{"version":3,"file":"src/js/main.server.js","sources":["../../src/js/environment.js","../../src/js/main.server.js"],"sourcesContent":["export const NODE = (typeof module !== 'undefined' && module.exports);\r\nexport const PARAMS = NODE ? { get: () => {} } : new URLSearchParams(window.location.search);\r\nexport const DEBUG = false || (PARAMS.get('debug') != null);\r\nexport const BASE_HREF = NODE ? null : document.querySelector('base').getAttribute('href');\r\nexport const STATIC = NODE ? false : (window && (window.location.port === '41999' || window.location.host === 'actarian.github.io'));\r\nexport const DEVELOPMENT = NODE ? false : (window && ['localhost', '127.0.0.1', '0.0.0.0'].indexOf(window.location.host.split(':')[0]) !== -1);\r\nexport const PRODUCTION = !DEVELOPMENT;\r\nexport const ENV = {\r\n\tSTATIC,\r\n\tDEVELOPMENT,\r\n\tPRODUCTION\r\n};\r\n\r\nexport class Environment {\r\n\r\n\tget href() {\r\n\t\tif (window.location.host.indexOf('herokuapp') !== -1) {\r\n\t\t\treturn 'https://raw.githubusercontent.com/actarian/b-here/b-here-barilla/docs/';\r\n\t\t} else {\r\n\t\t\treturn BASE_HREF;\r\n\t\t}\r\n\t}\r\n\r\n\tget host() {\r\n\t\tlet host = window.location.host.replace('127.0.0.1', '192.168.1.2');\r\n\t\t// let host = window.location.host;\r\n\t\tif (host.substr(host.length - 1, 1) === '/') {\r\n\t\t\thost = host.substr(0, host.length - 1);\r\n\t\t}\r\n\t\treturn `${window.location.protocol}//${host}${BASE_HREF}`;\r\n\t}\r\n\r\n\tgetModelPath(path) {\r\n\t\treturn this.href + this.paths.models + path;\r\n\t}\r\n\r\n\tgetTexturePath(path) {\r\n\t\treturn this.href + this.paths.textures + path;\r\n\t}\r\n\r\n\tgetFontPath(path) {\r\n\t\treturn this.href + this.paths.fonts + path;\r\n\t}\r\n\r\n\tconstructor(options) {\r\n\t\tif (options) {\r\n\t\t\tObject.assign(this, options);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport const environment = new Environment({\r\n\tappKey: '8b0cae93d47a44e48e97e7fd0404be4e',\r\n\tappCertificate: '',\r\n\tchannelName: 'BHere',\r\n\tpublisherId: '999',\r\n\tdebugMeetingId: '1591366622325',\r\n\tport: 5000,\r\n\tapiEnabled: false,\r\n\tpaths: {\r\n\t\tmodels: 'models/',\r\n\t\ttextures: 'textures/',\r\n\t\tfonts: 'fonts/',\r\n\t},\r\n\trenderOrder: {\r\n\t\tpanorama: 0,\r\n\t\tmodel: 10,\r\n\t\tplane: 20,\r\n\t\ttile: 30,\r\n\t\tbanner: 40,\r\n\t\tnav: 50,\r\n\t\tpanel: 60,\r\n\t\tmenu: 70,\r\n\t\tdebug: 80,\r\n\t\tpointer: 90,\r\n\t}\r\n});\r\n","const express = require('express');\r\nconst https = require('https');\r\nconst fs = require('fs');\r\nconst bodyParser = require('body-parser');\r\nconst serveStatic = require('serve-static');\r\nconst path = require('path');\r\nconst { RtcTokenBuilder, RtmTokenBuilder, RtcRole, RtmRole } = require('agora-access-token');\r\n\r\nimport { environment } from './environment';\r\n\r\nconst PORT = process.env.PORT || environment.port;\r\n\r\nvar app = express();\r\n\r\napp.disable('x-powered-by');\r\n\r\napp.use(express.static(path.join(__dirname, '../../docs/')));\r\napp.use('/b-here', serveStatic(path.join(__dirname, '../../docs/')));\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.raw());\r\n\r\n// app.use(express.favicon());\r\n/*\r\napp.get('/', function(request, response) {\r\n\tresponse.send('Hello World!');\r\n});\r\n*/\r\n/*\r\napp.set('views', path.join(__dirname, 'views'));\r\napp.set('view engine', 'ejs');\r\napp.get('/', (request, response) => response.render('pages/index'));\r\n*/\r\n// app.set('view engine', 'handlebars');\r\n\r\napp.get('/', function(request, response) {\r\n\tresponse.sendFile(path.join(__dirname, '../../docs/index.html'));\r\n\t// response.render('docs/index');\r\n});\r\n\r\napp.post('/api/token/rtc', function(request, response) {\r\n\tconst payload = request.body || {};\r\n\tconst duration = 3600;\r\n\tconst timestamp = Math.floor(Date.now() / 1000);\r\n\tconst expirationTime = timestamp + duration;\r\n\tconst uid = payload.uid ? String(payload.uid) : timestamp.toString();\r\n\tconst role = RtcRole.PUBLISHER;\r\n\tconst token = RtcTokenBuilder.buildTokenWithUid(environment.appKey, environment.appCertificate, environment.channelName, uid, role, expirationTime);\r\n\tresponse.send(JSON.stringify({\r\n\t\ttoken: token,\r\n\t}));\r\n});\r\n\r\napp.post('/api/token/rtm', function(request, response) {\r\n\tconst payload = request.body || {};\r\n\tconst duration = 3600;\r\n\tconst timestamp = Math.floor(Date.now() / 1000);\r\n\tconst expirationTime = timestamp + duration;\r\n\tconst uid = payload.uid ? String(payload.uid) : timestamp.toString();\r\n\tconst role = RtmRole.PUBLISHER;\r\n\tconst token = RtmTokenBuilder.buildToken(environment.appKey, environment.appCertificate, uid, role, expirationTime);\r\n\tresponse.send(JSON.stringify({\r\n\t\ttoken: token,\r\n\t}));\r\n});\r\n\r\napp.listen(PORT, () => {\r\n\tconsole.log(`Listening on ${ PORT }`);\r\n});\r\n\r\n/*\r\nhttps\r\n\t.createServer({\r\n\t\tcert: fs.readFileSync(path.join(__dirname, '../../certs/server.crt'), 'utf8'),\r\n\t\tkey: fs.readFileSync(path.join(__dirname, '../../certs/server.key'), 'utf8')\r\n\t}, app)\r\n\t.listen(PORT, function() {\r\n\t\tconsole.log(`Example app listening on port ${PORT}! Go to https://192.168.1.2:${PORT}/`);\r\n\t});\r\n*/\r\n\r\n// IMPORTANT! Build token with either the uid or with the user account. Comment out the option you do not want to use below.\r\n\r\n// Build token with uid\r\n// const token = RtcTokenBuilder.buildTokenWithUid(environment.appKey, environment.appCertificate, environment.channelName, uid, role, expirationTime);\r\n\r\n// Build token with user account\r\n// const token = RtcTokenBuilder.buildTokenWithAccount(environment.appKey, environment.appCertificate, environment.channelName, account, role, expirationTime);\r\n"],"names":["NODE","module","exports","PARAMS","get","URLSearchParams","window","location","search","DEBUG","BASE_HREF","document","querySelector","getAttribute","DEVELOPMENT","indexOf","host","split","Environment","getModelPath","path","href","paths","models","getTexturePath","textures","getFontPath","fonts","replace","substr","length","protocol","options","Object","assign","environment","appKey","appCertificate","channelName","publisherId","debugMeetingId","port","apiEnabled","renderOrder","panorama","model","plane","tile","banner","nav","panel","menu","debug","pointer","express","require","https","fs","bodyParser","serveStatic","RtcTokenBuilder","RtmTokenBuilder","RtcRole","RtmRole","PORT","process","env","app","disable","use","static","join","__dirname","urlencoded","extended","json","raw","request","response","sendFile","post","payload","body","duration","timestamp","Math","floor","Date","now","expirationTime","uid","String","toString","role","PUBLISHER","token","buildTokenWithUid","send","JSON","stringify","buildToken","listen","console","log"],"mappings":"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"}