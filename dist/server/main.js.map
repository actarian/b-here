{"version":3,"file":"server/main.js","sources":["../../server/upload/upload.js","../../server/static/static.js","../../server/api/api.js","../../server/main.js"],"sourcesContent":["const fs = require('fs'),\r\n\tpath = require('path'),\r\n\tmv = require('mv');\r\n\r\nfunction upload(temporaryFolder) {\r\n\tconst instance = {};\r\n\tinstance.temporaryFolder = temporaryFolder;\r\n\tinstance.maxFileSize = null;\r\n\tinstance.fileParameterName = 'file';\r\n\ttry {\r\n\t\tfs.mkdirSync(instance.temporaryFolder);\r\n\t} catch (e) { }\r\n\tfunction cleanIdentifier(identifier) {\r\n\t\treturn identifier.replace(/[^0-9A-Za-z_-]/g, '');\r\n\t}\r\n\tfunction getChunkFilename(chunkNumber, identifier) {\r\n\t\t// Clean up the identifier\r\n\t\tidentifier = cleanIdentifier(identifier);\r\n\t\t// What would the file name be?\r\n\t\treturn path.resolve(instance.temporaryFolder, './chunk-' + identifier + '.' + chunkNumber);\r\n\t}\r\n\tfunction validateRequest(chunkNumber, chunkSize, totalSize, identifier, filename, fileSize) {\r\n\t\t// Clean up the identifier\r\n\t\tidentifier = cleanIdentifier(identifier);\r\n\t\t// Check if the request is sane\r\n\t\tif (chunkNumber == 0 || chunkSize == 0 || totalSize == 0 || identifier.length == 0 || filename.length == 0) {\r\n\t\t\treturn 'non_flow_request';\r\n\t\t}\r\n\t\tconst numberOfChunks = Math.max(Math.floor(totalSize / (chunkSize * 1.0)), 1);\r\n\t\tif (chunkNumber > numberOfChunks) {\r\n\t\t\treturn 'invalid_flow_request1';\r\n\t\t}\r\n\t\t// Is the file too big?\r\n\t\tif (instance.maxFileSize && totalSize > instance.maxFileSize) {\r\n\t\t\treturn 'invalid_flow_request2';\r\n\t\t}\r\n\t\tif (typeof (fileSize) != 'undefined') {\r\n\t\t\tif (chunkNumber < numberOfChunks && fileSize != chunkSize) {\r\n\t\t\t\t// The chunk in the POST request isn't the correct size\r\n\t\t\t\treturn 'invalid_flow_request3';\r\n\t\t\t}\r\n\t\t\tif (numberOfChunks > 1 && chunkNumber == numberOfChunks && fileSize != ((totalSize % chunkSize) + parseInt(chunkSize))) {\r\n\t\t\t\t// The chunks in the POST is the last one, and the fil is not the correct size\r\n\t\t\t\treturn 'invalid_flow_request4';\r\n\t\t\t}\r\n\t\t\tif (numberOfChunks == 1 && fileSize != totalSize) {\r\n\t\t\t\t// The file is only a single chunk, and the data size does not fit\r\n\t\t\t\treturn 'invalid_flow_request5';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn 'valid';\r\n\t}\r\n\t//'found', filename, original_filename, identifier\r\n\t//'not_found', null, null, null\r\n\tinstance.get = function(req, callback) {\r\n\t\tconst chunkNumber = req.param('flowChunkNumber', 0);\r\n\t\tconst chunkSize = req.param('flowChunkSize', 0);\r\n\t\tconst totalSize = req.param('flowTotalSize', 0);\r\n\t\tconst identifier = req.param('flowIdentifier', \"\");\r\n\t\tconst filename = req.param('flowFilename', \"\");\r\n\t\tif (validateRequest(chunkNumber, chunkSize, totalSize, identifier, filename) == 'valid') {\r\n\t\t\tconst chunkFilename = getChunkFilename(chunkNumber, identifier);\r\n\t\t\t// console.log('test chunkFilename', chunkFilename);\r\n\t\t\tfs.access(chunkFilename, fs.constants.F_OK, (error) => {\r\n\t\t\t\tif (error) {\r\n\t\t\t\t\tcallback('not_found', null, null, null);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallback('found', chunkFilename, filename, identifier);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tcallback('not_found', null, null, null);\r\n\t\t}\r\n\t};\r\n\t//'partly_done', filename, original_filename, identifier\r\n\t//'done', filename, original_filename, identifier\r\n\t//'invalid_flow_request', null, null, null\r\n\t//'non_flow_request', null, null, null\r\n\tinstance.post = function(req, callback) {\r\n\t\tconst fields = req.body;\r\n\t\tconst files = req.files;\r\n\t\tconst chunkNumber = fields['flowChunkNumber'];\r\n\t\tconst chunkSize = fields['flowChunkSize'];\r\n\t\tconst totalSize = fields['flowTotalSize'];\r\n\t\tconst identifier = cleanIdentifier(fields['flowIdentifier']);\r\n\t\tconst filename = fields['flowFilename'];\r\n\t\tif (!files[instance.fileParameterName] || !files[instance.fileParameterName].size) {\r\n\t\t\tcallback('invalid_flow_request', null, null, null);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst original_filename = files[instance.fileParameterName]['originalFilename'];\r\n\t\tconst validation = validateRequest(chunkNumber, chunkSize, totalSize, identifier, filename, files[instance.fileParameterName].size);\r\n\t\tif (validation == 'valid') {\r\n\t\t\tconst chunkFilename = getChunkFilename(chunkNumber, identifier);\r\n\t\t\t// Save the chunk (TODO: OVERWRITE)\r\n\t\t\tmv(files[instance.fileParameterName].path, chunkFilename, function() {\r\n\t\t\t\t// Do we have all the chunks?\r\n\t\t\t\tlet currentTestChunk = 1;\r\n\t\t\t\tconst numberOfChunks = Math.max(Math.floor(totalSize / (chunkSize * 1.0)), 1);\r\n\t\t\t\tconst testChunkExists = function() {\r\n\t\t\t\t\tconst chunkFilename = getChunkFilename(currentTestChunk, identifier);\r\n\t\t\t\t\t// console.log('test chunkFilename', chunkFilename);\r\n\t\t\t\t\tfs.access(chunkFilename, fs.constants.F_OK, (error) => {\r\n\t\t\t\t\t\tif (error) {\r\n\t\t\t\t\t\t\tcallback('partly_done', filename, original_filename, identifier);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcurrentTestChunk++;\r\n\t\t\t\t\t\t\tif (currentTestChunk > numberOfChunks) {\r\n\t\t\t\t\t\t\t\tcallback('done', filename, original_filename, identifier);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t// Recursion\r\n\t\t\t\t\t\t\t\ttestChunkExists();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\ttestChunkExists();\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tcallback(validation, filename, original_filename, identifier);\r\n\t\t}\r\n\t};\r\n\t// Pipe chunks directly in to an existsing WritableStream\r\n\t//   r.write(identifier, response);\r\n\t//   r.write(identifier, response, {end:false});\r\n\t//\r\n\t//   const stream = fs.createWriteStream(filename);\r\n\t//   r.write(identifier, stream);\r\n\t//   stream.on('data', function(data){...});\r\n\t//   stream.on('finish', function(){...});\r\n\tinstance.write = function(identifier, stream, options) {\r\n\t\toptions = options || {};\r\n\t\toptions.end = (typeof options['end'] == 'undefined' ? true : options['end']);\r\n\t\t// Iterate over each chunk\r\n\t\tconst pipeChunk = function(number) {\r\n\t\t\tconst chunkFilename = getChunkFilename(number, identifier);\r\n\t\t\tfs.access(chunkFilename, fs.constants.F_OK, (error) => {\r\n\t\t\t\tif (error) {\r\n\t\t\t\t\t// When all the chunks have been piped, end the stream\r\n\t\t\t\t\tif (options.end) {\r\n\t\t\t\t\t\tstream.end();\r\n\t\t\t\t\t\tinstance.clean(identifier, options);\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// if (options.onDone) options.onDone();\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// If the chunk with the current number exists,\r\n\t\t\t\t\t// then create a ReadStream from the file\r\n\t\t\t\t\t// and pipe it to the specified stream.\r\n\t\t\t\t\tconst source = fs.createReadStream(chunkFilename);\r\n\t\t\t\t\tsource.pipe(stream, {\r\n\t\t\t\t\t\tend: false\r\n\t\t\t\t\t});\r\n\t\t\t\t\tsource.on('end', function() {\r\n\t\t\t\t\t\t// When the chunk is fully streamed,\r\n\t\t\t\t\t\t// jump to the next one\r\n\t\t\t\t\t\tpipeChunk(number + 1);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\tpipeChunk(1);\r\n\t};\r\n\tinstance.clean = function(identifier, options) {\r\n\t\toptions = options || {};\r\n\t\t// Iterate over each chunk\r\n\t\tconst pipeChunkRm = function(number) {\r\n\t\t\tconst chunkFilename = getChunkFilename(number, identifier);\r\n\t\t\t//console.log('removing pipeChunkRm ', number, 'chunkFilename', chunkFilename);\r\n\t\t\tfs.access(chunkFilename, fs.constants.F_OK, (error) => {\r\n\t\t\t\tif (error) {\r\n\t\t\t\t\tif (options.onDone) options.onDone();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.log('exist removing ', chunkFilename);\r\n\t\t\t\t\tfs.unlink(chunkFilename, function(err) {\r\n\t\t\t\t\t\tif (err && options.onError) options.onError(err);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tpipeChunkRm(number + 1);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t\tpipeChunkRm(1);\r\n\t};\r\n\treturn instance;\r\n}\r\n\r\nmodule.exports = {\r\n\tupload: upload,\r\n};\r\n","const path = require('path');\r\nconst fs = require('fs');\r\n// const router = express.Router();\r\n// const serveStatic = require('serve-static');\r\n\r\nconst MIME_CONTENT_TYPES = {\r\n\t\"css\": \"text/css\", // Cascading Style Sheets (CSS)\r\n\t\"csv\": \"text/csv\", // Comma-separated values (CSV)\r\n\t\"htm\": \"text/html\", // HyperText Markup Language (HTML)\r\n\t\"html\": \"text/html\", // HyperText Markup Language (HTML)\r\n\t\"ics\": \"text/calendar\", // iCalendar format\r\n\t\"js\": \"text/javascript\", // per the following specifications: https://html.spec.whatwg.org/multipage/#scriptingLanguages, https://html.spec.whatwg.org/multipage/#dependencies:willful-violation, https://datatracker.ietf.org/doc/draft-ietf-dispatch-javascript-mjs/ JavaScript\r\n\t\"mjs\": \"text/javascript\", // JavaScript module\r\n\t\"txt\": \"text/plain\", // Text, (generally ASCII or ISO 8859-n)\r\n\t\"xml\": \"text/xml\", // if readable from casual users (RFC 3023, section 3) \"application/xml\" if not readable from casual users (RFC 3023, section 3)\", // XML\r\n\t\"bmp\": \"image/bmp\", // Windows OS/2 Bitmap Graphics\r\n\t\"gif\": \"image/gif\", // Graphics Interchange Format (GIF)\r\n\t\"ico\": \"image/vnd.microsoft.icon\", // Icon format\r\n\t\"jpeg\": \"image/jpeg\", // JPEG images\r\n\t\"jpg\": \"image/jpeg\", // JPEG images\r\n\t\"png\": \"image/png\", // Portable Network Graphics\r\n\t\"svg\": \"image/svg+xml\", // Scalable Vector Graphics (SVG)\r\n\t\"tif\": \"image/tiff\", // Tagged Image File Format (TIFF)\r\n\t\"tiff\": \"image/tiff\", // Tagged Image File Format (TIFF)\r\n\t\"webp\": \"image/webp\", // WEBP image\r\n\t\"otf\": \"font/otf\", // OpenType font\r\n\t\"ttf\": \"font/ttf\", // TrueType Font\r\n\t\"woff\": \"font/woff\", // Web Open Font Format (WOFF)\r\n\t\"woff2\": \"font/woff2\", // Web Open Font Format (WOFF)\r\n\t\"aac\": \"audio/aac\", // AAC audio\r\n\t\"mid\": \"audio/midi audio/x-midi\", // Musical Instrument Digital Interface (MIDI)\r\n\t\"midi\": \"audio/midi audio/x-midi\", // Musical Instrument Digital Interface (MIDI)\r\n\t\"mp3\": \"audio/mpeg\", // MP3 audio\r\n\t\"mp4\": \"audio/mp4\", // MP4 video\r\n\t\"oga\": \"audio/ogg\", // OGG audio\r\n\t\"opus\": \"audio/opus\", // Opus audio\r\n\t\"wav\": \"audio/wav\", // Waveform Audio Format\r\n\t\"weba\": \"audio/webm\", // WEBM audio\r\n\t\"avi\": \"video/x-msvideo\", // AVI: Audio Video Interleave\r\n\t\"mpeg\": \"video/mpeg\", // MPEG Video\r\n\t\"ogv\": \"video/ogg\", // OGG video\r\n\t\"ts\": \"video/mp2t\", // MPEG transport stream\r\n\t\"webm\": \"video/webm\", // WEBM video\r\n\t\"3gp\": \"video/3gpp\", //\taudio/3gpp if it doesn't contain video\", // 3GPP audio/video container\r\n\t\"3g2\": \"video/3gpp2\", // audio/3gpp2 if it doesn't contain video\", // 3GPP2 audio/video container\r\n\t\"abw\": \"application/x-abiword\", // AbiWord document\r\n\t\"arc\": \"application/x-freearc\", // Archive document (multiple files embedded)\r\n\t\"azw\": \"application/vnd.amazon.ebook\", // Amazon Kindle eBook format\r\n\t\"bin\": \"application/octet-stream\", // Any kind of binary data\r\n\t\"bz\": \"application/x-bzip\", // BZip archive\r\n\t\"bz2\": \"application/x-bzip2\", // BZip2 archive\r\n\t\"csh\": \"application/x-csh\", // C-Shell script\r\n\t\"doc\": \"application/msword\", // Microsoft Word\r\n\t\"docx\": \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\", // Microsoft Word (OpenXML)\r\n\t\"eot\": \"application/vnd.ms-fontobject\", // MS Embedded OpenType fonts\r\n\t\"epub\": \"application/epub+zip\", // Electronic publication (EPUB)\r\n\t\"gz\": \"application/gzip\", // GZip Compressed Archive\r\n\t\"jar\": \"application/java-archive\", // Java Archive (JAR)\r\n\t\"json\": \"application/json\", // JSON format\r\n\t\"jsonld\": \"application/ld+json\", // JSON-LD format\r\n\t\"map\": \"application/ld+json\", // sourcemaps\r\n\t\"mpkg\": \"application/vnd.apple.installer+xml\", // Apple Installer Package\r\n\t\"odp\": \"application/vnd.oasis.opendocument.presentation\", // OpenDocument presentation document\r\n\t\"ods\": \"application/vnd.oasis.opendocument.spreadsheet\", // OpenDocument spreadsheet document\r\n\t\"odt\": \"application/vnd.oasis.opendocument.text\", // OpenDocument text document\r\n\t\"ogx\": \"application/ogg\", // OGG\r\n\t\"pdf\": \"application/pdf\", // Adobe Portable Document Format (PDF)\r\n\t\"php\": \"application/x-httpd-php\", // Hypertext Preprocessor (Personal Home Page)\r\n\t\"ppt\": \"application/vnd.ms-powerpoint\", // Microsoft PowerPoint\r\n\t\"pptx\": \"application/vnd.openxmlformats-officedocument.presentationml.presentation\", // Microsoft PowerPoint (OpenXML)\r\n\t\"rar\": \"application/vnd.rar\", // RAR archive\r\n\t\"rtf\": \"application/rtf\", // Rich Text Format (RTF)\r\n\t\"sh\": \"application/x-sh\", // Bourne shell script\r\n\t\"swf\": \"application/x-shockwave-flash\", // Small web format (SWF) or Adobe Flash document\r\n\t\"tar\": \"application/x-tar\", // Tape Archive (TAR)\r\n\t\"vsd\": \"application/vnd.visio\", // Microsoft Visio\r\n\t\"webmanifest\": \"application/json\", // webmanifest\r\n\t\"xhtml\": \"application/xhtml+xml\", // XHTML\r\n\t\"xls\": \"application/vnd.ms-excel\", // Microsoft Excel\r\n\t\"xlsx\": \"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet\", // Microsoft Excel (OpenXML)\r\n\t\"xul\": \"application/vnd.mozilla.xul+xml\", // XUL\r\n\t\"zip\": \"application/zip\", // ZIP archive\r\n\t\"7z\": \"application/x-7z-compressed\", // 7-zip archive,\r\n\t\"glb\": \"application/octet-stream\", // Glb\r\n\t\"gltf\": \"application/octet-stream\", // Gltf\r\n\t\"fbx\": \"application/octet-stream\", // Fbx\r\n\t\"usdz\": \"application/octet-stream\", // Usdz\r\n};\r\nconst MIME_TEXT = [\r\n\t'css', 'csv', 'htm', 'html', 'ics', 'js', 'mjs', 'txt', 'xml',\r\n];\r\nconst MIME_IMAGE = [\r\n\t'bmp', 'gif', 'ico', 'jpeg', 'jpg', 'png', 'svg', 'tif', 'tiff', 'webp',\r\n];\r\nconst MIME_FONTS = [\r\n\t'otf', 'ttf', 'woff', 'woff2',\r\n];\r\nconst MIME_AUDIO = [\r\n\t'aac', 'mid', 'midi', 'mp3', 'oga', 'opus', 'wav', 'weba',\r\n];\r\nconst MIME_VIDEO = [\r\n\t'mp4', 'avi', 'mpeg', 'ogv', 'ts', 'webm', '3gp', '3g2',\r\n];\r\nconst MIME_APPLICATION = [\r\n\t'abw', 'arc', 'azw', 'bin', 'bz', 'bz2', 'csh', 'doc', 'docx', 'eot', 'epub', 'gz', 'jar', 'json', 'jsonld', 'map', 'mpkg', 'odp', 'ods', 'odt', 'ogx', 'pdf', 'php', 'ppt', 'pptx', 'rar', 'rtf', 'sh', 'swf', 'tar', 'vsd', 'webmanifest', 'xhtml', 'xls', 'xlsx', 'xul', 'zip', '7z',\r\n\t'glb', 'gltf', 'fbx', 'usdz',\r\n];\r\nconst MIME_TYPES = [\r\n\t...MIME_TEXT,\r\n\t...MIME_IMAGE,\r\n\t...MIME_FONTS,\r\n\t...MIME_AUDIO,\r\n\t...MIME_VIDEO,\r\n\t...MIME_APPLICATION,\r\n];\r\n\r\nfunction staticMiddleware(vars) {\r\n\tif (!vars.root) {\r\n\t\tthrow new Error('missing Vars.root!');\r\n\t}\r\n\tif (!vars.baseHref) {\r\n\t\tthrow new Error('missing Vars.baseHref!');\r\n\t}\r\n\treturn (request, response, next) => {\r\n\t\tconst url = unescape(request.baseUrl.replace(/\\\\/g, '/'));\r\n\t\tconst baseHref = vars.baseHref.substr(0, vars.baseHref.length - 1).replace(/\\\\/g, '/');\r\n\t\tconst regExpText = `^(${baseHref})?(\\\\/[^\\\\?\\\\#]+)(\\\\.(${MIME_TYPES.join('|')}))(\\\\?.+)?(\\\\#.+)?$`;\r\n\t\t// console.log('regExpText', url, regExpText);\r\n\t\tconst regExp = new RegExp(regExpText);\r\n\t\t// console.log('NodeJs.regExp', regExp);\r\n\t\tconst matches = regExp.exec(url);\r\n\t\t// console.log(request.url, request.baseUrl, request.originalUrl, match);\r\n\t\tif (matches) {\r\n\t\t\tconst extension = matches[4];\r\n\t\t\tconst file = path.join(matches[2] + '.' + extension);\r\n\t\t\tconst filePath = path.join(__dirname, '../', vars.root, file);\r\n\t\t\tfs.readFile(filePath, {}, (error, data) => {\r\n\t\t\t\tif (error) {\r\n\t\t\t\t\tconsole.log('NodeJs.staticMiddleware.notFound', file);\r\n\t\t\t\t\treturn next();\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log('NodeJs.staticMiddleware.serving', file);\r\n\t\t\t\tresponse.set('Content-Type', MIME_CONTENT_TYPES[extension]);\r\n\t\t\t\tresponse.send(data);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\t// console.log('NodeJs.staticMiddleware.unmatch', file);\r\n\t\t\tnext();\r\n\t\t}\r\n\t};\r\n};\r\n\r\n// app.use(express.static(BASE_HREF, { index: false, extensions: MIME_TYPES }));\r\n// app.use(express.static('/', { index: false, extensions: MIME_TYPES }));\r\n// app.use(STATIC_REGEXP, serveStatic(path.join(__dirname, `${ROOT}`)));\r\n// app.use('/', serveStatic(path.join(__dirname, `${ROOT}`)));\r\n// app.use(express.static(path.join(__dirname, ROOT)));\r\n\r\nmodule.exports = {\r\n\tmimeContentTypes: MIME_CONTENT_TYPES,\r\n\tmimeText: MIME_TEXT,\r\n\tmimeImage: MIME_IMAGE,\r\n\tmimeFonts: MIME_FONTS,\r\n\tmimeAudio: MIME_AUDIO,\r\n\tmimeVideo: MIME_VIDEO,\r\n\tmimeApplication: MIME_APPLICATION,\r\n\tstaticMiddleware: staticMiddleware,\r\n};\r\n","const fs = require('fs');\r\nconst path = require('path');\r\n\r\nconst RoleType = {\r\n\tPublisher: 'publisher',\r\n\tAttendee: 'attendee',\r\n\tStreamer: 'streamer',\r\n\tViewer: 'viewer',\r\n\tSelfService: 'self-service',\r\n};\r\n\r\n/*\r\nconst { RtcTokenBuilder, RtmTokenBuilder, RtcRole, RtmRole } = require('agora-access-token');\r\nconst appCertificate = '';\r\n\r\napp.post('/api/token/rtc', function(request, response) {\r\n\tconst payload = request.body || {};\r\n\tconst duration = 3600;\r\n\tconst timestamp = Math.floor(Date.now() / 1000);\r\n\tconst expirationTime = timestamp + duration;\r\n\tconst uid = payload.uid ? String(payload.uid) : timestamp.toString();\r\n\tconst role = RtcRole.PUBLISHER;\r\n\tconst token = RtcTokenBuilder.buildTokenWithUid(environment.appKey, appCertificate, environment.channelName, uid, role, expirationTime);\r\n\tresponse.send(JSON.stringify({\r\n\t\ttoken: token,\r\n\t}));\r\n});\r\n\r\napp.post('/api/token/rtm', function(request, response) {\r\n\tconst payload = request.body || {};\r\n\tconst duration = 3600;\r\n\tconst timestamp = Math.floor(Date.now() / 1000);\r\n\tconst expirationTime = timestamp + duration;\r\n\tconst uid = payload.uid ? String(payload.uid) : timestamp.toString();\r\n\tconst role = RtmRole.PUBLISHER;\r\n\tconst token = RtmTokenBuilder.buildToken(environment.appKey, appCertificate, uid, role, expirationTime);\r\n\tresponse.send(JSON.stringify({\r\n\t\ttoken: token,\r\n\t}));\r\n});\r\n*/\r\n\r\nlet db = {\r\n\tviews: [], assets: [], users: [\r\n\t\t{\r\n\t\t\tid: '1601892639985',\r\n\t\t\tusername: 'publisher',\r\n\t\t\tpassword: 'publisher',\r\n\t\t\ttype: 'publisher',\r\n\t\t\tfirstName: 'Jhon',\r\n\t\t\tlastName: 'Appleseed',\r\n\t\t}, {\r\n\t\t\tid: '1601892639986',\r\n\t\t\tusername: 'attendee',\r\n\t\t\tpassword: 'attendee',\r\n\t\t\ttype: 'attendee',\r\n\t\t\tfirstName: 'Jhon',\r\n\t\t\tlastName: 'Appleseed',\r\n\t\t}\r\n\t]\r\n};\r\n\r\nconst pathname = path.join(__dirname, `../../docs/api/editor.json`);\r\nreadStore();\r\n\r\nfunction uuid() {\r\n\t// return new Date().getTime();\r\n\treturn parseInt(process.hrtime.bigint().toString());\r\n}\r\n\r\nfunction useApi() {\r\n\treturn null;\r\n}\r\n\r\nfunction readStore() {\r\n\tfs.readFile(pathname, 'utf8', (error, data) => {\r\n\t\tif (error) {\r\n\t\t\tconsole.log('NodeJs.Api.readStore.error', error, pathname);\r\n\t\t} else {\r\n\t\t\ttry {\r\n\t\t\t\tdb = Object.assign(db, JSON.parse(data));\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.log('NodeJs.Api.readStore.error', error, pathname);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction saveStore() {\r\n\tconst data = JSON.stringify(db, null, 2);\r\n\tfs.writeFile(pathname, data, 'utf8', (error, data) => {\r\n\t\tif (error) {\r\n\t\t\tconsole.log('NodeJs.Api.saveStore.error', error, pathname);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction sendError(response, status, message) {\r\n\tresponse.status(status).set('Content-Type', 'application/json').send(JSON.stringify({ status, message }));\r\n}\r\n\r\nfunction sendOk(response, data) {\r\n\tif (data) {\r\n\t\tresponse.status(200).set('Content-Type', 'application/json').send(JSON.stringify(data));\r\n\t} else {\r\n\t\tresponse.status(200).set('Content-Type', 'text/plain').send();\r\n\t}\r\n}\r\n\r\nfunction doCreate(request, response, params, items) {\r\n\tconst body = request.body;\r\n\tconst id = uuid();\r\n\tconst item = Object.assign({}, body, { id });\r\n\tif (item.items) {\r\n\t\titem.items.forEach(x => x.id = uuid());\r\n\t}\r\n\tif (item.tiles) {\r\n\t\titem.tiles.forEach(x => x.id = uuid());\r\n\t}\r\n\tif (item.navs) {\r\n\t\titem.navs.forEach(x => x.id = uuid());\r\n\t}\r\n\titems.push(item);\r\n\tsaveStore();\r\n\tsendOk(response, item);\r\n}\r\n\r\nfunction doUpdate(request, response, params, items) {\r\n\tconst body = request.body;\r\n\tconst item = items.find(x => x.id === body.id);\r\n\tif (item) {\r\n\t\tObject.assign(item, body);\r\n\t\tsaveStore();\r\n\t\tsendOk(response, item);\r\n\t} else {\r\n\t\tsendError(response, 404, 'Not Found');\r\n\t}\r\n}\r\n\r\nfunction doDelete(request, response, params, items) {\r\n\tconst index = items.reduce((p, x, i) => x.id === params.id ? i : p, -1);\r\n\tif (index !== -1) {\r\n\t\t// const item = items[index];\r\n\t\titems.splice(index, 1);\r\n\t\tsaveStore();\r\n\t\t// sendOk(response, item);\r\n\t\tsendOk(response);\r\n\t} else {\r\n\t\tsendError(response, 404, 'Not Found');\r\n\t}\r\n}\r\n\r\nfunction doGet(request, response, params, items) {\r\n\tlet item = items.find(x => x.id === params.id);\r\n\tif (!item) {\r\n\t\tsendError(response, 404, 'Not Found');\r\n\t}\r\n\treturn item;\r\n}\r\n\r\n// /api/upload\r\nconst ROUTES = [{\r\n\tpath: '/api/view', method: 'GET', callback: function(request, response, params) {\r\n\t\tsendOk(response, db);\r\n\t}\r\n}, {\r\n\tpath: '/api/view/:viewId', method: 'GET', callback: function(request, response, params) {\r\n\t\tconst view = doGet(request, response, { id: params.viewId }, db.views);\r\n\t\tif (view) {\r\n\t\t\tsendOk(response, view);\r\n\t\t}\r\n\t}\r\n}, {\r\n\tpath: '/api/view', method: 'POST', callback: function(request, response, params) {\r\n\t\tdoCreate(request, response, params, db.views);\r\n\t}\r\n}, {\r\n\tpath: '/api/view/:viewId', method: 'PUT', callback: function(request, response, params) {\r\n\t\tdoUpdate(request, response, params, db.views);\r\n\t}\r\n}, {\r\n\tpath: '/api/view/:viewId', method: 'DELETE', callback: function(request, response, params) {\r\n\t\tdoDelete(request, response, { id: params.viewId }, db.views);\r\n\t}\r\n}, {\r\n\tpath: '/api/view/:viewId/item', method: 'POST', callback: function(request, response, params) {\r\n\t\tconst view = doGet(request, response, { id: params.viewId }, db.views);\r\n\t\tif (view) {\r\n\t\t\tview.items = view.items || [];\r\n\t\t\tdoCreate(request, response, params, view.items);\r\n\t\t}\r\n\t}\r\n}, {\r\n\tpath: '/api/view/:viewId/item/:viewItemId', method: 'PUT', callback: function(request, response, params) {\r\n\t\tconst view = doGet(request, response, { id: params.viewId }, db.views);\r\n\t\tif (view) {\r\n\t\t\tview.items = view.items || [];\r\n\t\t\tdoUpdate(request, response, params, view.items);\r\n\t\t}\r\n\t}\r\n}, {\r\n\tpath: '/api/view/:viewId/item/:viewItemId', method: 'DELETE', callback: function(request, response, params) {\r\n\t\tconst view = doGet(request, response, { id: params.viewId }, db.views);\r\n\t\tif (view) {\r\n\t\t\tdoDelete(request, response, { id: params.viewItemId }, view.items);\r\n\t\t}\r\n\t}\r\n}, {\r\n\tpath: '/api/view/:viewId/tile/:tileId/item', method: 'POST', callback: function(request, response, params) {\r\n\t\tconst view = doGet(request, response, { id: params.viewId }, db.views);\r\n\t\tif (view) {\r\n\t\t\tconst tile = view.tiles.find(x => x.id === params.tileId);\r\n\t\t\tif (tile) {\r\n\t\t\t\ttile.navs = tile.navs || [];\r\n\t\t\t\tdoCreate(request, response, params, tile.navs);\r\n\t\t\t} else {\r\n\t\t\t\tsendError(response, 404, 'Not Found');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}, {\r\n\tpath: '/api/view/:viewId/tile/:tileId/item/:viewItemId', method: 'PUT', callback: function(request, response, params) {\r\n\t\tconst view = doGet(request, response, { id: params.viewId }, db.views);\r\n\t\tif (view) {\r\n\t\t\tconst tile = view.tiles.find(x => x.id === params.tileId);\r\n\t\t\tif (tile) {\r\n\t\t\t\ttile.navs = tile.navs || [];\r\n\t\t\t\tdoUpdate(request, response, params, tile.navs);\r\n\t\t\t} else {\r\n\t\t\t\tsendError(response, 404, 'Not Found');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}, {\r\n\tpath: '/api/view/:viewId/tile/:tileId/item/:viewItemId', method: 'DELETE', callback: function(request, response, params) {\r\n\t\tconst view = doGet(request, response, { id: params.viewId }, db.views);\r\n\t\tif (view) {\r\n\t\t\tconst tile = view.tiles.find(x => x.id === params.tileId);\r\n\t\t\tif (tile) {\r\n\t\t\t\ttile.navs = tile.navs || [];\r\n\t\t\t\tdoDelete(request, response, { id: params.viewItemId }, tile.navs);\r\n\t\t\t} else {\r\n\t\t\t\tsendError(response, 404, 'Not Found');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}, {\r\n\tpath: '/api/asset', method: 'POST', callback: function(request, response, params) {\r\n\t\tdoCreate(request, response, params, db.assets);\r\n\t}\r\n}, {\r\n\tpath: '/api/asset/:assetId', method: 'PUT', callback: function(request, response, params) {\r\n\t\tdoUpdate(request, response, params, db.assets);\r\n\t}\r\n}, {\r\n\tpath: '/api/asset/:assetId', method: 'DELETE', callback: function(request, response, params) {\r\n\t\tdoDelete(request, response, { id: params.assetId }, db.assets);\r\n\t}\r\n}, {\r\n\tpath: '/api/user/me', method: 'GET', callback: function(request, response, params) {\r\n\t\tconst user = request.session.user;\r\n\t\tif (!user) {\r\n\t\t\tsendError(response, 404, 'Not Found');\r\n\t\t} else {\r\n\t\t\tsendOk(response, user);\r\n\t\t}\r\n\t}\r\n}, {\r\n\tpath: '/api/user/login', method: 'POST', callback: function(request, response, params) {\r\n\t\tconst body = request.body;\r\n\t\tconst user = db.users.find(x => x.username === body.username && x.password === body.password);\r\n\t\tif (!user) {\r\n\t\t\tsendError(response, 404, 'Not Found');\r\n\t\t} else {\r\n\t\t\trequest.session.user = user;\r\n\t\t\tsendOk(response, user);\r\n\t\t}\r\n\t}\r\n}, {\r\n\tpath: '/api/user/logout', method: 'GET', callback: function(request, response, params) {\r\n\t\tconst user = request.session.user;\r\n\t\trequest.session.user = null;\r\n\t\tsendOk(response);\r\n\t}\r\n}, {\r\n\tpath: '/api/user/guided-tour', method: 'POST', callback: function(request, response, params) {\r\n\t\tconst body = request.body;\r\n\t\tconst id = uuid();\r\n\t\tconst user = Object.assign({ type: RoleType.Streamer }, body, { id });\r\n\t\trequest.session.user = null;\r\n\t\tdb.users.push(user);\r\n\t\tsaveStore();\r\n\t\tsendOk(response, user);\r\n\t}\r\n}, {\r\n\tpath: '/api/user/self-service-tour', method: 'POST', callback: function(request, response, params) {\r\n\t\tconst body = request.body;\r\n\t\tconst id = uuid();\r\n\t\tconst user = Object.assign({ type: RoleType.SelfService }, body, { id });\r\n\t\trequest.session.user = user;\r\n\t\tdb.users.push(user);\r\n\t\tsaveStore();\r\n\t\tsendOk(response, user);\r\n\t}\r\n}];\r\nROUTES.forEach(route => {\r\n\tconst segments = [];\r\n\tif (route.path === '**') {\r\n\t\tsegments.push(route.path);\r\n\t\troute.matcher = new RegExp('^.*$');\r\n\t} else {\r\n\t\tconst matchers = [`^`];\r\n\t\tconst regExp = /(^\\.\\.\\/|\\.\\/|\\/\\/|\\/)|([^:|\\/]+)\\/?|\\:([^\\/]+)\\/?/g;\r\n\t\tconst matches = route.path.matchAll(regExp);\r\n\t\tlet relative;\r\n\t\tfor (let match of matches) {\r\n\t\t\tconst g1 = match[1];\r\n\t\t\tconst g2 = match[2];\r\n\t\t\tconst g3 = match[3];\r\n\t\t\tif (g1) {\r\n\t\t\t\trelative = !(g1 === '//' || g1 === '/');\r\n\t\t\t} else if (g2) {\r\n\t\t\t\tmatchers.push(`\\/(${g2})`);\r\n\t\t\t\tsegments.push({ name: g2, param: null, value: null });\r\n\t\t\t} else if (g3) {\r\n\t\t\t\tmatchers.push('\\/([^\\/]+)');\r\n\t\t\t\tconst params = {};\r\n\t\t\t\tparams[g3] = null;\r\n\t\t\t\troute.params = params;\r\n\t\t\t\tsegments.push({ name: '', param: g3, value: null });\r\n\t\t\t}\r\n\t\t}\r\n\t\tmatchers.push('$');\r\n\t\tconst regexp = matchers.join('');\r\n\t\tconsole.log(regexp)\r\n\t\troute.matcher = new RegExp(regexp);\r\n\t}\r\n\troute.segments = segments;\r\n})\r\n\r\nfunction apiMiddleware(vars) {\r\n\tif (!vars.root) {\r\n\t\tthrow new Error('missing Vars.root!');\r\n\t}\r\n\tif (!vars.baseHref) {\r\n\t\tthrow new Error('missing Vars.baseHref!');\r\n\t}\r\n\treturn (request, response, next) => {\r\n\t\tconst url = request.baseUrl.replace(/\\\\/g, '/');\r\n\t\tconst params = {};\r\n\t\tconst method = ROUTES.find(route => {\r\n\t\t\tif (route.method.toLowerCase() === request.method.toLowerCase()) {\r\n\t\t\t\tconst match = url.match(route.matcher);\r\n\t\t\t\tif (match) {\r\n\t\t\t\t\troute.segments.forEach((x, i) => {\r\n\t\t\t\t\t\tif (x.param) {\r\n\t\t\t\t\t\t\tlet value = match[i + 1];\r\n\t\t\t\t\t\t\tif (parseInt(value).toString() === value) {\r\n\t\t\t\t\t\t\t\tvalue = parseInt(value);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tparams[x.param] = value;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\t// console.log('match', match, route);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tif (method) {\r\n\t\t\tconsole.log('apiMiddleware.url', url, method.path, method.method, params);\r\n\t\t\tmethod.callback(request, response, params);\r\n\t\t} else {\r\n\t\t\tnext();\r\n\t\t}\r\n\t};\r\n};\r\n\r\nmodule.exports = {\r\n\tapiMiddleware: apiMiddleware,\r\n\tuseApi: useApi,\r\n\tuuid: uuid,\r\n};\r\n","const https = require('https');\r\nconst fs = require('fs');\r\nconst serveStatic = require('serve-static');\r\nconst express = require('express');\r\nconst session = require('express-session');\r\nconst bodyParser = require('body-parser');\r\nconst path = require('path');\r\nconst multipart = require('connect-multiparty');\r\nconst multipartMiddleware = multipart({ uploadDir: path.join(__dirname, '../docs/temp/') });\r\nconst { upload } = require('./upload/upload.js');\r\nconst uploader = upload(path.join(__dirname, '../docs/temp/'));\r\nconst { staticMiddleware } = require('./static/static.js');\r\n// const { spaMiddleware } = require('./spa/spa.js');\r\nconst { apiMiddleware, useApi, uuid } = require('./api/api.js');\r\n// const router = express.Router();\r\nconst BASE_HREF = '/b-here/';\r\nconst ASSETS = `assets/`;\r\nconst ROOT = `../docs/`;\r\nconst PORT = process.env.PORT || 5000;\r\nconst PORT_HTTPS = 6443;\r\n\r\nconst Vars = {\r\n\tport: PORT,\r\n\tportHttps: PORT_HTTPS,\r\n\thost: `http://localhost:${PORT}`,\r\n\thostHttps: `https://localhost:${PORT_HTTPS}`,\r\n\tcharset: 'utf8',\r\n\tassets: ASSETS,\r\n\tbaseHref: BASE_HREF,\r\n\tcacheMode: 'file',\r\n\tcache: path.join(__dirname, `../cache/`),\r\n\troot: ROOT,\r\n\ttemplate: path.join(__dirname, `${ROOT}index.html`),\r\n\taccessControlAllowOrigin: true,\r\n};\r\n\r\nconst staticMiddleware_ = staticMiddleware(Vars);\r\nconst apiMiddleware_ = apiMiddleware(Vars);\r\n// const spaMiddleware_ = spaMiddleware(Vars);\r\nconst app = express();\r\napp.use(session({\r\n\tsecret: 'b-here-secret-keyword',\r\n\tsaveUninitialized: true,\r\n\tresave: true\r\n}));\r\napp.disable('x-powered-by');\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\napp.use(bodyParser.json());\r\napp.use(bodyParser.raw());\r\napp.use('*', staticMiddleware_);\r\napp.use('*', apiMiddleware_);\r\n\r\napp.post('/api/upload', multipartMiddleware, function(request, response) {\r\n\tif (Vars.accessControlAllowOrigin) {\r\n\t\tresponse.header('Access-Control-Allow-Origin', '*');\r\n\t}\r\n\tconsole.log(request.body, request.files);\r\n\t/*\r\n\tfile: {\r\n\t\tfieldName: 'file',\r\n\t\toriginalFilename: 'ambiente1_x3_y3.jpg',\r\n\t\tpath: 'C:\\\\WORK\\\\GIT\\\\TFS\\\\Websolute\\\\b-here\\\\docs\\\\temp\\\\CVvHZ4YYkiQdWmiAtTjhb6kF.jpg',\r\n\t\theaders: {\r\n\t\t  'content-disposition': 'form-data; name=\"file\"; filename=\"ambiente1_x3_y3.jpg\"',\r\n\t\t  'content-type': 'image/jpeg'\r\n\t\t},\r\n\t\tsize: 3888620,\r\n\t\tname: 'ambiente1_x3_y3.jpg',\r\n\t\ttype: 'image/jpeg'\r\n\t  }\r\n\t*/\r\n\tconst file = request.files.file;\r\n\tconst id = uuid();\r\n\tconst fileName = `${id}_${file.name}`;\r\n\tconst folder = `/uploads/`; // `uploads/`;\r\n\tconst input = file.path;\r\n\tconst output = path.join(__dirname, Vars.root, folder, fileName);\r\n\tconst upload = {\r\n\t\tid,\r\n\t\tfileName,\r\n\t\ttype: file.type,\r\n\t\toriginalFileName: file.name,\r\n\t\turl: `${folder}${fileName}`,\r\n\t\t// url: `${request.protocol === 'https' ? Vars.hostHttps : Vars.host}${Vars.baseHref}${folder}${fileName}`,\r\n\t};\r\n\tconst uploads = [upload];\r\n\tfs.copyFile(input, output, (error) => {\r\n\t\tfs.unlink(input, () => { });\r\n\t\tif (error) {\r\n\t\t\tthrow error;\r\n\t\t} else {\r\n\t\t\tresponse.status(200).send(JSON.stringify(uploads));\r\n\t\t}\r\n\t});\r\n});\r\napp.options('/api/upload', function(request, response) {\r\n\tconsole.log('OPTIONS');\r\n\tif (Vars.accessControlAllowOrigin) {\r\n\t\tresponse.header('Access-Control-Allow-Origin', '*');\r\n\t}\r\n\tresponse.status(200).send();\r\n});\r\n\r\n// Handle uploads through Flow.js\r\napp.post('/api/upload_', multipartMiddleware, function(request, response) {\r\n\tuploader.post(request, function(status, filename, original_filename, identifier) {\r\n\t\tconsole.log('POST', status, original_filename, identifier);\r\n\t\tif (Vars.accessControlAllowOrigin) {\r\n\t\t\tresponse.header('Access-Control-Allow-Origin', '*');\r\n\t\t}\r\n\t\tif (status === 'done') {\r\n\t\t\tfilename = identifier + '_' + filename;\r\n\t\t\tconst stream = fs.createWriteStream(path.join(__dirname, '../docs/uploads/', filename));\r\n\t\t\tstream.on('finish', function() {\r\n\t\t\t\tresponse.status(200).send(JSON.stringify({\r\n\t\t\t\t\tfilename,\r\n\t\t\t\t\turl: `/uploads/${filename}`,\r\n\t\t\t\t}));\r\n\t\t\t});\r\n\t\t\tuploader.write(identifier, stream, { end: true });\r\n\t\t} else {\r\n\t\t\tresponse.status(/^(partly_done|done)$/.test(status) ? 200 : 500).send();\r\n\t\t}\r\n\t});\r\n});\r\napp.options('/api/upload_', function(request, response) {\r\n\tconsole.log('OPTIONS');\r\n\tif (Vars.accessControlAllowOrigin) {\r\n\t\tresponse.header('Access-Control-Allow-Origin', '*');\r\n\t}\r\n\tresponse.status(200).send();\r\n});\r\n// Handle status checks on chunks through Flow.js\r\napp.get('/api/upload_', function(request, response) {\r\n\tuploader.get(request, function(status, filename, original_filename, identifier) {\r\n\t\tconsole.log('GET', status);\r\n\t\tif (Vars.accessControlAllowOrigin) {\r\n\t\t\tresponse.header('Access-Control-Allow-Origin', '*');\r\n\t\t}\r\n\t\tif (status == 'found') {\r\n\t\t\tstatus = 200;\r\n\t\t} else {\r\n\t\t\tstatus = 204;\r\n\t\t}\r\n\t\tresponse.status(status).send();\r\n\t});\r\n});\r\napp.get('/api/download/:identifier', function(request, response) {\r\n\tuploader.write(request.params.identifier, response);\r\n});\r\n// Handle uploads through Flow.js\r\n// app.get('*', spaMiddleware_);\r\napp.get('/', function(request, response) {\r\n\tresponse.sendFile(path.join(__dirname, '../docs/access.html'));\r\n\t// response.sendFile(path.join(__dirname, '../docs/index.html'));\r\n\t// response.render('docs/index');\r\n});\r\napp.get('/self-service-tour', function(request, response) {\r\n\tresponse.sendFile(path.join(__dirname, '../docs/b-here.html'));\r\n});\r\napp.get('/guided-tour', function(request, response) {\r\n\tresponse.sendFile(path.join(__dirname, '../docs/b-here.html'));\r\n});\r\napp.get('/b-here', function(request, response) {\r\n\tresponse.sendFile(path.join(__dirname, '../docs/b-here.html'));\r\n});\r\napp.get('/editor', function(request, response) {\r\n\tresponse.sendFile(path.join(__dirname, '../docs/editor.html'));\r\n});\r\n/*\r\napp.listen(Vars.port, () => {\r\n\tconsole.log(`NodeJs Running server at ${Vars.host}`);\r\n});\r\n*/\r\n\r\n/*\r\nconst serverHttp = http.createServer(app);\r\nserverHttp.listen(Vars.port, () => {\r\n\tconsole.log(`NodeJs Running server at ${Vars.host}`);\r\n});\r\n*/\r\n\r\napp.listen(Vars.port, () => {\r\n\tconsole.log(`NodeJs Running server at ${Vars.host}`);\r\n});\r\n\r\nconst heroku = (process.env._ && process.env._.indexOf('heroku'));\r\nif (!heroku) {\r\n\tconst privateKey = fs.readFileSync('certs/server.key', 'utf8');\r\n\tconst certificate = fs.readFileSync('certs/server.crt', 'utf8');\r\n\tconst credentials = { key: privateKey, cert: certificate };\r\n\tconst serverHttps = https.createServer(credentials, app);\r\n\tserverHttps.listen(Vars.portHttps, () => {\r\n\t\tconsole.log(`NodeJs Running server at ${Vars.hostHttps}`);\r\n\t});\r\n}\r\n"],"names":["upload","temporaryFolder","instance","maxFileSize","fileParameterName","fs","mkdirSync","e","cleanIdentifier","identifier","replace","getChunkFilename","chunkNumber","path","resolve","validateRequest","chunkSize","totalSize","filename","fileSize","length","numberOfChunks","Math","max","floor","parseInt","get","req","callback","param","chunkFilename","access","constants","F_OK","error","post","fields","body","files","size","original_filename","validation","mv","currentTestChunk","testChunkExists","write","stream","options","end","pipeChunk","number","clean","source","createReadStream","pipe","on","pipeChunkRm","onDone","console","log","unlink","err","onError","MIME_CONTENT_TYPES","MIME_TEXT","MIME_IMAGE","MIME_FONTS","MIME_AUDIO","MIME_VIDEO","MIME_APPLICATION","MIME_TYPES","staticMiddleware","vars","root","Error","baseHref","request","response","next","url","unescape","baseUrl","substr","regExpText","join","regExp","RegExp","matches","exec","extension","file","filePath","__dirname","readFile","data","set","send","mimeContentTypes","mimeText","mimeImage","mimeFonts","mimeAudio","mimeVideo","mimeApplication","RoleType","Publisher","Attendee","Streamer","Viewer","SelfService","db","views","assets","users","id","username","password","type","firstName","lastName","pathname","readStore","uuid","process","hrtime","bigint","toString","useApi","Object","assign","JSON","parse","saveStore","stringify","writeFile","sendError","status","message","sendOk","doCreate","params","items","item","forEach","x","tiles","navs","push","doUpdate","find","doDelete","index","reduce","p","i","splice","doGet","ROUTES","method","view","viewId","viewItemId","tile","tileId","assetId","user","session","route","segments","matcher","matchers","matchAll","match","g1","g2","g3","name","value","regexp","apiMiddleware","toLowerCase","multipartMiddleware","multipart","uploadDir","require$$0","uploader","require$$1","require$$2","BASE_HREF","ASSETS","ROOT","PORT","env","PORT_HTTPS","Vars","port","portHttps","host","hostHttps","charset","cacheMode","cache","template","accessControlAllowOrigin","staticMiddleware_","apiMiddleware_","app","express","use","secret","saveUninitialized","resave","disable","bodyParser","urlencoded","extended","json","raw","header","fileName","folder","input","output","originalFileName","uploads","copyFile","createWriteStream","test","sendFile","listen","heroku","_","indexOf","privateKey","readFileSync","certificate","credentials","key","cert","serverHttps","https","createServer"],"mappings":"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"}