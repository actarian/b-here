/*
 @preserve
 AgoraRTM Web SDK 1.5.1 - commit: v1.5.1-0-g5bbbcd72
 Copyright (C) 2018-2022 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/
"use strict";!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).AgoraRTM=e()}(this,(function(){function Be(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Wa(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Be(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function qa(t){return(qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wm(t,e,n,i,r,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function ma(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){function s(t){wm(a,i,r,s,o,"next",t)}function o(t){wm(a,i,r,s,o,"throw",t)}var a=t.apply(e,n);s(void 0)}))}}function va(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xm(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function eb(t,e,n){return e&&xm(t.prototype,e),n&&xm(t,n),t}function x(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Ga(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Jf(t,e)}function Td(t){return(Td=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Jf(t,e){return(Jf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function ym(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Ji(t,e,n){return(Ji=ym()?Reflect.construct:function(t,e,n){var i=[null];return i.push.apply(i,e),t=new(Function.bind.apply(t,i)),n&&Jf(t,n.prototype),t}).apply(null,arguments)}function Kf(t){var e="function"==typeof Map?new Map:void 0;return(Kf=function(t){function n(){return Ji(t,arguments,Td(this).constructor)}if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Jf(n,t)})(t)}function Ki(t,e){if(null==t)return{};if(null==t)var n={};else{n={};var i,r=Object.keys(t);for(i=0;i<r.length;i++){var s=r[i];0<=e.indexOf(s)||(n[s]=t[s])}}if(Object.getOwnPropertySymbols)for(i=Object.getOwnPropertySymbols(t),s=0;s<i.length;s++)r=i[s],0<=e.indexOf(r)||Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r]);return n}function z(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ha(t){var e=ym();return function(){var n=Td(t);if(e){var i=Td(this).constructor;n=Reflect.construct(n,arguments,i)}else n=n.apply(this,arguments);return!n||"object"!=typeof n&&"function"!=typeof n?z(this):n}}function Li(t,e,n){return(Li="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Td(t)););if(t)return(e=Object.getOwnPropertyDescriptor(t,e)).get?e.get.call(n):e.value})(t,e,n||t)}function $a(t,e){var n=Array.isArray(t)?t:void 0;if(!n)if(null==(n=t&&("undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"])))n=void 0;else{var i,r=[],s=!0,o=!1;try{for(n=n.call(t);!(s=(i=n.next()).done)&&(r.push(i.value),!e||r.length!==e);s=!0);}catch(t){o=!0;var a=t}finally{try{s||null==n.return||n.return()}finally{if(o)throw a}}n=r}if(!(t=n||zm(t,e)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return t}function Z(t){var e=Array.isArray(t)?Mi(t):void 0;if(e||(e="undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"]?Array.from(t):void 0),!(t=e||zm(t)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return t}function zm(t,e){if(t){if("string"==typeof t)return Mi(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mi(t,e)}}function Mi(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function Da(t,e,n,i,r){var s={};return Object.keys(i).forEach((function(t){s[t]=i[t]})),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=n.slice().reverse().reduce((function(n,i){return i(t,e,n)||n}),s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(t,e,s),s=null),s}function xb(t){var e={exports:{}};return t(e,e.exports),e.exports}function Ce(t){t||(t={});var e=t.ua;if(e||"undefined"==typeof navigator||(e=navigator.userAgent),e&&e.headers&&"string"==typeof e.headers["user-agent"]&&(e=e.headers["user-agent"]),"string"!=typeof e)return!1;var n=Zt.test(e)&&!$t.test(e)||!!t.tablet&&au.test(e);return!n&&t.tablet&&t.featureDetect&&navigator&&1<navigator.maxTouchPoints&&-1!==e.indexOf("Macintosh")&&-1!==e.indexOf("Safari")&&(n=!0),n}function Am(t,e){var n,i=3>arguments.length?t:arguments[2];return Ia(t)===i?t[e]:(n=dc.f(t,e))?ka(n,"value")?n.value:void 0===n.get?void 0:n.get.call(i):xa(n=uc(t))?Am(n,e,i):void 0}function bu(t){var e=t.charCodeAt(0)<<24,n=0|cu(~e),i=0,r=0|t.length,s="";if(5>n&&r>=n){for(e=e<<n>>>24+n,i=1;i<n;i=i+1|0)e=e<<6|63&t.charCodeAt(i);65535>=e?s+=Ud(e):1114111>=e?s+=Ud(55296+((e=e-65536|0)>>10)|0,56320+(1023&e)|0):i=0}for(;i<r;i=i+1|0)s+="ï¿½";return s}function Bm(){}function du(t){var e=0|t.charCodeAt(0);if(55296<=e&&56319>=e){var n=0|t.charCodeAt(1);if(!(n==n&&56320<=n&&57343>=n))return Ud(239,191,189);if(65535<(e=(e-55296<<10)+n-56320+65536|0))return Ud(240|e>>>18,128|e>>>12&63,128|e>>>6&63,128|63&e)}return 127>=e?t:2047>=e?Ud(192|e>>>6,128|63&e):Ud(224|e>>>12,128|e>>>6&63,128|63&e)}function Cm(){}function Ba(){Ba.init.call(this)}function Wg(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+qa(t))}function Dm(t,e,n,i){Wg(n);var r=t._events;if(void 0===r)r=t._events=Object.create(null),t._eventsCount=0;else{void 0!==r.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),r=t._events);var s=r[e]}return void 0===s?(r[e]=n,++t._eventsCount):("function"==typeof s?s=r[e]=i?[n,s]:[s,n]:i?s.unshift(n):s.push(n),0<(n=void 0===t._maxListeners?Ba.defaultMaxListeners:t._maxListeners)&&s.length>n&&!s.warned&&(s.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=t,n.type=e,n.count=s.length,console&&console.warn&&console.warn(n))),t}function eu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Em(t,e,n){return t={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},(e=eu.bind(t)).listener=n,t.wrapFn=e}function Fm(t,e,n){if(void 0===(t=t._events))return[];if(void 0===(e=t[e]))return[];if("function"==typeof e)return n?[e.listener||e]:[e];if(n)for(n=Array(e.length),t=0;t<n.length;++t)n[t]=e[t].listener||e[t];else n=Gm(e,e.length);return n}function Hm(t){var e=this._events;if(void 0!==e){if("function"==typeof(t=e[t]))return 1;if(void 0!==t)return t.length}return 0}function Gm(t,e){for(var n=Array(e),i=0;i<e;++i)n[i]=t[i];return n}function fu(t,e,n){"function"==typeof t.on&&Im(t,"error",e,n)}function Im(t,e,n,i){if("function"==typeof t.on)i.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+qa(t));t.addEventListener(e,(function r(s){i.once&&t.removeEventListener(e,r),n(s)}))}}function gu(t){return t?Z(t):hu((function(){return[]}),(function(t,e){return t.push(e),t}))}function Jm(t,e){var n,i,r,s;return N.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:n=Km(t)([Lm,Lm,function(t,e){return e}])[2],i=0;case 2:if(!(i<e.length)){o.next=17;break}if(r=e[i],!((s=n(Ni,r))instanceof Xg)){o.next=11;break}if((s=Oi(s.deref()))===Ni){o.next=10;break}return o.next=10,s;case 10:return o.abrupt("return");case 11:if(s===Ni){o.next=14;break}return o.next=14,s;case 14:i++,o.next=2;break;case 17:case"end":return o.stop()}}),iu)}function Yg(t,e){return null!=e&&"function"==typeof e[Symbol.iterator]?Jm(Yg(t),e):function(e){var n=e[2];return ju(e,(function(e,i){return n(e,t(i))}))}}function $c(t){return Object.prototype.toString.call(t).slice(8,-1)}function De(t){return"Object"===$c(t)&&t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function Mm(t){var e;return(e="Boolean"===$c(t)||"Null"===$c(t)||"Undefined"===$c(t))||(e="Number"===$c(t)&&!isNaN(t)),e||"String"===$c(t)||"Symbol"===$c(t)}function Vd(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Ee(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Fe(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var i=t[e];this.set(i[0],i[1])}}function Lf(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Zg;++e<n;)this.add(t[e])}function Ge(t){this.size=(this.__data__=new $g(t)).size}function He(t,e,n,i,r,s){var o,a=1&e,c=2&e,l=4&e;if(n&&(o=r?n(t,i,r,s):n(t)),void 0!==o)return o;if(!Gb(t))return t;if(i=ub(t)){if(o=ku(t),!a)return Pi(t,o)}else{var u=Mf(t),d="[object Function]"==u||"[object GeneratorFunction]"==u;if(Nf(t))return Nm(t,a);if("[object Object]"==u||"[object Arguments]"==u||d&&!r){if(o=c||d?{}:Om(t),!a)return c?lu(t,mu(o,t)):nu(t,ou(o,t))}else{if(!Oa[u])return r?t:{};o=pu(t,u,a)}}if(s||(s=new Ie),r=s.get(t))return r;s.set(t,o),qu(t)?t.forEach((function(i){o.add(He(i,e,n,i,t,s))})):ru(t)&&t.forEach((function(i,r){o.set(r,He(i,e,n,r,t,s))})),c=l?c?Pm:Qi:c?Of:Wd;var h=i?void 0:c(t);return su(h||t,(function(i,r){h&&(i=t[r=i]),Qm(o,r,He(i,e,n,r,t,s))})),o}function Ri(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var n=function n(){var i=arguments,r=e?e.apply(this,i):i[0],s=n.cache;return s.has(r)?s.get(r):(i=t.apply(this,i),n.cache=s.set(r,i)||s,i)};return n.cache=new(Ri.Cache||Zg),n}function Rm(t){if("string"==typeof t)return t;if(ub(t))return Je(t,Rm)+"";if(Ke(t))return Sm?Sm.call(t):"";var e=t+"";return"0"==e&&1/t==-tu?"-0":e}function Si(t,e,n,i,r){var s=-1,o=t.length;for(n||(n=uu),r||(r=[]);++s<o;){var a=t[s];0<e&&n(a)?1<e?Si(a,e-1,n,i,r):Ti(r,a):i||(r[r.length]=a)}return r}function Le(t,e,n,i,r){if(t===e)e=!0;else if(null==t||null==e||!Hc(t)&&!Hc(e))e=t!=t&&e!=e;else t:{var s=ub(t),o=ub(e),a=s?"[object Array]":Mf(t),c=o?"[object Array]":Mf(e),l="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a);if(o="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),(c=a==c)&&Nf(t)){if(!Nf(e)){e=!1;break t}s=!0,l=!1}if(c&&!l)r||(r=new Ie),e=s||Ui(t)?Tm(t,e,n,i,Le,r):vu(t,e,a,n,i,Le,r);else{if(!(1&n)&&(s=l&&Um.call(t,"__wrapped__"),a=o&&Um.call(e,"__wrapped__"),s||a)){t=s?t.value():t,e=a?e.value():e,r||(r=new Ie),e=Le(t,e,n,i,r);break t}if(c)e:if(r||(r=new Ie),s=1&n,a=Qi(t),o=a.length,c=Qi(e).length,o==c||s){for(c=o;c--;){var u=a[c];if(!(s?u in e:wu.call(e,u))){e=!1;break e}}if(l=r.get(t),u=r.get(e),l&&u)e=l==e&&u==t;else{l=!0,r.set(t,e),r.set(e,t);for(var d=s;++c<o;){var h=t[u=a[c]],A=e[u];if(i)var p=s?i(A,h,u,e,t,r):i(h,A,u,t,e,r);if(void 0===p?h!==A&&!Le(h,A,n,i,r):!p){l=!1;break}d||(d="constructor"==u)}l&&!d&&(n=t.constructor)!=(i=e.constructor)&&"constructor"in t&&"constructor"in e&&!("function"==typeof n&&n instanceof n&&"function"==typeof i&&i instanceof i)&&(l=!1),r.delete(t),r.delete(e),e=l}}else e=!1;else e=!1}}return e}function Pa(t,e,n){this.low=0|t,this.high=0|e,this.unsigned=!!n}function Hb(t){return!0===(t&&t.__isLong__)}function Xd(t,e){var n;if(e){if((e=0<=(t>>>=0)&&256>t)&&(n=Vm[t]))return n;n=Qa(t,0>(0|t)?-1:0,!0),e&&(Vm[t]=n)}else{if((e=-128<=(t|=0)&&128>t)&&(n=Wm[t]))return n;n=Qa(t,0>t?-1:0,!1),e&&(Wm[t]=n)}return n}function ec(t,e){if(isNaN(t))return e?Yd:fc;if(e){if(0>t)return Yd;if(t>=Xm)return Ym}else{if(t<=-Zm)return Ib;if(t+1>=Zm)return $m}return 0>t?ec(-t,e).neg():Qa(t%Me|0,t/Me|0,e)}function Qa(t,e,n){return new Pa(t,e,n)}function Vi(t,e,n){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return fc;if("number"==typeof e?(n=e,e=!1):e=!!e,2>(n=n||10)||36<n)throw RangeError("radix");var i;if(0<(i=t.indexOf("-")))throw Error("interior hyphen");if(0===i)return Vi(t.substring(1),e,n).neg();i=ec(ah(n,8));for(var r=fc,s=0;s<t.length;s+=8){var o=Math.min(8,t.length-s),a=parseInt(t.substring(s,s+o),n);8>o?(o=ec(ah(n,o)),r=r.mul(o).add(ec(a))):r=(r=r.mul(i)).add(ec(a))}return r.unsigned=e,r}function vc(t,e){return"number"==typeof t?ec(t,e):"string"==typeof t?Vi(t,e):Qa(t.low,t.high,"boolean"==typeof e?e:t.unsigned)}function ha(t,e){function n(){this.constructor=t}Wi(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function Ne(t){return"function"==typeof t}function Oe(t){setTimeout((function(){throw t}),0)}function Xi(t){return null!==t&&"object"===qa(t)}function an(t){return t.reduce((function(t,e){return t.concat(e instanceof Pf?e.errors:e)}),[])}function Yi(t){for(;t;){var e=t.destination,n=t.isStopped;if(t.closed||n)return!1;t=e&&e instanceof za?e:null}return!0}function wd(t){return t}function Zi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return bn(t)}function bn(t){return 0===t.length?wd:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}function cn(t){if(t||(t=gc.Promise||Promise),!t)throw Error("no Promise impl found");return t}function dn(){return function(t){return t.lift(new xu(t))}}function Qf(t){return t?yu(t):Sb}function yu(t){return new ua((function(e){return t.schedule((function(){return e.complete()}))}))}function ad(t){return t&&"function"==typeof t.schedule}function $i(t,e){return new ua((function(n){var i=new nb,r=0;return i.add(e.schedule((function(){r===t.length?n.complete():(n.next(t[r++]),n.closed||i.add(this.schedule()))}))),i}))}function Rf(t,e){return e?$i(t,e):new ua(en(t))}function ob(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ad(e=t[t.length-1])?(t.pop(),$i(t,e)):Rf(t)}function ra(t,e){return new ua(e?function(n){return e.schedule(zu,0,{error:t,subscriber:n})}:function(e){return e.error(t)})}function zu(t){t.subscriber.error(t.error)}function Au(t,e){return void 0===e&&(e=0),function(n){return n.lift(new Bu(t,e))}}function fn(t){return t in aj&&(delete aj[t],!0)}function Ic(){}function Ea(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Cu(t,e))}}function gn(t,e,n){if(e){if(!ad(e))return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return gn(t,n).apply(void 0,i).pipe(Ea((function(t){return hc(t)?e.apply(void 0,t):e(t)})))};n=e}return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var r,s=this,o={context:s,subject:r,callbackFunc:t,scheduler:n};return new ua((function(i){if(n)return n.schedule(Du,0,{args:e,subscriber:i,params:o});if(!r){r=new Sf;try{t.apply(s,e.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r.next(1>=t.length?t[0]:t),r.complete()}]))}catch(t){Yi(r)?r.error(t):console.warn(t)}}return r.subscribe(i)}))}}function Du(t){var e=this,n=t.args,i=t.subscriber,r=t.params;t=r.callbackFunc;var s=r.context,o=r.scheduler,a=r.subject;if(!a){a=r.subject=new Sf,r=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.add(o.schedule(Eu,0,{value:1>=t.length?t[0]:t,subject:a}))};try{t.apply(s,n.concat([r]))}catch(t){a.error(t)}}this.add(a.subscribe(i))}function Eu(t){var e=t.subject;e.next(t.value),e.complete()}function hn(t,e,n){if(e){if(!ad(e))return function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];return hn(t,n).apply(void 0,i).pipe(Ea((function(t){return hc(t)?e.apply(void 0,t):e(t)})))};n=e}return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var r={subject:void 0,args:e,callbackFunc:t,scheduler:n,context:this};return new ua((function(i){var s=r.context,o=r.subject;if(n)return n.schedule(Fu,0,{params:r,subscriber:i,context:s});if(!o){o=r.subject=new Sf;try{t.apply(s,e.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];(e=t.shift())?o.error(e):(o.next(1>=t.length?t[0]:t),o.complete())}]))}catch(t){Yi(o)?o.error(t):console.warn(t)}}return o.subscribe(i)}))}}function Fu(t){var e=this,n=t.params,i=t.subscriber;t=t.context;var r=n.callbackFunc,s=n.args,o=n.scheduler,a=n.subject;if(!a){a=n.subject=new Sf,n=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(n=t.shift())?e.add(o.schedule(jn,0,{err:n,subject:a})):e.add(o.schedule(Gu,0,{value:1>=t.length?t[0]:t,subject:a}))};try{r.apply(t,s.concat([n]))}catch(t){this.add(o.schedule(jn,0,{err:t,subject:a}))}}this.add(a.subscribe(i))}function Gu(t){var e=t.subject;e.next(t.value),e.complete()}function jn(t){t.subject.error(t.err)}function kn(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}function bj(t,e,n,i,r){if(void 0===r&&(r=new Hu(t,n,i)),!r.closed)return e instanceof ua?e.subscribe(r):Tf(e)(r)}function Iu(t,e){return new ua((function(n){var i=new nb;return i.add(e.schedule((function(){var r=t[Pe]();i.add(r.subscribe({next:function(t){i.add(e.schedule((function(){return n.next(t)})))},error:function(t){i.add(e.schedule((function(){return n.error(t)})))},complete:function(){i.add(e.schedule((function(){return n.complete()})))}}))}))),i}))}function Ju(t,e){return new ua((function(n){var i=new nb;return i.add(e.schedule((function(){return t.then((function(t){i.add(e.schedule((function(){n.next(t),i.add(e.schedule((function(){return n.complete()})))})))}),(function(t){i.add(e.schedule((function(){return n.error(t)})))}))}))),i}))}function Ku(t,e){if(!t)throw Error("Iterable cannot be null");return new ua((function(n){var i,r=new nb;return r.add((function(){i&&"function"==typeof i.return&&i.return()})),r.add(e.schedule((function(){i=t[xd](),r.add(e.schedule((function(){if(!n.closed){try{var t=i.next(),e=t.value,r=t.done}catch(t){return void n.error(t)}r?n.complete():(n.next(e),this.schedule())}})))}))),r}))}function ln(t,e){if(null!=t){if(t&&"function"==typeof t[Pe])return Iu(t,e);if(kn(t))return Ju(t,e);if(mn(t))return $i(t,e);if(t&&"function"==typeof t[xd]||"string"==typeof t)return Ku(t,e)}throw new TypeError((null!==t&&qa(t)||t)+" is not observable")}function Jc(t,e){return e?ln(t,e):t instanceof ua?t:new ua(Tf(t))}function bd(t,e){if(!e.closed){if(t instanceof ua)return t.subscribe(e);try{var n=Tf(t)(e)}catch(t){e.error(t)}return n}}function Cb(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(i){return i.pipe(Cb((function(n,i){return Jc(t(n,i)).pipe(Ea((function(t,r){return e(n,t,i,r)})))}),n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new Lu(t,n))})}function bh(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),Cb(wd,t)}function nn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return bh(1)(ob.apply(void 0,t))}function yd(t){return new ua((function(e){try{var n=t()}catch(t){return void e.error(t)}return(n?Jc(n):Qf()).subscribe(e)}))}function ch(t,e){return new ua((function(n){var i=t.length;if(0===i)n.complete();else for(var r=Array(i),s=0,o=0,a=function(a){var c=Jc(t[a]),l=!1;n.add(c.subscribe({next:function(t){l||(l=!0,o++),r[a]=t},error:function(t){return n.error(t)},complete:function(){++s!==i&&l||(o===i&&n.next(e?e.reduce((function(t,e,n){return t[e]=r[n],t}),{}):r),n.complete())}}))},c=0;c<i;c++)a(c)}))}function Db(t,e,n,i){return Ne(n)&&(i=n,n=void 0),i?Db(t,e,n).pipe(Ea((function(t){return hc(t)?i.apply(void 0,t):i(t)}))):new ua((function(i){on(t,e,(function(t){1<arguments.length?i.next(Array.prototype.slice.call(arguments)):i.next(t)}),i,n)}))}function on(t,e,n,i,r){if(t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener){t.addEventListener(e,n,r);var s=function(){return t.removeEventListener(e,n,r)}}else if(t&&"function"==typeof t.on&&"function"==typeof t.off)t.on(e,n),s=function(){return t.off(e,n)};else if(t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener)t.addListener(e,n),s=function(){return t.removeListener(e,n)};else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var o=0,a=t.length;o<a;o++)on(t[o],e,n,i,r)}i.add(s)}function pn(t,e,n){return n?pn(t,e).pipe(Ea((function(t){return hc(t)?n.apply(void 0,t):n(t)}))):new ua((function(n){var i=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return n.next(1===t.length?t[0]:t)};try{var r=t(i)}catch(t){return void n.error(t)}if(Ne(e))return function(){return e(i,r)}}))}function Mu(t){var e=t.subscriber,n=t.condition;if(!e.closed){if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void e.error(t)}else t.needIterate=!0;if(n){var i=void 0;try{i=n(t.state)}catch(t){return void e.error(t)}if(!i)return void e.complete();if(e.closed)return}try{var r=t.resultSelector(t.state)}catch(t){return void e.error(t)}if(!e.closed&&(e.next(r),!e.closed))return this.schedule(t)}}function cj(t){return!hc(t)&&0<=t-parseFloat(t)+1}function Qe(t,e){return void 0===t&&(t=0),void 0===e&&(e=cd),(!cj(t)||0>t)&&(t=0),e&&"function"==typeof e.schedule||(e=cd),new ua((function(n){return n.add(e.schedule(Nu,t,{subscriber:n,counter:0,period:t})),n}))}function Nu(t){var e=t.subscriber,n=t.counter;t=t.period,e.next(n),this.schedule({subscriber:e,counter:n+1,period:t},t)}function Jb(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];e=Number.POSITIVE_INFINITY;var n=null,i=t[t.length-1];return ad(i)?(n=t.pop(),1<t.length&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof i&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof ua?t[0]:bh(e)(Rf(t,n))}function dj(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(0===t.length)return Sb;var n=t[0],i=t.slice(1);return 1===t.length&&hc(n)?dj.apply(void 0,n):new ua((function(t){var e=function(){return t.add(dj.apply(void 0,i).subscribe(t))};return Jc(n).subscribe({next:function(e){t.next(e)},error:e,complete:e})}))}function Ou(t){var e=t.keys,n=t.index,i=t.subscriber,r=t.subscription;if(t=t.obj,!i.closed)if(n<e.length){var s=e[n];i.next([s,t[s]]),r.add(this.schedule({keys:e,index:n+1,subscriber:i,subscription:r,obj:t}))}else i.complete()}function Pu(t,e){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=t,n.thisArg=e,n}function yb(t,e){return function(n){return n.lift(new Qu(t,e))}}function fb(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){if(!hc(t[0]))return t[0];t=t[0]}return Rf(t,void 0).lift(new Ru)}function Su(t){var e=t.start,n=t.index,i=t.subscriber;n>=t.count?i.complete():(i.next(e),i.closed||(t.index=n+1,t.start=e+1,this.schedule(t)))}function dd(t,e,n){void 0===t&&(t=0);var i=-1;return cj(e)?i=1>Number(e)?1:Number(e):ad(e)&&(n=e),ad(n)||(n=cd),new ua((function(e){var r=cj(t)?t:+t-n.now();return n.schedule(Tu,r,{index:0,period:i,subscriber:e})}))}function Tu(t){var e=t.index,n=t.period,i=t.subscriber;if(i.next(e),!i.closed){if(-1===n)return i.complete();t.index=e+1,this.schedule(t,n)}}function ej(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"function"==typeof(e=t[t.length-1])&&t.pop(),Rf(t,void 0).lift(new Uu(e))}function dh(t){var e=arguments.length,n=cd;ad(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],e--);var i=null;2<=e&&(i=arguments[1]);var r=Number.POSITIVE_INFINITY;return 3<=e&&(r=arguments[2]),function(e){return e.lift(new Vu(t,i,r,n))}}function qn(t){var e=t.subscriber,n=t.context;n&&e.closeContext(n),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function Wu(t){var e=t.bufferCreationInterval,n=t.bufferTimeSpan,i=t.subscriber,r=t.scheduler,s=i.openContext();i.closed||(i.add(s.closeAction=r.schedule(rn,n,{subscriber:i,context:s})),this.schedule(t,e))}function rn(t){t.subscriber.closeContext(t.context)}function ab(t){return function(e){var n=new Xu(t);return e=e.lift(n),n.caught=e}}function fj(t,e){return Cb(t,e,1)}function sn(t){return void 0===t&&(t=null),function(e){return e.lift(new Yu(t))}}function Zd(t,e){void 0===e&&(e=cd);var n=t instanceof Date&&!isNaN(+t)?+t-e.now():Math.abs(t);return function(t){return t.lift(new Zu(n,e))}}function tn(t,e){return function(n){return n.lift(new $u(t,e))}}function $d(t){return void 0===t&&(t=av),function(e){return e.lift(new bv(t))}}function av(){return new eh}function hb(t){return function(e){return 0===t?Qf():e.lift(new cv(t))}}function fh(t){return function(e){return e.lift(new dv(t))}}function Ca(t,e){var n=2<=arguments.length;return function(i){return i.pipe(t?yb((function(e,n){return t(e,n,i)})):wd,hb(1),n?sn(e):$d((function(){return new eh})))}}function ev(){return function(t){return t.lift(new fv)}}function un(t){return function(e){return 0===t?Qf():e.lift(new gv(t))}}function Uf(t){return function(e){return e.lift(new hv(t))}}function gh(t,e){var n=!1;return 2<=arguments.length&&(n=!0),function(i){return i.lift(new iv(t,e,n))}}function vn(t,e){return 2<=arguments.length?function(n){return Zi(gh(t,e),un(1),sn(e))(n)}:function(e){return Zi(gh((function(e,n,i){return t(e,n,i+1)})),un(1))(e)}}function jv(t,e){return function(n){var i="function"==typeof t?t:function(){return t};if("function"==typeof e)return n.lift(new kv(i,e));var r=Object.create(n,lv);return r.source=n,r.subjectFactory=i,r}}function Re(t){return function(e){return e.lift(new mv(t,e))}}function nv(){return new rb}function Se(){return function(t){return dn()(jv(nv)(t))}}function wn(t,e,n){var i=t&&"object"===qa(t)?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n};return function(t){return t.lift(ov(i))}}function ov(t){var e,n,i=t.bufferSize,r=void 0===i?Number.POSITIVE_INFINITY:i,s=void 0===(i=t.windowTime)?Number.POSITIVE_INFINITY:i,o=t.refCount,a=t.scheduler,c=0,l=!1,u=!1;return function(t){if(c++,!e||l){l=!1;var i=(e=new Te(r,s,a)).subscribe(this);n=t.subscribe({next:function(t){e.next(t)},error:function(t){l=!0,e.error(t)},complete:function(){u=!0,n=void 0,e.complete()}}),u&&(n=void 0)}else i=e.subscribe(this);this.add((function(){c--,i.unsubscribe(),i=void 0,n&&!u&&o&&0===c&&(n.unsubscribe(),e=n=void 0)}))}}function Kb(t,e){return"function"==typeof e?function(n){return n.pipe(Kb((function(n,i){return Jc(t(n,i)).pipe(Ea((function(t,r){return e(n,t,i,r)})))})))}:function(e){return e.lift(new pv(t))}}function Kc(t){return function(e){return e.lift(new qv(t))}}function sa(t,e,n){return function(i){return i.lift(new rv(t,e,n))}}function sv(t,e,n){return void 0===e&&(e=cd),void 0===n&&(n=tv),function(i){return i.lift(new uv(t,e,n.leading,n.trailing))}}function vv(t){t.subscriber.clearThrottle()}function wv(t,e,n){return void 0===n&&(n=cd),function(i){var r=t instanceof Date&&!isNaN(+t),s=r?+t-n.now():Math.abs(t);return i.lift(new xv(s,r,e,n))}}function Lb(t,e){return void 0===e&&(e=cd),wv(t,ra(new Tb),e)}function yv(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n;return"function"==typeof t[t.length-1]&&(n=t.pop()),e.lift(new zv(t,n))}}function xn(t){(gj||t)&&(yn.abort(),t&&(yn=new AbortController),gj=t)}function zn(t,e,n,i,r){t!==e&&An(e,(function(s,o){if(r||(r=new Ie),Gb(s)){s=r;var a=hj(t,o),c=hj(e,o),l=s.get(c);if(l)ij(t,o,l);else{var u=void 0===(l=i?i(a,c,o+"",t,e,s):void 0);if(u){var d=ub(c),h=!d&&Nf(c),A=!d&&!h&&Ui(c);l=c,d||h||A?ub(a)?l=a:Hc(a)&&ae(a)?l=Pi(a):h?(u=!1,l=Nm(c,!0)):A?(u=!1,l=Bn(c,!0)):l=[]:Cn(c)||Vf(c)?(l=a,Vf(a)?l=Ue(a,Of(a)):Gb(a)&&!jj(a)||(l=Om(c))):u=!1}u&&(s.set(c,l),zn(l,c,n,i,s),s.delete(c)),ij(t,o,l)}}else void 0===(a=i?i(hj(t,o),s,o+"",t,e,r):void 0)&&(a=s),ij(t,o,a)}),Of)}function Av(t){var e=1,n=kj;1==(1>=arguments.length?0:arguments.length-1)?"number"==typeof(1>=arguments.length?void 0:arguments[1])?e=1>=arguments.length?void 0:arguments[1]:n=1>=arguments.length?void 0:arguments[1]:2==(1>=arguments.length?0:arguments.length-1)&&(e=1>=arguments.length?void 0:arguments[1],n=2>=arguments.length?void 0:arguments[2]);var i=e||1;return function(e){return e.pipe(gh((function(e,r){var s=n.now(),o=s-t;if((e=e.filter((function(t){return t.until>o}))).length>=i){var a=e[e.length-1],c=e[0].until+t*Math.floor(e.length/i);e.push({delay:a.until<s?c-s:c-a.until,until:c,value:r})}else e.push({delay:0,until:s,value:r});return e}),[]),Ea((function(t){return t[t.length-1]})),fj((function(t){var e=ob(t.value);return t.delay?e.pipe(Zd(t.delay,n)):e})))}}function Bv(t,e){var n=(e=void 0===e?{protocols:Dn,makeWebSocket:En}:e).protocols,i=void 0===n?Dn:n,r=void 0===(e=e.makeWebSocket)?En:e;return new ua((function(e){var n,s=new rb,o=r(t,i),a=!1,c=!1,l=!1,u=function(t){if(n)throw a=!0,t=Error("Web socket message factory function called more than once"),e.error(t),t;return n=t.subscribe((function(t){o.send(t)})),s};return o.onopen=function(){l=!0,c?(a=!0,o.close()):e.next(u)},o.onmessage=function(t){s.next(t.data)},o.onerror=function(t){a=!0,e.error(Error(t.message))},o.onclose=function(t){a||(a=!0,c?(e.complete(),s.complete()):e.error(Error(1e3===t.code?"Normal closure":t.reason)))},function(){c=!0,n&&n.unsubscribe(),a||(a=!0,l&&o.close())}}))}function hh(){this._listeners={}}function Fn(t){return"undefined"!=typeof Float32Array?function(){function e(t,e,n){s[0]=t,e[n]=o[0],e[n+1]=o[1],e[n+2]=o[2],e[n+3]=o[3]}function n(t,e,n){s[0]=t,e[n]=o[3],e[n+1]=o[2],e[n+2]=o[1],e[n+3]=o[0]}function i(t,e){return o[0]=t[e],o[1]=t[e+1],o[2]=t[e+2],o[3]=t[e+3],s[0]}function r(t,e){return o[3]=t[e],o[2]=t[e+1],o[1]=t[e+2],o[0]=t[e+3],s[0]}var s=new Float32Array([-0]),o=new Uint8Array(s.buffer),a=128===o[3];t.writeFloatLE=a?e:n,t.writeFloatBE=a?n:e,t.readFloatLE=a?i:r,t.readFloatBE=a?r:i}():function(){function e(t,e,n,i){var r=0>e?1:0;if(r&&(e=-e),0===e)t(0<1/e?0:2147483648,n,i);else if(isNaN(e))t(2143289344,n,i);else if(34028234663852886e22<e)t((r<<31|2139095040)>>>0,n,i);else if(11754943508222875e-54>e)t((r<<31|Math.round(e/1401298464324817e-60))>>>0,n,i);else{var s=Math.floor(Math.log(e)/Math.LN2);t((r<<31|s+127<<23|8388607&Math.round(e*Math.pow(2,-s)*8388608))>>>0,n,i)}}function n(t,e,n){return n=t(e,n),t=2*(n>>31)+1,e=n>>>23&255,n&=8388607,255===e?n?NaN:1/0*t:0===e?1401298464324817e-60*t*n:t*Math.pow(2,e-150)*(n+8388608)}t.writeFloatLE=e.bind(null,Gn),t.writeFloatBE=e.bind(null,Hn),t.readFloatLE=n.bind(null,In),t.readFloatBE=n.bind(null,Jn)}(),"undefined"!=typeof Float64Array?function(){function e(t,e,n){s[0]=t,e[n]=o[0],e[n+1]=o[1],e[n+2]=o[2],e[n+3]=o[3],e[n+4]=o[4],e[n+5]=o[5],e[n+6]=o[6],e[n+7]=o[7]}function n(t,e,n){s[0]=t,e[n]=o[7],e[n+1]=o[6],e[n+2]=o[5],e[n+3]=o[4],e[n+4]=o[3],e[n+5]=o[2],e[n+6]=o[1],e[n+7]=o[0]}function i(t,e){return o[0]=t[e],o[1]=t[e+1],o[2]=t[e+2],o[3]=t[e+3],o[4]=t[e+4],o[5]=t[e+5],o[6]=t[e+6],o[7]=t[e+7],s[0]}function r(t,e){return o[7]=t[e],o[6]=t[e+1],o[5]=t[e+2],o[4]=t[e+3],o[3]=t[e+4],o[2]=t[e+5],o[1]=t[e+6],o[0]=t[e+7],s[0]}var s=new Float64Array([-0]),o=new Uint8Array(s.buffer),a=128===o[7];t.writeDoubleLE=a?e:n,t.writeDoubleBE=a?n:e,t.readDoubleLE=a?i:r,t.readDoubleBE=a?r:i}():function(){function e(t,e,n,i,r,s){var o=0>i?1:0;if(o&&(i=-i),0===i)t(0,r,s+e),t(0<1/i?0:2147483648,r,s+n);else if(isNaN(i))t(0,r,s+e),t(2146959360,r,s+n);else if(17976931348623157e292<i)t(0,r,s+e),t((o<<31|2146435072)>>>0,r,s+n);else if(22250738585072014e-324>i)t((i/=5e-324)>>>0,r,s+e),t((o<<31|i/4294967296)>>>0,r,s+n);else{var a=Math.floor(Math.log(i)/Math.LN2);1024===a&&(a=1023),t(4503599627370496*(i*=Math.pow(2,-a))>>>0,r,s+e),t((o<<31|a+1023<<20|1048576*i&1048575)>>>0,r,s+n)}}function n(t,e,n,i,r){return e=t(i,r+e),i=t(i,r+n),t=2*(i>>31)+1,e=4294967296*(1048575&i)+e,2047==(n=i>>>20&2047)?e?NaN:1/0*t:0===n?5e-324*t*e:t*Math.pow(2,n-1075)*(e+4503599627370496)}t.writeDoubleLE=e.bind(null,Gn,0,4),t.writeDoubleBE=e.bind(null,Hn,4,0),t.readDoubleLE=n.bind(null,In,0,4),t.readDoubleBE=n.bind(null,Jn,4,0)}(),t}function Gn(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function Hn(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function In(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function Jn(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}function vb(t,e){this.lo=t>>>0,this.hi=e>>>0}function Wf(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function lj(){}function Cv(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function Aa(){this.len=0,this.tail=this.head=new Wf(lj,0,0),this.states=null}function mj(t,e,n){e[n]=255&t}function nj(t,e){this.len=t,this.next=void 0,this.val=e}function oj(t,e,n){for(;t.hi;)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;for(;127<t.lo;)e[n++]=127&t.lo|128,t.lo>>>=7;e[n++]=t.lo}function pj(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function Lc(){qj.call(this)}function Dv(t,e,n){40>t.length?pa.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}function wc(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function ib(t){this.buf=t,this.pos=0,this.len=t.length}function rj(){var t=new Kn(0,0),e=0;if(!(4<this.len-this.pos)){for(;3>e;++e){if(this.pos>=this.len)throw wc(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,128>this.buf[this.pos++])return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;4>e;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,128>this.buf[this.pos++])return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return t;if(e=0,4<this.len-this.pos){for(;5>e;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,128>this.buf[this.pos++])return t}else for(;5>e;++e){if(this.pos>=this.len)throw wc(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,128>this.buf[this.pos++])return t}throw Error("invalid varint encoding")}function ih(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function Ln(){if(this.pos+8>this.len)throw wc(this,8);return new Kn(ih(this.buf,this.pos+=4),ih(this.buf,this.pos+=4))}function be(t){sj.call(this,t)}function Xf(t,e,n){if("function"!=typeof t)throw TypeError("rpcImpl must be a function");pa.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=!!e,this.responseDelimited=!!n}function Mn(t){var e=[];return function t(n){if(null===n||"object"!==qa(n))return n;if(-1!==e.indexOf(n))return"[Circular]";if(e.push(n),"function"==typeof n.toJSON)try{var i=t(n.toJSON());return e.pop(),i}catch(t){return"[Throws: "+(t?t.message:"?")+"]"}return Array.isArray(n)?(i=n.map(t),e.pop(),i):(i=Object.keys(n).reduce((function(e,i){t:{if(Ev.call(n,i))try{var r=n[i];break t}catch(t){r="[Throws: "+(t?t.message:"?")+"]";break t}r=n[i]}return e[i]=t(r),e}),{}),e.pop(),i)}(t)}function Fv(t){if(!(100<(t=String(t)).length)&&(t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t))){var e=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e;case"weeks":case"week":case"w":return 6048e5*e;case"days":case"day":case"d":return 864e5*e;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e}}}function jh(t,e,n,i){return Math.round(t/n)+" "+i+(e>=1.5*n?"s":"")}function Gv(t){var e=t.areas,n=t.excludedArea;if(1===e.length&&e[0]===S.GLOBAL&&n===S.CHINA)return Ve([S.OVERSEA]);if(e.includes(S.GLOBAL)){if(t=Yf(kh).filter((function(t){return t!==S.GLOBAL&&t!==S.OVERSEA})),n in Zf){e=Zf[n];var i=[].concat(Z(null!=e?e:[]),[n]);return Ve(t.filter((function(t){return!i.includes(t)})))}if(Nn(n)){var r=Hv(n);return Ve(t.filter((function(t){return t!==n&&t!==r})))}}if(Nn(n)||n in Zf)return Ve(e);throw new ca("Invalid excludedArea area config")}function jb(t,e,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(t,e));var i=n.value;return n.value=function(){for(var t=this,n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];this.invokeTracker.apply(this,["%s: ".concat(0<r.length?"%s with args: ".concat(r.map((function(){return"%o"}))):"%s"),this.name,e].concat(Z(r.map(We))));try{var o=i.apply(this,r)}catch(t){throw this.logError.apply(this,["".concat(void 0!==t.code?"Error Code ".concat(t.code,": "):"","%s failed").concat(0<r.length?" with args: ".concat(r.map((function(){return"%o"}))):""),e].concat(Z(r.map(We)))),t.originalError&&this.logError(t.originalError),this.errorTracker(t),t}var a=Date.now();return ma(N.mark((function n(){var i,s;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,o;case 3:i=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),t.logError.apply(t,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<r.length?" with args: ".concat(r.map((function(){return"%o"}))):""),e].concat(Z(r.map(We)))),n.t0.originalError&&t.logError(n.t0.originalError),t.errorTracker(n.t0),n.abrupt("return");case 12:i!==o?void 0===i?t.resultTracker("%s promise resolves after %dms",e,Date.now()-a):t.resultTracker("%s promise resolves after %dms, result is %o",e,Date.now()-a,We(i)):"Object"!==$c(i)||De(i)?t.resultTracker("%s result is %o",e,We(i)):t.resultTracker("%s result is %s",e,i.name||(null===(s=i.constructor)||void 0===s?void 0:s.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),o},n}function Mc(t,e,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(t,e));var i=n.value;return n.value=function(){for(var t=this,n=arguments.length,r=Array(n),s=0;s<n;s++)r[s]=arguments[s];this.invokeTracker.apply(this,["%s: ".concat(0<r.length?"%s with args: ".concat(r.map((function(){return"%o"}))):"%s"),this.name,e].concat(r));try{var o=i.apply(this,r)}catch(t){throw this.logError.apply(this,["".concat(void 0!==t.code?"Error Code ".concat(t.code,": "):"","%s failed").concat(0<r.length?" with args: ".concat(r.map((function(){return"%o"}))):""),e].concat(r)),t.originalError&&this.logError(t.originalError),this.errorTracker(t),t}var a=Date.now();return ma(N.mark((function n(){var i,s;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,o;case 3:i=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),t.logError.apply(t,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<r.length?" with args: ".concat(r.map((function(){return"%o"}))):""),e].concat(r)),n.t0.originalError&&t.logError(n.t0.originalError),t.errorTracker(n.t0),n.abrupt("return");case 12:i!==o?void 0===i?t.resultTracker("%s promise resolves after %dms",e,Date.now()-a):t.resultTracker("%s promise resolves after %dms, result is %o",e,Date.now()-a,i):"Object"!==$c(i)||De(i)?t.resultTracker("%s result is %o",e,i):t.resultTracker("%s result is %s",e,i.name||(null===(s=i.constructor)||void 0===s?void 0:s.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),o},n}function bb(t,e,n){return tj.apply(this,arguments)}function tj(){return(tj=ma(N.mark((function t(e,n,i){var r,s,o,a=arguments;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=3<a.length&&void 0!==a[3]&&a[3],s=Iv[e].encode(n).finish(),o=function(){var t=ma(N.mark((function t(n){var a,c,l,u=arguments;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(3<(c=1<u.length&&void 0!==u[1]?u[1]:0))){t.next=3;break}return t.abrupt("return");case 3:if(l=Xe(l=i?"https://".concat(null!==(a=null==fa?void 0:fa.PROXY_NGINX[0])&&void 0!==a?a:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(n,"&p=443&d=events/proto-raw"):"https://".concat(n,"/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),l=Xe(l,"id",Jv[e].toString()),!r){t.next=9;break}return t.next=9,Kv(1e4);case 9:return t.next=11,lh(l,{body:s,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch((function(t){return o(n,c+1)}));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.prev=3,t.next=6,o((null==fa?void 0:fa.EVENT_REPORT_DOMAIN[0])||$f(null)&&null||"webcollector-rtm.agora.io");case 6:t.next=12;break;case 8:return t.prev=8,t.t0=t.catch(3),t.next=12,o(fa&&On(1<(null==fa?void 0:fa.EVENT_REPORT_DOMAIN.length)?null==fa?void 0:fa.EVENT_REPORT_DOMAIN.slice(1):null==fa?void 0:fa.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 12:case"end":return t.stop()}}),t,null,[[3,8]])})))).apply(this,arguments)}function Xa(t){return void 0===t?P.fromNumber(0):P.fromNumber(Date.now()-t)}function Ta(t){return"string"==typeof t&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(t)&&"null"!==t}function Pn(t){try{var e=t.split(".").map((function(t){return Number(t)}))}catch(t){return!1}if(4!==e.length||0===e[0])return!1;for(t=0;t<e.length;t++){var n=e[t];if(!Number.isInteger(n)||0>n||255<n)return!1}return!0}function Qn(t,e){if(!Array.isArray(e)||0===e.length||32<e.length||e.some((function(t){return 0===t.length||32<t.length})))throw new ca("arguments is not valid",gb);if(!Ta(t))throw new ca("ID is invalid",gb)}function ag(t){var e=t.attributes,n=t.attrSizeMap,i=t.maxAttrsCount,r=t.maxAttrValueSize;if(t=t.maxTotalSize,!De(e))throw new ca("attributes must be an object",gb);if(Object.keys(e).length>i)throw new ic("Exceed the limit of ".concat(i," attributes"),Ye);if(0===Object.keys(e).length)throw new ca("The attributes is an empty object",gb);var s=0,o=0;for(e=Object.entries(e);o<e.length;o++){var a=$a(e[o],2),c=a[1];a=new Blob([a[0]]).size;var l=new Blob([c]).size;if(0===a||32<a)throw new ca("Invalid attribute key",gb);if(l>r)throw new ic("Invalid attribute value, over the limit of ".concat(r," bytes"),Ye);if("string"!=typeof c||0===c.length)throw new ca("Invalid attribute value",gb);s+=a,s+=l}if(s>t)throw new ic("The attributes size overflow",Ye);if(void 0!==n){if(Object.keys(n).length>i)throw new ic("Exceed the limit of ".concat(i," attributes"),Ye);for(s=i=0,n=Object.entries(n);s<n.length;s++){if(o=(e=$a(n[s],2))[1],0===(e=new Blob([e[0]]).size))throw new ca("Invalid attribute key",gb);if(o>r)throw new ic("Invalid attribute value, over the limit of ".concat(r," bytes"),Ye);i+=e,i+=o}if(i>t)throw new ic("The attributes size overflow",Ye)}}function mh(t,e){return Math.floor(Math.random()*(Math.floor(e)-Math.ceil(t)+1))+t}function nh(){var t=mh(0,4294967295),e=mh(1,4294967295);return new P(t,e,!0)}function sb(t){return t.toString().padEnd(32,"0")}function Rn(t,e){return new TypeError("Unexpected ".concat(t,": ").concat(e))}function Sn(t,e){return t=t.split(".").map((function(t){return Number(t)})),e=e.split(".").map((function(t){return Number(t)})),Math.sqrt(1e3*Math.pow(t[0]-e[0],2)+100*Math.pow(t[1]-e[1],2)+10*Math.pow(t[2]-e[2],2)+1*Math.pow(t[3]-e[3],2))}function Tn(t){return t.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?t.toNumber():t.toString()}function uj(t,e){e="".concat(t).concat(e||"");var n=Un.get(e)||1;return Un.set(e,n+1),"".concat(t).concat(n)}function Vn(t,e){var n="number"==typeof e?e:void 0!==e&&"string"!=typeof e?e.code:void 0;return e="number"!=typeof e&&"string"!=typeof e&&void 0!==e&&void 0!==e.serverCode?e.serverCode:void 0,n="".concat(void 0!==n?" Error Code ".concat(n):"").concat(void 0!==e?", server Code ".concat(e):""),t="string"==typeof t&&t?oh(t):Array.isArray(t)&&"string"==typeof t[0]&&t[0]?oh(Wn.apply(void 0,[t[0]].concat(Z(t.slice(1))))):"","".concat(""===n?"":"".concat(n," - ")).concat(t)}function Kv(t,e){return vj.apply(this,arguments)}function vj(){return(vj=ma(N.mark((function t(e,n){return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n||!n.aborted){t.next=2;break}return t.abrupt("return");case 2:return t.abrupt("return",new Promise((function(t){setTimeout(t,e),null==n||n.addEventListener("abort",t)})));case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function lh(t,e,n){return wj.apply(this,arguments)}function wj(){return(wj=ma(N.mark((function t(e,n,i){var r,s,o,a,c,l,u,d,h,A,p,f,m,g,v,y,_,b,E,w,S,T,C,R,I,x;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=n.body,s=n.headers,o=void 0===s?{}:s,a=n.timeout,c=void 0===a?1e4:a,l=n.signal,u=n.withCredentials,d=void 0!==u&&u,h=(i||{}).useBinaryResponse,A=void 0!==h&&h,(p=new XMLHttpRequest).open("POST",e,!0),p.responseType=A?"arraybuffer":"text",p.withCredentials=d,p.timeout=c,f=r instanceof FormData,m=r instanceof Uint8Array,!(1<(g=Object.keys(o).filter((function(t){return"content-type"===t.toLowerCase()}))).length)){t.next=14;break}throw new RangeError("multiple content-type");case 14:0===g.length&&(m?o["Content-Type"]="application/octet-stream":f||(o["Content-Type"]="application/json"));case 15:if("setRequestHeader"in p){t.next=46;break}return p.abort(),t.next=19,fetch(e,{body:f||m?r:JSON.stringify(r),cache:"no-cache",credentials:d?"include":"same-origin",headers:o,method:"POST",mode:"cors",referrer:"no-referrer",signal:l});case 19:if(v=t.sent,!(200<=(y=v.status)&&300>y||304===y)){t.next=31;break}if(!A){t.next=27;break}return t.next=25,v.arrayBuffer();case 25:return _=t.sent,t.abrupt("return",{status:y,responseData:_});case 27:return t.next=29,v.text();case 29:return b=t.sent,t.abrupt("return",{status:y,responseText:b});case 31:return E=new Ja(["Post XHR failure, status %d",y]),t.prev=32,t.next=35,v.text();case 35:throw w=t.sent,E.statusCode=y,E.message=w||"Request failed, status ".concat(y),E;case 41:throw t.prev=41,t.t0=t.catch(32),E.statusCode=y,E.message="Request failed, status ".concat(y),E;case 46:if(0!==Object.keys(o).length)for(S=0,T=Object.entries(o);S<T.length;S++)C=$a(T[S],2),R=C[0],I=C[1],p.setRequestHeader(R,I);return void 0!==l&&(x=function t(){p.abort(),l.removeEventListener("abort",t)},l.addEventListener("abort",x)),f||m?p.send(r):p.send(JSON.stringify(r)),t.abrupt("return",new Promise((function(t,e){p.onload=function(){var n=p.status;if(200<=n&&300>n||304===n)t(A?{status:n,responseData:p.response}:{status:n,responseText:p.responseText});else{var i=new Ja(["Post XHR failure, status %d",n]);i.statusCode=n,i.message=p.response||"Request failed, status ".concat(p.status),e(i)}},p.ontimeout=function(t){e(new Ub(["XHR request timed out after %d ms",c],{originalError:t}))},p.onerror=function(){var t=new Ja(["Post XHR failure, status %d",p.status]);t.statusCode=p.status,t.message=p.response||"Request failed, status ".concat(p.status),e(t)},p.onabort=function(){try{e(new DOMException("The request aborted.","AbortError"))}catch(n){var t=Error("The request aborted.");t.name="AbortError",e(t)}}})));case 50:case"end":return t.stop()}}),t,null,[[32,41]])})))).apply(this,arguments)}function Xn(t,e){if(!De(t))throw new ca("message object is not a plain object",e);if(void 0===t.messageType)if(t.rawMessage instanceof Uint8Array){if(t.messageType="RAW",void 0!==t.text)throw new ca("Raw messages cannot have text property. Use description instead",e)}else{if("string"!=typeof t.text)throw new ca("messageType is undefined",e);if(t.messageType="TEXT",void 0!==t.rawMessage)throw new ca("Text messages cannot have rawMessage property",e)}}function ph(t){return xj.apply(this,arguments)}function xj(){return(xj=ma(N.mark((function t(e){var n,i,r,s,o,a,c,l,u,d,h,A,p,f,m,g,v,y,_,b,E;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.message,i=e.peerId,r=e.toPeer,s=e.session,o=e.errorCodes,a=e.diff,c=e.logger,void 0!==s){t.next=3;break}throw new da("The client is not logged in. Cannot do the operation",o.NOT_LOGGED_IN);case 3:if(l=!1,u=r?"TEXT"===n.messageType?Ka.P2pSMsgNoOfflineFlag:Ka.P2pRMsgNoOfflineFlag:"TEXT"===n.messageType?Ka.ChannelSMsg:Ka.ChannelRMsg,"TEXT"!==n.messageType||!n.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!r){t.next=14;break}if(d=n.text.split("_"),h=$a(d,3),A=h[0],p=h[1],void 0!==h[2]&&Ta(p)&&"AgoraRTMLegacyEndcallCompatibleMessagePrefix"===A){t.next=13;break}throw s.emit("messageCount",{messageCategory:u,type:"common",key:"sentcount"}),s.emit("messageCount",{messageCategory:u,type:"common",key:"invalidmessagecount"}),new ca("Message is not valid",bg);case 13:l=!0;case 14:if(f=Date.now(),m=s.messageSentTimes.length-1,!((g=s.messageSentTimes[m])&&g+3e3<f)){t.next=21;break}s.messageSentTimes=[f],t.next=34;break;case 21:v=m;case 22:if(!(0<=v)){t.next=33;break}if(!(s.messageSentTimes[v]+3e3<f)){t.next=26;break}return s.messageSentTimes=s.messageSentTimes.slice(v+1,m+1),t.abrupt("break",33);case 26:if(!(180<=m-v+1)){t.next=30;break}throw s.emit("messageCount",{messageCategory:u,type:"common",key:"sentcount"}),s.emit("messageCount",{messageCategory:u,type:"common",key:"toooftencount"}),new ic("Message sent failed, exceeded the 180 message in 3 seconds",o.TOO_OFTEN);case 30:v--,t.next=22;break;case 33:s.messageSentTimes.push(f);case 34:t.t0=n.messageType,t.next="TEXT"===t.t0?37:"RAW"===t.t0?42:44;break;case 37:if(!l){t.next=41;break}return y=n.text.split("_"),_=$a(y,3),b=_[1],E=_[2],c.info("[rtm-API] EndCall message send api is called"),t.abrupt("return",s.sendInvitationMessage({peerId:i,type:"CallCancel",extra:E,channelId:b,callId:"0"}));case 41:return t.abrupt("return",s.sendTextMessage(n.text,i,r,1e4-a));case 42:return void 0===n.description&&(n.description=""),t.abrupt("return",s.sendRawMessage(n.rawMessage,n.description,i,r,1e4-a));case 44:throw s.emit("messageCount",{messageCategory:u,type:"common",key:"sentcount"}),s.emit("messageCount",{messageCategory:u,type:"common",key:"invalidmessagecount"}),new ca("Invalid message type",bg);case 47:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function Lv(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=t.replace(/(https?:\/\/)?(www.)?/i,"");return e||(n=n.split(".").slice(t.length-2).join(".")),-1!==n.indexOf("/")?n.split("/")[0]:n}function La(t){if("string"!=typeof t)return"[Sensitive Info]";var e=Math.floor(.7*t.length),n=t.length;return Yn(t,e,n,"*".repeat(n-e))}function Zn(t,e,n){function i(r){if(void 0===t)return t;if(Mm(r))return r;if(Array.isArray(r))return r.map(i);var s={},o=0;for(r=qh(r);o<r.length;o++){var a=$a(r[o],2),c=a[0];if("string"==typeof(a=a[1])&&n.includes(c)){s[c]="string"==typeof a?La(a):"[Sensitive Info]";break}e.includes(c)?s[c]="[Hidden Info]":s[c]=null==a?a:n.includes(c)?"[Sensitive Info]":i(a)}return s}return Array.isArray(t)?t.map(i):i(t)}function $n(t){return Object.getOwnPropertyNames(t).forEach((function(e){"object"==qa(e=t[e])&&null!==e&&$n(e)})),Object.freeze(t)}function cg(t){return new TextDecoder("utf-8").decode(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength))}function rh(t){return(new TextEncoder).encode(t).length}function ao(){for(var t=0,e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];for(e=0;e<n.length;e++)t+=n[e].length;for(t=new Uint8Array(t),i=e=0;i<n.length;i++){var r=n[i];t.set(r,e),e+=r.length}return t}function Xe(t,e,n){var i=t.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(t=null==i?void 0:i[1],i=null==i?void 0:i[2]){var r;for(i=i.substr(1).split("&"),r=0;r<i.length;r++)if(i[r].split("=")[0]==e){i[r]=e+"="+encodeURIComponent(n);break}return r==i.length&&i.push(e+"="+encodeURIComponent(n)),t+"?"+i.join("&")}return t+"?"+e+"="+encodeURIComponent(n)}function Yn(t,e,n,i){return"string"!=typeof t?"[Sensitive Info]":t.substring(0,e)+i+t.substring(n)}function $f(t){return"string"==typeof t&&0!==t.length&&"false"!==t&&"null"!==t&&"undefined"!==t}function Mv(t,e){var n="".concat(t,"Uri");if("number"!=typeof(n=yj[n])||0===n)throw new TypeError("Got Unknown URI Name");return e=new(t=bo[t])(e),e=t.encode(e).finish(),new Nv({uri:n,data:e})}function co(t,e){var n=$f(null);return"".concat(t.split(".").join("-"),".edge.").concat(n?null:e?"sd-rtn.com":"agora.io")}function sh(t,e){return P.fromValue(t).eq(e)}function th(t,e){var n=void 0===e?t.val:e,i=t.isBoolean;e=t.isNumber;var r=t.oneof,s=t.len;if(2!==[i,e,r].filter((function(t){return!t})).length)throw new TypeError("invalid field type");if(void 0!==n&&(t=!1,void 0!==r&&(r=zj(r),Ov(r,sh).length===r.length&&void 0!==Pv(r,(function(t){return sh(n,t)}))&&(t=!0)),i=void 0!==i&&(0===n||1===n)&&1===s,e=void 0!==e&&n.toString(2).length<=s,!(t||i||e)))throw Error("invalid field value")}function eo(t){return t.reduce((function(t,e){return t.concat(e instanceof uh.UnsubscriptionError?e.errors:e)}),[])}function Qv(t,e){do{2147483647==dg?dg=0:dg++}while(Ze.hasOwnProperty(dg));var n=dg;return Ze[n]={callback:t,parameters:Array.prototype.slice.call(arguments,2)},Aj.postMessage({name:"setInterval",fakeId:n,time:e}),n}function fo(t){return function(){var e=t();if(!e)throw new da("Client is not logged in. Cannot do the operation");return e}}var Ya="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},vh=function(t){return t&&t.Math==Math&&t},R=vh("object"==typeof globalThis&&globalThis)||vh("object"==typeof window&&window)||vh("object"==typeof self&&self)||vh("object"==typeof Ya&&Ya)||function(){return this}()||Function("return this")(),la=function(t){try{return!!t()}catch(t){return!0}},wa=!la((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),go={}.propertyIsEnumerable,ho=Object.getOwnPropertyDescriptor,eg=ho&&!go.call({1:2},1)?function(t){return!!(t=ho(this,t))&&t.enumerable}:go,Nc=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Rv={}.toString,xc=function(t){return Rv.call(t).slice(8,-1)},Sv="".split,fg=la((function(){return!Object("z").propertyIsEnumerable(0)}))?function(t){return"String"==xc(t)?Sv.call(t,""):Object(t)}:Object,Eb=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},Mb=function(t){return fg(Eb(t))},xa=function(t){return"object"==typeof t?null!==t:"function"==typeof t},Oc=function(t,e){if(!xa(t))return t;var n,i;if(e&&"function"==typeof(n=t.toString)&&!xa(i=n.call(t))||"function"==typeof(n=t.valueOf)&&!xa(i=n.call(t))||!e&&"function"==typeof(n=t.toString)&&!xa(i=n.call(t)))return i;throw TypeError("Can't convert object to primitive value")},pb=function(t){return Object(Eb(t))},Tv={}.hasOwnProperty,ka=function(t,e){return Tv.call(pb(t),e)},$e=R.document,wh=xa($e)&&xa($e.createElement),io=!wa&&!la((function(){return 7!=Object.defineProperty(wh?$e.createElement("div"):{},"a",{get:function(){return 7}}).a})),jo=Object.getOwnPropertyDescriptor,dc={f:wa?jo:function(t,e){if(t=Mb(t),e=Oc(e,!0),io)try{return jo(t,e)}catch(t){}if(ka(t,e))return Nc(!eg.call(t,e),t[e])}},Ia=function(t){if(!xa(t))throw TypeError(String(t)+" is not an object");return t},ko=Object.defineProperty,qb={f:wa?ko:function(t,e,n){if(Ia(t),e=Oc(e,!0),Ia(n),io)try{return ko(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},kb=wa?function(t,e,n){return qb.f(t,e,Nc(1,n))}:function(t,e,n){return t[e]=n,t},Bj=function(t,e){try{kb(R,t,e)}catch(n){R[t]=e}return e},zd=R["__core-js_shared__"]||Bj("__core-js_shared__",{}),Uv=Function.toString;"function"!=typeof zd.inspectSource&&(zd.inspectSource=function(t){return Uv.call(t)});var Cj=zd.inspectSource,lo=R.WeakMap,Vv="function"==typeof lo&&/native code/.test(Cj(lo)),Ad=xb((function(t){(t.exports=function(t,e){return zd[t]||(zd[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})})),Wv=0,Xv=Math.random(),af=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++Wv+Xv).toString(36)},mo=Ad("keys"),xh=function(t){return mo[t]||(mo[t]=af(t))},bf={},Yv=R.WeakMap;if(Vv||zd.state)var ce=zd.state||(zd.state=new Yv),Zv=ce.get,no=ce.has,$v=ce.set,Dj=function(t,e){if(no.call(ce,t))throw new TypeError("Object already initialized");return e.facade=t,$v.call(ce,t,e),e},yh=function(t){return Zv.call(ce,t)||{}},Ej=function(t){return no.call(ce,t)};else{var cf=xh("state");bf[cf]=!0,Dj=function(t,e){if(ka(t,cf))throw new TypeError("Object already initialized");return e.facade=t,kb(t,cf,e),e},yh=function(t){return ka(t,cf)?t[cf]:{}},Ej=function(t){return ka(t,cf)}}var cb={set:Dj,get:yh,has:Ej,enforce:function(t){return Ej(t)?yh(t):Dj(t,{})},getterFor:function(t){return function(e){var n;if(!xa(e)||(n=yh(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},Za=xb((function(t){var e=cb.get,n=cb.enforce,i=String(String).split("String");(t.exports=function(t,e,r,s){var o=!!s&&!!s.unsafe,a=!!s&&!!s.enumerable;if(s=!!s&&!!s.noTargetGet,"function"==typeof r){"string"!=typeof e||ka(r,"name")||kb(r,"name",e);var c=n(r);c.source||(c.source=i.join("string"==typeof e?e:""))}t===R?a?t[e]=r:Bj(e,r):(o?!s&&t[e]&&(a=!0):delete t[e],a?t[e]=r:kb(t,e,r))})(Function.prototype,"toString",(function(){return"function"==typeof this&&e(this).source||Cj(this)}))})),oo=function(t){return"function"==typeof t?t:void 0},Pc=function(t,e){return 2>arguments.length?oo(R[t])||oo(R[t]):R[t]&&R[t][e]||R[t]&&R[t][e]},aw=Math.ceil,bw=Math.floor,yc=function(t){return isNaN(t=+t)?0:(0<t?bw:aw)(t)},cw=Math.min,Ma=function(t){return 0<t?cw(yc(t),9007199254740991):0},dw=Math.max,ew=Math.min,Vb=function(t,e){return 0>(t=yc(t))?dw(t+e,0):ew(t,e)},po=function(t){return function(e,n,i){e=Mb(e);var r=Ma(e.length);if(i=Vb(i,r),t&&n!=n){for(;r>i;)if((n=e[i++])!=n)return!0}else for(;r>i;i++)if((t||i in e)&&e[i]===n)return t||i||0;return!t&&-1}},qo=po(!0),Fj=po(!1),ro=function(t,e){t=Mb(t);var n,i=0,r=[];for(n in t)!ka(bf,n)&&ka(t,n)&&r.push(n);for(;e.length>i;)ka(t,n=e[i++])&&(~Fj(r,n)||r.push(n));return r},zh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),fw=zh.concat("length","prototype"),de={f:Object.getOwnPropertyNames||function(t){return ro(t,fw)}},gg={f:Object.getOwnPropertySymbols},so=Pc("Reflect","ownKeys")||function(t){var e=de.f(Ia(t)),n=gg.f;return n?e.concat(n(t)):e},to=function(t,e){for(var n=so(e),i=qb.f,r=dc.f,s=0;s<n.length;s++){var o=n[s];ka(t,o)||i(t,o,r(e,o))}},gw=/#|\.prototype\./,Qc=function(t,e){return(t=hw[iw(t)])==jw||t!=kw&&("function"==typeof e?la(e):!!e)},iw=Qc.normalize=function(t){return String(t).replace(gw,".").toLowerCase()},hw=Qc.data={},kw=Qc.NATIVE="N",jw=Qc.POLYFILL="P",lw=dc.f,ea=function(t,e){var n,i,r,s=t.target,o=t.global,a=t.stat;if(i=o?R:a?R[s]||Bj(s,{}):(R[s]||{}).prototype)for(r in e){var c=e[r],l=t.noTargetGet?(n=lw(i,r))&&n.value:i[r];if(!(n=Qc(o?r:s+(a?".":"#")+r,t.forced))&&void 0!==l){if(typeof c==typeof l)continue;to(c,l)}(t.sham||l&&l.sham)&&kb(c,"sham",!0);try{Za(i,r,c,t)}catch(t){}}},Gj=function(){var t=Ia(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e},Rc=la((function(){var t=/a/y;return t.lastIndex=2,null!=t.exec("abcd")})),mw=la((function(){var t=/^r/gy;return t.lastIndex=2,null!=t.exec("str")})),Ah=RegExp.prototype.exec,nw=Ad("native-string-replace",String.prototype.replace),uo=Ah,Hj=(c=/a/,b=/b*/g,Ah.call(c,"a"),Ah.call(b,"a"),0!==c.lastIndex||0!==b.lastIndex),vo=Rc||mw,Ij=void 0!==/()??/.exec("")[1],c,b;(Hj||Ij||vo)&&(uo=function(t){var e,n=vo&&this.sticky,i=Gj.call(this),r=this.source,s=0,o=t;if(n){-1===(i=i.replace("y","")).indexOf("g")&&(i+="g"),o=String(t).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&"\n"!==t[this.lastIndex-1])&&(r="(?: "+r+")",o=" "+o,s++);var a=new RegExp("^(?:"+r+")",i)}if(Ij&&(a=new RegExp("^"+r+"$(?!\\s)",i)),Hj)var c=this.lastIndex;var l=Ah.call(n?a:this,o);return n?l?(l.input=l.input.slice(s),l[0]=l[0].slice(s),l.index=this.lastIndex,this.lastIndex+=l[0].length):this.lastIndex=0:Hj&&l&&(this.lastIndex=this.global?l.index+l[0].length:c),Ij&&l&&1<l.length&&nw.call(l[0],a,(function(){for(e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(l[e]=void 0)})),l});var hg=uo;ea({target:"RegExp",proto:!0,forced:/./.exec!==hg},{exec:hg});var df=Pc("navigator","userAgent")||"",wo=R.process,xo=wo&&wo.versions,yo=xo&&xo.v8;if(yo)var Bd=yo.split("."),Jj=4>Bd[0]?1:Bd[0]+Bd[1];else df&&(Bd=df.match(/Edge\/(\d+)/),(!Bd||74<=Bd[1])&&(Bd=df.match(/Chrome\/(\d+)/))&&(Jj=Bd[1]));var Cd=Jj&&+Jj,Sc=!!Object.getOwnPropertySymbols&&!la((function(){return!String(Symbol())||!Symbol.sham&&Cd&&41>Cd})),zo=Sc&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ig=Ad("wks"),jg=R.Symbol,ow=zo?jg:jg&&jg.withoutSetter||af,Fa=function(t){return ka(ig,t)&&(Sc||"string"==typeof ig[t])||(Sc&&ka(jg,t)?ig[t]=jg[t]:ig[t]=ow("Symbol."+t)),ig[t]},pw=Fa("species"),Kj=RegExp.prototype,qw=!la((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")})),Ao="$0"==="a".replace(/./,"$0"),Bo=Fa("replace"),Co=!!/./[Bo]&&""===/./[Bo]("a","$0"),rw=!la((function(){var t=/(?:)/,e=t.exec;return t.exec=function(){return e.apply(this,arguments)},2!==(t="ab".split(t)).length||"a"!==t[0]||"b"!==t[1]})),Bh=function(t,e,n,i){var r=Fa(t),s=!la((function(){var e={};return e[r]=function(){return 7},7!=""[t](e)})),o=s&&!la((function(){var e=!1,n=/a/;return"split"===t&&((n={constructor:{}}).constructor[pw]=function(){return n},n.flags="",n[r]=/./[r]),n.exec=function(){return e=!0,null},n[r](""),!e}));if(!s||!o||"replace"===t&&(!qw||!Ao||Co)||"split"===t&&!rw){var a=/./[r],c=(n=n(r,""[t],(function(t,e,n,i,r){var o=e.exec;return o===hg||o===Kj.exec?s&&!r?{done:!0,value:a.call(e,n,i)}:{done:!0,value:t.call(n,e,i)}:{done:!1}}),{REPLACE_KEEPS_$0:Ao,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Co}))[1];Za(String.prototype,t,n[0]),Za(Kj,r,2==e?function(t,e){return c.call(t,this,e)}:function(t){return c.call(t,this)})}i&&kb(Kj[r],"sham",!0)},sw=Fa("match"),Lj=function(t){var e;return xa(t)&&(void 0!==(e=t[sw])?!!e:"RegExp"==xc(t))},Wb=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},tw=Fa("species"),ee=function(t,e){var n;return void 0===(t=Ia(t).constructor)||null==(n=Ia(t)[tw])?e:Wb(n)},Do=function(t){return function(e,n){e=String(Eb(e)),n=yc(n);var i,r=e.length;if(0>n||n>=r)return t?"":void 0;var s=e.charCodeAt(n);return 55296>s||56319<s||n+1===r||56320>(i=e.charCodeAt(n+1))||57343<i?t?e.charAt(n):s:t?e.slice(n,n+2):i-56320+(s-55296<<10)+65536}},uw=Do(!1),Eo=Do(!0),Mj=function(t,e,n){return e+(n?Eo(t,e).length:1)},ef=function(t,e){var n=t.exec;if("function"==typeof n){if("object"!=typeof(t=n.call(t,e)))throw TypeError("RegExp exec method returned something other than an Object or null");return t}if("RegExp"!==xc(t))throw TypeError("RegExp#exec called on incompatible receiver");return hg.call(t,e)},vw=[].push,ww=Math.min;Bh("split",2,(function(t,e,n){var i="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(t,n){var i=String(Eb(this));if(0==(n=void 0===n?4294967295:n>>>0))return[];if(void 0===t)return[i];if(!Lj(t))return e.call(i,t,n);var r,s,o,a=[],c=0;for(t=new RegExp(t.source,(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":"")+"g");(r=hg.call(t,i))&&!((s=t.lastIndex)>c&&(a.push(i.slice(c,r.index)),1<r.length&&r.index<i.length&&vw.apply(a,r.slice(1)),o=r[0].length,c=s,a.length>=n));)t.lastIndex===r.index&&t.lastIndex++;return c===i.length?(o||!t.test(""))&&a.push(""):a.push(i.slice(c)),a.length>n?a.slice(0,n):a}:"0".split(void 0,0).length?function(t,n){return void 0===t&&0===n?[]:e.call(this,t,n)}:e;return[function(e,n){var r=Eb(this),s=null==e?void 0:e[t];return void 0!==s?s.call(e,r,n):i.call(String(r),e,n)},function(t,r){var s=n(i,t,this,r,i!==e);if(s.done)return s.value;var o=Ia(t);t=String(this);var a=ee(o,RegExp);if(s=o.unicode,o=new a(Rc?"^(?:"+o.source+")":o,(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(Rc?"g":"y")),0==(r=void 0===r?4294967295:r>>>0))return[];if(0===t.length)return null===ef(o,t)?[t]:[];var c=0,l=0;for(a=[];l<t.length;){o.lastIndex=Rc?0:l;var u,d=ef(o,Rc?t.slice(l):t);if(null===d||(u=ww(Ma(o.lastIndex+(Rc?l:0)),t.length))===c)l=Mj(t,l,s);else{if(a.push(t.slice(c,l)),a.length===r)return a;for(c=1;c<=d.length-1;c++)if(a.push(d[c]),a.length===r)return a;l=c=u}}return a.push(t.slice(c)),a}]}),Rc);var xw=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,yw=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,Nj=function(t){return function(e){return e=String(Eb(e)),1&t&&(e=e.replace(xw,"")),2&t&&(e=e.replace(yw,"")),e}};Nj(1),Nj(2);var Oj=Nj(3),Ch=R.parseInt,zw=/^[+-]?0[Xx]/,Fo=8!==Ch("\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff08")||22!==Ch("\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff0x16")?function(t,e){return t=Oj(String(t)),Ch(t,e>>>0||(zw.test(t)?16:10))}:Ch;ea({global:!0,forced:parseInt!=Fo},{parseInt:Fo});var Dd=function(t,e,n){if(Wb(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)}}return function(){return t.apply(e,arguments)}},Ed=Array.isArray||function(t){return"Array"==xc(t)},Aw=Fa("species"),Dh=function(t,e){if(Ed(t)){var n=t.constructor;"function"!=typeof n||n!==Array&&!Ed(n.prototype)?xa(n)&&null===(n=n[Aw])&&(n=void 0):n=void 0}return new(void 0===n?Array:n)(0===e?0:e)},Go=[].push,Fd=function(t){var e=1==t,n=2==t,i=3==t,r=4==t,s=6==t,o=7==t,a=5==t||s;return function(c,l,u,d){var h=pb(c),A=fg(h);l=Dd(l,u,3),u=Ma(A.length);var p,f=0;for(d=d||Dh,c=e?d(c,u):n||o?d(c,0):void 0;u>f;f++)if((a||f in A)&&(p=l(d=A[f],f,h),t))if(e)c[f]=p;else if(p)switch(t){case 3:return!0;case 5:return d;case 6:return f;case 2:Go.call(c,d)}else switch(t){case 4:return!1;case 7:Go.call(c,d)}return s?-1:i||r?r:c}},fe=Fd(0),Ho=Fd(1),Io=Fd(2),Bw=Fd(3),Cw=Fd(4),Jo=Fd(5),Dw=Fd(6);Fd(7);var Ew=Fa("species"),kg=function(t){return 51<=Cd||!la((function(){var e=[];return(e.constructor={})[Ew]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Fw=kg("filter");ea({target:"Array",proto:!0,forced:!Fw},{filter:function(t){return Io(this,t,1<arguments.length?arguments[1]:void 0)}});var ed=Object.keys||function(t){return ro(t,zh)},Gw=la((function(){ed(1)}));ea({target:"Object",stat:!0,forced:Gw},{keys:function(t){return ed(pb(t))}});var ff=function(t,e){var n=[][t];return!!n&&la((function(){n.call(null,e||function(){throw 1},1)}))},Hw=[].join,Iw=fg!=Object,Jw=ff("join",",");ea({target:"Array",proto:!0,forced:Iw||!Jw},{join:function(t){return Hw.call(Mb(this),void 0===t?",":t)}});var Kw=kg("map");ea({target:"Array",proto:!0,forced:!Kw},{map:function(t){return Ho(this,t,1<arguments.length?arguments[1]:void 0)}});var Pj=function(t){var e=t.return;if(void 0!==e)return Ia(e.call(t)).value},gf={},Lw=Fa("iterator"),Mw=Array.prototype,Qj=function(t){return void 0!==t&&(gf.Array===t||Mw[Lw]===t)},hf=function(t,e,n){(e=Oc(e))in t?qb.f(t,e,Nc(0,n)):t[e]=n},Nw=Fa("toStringTag"),Ko={};Ko[Nw]="z";var Rj="[object z]"===String(Ko),Ow=Fa("toStringTag"),Pw="Arguments"==xc(function(){return arguments}()),jf=Rj?xc:function(t){var e;if(void 0===t)var n="Undefined";else{if(null===t)var i="Null";else{t:{var r=t=Object(t);try{i=r[Ow];break t}catch(t){}i=void 0}i="string"==typeof(n=i)?n:Pw?xc(t):"Object"==(e=xc(t))&&"function"==typeof t.callee?"Arguments":e}n=i}return n},Qw=Fa("iterator"),lg=function(t){if(null!=t)return t[Qw]||t["@@iterator"]||gf[jf(t)]},ge=function(t){var e,n=pb(t),i="function"==typeof this?this:Array,r=arguments.length,s=1<r?arguments[1]:void 0,o=void 0!==s,a=lg(n),c=0;if(o&&(s=Dd(s,2<r?arguments[2]:void 0,2)),null==a||i==Array&&Qj(a)){var l=Ma(n.length);for(i=new i(l);l>c;c++)a=o?s(n[c],c):n[c],hf(i,c,a)}else for(r=(n=a.call(n)).next,i=new i;!(e=r.call(n)).done;c++){if(o){a=n;var u=s;e=[e.value,c];try{l=u(Ia(e)[0],e[1])}catch(t){throw Pj(a),t}}else l=e.value;hf(i,c,a=l)}return i.length=c,i},Lo=Fa("iterator"),Mo=!1;try{var Rw=0,No={next:function(){return{done:!!Rw++}},return:function(){Mo=!0}};No[Lo]=function(){return this},Array.from(No,(function(){throw 2}))}catch(c){}var Eh=function(t,e){if(!e&&!Mo)return!1;var n=!1;try{(e={})[Lo]=function(){return{next:function(){return{done:n=!0}}}},t(e)}catch(t){}return n},Sw=!Eh((function(t){Array.from(t)}));ea({target:"Array",stat:!0,forced:Sw},{from:ge});var Oo=!la((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Po=xh("IE_PROTO"),Tw=Object.prototype,uc=Oo?Object.getPrototypeOf:function(t){return t=pb(t),ka(t,Po)?t[Po]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Tw:null},Sj=Fa("iterator"),Qo=!1,Uw=function(){return this},he;if([].keys){var Ro=[].keys();if("next"in Ro){var So=uc(uc(Ro));So!==Object.prototype&&(he=So)}else Qo=!0}(null==he||la((function(){var t={};return he[Sj].call(t)!==t})))&&(he={}),ka(he,Sj)||kb(he,Sj,Uw);var Fh=he,Gh=Qo,To=wa?Object.defineProperties:function(t,e){Ia(t);for(var n,i=ed(e),r=i.length,s=0;r>s;)qb.f(t,n=i[s++],e[n]);return t},Tj=Pc("document","documentElement"),Uo=xh("IE_PROTO"),Uj=function(){},Vj,Hh=function(){try{Vj=document.domain&&new ActiveXObject("htmlfile")}catch(t){}if(Vj){var t=Vj;t.write("<script><\/script>"),t.close(),t=t.parentWindow.Object}else(t=wh?$e.createElement("iframe"):{}).style.display="none",Tj.appendChild(t),t.src="javascript:",(t=t.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),t=t.F;for(Hh=t,t=zh.length;t--;)delete Hh.prototype[zh[t]];return Hh()};bf[Uo]=!0;var jc=Object.create||function(t,e){if(null!==t){Uj.prototype=Ia(t);var n=new Uj;Uj.prototype=null,n[Uo]=t}else n=Hh();return void 0===e?n:To(n,e)},Vw=qb.f,Vo=Fa("toStringTag"),zc=function(t,e,n){t&&!ka(t=n?t:t.prototype,Vo)&&Vw(t,Vo,{configurable:!0,value:e})},Ww=function(){return this},Wo=function(t,e,n){return e+=" Iterator",t.prototype=jc(Fh,{next:Nc(1,n)}),zc(t,e,!1),gf[e]=Ww,t},tb=Object.setPrototypeOf||("__proto__"in{}?function(){var t=!1,e={};try{var n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;n.call(e,[]),t=e instanceof Array}catch(t){}return function(e,i){if(Ia(e),!xa(i)&&null!==i)throw TypeError("Can't set "+String(i)+" as a prototype");return t?n.call(e,i):e.__proto__=i,e}}():void 0),mg=Fa("iterator"),Xw=function(){return this},Wj=function(t,e,n,i,r,s,o){Wo(n,e,i),i=function(t){if(t===r&&h)return h;if(!Gh&&t in u)return u[t];switch(t){case"keys":case"values":case"entries":return function(){return new n(this,t)}}return function(){return new n(this)}};var a,c=e+" Iterator",l=!1,u=t.prototype,d=u[mg]||u["@@iterator"]||r&&u[r],h=!Gh&&d||i(r),A="Array"==e&&u.entries||d;if(A&&(t=uc(A.call(new t)),Fh!==Object.prototype&&t.next&&(uc(t)!==Fh&&(tb?tb(t,Fh):"function"!=typeof t[mg]&&kb(t,mg,Xw)),zc(t,c,!0))),"values"==r&&d&&"values"!==d.name&&(l=!0,h=function(){return d.call(this)}),u[mg]!==h&&kb(u,mg,h),gf[e]=h,r){var p={values:i("values"),keys:s?h:i("keys"),entries:i("entries")};if(o)for(a in p)!Gh&&!l&&a in u||Za(u,a,p[a]);else ea({target:e,proto:!0,forced:Gh||l},p)}return p},Yw=cb.set,Zw=cb.getterFor("String Iterator");Wj(String,"String",(function(t){Yw(this,{type:"String Iterator",string:String(t),index:0})}),(function(){var t=Zw(this),e=t.string,n=t.index;return n>=e.length?{value:void 0,done:!0}:(e=Eo(e,n),t.index+=e.length,{value:e,done:!1})}));var Xj=Fa("unscopables"),Yj=Array.prototype;null==Yj[Xj]&&qb.f(Yj,Xj,{configurable:!0,value:jc(null)});var ng=function(t){Yj[Xj][t]=!0},Xo=!0;"find"in[]&&Array(1).find((function(){Xo=!1})),ea({target:"Array",proto:!0,forced:Xo},{find:function(t){return Jo(this,t,1<arguments.length?arguments[1]:void 0)}}),ng("find");var Yo=function(t){var e=String(Eb(this)),n="";if(0>(t=yc(t))||1/0==t)throw RangeError("Wrong number of repetitions");for(;0<t;(t>>>=1)&&(e+=e))1&t&&(n+=e);return n};ea({target:"String",proto:!0},{repeat:Yo});var Zo=[].indexOf,$o=!!Zo&&0>1/[1].indexOf(1,-0),$w=ff("indexOf");ea({target:"Array",proto:!0,forced:$o||!$w},{indexOf:function(t){return $o?Zo.apply(this,arguments)||0:Fj(this,t,1<arguments.length?arguments[1]:void 0)}});var Zt=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,$t=/CrOS/,au=/android|ipad|playbook|silk/i;Ce.isMobile=Ce,Ce.default=Ce,ea({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),ea({target:"Number",stat:!0},{isNaN:function(t){return t!=t}}),R.Number.isNaN;var ax=Rj?{}.toString:function(){return"[object "+jf(this)+"]"};Rj||Za(Object.prototype,"toString",ax,{unsafe:!0});var Ih=R.Promise,kf=function(t,e,n){for(var i in e)Za(t,i,e[i],n);return t},ap=Fa("species"),og=function(t){t=Pc(t);var e=qb.f;wa&&t&&!t[ap]&&e(t,ap,{configurable:!0,get:function(){return this}})},Ac=function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t},pg=function(t,e){this.stopped=t,this.result=e},Jh=function(t,e,n){var i,r=!(!n||!n.AS_ENTRIES),s=!(!n||!n.IS_ITERATOR),o=!(!n||!n.INTERRUPTED),a=Dd(e,n&&n.that,1+r+o),c=function(t){return l&&Pj(l),new pg(!0,t)};if(e=function(t){return r?(Ia(t),o?a(t[0],t[1],c):a(t[0],t[1])):o?a(t,c):a(t)},s)var l=t;else{if("function"!=typeof(s=lg(t)))throw TypeError("Target is not iterable");if(Qj(s)){for(s=0,n=Ma(t.length);n>s;s++)if((i=e(t[s]))&&i instanceof pg)return i;return new pg(!1)}l=s.call(t)}for(t=l.next;!(s=t.call(l)).done;){try{i=e(s.value)}catch(t){throw Pj(l),t}if("object"==typeof i&&i&&i instanceof pg)return i}return new pg(!1)},bp=/(?:iphone|ipod|ipad).*applewebkit/i.test(df),fd="process"==xc(R.process),Kh=R.location,Zj=R.setImmediate,cp=R.clearImmediate,bx=R.process,dp=R.MessageChannel,ak=R.Dispatch,bk=0,qg={},ck=function(t){if(qg.hasOwnProperty(t)){var e=qg[t];delete qg[t],e()}},dk=function(t){return function(){ck(t)}},ep=function(t){ck(t.data)},fp=function(t){R.postMessage(t+"",Kh.protocol+"//"+Kh.host)};if(!Zj||!cp)if(Zj=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return qg[++bk]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},rg(bk),bk},cp=function(t){delete qg[t]},fd)var rg=function(t){bx.nextTick(dk(t))};else if(ak&&ak.now)rg=function(t){ak.now(dk(t))};else if(dp&&!bp){var gp=new dp,hp=gp.port2;gp.port1.onmessage=ep,rg=Dd(hp.postMessage,hp,1)}else R.addEventListener&&"function"==typeof postMessage&&!R.importScripts&&Kh&&"file:"!==Kh.protocol&&!la(fp)?(rg=fp,R.addEventListener("message",ep,!1)):rg="onreadystatechange"in(wh?$e.createElement("script"):{})?function(t){Tj.appendChild(wh?$e.createElement("script"):{}).onreadystatechange=function(){Tj.removeChild(this),ck(t)}}:function(t){setTimeout(dk(t),0)};var ek=Zj,cx=/web0s(?!.*chrome)/i.test(df),dx=dc.f,ip=R.MutationObserver||R.WebKitMutationObserver,jp=R.document,kp=R.process,Lh=R.Promise,lp=dx(R,"queueMicrotask"),mp=lp&&lp.value,ie,sg;if(!mp){var Nh=function(){var t;for(fd&&(t=kp.domain)&&t.exit();ie;){var e=ie.fn;ie=ie.next;try{e()}catch(t){throw ie?Mh():sg=void 0,t}}sg=void 0,t&&t.enter()};if(bp||fd||cx||!ip||!jp)if(Lh&&Lh.resolve){var fk=Lh.resolve(void 0);fk.constructor=Lh;var ex=fk.then,Mh=function(){ex.call(fk,Nh)}}else Mh=fd?function(){kp.nextTick(Nh)}:function(){ek.call(R,Nh)};else{var np=!0,op=jp.createTextNode("");new ip(Nh).observe(op,{characterData:!0}),Mh=function(){op.data=np=!np}}}var pp=mp||function(t){t={fn:t,next:void 0},sg&&(sg.next=t),ie||(ie=t,Mh()),sg=t},fx=function(t){var e,n;this.promise=new t((function(t,i){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=i})),this.resolve=Wb(e),this.reject=Wb(n)},gk={f:function(t){return new fx(t)}},gx=function(t,e){var n=R.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))},hk=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},hx="object"==typeof window,ix=Fa("species"),qp=cb.get,jx=cb.set,kx=cb.getterFor("Promise"),je=Ih&&Ih.prototype,Xb=Ih,Oh=je,rp=R.TypeError,ik=R.document,jk=R.process,lf=gk.f,lx=lf,mx=!!(ik&&ik.createEvent&&R.dispatchEvent),sp="function"==typeof PromiseRejectionEvent,tp=!1,tg=Qc("Promise",(function(){var t=Cj(Xb)!==String(Xb);if(!t&&66===Cd)return!0;if(51<=Cd&&/native code/.test(Xb))return!1;var e=new Xb((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};return(e.constructor={})[ix]=n,!(tp=e.then((function(){}))instanceof n)||!t&&hx&&!sp})),nx=tg||!Eh((function(t){Xb.all(t).catch((function(){}))})),up=function(t){var e;return!(!xa(t)||"function"!=typeof(e=t.then))&&e},kk=function(t,e){if(!t.notified){t.notified=!0;var n=t.reactions;pp((function(){for(var i=t.value,r=1==t.state,s=0;n.length>s;){var o,a=n[s++],c=r?a.ok:a.fail,l=a.resolve,u=a.reject,d=a.domain;try{if(c){if(r||(2===t.rejection&&ox(t),t.rejection=1),!0===c)var h=i;else if(d&&d.enter(),h=c(i),d){d.exit();var A=!0}h===a.promise?u(rp("Promise-chain cycle")):(o=up(h))?o.call(h,l,u):l(h)}else u(i)}catch(t){d&&!A&&d.exit(),u(t)}}t.reactions=[],t.notified=!1,e&&!t.rejection&&px(t)}))}},vp=function(t,e,n){var i;if(mx){var r=ik.createEvent("Event");r.promise=e,r.reason=n,r.initEvent(t,!1,!0),R.dispatchEvent(r)}else r={promise:e,reason:n};!sp&&(i=R["on"+t])?i(r):"unhandledrejection"===t&&gx("Unhandled promise rejection",n)},px=function(t){ek.call(R,(function(){var e=t.facade,n=t.value;if(1!==t.rejection&&!t.parent){var i=hk((function(){fd?jk.emit("unhandledRejection",n,e):vp("unhandledrejection",e,n)}));if(t.rejection=fd||1!==t.rejection&&!t.parent?2:1,i.error)throw i.value}}))},ox=function(t){ek.call(R,(function(){var e=t.facade;fd?jk.emit("rejectionHandled",e):vp("rejectionhandled",e,t.value)}))},mf=function(t,e,n){return function(i){t(e,i,n)}},nf=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,kk(t,!0))},lk=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw rp("Promise can't be resolved itself");var i=up(e);i?pp((function(){var n={done:!1};try{i.call(e,mf(lk,n,t),mf(nf,n,t))}catch(e){nf(n,e,t)}})):(t.value=e,t.state=1,kk(t,!1))}catch(e){nf({done:!1},e,t)}}};if(tg){Xb=function(t){Ac(this,Xb,"Promise"),Wb(t),mk.call(this);var e=qp(this);try{t(mf(lk,e),mf(nf,e))}catch(t){nf(e,t)}},Oh=Xb.prototype;var mk=function(t){jx(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};mk.prototype=kf(Oh,{then:function(t,e){var n=kx(this),i=lf(ee(this,Xb));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=fd?jk.domain:void 0,n.parent=!0,n.reactions.push(i),0!=n.state&&kk(n,!1),i.promise},catch:function(t){return this.then(void 0,t)}});var qx=function(){var t=new mk,e=qp(t);this.promise=t,this.resolve=mf(lk,e),this.reject=mf(nf,e)};if(gk.f=lf=function(t){return t===Xb||t===rx?new qx(t):lx(t)},"function"==typeof Ih&&je!==Object.prototype){var sx=je.then;tp||(Za(je,"then",(function(t,e){var n=this;return new Xb((function(t,e){sx.call(n,t,e)})).then(t,e)}),{unsafe:!0}),Za(je,"catch",Oh.catch,{unsafe:!0}));try{delete je.constructor}catch(c){}tb&&tb(je,Oh)}}ea({global:!0,wrap:!0,forced:tg},{Promise:Xb}),zc(Xb,"Promise",!1),og("Promise");var rx=Pc("Promise");ea({target:"Promise",stat:!0,forced:tg},{reject:function(t){var e=lf(this);return e.reject.call(void 0,t),e.promise}}),ea({target:"Promise",stat:!0,forced:tg},{resolve:function(t){if(Ia(this),!xa(t)||t.constructor!==this){var e=gk.f(this);(0,e.resolve)(t),t=e.promise}return t}}),ea({target:"Promise",stat:!0,forced:nx},{all:function(t){var e=this,n=lf(e),i=n.resolve,r=n.reject,s=hk((function(){var n=Wb(e.resolve),s=[],o=0,a=1;Jh(t,(function(t){var c=o++,l=!1;s.push(void 0),a++,n.call(e,t).then((function(t){l||(l=!0,s[c]=t,--a||i(s))}),r)})),--a||i(s)}));return s.error&&r(s.value),n.promise},race:function(t){var e=this,n=lf(e),i=n.reject,r=hk((function(){var r=Wb(e.resolve);Jh(t,(function(t){r.call(e,t).then(n.resolve,i)}))}));return r.error&&i(r.value),n.promise}});var tx=Math.floor,ux="".replace,vx=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,wx=/\$([$&'`]|\d{1,2})/g,xx=function(t,e,n,i,r,s){var o=n+t.length,a=i.length,c=wx;return void 0!==r&&(r=pb(r),c=vx),ux.call(s,c,(function(s,c){switch(c.charAt(0)){case"$":return"$";case"&":return t;case"`":return e.slice(0,n);case"'":return e.slice(o);case"<":s=r[c.slice(1,-1)];break;default:var l=+c;if(0===l)return s;if(l>a)return 0===(l=tx(l/10))?s:l<=a?void 0===i[l-1]?c.charAt(1):i[l-1]+c.charAt(1):s;s=i[l-1]}return void 0===s?"":s}))},yx=Math.max,zx=Math.min;Bh("replace",2,(function(t,e,n,i){var r=i.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,s=i.REPLACE_KEEPS_$0,o=r?"$":"$0";return[function(n,i){var r=Eb(this),s=null==n?void 0:n[t];return void 0!==s?s.call(n,r,i):e.call(String(r),n,i)},function(t,i){if(!r&&s||"string"==typeof i&&-1===i.indexOf(o)){var a=n(e,t,this,i);if(a.done)return a.value}var c=Ia(t);t=String(this),(a="function"==typeof i)||(i=String(i));var l=c.global;if(l){var u=c.unicode;c.lastIndex=0}for(var d=[];;){var h=ef(c,t);if(null===h)break;if(d.push(h),!l)break;""===String(h[0])&&(c.lastIndex=Mj(t,Ma(c.lastIndex),u))}for(u="",l=c=0;l<d.length;l++){h=d[l];for(var A=String(h[0]),p=yx(zx(yc(h.index),t.length),0),f=[],m=1;m<h.length;m++){var g=f,v=h[m];g.push.call(g,void 0===v?v:String(v))}h=h.groups,a?(f=[A].concat(f,p,t),void 0!==h&&f.push(h),h=String(i.apply(void 0,f))):h=xx(A,t,p,f,h,i),p>=c&&(u+=t.slice(c,p)+h,c=p+A.length)}return u+t.slice(c)}]}));var Ax=kg("slice"),Bx=Fa("species"),Cx=[].slice,Dx=Math.max;ea({target:"Array",proto:!0,forced:!Ax},{slice:function(t,e){var n=Mb(this),i=Ma(n.length);if(t=Vb(t,i),e=Vb(void 0===e?i:e,i),Ed(n)){var r=n.constructor;if("function"!=typeof r||r!==Array&&!Ed(r.prototype)?xa(r)&&null===(r=r[Bx])&&(r=void 0):r=void 0,r===Array||void 0===r)return Cx.call(n,t,e)}for(r=new(void 0===r?Array:r)(Dx(e-t,0)),i=0;t<e;t++,i++)t in n&&hf(r,i,n[t]);return r.length=i,r}});var Ex=cb.set,Fx=cb.getterFor("Array Iterator"),Gd=Wj(Array,"Array",(function(t,e){Ex(this,{type:"Array Iterator",target:Mb(t),index:0,kind:e})}),(function(){var t=Fx(this),e=t.target,n=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:i,done:!1}:"values"==n?{value:e[i],done:!1}:{value:[i,e[i]],done:!1}}),"values");gf.Arguments=gf.Array,ng("keys"),ng("values"),ng("entries");var wp="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,of=function(t){if(void 0===t)return 0;t=yc(t);var e=Ma(t);if(t!==e)throw RangeError("Wrong length or index");return e},Gx=Math.abs,gd=Math.pow,Hx=Math.floor,Ix=Math.log,Jx=Math.LN2,xp=function(t){var e=pb(this),n=Ma(e.length),i=arguments.length,r=Vb(1<i?arguments[1]:void 0,n);for(n=void 0===(i=2<i?arguments[2]:void 0)?n:Vb(i,n);n>r;)e[r++]=t;return e},Kx=de.f,Lx=qb.f,pf=cb.get,yp=cb.set,Bc=R.ArrayBuffer,Yb=Bc,Cc=R.DataView,Ph=Cc&&Cc.prototype,zp=Object.prototype,Qh=R.RangeError,Ap=function(t,e,n){var i,r=Array(n),s=(1<<(n=8*n-e-1))-1,o=s>>1,a=23===e?gd(2,-24)-gd(2,-77):0,c=0>t||0===t&&0>1/t?1:0,l=0;if((t=Gx(t))!=t||1/0===t){t=t!=t?1:0;var u=s}else u=Hx(Ix(t)/Jx),1>t*(i=gd(2,-u))&&(u--,i*=2),2<=(t=1<=u+o?t+a/i:t+a*gd(2,1-o))*i&&(u++,i/=2),u+o>=s?(t=0,u=s):1<=u+o?(t=(t*i-1)*gd(2,e),u+=o):(t=t*gd(2,o-1)*gd(2,e),u=0);for(;8<=e;r[l++]=255&t,t/=256,e-=8);for(u=u<<e|t,n+=e;0<n;r[l++]=255&u,u/=256,n-=8);return r[--l]|=128*c,r},Bp=function(t,e){var n=t.length,i=8*n-e-1,r=(1<<i)-1,s=r>>1;i-=7,--n;var o=t[n--],a=127&o;for(o>>=7;0<i;a=256*a+t[n],n--,i-=8);var c=a&(1<<-i)-1;for(a>>=-i,i+=e;0<i;c=256*c+t[n],n--,i-=8);if(0===a)a=1-s;else{if(a===r)return c?NaN:o?-1/0:1/0;c+=gd(2,e),a-=s}return(o?-1:1)*c*gd(2,a-e)},Cp=function(t){return[255&t]},Dp=function(t){return[255&t,t>>8&255]},Ep=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Fp=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Mx=function(t){return Ap(t,23,4)},Nx=function(t){return Ap(t,52,8)},Rh=function(t,e){Lx(t.prototype,e,{get:function(){return pf(this)[e]}})},Hd=function(t,e,n,i){n=of(n);var r=pf(t);if(n+e>r.byteLength)throw Qh("Wrong index");return t=pf(r.buffer).bytes,n+=r.byteOffset,e=t.slice(n,n+e),i?e:e.reverse()},Id=function(t,e,n,i,r,s){n=of(n);var o=pf(t);if(n+e>o.byteLength)throw Qh("Wrong index");for(t=pf(o.buffer).bytes,n+=o.byteOffset,i=i(+r),r=0;r<e;r++)t[n+r]=i[s?r:e-r-1]};if(wp){if(!la((function(){Bc(1)}))||!la((function(){new Bc(-1)}))||la((function(){return new Bc,new Bc(1.5),new Bc(NaN),"ArrayBuffer"!=Bc.name}))){Yb=function(t){return Ac(this,Yb),new Bc(of(t))};for(var Ox=Yb.prototype=Bc.prototype,Gp=Kx(Bc),Hp=0,nk;Gp.length>Hp;)(nk=Gp[Hp++])in Yb||kb(Yb,nk,Bc[nk]);Ox.constructor=Yb}tb&&uc(Ph)!==zp&&tb(Ph,zp);var Sh=new Cc(new Yb(2)),Ip=Ph.setInt8;Sh.setInt8(0,2147483648),Sh.setInt8(1,2147483649),!Sh.getInt8(0)&&Sh.getInt8(1)||kf(Ph,{setInt8:function(t,e){Ip.call(this,t,e<<24>>24)},setUint8:function(t,e){Ip.call(this,t,e<<24>>24)}},{unsafe:!0})}else Yb=function(t){Ac(this,Yb,"ArrayBuffer"),t=of(t),yp(this,{bytes:xp.call(Array(t),0),byteLength:t}),wa||(this.byteLength=t)},Cc=function(t,e,n){Ac(this,Cc,"DataView"),Ac(t,Yb,"DataView");var i=pf(t).byteLength;if(0>(e=yc(e))||e>i)throw Qh("Wrong offset");if(e+(n=void 0===n?i-e:Ma(n))>i)throw Qh("Wrong length");yp(this,{buffer:t,byteLength:n,byteOffset:e}),wa||(this.buffer=t,this.byteLength=n,this.byteOffset=e)},wa&&(Rh(Yb,"byteLength"),Rh(Cc,"buffer"),Rh(Cc,"byteLength"),Rh(Cc,"byteOffset")),kf(Cc.prototype,{getInt8:function(t){return Hd(this,1,t)[0]<<24>>24},getUint8:function(t){return Hd(this,1,t)[0]},getInt16:function(t){var e=Hd(this,2,t,1<arguments.length?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Hd(this,2,t,1<arguments.length?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Fp(Hd(this,4,t,1<arguments.length?arguments[1]:void 0))},getUint32:function(t){return Fp(Hd(this,4,t,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(t){return Bp(Hd(this,4,t,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(t){return Bp(Hd(this,8,t,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(t,e){Id(this,1,t,Cp,e)},setUint8:function(t,e){Id(this,1,t,Cp,e)},setInt16:function(t,e){Id(this,2,t,Dp,e,2<arguments.length?arguments[2]:void 0)},setUint16:function(t,e){Id(this,2,t,Dp,e,2<arguments.length?arguments[2]:void 0)},setInt32:function(t,e){Id(this,4,t,Ep,e,2<arguments.length?arguments[2]:void 0)},setUint32:function(t,e){Id(this,4,t,Ep,e,2<arguments.length?arguments[2]:void 0)},setFloat32:function(t,e){Id(this,4,t,Mx,e,2<arguments.length?arguments[2]:void 0)},setFloat64:function(t,e){Id(this,8,t,Nx,e,2<arguments.length?arguments[2]:void 0)}});zc(Yb,"ArrayBuffer"),zc(Cc,"DataView");var ug={ArrayBuffer:Yb,DataView:Cc},ok=ug.ArrayBuffer,Jp=ug.DataView,Kp=ok.prototype.slice,Px=la((function(){return!new ok(2).slice(1,void 0).byteLength}));ea({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Px},{slice:function(t,e){if(void 0!==Kp&&void 0===e)return Kp.call(Ia(this),t);var n=Ia(this).byteLength;t=Vb(t,n),e=Vb(void 0===e?n:e,n),n=new(ee(this,ok))(Ma(e-t));for(var i=new Jp(this),r=new Jp(n),s=0;t<e;)r.setUint8(s++,i.getUint8(t++));return n}});var Qx=qb.f,Th=R.Int8Array,pk=Th&&Th.prototype,Lp=R.Uint8ClampedArray,Mp=Lp&&Lp.prototype,Tc=Th&&uc(Th),Dc=pk&&uc(pk),Np=Object.prototype,Op=Np.isPrototypeOf,Pp=Fa("toStringTag"),qk=af("TYPED_ARRAY_TAG"),hd=wp&&!!tb&&"Opera"!==jf(R.opera),Qp=!1,Zb,Uc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Rx={BigInt64Array:8,BigUint64Array:8},Uh=function(t){return!!xa(t)&&(t=jf(t),ka(Uc,t)||ka(Rx,t))};for(Zb in Uc)R[Zb]||(hd=!1);if((!hd||"function"!=typeof Tc||Tc===Function.prototype)&&(Tc=function(){throw TypeError("Incorrect invocation")},hd))for(Zb in Uc)R[Zb]&&tb(R[Zb],Tc);if((!hd||!Dc||Dc===Np)&&(Dc=Tc.prototype,hd))for(Zb in Uc)R[Zb]&&tb(R[Zb].prototype,Dc);if(hd&&uc(Mp)!==Dc&&tb(Mp,Dc),wa&&!ka(Dc,Pp))for(Zb in Qp=!0,Qx(Dc,Pp,{get:function(){return xa(this)?this[qk]:void 0}}),Uc)R[Zb]&&kb(R[Zb],qk,Zb);var vg=hd,Rp=Qp&&qk,Ua=function(t){if(Uh(t))return t;throw TypeError("Target is not a typed array")},qf=function(t){if(tb){if(Op.call(Tc,t))return t}else for(var e in Uc)if(ka(Uc,Zb)){var n=R[e];if(n&&(t===n||Op.call(n,t)))return t}throw TypeError("Target is not a typed array constructor")},Ra=function(t,e,n){if(wa){if(n)for(var i in Uc){var r=R[i];if(r&&ka(r.prototype,t))try{delete r.prototype[t]}catch(t){}}Dc[t]&&!n||Za(Dc,t,n?e:hd&&pk[t]||e)}},Sp=function(t,e,n){var i,r;if(wa){if(tb){if(n)for(i in Uc)if((r=R[i])&&ka(r,t))try{delete r[t]}catch(t){}if(Tc[t]&&!n)return;try{return Za(Tc,t,n?e:hd&&Tc[t]||e)}catch(t){}}for(i in Uc)!(r=R[i])||r[t]&&!n||Za(r,t,e)}},Tp=Tc,wg=Dc,Sx=R.ArrayBuffer,ke=R.Int8Array,rk=!vg||!la((function(){ke(1)}))||!la((function(){new ke(-1)}))||!Eh((function(t){new ke,new ke(null),new ke(1.5),new ke(t)}),!0)||la((function(){return 1!==new ke(new Sx(2),1,void 0).length})),Vh=function(t,e){if(0>(t=yc(t)))throw RangeError("The argument can't be less than 0");if(t%e)throw RangeError("Wrong offset");return t},sk=function(t){var e=pb(t),n=arguments.length,i=1<n?arguments[1]:void 0,r=void 0!==i,s=lg(e);if(null!=s&&!Qj(s)){var o=s.call(e),a=o.next;for(e=[];!(s=a.call(o)).done;)e.push(s.value)}for(r&&2<n&&(i=Dd(i,arguments[2],2)),s=Ma(e.length),o=new(qf(this))(s),n=0;s>n;n++)o[n]=r?i(e[n],n):e[n];return o},Wh=function(t,e,n){var i,r;return tb&&"function"==typeof(i=e.constructor)&&i!==n&&xa(r=i.prototype)&&r!==n.prototype&&tb(t,r),t},xg=xb((function(t){var e=de.f,n=cb.get,i=cb.set,r=qb.f,s=dc.f,o=Math.round,a=R.RangeError,c=ug.ArrayBuffer,l=ug.DataView,u=function(t,e){var n=0,i=e.length;for(t=new(qf(t))(i);i>n;)t[n]=e[n++];return t},d=function(t,e){r(t,e,{get:function(){return n(this)[e]}})},h=function(t){var e;return t instanceof c||"ArrayBuffer"==(e=jf(t))||"SharedArrayBuffer"==e},A=function(t,e){return Uh(t)&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},p=function(t,e){return A(t,e=Oc(e,!0))?Nc(2,t[e]):s(t,e)},f=function(t,e,n){return!(A(t,e=Oc(e,!0))&&xa(n)&&ka(n,"value"))||ka(n,"get")||ka(n,"set")||n.configurable||ka(n,"writable")&&!n.writable||ka(n,"enumerable")&&!n.enumerable?r(t,e,n):(t[e]=n.value,t)};wa?(vg||(dc.f=p,qb.f=f,d(wg,"buffer"),d(wg,"byteOffset"),d(wg,"byteLength"),d(wg,"length")),ea({target:"Object",stat:!0,forced:!vg},{getOwnPropertyDescriptor:p,defineProperty:f}),t.exports=function(t,s,d){var A=t.match(/\d+$/)[0]/8,p=t+(d?"Clamped":"")+"Array",f="get"+t,m="set"+t,g=R[p],v=g;t=v&&v.prototype;var y={},_=function(t,e){r(t,e,{get:function(){var t=n(this);return t.view[f](e*A+t.byteOffset,!0)},set:function(t){var i=n(this);d&&(t=0>(t=o(t))?0:255<t?255:255&t),i.view[m](e*A+i.byteOffset,t,!0)},enumerable:!0})};vg?rk&&(v=s((function(t,e,n,i){return Ac(t,v,p),Wh(xa(e)?h(e)?void 0!==i?new g(e,Vh(n,A),i):void 0!==n?new g(e,Vh(n,A)):new g(e):Uh(e)?u(v,e):sk.call(v,e):new g(of(e)),t,v)})),tb&&tb(v,Tp),fe(e(g),(function(t){t in v||kb(v,t,g[t])})),v.prototype=t):(v=s((function(t,e,n,r){Ac(t,v,p);var s=0,o=0;if(xa(e)){if(!h(e))return Uh(e)?u(v,e):sk.call(v,e);var d=e;if(o=Vh(n,A),e=e.byteLength,void 0===r){if(e%A)throw a("Wrong length");if(0>(r=e-o))throw a("Wrong length")}else if((r=Ma(r)*A)+o>e)throw a("Wrong length");e=r/A}else e=of(e),d=new c(r=e*A);for(i(t,{buffer:d,byteOffset:o,byteLength:r,length:e,view:new l(d)});s<e;)_(t,s++)})),tb&&tb(v,Tp),t=v.prototype=jc(wg)),t.constructor!==v&&kb(t,"constructor",v),Rp&&kb(t,Rp,p),y[p]=v,ea({global:!0,forced:v!=g,sham:!vg},y),"BYTES_PER_ELEMENT"in v||kb(v,"BYTES_PER_ELEMENT",A),"BYTES_PER_ELEMENT"in t||kb(t,"BYTES_PER_ELEMENT",A),og(p)}):t.exports=function(){}}));xg("Uint8",(function(t){return function(e,n,i){return t(this,e,n,i)}}));var Tx=Math.min,Ux=[].copyWithin||function(t,e){var n=pb(this),i=Ma(n.length),r=Vb(t,i),s=Vb(e,i),o=2<arguments.length?arguments[2]:void 0;for(i=Tx((void 0===o?i:Vb(o,i))-s,i-r),o=1,s<r&&r<s+i&&(o=-1,s+=i-1,r+=i-1);0<i--;)s in n?n[r]=n[s]:delete n[r],r+=o,s+=o;return n};Ra("copyWithin",(function(t,e){return Ux.call(Ua(this),t,e,2<arguments.length?arguments[2]:void 0)})),Ra("every",(function(t){return Cw(Ua(this),t,1<arguments.length?arguments[1]:void 0)})),Ra("fill",(function(t){return xp.apply(Ua(this),arguments)})),Ra("filter",(function(t){var e=Io(Ua(this),t,1<arguments.length?arguments[1]:void 0),n=ee(this,this.constructor),i=0,r=e.length;for(n=new(qf(n))(r);r>i;)n[i]=e[i++];return n})),Ra("find",(function(t){return Jo(Ua(this),t,1<arguments.length?arguments[1]:void 0)})),Ra("findIndex",(function(t){return Dw(Ua(this),t,1<arguments.length?arguments[1]:void 0)})),Ra("forEach",(function(t){fe(Ua(this),t,1<arguments.length?arguments[1]:void 0)})),Ra("includes",(function(t){return qo(Ua(this),t,1<arguments.length?arguments[1]:void 0)})),Ra("indexOf",(function(t){return Fj(Ua(this),t,1<arguments.length?arguments[1]:void 0)}));var Up=Fa("iterator"),Vp=R.Uint8Array,Vx=Gd.values,Wx=Gd.keys,Xx=Gd.entries,tk=Vp&&Vp.prototype[Up],Wp=!!tk&&("values"==tk.name||null==tk.name),Xp=function(){return Vx.call(Ua(this))};Ra("entries",(function(){return Xx.call(Ua(this))})),Ra("keys",(function(){return Wx.call(Ua(this))})),Ra("values",Xp,!Wp),Ra(Up,Xp,!Wp);var Yx=[].join;Ra("join",(function(t){return Yx.apply(Ua(this),arguments)}));var Zx=Math.min,uk=[].lastIndexOf,Yp=!!uk&&0>1/[1].lastIndexOf(1,-0),$x=ff("lastIndexOf"),ay=Yp||!$x?function(t){if(Yp)return uk.apply(this,arguments)||0;var e=Mb(this),n=Ma(e.length),i=n-1;for(1<arguments.length&&(i=Zx(i,yc(arguments[1]))),0>i&&(i=n+i);0<=i;i--)if(i in e&&e[i]===t)return i||0;return-1}:uk;Ra("lastIndexOf",(function(t){return ay.apply(Ua(this),arguments)})),Ra("map",(function(t){return Ho(Ua(this),t,1<arguments.length?arguments[1]:void 0,(function(t,e){return new(qf(ee(t,t.constructor)))(e)}))}));var Zp=function(t){return function(e,n,i,r){Wb(n),e=pb(e);var s=fg(e),o=Ma(e.length),a=t?o-1:0,c=t?-1:1;if(2>i)for(;;){if(a in s){r=s[a],a+=c;break}if(a+=c,t?0>a:o<=a)throw TypeError("Reduce of empty array with no initial value")}for(;t?0<=a:o>a;a+=c)a in s&&(r=n(r,s[a],a,e));return r}},$p=Zp(!1),by=Zp(!0);Ra("reduce",(function(t){return $p(Ua(this),t,arguments.length,1<arguments.length?arguments[1]:void 0)})),Ra("reduceRight",(function(t){return by(Ua(this),t,arguments.length,1<arguments.length?arguments[1]:void 0)}));var cy=Math.floor;Ra("reverse",(function(){for(var t,e=Ua(this).length,n=cy(e/2),i=0;i<n;)t=this[i],this[i++]=this[--e],this[e]=t;return this}));var dy=la((function(){new Int8Array(1).set({})}));Ra("set",(function(t){Ua(this);var e=Vh(1<arguments.length?arguments[1]:void 0,1),n=this.length,i=pb(t),r=Ma(i.length),s=0;if(r+e>n)throw RangeError("Wrong length");for(;s<r;)this[e+s]=i[s++]}),dy);var ey=[].slice,fy=la((function(){new Int8Array(1).slice()}));Ra("slice",(function(t,e){t=ey.call(Ua(this),t,e);var n=ee(this,this.constructor);e=0;var i=t.length;for(n=new(qf(n))(i);i>e;)n[e]=t[e++];return n}),fy),Ra("some",(function(t){return Bw(Ua(this),t,1<arguments.length?arguments[1]:void 0)}));var gy=[].sort;Ra("sort",(function(t){return gy.call(Ua(this),t)})),Ra("subarray",(function(t,e){var n=Ua(this),i=n.length;return t=Vb(t,i),new(ee(n,n.constructor))(n.buffer,n.byteOffset+t*n.BYTES_PER_ELEMENT,Ma((void 0===e?i:Vb(e,i))-t))}));var Xh=R.Int8Array,aq=[].toLocaleString,hy=[].slice,iy=!!Xh&&la((function(){aq.call(new Xh(1))})),jy=la((function(){return[1,2].toLocaleString()!=new Xh([1,2]).toLocaleString()}))||!la((function(){Xh.prototype.toLocaleString.call([1,2])}));Ra("toLocaleString",(function(){return aq.apply(iy?hy.call(Ua(this)):Ua(this),arguments)}),jy);var bq=R.Uint8Array,ky=bq&&bq.prototype||{},Yh=[].toString,ly=[].join;la((function(){Yh.call({})}))&&(Yh=function(){return ly.call(this)}),Ra("toString",Yh,ky.toString!=Yh);var cq=ug.ArrayBuffer;ea({global:!0,forced:R.ArrayBuffer!==cq},{ArrayBuffer:cq}),og("ArrayBuffer");var my=qb.f,vk=Function.prototype,ny=vk.toString,oy=/^\s*function ([^ (]*)/;!wa||"name"in vk||my(vk,"name",{configurable:!0,get:function(){try{return ny.call(this).match(oy)[1]}catch(t){return""}}});var dq=RegExp.prototype,eq=dq.toString,py=la((function(){return"/a/b"!=eq.call({source:"a",flags:"b"})})),qy="toString"!=eq.name;(py||qy)&&Za(RegExp.prototype,"toString",(function(){var t=Ia(this),e=String(t.source),n=t.flags;return"/"+e+"/"+String(void 0===n&&t instanceof RegExp&&!("flags"in dq)?Gj.call(t):n)}),{unsafe:!0});var ry=kg("splice"),sy=Math.max,ty=Math.min;ea({target:"Array",proto:!0,forced:!ry},{splice:function(t,e){var n,i,r=pb(this),s=Ma(r.length),o=Vb(t,s),a=arguments.length;if(0===a?a=n=0:1===a?(a=0,n=s-o):(a-=2,n=ty(sy(yc(e),0),s-o)),9007199254740991<s+a-n)throw TypeError("Maximum allowed length exceeded");var c=Dh(r,n);for(i=0;i<n;i++){var l=o+i;l in r&&hf(c,i,r[l])}if(c.length=n,a<n){for(i=o;i<s-n;i++){var u=i+a;(l=i+n)in r?r[u]=r[l]:delete r[u]}for(i=s;i>s-n+a;i--)delete r[i-1]}else if(a>n)for(i=s-n;i>o;i--)u=i+a-1,(l=i+n-1)in r?r[u]=r[l]:delete r[u];for(i=0;i<a;i++)r[i+o]=arguments[i+2];return r.length=s-n+a,c}});var wk={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xk=Fa("iterator"),fq=Fa("toStringTag"),yk=Gd.values,Zh;for(Zh in wk){var gq=R[Zh],id=gq&&gq.prototype;if(id){if(id[xk]!==yk)try{kb(id,xk,yk)}catch(c){id[xk]=yk}if(id[fq]||kb(id,fq,Zh),wk[Zh])for(var rf in Gd)if(id[rf]!==Gd[rf])try{kb(id,rf,Gd[rf])}catch(c){id[rf]=Gd[rf]}}}var hq=Object.is||function(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e};Bh("search",1,(function(t,e,n){return[function(e){var n=Eb(this),i=null==e?void 0:e[t];return void 0!==i?i.call(e,n):new RegExp(e)[t](String(n))},function(t){var i=n(e,t,this);if(i.done)return i.value;t=Ia(t);var r=String(this);return i=t.lastIndex,hq(i,0)||(t.lastIndex=0),r=ef(t,r),hq(t.lastIndex,i)||(t.lastIndex=i),null===r?-1:r.index}]})),xb((function(t){var e,n;e="undefined"!=typeof self?self:Ya,n=function(t){function e(t){return btoa(t).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(t){return t=(t+="===").slice(0,-t.length%4),atob(t.replace(/-/g,"+").replace(/_/g,"/"))}function i(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}function r(t){return t instanceof ArrayBuffer&&(t=new Uint8Array(t)),String.fromCharCode.apply(String,t)}function s(t){var e={name:(t.name||t||"").toUpperCase().replace("V","v")};switch(e.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":t.length&&(e.length=t.length);break;case"HMAC":t.hash&&(e.hash=s(t.hash)),t.length&&(e.length=t.length);break;case"RSAES-PKCS1-v1_5":t.publicExponent&&(e.publicExponent=new Uint8Array(t.publicExponent)),t.modulusLength&&(e.modulusLength=t.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":t.hash&&(e.hash=s(t.hash)),t.publicExponent&&(e.publicExponent=new Uint8Array(t.publicExponent)),t.modulusLength&&(e.modulusLength=t.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return e}function o(t){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[t.name][(t.hash||{}).name||t.length||""]}function a(t){(t instanceof ArrayBuffer||t instanceof Uint8Array)&&(t=JSON.parse(decodeURIComponent(escape(r(t)))));var e={kty:t.kty,alg:t.alg,ext:t.ext||t.extractable};switch(e.kty){case"oct":e.k=t.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach((function(n){n in t&&(e[n]=t[n])}));break;default:throw new TypeError("Unsupported key type")}return e}function c(t){return t=a(t),_&&(t.extractable=t.ext,delete t.ext),i(unescape(encodeURIComponent(JSON.stringify(t)))).buffer}function l(t){var n=u(t),i=!1;if("1.2.840.113549.1.1.1"!==(2<n.length&&(i=!0,n.shift()),t={ext:!0},n[0][0]))throw new TypeError("Unsupported key type");var s="n e d p q dp dq qi".split(" ");for(n=u(n[1]),i&&n.shift(),i=0;i<n.length;i++)n[i][0]||(n[i]=n[i].subarray(1)),t[s[i]]=e(r(n[i]));return t.kty="RSA",t}function u(t,e){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),e||(e={pos:0,end:t.length}),2>e.end-e.pos||e.end>t.length)throw new RangeError("Malformed DER");var n=t[e.pos++],i=t[e.pos++];if(128<=i){if(i&=127,e.end-e.pos<i)throw new RangeError("Malformed DER");for(var s=0;i--;)s<<=8,s|=t[e.pos++];i=s}if(e.end-e.pos<i)throw new RangeError("Malformed DER");switch(n){case 2:n=t.subarray(e.pos,e.pos+=i);break;case 3:if(t[e.pos++])throw Error("Unsupported bit string");i--;case 4:n=new Uint8Array(t.subarray(e.pos,e.pos+=i)).buffer;break;case 5:n=null;break;case 6:if(!((t=btoa(r(t.subarray(e.pos,e.pos+=i))))in E))throw Error("Unsupported OBJECT ID "+t);n=E[t];break;case 48:for(n=[],i=e.pos+i;e.pos<i;)n.push(u(t,e));break;default:throw Error("Unsupported DER tag 0x"+n.toString(16))}return n}function d(t,e){e||(e=[]);var n=e.length+2;if(e.push(0,0),t instanceof Uint8Array)for(var r=2,s=t.length,o=0;o<s;o++)e.push(t[o]);else if(t instanceof ArrayBuffer)for(r=4,s=t.byteLength,t=new Uint8Array(t),o=0;o<s;o++)e.push(t[o]);else if(null===t)r=5,s=0;else if("string"==typeof t&&t in w)for(r=6,s=(t=i(atob(w[t]))).length,o=0;o<s;o++)e.push(t[o]);else if(t instanceof Array){for(o=0;o<t.length;o++)d(t[o],e);r=48,s=e.length-n}else{if(!("object"===qa(t)&&3===t.tag&&t.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+t);for(r=3,s=(t=new Uint8Array(t.value)).byteLength,e.push(0),o=0;o<s;o++)e.push(t[o]);s++}if(128<=s){for(o=s,s=4,e.splice(n,0,o>>24&255,o>>16&255,o>>8&255,255&o);1<s&&!(o>>24);)o<<=8,s--;4>s&&e.splice(n,4-s),s|=128}return e.splice(n-2,2,r,s),e}function h(t,e,n,i){Object.defineProperties(this,{_key:{value:t},type:{value:t.type,enumerable:!0},extractable:{value:void 0===n?t.extractable:n,enumerable:!0},algorithm:{value:void 0===e?t.algorithm:e,enumerable:!0},usages:{value:void 0===i?t.usages:i,enumerable:!0}})}function A(t){return"verify"===t||"encrypt"===t||"wrapKey"===t}function p(t){return"sign"===t||"decrypt"===t||"unwrapKey"===t}if("function"!=typeof Promise)throw"Promise support required";var f=t.crypto||t.msCrypto;if(f){var m=f.subtle||f.webkitSubtle;if(m){var g=t.Crypto||f.constructor||Object,v=t.SubtleCrypto||m.constructor||Object;t.CryptoKey||t.Key;var y=-1<t.navigator.userAgent.indexOf("Edge/"),_=!!t.msCrypto&&!y,b=!f.subtle&&!!f.webkitSubtle;if(_||b){var E={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},w={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach((function(t){var e=m[t];m[t]=function(r,u,d){var g=[].slice.call(arguments);switch(t){case"generateKey":var v=s(r),y=u,E=d;break;case"importKey":v=s(d),y=g[3],E=g[4],"jwk"===r&&((u=a(u)).alg||(u.alg=o(v)),u.key_ops||(u.key_ops="oct"!==u.kty?"d"in u?E.filter(p):E.filter(A):E.slice()),g[1]=c(u));break;case"unwrapKey":v=g[4],y=g[5],E=g[6],g[2]=d._key}if("generateKey"===t&&"HMAC"===v.name&&v.hash)return v.length=v.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[v.hash.name],m.importKey("raw",f.getRandomValues(new Uint8Array(v.length+7>>3)),v,y,E);if(b&&"generateKey"===t&&"RSASSA-PKCS1-v1_5"===v.name&&(!v.modulusLength||2048<=v.modulusLength))return(r=s(r)).name="RSAES-PKCS1-v1_5",delete r.hash,m.generateKey(r,!0,["encrypt","decrypt"]).then((function(t){return Promise.all([m.exportKey("jwk",t.publicKey),m.exportKey("jwk",t.privateKey)])})).then((function(t){return t[0].alg=t[1].alg=o(v),t[0].key_ops=E.filter(A),t[1].key_ops=E.filter(p),Promise.all([m.importKey("jwk",t[0],v,!0,t[0].key_ops),m.importKey("jwk",t[1],v,y,t[1].key_ops)])})).then((function(t){return{publicKey:t[0],privateKey:t[1]}}));if((b||_&&"SHA-1"===(v.hash||{}).name)&&"importKey"===t&&"jwk"===r&&"HMAC"===v.name&&"oct"===u.kty)return m.importKey("raw",i(n(u.k)),d,g[3],g[4]);if(b&&"importKey"===t&&("spki"===r||"pkcs8"===r))return m.importKey("jwk",l(u),d,g[3],g[4]);if(_&&"unwrapKey"===t)return m.decrypt(g[3],d,u).then((function(t){return m.importKey(r,t,g[4],g[5],g[6])}));try{var w=e.apply(m,g)}catch(t){return Promise.reject(t)}return _&&(w=new Promise((function(t,e){w.onabort=w.onerror=function(t){e(t)},w.oncomplete=function(e){t(e.target.result)}}))),w=w.then((function(t){return"HMAC"!==v.name||v.length||(v.length=8*t.algorithm.length),0==v.name.search("RSA")&&(v.modulusLength||(v.modulusLength=(t.publicKey||t).algorithm.modulusLength),v.publicExponent||(v.publicExponent=(t.publicKey||t).algorithm.publicExponent)),t.publicKey&&t.privateKey?{publicKey:new h(t.publicKey,v,y,E.filter(A)),privateKey:new h(t.privateKey,v,y,E.filter(p))}:new h(t,v,y,E)}))}})),["exportKey","wrapKey"].forEach((function(t){var s=m[t];m[t]=function(c,l,u){var h=[].slice.call(arguments);switch(t){case"exportKey":h[1]=l._key;break;case"wrapKey":h[1]=l._key,h[2]=u._key}if((b||_&&"SHA-1"===(l.algorithm.hash||{}).name)&&"exportKey"===t&&"jwk"===c&&"HMAC"===l.algorithm.name&&(h[0]="raw"),!b||"exportKey"!==t||"spki"!==c&&"pkcs8"!==c||(h[0]="jwk"),_&&"wrapKey"===t)return m.exportKey(c,l).then((function(t){return"jwk"===c&&(t=i(unescape(encodeURIComponent(JSON.stringify(a(t)))))),m.encrypt(h[3],u,t)}));try{var f=s.apply(m,h)}catch(t){return Promise.reject(t)}return _&&(f=new Promise((function(t,e){f.onabort=f.onerror=function(t){e(t)},f.oncomplete=function(e){t(e.target.result)}}))),"exportKey"===t&&"jwk"===c&&(f=f.then((function(t){return(b||_&&"SHA-1"===(l.algorithm.hash||{}).name)&&"HMAC"===l.algorithm.name?{kty:"oct",alg:o(l.algorithm),key_ops:l.usages.slice(),ext:!0,k:e(r(t))}:((t=a(t)).alg||(t.alg=o(l.algorithm)),t.key_ops||(t.key_ops="public"===l.type?l.usages.filter(A):"private"===l.type?l.usages.filter(p):l.usages.slice()),t)}))),!b||"exportKey"!==t||"spki"!==c&&"pkcs8"!==c||(f=f.then((function(t){var e=[["",null]],r=!1;if("RSA"!==(t=a(t)).kty)throw new TypeError("Unsupported key type");for(var s="n e d p q dp dq qi".split(" "),o=[],c=0;c<s.length&&s[c]in t;c++){var l=o[c]=i(n(t[s[c]]));128&l[0]&&(o[c]=new Uint8Array(l.length+1),o[c].set(l,1))}return 2<o.length&&(r=!0,o.unshift(new Uint8Array([0]))),e[0][0]="1.2.840.113549.1.1.1",e.push(new Uint8Array(d(o)).buffer),r?e.unshift(new Uint8Array([0])):e[1]={tag:3,value:e[1]},new Uint8Array(d(e)).buffer}))),f}})),["encrypt","decrypt","sign","verify"].forEach((function(t){var e=m[t];m[t]=function(n,i,r,o){if(_&&(!r.byteLength||o&&!o.byteLength))throw Error("Empty input is not allowed");var a=[].slice.call(arguments),c=s(n);if(!_||"sign"!==t&&"verify"!==t||"RSASSA-PKCS1-v1_5"!==n&&"HMAC"!==n||(a[0]={name:n}),_&&i.algorithm.hash&&(a[0].hash=a[0].hash||i.algorithm.hash),_&&"decrypt"===t&&"AES-GCM"===c.name){var l=n.tagLength>>3;a[2]=(r.buffer||r).slice(0,r.byteLength-l),n.tag=(r.buffer||r).slice(r.byteLength-l)}_&&"AES-GCM"===c.name&&void 0===a[0].tagLength&&(a[0].tagLength=128),a[1]=i._key;try{var u=e.apply(m,a)}catch(t){return Promise.reject(t)}return _&&(u=new Promise((function(e,n){u.onabort=u.onerror=function(t){n(t)},u.oncomplete=function(n){if(n=n.target.result,"encrypt"===t&&n instanceof AesGcmEncryptResult){var i=n.ciphertext,r=n.tag;(n=new Uint8Array(i.byteLength+r.byteLength)).set(new Uint8Array(i),0),n.set(new Uint8Array(r),i.byteLength),n=n.buffer}e(n)}}))),u}})),_){var S=m.digest;m.digest=function(t,e){if(!e.byteLength)throw Error("Empty input is not allowed");try{var n=S.call(m,t,e)}catch(t){return Promise.reject(t)}return n=new Promise((function(t,e){n.onabort=n.onerror=function(t){e(t)},n.oncomplete=function(e){t(e.target.result)}}))},t.crypto=Object.create(f,{getRandomValues:{value:function(t){return f.getRandomValues(t)}},subtle:{value:m}}),t.CryptoKey=h}b&&(f.subtle=m,t.Crypto=g,t.SubtleCrypto=v,t.CryptoKey=h)}}}},t.exports?t.exports=n(e):n(e)})),function(t){t.console||(t.console={}),t=t.console;for(var e,n=function(){},i=["memory"],r="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");e=i.pop();)t[e]||(t[e]={});for(;e=r.pop();)t[e]||(t[e]=n)}("undefined"==typeof window?Ya:window),ea({target:"Object",stat:!0},{setPrototypeOf:tb});var uy=la((function(){uc(1)}));ea({target:"Object",stat:!0,forced:uy,sham:!Oo},{getPrototypeOf:function(t){return uc(pb(t))}});var iq=[].slice,zk={},vy=Function.bind||function(t){var e=Wb(this),n=iq.call(arguments,1),i=function(){var r=n.concat(iq.call(arguments));if(this instanceof i){var s=r.length;if(!(s in zk)){for(var o=[],a=0;a<s;a++)o[a]="a["+a+"]";zk[s]=Function("C,a","return new C("+o.join(",")+")")}r=zk[s](e,r)}else r=e.apply(t,r);return r};return xa(e.prototype)&&(i.prototype=e.prototype),i},Ak=Pc("Reflect","construct"),jq=la((function(){function t(){}return!(Ak((function(){}),[],t)instanceof t)})),kq=!la((function(){Ak((function(){}))})),lq=jq||kq;ea({target:"Reflect",stat:!0,forced:lq,sham:lq},{construct:function(t,e){Wb(t),Ia(e);var n=3>arguments.length?t:Wb(arguments[2]);if(kq&&!jq)return Ak(t,e,n);if(t==n){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}return(n=[null]).push.apply(n,e),new(vy.apply(t,n))}n=n.prototype,n=jc(xa(n)?n:Object.prototype);var i=Function.apply.call(t,n,e);return xa(i)?i:n}}),ea({target:"Reflect",stat:!0},{get:Am});var mq=dc.f,wy=la((function(){mq(1)}));ea({target:"Object",stat:!0,forced:!wa||wy,sham:!wa},{getOwnPropertyDescriptor:function(t,e){return mq(Mb(t),e)}});var nq=de.f,xy={}.toString,oq="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Bk=function(t){if(oq&&"[object Window]"==xy.call(t))try{var e=nq(t)}catch(t){e=oq.slice()}else e=nq(Mb(t));return e},pq={f:Fa},yy=qb.f,$h=function(t){var e=R.Symbol||(R.Symbol={});ka(e,t)||yy(e,t,{value:pq.f(t)})},Nb=xh("hidden"),qq=Fa("toPrimitive"),zy=cb.set,rq=cb.getterFor("Symbol"),kc=Object.prototype,Ob=R.Symbol,yg=Pc("JSON","stringify"),sq=dc.f,Jd=qb.f,tq=Bk,Ay=eg,jd=Ad("symbols"),zg=Ad("op-symbols"),Ck=Ad("string-to-symbol-registry"),Dk=Ad("symbol-to-string-registry"),By=Ad("wks"),Ek=R.QObject,Fk=!Ek||!Ek.prototype||!Ek.prototype.findChild,Gk=wa&&la((function(){return 7!=jc(Jd({},"a",{get:function(){return Jd(this,"a",{value:7}).a}})).a}))?function(t,e,n){var i=sq(kc,e);i&&delete kc[e],Jd(t,e,n),i&&t!==kc&&Jd(kc,e,i)}:Jd,Hk=function(t,e){var n=jd[t]=jc(Ob.prototype);return zy(n,{type:"Symbol",tag:t,description:e}),wa||(n.description=e),n},Ik=zo?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof Ob},ai=function(t,e,n){return t===kc&&ai(zg,e,n),Ia(t),e=Oc(e,!0),Ia(n),ka(jd,e)?(n.enumerable?(ka(t,Nb)&&t[Nb][e]&&(t[Nb][e]=!1),n=jc(n,{enumerable:Nc(0,!1)})):(ka(t,Nb)||Jd(t,Nb,Nc(1,{})),t[Nb][e]=!0),Gk(t,e,n)):Jd(t,e,n)},uq=function(t,e){Ia(t);var n=Mb(e);return e=ed(n).concat(Jk(n)),fe(e,(function(e){wa&&!Kk.call(n,e)||ai(t,e,n[e])})),t},Kk=function(t){t=Oc(t,!0);var e=Ay.call(this,t);return!(this===kc&&ka(jd,t)&&!ka(zg,t))&&(!(e||!ka(this,t)||!ka(jd,t)||ka(this,Nb)&&this[Nb][t])||e)},vq=function(t,e){if(t=Mb(t),e=Oc(e,!0),t!==kc||!ka(jd,e)||ka(zg,e)){var n=sq(t,e);return!n||!ka(jd,e)||ka(t,Nb)&&t[Nb][e]||(n.enumerable=!0),n}},wq=function(t){t=tq(Mb(t));var e=[];return fe(t,(function(t){ka(jd,t)||ka(bf,t)||e.push(t)})),e},Jk=function(t){var e=t===kc;t=tq(e?zg:Mb(t));var n=[];return fe(t,(function(t){!ka(jd,t)||e&&!ka(kc,t)||n.push(jd[t])})),n};if(Sc||(Ob=function(){if(this instanceof Ob)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=af(t),n=function(t){this===kc&&n.call(zg,t),ka(this,Nb)&&ka(this[Nb],e)&&(this[Nb][e]=!1),Gk(this,e,Nc(1,t))};return wa&&Fk&&Gk(kc,e,{configurable:!0,set:n}),Hk(e,t)},Za(Ob.prototype,"toString",(function(){return rq(this).tag})),Za(Ob,"withoutSetter",(function(t){return Hk(af(t),t)})),eg=Kk,qb.f=ai,dc.f=vq,de.f=Bk=wq,gg.f=Jk,pq.f=function(t){return Hk(Fa(t),t)},wa&&(Jd(Ob.prototype,"description",{configurable:!0,get:function(){return rq(this).description}}),Za(kc,"propertyIsEnumerable",Kk,{unsafe:!0}))),ea({global:!0,wrap:!0,forced:!Sc,sham:!Sc},{Symbol:Ob}),fe(ed(By),(function(t){$h(t)})),ea({target:"Symbol",stat:!0,forced:!Sc},{for:function(t){if(t=String(t),ka(Ck,t))return Ck[t];var e=Ob(t);return Ck[t]=e,Dk[e]=t,e},keyFor:function(t){if(!Ik(t))throw TypeError(t+" is not a symbol");if(ka(Dk,t))return Dk[t]},useSetter:function(){Fk=!0},useSimple:function(){Fk=!1}}),ea({target:"Object",stat:!0,forced:!Sc,sham:!wa},{create:function(t,e){return void 0===e?jc(t):uq(jc(t),e)},defineProperty:ai,defineProperties:uq,getOwnPropertyDescriptor:vq}),ea({target:"Object",stat:!0,forced:!Sc},{getOwnPropertyNames:wq,getOwnPropertySymbols:Jk}),ea({target:"Object",stat:!0,forced:la((function(){gg.f(1)}))},{getOwnPropertySymbols:function(t){return gg.f(pb(t))}}),yg){var Cy=!Sc||la((function(){var t=Ob();return"[null]"!=yg([t])||"{}"!=yg({a:t})||"{}"!=yg(Object(t))}));ea({target:"JSON",stat:!0,forced:Cy},{stringify:function(t,e,n){for(var i,r=[t],s=1;arguments.length>s;)r.push(arguments[s++]);if(i=e,(xa(e)||void 0!==t)&&!Ik(t))return Ed(e)||(e=function(t,e){if("function"==typeof i&&(e=i.call(this,t,e)),!Ik(e))return e}),r[1]=e,yg.apply(null,r)}})}Ob.prototype[qq]||kb(Ob.prototype,qq,Ob.prototype.valueOf),zc(Ob,"Symbol"),bf[Nb]=!0;var Dy=qb.f,kd=R.Symbol;if(wa&&"function"==typeof kd&&(!("description"in kd.prototype)||void 0!==kd().description)){var xq={},Ag=function(){var t=1>arguments.length||void 0===arguments[0]?void 0:String(arguments[0]),e=this instanceof Ag?new kd(t):void 0===t?kd():kd(t);return""===t&&(xq[e]=!0),e};to(Ag,kd);var Lk=Ag.prototype=kd.prototype;Lk.constructor=Ag;var Ey=Lk.toString,Fy="Symbol(test)"==String(kd("test")),Gy=/^Symbol\((.*)\)[^)]+$/;Dy(Lk,"description",{configurable:!0,get:function(){var t=xa(this)?this.valueOf():this,e=Ey.call(t);return ka(xq,t)?"":""===(t=Fy?e.slice(7,-1):e.replace(Gy,"$1"))?void 0:t}}),ea({global:!0,forced:!0},{Symbol:Ag})}$h("toStringTag"),zc(R.JSON,"JSON",!0),zc(Math,"Math",!0),function(){function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function n(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}function i(t){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function r(t,e){return(r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function o(t,e,n){return(o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=i(t)););if(t)return(e=Object.getOwnPropertyDescriptor(t,e)).get?e.get.call(n):e.value})(t,e,n||t)}var a=function(){function e(){t(this,e),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(e,[{key:"addEventListener",value:function(t,e,n){t in this.listeners||(this.listeners[t]=[]),this.listeners[t].push({callback:e,options:n})}},{key:"removeEventListener",value:function(t,e){if(t in this.listeners)for(var n=0,i=(t=this.listeners[t]).length;n<i;n++)if(t[n].callback===e){t.splice(n,1);break}}},{key:"dispatchEvent",value:function(t){if(t.type in this.listeners){for(var e=this.listeners[t.type].slice(),n=0,i=e.length;n<i;n++){var r=e[n];try{r.callback.call(this,t)}catch(t){Promise.resolve().then((function(){throw t}))}r.options&&r.options.once&&this.removeEventListener(t.type,r.callback)}return!t.defaultPrevented}}}]),e}(),c=function(e){function c(){t(this,c);var e=l.call(this);return e.listeners||a.call(s(e)),Object.defineProperty(s(e),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(s(e),"onabort",{value:null,writable:!0,configurable:!0}),e}!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}(c,e);var l=function(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n=i(t);if(e){var r=i(this).constructor;n=Reflect.construct(n,arguments,r)}else n=n.apply(this,arguments);return!n||"object"!==qa(n)&&"function"!=typeof n?s(this):n}}(c);return n(c,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(t){"abort"===t.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,t)),o(i(c.prototype),"dispatchEvent",this).call(this,t)}}]),c}(a),l=function(){function e(){t(this,e),Object.defineProperty(this,"signal",{value:new c,writable:!0,configurable:!0})}return n(e,[{key:"abort",value:function(){try{var t=new Event("abort")}catch(e){"undefined"!=typeof document?document.createEvent?(t=document.createEvent("Event")).initEvent("abort",!1,!1):(t=document.createEventObject()).type="abort":t={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(t)}},{key:"toString",value:function(){return"[object AbortController]"}}]),e}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(l.prototype[Symbol.toStringTag]="AbortController",c.prototype[Symbol.toStringTag]="AbortSignal"),function(t){if(t.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var e=!0}else e="function"==typeof t.Request&&!t.Request.prototype.hasOwnProperty("signal")||!t.AbortController;e&&(t.AbortController=l,t.AbortSignal=c)}("undefined"!=typeof self?self:Ya)}();var Hy=Math.floor,Iy=Math.log,Jy=Math.LOG2E;ea({target:"Math",stat:!0},{clz32:function(t){return(t>>>=0)?31-Hy(Iy(t+.5)*Jy):32}});var Ky=Math.log,Ly=Math.LN2,cu=Math.clz32||function(t){return 31-Ky(t>>>0)/Ly|0},Ud=String.fromCharCode,yq={}.toString,Mk=window.Uint8Array,Nk=Mk||Array,My=yq.call((window.ArrayBuffer||Nk).prototype),Ok;Bm.prototype.decode=function(t){if(t=t&&t.buffer||t,yq.call(t)!==My)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var e="",n=0,i=0|(t=Mk?new Nk(t):t).length;n<i;n=n+32768|0)e+=Ud.apply(0,t[Mk?"slice":"subarray"](n,n+32768|0));return e.replace(/[\xc0-\xff][\x80-\xbf]*/g,bu)},window.TextDecoder||(window.TextDecoder=Bm),Cm.prototype.encode=function(t){for(var e=0|(t=void 0===t?"":(""+t).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,du)).length,n=new Nk(e),i=0;i<e;i=i+1|0)n[i]=t.charCodeAt(i);return n},window.TextEncoder||(window.TextEncoder=Cm),function(t){var e,n,i,r,s,o,a,c,l,u,d,h;(n=e||(e={})).LOGIN="LOGIN",n.LOGIN_SUCCESS="LOGIN_SUCCESS",n.LOGIN_FAILURE="LOGIN_FAILURE",n.LOGIN_TIMEOUT="LOGIN_TIMEOUT",n.INTERRUPTED="INTERRUPTED",n.LOGOUT="LOGOUT",n.BANNED_BY_SERVER="BANNED_BY_SERVER",n.REMOTE_LOGIN="REMOTE_LOGIN",n.TOKEN_EXPIRED="TOKEN_EXPIRED",t.ConnectionChangeReason=e,function(t){t.DISCONNECTED="DISCONNECTED",t.CONNECTING="CONNECTING",t.CONNECTED="CONNECTED",t.RECONNECTING="RECONNECTING",t.ABORTED="ABORTED"}(i||(i={})),t.ConnectionState=i,function(t){t.IDLE="IDLE",t.SENT_TO_REMOTE="SENT_TO_REMOTE",t.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",t.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",t.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",t.CANCELED="CANCELED",t.FAILURE="FAILURE"}(r||(r={})),t.LocalInvitationState=r,function(t){t.INVITATION_RECEIVED="INVITATION_RECEIVED",t.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",t.REFUSED="REFUSED",t.ACCEPTED="ACCEPTED",t.CANCELED="CANCELED",t.FAILURE="FAILURE"}(s||(s={})),t.RemoteInvitationState=s,function(t){t.UNKNOWN="UNKNOWN",t.PEER_NO_RESPONSE="PEER_NO_RESPONSE",t.INVITATION_EXPIRE="INVITATION_EXPIRE",t.PEER_OFFLINE="PEER_OFFLINE",t.NOT_LOGGEDIN="NOT_LOGGEDIN"}(o||(o={})),t.LocalInvitationFailureReason=o,function(t){t.UNKNOWN="UNKNOWN",t.PEER_OFFLINE="PEER_OFFLINE",t.ACCEPT_FAILURE="ACCEPT_FAILURE",t.INVITATION_EXPIRE="INVITATION_EXPIRE"}(a||(a={})),t.RemoteInvitationFailureReason=a,function(t){t.ONLINE="ONLINE",t.UNREACHABLE="UNREACHABLE",t.OFFLINE="OFFLINE"}(c||(c={})),t.PeerOnlineState=c,(l||(l={})).ONLINE_STATUS="ONLINE_STATUS",t.PeerSubscriptionOption=l,function(t){t.TEXT="TEXT",t.RAW="RAW"}(u||(u={})),t.MessageType=u,function(t){t.CN="CN",t.NA="NA",t.EU="EU",t.AS="AS",t.JP="JP",t.IN="IN",t.GLOB="GLOB",t.OC="OC",t.SA="SA",t.AF="AF",t.OVS="OVS"}(d||(d={})),t.LegacyAreaCode=d,function(t){t.GLOBAL="GLOBAL",t.INDIA="INDIA",t.JAPAN="JAPAN",t.ASIA="ASIA",t.EUROPE="EUROPE",t.CHINA="CHINA",t.NORTH_AMERICA="NORTH_AMERICA"}(h||(h={})),t.AreaCode=h}(Ok||(Ok={}));var ta=Ok;ea({target:"Array",proto:!0},{includes:function(t){return qo(this,t,1<arguments.length?arguments[1]:void 0)}}),ng("includes");var Pk=function(t){if(Lj(t))throw TypeError("The method doesn't accept regular expressions");return t},Ny=Fa("match"),Qk=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[Ny]=!1,"/./"[t](e)}catch(t){}}return!1};ea({target:"String",proto:!0,forced:!Qk("includes")},{includes:function(t){return!!~String(Eb(this)).indexOf(Pk(t),1<arguments.length?arguments[1]:void 0)}});var Ec={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0,ENABLE_EDGE_AUTO_FALLBACK:!0};$h("iterator"),$h("asyncIterator");var Rk=ff("forEach")?[].forEach:function(t){return fe(this,t,1<arguments.length?arguments[1]:void 0)},zq;for(zq in wk){var Aq=R[zq],bi=Aq&&Aq.prototype;if(bi&&bi.forEach!==Rk)try{kb(bi,"forEach",Rk)}catch(c){bi.forEach=Rk}}var Oy=[].reverse,Bq=[1,2];ea({target:"Array",proto:!0,forced:String(Bq)===String(Bq.reverse())},{reverse:function(){return Ed(this)&&(this.length=this.length),Oy.call(this)}});var N=xb((function(t){t=function(t){function e(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}function n(t,e,n,s){return e=Object.create((e&&e.prototype instanceof r?e:r).prototype),s=new h(s||[]),e._invoke=function(t,e,n){var r=E;return function(s,o){if(r===S)throw Error("Generator is already running");if(r===T){if("throw"===s)throw o;return p()}for(n.method=s,n.arg=o;;){if((s=n.delegate)&&(s=l(s,n))){if(s===C)continue;return s}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===E)throw r=T,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);if(r=S,"normal"===(s=i(t,e,n)).type){if(r=n.done?T:w,s.arg===C)continue;return{value:s.arg,done:n.done}}"throw"===s.type&&(r=T,n.method="throw",n.arg=s.arg)}}}(t,n,s),e}function i(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function r(){}function s(){}function o(){}function a(t){["next","throw","return"].forEach((function(n){e(t,n,(function(t){return this._invoke(n,t)}))}))}function c(t,e){function n(r,s,o,a){if("throw"!==(r=i(t[r],t,s)).type){var c=r.arg;return(r=c.value)&&"object"===qa(r)&&g.call(r,"__await")?e.resolve(r.__await).then((function(t){n("next",t,o,a)}),(function(t){n("throw",t,o,a)})):e.resolve(r).then((function(t){c.value=t,o(c)}),(function(t){return n("throw",t,o,a)}))}a(r.arg)}var r;this._invoke=function(t,i){function s(){return new e((function(e,r){n(t,i,e,r)}))}return r=r?r.then(s,s):s()}}function l(t,e){var n=t.iterator[e.method];if(n===f){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=f,l(t,e),"throw"===e.method))return C;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return C}return"throw"===(n=i(n,t.iterator,e.arg)).type?(e.method="throw",e.arg=n.arg,e.delegate=null,C):(n=n.arg)?n.done?(e[t.resultName]=n.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=f),e.delegate=null,C):n:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,C)}function u(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function d(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function h(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(u,this),this.reset(!0)}function A(t){if(t){var e=t[y];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1;return(e=function e(){for(;++n<t.length;)if(g.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=f,e.done=!0,e}).next=e}}return{next:p}}function p(){return{value:f,done:!0}}var f,m=Object.prototype,g=m.hasOwnProperty,v="function"==typeof Symbol?Symbol:{},y=v.iterator||"@@iterator",_=v.asyncIterator||"@@asyncIterator",b=v.toStringTag||"@@toStringTag";try{e({},"")}catch(t){e=function(t,e,n){return t[e]=n}}t.wrap=n;var E="suspendedStart",w="suspendedYield",S="executing",T="completed",C={};e(v={},y,(function(){return this}));var R=Object.getPrototypeOf;(R=R&&R(R(A([]))))&&R!==m&&g.call(R,y)&&(v=R);var I=o.prototype=r.prototype=Object.create(v);return s.prototype=o,e(I,"constructor",o),e(o,"constructor",s),s.displayName=e(o,b,"GeneratorFunction"),t.isGeneratorFunction=function(t){return!!(t="function"==typeof t&&t.constructor)&&(t===s||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,o):(t.__proto__=o,e(t,b,"GeneratorFunction")),t.prototype=Object.create(I),t},t.awrap=function(t){return{__await:t}},a(c.prototype),e(c.prototype,_,(function(){return this})),t.AsyncIterator=c,t.async=function(e,i,r,s,o){void 0===o&&(o=Promise);var a=new c(n(e,i,r,s),o);return t.isGeneratorFunction(i)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},a(I),e(I,b,"Generator"),e(I,y,(function(){return this})),e(I,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e,n=[];for(e in t)n.push(e);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},t.values=A,h.prototype={constructor:h,reset:function(t){if(this.next=this.prev=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(d),!t)for(var e in this)"t"===e.charAt(0)&&g.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=f)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function e(e,i){return s.type="throw",s.arg=t,n.next=e,i&&(n.method="next",n.arg=f),!!i}if(this.done)throw t;for(var n=this,i=this.tryEntries.length-1;0<=i;--i){var r=this.tryEntries[i],s=r.completion;if("root"===r.tryLoc)return e("end");if(r.tryLoc<=this.prev){var o=g.call(r,"catchLoc"),a=g.call(r,"finallyLoc");if(o&&a){if(this.prev<r.catchLoc)return e(r.catchLoc,!0);if(this.prev<r.finallyLoc)return e(r.finallyLoc)}else if(o){if(this.prev<r.catchLoc)return e(r.catchLoc,!0)}else{if(!a)throw Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return e(r.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&g.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var r=i;break}}return r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null),(n=r?r.completion:{}).type=t,n.arg=e,r?(this.method="next",this.next=r.finallyLoc,C):this.complete(n)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),C},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),d(n),C}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var n=this.tryEntries[e];if(n.tryLoc===t){if("throw"===(t=n.completion).type){var i=t.arg;d(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=f),C}},t}(t.exports);try{regeneratorRuntime=t}catch(e){"object"===("undefined"==typeof globalThis?"undefined":qa(globalThis))?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})),Cq=!la((function(){return Object.isExtensible(Object.preventExtensions({}))})),Sk=xb((function(t){var e=qb.f,n=af("meta"),i=0,r=Object.isExtensible||function(){return!0},s=function(t){e(t,n,{value:{objectID:"O"+ ++i,weakData:{}}})},o=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!xa(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!ka(t,n)){if(!r(t))return"F";if(!e)return"E";s(t)}return t[n].objectID},getWeakData:function(t,e){if(!ka(t,n)){if(!r(t))return!0;if(!e)return!1;s(t)}return t[n].weakData},onFreeze:function(t){return Cq&&o.REQUIRED&&r(t)&&!ka(t,n)&&s(t),t}};bf[n]=!0})),Dq=function(t,e,n){var i=-1!==t.indexOf("Map"),r=-1!==t.indexOf("Weak"),s=i?"set":"add",o=R[t],a=o&&o.prototype,c=o,l={},u=function(t){var e=a[t];Za(a,t,"add"==t?function(t){return e.call(this,0===t?0:t),this}:"delete"==t?function(t){return!(r&&!xa(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return r&&!xa(t)?void 0:e.call(this,0===t?0:t)}:"has"==t?function(t){return!(r&&!xa(t))&&e.call(this,0===t?0:t)}:function(t,n){return e.call(this,0===t?0:t,n),this})};if(Qc(t,"function"!=typeof o||!(r||a.forEach&&!la((function(){(new o).entries().next()})))))c=n.getConstructor(e,t,i,s),Sk.REQUIRED=!0;else if(Qc(t,!0)){var d=new c,h=d[s](r?{}:-0,1)!=d,A=la((function(){d.has(1)})),p=Eh((function(t){new o(t)})),f=!r&&la((function(){for(var t=new o,e=5;e--;)t[s](e,e);return!t.has(-0)}));p||((c=e((function(e,n){return Ac(e,c,t),e=Wh(new o,e,c),null!=n&&Jh(n,e[s],{that:e,AS_ENTRIES:i}),e}))).prototype=a,a.constructor=c),(A||f)&&(u("delete"),u("has"),i&&u("get")),(f||h)&&u(s),r&&a.clear&&delete a.clear}return l[t]=c,ea({global:!0,forced:c!=o},l),zc(c,t),r||n.setStrong(c,t,i),c},Py=qb.f,Eq=Sk.fastKey,Fq=cb.set,Tk=cb.getterFor,Gq={getConstructor:function(t,e,n,i){var r=t((function(t,s){Ac(t,r,e),Fq(t,{type:e,index:jc(null),first:void 0,last:void 0,size:0}),wa||(t.size=0),null!=s&&Jh(s,t[i],{that:t,AS_ENTRIES:n})})),s=Tk(e),o=function(t,e,n){var i,r=s(t),o=a(t,e);return o?o.value=n:(r.last=o={index:i=Eq(e,!0),key:e,value:n,previous:e=r.last,next:void 0,removed:!1},r.first||(r.first=o),e&&(e.next=o),wa?r.size++:t.size++,"F"!==i&&(r.index[i]=o)),t},a=function(t,e){t=s(t);var n=Eq(e);if("F"!==n)return t.index[n];for(t=t.first;t;t=t.next)if(t.key==e)return t};return kf(r.prototype,{clear:function(){for(var t=s(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,wa?t.size=0:this.size=0},delete:function(t){var e=s(this);if(t=a(this,t)){var n=t.next,i=t.previous;delete e.index[t.index],t.removed=!0,i&&(i.next=n),n&&(n.previous=i),e.first==t&&(e.first=n),e.last==t&&(e.last=i),wa?e.size--:this.size--}return!!t},forEach:function(t){for(var e,n=s(this),i=Dd(t,1<arguments.length?arguments[1]:void 0,3);e=e?e.next:n.first;)for(i(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!a(this,t)}}),kf(r.prototype,n?{get:function(t){return(t=a(this,t))&&t.value},set:function(t,e){return o(this,0===t?0:t,e)}}:{add:function(t){return o(this,t=0===t?0:t,t)}}),wa&&Py(r.prototype,"size",{get:function(){return s(this).size}}),r},setStrong:function(t,e,n){var i=e+" Iterator",r=Tk(e),s=Tk(i);Wj(t,e,(function(t,e){Fq(this,{type:i,target:t,state:r(t),kind:e,last:void 0})}),(function(){for(var t=s(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),og(e)}};Dq("Set",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Gq);var Uk=Pc("Reflect","apply"),Qy=Function.apply,Ry=!la((function(){Uk((function(){}))}));ea({target:"Reflect",stat:!0,forced:Ry},{apply:function(t,e,n){return Wb(t),Ia(n),Uk?Uk(t,e,n):Qy.call(t,e,n)}}),ea({target:"Reflect",stat:!0},{ownKeys:so});var Hq=Fa("isConcatSpreadable"),Sy=51<=Cd||!la((function(){var t=[];return t[Hq]=!1,t.concat()[0]!==t})),Ty=kg("concat");ea({target:"Array",proto:!0,forced:!Sy||!Ty},{concat:function(t){var e,n=pb(this),i=Dh(n,0),r=0,s=-1;for(e=arguments.length;s<e;s++){var o=-1===s?n:arguments[s],a=o;if(xa(a)){var c=a[Hq];a=void 0!==c?!!c:Ed(a)}else a=!1;if(a){if(9007199254740991<r+(c=Ma(o.length)))throw TypeError("Maximum allowed index exceeded");for(a=0;a<c;a++,r++)a in o&&hf(i,r,o[a])}else{if(9007199254740991<=r)throw TypeError("Maximum allowed index exceeded");hf(i,r++,o)}}return i.length=r,i}});var Uy=Bk,Vy=la((function(){return!Object.getOwnPropertyNames(1)}));ea({target:"Object",stat:!0,forced:Vy},{getOwnPropertyNames:Uy});var Wy=de.f,Xy=dc.f,Yy=qb.f,Kd=R.Number,ci=Kd.prototype,Zy="Number"==xc(jc(ci)),Iq=function(t){var e,n=Oc(t,!1);if("string"==typeof n&&2<n.length)if(43===(t=(n=Oj(n)).charCodeAt(0))||45===t){if(88===(t=n.charCodeAt(2))||120===t)return NaN}else if(48===t){switch(n.charCodeAt(1)){case 66:case 98:t=2;var i=49;break;case 79:case 111:t=8,i=55;break;default:return+n}var r=(n=n.slice(2)).length;for(e=0;e<r;e++){var s=n.charCodeAt(e);if(48>s||s>i)return NaN}return parseInt(n,t)}return+n};if(Qc("Number",!Kd(" 0o1")||!Kd("0b1")||Kd("+0x1"))){for(var le=function(t){var e=1>arguments.length?0:t,n=this;return n instanceof le&&(Zy?la((function(){ci.valueOf.call(n)})):"Number"!=xc(n))?Wh(new Kd(Iq(e)),n,le):Iq(e)},Jq=wa?Wy(Kd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),Vk=0,di;Jq.length>Vk;Vk++)ka(Kd,di=Jq[Vk])&&!ka(le,di)&&Yy(le,di,Xy(Kd,di));le.prototype=ci,ci.constructor=le,Za(R,"Number",le)}var sf="object"===("undefined"==typeof Reflect?"undefined":qa(Reflect))?Reflect:null,Kq=sf&&"function"==typeof sf.apply?sf.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)},$y=sf&&"function"==typeof sf.ownKeys?sf.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)},Lq=Number.isNaN||function(t){return t!=t};Ba.EventEmitter=Ba,Ba.prototype._events=void 0,Ba.prototype._eventsCount=0,Ba.prototype._maxListeners=void 0;var Mq=10;Object.defineProperty(Ba,"defaultMaxListeners",{enumerable:!0,get:function(){return Mq},set:function(t){if("number"!=typeof t||0>t||Lq(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Mq=t}}),Ba.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ba.prototype.setMaxListeners=function(t){if("number"!=typeof t||0>t||Lq(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},Ba.prototype.getMaxListeners=function(){return void 0===this._maxListeners?Ba.defaultMaxListeners:this._maxListeners},Ba.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);n="error"===t;var i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var r;if(0<e.length&&(r=e[0]),r instanceof Error)throw r;throw(e=Error("Unhandled error."+(r?" ("+r.message+")":""))).context=r,e}if(void 0===(n=i[t]))return!1;if("function"==typeof n)Kq(n,this,e);else for(i=Gm(n,r=n.length),n=0;n<r;++n)Kq(i[n],this,e);return!0},Ba.prototype.addListener=function(t,e){return Dm(this,t,e,!1)},Ba.prototype.on=Ba.prototype.addListener,Ba.prototype.prependListener=function(t,e){return Dm(this,t,e,!0)},Ba.prototype.once=function(t,e){return Wg(e),this.on(t,Em(this,t,e)),this},Ba.prototype.prependOnceListener=function(t,e){return Wg(e),this.prependListener(t,Em(this,t,e)),this},Ba.prototype.removeListener=function(t,e){var n;Wg(e);var i=this._events;if(void 0===i)return this;var r=i[t];if(void 0===r)return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete i[t],i.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){var s=-1;for(n=r.length-1;0<=n;n--)if(r[n]===e||r[n].listener===e){var o=r[n].listener;s=n;break}if(0>s)return this;if(0===s)r.shift();else{for(;s+1<r.length;s++)r[s]=r[s+1];r.pop()}1===r.length&&(i[t]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",t,o||e)}return this},Ba.prototype.off=Ba.prototype.removeListener,Ba.prototype.removeAllListeners=function(t){var e=this._events;if(void 0===e)return this;if(void 0===e.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==e[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete e[t]),this;if(0===arguments.length){var n=Object.keys(e);for(e=0;e<n.length;++e){var i=n[e];"removeListener"!==i&&this.removeAllListeners(i)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=e[t]))this.removeListener(t,n);else if(void 0!==n)for(e=n.length-1;0<=e;e--)this.removeListener(t,n[e]);return this},Ba.prototype.listeners=function(t){return Fm(this,t,!0)},Ba.prototype.rawListeners=function(t){return Fm(this,t,!1)},Ba.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):Hm.call(t,e)},Ba.prototype.listenerCount=Hm,Ba.prototype.eventNames=function(){return 0<this._eventsCount?$y(this._events):[]},Ba.once=function(t,e){return new Promise((function(n,i){function r(n){t.removeListener(e,s),i(n)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",r),n([].slice.call(arguments))}Im(t,e,s,{once:!0}),"error"!==e&&fu(t,r,{once:!0})}))};var tf=Object.assign,Nq=Object.defineProperty,Bg=!tf||la((function(){if(wa&&1!==tf({b:1},tf(Nq({},"a",{enumerable:!0,get:function(){Nq(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=tf({},t)[n]||"abcdefghijklmnopqrst"!=ed(tf({},e)).join("")}))?function(t,e){for(var n=pb(t),i=arguments.length,r=1,s=gg.f,o=eg;i>r;)for(var a,c=fg(arguments[r++]),l=s?ed(c).concat(s(c)):ed(c),u=l.length,d=0;u>d;)a=l[d++],(!wa||o.call(c,a))&&(n[a]=c[a]);return n}:tf;ea({target:"Object",stat:!0,forced:Object.assign!==Bg},{assign:Bg}),Dq("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),Gq);var az=Math.log,bz=Math.LN2;ea({target:"Math",stat:!0},{log2:function(t){return az(t)/bz}});var cz=qb.f,dz=de.f,ez=cb.enforce,fz=Fa("match"),Vc=R.RegExp,Wk=Vc.prototype,Cg=/a/g,Xk=/a/g,Yk=new Vc(Cg)!==Cg;if(wa&&Qc("RegExp",!Yk||Rc||la((function(){return Xk[fz]=!1,Vc(Cg)!=Cg||Vc(Xk)==Xk||"/a/i"!=Vc(Cg,"i")})))){for(var ld=function(t,e){var n,i=this instanceof ld,r=Lj(t),s=void 0===e;return!i&&r&&t.constructor===ld&&s||(Yk?r&&!s&&(t=t.source):t instanceof ld&&(s&&(e=Gj.call(t)),t=t.source),Rc&&(n=!!e&&-1<e.indexOf("y"))&&(e=e.replace(/y/g,"")),t=Wh(Yk?new Vc(t,e):Vc(t,e),i?this:Wk,ld),Rc&&n&&(ez(t).sticky=!0)),t},gz=function(t){t in ld||cz(ld,t,{configurable:!0,get:function(){return Vc[t]},set:function(e){Vc[t]=e}})},Oq=dz(Vc),Pq=0;Oq.length>Pq;)gz(Oq[Pq++]);Wk.constructor=ld,ld.prototype=Wk,Za(R,"RegExp",ld)}og("RegExp"),xg("Float32",(function(t){return function(e,n,i){return t(this,e,n,i)}})),xg("Float64",(function(t){return function(e,n,i){return t(this,e,n,i)}})),xg("Uint32",(function(t){return function(e,n,i){return t(this,e,n,i)}})),xg("Uint16",(function(t){return function(e,n,i){return t(this,e,n,i)}}));var Zk=function(t,e){return t===e?0:null==t?null==e?0:-1:null==e?null==t?0:1:"function"==typeof t.compare?t.compare(e):"function"==typeof e.compare?-e.compare(t):t<e?-1:t>e?1:0},$k=[],Qq=$k.sort,hz=la((function(){$k.sort(void 0)})),iz=la((function(){$k.sort(null)})),jz=ff("sort");ea({target:"Array",proto:!0,forced:hz||!iz||!jz},{sort:function(t){return void 0===t?Qq.call(pb(this)):Qq.call(pb(this),Wb(t))}});var Rq=Object.getPrototypeOf({}),Dg=function(t,e){var n;return t===e||(null==t?t==e:"function"===qa(t.equiv)?t.equiv(e):null==e?t==e:"function"===qa(e.equiv)?e.equiv(t):"string"!==qa(t)&&"string"!==qa(e)&&(null!=(n=Object.getPrototypeOf(t))&&n!==Rq||null!=(n=Object.getPrototypeOf(e))&&n!==Rq?"function"!==qa(t)&&void 0!==t.length&&"function"!==qa(e)&&void 0!==e.length?lz(t,e):t instanceof Set&&e instanceof Set?mz(t,e):t instanceof Map&&e instanceof Map?nz(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!=t&&e!=e:kz(t,e)))},lz=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Dg,i=t.length;if(i===e.length)for(;0<=--i&&n(t[i],e[i]););return 0>i},mz=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Dg;return t.size===e.size&&n(Z(t.keys()).sort(),Z(e.keys()).sort())},nz=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Dg;return t.size===e.size&&n(Z(t).sort(),Z(e).sort())},kz=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Dg;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(var i in t)if(!e.hasOwnProperty(i)||!n(t[i],e[i]))return!1;return!0},Sq=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(t){return void 0!==t?": "+t:""};return function(n){function i(n){return va(this,i),r.call(this,t(n)+e(n))}Ga(i,n);var r=Ha(i);return i}(Kf(Error))},oz=Sq((function(){return"illegal argument(s)"})),ei=function(t){throw new oz(t)},al=Sq((function(){return"index out of bounds"})),Tq=1/4294967295,pz=function(){function t(){va(this,t)}return eb(t,[{key:"float",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.int()*Tq*t}},{key:"norm",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(this.int()*Tq-.5)*t}},{key:"minmax",value:function(t,e){return this.float()*(e-t)+t}}]),t}(),bl=Math.random,qz=new(function(t){function e(){return va(this,e),n.apply(this,arguments)}Ga(e,t);var n=Ha(e);return eb(e,[{key:"int",value:function(){return 4294967296*bl()>>>0}},{key:"float",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return bl()*t}},{key:"norm",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(bl()-.5)*t}}]),e}(pz)),Ni=Symbol(),Lm=function(){},rz=Sk.onFreeze,cl=Object.freeze,sz=la((function(){cl(1)}));ea({target:"Object",stat:!0,forced:sz,sham:!Cq},{freeze:function(t){return cl&&xa(t)?cl(rz(t)):t}});var tz=ff("reduce"),uz=!fd&&79<Cd&&83>Cd;ea({target:"Array",proto:!0,forced:!tz||uz},{reduce:function(t){return $p(this,t,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Km=function(t){return null!=t&&"function"==typeof t.xform?t.xform():t},Xg=function(){function t(e){va(this,t),this.value=e}return eb(t,[{key:"deref",value:function(){return this.value}}]),t}(),Oi=function(t){return t instanceof Xg?t.deref():t},hu=function(t,e){return[t,function(t){return t},e]},vz=N.mark((function(t,e){var n,i,r,s,o,a;return N.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=Km(t)(gu()),i=n[1],r=n[2],s=0;case 4:if(!(s<e.length)){c.next=15;break}if(o=e[s],!((a=r([],o))instanceof Xg)){c.next=10;break}return c.delegateYield(Oi(i(a.deref())),"t0",9);case 9:return c.abrupt("return");case 10:if(!a.length){c.next=12;break}return c.delegateYield(a,"t1",12);case 12:s++,c.next=4;break;case 15:return c.delegateYield(Oi(i([])),"t2",16);case 16:case"end":return c.stop()}}),vz)})),iu=N.mark(Jm),ju=function(t,e){return[t[0],t[1],e]},wz=function(){function t(e){va(this,t),this._length=0,e&&this.into(e)}return eb(t,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new t(this)}},{key:"empty",value:function(){return new t}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var t,e=this.head;e;)t=e.next,delete e.value,delete e.prev,delete e.next,e=t;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(t){var e=this._length;if(e<t._length)return-1;if(e>t._length)return 1;if(0===e)return 0;e=this.head,t=t.head;for(var n=0;e&&0==n;)n=Zk(e.value,t.value),e=e.next,t=t.next;return n}},{key:"equiv",value:function(e){if(!(e instanceof t||null!=e&&"function"!=typeof e&&void 0!==e.length)||this._length!==e.length)return!1;if(!this._length||this===e)return!0;for(var n=this.head,i=0;i<e.length;i++){if(!Dg(n.value,e[i]))return!1;n=n.next}return!0}},{key:Symbol.iterator,value:N.mark((function t(){var e;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e=this.head;case 1:if(!e){t.next=7;break}return t.next=4,e.value;case 4:e=e.next,t.next=1;break;case 7:case"end":return t.stop()}}),t,this)}))},{key:"seq",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;if(!(t>=e||0>t)){t=this.nthCell(t);var n=this.nthCell(e-1);return e=function t(e){return{first:function(){return e.value},next:function(){return e!==n&&e.next?t(e.next):void 0}}},t?e(t):void 0}}},{key:"cycle",value:N.mark((function t(){return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.delegateYield(this,"t0",2);case 2:t.next=0;break;case 4:case"end":return t.stop()}}),t,this)}))},{key:"$reduce",value:function(t,e){for(var n=this.head;n&&!(e instanceof Xg);)e=t(e,n.value),n=n.next;return e}},{key:"drop",value:function(){var t=this.head;if(t)return(this.head=t.next)?delete this.head.prev:delete this.tail,this._length--,t.value}},{key:"cons",value:function(t){return t={value:t,next:this.head},this.head?this.head.prev=t:this.tail=t,this.head=t,this._length++,this}},{key:"insertBefore",value:function(t,e){return t||ei("cell is undefined"),e={value:e,next:t,prev:t.prev},t.prev?t.prev.next=e:this.head=e,t.prev=e,this._length++,this}},{key:"insertAfter",value:function(t,e){return t||ei("cell is undefined"),e={value:e,next:t.next,prev:t},t.next?t.next.prev=e:this.tail=e,t.next=e,this._length++,this}},{key:"insertBeforeNth",value:function(t,e){if(0>t&&(t+=this._length),0>=t)return this.cons(e);if(0>t||t>=this._length)throw new al(t);return this.insertBefore(this.nthCellUnsafe(t),e)}},{key:"insertAfterNth",value:function(t,e){if(0>t&&(t+=this._length),t>=this._length-1)return this.push(e);if(0>t||t>=this._length)throw new al(t);return this.insertAfter(this.nthCellUnsafe(t),e)}},{key:"insertSorted",value:function(t,e){e=e||Zk;for(var n=this.head;n;){if(0>=e(t,n.value))return this.insertBefore(n,t);n=n.next}return this.push(t)}},{key:"find",value:function(t){for(var e=this.head;e;){if(e.value===t)return e;e=e.next}}},{key:"findWith",value:function(t){for(var e=this.head;e;){if(t(e.value))return e;e=e.next}}},{key:"concat",value:function(){for(var t=this.copy(),e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];for(e=0;e<n.length;e++)t.into(n[e]);return t}},{key:"into",value:function(t){for(var e=0;e<t.length;e++)this.push(t[e])}},{key:"slice",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;e=0>e?e+this._length:e,n=0>n?n+this._length:n,(0>e||0>n)&&ei("invalid indices: ${from} / ${to}");for(var i=new t,r=this.nthCell(e);r&&++e<=n;)i.push(r.value),r=r.next;return i}},{key:"splice",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length?arguments[2]:void 0;if("number"==typeof e){if(0>e&&(e+=this._length),0>e||e>=this._length)throw new al(e);var r=this.nthCellUnsafe(e)}else r=e;var s=new t;if(0<n)for(;r&&0<n--;)this.remove(r),s.push(r.value),r=r.next;else r&&(r=r.next);if(i)if(r)for(n=0;n<i.length;n++)this.insertBefore(r,i[n]);else for(r=0;r<i.length;r++)this.push(i[r]);return s}},{key:"remove",value:function(t){return t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,this._length--,this}},{key:"swap",value:function(t,e){if(t!==e){var n=t.value;t.value=e.value,e.value=n}return this}},{key:"push",value:function(t){return this.tail?(t={value:t,prev:this.tail},this.tail=this.tail.next=t,this._length++,this):this.cons(t)}},{key:"pop",value:function(){var t=this.tail;if(t)return(this.tail=t.prev)?delete this.tail.next:delete this.head,this._length--,t.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(t){return this.head?(this.head.value=t,this):this.cons(t)}},{key:"setTail",value:function(t){return this.tail?(this.tail.value=t,this):this.push(t)}},{key:"setNth",value:function(t,e){var n=this.nthCell(t);return!n&&ei("index out of bounds: ".concat(t)),n.value=e,this}},{key:"nth",value:function(t,e){return(t=this.nthCell(t))?t.value:e}},{key:"nthCell",value:function(t){if(0>t&&(t+=this._length),!(0>t||t>=this._length))return this.nthCellUnsafe(t)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var t=this.peek();return this.pop(),this.cons(t)}}},{key:"map",value:function(e){for(var n=new t,i=this.head;i;)n.push(e(i.value)),i=i.next;return n}},{key:"filter",value:function(e){for(var n=new t,i=this.head;i;)e(i.value)&&n.push(i.value),i=i.next;return n}},{key:"reduce",value:function(t,e){for(var n=this.head;n;)e=t(e,n.value),n=n.next;return e}},{key:"shuffle",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:qz;if(2>this._length)return this;for(t=null!=t?t:Math.ceil(1.5*Math.log2(this._length));0<t;t--)for(var n=this.head;n;){var i=n.next;.5>e.float()?this.asHead(n):this.asTail(n),n=i}return this}},{key:"sort",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Zk;if(!this._length)return this;for(var e=1;;){var n=this.head;this.tail=this.head=void 0;for(var i=0;n;){i++;for(var r=n,s=0,o=0;o<e&&(s++,r=r.next);o++);for(o=e;0<s||0<o&&r;){if(0===s){var a=r;r=r.next,o--}else r&&0!==o?0>=t(n.value,r.value)?(a=n,n=n.next,s--):(a=r,r=r.next,o--):(a=n,n=n.next,s--);this.tail?this.tail.next=a:this.head=a,a.prev=this.tail,this.tail=a}n=r}if(this.tail.next=void 0,1>=i)return this;e*=2}}},{key:"reverse",value:function(){for(var t=this.head,e=this.tail,n=(this._length>>>1)+(1&this._length);t&&e&&0<n;){var i=t.value;t.value=e.value,e.value=i,t=t.next,e=e.prev,n--}return this}},{key:"asHead",value:function(t){return t===this.head||(this.remove(t),this.head.prev=t,t.next=this.head,t.prev=void 0,this.head=t,this._length++),this}},{key:"asTail",value:function(t){return t===this.tail||(this.remove(t),this.tail.next=t,t.prev=this.tail,t.next=void 0,this.tail=t,this._length++),this}},{key:"toString",value:function(){for(var t=[],e=this.head;e;)t.push(String(e.value)),e=e.next;return t.join(", ")}},{key:"toJSON",value:function(){return Z(this)}},{key:"nthCellUnsafe",value:function(t){if(t<=this._length>>1)var e=this.head,n="next";else e=this.tail,n="prev",t=this._length-t-1;for(;0<t--&&e;)e=e[n];return e}}]),t}(),Wc=function(){function t(e,n){va(this,t),n=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},n),this.map=n.map(),this.items=new wz,this._size=0,this.opts=n,e&&this.into(e)}return eb(t,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return Yg((function(t){return[t.k,t]}),this.items)}},{key:"keys",value:function(){return Yg((function(t){return t.k}),this.items)}},{key:"values",value:function(){return Yg((function(t){return t.v}),this.items)}},{key:"copy",value:function(){var t=this.empty();t.items=this.items.copy();for(var e=t.items.head;e;)t.map.set(e.value.k,e),e=e.next;return t}},{key:"empty",value:function(){return new t(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var t=this.opts.release;if(t){for(var e;e=this.items.drop();)t(e.k,e.v);return!0}return this.items.release()}},{key:"has",value:function(t){return this.map.has(t)}},{key:"get",value:function(t,e){return(t=this.map.get(t))?this.resetEntry(t):e}},{key:"set",value:function(t,e){var n=this.opts.ksize(t)+this.opts.vsize(e),i=this.map.get(t);return this._size+=Math.max(0,n-(i?i.value.s:0)),this.ensureSize()&&this.doSetEntry(i,t,e,n),e}},{key:"into",value:function(t){for(var e=0;e<t.length;e++){var n=t[e];this.set(n[0],n[1])}return this}},{key:"getSet",value:function(t,e){var n=this,i=this.map.get(t);return i?Promise.resolve(this.resetEntry(i)):e().then((function(e){return n.set(t,e)}))}},{key:"delete",value:function(t){return!!(t=this.map.get(t))&&(this.removeEntry(t),!0)}},{key:"resetEntry",value:function(t){return this.items.asTail(t),t.value.v}},{key:"ensureSize",value:function(){for(var t=this.opts.release,e=this.opts.maxsize,n=this.opts.maxlen;this._size>e||this.length>=n;){var i=this.items.drop();if(!i)return!1;this.map.delete(i.k),t&&t(i.k,i.v),this._size-=i.s}return!0}},{key:"removeEntry",value:function(t){var e=t.value;this.map.delete(e.k),this.items.remove(t),this.opts.release&&this.opts.release(e.k,e.v),this._size-=e.s}},{key:"doSetEntry",value:function(t,e,n,i){t?(t.value.v=n,t.value.s=i,this.items.asTail(t)):(this.items.push({k:e,v:n,s:i}),this.map.set(e,this.items.tail))}}]),t}(),xz=function(t){function e(t,i){return va(this,e),i=Object.assign({ttl:36e5},i),n.call(this,t,i)}Ga(e,t);var n=Ha(e);return eb(e,[{key:"empty",value:function(){return new e(null,this.opts)}},{key:"has",value:function(t){return void 0!==this.get(t)}},{key:"get",value:function(t,e){if(t=this.map.get(t)){if(t.value.t>=Date.now())return this.resetEntry(t);this.removeEntry(t)}return e}},{key:"set",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,i=this.opts.ksize(t)+this.opts.vsize(e),r=this.map.get(t);return this._size+=Math.max(0,i-(r?r.value.s:0)),this.ensureSize()&&(n=Date.now()+n,r?(r.value.v=e,r.value.s=i,r.value.t=n,this.items.asTail(r)):(this.items.push({k:t,v:e,s:i,t:n}),this.map.set(t,this.items.tail))),e}},{key:"getSet",value:function(t,e){var n=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,r=this.get(t);return r?Promise.resolve(r):e().then((function(e){return n.set(t,e,i)}))}},{key:"prune",value:function(){for(var t=Date.now(),e=this.items.head;e;)e.value.t<t&&this.removeEntry(e),e=e.next}},{key:"ensureSize",value:function(){for(var t=this.opts.maxsize,n=this.opts.maxlen,i=Date.now(),r=this.items.head;r&&(this._size>t||this.length>=n);)r.value.t<i&&this.removeEntry(r),r=r.next;return Li(Td(e.prototype),"ensureSize",this).call(this)}}]),e}(Wc),Uq="object"==qa(Ya)&&Ya&&Ya.Object===Object&&Ya,yz="object"==("undefined"==typeof self?"undefined":qa(self))&&self&&self.Object===Object&&self,$b=Uq||yz||Function("return this")(),lc=$b.Symbol,Vq=Object.prototype,zz=Vq.hasOwnProperty,Az=Vq.toString,Eg=lc?lc.toStringTag:void 0,Bz=Object.prototype.toString,Wq=lc?lc.toStringTag:void 0,me=function(t){if(null==t)t=void 0===t?"[object Undefined]":"[object Null]";else if(Wq&&Wq in Object(t)){var e=zz.call(t,Eg),n=t[Eg];try{t[Eg]=void 0;var i=!0}catch(t){}var r=Az.call(t);i&&(e?t[Eg]=n:delete t[Eg]),t=r}else t=Bz.call(t);return t},Gb=function(t){var e=qa(t);return null!=t&&("object"==e||"function"==e)},jj=function(t){return!!Gb(t)&&("[object Function]"==(t=me(t))||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t)},dl=$b["__core-js_shared__"],Xq=(e=/[^.]+$/.exec(dl&&dl.keys&&dl.keys.IE_PROTO||""),e?"Symbol(src)_1."+e:""),Cz=Function.prototype.toString,ne=function(t){if(null!=t){try{return Cz.call(t)}catch(t){}return t+""}return""},Dz=/^\[object .+?Constructor\]$/,Ez=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),oe=function(t,e){return t=null==t?void 0:t[e],!Gb(t)||Xq&&Xq in t||!(jj(t)?Ez:Dz).test(ne(t))?void 0:t},Fg=oe(Object,"create"),Fz=Object.prototype.hasOwnProperty,Gz=Object.prototype.hasOwnProperty,e;Vd.prototype.clear=function(){this.__data__=Fg?Fg(null):{},this.size=0},Vd.prototype.delete=function(t){return t=this.has(t)&&delete this.__data__[t],this.size-=t?1:0,t},Vd.prototype.get=function(t){var e=this.__data__;return Fg?"__lodash_hash_undefined__"===(t=e[t])?void 0:t:Fz.call(e,t)?e[t]:void 0},Vd.prototype.has=function(t){var e=this.__data__;return Fg?void 0!==e[t]:Gz.call(e,t)},Vd.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Fg&&void 0===e?"__lodash_hash_undefined__":e,this};var Gg=function(t,e){return t===e||t!=t&&e!=e},fi=function(t,e){for(var n=t.length;n--;)if(Gg(t[n][0],e))return n;return-1},Hz=Array.prototype.splice;Ee.prototype.clear=function(){this.__data__=[],this.size=0},Ee.prototype.delete=function(t){var e=this.__data__;return!(0>(t=fi(e,t))||(t==e.length-1?e.pop():Hz.call(e,t,1),--this.size,0))},Ee.prototype.get=function(t){var e=this.__data__;return 0>(t=fi(e,t))?void 0:e[t][1]},Ee.prototype.has=function(t){return-1<fi(this.__data__,t)},Ee.prototype.set=function(t,e){var n=this.__data__,i=fi(n,t);return 0>i?(++this.size,n.push([t,e])):n[i][1]=e,this};var $g=Ee,Hg=oe($b,"Map"),gi=function(t,e){t=t.__data__;var n=qa(e);return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e)?t["string"==typeof e?"string":"hash"]:t.map};Fe.prototype.clear=function(){this.size=0,this.__data__={hash:new Vd,map:new(Hg||$g),string:new Vd}},Fe.prototype.delete=function(t){return t=gi(this,t).delete(t),this.size-=t?1:0,t},Fe.prototype.get=function(t){return gi(this,t).get(t)},Fe.prototype.has=function(t){return gi(this,t).has(t)},Fe.prototype.set=function(t,e){var n=gi(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this};var Zg=Fe;Lf.prototype.add=Lf.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Lf.prototype.has=function(t){return this.__data__.has(t)};var Yq=function(t,e,n,i){var r=t.length;for(n+=i?1:-1;i?n--:++n<r;)if(e(t[n],n,t))return n;return-1},Iz=function(t){return t!=t},Jz=function(t,e){var n;if(n=!(null==t||!t.length)){if(e==e)t:{n=-1;for(var i=t.length;++n<i;)if(t[n]===e){t=n;break t}t=-1}else t=Yq(t,Iz,0);n=-1<t}return n},Kz=function(t,e,n){for(var i=-1,r=null==t?0:t.length;++i<r;)if(n(e,t[i]))return!0;return!1},Lz=function(t,e){return t.has(e)},uf=oe($b,"Set"),Mz=function(){},el=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n},Nz=1/0,Oz=uf&&1/el(new uf([,-0]))[1]==Nz?function(t){return new uf(t)}:Mz,fl=function(t,e,n){var i=-1,r=Jz,s=t.length,o=!0,a=[],c=a;if(n)o=!1,r=Kz;else if(200<=s){if(r=e?null:Oz(t))return el(r);o=!1,r=Lz,c=new Lf}else c=e?[]:a;t:for(;++i<s;){var l=t[i],u=e?e(l):l;if(l=n||0!==l?l:0,o&&u==u){for(var d=c.length;d--;)if(c[d]===u)continue t;e&&c.push(u),a.push(l)}else r(c,u,n)||(c!==a&&c.push(u),a.push(l))}return a},Zq=function(t){for(var e=-1,n=null==t?0:t.length,i={};++e<n;){var r=t[e];i[r[0]]=r[1]}return i},Je=function(t,e){for(var n=-1,i=null==t?0:t.length,r=Array(i);++n<i;)r[n]=e(t[n],n,t);return r};Ge.prototype.clear=function(){this.__data__=new $g,this.size=0},Ge.prototype.delete=function(t){var e=this.__data__;return t=e.delete(t),this.size=e.size,t},Ge.prototype.get=function(t){return this.__data__.get(t)},Ge.prototype.has=function(t){return this.__data__.has(t)},Ge.prototype.set=function(t,e){var n=this.__data__;if(n instanceof $g){var i=n.__data__;if(!Hg||199>i.length)return i.push([t,e]),this.size=++n.size,this;n=this.__data__=new Zg(i)}return n.set(t,e),this.size=n.size,this};var Ie=Ge,su=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i&&!1!==e(t[n],n,t););return t},hi=function(){try{var t=oe(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Ig=function(t,e,n){"__proto__"==e&&hi?hi(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},Pz=Object.prototype.hasOwnProperty,Qm=function(t,e,n){var i=t[e];Pz.call(t,e)&&Gg(i,n)&&(void 0!==n||e in t)||Ig(t,e,n)},Ue=function(t,e,n,i){var r=!n;n||(n={});for(var s=-1,o=e.length;++s<o;){var a=e[s],c=i?i(n[a],t[a],a,n,t):void 0;void 0===c&&(c=t[a]),r?Ig(n,a,c):Qm(n,a,c)}return n},Hc=function(t){return null!=t&&"object"==qa(t)},$q=function(t){return Hc(t)&&"[object Arguments]"==me(t)},ar=Object.prototype,Qz=ar.hasOwnProperty,Rz=ar.propertyIsEnumerable,Vf=$q(function(){return arguments}())?$q:function(t){return Hc(t)&&Qz.call(t,"callee")&&!Rz.call(t,"callee")},ub=Array.isArray,Sz=function(){return!1},Nf=xb((function(t,e){var n=(e=e&&!e.nodeType&&e)&&t&&!t.nodeType&&t;e=n&&n.exports===e?$b.Buffer:void 0,t.exports=(e?e.isBuffer:void 0)||Sz})),Tz=/^(?:0|[1-9]\d*)$/,gl=function(t,e){var n=qa(t);return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Tz.test(t))&&-1<t&&0==t%1&&t<e},hl=function(t){return"number"==typeof t&&-1<t&&0==t%1&&9007199254740991>=t},Va={};Va["[object Float32Array]"]=Va["[object Float64Array]"]=Va["[object Int8Array]"]=Va["[object Int16Array]"]=Va["[object Int32Array]"]=Va["[object Uint8Array]"]=Va["[object Uint8ClampedArray]"]=Va["[object Uint16Array]"]=Va["[object Uint32Array]"]=!0,Va["[object Arguments]"]=Va["[object Array]"]=Va["[object ArrayBuffer]"]=Va["[object Boolean]"]=Va["[object DataView]"]=Va["[object Date]"]=Va["[object Error]"]=Va["[object Function]"]=Va["[object Map]"]=Va["[object Number]"]=Va["[object Object]"]=Va["[object RegExp]"]=Va["[object Set]"]=Va["[object String]"]=Va["[object WeakMap]"]=!1;var Uz=function(t){return Hc(t)&&hl(t.length)&&!!Va[me(t)]},ii=function(t){return function(e){return t(e)}},vf=xb((function(t,e){var n=e&&!e.nodeType&&e;n=(e=n&&t&&!t.nodeType&&t)&&e.exports===n&&Uq.process;t:{try{var i=e&&e.require&&e.require("util").types;if(i){var r=i;break t}r=n&&n.binding&&n.binding("util");break t}catch(t){}r=void 0}t.exports=r})),br=vf&&vf.isTypedArray,Ui=br?ii(br):Uz,Vz=Object.prototype.hasOwnProperty,cr=function(t,e){var n=ub(t),i=!n&&Vf(t),r=!n&&!i&&Nf(t),s=!n&&!i&&!r&&Ui(t);if(n=n||i||r||s){i=t.length;for(var o=String,a=-1,c=Array(i);++a<i;)c[a]=o(a);i=c}else i=[];for(var l in o=i.length,t)!e&&!Vz.call(t,l)||n&&("length"==l||r&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||gl(l,o))||i.push(l);return i},Wz=Object.prototype,il=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Wz)},dr=function(t,e){return function(n){return t(e(n))}},Xz=dr(Object.keys,Object),Yz=Object.prototype.hasOwnProperty,ae=function(t){return null!=t&&hl(t.length)&&!jj(t)},Wd=function(t){if(ae(t))t=cr(t);else if(il(t)){var e,n=[];for(e in Object(t))Yz.call(t,e)&&"constructor"!=e&&n.push(e);t=n}else t=Xz(t);return t},ou=function(t,e){return t&&Ue(e,Wd(e),t)},Zz=Object.prototype.hasOwnProperty,Of=function(t){if(ae(t))t=cr(t,!0);else if(Gb(t)){var e=il(t),n=[];for(i in t)("constructor"!=i||!e&&Zz.call(t,i))&&n.push(i);t=n}else{var i=[];if(null!=t)for(e in Object(t))i.push(e);t=i}return t},mu=function(t,e){return t&&Ue(e,Of(e),t)},Nm=xb((function(t,e){var n=(e=e&&!e.nodeType&&e)&&t&&!t.nodeType&&t,i=(e=n&&n.exports===e?$b.Buffer:void 0)?e.allocUnsafe:void 0;t.exports=function(t,e){return e?t.slice():(e=t.length,e=i?i(e):new t.constructor(e),t.copy(e),e)}})),Pi=function(t,e){var n=-1,i=t.length;for(e||(e=Array(i));++n<i;)e[n]=t[n];return e},$z=function(t,e){for(var n=-1,i=null==t?0:t.length,r=0,s=[];++n<i;){var o=t[n];e(o,n,t)&&(s[r++]=o)}return s},er=function(){return[]},aA=Object.prototype.propertyIsEnumerable,fr=Object.getOwnPropertySymbols,jl=fr?function(t){return null==t?[]:(t=Object(t),$z(fr(t),(function(e){return aA.call(t,e)})))}:er,nu=function(t,e){return Ue(t,jl(t),e)},Ti=function(t,e){for(var n=-1,i=e.length,r=t.length;++n<i;)t[r+n]=e[n];return t},kl=dr(Object.getPrototypeOf,Object),gr=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Ti(e,jl(t)),t=kl(t);return e}:er,lu=function(t,e){return Ue(t,gr(t),e)},hr=function(t,e,n){return e=e(t),ub(t)?e:Ti(e,n(t))},Qi=function(t){return hr(t,Wd,jl)},Pm=function(t){return hr(t,Of,gr)},ll=oe($b,"DataView"),ml=oe($b,"Promise"),nl=oe($b,"WeakMap"),bA=ne(ll),cA=ne(Hg),dA=ne(ml),eA=ne(uf),fA=ne(nl),pe=me;(ll&&"[object DataView]"!=pe(new ll(new ArrayBuffer(1)))||Hg&&"[object Map]"!=pe(new Hg)||ml&&"[object Promise]"!=pe(ml.resolve())||uf&&"[object Set]"!=pe(new uf)||nl&&"[object WeakMap]"!=pe(new nl))&&(pe=function(t){var e=me(t);if(t=(t="[object Object]"==e?t.constructor:void 0)?ne(t):"")switch(t){case bA:return"[object DataView]";case cA:return"[object Map]";case dA:return"[object Promise]";case eA:return"[object Set]";case fA:return"[object WeakMap]"}return e});var Mf=pe,gA=Object.prototype.hasOwnProperty,ku=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&gA.call(t,"index")&&(n.index=t.index,n.input=t.input),n},ji=$b.Uint8Array,ol=function(t){var e=new t.constructor(t.byteLength);return new ji(e).set(new ji(t)),e},hA=/\w*$/,ir=lc?lc.prototype:void 0,jr=ir?ir.valueOf:void 0,Bn=function(t,e){return e=e?ol(t.buffer):t.buffer,new t.constructor(e,t.byteOffset,t.length)},pu=function(t,e,n){var i=t.constructor;switch(e){case"[object ArrayBuffer]":return ol(t);case"[object Boolean]":case"[object Date]":return new i(+t);case"[object DataView]":return e=n?ol(t.buffer):t.buffer,new t.constructor(e,t.byteOffset,t.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Bn(t,n);case"[object Map]":case"[object Set]":return new i;case"[object Number]":case"[object String]":return new i(t);case"[object RegExp]":return(e=new t.constructor(t.source,hA.exec(t))).lastIndex=t.lastIndex,e;case"[object Symbol]":return jr?Object(jr.call(t)):{}}},kr=Object.create,iA=function(){function t(){}return function(e){return Gb(e)?kr?kr(e):(t.prototype=e,e=new t,t.prototype=void 0,e):{}}}(),Om=function(t){return"function"!=typeof t.constructor||il(t)?{}:iA(kl(t))},jA=function(t){return Hc(t)&&"[object Map]"==Mf(t)},lr=vf&&vf.isMap,ru=lr?ii(lr):jA,kA=function(t){return Hc(t)&&"[object Set]"==Mf(t)},mr=vf&&vf.isSet,qu=mr?ii(mr):kA,Oa={};Oa["[object Arguments]"]=Oa["[object Array]"]=Oa["[object ArrayBuffer]"]=Oa["[object DataView]"]=Oa["[object Boolean]"]=Oa["[object Date]"]=Oa["[object Float32Array]"]=Oa["[object Float64Array]"]=Oa["[object Int8Array]"]=Oa["[object Int16Array]"]=Oa["[object Int32Array]"]=Oa["[object Map]"]=Oa["[object Number]"]=Oa["[object Object]"]=Oa["[object RegExp]"]=Oa["[object Set]"]=Oa["[object String]"]=Oa["[object Symbol]"]=Oa["[object Uint8Array]"]=Oa["[object Uint8ClampedArray]"]=Oa["[object Uint16Array]"]=Oa["[object Uint32Array]"]=!0,Oa["[object Error]"]=Oa["[object Function]"]=Oa["[object WeakMap]"]=!1;var Ke=function(t){return"symbol"==qa(t)||Hc(t)&&"[object Symbol]"==me(t)},lA=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mA=/^\w*$/,pl=function(t,e){if(ub(t))return!1;var n=qa(t);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Ke(t))||mA.test(t)||!lA.test(t)||null!=e&&t in Object(e)};Ri.Cache=Zg;var nA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oA=/\\(\\)?/g,pA=function(t){var e=(t=Ri(t,(function(t){return 500===e.size&&e.clear(),t}))).cache;return t}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(nA,(function(t,n,i,r){e.push(i?r.replace(oA,"$1"):n||t)})),e})),tu=1/0,nr=lc?lc.prototype:void 0,Sm=nr?nr.toString:void 0,ki=function(t,e){return ub(t)?t:pl(t,e)?[t]:pA(null==t?"":Rm(t))},qA=1/0,Jg=function(t){if("string"==typeof t||Ke(t))return t;var e=t+"";return"0"==e&&1/t==-qA?"-0":e},li=function(t,e){for(var n=0,i=(e=ki(e,t)).length;null!=t&&n<i;)t=t[Jg(e[n++])];return n&&n==i?t:void 0},rA=function(t,e){if(!(2>(e=ki(e,t)).length)){var n=e,i=0,r=-1,s=-1,o=n.length;for(0>i&&(i=-i>o?0:o+i),0>(r=r>o?o:r)&&(r+=o),o=i>r?0:r-i>>>0,i>>>=0,r=Array(o);++s<o;)r[s]=n[s+i];t=li(t,r)}return(n=null==t)||(n=null==e?0:e.length,n=delete t[Jg(n?e[n-1]:void 0)]),n},or=Function.prototype.toString,sA=Object.prototype.hasOwnProperty,tA=or.call(Object),Cn=function(t){return!(!Hc(t)||"[object Object]"!=me(t))&&(null===(t=kl(t))||"function"==typeof(t=sA.call(t,"constructor")&&t.constructor)&&t instanceof t&&or.call(t)==tA)},uA=function(t){return Cn(t)?void 0:t},pr=lc?lc.isConcatSpreadable:void 0,uu=function(t){return ub(t)||Vf(t)||!!(pr&&t&&t[pr])},vA=function(t){return null!=t&&t.length?Si(t,1):[]},wA=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},qr=Math.max,rr=function(t,e,n){return e=qr(void 0===e?t.length-1:e,0),function(){for(var i=arguments,r=-1,s=qr(i.length-e,0),o=Array(s);++r<s;)o[r]=i[e+r];for(r=-1,s=Array(e+1);++r<e;)s[r]=i[r];return s[e]=n(o),wA(t,this,s)}},xA=function(t){return function(){return t}},mi=function(t){return t},yA=Date.now,sr=function(t){var e=0,n=0;return function(){var i=yA(),r=16-(i-n);if(n=i,0<r){if(800<=++e)return arguments[0]}else e=0;return t.apply(void 0,arguments)}}(hi?function(t,e){return hi(t,"toString",{configurable:!0,enumerable:!1,value:xA(e),writable:!0})}:mi),ql=function(t){return sr(rr(t,void 0,vA),t+"")}((function(t,e){var n={};if(null==t)return n;var i=!1;e=Je(e,(function(e){return e=ki(e,t),i||(i=1<e.length),e})),Ue(t,Pm(t),n),i&&(n=He(n,7,uA));for(var r=e.length;r--;)rA(n,e[r]);return n})),zA=function(t,e,n,i){for(var r=-1,s=null==t?0:t.length;++r<s;){var o=t[r];e(i,o,n(o),t)}return i},An=function(t,e,n){for(var i=-1,r=Object(t),s=(n=n(t)).length;s--;){var o=n[++i];if(!1===e(r[o],o,r))break}return t},tr=function(t,e){return t&&An(t,e,Wd)},rl=function(t,e){return function(e,n){if(null==e)return e;if(!ae(e))return t(e,n);for(var i=e.length,r=-1,s=Object(e);++r<i&&!1!==n(s[r],r,s););return e}}(tr),AA=function(t,e,n,i){return rl(t,(function(t,r,s){e(i,t,n(t),s)})),i},ur=function(t,e){for(var n=-1,i=null==t?0:t.length;++n<i;)if(e(t[n],n,t))return!0;return!1},Tm=function(t,e,n,i,r,s){var o=1&n,a=t.length,c=e.length;if(a!=c&&!(o&&c>a))return!1;c=s.get(t);var l=s.get(e);if(c&&l)return c==e&&l==t;c=-1,l=!0;var u=2&n?new Lf:void 0;for(s.set(t,e),s.set(e,t);++c<a;){var d=t[c],h=e[c];if(i)var A=o?i(h,d,c,e,t,s):i(d,h,c,t,e,s);if(void 0!==A){if(A)continue;l=!1;break}if(u){if(!ur(e,(function(t,e){if(!u.has(e)&&(d===t||r(d,t,n,i,s)))return u.push(e)}))){l=!1;break}}else if(d!==h&&!r(d,h,n,i,s)){l=!1;break}}return s.delete(t),s.delete(e),l},BA=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,i){n[++e]=[i,t]})),n},vr=lc?lc.prototype:void 0,sl=vr?vr.valueOf:void 0,vu=function(t,e,n,i,r,s,o){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)break;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":if(t.byteLength!=e.byteLength||!s(new ji(t),new ji(e)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return Gg(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=BA;case"[object Set]":if(a||(a=el),t.size!=e.size&&!(1&i))break;return(n=o.get(t))?n==e:(i|=2,o.set(t,e),e=Tm(a(t),a(e),i,r,s,o),o.delete(t),e);case"[object Symbol]":if(sl)return sl.call(t)==sl.call(e)}return!1},wu=Object.prototype.hasOwnProperty,Um=Object.prototype.hasOwnProperty,CA=function(t,e,n,i){var r=n.length,s=r,o=!i;if(null==t)return!s;for(t=Object(t);r--;){var a=n[r];if(o&&a[2]?a[1]!==t[a[0]]:!(a[0]in t))return!1}for(;++r<s;){var c=(a=n[r])[0],l=t[c],u=a[1];if(o&&a[2]){if(void 0===l&&!(c in t))return!1}else{if(a=new Ie,i)var d=i(l,u,c,t,e,a);if(void 0===d?!Le(u,l,3,i,a):!d)return!1}}return!0},DA=function(t){for(var e=Wd(t),n=e.length;n--;){var i=e[n],r=t[i];e[n]=[i,r,r==r&&!Gb(r)]}return e},wr=function(t,e){return function(n){return null!=n&&n[t]===e&&(void 0!==e||t in Object(n))}},EA=function(t){var e=DA(t);return 1==e.length&&e[0][2]?wr(e[0][0],e[0][1]):function(n){return n===t||CA(n,t,e)}},FA=function(t,e){return pl(t)&&e==e&&!Gb(e)?wr(Jg(t),e):function(n){var i=null==n?void 0:li(n,t);if(void 0===(i=void 0===i?void 0:i)&&i===e){if(i=null!=n){for(var r=-1,s=(i=ki(i=t,n)).length,o=!1;++r<s;){var a=Jg(i[r]);if(!(o=null!=n&&null!=n&&a in Object(n)))break;n=n[a]}i=o||++r!=s?o:!!(s=null==n?0:n.length)&&hl(s)&&gl(a,s)&&(ub(n)||Vf(n))}a=i}else a=Le(e,i,3);return a}},GA=function(t){return function(e){return null==e?void 0:e[t]}},HA=function(t){return function(e){return li(e,t)}},wf=function(t){return"function"==typeof t?t:null==t?mi:"object"==qa(t)?ub(t)?FA(t[0],t[1]):EA(t):pl(t)?GA(Jg(t)):HA(t)},tl=function(t,e){return function(e,n){return(ub(e)?zA:AA)(e,t,wf(n),{})}}((function(t,e,n){Ig(t,n,e)})),md=function(t,e){var n={};return e=wf(e),tr(t,(function(t,i,r){Ig(n,i,e(t,i,r))})),n};ea({target:"String",proto:!0,forced:la((function(){var t="".sub('"');return t!==t.toLowerCase()||3<t.split('"').length}))},{sub:function(){return"<sub>"+String(Eb(this))+"</sub>"}});var P=Pa,mc=null;try{mc=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(c){}Pa.prototype.__isLong__,Object.defineProperty(Pa.prototype,"__isLong__",{value:!0}),Pa.isLong=Hb;var Wm={},Vm={};Pa.fromInt=Xd,Pa.fromNumber=ec,Pa.fromBits=Qa;var ah=Math.pow;Pa.fromString=Vi,Pa.fromValue=vc;var Me=4294967296,Xm=Me*Me,Zm=Xm/2,xr=Xd(16777216),fc=Xd(0);Pa.ZERO=fc;var Yd=Xd(0,!0);Pa.UZERO=Yd;var xf=Xd(1);Pa.ONE=xf;var yr=Xd(1,!0);Pa.UONE=yr;var ul=Xd(-1);Pa.NEG_ONE=ul;var $m=Qa(-1,2147483647,!1);Pa.MAX_VALUE=$m;var Ym=Qa(-1,-1,!0);Pa.MAX_UNSIGNED_VALUE=Ym;var Ib=Qa(0,-2147483648,!1);Pa.MIN_VALUE=Ib;var V=Pa.prototype;V.toInt=function(){return this.unsigned?this.low>>>0:this.low},V.toNumber=function(){return this.unsigned?(this.high>>>0)*Me+(this.low>>>0):this.high*Me+(this.low>>>0)},V.toString=function(t){if(2>(t=t||10)||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Ib)){var e=ec(t),n=this.div(e);return e=n.mul(e).sub(this),n.toString(t)+e.toInt().toString(t)}return"-"+this.neg().toString(t)}n=ec(ah(t,6),this.unsigned),e=this;for(var i="";;){var r=e.div(n),s=(e.sub(r.mul(n)).toInt()>>>0).toString(t);if((e=r).isZero())return s+i;for(;6>s.length;)s="0"+s;i=""+s+i}},V.getHighBits=function(){return this.high},V.getHighBitsUnsigned=function(){return this.high>>>0},V.getLowBits=function(){return this.low},V.getLowBitsUnsigned=function(){return this.low>>>0},V.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ib)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;0<e&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},V.isZero=function(){return 0===this.high&&0===this.low},V.eqz=V.isZero,V.isNegative=function(){return!this.unsigned&&0>this.high},V.isPositive=function(){return this.unsigned||0<=this.high},V.isOdd=function(){return 1==(1&this.low)},V.isEven=function(){return 0==(1&this.low)},V.equals=function(t){return Hb(t)||(t=vc(t)),(this.unsigned===t.unsigned||1!=this.high>>>31||1!=t.high>>>31)&&this.high===t.high&&this.low===t.low},V.eq=V.equals,V.notEquals=function(t){return!this.eq(t)},V.neq=V.notEquals,V.ne=V.notEquals,V.lessThan=function(t){return 0>this.comp(t)},V.lt=V.lessThan,V.lessThanOrEqual=function(t){return 0>=this.comp(t)},V.lte=V.lessThanOrEqual,V.le=V.lessThanOrEqual,V.greaterThan=function(t){return 0<this.comp(t)},V.gt=V.greaterThan,V.greaterThanOrEqual=function(t){return 0<=this.comp(t)},V.gte=V.greaterThanOrEqual,V.ge=V.greaterThanOrEqual,V.compare=function(t){if(Hb(t)||(t=vc(t)),this.eq(t))return 0;var e=this.isNegative(),n=t.isNegative();return e&&!n?-1:!e&&n?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},V.comp=V.compare,V.negate=function(){return!this.unsigned&&this.eq(Ib)?Ib:this.not().add(xf)},V.neg=V.negate,V.add=function(t){Hb(t)||(t=vc(t));var e=this.high>>>16,n=65535&this.high,i=this.low>>>16,r=t.high>>>16,s=65535&t.high,o=t.low>>>16;return i=(o=((t=(65535&this.low)+(65535&t.low))>>>16)+(i+o))>>>16,Qa((65535&o)<<16|65535&t,(e=((i+=n+s)>>>16)+(e+r)&65535)<<16|65535&i,this.unsigned)},V.subtract=function(t){return Hb(t)||(t=vc(t)),this.add(t.neg())},V.sub=V.subtract,V.multiply=function(t){if(this.isZero())return fc;if(Hb(t)||(t=vc(t)),mc){var e=mc.mul(this.low,this.high,t.low,t.high);return Qa(e,mc.get_high(),this.unsigned)}if(t.isZero())return fc;if(this.eq(Ib))return t.isOdd()?Ib:fc;if(t.eq(Ib))return this.isOdd()?Ib:fc;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(xr)&&t.lt(xr))return ec(this.toNumber()*t.toNumber(),this.unsigned);e=this.high>>>16;var n=65535&this.high,i=this.low>>>16,r=65535&this.low,s=t.high>>>16,o=65535&t.high,a=t.low>>>16,c=r*(t=65535&t.low),l=(c>>>16)+i*t,u=l>>>16;u+=(l=(65535&l)+r*a)>>>16;var d=(u+=n*t)>>>16;return Qa((65535&l)<<16|65535&c,(d=(d+=(u=(65535&u)+i*a)>>>16)+((u=(65535&u)+r*o)>>>16)+(e*t+n*a+i*o+r*s)&65535)<<16|65535&u,this.unsigned)},V.mul=V.multiply,V.divide=function(t){if(Hb(t)||(t=vc(t)),t.isZero())throw Error("division by zero");if(mc)return this.unsigned||-2147483648!==this.high||-1!==t.low||-1!==t.high?Qa(t=(this.unsigned?mc.div_u:mc.div_s)(this.low,this.high,t.low,t.high),mc.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Yd:fc;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return Yd;if(t.gt(this.shru(1)))return yr;var e=Yd}else{if(this.eq(Ib)){if(t.eq(xf)||t.eq(ul))return Ib;if(t.eq(Ib))return xf;var n=this.shr(1).div(t).shl(1);if(n.eq(fc))return t.isNegative()?xf:ul;var i=this.sub(t.mul(n));return n.add(i.div(t))}if(t.eq(Ib))return this.unsigned?Yd:fc;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();e=fc}for(i=this;i.gte(t);){n=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));var r=Math.ceil(Math.log(n)/Math.LN2);r=48>=r?1:ah(2,r-48);for(var s=ec(n),o=s.mul(t);o.isNegative()||o.gt(i);)o=(s=ec(n-=r,this.unsigned)).mul(t);s.isZero()&&(s=xf),e=e.add(s),i=i.sub(o)}return e},V.div=V.divide,V.modulo=function(t){return Hb(t)||(t=vc(t)),mc?Qa(t=(this.unsigned?mc.rem_u:mc.rem_s)(this.low,this.high,t.low,t.high),mc.get_high(),this.unsigned):this.sub(this.div(t).mul(t))},V.mod=V.modulo,V.rem=V.modulo,V.not=function(){return Qa(~this.low,~this.high,this.unsigned)},V.and=function(t){return Hb(t)||(t=vc(t)),Qa(this.low&t.low,this.high&t.high,this.unsigned)},V.or=function(t){return Hb(t)||(t=vc(t)),Qa(this.low|t.low,this.high|t.high,this.unsigned)},V.xor=function(t){return Hb(t)||(t=vc(t)),Qa(this.low^t.low,this.high^t.high,this.unsigned)},V.shiftLeft=function(t){return Hb(t)&&(t=t.toInt()),0==(t&=63)?this:32>t?Qa(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):Qa(0,this.low<<t-32,this.unsigned)},V.shl=V.shiftLeft,V.shiftRight=function(t){return Hb(t)&&(t=t.toInt()),0==(t&=63)?this:32>t?Qa(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):Qa(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},V.shr=V.shiftRight,V.shiftRightUnsigned=function(t){if(Hb(t)&&(t=t.toInt()),0==(t&=63))return this;var e=this.high;return 32>t?Qa(this.low>>>t|e<<32-t,e>>>t,this.unsigned):Qa(32===t?e:e>>>t-32,0,this.unsigned)},V.shru=V.shiftRightUnsigned,V.shr_u=V.shiftRightUnsigned,V.toSigned=function(){return this.unsigned?Qa(this.low,this.high,!1):this},V.toUnsigned=function(){return this.unsigned?this:Qa(this.low,this.high,!0)},V.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},V.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},V.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},Pa.fromBytes=function(t,e,n){return n?Pa.fromBytesLE(t,e):Pa.fromBytesBE(t,e)},Pa.fromBytesLE=function(t,e){return new Pa(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},Pa.fromBytesBE=function(t,e){return new Pa(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)};var Wi=function(t,e){return(Wi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},vl=!1,gc={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t?console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+Error().stack):vl&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),vl=t},get useDeprecatedSynchronousErrorHandling(){return vl}},ni={closed:!0,next:function(t){},error:function(t){if(gc.useDeprecatedSynchronousErrorHandling)throw t;Oe(t)},complete:function(){}},hc=Array.isArray||function(t){return t&&"number"==typeof t.length},Pf=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),nb=function(){function t(t){this.closed=!1,this._subscriptions=this._parentOrParents=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){if(!this.closed){var e=this._parentOrParents,n=this._ctorUnsubscribe,i=this._unsubscribe,r=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,e instanceof t)e.remove(this);else if(null!==e)for(var s=0;s<e.length;++s)e[s].remove(this);if(Ne(i)){n&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){var o=t instanceof Pf?an(t.errors):[t]}}if(hc(r))for(s=-1,e=r.length;++s<e;)if(Xi(n=r[s]))try{n.unsubscribe()}catch(t){o=o||[],t instanceof Pf?o=o.concat(an(t.errors)):o.push(t)}if(o)throw new Pf(o)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(qa(e)){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof t||(e=n,(n=new t)._subscriptions=[e]);break;default:throw Error("unrecognized teardown "+e+" added to Subscription.")}if(null===(e=n._parentOrParents))n._parentOrParents=this;else if(e instanceof t){if(e===this)return n;n._parentOrParents=[e,this]}else{if(-1!==e.indexOf(this))return n;e.push(this)}return null===(e=this._subscriptions)?this._subscriptions=[n]:e.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;e&&-1!==(t=e.indexOf(t))&&e.splice(t,1)},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}(),oi="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),za=function(t){function e(n,i,r){var s=t.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=ni;break;case 1:if(!n){s.destination=ni;break}if("object"===qa(n)){n instanceof e?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new zr(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new zr(s,n,i,r)}return s}return ha(e,t),e.prototype[oi]=function(){return this},e.create=function(t,n,i){return(t=new e(t,n,i)).syncErrorThrowable=!1,t},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=t,this},e}(nb),zr=function(t){function e(e,n,i,r){var s=t.call(this)||this;if(s._parentSubscriber=e,e=s,Ne(n))var o=n;else n&&(o=n.next,i=n.error,r=n.complete,n!==ni&&(Ne((e=Object.create(n)).unsubscribe)&&s.add(e.unsubscribe.bind(e)),e.unsubscribe=s.unsubscribe.bind(s)));return s._context=e,s._next=o,s._error=i,s._complete=r,s}return ha(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;gc.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=gc.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?this.__tryOrSetError(e,this._error,t):this.__tryOrUnsub(this._error,t),this.unsubscribe();else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):Oe(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;Oe(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};gc.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,n):this.__tryOrUnsub(n)}this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),gc.useDeprecatedSynchronousErrorHandling)throw t;Oe(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!gc.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{e.call(this._context,n)}catch(e){return gc.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0):Oe(e),!0}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._parentSubscriber=this._context=null,t.unsubscribe()},e}(za),Pe="function"==typeof Symbol&&Symbol.observable||"@@observable",ua=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var i=this.operator;t:{if(t){if(t instanceof za)break t;if(t[oi]){t=t[oi]();break t}}t=t||e||n?new za(t,e,n):new za(ni)}if(i?t.add(i.call(t,this.source)):t.add(this.source||gc.useDeprecatedSynchronousErrorHandling&&!t.syncErrorThrowable?this._subscribe(t):this._trySubscribe(t)),gc.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable&&(t.syncErrorThrowable=!1,t.syncErrorThrown))throw t.syncErrorValue;return t},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){gc.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),Yi(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=cn(e))((function(e,i){var r=n.subscribe((function(e){try{t(e)}catch(t){i(t),r&&r.unsubscribe()}}),i,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[Pe]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:bn(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=cn(t))((function(t,n){var i;e.subscribe((function(t){return i=t}),(function(t){return n(t)}),(function(){return t(i)}))}))},t.create=function(e){return new t(e)},t}(),Ld=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),Ar=function(t){function e(e,n){var i=t.call(this)||this;return i.subject=e,i.subscriber=n,i.closed=!1,i}return ha(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;this.subject=null,!e||0===e.length||t.isStopped||t.closed||-1!==(t=e.indexOf(this.subscriber))&&e.splice(t,1)}},e}(nb),Br=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return ha(e,t),e}(za),rb=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return ha(e,t),e.prototype[oi]=function(){return new Br(this)},e.prototype.lift=function(t){var e=new Cr(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new Ld;if(!this.isStopped){var e=this.observers,n=e.length;e=e.slice();for(var i=0;i<n;i++)e[i].next(t)}},e.prototype.error=function(t){if(this.closed)throw new Ld;this.hasError=!0,this.thrownError=t,this.isStopped=!0;var e=this.observers,n=e.length;e=e.slice();for(var i=0;i<n;i++)e[i].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new Ld;this.isStopped=!0;var t=this.observers,e=t.length;t=t.slice();for(var n=0;n<e;n++)t[n].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new Ld;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new Ld;return this.hasError?(t.error(this.thrownError),nb.EMPTY):this.isStopped?(t.complete(),nb.EMPTY):(this.observers.push(t),new Ar(this,t))},e.prototype.asObservable=function(){var t=new ua;return t.source=this,t},e.create=function(t,e){return new Cr(t,e)},e}(ua),Cr=function(t){function e(e,n){var i=t.call(this)||this;return i.destination=e,i.source=n,i}return ha(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):nb.EMPTY},e}(rb),xu=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;return n._refCount++,t=new IA(t,n),e=e.subscribe(t),t.closed||(t.connection=n.connect()),e},t}(),IA=function(t){function e(e,n){return(e=t.call(this,e)||this).connectable=n,e}return ha(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;0>=e?this.connection=null:(t._refCount=e-1,1<e?this.connection=null:(e=this.connection,t=t._connection,this.connection=null,!t||e&&t!==e||t.unsubscribe()))}else this.connection=null},e}(za),Dr=function(t){function e(e,n){var i=t.call(this)||this;return i.source=e,i.subjectFactory=n,i._refCount=0,i._isComplete=!1,i}return ha(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new nb).add(this.source.subscribe(new JA(this.getSubject(),this))),t.closed&&(this._connection=null,t=nb.EMPTY)),t},e.prototype.refCount=function(){return dn()(this)},e}(ua),lv=function(){var t=Dr.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}}(),JA=function(t){function e(e,n){return(e=t.call(this,e)||this).connectable=n,e}return ha(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(Br);!function(t){function e(e,n){return(e=t.call(this,e)||this).connectable=n,e}ha(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;0>=e?this.connection=null:(t._refCount=e-1,1<e?this.connection=null:(e=this.connection,t=t._connection,this.connection=null,!t||e&&t!==e||t.unsubscribe()))}else this.connection=null}}(za),function(t){function e(e,n,i,r,s){return(e=t.call(this,e)||this).keySelector=n,e.elementSelector=i,e.durationSelector=r,e.subjectSelector=s,e.groups=null,e.attemptedToUnsubscribe=!1,e.count=0,e}ha(e,t),e.prototype._next=function(t){try{var e=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,e)},e.prototype._group=function(t,e){var n=this.groups;n||(n=this.groups=new Map);var i=n.get(e);if(this.elementSelector)try{var r=this.elementSelector(t)}catch(t){this.error(t)}else r=t;if(!i&&(i=this.subjectSelector?this.subjectSelector():new rb,n.set(e,i),t=new wl(e,i,this),this.destination.next(t),this.durationSelector)){t=void 0;try{t=this.durationSelector(new wl(e,i))}catch(t){return void this.error(t)}this.add(t.subscribe(new KA(e,i,this)))}i.closed||i.next(r)},e.prototype._error=function(t){var e=this.groups;e&&(e.forEach((function(e,n){e.error(t)})),e.clear()),this.destination.error(t)},e.prototype._complete=function(){var t=this.groups;t&&(t.forEach((function(t,e){t.complete()})),t.clear()),this.destination.complete()},e.prototype.removeGroup=function(t){this.groups.delete(t)},e.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&t.prototype.unsubscribe.call(this))}}(za);var KA=function(t){function e(e,n,i){var r=t.call(this,n)||this;return r.key=e,r.group=n,r.parent=i,r}return ha(e,t),e.prototype._next=function(t){this.complete()},e.prototype._unsubscribe=function(){var t=this.parent,e=this.key;this.key=this.parent=null,t&&t.removeGroup(e)},e}(za),wl=function(t){function e(e,n,i){var r=t.call(this)||this;return r.key=e,r.groupSubject=n,r.refCountSubscription=i,r}return ha(e,t),e.prototype._subscribe=function(t){var e=new nb,n=this.refCountSubscription,i=this.groupSubject;return n&&!n.closed&&e.add(new LA(n)),e.add(i.subscribe(t)),e},e}(ua),LA=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,e.count++,n}return ha(e,t),e.prototype.unsubscribe=function(){var e=this.parent;e.closed||this.closed||(t.prototype.unsubscribe.call(this),--e.count,0===e.count&&e.attemptedToUnsubscribe&&e.unsubscribe())},e}(nb),MA=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return ha(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ld;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(rb),Kg=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return ha(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t,t=this.id;var n=this.scheduler;return null!=t&&(this.id=this.recycleAsyncId(n,t,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(t=this._execute(t,e))?t:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},e.prototype._execute=function(t,e){e=!1;var n=void 0;try{this.work(t)}catch(t){e=!0,n=!!t&&t||Error(t)}if(e)return this.unsubscribe(),n},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,i=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==i&&n.splice(i,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(function(t){function e(e,n){return t.call(this)||this}return ha(e,t),e.prototype.schedule=function(t,e){return this},e}(nb)),NA=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return ha(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),0<n?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return 0<n||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,i){return void 0===i&&(i=0),null!==i&&0<i||null===i&&0<this.delay?t.prototype.requestAsyncId.call(this,e,n,i):e.flush(this)},e}(Kg),xl=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),Lg=function(t){function e(n,i){void 0===i&&(i=xl.now);var r=t.call(this,n,(function(){return e.delegate&&e.delegate!==r?e.delegate.now():i()}))||this;return r.actions=[],r.active=!1,r.scheduled=void 0,r}return ha(e,t),e.prototype.schedule=function(n,i,r){return void 0===i&&(i=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,i,r):t.prototype.schedule.call(this,n,i,r)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(xl),Mg=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ha(e,t),e}(Lg))(NA),Sb=new ua((function(t){return t.complete()})),en=function(t){return function(e){for(var n=0,i=t.length;n<i&&!e.closed;n++)e.next(t[n]);e.complete()}},yl;!function(t){t.NEXT="N",t.ERROR="E",t.COMPLETE="C"}(yl||(yl={}));var yf=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){switch(this.kind){case"N":return ob(this.value);case"E":return ra(this.error);case"C":return Qf()}throw Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}(),Bu=function(){function t(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return e.subscribe(new Er(t,this.scheduler,this.delay))},t}(),Er=function(t){function e(e,n,i){return void 0===i&&(i=0),(e=t.call(this,e)||this).scheduler=n,e.delay=i,e}return ha(e,t),e.dispatch=function(t){t.notification.observe(t.destination),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new OA(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(yf.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(yf.createError(t)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(yf.createComplete()),this.unsubscribe()},e}(za),OA=function(t,e){this.notification=t,this.destination=e},Te=function(t){function e(e,n,i){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=t.call(this)||this;return r.scheduler=i,r._events=[],r._infiniteTimeWindow=!1,r._bufferSize=1>e?1:e,r._windowTime=1>n?1:n,n===Number.POSITIVE_INFINITY?(r._infiniteTimeWindow=!0,r.next=r.nextInfiniteTimeWindow):r.next=r.nextTimeWindow,r}return ha(e,t),e.prototype.nextInfiniteTimeWindow=function(e){if(!this.isStopped){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift()}t.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this.isStopped||(this._events.push(new PA(this._getNow(),e)),this._trimBufferThenGetEvents()),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e=this._infiniteTimeWindow,n=e?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,r=n.length;if(this.closed)throw new Ld;if(this.isStopped||this.hasError)var s=nb.EMPTY;else this.observers.push(t),s=new Ar(this,t);if(i&&t.add(t=new Er(t,i)),e)for(e=0;e<r&&!t.closed;e++)t.next(n[e]);else for(e=0;e<r&&!t.closed;e++)t.next(n[e].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),s},e.prototype._getNow=function(){return(this.scheduler||Mg).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,i=this._events,r=i.length,s=0;s<r&&!(t-i[s].time<n);)s++;return r>e&&(s=Math.max(s,r-e)),0<s&&i.splice(0,s),i},e}(rb),PA=function(t,e){this.time=t,this.value=e},Sf=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=null,e.hasNext=!1,e.hasCompleted=!1,e}return ha(e,t),e.prototype._subscribe=function(e){return this.hasError?(e.error(this.thrownError),nb.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),nb.EMPTY):t.prototype._subscribe.call(this,e)},e.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},e.prototype.error=function(e){this.hasCompleted||t.prototype.error.call(this,e)},e.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&t.prototype.next.call(this,this.value),t.prototype.complete.call(this)},e}(rb),QA=1,RA=Promise.resolve(),aj={},Fr={setImmediate:function(t){var e=QA++;return aj[e]=!0,RA.then((function(){return fn(e)&&t()})),e},clearImmediate:function(t){fn(t)}},SA=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return ha(e,t),e.prototype.requestAsyncId=function(e,n,i){return void 0===i&&(i=0),null!==i&&0<i?t.prototype.requestAsyncId.call(this,e,n,i):(e.actions.push(this),e.scheduled||(e.scheduled=Fr.setImmediate(e.flush.bind(e,null))))},e.prototype.recycleAsyncId=function(e,n,i){if(void 0===i&&(i=0),null!==i&&0<i||null===i&&0<this.delay)return t.prototype.recycleAsyncId.call(this,e,n,i);0===e.actions.length&&(Fr.clearImmediate(n),e.scheduled=void 0)},e}(Kg),kj=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ha(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,i=-1,r=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++i<r&&(t=n.shift()));if(this.active=!1,e){for(;++i<r&&(t=n.shift());)t.unsubscribe();throw e}},e}(Lg))(SA),TA=kj,zl=new Lg(Kg),cd=zl,UA=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return ha(e,t),e.prototype.requestAsyncId=function(e,n,i){return void 0===i&&(i=0),null!==i&&0<i?t.prototype.requestAsyncId.call(this,e,n,i):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame((function(){return e.flush(null)}))))},e.prototype.recycleAsyncId=function(e,n,i){if(void 0===i&&(i=0),null!==i&&0<i||null===i&&0<this.delay)return t.prototype.recycleAsyncId.call(this,e,n,i);0===e.actions.length&&(cancelAnimationFrame(n),e.scheduled=void 0)},e}(Kg),Gr=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ha(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,i=-1,r=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++i<r&&(t=n.shift()));if(this.active=!1,e){for(;++i<r&&(t=n.shift());)t.unsubscribe();throw e}},e}(Lg))(UA),VA=function(t){function e(e,n){void 0===e&&(e=Hr),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this,e,(function(){return i.frame}))||this;return i.maxFrames=n,i.frame=0,i.index=-1,i}return ha(e,t),e.prototype.flush=function(){for(var t,e,n=this.actions,i=this.maxFrames;(e=n[0])&&e.delay<=i&&(n.shift(),this.frame=e.delay,!(t=e.execute(e.state,e.delay))););if(t){for(;e=n.shift();)e.unsubscribe();throw t}},e.frameTimeFactor=10,e}(Lg),Hr=function(t){function e(e,n,i){void 0===i&&(i=e.index+=1);var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.index=i,r.active=!0,r.index=e.index=i,r}return ha(e,t),e.prototype.schedule=function(n,i){if(void 0===i&&(i=0),!this.id)return t.prototype.schedule.call(this,n,i);this.active=!1;var r=new e(this.scheduler,this.work);return this.add(r),r.schedule(n,i)},e.prototype.requestAsyncId=function(t,n,i){return void 0===i&&(i=0),this.delay=t.frame+i,(t=t.actions).push(this),t.sort(e.sortActions),!0},e.prototype.recycleAsyncId=function(t,e,n){},e.prototype._execute=function(e,n){if(!0===this.active)return t.prototype._execute.call(this,e,n)},e.sortActions=function(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1},e}(Kg),Al=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}(),eh=function(){function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t}(),Tb=function(){function t(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return t.prototype=Object.create(Error.prototype),t}(),Cu=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new WA(t,this.project,this.thisArg))},t}(),WA=function(t){function e(e,n,i){return(e=t.call(this,e)||this).project=n,e.count=0,e.thisArg=i||e,e}return ha(e,t),e.prototype._next=function(t){try{var e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(za),Bl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ha(e,t),e.prototype.notifyNext=function(t,e,n,i,r){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(za),Hu=function(t){function e(e,n,i){var r=t.call(this)||this;return r.parent=e,r.outerValue=n,r.outerIndex=i,r.index=0,r}return ha(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(za),XA=function(t){return function(e){return t.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,Oe),e}},xd="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",YA=function(t){return function(e){for(var n=t[xd]();;){var i=void 0;try{i=n.next()}catch(t){return e.error(t),e}if(i.done){e.complete();break}if(e.next(i.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e}},ZA=function(t){return function(e){var n=t[Pe]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)}},mn=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t},Tf=function(t){if(t&&"function"==typeof t[Pe])return ZA(t);if(mn(t))return en(t);if(kn(t))return XA(t);if(t&&"function"==typeof t[xd])return YA(t);throw t=Xi(t)?"an invalid object":"'"+t+"'",new TypeError("You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Ir={},aB=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new $A(t,this.resultSelector))},t}(),$A=function(t){function e(e,n){return(e=t.call(this,e)||this).resultSelector=n,e.active=0,e.values=[],e.observables=[],e}return ha(e,t),e.prototype._next=function(t){this.values.push(Ir),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.toRespond=this.active=e;for(var n=0;n<e;n++)this.add(bj(this,t[n],void 0,n))}},e.prototype.notifyComplete=function(t){0==--this.active&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n){var i=(t=this.values)[n];i=this.toRespond?i===Ir?--this.toRespond:this.toRespond:0,t[n]=e,0===i&&(this.resultSelector?this._tryResultSelector(t):this.destination.next(t.slice()))},e.prototype._tryResultSelector=function(t){try{var e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Bl),nd=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return ha(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(za);!function(t){function e(e,n,i){var r=t.call(this)||this;return r.parent=e,r.outerValue=n,r.outerIndex=i,r}ha(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(za);var od=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ha(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(za);!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}ha(e,t),e.prototype.notifyNext=function(t,e,n,i){this.destination.next(e)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()}}(za);var Lu=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new bB(t,this.project,this.concurrent))},t}(),bB=function(t){function e(e,n,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),(e=t.call(this,e)||this).project=n,e.concurrent=i,e.hasCompleted=!1,e.buffer=[],e.active=0,e.index=0,e}return ha(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e=this.index++;try{var n=this.project(t,e)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(n)},e.prototype._innerSub=function(t){var e=new nd(this),n=this.destination;n.add(e),(t=bd(t,e))!==e&&n.add(t)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,0<t.length?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(od),Cl=R.parseFloat,Jr=-1/0!=1/Cl("\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff-0")?function(t){t=Oj(String(t));var e=Cl(t);return 0===e&&"-"==t.charAt(0)?-0:e}:Cl;ea({global:!0,forced:parseFloat!=Jr},{parseFloat:Jr});var Dl=new ua(Ic),Qu=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new cB(t,this.predicate,this.thisArg))},t}(),cB=function(t){function e(e,n,i){return(e=t.call(this,e)||this).predicate=n,e.thisArg=i,e.count=0,e}return ha(e,t),e.prototype._next=function(t){try{var e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(za),Ru=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new dB(t))},t}(),dB=function(t){function e(e){return(e=t.call(this,e)||this).hasFirst=!1,e.observables=[],e.subscriptions=[],e}return ha(e,t),e.prototype._next=function(t){this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(var n=0;n<e&&!this.hasFirst;n++){var i=bj(this,t[n],void 0,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},e.prototype.notifyNext=function(t,e,n){if(!this.hasFirst){for(this.hasFirst=!0,t=0;t<this.subscriptions.length;t++)if(t!==n){var i=this.subscriptions[t];i.unsubscribe(),this.remove(i)}this.subscriptions=null}this.destination.next(e)},e}(Bl),Uu=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new eB(t,this.resultSelector))},t}(),eB=function(t){function e(e,n,i){return(e=t.call(this,e)||this).resultSelector=n,e.iterators=[],e.active=0,e.resultSelector="function"==typeof n?n:void 0,e}return ha(e,t),e.prototype._next=function(t){var e=this.iterators;hc(t)?e.push(new fB(t)):"function"==typeof t[xd]?e.push(new gB(t[xd]())):e.push(new hB(this.destination,this,t))},e.prototype._complete=function(){var t=this.iterators,e=t.length;if(this.unsubscribe(),0===e)this.destination.complete();else{this.active=e;for(var n=0;n<e;n++){var i=t[n];i.stillUnsubscribed?this.destination.add(i.subscribe()):this.active--}}},e.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},e.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,n=this.destination,i=0;i<e;i++){var r=t[i];if("function"==typeof r.hasValue&&!r.hasValue())return}var s=!1,o=[];for(i=0;i<e;i++){var a=(r=t[i]).next();if(r.hasCompleted()&&(s=!0),a.done)return void n.complete();o.push(a.value)}this.resultSelector?this._tryresultSelector(o):n.next(o),s&&n.complete()},e.prototype._tryresultSelector=function(t){try{var e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(za),gB=function(){function t(t){this.iterator=t,this.nextResult=t.next()}return t.prototype.hasValue=function(){return!0},t.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},t.prototype.hasCompleted=function(){var t=this.nextResult;return!(!t||!t.done)},t}(),fB=function(){function t(t){this.array=t,this.length=this.index=0,this.length=t.length}return t.prototype[xd]=function(){return this},t.prototype.next=function(t){t=this.index++;var e=this.array;return t<this.length?{value:e[t],done:!1}:{value:null,done:!0}},t.prototype.hasValue=function(){return this.array.length>this.index},t.prototype.hasCompleted=function(){return this.array.length===this.index},t}(),hB=function(t){function e(e,n,i){return(e=t.call(this,e)||this).parent=n,e.observable=i,e.stillUnsubscribed=!0,e.buffer=[],e.isComplete=!1,e}return ha(e,t),e.prototype[xd]=function(){return this},e.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},e.prototype.hasValue=function(){return 0<this.buffer.length},e.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},e.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(t){this.buffer.push(t),this.parent.checkIterators()},e.prototype.subscribe=function(){return bd(this.observable,new nd(this))},e}(od),iB=Object.freeze({__proto__:null,Observable:ua,ConnectableObservable:Dr,GroupedObservable:wl,observable:Pe,Subject:rb,BehaviorSubject:MA,ReplaySubject:Te,AsyncSubject:Sf,asap:TA,asapScheduler:kj,async:cd,asyncScheduler:zl,queue:Mg,queueScheduler:Mg,animationFrame:Gr,animationFrameScheduler:Gr,VirtualTimeScheduler:VA,VirtualAction:Hr,Scheduler:xl,Subscription:nb,Subscriber:za,Notification:yf,get NotificationKind(){return yl},pipe:Zi,noop:Ic,identity:wd,isObservable:function(t){return!!t&&(t instanceof ua||"function"==typeof t.lift&&"function"==typeof t.subscribe)},ArgumentOutOfRangeError:Al,EmptyError:eh,ObjectUnsubscribedError:Ld,UnsubscriptionError:Pf,TimeoutError:Tb,bindCallback:gn,bindNodeCallback:hn,combineLatest:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=e=void 0;return ad(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&hc(t[0])&&(t=t[0]),Rf(t,n).lift(new aB(e))},concat:nn,defer:yd,empty:Qf,forkJoin:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){var n=t[0];if(hc(n))return ch(n,null);if(Xi(n)&&Object.getPrototypeOf(n)===Object.prototype)return ch((t=Object.keys(n)).map((function(t){return n[t]})),t)}if("function"==typeof t[t.length-1]){var i=t.pop();return ch(t=1===t.length&&hc(t[0])?t[0]:t,null).pipe(Ea((function(t){return i.apply(void 0,t)})))}return ch(t,null)},from:Jc,fromEvent:Db,fromEventPattern:pn,generate:function(t,e,n,i,r){if(1==arguments.length){var s=t.initialState;e=t.condition,n=t.iterate;var o=t.resultSelector||wd;r=t.scheduler}else void 0===i||ad(i)?(s=t,o=wd,r=i):(s=t,o=i);return new ua((function(t){var i=s;if(r)return r.schedule(Mu,0,{subscriber:t,iterate:n,condition:e,resultSelector:o,state:i});for(;;){if(e){var a=void 0;try{a=e(i)}catch(e){t.error(e);break}if(!a){t.complete();break}}a=void 0;try{a=o(i)}catch(e){t.error(e);break}if(t.next(a),t.closed)break;try{i=n(i)}catch(e){t.error(e);break}}}))},iif:function(t,e,n){return void 0===e&&(e=Sb),void 0===n&&(n=Sb),yd((function(){return t()?e:n}))},interval:Qe,merge:Jb,never:function(){return Dl},of:ob,onErrorResumeNext:dj,pairs:function(t,e){return new ua(e?function(n){var i=Object.keys(t),r=new nb;return r.add(e.schedule(Ou,0,{keys:i,index:0,subscriber:n,subscription:r,obj:t})),r}:function(e){for(var n=Object.keys(t),i=0;i<n.length&&!e.closed;i++){var r=n[i];t.hasOwnProperty(r)&&e.next([r,t[r]])}e.complete()})},partition:function(t,e,n){return[yb(e,n)(new ua(Tf(t))),yb(Pu(e,n))(new ua(Tf(t)))]},race:fb,range:function(t,e,n){return void 0===t&&(t=0),new ua((function(i){void 0===e&&(e=t,t=0);var r=0,s=t;if(n)return n.schedule(Su,0,{index:r,count:e,start:t,subscriber:i});for(;;){if(r++>=e){i.complete();break}if(i.next(s++),i.closed)break}}))},throwError:ra,timer:dd,using:function(t,e){return new ua((function(n){try{var i=t()}catch(t){return void n.error(t)}try{var r=e(i)}catch(t){return void n.error(t)}var s=(r?Jc(r):Sb).subscribe(n);return function(){s.unsubscribe(),i&&i.unsubscribe()}}))},zip:ej,scheduled:ln,EMPTY:Sb,NEVER:Dl,config:gc}),Vu=function(){function t(t,e,n,i){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=n,this.scheduler=i}return t.prototype.call=function(t,e){return e.subscribe(new jB(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},t}(),kB=function(){this.buffer=[]},jB=function(t){function e(e,n,i,r,s){if((e=t.call(this,e)||this).bufferTimeSpan=n,e.bufferCreationInterval=i,e.maxBufferSize=r,e.scheduler=s,e.contexts=[],r=e.openContext(),e.timespanOnly=null==i||0>i,e.timespanOnly)e.add(r.closeAction=s.schedule(qn,n,{subscriber:e,context:r,bufferTimeSpan:n}));else{var o={bufferTimeSpan:n,bufferCreationInterval:i,subscriber:e,scheduler:s};e.add(r.closeAction=s.schedule(rn,n,{subscriber:e,context:r})),e.add(s.schedule(Wu,i,o))}return e}return ha(e,t),e.prototype._next=function(t){for(var e,n=this.contexts,i=n.length,r=0;r<i;r++){var s=n[r],o=s.buffer;o.push(t),o.length==this.maxBufferSize&&(e=s)}e&&this.onBufferFull(e)},e.prototype._error=function(e){this.contexts.length=0,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts,n=this.destination;0<e.length;){var i=e.shift();n.next(i.buffer)}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.contexts=null},e.prototype.onBufferFull=function(t){if(this.closeContext(t),(t=t.closeAction).unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){t=this.openContext();var e=this.bufferTimeSpan;this.add(t.closeAction=this.scheduler.schedule(qn,e,{subscriber:this,context:t,bufferTimeSpan:e}))}},e.prototype.openContext=function(){var t=new kB;return this.contexts.push(t),t},e.prototype.closeContext=function(t){this.destination.next(t.buffer);var e=this.contexts;0<=(e?e.indexOf(t):-1)&&e.splice(e.indexOf(t),1)},e}(za),Xu=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new lB(t,this.selector,this.caught))},t}(),lB=function(t){function e(e,n,i){return(e=t.call(this,e)||this).selector=n,e.caught=i,e}return ha(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle(),e=new nd(this),this.add(e),(n=bd(n,e))!==e&&this.add(n)}},e}(od),Yu=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new mB(t,this.defaultValue))},t}(),mB=function(t){function e(e,n){return(e=t.call(this,e)||this).defaultValue=n,e.isEmpty=!0,e}return ha(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(za),Zu=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new nB(t,this.delay,this.scheduler))},t}(),nB=function(t){function e(e,n,i){return(e=t.call(this,e)||this).delay=n,e.scheduler=i,e.queue=[],e.active=!1,e.errored=!1,e}return ha(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,i=t.scheduler,r=t.destination;0<n.length&&0>=n[0].time-i.now();)n.shift().notification.observe(r);0<n.length?(e=Math.max(0,n[0].time-i.now()),this.schedule(t,e)):(this.unsubscribe(),e.active=!1)},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler;t=new oB(e.now()+this.delay,t),this.queue.push(t),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(yf.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(yf.createComplete()),this.unsubscribe()},e}(za),oB=function(t,e){this.time=t,this.notification=e},$u=function(){function t(t,e){this.keySelector=t,this.flushes=e}return t.prototype.call=function(t,e){return e.subscribe(new pB(t,this.keySelector,this.flushes))},t}(),pB=function(t){function e(e,n,i){return(e=t.call(this,e)||this).keySelector=n,e.values=new Set,i&&e.add(bd(i,new nd(e))),e}return ha(e,t),e.prototype.notifyNext=function(){this.values.clear()},e.prototype.notifyError=function(t){this._error(t)},e.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},e.prototype._useKeySelector=function(t){var e=this.destination;try{var n=this.keySelector(t)}catch(t){return void e.error(t)}this._finalizeNext(n,t)},e.prototype._finalizeNext=function(t,e){var n=this.values;n.has(t)||(n.add(t),this.destination.next(e))},e}(od),bv=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,e){return e.subscribe(new qB(t,this.errorFactory))},t}(),qB=function(t){function e(e,n){return(e=t.call(this,e)||this).errorFactory=n,e.hasValue=!1,e}return ha(e,t),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)},e}(za),cv=function(){function t(t){if(this.total=t,0>this.total)throw new Al}return t.prototype.call=function(t,e){return e.subscribe(new rB(t,this.total))},t}(),rB=function(t){function e(e,n){return(e=t.call(this,e)||this).total=n,e.count=0,e}return ha(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(za),dv=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new sB(t,this.callback))},t}(),sB=function(t){function e(e,n){return(e=t.call(this,e)||this).add(new nb(n)),e}return ha(e,t),e}(za),fv=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new tB(t))},t}(),tB=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return ha(e,t),e.prototype._next=function(t){},e}(za),gv=function(){function t(t){if(this.total=t,0>this.total)throw new Al}return t.prototype.call=function(t,e){return e.subscribe(new uB(t,this.total))},t}(),uB=function(t){function e(e,n){return(e=t.call(this,e)||this).total=n,e.ring=[],e.count=0,e}return ha(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,i=this.count++;e.length<n?e.push(t):e[i%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(0<e)for(var n=this.count>=this.total?this.total:this.count,i=this.ring,r=0;r<n;r++){var s=e++%n;t.next(i[s])}t.complete()},e}(za),hv=function(){function t(t){this.value=t}return t.prototype.call=function(t,e){return e.subscribe(new vB(t,this.value))},t}(),vB=function(t){function e(e,n){return(e=t.call(this,e)||this).value=n,e}return ha(e,t),e.prototype._next=function(t){this.destination.next(this.value)},e}(za),iv=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new wB(t,this.accumulator,this.seed,this.hasSeed))},t}(),wB=function(t){function e(e,n,i,r){return(e=t.call(this,e)||this).accumulator=n,e._seed=i,e.hasSeed=r,e.index=0,e}return ha(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e=this.index++;try{var n=this.accumulator(this.seed,t,e)}catch(t){this.destination.error(t)}this.seed=n,this.destination.next(n)},e}(za),kv=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var n=this.selector,i=this.subjectFactory();return(t=n(i).subscribe(t)).add(e.subscribe(i)),t},t}(),mv=function(){function t(t,e){this.notifier=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new xB(t,this.notifier,this.source))},t}(),xB=function(t){function e(e,n,i){return(e=t.call(this,e)||this).notifier=n,e.source=i,e}return ha(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.errors,i=this.retries,r=this.retriesSubscription;if(i)this.retriesSubscription=this.errors=void 0;else{n=new rb;try{i=(0,this.notifier)(n)}catch(e){return t.prototype.error.call(this,e)}r=bd(i,new nd(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=i,this.retriesSubscription=r,n.next(e)}},e.prototype._unsubscribe=function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype.notifyNext=function(){var t=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=t,this.source.subscribe(this)},e}(od),pv=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new yB(t,this.project))},t}(),yB=function(t){function e(e,n){return(e=t.call(this,e)||this).project=n,e.index=0,e}return ha(e,t),e.prototype._next=function(t){var e=this.index++;try{var n=this.project(t,e)}catch(t){return void this.destination.error(t)}this._innerSub(n)},e.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe(),e=new nd(this);var n=this.destination;n.add(e),this.innerSubscription=bd(t,e),this.innerSubscription!==e&&n.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}(od),qv=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){t=new zB(t);var n=bd(this.notifier,new nd(t));return n&&!t.seenValue?(t.add(n),e.subscribe(t)):t},t}(),zB=function(t){function e(e){return(e=t.call(this,e)||this).seenValue=!1,e}return ha(e,t),e.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){},e}(od),rv=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new AB(t,this.nextOrObserver,this.error,this.complete))},t}(),AB=function(t){function e(e,n,i,r){return(e=t.call(this,e)||this)._tapNext=Ic,e._tapError=Ic,e._tapComplete=Ic,e._tapError=i||Ic,e._tapComplete=r||Ic,Ne(n)?(e._context=e,e._tapNext=n):n&&(e._context=n,e._tapNext=n.next||Ic,e._tapError=n.error||Ic,e._tapComplete=n.complete||Ic),e}return ha(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(za),tv={leading:!0,trailing:!1};!function(t){function e(e,n,i,r){var s=t.call(this,e)||this;return s.destination=e,s.durationSelector=n,s._leading=i,s._trailing=r,s._hasValue=!1,s}ha(e,t),e.prototype._next=function(t){this._hasValue=!0,this._sendValue=t,this._throttled||(this._leading?this.send():this.throttle(t))},e.prototype.send=function(){var t=this._sendValue;this._hasValue&&(this.destination.next(t),this.throttle(t)),this._hasValue=!1,this._sendValue=void 0},e.prototype.throttle=function(t){(t=this.tryDurationSelector(t))&&this.add(this._throttled=bd(t,new nd(this)))},e.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}},e.prototype.throttlingDone=function(){var t=this._throttled,e=this._trailing;t&&t.unsubscribe(),this._throttled=void 0,e&&this.send()},e.prototype.notifyNext=function(){this.throttlingDone()},e.prototype.notifyComplete=function(){this.throttlingDone()}}(od);for(var uv=function(){function t(t,e,n,i){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=i}return t.prototype.call=function(t,e){return e.subscribe(new BB(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),BB=function(t){function e(e,n,i,r,s){return(e=t.call(this,e)||this).duration=n,e.scheduler=i,e.leading=r,e.trailing=s,e._hasTrailingValue=!1,e._trailingValue=null,e}return ha(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(vv,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(za),xv=function(){function t(t,e,n,i){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=i}return t.prototype.call=function(t,e){return e.subscribe(new CB(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),CB=function(t){function e(e,n,i,r,s){return(e=t.call(this,e)||this).absoluteTimeout=n,e.waitFor=i,e.withObservable=r,e.scheduler=s,e.scheduleTimeout(),e}return ha(e,t),e.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add(bd(e,new nd(t)))},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},e.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},e}(od),zv=function(){function t(t,e){this.observables=t,this.project=e}return t.prototype.call=function(t,e){return e.subscribe(new DB(t,this.observables,this.project))},t}(),DB=function(t){function e(e,n,i){(e=t.call(this,e)||this).observables=n,e.project=i,e.toRespond=[],i=n.length,e.values=Array(i);for(var r=0;r<i;r++)e.toRespond.push(r);for(r=0;r<i;r++)e.add(bj(e,n[r],void 0,r));return e}return ha(e,t),e.prototype.notifyNext=function(t,e,n){this.values[n]=e,0<(t=this.toRespond).length&&-1!==(n=t.indexOf(n))&&t.splice(n,1)},e.prototype.notifyComplete=function(){},e.prototype._next=function(t){0===this.toRespond.length&&(t=[t].concat(this.values),this.project?this._tryProject(t):this.destination.next(t))},e.prototype._tryProject=function(t){try{var e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Bl),Kr=xb((function(t){var e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(e){var n=new Uint8Array(16);t.exports=function(){return e(n),n}}else{var i=Array(16);t.exports=function(){for(var t,e=0;16>e;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}})),zb=[],pi=0;256>pi;++pi)zb[pi]=(pi+256).toString(16).substr(1);var Lr=function(t,e){return e=e||0,[zb[t[e++]],zb[t[e++]],zb[t[e++]],zb[t[e++]],"-",zb[t[e++]],zb[t[e++]],"-",zb[t[e++]],zb[t[e++]],"-",zb[t[e++]],zb[t[e++]],"-",zb[t[e++]],zb[t[e++]],zb[t[e++]],zb[t[e++]],zb[t[e++]],zb[t[e++]]].join("")},Ng=function(t,e,n){if(n=e&&n||0,"string"==typeof t&&(e="binary"===t?Array(16):null,t=null),(t=(t=t||{}).random||(t.rng||Kr)())[6]=15&t[6]|64,t[8]=63&t[8]|128,e)for(var i=0;16>i;++i)e[n+i]=t[i];return e||Lr(t)},Og=Ng(),gj=!1,yn=new AbortController,pd,Md,El,Fl,Nd,qe,Fc,re,nc,Gl,qd,se,rd,sd,td,zf;!function(t){t[t.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",t[t.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",t[t.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",t[t.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",t[t.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",t[t.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",t[t.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"}(pd||(pd={})),function(t){t[t.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",t[t.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",t[t.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",t[t.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",t[t.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",t[t.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Md||(Md={})),function(t){t[t.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(El||(El={})),function(t){t[t.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Fl||(Fl={})),function(t){t[t.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",t[t.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",t[t.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",t[t.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",t[t.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",t[t.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(Nd||(Nd={})),function(t){t[t.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",t[t.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",t[t.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",t[t.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",t[t.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(qe||(qe={})),function(t){t[t.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",t[t.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",t[t.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",t[t.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",t[t.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",t[t.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",t[t.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",t[t.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",t[t.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",t[t.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",t[t.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(Fc||(Fc={})),function(t){t[t.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",t[t.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",t[t.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",t[t.LEAVE_CHANNEL_ERR_KICKED=4]="LEAVE_CHANNEL_ERR_KICKED",t[t.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(re||(re={})),function(t){t[t.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",t[t.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",t[t.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",t[t.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",t[t.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",t[t.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",t[t.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",t[t.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",t[t.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",t[t.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",t[t.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(nc||(nc={})),function(t){t[t.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Gl||(Gl={})),function(t){t[t.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",t[t.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",t[t.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",t[t.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",t[t.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",t[t.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",t[t.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(qd||(qd={})),function(t){t[t.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",t[t.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",t[t.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",t[t.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",t[t.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(se||(se={})),function(t){t[t.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",t[t.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",t[t.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",t[t.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",t[t.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",t[t.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",t[t.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",t[t.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(rd||(rd={})),function(t){t[t.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",t[t.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(t){t[t.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",t[t.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",t[t.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",t[t.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",t[t.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",t[t.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",t[t.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(td||(td={})),function(t){t[t.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",t[t.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",t[t.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",t[t.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(zf||(zf={}));var oc=pd.ATTRIBUTE_OPERATION_ERR_FAILURE,gb=pd.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,Ye=pd.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;pd.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Mr=pd.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,pc=pd.ATTRIBUTE_OPERATION_ERR_TIMEOUT,qc=pd.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,qi=Md.CHANNEL_MESSAGE_ERR_FAILURE,Hl=Md.CHANNEL_MESSAGE_ERR_TIMEOUT,Nr=Md.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Il=Md.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE,EB=Md.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL,Jl=Md.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,FB=El.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Or=Fl.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Pr=sd.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Qr=sd.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,GB=sd.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var HB=sd.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,IB=Nd.GET_MEMBERS_ERR_FAILURE,JB=Nd.GET_MEMBERS_ERR_REJECTED;Nd.GET_MEMBERS_ERR_TIMEOUT,Nd.GET_MEMBERS_ERR_TOO_OFTEN;var KB=Nd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,LB=Nd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,Xc=qe.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,MB=qe.INVITATION_API_CALL_ERR_NOT_STARTED,ri=qe.INVITATION_API_CALL_ERR_ALREADY_END,Rr=qe.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,NB=qe.INVITATION_API_CALL_ERR_ALREADY_SENT,Sr=Fc.JOIN_CHANNEL_ERR_FAILURE;Fc.JOIN_CHANNEL_ERR_REJECTED;var OB=Fc.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Tr=Fc.JOIN_CHANNEL_TIMEOUT,Ur=Fc.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Vr=Fc.JOIN_CHANNEL_ERR_ALREADY_JOINED;Fc.JOIN_CHANNEL_ERR_TOO_OFTEN;var Wr=Fc.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Xr=Fc.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Yr=re.LEAVE_CHANNEL_ERR_FAILURE,Zr=re.LEAVE_CHANNEL_ERR_REJECTED,PB=re.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,QB=re.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,RB=re.LEAVE_CHANNEL_ERR_KICKED,$r=nc.LOGIN_ERR_UNKNOWN,Pg=nc.LOGIN_ERR_REJECTED,si=nc.LOGIN_ERR_INVALID_ARGUMENT,as=nc.LOGIN_ERR_INVALID_APP_ID,bs=nc.LOGIN_ERR_INVALID_TOKEN,ti=nc.LOGIN_ERR_TOKEN_EXPIRED;nc.LOGIN_ERR_NOT_AUTHORIZED;var SB=nc.LOGIN_ERR_ALREADY_LOGIN,TB=nc.LOGIN_ERR_TIMEOUT,UB=nc.LOGIN_ERR_TOO_OFTEN,cs=Gl.LOGOUT_ERR_USER_NOT_LOGGED_IN,ds=qd.PEER_MESSAGE_ERR_FAILURE,Kl=qd.PEER_MESSAGE_ERR_TIMEOUT,es=qd.PEER_MESSAGE_ERR_TOO_OFTEN,fs=qd.PEER_MESSAGE_ERR_INVALID_USERID,bg=qd.PEER_MESSAGE_ERR_INVALID_MESSAGE,Ll=qd.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN;qd.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE;var gs=se.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;se.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var VB=se.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;se.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var WB=se.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,Ml=rd.RENEW_TOKEN_ERR_FAILURE,XB=rd.RENEW_TOKEN_ERR_INVALID_ARGUMENT;rd.RENEW_TOKEN_ERR_REJECTED,rd.RENEW_TOKEN_ERR_TOO_OFTEN;var YB=rd.RENEW_TOKEN_ERR_TOKEN_EXPIRED,ZB=rd.RENEW_TOKEN_ERR_INVALID_TOKEN,hs=rd.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,is=td.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,Qg=td.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;td.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var $B=td.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;td.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var js=td.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,Nl=td.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var aC=function(t,e){var n;return rl(t,(function(t,i,r){return!(n=e(t,i,r))})),!!n},ui=function(t,e,n){if(!Gb(n))return!1;var i=qa(e);return!!("number"==i?ae(n)&&gl(e,n.length):"string"==i&&e in n)&&Gg(n[e],t)},Ol=function(t,e,n){var i=ub(t)?ur:aC;return n&&ui(t,e,n)&&(e=void 0),i(t,wf(e))},bC=function(t,e){var n=-1,i=ae(t)?Array(t.length):[];return rl(t,(function(t,r,s){i[++n]=e(t,r,s)})),i},cC=function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t},dC=function(t,e,n){e=e.length?Je(e,(function(t){return ub(t)?function(e){return li(e,1===t.length?t[0]:t)}:t})):[mi];var i=-1;return e=Je(e,ii(wf)),t=bC(t,(function(t,n,r){return{criteria:Je(e,(function(e){return e(t)})),index:++i,value:t}})),cC(t,(function(t,e){t:{for(var i=-1,r=t.criteria,s=e.criteria,o=r.length,a=n.length;++i<o;){e:{var c=r[i],l=s[i];if(c!==l){var u=void 0!==c,d=null===c,h=c==c,A=Ke(c),p=void 0!==l,f=null===l,m=l==l,g=Ke(l);if(!f&&!g&&!A&&c>l||A&&p&&m&&!f&&!g||d&&p&&m||!u&&m||!h){c=1;break e}if(!d&&!A&&!g&&c<l||g&&u&&h&&!d&&!A||f&&u&&h||!p&&h||!m){c=-1;break e}}c=0}if(c){t=i>=a?c:c*("desc"==n[i]?-1:1);break t}}t=t.index-e.index}return t}))},ks=function(t,e){return sr(rr(t,e,mi),t+"")},ls=ks((function(t,e){if(null==t)return[];var n=e.length;return 1<n&&ui(t,e[0],e[1])?e=[]:2<n&&ui(e[0],e[1],e[2])&&(e=[e[0]]),dC(t,Si(e,1),[])})),ms=function(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})})),e}(iB),ns=xb((function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=[],i=function(t,e){return new WebSocket(t,e)};e.normalClosureMessage="Normal closure",e.default=function(t,r){var s=(r=void 0===r?{protocols:n,makeWebSocket:i}:r).protocols,o=void 0===s?n:s,a=void 0===(r=r.makeWebSocket)?i:r;return new ms.Observable((function(n){var i,r=new ms.Subject,s=a(t,o),c=!1,l=!1,u=function(t){if(i)throw c=!0,t=Error("Web socket message factory function called more than once"),n.error(t),t;return i=t.subscribe((function(t){s.send(t)})),r};return s.onopen=function(){l?(c=!0,s.close()):n.next(u)},s.onmessage=function(t){r.next(t.data)},s.onerror=function(t){c=!0,n.error(Error(t.message))},s.onclose=function(t){c||(c=!0,l?(n.complete(),r.complete()):n.error(Error(1e3===t.code?e.normalClosureMessage:t.reason)))},function(){l=!0,i&&i.unsubscribe(),c||(c=!0,s.close())}}))}}));!function(t){t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")&&t.default}(ns);var ij=function(t,e,n){(void 0===n||Gg(t[e],n))&&(void 0!==n||e in t)||Ig(t,e,n)},hj=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},eC=function(t){return ks((function(e,n){var i=-1,r=n.length,s=1<r?n[r-1]:void 0,o=2<r?n[2]:void 0;for(s=3<t.length&&"function"==typeof s?(r--,s):void 0,o&&ui(n[0],n[1],o)&&(s=3>r?void 0:s,r=1),e=Object(e);++i<r;)(o=n[i])&&t(e,o,i,s);return e}))}((function(t,e,n,i){zn(t,e,n,i)})),fC=Math.floor,gC=Math.random,os=function(t,e){return t+fC(gC()*(e-t+1))},ps=function(t){var e=t.length;return e?t[os(0,e-1)]:void 0},hC=function(t,e){return Je(e,(function(e){return t[e]}))},zj=function(t){return null==t?[]:hC(t,Wd(t))},iC=function(t){return ps(zj(t))},On=function(t){return(ub(t)?ps:iC)(t)},Dn=[],En=function(t,e){return new WebSocket(t,e)},jC=Math.floor;ea({target:"Number",stat:!0},{isInteger:function(t){return!xa(t)&&isFinite(t)&&jC(t)===t}}),Sp("from",sk,rk);var kC=function(t,e){for(var n=Array(arguments.length-1),i=0,r=2,s=!0;r<arguments.length;)n[i++]=arguments[r++];return new Promise((function(r,o){n[i]=function(t){if(s)if(s=!1,t)o(t);else{for(var e=Array(arguments.length-1),n=0;n<e.length;)e[n++]=arguments[n];r.apply(null,e)}};try{t.apply(e||null,n)}catch(t){s&&(s=!1,o(t))}}))},lC=xb((function(t,e){e.length=function(t){var e=t.length;if(!e)return 0;for(var n=0;1<--e%4&&"="===t.charAt(e);)++n;return Math.ceil(3*t.length)/4-n};var n=Array(64),i=Array(123);for(t=0;64>t;)i[n[t]=26>t?t+65:52>t?t+71:62>t?t-4:t-59|43]=t++;e.encode=function(t,e,i){for(var r,s=null,o=[],a=0,c=0;e<i;){var l=t[e++];switch(c){case 0:o[a++]=n[l>>2],r=(3&l)<<4,c=1;break;case 1:o[a++]=n[r|l>>4],r=(15&l)<<2,c=2;break;case 2:o[a++]=n[r|l>>6],o[a++]=n[63&l],c=0}8191<a&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return c&&(o[a++]=n[r],o[a++]=61,1===c&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))},e.decode=function(t,e,n){for(var r,s=n,o=0,a=0;a<t.length;){var c=t.charCodeAt(a++);if(61===c&&1<o)break;if(void 0===(c=i[c]))throw Error("invalid encoding");switch(o){case 0:r=c,o=1;break;case 1:e[n++]=r<<2|(48&c)>>4,r=c,o=2;break;case 2:e[n++]=(15&r)<<4|(60&c)>>2,r=c,o=3;break;case 3:e[n++]=(3&r)<<6|c,o=0}}if(1===o)throw Error("invalid encoding");return n-s},e.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}}));hh.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},hh.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else{t=this._listeners[t];for(var n=0;n<t.length;)t[n].fn===e?t.splice(n,1):++n}return this},hh.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<e.length;)e[i].fn.apply(e[i++].ctx,n)}return this};var mC=Fn(Fn),nC=function(c){try{var b=eval("quire".replace(/^/,"re"))(c);if(b&&(b.length||Object.keys(b).length))return b}catch(t){}return null},oC=xb((function(t,e){e.length=function(t){for(var e,n=0,i=0;i<t.length;++i)128>(e=t.charCodeAt(i))?n+=1:2048>e?n+=2:55296==(64512&e)&&56320==(64512&t.charCodeAt(i+1))?(++i,n+=4):n+=3;return n},e.read=function(t,e,n){if(1>n-e)return"";for(var i,r=null,s=[],o=0;e<n;)128>(i=t[e++])?s[o++]=i:191<i&&224>i?s[o++]=(31&i)<<6|63&t[e++]:239<i&&365>i?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,s[o++]=55296+(i>>10),s[o++]=56320+(1023&i)):s[o++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],8191<o&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),o=0);return r?(o&&r.push(String.fromCharCode.apply(String,s.slice(0,o))),r.join("")):String.fromCharCode.apply(String,s.slice(0,o))},e.write=function(t,e,n){for(var i,r,s=n,o=0;o<t.length;++o)128>(i=t.charCodeAt(o))?e[n++]=i:(2048>i?e[n++]=i>>6|192:(55296==(64512&i)&&56320==(64512&(r=t.charCodeAt(o+1)))?(i=65536+((1023&i)<<10)+(1023&r),++o,e[n++]=i>>18|240,e[n++]=i>>12&63|128):e[n++]=i>>12|224,e[n++]=i>>6&63|128),e[n++]=63&i|128);return n-s}})),pC=function(t,e,n){var i=n||8192,r=i>>>1,s=null,o=i;return function(n){return 1>n||n>r?t(n):(o+n>i&&(s=t(i),o=0),n=e.call(s,o,o+=n),7&o&&(o=1+(7|o)),n)}},te=vb.zero=new vb(0,0);te.toNumber=function(){return 0},te.zzEncode=te.zzDecode=function(){return this},te.length=function(){return 1};var qC=vb.zeroHash="\0\0\0\0\0\0\0\0";vb.fromNumber=function(t){if(0===t)return te;var e=0>t;e&&(t=-t);var n=t>>>0;return t=(t-n)/4294967296>>>0,e&&(t=~t>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++t&&(t=0))),new vb(n,t)},vb.from=function(t){if("number"==typeof t)return vb.fromNumber(t);if(pa.isString(t)){if(!pa.Long)return vb.fromNumber(parseInt(t,10));t=pa.Long.fromString(t)}return t.low||t.high?new vb(t.low>>>0,t.high>>>0):te},vb.prototype.toNumber=function(t){if(!t&&this.hi>>>31){t=1+~this.lo>>>0;var e=~this.hi>>>0;return t||(e=e+1>>>0),-(t+4294967296*e)}return this.lo+4294967296*this.hi},vb.prototype.toLong=function(t){return pa.Long?new pa.Long(0|this.lo,0|this.hi,!!t):{low:0|this.lo,high:0|this.hi,unsigned:!!t}};var Od=String.prototype.charCodeAt;vb.fromHash=function(t){return t===qC?te:new vb((Od.call(t,0)|Od.call(t,1)<<8|Od.call(t,2)<<16|Od.call(t,3)<<24)>>>0,(Od.call(t,4)|Od.call(t,5)<<8|Od.call(t,6)<<16|Od.call(t,7)<<24)>>>0)},vb.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},vb.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},vb.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},vb.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?16384>t?128>t?1:2:2097152>t?3:4:16384>e?128>e?5:6:2097152>e?7:8:128>n?9:10};var pa=xb((function(t,e){function n(t,e,n){for(var i=Object.keys(e),r=0;r<i.length;++r)void 0!==t[i[r]]&&n||(t[i[r]]=e[i[r]]);return t}function i(t){function e(t,i){if(!(this instanceof e))return new e(t,i);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:Error().stack||""}),i&&n(this,i)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}e.asPromise=kC,e.base64=lC,e.EventEmitter=hh,e.float=mC,e.inquire=nC,e.utf8=oC,e.pool=pC,e.LongBits=vb,e.isNode=!!(void 0!==Ya&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),e.global=e.isNode&&Ya||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||Ya,e.emptyArray=Object.freeze?Object.freeze([]):[],e.emptyObject=Object.freeze?Object.freeze({}):{},e.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},e.isString=function(t){return"string"==typeof t||t instanceof String},e.isObject=function(t){return t&&"object"===qa(t)},e.isset=e.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!==qa(n)||0<(Array.isArray(n)?n.length:Object.keys(n).length))},e.Buffer=function(){try{var t=e.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(t){return null}}(),e._Buffer_from=null,e._Buffer_allocUnsafe=null,e.newBuffer=function(t){return"number"==typeof t?e.Buffer?e._Buffer_allocUnsafe(t):new e.Array(t):e.Buffer?e._Buffer_from(t):"undefined"==typeof Uint8Array?t:new Uint8Array(t)},e.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,e.Long=e.global.dcodeIO&&e.global.dcodeIO.Long||e.global.Long||e.inquire("long"),e.key2Re=/^true|false|0|1$/,e.key32Re=/^-?(?:0|[1-9][0-9]*)$/,e.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,e.longToHash=function(t){return t?e.LongBits.from(t).toHash():e.LongBits.zeroHash},e.longFromHash=function(t,n){return t=e.LongBits.fromHash(t),e.Long?e.Long.fromBits(t.lo,t.hi,n):t.toNumber(!!n)},e.merge=n,e.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},e.newError=i,e.ProtocolError=i("ProtocolError"),e.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;-1<n;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},e.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},e.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},e._configure=function(){var t=e.Buffer;t?(e._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},e._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):e._Buffer_from=e._Buffer_allocUnsafe=null}})),qj=Aa,Pl,vi=pa.LongBits,qs=pa.base64,rs=pa.utf8,ss=function(){return pa.Buffer?function(){return(Aa.create=function(){return new Pl})()}:function(){return new Aa}};Aa.create=ss(),Aa.alloc=function(t){return new pa.Array(t)},pa.Array!==Array&&(Aa.alloc=pa.pool(Aa.alloc,pa.Array.prototype.subarray)),Aa.prototype._push=function(t,e,n){return this.tail=this.tail.next=new Wf(t,e,n),this.len+=e,this},nj.prototype=Object.create(Wf.prototype),nj.prototype.fn=function(t,e,n){for(;127<t;)e[n++]=127&t|128,t>>>=7;e[n]=t},Aa.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new nj(128>(t>>>=0)?1:16384>t?2:2097152>t?3:268435456>t?4:5,t)).len,this},Aa.prototype.int32=function(t){return 0>t?this._push(oj,10,vi.fromNumber(t)):this.uint32(t)},Aa.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},Aa.prototype.uint64=function(t){return t=vi.from(t),this._push(oj,t.length(),t)},Aa.prototype.int64=Aa.prototype.uint64,Aa.prototype.sint64=function(t){return t=vi.from(t).zzEncode(),this._push(oj,t.length(),t)},Aa.prototype.bool=function(t){return this._push(mj,1,t?1:0)},Aa.prototype.fixed32=function(t){return this._push(pj,4,t>>>0)},Aa.prototype.sfixed32=Aa.prototype.fixed32,Aa.prototype.fixed64=function(t){return t=vi.from(t),this._push(pj,4,t.lo)._push(pj,4,t.hi)},Aa.prototype.sfixed64=Aa.prototype.fixed64,Aa.prototype.float=function(t){return this._push(pa.float.writeFloatLE,4,t)},Aa.prototype.double=function(t){return this._push(pa.float.writeDoubleLE,8,t)};var rC=pa.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var i=0;i<t.length;++i)e[n+i]=t[i]};Aa.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(mj,1,0);if(pa.isString(t)){var n=Aa.alloc(e=qs.length(t));qs.decode(t,n,0),t=n}return this.uint32(e)._push(rC,e,t)},Aa.prototype.string=function(t){var e=rs.length(t);return e?this.uint32(e)._push(rs.write,e,t):this._push(mj,1,0)},Aa.prototype.fork=function(){return this.states=new Cv(this),this.head=this.tail=new Wf(lj,0,0),this.len=0,this},Aa.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Wf(lj,0,0),this.len=0),this},Aa.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},Aa.prototype.finish=function(){for(var t=this.head.next,e=this.constructor.alloc(this.len),n=0;t;)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},Aa._configure=function(t){Pl=t,Aa.create=ss(),Pl._configure()},(Lc.prototype=Object.create(qj.prototype)).constructor=Lc,Lc._configure=function(){Lc.alloc=pa._Buffer_allocUnsafe,Lc.writeBytesBuffer=pa.Buffer&&pa.Buffer.prototype instanceof Uint8Array&&"set"===pa.Buffer.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var i=0;i<t.length;)e[n++]=t[i++]}},Lc.prototype.bytes=function(t){pa.isString(t)&&(t=pa._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(Lc.writeBytesBuffer,e,t),this},Lc.prototype.string=function(t){var e=pa.Buffer.byteLength(t);return this.uint32(e),e&&this._push(Dv,e,t),this},Lc._configure();var sj=ib,Ql,Kn=pa.LongBits,sC=pa.utf8,ts="undefined"!=typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new ib(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new ib(t);throw Error("illegal buffer")},us=function(){return pa.Buffer?function(t){return(ib.create=function(t){return pa.Buffer.isBuffer(t)?new Ql(t):ts(t)})(t)}:ts};ib.create=us(),ib.prototype._slice=pa.Array.prototype.subarray||pa.Array.prototype.slice,ib.prototype.uint32=function(){var t=4294967295;return function(){if(t=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return t;if((this.pos+=5)>this.len)throw this.pos=this.len,wc(this,10);return t}}(),ib.prototype.int32=function(){return 0|this.uint32()},ib.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},ib.prototype.bool=function(){return 0!==this.uint32()},ib.prototype.fixed32=function(){if(this.pos+4>this.len)throw wc(this,4);return ih(this.buf,this.pos+=4)},ib.prototype.sfixed32=function(){if(this.pos+4>this.len)throw wc(this,4);return 0|ih(this.buf,this.pos+=4)},ib.prototype.float=function(){if(this.pos+4>this.len)throw wc(this,4);var t=pa.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},ib.prototype.double=function(){if(this.pos+8>this.len)throw wc(this,4);var t=pa.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},ib.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw wc(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},ib.prototype.string=function(){var t=this.bytes();return sC.read(t,0,t.length)},ib.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw wc(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw wc(this)}while(128&this.buf[this.pos++]);return this},ib.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},ib._configure=function(t){Ql=t,ib.create=us(),Ql._configure();var e=pa.Long?"toLong":"toNumber";pa.merge(ib.prototype,{int64:function(){return rj.call(this)[e](!1)},uint64:function(){return rj.call(this)[e](!0)},sint64:function(){return rj.call(this).zzDecode()[e](!1)},fixed64:function(){return Ln.call(this)[e](!0)},sfixed64:function(){return Ln.call(this)[e](!1)}})},(be.prototype=Object.create(sj.prototype)).constructor=be,be._configure=function(){pa.Buffer&&(be.prototype._slice=pa.Buffer.prototype.slice)},be.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},be._configure(),(Xf.prototype=Object.create(pa.EventEmitter.prototype)).constructor=Xf,Xf.prototype.rpcCall=function t(e,n,i,r,s){if(!r)throw TypeError("request must be specified");var o=this;if(!s)return pa.asPromise(t,o,e,n,i,r);if(o.rpcImpl)try{return o.rpcImpl(e,n[o.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(t,n){if(t)return o.emit("error",t,e),s(t);if(null!==n){if(!(n instanceof i))try{n=i[o.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return o.emit("error",t,e),s(t)}return o.emit("data",n,e),s(null,n)}o.end(!0)}))}catch(t){o.emit("error",t,e),setTimeout((function(){s(t)}),0)}else setTimeout((function(){s(Error("already ended"))}),0)},Xf.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var tC=xb((function(t,e){e.Service=Xf})),uC={},Gc=xb((function(t,e){function n(){i.util._configure(),i.Writer._configure(i.BufferWriter),i.Reader._configure(i.BufferReader)}var i=e;i.build="minimal",i.Writer=qj,i.BufferWriter=Lc,i.Reader=sj,i.BufferReader=be,i.util=pa,i.rpc=tC,i.roots=uC,i.configure=n,n()}));Gc.util.Long=P,Gc.configure();var M=Gc.Reader,ia=Gc.Writer,D=Gc.util,I=Gc.roots.default||(Gc.roots.default={}),vC=I.URI=function(){var t={},e=Object.create(t);return e[t[0]="Unknown"]=0,e[t[1]="PingUri"]=1,e[t[2]="PongUri"]=2,e[t[11]="UserJoinUri"]=11,e[t[12]="UserRespUri"]=12,e[t[15]="UserTicketNearlyExpireUri"]=15,e[t[16]="UserRenewTokenReqUri"]=16,e[t[17]="UserRenewTokenRespUri"]=17,e[t[21]="UserQuitUri"]=21,e[t[22]="UserDropUri"]=22,e[t[31]="GroupEnterUri"]=31,e[t[32]="GroupLeaveUri"]=32,e[t[33]="GroupReplyUri"]=33,e[t[35]="GroupDropUri"]=35,e[t[36]="GroupEnterNoticeUri"]=36,e[t[37]="GroupLeaveNoticeUri"]=37,e[t[38]="GroupEventNoticeUri"]=38,e[t[39]="GroupCountNoticeUri"]=39,e[t[41]="UserStatusListUri"]=41,e[t[42]="UserStatusResultUri"]=42,e[t[51]="GroupStatusListUri"]=51,e[t[52]="GroupStatusResultUri"]=52,e[t[55]="GroupAllUsersListUri"]=55,e[t[56]="GroupAllUsersResultUri"]=56,e[t[100]="MessageUri"]=100,e[t[101]="AckUri"]=101,e[t[201]="UserJoinNoticeUri"]=201,e[t[202]="UserQuitNoticeUri"]=202,e[t[203]="UserWaitNoticeUri"]=203,e[t[301]="UserAttributeGetUri"]=301,e[t[302]="UserAttributeRetUri"]=302,e[t[303]="UserAttributeSetUri"]=303,e[t[304]="UserAttributeModUri"]=304,e[t[305]="UserAttributeDelUri"]=305,e[t[307]="UserAttributeRspUri"]=307,e[t[308]="UserAttributeErrUri"]=308,e[t[311]="UserAttributeKeysGetUri"]=311,e[t[312]="UserAttributeKeysRetUri"]=312,e[t[351]="GroupAttributeGetUri"]=351,e[t[352]="GroupAttributeRetUri"]=352,e[t[353]="GroupAttributeSetUri"]=353,e[t[354]="GroupAttributeModUri"]=354,e[t[355]="GroupAttributeDelUri"]=355,e[t[356]="GroupAttributeAltUri"]=356,e[t[357]="GroupAttributeRspUri"]=357,e[t[358]="GroupAttributeErrUri"]=358,e[t[361]="GroupAttributeKeysGetUri"]=361,e[t[362]="GroupAttributeKeysRetUri"]=362,e[t[401]="SubscribeUserStatusUri"]=401,e[t[402]="UnsubscribeUserStatusUri"]=402,e[t[499]="SubscribeResponseUri"]=499,e}(),wi=I.Wrapper=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.uri=0,t.prototype.data=D.newBuffer([]),t.encode=function(t,e){return e||(e=ia.create()),null!=t.uri&&Object.hasOwnProperty.call(t,"uri")&&e.uint32(8).int32(t.uri),null!=t.data&&Object.hasOwnProperty.call(t,"data")&&e.uint32(18).bytes(t.data),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.Wrapper;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.uri=t.int32();break;case 2:n.data=t.bytes();break;default:t.skipType(7&i)}}return n},t}(),wC=I.Ping=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.ms&&Object.hasOwnProperty.call(t,"ms")&&e.uint32(16).uint64(t.ms),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.Ping;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.ms=t.uint64();break;default:t.skipType(7&i)}}return n},t}(),xC=I.Pong=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.ms&&Object.hasOwnProperty.call(t,"ms")&&e.uint32(16).uint64(t.ms),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.Pong;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.ms=t.uint64();break;default:t.skipType(7&i)}}return n},t}(),yC=I.UserJoin=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.opt=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.account="",t.prototype.ticket="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.opt&&Object.hasOwnProperty.call(t,"opt")&&e.uint32(16).uint64(t.opt),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(24).uint64(t.instance),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(34).string(t.account),null!=t.ticket&&Object.hasOwnProperty.call(t,"ticket")&&e.uint32(42).string(t.ticket),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserJoin;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.opt=t.uint64();break;case 3:n.instance=t.uint64();break;case 4:n.account=t.string();break;case 5:n.ticket=t.string();break;default:t.skipType(7&i)}}return n},t}(),zC=I.UserResp=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.account="",t.prototype.code=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(24).uint32(t.code),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserResp;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.account=t.string();break;case 3:n.code=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),AC=I.UserQuit=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.encode=function(t,e){return e||(e=ia.create()),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserQuit;t.pos<e;){var i=t.uint32();t.skipType(7&i)}return n},t}(),BC=I.UserDrop=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.code=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(8).uint32(t.code),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserDrop;t.pos<e;){var i=t.uint32();if(i>>>3==1)n.code=t.uint32();else t.skipType(7&i)}return n},t}(),CC=I.UserTicketNearlyExpire=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.expireTs=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.ticket="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.expireTs&&Object.hasOwnProperty.call(t,"expireTs")&&e.uint32(8).uint64(t.expireTs),null!=t.ticket&&Object.hasOwnProperty.call(t,"ticket")&&e.uint32(18).string(t.ticket),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserTicketNearlyExpire;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.expireTs=t.uint64();break;case 2:n.ticket=t.string();break;default:t.skipType(7&i)}}return n},t}(),DC=I.UserRenewTokenReq=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.account="",t.prototype.ticket="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(16).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(26).string(t.account),null!=t.ticket&&Object.hasOwnProperty.call(t,"ticket")&&e.uint32(34).string(t.ticket),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserRenewTokenReq;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.instance=t.uint64();break;case 2:n.seq=t.uint64();break;case 3:n.account=t.string();break;case 4:n.ticket=t.string();break;default:t.skipType(7&i)}}return n},t}(),EC=I.UserRenewTokenResp=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.code=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(16).uint32(t.code),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserRenewTokenResp;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.code=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),FC=I.GroupEnter=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.account="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupEnter;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.account=t.string();break;default:t.skipType(7&i)}}return n},t}(),GC=I.GroupLeave=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.account="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(10).string(t.account),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupLeave;t.pos<e;){var i=t.uint32();if(i>>>3==1)n.account=t.string();else t.skipType(7&i)}return n},t}(),HC=I.GroupReply=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.account="",t.prototype.code=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(24).uint32(t.code),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupReply;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.account=t.string();break;case 3:n.code=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),vs=I.GroupLeaveNotice=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.user="",t.prototype.group="",t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.size=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.user&&Object.hasOwnProperty.call(t,"user")&&e.uint32(18).string(t.user),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(26).string(t.group),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(32).uint64(t.instance),null!=t.size&&Object.hasOwnProperty.call(t,"size")&&e.uint32(40).uint32(t.size),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupLeaveNotice;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.user=t.string();break;case 3:n.group=t.string();break;case 4:n.instance=t.uint64();break;case 5:n.size=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),ws=I.GroupEnterNotice=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.user="",t.prototype.group="",t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.size=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.user&&Object.hasOwnProperty.call(t,"user")&&e.uint32(18).string(t.user),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(26).string(t.group),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(32).uint64(t.instance),null!=t.size&&Object.hasOwnProperty.call(t,"size")&&e.uint32(40).uint32(t.size),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupEnterNotice;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.user=t.string();break;case 3:n.group=t.string();break;case 4:n.instance=t.uint64();break;case 5:n.size=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),xs=I.Message=function(){function t(t){if(this.MiscMap={},t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.dialogue=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.sequence=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.options=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.src="",t.prototype.dst="",t.prototype.payload=D.newBuffer([]),t.prototype.MiscMap=D.emptyObject,t.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.dialogue&&Object.hasOwnProperty.call(t,"dialogue")&&e.uint32(16).uint64(t.dialogue),null!=t.sequence&&Object.hasOwnProperty.call(t,"sequence")&&e.uint32(24).uint64(t.sequence),null!=t.options&&Object.hasOwnProperty.call(t,"options")&&e.uint32(32).uint64(t.options),null!=t.src&&Object.hasOwnProperty.call(t,"src")&&e.uint32(42).string(t.src),null!=t.dst&&Object.hasOwnProperty.call(t,"dst")&&e.uint32(50).string(t.dst),null!=t.payload&&Object.hasOwnProperty.call(t,"payload")&&e.uint32(58).bytes(t.payload),null!=t.MiscMap&&Object.hasOwnProperty.call(t,"MiscMap"))for(var n=Object.keys(t.MiscMap),i=0;i<n.length;++i)e.uint32(66).fork().uint32(10).string(n[i]).uint32(18).bytes(t.MiscMap[n[i]]).ldelim();return null!=t.ms&&Object.hasOwnProperty.call(t,"ms")&&e.uint32(72).uint64(t.ms),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n,i,r=new I.Message;t.pos<e;)switch(n=t.uint32(),n>>>3){case 1:r.instance=t.uint64();break;case 2:r.dialogue=t.uint64();break;case 3:r.sequence=t.uint64();break;case 4:r.options=t.uint64();break;case 5:r.src=t.string();break;case 6:r.dst=t.string();break;case 7:r.payload=t.bytes();break;case 8:r.MiscMap===D.emptyObject&&(r.MiscMap={});var s=t.uint32()+t.pos;for(n="",i=[];t.pos<s;){var o=t.uint32();switch(o>>>3){case 1:n=t.string();break;case 2:i=t.bytes();break;default:t.skipType(7&o)}}r.MiscMap[n]=i;break;case 9:r.ms=t.uint64();break;default:t.skipType(7&n)}return r},t}(),ys=I.Ack=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.dialogue=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.sequence=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.code=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.dialogue&&Object.hasOwnProperty.call(t,"dialogue")&&e.uint32(16).uint64(t.dialogue),null!=t.sequence&&Object.hasOwnProperty.call(t,"sequence")&&e.uint32(24).uint64(t.sequence),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(32).uint32(t.code),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.Ack;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.instance=t.uint64();break;case 2:n.dialogue=t.uint64();break;case 3:n.sequence=t.uint64();break;case 4:n.code=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),IC=I.GroupDrop=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.account="",t.prototype.code=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(10).string(t.account),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(16).uint32(t.code),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupDrop;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.account=t.string();break;case 2:n.code=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),JC=I.GroupAllUsersList=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.group="",t.prototype.pageSize=0,t.prototype.pageNumber=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),null!=t.pageSize&&Object.hasOwnProperty.call(t,"pageSize")&&e.uint32(24).uint32(t.pageSize),null!=t.pageNumber&&Object.hasOwnProperty.call(t,"pageNumber")&&e.uint32(32).uint32(t.pageNumber),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAllUsersList;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.group=t.string();break;case 3:n.pageSize=t.uint32();break;case 4:n.pageNumber=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),KC=I.GroupAllUsersResult=function(){function t(t){if(this.memberInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.group="",t.prototype.totalSize=0,t.prototype.pageSize=0,t.prototype.pageNumber=0,t.prototype.memberInfos=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),null!=t.totalSize&&Object.hasOwnProperty.call(t,"totalSize")&&e.uint32(24).uint32(t.totalSize),null!=t.pageSize&&Object.hasOwnProperty.call(t,"pageSize")&&e.uint32(32).uint32(t.pageSize),null!=t.pageNumber&&Object.hasOwnProperty.call(t,"pageNumber")&&e.uint32(40).uint32(t.pageNumber),null!=t.memberInfos&&t.memberInfos.length)for(var n=0;n<t.memberInfos.length;++n)I.GroupAllUsersResult.MemberInfo.encode(t.memberInfos[n],e.uint32(50).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAllUsersResult;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.group=t.string();break;case 3:n.totalSize=t.uint32();break;case 4:n.pageSize=t.uint32();break;case 5:n.pageNumber=t.uint32();break;case 6:n.memberInfos&&n.memberInfos.length||(n.memberInfos=[]),n.memberInfos.push(I.GroupAllUsersResult.MemberInfo.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.MemberInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.account="",t.prototype.ts=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(10).string(t.account),null!=t.ts&&Object.hasOwnProperty.call(t,"ts")&&e.uint32(16).uint32(t.ts),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAllUsersResult.MemberInfo;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.account=t.string();break;case 2:n.ts=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),t}(),LC=I.UserStatusList=function(){function t(t){if(this.users=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.users=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.users&&t.users.length)for(var n=0;n<t.users.length;++n)e.uint32(18).string(t.users[n]);return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserStatusList;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.users&&n.users.length||(n.users=[]),n.users.push(t.string());break;default:t.skipType(7&i)}}return n},t}(),MC=I.UserStatusResult=function(){function t(t){if(this.userInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.userInfos=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.userInfos&&t.userInfos.length)for(var n=0;n<t.userInfos.length;++n)I.UserStatusResult.UserStatusInfo.encode(t.userInfos[n],e.uint32(18).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserStatusResult;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.userInfos&&n.userInfos.length||(n.userInfos=[]),n.userInfos.push(I.UserStatusResult.UserStatusInfo.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.UserStatusInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.account="",t.prototype.ts=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(10).string(t.account),null!=t.ts&&Object.hasOwnProperty.call(t,"ts")&&e.uint32(16).uint32(t.ts),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserStatusResult.UserStatusInfo;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.account=t.string();break;case 2:n.ts=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),t}(),NC=I.UserAttributeGet=function(){function t(t){if(this.attributes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.account="",t.prototype.attributes=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),null!=t.attributes&&t.attributes.length)for(var n=0;n<t.attributes.length;++n)e.uint32(26).string(t.attributes[n]);return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeGet;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.account=t.string();break;case 3:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(t.string());break;default:t.skipType(7&i)}}return n},t}(),OC=I.UserAttributeRet=function(){function t(t){if(this.attributeInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.attributeInfos=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.attributeInfos&&t.attributeInfos.length)for(var n=0;n<t.attributeInfos.length;++n)I.UserAttributeRet.AttributeInfo.encode(t.attributeInfos[n],e.uint32(18).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeRet;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(I.UserAttributeRet.AttributeInfo.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.AttributeInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.key="",t.prototype.value="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeRet.AttributeInfo;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.key=t.string();break;case 2:n.value=t.string();break;default:t.skipType(7&i)}}return n},t}(),t}(),PC=I.UserAttributeSet=function(){function t(t){if(this.attributeInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.account="",t.prototype.attributeInfos=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),null!=t.attributeInfos&&t.attributeInfos.length)for(var n=0;n<t.attributeInfos.length;++n)I.UserAttributeSet.AttributeInfo.encode(t.attributeInfos[n],e.uint32(26).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeSet;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.account=t.string();break;case 3:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(I.UserAttributeSet.AttributeInfo.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.AttributeInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.key="",t.prototype.value="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeSet.AttributeInfo;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.key=t.string();break;case 2:n.value=t.string();break;default:t.skipType(7&i)}}return n},t}(),t}(),QC=I.UserAttributeMod=function(){function t(t){if(this.attributeInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.account="",t.prototype.attributeInfos=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),null!=t.attributeInfos&&t.attributeInfos.length)for(var n=0;n<t.attributeInfos.length;++n)I.UserAttributeMod.AttributeInfo.encode(t.attributeInfos[n],e.uint32(26).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeMod;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.account=t.string();break;case 3:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(I.UserAttributeMod.AttributeInfo.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.AttributeInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.key="",t.prototype.value="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeMod.AttributeInfo;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.key=t.string();break;case 2:n.value=t.string();break;default:t.skipType(7&i)}}return n},t}(),t}(),RC=I.UserAttributeDel=function(){function t(t){if(this.attributes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.account="",t.prototype.attributes=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),null!=t.attributes&&t.attributes.length)for(var n=0;n<t.attributes.length;++n)e.uint32(26).string(t.attributes[n]);return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeDel;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.account=t.string();break;case 3:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(t.string());break;default:t.skipType(7&i)}}return n},t}(),SC=I.UserAttributeErr=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.code=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(16).uint32(t.code),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeErr;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.code=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),TC=I.UserAttributeKeysGet=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.account="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(18).string(t.account),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeKeysGet;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.account=t.string();break;default:t.skipType(7&i)}}return n},t}(),UC=I.UserAttributeKeysRet=function(){function t(t){if(this.keys=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.keys=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.keys&&t.keys.length)for(var n=0;n<t.keys.length;++n)e.uint32(18).string(t.keys[n]);return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeKeysRet;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(t.string());break;default:t.skipType(7&i)}}return n},t}(),VC=I.UserAttributeRsp=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserAttributeRsp;t.pos<e;){var i=t.uint32();if(i>>>3==1)n.seq=t.uint64();else t.skipType(7&i)}return n},t}(),WC=I.GroupStatusList=function(){function t(t){if(this.groups=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.groups=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.groups&&t.groups.length)for(var n=0;n<t.groups.length;++n)e.uint32(18).string(t.groups[n]);return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupStatusList;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.groups&&n.groups.length||(n.groups=[]),n.groups.push(t.string());break;default:t.skipType(7&i)}}return n},t}(),XC=I.GroupStatusResult=function(){function t(t){if(this.groupInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.groupInfos=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.groupInfos&&t.groupInfos.length)for(var n=0;n<t.groupInfos.length;++n)I.GroupStatusResult.GroupInfo.encode(t.groupInfos[n],e.uint32(18).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupStatusResult;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.groupInfos&&n.groupInfos.length||(n.groupInfos=[]),n.groupInfos.push(I.GroupStatusResult.GroupInfo.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.GroupInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.group="",t.prototype.memberCount=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(10).string(t.group),null!=t.memberCount&&Object.hasOwnProperty.call(t,"memberCount")&&e.uint32(16).uint32(t.memberCount),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupStatusResult.GroupInfo;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.group=t.string();break;case 2:n.memberCount=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),t}(),YC=I.GroupCountNotice=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.group="",t.prototype.size=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(16).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(26).string(t.group),null!=t.size&&Object.hasOwnProperty.call(t,"size")&&e.uint32(32).uint32(t.size),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupCountNotice;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.instance=t.uint64();break;case 2:n.seq=t.uint64();break;case 3:n.group=t.string();break;case 4:n.size=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),ZC=I.GroupAttributeGet=function(){function t(t){if(this.attributes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.group="",t.prototype.attributes=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),null!=t.attributes&&t.attributes.length)for(var n=0;n<t.attributes.length;++n)e.uint32(26).string(t.attributes[n]);return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeGet;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.group=t.string();break;case 3:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(t.string());break;default:t.skipType(7&i)}}return n},t}(),$C=I.GroupAttributeRet=function(){function t(t){if(this.attributeMaps=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.attributeMaps=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.attributeMaps&&t.attributeMaps.length)for(var n=0;n<t.attributeMaps.length;++n)I.GroupAttributeRet.AttributeMap.encode(t.attributeMaps[n],e.uint32(18).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeRet;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.attributeMaps&&n.attributeMaps.length||(n.attributeMaps=[]),n.attributeMaps.push(I.GroupAttributeRet.AttributeMap.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.AttributeMap=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.key="",t.prototype.value="",t.prototype.origin="",t.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),null!=t.origin&&Object.hasOwnProperty.call(t,"origin")&&e.uint32(26).string(t.origin),null!=t.ms&&Object.hasOwnProperty.call(t,"ms")&&e.uint32(32).uint64(t.ms),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeRet.AttributeMap;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.key=t.string();break;case 2:n.value=t.string();break;case 3:n.origin=t.string();break;case 4:n.ms=t.uint64();break;default:t.skipType(7&i)}}return n},t}(),t}(),aD=I.GroupAttributeSet=function(){function t(t){if(this.attributeInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.group="",t.prototype.broadcast=!1,t.prototype.attributeInfos=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),null!=t.broadcast&&Object.hasOwnProperty.call(t,"broadcast")&&e.uint32(24).bool(t.broadcast),null!=t.attributeInfos&&t.attributeInfos.length)for(var n=0;n<t.attributeInfos.length;++n)I.GroupAttributeSet.AttributeInfo.encode(t.attributeInfos[n],e.uint32(34).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeSet;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.group=t.string();break;case 3:n.broadcast=t.bool();break;case 4:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(I.GroupAttributeSet.AttributeInfo.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.AttributeInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.key="",t.prototype.value="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeSet.AttributeInfo;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.key=t.string();break;case 2:n.value=t.string();break;default:t.skipType(7&i)}}return n},t}(),t}(),bD=I.GroupAttributeMod=function(){function t(t){if(this.attributeInfos=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.group="",t.prototype.broadcast=!1,t.prototype.attributeInfos=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),null!=t.broadcast&&Object.hasOwnProperty.call(t,"broadcast")&&e.uint32(24).bool(t.broadcast),null!=t.attributeInfos&&t.attributeInfos.length)for(var n=0;n<t.attributeInfos.length;++n)I.GroupAttributeMod.AttributeInfo.encode(t.attributeInfos[n],e.uint32(34).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeMod;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.group=t.string();break;case 3:n.broadcast=t.bool();break;case 4:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(I.GroupAttributeMod.AttributeInfo.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.AttributeInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.key="",t.prototype.value="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeMod.AttributeInfo;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.key=t.string();break;case 2:n.value=t.string();break;default:t.skipType(7&i)}}return n},t}(),t}(),cD=I.GroupAttributeDel=function(){function t(t){if(this.attributes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.group="",t.prototype.broadcast=!1,t.prototype.attributes=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),null!=t.broadcast&&Object.hasOwnProperty.call(t,"broadcast")&&e.uint32(24).bool(t.broadcast),null!=t.attributes&&t.attributes.length)for(var n=0;n<t.attributes.length;++n)e.uint32(34).string(t.attributes[n]);return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeDel;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.group=t.string();break;case 3:n.broadcast=t.bool();break;case 4:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(t.string());break;default:t.skipType(7&i)}}return n},t}(),dD=I.GroupAttributeAlt=function(){function t(t){if(this.attributeMaps=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.group="",t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.attributeMaps=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(24).uint64(t.instance),null!=t.attributeMaps&&t.attributeMaps.length)for(var n=0;n<t.attributeMaps.length;++n)I.GroupAttributeAlt.AttributeMap.encode(t.attributeMaps[n],e.uint32(34).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeAlt;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.group=t.string();break;case 3:n.instance=t.uint64();break;case 4:n.attributeMaps&&n.attributeMaps.length||(n.attributeMaps=[]),n.attributeMaps.push(I.GroupAttributeAlt.AttributeMap.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.AttributeMap=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.key="",t.prototype.value="",t.prototype.origin="",t.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).string(t.value),null!=t.origin&&Object.hasOwnProperty.call(t,"origin")&&e.uint32(26).string(t.origin),null!=t.ms&&Object.hasOwnProperty.call(t,"ms")&&e.uint32(32).uint64(t.ms),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeAlt.AttributeMap;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.key=t.string();break;case 2:n.value=t.string();break;case 3:n.origin=t.string();break;case 4:n.ms=t.uint64();break;default:t.skipType(7&i)}}return n},t}(),t}(),eD=I.GroupAttributeRsp=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeRsp;t.pos<e;){var i=t.uint32();if(i>>>3==1)n.seq=t.uint64();else t.skipType(7&i)}return n},t}(),fD=I.GroupAttributeErr=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.code=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(16).uint32(t.code),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeErr;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.code=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),gD=I.GroupAttributeKeysGet=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.group="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.group&&Object.hasOwnProperty.call(t,"group")&&e.uint32(18).string(t.group),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeKeysGet;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.group=t.string();break;default:t.skipType(7&i)}}return n},t}(),hD=I.GroupAttributeKeysRet=function(){function t(t){if(this.keys=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.keys=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.keys&&t.keys.length)for(var n=0;n<t.keys.length;++n)e.uint32(18).string(t.keys[n]);return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.GroupAttributeKeysRet;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(t.string());break;default:t.skipType(7&i)}}return n},t}(),iD=I.SubscribeUserStatus=function(){function t(t){if(this.users=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.users=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.users&&t.users.length)for(var n=0;n<t.users.length;++n)e.uint32(18).string(t.users[n]);return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.SubscribeUserStatus;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.users&&n.users.length||(n.users=[]),n.users.push(t.string());break;default:t.skipType(7&i)}}return n},t}(),jD=I.UnsubscribeUserStatus=function(){function t(t){if(this.users=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.users=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.users&&t.users.length)for(var n=0;n<t.users.length;++n)e.uint32(18).string(t.users[n]);return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UnsubscribeUserStatus;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.users&&n.users.length||(n.users=[]),n.users.push(t.string());break;default:t.skipType(7&i)}}return n},t}(),kD=I.UserJoinNotice=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.user="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(16).uint64(t.seq),null!=t.user&&Object.hasOwnProperty.call(t,"user")&&e.uint32(26).string(t.user),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserJoinNotice;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.instance=t.uint64();break;case 2:n.seq=t.uint64();break;case 3:n.user=t.string();break;default:t.skipType(7&i)}}return n},t}(),lD=I.UserQuitNotice=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.user="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(16).uint64(t.seq),null!=t.user&&Object.hasOwnProperty.call(t,"user")&&e.uint32(26).string(t.user),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserQuitNotice;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.instance=t.uint64();break;case 2:n.seq=t.uint64();break;case 3:n.user=t.string();break;default:t.skipType(7&i)}}return n},t}(),mD=I.UserWaitNotice=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.user="",t.encode=function(t,e){return e||(e=ia.create()),null!=t.instance&&Object.hasOwnProperty.call(t,"instance")&&e.uint32(8).uint64(t.instance),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(16).uint64(t.seq),null!=t.user&&Object.hasOwnProperty.call(t,"user")&&e.uint32(26).string(t.user),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.UserWaitNotice;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.instance=t.uint64();break;case 2:n.seq=t.uint64();break;case 3:n.user=t.string();break;default:t.skipType(7&i)}}return n},t}(),nD=I.SubscribeResponse=function(){function t(t){if(this.errors=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,t.prototype.errors=D.emptyArray,t.encode=function(t,e){if(e||(e=ia.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.errors&&t.errors.length)for(var n=0;n<t.errors.length;++n)I.SubscribeResponse.SubscribeErrorsType.encode(t.errors[n],e.uint32(18).fork()).ldelim();return e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.SubscribeResponse;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.seq=t.uint64();break;case 2:n.errors&&n.errors.length||(n.errors=[]),n.errors.push(I.SubscribeResponse.SubscribeErrorsType.decode(t,t.uint32()));break;default:t.skipType(7&i)}}return n},t.SubscribeErrorsType=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.account="",t.prototype.code=0,t.encode=function(t,e){return e||(e=ia.create()),null!=t.account&&Object.hasOwnProperty.call(t,"account")&&e.uint32(10).string(t.account),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(16).uint32(t.code),e},t.decode=function(t,e){t instanceof M||(t=M.create(t)),e=void 0===e?t.len:t.pos+e;for(var n=new I.SubscribeResponse.SubscribeErrorsType;t.pos<e;){var i=t.uint32();switch(i>>>3){case 1:n.account=t.string();break;case 2:n.code=t.uint32();break;default:t.skipType(7&i)}}return n},t}(),t}(),oD=Object.freeze({__proto__:null,URI:vC,Wrapper:wi,Ping:wC,Pong:xC,UserJoin:yC,UserResp:zC,UserQuit:AC,UserDrop:BC,UserTicketNearlyExpire:CC,UserRenewTokenReq:DC,UserRenewTokenResp:EC,GroupEnter:FC,GroupLeave:GC,GroupReply:HC,GroupLeaveNotice:vs,GroupEnterNotice:ws,Message:xs,Ack:ys,GroupDrop:IC,GroupAllUsersList:JC,GroupAllUsersResult:KC,UserStatusList:LC,UserStatusResult:MC,UserAttributeGet:NC,UserAttributeRet:OC,UserAttributeSet:PC,UserAttributeMod:QC,UserAttributeDel:RC,UserAttributeErr:SC,UserAttributeKeysGet:TC,UserAttributeKeysRet:UC,UserAttributeRsp:VC,GroupStatusList:WC,GroupStatusResult:XC,GroupCountNotice:YC,GroupAttributeGet:ZC,GroupAttributeRet:$C,GroupAttributeSet:aD,GroupAttributeMod:bD,GroupAttributeDel:cD,GroupAttributeAlt:dD,GroupAttributeRsp:eD,GroupAttributeErr:fD,GroupAttributeKeysGet:gD,GroupAttributeKeysRet:hD,SubscribeUserStatus:iD,UnsubscribeUserStatus:jD,UserJoinNotice:kD,UserQuitNotice:lD,UserWaitNotice:mD,SubscribeResponse:nD,default:I}),pD=Math.ceil,zs=function(t){return function(e,n,i){var r=(e=String(Eb(e))).length;return i=void 0===i?" ":String(i),(n=Ma(n))<=r||""==i?e:(n-=r,(r=Yo.call(i,pD(n/i.length))).length>n&&(r=r.slice(0,n)),t?e+r:r+e)}},qD=zs(!1),rD=zs(!0),As=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(df);ea({target:"String",proto:!0,forced:As},{padEnd:function(t){return rD(this,t,1<arguments.length?arguments[1]:void 0)}});var sD=eg,Bs=function(t){return function(e){e=Mb(e);for(var n,i=ed(e),r=i.length,s=0,o=[];r>s;)n=i[s++],wa&&!sD.call(e,n)||o.push(t?[n,e[n]]:e[n]);return o}},tD=Bs(!0),uD=Bs(!1);ea({target:"Object",stat:!0},{entries:function(t){return tD(t)}});var vD=dc.f,Cs="".endsWith,wD=Math.min,Ds=Qk("endsWith"),xD=!Ds&&!!function(){var t=vD(String.prototype,"endsWith");return t&&!t.writable}();ea({target:"String",proto:!0,forced:!xD&&!Ds},{endsWith:function(t){var e=String(Eb(this));Pk(t);var n=1<arguments.length?arguments[1]:void 0,i=Ma(e.length);return n=void 0===n?i:wD(Ma(n),i),i=String(t),Cs?Cs.call(e,i,n):e.slice(n-i.length,n)===i}}),Bh("match",1,(function(t,e,n){return[function(e){var n=Eb(this),i=null==e?void 0:e[t];return void 0!==i?i.call(e,n):new RegExp(e)[t](String(n))},function(t){var i=n(e,t,this);if(i.done)return i.value;if(t=Ia(t),i=String(this),!t.global)return ef(t,i);var r=t.unicode;t.lastIndex=0;for(var s,o=[],a=0;null!==(s=ef(t,i));)s=String(s[0]),o[a]=s,""===s&&(t.lastIndex=Mj(i,Ma(t.lastIndex),r)),a++;return 0===a?null:o}]}));var yD=dc.f,Es="".startsWith,zD=Math.min,Fs=Qk("startsWith"),AD=!Fs&&!!function(){var t=yD(String.prototype,"startsWith");return t&&!t.writable}();ea({target:"String",proto:!0,forced:!AD&&!Fs},{startsWith:function(t){var e=String(Eb(this));Pk(t);var n=Ma(zD(1<arguments.length?arguments[1]:void 0,e.length)),i=String(t);return Es?Es.call(e,i,n):e.slice(n,n+i.length)===i}});var Wn=function(t){var e=/(%?)(%([jds]))/g,n=Array.prototype.slice.call(arguments,1);return n.length&&(t=t.replace(e,(function(t,e,i,r){switch(i=n.shift(),r){case"s":i=""+i;break;case"d":i=Number(i);break;case"j":i=JSON.stringify(i)}return e?(n.unshift(i),t):i}))),n.length&&(t+=" "+n.join(" ")),""+t.replace(/%{2,2}/g,"%")},BD=/\s/,CD=/^\s+/,Gs=NaN,DD=/^[-+]0x[0-9a-f]+$/i,ED=/^0b[01]+$/i,FD=/^0o[0-7]+$/i,GD=parseInt,xi=function(t){if("number"==typeof t)return t;if(Ke(t))return Gs;if(Gb(t)&&(t="function"==typeof t.valueOf?t.valueOf():t,t=Gb(t)?t+"":t),"string"!=typeof t)return 0===t?t:+t;if(t){for(var e=t.slice,n=t.length;n--&&BD.test(t.charAt(n)););t=e.call(t,0,n+1).replace(CD,"")}return(e=ED.test(t))||FD.test(t)?GD(t.slice(2),e?2:8):DD.test(t)?Gs:+t},HD=Math.max,ID=Math.min,JD=function(t,e,n){function i(e){var n=c,i=l;return c=l=void 0,A=e,u=t.apply(i,n)}function r(t){var n=t-h;return t-=A,void 0===h||n>=e||0>n||f&&t>=g}function s(){var t=$b.Date.now();if(r(t))return o(t);var n=setTimeout,i=t-A;t=e-(t-h),i=f?ID(t,g-i):t,d=n(s,i)}function o(t){return d=void 0,m&&c?i(t):(c=l=void 0,u)}function a(){var t=$b.Date.now(),n=r(t);if(c=arguments,l=this,h=t,n){if(void 0===d)return A=t=h,d=setTimeout(s,e),p?i(t):u;if(f)return clearTimeout(d),d=setTimeout(s,e),i(h)}return void 0===d&&(d=setTimeout(s,e)),u}var c,l,u,d,h,A=0,p=!1,f=!1,m=!0;if("function"!=typeof t)throw new TypeError("Expected a function");if(e=xi(e)||0,Gb(n)){p=!!n.leading;var g=(f="maxWait"in n)?HD(xi(n.maxWait)||0,e):g;m="trailing"in n?!!n.trailing:m}return a.cancel=function(){void 0!==d&&clearTimeout(d),A=0,c=h=l=d=void 0},a.flush=function(){return void 0===d?u:o($b.Date.now())},a},KD=Math.max,LD=Math.min,Hs=1/0,Rl=function(t){return t?(t=xi(t))===Hs||t===-Hs?17976931348623157e292*(0>t?-1:1):t==t?t:0:0===t?t:0},Is=function(t,e,n){return e=Rl(e),void 0===n?(n=e,e=0):n=Rl(n),(t=xi(t))>=LD(e,n)&&t<KD(e,n)},ac=Gc.Writer,H=Gc.util,Pb=Gc.roots.default||(Gc.roots.default={}),MD=Pb.Session=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.appId="",t.prototype.ver="",t.prototype.buildno=0,t.prototype.installId="",t.prototype.os=0,t.prototype.did="",t.prototype.index=null,t.prototype.token="",t.prototype.version=0,t.prototype.subVersion=0,t.encode=function(t,e){return e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.appId&&Object.hasOwnProperty.call(t,"appId")&&e.uint32(42).string(t.appId),null!=t.ver&&Object.hasOwnProperty.call(t,"ver")&&e.uint32(50).string(t.ver),null!=t.buildno&&Object.hasOwnProperty.call(t,"buildno")&&e.uint32(56).int32(t.buildno),null!=t.installId&&Object.hasOwnProperty.call(t,"installId")&&e.uint32(66).string(t.installId),null!=t.os&&Object.hasOwnProperty.call(t,"os")&&e.uint32(128).int32(t.os),null!=t.did&&Object.hasOwnProperty.call(t,"did")&&e.uint32(138).string(t.did),null!=t.index&&Object.hasOwnProperty.call(t,"index")&&Pb.Session.CommonIndex.encode(t.index,e.uint32(162).fork()).ldelim(),null!=t.token&&Object.hasOwnProperty.call(t,"token")&&e.uint32(170).string(t.token),null!=t.version&&Object.hasOwnProperty.call(t,"version")&&e.uint32(176).int32(t.version),null!=t.subVersion&&Object.hasOwnProperty.call(t,"subVersion")&&e.uint32(184).int32(t.subVersion),e},t.CommonIndex=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.index1="",t.prototype.index2="",t.prototype.index3="",t.encode=function(t,e){return e||(e=ac.create()),null!=t.index1&&Object.hasOwnProperty.call(t,"index1")&&e.uint32(10).string(t.index1),null!=t.index2&&Object.hasOwnProperty.call(t,"index2")&&e.uint32(18).string(t.index2),null!=t.index3&&Object.hasOwnProperty.call(t,"index3")&&e.uint32(26).string(t.index3),e},t}(),t}(),ND=Pb.ApEvent=function(){function t(t){if(this.linkServerList=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.apAddr="",t.prototype.linkServerList=H.emptyArray,t.prototype.errCode=0,t.prototype.serverErrCode=0,t.prototype.isp="",t.prototype.opId=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.envId=0,t.prototype.flag=0,t.prototype.area="",t.encode=function(t,e){if(e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.apAddr&&Object.hasOwnProperty.call(t,"apAddr")&&e.uint32(50).string(t.apAddr),null!=t.linkServerList&&t.linkServerList.length)for(var n=0;n<t.linkServerList.length;++n)e.uint32(58).string(t.linkServerList[n]);return null!=t.errCode&&Object.hasOwnProperty.call(t,"errCode")&&e.uint32(72).int32(t.errCode),null!=t.serverErrCode&&Object.hasOwnProperty.call(t,"serverErrCode")&&e.uint32(80).int32(t.serverErrCode),null!=t.isp&&Object.hasOwnProperty.call(t,"isp")&&e.uint32(90).string(t.isp),null!=t.opId&&Object.hasOwnProperty.call(t,"opId")&&e.uint32(96).int64(t.opId),null!=t.envId&&Object.hasOwnProperty.call(t,"envId")&&e.uint32(104).int32(t.envId),null!=t.flag&&Object.hasOwnProperty.call(t,"flag")&&e.uint32(112).int32(t.flag),null!=t.area&&Object.hasOwnProperty.call(t,"area")&&e.uint32(122).string(t.area),e},t}(),OD=Pb.ApRequest=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.apAddr="",t.prototype.opId=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.envId=0,t.prototype.flag=0,t.encode=function(t,e){return e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.apAddr&&Object.hasOwnProperty.call(t,"apAddr")&&e.uint32(42).string(t.apAddr),null!=t.opId&&Object.hasOwnProperty.call(t,"opId")&&e.uint32(48).int64(t.opId),null!=t.envId&&Object.hasOwnProperty.call(t,"envId")&&e.uint32(56).int32(t.envId),null!=t.flag&&Object.hasOwnProperty.call(t,"flag")&&e.uint32(64).int32(t.flag),e},t}(),PD=Pb.LinkLoginRequest=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.destServerIp="",t.prototype.linkId=0,t.encode=function(t,e){return e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.destServerIp&&Object.hasOwnProperty.call(t,"destServerIp")&&e.uint32(42).string(t.destServerIp),null!=t.linkId&&Object.hasOwnProperty.call(t,"linkId")&&e.uint32(48).int32(t.linkId),e},t}(),QD=Pb.Link=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.ec=0,t.prototype.sc=0,t.prototype.destServerIp="",t.prototype.ackedServerIp="",t.prototype.responseTime=0,t.encode=function(t,e){return e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.ec&&Object.hasOwnProperty.call(t,"ec")&&e.uint32(40).int32(t.ec),null!=t.sc&&Object.hasOwnProperty.call(t,"sc")&&e.uint32(48).int32(t.sc),null!=t.destServerIp&&Object.hasOwnProperty.call(t,"destServerIp")&&e.uint32(58).string(t.destServerIp),null!=t.ackedServerIp&&Object.hasOwnProperty.call(t,"ackedServerIp")&&e.uint32(66).string(t.ackedServerIp),null!=t.responseTime&&Object.hasOwnProperty.call(t,"responseTime")&&e.uint32(72).int32(t.responseTime),e},t}(),RD=Pb.Logout=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.encode=function(t,e){return e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),e},t}(),SD=Pb.KickedOff=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.linkId=0,t.prototype.code=0,t.prototype.server="",t.prototype.serverCode=0,t.encode=function(t,e){return e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.linkId&&Object.hasOwnProperty.call(t,"linkId")&&e.uint32(48).int32(t.linkId),null!=t.code&&Object.hasOwnProperty.call(t,"code")&&e.uint32(56).int32(t.code),null!=t.server&&Object.hasOwnProperty.call(t,"server")&&e.uint32(66).string(t.server),null!=t.serverCode&&Object.hasOwnProperty.call(t,"serverCode")&&e.uint32(72).int32(t.serverCode),e},t}(),TD=Pb.ChnJoin=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.cname="",t.prototype.errCode=0,t.encode=function(t,e){return e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.cname&&Object.hasOwnProperty.call(t,"cname")&&e.uint32(50).string(t.cname),null!=t.errCode&&Object.hasOwnProperty.call(t,"errCode")&&e.uint32(56).int32(t.errCode),e},t}(),UD=Pb.ChnJoinRes=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.cname="",t.prototype.errCode=0,t.prototype.serverErrCode=0,t.encode=function(t,e){return e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.cname&&Object.hasOwnProperty.call(t,"cname")&&e.uint32(50).string(t.cname),null!=t.errCode&&Object.hasOwnProperty.call(t,"errCode")&&e.uint32(56).int32(t.errCode),null!=t.serverErrCode&&Object.hasOwnProperty.call(t,"serverErrCode")&&e.uint32(64).int32(t.serverErrCode),e},t}(),VD=Pb.ChnLeave=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.cname="",t.prototype.errCode=0,t.encode=function(t,e){return e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.cname&&Object.hasOwnProperty.call(t,"cname")&&e.uint32(50).string(t.cname),null!=t.errCode&&Object.hasOwnProperty.call(t,"errCode")&&e.uint32(56).int32(t.errCode),e},t}(),WD=Pb.ConnectionStateChange=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sid="",t.prototype.userId="",t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.oldState=0,t.prototype.newState=0,t.prototype.reason=0,t.prototype.reconnId=0,t.encode=function(t,e){return e||(e=ac.create()),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(10).string(t.sid),null!=t.userId&&Object.hasOwnProperty.call(t,"userId")&&e.uint32(18).string(t.userId),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(24).int64(t.lts),null!=t.elapse&&Object.hasOwnProperty.call(t,"elapse")&&e.uint32(32).int64(t.elapse),null!=t.oldState&&Object.hasOwnProperty.call(t,"oldState")&&e.uint32(40).int32(t.oldState),null!=t.newState&&Object.hasOwnProperty.call(t,"newState")&&e.uint32(48).int32(t.newState),null!=t.reason&&Object.hasOwnProperty.call(t,"reason")&&e.uint32(56).int32(t.reason),null!=t.reconnId&&Object.hasOwnProperty.call(t,"reconnId")&&e.uint32(64).int32(t.reconnId),e},t}(),Js=Pb.RtmSdkMessageCount=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.vid=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.sid="",t.prototype.messagecategory=0,t.prototype.reportsequence=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.sentcount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.receivedcount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack10mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack25mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack50mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack75mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack100mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack150mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack200mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack250mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack300mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack400mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack500mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack600mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack800mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack1000mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack2000mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack3000mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack5000mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerack7000mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.peerackslowcount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack10mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack25mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack50mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack75mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack100mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack150mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack200mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack250mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack300mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack400mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack500mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack600mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack800mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack1000mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack2000mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack3000mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack5000mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientack7000mscount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.norecipientackslowcount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.acktimeoutcount=H.Long?H.Long.fromBits(0,0,!1):0,t.prototype.apimajorversion=0,t.prototype.apiminorversion=0,t.prototype.os=0,t.prototype.toooftencount=0,t.prototype.receiverofflinecount=0,t.prototype.invalidmessagecount=0,t.prototype.unknowerrorcount=0,t.prototype.servercachedcount=0,t.prototype.timeoutcount=0,t.prototype.successcount=0,t.prototype.userid="",t.encode=function(t,e){return e||(e=ac.create()),null!=t.lts&&Object.hasOwnProperty.call(t,"lts")&&e.uint32(8).int64(t.lts),null!=t.vid&&Object.hasOwnProperty.call(t,"vid")&&e.uint32(16).int64(t.vid),null!=t.sid&&Object.hasOwnProperty.call(t,"sid")&&e.uint32(26).string(t.sid),null!=t.messagecategory&&Object.hasOwnProperty.call(t,"messagecategory")&&e.uint32(32).int32(t.messagecategory),null!=t.reportsequence&&Object.hasOwnProperty.call(t,"reportsequence")&&e.uint32(40).int64(t.reportsequence),null!=t.sentcount&&Object.hasOwnProperty.call(t,"sentcount")&&e.uint32(48).int64(t.sentcount),null!=t.receivedcount&&Object.hasOwnProperty.call(t,"receivedcount")&&e.uint32(56).int64(t.receivedcount),null!=t.peerack10mscount&&Object.hasOwnProperty.call(t,"peerack10mscount")&&e.uint32(64).int64(t.peerack10mscount),null!=t.peerack25mscount&&Object.hasOwnProperty.call(t,"peerack25mscount")&&e.uint32(72).int64(t.peerack25mscount),null!=t.peerack50mscount&&Object.hasOwnProperty.call(t,"peerack50mscount")&&e.uint32(80).int64(t.peerack50mscount),null!=t.peerack75mscount&&Object.hasOwnProperty.call(t,"peerack75mscount")&&e.uint32(88).int64(t.peerack75mscount),null!=t.peerack100mscount&&Object.hasOwnProperty.call(t,"peerack100mscount")&&e.uint32(96).int64(t.peerack100mscount),null!=t.peerack150mscount&&Object.hasOwnProperty.call(t,"peerack150mscount")&&e.uint32(104).int64(t.peerack150mscount),null!=t.peerack200mscount&&Object.hasOwnProperty.call(t,"peerack200mscount")&&e.uint32(112).int64(t.peerack200mscount),null!=t.peerack250mscount&&Object.hasOwnProperty.call(t,"peerack250mscount")&&e.uint32(120).int64(t.peerack250mscount),null!=t.peerack300mscount&&Object.hasOwnProperty.call(t,"peerack300mscount")&&e.uint32(128).int64(t.peerack300mscount),null!=t.peerack400mscount&&Object.hasOwnProperty.call(t,"peerack400mscount")&&e.uint32(136).int64(t.peerack400mscount),null!=t.peerack500mscount&&Object.hasOwnProperty.call(t,"peerack500mscount")&&e.uint32(144).int64(t.peerack500mscount),null!=t.peerack600mscount&&Object.hasOwnProperty.call(t,"peerack600mscount")&&e.uint32(152).int64(t.peerack600mscount),null!=t.peerack800mscount&&Object.hasOwnProperty.call(t,"peerack800mscount")&&e.uint32(160).int64(t.peerack800mscount),null!=t.peerack1000mscount&&Object.hasOwnProperty.call(t,"peerack1000mscount")&&e.uint32(168).int64(t.peerack1000mscount),null!=t.peerack2000mscount&&Object.hasOwnProperty.call(t,"peerack2000mscount")&&e.uint32(176).int64(t.peerack2000mscount),null!=t.peerack3000mscount&&Object.hasOwnProperty.call(t,"peerack3000mscount")&&e.uint32(184).int64(t.peerack3000mscount),null!=t.peerack5000mscount&&Object.hasOwnProperty.call(t,"peerack5000mscount")&&e.uint32(192).int64(t.peerack5000mscount),null!=t.peerack7000mscount&&Object.hasOwnProperty.call(t,"peerack7000mscount")&&e.uint32(200).int64(t.peerack7000mscount),null!=t.peerackslowcount&&Object.hasOwnProperty.call(t,"peerackslowcount")&&e.uint32(208).int64(t.peerackslowcount),null!=t.norecipientack10mscount&&Object.hasOwnProperty.call(t,"norecipientack10mscount")&&e.uint32(216).int64(t.norecipientack10mscount),null!=t.norecipientack25mscount&&Object.hasOwnProperty.call(t,"norecipientack25mscount")&&e.uint32(224).int64(t.norecipientack25mscount),null!=t.norecipientack50mscount&&Object.hasOwnProperty.call(t,"norecipientack50mscount")&&e.uint32(232).int64(t.norecipientack50mscount),null!=t.norecipientack75mscount&&Object.hasOwnProperty.call(t,"norecipientack75mscount")&&e.uint32(240).int64(t.norecipientack75mscount),null!=t.norecipientack100mscount&&Object.hasOwnProperty.call(t,"norecipientack100mscount")&&e.uint32(248).int64(t.norecipientack100mscount),null!=t.norecipientack150mscount&&Object.hasOwnProperty.call(t,"norecipientack150mscount")&&e.uint32(256).int64(t.norecipientack150mscount),null!=t.norecipientack200mscount&&Object.hasOwnProperty.call(t,"norecipientack200mscount")&&e.uint32(264).int64(t.norecipientack200mscount),null!=t.norecipientack250mscount&&Object.hasOwnProperty.call(t,"norecipientack250mscount")&&e.uint32(272).int64(t.norecipientack250mscount),null!=t.norecipientack300mscount&&Object.hasOwnProperty.call(t,"norecipientack300mscount")&&e.uint32(280).int64(t.norecipientack300mscount),null!=t.norecipientack400mscount&&Object.hasOwnProperty.call(t,"norecipientack400mscount")&&e.uint32(288).int64(t.norecipientack400mscount),null!=t.norecipientack500mscount&&Object.hasOwnProperty.call(t,"norecipientack500mscount")&&e.uint32(296).int64(t.norecipientack500mscount),null!=t.norecipientack600mscount&&Object.hasOwnProperty.call(t,"norecipientack600mscount")&&e.uint32(304).int64(t.norecipientack600mscount),null!=t.norecipientack800mscount&&Object.hasOwnProperty.call(t,"norecipientack800mscount")&&e.uint32(312).int64(t.norecipientack800mscount),null!=t.norecipientack1000mscount&&Object.hasOwnProperty.call(t,"norecipientack1000mscount")&&e.uint32(320).int64(t.norecipientack1000mscount),null!=t.norecipientack2000mscount&&Object.hasOwnProperty.call(t,"norecipientack2000mscount")&&e.uint32(328).int64(t.norecipientack2000mscount),null!=t.norecipientack3000mscount&&Object.hasOwnProperty.call(t,"norecipientack3000mscount")&&e.uint32(336).int64(t.norecipientack3000mscount),null!=t.norecipientack5000mscount&&Object.hasOwnProperty.call(t,"norecipientack5000mscount")&&e.uint32(344).int64(t.norecipientack5000mscount),null!=t.norecipientack7000mscount&&Object.hasOwnProperty.call(t,"norecipientack7000mscount")&&e.uint32(352).int64(t.norecipientack7000mscount),null!=t.norecipientackslowcount&&Object.hasOwnProperty.call(t,"norecipientackslowcount")&&e.uint32(360).int64(t.norecipientackslowcount),null!=t.acktimeoutcount&&Object.hasOwnProperty.call(t,"acktimeoutcount")&&e.uint32(368).int64(t.acktimeoutcount),null!=t.apimajorversion&&Object.hasOwnProperty.call(t,"apimajorversion")&&e.uint32(376).int32(t.apimajorversion),null!=t.apiminorversion&&Object.hasOwnProperty.call(t,"apiminorversion")&&e.uint32(384).int32(t.apiminorversion),null!=t.os&&Object.hasOwnProperty.call(t,"os")&&e.uint32(392).int32(t.os),null!=t.toooftencount&&Object.hasOwnProperty.call(t,"toooftencount")&&e.uint32(400).int32(t.toooftencount),null!=t.receiverofflinecount&&Object.hasOwnProperty.call(t,"receiverofflinecount")&&e.uint32(408).int32(t.receiverofflinecount),null!=t.invalidmessagecount&&Object.hasOwnProperty.call(t,"invalidmessagecount")&&e.uint32(416).int32(t.invalidmessagecount),null!=t.unknowerrorcount&&Object.hasOwnProperty.call(t,"unknowerrorcount")&&e.uint32(424).int32(t.unknowerrorcount),null!=t.servercachedcount&&Object.hasOwnProperty.call(t,"servercachedcount")&&e.uint32(432).int32(t.servercachedcount),null!=t.timeoutcount&&Object.hasOwnProperty.call(t,"timeoutcount")&&e.uint32(440).int32(t.timeoutcount),null!=t.successcount&&Object.hasOwnProperty.call(t,"successcount")&&e.uint32(448).int32(t.successcount),null!=t.userid&&Object.hasOwnProperty.call(t,"userid")&&e.uint32(458).string(t.userid),e},t}(),Iv=Object.freeze({__proto__:null,Session:MD,ApEvent:ND,ApRequest:OD,LinkLoginRequest:PD,Link:QD,Logout:RD,KickedOff:SD,ChnJoin:TD,ChnJoinRes:UD,ChnLeave:VD,ConnectionStateChange:WD,RtmSdkMessageCount:Js,default:Pb}),XD=la((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));ea({target:"Date",proto:!0,forced:XD},{toJSON:function(t){t=pb(this);var e=Oc(t);return"number"!=typeof e||isFinite(e)?t.toISOString():null}}),ea({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var Ev=Object.prototype.hasOwnProperty,Ks=function(t,e,n){return JSON.stringify(Mn(t),e,n)};Ks.ensureProperties=Mn;var YD=function(t,e){e=e||{};var n=qa(t);if("string"===n&&0<t.length)return Fv(t);if("number"===n&&isFinite(t))return t=e.long?864e5<=(e=Math.abs(t))?jh(t,e,864e5,"day"):36e5<=e?jh(t,e,36e5,"hour"):6e4<=e?jh(t,e,6e4,"minute"):1e3<=e?jh(t,e,1e3,"second"):t+" ms":864e5<=(e=Math.abs(t))?Math.round(t/864e5)+"d":36e5<=e?Math.round(t/36e5)+"h":6e4<=e?Math.round(t/6e4)+"m":1e3<=e?Math.round(t/1e3)+"s":t+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))},ZD=function(t){function e(t){function i(){for(var t=arguments.length,n=Array(t),s=0;s<t;s++)n[s]=arguments[s];if(i.enabled){t=Number(new Date),i.diff=t-(r||t),i.prev=r,r=i.curr=t,n[0]=e.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var o=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(t,r){return"%%"===t?"%":(o++,"function"==typeof(r=e.formatters[r])&&(t=r.call(i,n[o]),n.splice(o,1),o--),t)})),e.formatArgs.call(i,n),(i.log||e.log).apply(i,n)}}var r,s=null;return i.namespace=t,i.useColors=e.useColors(),i.color=e.selectColor(t),i.extend=n,i.destroy=e.destroy,Object.defineProperty(i,"enabled",{enumerable:!0,configurable:!1,get:function(){return null===s?e.enabled(t):s},set:function(t){s=t}}),"function"==typeof e.init&&e.init(i),i}function n(t,n){return(t=e(this.namespace+(void 0===n?":":n)+t)).log=this.log,t}function i(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){return t instanceof Error?t.stack||t.message:t},e.disable=function(){var t=[].concat(Z(e.names.map(i)),Z(e.skips.map(i).map((function(t){return"-"+t})))).join(",");return e.enable(""),t},e.enable=function(t){e.save(t),e.names=[],e.skips=[];var n,i=("string"==typeof t?t:"").split(/[\s,]+/),r=i.length;for(n=0;n<r;n++)i[n]&&("-"===(t=i[n].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.substr(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;var n,i=0;for(n=e.skips.length;i<n;i++)if(e.skips[i].test(t))return!1;for(i=0,n=e.names.length;i<n;i++)if(e.names[i].test(t))return!0;return!1},e.humanize=YD,e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((function(n){e[n]=t[n]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){for(var n=0,i=0;i<t.length;i++)n=(n<<5)-n+t.charCodeAt(i),n|=0;return e.colors[Math.abs(n)%e.colors.length]},e.enable(e.load()),e},Ls=xb((function(t,e){e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var i=0,r=0;e[0].replace(/%[a-zA-Z%]/g,(function(t){"%%"!==t&&(i++,"%c"===t&&(r=i))})),e.splice(r,0,n)}},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){try{var t=e.storage.getItem("debug")}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t},e.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var n=localStorage;break t}catch(i){}n=void 0}var i;e.storage=n,e.destroy=(i=!1,function(){i||(i=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),e.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),e.log=console.debug||console.log||function(){},t.exports=ZD(e),t.exports.formatters.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}})),Ms=Ls("RTM:DEBUG"),Af;Ms.enabled=!1,function(t){t[t.Uploading=0]="Uploading",t[t.Free=1]="Free"}(Af||(Af={}));var $D=function(){function t(e){va(this,t),x(this,"uploadRequest",void 0),x(this,"uploadState",void 0),x(this,"uploadResendCount",void 0),x(this,"LogCache",void 0),x(this,"LogsToPost",void 0),x(this,"processId",void 0),x(this,"sdkVersion",void 0),x(this,"logId",void 0),x(this,"rtmConfig",void 0),this.processId=e.processId,this.sdkVersion=e.sdkVersion,this.rtmConfig=e.rtmConfig,this.uploadRequest=e.uploadRequest,this.uploadState=Af.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return eb(t,[{key:"upload",value:function(t){this.LogCache.push(t),this.uploadState===Af.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(t){var e=this;this.uploadState=Af.Uploading,setTimeout(ma(N.mark((function n(){var i,r,s;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i={sdk_version:e.sdkVersion,process_id:e.processId,payload:JSON.stringify(t)},n.prev=1,n.next=4,e.uploadRequest(i,null!==(r=e.rtmConfig.enableCloudProxy)&&void 0!==r&&r);case 4:if(!gj){n.next=6;break}throw Error("RTM is busy");case 6:n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(1),s=2>e.uploadResendCount++?2e3:1e4,setTimeout((function(){return e.postLog(e.LogsToPost)}),s),n.abrupt("return");case 13:if(Ms('The logs uploaded for "process-'.concat(Og,'"')),0!==e.LogCache.length){n.next=17;break}return e.uploadState=Af.Free,n.abrupt("return");case 17:e.uploadResendCount=0,e.LogsToPost=40>e.LogCache.length?e.LogCache.splice(0,e.LogCache.length):e.LogCache.splice(0,40),e.postLog(e.LogsToPost);case 20:case"end":return n.stop()}}),n,null,[[1,8]])}))),ue.getParameter("LOG_UPLOAD_INTERVAL"))}}]),t}(),Ns=function(t,e,n,i,r,s,o,a){var c=0;for(o=!!o&&Dd(o,a,3);c<i;){if(c in n){if(a=o?o(n[c],c,e):n[c],0<s&&Ed(a))r=Ns(t,e,a,Ma(a.length),r,s-1)-1;else{if(9007199254740991<=r)throw TypeError("Exceed the acceptable array length");t[r]=a}r++}c++}return r},aE=Ns;ea({target:"Array",proto:!0},{flat:function(){var t=arguments.length?arguments[0]:void 0,e=pb(this),n=Ma(e.length),i=Dh(e,0);return i.length=aE(i,e,e,n,0,void 0===t?1:yc(t)),i}}),ea({target:"Object",stat:!0},{values:function(t){return uD(t)}});var ud=function(t){function e(t,i){return va(this,e),x(z(t=n.call(this,Vn(t,i))),"originalError",void 0),x(z(t),"code",void 0),x(z(t),"serverCode",void 0),"number"==typeof i?t.code=i:"string"==typeof i?t.name=i:void 0!==i&&(i.originalError&&(t.originalError=i.originalError),void 0!==i.code&&(t.code=i.code),void 0!==i.serverCode&&(t.serverCode=i.serverCode)),t}Ga(e,t);var n=Ha(e);return e}(Kf(Error)),rc=function(t){function e(t,i){return va(this,e),x(z(t=n.call(this,Vn(t,i))),"name","RtmInternalError"),x(z(t),"code",void 0),t.code=i,t}Ga(e,t);var n=Ha(e);return e}(Kf(Error)),yi=function(){return function(t){function e(t){va(this,e);var i=Object.keys(t);return n.call(this,t[i[0]],i[0])}Ga(e,t);var n=Ha(e);return e}(rc)},mb=yi(),Ub=function(t){function e(){va(this,e);for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return x(z(t=n.call.apply(n,[this].concat(i))),"name","RtmTimeoutError"),t}Ga(e,t);var n=Ha(e);return e}(ud),ca=function(t){function e(){va(this,e);for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return x(z(t=n.call.apply(n,[this].concat(i))),"name","RtmInvalidArgumentError"),t}Ga(e,t);var n=Ha(e);return e}(ud),da=function(t){function e(){va(this,e);for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return x(z(t=n.call.apply(n,[this].concat(i))),"name","RtmInvalidStatusError"),t}Ga(e,t);var n=Ha(e);return e}(ud),ic=function(t){function e(){va(this,e);for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return x(z(t=n.call.apply(n,[this].concat(i))),"name","RtmLimitExceededError"),t}Ga(e,t);var n=Ha(e);return e}(ud),bE=function(t){function e(){va(this,e);for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return x(z(t=n.call.apply(n,[this].concat(i))),"name","RtmInvokeTooOftenError"),t}Ga(e,t);var n=Ha(e);return e}(ud),Ja=function(t){function e(){va(this,e);for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return x(z(t=n.call.apply(n,[this].concat(i))),"name","RtmUnavailableError"),x(z(t),"serverCode",void 0),x(z(t),"statusCode",void 0),t}Ga(e,t);var n=Ha(e);return e}(ud),Bf=function(t){function e(){va(this,e);for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return x(z(t=n.call.apply(n,[this].concat(i))),"name","RtmUnauthenticatedError"),x(z(t),"serverCode",void 0),t}Ga(e,t);var n=Ha(e);return e}(ud),ve=function(t){function e(){va(this,e);for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];return x(z(t=n.call.apply(n,[this].concat(i))),"name","RtmUnknownError"),t}Ga(e,t);var n=Ha(e);return e}(ud),Ab=function(t){return t instanceof Ub||t instanceof Tb},Na=function(t){return t instanceof ud},we=function(t,e,n){return['Executing "%s.%s" timed out after %ds',t,e,n/1e3]},cE=["CODE"],bc,Pd,S;!function(t){t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL"}(S||(S={}));var dE={CN:S.CHINA,NA:S.NORTH_AMERICA,EU:S.EUROPE,AS:S.ASIA,JP:S.JAPAN,IN:S.INDIA,GLOB:S.GLOBAL,AF:S.AFRICA,OC:S.OVERSEA,OVS:S.OVERSEA,SA:S.SOUTH_AMERICA},kh=$n((bc={},x(bc,S.ASIA,{CODE:S.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.NORTH_AMERICA,{CODE:S.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.EUROPE,{CODE:S.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.JAPAN,{CODE:S.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.INDIA,{CODE:S.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.OVERSEA,{CODE:S.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),x(bc,S.GLOBAL,{CODE:S.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.OCEANIA,{CODE:S.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.SOUTH_AMERICA,{CODE:S.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.AFRICA,{CODE:S.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.CHINA,{CODE:S.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),bc)),Zf=(Pd={},x(Pd,S.ASIA,[S.CHINA,S.JAPAN,S.INDIA]),x(Pd,S.EUROPE,[]),x(Pd,S.NORTH_AMERICA,[]),x(Pd,S.SOUTH_AMERICA,[]),x(Pd,S.OCEANIA,[]),x(Pd,S.AFRICA,[]),Pd),Os=[S.OVERSEA,S.GLOBAL,S.CHINA,S.NORTH_AMERICA,S.EUROPE,S.ASIA,S.JAPAN,S.INDIA,S.OCEANIA,S.SOUTH_AMERICA,S.AFRICA],Nn=function(t){return Object.values(Zf).flat().includes(t)},Hv=function(t){var e;return null===(e=qh(Zf).find((function(e){return(e=$a(e,2))[0],e[1].includes(t)})))||void 0===e?void 0:e[0]},eE=function(t){return t.sort((function(t,e){return Os.indexOf(t)-Os.indexOf(e)}))},Ve=function(t){var e=new Set;if(0===(t=eE(t).slice(0,3).map((function(t){var n=kh[t];if(void 0===n)throw new rc("invalid area key");return t=n.CODE,n=Ki(n,cE),e.add(t),n}))).length)throw new rc("areas cannot be empty");return Wa({CODES:e},t.reduce((function(t,e){for(var n=0,i=qh(t);n<i.length;n++){var r=$a(i[n],2),s=r[0];r=r[1],t[s]=Array.from(new Set([].concat(Z(e[s]),Z(r))))}return t})))},fa,Ps=function(){var t=ma(N.mark((function t(e,n){var i,r,s,o,a,c=arguments;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(2<(r=2<c.length&&void 0!==c[2]?c[2]:0))){t.next=3;break}return t.abrupt("return");case 3:return s={withCredentials:!0,body:e,timeout:2e4},o=0<r?(null==fa?void 0:fa.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(null==fa?void 0:fa.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",a=n?"https://".concat(null!==(i=null==fa?void 0:fa.PROXY_NGINX[0])&&void 0!==i?i:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(o,"&p=443&d=upload/v1"):"https://".concat(o,"/upload/v1"),t.next=8,lh(a,s).catch((function(t){return Ps(e,n,r+1)}));case 8:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),Qs=new $D({processId:"process-".concat(Og),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.5.1-0-g5bbbcd72"),uploadRequest:Ps,rtmConfig:{}}),Sl="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Rs="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Ss=["serverReceivedTs","hasPeerReceived","messageType","enableNotificationToChannelMembers","lastUpdateTs"],fE="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),We=function(t){if("string"==typeof t)return La(t);if(Array.isArray(t)&&t.every((function(t){return"string"==typeof t})))return t.map((function(t){return La(t)}));if(!Mm(t)){for(var e={},n=0;n<Ss.length;n++){var i=Ss[n];i in t&&(e[i]=t[i])}if(0<Object.keys(e).length)return e;if(5>Object.keys(t).length){for(n=0,t=Object.entries(t);n<t.length;n++){var r=$a(t[n],2);i=r[0],r=r[1],Sl.includes(i)?e[i]="[Hidden Info]":e[La(i)]="string"==typeof r?La(r):"[Sensitive Info]"}return e}return"[Sensitive Info]"}return t},Ts=function(t){return"object"===qa(t)?De(t)?Zn(He(t,5),Sl,Rs):t.constructor&&t.constructor.name:t},Us=function(t,e){return t instanceof Error?t.message:"string"!=typeof t?JSON.stringify(Zn(He(t,5),Sl,Rs)):(e=e.map((function(t){return t instanceof Error?t.message:"object"===qa(t)?Ks(Array.isArray(t)?t.map(Ts):Ts(t)):t})),Wn.apply(void 0,[t.replace(/%[%Oo]/g,(function(t){return"%%"===t?"%":"%o"===t||"%O"===t?"%s":t}))].concat(Z(e))))},gE=1,Vs=function(t,e,n){var i=Ls(t);return i.enabled=!0,i.log=n,i.useColors=!1,function(n){for(var r=arguments.length,s=Array(1<r?r-1:0),o=1;o<r;o++)s[o-1]=arguments[o];if(e.enableLogUpload){r=oh(n);var a=Us(r,s);Qs.upload({log_item_id:"".concat(gE++),log_level:t,payload_str:"[".concat(hE(),"] ").concat(t," - ").concat(256<a.length?a.slice(0,256):a)})}switch(r=function(t){var e=a||Us(oh(n),s),r=Ec.LOG_HANDLER;"function"==typeof r&&r({level:t,message:e}),i(e)},t){case"RTM:INFO":e.logFilter.info&&r("log");break;case"RTM:WARN":e.logFilter.warn&&r("warning");break;case"RTM:ERROR":e.logFilter.error&&r("error");break;case"RTM:TRACK":e.logFilter.track&&r("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":case"RTM:DEBUG":e.logFilter.debug&&r("debug")}}},Tl,Ws=function(t){return function(e){var n=1===Tl||void 0===t?"":"Ins#".concat(t," ");return"".concat(n).concat(e)}},Ul=function(t,e,n){var i=Ws(Tl);return Vs("RTM:".concat(e),n,(function(e){return t(i(e))}))},sc=function(){return function(t){function e(t,i){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];va(this,e);var s=n.call(this);if(x(z(s),"logError",void 0),x(z(s),"invokeTracker",void 0),x(z(s),"resultTracker",void 0),x(z(s),"errorTracker",void 0),x(z(s),"eventTracker",void 0),x(z(s),"info",void 0),x(z(s),"warn",void 0),x(z(s),"log",void 0),x(z(s),"genLogger",void 0),x(z(s),"loggerId",void 0),x(z(s),"logger",void 0),x(z(s),"name",void 0),s.logger=t,s.name=i,s.loggerId=t.loggerId,s.info=t.info,s.warn=t.warn,s.logError=t.logError,s.genLogger=t.genLogger,s.log=t.genLogger("RTM:DEBUG","<".concat(i,"> ")),s.invokeTracker=t.genTracker("Invoke"),s.eventTracker=t.genTracker("Event"),s.resultTracker=t.genTracker("Result"),s.errorTracker=t.genTracker("Error"),r){var o=s.emit.bind(z(s));s.emit=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];t=e[0],n=e.slice(1);var r=fE.includes(t);s.eventTracker.apply(s,["%s: ".concat(0<n.length?"%s emitted with args: ".concat(n.map((function(){return"%o"}))):"%s emitted"),i,t].concat(Z(r?n.map(We):n)));try{o.apply(void 0,e)}catch(e){s.logError("Caught in the callback function of the event %s",t,e)}}}return s}Ga(e,t);var n=Ha(e);return e}(Ba)},iE=function(t){return Ul(console.log.bind(console),"INFO",t)},jE=function(t){return Ul(console.warn.bind(console),"WARN",t)},kE=function(t){return Ul(console.error.bind(console),"ERROR",t)},Xs=function(t,e){return function(n){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",r=Ws(t),s=console.debug.bind(console),o=Vs(n,e,(function(t){return s(r(t))}));return function(t){for(var e=arguments.length,n=Array(1<e?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return o.apply(void 0,[i+t].concat(n))}}},lE=function(t,e){return function(n){return Xs(t,e)("RTM:TRACK","[".concat(n,"] "))}},Jv=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510}}),Ka;!function(t){t[t.ChannelSMsg=1]="ChannelSMsg",t[t.ChannelRMsg=2]="ChannelRMsg",t[t.P2pSMsgOfflineFlag=3]="P2pSMsgOfflineFlag",t[t.P2pRMsgOfflineFlag=4]="P2pRMsgOfflineFlag",t[t.P2pSMsgNoOfflineFlag=5]="P2pSMsgNoOfflineFlag",t[t.P2pRMsgNoOfflineFlag=6]="P2pRMsgNoOfflineFlag",t[t.P2pCallInvitation=7]="P2pCallInvitation",t[t.P2pCallCancellation=8]="P2pCallCancellation",t[t.P2pCallAcceptance=9]="P2pCallAcceptance",t[t.P2pCallRefusal=10]="P2pCallRefusal"}(Ka||(Ka={}));var zi=function(t){function e(t,i,r){return va(this,e),x(z(i=n.call(this,i,"MessageReport")),"messagecount",i.getInitMessageCount()),x(z(i),"context",void 0),x(z(i),"rtmMessageCategory",void 0),x(z(i),"seq",P.fromNumber(1,!0)),i.context=t,i.rtmMessageCategory=r,i}Ga(e,t);var n=Ha(e);return eb(e,[{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1)}},{key:"getInitMessageCount",value:function(){return{peerack10mscount:P.fromNumber(0),peerack25mscount:P.fromNumber(0),peerack50mscount:P.fromNumber(0),peerack75mscount:P.fromNumber(0),peerack100mscount:P.fromNumber(0),peerack150mscount:P.fromNumber(0),peerack200mscount:P.fromNumber(0),peerack250mscount:P.fromNumber(0),peerack300mscount:P.fromNumber(0),peerack400mscount:P.fromNumber(0),peerack500mscount:P.fromNumber(0),peerack600mscount:P.fromNumber(0),peerack800mscount:P.fromNumber(0),peerack1000mscount:P.fromNumber(0),peerack2000mscount:P.fromNumber(0),peerack3000mscount:P.fromNumber(0),peerack5000mscount:P.fromNumber(0),peerack7000mscount:P.fromNumber(0),peerackslowcount:P.fromNumber(0),norecipientack10mscount:P.fromNumber(0),norecipientack25mscount:P.fromNumber(0),norecipientack50mscount:P.fromNumber(0),norecipientack75mscount:P.fromNumber(0),norecipientack100mscount:P.fromNumber(0),norecipientack150mscount:P.fromNumber(0),norecipientack200mscount:P.fromNumber(0),norecipientack250mscount:P.fromNumber(0),norecipientack300mscount:P.fromNumber(0),norecipientack400mscount:P.fromNumber(0),norecipientack500mscount:P.fromNumber(0),norecipientack600mscount:P.fromNumber(0),norecipientack800mscount:P.fromNumber(0),norecipientack1000mscount:P.fromNumber(0),norecipientack2000mscount:P.fromNumber(0),norecipientack3000mscount:P.fromNumber(0),norecipientack5000mscount:P.fromNumber(0),norecipientack7000mscount:P.fromNumber(0),norecipientackslowcount:P.fromNumber(0),sentcount:P.fromNumber(0),receivedcount:P.fromNumber(0),acktimeoutcount:P.fromNumber(0),toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0}}},{key:"updatePeerAckCount",value:function(t){t/=2;for(var e=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],n=0;n<e.length;n++){var i,r=e[n];if(Is(t,r[0],r[1]))r="peerack".concat(r[1],"mscount"),this.messagecount[r]=null===(i=this.messagecount[r])||void 0===i?void 0:i.add(1);else if(7e3<t){var s;this.messagecount.peerackslowcount=null===(s=this.messagecount.peerackslowcount)||void 0===s?void 0:s.add(1)}}}},{key:"updateNorecipientackCount",value:function(t){t/=2;for(var e=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],n=0;n<e.length;n++){var i,r=e[n];if(Is(t,r[0],r[1]))r="norecipientack".concat(r[1],"mscount"),this.messagecount[r]=null===(i=this.messagecount[r])||void 0===i?void 0:i.add(1);else if(7e3<t){var s;this.messagecount.norecipientackslowcount=null===(s=this.messagecount.norecipientackslowcount)||void 0===s?void 0:s.add(1)}}}},{key:"updateCommonCount",value:function(t){var e=this.messagecount[t];P.isLong(e)?this.messagecount[t]=e.add(1):this.messagecount[t]=e+1}},{key:"report",value:function(){var t,e;bb("RtmSdkMessageCount",new Js(Wa(Wa({},this.messagecount),{},{vid:P.fromString(null!==(t=this.context.vid)&&void 0!==t?t:"0"),os:7,lts:P.fromNumber(Date.now()),sid:this.context.sid,reportsequence:this.incGetSeq(),apimajorversion:4,apiminorversion:18,userid:this.context.uid,messagecategory:this.rtmMessageCategory})),null!==(e=this.context.config.enableCloudProxy)&&void 0!==e&&e),this.messagecount=Wa(Wa({},this.messagecount),{},{toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0})}}]),e}(sc()),Un=new Map,hE=function(){var t=new Date;return"".concat(t.toISOString().split("T")[1].replace(/\..+/,""),".").concat(t.getMilliseconds())},Yf=Object.keys,qh=Object.entries.bind(Object),oh=function(t){return"string"==typeof t?t.endsWith(".")?t:"".concat(t,"."):t},yj=I.URI,Nv=wi,mE=Ki(oD,["Wrapper"]),bo=ql(mE,"URI"),Ys=function(t,e){var n=-1,i=t.length,r=i-1;for(e=void 0===e?i:e;++n<e;){var s=t[i=os(n,r)];t[i]=t[n],t[n]=s}return t.length=e,t},nE=function(t){return Ys(Pi(t))},oE=function(t){return Ys(zj(t))},Cf=function(t){return(ub(t)?nE:oE)(t)},Df={0:9591,1:9593},xe=function(t){var e=$f(null);return"https://".concat(e?null:t,"/api/v1")},pE=ob.apply(void 0,Z(Cf(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map(xe)))),qE=ob.apply(void 0,Z(Cf(["ap-web-1.agora.io","ap-web-2.agora.io"].map(xe)))),rE=ob.apply(void 0,Z(Cf(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map(xe)))),sE=ob.apply(void 0,Z(Cf(["ap-web-3.agora.io","ap-web-4.agora.io"].map(xe)))),Zs=yi(),Vl=function(t){function e(t,i,r,s,o,a){var c,l;va(this,e);var u=n.call(this,o,uj("Socket-",o.loggerId));if(x(z(u),"isActiveClose",!1),x(z(u),"loggedIn",!1),x(z(u),"useNewDomain",void 0),x(z(u),"receivedPacket",new rb),x(z(u),"open$",void 0),x(z(u),"input$",new rb),x(z(u),"userJoin$",new rb),x(z(u),"attemptsSinceLastError",0),x(z(u),"message$",new rb),x(z(u),"socket$",void 0),x(z(u),"toClose",new rb),x(z(u),"toReconnect",new rb),x(z(u),"sendLogger",void 0),x(z(u),"receiveLogger",void 0),x(z(u),"ip",void 0),x(z(u),"env",void 0),x(z(u),"ticket",void 0),x(z(u),"context",void 0),x(z(u),"getDomain",(function(){return co(u.ip,u.useNewDomain)})),x(z(u),"socketReconnector",(function(t){var e=function(t){return u.attemptsSinceLastError+=1,u.warn("The %s of Env %d reconnecting %s",u.name,u.env,t.message),dd(3e3)};return t.pipe(ab((function(t){return u.log("socket connection closed"),u.loggedIn=!1,2<=u.attemptsSinceLastError?(u.warn("socket connection failure"),u.emit("connectionFailure"),u.close(),ra(t)):u.isActiveClose?Sb:(u.emit("reconnect"),u.useNewDomain=!u.useNewDomain,ra(t))})),Re((function(t){return t.pipe(Kb(e))})))})),u.ip=t,u.env=i,u.ticket=r,u.context=s,u.useNewDomain=null!=a?a:.5<=Math.random(),u.sendLogger=u.genLogger("RTM:MSG:SEND"),u.receiveLogger=u.genLogger("RTM:MSG:RECV"),0!==i&&1!==i)throw new Zs({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});var d=Df[i];u.log("Opening websocket address %s for the Env %d",u.ip,u.env),bb("LinkLoginRequest",{sid:u.context.sid,userId:u.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(u.context.startTime),destServerIp:u.ip,linkId:u.env},null!==(c=u.context.config.enableCloudProxy||u.context.socketUseProxy)&&void 0!==c&&c),bb("LinkLoginRequest",{sid:u.context.sid,userId:u.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(u.context.startTime),destServerIp:u.ip,linkId:u.env},null!==(l=u.context.config.enableCloudProxy||u.context.socketUseProxy)&&void 0!==l&&l);var h=Jb(u.input$,u.userJoin$.pipe(Av(2)),u.message$).pipe(Ea((function(t){return wi.encode(t).finish()})));return t=Jb(Bv("",{protocols:[],makeWebSocket:function(){if(u.context.config.enableCloudProxy||u.context.socketUseProxy){if(0===u.context.cloudProxyServers.length)throw u.logError("No cloud proxy server to connect"),new Ja;var t=$f(null)?JSON.parse(null.replace(/-/g,".")):u.context.cloudProxyServers;t=Xe(t="wss://".concat(co(On(t),!1),"/"),"sid",u.context.sid),t=Xe(t,"remote_port",d.toString()),t=Xe(t,"remote_ip",u.ip),t=Xe(t,"token",u.context.key),t=new WebSocket(t)}else t=new WebSocket("wss://".concat(u.getDomain(),":").concat(d));return t.binaryType="arraybuffer",t}}),u.toReconnect),u.socket$=fb(t,Dl.pipe(Lb(7e3),ab((function(t){return Ab(t)&&u.warn("socket open timed out"),ra(t)})))).pipe(Ea((function(t){if(t instanceof Error)throw u.warn("Env_%d: Force reconnect the socket",u.env),t;return t(h).pipe(Ea((function(t){return wi.decode(new Uint8Array(t))})))})),u.socketReconnector),u.open$=u.socket$.pipe(sa((function(t){u.log("Websocket opened",u.name),t.subscribe((function(t){var e=t.data;t=yj[t.uri].slice(0,-3),e=bo[t].decode(e);var n=eC({},ql(e,"toJSON"),(function(t,e){return e instanceof P?Tn(e):e})),i=!1;if((e instanceof ws||e instanceof vs)&&e.instance.lessThanOrEqual(4294967295)&&(i=!0),e instanceof xs||e instanceof ys){var r=e.instance,s=e.sequence;(e.dialogue.lessThanOrEqual(4294967295)||r.lessThanOrEqual(4294967295)||s.lessThan(1))&&(i=!0)}i?u.warn("Env_%d: Illegal %s, abandoned %o",u.env,t,n):("Pong"!==t&&u.receiveLogger("Env_%d: %s %o",u.env,t,n),u.receivedPacket.next([t,e]))}),(function(){}))})),Uf(void 0),Kc(u.toClose),Se()),u}Ga(e,t);var n=Ha(e);return eb(e,[{key:"address",get:function(){return"".concat(this.ip,":").concat(Df[this.env])}},{key:"sendPacket",value:function(t,e){if("Ping"!==t){var n=md(e,(function(t){return t instanceof P?Tn(t):t}));this.sendLogger("Env_%d: %s %o",this.env,t,n)}e=Mv(t,e),"UserJoin"===t?this.userJoin$.next(e):"Message"===t?this.message$.next(e):this.input$.next(e)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(t){return this.receivedPacket.pipe(yb((function(e){return $a(e,1)[0]===t})),Ea((function(t){return $a(t,2)[1]})))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new Zs({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),e}(sc());ea({target:"String",proto:!0,forced:As},{padStart:function(t){return qD(this,t,1<arguments.length?arguments[1]:void 0)}});var tE=function(t){var e=Yf(kh);t=Lv(t);for(var n=0;n<e.length;n++){var i=kh[e[n]];if(null!=i&&i.AP_DOMAINS.includes(t)||null!=i&&i.AP_BACKUP_DOMAINS.includes(t)||null!=i&&i.PROXY_AP.includes(t))return[i.CODE]}return[S.CHINA,S.GLOBAL]},uE={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},$s={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},vE=[100,101,102],Ai=/web-(\d)/,at=function(t){function e(t,i){var r=2<arguments.length&&void 0!==arguments[2]&&arguments[2];va(this,e);var s=n.call(this,i,"AccessPoint");return x(z(s),"handleUniLbsError",(function(t,e){var n=t;if(4<t.toString().length){var i=t.toString().padStart(8,"0"),r=parseInt(i.slice(0,4),10);if(i=parseInt(i.slice(4,8),10),201===r)n=i;else if(101===r&&!vE.includes(i))return ra(Error("service is currently unavailable"))}if(r=n.toString(),!Object.keys($s).includes(r))return(t=new Ja(["Login is rejected by the server. The response code is %d",t],Pg)).serverCode=n,ra(t);switch(r=$s[r],n=uE[r],r){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(e=new Bf(n,as)).serverCode=t,ra(e);case"INVALID_USER_ID":return(e=new Bf(n,si)).serverCode=t,ra(e);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(e=new Bf(n,ti)).serverCode=t,ra(e);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(e=new Bf(n,bs)).serverCode=t,ra(e);case"CANNOT_MEET_AREA_DEMAND":return(e=tE(e)).forEach((function(t){return s.failedAreas.add(t)})),s.failedAreas.size===(void 0===fa?2:fa.CODES.size)?((e=new ca(n,Pg)).serverCode=t,ra(e)):ra(Error("ap ".concat(e.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(e=new Ja(n,Pg)).serverCode=t,ra(e);default:return ra(Rn("ApResErrType",r))}})),x(z(s),"getApEdgeInfo$",void 0),x(z(s),"getApEdgeInfoEndFirst$",void 0),x(z(s),"apFinish$",new rb),x(z(s),"retryCount",0),x(z(s),"failedAreas",new Set),x(z(s),"usedUrl",[]),x(z(s),"newDomainUsed",!1),x(z(s),"backupNewDomainUsed",!1),x(z(s),"genUrl",(function(){return void 0===fa?ej.apply(void 0,Z(Cf([pE,qE]))).pipe(fj((function(t){return ob.apply(void 0,Z(t))}))):ob.apply(void 0,Z(fa.AP_DOMAINS.slice(0,3).map(xe)))})),x(z(s),"genBackupUrl",(function(){return void 0===fa?ej.apply(void 0,Z(Cf([rE,sE]))).pipe(fj((function(t){return ob.apply(void 0,Z(t))}))):ob.apply(void 0,Z(fa.AP_BACKUP_DOMAINS.slice(0,3).map(xe)))})),x(z(s),"getApUrl$",(function(t){var n,i;return s.genUrl().pipe(yb((function(t){return!(s.newDomainUsed&&t.includes("sd-rtn.com")||(t.includes("sd-rtn.com")&&(s.newDomainUsed=!0),Ol(s.usedUrl,(function(e){var n;return e===(null===(n=t.match(Ai))||void 0===n?void 0:n[1])}))))})),sa((function(t){var e;void 0===fa&&"string"==typeof(t=null===(e=t.match(Ai))||void 0===e?void 0:e[1])&&s.usedUrl.push(t)})),hb(t?Math.max(Ec.RECONNECTING_AP_NUM,null!==(n=null==fa?void 0:fa.CODES.size)&&void 0!==n?n:0):null!==(i=null==fa?void 0:fa.CODES.size)&&void 0!==i?i:2),$d((function(){return e.runOutOfUrlSymbol})),ab((function(t,n){return s.newDomainUsed=!1,t===e.runOutOfUrlSymbol?(s.usedUrl=[],n):ra(t)})))})),x(z(s),"getBackupApUrl$",(function(t){var n,i;return s.genBackupUrl().pipe(yb((function(t){return!(s.backupNewDomainUsed&&t.includes("sd-rtn.com")||(t.includes("sd-rtn.com")&&(s.backupNewDomainUsed=!0),Ol(s.usedUrl,(function(e){var n;return e===(null===(n=t.match(Ai))||void 0===n?void 0:n[1])}))))})),sa((function(t){var e;void 0===fa&&"string"==typeof(t=null===(e=t.match(Ai))||void 0===e?void 0:e[1])&&s.usedUrl.push(t)})),hb(t?Math.max(Ec.RECONNECTING_AP_NUM,null!==(n=null==fa?void 0:fa.CODES.size)&&void 0!==n?n:0):null!==(i=null==fa?void 0:fa.CODES.size)&&void 0!==i?i:2),$d((function(){return e.runOutOfUrlSymbol})),ab((function(t,n){return s.backupNewDomainUsed=!1,t===e.runOutOfUrlSymbol?(s.usedUrl=[],n):ra(t)})))})),x(z(s),"getProxyApUrl$",(function(t){var e,n;return ob.apply(void 0,Z(((null==fa?void 0:fa.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map(xe))).pipe(hb(t?Math.max(Ec.RECONNECTING_AP_NUM,null!==(e=null==fa?void 0:fa.CODES.size)&&void 0!==e?e:0):null!==(n=null==fa?void 0:fa.CODES.size)&&void 0!==n?n:2))})),x(z(s),"context",void 0),x(z(s),"fetchCloudProxy",(function(t,e){var n=uj("AP-",s.loggerId);s.log("The AccessPoint requests %s(%s)",t,n);var i,r=new AbortController;return s.apFinish$.pipe(hb(1)).subscribe((function(){return r.abort()})),yd(ma(N.mark((function i(){var o,a;return N.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=mh(0,Number.MAX_SAFE_INTEGER),s.log("%s request opid: %d",n,a),bb("ApRequest",{sid:s.context.sid,userId:s.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(s.context.startTime),apAddr:t,opId:P.fromNumber(a),envId:0,flag:128},null!==(o=s.context.config.enableCloudProxy)&&void 0!==o&&o),i.abrupt("return",lh(t,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:s.context.sid,opid:a,appid:s.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:null!=e?e:s.context.key,cname:s.context.uid,uid:0,detail:Wa({},void 0===fa?{11:[S.CHINA,S.GLOBAL].join(),12:"1"}:{11:Array.from(fa.CODES).map((function(t){return t===S.OVERSEA?"".concat(S.ASIA,",").concat(S.EUROPE,",").concat(S.AFRICA,",").concat(S.NORTH_AMERICA,",").concat(S.SOUTH_AMERICA,",").concat(S.OCEANIA):t})).join(","),12:"1"})}}]},signal:r.signal}));case 4:case"end":return i.stop()}}),i)})))).pipe(ab((function(e){return"AbortError"!==e.name&&(s.logError(e),s.warn("The AP server %s request failure",t,e)),Sb})),Cb((i=ma(N.mark((function e(i){var r,o,a,c,l,u,d,h,A,p,f,m,g,v,y,_,b,E,w;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=i.responseText,o=JSON.parse(r),s.log("The %s response is %o",n,o),(void 0===(a=o.response_body)||0===a.length||a.some((function(t){var e;return void 0===(null===(e=t.buffer)||void 0===e?void 0:e.code)||23!==t.uri})))&&ra(new Ja("cloud proxy response_body not valid",Pg)),0===(c=a.filter((function(t){return 0!==t.buffer.code}))).length){e.next=14;break}if(void 0===(l=c.find((function(t){return 128===t.buffer.flag})))){e.next=12;break}return e.abrupt("return",s.handleUniLbsError(l.buffer.code,t));case 12:return s.logError("cloud proxy error response"),e.abrupt("return",s.handleUniLbsError(c[0].buffer.code,t));case 14:for(u=[],d=0;d<a.length;d++)if(262144===(null==(p=a[d])||null===(h=p.buffer)||void 0===h?void 0:h.flag))null===(f=p.buffer)||void 0===f||null===(m=f.edges_services)||void 0===m||null===(g=m.forEach)||void 0===g||g.call(m,(function(t){Pn(t=t.ip)&&-1===s.context.cloudProxyServers.indexOf(t)&&(s.log("got cloud proxy server: %s",t),s.context.cloudProxyServers.push(t))}));else if(128===(null==p||null===(A=p.buffer)||void 0===A?void 0:A.flag)){for(b=function(t,e){var n=e[t];u.some((function(t){return t.ip===n.ip}))||u.push({ip:n.ip,ticket:p.buffer.cert})},E=0,w=p.buffer.edges_services;E<w.length;E++)b(E,w);s.context.rtmArea=null!==(v=null===(y=p.buffer)||void 0===y||null===(_=y.detail)||void 0===_?void 0:_[9])&&void 0!==v?v:""}return e.abrupt("return",ob.apply(void 0,Z(u).concat([Mg])));case 19:case"end":return e.stop()}}),e)}))),function(t){return i.apply(this,arguments)})),ab((function(t){return Na(t)?ra(t):Sb})),bh(),yb((function(t){return void 0!==t&&"string"==typeof t.ip&&"string"==typeof t.ticket&&Pn(t.ip)})))})),x(z(s),"fetchAp",(function(t,e){var n=uj("AP-",s.loggerId);s.log("The AccessPoint requests %s(%s)",t,n);var i=new AbortController;s.apFinish$.pipe(hb(1)).subscribe((function(){return i.abort()}));var r,o=mh(0,Number.MAX_SAFE_INTEGER);return yd(ma(N.mark((function r(){var a;return N.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s.log("%s request opid: %d",n,o),bb("ApRequest",{sid:s.context.sid,userId:s.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(s.context.startTime),apAddr:t,opId:P.fromNumber(o),envId:0,flag:128},null!==(a=s.context.config.enableCloudProxy)&&void 0!==a&&a),r.abrupt("return",lh(t,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:o,key:e||s.context.key,cname:s.context.uid,detail:Wa({},void 0===fa?{11:[S.CHINA,S.GLOBAL].join(),12:"1"}:{11:Array.from(fa.CODES).map((function(t){return t===S.OVERSEA?"".concat(S.ASIA,",").concat(S.EUROPE,",").concat(S.AFRICA,",").concat(S.NORTH_AMERICA,",").concat(S.SOUTH_AMERICA,",").concat(S.OCEANIA):t})).join(","),12:"1"}),uid:0,sid:s.context.sid},signal:i.signal}));case 3:case"end":return r.stop()}}),r)})))).pipe(ab((function(e){return"AbortError"!==e.name&&(s.logError(e),s.warn("The AP server %s request failure",t,e)),Sb})),Cb((r=ma(N.mark((function e(i){var r,a,c,l,u,d,h,A,p;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=i.responseText,c=JSON.parse(a),s.log("The %s response is %o",n,c),u=(l=c).code,d=l.addresses,h=l.detail,s.context.vid=h[8],bb("ApEvent",{sid:s.context.sid,userId:s.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(s.context.startTime),apAddr:t,linkServerList:d.map((function(t){return t.ip})),serverErrCode:u,flag:128,envId:0,opId:P.fromNumber(o),errCode:0,area:h[9],isp:h[2]},null!==(r=s.context.config.enableCloudProxy)&&void 0!==r&&r),s.info(c),0===u){e.next=9;break}return e.abrupt("return",s.handleUniLbsError(u,t));case 9:if(A=d,$f(null)&&(p=JSON.parse(null.replace(/-/g,".")),A=p.map((function(t){return{ip:t,ticket:A[0].ticket}}))),0!==A.length){e.next=14;break}return e.abrupt("return",ra(Error("No available edge address to connect")));case 14:return s.context.rtmArea=null==h?void 0:h[9],e.abrupt("return",ob.apply(void 0,Z(A).concat([Mg])));case 16:case"end":return e.stop()}}),e)}))),function(t){return r.apply(this,arguments)})),bh(),ab((function(t){return Na(t)?ra(t):Sb})),yb((function(t){return void 0!==t&&"string"==typeof t.ip&&"string"==typeof t.ticket})))})),s.context=t,s.getApEdgeInfoEndFirst$=function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return dd(0,t||r?Ec.RECONNECTING_AP_INTERVAL:2e3).pipe(hb(1),sa((function(){s.retryCount+=1})),Cb((function(){return s.context.config.enableCloudProxy||s.context.socketUseProxy?s.getProxyApUrl$(t||r):(4<=s.retryCount&&(s.retryCount=0),3>=s.retryCount?s.getApUrl$(t||r):s.getBackupApUrl$(t||r))})),Cb((function(t){return s.context.config.enableCloudProxy||s.context.socketUseProxy?s.fetchCloudProxy(t):s.fetchAp(t)})),ab((function(t){return t instanceof Tb&&s.warn("AP request timeout"),ra(t)})),tn((function(t){return t.ip})),Kc(s.apFinish$))},s.getApEdgeInfo$=function(t){return dd(0,t||r?Ec.RECONNECTING_AP_INTERVAL:2e3).pipe(hb(8),sa((function(){s.retryCount+=1})),Cb((function(){return s.context.config.enableCloudProxy||s.context.socketUseProxy?s.getProxyApUrl$(t||r):3>=s.retryCount?s.getApUrl$(t||r):s.getBackupApUrl$(t||r)})),Cb((function(t){return(s.context.config.enableCloudProxy||s.context.socketUseProxy?s.fetchCloudProxy(t):s.fetchAp(t)).pipe()})),ab((function(t){return t instanceof Tb&&s.warn("AP request timeout"),ra(t)})),tn((function(t){return t.ip})),Kc(s.apFinish$))},s}Ga(e,t);var n=Ha(e);return eb(e,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),e}(sc());x(at,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var bt=yi(),ct=function(t){function e(t,i,r){va(this,e);var s=n.call(this,i,"Connection");x(z(s),"apClient",void 0),x(z(s),"lastOpenSockets",[new Te(1),new Te(1)]),x(z(s),"curOpenSockets",[void 0,void 0]),x(z(s),"ipIterator",0),x(z(s),"loginSocketOpenFailureCount",0),x(z(s),"firstEnv",.5<=Math.random()?1:0),x(z(s),"firstSocketOpener",void 0),x(z(s),"secondSocketOpener",void 0),x(z(s),"firstOpenKeeperSubject",new rb),x(z(s),"secondOpenKeeperSubject",new rb),x(z(s),"blacklistedIP",{}),x(z(s),"edgeInfoReplayed",void 0),x(z(s),"firstEnvOpenSocket",void 0),x(z(s),"firstOpenKeeperSub",void 0),x(z(s),"secondOpenKeeperSub",void 0),x(z(s),"context",void 0),x(z(s),"logger",void 0),s.context=t,s.logger=i,s.apClient=new at(s.context,i),s.apClient.apFinish$.subscribe((function(){s.log("Ap client fetch finished")}));var o,a=[];return s.edgeInfoReplayed=s.apClient.getApEdgeInfo$(r).pipe(Re((function(t){return t.pipe(sa((function(t){if(Na(t))throw t})),Zd(r?ue.getParameter("RECONNECTING_AP_INTERVAL"):900),Kc(dd(2e4)))})),yb((function(t){var e;return!Ol(a,t)&&1>=(null!==(e=s.blacklistedIP[t.ip])&&void 0!==e?e:0)})),$d((function(){return new bt({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),sa((function(t){a.push(t),s.log("An edge info got %o",t)})),sa({error:function(t){s.emit("connectionInitFailure",t)}}),fh((function(){s.apClient.clearUp()})),wn()),s.firstEnvOpenSocket=s.edgeInfoReplayed.pipe(Cb((function(t){if(void 0===t)return ra(Error("Invalid edge info"));var e=new Vl(t.ip,s.firstEnv,t.ticket,s.context,i,o);if(s.firstEnv=1===s.firstEnv?0:1,e.once("connectionFailure",(function(){return s.onSocketConnectionFailure(e)})),!r&&Ec.ENABLE_EDGE_AUTO_FALLBACK&&!s.context.config.enableCloudProxy){var n,a=Date.now();e.on("reconnect",(function(){var t;s.loginSocketOpenFailureCount+=1,null!==(t=n)&&void 0!==t||(n=Date.now()-a),500>n&&1<s.loginSocketOpenFailureCount&&(s.context.socketUseProxy=!0)}))}return o=!e.useNewDomain,e.open$.pipe(Uf(e))})),sa((function(t){s.log("The websocket of ENV_%d opened to %s:%d",t.env,t.ip,Df[t.env]),s.curOpenSockets[t.env]=t,s.lastOpenSockets[t.env].next(t),s.firstEnv=t.env,s.openSecondSocket(t.env,t.ip,t.useNewDomain)})),hb(1),Se()),s.firstSocketOpener=s.firstEnvOpenSocket.pipe(Cb((function(t){return t.open$.pipe(sa((function(){s.log("The websocket of first ENV_%d re-opened to %s:%d",t.env,t.ip,Df[t.env]),s.curOpenSockets[t.env]=t,s.lastOpenSockets[t.env].next(t)})))}))),t=s.firstOpenKeeperSubject.pipe(Kb(wd)),s.firstOpenKeeperSub=t.subscribe({error:s.logError}),s}Ga(e,t);var n=Ha(e);return eb(e,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(t,e){if(![0,1].includes(t))throw new mb({INVALID_ENV:"The env argument is not 0 or 1"});var n=t===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var i=this.curOpenSockets[t];this.curOpenSockets[t]=void 0,i&&(i.isActiveClose=!0,setTimeout((function(){i.close()}),e)),void 0!==n&&setTimeout((function(){null==n||n.unsubscribe()}),e)}},{key:"waitClosing",value:function(t){var e=this;return t.isActiveClose=!0,t.open$.pipe(ev(),ab((function(t){return t.message===ns.normalClosureMessage?Sb:ra(t)})),Lb(5e3),ab((function(n){return n instanceof Tb?(e.warn("Force closing the ENV_%d connection",t.env),Sb):ra(n)})))}},{key:"onSocketConnectionFailure",value:function(t){var e=[0,1].filter((function(e){return e!==t.env}))[0];(e=this.curOpenSockets[e])&&e.loggedIn?this.reopenSocketWithApRequest(t.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(t,e,n){var i=this,r=1===t?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(vn((function(t,e){return[].concat(Z(t),[e])}),[]),Ea((function(t){return ls(t,(function(t){return Sn(e,t.ip)})).slice(-1)[0]})),hb(1),Cb((function(t){if(void 0===t)return ra(Error("Invalid edge info"));var e=new Vl(t.ip,r,t.ticket,i.context,i.logger,n);return e.on("connectionFailure",(function(){return i.onSocketConnectionFailure(e)})),e.open$.pipe(sa((function(){i.lastOpenSockets[r].next(e),i.curOpenSockets[r]=e})))})),Se()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Kb(wd)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(t){var e=this,n=[0,1].filter((function(e){return e!==t}))[0];if(void 0!==(n=this.curOpenSockets[n])){var i,r=n.ip;n=this.apClient.getApEdgeInfoEndFirst$(!0).pipe($d((function(){return new bt({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),Re((function(t){return t.pipe(sa((function(t){if(t.code===ti)e.emit("tokenExpired"),e.apClient.apFinish$.next(void 0);else if(Na(t))throw t})),Zd(ue.getParameter("RECONNECTING_AP_INTERVAL")),Kc(dd(15e3)))})),sa((function(t){e.log("An edge info got %o",t)})),fh((function(){e.apClient.clearUp()}))).pipe(vn((function(t,e){return[].concat(Z(t),[e])}),[]),Ea((function(t){return(t=ls(t,(function(t){return Sn(r,t.ip)}))).length-1>=e.ipIterator?t.slice(-e.ipIterator++-1)[0]:(e.ipIterator=0,t.slice(-1)[0])})),$d(),Cb((function(n){if(void 0===n)return ra(Error("Invalid edge info"));var r=new Vl(n.ip,t,n.ticket,e.context,e.logger,i);return r.on("connectionFailure",(function(){return e.onSocketConnectionFailure(r)})),i=!r.useNewDomain,r.open$.pipe(Uf(r))})),sa((function(n){e.log("The websocket of ENV_%d re-opened to %s:%d using ap",n.env,n.ip,Df[n.env]),e.curOpenSockets[t]=n,e.lastOpenSockets[t].next(n)})),Cb((function(n){return n.open$.pipe(sa((function(){e.log("The websocket of ENV_%d re-opened to %s:%d",n.env,n.ip,Df[n.env]),e.curOpenSockets[t]=n,e.lastOpenSockets[t].next(n)})))})),Se()),t===this.firstEnv?this.firstOpenKeeperSubject.next(n):this.secondOpenKeeperSubject.next(n)}}}]),e}(sc()),xE=function(t){function e(t,i,r){return va(this,e),x(z(r=n.call(this,r,"Context")),"_token",void 0),x(z(r),"config",void 0),x(z(r),"_uid",void 0),x(z(r),"_sid",void 0),x(z(r),"_vid",void 0),x(z(r),"_startTime",void 0),x(z(r),"_area","CN"),x(z(r),"_socketUseProxy",!1),x(z(r),"appId",void 0),x(z(r),"enableCloudProxy",!1),x(z(r),"cloudProxyServers",[]),r.appId=t,r.config=i,r}Ga(e,t);var n=Ha(e);return eb(e,[{key:"socketUseProxy",get:function(){return this._socketUseProxy&&Ec.ENABLE_EDGE_AUTO_FALLBACK},set:function(t){this.log("socketUseProxy is set to %s",t),this._socketUseProxy=t}},{key:"token",set:function(t){this._token="string"==typeof t&&t?t:void 0}},{key:"uid",get:function(){if("string"==typeof this._uid&&this._uid)return this._uid;throw new rc("Cannot get illegal uid")},set:function(t){if(this.log("The user ID is set to %s",La(t)),!Ta(t))throw new rc;this._uid=t}},{key:"vid",get:function(){if("string"==typeof this._vid&&this._vid)return this._vid;throw new rc("Cannot get illegal vid")},set:function(t){this._vid=t}},{key:"key",get:function(){if("string"==typeof this._token&&this._token)return this._token;if("string"==typeof this.appId&&this.appId)return this.appId;throw new rc("Cannot get illegal key")}},{key:"sid",get:function(){if("string"==typeof this._sid&&this._sid)return this._sid;throw new rc("Cannot get illegal sid")},set:function(t){if(this.log("sid is set to %s",t),"string"!=typeof t||!t)throw new rc;this._sid=t}},{key:"startTime",get:function(){if("number"==typeof this._startTime&&this._startTime)return this._startTime;throw new rc("Cannot get illegal startTime")},set:function(t){if(this.log("startTime is set to %s",t),"number"!=typeof t||!t)throw new rc;this._startTime=t}},{key:"rtmArea",get:function(){if("string"==typeof this._area&&this._area)return this._area;throw new rc("Cannot get illegal area")},set:function(t){this.log("area is set to %s",t),"string"==typeof t&&t?this._area=t:this.warn("set area failed")}}]),e}(sc());Sp("of",(function(){for(var t=0,e=arguments.length,n=new(qf(this))(e);e>t;)n[t]=arguments[t++];return n}),rk);var yE=Math.max,Pv=function(t,e,n){var i=Object(t);if(!ae(t)){var r=wf(e);t=Wd(t),e=function(t){return r(i[t],t,i)}}return-1<(e=function(t,e,n){var i=null==t?0:t.length;if(!i)return-1;if(null==n)n=0;else{var r=(n=Rl(n))%1;n=n==n?r?n-r:n:0}return 0>n&&(n=yE(i+n,0)),Yq(t,wf(e),n)}(t,e,n))?i[r?t[e]:e]:void 0},Ov=function(t,e){return t&&t.length?fl(t,void 0,"function"==typeof e?e:void 0):[]},dt=function(){function t(){va(this,t),x(this,"size",0),x(this,"fields",new Map)}return eb(t,[{key:"define",value:function(t,e,n){if(this.size+=n,64<this.size)throw new RangeError("the struct over 64 bits is not supported");th(e={val:0,isNumber:"number"===e,isBoolean:"boolean"===e,oneof:"number"===e||"boolean"===e?void 0:e,len:n}),this.fields.set(t,e)}},{key:"set",value:function(t,e){if(!(t=this.fields.get(t)))throw Error("field not found");var n=t.oneof;if(!P.isLong(e)&&"number"!=typeof e)if("boolean"==typeof e)e=e?1:0;else{if(void 0===n)throw Error("invalid field type");if(void 0===(e=n[e]))throw Error("field type not found")}th(t,e),t.val=e}},{key:"toNumber",value:function(){for(var t=0,e=0,n=0,i=Array.from(this.fields);n<i.length;n++){var r=$a(i[n],2)[1],s=r.len;void 0!==(r=r.val)&&(t+=P.fromValue(r).shiftLeft(e).toNumber(),e+=s)}return t}},{key:"toLong",value:function(){for(var t=P.fromNumber(0,!0),e=0,n=0,i=Array.from(this.fields);n<i.length;n++){var r=$a(i[n],2)[1],s=r.len;void 0!==(r=r.val)&&(t=P.fromValue(r).shiftLeft(e).add(t),e+=s)}return t}},{key:"assert",value:function(t,e){function n(t){if(!P.isLong(t)&&"number"!=typeof t)if("boolean"==typeof t)t=t?1:0;else{if(void 0===r)throw Error("invalid field type");if(void 0===(t=r[t]))throw Error("field type not found")}return th(i,t),sh(t,i.val)}var i=this.fields.get(t);if(!i)throw Error("field not found");var r=i.oneof;if(!Array.isArray(e))return n(e);if(1===e.length)return n(e[0]);if(e.every((function(t){return"string"==typeof t}))&&void 0!==r)return e.some((function(t){return n(t)}));throw Error("invalid valueTypes")}},{key:"from",value:function(t){t=P.fromValue(t);for(var e=0,n=0,i=Array.from(this.fields);n<i.length;n++){var r=$a(i[n],2)[1],s=r.len,o=P.fromNumber(Math.pow(2,s)-1,!0).shiftLeft(e);th(r,o=t.and(o).shiftRightUnsigned(e)),r.val=o,e+=s}}},{key:"typeOf",value:function(t){if(void 0!==(t=this.fields.get(t))){var e=t.oneof;if(t=t.val,void 0!==e){var n=0;for(e=Object.entries(e);n<e.length;n++){var i=$a(e[n],2),r=i[0];if(sh(t,i[1]))return r}}}throw new TypeError("can only get type of oneof type")}}]),t}(),et=function(t){function e(t){va(this,e);var i=n.call(this);return i.define("Rejoin","boolean",1),i.define("Unused","number",31),i.define("Platform","number",8),i.define("Version","number",12),i.define("Subversion","number",12),i.set("Platform",7),i.set("Version",4),i.set("Subversion",18),i.set("Rejoin",t),i}Ga(e,t);var n=Ha(e);return e}(dt),zE=Wa(Wa({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),ft={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},AE=Wa(Wa({},zE),ft),BE={Uncompressed:0,Zlib:1},Ef=function(t){function e(t){va(this,e);var i=n.call(this);if(i.define("MessageType",AE,8),i.define("BroadcastJumps","number",2),i.define("ToCache","boolean",1),i.define("FromCache","boolean",1),i.define("CompressionMethod",BE,2),i.define("IterationNumber","number",4),i.define("BufferedMessage","boolean",1),i.define("ToArchive","boolean",1),i.define("FromArchive","boolean",1),"number"==typeof t||P.isLong(t))i.from(t);else if(void 0!==t){var r=0;for(t=qh(t);r<t.length;r++){var s=$a(t[r],2);i.set(s[0],s[1])}}return i}Ga(e,t);var n=Ha(e);return eb(e,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(t){var e=this;return void 0!==t?this.assert("MessageType",t):Yf(ft).some((function(t){return e.assert("MessageType",t)}))}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),e}(dt),CE=function(t){function e(t){return va(this,e),x(z(t=n.call(this,t,"ChatManager")),"dialogueLru",new xz(void 0,{maxlen:1e4,ttl:1e4})),t}Ga(e,t);var n=Ha(e);return eb(e,[{key:"getChatInfo",value:function(t){var e=this.dialogueLru.get(t);if(this.dialogueLru.prune(),e){var n=e.dialogue,i={dialogue:n,sequence:e=e.sequence.add(1)};return this.dialogueLru.set(t,{dialogue:n,sequence:e}),i}return n={dialogue:nh(),sequence:P.fromNumber(1,!0)},this.dialogueLru.set(t,n),n}}]),e}(sc()),G={};"object"==("undefined"==typeof module?"undefined":qa(module))&&(module.exports=G),G.parse=function(t,e){var n,i=G.bin.readUshort,r=G.bin.readUint,s={};for(n=(t=new Uint8Array(t)).length-4;101010256!=r(t,n);)n--;var o=i(t,n=n+4+4);i(t,n+=2),r(t,n+=2),n=r(t,n+=4);for(var a=0;a<o;a++){r(t,n),n+=4,n+=4,n+=4,r(t,n+=4);var c=r(t,n+=4),l=r(t,n+=4),u=i(t,n+=4),d=i(t,n+2),h=i(t,n+4);n+=6;var A=r(t,n+=8);n+=4,n+=u+d+h,G._readLocal(t,A,s,c,l,e)}return s},G._readLocal=function(t,e,n,i,r,s){var o=G.bin.readUshort,a=G.bin.readUint;a(t,e),o(t,e+=4),o(t,e+=2);var c=o(t,e+=2);a(t,e+=2),a(t,e+=4),a=o(t,e=e+4+8);var l=o(t,e+=2);if(e+=2,o=G.bin.readUTF8(t,e,a),e=e+a+l,s)n[o]={size:r,csize:i};else if(t=new Uint8Array(t.buffer,e),0==c)n[o]=new Uint8Array(t.buffer.slice(e,e+i));else{if(8!=c)throw"unknown compression method: "+c;e=new Uint8Array(r),G.inflateRaw(t,e),n[o]=e}},G.inflateRaw=function(t,e){return G.F.inflate(t,e)},G.inflate=function(t,e){return t[0],t[1],G.inflateRaw(new Uint8Array(t.buffer,t.byteOffset+2,t.length-2),e)},G.deflate=function(t,e){null==e&&(e={level:6});var n=0,i=new Uint8Array(50+Math.floor(1.1*t.length));return i[n]=120,i[n+1]=156,n=G.F.deflateRaw(t,i,n+2,e.level),t=G.adler(t,0,t.length),i[n+0]=t>>>24&255,i[n+1]=t>>>16&255,i[n+2]=t>>>8&255,i[n+3]=t>>>0&255,new Uint8Array(i.buffer,0,n+4)},G.deflateRaw=function(t,e){null==e&&(e={level:6});var n=new Uint8Array(50+Math.floor(1.1*t.length)),i=G.F.deflateRaw(t,n,i,e.level);return new Uint8Array(n.buffer,0,i)},G.encode=function(t,e){null==e&&(e=!1);var n,i=0,r=G.bin.writeUint,s=G.bin.writeUshort,o={};for(n in t){var a=!G._noNeed(n)&&!e,c=t[n],l=G.crc.crc(c,0,c.length);o[n]={cpr:a,usize:c.length,crc:l,file:a?G.deflateRaw(c):c}}for(n in o)i+=o[n].file.length+30+46+2*G.bin.sizeUTF8(n);for(n in t=new Uint8Array(i+22),e=0,c=[],o)l=o[n],c.push(e),e=G._writeHeader(t,e,n,l,0);for(n in i=0,a=e,o)l=o[n],c.push(e),e=G._writeHeader(t,e,n,l,1,c[i++]);return o=e-a,r(t,e,101010256),s(t,e=e+4+4,i),s(t,e+=2,i),r(t,e+=2,o),r(t,e+4,a),t.buffer},G._noNeed=function(t){return t=t.split(".").pop().toLowerCase(),-1!="png,jpg,jpeg,zip".indexOf(t)},G._writeHeader=function(t,e,n,i,r,s){var o=G.bin.writeUint,a=G.bin.writeUshort,c=i.file;return o(t,e,0==r?67324752:33639248),e+=4,1==r&&(e+=2),a(t,e,20),a(t,e+=2,0),a(t,e+=2,i.cpr?8:0),o(t,e+=2,0),o(t,e+=4,i.crc),o(t,e+=4,c.length),o(t,e+=4,i.usize),a(t,e+=4,G.bin.sizeUTF8(n)),a(t,e+=2,0),e+=2,1==r&&(o(t,e=e+2+2+6,s),e+=4),e+=n=G.bin.writeUTF8(t,e,n),0==r&&(t.set(c,e),e+=c.length),e},G.crc={table:function(){for(var t=new Uint32Array(256),e=0;256>e;e++){for(var n=e,i=0;8>i;i++)n=1&n?3988292384^n>>>1:n>>>1;t[e]=n}return t}(),update:function(t,e,n,i){for(var r=0;r<i;r++)t=G.crc.table[255&(t^e[n+r])]^t>>>8;return t},crc:function(t,e,n){return 4294967295^G.crc.update(4294967295,t,e,n)}},G.adler=function(t,e,n){var i=1,r=0,s=e;for(e+=n;s<e;){for(n=Math.min(s+5552,e);s<n;)r+=i+=t[s++];i%=65521,r%=65521}return r<<16|i},G.bin={readUshort:function(t,e){return t[e]|t[e+1]<<8},writeUshort:function(t,e,n){t[e]=255&n,t[e+1]=n>>8&255},readUint:function(t,e){return 16777216*t[e+3]+(t[e+2]<<16|t[e+1]<<8|t[e])},writeUint:function(t,e,n){t[e]=255&n,t[e+1]=n>>8&255,t[e+2]=n>>16&255,t[e+3]=n>>24&255},readASCII:function(t,e,n){for(var i="",r=0;r<n;r++)i+=String.fromCharCode(t[e+r]);return i},writeASCII:function(t,e,n){for(var i=0;i<n.length;i++)t[e+i]=n.charCodeAt(i)},pad:function(t){return 2>t.length?"0"+t:t},readUTF8:function(t,e,n){for(var i,r="",s=0;s<n;s++)r+="%"+G.bin.pad(t[e+s].toString(16));try{i=decodeURIComponent(r)}catch(i){return G.bin.readASCII(t,e,n)}return i},writeUTF8:function(t,e,n){for(var i=n.length,r=0,s=0;s<i;s++){var o=n.charCodeAt(s);if(0==(4294967168&o))t[e+r]=o,r++;else if(0==(4294965248&o))t[e+r]=192|o>>6,t[e+r+1]=128|o>>0&63,r+=2;else if(0==(4294901760&o))t[e+r]=224|o>>12,t[e+r+1]=128|o>>6&63,t[e+r+2]=128|o>>0&63,r+=3;else{if(0!=(4292870144&o))throw"e";t[e+r]=240|o>>18,t[e+r+1]=128|o>>12&63,t[e+r+2]=128|o>>6&63,t[e+r+3]=128|o>>0&63,r+=4}}return r},sizeUTF8:function(t){for(var e=t.length,n=0,i=0;i<e;i++){var r=t.charCodeAt(i);if(0==(4294967168&r))n++;else if(0==(4294965248&r))n+=2;else if(0==(4294901760&r))n+=3;else{if(0!=(4292870144&r))throw"e";n+=4}}return n}},G.F={},G.F.deflateRaw=function(t,e,n,i){var r=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],s=G.F.U,o=G.F._goodIndex;G.F._hash;var a=G.F._putsE,c=0;n<<=3;var l=0,u=t.length;if(0==i){for(;c<u;){var d=Math.min(65535,u-c);a(e,n,c+d==u?1:0),n=G.F._copyExact(t,c,d,e,n+8),c+=d}return n>>>3}a=s.lits,i=s.strt;var h=s.prev,A=0,p=0,f=0,m=0,g=0;for(2<u&&(i[g=G.F._hash(t,0)]=0),c=0;c<u;c++){if(d=g,c+1<u-2){g=G.F._hash(t,c+1);var v=c+1&32767;h[v]=i[g],i[g]=v}if(l<=c){if((14e3<A||26697<p)&&100<u-c&&(l<c&&(a[A]=c-l,A+=2,l=c),n=G.F._writeBlock(c==u-1||l==u?1:0,a,A,m,t,f,c-f,e,n),A=p=m=0,f=c),v=0,c<u-2&&(v=G.F._bestMatch(t,c,h,d,Math.min(r[2],u-c),r[3])),0!=v){d=v>>>16,v&=65535;var y=o(d,s.of0);s.lhst[257+y]++;var _=o(v,s.df0);s.dhst[_]++,m+=s.exb[y]+s.dxb[_],a[A]=d<<23|c-l,a[A+1]=v<<16|y<<8|_,A+=2,l=c+d}else s.lhst[t[c]]++;p++}}for(f==c&&0!=t.length||(l<c&&(a[A]=c-l,A+=2),n=G.F._writeBlock(1,a,A,m,t,f,c-f,e,n));0!=(7&n);)n++;return n>>>3},G.F._bestMatch=function(t,e,n,i,r,s){var o=32767&e,a=n[o],c=o-a+32768&32767;if(a==o||i!=G.F._hash(t,e-c))return 0;for(var l=i=0,u=Math.min(32767,e);c<=u&&0!=--s&&a!=o;){if((0==i||t[e+i]==t[e+i-c])&&(o=G.F._howLong(t,e,c))>i){if(l=c,(i=o)>=r)break;c+2<o&&(o=c+2);for(var d=0,h=0;h<o-2;h++){var A=e-c+h+32768&32767,p=A-n[A]+32768&32767;p>d&&(d=p,a=A)}}c+=(o=a)-(a=n[o])+32768&32767}return i<<16|l},G.F._howLong=function(t,e,n){if(t[e]!=t[e-n]||t[e+1]!=t[e+1-n]||t[e+2]!=t[e+2-n])return 0;var i=e,r=Math.min(t.length,e+258);for(e+=3;e<r&&t[e]==t[e-n];)e++;return e-i},G.F._hash=function(t,e){return(t[e]<<8|t[e+1])+(t[e+2]<<4)&65535},G.saved=0,G.F._writeBlock=function(t,e,n,i,r,s,o,a,c){var l=G.F.U,u=G.F._putsF,d=G.F._putsE;l.lhst[256]++;var h=G.F.getTrees(),A=h[0],p=h[1],f=h[2],m=h[3],g=h[4],v=h[5],y=h[6];h=h[7];var _=32+(0==(c+3&7)?0:8-(c+3&7))+(o<<3),b=i+G.F.contSize(l.fltree,l.lhst)+G.F.contSize(l.fdtree,l.dhst);i=i+G.F.contSize(l.ltree,l.lhst)+G.F.contSize(l.dtree,l.dhst),i+=14+3*v+G.F.contSize(l.itree,l.ihst)+(2*l.ihst[16]+3*l.ihst[17]+7*l.ihst[18]);for(var E=0;286>E;E++)l.lhst[E]=0;for(E=0;30>E;E++)l.dhst[E]=0;for(E=0;19>E;E++)l.ihst[E]=0;if(_=_<b&&_<i?0:b<i?1:2,u(a,c,t),u(a,c+1,_),c+=3,0==_){for(;0!=(7&c);)c++;c=G.F._copyExact(r,s,o,a,c)}else{if(1==_)var w=l.fltree,S=l.fdtree;if(2==_){for(G.F.makeCodes(l.ltree,A),G.F.revCodes(l.ltree,A),G.F.makeCodes(l.dtree,p),G.F.revCodes(l.dtree,p),G.F.makeCodes(l.itree,f),G.F.revCodes(l.itree,f),w=l.ltree,S=l.dtree,d(a,c,m-257),d(a,c+=5,g-1),d(a,c+=5,v-4),c+=4,t=0;t<v;t++)d(a,c+3*t,l.itree[1+(l.ordr[t]<<1)]);c=G.F._codeTiny(y,l.itree,a,c+3*v),c=G.F._codeTiny(h,l.itree,a,c)}for(v=0;v<n;v+=2){for(y=(t=e[v])>>>23,t=s+(8388607&t);s<t;)c=G.F._writeLit(r[s++],w,a,c);0!=y&&(t=(A=e[v+1])>>16,o=A>>8&255,A&=255,d(a,c=G.F._writeLit(257+o,w,a,c),y-l.of0[o]),c+=l.exb[o],u(a,c=G.F._writeLit(A,S,a,c),t-l.df0[A]),c+=l.dxb[A],s+=y)}c=G.F._writeLit(256,w,a,c)}return c},G.F._copyExact=function(t,e,n,i,r){var s=r>>>3;return i[s]=n,i[s+1]=n>>>8,i[s+2]=255-i[s],i[s+3]=255-i[s+1],s+=4,i.set(new Uint8Array(t.buffer,e,n),s),r+(n+4<<3)},G.F.getTrees=function(){for(var t=G.F.U,e=G.F._hufTree(t.lhst,t.ltree,15),n=G.F._hufTree(t.dhst,t.dtree,15),i=[],r=G.F._lenCodes(t.ltree,i),s=[],o=G.F._lenCodes(t.dtree,s),a=0;a<i.length;a+=2)t.ihst[i[a]]++;for(a=0;a<s.length;a+=2)t.ihst[s[a]]++;a=G.F._hufTree(t.ihst,t.itree,7);for(var c=19;4<c&&0==t.itree[1+(t.ordr[c-1]<<1)];)c--;return[e,n,a,r,o,c,i,s]},G.F.getSecond=function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(t[n+1]);return e},G.F.nonZero=function(t){for(var e="",n=0;n<t.length;n+=2)0!=t[n+1]&&(e+=(n>>1)+",");return e},G.F.contSize=function(t,e){for(var n=0,i=0;i<e.length;i++)n+=e[i]*t[1+(i<<1)];return n},G.F._codeTiny=function(t,e,n,i){for(var r=0;r<t.length;r+=2){var s=t[r],o=t[r+1];i=G.F._writeLit(s,e,n,i);var a=16==s?2:17==s?3:7;15<s&&(G.F._putsE(n,i,o,a),i+=a)}return i},G.F._lenCodes=function(t,e){for(var n=t.length;2!=n&&0==t[n-1];)n-=2;for(var i=0;i<n;i+=2){var r=t[i+1],s=i+3<n?t[i+3]:-1,o=i+5<n?t[i+5]:-1,a=0==i?-1:t[i-1];if(0==r&&s==r&&o==r){for(s=i+5;s+2<n&&t[s+2]==r;)s+=2;11>(r=Math.min(s+1-i>>>1,138))?e.push(17,r-3):e.push(18,r-11),i+=2*r-2}else if(r==a&&s==r&&o==r){for(s=i+5;s+2<n&&t[s+2]==r;)s+=2;r=Math.min(s+1-i>>>1,6),e.push(16,r-3),i+=2*r-2}else e.push(r,0)}return n>>>1},G.F._hufTree=function(t,e,n){var i=[],r=t.length,s=e.length,o=0;for(o=0;o<s;o+=2)e[o]=0,e[o+1]=0;for(o=0;o<r;o++)0!=t[o]&&i.push({lit:o,f:t[o]});if(t=i.length,r=i.slice(0),0==t)return 0;if(1==t)return e[1+((n=i[0].lit)<<1)]=1,e[1+((0==n?1:0)<<1)]=1;i.sort((function(t,e){return t.f-e.f})),o=i[0],s=i[1];var a=0,c=1,l=2;for(i[0]={lit:-1,f:o.f+s.f,l:o,r:s,d:0};c!=t-1;)o=a!=c&&(l==t||i[a].f<i[l].f)?i[a++]:i[l++],s=a!=c&&(l==t||i[a].f<i[l].f)?i[a++]:i[l++],i[c++]={lit:-1,f:o.f+s.f,l:o,r:s};for((i=G.F.setDepth(i[c-1],0))>n&&(G.F.restrictDepth(r,n,i),i=n),o=0;o<t;o++)e[1+(r[o].lit<<1)]=r[o].d;return i},G.F.setDepth=function(t,e){return-1!=t.lit?t.d=e:Math.max(G.F.setDepth(t.l,e+1),G.F.setDepth(t.r,e+1))},G.F.restrictDepth=function(t,e,n){var i=0,r=1<<n-e,s=0;for(t.sort((function(t,e){return e.d==t.d?t.f-e.f:e.d-t.d})),i=0;i<t.length&&t[i].d>e;i++){var o=t[i].d;t[i].d=e,s+=r-(1<<n-o)}for(s>>>=n-e;0<s;)(o=t[i].d)<e?(t[i].d++,s-=1<<e-o-1):i++;for(;0<=i;i--)t[i].d==e&&0>s&&(t[i].d--,s++);0!=s&&console.log("debt left")},G.F._goodIndex=function(t,e){var n=0;return e[16|n]<=t&&(n|=16),e[8|n]<=t&&(n|=8),e[4|n]<=t&&(n|=4),e[2|n]<=t&&(n|=2),e[1|n]<=t&&(n|=1),n},G.F._writeLit=function(t,e,n,i){return G.F._putsF(n,i,e[t<<1]),i+e[1+(t<<1)]},G.F.inflate=function(t,e){var n=Uint8Array;if(3==t[0]&&0==t[1])return e||new n(0);var i=G.F,r=i._bitsF,s=i._bitsE,o=i._decodeTiny,a=i.makeCodes,c=i.codes2map,l=i._get17,u=i.U,d=null==e;d&&(e=new n(t.length>>>2<<3));for(var h,A,p,f,m=0,g=0,v=A=0,y=0;0==m;)if(m=r(t,y,1),h=r(t,y+1,2),y+=3,0==h)0!=(7&y)&&(y+=8-(7&y)),h=t[(y=4+(y>>>3))-4]|t[y-3]<<8,d&&(e=G.F._check(e,v+h)),e.set(new n(t.buffer,t.byteOffset+y,h),v),y=y+h<<3,v+=h;else{if(d&&(e=G.F._check(e,v+131072)),1==h&&(p=u.flmap,f=u.fdmap,g=511,A=31),2==h){for(A=s(t,y,5)+257,h=s(t,y+5,5)+1,p=s(t,y+10,4)+4,y+=14,f=0;38>f;f+=2)u.itree[f]=0,u.itree[f+1]=0;for(g=1,f=0;f<p;f++){var _=s(t,y+3*f,3);u.itree[1+(u.ordr[f]<<1)]=_,_>g&&(g=_)}y+=3*p,a(u.itree,g),c(u.itree,g,u.imap),p=u.lmap,f=u.dmap,y=o(u.imap,(1<<g)-1,A+h,t,y,u.ttree),g=(1<<(_=i._copyOut(u.ttree,0,A,u.ltree)))-1,A=(1<<(h=i._copyOut(u.ttree,A,h,u.dtree)))-1,a(u.ltree,_),c(u.ltree,_,p),a(u.dtree,h),c(u.dtree,h,f)}for(;;)if(y+=15&(h=p[l(t,y)&g]),0==(_=h>>>4)>>>8)e[v++]=_;else{if(256==_)break;h=v+_-254,264<_&&(h=v+((_=u.ldef[_-257])>>>3)+s(t,y,7&_),y+=7&_),y+=15&(_=f[l(t,y)&A]);var b=((_=u.ddef[_>>>4])>>>4)+r(t,y,15&_);for(y+=15&_,d&&(e=G.F._check(e,v+131072));v<h;)e[v]=e[v++-b],e[v]=e[v++-b],e[v]=e[v++-b],e[v]=e[v++-b];v=h}}return e.length==v?e:e.slice(0,v)},G.F._check=function(t,e){var n=t.length;return e<=n?t:((e=new Uint8Array(Math.max(n<<1,e))).set(t,0),e)},G.F._decodeTiny=function(t,e,n,i,r,s){for(var o=G.F._bitsE,a=G.F._get17,c=0;c<n;){var l=t[a(i,r)&e];r+=15&l;var u=l>>>4;if(15>=u)s[c]=u,c++;else{var d=l=0;for(16==u?(d=3+o(i,r,2),r+=2,l=s[c-1]):17==u?(d=3+o(i,r,3),r+=3):18==u&&(d=11+o(i,r,7),r+=7),u=c+d;c<u;)s[c]=l,c++}}return r},G.F._copyOut=function(t,e,n,i){for(var r=0,s=0,o=i.length>>>1;s<n;){var a=t[s+e];i[s<<1]=0,i[1+(s<<1)]=a,a>r&&(r=a),s++}for(;s<o;)i[s<<1]=0,i[1+(s<<1)]=0,s++;return r},G.F.makeCodes=function(t,e){var n,i,r=G.F.U,s=t.length,o=r.bl_count;for(n=0;n<=e;n++)o[n]=0;for(n=1;n<s;n+=2)o[t[n]]++;for(r=r.next_code,n=0,o[0]=0,i=1;i<=e;i++)n=n+o[i-1]<<1,r[i]=n;for(e=0;e<s;e+=2)0!=(o=t[e+1])&&(t[e]=r[o],r[o]++)},G.F.codes2map=function(t,e,n){for(var i=t.length,r=G.F.U.rev15,s=0;s<i;s+=2)if(0!=t[s+1]){var o=t[s+1],a=s>>1<<4|o,c=e-o;for(c=(o=t[s]<<c)+(1<<c);o!=c;)n[r[o]>>>15-e]=a,o++}},G.F.revCodes=function(t,e){for(var n=G.F.U.rev15,i=15-e,r=0;r<t.length;r+=2)t[r]=n[t[r]<<e-t[r+1]]>>>i},G.F._putsE=function(t,e,n){n<<=7&e,t[e>>>=3]|=n,t[e+1]|=n>>>8},G.F._putsF=function(t,e,n){n<<=7&e,t[e>>>=3]|=n,t[e+1]|=n>>>8,t[e+2]|=n>>>16},G.F._bitsE=function(t,e,n){return(t[e>>>3]|t[1+(e>>>3)]<<8)>>>(7&e)&(1<<n)-1},G.F._bitsF=function(t,e,n){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)&(1<<n)-1},G.F._get17=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16)>>>(7&e)},G.F._get25=function(t,e){return(t[e>>>3]|t[1+(e>>>3)]<<8|t[2+(e>>>3)]<<16|t[3+(e>>>3)]<<24)>>>(7&e)},G.F.U=function(){var t=Uint16Array,e=Uint32Array;return{next_code:new t(16),bl_count:new t(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new t(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new e(32),flmap:new t(512),fltree:[],fdmap:new t(32),fdtree:[],lmap:new t(32768),ltree:[],ttree:[],dmap:new t(32768),dtree:[],imap:new t(512),itree:[],rev15:new t(32768),lhst:new e(286),dhst:new e(30),ihst:new e(19),lits:new e(15e3),strt:new t(65536),prev:new t(32768)}}(),function(){function t(t,e,n){for(;0!=e--;)t.push(0,n)}for(var e=G.F.U,n=0;32768>n;n++){var i=n;i=(4278255360&(i=(4042322160&(i=(3435973836&(i=(2863311530&i)>>>1|(1431655765&i)<<1))>>>2|(858993459&i)<<2))>>>4|(252645135&i)<<4))>>>8|(16711935&i)<<8,e.rev15[n]=(i>>>16|i<<16)>>>17}for(n=0;32>n;n++)e.ldef[n]=e.of0[n]<<3|e.exb[n],e.ddef[n]=e.df0[n]<<4|e.dxb[n];t(e.fltree,144,8),t(e.fltree,112,9),t(e.fltree,24,7),t(e.fltree,8,8),G.F.makeCodes(e.fltree,9),G.F.codes2map(e.fltree,9,e.flmap),G.F.revCodes(e.fltree,9),t(e.fdtree,32,5),G.F.makeCodes(e.fdtree,5),G.F.codes2map(e.fdtree,5,e.fdmap),G.F.revCodes(e.fdtree,5),t(e.itree,19,0),t(e.ltree,286,0),t(e.dtree,30,0),t(e.ttree,320,0)}();var DE=Array.isArray||function(t){return t&&"number"==typeof t.length},EE=Object.defineProperty({isArray:DE},"__esModule",{value:!0}),FE=Object.defineProperty({isObject:function(t){return null!==t&&"object"===qa(t)}},"__esModule",{value:!0}),GE=Object.defineProperty({isFunction:function(t){return"function"==typeof t}},"__esModule",{value:!0}),HE=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),uh=Object.defineProperty({UnsubscriptionError:HE},"__esModule",{value:!0}),IE=function(){function t(t){this.closed=!1,this._subscriptions=this._parentOrParents=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){if(!this.closed){var e=this._parentOrParents,n=this._ctorUnsubscribe,i=this._unsubscribe,r=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,e instanceof t)e.remove(this);else if(null!==e)for(var s=0;s<e.length;++s)e[s].remove(this);if(GE.isFunction(i)){n&&(this._unsubscribe=void 0);try{i.call(this)}catch(t){var o=t instanceof uh.UnsubscriptionError?eo(t.errors):[t]}}if(EE.isArray(r))for(s=-1,e=r.length;++s<e;)if(n=r[s],FE.isObject(n))try{n.unsubscribe()}catch(t){o=o||[],t instanceof uh.UnsubscriptionError?o=o.concat(eo(t.errors)):o.push(t)}if(o)throw new uh.UnsubscriptionError(o)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(qa(e)){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof t||(e=n,(n=new t)._subscriptions=[e]);break;default:throw Error("unrecognized teardown "+e+" added to Subscription.")}if(null===(e=n._parentOrParents))n._parentOrParents=this;else if(e instanceof t){if(e===this)return n;n._parentOrParents=[e,this]}else{if(-1!==e.indexOf(this))return n;e.push(this)}return null===(e=this._subscriptions)?this._subscriptions=[n]:e.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;e&&-1!==(t=e.indexOf(t))&&e.splice(t,1)},t.EMPTY=((e=new t).closed=!0,e),t}(),JE=Object.defineProperty({Subscription:IE},"__esModule",{value:!0}),KE=Ya&&Ya.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),LE=function(t){function e(e,n){return t.call(this)||this}return KE(e,t),e.prototype.schedule=function(t,e){return this},e}(JE.Subscription),ME=Object.defineProperty({Action:LE},"__esModule",{value:!0}),NE=Ya&&Ya.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),gt=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return NE(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t,t=this.id;var n=this.scheduler;return null!=t&&(this.id=this.recycleAsyncId(n,t,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(n,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(t=this._execute(t,e))?t:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},e.prototype._execute=function(t,e){e=!1;var n=void 0;try{this.work(t)}catch(t){e=!0,n=!!t&&t||Error(t)}if(e)return this.unsubscribe(),n},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,i=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==i&&n.splice(i,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(ME.Action);Object.defineProperty({AsyncAction:gt},"__esModule",{value:!0});var OE=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),ht=Object.defineProperty({Scheduler:OE},"__esModule",{value:!0}),PE=Ya&&Ya.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),it=function(t){function e(n,i){void 0===i&&(i=ht.Scheduler.now);var r=t.call(this,n,(function(){return e.delegate&&e.delegate!==r?e.delegate.now():i()}))||this;return r.actions=[],r.active=!1,r.scheduled=void 0,r}return PE(e,t),e.prototype.schedule=function(n,i,r){return void 0===i&&(i=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,i,r):t.prototype.schedule.call(this,n,i,r)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(ht.Scheduler);Object.defineProperty({AsyncScheduler:it},"__esModule",{value:!0});var QE=Fa("iterator"),Wl=!la((function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n="";return t.pathname="c%20d",e.forEach((function(t,i){e.delete("b"),n+=i+t})),!e.sort||"http://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[QE]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),RE=/[^\0-\u007E]/,SE=/[.\u3002\uFF0E\uFF61]/g,Ff=Math.floor,Xl=String.fromCharCode,jt=function(t){var e=lg(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return Ia(e.call(t))},kt=Pc("fetch"),Yl=Pc("Headers"),TE=Fa("iterator"),lt=cb.set,cc=cb.getterFor("URLSearchParams"),UE=cb.getterFor("URLSearchParamsIterator"),VE=/\+/g,mt=Array(4),WE=function(t){try{return decodeURIComponent(t)}catch(e){return t}},nt=function(t){var e=t.replace(VE," ");t=4;try{return decodeURIComponent(e)}catch(r){for(;t;){var n=e.replace,i=t--;i=mt[i-1]||(mt[i-1]=RegExp("((?:%[\\da-f]{2}){"+i+"})","gi")),e=n.call(e,i,WE)}return e}},ot=/[!'()~]|%20/g,XE={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},pt=function(t){return XE[t]},qt=function(t,e){if(e){e=e.split("&");for(var n,i=0;i<e.length;)(n=e[i++]).length&&(n=n.split("="),t.push({key:nt(n.shift()),value:nt(n.join("="))}))}},YE=function(t){this.entries.length=0,qt(this.entries,t)},Gf=function(t,e){if(t<e)throw TypeError("Not enough arguments")},Zl=Wo((function(t,e){lt(this,{type:"URLSearchParamsIterator",iterator:jt(cc(t).entries),kind:e})}),"Iterator",(function(){var t=UE(this),e=t.kind,n=(t=t.iterator.next()).value;return t.done||(t.value="keys"===e?n.key:"values"===e?n.value:[n.key,n.value]),t})),Rg=function(){Ac(this,Rg,"URLSearchParams");var t,e,n,i=0<arguments.length?arguments[0]:void 0,r=[];if(lt(this,{type:"URLSearchParams",entries:r,updateURL:function(){},updateSearchParams:YE}),void 0!==i)if(xa(i)){var s=lg(i);if("function"==typeof s)for(i=s.call(i),s=i.next;!(t=s.call(i)).done;){var o=(t=jt(Ia(t.value))).next;if((e=o.call(t)).done||(n=o.call(t)).done||!o.call(t).done)throw TypeError("Expected sequence with length 2");r.push({key:e.value+"",value:n.value+""})}else for(t in i)ka(i,t)&&r.push({key:t,value:i[t]+""})}else qt(r,"string"==typeof i?"?"===i.charAt(0)?i.slice(1):i:i+"")},Bi=Rg.prototype;kf(Bi,{append:function(t,e){Gf(arguments.length,2);var n=cc(this);n.entries.push({key:t+"",value:e+""}),n.updateURL()},delete:function(t){Gf(arguments.length,1);for(var e=cc(this),n=e.entries,i=t+"",r=0;r<n.length;)n[r].key===i?n.splice(r,1):r++;e.updateURL()},get:function(t){Gf(arguments.length,1);for(var e=cc(this).entries,n=t+"",i=0;i<e.length;i++)if(e[i].key===n)return e[i].value;return null},getAll:function(t){Gf(arguments.length,1);for(var e=cc(this).entries,n=t+"",i=[],r=0;r<e.length;r++)e[r].key===n&&i.push(e[r].value);return i},has:function(t){Gf(arguments.length,1);for(var e=cc(this).entries,n=t+"",i=0;i<e.length;)if(e[i++].key===n)return!0;return!1},set:function(t,e){Gf(arguments.length,1);for(var n,i=cc(this),r=i.entries,s=!1,o=t+"",a=e+"",c=0;c<r.length;c++)(n=r[c]).key===o&&(s?r.splice(c--,1):(s=!0,n.value=a));s||r.push({key:o,value:a}),i.updateURL()},sort:function(){var t,e,n=cc(this),i=n.entries,r=i.slice();for(e=i.length=0;e<r.length;e++){var s=r[e];for(t=0;t<e;t++)if(i[t].key>s.key){i.splice(t,0,s);break}t===e&&i.push(s)}n.updateURL()},forEach:function(t){for(var e,n=cc(this).entries,i=Dd(t,1<arguments.length?arguments[1]:void 0,3),r=0;r<n.length;)i((e=n[r++]).value,e.key,this)},keys:function(){return new Zl(this,"keys")},values:function(){return new Zl(this,"values")},entries:function(){return new Zl(this,"entries")}},{enumerable:!0}),Za(Bi,TE,Bi.entries),Za(Bi,"toString",(function(){for(var t,e=cc(this).entries,n=[],i=0;i<e.length;)t=e[i++],n.push(encodeURIComponent(t.key).replace(ot,pt)+"="+encodeURIComponent(t.value).replace(ot,pt));return n.join("&")}),{enumerable:!0}),zc(Rg,"URLSearchParams"),ea({global:!0,forced:!Wl},{URLSearchParams:Rg}),Wl||"function"!=typeof kt||"function"!=typeof Yl||ea({global:!0,enumerable:!0,forced:!0},{fetch:function(t){var e=[t];if(1<arguments.length){var n=arguments[1];if(xa(n)){var i=n.body;if("URLSearchParams"===jf(i)){var r=n.headers?new Yl(n.headers):new Yl;r.has("content-type")||r.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),n=jc(n,{body:Nc(0,String(i)),headers:Nc(0,r)})}}e.push(n)}return kt.apply(this,e)}});var Sg=R.URL,ZE=Rg,$E=cb.set,db=cb.getterFor("URL"),aF=Math.floor,rt=Math.pow,st=/[A-Za-z]/,bF=/[\d+-.A-Za-z]/,$l=/\d/,cF=/^(0x|0X)/,dF=/^[0-7]+$/,eF=/^\d+$/,tt=/^[\dA-Fa-f]+$/,fF=/[\0\t\n\r #%/:?@[\\]]/,gF=/[\0\t\n\r #/:?@[\\]]/,hF=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,iF=/[\t\n\r]/g,am=function(t,e){var n;if("["==e.charAt(0)){if("]"!=e.charAt(e.length-1))return"Invalid host";var i=jF(e.slice(1,-1));if(!i)return"Invalid host"}else if(wb(t)){for(i=[],e=e.toLowerCase().replace(SE,".").split("."),n=0;n<e.length;n++){var r=e[n],s=i,o=s.push;if(RE.test(r)){var a=r;r=[];var c=a;a=[];for(var l=0,u=c.length;l<u;){var d=c.charCodeAt(l++);if(55296<=d&&56319>=d&&l<u){var h=c.charCodeAt(l++);56320==(64512&h)?a.push(((1023&d)<<10)+(1023&h)+65536):(a.push(d),l--)}else a.push(d)}l=a.length,u=128;var A=0,p=72;for(c=0;c<a.length;c++){var f=a[c];128>f&&r.push(Xl(f))}for((h=d=r.length)&&r.push("-");h<l;){var m=2147483647;for(c=0;c<a.length;c++)(f=a[c])>=u&&f<m&&(m=f);var g=h+1;if(m-u>Ff((2147483647-A)/g))throw RangeError("Overflow: input needs wider integers to process");for(A+=(m-u)*g,u=m,c=0;c<a.length;c++){if((f=a[c])<u&&2147483647<++A)throw RangeError("Overflow: input needs wider integers to process");if(f==u){var v=A;for(f=36;!(v<(m=f<=p?1:f>=p+26?26:f-p));f+=36){var y=36-m,_=r;m+=(v-=m)%y,_.push.call(_,Xl(m+22+75*(26>m))),v=Ff(v/y)}for(r.push(Xl(v+22+75*(26>v))),p=g,f=0,A=h==d?Ff(A/700):A>>1,A+=Ff(A/p);455<A;f+=36)A=Ff(A/35);p=Ff(f+36*A/(A+38)),A=0,++h}}++A,++u}r="xn--"+r.join("")}o.call(s,r)}if(e=i.join("."),fF.test(e))return"Invalid host";if(null===(i=kF(e)))return"Invalid host"}else{if(gF.test(e))return"Invalid host";for(i="",e=ge(e),n=0;n<e.length;n++)i+=Qd(e[n],Ci)}t.host=i},kF=function(t){var e,n=t.split(".");n.length&&""==n[n.length-1]&&n.pop();var i=n.length;if(4<i)return t;var r=[];for(e=0;e<i;e++){var s=n[e];if(""==s)return t;var o=10;if(1<s.length&&"0"==s.charAt(0)&&(o=cF.test(s)?16:8,s=s.slice(8==o?1:2)),""===s)s=0;else{if(!(10==o?eF:8==o?dF:tt).test(s))return t;s=parseInt(s,o)}r.push(s)}for(e=0;e<i;e++)if(s=r[e],e==i-1){if(s>=rt(256,5-i))return null}else if(255<s)return null;for(t=r.pop(),e=0;e<r.length;e++)t+=r[e]*rt(256,3-e);return t},jF=function(t){var e,n,i=[0,0,0,0,0,0,0,0],r=0,s=null,o=0,a=function(){return t.charAt(o)};if(":"==a()){if(":"!=t.charAt(1))return;o+=2,s=++r}for(;a();){if(8==r)return;if(":"==a()){if(null!==s)return;o++,s=++r}else{for(e=n=0;4>n&&tt.test(a());)e=16*e+parseInt(a(),16),o++,n++;if("."==a()){if(0==n)return;if(o-=n,6<r)return;for(e=0;a();){if(n=null,0<e){if(!("."==a()&&4>e))return;o++}if(!$l.test(a()))return;for(;$l.test(a());){var c=parseInt(a(),10);if(null===n)n=c;else{if(0==n)return;n=10*n+c}if(255<n)return;o++}i[r]=256*i[r]+n,2!=++e&&4!=e||r++}if(4!=e)return;break}if(":"==a()){if(o++,!a())return}else if(a())return;i[r++]=e}}if(null!==s)for(a=r-s,r=7;0!=r&&0<a;)e=i[r],i[r--]=i[s+a-1],i[s+--a]=e;else if(8!=r)return;return i},Tg=function(t){var e,n;if("number"==typeof t){var i=[];for(e=0;4>e;e++)i.unshift(t%256),t=aF(t/256);return i.join(".")}if("object"==typeof t){i="",e=null;for(var r=1,s=null,o=0,a=0;8>a;a++)0!==t[a]?(o>r&&(e=s,r=o),s=null,o=0):(null===s&&(s=a),++o);for(o>r&&(e=s),r=e,e=0;8>e;e++)n&&0===t[e]||(n&&(n=!1),r===e?(i+=e?":":"::",n=!0):(i+=t[e].toString(16),7>e&&(i+=":")));return"["+i+"]"}return t},Ci={},ut=Bg({},Ci,{" ":1,'"':1,"<":1,">":1,"`":1}),vt=Bg({},ut,{"#":1,"?":1,"{":1,"}":1}),bm=Bg({},vt,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Qd=function(t,e){var n=uw(t,0);return 32<n&&127>n&&!ka(e,t)?t:encodeURIComponent(t)},Di={ftp:21,file:null,http:80,https:443,ws:80,wss:443},wb=function(t){return ka(Di,t.scheme)},cm=function(t){return!t.host||t.cannotBeABaseURL||"file"==t.scheme},Ug=function(t,e){var n;return 2==t.length&&st.test(t.charAt(0))&&(":"==(n=t.charAt(1))||!e&&"|"==n)},wt=function(t){var e;return 1<t.length&&Ug(t.slice(0,2))&&(2==t.length||"/"===(e=t.charAt(2))||"\\"===e||"?"===e||"#"===e)},xt=function(t){var e=t.path,n=e.length;!n||"file"==t.scheme&&1==n&&Ug(e[0],!0)||e.pop()},dm={},yt={},em={},zt={},At={},fm={},Bt={},Ct={},Ei={},Fi={},gm={},hm={},im={},jm={},Dt={},km={},Vg={},Yc={},Et={},ye={},vd={},Zc=function(t,e,n,i){var r=n||dm,s=0,o="",a=!1,c=!1,l=!1;for(n||(t.scheme="",t.username="",t.password="",t.host=null,t.port=null,t.path=[],t.query=null,t.fragment=null,t.cannotBeABaseURL=!1,e=e.replace(hF,"")),e=e.replace(iF,""),e=ge(e);s<=e.length;){var u=e[s];switch(r){case dm:if(!u||!st.test(u)){if(n)return"Invalid scheme";r=em;continue}o+=u.toLowerCase(),r=yt;break;case yt:if(u&&(bF.test(u)||"+"==u||"-"==u||"."==u))o+=u.toLowerCase();else{if(":"!=u){if(n)return"Invalid scheme";o="",r=em,s=0;continue}if(n&&(wb(t)!=ka(Di,o)||"file"==o&&(""!=t.username||""!=t.password||null!==t.port)||"file"==t.scheme&&!t.host))return;if(t.scheme=o,n)return void(wb(t)&&Di[t.scheme]==t.port&&(t.port=null));o="","file"==t.scheme?r=jm:wb(t)&&i&&i.scheme==t.scheme?r=zt:wb(t)?r=Ct:"/"==e[s+1]?(r=At,s++):(t.cannotBeABaseURL=!0,t.path.push(""),r=Et)}break;case em:if(!i||i.cannotBeABaseURL&&"#"!=u)return"Invalid scheme";if(i.cannotBeABaseURL&&"#"==u){t.scheme=i.scheme,t.path=i.path.slice(),t.query=i.query,t.fragment="",t.cannotBeABaseURL=!0,r=vd;break}r="file"==i.scheme?jm:fm;continue;case zt:if("/"!=u||"/"!=e[s+1]){r=fm;continue}r=Ei,s++;break;case At:if("/"==u){r=Fi;break}r=Yc;continue;case fm:if(t.scheme=i.scheme,null==u)t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.query=i.query;else if("/"==u||"\\"==u&&wb(t))r=Bt;else if("?"==u)t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.query="",r=ye;else{if("#"!=u){t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.path.pop(),r=Yc;continue}t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,t.path=i.path.slice(),t.query=i.query,t.fragment="",r=vd}break;case Bt:if(!wb(t)||"/"!=u&&"\\"!=u){if("/"!=u){t.username=i.username,t.password=i.password,t.host=i.host,t.port=i.port,r=Yc;continue}r=Fi}else r=Ei;break;case Ct:if(r=Ei,"/"!=u||"/"!=o.charAt(s+1))continue;s++;break;case Ei:if("/"!=u&&"\\"!=u){r=Fi;continue}break;case Fi:if("@"==u){for(a&&(o="%40"+o),a=!0,o=ge(o),u=0;u<o.length;u++){var d=o[u];":"!=d||l?(d=Qd(d,bm),l?t.password+=d:t.username+=d):l=!0}o=""}else if(null==u||"/"==u||"?"==u||"#"==u||"\\"==u&&wb(t)){if(a&&""==o)return"Invalid authority";s-=ge(o).length+1,o="",r=gm}else o+=u;break;case gm:case hm:if(n&&"file"==t.scheme){r=km;continue}if(":"!=u||c){if(null==u||"/"==u||"?"==u||"#"==u||"\\"==u&&wb(t)){if(wb(t)&&""==o)return"Invalid host";if(n&&""==o&&(""!=t.username||""!=t.password||null!==t.port))return;if(r=am(t,o))return r;if(o="",r=Vg,n)return;continue}"["==u?c=!0:"]"==u&&(c=!1),o+=u}else{if(""==o)return"Invalid host";if(r=am(t,o))return r;if(o="",r=im,n==hm)return}break;case im:if(!$l.test(u)){if(null==u||"/"==u||"?"==u||"#"==u||"\\"==u&&wb(t)||n){if(""!=o){if(65535<(r=parseInt(o,10)))return"Invalid port";t.port=wb(t)&&r===Di[t.scheme]?null:r,o=""}if(n)return;r=Vg;continue}return"Invalid port"}o+=u;break;case jm:if(t.scheme="file","/"==u||"\\"==u)r=Dt;else{if(!i||"file"!=i.scheme){r=Yc;continue}if(null==u)t.host=i.host,t.path=i.path.slice(),t.query=i.query;else if("?"==u)t.host=i.host,t.path=i.path.slice(),t.query="",r=ye;else{if("#"!=u){wt(e.slice(s).join(""))||(t.host=i.host,t.path=i.path.slice(),xt(t)),r=Yc;continue}t.host=i.host,t.path=i.path.slice(),t.query=i.query,t.fragment="",r=vd}}break;case Dt:if("/"==u||"\\"==u){r=km;break}i&&"file"==i.scheme&&!wt(e.slice(s).join(""))&&(Ug(i.path[0],!0)?t.path.push(i.path[0]):t.host=i.host),r=Yc;continue;case km:if(null==u||"/"==u||"\\"==u||"?"==u||"#"==u){if(!n&&Ug(o))r=Yc;else{if(""==o){if(t.host="",n)return}else{if(r=am(t,o))return r;if("localhost"==t.host&&(t.host=""),n)return;o=""}r=Vg}continue}o+=u;break;case Vg:if(wb(t)){if(r=Yc,"/"!=u&&"\\"!=u)continue}else if(n||"?"!=u)if(n||"#"!=u){if(null!=u&&(r=Yc,"/"!=u))continue}else t.fragment="",r=vd;else t.query="",r=ye;break;case Yc:if(null==u||"/"==u||"\\"==u&&wb(t)||!n&&("?"==u||"#"==u)){if(".."===(d=(d=o).toLowerCase())||"%2e."===d||".%2e"===d||"%2e%2e"===d?(xt(t),"/"==u||"\\"==u&&wb(t)||t.path.push("")):"."===o||"%2e"===o.toLowerCase()?"/"==u||"\\"==u&&wb(t)||t.path.push(""):("file"==t.scheme&&!t.path.length&&Ug(o)&&(t.host&&(t.host=""),o=o.charAt(0)+":"),t.path.push(o)),o="","file"==t.scheme&&(null==u||"?"==u||"#"==u))for(;1<t.path.length&&""===t.path[0];)t.path.shift();"?"==u?(t.query="",r=ye):"#"==u&&(t.fragment="",r=vd)}else o+=Qd(u,vt);break;case Et:"?"==u?(t.query="",r=ye):"#"==u?(t.fragment="",r=vd):null!=u&&(t.path[0]+=Qd(u,Ci));break;case ye:n||"#"!=u?null!=u&&("'"==u&&wb(t)?t.query+="%27":t.query="#"==u?t.query+"%23":t.query+Qd(u,Ci)):(t.fragment="",r=vd);break;case vd:null!=u&&(t.fragment+=Qd(u,ut))}s++}},Rd=function(t){var e=Ac(this,Rd,"URL"),n=1<arguments.length?arguments[1]:void 0,i=String(t),r=$E(e,{type:"URL"});if(void 0!==n)if(n instanceof Rd)var s=db(n);else if(n=Zc(s={},String(n)))throw TypeError(n);if(n=Zc(r,i,null,s))throw TypeError(n);var o=r.searchParams=new ZE;(i=cc(o)).updateSearchParams(r.query),i.updateURL=function(){r.query=String(o)||null},wa||(e.href=Gi.call(e),e.origin=Ft.call(e),e.protocol=Gt.call(e),e.username=Ht.call(e),e.password=It.call(e),e.host=Jt.call(e),e.hostname=Kt.call(e),e.port=Lt.call(e),e.pathname=Mt.call(e),e.search=Nt.call(e),e.searchParams=Ot.call(e),e.hash=Pt.call(e))},lm=Rd.prototype,Gi=function(){var t=db(this),e=t.scheme,n=t.username,i=t.password,r=t.host,s=t.port,o=t.path,a=t.query,c=t.fragment,l=e+":";return null!==r?(l+="//",""==t.username&&""==t.password||(l+=n+(i?":"+i:"")+"@"),l+=Tg(r),null!==s&&(l+=":"+s)):"file"==e&&(l+="//"),l+=t.cannotBeABaseURL?o[0]:o.length?"/"+o.join("/"):"",null!==a&&(l+="?"+a),null!==c&&(l+="#"+c),l},Ft=function(){var t=db(this),e=t.scheme,n=t.port;if("blob"==e)try{return new Rd(e.path[0]).origin}catch(t){return"null"}return"file"!=e&&wb(t)?e+"://"+Tg(t.host)+(null!==n?":"+n:""):"null"},Gt=function(){return db(this).scheme+":"},Ht=function(){return db(this).username},It=function(){return db(this).password},Jt=function(){var t=db(this),e=t.host;return t=t.port,null===e?"":null===t?Tg(e):Tg(e)+":"+t},Kt=function(){var t=db(this).host;return null===t?"":Tg(t)},Lt=function(){var t=db(this).port;return null===t?"":String(t)},Mt=function(){var t=db(this),e=t.path;return t.cannotBeABaseURL?e[0]:e.length?"/"+e.join("/"):""},Nt=function(){var t=db(this).query;return t?"?"+t:""},Ot=function(){return db(this).searchParams},Pt=function(){var t=db(this).fragment;return t?"#"+t:""},tc=function(t,e){return{get:t,set:e,configurable:!0,enumerable:!0}};if(wa&&To(lm,{href:tc(Gi,(function(t){var e=db(this);if(t=Zc(e,String(t)))throw TypeError(t);cc(e.searchParams).updateSearchParams(e.query)})),origin:tc(Ft),protocol:tc(Gt,(function(t){var e=db(this);Zc(e,String(t)+":",dm)})),username:tc(Ht,(function(t){var e=db(this);if(t=ge(String(t)),!cm(e)){e.username="";for(var n=0;n<t.length;n++)e.username+=Qd(t[n],bm)}})),password:tc(It,(function(t){var e=db(this);if(t=ge(String(t)),!cm(e)){e.password="";for(var n=0;n<t.length;n++)e.password+=Qd(t[n],bm)}})),host:tc(Jt,(function(t){var e=db(this);e.cannotBeABaseURL||Zc(e,String(t),gm)})),hostname:tc(Kt,(function(t){var e=db(this);e.cannotBeABaseURL||Zc(e,String(t),hm)})),port:tc(Lt,(function(t){var e=db(this);cm(e)||(""==(t=String(t))?e.port=null:Zc(e,t,im))})),pathname:tc(Mt,(function(t){var e=db(this);e.cannotBeABaseURL||(e.path=[],Zc(e,t+"",Vg))})),search:tc(Nt,(function(t){var e=db(this);""==(t=String(t))?e.query=null:("?"==t.charAt(0)&&(t=t.slice(1)),e.query="",Zc(e,t,ye)),cc(e.searchParams).updateSearchParams(e.query)})),searchParams:tc(Ot),hash:tc(Pt,(function(t){var e=db(this);""==(t=String(t))?e.fragment=null:("#"==t.charAt(0)&&(t=t.slice(1)),e.fragment="",Zc(e,t,vd))}))}),Za(lm,"toJSON",(function(){return Gi.call(this)}),{enumerable:!0}),Za(lm,"toString",(function(){return Gi.call(this)}),{enumerable:!0}),Sg){var Qt=Sg.createObjectURL,Rt=Sg.revokeObjectURL;Qt&&Za(Rd,"createObjectURL",(function(t){return Qt.apply(Sg,arguments)})),Rt&&Za(Rd,"revokeObjectURL",(function(t){return Rt.apply(Sg,arguments)}))}zc(Rd,"URL"),ea({global:!0,forced:!Wl,sham:!wa},{URL:Rd});var lF=new Blob(["var fakeIdToId = {};onmessage = function (event) {\tvar data = event.data,\t\tname = data.name,\t\tfakeId = data.fakeId,\t\ttime;\tif(data.hasOwnProperty('time')) {\t\ttime = data.time;\t}\tswitch (name) {\t\tcase 'setInterval':\t\t\tfakeIdToId[fakeId] = setInterval(function () {\t\t\t\tpostMessage({fakeId: fakeId});\t\t\t}, time);\t\t\tbreak;\t\tcase 'clearInterval':\t\t\tif (fakeIdToId.hasOwnProperty (fakeId)) {\t\t\t\tclearInterval(fakeIdToId[fakeId]);\t\t\t\tdelete fakeIdToId[fakeId];\t\t\t}\t\t\tbreak;\t}}"]),mF=window.URL.createObjectURL(lF),Ze={},dg=0,Aj=new Worker(mF);Aj.onmessage=function(t){if(t=t.data.fakeId,Ze.hasOwnProperty(t)){var e=Ze[t];t=e.callback,e=e.parameters,t.apply(window,e)}};var nF=function(t){function e(){return va(this,e),n.apply(this,arguments)}Ga(e,t);var n=Ha(e);return eb(e,[{key:"requestAsyncId",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return Qv(t.flush.bind(t,this),n)}},{key:"recycleAsyncId",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(null!==n&&this.delay===n&&!1===this.pending)return e;Ze.hasOwnProperty(e)&&(delete Ze[e],Aj.postMessage({name:"clearInterval",fakeId:e}))}}]),e}(gt),oF=new it(nF),pF=["group"],mm=G.inflate,St=G.deflate,Tt=function(t){function e(t,n,r,s){va(this,e);var o=i.call(this,s,"Session");return x(z(o),"lastNoticeTicket",""),x(z(o),"chatManager",void 0),x(z(o),"usedChannelIds",[]),x(z(o),"msgDedupLru",new Wc(void 0,{maxlen:200})),x(z(o),"startTime",Date.now()),x(z(o),"seq",P.fromNumber(1,!0)),x(z(o),"userJoinOptions",new et(!1)),x(z(o),"seqSentStatuses",[!1,!1]),x(z(o),"dialogueSequenceLru",new Wc(void 0,{maxlen:1e4})),x(z(o),"loggedOut",!1),x(z(o),"messageSentTimes",[]),x(z(o),"curLoginSockets",[void 0,void 0]),x(z(o),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),x(z(o),"lastLoginSockets",[new Te(1),new Te(1)]),x(z(o),"dialPendingMsgSubjectMap",new Map),x(z(o),"context",void 0),x(z(o),"connection",void 0),x(z(o),"instanceId",void 0),x(z(o),"lastPingTime",void 0),x(z(o),"chanelStringMessageReport",void 0),x(z(o),"chanelRawMessageReport",void 0),x(z(o),"p2pSMsgNoOfflineReport",void 0),x(z(o),"p2pRMsgNoOfflineReport",void 0),x(z(o),"registerSocketsFailureListener",(function(){o.connection.once("socketsFailure",(function(){o.log("socketsFailure, creating a new connection"),yd((function(){return o.connection.removeAllListeners(),o.connection=new ct(o.context,o.logger,!0),o.loginHandler(15e3,!0)})).pipe(Re((function(t){return t.pipe(Zd(ue.getParameter("RECONNECTING_AP_INTERVAL")))})),Kc(o.connection.apClient.apFinish$)).subscribe((function(){o.log("new connection connected")}))})),0===o.connection.listenerCount("tokenExpired")&&o.connection.on("tokenExpired",(function(){o.emit("tokenExpired")}))})),o.context=t,o.context.startTime=o.startTime,o.connection=n,o.instanceId=r,o.chatManager=new CE(s),o.lastPingTime=[0,0],o.setMaxListeners(512),o.log("The instanceId is %s",o.instanceId.toString()),o.chanelStringMessageReport=new zi(t,s,Ka.ChannelSMsg),o.chanelRawMessageReport=new zi(t,s,Ka.ChannelRMsg),o.p2pSMsgNoOfflineReport=new zi(t,s,Ka.P2pSMsgNoOfflineFlag),o.p2pRMsgNoOfflineReport=new zi(t,s,Ka.P2pRMsgNoOfflineFlag),o}Ga(e,t);var n,i=Ha(e);return eb(e,[{key:"loginHandler",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:12e3,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.loggedOut&&n)throw new da("Already logged out, request ignored");n&&this.registerSocketsFailureListener(),this.connection.initConnection();var i=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),r=Date.now();return i.forEach((function(e,i){var s=t.loginSocketSubs[i].login;void 0!==s&&s.unsubscribe(),t.loginSocketSubs[i].login=e.pipe(sa((function(e){var s;t.curLoginSockets[i]=e;var o=Date.now();bb("Link",{ackedServerIp:e.address,destServerIp:e.ip,ec:0,sc:0,elapse:Xa(t.startTime),lts:P.fromNumber(o),responseTime:o-r,sid:sb(t.instanceId),userId:t.context.uid},null!==(s=t.context.config.enableCloudProxy)&&void 0!==s&&s),t.emit("userJoined",e.env),n&&t.connection.apClient.apFinish$.next(void 0)}))).subscribe(t.lastLoginSockets[i])})),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Jb.apply(void 0,Z(i).concat([Db(this.connection,"connectionInitFailure").pipe(sa((function(t){if(Na(t)||Ab(t))throw t;throw new Ja("Login failure",{code:$r,originalError:t})})))])).pipe(hb(1),Lb(e),ab((function(e){return e instanceof Tb&&t.warn("Client login timeout"),e&&e.code===ti&&(t.connection.emit("tokenExpired"),t.connection.apClient.apFinish$.next(void 0)),t.clearSockets(0,n),ra(e)})),sa((function(){n||t.registerSocketsFailureListener()})),fh((function(){n||t.connection.apClient.apFinish$.next(void 0)})))}},{key:"logoutHandler",value:(n=ma(N.mark((function t(){var e,n,i,r=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),e=this.getLoginSockets(),n=e.map((function(t){return t.sendPacket("UserQuit",{}),r.connection.waitClosing(t)})),this.clearSockets(5e3),i=e.map((function(t){return t.env})),[0,1].filter((function(t){return!i.includes(t)})).forEach((function(t){r.connection.closeSocket(t,0)})),t.abrupt("return",Jb.apply(void 0,Z(n)).toPromise());case 9:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"requestChannelJoin",value:function(){var t=ma(N.mark((function t(e){var n,i,r,s=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==this.getLoginSockets().length){t.next=2;break}throw new da("Client is not logged in. Cannot join the channel",Wr);case 2:return n=Db(this,"channelLeft").pipe(yb((function(t){return e===t})),hb(1)),i=this.incGetSeq(),(r=this.lastLoginSockets.map((function(t){return t.pipe(Kb((function(t,n){0!==n&&s.incSeqIfNeeded(t.env);var r=0===n?i:s.seq;return t.sendPacket("GroupEnter",{account:e,seq:r}),t.fromReceived("GroupReply").pipe(Ca((function(t){return r.eq(t.seq)})),sa((function(t){if(0!==(t=t.code))throw new Ja(["Channel join failure. The response code is %d",t],Sr)})))})),Kc(n),Se())}))).forEach((function(t,n){var i=function(){return s.loginSocketSubs[n].channels.delete(e)};s.loginSocketSubs[n].channels.set(e,t.subscribe({error:i,complete:i}))})),t.next=8,Jb.apply(void 0,Z(r)).pipe(hb(1),Lb(1e4),ab((function(t){return t instanceof Tb&&s.warn("Channel join timeout"),ra(t)}))).toPromise();case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(t){this.getLoginSockets().forEach((function(e){e.sendPacket("GroupLeave",{account:t})}))}},{key:"requestUpdateEdgeTicket",value:function(t){var n=this,i=this.getLoginSockets();if(0===i.length)throw new da("Client is not logged in. Cannot renew token",hs);var r=this.incGetSeq();return i.forEach((function(e){e.sendPacket("UserRenewTokenReq",{instance:n.instanceId,seq:r,account:n.context.uid,ticket:t})})),fb.apply(void 0,[e.genTimeoutError(Ml)].concat(Z(i.map((function(t){return t.fromReceived("UserRenewTokenResp").pipe(Ca((function(t){var e=t.code;return r.eq(t.seq)&&0===e})))})))))}},{key:"requestChannelMemberList",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in. Cannot get the channel members",JB);var i=this.incGetSeq();return n.forEach((function(e){e.sendPacket("GroupAllUsersList",{group:t,pageNumber:0,pageSize:200,seq:i})})),fb.apply(void 0,[e.genTimeoutError(Qr)].concat(Z(n.map((function(e){return e.fromReceived("GroupAllUsersResult").pipe(Ca((function(e){var n=e.seq;return e.group===t&&i.eq(n)})))})))))}},{key:"requestPeersOnlineStatus",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var i=this.incGetSeq();return n.forEach((function(e){e.sendPacket("UserStatusList",{users:t,seq:i})})),fb.apply(void 0,[e.genTimeoutError(VB)].concat(Z(n.map((function(t){return t.fromReceived("UserStatusResult").pipe(Ca((function(t){return i.eq(t.seq)})))})))))}},{key:"requestSetLocalUserAttributes",value:function(t,n){var i=this,r=this.getLoginSockets();if(0===r.length)throw new da("Client is not logged in");var s=this.incGetSeq();return r.forEach((function(e,r){void 0!==n&&r!==n||e.sendPacket("UserAttributeSet",{account:i.context.uid,attributeInfos:Object.entries(t).map((function(t){return{key:(t=$a(t,2))[0],value:t[1]}})),seq:s})})),fb.apply(void 0,Z(r.map((function(t){return t.fromReceived("UserAttributeErr").pipe(Ca((function(t){return s.eq(t.seq)})),Ea((function(t){throw new Ja(["The user attributes set failure, code %d",t.code],oc)})))}))).concat([e.genTimeoutError(pc)],Z(r.map((function(t){return t.fromReceived("UserAttributeRsp").pipe(Ca((function(t){return s.eq(t.seq)})))})))))}},{key:"requestSetChannelAttributes",value:function(t,n,i){var r=this.getLoginSockets();if(0===r.length)throw new da("Client is not logged in");var s=this.incGetSeq();return r.forEach((function(e){e.sendPacket("GroupAttributeSet",{broadcast:i,group:t,attributeInfos:Object.entries(n).map((function(t){return{key:(t=$a(t,2))[0],value:t[1]}})),seq:s})})),fb.apply(void 0,Z(r.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(Ca((function(t){return s.eq(t.seq)})),Ea((function(t){throw new Ja(["The group attributes set failure, code %d",t.code],oc)})))}))).concat([e.genTimeoutError(pc)],Z(r.map((function(t){return t.fromReceived("GroupAttributeRsp").pipe(Ca((function(t){return s.eq(t.seq)})))})))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(t){var n=this,i=this.getLoginSockets();if(0===i.length)throw new da("Client is not logged in");var r=this.incGetSeq();return i.forEach((function(e){e.sendPacket("UserAttributeMod",{account:n.context.uid,attributeInfos:Object.entries(t).map((function(t){return{key:(t=$a(t,2))[0],value:t[1]}})),seq:r})})),fb.apply(void 0,Z(i.map((function(t){return t.fromReceived("UserAttributeErr").pipe(Ca((function(t){return r.eq(t.seq)})),Ea((function(t){throw new Ja(["The user attributes add or update failure, code %d",t.code],oc)})))}))).concat([e.genTimeoutError(pc)],Z(i.map((function(t){return t.fromReceived("UserAttributeRsp").pipe(Ca((function(t){return r.eq(t.seq)})))})))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(t,n,i){var r=this.getLoginSockets();if(0===r.length)throw new da("Client is not logged in");var s=this.incGetSeq();return r.forEach((function(e){e.sendPacket("GroupAttributeMod",{broadcast:i,group:t,attributeInfos:Object.entries(n).map((function(t){return{key:(t=$a(t,2))[0],value:t[1]}})),seq:s})})),fb.apply(void 0,Z(r.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(Ca((function(t){return s.eq(t.seq)})),Ea((function(t){throw new Ja(["The group attributes add or update failure, code %d",t.code],oc)})))}))).concat([e.genTimeoutError(pc)],Z(r.map((function(t){return t.fromReceived("GroupAttributeRsp").pipe(Ca((function(t){return s.eq(t.seq)})))})))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(t){var n=this,i=this.getLoginSockets();if(0===i.length)throw new da("Client is not logged in");var r=this.incGetSeq();return i.forEach((function(e){e.sendPacket("UserAttributeDel",{account:n.context.uid,attributes:t,seq:r})})),fb.apply(void 0,Z(i.map((function(t){return t.fromReceived("UserAttributeErr").pipe(Ca((function(t){return r.eq(t.seq)})),Ea((function(t){throw new Ja(["The user attributes delete failure, code %d",t.code],oc)})))}))).concat([e.genTimeoutError(pc)],Z(i.map((function(t){return t.fromReceived("UserAttributeRsp").pipe(Ca((function(t){return r.eq(t.seq)})))})))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(t,n,i){var r=this.getLoginSockets();if(0===r.length)throw new da("Client is not logged in");var s=this.incGetSeq();return r.forEach((function(e){e.sendPacket("GroupAttributeDel",{group:t,broadcast:i,attributes:n,seq:s})})),fb.apply(void 0,Z(r.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(Ca((function(t){return s.eq(t.seq)})),Ea((function(t){throw new Ja(["The channel attributes delete failure, code %d",t.code],oc)})))}))).concat([e.genTimeoutError(pc)],Z(r.map((function(t){return t.fromReceived("GroupAttributeRsp").pipe(Ca((function(t){return s.eq(t.seq)})))})))))}},{key:"requestClearLocalUserAttributes",value:function(){var t=this,n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var i=this.incGetSeq();return n.forEach((function(e){e.sendPacket("UserAttributeSet",{account:t.context.uid,seq:i,attributeInfos:[]})})),fb.apply(void 0,Z(n.map((function(t){return t.fromReceived("UserAttributeErr").pipe(Ca((function(t){return i.eq(t.seq)})),Ea((function(t){throw new Ja(["The user attributes clear failure, code %d",t.code],oc)})))}))).concat([e.genTimeoutError(pc)],Z(n.map((function(t){return t.fromReceived("UserAttributeRsp").pipe(Ca((function(t){return i.eq(t.seq)})))})))))}},{key:"requestClearChannelAttributes",value:function(t,n){var i=this.getLoginSockets();if(0===i.length)throw new da("Client is not logged in");var r=this.incGetSeq();return i.forEach((function(e){e.sendPacket("GroupAttributeSet",{group:t,seq:r,attributeInfos:[],broadcast:n})})),fb.apply(void 0,Z(i.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(Ca((function(t){return r.eq(t.seq)})),Ea((function(t){throw new Ja(["The channel attributes clear failure, code %d",t.code],oc)})))}))).concat([e.genTimeoutError(pc)],Z(i.map((function(t){return t.fromReceived("GroupAttributeRsp").pipe(Ca((function(t){return r.eq(t.seq)})))})))))}},{key:"requestGetUserAttributesByKeys",value:function(t,n){var i=this.getLoginSockets();if(0===i.length)throw new da("Client is not logged in");var r=this.incGetSeq();return i.forEach((function(e){e.sendPacket("UserAttributeGet",{account:t,seq:r,attributes:n})})),fb.apply(void 0,[e.genTimeoutError(pc)].concat(Z(i.map((function(t){return t.fromReceived("UserAttributeErr").pipe(Ca((function(t){return r.eq(t.seq)})),Ea((function(t){if(10008===(t=t.code))throw new Ja("The user requested is not online",Mr);throw new ve(["User attribute operation unknown error code: %d",t],oc)})))}))),Z(i.map((function(t){return t.fromReceived("UserAttributeRet").pipe(Ca((function(t){return r.eq(t.seq)})))})))))}},{key:"requestGetChannelAttributesByKeys",value:function(t,n){var i=this.getLoginSockets();if(0===i.length)throw new da("Client is not logged in");var r=this.incGetSeq();return i.forEach((function(e){e.sendPacket("GroupAttributeGet",{group:t,seq:r,attributes:n})})),fb.apply(void 0,[e.genTimeoutError(pc)].concat(Z(i.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(Ca((function(t){return r.eq(t.seq)})),Ea((function(t){throw new Ja(["The channel attributes get failure, code %d",t.code],oc)})))}))),Z(i.map((function(t){return t.fromReceived("GroupAttributeRet").pipe(Ca((function(t){return r.eq(t.seq)})))})))))}},{key:"requestGetUserAttributeKeys",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var i=this.incGetSeq();return n.forEach((function(e){e.sendPacket("UserAttributeKeysGet",{account:t,seq:i})})),fb.apply(void 0,[e.genTimeoutError(pc)].concat(Z(n.map((function(t){return t.fromReceived("UserAttributeErr").pipe(Ca((function(t){return i.eq(t.seq)})),Ea((function(t){if(10008===(t=t.code))throw new Ja("The user requested is not online",Mr);throw new ve(["User attribute operation unknown error code: %d",t],oc)})))}))),Z(n.map((function(t){return t.fromReceived("UserAttributeKeysRet").pipe(Ca((function(t){return i.eq(t.seq)})))})))))}},{key:"requestGetChannelAttributesKeys",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var i=this.incGetSeq();return n.forEach((function(e){e.sendPacket("GroupAttributeKeysGet",{group:t,seq:i})})),fb.apply(void 0,[e.genTimeoutError(pc)].concat(Z(n.map((function(t){return t.fromReceived("GroupAttributeErr").pipe(Ca((function(t){return i.eq(t.seq)})),Ea((function(t){throw new ve(["Channel attribute operation unknown error code: %d",t.code],oc)})))}))),Z(n.map((function(t){return t.fromReceived("GroupAttributeKeysRet").pipe(Ca((function(t){return i.eq(t.seq)})))})))))}},{key:"requestGetChannelMemberCount",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var i=this.incGetSeq();return n.forEach((function(e){e.sendPacket("GroupStatusList",{groups:t,seq:i})})),fb.apply(void 0,[e.genTimeoutError(Qr)].concat(Z(n.map((function(t){return t.fromReceived("GroupStatusResult").pipe(Ca((function(t){return i.eq(t.seq)})))})))))}},{key:"requestSubscribePeersOnlineStatus",value:function(t){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var i=this.incGetSeq();return n.forEach((function(e){e.sendPacket("SubscribeUserStatus",{seq:i,users:t})})),fb.apply(void 0,[e.genTimeoutError($B)].concat(Z(n.map((function(t){return t.fromReceived("SubscribeResponse").pipe(Ca((function(t){return i.eq(t.seq)})))})))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(t){var e=this.getLoginSockets();if(0===e.length)throw new da("Client is not logged in");var n=this.incGetSeq();e.forEach((function(e){e.sendPacket("UnsubscribeUserStatus",{seq:n,users:t})}))}},{key:"sendInvitationMessage",value:function(){var t=ma(N.mark((function t(e){var n,i,r,s,o,a,c,l,u,d,h,A,p=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.peerId,i=e.callId,r=e.extra,s=e.isAcceptAck,o=e.channelId,a=e.type,c={callId:i},void 0===s){t.next=6;break}if("CallAccept"===a){t.next=5;break}throw Error("invalid invitation type");case 5:c.type=s?"ack":"request";case 6:return c.channel=o,("CallInvite"===a||"CallCancel"===a||"CallReject"===a||"CallAccept"===a&&!1===s)&&void 0!==r&&(c.extra=r),l=nh(),this.log("The sent invitation body is %o",c),u=function(t){return{MiscMap:{},sequence:P.fromNumber(1),dialogue:l,instance:p.instanceId,dst:n,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:t,MessageType:a}).toLong(),payload:(new TextEncoder).encode(JSON.stringify(c)),src:p.context.uid}},t.next=14,Jc(this.sendMessageToRetry(u,!0)).pipe(Lb(1e4),ab((function(t){return t instanceof Tb&&p.warn("Send invitation timeout"),ra(t)}))).toPromise();case 14:return d=t.sent,h=d.code,A=d.retryTimes,t.abrupt("return",{hasPeerReceived:0===h,hasReSent:0!==A});case 18:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var t=ma(N.mark((function t(e,n,i,r,s){var o,a,c,l,u,d,h,A,p,f,m,g=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=Date.now(),a=r?Ka.P2pRMsgNoOfflineFlag:Ka.ChannelRMsg,Ta(i)&&e instanceof Uint8Array&&"string"==typeof n){t.next=4;break}throw new ca("The send message arguments are not valid",r?fs:qi);case 4:if(!(32768<e.byteLength+new Blob([n]).size)){t.next=8;break}throw this.emit("messageCount",{messageCategory:a,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:a,type:"common",key:"invalidmessagecount"}),new ic("The message size is over the 32KB limit",r?bg:Il);case 8:return c=!ue.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=e.byteLength,l=this.chatManager.getChatInfo(i),u=l.dialogue,d=l.sequence,h=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(h,"-").concat(u,"#").concat(d,'"'),c?" compressed":"",r?"peer":"channel",La(i)),A=function(t){return{MiscMap:{description:(new TextEncoder).encode(n)},sequence:d,dialogue:u,instance:h,dst:i,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:t,CompressionMethod:c?"Zlib":"Uncompressed",MessageType:r?"PeerRawMessage":"ChannelRawMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:c?St(e):e,src:g.context.uid}},t.next=15,Jc(this.sendMessageToRetry(A,!0)).pipe(Lb(void 0===s?1e4:s),ab((function(t){return t instanceof Tb&&g.warn("Send message timeout"),ra(t)}))).toPromise();case 15:return p=t.sent,f=p.code,m=0===f,this.emit("messageCount",{messageCategory:a,type:"common",key:"sentcount"}),m&&(this.emit("messageCount",{messageCategory:a,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:a,type:r?"peer":"recipient",delay:Xa(o).toNumber()})),t.abrupt("return",{hasPeerReceived:m});case 21:case"end":return t.stop()}}),t,this)})));return function(e,n,i,r,s){return t.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var t=ma(N.mark((function t(e,n,i,r){var s,o,a,c,l,u,d,h,A,p,f,m,g=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=Date.now(),o=i?Ka.P2pSMsgNoOfflineFlag:Ka.ChannelSMsg,Ta(n)){t.next=4;break}throw new ca("The send message arguments are not valid",i?fs:qi);case 4:if(!(32768<new Blob([e]).size)){t.next=8;break}throw this.emit("messageCount",{messageCategory:o,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:o,type:"common",key:"invalidmessagecount"}),new ic("The message size is over the 32KB limit",i?bg:Il);case 8:return a=!ue.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([e]).size,c=this.chatManager.getChatInfo(n),l=c.dialogue,u=c.sequence,d=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(d,"-").concat(l,"#").concat(u,'"'),a?" compressed":"",i?"peer":"channel",La(n)),h=(new TextEncoder).encode(e),A=function(t){return{MiscMap:{},sequence:u,dialogue:l,instance:d,dst:n,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:t,CompressionMethod:a?"Zlib":"Uncompressed",MessageType:i?"PeerTextMessage":"ChannelTextMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:a?St(h):h,src:g.context.uid}},t.next=16,Jc(this.sendMessageToRetry(A,!0)).pipe(Lb(void 0===r?1e4:r),ab((function(t){return t instanceof Tb&&(g.emit("messageCount",{messageCategory:o,type:"common",key:"sentcount"}),g.emit("messageCount",{messageCategory:o,type:"common",key:"timeoutcount"}),g.warn("Send message timeout")),ra(t)}))).toPromise();case 16:return p=t.sent,f=p.code,m=0===f,this.emit("messageCount",{messageCategory:o,type:"common",key:"sentcount"}),m&&(this.emit("messageCount",{messageCategory:o,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:o,type:i?"peer":"recipient",delay:Xa(s).toNumber()})),t.abrupt("return",{hasPeerReceived:m});case 22:case"end":return t.stop()}}),t,this)})));return function(e,n,i,r){return t.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(t,e){Object.entries(this.loginSocketSubs[t]).forEach((function(t){var n=(t=$a(t,2))[1];"channels"===t[0]&&e||(Array.isArray(n)||n instanceof Map?n.forEach((function(t){return t.unsubscribe()})):n&&n.unsubscribe())})),this.loginSocketSubs[t]={channels:e?this.loginSocketSubs[t].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var t=ma(N.mark((function t(e,n){var i,r,s,o,a,c,l,u,d,h=this,A=arguments;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=2<A.length&&void 0!==A[2]?A[2]:0,this.log("Attempt to send the message ".concat(n?" with retrying, %o":"without retrying"),{retryTimes:i}),0!==(r=this.getLoginSockets()).length){t.next=5;break}throw Error("no logged-in sockets");case 5:return s=e(i),r.forEach((function(t){t.sendPacket("Message",s)})),o=s.dialogue,a=s.sequence,c=s.instance,l=r.map((function(t){return t.fromReceived("Ack").pipe(yb((function(t){return o.eq(t.dialogue)&&a.eq(t.sequence)&&c.eq(t.instance)})))})),t.prev=9,t.next=12,Jb.apply(void 0,Z(l)).pipe(Lb(6e3),ab((function(t){return Ab(t)&&h.warn("Message send timeout, retry times %d",i),ra(t)})),hb(1)).toPromise();case 12:return u=t.sent,d=u.code,this.log("The message has been acked, %o",{code:d}),t.abrupt("return",{code:d,retryTimes:i});case 18:if(t.prev=18,t.t0=t.catch(9),!(t.t0 instanceof Tb&&n)){t.next=22;break}return t.abrupt("return",this.sendMessageToRetry(e,!1,i+1));case 22:throw t.t0;case 23:case"end":return t.stop()}}),t,this,[[9,18]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var t=this;this.lastLoginSockets.map((function(e){return e.pipe(Kb((function(e){return dd(0,2500,Ce()?void 0:oF).pipe(sa((function(){t.sendPing(e)})))})))})).forEach((function(e,n){var i=t.loginSocketSubs[n].keepAlive;void 0!==i&&i.unsubscribe(),t.loginSocketSubs[n].keepAlive=e.subscribe({error:function(){}})}))}},{key:"initKeepAliveReconnector",value:function(){var t=this;this.lastLoginSockets.map((function(t){return t.pipe(Kb((function(t){var e,n=!1,i=t.userJoin$.pipe(sa((function(){n=!0}))),r=t.input$.pipe(sa((function(t){"Ping"!==yj[t.uri].slice(0,-3)&&(n=!1)})));return Jb(dd(6e3,1e4).pipe(yv(t.receivedPacket),sa((function(i){i=$a(i,2),i=$a(i[1],2)[1],e!==i||n||t.forceReconnect(),e=i}))),i,r)})))})).forEach((function(e,n){var i=t.loginSocketSubs[n].keepAliveReconnector;void 0!==i&&i.unsubscribe(),t.loginSocketSubs[n].keepAliveReconnector=e.subscribe({error:function(){}})}))}},{key:"initLoginReceiver",value:function(){var t=this;fb.apply(void 0,Z(this.lastLoginSockets.map((function(e){return e.pipe(Kb((function(e){return e.fromReceived("UserTicketNearlyExpire").pipe(sv(5e3),sa(t.onUserTicketNearlyExpire(e)))})))})))).subscribe();var e=Db(this,"messageCount"),n=e.pipe(yb((function(t){return t.messageCategory===Ka.ChannelSMsg})));n.subscribe((function(e){return t.updateMessageCount(e)})),n.pipe(dh(6e3)).subscribe((function(e){e.length&&t.chanelStringMessageReport.report()})),Jb(ob(void 0),n).pipe(Kb((function(){return Qe(36e5)}))).subscribe((function(){t.chanelStringMessageReport.report()})),(n=e.pipe(yb((function(t){return t.messageCategory===Ka.ChannelRMsg})))).subscribe((function(e){return t.updateMessageCount(e)})),n.pipe(dh(6e3)).subscribe((function(e){e.length&&t.chanelRawMessageReport.report()})),Jb(ob(void 0),n).pipe(Kb((function(){return Qe(36e5)}))).subscribe((function(){t.chanelRawMessageReport.report()})),(n=e.pipe(yb((function(t){return t.messageCategory===Ka.P2pSMsgNoOfflineFlag})))).subscribe((function(e){return t.updateMessageCount(e)})),n.pipe(dh(6e3)).subscribe((function(e){e.length&&t.p2pSMsgNoOfflineReport.report()})),Jb(ob(void 0),n).pipe(Kb((function(){return Qe(36e5)}))).subscribe((function(){t.p2pSMsgNoOfflineReport.report()})),(e=e.pipe(yb((function(t){return t.messageCategory===Ka.P2pRMsgNoOfflineFlag})))).subscribe((function(e){return t.updateMessageCount(e)})),e.pipe(dh(6e3)).subscribe((function(e){e.length&&t.p2pRMsgNoOfflineReport.report()})),Jb(ob(void 0),e).pipe(Kb((function(){return Qe(36e5)}))).subscribe((function(){t.p2pSMsgNoOfflineReport.report()})),this.lastLoginSockets.map((function(e){return e.pipe(Kb((function(e){return Jb(Db(e,"reconnect").pipe(sa(t.onSocketReconnect(e))),e.fromReceived("Message").pipe(sa(t.onMessage(e))),e.fromReceived("GroupEnterNotice").pipe(sa(t.onGroupEnterNotice())),e.fromReceived("GroupLeaveNotice").pipe(sa(t.onGroupLeaveNotice())),e.fromReceived("GroupCountNotice").pipe(sa(t.onGroupCountNotice())),e.fromReceived("GroupAttributeAlt").pipe(sa(t.onGroupAttributeAlt())),e.fromReceived("UserJoinNotice").pipe(sa(t.onUserNotice(ta.PeerOnlineState.ONLINE))),e.fromReceived("UserQuitNotice").pipe(sa(t.onUserNotice(ta.PeerOnlineState.OFFLINE))),e.fromReceived("UserWaitNotice").pipe(sa(t.onUserNotice(ta.PeerOnlineState.UNREACHABLE))),e.fromReceived("Pong").pipe(sa(t.onPong())),e.fromReceived("UserDrop").pipe(sa(t.onUserDrop(e))),e.fromReceived("GroupDrop").pipe(sa(t.onGroupDrop()))).pipe(Uf(void 0))})))})).forEach((function(e,n){t.loginSocketSubs[n].receivers.push(e.subscribe({error:function(){}}))}))}},{key:"requestSocketLogin",value:function(t,e,n){var i=this;return nn(yd((function(){i.userJoinOptions=new et(e),t.sendPacket("UserJoin",{account:i.context.uid,instance:i.instanceId,opt:i.userJoinOptions.toLong(),seq:n,ticket:t.ticket})})),t.fromReceived("UserResp").pipe(Ca((function(t){return n.eq(t.seq)})),sa((function(e){if(0!==(e=e.code))throw i.clearSockets(),i.logError("Connected to gateway success but the Rtm server rejected login"),new Ja(["Login failure. The response code from the RTM service is %d",e],Pg);t.attemptsSinceLastError=0,t.loggedIn=!0,i.log("ENV_%d logged in",t.env)})),Uf(t),Lb(6e3))).pipe(yb((function(t){return void 0!==t})),ab((function(n){return n instanceof Tb&&i.warn("Login response timeout, rejoin: %s",e),i.clearSockets(),n.name="loginRespTimeout",i.emit("banEdgeIP",t.ip),ra(n)})))}},{key:"getSocketLoginObservables",value:function(t,e){var n=this;return t.map((function(t){return t.pipe(Kb((function(t,i){return n.incSeqIfNeeded(t.env),n.requestSocketLogin(t,0!==i,0===i?e:n.seq)})),Se())}))}},{key:"incSeqIfNeeded",value:function(t){if(![0,1].includes(t))throw new mb({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[t]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[t]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var t=this.curLoginSockets,e=-1,n=null==t?0:t.length,i=0,r=[];++e<n;){var s=t[e];s&&(r[i++]=s)}return r}},{key:"emitMessage",value:function(t,n){var i,r=t.options,s=t.payload,o=t.src,a=t.dst,c=t.instance,l=t.dialogue,u=t.sequence,d=t.ms,h=t.MiscMap;this.dialogueSequenceLru.set(l.toString(),u),c="".concat(c,"-").concat(l,"#").concat(u),this.msgDedupLru.has(c)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",n,c):(this.msgDedupLru.set(c,void 0),r=new Ef(r),this.lastLoginSockets.forEach((i=ma(N.mark((function n(i){var r;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.pipe(hb(1)).toPromise();case 2:r=n.sent,e.sendMessageAck(t,r);case 4:case"end":return n.stop()}}),n)}))),function(t){return i.apply(this,arguments)})),n=r.isZlibCompressed(),r.isInvitation()?(a=cg(n?mm(ao(s,Uint8Array.of(0,0,0,0))):s),a=JSON.parse(a),this.log("The received invitation body is %o",a),this.emit("invitationMessage",{body:a,type:r.getInvitationType(),peerId:o,serverReceivedTs:d.toNumber()})):r.isTextMessage()?(h=r.isPeerTextMessage(),s=cg(n?mm(ao(s,Uint8Array.of(0,0,0,0))):s),this.info("Received a %s %s text message from %s to %s, %s",n?" compressed":"",h?"peer":"channel",La(o),La(a),c),h?(o={text:s,peerId:o,properties:{serverReceivedTs:d.toNumber()}},this.emit("peerTextMessage",o),this.emit("messageCount",{messageCategory:Ka.P2pSMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelTextMessage",{channelId:a,memberId:o,text:s,properties:{serverReceivedTs:d.toNumber()}}),this.emit("messageCount",{messageCategory:Ka.ChannelSMsg,type:"common",key:"receivedcount"}))):r.isRawMessage()&&(r=r.isRawPeerMessage(),h=void 0===(h=h.description)?"":cg(h),s=n?mm(s):s,this.info("Received a %s %s raw message from %s to %s, %s",n?" compressed":"",r?"peer":"channel",La(o),La(a),c),r?(o={desc:h,raw:s,peerId:o,properties:{serverReceivedTs:d.toNumber()}},this.emit("peerRawMessage",o),this.emit("messageCount",{messageCategory:Ka.P2pRMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelRawMessage",{desc:h,raw:s,channelId:a,memberId:o,properties:{serverReceivedTs:d.toNumber()}}),this.emit("messageCount",{messageCategory:Ka.ChannelRMsg,type:"common",key:"receivedcount"}))))}},{key:"onSocketReconnect",value:function(t){var e=this;return function(){var n=[0,1].filter((function(e){return e!==t.env}))[0];(n=e.connection.curOpenSockets[n])&&!n.loggedIn&&e.emit("connectionLost")}}},{key:"onUserTicketNearlyExpire",value:function(t){var e=this;return function(n){(n=n.ticket)!==e.lastNoticeTicket&&n===t.ticket?(e.lastNoticeTicket=n,e.emit("tokenPrivilegeWillExpire")):e.requestUpdateEdgeTicket(t.ticket).toPromise()}}},{key:"onGroupDrop",value:function(){var t=this;return function(e){var n,i=e.account;bb("ChnLeave",{cname:i,lts:P.fromNumber(Date.now()),elapse:Xa(t.startTime),errCode:RB,sid:sb(t.instanceId),userId:t.context.uid},null!==(n=t.context.config.enableCloudProxy)&&void 0!==n&&n),[0,1].forEach((function(e){return t.loginSocketSubs[e].channels.delete(i)})),t.logError("the user is kicked out of the current channel")}}},{key:"onUserDrop",value:function(t){var e=this;return function(n){var i;n=n.code,bb("KickedOff",{code:0,elapse:Xa(e.startTime),linkId:parseInt(t.name.split("-")[1],10),lts:P.fromNumber(Date.now()),server:t.address,serverCode:n,sid:sb(e.instanceId),userId:e.context.uid},null!==(i=e.context.config.enableCloudProxy)&&void 0!==i&&i),10006===n||10001===n?e.warn("Login too often and kicked off, reconnect and login"):10009===n?(e.warn("The instance ID conflicts, reconnecting"),e.instanceId=nh(),e.context.sid=sb(e.instanceId),e.emit("instanceChanged",e.instanceId)):[2,11,14,15,16].includes(n)&&(e.emit("userDrop",n),e.clearSockets())}}},{key:"clearSockets",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];[0,1].forEach((function(i){t.cleanLoginSubs(i,n),t.connection.closeSocket(i,e)}))}},{key:"onMessage",value:function(t){var e=this;return function(n){var i=n.dialogue,r=n.instance,s=n.sequence,o=n.options;if(n.src===e.context.uid)e.log("The message is from the local account, ignored");else{var a=i.toString(),c=e.dialPendingMsgSubjectMap.get(a);if(i="".concat(r,"-").concat(i,"#").concat(s),c)c.next(n),e.log("Env_%d: The dialogue has pending messages, next: %s",t.env,i);else{var l=e.dialogueSequenceLru.get(a);if(c=!l&&s.eq(1),r=void 0!==l&&s.sub(l).eq(1),c||r)e.emitMessage(n,t.env);else{if(l){if(s.lte(l))return;e.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",t.env,i)}else e.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",t.env,i);s=new rb,e.dialPendingMsgSubjectMap.set(a,s);var u=s.pipe(Au(zl),gh((function(t,e){return[].concat(Z(t),[e])}),[]),Ea((function(t){return Z(t).sort((function(t,e){return t=t.sequence,e=e.sequence,t.eq(e)?0:t.gt(e)?1:-1}))})),wn(1));o=!(o=new Ef(o)).isFromCache()&&!o.isBufferedMessage(),u.pipe(Kc(dd(o?750:1500)),Ca((function(t){if(2>t.length)return!1;for(var e=void 0===l?P.fromNumber(1,!0):l.add(1),n=0;n<t.length;e=e.add(1),n++)if(!t[n].sequence.eq(e))return!1;return!0})),fh((function(){e.dialPendingMsgSubjectMap.delete(a)}))).subscribe((function(n){n.forEach((function(n){e.emitMessage(n,t.env),e.log("Env_%d: The message queue has fully ordered, emitting: %s",t.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence))}))}),(function(n){n instanceof eh&&u.pipe(hb(1)).subscribe((function(n){return n.forEach((function(n){e.log("Env_%d: The message pending queue expired, emitting: %s",t.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence)),e.emitMessage(n,t.env)}))}))})),s.next(n)}}}}}},{key:"onPong",value:function(){var t=this;return function(){document.hidden&&t.getLoginSockets().forEach((function(e){t.sendPing(e)}))}}},{key:"onGroupEnterNotice",value:function(){var t=this;return function(e){t.emit("memberNotice",{channelId:e.group,seq:e.seq,instance:e.instance,memberId:e.user,type:"MemberJoined",size:e.size})}}},{key:"onGroupLeaveNotice",value:function(){var t=this;return function(e){t.emit("memberNotice",{channelId:e.group,seq:e.seq,instance:e.instance,memberId:e.user,type:"MemberLeft",size:e.size})}}},{key:"onGroupCountNotice",value:function(){var t=this;return function(e){t.emit("memberNotice",{channelId:e.group,seq:e.seq,instance:e.instance,type:"MemberCountUpdated",size:e.size})}}},{key:"onGroupAttributeAlt",value:function(){var t=this;return function(e){var n=e.group;e=Ki(e,pF),t.emit("channelAttributesUpdated",Wa({channelId:n},e))}}},{key:"onUserNotice",value:function(t){var e=this;return function(n){e.emit("peerOnlineStatusChanged",{peerId:n.user,instance:n.instance,seq:n.seq,state:t})}}},{key:"sendPing",value:function(t){2500>=Date.now()-this.lastPingTime[t.env]||(this.incSeqIfNeeded(t.env),t.sendPacket("Ping",{ms:P.fromNumber(Date.now(),!0),seq:this.seq}),this.lastPingTime[t.env]=Date.now())}},{key:"updateMessageCount",value:function(t){var e,n=(e={},x(e,Ka.ChannelRMsg,this.chanelRawMessageReport),x(e,Ka.ChannelSMsg,this.chanelStringMessageReport),x(e,Ka.P2pRMsgNoOfflineFlag,this.p2pRMsgNoOfflineReport),x(e,Ka.P2pSMsgNoOfflineFlag,this.p2pSMsgNoOfflineReport),x(e,3,void 0),x(e,4,void 0),x(e,7,void 0),x(e,8,void 0),x(e,9,void 0),x(e,10,void 0),e)[t.messageCategory];"common"===t.type?null==n||n.updateCommonCount(t.key):"peer"===t.type?null==n||n.updatePeerAckCount(t.delay):null==n||n.updateNorecipientackCount(t.delay)}}],[{key:"sendMessageAck",value:function(t,e){var n=new Ef(t.options);(n.isInvitation()||n.isPeerMessage())&&e.sendPacket("Ack",{code:0,dialogue:t.dialogue,instance:t.instance,sequence:t.sequence})}}]),e}(sc());x(Tt,"genTimeoutError",(function(t,e){return ob(void 0).pipe(Zd(void 0===e?1e4:e),Ea((function(){throw new Ub(["Request timed out after %ds",(void 0===e?1e4:e)/1e3],t)})))}));var Ut,nm,om=0,pm=0;Ng.v1=function(t,e,n){n=e&&n||0;var i=e||[],r=(t=t||{}).node||Ut,s=void 0!==t.clockseq?t.clockseq:nm;if(null==r||null==s){var o=Kr();null==r&&(r=Ut=[1|o[0],o[1],o[2],o[3],o[4],o[5]]),null==s&&(s=nm=16383&(o[6]<<8|o[7]))}o=void 0!==t.msecs?t.msecs:(new Date).getTime();var a=void 0!==t.nsecs?t.nsecs:pm+1,c=o-om+(a-pm)/1e4;if(0>c&&void 0===t.clockseq&&(s=s+1&16383),(0>c||o>om)&&void 0===t.nsecs&&(a=0),1e4<=a)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(om=o,pm=a,nm=s,t=(1e4*(268435455&(o+=122192928e5))+a)%4294967296,i[n++]=t>>>24&255,i[n++]=t>>>16&255,i[n++]=t>>>8&255,i[n++]=255&t,t=o/4294967296*1e4&268435455,i[n++]=t>>>8&255,i[n++]=255&t,i[n++]=t>>>24&15|16,i[n++]=t>>>16&255,i[n++]=s>>>8|128,i[n++]=255&s,s=0;6>s;++s)i[n+s]=r[s];return e||Lr(i)},Ng.v4=Ng;var qm=yi(),Sd,Hf=ta.LocalInvitationFailureReason,Sa=ta.LocalInvitationState,qF=(Sd=function(t){function e(t,i,r){va(this,e);var s=n.call(this,r,"RtmLocalInvitation",!0);return x(z(s),"state",Sa.IDLE),x(z(s),"localInvitationEnd$",fb(Db(z(s),"LocalInvitationAccepted"),Db(z(s),"LocalInvitationRefused"),Db(z(s),"LocalInvitationFailure"),Db(z(s),"LocalInvitationCanceled")).pipe(hb(1))),x(z(s),"callId",Ng.v4()),x(z(s),"_content",""),x(z(s),"_channelId",""),x(z(s),"_response",""),x(z(s),"calleeId",void 0),x(z(s),"logger",void 0),x(z(s),"getSession",void 0),s.calleeId=t,s.getSession=i,s.logger=r,s}Ga(e,t);var n=Ha(e);return eb(e,[{key:"channelId",get:function(){return this._channelId},set:function(t){this.state!==Sa.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=t)}},{key:"content",get:function(){return this._content},set:function(t){this.log("set content for %s",this.callId),this._content=t}},{key:"response",get:function(){return this._response},set:function(t){throw new ca('Cannot set the "response" of the LocalInvitation instance.',Xc)}},{key:"send",value:function(){var t,e=this;if(this.state===Sa.SENT_TO_REMOTE||this.state===Sa.RECEIVED_BY_REMOTE)throw new da("The local invitation send failure. The call invitation has already been sent.",NB);if(this.isLocalInvitationEnd())throw new da("The local invitation send failure. The call invitation has ended.",ri);if(0<this._channelId.length&&!Ta(this._channelId))throw new ca("Illegal invitation channel ID",Xc);if(!Ta(this.calleeId))throw new ca("Illegal invitation callee user ID",Xc);if(8192<rh(this._content))throw new ca('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this.state=Sa.SENT_TO_REMOTE,yd(ma(N.mark((function n(){var i,r,s;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.getSession().sendInvitationMessage({peerId:e.calleeId,callId:e.callId,extra:e._content,type:"CallInvite",channelId:e._channelId});case 2:if(i=n.sent,r=i.hasPeerReceived,s=i.hasReSent,!e.isLocalInvitationEnd()){n.next=7;break}throw new Ub("send invitation timeout");case 7:if(e.log("The local invitation has sent to the callee"),r||s){n.next=11;break}throw t=new qm({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(r){n.next=14;break}throw t=new qm({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return n.stop()}}),n)})))).pipe(Re((function(t){return t.pipe(sa((function(t){if(!(t instanceof qm))throw t})),Zd(2e3))})),Lb(3e4),ab((function(t){return Ab(t)&&e.warn("local invitation ack timed out"),ra(t)})),Kc(this.localInvitationEnd$)).subscribe({next:function(){e.state===Sa.RECEIVED_BY_REMOTE?e.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):e.state!==Sa.SENT_TO_REMOTE?e.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(e.info("The peer received the local invitation %s.",e.callId),e.state=Sa.RECEIVED_BY_REMOTE,e.emit("LocalInvitationReceivedByPeer"),e.localInvitationEnd$.pipe(Lb(6e4),ab((function(t){return Ab(t)&&e.warn("local invitation expired"),ra(t)}))).subscribe({error:function(){e.state=Sa.FAILURE,e.emit("LocalInvitationFailure",Hf.INVITATION_EXPIRE)}}))},error:function(n){e.isLocalInvitationEnd()?e.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(e.state=Sa.FAILURE,Ab(n)&&t?"PEER_NOT_ONLINE"===t.code?e.emit("LocalInvitationFailure",Hf.PEER_OFFLINE):"RESENT_AND_OFFLINE"===t.code&&e.emit("LocalInvitationFailure",Hf.PEER_NO_RESPONSE):Ab(n)?e.emit("LocalInvitationFailure",Hf.PEER_NO_RESPONSE):"RtmInvalidStatusError"===n.name?e.emit("LocalInvitationFailure",Hf.NOT_LOGGEDIN):e.emit("LocalInvitationFailure",Hf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new da("The local invitation cancel failure",ri);if(this.state===Sa.IDLE)throw new da("The local invitation has not been sent",MB);if(8192<rh(this._content))throw new ca('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Sa.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(t){if(this.isLocalInvitationEnd()&&this.state!==Sa.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Sa.IDLE)throw new da("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Sa.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Sa.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Sa.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Sa.ACCEPTED_BY_REMOTE,this._response=t,this.emit("LocalInvitationAccepted",t))}}},{key:"onRefuseReceived",value:function(t){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Sa.IDLE)throw new da("the local have not sent the invitation, how can remote refuse it?");this.state===Sa.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Sa.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=t,this.state=Sa.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",t)}}},{key:"isLocalInvitationEnd",value:function(){return[Sa.CANCELED,Sa.FAILURE,Sa.ACCEPTED_BY_REMOTE,Sa.REFUSED_BY_REMOTE].includes(this.state)}}]),e}(sc()),Da(Sd.prototype,"send",[Mc],Object.getOwnPropertyDescriptor(Sd.prototype,"send"),Sd.prototype),Da(Sd.prototype,"cancel",[Mc],Object.getOwnPropertyDescriptor(Sd.prototype,"cancel"),Sd.prototype),Sd),Hi=ta.RemoteInvitationFailureReason,Fb=ta.RemoteInvitationState,rF=function(t){function e(t){var i=t.invitationChannel,r=t.extraContent,s=t.callId,o=t.callerId,a=t.logger;t=t.getSession,va(this,e);var c=n.call(this,a,"RtmRemoteInvitation",!0);return x(z(c),"state",Fb.INVITATION_RECEIVED),x(z(c),"remoteInvitationEnd$",fb(Db(z(c),"RemoteInvitationCanceled"),Db(z(c),"RemoteInvitationRefused"),Db(z(c),"RemoteInvitationAccepted"),Db(z(c),"RemoteInvitationFailure")).pipe(hb(1))),x(z(c),"callerId",void 0),x(z(c),"callId",void 0),x(z(c),"_getSession",void 0),x(z(c),"logger",void 0),x(z(c),"_content",void 0),x(z(c),"_channelId",void 0),x(z(c),"_response",""),c._channelId=i,c._content=r,c.callId=s,c.callerId=o,c._getSession=t,c.logger=a,c.remoteInvitationEnd$.pipe(Lb(6e4),ab((function(t){return Ab(t)&&c.warn("Remote invitation expired"),ra(t)}))).subscribe({error:function(){c.state=Fb.FAILURE,c.emit("RemoteInvitationFailure",Hi.INVITATION_EXPIRE)}}),c}Ga(e,t);var n=Ha(e);return eb(e,[{key:"channelId",get:function(){return this._channelId},set:function(t){throw new ca('Cannot set the "response" of the RemoteInvitation instance.',Xc)}},{key:"content",get:function(){return this._content},set:function(t){throw new ca('Cannot set the "content" of the RemoteInvitation instance.',Xc)}},{key:"response",get:function(){return this._response},set:function(t){this._response=t}},{key:"accept",value:function(){var t,e=this;if(this.isRemoteInvitationEnd())throw new da("The local invitation has ended. Cannot accept.",ri);if(this.state===Fb.ACCEPT_SENT_TO_LOCAL)throw new da("The remote invitation is accepting. Cannot do the operation.",Rr);if(8192<rh(this._response))throw new ca('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this.state=Fb.ACCEPT_SENT_TO_LOCAL,Jb(Qe(1e3).pipe(Cb((function(){return yd(ma(N.mark((function t(){return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e._getSession().sendInvitationMessage({peerId:e.callerId,callId:e.callId,extra:e.response,type:"CallAccept",isAcceptAck:!1,channelId:e.channelId}));case 1:case"end":return t.stop()}}),t)}))))})),yb((function(e){return t=e.hasPeerReceived})),hb(1)),Db(this,"RemoteInvitationAccepted")).pipe(Lb(5e3),Kc(this.remoteInvitationEnd$)).subscribe({error:function(n){if(e.logError(n),e.state=Fb.FAILURE,Ab(n))switch(t){case void 0:case!0:return void e.emit("RemoteInvitationFailure",Hi.ACCEPT_FAILURE);case!1:return void e.emit("RemoteInvitationFailure",Hi.PEER_OFFLINE)}e.emit("RemoteInvitationFailure",Hi.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===Fb.ACCEPT_SENT_TO_LOCAL)throw new da("The remote invitation is accepting. Cannot do the operation.",Rr);if(this.isRemoteInvitationEnd())throw new da("The invitation is end. Cannot refuse",ri);if(8192<rh(this._response))throw new ca('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=Fb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(t){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===Fb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=t,this.state=Fb.CANCELED,this.emit("RemoteInvitationCanceled",t))}},{key:"onAcceptAckReceived",value:function(){this.state!==Fb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=Fb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[Fb.ACCEPTED,Fb.REFUSED,Fb.CANCELED,Fb.FAILURE].includes(this.state)}}]),e}(sc()),sF=function(t){function e(t,i){va(this,e);var r=n.call(this,i,"InvitationManager");return x(z(r),"getSession",void 0),x(z(r),"invitationDispatcher",new Ba.EventEmitter),x(z(r),"outgoingLocalInvitations",new Map),x(z(r),"receivedRemoteInvitations",new Wc(void 0,{maxlen:1e4})),x(z(r),"logger",void 0),r.getSession=fo(t),r.logger=i,r.invitationDispatcher.on("remoteInvitationToManager",(function(t){var e=t.callId,n=t.extra,s=t.callerId;t=t.channelId,r.receivedRemoteInvitations.has(e)||((n=new rF({callerId:s,callId:e,getSession:r.getSession,logger:i,extraContent:n,invitationChannel:t})).remoteInvitationEnd$.subscribe((function(){r.receivedRemoteInvitations.delete(e)})),r.receivedRemoteInvitations.set(e,n),r.emit("remoteInvitationInstance",n))})),r.invitationDispatcher.on("acceptAckToRemoteInvitation",(function(t){(t=r.receivedRemoteInvitations.get(t.callId))&&t.onAcceptAckReceived()})),r.invitationDispatcher.on("cancelToRemoteInvitation",(function(t){var e=t.extra;(t=r.receivedRemoteInvitations.get(t.callId))&&t.onCancelReceived(e)})),r.invitationDispatcher.on("acceptToLocalInvitation",(function(t){var e=t.extra;(t=r.outgoingLocalInvitations.get(t.callId))&&t.onAcceptReceived(e)})),r.invitationDispatcher.on("refuseToLocalInvitation",(function(t){var e=t.extra;(t=r.outgoingLocalInvitations.get(t.callId))&&t.onRefuseReceived(e)})),r}Ga(e,t);var n=Ha(e);return eb(e,[{key:"invitationMessageHandler",value:function(t){var e=t.body,n=e.callId,i=e.extra;i=void 0===i?"":i;var r=e.type,s=void 0===(e=e.channel)?"":e,o=t.type;switch(e=t.peerId,t=t.serverReceivedTs,o){case"CallAccept":"ack"===r?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:n}):"request"===r&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:n,extra:i});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:n,callerId:e,extra:i,channelId:s});break;case"CallCancel":if("0"===n){n="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(s,"_").concat(i),this.getSession().emit("peerTextMessage",{peerId:e,properties:{serverReceivedTs:t},text:n});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:n,extra:i});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:n,extra:i});break;default:throw Rn("invitationType",o)}}},{key:"genLocalInvitation",value:function(t){var e=this,n=new qF(t,this.getSession,this.logger);return n.localInvitationEnd$.subscribe((function(){e.outgoingLocalInvitations.delete(n.callId)})),this.outgoingLocalInvitations.set(n.callId,n),n}}]),e}(sc()),tF=function(t,e,n){var i=!0,r=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return Gb(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),JD(t,e,{leading:i,maxWait:e,trailing:r})},Qb,If;!function(t){t[t.JOINED=0]="JOINED",t[t.LEFT=1]="LEFT"}(If||(If={}));var Ii=ta.ConnectionState,uF=(Qb=function(t){function e(t,n,r,s){va(this,e);var o=i.call(this,s,"RtmChannel",!0);return x(z(o),"onMemberCountUpdated",tF((function(t){t!==o.memberCount&&(o.memberCount=t,o.emit("MemberCountUpdated",t))}),1e3)),x(z(o),"getSession",void 0),x(z(o),"memberCount",0),x(z(o),"joinState","LEFT"),x(z(o),"joinPromise",void 0),x(z(o),"memberJoinedLru",new Wc(void 0,{maxlen:1e4})),x(z(o),"memberLeftLru",new Wc(void 0,{maxlen:1e4})),x(z(o),"memberJoinStateLru",new Wc(void 0,{maxlen:1e4})),x(z(o),"attributesSeqLru",new Wc(void 0,{maxlen:1e4})),x(z(o),"channelId",void 0),x(z(o),"client",void 0),x(z(o),"onChannelMemberCountUpdated",(function(t,e){o.channelId===t&&o.onMemberCountUpdated(e)})),x(z(o),"onLogout",(function(){try{o.clearChannel(o.getSession())}catch(t){}})),x(z(o),"onAttributesUpdated",(function(t){var e=t.channelId,n=t.attributeMaps,i=t.seq;t=t.instance.toString();var r=o.attributesSeqLru.get(t);if((!r||i.greaterThan(r))&&(o.attributesSeqLru.set(t,i),e===o.channelId)){for(e={},i=0;i<n.length;i++){var s=n[i];t=s.key,r=s.ms;var a=s.value;if(s=s.origin,"string"!=typeof t||!P.isLong(r)||"string"!=typeof a||!Ta(s))break;e[t]={value:a,lastUpdateUserId:s,lastUpdateTs:r.toNumber()}}o.emit("AttributesUpdated",e)}})),x(z(o),"onChannelTextMessage",(function(t){var e=t.memberId,n=t.text,i=t.properties;t.channelId===o.channelId&&o.emit("ChannelMessage",{text:n,messageType:ta.MessageType.TEXT},e,i)})),x(z(o),"onChannelRawMessage",(function(t){var e=t.desc,n=t.raw,i=t.memberId,r=t.properties;t.channelId===o.channelId&&o.emit("ChannelMessage",{messageType:ta.MessageType.RAW,rawMessage:n,description:e},i,r)})),x(z(o),"onMemberNotice",(function(t){var e=t.memberId,n=t.type,i=t.size;if(t.channelId===o.channelId){var r=t.instance.toString();t=t.seq.toString();var s={MemberLeft:o.memberLeftLru,MemberJoined:o.memberJoinedLru,MemberCountUpdated:void 0}[n];if(s){if(s.has(r+t))return void o.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",n,t,La(o.channelId),La(e||""));if(s.set(r+t,void 0),"string"!=typeof e)return;if(e!==o.getSession().context.uid){if((r=o.memberJoinStateLru.get(e))===If.JOINED&&"MemberJoined"===n)return void o.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,t,La(o.channelId),La(e||""));if(r===If.LEFT&&"MemberLeft"===n)return void o.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,t,La(o.channelId),La(e||""))}o.memberJoinStateLru.set(e,"MemberJoined"===n?If.JOINED:If.LEFT)}o.info("Channel %s - %s, memberId: %s",n,La(o.channelId),"MemberCountUpdated"===n?"[unknown]":La(e||"")),r=e===o.getSession().context.uid,"MemberLeft"===n&&Ta(e)||"MemberJoined"===n&&Ta(e)?(r||o.emit(n,e),o.onMemberCountUpdated(i)):"MemberCountUpdated"===n&&"number"==typeof i&&o.onMemberCountUpdated(i)}})),o.getSession=fo(n),o.channelId=t,o.client=r,o.info("A channel created, id %s",La(t)),o}Ga(e,t);var n,i=Ha(e);return eb(e,[{key:"join",value:(n=ma(N.mark((function t(){var e,n,i,r,s,o,a,c=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,e=this.getSession(),t.next=7;break;case 4:throw t.prev=4,t.t0=t.catch(0),new da("The client is not logged in. Cannot do the operation",Wr);case 7:if(t.prev=7,Ta(this.channelId)){t.next=10;break}throw new ca(["The %s in the arguments is invalid","channelId"],OB);case 10:if("LEFT"===this.joinState){t.next=13;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:e.context.uid,elapse:Xa(e.startTime),errCode:Vr,sid:sb(e.instanceId)},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),new da("The channel has joined. Cannot rejoin",Vr);case 13:if(!e.usedChannelIds.includes(this.channelId)){t.next=16;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:e.context.uid,elapse:Xa(e.startTime),errCode:Xr,sid:sb(e.instanceId)},null!==(s=this.client.context.config.enableCloudProxy)&&void 0!==s&&s),new da("A channel of the same channel ID has already joined. Cannot rejoin",Xr);case 16:if(!(20<=e.usedChannelIds.length)){t.next=19;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:e.context.uid,elapse:Xa(e.startTime),errCode:Ur,sid:sb(e.instanceId)},null!==(o=this.client.context.config.enableCloudProxy)&&void 0!==o&&o),new ic("The joined channels has exceeded the limit of 20",Ur);case 19:return bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:e.context.uid,elapse:Xa(e.startTime),errCode:0,sid:sb(e.instanceId)},null!==(n=this.client.context.config.enableCloudProxy)&&void 0!==n&&n),this.log("Joining the channel %s",La(this.channelId)),this.joinState="JOINING",e.usedChannelIds.push(this.channelId),this.joinPromise=e.requestChannelJoin(this.channelId).then((function(){c.joinState="JOINED"})),t.next=26,this.joinPromise;case 26:bb("ChnJoinRes",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(e.startTime),errCode:0,sid:sb(e.instanceId),serverErrCode:0,userId:e.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),this.info("The channel %s joined successfully",La(this.channelId)),e.on("channelTextMessage",this.onChannelTextMessage),e.on("channelRawMessage",this.onChannelRawMessage),e.on("memberNotice",this.onMemberNotice),e.on("channelAttributesUpdated",this.onAttributesUpdated),this.client.internalEmitter.on("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.once("LOGOUT",this.onLogout),t.next=46;break;case 36:if(t.prev=36,t.t1=t.catch(7),"JOINING"===this.joinState&&(this.joinState="LEFT"),this.logError(t.t1),!Na(t.t1)){t.next=42;break}throw t.t1;case 42:if(!Ab(t.t1)){t.next=45;break}throw bb("ChnJoinRes",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(e.startTime),errCode:Tr,sid:sb(e.instanceId),serverErrCode:0,userId:e.context.uid},null!==(a=this.client.context.config.enableCloudProxy)&&void 0!==a&&a),new Ub(["Join channel %s timed out",La(this.channelId)],Tr);case 45:throw new ve(["The channel %s join failure",La(this.channelId)],{code:Sr,originalError:t.t1});case 46:case"end":return t.stop()}}),t,this,[[0,4],[7,36]])}))),function(){return n.apply(this,arguments)})},{key:"leave",value:function(){var t=ma(N.mark((function t(){var e,n,i,r;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=this.getSession(),t.next=7;break;case 4:throw t.prev=4,t.t0=t.catch(0),new da("The client is not logged in. Cannot do the operation",QB);case 7:if("LEFT"!==this.joinState){t.next=9;break}throw new da("The channel does not join. Cannot do the operation",PB);case 9:return t.prev=9,n.requestChannelLeave(this.channelId),t.next=13,this.clearChannel(n);case 13:t.next=24;break;case 15:if(t.prev=15,t.t1=t.catch(9),this.logError(t.t1),!Na(t.t1)){t.next=22;break}throw void 0===t.t1.code&&(t.t1.code=Zr),bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(n.startTime),errCode:Zr,sid:sb(n.instanceId),userId:n.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),t.t1;case 22:throw bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(n.startTime),errCode:Yr,sid:sb(n.instanceId),userId:n.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),new ve("The channel leave failure",{code:Yr,originalError:t.t1});case 24:bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(n.startTime),errCode:0,sid:sb(n.instanceId),userId:n.context.uid},null!==(e=this.client.context.config.enableCloudProxy)&&void 0!==e&&e);case 25:case"end":return t.stop()}}),t,this,[[0,4],[9,15]])})));return function(){return t.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var t=ma(N.mark((function t(e){var n,i=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Xn(e,Il),this.client.connectionState!==Ii.CONNECTED||"JOINED"===this.joinState){t.next=3;break}throw new da("The channel does not join. Cannot do the operation",EB);case 3:if(this.client.connectionState!==Ii.RECONNECTING){t.next=8;break}return n=Date.now(),t.next=7,new Promise((function(t,r){var s,o=(s=ma(N.mark((function s(){var o;return N.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o=Date.now()-n,s.prev=1,s.next=4,ph({message:e,peerId:i.channelId,toPeer:!1,session:i.getSession(),errorCodes:{NOT_LOGGED_IN:Jl,TOO_OFTEN:Nr},diff:o,logger:i.logger});case 4:t(),s.next=12;break;case 7:s.prev=7,s.t0=s.catch(1),Ab(s.t0)&&r(new Ub(we(i.name,"sendMessageToPeer",1e4),Hl)),Na(s.t0)&&r(s.t0),r(new Ja("Channel message send failure",{code:qi,originalError:s.t0}));case 12:return s.prev=12,clearTimeout(a),s.finish(12);case 15:case"end":return s.stop()}}),s,null,[[1,7,12,15]])}))),function(){return s.apply(this,arguments)});i.client.internalEmitter.once("RECONNECTED",o);var a=setTimeout((function(){i.client.internalEmitter.off("RECONNECTED",o),r(new Ub(we(i.name,"sendMessageToPeer",1e4),Hl))}),9e3)}));case 7:return t.abrupt("return");case 8:if(this.client.connectionState===Ii.CONNECTED){t.next=10;break}throw new da("The client is not logged in. Cannot do the operation",Jl);case 10:return t.prev=10,t.next=13,ph({message:e,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:Jl,TOO_OFTEN:Nr},diff:0,logger:this.logger});case 13:t.next=23;break;case 15:if(t.prev=15,t.t0=t.catch(10),!Ab(t.t0)){t.next=19;break}throw new Ub(we(this.name,"sendMessage",1e4),Hl);case 19:if(!Na(t.t0)){t.next=22;break}throw this.logError(t.t0),t.t0;case 22:throw new ve("The channel message send failure",qi);case 23:case"end":return t.stop()}}),t,this,[[10,15]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getMembers",value:function(){var t=ma(N.mark((function t(){var e,n;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.client.connectionState===Ii.CONNECTED){t.next=3;break}throw new da("The client is not logged in. Cannot do the operation",LB);case 3:if("JOINED"===this.joinState){t.next=5;break}throw new da("The channel does not join. Cannot do the operation",KB);case 5:return e=this.getSession().requestChannelMemberList(this.channelId),t.next=8,e.pipe(Ea((function(t){return t.memberInfos.map((function(t){return t.account}))}))).toPromise();case 8:return n=t.sent,this.info("Channel %s - get members success, %o",La(this.channelId),n.map(La)),t.abrupt("return",n);case 13:if(t.prev=13,t.t0=t.catch(0),!Na(t.t0)){t.next=18;break}throw this.logError(t.t0),t.t0;case 18:throw new ve("The channel members get failure",IB);case 19:case"end":return t.stop()}}),t,this,[[0,13]])})));return function(){return t.apply(this,arguments)}}()},{key:"clearChannel",value:function(){var t=ma(N.mark((function t(e){var n=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.emit("channelLeft",this.channelId),"JOINING"!==this.joinState){t.next=4;break}return t.next=4,this.joinPromise;case 4:this.joinState="LEFT",this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,e.removeListener("channelTextMessage",this.onChannelTextMessage),e.removeListener("channelRawMessage",this.onChannelRawMessage),e.removeListener("memberNotice",this.onMemberNotice),e.removeListener("channelAttributesUpdated",this.onAttributesUpdated),this.client.internalEmitter.removeListener("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.removeListener("LOGOUT",this.onLogout),e.usedChannelIds=e.usedChannelIds.filter((function(t){return t!==n.channelId}));case 17:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),e}(sc()),Da(Qb.prototype,"join",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"join"),Qb.prototype),Da(Qb.prototype,"leave",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"leave"),Qb.prototype),Da(Qb.prototype,"sendMessage",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"sendMessage"),Qb.prototype),Da(Qb.prototype,"getMembers",[jb],Object.getOwnPropertyDescriptor(Qb.prototype,"getMembers"),Qb.prototype),Qb),W,Rb=ta.ConnectionChangeReason,oa=ta.ConnectionState,Vt={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},vF={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8,TOKEN_EXPIRED:9},wF=(W=function(t){function e(t,n,r,s){va(this,e);var o=i.call(this,n,"RtmClient",!0);return x(z(o),"connectionState",oa.DISCONNECTED),x(z(o),"internalEmitter",new Ba),x(z(o),"context",void 0),x(z(o),"attributes",{}),x(z(o),"loginPromise",void 0),x(z(o),"attributeDrafts",new Set),x(z(o),"session",void 0),x(z(o),"lastLoginTime",void 0),x(z(o),"reconnId",0),x(z(o),"channelAttributesCacheLru",new Wc(void 0,{maxlen:1e4})),x(z(o),"invitationManager",void 0),x(z(o),"subscribedPeerStatusCache",{}),x(z(o),"pendingPeerStatusSubCount",0),x(z(o),"peerStatusSeqLru",new Wc(void 0,{maxlen:1e4})),x(z(o),"peerUnreachableTimers",{}),x(z(o),"setParameters",void 0),x(z(o),"updateConfig",void 0),x(z(o),"blacklistedIP",{}),x(z(o),"TokenPrivilegeWillExpireHandler",(function(){o.emit("TokenPrivilegeWillExpire")})),x(z(o),"userDropHandler",(function(t){if(o.connectionState!==oa.ABORTED)switch(t){case 2:o.logError("Server banned because of token is expired"),o.onConnectionStateChanged(oa.ABORTED,Rb.TOKEN_EXPIRED),o.emit("TokenExpired");break;case 11:o.logError("Kicked off by remote session"),o.onConnectionStateChanged(oa.ABORTED,Rb.REMOTE_LOGIN);break;case 14:case 15:case 16:o.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[t])),o.onConnectionStateChanged(oa.ABORTED,Rb.BANNED_BY_SERVER);break;default:o.logError("User kicked off for unknown code: ".concat(t)),o.onConnectionStateChanged(oa.ABORTED,Rb.INTERRUPTED)}})),o.context=new xE(t,r,n),o.context.config=r,o.setParameters=s.bind(z(o)),o.updateConfig=s.bind(z(o)),o.invitationManager=new sF((function(){return o.session}),n),o.invitationManager.on("remoteInvitationInstance",(function(t){o.emit("RemoteInvitationReceived",t)})),o.setMaxListeners(512),o.internalEmitter.setMaxListeners(512),o}Ga(e,t);var n,i=Ha(e);return eb(e,[{key:"renewToken",value:(n=ma(N.mark((function t(e){var n,i,r,s,o=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"==typeof e&&0!==e.length){t.next=2;break}throw new ca("Invalid argument",XB);case 2:if(this.connectionState!==oa.ABORTED){t.next=5;break}return t.next=5,new Promise((function(){}));case 5:if(this.connectionState===oa.CONNECTED||this.connectionState===oa.RECONNECTING){t.next=7;break}throw new da("The client is not logged in",hs);case 7:if(void 0!==this.session){t.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return t.prev=9,n=this.context.token,this.context.token=e,t.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe($d((function(){return Error("No available edge address to connect")})),Re((function(t){return t.pipe(sa((function(t){if(Na(t))throw t})),Zd(2500),hb(4))})),hb(1),Lb(2e4),ab((function(t){return Ab(t)&&o.warn("renewToken timed out"),ra(t)}))).toPromise();case 14:i=t.sent,r=i.ticket,t.next=27;break;case 18:if(t.prev=18,t.t0=t.catch(9),this.context.token=n,t.t0.code!==as&&t.t0.code!==bs){t.next=23;break}throw new Bf("Invalid token",ZB);case 23:if(t.t0.code!==ti){t.next=25;break}throw new Bf("The token expired",YB);case 25:if(!Ab(t.t0)){t.next=27;break}throw new Ub("Renew token timed out",Ml);case 27:s=this.session,this.session.requestUpdateEdgeTicket(r).toPromise().then((function(t){if(0!==t.code)throw new Ja(["RenewToken failure. The response code is %d",t.code],Ml);s.curLoginSockets.filter((function(t){return void 0!==t})).forEach((function(t){return t.ticket=r}))}));case 29:case"end":return t.stop()}}),t,this,[[9,18]])}))),function(t){return n.apply(this,arguments)})},{key:"queryPeersOnlineStatus",value:function(){var t=ma(N.mark((function t(e){var n,i,r=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===oa.CONNECTED){t.next=2;break}throw new da("The client is not logged in",WB);case 2:if(void 0!==this.session){t.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(e)||0===e.length||e.some((function(t){return!Ta(t)}))||256<e.length)){t.next=6;break}throw new ca("invalid arguments",gs);case 6:return t.next=8,this.session.requestPeersOnlineStatus(e).toPromise();case 8:return n=t.sent,i=md(tl(n.userInfos,"account"),(function(t){return!!t.ts})),Object.keys(i).forEach((function(t){if(t in r.subscribedPeerStatusCache&&r.subscribedPeerStatusCache[t]!==ta.PeerOnlineState.UNREACHABLE){var e=i[t]?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE;r.emit("PeersOnlineStatusChanged",x({},t,e)),r.subscribedPeerStatusCache[t]=e}})),t.abrupt("return",i);case 12:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var t=ma(N.mark((function t(e){var n,i,r,s,o,a,c,l,u;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===oa.CONNECTED){t.next=2;break}throw new da("The client is not logged in",HB);case 2:if(void 0!==this.session){t.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(e)&&e.every((function(t){return"string"==typeof t}))&&0!==e.length){t.next=6;break}throw new ca("Invalid arguments: channelIds",Pr);case 6:if(!(32<e.length)){t.next=8;break}throw new ca("getChannelMemberCount exceed limit of 32 channelIds",GB);case 8:n=0;case 9:if(!(n<e.length)){t.next=16;break}if(Ta(i=e[n])){t.next=13;break}throw new ca(["getChannelMemberCount channel id %s is invalid",i],Pr);case 13:n++,t.next=9;break;case 16:return t.next=18,this.session.requestGetChannelMemberCount(e).toPromise();case 18:for(r=t.sent,s=r.groupInfos,o={},a=0;a<s.length;a++)c=s[a],l=c.group,u=c.memberCount,Ta(l)&&"number"==typeof u&&(this.internalEmitter.emit("channelMemberCountUpdated",l,u),o[l]=u);return t.abrupt("return",o);case 23:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var t=ma(N.mark((function t(e){var n,i;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ag({attributes:e,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===oa.CONNECTED){t.next=3;break}throw new da("The client is not logged in",qc);case 3:if(void 0!==this.session){t.next=5;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return n=this.session.requestSetLocalUserAttributes(e).toPromise(),i={attribute:e,promise:n},this.attributeDrafts.add(i),t.prev=8,t.next=11,n;case 11:this.attributes=e,t.next=19;break;case 14:if(t.prev=14,t.t0=t.catch(8),!Na(t.t0)){t.next=18;break}throw t.t0;case 18:throw new ca("arguments is not valid",gb);case 19:return t.prev=19,this.attributeDrafts.delete(i),t.finish(19);case 22:case"end":return t.stop()}}),t,this,[[8,14,19,22]])})));return function(e){return t.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var t=ma(N.mark((function t(e,n){var i,r,s,o,a,c=arguments;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=2<c.length&&void 0!==c[2]?c[2]:{},r=i.enableNotificationToChannelMembers,s=void 0!==r&&r,ag({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===oa.CONNECTED){t.next=4;break}throw new da("The client is not logged in",qc);case 4:if(void 0!==this.session){t.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return o=this.session.requestSetChannelAttributes(e,n,s).toPromise(),t.prev=7,t.next=10,o;case 10:a=md(n,(function(t){return new Blob([t]).size})),this.channelAttributesCacheLru.set(e,a),t.next=19;break;case 14:if(t.prev=14,t.t0=t.catch(7),!Na(t.t0)){t.next=18;break}throw t.t0;case 18:throw new ca("arguments is not valid",gb);case 19:case"end":return t.stop()}}),t,this,[[7,14]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var t=ma(N.mark((function t(e){var n,i,r;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=Wa(Wa({},this.attributes),e),ag({attributes:e,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),ag({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===oa.CONNECTED){t.next=5;break}throw new da("The client is not logged in",qc);case 5:if(void 0!==this.session){t.next=7;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return i=this.session.requestAddOrUpdateLocalUserAttributes(e).toPromise(),r={attribute:n,promise:i},this.attributeDrafts.add(r),t.prev=10,t.next=13,i;case 13:this.attributes=n,t.next=21;break;case 16:if(t.prev=16,t.t0=t.catch(10),!Na(t.t0)){t.next=20;break}throw t.t0;case 20:throw new ca("arguments is not valid",gs);case 21:return t.prev=21,this.attributeDrafts.delete(r),t.finish(21);case 24:case"end":return t.stop()}}),t,this,[[10,16,21,24]])})));return function(e){return t.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var t=ma(N.mark((function t(e,n){var i,r,s,o,a,c,l,u=arguments;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=2<u.length&&void 0!==u[2]?u[2]:{},r=i.enableNotificationToChannelMembers,s=void 0!==r&&r,o=this.channelAttributesCacheLru.get(e,{}),a=md(n,(function(t){return new Blob([t]).size})),c=Wa(Wa({},o),a),ag({attributes:n,attrSizeMap:c,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===oa.CONNECTED){t.next=7;break}throw new da("The client is not logged in",qc);case 7:if(void 0!==this.session){t.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return l=this.session.requestAddOrUpdateChannelAttributes(e,n,s).toPromise(),t.prev=10,t.next=13,l;case 13:this.channelAttributesCacheLru.set(e,c),t.next=21;break;case 16:if(t.prev=16,t.t0=t.catch(10),!Na(t.t0)){t.next=20;break}throw t.t0;case 20:throw new ca("arguments is not valid",gb);case 21:case"end":return t.stop()}}),t,this,[[10,16]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var t=ma(N.mark((function t(e){var n,i,r,s;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Array.isArray(e)&&0!==e.length&&!e.some((function(t){return 0===t.length}))){t.next=2;break}throw new da("arguments is not valid",gb);case 2:if(this.connectionState===oa.CONNECTED){t.next=4;break}throw new da("The client is not logged in",qc);case 4:if(void 0!==this.session){t.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return n=this.session.requestDeleteLocalUserAttributesByKeys(e).toPromise(),i={attribute:ql(this.attributes,e),promise:n},this.attributeDrafts.add(i),t.prev=9,t.next=12,n;case 12:for(r=0;r<e.length;r++)s=e[r],delete this.attributes[s];t.next=20;break;case 15:if(t.prev=15,t.t0=t.catch(9),!Na(t.t0)){t.next=19;break}throw t.t0;case 19:throw new ca("arguments is not valid",gb);case 20:return t.prev=20,this.attributeDrafts.delete(i),t.finish(20);case 23:case"end":return t.stop()}}),t,this,[[9,15,20,23]])})));return function(e){return t.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var t=ma(N.mark((function t(e,n){var i,r,s,o,a,c,l,u=arguments;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=2<u.length&&void 0!==u[2]?u[2]:{},r=i.enableNotificationToChannelMembers,s=void 0!==r&&r,Array.isArray(n)&&0!==n.length&&Ta(e)&&!n.some((function(t){return 0===t.length||512<t.length}))){t.next=3;break}throw new da("arguments is not valid",gb);case 3:if(this.connectionState===oa.CONNECTED){t.next=5;break}throw new da("The client is not logged in",qc);case 5:if(void 0!==this.session){t.next=7;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return o=this.session.requestDeleteChannelAttributesByKeys(e,n,s).toPromise(),t.prev=8,t.next=11,o;case 11:if(a=this.channelAttributesCacheLru.get(e))for(c=0;c<n.length;c++)l=n[c],delete a[l];t.next=20;break;case 15:if(t.prev=15,t.t0=t.catch(8),!Na(t.t0)){t.next=19;break}throw t.t0;case 19:throw new ca("arguments is not valid",gb);case 20:case"end":return t.stop()}}),t,this,[[8,15]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var t=ma(N.mark((function t(){var e,n;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===oa.CONNECTED){t.next=2;break}throw new da("The client is not logged in",qc);case 2:if(void 0!==this.session){t.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return e=this.session.requestClearLocalUserAttributes().toPromise(),n={attribute:{},promise:e},this.attributeDrafts.add(n),t.prev=7,t.next=10,e;case 10:this.attributes={},t.next=18;break;case 13:if(t.prev=13,t.t0=t.catch(7),!Na(t.t0)){t.next=17;break}throw t.t0;case 17:throw new ca("arguments is not valid",gb);case 18:return t.prev=18,this.attributeDrafts.delete(n),t.finish(18);case 21:case"end":return t.stop()}}),t,this,[[7,13,18,21]])})));return function(){return t.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var t=ma(N.mark((function t(e){var n,i,r,s,o=arguments;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=1<o.length&&void 0!==o[1]?o[1]:{},i=n.enableNotificationToChannelMembers,r=void 0!==i&&i,this.connectionState===oa.CONNECTED){t.next=3;break}throw new da("The client is not logged in",qc);case 3:if(void 0!==this.session){t.next=5;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return s=this.session.requestClearChannelAttributes(e,r).toPromise(),t.prev=6,t.next=9,s;case 9:this.channelAttributesCacheLru.delete(e),t.next=17;break;case 12:if(t.prev=12,t.t0=t.catch(6),!Na(t.t0)){t.next=16;break}throw t.t0;case 16:throw new ca("arguments is not valid",gb);case 17:case"end":return t.stop()}}),t,this,[[6,12]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var t=ma(N.mark((function t(e){var n,i,r;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Ta(e)){t.next=2;break}throw new ca("Not a valid user ID",gb);case 2:if(this.connectionState===oa.CONNECTED){t.next=4;break}throw new da("The client is not logged in",qc);case 4:if(void 0!==this.session){t.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return t.prev=6,t.next=9,this.session.requestGetUserAttributeKeys(e).toPromise();case 9:return n=t.sent,i=n.keys,t.next=13,this.session.requestGetUserAttributesByKeys(e,i.slice(0,512)).toPromise();case 13:r=t.sent,t.next=21;break;case 16:if(t.prev=16,t.t0=t.catch(6),!Na(t.t0)){t.next=20;break}throw t.t0;case 20:throw new ca("arguments is not valid",gb);case 21:return t.abrupt("return",Zq(r.attributeInfos.map((function(t){return[t.key,t.value]}))));case 22:case"end":return t.stop()}}),t,this,[[6,16]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var t=ma(N.mark((function t(e){var n,i,r,s,o,a,c,l,u,d,h;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Ta(e)){t.next=2;break}throw new ca("Not a valid channel ID",gb);case 2:if(this.connectionState===oa.CONNECTED){t.next=4;break}throw new da("The client is not logged in",qc);case 4:if(void 0!==this.session){t.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return t.prev=6,t.next=9,this.session.requestGetChannelAttributesKeys(e).toPromise();case 9:return n=t.sent,i=n.keys,t.next=13,this.session.requestGetChannelAttributesByKeys(e,i).toPromise();case 13:r=t.sent,s=r.attributeMaps,t.next=22;break;case 17:if(t.prev=17,t.t0=t.catch(6),!Na(t.t0)){t.next=21;break}throw t.t0;case 21:throw new ca("arguments is not valid",gb);case 22:o={},a=0;case 24:if(!(a<s.length)){t.next=32;break}if(c=s[a],l=c.key,u=c.ms,d=c.value,h=c.origin,"string"==typeof l&&P.isLong(u)&&"string"==typeof d&&Ta(h)){t.next=28;break}return t.abrupt("break",32);case 28:o[l]={value:d,lastUpdateUserId:h,lastUpdateTs:u.toNumber()};case 29:a++,t.next=24;break;case 32:return this.channelAttributesCacheLru.set(e,md(o,(function(t){return new Blob([t.value]).size}))),t.abrupt("return",o);case 34:case"end":return t.stop()}}),t,this,[[6,17]])})));return function(e){return t.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var t=ma(N.mark((function t(e,n){var i,r,s,o,a,c,l,u,d,h;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===oa.CONNECTED){t.next=2;break}throw new da("The client is not logged in",qc);case 2:if(void 0!==this.session){t.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Qn(e,n),t.prev=5,t.next=8,this.session.requestGetChannelAttributesByKeys(e,n).toPromise();case 8:i=t.sent,r=i.attributeMaps,t.next=17;break;case 12:if(t.prev=12,t.t0=t.catch(5),!Na(t.t0)){t.next=16;break}throw t.t0;case 16:throw new ca("arguments is not valid",gb);case 17:s={},o=this.channelAttributesCacheLru.get(e,{}),a=0;case 20:if(!(a<r.length)){t.next=29;break}if(c=r[a],l=c.key,u=c.ms,d=c.value,h=c.origin,"string"==typeof l&&P.isLong(u)&&"string"==typeof d&&Ta(h)){t.next=24;break}return t.abrupt("break",29);case 24:o[l]=new Blob([d]).size,s[l]={value:d,lastUpdateUserId:h,lastUpdateTs:u.toNumber()};case 26:a++,t.next=20;break;case 29:return this.channelAttributesCacheLru.set(e,o),t.abrupt("return",s);case 31:case"end":return t.stop()}}),t,this,[[5,12]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var t=ma(N.mark((function t(e,n){var i;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===oa.CONNECTED){t.next=2;break}throw new da("The client is not logged in",qc);case 2:if(void 0!==this.session){t.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Qn(e,n),t.prev=5,t.next=8,this.session.requestGetUserAttributesByKeys(e,n).toPromise();case 8:i=t.sent,t.next=16;break;case 11:if(t.prev=11,t.t0=t.catch(5),!Na(t.t0)){t.next=15;break}throw t.t0;case 15:throw new ca("arguments is not valid",gb);case 16:return t.abrupt("return",Zq(i.attributeInfos.map((function(t){return[t.key,t.value]}))));case 17:case"end":return t.stop()}}),t,this,[[5,11]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"login",value:function(){var t=ma(N.mark((function t(e){var n,i,r,s,o;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(xn(!0),i=nh(),r=e.token,e.token===this.context.appId&&(r=void 0),bb("Session",{appId:this.context.appId,did:navigator.userAgent,elapse:Xa(this.session&&this.session.startTime),index:{index1:e.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},installId:Og,lts:P.fromNumber(Date.now()),os:7,sid:sb(i),token:r||"",userId:e.uid,ver:"1.5.1",buildno:418,subVersion:18,version:4},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n,!0),De(e)&&Ta(e.uid)){t.next=7;break}throw new ca("not a valid user id",si);case 7:if("string"!=typeof r||!r){t.next=11;break}this.context.token=r,t.next=13;break;case 11:if("string"==typeof r||null==r){t.next=13;break}throw new ca('The "token" is not a valid string.',si);case 13:return s=Date.now(),this.context.sid=sb(i),this.loginPromise=this.loginImpl({uid:e.uid,instanceId:i}),this.info("RTM Client logging in as ".concat(La(e.uid))),t.prev=17,t.next=20,this.loginPromise;case 20:t.next=28;break;case 22:throw t.prev=22,t.t0=t.catch(17),Na(t.t0)&&bb("Link",{ackedServerIp:"",destServerIp:"",ec:t.t0.code||1,sc:t.t0.serverCode,elapse:Xa(this.session&&this.session.startTime),lts:P.fromNumber(Date.now()),responseTime:Date.now()-s,sid:sb(i),userId:e.uid},null!==(o=this.context.config.enableCloudProxy)&&void 0!==o&&o),this.context.token=void 0,this.context.socketUseProxy=!1,t.t0;case 28:return t.prev=28,this.loginPromise=void 0,t.finish(28);case 31:this.context.socketUseProxy&&this.emit("FallbackProxyConnected"),xn(!1);case 33:case"end":return t.stop()}}),t,this,[[17,22,28,31]])})));return function(e){return t.apply(this,arguments)}}()},{key:"logout",value:function(){var t=ma(N.mark((function t(){var e;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.loginPromise){t.next=3;break}return t.next=3,this.loginPromise;case 3:if(this.connectionState!==oa.DISCONNECTED){t.next=6;break}throw this.logError("Already in logout state"),new da("Logout failure. The client has already been logged out",cs);case 6:if(this.internalEmitter.emit("LOGOUT"),this.connectionState!==oa.ABORTED){t.next=11;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),t.abrupt("return");case 11:if(void 0!==this.session){t.next=14;break}return this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),t.abrupt("return");case 14:return bb("Logout",{elapse:Xa(this.session.startTime),lts:P.fromNumber(Date.now()),sid:sb(this.session.instanceId),userId:this.context.uid},null!==(e=this.context.config.enableCloudProxy)&&void 0!==e&&e),t.next=17,this.session.logoutHandler();case 17:this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),this.log("Log out success");case 19:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var t,e=this;if(this.connectionState===oa.DISCONNECTED)throw this.logError("Already in logout state"),new da("Logout failure. The client has already been logged out",cs);this.connectionState===oa.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):void 0!==this.session&&(bb("Logout",{elapse:Xa(this.session.startTime),lts:P.fromNumber(Date.now()),sid:sb(this.session.instanceId),userId:this.context.uid},null!==(t=this.context.config.enableCloudProxy)&&void 0!==t&&t),this.session.logoutHandler().then((function(){e.log("Log out success")}))),this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var t=ma(N.mark((function t(e,n){var i,r,s=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(Xn(e,bg),i="TEXT"===e.messageType?Ka.P2pSMsgNoOfflineFlag:Ka.P2pRMsgNoOfflineFlag,this.connectionState!==oa.RECONNECTING){t.next=5;break}return r=Date.now(),t.abrupt("return",new Promise((function(t,o){var a,c=(a=ma(N.mark((function a(){var c;return N.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==s.session){a.next=2;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return c=Date.now()-r,a.prev=3,a.t0=t,a.next=7,ph({message:e,peerId:n,toPeer:!0,session:s.session,errorCodes:{NOT_LOGGED_IN:Ll,TOO_OFTEN:es},diff:c,logger:s.logger});case 7:a.t1=a.sent,(0,a.t0)(a.t1),a.next=18;break;case 11:a.prev=11,a.t2=a.catch(3),Ab(a.t2)&&(s.session.emit("messageCount",{messageCategory:i,type:"common",key:"sentcount"}),s.session.emit("messageCount",{messageCategory:i,type:"common",key:"timeoutcount"}),o(new Ub(we(s.name,"sendMessageToPeer",1e4),Kl))),Na(a.t2)&&o(a.t2),s.session.emit("messageCount",{messageCategory:i,type:"common",key:"sentcount"}),s.session.emit("messageCount",{messageCategory:i,type:"common",key:"unknowerrorcount"}),o(new Ja("Peer-to-peer message send failure",{code:ds,originalError:a.t2}));case 18:return a.prev=18,clearTimeout(l),a.finish(18);case 21:case"end":return a.stop()}}),a,null,[[3,11,18,21]])}))),function(){return a.apply(this,arguments)});s.internalEmitter.once("RECONNECTED",c);var l=setTimeout((function(){s.internalEmitter.off("RECONNECTED",c),o(new Ub(we(s.name,"sendMessageToPeer",1e4),Kl))}),9e3)})));case 5:if(this.connectionState===oa.CONNECTED){t.next=7;break}throw new da("Failed to send the peer-to-peer message. The client is not logged in",Ll);case 7:if(void 0!==this.session){t.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return t.prev=9,t.next=12,ph({message:e,peerId:n,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:Ll,TOO_OFTEN:es},diff:0,logger:this.logger});case 12:return t.abrupt("return",t.sent);case 15:if(t.prev=15,t.t0=t.catch(9),!Ab(t.t0)){t.next=21;break}throw this.session.emit("messageCount",{messageCategory:i,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:i,type:"common",key:"timeoutcount"}),new Ub(we(this.name,"sendMessageToPeer",1e4),Kl);case 21:if(!Na(t.t0)){t.next=23;break}throw t.t0;case 23:throw this.session.emit("messageCount",{messageCategory:i,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:i,type:"common",key:"unknowerrorcount"}),new Ja("Peer-to-peer message send failure",{code:ds,originalError:t.t0});case 26:case"end":return t.stop()}}),t,this,[[9,15]])})));return function(e,n){return t.apply(this,arguments)}}()},{key:"createChannel",value:function(t){var e=this;if(!Ta(t))throw new ca(["The %s in the arguments is invalid",Object.keys({channelId:t})[0]],FB);return new uF(t,(function(){return e.session}),this,this.logger)}},{key:"createLocalInvitation",value:function(t){if(!Ta(t))throw new ca(["The %s in the arguments is invalid",Object.keys({calleeId:t})[0]],Xc);return this.invitationManager.genLocalInvitation(t)}},{key:"subscribePeersOnlineStatus",value:function(){var t=ma(N.mark((function t(e){var n,i,r,s,o,a,c,l,u,d,h,A,p,f=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===oa.CONNECTED){t.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(void 0!==this.session){t.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(e)&&0!==e.length){t.next=6;break}throw new ca("Invalid arguments: peerIds",Qg);case 6:n=0;case 7:if(!(n<e.length)){t.next=14;break}if(Ta(i=e[n])){t.next=11;break}throw new ca(["subscribePeersOnlineStatus peer id %s is invalid",i],Qg);case 11:n++,t.next=7;break;case 14:if(!(512<(r=e&&e.length?fl(e):[]).length+Object.keys(this.subscribedPeerStatusCache).length+this.pendingPeerStatusSubCount)){t.next=17;break}throw new ic("Subscribed peers overflows",js);case 17:return this.pendingPeerStatusSubCount+=r.length,t.next=20,this.session.requestSubscribePeersOnlineStatus(r).toPromise();case 20:s=t.sent,o=s.errors,this.pendingPeerStatusSubCount-=r.length,a=[],c=[],l=0;case 26:if(!(l<o.length)){t.next=34;break}if(u=o[l],d=u.code,"string"==typeof(h=u.account)){t.next=30;break}throw new Ja("Returned account is invalid",is);case 30:0!==d&&a.push(h);case 31:l++,t.next=26;break;case 34:for(A=0;A<r.length;A++)p=r[A],a.includes(p)||(c.push(p),this.subscribedPeerStatusCache[p]=void 0);if(this.session.requestPeersOnlineStatus(c).pipe(Ea((function(t){return md(tl(t.userInfos,"account"),(function(t){return!!t.ts}))}))).subscribe((function(t){t=md(t,(function(t,e){return t=t?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE,f.subscribedPeerStatusCache[e]=t})),f.emit("PeersOnlineStatusChanged",t)})),0===a.length){t.next=38;break}throw new Ja("Subscription failed",is);case 38:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var t=ma(N.mark((function t(e){var n,i,r,s,o;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===oa.CONNECTED){t.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(void 0!==this.session){t.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(e)&&0!==e.length){t.next=6;break}throw new ca("Invalid arguments: peerIds",Qg);case 6:n=0;case 7:if(!(n<e.length)){t.next=14;break}if(Ta(i=e[n])){t.next=11;break}throw new ca(["subscribePeersOnlineStatus peer id %s is invalid",i],Qg);case 11:n++,t.next=7;break;case 14:if(!(512<e.length)){t.next=16;break}throw new ic("Unsubscribed peers overflows",js);case 16:for(r=e&&e.length?fl(e):[],this.session.requestUnsubscribePeersOnlineStatus(r),s=0;s<r.length;s++)o=r[s],delete this.subscribedPeerStatusCache[o];case 19:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var t=ma(N.mark((function t(e){return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.connectionState===oa.CONNECTED){t.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(e!==ta.PeerSubscriptionOption.ONLINE_STATUS){t.next=4;break}return t.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new ca("Subscription option not supported",Qg);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"createMessage",value:function(t){return t}},{key:"loginImpl",value:function(){var t=ma(N.mark((function t(e){var n,i,r,s,o,a,c,l,u=this;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uid,i=e.instanceId,r=e.forceLoginTime,s=void 0===r?0:r,o=i,!(void 0!==this.lastLoginTime&&500>Date.now()-this.lastLoginTime)){t.next=4;break}throw new bE(["The frequency of login exceeded the limit of %d queries per second",2],UB);case 4:if(this.connectionState===oa.DISCONNECTED||0!==s){t.next=6;break}throw new da("The SDK is either logging in or has logged in the Agora RTM system",SB);case 6:t.prev=6,this.context.uid=n,t.next=13;break;case 10:throw t.prev=10,t.t0=t.catch(6),new ca(["The %s in the arguments is invalid",Object.keys({uid:n})[0]],si);case 13:return 0===s&&this.onConnectionStateChanged(oa.CONNECTING,Rb.LOGIN),(a=new ct(this.context,this.logger,!1)).blacklistedIP=this.blacklistedIP,this.session=c=new Tt(this.context,a,o,this.logger),l=function(){u.connectionState===oa.CONNECTED&&(u.onConnectionStateChanged(oa.RECONNECTING,Rb.INTERRUPTED),u.session)&&u.session.once("userJoined",(function(){u.onConnectionStateChanged(oa.CONNECTED,Rb.LOGIN_SUCCESS)}))},c.on("connectionLost",l),c.on("tokenExpired",(function(){u.emit("TokenExpired")})),c.on("tokenPrivilegeWillExpire",this.TokenPrivilegeWillExpireHandler),c.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",(function(t){u.emit("MessageFromPeer",{text:t.text,messageType:ta.MessageType.TEXT},t.peerId,t.properties)})),this.session.on("peerRawMessage",(function(t){u.emit("MessageFromPeer",{rawMessage:t.raw,description:t.desc,messageType:ta.MessageType.RAW},t.peerId,t.properties)})),c.on("instanceChanged",(function(t){return o=t})),c.on("peerOnlineStatusChanged",(function(t){var e=t.instance.toString()+t.state,n=u.peerStatusSeqLru.get(e);!n||t.seq.greaterThan(n)?(u.peerStatusSeqLru.set(e,t.seq),t.state!==u.subscribedPeerStatusCache[t.peerId]&&u.emit("PeersOnlineStatusChanged",x({},t.peerId,t.state)),u.subscribedPeerStatusCache[t.peerId]=t.state,clearTimeout(u.peerUnreachableTimers[e]),t.state===ta.PeerOnlineState.UNREACHABLE&&(u.peerUnreachableTimers[e]=setTimeout((function(){u.subscribedPeerStatusCache[t.peerId]===ta.PeerOnlineState.UNREACHABLE&&(u.subscribedPeerStatusCache[t.peerId]=ta.PeerOnlineState.ONLINE,u.emit("PeersOnlineStatusChanged",x({},t.peerId,ta.PeerOnlineState.ONLINE)))}),3e4))):u.log("peerOnlineStatusChanged dedup for %s, %d",e,t.seq.toNumber())})),c.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),c.on("channelAttributesUpdated",(function(t){var e=t.channelId;t=t.attributeMaps;for(var n={},i=0;i<t.length;i++){var r=t[i],s=r.key,o=r.ms,a=r.value;if(r=r.origin,"string"!=typeof s||!P.isLong(o)||"string"!=typeof a||!Ta(r))break;n[s]=new Blob([a]).size}u.channelAttributesCacheLru.set(e,n)})),c.on("userJoined",(function(t){if(0!==Object.keys(u.attributes).length){if(void 0===u.session)return;u.session.requestSetLocalUserAttributes(u.attributes,t).toPromise()}if(0!==u.attributeDrafts.size)for(var e=function(e,n){var i=(e=n[e]).attribute;e.promise.then((function(){void 0!==u.session&&u.session.requestSetLocalUserAttributes(i,t).toPromise()}))},n=0,i=Array.from(u.attributeDrafts);n<i.length;n++)e(n,i);0!==Object.keys(u.subscribedPeerStatusCache).length&&c.requestSubscribePeersOnlineStatus(Object.keys(u.subscribedPeerStatusCache))})),c.on("banEdgeIP",(function(t){u.banIP(t)})),this.lastLoginTime=Date.now(),t.prev=32,t.next=35,c.loginHandler().toPromise();case 35:t.next=53;break;case 37:if(t.prev=37,t.t1=t.catch(32),!("loginRespTimeout"===t.t1.name&&2>s)){t.next=46;break}return c.removeAllListeners(),t.next=43,this.loginImpl({uid:n,instanceId:i,forceLoginTime:s+1});case 43:return t.abrupt("return");case 46:if(!Ab(t.t1)){t.next=49;break}throw this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGIN_TIMEOUT),new Ub(we(this.name,"login",12e3),TB);case 49:if(this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGIN_FAILURE),!Na(t.t1)){t.next=52;break}throw t.t1;case 52:throw new Ja("Login failure",{code:$r,originalError:t.t1});case 53:this.onConnectionStateChanged(oa.CONNECTED,Rb.LOGIN_SUCCESS);case 54:case"end":return t.stop()}}),t,this,[[6,10],[32,37]])})));return function(e){return t.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(t,e){var n,i=this;t===oa.RECONNECTING&&(this.reconnId+=1),bb("ConnectionStateChange",{elapse:Xa(this.session&&this.session.startTime),lts:P.fromNumber(Date.now()),newState:Vt[t],oldState:Vt[this.connectionState],reason:vF[e],sid:sb(this.session&&this.session.instanceId||P.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),this.connectionState===oa.RECONNECTING&&t===oa.CONNECTED&&(0!==Object.keys(this.subscribedPeerStatusCache).length&&void 0!==this.session&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(Ea((function(t){return md(tl(t.userInfos,"account"),(function(t){return!!t.ts}))}))).subscribe((function(t){t=md(t,(function(t,e){return t=t?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE,i.subscribedPeerStatusCache[e]=t})),i.emit("PeersOnlineStatusChanged",t)})),this.internalEmitter.emit("RECONNECTED")),this.connectionState=t,t!==oa.ABORTED&&t!==oa.DISCONNECTED||(this.pendingPeerStatusSubCount=this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.emit("ConnectionStateChanged",t,e)}},{key:"banIP",value:function(t){var e;this.log("ip banned",t);var n=null!==(e=this.blacklistedIP[t])&&void 0!==e?e:0;this.blacklistedIP[t]=n+1}}]),e}(sc()),Da(W.prototype,"renewToken",[jb],Object.getOwnPropertyDescriptor(W.prototype,"renewToken"),W.prototype),Da(W.prototype,"queryPeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"queryPeersOnlineStatus"),W.prototype),Da(W.prototype,"getChannelMemberCount",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelMemberCount"),W.prototype),Da(W.prototype,"setLocalUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"setLocalUserAttributes"),W.prototype),Da(W.prototype,"setChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"setChannelAttributes"),W.prototype),Da(W.prototype,"addOrUpdateLocalUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"addOrUpdateLocalUserAttributes"),W.prototype),Da(W.prototype,"addOrUpdateChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"addOrUpdateChannelAttributes"),W.prototype),Da(W.prototype,"deleteLocalUserAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"deleteLocalUserAttributesByKeys"),W.prototype),Da(W.prototype,"deleteChannelAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"deleteChannelAttributesByKeys"),W.prototype),Da(W.prototype,"clearLocalUserAttributes",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"clearLocalUserAttributes"),W.prototype),Da(W.prototype,"clearChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"clearChannelAttributes"),W.prototype),Da(W.prototype,"getUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getUserAttributes"),W.prototype),Da(W.prototype,"getChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelAttributes"),W.prototype),Da(W.prototype,"getChannelAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelAttributesByKeys"),W.prototype),Da(W.prototype,"getUserAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getUserAttributesByKeys"),W.prototype),Da(W.prototype,"login",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"login"),W.prototype),Da(W.prototype,"logout",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"logout"),W.prototype),Da(W.prototype,"logoutSync",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"logoutSync"),W.prototype),Da(W.prototype,"sendMessageToPeer",[jb],Object.getOwnPropertyDescriptor(W.prototype,"sendMessageToPeer"),W.prototype),Da(W.prototype,"createChannel",[jb],Object.getOwnPropertyDescriptor(W.prototype,"createChannel"),W.prototype),Da(W.prototype,"createLocalInvitation",[jb],Object.getOwnPropertyDescriptor(W.prototype,"createLocalInvitation"),W.prototype),Da(W.prototype,"subscribePeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"subscribePeersOnlineStatus"),W.prototype),Da(W.prototype,"unsubscribePeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"unsubscribePeersOnlineStatus"),W.prototype),Da(W.prototype,"queryPeersBySubscriptionOption",[jb],Object.getOwnPropertyDescriptor(W.prototype,"queryPeersBySubscriptionOption"),W.prototype),Da(W.prototype,"createMessage",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"createMessage"),W.prototype),W),rm,sm,tm,um,Wt=null===(rm=/Chrome\/([0-9.]+)/.exec(null===(tm=window)||void 0===tm||null===(um=tm.navigator)||void 0===um?void 0:um.userAgent))||void 0===rm||null===(sm=rm[1])||void 0===sm?void 0:sm.split(".")[0];if(Wt&&88<=parseInt(Wt,10)&&!Ce()){var vm,ze=document.createElement("video"),Ae=document.createElement("canvas");ze.setAttribute("style","display:none"),ze.setAttribute("muted",""),ze.muted=!0,ze.setAttribute("autoplay",""),ze.autoplay=!0,ze.setAttribute("playsinline",""),Ae.setAttribute("style","display:none"),Ae.setAttribute("width","1"),Ae.setAttribute("height","1"),null===(vm=Ae.getContext("2d"))||void 0===vm||vm.fillRect(0,0,1,1),ze.srcObject=null==Ae?void 0:Ae.captureStream()}var Xt={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},Yt={enableLogUpload:!1,logFilter:Xt.LOG_FILTER_INFO,enableCloudProxy:!1},ue=Wa(Wa({createInstance:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(t))throw new ca(["The %s in the arguments is invalid",Object.keys({appId:t})[0]],Or);var i=Object.keys(e).filter((function(t){return!(t in Yt)}));if(0!==i.length)throw new ca("Invalid RTM config: ".concat(i.join(", ")),Or);var r=Wa(Wa({},Yt),e);if(void 0!==n&&(!Array.isArray(n)||0===n.length))throw new ca("Invalid area config");if(null!=n){if(!n.every((function(t){return t in ta.LegacyAreaCode})))throw new ca("Invalid area codes: ".concat(n.filter((function(t){return!(t in ta)})).join(", ")));fa=Ve(n.map((function(t){return dE[t]})))}n=Tl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var s=iE(r);i=jE(r);var o=kE(r),a=lE(n,r),c=Xs(n,r),l=c("RTM:DEBUG","<Entry> ");return Qs.rtmConfig=r,s("The Agora RTM Web SDK version is %s","1.5.1"),e.enableCloudProxy&&s("RTM cloud proxy enabled"),e.enableLogUpload&&s("Log upload enabled"),fa&&l("Area is set to %s",Array.from(fa.CODES).map((function(t){return Yf(S).find((function(e){return S[e]===t}))})).join(", ")),l("Creating an RtmClient instance"),l('The Git commit ID is "'.concat("v1.5.1-0-g5bbbcd72",'"')),l("The App ID is %s",Yn(t,4,10,"*".repeat(6))),s("The process ID is %s",Og),l("The build is %s","v1.5.1-0-g5bbbcd72"),l("NODE_ENV is %s","production"),new wF(t,{genLogger:c,genTracker:a,info:s,warn:i,logError:o,loggerId:n},r,(function(t){for(var e=0,n=Yf(t);e<n.length;e++){var i=n[e];try{var o=t[i];null!=o&&(t.enableCloudProxy&&s("RTM cloud proxy enabled"),t.enableLogUpload&&s("Log upload enabled"),r[i]=o)}catch(t){throw new ca(["The %s in the arguments is invalid",i],void 0)}}}))},BUILD:"v1.5.1-0-g5bbbcd72",VERSION:"1.5.1",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:Og,ConnectionChangeReason:ta.ConnectionChangeReason,ConnectionState:ta.ConnectionState,LocalInvitationFailureReason:ta.LocalInvitationFailureReason,LocalInvitationState:ta.LocalInvitationState,RemoteInvitationFailureReason:ta.RemoteInvitationFailureReason,RemoteInvitationState:ta.RemoteInvitationState,MessageType:ta.MessageType,PeerOnlineState:ta.PeerOnlineState,PeerSubscriptionOption:ta.PeerSubscriptionOption},Xt),{},{setParameter:function(t,e){Object.keys(Ec).includes(t)&&(Ec[t]=e)},getParameter:function(t){return Ec[t]},setArea:function(t){var e=t.areaCodes;if(t=t.excludedArea,!Array.isArray(e)||0===e.length||!e.every((function(t){return t in ta.AreaCode})))throw new ca("Invalid area config");if(void 0!==t&&t===ta.AreaCode.GLOBAL)throw new ca("Excluded area cannot be global");if(void 0===t)fa=Ve(e.map((function(t){return S[t]})));else{if(e.includes(t))throw new ca("Excluded area cannot be in areaCodes");if(!(t in S))throw new ca("Invalid excludedArea:",t);fa=Gv({areas:e.map((function(t){return S[t]})),excludedArea:S[t]})}}});return ue})),"undefined"!=typeof window&&function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Hls=e():t.Hls=e()}(this,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
  !*** ./node_modules/eventemitter3/index.js ***!
  \*********************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,n){var i=Object.prototype.hasOwnProperty,r="~";function s(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function a(t,e,n,i,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,i||t,s),c=r?r+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function l(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),l.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)i.call(t,e)&&n.push(r?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},l.prototype.listeners=function(t){var e=r?r+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,s=n.length,o=new Array(s);i<s;i++)o[i]=n[i].fn;return o},l.prototype.listenerCount=function(t){var e=r?r+t:t,n=this._events[e];return n?n.fn?1:n.length:0},l.prototype.emit=function(t,e,n,i,s,o){var a=r?r+t:t;if(!this._events[a])return!1;var c,l,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,i),!0;case 5:return u.fn.call(u.context,e,n,i,s),!0;case 6:return u.fn.call(u.context,e,n,i,s,o),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,A=u.length;for(l=0;l<A;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,n);break;case 4:u[l].fn.call(u[l].context,e,n,i);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},l.prototype.on=function(t,e,n){return a(this,t,e,n,!1)},l.prototype.once=function(t,e,n){return a(this,t,e,n,!0)},l.prototype.removeListener=function(t,e,n,i){var s=r?r+t:t;if(!this._events[s])return this;if(!e)return c(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||i&&!o.once||n&&o.context!==n||c(this,s);else{for(var a=0,l=[],u=o.length;a<u;a++)(o[a].fn!==e||i&&!o[a].once||n&&o[a].context!==n)&&l.push(o[a]);l.length?this._events[s]=1===l.length?l[0]:l:c(this,s)}return this},l.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&c(this,e)):(this._events=new s,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=r,l.EventEmitter=l,t.exports=l},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,n){var i,r,s,o,a;i=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,r=/^([^\/?#]*)(.*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var i=a.parseURL(t);if(!i)throw new Error("Error trying to parse base URL.");return i.path=a.normalizePath(i.path),a.buildURLFromParts(i)}var s=a.parseURL(e);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return n.alwaysNormalize?(s.path=a.normalizePath(s.path),a.buildURLFromParts(s)):e;var o=a.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var c=r.exec(o.path);o.netLoc=c[1],o.path=c[2]}o.netLoc&&!o.path&&(o.path="/");var l={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(l.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var u=o.path,d=u.substring(0,u.lastIndexOf("/")+1)+s.path;l.path=a.normalizePath(d)}else l.path=o.path,s.params||(l.params=o.params,s.query||(l.query=o.query));return null===l.path&&(l.path=n.alwaysNormalize?a.normalizePath(s.path):s.path),a.buildURLFromParts(l)},parseURL:function(t){var e=i.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(s,"");t.length!==(t=t.replace(o,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=a},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(t,e,n){function i(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw console.error(t),t};var i=n(n.s=ENTRY_MODULE);return i.default||i}var r="[\\.|\\-|\\+|\\w|/|@]+",s="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function o(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(t,e,i){var a={};a[i]=[];var c=e.toString(),l=c.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return a;for(var u,d=l[1],h=new RegExp("(\\\\n|\\W)"+o(d)+s,"g");u=h.exec(c);)"dll-reference"!==u[3]&&a[i].push(u[3]);for(h=new RegExp("\\("+o(d)+'\\("(dll-reference\\s('+r+'))"\\)\\)'+s,"g");u=h.exec(c);)t[u[2]]||(a[i].push(u[1]),t[u[2]]=n(u[1]).m),a[u[2]]=a[u[2]]||[],a[u[2]].push(u[4]);for(var A,p=Object.keys(a),f=0;f<p.length;f++)for(var m=0;m<a[p[f]].length;m++)A=a[p[f]][m],isNaN(1*A)||(a[p[f]][m]=1*a[p[f]][m]);return a}function c(t){return Object.keys(t).reduce((function(e,n){return e||t[n].length>0}),!1)}t.exports=function(t,e){e=e||{};var r={main:n.m},s=e.all?{main:Object.keys(r.main)}:function(t,e){for(var n={main:[e]},i={main:[]},r={main:{}};c(n);)for(var s=Object.keys(n),o=0;o<s.length;o++){var l=s[o],u=n[l].pop();if(r[l]=r[l]||{},!r[l][u]&&t[l][u]){r[l][u]=!0,i[l]=i[l]||[],i[l].push(u);for(var d=a(t,t[l][u],l),h=Object.keys(d),A=0;A<h.length;A++)n[h[A]]=n[h[A]]||[],n[h[A]]=n[h[A]].concat(d[h[A]])}}return i}(r,t),o="";Object.keys(s).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;s[t][e];)e++;s[t].push(e),r[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",o=o+"var "+t+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+s[t].map((function(e){return JSON.stringify(e)+": "+r[t][e].toString()})).join(",")+"});\n"})),o=o+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s.main.map((function(t){return JSON.stringify(t)+": "+r.main[t].toString()})).join(",")+"}))(self);";var l=new window.Blob([o],{type:"text/javascript"});if(e.bare)return l;var u=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(l),d=new window.Worker(u);return d.objectURL=u,d}},"./src/crypt/decrypter.js":
/*!********************************************!*\
  !*** ./src/crypt/decrypter.js + 3 modules ***!
  \********************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.ts */function(t,e,n){n.r(e);var i=function(){function t(t,e){this.subtle=t,this.aesIV=e}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}(),r=function(){function t(t,e){this.subtle=t,this.key=e}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}();var s=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var e=t.prototype;return e.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),n=new Uint32Array(4),i=0;i<4;i++)n[i]=e.getUint32(4*i);return n},e.initTable=function(){var t=this.sBox,e=this.invSBox,n=this.subMix,i=n[0],r=n[1],s=n[2],o=n[3],a=this.invSubMix,c=a[0],l=a[1],u=a[2],d=a[3],h=new Uint32Array(256),A=0,p=0,f=0;for(f=0;f<256;f++)h[f]=f<128?f<<1:f<<1^283;for(f=0;f<256;f++){var m=p^p<<1^p<<2^p<<3^p<<4;m=m>>>8^255&m^99,t[A]=m,e[m]=A;var g=h[A],v=h[g],y=h[v],_=257*h[m]^16843008*m;i[A]=_<<24|_>>>8,r[A]=_<<16|_>>>16,s[A]=_<<8|_>>>24,o[A]=_,_=16843009*y^65537*v^257*g^16843008*A,c[m]=_<<24|_>>>8,l[m]=_<<16|_>>>16,u[m]=_<<8|_>>>24,d[m]=_,A?(A=g^h[h[h[y^g]]],p^=h[h[p]]):A=p=1}},e.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),n=!0,i=0;i<e.length&&n;)n=e[i]===this.key[i],i++;if(!n){this.key=e;var r=this.keySize=e.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var s,o,a,c,l=this.ksRows=4*(r+6+1),u=this.keySchedule=new Uint32Array(l),d=this.invKeySchedule=new Uint32Array(l),h=this.sBox,A=this.rcon,p=this.invSubMix,f=p[0],m=p[1],g=p[2],v=p[3];for(s=0;s<l;s++)s<r?a=u[s]=e[s]:(c=a,s%r==0?(c=h[(c=c<<8|c>>>24)>>>24]<<24|h[c>>>16&255]<<16|h[c>>>8&255]<<8|h[255&c],c^=A[s/r|0]<<24):r>6&&s%r==4&&(c=h[c>>>24]<<24|h[c>>>16&255]<<16|h[c>>>8&255]<<8|h[255&c]),u[s]=a=(u[s-r]^c)>>>0);for(o=0;o<l;o++)s=l-o,c=3&o?u[s]:u[s-4],d[o]=o<4||s<=4?c:f[h[c>>>24]]^m[h[c>>>16&255]]^g[h[c>>>8&255]]^v[h[255&c]],d[o]=d[o]>>>0}},e.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},e.decrypt=function(t,e,n,i){for(var r,s,o,a,c,l,u,d,h,A,p,f,m,g,v,y,_,b=this.keySize+6,E=this.invKeySchedule,w=this.invSBox,S=this.invSubMix,T=S[0],C=S[1],R=S[2],I=S[3],x=this.uint8ArrayToUint32Array_(n),O=x[0],L=x[1],M=x[2],k=x[3],N=new Int32Array(t),P=new Int32Array(N.length),D=this.networkToHostOrderSwap;e<N.length;){for(h=D(N[e]),A=D(N[e+1]),p=D(N[e+2]),f=D(N[e+3]),c=h^E[0],l=f^E[1],u=p^E[2],d=A^E[3],m=4,g=1;g<b;g++)r=T[c>>>24]^C[l>>16&255]^R[u>>8&255]^I[255&d]^E[m],s=T[l>>>24]^C[u>>16&255]^R[d>>8&255]^I[255&c]^E[m+1],o=T[u>>>24]^C[d>>16&255]^R[c>>8&255]^I[255&l]^E[m+2],a=T[d>>>24]^C[c>>16&255]^R[l>>8&255]^I[255&u]^E[m+3],c=r,l=s,u=o,d=a,m+=4;r=w[c>>>24]<<24^w[l>>16&255]<<16^w[u>>8&255]<<8^w[255&d]^E[m],s=w[l>>>24]<<24^w[u>>16&255]<<16^w[d>>8&255]<<8^w[255&c]^E[m+1],o=w[u>>>24]<<24^w[d>>16&255]<<16^w[c>>8&255]<<8^w[255&l]^E[m+2],a=w[d>>>24]<<24^w[c>>16&255]<<16^w[l>>8&255]<<8^w[255&u]^E[m+3],m+=3,P[e]=D(r^O),P[e+1]=D(a^L),P[e+2]=D(o^M),P[e+3]=D(s^k),O=h,L=A,M=p,k=f,e+=4}return i?(v=P.buffer,y=v.byteLength,(_=y&&new DataView(v).getUint8(y-1))?v.slice(0,y-_):v):P.buffer},e.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},t}(),o=n("./src/errors.ts"),a=n("./src/utils/logger.js"),c=n("./src/events.js"),l=n("./src/utils/get-self-scope.js"),u=Object(l.getSelfScope)(),d=function(){function t(t,e,n){var i=(void 0===n?{}:n).removePKCS7Padding,r=void 0===i||i;if(this.logEnabled=!0,this.observer=t,this.config=e,this.removePKCS7Padding=r,r)try{var s=u.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(t){}this.disableWebCrypto=!this.subtle}var e=t.prototype;return e.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},e.decrypt=function(t,e,n,o){var c=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(a.logger.log("JS AES decrypt"),this.logEnabled=!1);var l=this.decryptor;l||(this.decryptor=l=new s),l.expandKey(e),o(l.decrypt(t,0,n,this.removePKCS7Padding))}else{this.logEnabled&&(a.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var u=this.subtle;this.key!==e&&(this.key=e,this.fastAesKey=new r(u,e)),this.fastAesKey.expandKey().then((function(r){new i(u,n).decrypt(t,r).catch((function(i){c.onWebCryptoError(i,t,e,n,o)})).then((function(t){o(t)}))})).catch((function(i){c.onWebCryptoError(i,t,e,n,o)}))}},e.onWebCryptoError=function(t,e,n,i,r){this.config.enableSoftwareAES?(a.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(e,n,i,r)):(a.logger.error("decrypting error : "+t.message),this.observer.trigger(c.default.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))},e.destroy=function(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)},t}();e.default=d},"./src/demux/demuxer-inline.js":
/*!**************************************************!*\
  !*** ./src/demux/demuxer-inline.js + 12 modules ***!
  \**************************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.ts */function(t,e,n){n.r(e);var i=n("./src/events.js"),r=n("./src/errors.ts"),s=n("./src/crypt/decrypter.js"),o=n("./src/polyfills/number.js"),a=n("./src/utils/logger.js"),c=n("./src/utils/get-self-scope.js");function l(t,e){return 255===t[e]&&240==(246&t[e+1])}function u(t,e){return 1&t[e+1]?7:9}function d(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function h(t,e){return!!(e+1<t.length&&l(t,e))}function A(t,e){if(h(t,e)){var n=u(t,e);if(e+n>=t.length)return!1;var i=d(t,e);if(i<=n)return!1;var r=e+i;if(r===t.length||r+1<t.length&&l(t,r))return!0}return!1}function p(t,e,n,s,o){if(!t.samplerate){var c=function(t,e,n,s){var o,c,l,u,d,h=navigator.userAgent.toLowerCase(),A=s,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(o=1+((192&e[n+2])>>>6),!((c=(60&e[n+2])>>>2)>p.length-1))return u=(1&e[n+2])<<2,u|=(192&e[n+3])>>>6,a.logger.log("manifest codec:"+s+",ADTS data:type:"+o+",sampleingIndex:"+c+"["+p[c]+"Hz],channelConfig:"+u),/firefox/i.test(h)?c>=6?(o=5,d=new Array(4),l=c-3):(o=2,d=new Array(2),l=c):-1!==h.indexOf("android")?(o=2,d=new Array(2),l=c):(o=5,d=new Array(4),s&&(-1!==s.indexOf("mp4a.40.29")||-1!==s.indexOf("mp4a.40.5"))||!s&&c>=6?l=c-3:((s&&-1!==s.indexOf("mp4a.40.2")&&(c>=6&&1===u||/vivaldi/i.test(h))||!s&&1===u)&&(o=2,d=new Array(2)),l=c)),d[0]=o<<3,d[0]|=(14&c)>>1,d[1]|=(1&c)<<7,d[1]|=u<<3,5===o&&(d[1]|=(14&l)>>1,d[2]=(1&l)<<7,d[2]|=8,d[3]=0),{config:d,samplerate:p[c],channelCount:u,codec:"mp4a.40."+o,manifestCodec:A};t.trigger(i.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+c})}(e,n,s,o);t.config=c.config,t.samplerate=c.samplerate,t.channelCount=c.channelCount,t.codec=c.codec,t.manifestCodec=c.manifestCodec,a.logger.log("parsed codec:"+t.codec+",rate:"+c.samplerate+",nb channel:"+c.channelCount)}}function f(t){return 9216e4/t}function m(t,e,n,i,r){var s=function(t,e,n,i,r){var s,o,a=t.length;if(s=u(t,e),o=d(t,e),(o-=s)>0&&e+s+o<=a)return{headerLength:s,frameLength:o,stamp:n+i*r}}(e,n,i,r,f(t.samplerate));if(s){var o=s.stamp,a=s.headerLength,c=s.frameLength,l={unit:e.subarray(n+a,n+a+c),pts:o,dts:o};return t.samples.push(l),{sample:l,length:c+a}}}var g=n("./src/demux/id3.js"),v=function(){function t(t,e,n){this.observer=t,this.config=n,this.remuxer=e}var e=t.prototype;return e.resetInitSegment=function(t,e,n,i){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},e.resetTimeStamp=function(){},t.probe=function(t){if(!t)return!1;for(var e=(g.default.getID3Data(t,0)||[]).length,n=t.length;e<n;e++)if(A(t,e))return a.logger.log("ADTS sync word found !"),!0;return!1},e.append=function(t,e,n,i){for(var r=this._audioTrack,s=g.default.getID3Data(t,0)||[],c=g.default.getTimeStamp(s),l=Object(o.isFiniteNumber)(c)?90*c:9e4*e,u=0,d=l,A=t.length,f=s.length,v=[{pts:d,dts:d,data:s}];f<A-1;)if(h(t,f)&&f+5<A){p(r,this.observer,t,f,r.manifestCodec);var y=m(r,t,f,l,u);if(!y){a.logger.log("Unable to parse AAC frame");break}f+=y.length,d=y.sample.pts,u++}else g.default.isHeader(t,f)?(s=g.default.getID3Data(t,f),v.push({pts:d,dts:d,data:s}),f+=s.length):f++;this.remuxer.remux(r,{samples:[]},{samples:v,inputTimeScale:9e4},{samples:[]},e,n,i)},e.destroy=function(){},t}(),y=n("./src/demux/mp4demuxer.js"),_={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(t,e,n,i,r){if(!(n+24>e.length)){var s=this.parseHeader(e,n);if(s&&n+s.frameLength<=e.length){var o=i+r*(9e4*s.samplesPerFrame/s.sampleRate),a={unit:e.subarray(n,n+s.frameLength),pts:o,dts:o};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(a),{sample:a,length:s.frameLength}}}},parseHeader:function(t,e){var n=t[e+1]>>3&3,i=t[e+1]>>1&3,r=t[e+2]>>4&15,s=t[e+2]>>2&3,o=t[e+2]>>1&1;if(1!==n&&0!==r&&15!==r&&3!==s){var a=3===n?3-i:3===i?3:4,c=1e3*_.BitratesMap[14*a+r-1],l=3===n?0:2===n?1:2,u=_.SamplingRateMap[3*l+s],d=t[e+3]>>6==3?1:2,h=_.SamplesCoefficients[n][i],A=_.BytesInSlot[i],p=8*h*A;return{sampleRate:u,channelCount:d,frameLength:parseInt(h*c/u+o,10)*A,samplesPerFrame:p}}},isHeaderPattern:function(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])},isHeader:function(t,e){return!!(e+1<t.length&&this.isHeaderPattern(t,e))},probe:function(t,e){if(e+1<t.length&&this.isHeaderPattern(t,e)){var n=this.parseHeader(t,e),i=4;n&&n.frameLength&&(i=n.frameLength);var r=e+i;if(r===t.length||r+1<t.length&&this.isHeaderPattern(t,r))return!0}return!1}},b=_,E=function(){function t(t){this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var e=t.prototype;return e.loadWord=function(){var t=this.data,e=this.bytesAvailable,n=t.byteLength-e,i=new Uint8Array(4),r=Math.min(4,e);if(0===r)throw new Error("no bytes available");i.set(t.subarray(n,n+r)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r},e.skipBits=function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},e.readBits=function(t){var e=Math.min(this.bitsAvailable,t),n=this.word>>>32-e;return t>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),(e=t-e)>0&&this.bitsAvailable?n<<e|this.readBits(e):n},e.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},e.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.skipEG=function(){this.skipBits(1+this.skipLZ())},e.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},e.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},e.readBoolean=function(){return 1===this.readBits(1)},e.readUByte=function(){return this.readBits(8)},e.readUShort=function(){return this.readBits(16)},e.readUInt=function(){return this.readBits(32)},e.skipScalingList=function(t){var e,n=8,i=8;for(e=0;e<t;e++)0!==i&&(i=(n+this.readEG()+256)%256),n=0===i?n:i},e.readSPS=function(){var t,e,n,i,r,s,o,a=0,c=0,l=0,u=0,d=this.readUByte.bind(this),h=this.readBits.bind(this),A=this.readUEG.bind(this),p=this.readBoolean.bind(this),f=this.skipBits.bind(this),m=this.skipEG.bind(this),g=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);if(d(),t=d(),h(5),f(3),d(),g(),100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t){var y=A();if(3===y&&f(1),g(),g(),f(1),p())for(s=3!==y?8:12,o=0;o<s;o++)p()&&v(o<6?16:64)}g();var _=A();if(0===_)A();else if(1===_)for(f(1),m(),m(),e=A(),o=0;o<e;o++)m();g(),f(1),n=A(),i=A(),0===(r=h(1))&&f(1),f(1),p()&&(a=A(),c=A(),l=A(),u=A());var b=[1,1];if(p()&&p())switch(d()){case 1:b=[1,1];break;case 2:b=[12,11];break;case 3:b=[10,11];break;case 4:b=[16,11];break;case 5:b=[40,33];break;case 6:b=[24,11];break;case 7:b=[20,11];break;case 8:b=[32,11];break;case 9:b=[80,33];break;case 10:b=[18,11];break;case 11:b=[15,11];break;case 12:b=[64,33];break;case 13:b=[160,99];break;case 14:b=[4,3];break;case 15:b=[3,2];break;case 16:b=[2,1];break;case 255:b=[d()<<8|d(),d()<<8|d()]}return{width:Math.ceil(16*(n+1)-2*a-2*c),height:(2-r)*(i+1)*16-(r?2:4)*(l+u),pixelRatio:b}},e.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}(),w=function(){function t(t,e,n,i){this.decryptdata=n,this.discardEPB=i,this.decrypter=new s.default(t,e,{removePKCS7Padding:!1})}var e=t.prototype;return e.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,e)},e.decryptAacSample=function(t,e,n,i){var r=t[e].unit,s=r.subarray(16,r.length-r.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length),a=this;this.decryptBuffer(o,(function(s){s=new Uint8Array(s),r.set(s,16),i||a.decryptAacSamples(t,e+1,n)}))},e.decryptAacSamples=function(t,e,n){for(;;e++){if(e>=t.length)return void n();if(!(t[e].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,e,n,i),!i)return}}},e.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(e),i=0,r=32;r<=t.length-16;r+=160,i+=16)n.set(t.subarray(r,r+16),i);return n},e.getAvcDecryptedUnit=function(t,e){e=new Uint8Array(e);for(var n=0,i=32;i<=t.length-16;i+=160,n+=16)t.set(e.subarray(n,n+16),i);return t},e.decryptAvcSample=function(t,e,n,i,r,s){var o=this.discardEPB(r.data),a=this.getAvcEncryptedData(o),c=this;this.decryptBuffer(a.buffer,(function(a){r.data=c.getAvcDecryptedUnit(o,a),s||c.decryptAvcSamples(t,e,n+1,i)}))},e.decryptAvcSamples=function(t,e,n,i){for(;;e++,n=0){if(e>=t.length)return void i();for(var r=t[e].units;!(n>=r.length);n++){var s=r[n];if(!(s.length<=48||1!==s.type&&5!==s.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,e,n,i,s,o),!o)return}}}},t}(),S={video:1,audio:2,id3:3,text:4},T=function(){function t(t,e,n,i){this.observer=t,this.config=n,this.typeSupported=i,this.remuxer=e,this.sampleAes=null,this.pmtUnknownTypes={}}var e=t.prototype;return e.setDecryptData=function(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new w(this.observer,this.config,t,this.discardEPB):this.sampleAes=null},t.probe=function(e){var n=t._syncOffset(e);return!(n<0)&&(n&&a.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),!0)},t._syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),n=0;n<e;){if(71===t[n]&&71===t[n+188]&&71===t[n+376])return n;n++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:S[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===t?0:void 0,isAAC:"audio"===t||void 0,duration:"audio"===t?e:void 0}},e.resetInitSegment=function(e,n,i,r){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=t.createTrack("video",r),this._audioTrack=t.createTrack("audio",r),this._id3Track=t.createTrack("id3",r),this._txtTrack=t.createTrack("text",r),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=i,this._duration=r},e.resetTimeStamp=function(){},e.append=function(e,n,s,o){var c,l,u,d,h,A=e.length,p=!1;this.pmtUnknownTypes={},this.contiguous=s;var f=this.pmtParsed,m=this._avcTrack,g=this._audioTrack,v=this._id3Track,y=m.pid,_=g.pid,b=v.pid,E=this._pmtId,w=m.pesData,S=g.pesData,T=v.pesData,C=this._parsePAT,R=this._parsePMT.bind(this),I=this._parsePES,x=this._parseAVCPES.bind(this),O=this._parseAACPES.bind(this),L=this._parseMPEGPES.bind(this),M=this._parseID3PES.bind(this),k=t._syncOffset(e);for(A-=(A+k)%188,c=k;c<A;c+=188)if(71===e[c]){if(l=!!(64&e[c+1]),u=((31&e[c+1])<<8)+e[c+2],(48&e[c+3])>>4>1){if((d=c+5+e[c+4])===c+188)continue}else d=c+4;switch(u){case y:l&&(w&&(h=I(w))&&x(h,!1),w={data:[],size:0}),w&&(w.data.push(e.subarray(d,c+188)),w.size+=c+188-d);break;case _:l&&(S&&(h=I(S))&&(g.isAAC?O(h):L(h)),S={data:[],size:0}),S&&(S.data.push(e.subarray(d,c+188)),S.size+=c+188-d);break;case b:l&&(T&&(h=I(T))&&M(h),T={data:[],size:0}),T&&(T.data.push(e.subarray(d,c+188)),T.size+=c+188-d);break;case 0:l&&(d+=e[d]+1),E=this._pmtId=C(e,d);break;case E:l&&(d+=e[d]+1);var N=R(e,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(y=N.avc)>0&&(m.pid=y),(_=N.audio)>0&&(g.pid=_,g.isAAC=N.isAAC),(b=N.id3)>0&&(v.pid=b),p&&!f&&(a.logger.log("reparse from beginning"),p=!1,c=k-188),f=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(i.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});w&&(h=I(w))?(x(h,!0),m.pesData=null):m.pesData=w,S&&(h=I(S))?(g.isAAC?O(h):L(h),g.pesData=null):(S&&S.size&&a.logger.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=S),T&&(h=I(T))?(M(h),v.pesData=null):v.pesData=T,null==this.sampleAes?this.remuxer.remux(g,m,v,this._txtTrack,n,s,o):this.decryptAndRemux(g,m,v,this._txtTrack,n,s,o)},e.decryptAndRemux=function(t,e,n,i,r,s,o){if(t.samples&&t.isAAC){var a=this;this.sampleAes.decryptAacSamples(t.samples,0,(function(){a.decryptAndRemuxAvc(t,e,n,i,r,s,o)}))}else this.decryptAndRemuxAvc(t,e,n,i,r,s,o)},e.decryptAndRemuxAvc=function(t,e,n,i,r,s,o){if(e.samples){var a=this;this.sampleAes.decryptAvcSamples(e.samples,0,0,(function(){a.remuxer.remux(t,e,n,i,r,s,o)}))}else this.remuxer.remux(t,e,n,i,r,s,o)},e.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},e._parsePAT=function(t,e){return(31&t[e+10])<<8|t[e+11]},e._trackUnknownPmt=function(t,e,n){var i=this.pmtUnknownTypes[t]||0;return 0===i&&(this.pmtUnknownTypes[t]=0,e.call(a.logger,n)),this.pmtUnknownTypes[t]++,i},e._parsePMT=function(t,e,n,i){var r,s,o={audio:-1,avc:-1,id3:-1,isAAC:!0};for(r=e+3+((15&t[e+1])<<8|t[e+2])-4,e+=12+((15&t[e+10])<<8|t[e+11]);e<r;){switch(s=(31&t[e+1])<<8|t[e+2],t[e]){case 207:if(!i){this._trackUnknownPmt(t[e],a.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===o.audio&&(o.audio=s);break;case 21:-1===o.id3&&(o.id3=s);break;case 219:if(!i){this._trackUnknownPmt(t[e],a.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===o.avc&&(o.avc=s);break;case 3:case 4:n?-1===o.audio&&(o.audio=s,o.isAAC=!1):this._trackUnknownPmt(t[e],a.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(t[e],a.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(t[e],a.logger.log,"Unknown stream type:"+t[e])}e+=5+((15&t[e+3])<<8|t[e+4])}return o},e._parsePES=function(t){var e,n,i,r,s,o,c,l,u=0,d=t.data;if(!t||0===t.size)return null;for(;d[0].length<19&&d.length>1;){var h=new Uint8Array(d[0].length+d[1].length);h.set(d[0]),h.set(d[1],d[0].length),d[0]=h,d.splice(1,1)}if(1===((e=d[0])[0]<<16)+(e[1]<<8)+e[2]){if((i=(e[4]<<8)+e[5])&&i>t.size-6)return null;if(192&(n=e[7])&&(o=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&n?o-(c=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(a.logger.warn(Math.round((o-c)/9e4)+"s delta between PTS and DTS, align them"),o=c):c=o),l=(r=e[8])+9,t.size<=l)return null;t.size-=l,s=new Uint8Array(t.size);for(var A=0,p=d.length;A<p;A++){var f=(e=d[A]).byteLength;if(l){if(l>f){l-=f;continue}e=e.subarray(l),f-=l,l=0}s.set(e,u),u+=f}return i&&(i-=r+3),{data:s,pts:o,dts:c,len:i}}return null},e.pushAccesUnit=function(t,e){if(t.units.length&&t.frame){var n=e.samples,i=n.length;if(isNaN(t.pts)){if(!i)return void e.dropped++;var r=n[i-1];t.pts=r.pts,t.dts=r.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||e.sps&&(i||this.contiguous)?(t.id=i,n.push(t)):e.dropped++}t.debug.length&&a.logger.log(t.pts+"/"+t.dts+":"+t.debug)},e._parseAVCPES=function(t,e){var n,i,r,s=this,o=this._avcTrack,a=this._parseAVCNALu(t.data),c=this.avcSample,l=!1,u=this.pushAccesUnit.bind(this),d=function(t,e,n,i){return{key:t,pts:e,dts:n,units:[],debug:i}};t.data=null,c&&a.length&&!o.audFound&&(u(c,o),c=this.avcSample=d(!1,t.pts,t.dts,"")),a.forEach((function(e){switch(e.type){case 1:i=!0,c||(c=s.avcSample=d(!0,t.pts,t.dts,"")),c.frame=!0;var a=e.data;if(l&&a.length>4){var h=new E(a).readSliceType();2!==h&&4!==h&&7!==h&&9!==h||(c.key=!0)}break;case 5:i=!0,c||(c=s.avcSample=d(!0,t.pts,t.dts,"")),c.key=!0,c.frame=!0;break;case 6:i=!0,(n=new E(s.discardEPB(e.data))).readUByte();for(var A=0,p=0,f=!1,m=0;!f&&n.bytesAvailable>1;){A=0;do{A+=m=n.readUByte()}while(255===m);p=0;do{p+=m=n.readUByte()}while(255===m);if(4===A&&0!==n.bytesAvailable){if(f=!0,181===n.readUByte())if(49===n.readUShort())if(1195456820===n.readUInt())if(3===n.readUByte()){var v=n.readUByte(),y=31&v,_=[v,n.readUByte()];for(r=0;r<y;r++)_.push(n.readUByte()),_.push(n.readUByte()),_.push(n.readUByte());s._insertSampleInOrder(s._txtTrack.samples,{type:3,pts:t.pts,bytes:_})}}else if(5===A&&0!==n.bytesAvailable){if(f=!0,p>16){var b=[];for(r=0;r<16;r++)b.push(n.readUByte().toString(16)),3!==r&&5!==r&&7!==r&&9!==r||b.push("-");var w=p-16,S=new Uint8Array(w);for(r=0;r<w;r++)S[r]=n.readUByte();s._insertSampleInOrder(s._txtTrack.samples,{pts:t.pts,payloadType:A,uuid:b.join(""),userDataBytes:S,userData:Object(g.utf8ArrayToStr)(S.buffer)})}}else if(p<n.bytesAvailable)for(r=0;r<p;r++)n.readUByte()}break;case 7:if(i=!0,l=!0,!o.sps){var T=(n=new E(e.data)).readSPS();o.width=T.width,o.height=T.height,o.pixelRatio=T.pixelRatio,o.sps=[e.data],o.duration=s._duration;var C=e.data.subarray(1,4),R="avc1.";for(r=0;r<3;r++){var I=C[r].toString(16);I.length<2&&(I="0"+I),R+=I}o.codec=R}break;case 8:i=!0,o.pps||(o.pps=[e.data]);break;case 9:i=!1,o.audFound=!0,c&&u(c,o),c=s.avcSample=d(!1,t.pts,t.dts,"");break;case 12:i=!1;break;default:i=!1,c&&(c.debug+="unknown NAL "+e.type+" ")}c&&i&&c.units.push(e)})),e&&c&&(u(c,o),this.avcSample=null)},e._insertSampleInOrder=function(t,e){var n=t.length;if(n>0){if(e.pts>=t[n-1].pts)t.push(e);else for(var i=n-1;i>=0;i--)if(e.pts<t[i].pts){t.splice(i,0,e);break}}else t.push(e)},e._getLastNalUnit=function(){var t,e=this.avcSample;if(!e||0===e.units.length){var n=this._avcTrack.samples;e=n[n.length-1]}if(e){var i=e.units;t=i[i.length-1]}return t},e._parseAVCNALu=function(t){var e,n,i,r,s=0,o=t.byteLength,a=this._avcTrack,c=a.naluState||0,l=c,u=[],d=-1;for(-1===c&&(d=0,r=31&t[0],c=0,s=1);s<o;)if(e=t[s++],c)if(1!==c)if(e)if(1===e){if(d>=0)i={data:t.subarray(d,s-c-1),type:r},u.push(i);else{var h=this._getLastNalUnit();if(h&&(l&&s<=4-l&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-l)),(n=s-c-1)>0)){var A=new Uint8Array(h.data.byteLength+n);A.set(h.data,0),A.set(t.subarray(0,n),h.data.byteLength),h.data=A}}s<o?(d=s,r=31&t[s],c=0):c=-1}else c=0;else c=3;else c=e?0:2;else c=e?0:1;if(d>=0&&c>=0&&(i={data:t.subarray(d,o),type:r,state:c},u.push(i)),0===u.length){var p=this._getLastNalUnit();if(p){var f=new Uint8Array(p.data.byteLength+t.byteLength);f.set(p.data,0),f.set(t,p.data.byteLength),p.data=f}}return a.naluState=c,u},e.discardEPB=function(t){for(var e,n,i=t.byteLength,r=[],s=1;s<i-2;)0===t[s]&&0===t[s+1]&&3===t[s+2]?(r.push(s+2),s+=2):s++;if(0===r.length)return t;e=i-r.length,n=new Uint8Array(e);var o=0;for(s=0;s<e;o++,s++)o===r[0]&&(o++,r.shift()),n[s]=t[o];return n},e._parseAACPES=function(t){var e,n,s,o,c,l,u,d=this._audioTrack,A=t.data,g=t.pts,v=this.aacOverFlow,y=this.aacLastPTS;if(v){var _=new Uint8Array(v.byteLength+A.byteLength);_.set(v,0),_.set(A,v.byteLength),A=_}for(s=0,c=A.length;s<c-1&&!h(A,s);s++);if(s&&(s<c-1?(l="AAC PES did not start with ADTS header,offset:"+s,u=!1):(l="no ADTS header found in AAC PES",u=!0),a.logger.warn("parsing error:"+l),this.observer.trigger(i.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:u,reason:l}),u))return;if(p(d,this.observer,A,s,this.audioCodec),n=0,e=f(d.samplerate),v&&y){var b=y+e;Math.abs(b-g)>1&&(a.logger.log("AAC: align PTS for overlapping frames by "+Math.round((b-g)/90)),g=b)}for(;s<c;){if(h(A,s)){if(s+5<c){var E=m(d,A,s,g,n);if(E){s+=E.length,o=E.sample.pts,n++;continue}}break}s++}v=s<c?A.subarray(s,c):null,this.aacOverFlow=v,this.aacLastPTS=o},e._parseMPEGPES=function(t){for(var e=t.data,n=e.length,i=0,r=0,s=t.pts;r<n;)if(b.isHeader(e,r)){var o=b.appendFrame(this._audioTrack,e,r,s,i);if(!o)break;r+=o.length,i++}else r++},e._parseID3PES=function(t){this._id3Track.samples.push(t)},t}(),C=function(){function t(t,e,n){this.observer=t,this.config=n,this.remuxer=e}var e=t.prototype;return e.resetInitSegment=function(t,e,n,i){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:e,duration:i,inputTimeScale:9e4}},e.resetTimeStamp=function(){},t.probe=function(t){var e,n,i=g.default.getID3Data(t,0);if(i&&void 0!==g.default.getTimeStamp(i))for(e=i.length,n=Math.min(t.length-1,e+100);e<n;e++)if(b.probe(t,e))return a.logger.log("MPEG Audio sync word found !"),!0;return!1},e.append=function(t,e,n,i){for(var r=g.default.getID3Data(t,0)||[],s=g.default.getTimeStamp(r),o=void 0!==s?90*s:9e4*e,a=r.length,c=t.length,l=0,u=0,d=this._audioTrack,h=[{pts:o,dts:o,data:r}];a<c;)if(b.isHeader(t,a)){var A=b.appendFrame(d,t,a,o,l);if(!A)break;a+=A.length,u=A.sample.pts,l++}else g.default.isHeader(t,a)?(r=g.default.getID3Data(t,a),h.push({pts:u,dts:u,data:r}),a+=r.length):a++;this.remuxer.remux(d,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},e,n,i)},e.destroy=function(){},t}(),R=function(){function t(){}return t.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},t}(),I=Math.pow(2,32)-1,x=function(){function t(){}return t.init=function(){var e;for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:i};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=s,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,o,c,o,a),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,r))},t.box=function(t){for(var e,n=Array.prototype.slice.call(arguments,1),i=8,r=n.length,s=r;r--;)i+=n[r].byteLength;for((e=new Uint8Array(i))[0]=i>>24&255,e[1]=i>>16&255,e[2]=i>>8&255,e[3]=255&i,e.set(t,4),r=0,i=8;r<s;r++)e.set(n[r],i),i+=n[r].byteLength;return e},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,n){n*=e;var i=Math.floor(n/(I+1)),r=Math.floor(n%(I+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,n,i){return t.box(t.types.moof,t.mfhd(e),t.traf(i,n))},t.moov=function(e){for(var n=e.length,i=[];n--;)i[n]=t.trak(e[n]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(i).concat(t.mvex(e)))},t.mvex=function(e){for(var n=e.length,i=[];n--;)i[n]=t.trex(e[n]);return t.box.apply(null,[t.types.mvex].concat(i))},t.mvhd=function(e,n){n*=e;var i=Math.floor(n/(I+1)),r=Math.floor(n%(I+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,s)},t.sdtp=function(e){var n,i,r=e.samples||[],s=new Uint8Array(4+r.length);for(i=0;i<r.length;i++)n=r[i].flags,s[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,s)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var n,i,r,s=[],o=[];for(n=0;n<e.sps.length;n++)r=(i=e.sps[n]).byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(i));for(n=0;n<e.pps.length;n++)r=(i=e.pps[n]).byteLength,o.push(r>>>8&255),o.push(255&r),o=o.concat(Array.prototype.slice.call(i));var a=t.box(t.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|e.sps.length].concat(s).concat([e.pps.length]).concat(o))),c=e.width,l=e.height,u=e.pixelRatio[0],d=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,l>>8&255,255&l,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,255&u,d>>24,d>>16&255,d>>8&255,255&d])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var n=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var n=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var n=e.id,i=e.duration*e.timescale,r=e.width,s=e.height,o=Math.floor(i/(I+1)),a=Math.floor(i%(I+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,s>>8&255,255&s,0,0]))},t.traf=function(e,n){var i=t.sdtp(e),r=e.id,s=Math.floor(n/(I+1)),o=Math.floor(n%(I+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o])),t.trun(e,i.length+16+20+8+16+8+8),i)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var n=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,n){var i,r,s,o,a,c,l=e.samples||[],u=l.length,d=12+16*u,h=new Uint8Array(d);for(n+=8+d,h.set([0,0,15,1,u>>>24&255,u>>>16&255,u>>>8&255,255&u,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),i=0;i<u;i++)s=(r=l[i]).duration,o=r.size,a=r.flags,c=r.cts,h.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,o>>>24&255,o>>>16&255,o>>>8&255,255&o,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*i);return t.box(t.types.trun,h)},t.initSegment=function(e){t.types||t.init();var n,i=t.moov(e);return(n=new Uint8Array(t.FTYP.byteLength+i.byteLength)).set(t.FTYP),n.set(i,t.FTYP.byteLength),n},t}(),O=x;function L(t,e,n,i){void 0===n&&(n=1),void 0===i&&(i=!1);var r=t*e*n;return i?Math.round(r):r}function M(t,e){return void 0===e&&(e=!1),L(t,1e3,1/9e4,e)}function k(t,e){return void 0===e&&(e=1),L(t,9e4,1/e)}var N=k(10),P=k(.2),D=null;function B(t,e){var n;if(void 0===e)return t;for(n=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=n;return t}var U,F=function(){function t(t,e,n,i){if(this.observer=t,this.config=e,this.typeSupported=n,this.ISGenerated=!1,null===D){var r=navigator.userAgent.match(/Chrome\/(\d+)/i);D=r?parseInt(r[1]):0}}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){this._initPTS=this._initDTS=t},e.resetInitSegment=function(){this.ISGenerated=!1},e.getVideoStartPts=function(t){var e=!1,n=t.reduce((function(t,n){var i=n.pts-t;return i<-4294967296?(e=!0,t):i>0?t:n.pts}),t[0].pts);return e&&a.logger.debug("PTS rollover detected"),n},e.remux=function(t,e,n,r,s,o,c){if(this.ISGenerated||this.generateIS(t,e,s),this.ISGenerated){var l=t.samples.length,u=e.samples.length,d=s,h=s;if(l&&u){var A=this.getVideoStartPts(e.samples),p=(t.samples[0].pts-A)/e.inputTimeScale;d+=Math.max(0,p),h+=Math.max(0,-p)}if(l){t.timescale||(a.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(t,e,s));var f,m=this.remuxAudio(t,d,o,c);if(u)m&&(f=m.endPTS-m.startPTS),e.timescale||(a.logger.warn("regenerate InitSegment as video detected"),this.generateIS(t,e,s)),this.remuxVideo(e,h,o,f)}else if(u){var g=this.remuxVideo(e,h,o,0,c);g&&t.codec&&this.remuxEmptyAudio(t,d,o,g)}}n.samples.length&&this.remuxID3(n,s),r.samples.length&&this.remuxText(r,s),this.observer.trigger(i.default.FRAG_PARSED)},e.generateIS=function(t,e,n){var s,o,c=this.observer,l=t.samples,u=e.samples,d=this.typeSupported,h="audio/mp4",A={},p={tracks:A},f=void 0===this._initPTS;if(f&&(s=o=1/0),t.config&&l.length&&(t.timescale=t.samplerate,a.logger.log("audio sampling rate : "+t.samplerate),t.isAAC||(d.mpeg?(h="audio/mpeg",t.codec=""):d.mp3&&(t.codec="mp3")),A.audio={container:h,codec:t.codec,initSegment:!t.isAAC&&d.mpeg?new Uint8Array:O.initSegment([t]),metadata:{channelCount:t.channelCount}},f&&(s=o=l[0].pts-Math.round(t.inputTimeScale*n))),e.sps&&e.pps&&u.length){var m=e.inputTimeScale;if(e.timescale=m,A.video={container:"video/mp4",codec:e.codec,initSegment:O.initSegment([e]),metadata:{width:e.width,height:e.height}},f){var g=this.getVideoStartPts(u),v=Math.round(m*n);o=Math.min(o,u[0].dts-v),s=Math.min(s,g-v),this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:s})}}else f&&A.audio&&this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:s});Object.keys(A).length?(c.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,f&&(this._initPTS=s,this._initDTS=o)):c.trigger(i.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},e.remuxVideo=function(t,e,n,s){var o,c,l,u,d,h=t.timescale,A=t.samples,p=[],f=A.length,m=this._initPTS,g=8,v=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,_=0,b=!1,E=this.nextAvcDts;if(0!==f){if(!n)E=e*h-(A[0].pts-B(A[0].dts,A[0].pts));for(var w=0;w<f;w++){var S=A[w];S.pts=B(S.pts-m,E),S.dts=B(S.dts-m,E),S.dts>S.pts&&(_=Math.max(Math.min(_,S.pts-S.dts),-1*P)),S.dts<A[w>0?w-1:w].dts&&(b=!0)}b&&A.sort((function(t,e){var n=t.dts-e.dts,i=t.pts-e.pts;return n||i||t.id-e.id})),u=A[0].dts,d=A[f-1].dts;var T=Math.round((d-u)/(f-1));if(_<0){if(_<-2*T){a.logger.warn("PTS < DTS detected in video samples, offsetting DTS to PTS "+M(-T,!0)+" ms");for(var C=0;C<f;C++)A[C].dts=A[C].pts-T}else{a.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+M(_,!0)+" ms to overcome this issue");for(var R=0;R<f;R++)A[R].dts=A[R].dts+_}u=A[0].dts,d=A[f-1].dts}if(n){var I=u-E,x=I>T;if(x||I<-1){x?a.logger.warn("AVC: "+M(I,!0)+" ms ("+I+"dts) hole between fragments detected, filling it"):a.logger.warn("AVC: "+M(-I,!0)+" ms ("+I+"dts) overlapping between fragments detected"),u=E;var L=A[0].pts-I;A[0].dts=u,A[0].pts=L,a.logger.log("Video: First PTS/DTS adjusted: "+M(L,!0)+"/"+M(u,!0)+", delta: "+M(I,!0)+" ms")}}D&&D<75&&(u=Math.max(0,u));for(var k=0,N=0,U=0;U<f;U++){for(var F=A[U],H=F.units,V=H.length,j=0,G=0;G<V;G++)j+=H[G].data.length;N+=j,k+=V,F.length=j,F.dts=Math.max(F.dts,u),F.pts=Math.max(F.pts,F.dts,0),v=Math.min(F.pts,v),y=Math.max(F.pts,y)}d=A[f-1].dts;var Q=N+4*k+8;try{c=new Uint8Array(Q)}catch(t){return void this.observer.trigger(i.default.ERROR,{type:r.ErrorTypes.MUX_ERROR,details:r.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Q,reason:"fail allocating video mdat "+Q})}var z=new DataView(c.buffer);z.setUint32(0,Q),c.set(O.types.mdat,4);for(var W=0;W<f;W++){for(var K,q=A[W],Y=q.units,$=0,X=0,J=Y.length;X<J;X++){var Z=Y[X],tt=Z.data,et=Z.data.byteLength;z.setUint32(g,et),g+=4,c.set(tt,g),g+=et,$+=4+et}if(W<f-1)o=A[W+1].dts-q.dts;else{var nt=this.config,it=q.dts-A[W>0?W-1:W].dts;if(nt.stretchShortVideoTrack){var rt=nt.maxBufferHole,st=Math.floor(rt*h),ot=(s?v+s*h:this.nextAudioPts)-q.pts;ot>st?((o=ot-it)<0&&(o=it),a.logger.log("It is approximately "+M(ot,!1)+" ms to the next segment; using duration "+M(o,!1)+" ms for the last video frame.")):o=it}else o=it}K=Math.round(q.pts-q.dts),p.push({size:$,duration:o,cts:K,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:q.key?2:1,isNonSync:q.key?0:1}})}this.nextAvcDts=d+o;var at=t.dropped;if(t.nbNalu=0,t.dropped=0,p.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ct=p[0].flags;ct.dependsOn=2,ct.isNonSync=0}t.samples=p,l=O.moof(t.sequenceNumber++,u,t),t.samples=[];var lt={data1:l,data2:c,startPTS:v/h,endPTS:(y+o)/h,startDTS:u/h,endDTS:this.nextAvcDts/h,type:"video",hasAudio:!1,hasVideo:!0,nb:p.length,dropped:at};return this.observer.trigger(i.default.FRAG_PARSING_DATA,lt),lt}},e.remuxAudio=function(t,e,n,s){var o,c,l,u,d,h,A=t.inputTimeScale,p=t.timescale,f=A/p,m=(t.isAAC?1024:1152)*f,g=this._initPTS,v=!t.isAAC&&this.typeSupported.mpeg,y=v?0:8,_=t.samples,b=[],E=this.nextAudioPts;if(n|=_.length&&E&&(s&&Math.abs(e-E/A)<.1||Math.abs(_[0].pts-E-g)<20*m),_.forEach((function(t){t.pts=t.dts=B(t.pts-g,e*A)})),_=_.filter((function(t){return t.pts>=0})),0!==_.length){if(n||(E=s?Math.max(0,e*A):_[0].pts),t.isAAC)for(var w=this.config.maxAudioFramesDrift,S=0,T=E;S<_.length;){var C=_[S],I=C.pts,x=I-T;if(x<=-w*m)n||S>0?(a.logger.warn("Dropping 1 audio frame @ "+M(T,!0)/1e3+"s due to "+M(x,!0)+" ms overlap."),_.splice(S,1)):(a.logger.warn("Audio frame @ "+M(I,!0)/1e3+"s overlaps nextAudioPts by "+M(x,!0)+" ms."),T=I+m,S++);else if(x>=w*m&&x<N&&T){var L=Math.round(x/m);a.logger.warn("Injecting "+L+" audio frames @ "+M(T,!0)/1e3+"s due to "+M(x,!0)+" ms gap.");for(var k=0;k<L;k++){var P=Math.max(T,0);(c=R.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(a.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),c=C.unit.subarray()),_.splice(S,0,{unit:c,pts:P,dts:P}),T+=m,S++}C.pts=C.dts=T,T+=m,S++}else Math.abs(x),C.pts=C.dts=T,T+=m,S++}for(var D=_.length,U=0;D--;)U+=_[D].unit.byteLength;for(var F=0,H=_.length;F<H;F++){var V=_[F],j=V.unit,G=V.pts;if(void 0!==h&&o)o.duration=Math.round((G-h)/f);else{var Q=G-E,z=0;if(n&&t.isAAC&&Q){if(Q>0&&Q<N)z=Math.round((G-E)/m),a.logger.log(M(Q,!0)+" ms hole between AAC samples detected,filling it"),z>0&&((c=R.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(c=j.subarray()),U+=z*c.length);else if(Q<-12){a.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+M(E,!0)+" ms / "+M(G,!0)+" ms / "+M(-Q,!0)+" ms"),U-=j.byteLength;continue}G=E}if(d=G,!(U>0))return;U+=y;try{l=new Uint8Array(U)}catch(t){return void this.observer.trigger(i.default.ERROR,{type:r.ErrorTypes.MUX_ERROR,details:r.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating audio mdat "+U})}v||(new DataView(l.buffer).setUint32(0,U),l.set(O.types.mdat,4));for(var W=0;W<z;W++)(c=R.getSilentFrame(t.manifestCodec||t.codec,t.channelCount))||(a.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),c=j.subarray()),l.set(c,y),y+=c.byteLength,o={size:c.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(o)}l.set(j,y);var K=j.byteLength;y+=K,o={size:K,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},b.push(o),h=G}var q=0;if((D=b.length)>=2&&(q=b[D-2].duration,o.duration=q),D){this.nextAudioPts=E=h+f*q,t.samples=b,u=v?new Uint8Array:O.moof(t.sequenceNumber++,d/f,t),t.samples=[];var Y=d/A,$=E/A,X={data1:u,data2:l,startPTS:Y,endPTS:$,startDTS:Y,endDTS:$,type:"audio",hasAudio:!0,hasVideo:!1,nb:D};return this.observer.trigger(i.default.FRAG_PARSING_DATA,X),X}return null}},e.remuxEmptyAudio=function(t,e,n,i){var r=t.inputTimeScale,s=r/(t.samplerate?t.samplerate:r),o=this.nextAudioPts,c=(void 0!==o?o:i.startDTS*r)+this._initDTS,l=i.endDTS*r+this._initDTS,u=1024*s,d=Math.ceil((l-c)/u),h=R.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(a.logger.warn("remux empty Audio"),h){for(var A=[],p=0;p<d;p++){var f=c+p*u;A.push({unit:h,pts:f,dts:f})}t.samples=A,this.remuxAudio(t,e,n)}else a.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},e.remuxID3=function(t,e){var n=t.samples.length;if(n){for(var r=t.inputTimeScale,s=this._initPTS,o=this._initDTS,a=0;a<n;a++){var c=t.samples[a];c.pts=B(c.pts-s,e*r)/r,c.dts=B(c.dts-o,e*r)/r}this.observer.trigger(i.default.FRAG_PARSING_METADATA,{samples:t.samples}),t.samples=[]}},e.remuxText=function(t,e){var n=t.samples.length,r=t.inputTimeScale,s=this._initPTS;if(n){for(var o=0;o<n;o++){var a=t.samples[o];a.pts=B(a.pts-s,e*r)/r}t.samples.sort((function(t,e){return t.pts-e.pts})),this.observer.trigger(i.default.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[]},t}(),H=function(){function t(t){this.observer=t}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(){},e.resetInitSegment=function(){},e.remux=function(t,e,n,r,s,o,a,c){var l=this.observer,u="";t&&(u+="audio"),e&&(u+="video"),l.trigger(i.default.FRAG_PARSING_DATA,{data1:c,startPTS:s,startDTS:s,type:u,hasAudio:!!t,hasVideo:!!e,nb:1,dropped:0}),l.trigger(i.default.FRAG_PARSED)},t}(),V=Object(c.getSelfScope)();try{U=V.performance.now.bind(V.performance)}catch(t){a.logger.debug("Unable to use Performance API on this environment"),U=V.Date.now}var j=function(){function t(t,e,n,i){this.observer=t,this.typeSupported=e,this.config=n,this.vendor=i}var e=t.prototype;return e.destroy=function(){var t=this.demuxer;t&&t.destroy()},e.push=function(t,e,n,r,o,a,c,l,u,d,h,A){var p=this;if(t.byteLength>0&&null!=e&&null!=e.key&&"AES-128"===e.method){var f=this.decrypter;null==f&&(f=this.decrypter=new s.default(this.observer,this.config));var m=U();f.decrypt(t,e.key.buffer,e.iv.buffer,(function(t){var s=U();p.observer.trigger(i.default.FRAG_DECRYPTED,{stats:{tstart:m,tdecrypt:s}}),p.pushDecrypted(new Uint8Array(t),e,new Uint8Array(n),r,o,a,c,l,u,d,h,A)}))}else this.pushDecrypted(new Uint8Array(t),e,new Uint8Array(n),r,o,a,c,l,u,d,h,A)},e.pushDecrypted=function(t,e,n,s,o,a,c,l,u,d,h,A){var p=this.demuxer,f=this.remuxer;if(!p||c||l){for(var m,g=this.observer,_=this.typeSupported,b=this.config,E=[{demux:T,remux:F},{demux:y.default,remux:H},{demux:v,remux:F},{demux:C,remux:F}],w=0,S=E.length;w<S&&!(m=E[w]).demux.probe(t);w++);if(!m)return void g.trigger(i.default.ERROR,{type:r.ErrorTypes.MEDIA_ERROR,details:r.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});f&&f instanceof m.remux||(f=new m.remux(g,b,_,this.vendor)),p&&p instanceof m.demux||(p=new m.demux(g,f,b,_),this.probe=m.demux.probe),this.demuxer=p,this.remuxer=f}(c||l)&&(p.resetInitSegment(n,s,o,d),f.resetInitSegment()),c&&(p.resetTimeStamp(A),f.resetTimeStamp(A)),"function"==typeof p.setDecryptData&&p.setDecryptData(e),p.append(t,a,u,h)},t}();e.default=j},"./src/demux/demuxer-worker.js":
/*!*************************************!*\
  !*** ./src/demux/demuxer-worker.js ***!
  \*************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Module is referenced from these modules with unsupported syntax: ./src/demux/demuxer.js (referenced with require.resolve) */function(t,e,n){n.r(e);var i=n(/*! ../demux/demuxer-inline */"./src/demux/demuxer-inline.js"),r=n(/*! ../events */"./src/events.js"),s=n(/*! ../utils/logger */"./src/utils/logger.js"),o=n(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");e.default=function(t){var e=new o.EventEmitter;e.trigger=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.emit.apply(e,[t,t].concat(i))},e.off=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.removeListener.apply(e,[t].concat(i))};var n=function(e,n){t.postMessage({event:e,data:n})};t.addEventListener("message",(function(r){var o=r.data;switch(o.cmd){case"init":var a=JSON.parse(o.config);t.demuxer=new i.default(e,o.typeSupported,a,o.vendor),Object(s.enableLogs)(a.debug),n("init",null);break;case"demux":t.demuxer.push(o.data,o.decryptdata,o.initSegment,o.audioCodec,o.videoCodec,o.timeOffset,o.discontinuity,o.trackSwitch,o.contiguous,o.duration,o.accurateTimeOffset,o.defaultInitPTS)}})),e.on(r.default.FRAG_DECRYPTED,n),e.on(r.default.FRAG_PARSING_INIT_SEGMENT,n),e.on(r.default.FRAG_PARSED,n),e.on(r.default.ERROR,n),e.on(r.default.FRAG_PARSING_METADATA,n),e.on(r.default.FRAG_PARSING_USERDATA,n),e.on(r.default.INIT_PTS_FOUND,n),e.on(r.default.FRAG_PARSING_DATA,(function(e,n){var i=[],r={event:e,data:n};n.data1&&(r.data1=n.data1.buffer,i.push(n.data1.buffer),delete n.data1),n.data2&&(r.data2=n.data2.buffer,i.push(n.data2.buffer),delete n.data2),t.postMessage(r,i)}))}},"./src/demux/id3.js":
/*!**************************!*\
  !*** ./src/demux/id3.js ***!
  \**************************/
/*! exports provided: default, utf8ArrayToStr */function(t,e,n){n.r(e),n.d(e,"utf8ArrayToStr",(function(){return a}));var i,r=n(/*! ../utils/get-self-scope */"./src/utils/get-self-scope.js"),s=function(){function t(){}return t.isHeader=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.isFooter=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},t.getID3Data=function(e,n){for(var i=n,r=0;t.isHeader(e,n);){r+=10,r+=t._readSize(e,n+6),t.isFooter(e,n+10)&&(r+=10),n+=r}if(r>0)return e.subarray(i,i+r)},t._readSize=function(t,e){var n=0;return n=(127&t[e])<<21,n|=(127&t[e+1])<<14,n|=(127&t[e+2])<<7,n|=127&t[e+3]},t.getTimeStamp=function(e){for(var n=t.getID3Frames(e),i=0;i<n.length;i++){var r=n[i];if(t.isTimeStampFrame(r))return t._readTimeStamp(r)}},t.isTimeStampFrame=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},t._getFrameData=function(e){var n=String.fromCharCode(e[0],e[1],e[2],e[3]),i=t._readSize(e,4);return{type:n,size:i,data:e.subarray(10,10+i)}},t.getID3Frames=function(e){for(var n=0,i=[];t.isHeader(e,n);){for(var r=t._readSize(e,n+6),s=(n+=10)+r;n+8<s;){var o=t._getFrameData(e.subarray(n)),a=t._decodeFrame(o);a&&i.push(a),n+=o.size+10}t.isFooter(e,n)&&(n+=10)}return i},t._decodeFrame=function(e){return"PRIV"===e.type?t._decodePrivFrame(e):"T"===e.type[0]?t._decodeTextFrame(e):"W"===e.type[0]?t._decodeURLFrame(e):void 0},t._readTimeStamp=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),n=1&e[3],i=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return i/=45,n&&(i+=47721858.84),Math.round(i)}},t._decodePrivFrame=function(e){if(!(e.size<2)){var n=t._utf8ArrayToStr(e.data,!0),i=new Uint8Array(e.data.subarray(n.length+1));return{key:e.type,info:n,data:i.buffer}}},t._decodeTextFrame=function(e){if(!(e.size<2)){if("TXXX"===e.type){var n=1,i=t._utf8ArrayToStr(e.data.subarray(n),!0);n+=i.length+1;var r=t._utf8ArrayToStr(e.data.subarray(n));return{key:e.type,info:i,data:r}}var s=t._utf8ArrayToStr(e.data.subarray(1));return{key:e.type,data:s}}},t._decodeURLFrame=function(e){if("WXXX"===e.type){if(e.size<2)return;var n=1,i=t._utf8ArrayToStr(e.data.subarray(n),!0);n+=i.length+1;var r=t._utf8ArrayToStr(e.data.subarray(n));return{key:e.type,info:i,data:r}}var s=t._utf8ArrayToStr(e.data);return{key:e.type,data:s}},t._utf8ArrayToStr=function(t,e){void 0===e&&(e=!1);var n=o();if(n){var i=n.decode(t);if(e){var r=i.indexOf("\0");return-1!==r?i.substring(0,r):i}return i.replace(/\0/g,"")}for(var s,a,c,l=t.length,u="",d=0;d<l;){if(0===(s=t[d++])&&e)return u;if(0!==s&&3!==s)switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(s);break;case 12:case 13:a=t[d++],u+=String.fromCharCode((31&s)<<6|63&a);break;case 14:a=t[d++],c=t[d++],u+=String.fromCharCode((15&s)<<12|(63&a)<<6|(63&c)<<0)}}return u},t}();function o(){var t=Object(r.getSelfScope)();return i||void 0===t.TextDecoder||(i=new t.TextDecoder("utf-8")),i}var a=s._utf8ArrayToStr;e.default=s},"./src/demux/mp4demuxer.js":
/*!*********************************!*\
  !*** ./src/demux/mp4demuxer.js ***!
  \*********************************/
/*! exports provided: default */function(t,e,n){n.r(e);var i=n(/*! ../utils/logger */"./src/utils/logger.js"),r=n(/*! ../events */"./src/events.js"),s=Math.pow(2,32)-1,o=function(){function t(t,e){this.observer=t,this.remuxer=e}var e=t.prototype;return e.resetTimeStamp=function(t){this.initPTS=t},e.resetInitSegment=function(e,n,i,s){if(e&&e.byteLength){var o=this.initData=t.parseInitSegment(e);null==n&&(n="mp4a.40.5"),null==i&&(i="avc1.42e01e");var a={};o.audio&&o.video?a.audiovideo={container:"video/mp4",codec:n+","+i,initSegment:s?e:null}:(o.audio&&(a.audio={container:"audio/mp4",codec:n,initSegment:s?e:null}),o.video&&(a.video={container:"video/mp4",codec:i,initSegment:s?e:null})),this.observer.trigger(r.default.FRAG_PARSING_INIT_SEGMENT,{tracks:a})}else n&&(this.audioCodec=n),i&&(this.videoCodec=i)},t.probe=function(e){return t.findBox({data:e,start:0,end:Math.min(e.length,16384)},["moof"]).length>0},t.bin2str=function(t){return String.fromCharCode.apply(null,t)},t.readUint16=function(t,e){t.data&&(e+=t.start,t=t.data);var n=t[e]<<8|t[e+1];return n<0?65536+n:n},t.readUint32=function(t,e){t.data&&(e+=t.start,t=t.data);var n=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return n<0?4294967296+n:n},t.writeUint32=function(t,e,n){t.data&&(e+=t.start,t=t.data),t[e]=n>>24,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n},t.findBox=function(e,n){var i,r,s,o,a,c,l=[];if(e.data?(a=e.start,s=e.end,e=e.data):(a=0,s=e.byteLength),!n.length)return null;for(i=a;i<s;)c=(r=t.readUint32(e,i))>1?i+r:s,t.bin2str(e.subarray(i+4,i+8))===n[0]&&(1===n.length?l.push({data:e,start:i+8,end:c}):(o=t.findBox({data:e,start:i+8,end:c},n.slice(1))).length&&(l=l.concat(o))),i=c;return l},t.parseSegmentIndex=function(e){var n,i=t.findBox(e,["moov"])[0],r=i?i.end:null,s=0,o=t.findBox(e,["sidx"]);if(!o||!o[0])return null;n=[];var a=(o=o[0]).data[0];s=0===a?8:16;var c=t.readUint32(o,s);s+=4;s+=0===a?8:16,s+=2;var l=o.end+0,u=t.readUint16(o,s);s+=2;for(var d=0;d<u;d++){var h=s,A=t.readUint32(o,h);h+=4;var p=2147483647&A;if(1===(2147483648&A)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var f=t.readUint32(o,h);h+=4,n.push({referenceSize:p,subsegmentDuration:f,info:{duration:f/c,start:l,end:l+p-1}}),l+=p,s=h+=4}return{earliestPresentationTime:0,timescale:c,version:a,referencesCount:u,references:n,moovEndOffset:r}},t.parseInitSegment=function(e){var n=[];return t.findBox(e,["moov","trak"]).forEach((function(e){var r=t.findBox(e,["tkhd"])[0];if(r){var s=r.data[r.start],o=0===s?12:20,a=t.readUint32(r,o),c=t.findBox(e,["mdia","mdhd"])[0];if(c){o=0===(s=c.data[c.start])?12:20;var l=t.readUint32(c,o),u=t.findBox(e,["mdia","hdlr"])[0];if(u){var d={soun:"audio",vide:"video"}[t.bin2str(u.data.subarray(u.start+8,u.start+12))];if(d){var h=t.findBox(e,["mdia","minf","stbl","stsd"]);if(h.length){h=h[0];var A=t.bin2str(h.data.subarray(h.start+12,h.start+16));i.logger.log("MP4Demuxer:"+d+":"+A+" found")}n[a]={timescale:l,type:d},n[d]={timescale:l,id:a}}}}}})),n},t.getStartDTS=function(e,n){var i,r,s;return i=t.findBox(n,["moof","traf"]),r=[].concat.apply([],i.map((function(n){return t.findBox(n,["tfhd"]).map((function(i){var r,s,o;return r=t.readUint32(i,4),s=e[r].timescale||9e4,o=t.findBox(n,["tfdt"]).map((function(e){var n,i;return n=e.data[e.start],i=t.readUint32(e,4),1===n&&(i*=Math.pow(2,32),i+=t.readUint32(e,8)),i}))[0],o/s}))}))),s=Math.min.apply(null,r),isFinite(s)?s:0},t.offsetStartDTS=function(e,n,i){t.findBox(n,["moof","traf"]).map((function(n){return t.findBox(n,["tfhd"]).map((function(r){var o=t.readUint32(r,4),a=e[o].timescale||9e4;t.findBox(n,["tfdt"]).map((function(e){var n=e.data[e.start],r=t.readUint32(e,4);if(0===n)t.writeUint32(e,4,r-i*a);else{r*=Math.pow(2,32),r+=t.readUint32(e,8),r-=i*a,r=Math.max(r,0);var o=Math.floor(r/(s+1)),c=Math.floor(r%(s+1));t.writeUint32(e,4,o),t.writeUint32(e,8,c)}}))}))}))},e.append=function(e,n,i,s){var o=this.initData;o||(this.resetInitSegment(e,this.audioCodec,this.videoCodec,!1),o=this.initData);var a,c=this.initPTS;if(void 0===c){var l=t.getStartDTS(o,e);this.initPTS=c=l-n,this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:c})}t.offsetStartDTS(o,e,c),a=t.getStartDTS(o,e),this.remuxer.remux(o.audio,o.video,null,null,a,i,s,e)},e.destroy=function(){},t}();e.default=o},"./src/errors.ts":
/*!***********************!*\
  !*** ./src/errors.ts ***!
  \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(t,e,n){var i,r;n.r(e),n.d(e,"ErrorTypes",(function(){return i})),n.d(e,"ErrorDetails",(function(){return r})),function(t){t.NETWORK_ERROR="networkError",t.MEDIA_ERROR="mediaError",t.KEY_SYSTEM_ERROR="keySystemError",t.MUX_ERROR="muxError",t.OTHER_ERROR="otherError"}(i||(i={})),function(t){t.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",t.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",t.KEY_SYSTEM_NO_SESSION="keySystemNoSession",t.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",t.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",t.MANIFEST_LOAD_ERROR="manifestLoadError",t.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",t.MANIFEST_PARSING_ERROR="manifestParsingError",t.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",t.LEVEL_EMPTY_ERROR="levelEmptyError",t.LEVEL_LOAD_ERROR="levelLoadError",t.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",t.LEVEL_SWITCH_ERROR="levelSwitchError",t.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",t.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",t.FRAG_LOAD_ERROR="fragLoadError",t.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",t.FRAG_DECRYPT_ERROR="fragDecryptError",t.FRAG_PARSING_ERROR="fragParsingError",t.REMUX_ALLOC_ERROR="remuxAllocError",t.KEY_LOAD_ERROR="keyLoadError",t.KEY_LOAD_TIMEOUT="keyLoadTimeOut",t.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",t.BUFFER_APPEND_ERROR="bufferAppendError",t.BUFFER_APPENDING_ERROR="bufferAppendingError",t.BUFFER_STALLED_ERROR="bufferStalledError",t.BUFFER_FULL_ERROR="bufferFullError",t.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",t.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",t.INTERNAL_EXCEPTION="internalException"}(r||(r={}))},"./src/events.js":
/*!***********************!*\
  !*** ./src/events.js ***!
  \***********************/
/*! exports provided: default */function(t,e,n){n.r(e);e.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":
/*!*********************************!*\
  !*** ./src/hls.ts + 50 modules ***!
  \*********************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/demuxer-inline.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/eventemitter3/index.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/url-toolkit/src/url-toolkit.js (<- Module is not an ECMAScript module) */function(t,e,n){n.r(e),n.d(e,"default",(function(){return un}));var i={};n.r(i),n.d(i,"newCue",(function(){return pe}));var r,s,o=n("./node_modules/url-toolkit/src/url-toolkit.js"),a=n("./src/errors.ts"),c=n("./src/polyfills/number.js"),l=n("./src/events.js"),u=n("./src/utils/logger.js"),d={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},h=function(){function t(t){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=t,this.onEvent=this.onEvent.bind(this);for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}var e=t.prototype;return e.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){},e.onHandlerDestroyed=function(){},e.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},e.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(t){if(d[t])throw new Error("Forbidden event-name: "+t);this.hls.on(t,this.onEvent)}),this)},e.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(t){this.hls.off(t,this.onEvent)}),this)},e.onEvent=function(t,e){this.onEventGeneric(t,e)},e.onEventGeneric=function(t,e){try{(function(t,e){var n="on"+t.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,e)}).call(this,t,e).call()}catch(e){u.logger.error("An internal error happened while handling event "+t+'. Error message: "'+e.message+'". Here is a stacktrace:',e),this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}},t}(),A=h;!function(t){t.MANIFEST="manifest",t.LEVEL="level",t.AUDIO_TRACK="audioTrack",t.SUBTITLE_TRACK="subtitleTrack"}(r||(r={})),function(t){t.MAIN="main",t.AUDIO="audio",t.SUBTITLE="subtitle"}(s||(s={}));var p=n("./src/demux/mp4demuxer.js");function f(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var m,g=function(){function t(t,e){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=t,this.reluri=e}var e,n,i;return e=t,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(o.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&f(e.prototype,n),i&&f(e,i),t}();function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}!function(t){t.AUDIO="audio",t.VIDEO="video"}(m||(m={}));var y=function(){function t(){var t;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((t={})[m.AUDIO]=!1,t[m.VIDEO]=!1,t),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var e,n,i,r=t.prototype;return r.setByteRange=function(t,e){var n=t.split("@",2),i=[];1===n.length?i[0]=e?e.byteRangeEndOffset:0:i[0]=parseInt(n[1]),i[1]=parseInt(n[0])+i[0],this._byteRange=i},r.addElementaryStream=function(t){this._elementaryStreams[t]=!0},r.hasElementaryStream=function(t){return!0===this._elementaryStreams[t]},r.createInitializationVector=function(t){for(var e=new Uint8Array(16),n=12;n<16;n++)e[n]=t>>8*(15-n)&255;return e},r.setDecryptDataFromLevelKey=function(t,e){var n=t;return(null==t?void 0:t.method)&&t.uri&&!t.iv&&((n=new g(t.baseuri,t.reluri)).method=t.method,n.iv=this.createInitializationVector(e)),n},e=t,(n=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(o.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(t){this._url=t}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var t=this.sn;"number"!=typeof t&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&u.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(c.isFiniteNumber)(this.programDateTime))return null;var t=Object(c.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&v(e.prototype,n),i&&v(e,i),t}();function _(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var b=function(){function t(t){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=t,this.version=null}var e,n,i;return e=t,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(c.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&_(e.prototype,n),i&&_(e,i),t}(),E=/^(\d+)x(\d+)$/,w=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,S=function(){function t(e){for(var n in"string"==typeof e&&(e=t.parseAttrList(e)),e)e.hasOwnProperty(n)&&(this[n]=e[n])}var e=t.prototype;return e.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var n=new Uint8Array(e.length/2),i=0;i<e.length/2;i++)n[i]=parseInt(e.slice(2*i,2*i+2),16);return n}return null},e.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.decimalFloatingPoint=function(t){return parseFloat(this[t])},e.enumeratedString=function(t){return this[t]},e.decimalResolution=function(t){var e=E.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e,n={};for(w.lastIndex=0;null!==(e=w.exec(t));){var i=e[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),n[e[1]]=i}return n},t}(),T={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function C(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}var R=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,I=/#EXT-X-MEDIA:(.*)/g,x=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),O=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,L=/\.(mp4|m4s|m4v|m4a)$/i,M=function(){function t(){}return t.findGroup=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i.id===e)return i}},t.convertAVC1ToAVCOTI=function(t){var e,n=t.split(".");return n.length>2?(e=n.shift()+".",e+=parseInt(n.shift()).toString(16),e+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):e=t,e},t.resolve=function(t,e){return o.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,n){var i,r=[],s={},o=!1;function a(t,e){["video","audio"].forEach((function(n){var i=t.filter((function(t){return function(t,e){var n=T[e];return!!n&&!0===n[t.slice(0,4)]}(t,n)}));if(i.length){var r=i.filter((function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}));e[n+"Codec"]=r.length>0?r[0]:i[0],t=t.filter((function(t){return-1===i.indexOf(t)}))}})),e.unknownCodecs=t}for(R.lastIndex=0;null!=(i=R.exec(e));)if(i[1]){var c={},l=c.attrs=new S(i[1]);c.url=t.resolve(i[2],n);var u=l.decimalResolution("RESOLUTION");u&&(c.width=u.width,c.height=u.height),c.bitrate=l.decimalInteger("AVERAGE-BANDWIDTH")||l.decimalInteger("BANDWIDTH"),c.name=l.NAME,a([].concat((l.CODECS||"").split(/[ ,]+/)),c),c.videoCodec&&-1!==c.videoCodec.indexOf("avc1")&&(c.videoCodec=t.convertAVC1ToAVCOTI(c.videoCodec)),r.push(c)}else if(i[3]){var d=new S(i[3]);d["DATA-ID"]&&(o=!0,s[d["DATA-ID"]]=d)}return{levels:r,sessionData:o?s:null}},t.parseMasterPlaylistMedia=function(e,n,i,r){var s;void 0===r&&(r=[]);var o=[],a=0;for(I.lastIndex=0;null!==(s=I.exec(e));){var c=new S(s[1]);if(c.TYPE===i){var l={attrs:c,id:a++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE,type:i,default:"YES"===c.DEFAULT,autoselect:"YES"===c.AUTOSELECT,forced:"YES"===c.FORCED,lang:c.LANGUAGE};if(c.URI&&(l.url=t.resolve(c.URI,n)),r.length){var u=t.findGroup(r,l.groupId);l.audioCodec=u?u.codec:r[0].codec}o.push(l)}}return o},t.parseLevelPlaylist=function(t,e,n,i,r){var s,o,a,l=0,d=0,h=new b(e),A=0,p=null,f=new y,m=null;for(x.lastIndex=0;null!==(s=x.exec(t));){var v=s[1];if(v){f.duration=parseFloat(v);var _=(" "+s[2]).slice(1);f.title=_||null,f.tagList.push(_?["INF",v,_]:["INF",v])}else if(s[3]){if(Object(c.isFiniteNumber)(f.duration)){var E=l++;f.type=i,f.start=d,a&&(f.levelkey=a),f.sn=E,f.level=n,f.cc=A,f.urlId=r,f.baseurl=e,f.relurl=(" "+s[3]).slice(1),k(f,p),h.fragments.push(f),p=f,d+=f.duration,f=new y}}else if(s[4]){var w=(" "+s[4]).slice(1);p?f.setByteRange(w,p):f.setByteRange(w)}else if(s[5])f.rawProgramDateTime=(" "+s[5]).slice(1),f.tagList.push(["PROGRAM-DATE-TIME",f.rawProgramDateTime]),null===m&&(m=h.fragments.length);else{if(!(s=s[0].match(O))){u.logger.warn("No matches on slow regex match for level playlist!");continue}for(o=1;o<s.length&&void 0===s[o];o++);var T=(" "+s[o+1]).slice(1),C=(" "+s[o+2]).slice(1);switch(s[o]){case"#":f.tagList.push(C?[T,C]:[T]);break;case"PLAYLIST-TYPE":h.type=T.toUpperCase();break;case"MEDIA-SEQUENCE":l=h.startSN=parseInt(T);break;case"TARGETDURATION":h.targetduration=parseFloat(T);break;case"VERSION":h.version=parseInt(T);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"DIS":A++,f.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":A=parseInt(T);break;case"KEY":var R=new S(T),I=R.enumeratedString("METHOD"),M=R.URI,N=R.hexadecimalInteger("IV");if("com.apple.streamingkeydelivery"===(R.KEYFORMAT||"identity")){u.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}I&&(a=new g(e,M),M&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(I)>=0&&(a.method=I,a.key=null,a.iv=N));break;case"START":var P=new S(T).decimalFloatingPoint("TIME-OFFSET");Object(c.isFiniteNumber)(P)&&(h.startTimeOffset=P);break;case"MAP":var D=new S(T);f.relurl=D.URI,D.BYTERANGE&&f.setByteRange(D.BYTERANGE),f.baseurl=e,f.level=n,f.type=i,f.sn="initSegment",h.initSegment=f,(f=new y).rawProgramDateTime=h.initSegment.rawProgramDateTime;break;default:u.logger.warn("line parsed but not handled: "+s)}}}return(f=p)&&!f.relurl&&(h.fragments.pop(),d-=f.duration),h.totalduration=d,h.averagetargetduration=d/h.fragments.length,h.endSN=l-1,h.startCC=h.fragments[0]?h.fragments[0].cc:0,h.endCC=A,!h.initSegment&&h.fragments.length&&h.fragments.every((function(t){return L.test(t.relurl)}))&&(u.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(f=new y).relurl=h.fragments[0].relurl,f.baseurl=e,f.level=n,f.type=i,f.sn="initSegment",h.initSegment=f,h.needSidxRanges=!0),m&&function(t,e){for(var n=t[e],i=e-1;i>=0;i--){var r=t[i];r.programDateTime=n.programDateTime-1e3*r.duration,n=r}}(h.fragments,m),h},t}();function k(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):(null==e?void 0:e.programDateTime)&&(t.programDateTime=e.endProgramDateTime),Object(c.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}var N=window.performance,P=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.MANIFEST_LOADING,l.default.LEVEL_LOADING,l.default.AUDIO_TRACK_LOADING,l.default.SUBTITLE_TRACK_LOADING)||this).loaders={},n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,i.canHaveQualityLevels=function(t){return t!==r.AUDIO_TRACK&&t!==r.SUBTITLE_TRACK},i.mapContextToLevelType=function(t){switch(t.type){case r.AUDIO_TRACK:return s.AUDIO;case r.SUBTITLE_TRACK:return s.SUBTITLE;default:return s.MAIN}},i.getResponseUrl=function(t,e){var n=t.url;return void 0!==n&&0!==n.indexOf("data:")||(n=e.url),n};var o=i.prototype;return o.createInternalLoader=function(t){var e=this.hls.config,n=e.pLoader,i=e.loader,r=new(n||i)(e);return t.loader=r,this.loaders[t.type]=r,r},o.getInternalLoader=function(t){return this.loaders[t.type]},o.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},o.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},o.destroy=function(){this.destroyInternalLoaders(),t.prototype.destroy.call(this)},o.onManifestLoading=function(t){this.load({url:t.url,type:r.MANIFEST,level:0,id:null,responseType:"text"})},o.onLevelLoading=function(t){this.load({url:t.url,type:r.LEVEL,level:t.level,id:t.id,responseType:"text"})},o.onAudioTrackLoading=function(t){this.load({url:t.url,type:r.AUDIO_TRACK,level:null,id:t.id,responseType:"text"})},o.onSubtitleTrackLoading=function(t){this.load({url:t.url,type:r.SUBTITLE_TRACK,level:null,id:t.id,responseType:"text"})},o.load=function(t){var e=this.hls.config;u.logger.debug("Loading playlist of type "+t.type+", level: "+t.level+", id: "+t.id);var n,i,s,o,a=this.getInternalLoader(t);if(a){var c=a.context;if(c&&c.url===t.url)return u.logger.trace("playlist request ongoing"),!1;u.logger.warn("aborting previous loader for type: "+t.type),a.abort()}switch(t.type){case r.MANIFEST:n=e.manifestLoadingMaxRetry,i=e.manifestLoadingTimeOut,s=e.manifestLoadingRetryDelay,o=e.manifestLoadingMaxRetryTimeout;break;case r.LEVEL:n=0,o=0,s=0,i=e.levelLoadingTimeOut;break;default:n=e.levelLoadingMaxRetry,i=e.levelLoadingTimeOut,s=e.levelLoadingRetryDelay,o=e.levelLoadingMaxRetryTimeout}a=this.createInternalLoader(t);var l={timeout:i,maxRetry:n,retryDelay:s,maxRetryDelay:o},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return u.logger.debug("Calling internal loader delegate for URL: "+t.url),a.load(t,l,d),!0},o.loadsuccess=function(t,e,n,i){if(void 0===i&&(i=null),n.isSidxRequest)return this._handleSidxRequest(t,n),void this._handlePlaylistLoaded(t,e,n,i);if(this.resetInternalLoader(n.type),"string"!=typeof t.data)throw new Error('expected responseType of "text" for PlaylistLoader');var r=t.data;e.tload=N.now(),0===r.indexOf("#EXTM3U")?r.indexOf("#EXTINF:")>0||r.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(t,e,n,i):this._handleMasterPlaylist(t,e,n,i):this._handleManifestParsingError(t,n,"no EXTM3U delimiter",i)},o.loaderror=function(t,e,n){void 0===n&&(n=null),this._handleNetworkError(e,n,!1,t)},o.loadtimeout=function(t,e,n){void 0===n&&(n=null),this._handleNetworkError(e,n,!0)},o._handleMasterPlaylist=function(t,e,n,r){var s=this.hls,o=t.data,a=i.getResponseUrl(t,n),c=M.parseMasterPlaylist(o,a),d=c.levels,h=c.sessionData;if(d.length){var A=d.map((function(t){return{id:t.attrs.AUDIO,codec:t.audioCodec}})),p=M.parseMasterPlaylistMedia(o,a,"AUDIO",A),f=M.parseMasterPlaylistMedia(o,a,"SUBTITLES"),m=M.parseMasterPlaylistMedia(o,a,"CLOSED-CAPTIONS");if(p.length){var g=!1;p.forEach((function(t){t.url||(g=!0)})),!1===g&&d[0].audioCodec&&!d[0].attrs.AUDIO&&(u.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}s.trigger(l.default.MANIFEST_LOADED,{levels:d,audioTracks:p,subtitles:f,captions:m,url:a,stats:e,networkDetails:r,sessionData:h})}else this._handleManifestParsingError(t,n,"no level found in manifest",r)},o._handleTrackOrLevelPlaylist=function(t,e,n,s){var o=this.hls,u=n.id,d=n.level,h=n.type,A=i.getResponseUrl(t,n),p=Object(c.isFiniteNumber)(u)?u:0,f=Object(c.isFiniteNumber)(d)?d:p,m=i.mapContextToLevelType(n),g=M.parseLevelPlaylist(t.data,A,f,m,p);if(g.tload=e.tload,g.fragments.length){if(h===r.MANIFEST){var v={url:A,details:g};o.trigger(l.default.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:A,stats:e,networkDetails:s,sessionData:null})}if(e.tparsed=N.now(),g.needSidxRanges){var y=g.initSegment.url;this.load({url:y,isSidxRequest:!0,type:h,level:d,levelDetails:g,id:u,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else n.levelDetails=g,this._handlePlaylistLoaded(t,e,n,s)}else o.trigger(l.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:A,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},o._handleSidxRequest=function(t,e){if("string"==typeof t.data)throw new Error("sidx request must be made with responseType of array buffer");var n=p.default.parseSegmentIndex(new Uint8Array(t.data));if(n){var i=n.references,r=e.levelDetails;i.forEach((function(t,e){var n=t.info;if(r){var i=r.fragments[e];0===i.byteRange.length&&i.setByteRange(String(1+n.end-n.start)+"@"+String(n.start))}})),r&&r.initSegment.setByteRange(String(n.moovEndOffset)+"@0")}},o._handleManifestParsingError=function(t,e,n,i){this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:t.url,reason:n,networkDetails:i})},o._handleNetworkError=function(t,e,n,i){var s,o;void 0===n&&(n=!1),void 0===i&&(i=null),u.logger.info("A network error occured while loading a "+t.type+"-type playlist");var c=this.getInternalLoader(t);switch(t.type){case r.MANIFEST:s=n?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,o=!0;break;case r.LEVEL:s=n?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,o=!1;break;case r.AUDIO_TRACK:s=n?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,o=!1;break;default:o=!1}c&&(c.abort(),this.resetInternalLoader(t.type));var d={type:a.ErrorTypes.NETWORK_ERROR,details:s,fatal:o,url:t.url,loader:c,context:t,networkDetails:e};i&&(d.response=i),this.hls.trigger(l.default.ERROR,d)},o._handlePlaylistLoaded=function(t,e,n,s){var o=n.type,a=n.level,c=n.id,u=n.levelDetails;if(u&&u.targetduration)if(i.canHaveQualityLevels(n.type))this.hls.trigger(l.default.LEVEL_LOADED,{details:u,level:a||0,id:c||0,stats:e,networkDetails:s});else switch(o){case r.AUDIO_TRACK:this.hls.trigger(l.default.AUDIO_TRACK_LOADED,{details:u,id:c,stats:e,networkDetails:s});break;case r.SUBTITLE_TRACK:this.hls.trigger(l.default.SUBTITLE_TRACK_LOADED,{details:u,id:c,stats:e,networkDetails:s})}else this._handleManifestParsingError(t,n,"invalid target duration",s)},i}(A);var D=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.FRAG_LOADING)||this).loaders={},n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=i.prototype;return r.destroy=function(){var e=this.loaders;for(var n in e){var i=e[n];i&&i.destroy()}this.loaders={},t.prototype.destroy.call(this)},r.onFragLoading=function(t){var e=t.frag,n=e.type,i=this.loaders,r=this.hls.config,s=r.fLoader,o=r.loader;e.loaded=0;var a,l,d,h=i[n];h&&(u.logger.warn("abort previous fragment loader for type: "+n),h.abort()),h=i[n]=e.loader=r.fLoader?new s(r):new o(r),a={url:e.url,frag:e,responseType:"arraybuffer",progressData:!1};var A=e.byteRangeStartOffset,p=e.byteRangeEndOffset;Object(c.isFiniteNumber)(A)&&Object(c.isFiniteNumber)(p)&&(a.rangeStart=A,a.rangeEnd=p),l={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout},d={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},h.load(a,l,d)},r.loadsuccess=function(t,e,n,i){void 0===i&&(i=null);var r=t.data,s=n.frag;s.loader=void 0,this.loaders[s.type]=void 0,this.hls.trigger(l.default.FRAG_LOADED,{payload:r,frag:s,stats:e,networkDetails:i})},r.loaderror=function(t,e,n){void 0===n&&(n=null);var i=e.frag,r=i.loader;r&&r.abort(),this.loaders[i.type]=void 0,this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:e.frag,response:t,networkDetails:n})},r.loadtimeout=function(t,e,n){void 0===n&&(n=null);var i=e.frag,r=i.loader;r&&r.abort(),this.loaders[i.type]=void 0,this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e.frag,networkDetails:n})},r.loadprogress=function(t,e,n,i){void 0===i&&(i=null);var r=e.frag;r.loaded=t.loaded,this.hls.trigger(l.default.FRAG_LOAD_PROGRESS,{frag:r,stats:t,networkDetails:i})},i}(A);var B=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.KEY_LOADING)||this).loaders={},n.decryptkey=null,n.decrypturl=null,n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=i.prototype;return r.destroy=function(){for(var e in this.loaders){var n=this.loaders[e];n&&n.destroy()}this.loaders={},t.prototype.destroy.call(this)},r.onKeyLoading=function(t){var e=t.frag,n=e.type,i=this.loaders[n];if(e.decryptdata){var r=e.decryptdata.uri;if(r!==this.decrypturl||null===this.decryptkey){var s=this.hls.config;if(i&&(u.logger.warn("abort previous key loader for type:"+n),i.abort()),!r)return void u.logger.warn("key uri is falsy");e.loader=this.loaders[n]=new s.loader(s),this.decrypturl=r,this.decryptkey=null;var o={url:r,frag:e,responseType:"arraybuffer"},a={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};e.loader.load(o,a,c)}else this.decryptkey&&(e.decryptdata.key=this.decryptkey,this.hls.trigger(l.default.KEY_LOADED,{frag:e}))}else u.logger.warn("Missing decryption data on fragment in onKeyLoading")},r.loadsuccess=function(t,e,n){var i=n.frag;i.decryptdata?(this.decryptkey=i.decryptdata.key=new Uint8Array(t.data),i.loader=void 0,delete this.loaders[i.type],this.hls.trigger(l.default.KEY_LOADED,{frag:i})):u.logger.error("after key load, decryptdata unset")},r.loaderror=function(t,e){var n=e.frag,i=n.loader;i&&i.abort(),delete this.loaders[n.type],this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:t})},r.loadtimeout=function(t,e){var n=e.frag,i=n.loader;i&&i.abort(),delete this.loaders[n.type],this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},i}(A);var U="NOT_LOADED",F="APPENDING",H="PARTIAL",V="OK",j=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.BUFFER_APPENDED,l.default.FRAG_BUFFERED,l.default.FRAG_LOADED)||this).bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=e.config,n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=i.prototype;return r.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,A.prototype.destroy.call(this),t.prototype.destroy.call(this)},r.getBufferedFrag=function(t,e){var n=this.fragments,i=Object.keys(n).filter((function(i){var r=n[i];if(r.body.type!==e)return!1;if(!r.buffered)return!1;var s=r.body;return s.startPTS<=t&&t<=s.endPTS}));if(0===i.length)return null;var r=i.pop();return n[r].body},r.detectEvictedFragments=function(t,e){var n=this;Object.keys(this.fragments).forEach((function(i){var r=n.fragments[i];if(r&&r.buffered){var s=r.range[t];if(s)for(var o=s.time,a=0;a<o.length;a++){var c=o[a];if(!n.isTimeBuffered(c.startPTS,c.endPTS,e)){n.removeFragment(r.body);break}}}}))},r.detectPartialFragments=function(t){var e=this,n=this.getFragmentKey(t),i=this.fragments[n];i&&(i.buffered=!0,Object.keys(this.timeRanges).forEach((function(n){if(t.hasElementaryStream(n)){var r=e.timeRanges[n];i.range[n]=e.getBufferedTimes(t.startPTS,t.endPTS,r)}})))},r.getBufferedTimes=function(t,e,n){for(var i,r,s=[],o=!1,a=0;a<n.length;a++){if(i=n.start(a)-this.bufferPadding,r=n.end(a)+this.bufferPadding,t>=i&&e<=r){s.push({startPTS:Math.max(t,n.start(a)),endPTS:Math.min(e,n.end(a))});break}if(t<r&&e>i)s.push({startPTS:Math.max(t,n.start(a)),endPTS:Math.min(e,n.end(a))}),o=!0;else if(e<=i)break}return{time:s,partial:o}},r.getFragmentKey=function(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn},r.getPartialFragment=function(t){var e,n,i,r=this,s=null,o=0;return Object.keys(this.fragments).forEach((function(a){var c=r.fragments[a];r.isPartial(c)&&(n=c.body.startPTS-r.bufferPadding,i=c.body.endPTS+r.bufferPadding,t>=n&&t<=i&&(e=Math.min(t-n,i-t),o<=e&&(s=c.body,o=e)))})),s},r.getState=function(t){var e=this.getFragmentKey(t),n=this.fragments[e],i=U;return void 0!==n&&(i=n.buffered?!0===this.isPartial(n)?H:V:F),i},r.isPartial=function(t){return!0===t.buffered&&(void 0!==t.range.video&&!0===t.range.video.partial||void 0!==t.range.audio&&!0===t.range.audio.partial)},r.isTimeBuffered=function(t,e,n){for(var i,r,s=0;s<n.length;s++){if(i=n.start(s)-this.bufferPadding,r=n.end(s)+this.bufferPadding,t>=i&&e<=r)return!0;if(e<=i)return!1}return!1},r.onFragLoaded=function(t){var e=t.frag;Object(c.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.fragments[this.getFragmentKey(e)]={body:e,range:Object.create(null),buffered:!1})},r.onBufferAppended=function(t){var e=this;this.timeRanges=t.timeRanges,Object.keys(this.timeRanges).forEach((function(t){var n=e.timeRanges[t];e.detectEvictedFragments(t,n)}))},r.onFragBuffered=function(t){this.detectPartialFragments(t.frag)},r.hasFragment=function(t){var e=this.getFragmentKey(t);return void 0!==this.fragments[e]},r.removeFragment=function(t){var e=this.getFragmentKey(t);delete this.fragments[e]},r.removeAllFragments=function(){this.fragments=Object.create(null)},i}(A),G={search:function(t,e){for(var n=0,i=t.length-1,r=null,s=null;n<=i;){var o=e(s=t[r=(n+i)/2|0]);if(o>0)n=r+1;else{if(!(o<0))return s;i=r-1}}return null}},Q=function(){function t(){}return t.isBuffered=function(t,e){try{if(t)for(var n=t.buffered,i=0;i<n.length;i++)if(e>=n.start(i)&&e<=n.end(i))return!0}catch(t){}return!1},t.bufferInfo=function(t,e,n){try{if(t){var i,r=t.buffered,s=[];for(i=0;i<r.length;i++)s.push({start:r.start(i),end:r.end(i)});return this.bufferedInfo(s,e,n)}}catch(t){}return{len:0,start:e,end:e,nextStart:void 0}},t.bufferedInfo=function(t,e,n){t.sort((function(t,e){var n=t.start-e.start;return n||e.end-t.end}));var i=[];if(n)for(var r=0;r<t.length;r++){var s=i.length;if(s){var o=i[s-1].end;t[r].start-o<n?t[r].end>o&&(i[s-1].end=t[r].end):i.push(t[r])}else i.push(t[r])}else i=t;for(var a,c=0,l=e,u=e,d=0;d<i.length;d++){var h=i[d].start,A=i[d].end;if(e+n>=h&&e<A)l=h,c=(u=A)-e;else if(e+n<h){a=h;break}}return{len:c,start:l,end:u,nextStart:a}},t}(),z=n("./node_modules/eventemitter3/index.js"),W=n("./node_modules/webworkify-webpack/index.js"),K=n("./src/demux/demuxer-inline.js");function q(){return window.MediaSource||window.WebKitMediaSource}var Y=n("./src/utils/get-self-scope.js");var $=function(t){var e,n;function i(){return t.apply(this,arguments)||this}return n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,i.prototype.trigger=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];this.emit.apply(this,[t,t].concat(n))},i}(z.EventEmitter),X=Object(Y.getSelfScope)(),J=q()||{isTypeSupported:function(){return!1}},Z=function(){function t(t,e){var n=this;this.hls=t,this.id=e;var i=this.observer=new $,r=t.config,s=function(e,i){(i=i||{}).frag=n.frag,i.id=n.id,t.trigger(e,i)};i.on(l.default.FRAG_DECRYPTED,s),i.on(l.default.FRAG_PARSING_INIT_SEGMENT,s),i.on(l.default.FRAG_PARSING_DATA,s),i.on(l.default.FRAG_PARSED,s),i.on(l.default.ERROR,s),i.on(l.default.FRAG_PARSING_METADATA,s),i.on(l.default.FRAG_PARSING_USERDATA,s),i.on(l.default.INIT_PTS_FOUND,s);var o={mp4:J.isTypeSupported("video/mp4"),mpeg:J.isTypeSupported("audio/mpeg"),mp3:J.isTypeSupported('audio/mp4; codecs="mp3"')},c=navigator.vendor;if(r.enableWorker&&"undefined"!=typeof Worker){var d;u.logger.log("demuxing in webworker");try{d=this.w=W(/*! ../demux/demuxer-worker.js */"./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),d.addEventListener("message",this.onwmsg),d.onerror=function(e){t.trigger(l.default.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},d.postMessage({cmd:"init",typeSupported:o,vendor:c,id:e,config:JSON.stringify(r)})}catch(t){u.logger.warn("Error in worker:",t),u.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),d&&X.URL.revokeObjectURL(d.objectURL),this.demuxer=new K.default(i,o,r,c),this.w=void 0}}else this.demuxer=new K.default(i,o,r,c)}var e=t.prototype;return e.destroy=function(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var e=this.demuxer;e&&(e.destroy(),this.demuxer=null)}var n=this.observer;n&&(n.removeAllListeners(),this.observer=null)},e.push=function(t,e,n,i,r,s,o,a){var l=this.w,d=Object(c.isFiniteNumber)(r.startPTS)?r.startPTS:r.start,h=r.decryptdata,A=this.frag,p=!(A&&r.cc===A.cc),f=!(A&&r.level===A.level),m=A&&r.sn===A.sn+1,g=!f&&m;if(p&&u.logger.log(this.id+":discontinuity detected"),f&&u.logger.log(this.id+":switch detected"),this.frag=r,l)l.postMessage({cmd:"demux",data:t,decryptdata:h,initSegment:e,audioCodec:n,videoCodec:i,timeOffset:d,discontinuity:p,trackSwitch:f,contiguous:g,duration:s,accurateTimeOffset:o,defaultInitPTS:a},t instanceof ArrayBuffer?[t]:[]);else{var v=this.demuxer;v&&v.push(t,h,e,n,i,d,p,f,g,s,o,a)}},e.onWorkerMessage=function(t){var e=t.data,n=this.hls;switch(e.event){case"init":X.URL.revokeObjectURL(this.w.objectURL);break;case l.default.FRAG_PARSING_DATA:e.data.data1=new Uint8Array(e.data1),e.data2&&(e.data.data2=new Uint8Array(e.data2));default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,n.trigger(e.event,e.data)}},t}();function tt(t,e,n){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(n);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(n)}}function et(t,e,n){var i=t[e],r=t[n],s=r.startPTS;if(Object(c.isFiniteNumber)(s))n>e?(i.duration=s-i.start,i.duration<0&&u.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!")):(r.duration=i.start-s,r.duration<0&&u.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!"));else if(n>e){var o=i.cc===r.cc;r.start=i.start+(o&&i.minEndPTS?i.minEndPTS-i.start:i.duration)}else r.start=Math.max(i.start-r.duration,0)}function nt(t,e,n,i,r,s){var o=n,a=i;if(Object(c.isFiniteNumber)(e.startPTS)){var l=Math.abs(e.startPTS-n);Object(c.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(l,e.deltaPTS):e.deltaPTS=l,o=Math.max(n,e.startPTS),n=Math.min(n,e.startPTS),a=Math.min(i,e.endPTS),i=Math.max(i,e.endPTS),r=Math.min(r,e.startDTS),s=Math.max(s,e.endDTS)}var u=n-e.start;e.start=e.startPTS=n,e.maxStartPTS=o,e.endPTS=i,e.minEndPTS=a,e.startDTS=r,e.endDTS=s,e.duration=i-n;var d,h,A,p=e.sn;if(!t||p<t.startSN||p>t.endSN)return 0;for(d=p-t.startSN,(h=t.fragments)[d]=e,A=d;A>0;A--)et(h,A,A-1);for(A=d;A<h.length-1;A++)et(h,A,A+1);return t.PTSKnown=!0,u}function it(t,e){e.initSegment&&t.initSegment&&(e.initSegment=t.initSegment);var n,i=0;if(rt(t,e,(function(t,r){i=t.cc-r.cc,Object(c.isFiniteNumber)(t.startPTS)&&(r.start=r.startPTS=t.startPTS,r.endPTS=t.endPTS,r.duration=t.duration,r.backtracked=t.backtracked,r.dropped=t.dropped,n=r),e.PTSKnown=!0})),e.PTSKnown){if(i){u.logger.log("discontinuity sliding from playlist, take drift into account");for(var r=e.fragments,s=0;s<r.length;s++)r[s].cc+=i}n?nt(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):function(t,e){var n=e.startSN-t.startSN,i=t.fragments,r=e.fragments;if(n<0||n>i.length)return;for(var s=0;s<r.length;s++)r[s].start+=i[n].start}(t,e),e.PTSKnown=t.PTSKnown}}function rt(t,e,n){if(t&&e)for(var i=Math.max(t.startSN,e.startSN)-e.startSN,r=Math.min(t.endSN,e.endSN)-e.startSN,s=e.startSN-t.startSN,o=i;o<=r;o++){var a=t.fragments[s+o],c=e.fragments[o];if(!a||!c)break;n(a,c,o)}}function st(t,e,n){var i=1e3*(e.averagetargetduration?e.averagetargetduration:e.targetduration),r=i/2;return t&&e.endSN===t.endSN&&(i=r),n&&(i=Math.max(r,i-(window.performance.now()-n))),Math.round(i)}var ot={toString:function(t){for(var e="",n=t.length,i=0;i<n;i++)e+="["+t.start(i).toFixed(3)+","+t.end(i).toFixed(3)+"]";return e}};function at(t,e){e.fragments.forEach((function(e){if(e){var n=e.start+t;e.start=e.startPTS=n,e.endPTS=n+e.duration}})),e.PTSKnown=!0}function ct(t,e,n){!function(t,e,n){if(function(t,e,n){var i=!1;return e&&e.details&&n&&(n.endCC>n.startCC||t&&t.cc<n.startCC)&&(i=!0),i}(t,n,e)){var i=function(t,e){var n=t.fragments,i=e.fragments;if(i.length&&n.length){var r=function(t,e){for(var n=null,i=0;i<t.length;i+=1){var r=t[i];if(r&&r.cc===e){n=r;break}}return n}(n,i[0].cc);if(r&&(!r||r.startPTS))return r;u.logger.log("No frag in previous level to align on")}else u.logger.log("No fragments to align")}(n.details,e);i&&(u.logger.log("Adjusting PTS using last level due to CC increase within current level"),at(i.start,e))}}(t,n,e),!n.PTSKnown&&e&&function(t,e){if(e&&e.fragments.length){if(!t.hasProgramDateTime||!e.hasProgramDateTime)return;var n=e.fragments[0].programDateTime,i=(t.fragments[0].programDateTime-n)/1e3+e.fragments[0].start;Object(c.isFiniteNumber)(i)&&(u.logger.log("adjusting PTS using programDateTime delta, sliding:"+i.toFixed(3)),at(i,t))}}(n,e.details)}function lt(t,e,n){if(null===e||!Array.isArray(t)||!t.length||!Object(c.isFiniteNumber)(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;n=n||0;for(var i=0;i<t.length;++i){var r=t[i];if(ht(e,n,r))return r}return null}function ut(t,e,n,i){void 0===n&&(n=0),void 0===i&&(i=0);var r=null;if(t?r=e[t.sn-e[0].sn+1]:0===n&&0===e[0].start&&(r=e[0]),r&&0===dt(n,i,r))return r;var s=G.search(e,dt.bind(null,n,i));return s||r}function dt(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0);var i=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-i<=t?1:n.start-i>t&&n.start?-1:0}function ht(t,e,n){var i=1e3*Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-i>t}var At=function(){function t(t,e,n,i){this.config=t,this.media=e,this.fragmentTracker=n,this.hls=i,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var e=t.prototype;return e.poll=function(t){var e=this.config,n=this.media,i=this.stalled,r=n.currentTime,s=n.seeking,o=this.seeking&&!s,a=!this.seeking&&s;if(this.seeking=s,r===t){if((a||o)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&n.buffered.length){var c=Q.bufferInfo(n,r,0),l=c.len>0,d=c.nextStart||0;if(l||d){if(s){var h=c.len>2,A=!d||d-r>2&&!this.fragmentTracker.getPartialFragment(r);if(h||A)return;this.moved=!1}if(!this.moved&&this.stalled){var p=Math.max(d,c.start||0)-r;if(p>0&&p<=2)return void this._trySkipBufferHole(null)}var f=self.performance.now();if(null!==i){var m=f-i;!s&&m>=250&&this._reportStall(c.len);var g=Q.bufferInfo(n,r,e.maxBufferHole);this._tryFixBufferStall(g,m)}else this.stalled=f}}}else if(this.moved=!0,null!==i){if(this.stallReported){var v=self.performance.now()-i;u.logger.warn("playback not stuck anymore @"+r+", after "+Math.round(v)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},e._tryFixBufferStall=function(t,e){var n=this.config,i=this.fragmentTracker,r=this.media.currentTime,s=i.getPartialFragment(r);if(s&&this._trySkipBufferHole(s))return;t.len>n.maxBufferHole&&e>1e3*n.highBufferWatchdogPeriod&&(u.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},e._reportStall=function(t){var e=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,u.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+t+")"),e.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},e._trySkipBufferHole=function(t){for(var e=this.config,n=this.hls,i=this.media,r=i.currentTime,s=0,o=0;o<i.buffered.length;o++){var c=i.buffered.start(o);if(r+e.maxBufferHole>=s&&r<c){var d=Math.max(c+.05,i.currentTime+.1);return u.logger.warn("skipping hole, adjusting currentTime from "+r+" to "+d),this.moved=!0,this.stalled=null,i.currentTime=d,t&&n.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+r+" to "+d,frag:t}),d}s=i.buffered.end(o)}return 0},e._tryNudgeBuffer=function(){var t=this.config,e=this.hls,n=this.media,i=n.currentTime,r=(this.nudgeRetry||0)+1;if(this.nudgeRetry=r,r<t.nudgeMaxRetry){var s=i+r*t.nudgeOffset;u.logger.warn("Nudging 'currentTime' from "+i+" to "+s),n.currentTime=s,e.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else u.logger.error("Playhead still not moving while enough data buffered @"+i+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},t}();function pt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var ft=function(t){var e,n;function i(e){for(var n,i=arguments.length,r=new Array(i>1?i-1:0),s=1;s<i;s++)r[s-1]=arguments[s];return(n=t.call.apply(t,[this,e].concat(r))||this)._boundTick=void 0,n._tickTimer=null,n._tickInterval=null,n._tickCallCount=0,n._boundTick=n.tick.bind(pt(n)),n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=i.prototype;return r.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},r.hasInterval=function(){return!!this._tickInterval},r.hasNextTick=function(){return!!this._tickTimer},r.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},r.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},r.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},r.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},r.doTick=function(){},i}(A);var mt="STOPPED",gt="STARTING",vt="IDLE",yt="PAUSED",_t="KEY_LOADING",bt="FRAG_LOADING",Et="FRAG_LOADING_WAITING_RETRY",wt="WAITING_TRACK",St="PARSING",Tt="PARSED",Ct="BUFFER_FLUSHING",Rt="ENDED",It="ERROR",xt="WAITING_INIT_PTS",Ot="WAITING_LEVEL",Lt=function(t){var e,n;function i(){return t.apply(this,arguments)||this}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=i.prototype;return r.doTick=function(){},r.startLoad=function(){},r.stopLoad=function(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragmentTracker.removeFragment(t)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=mt},r._streamEnded=function(t,e){var n=this.fragCurrent,i=this.fragmentTracker;if(!e.live&&n&&!n.backtracked&&n.sn===e.endSN&&!t.nextStart){var r=i.getState(n);return r===H||r===V}return!1},r.onMediaSeeking=function(){var t=this.config,e=this.media,n=this.mediaBuffer,i=this.state,r=e?e.currentTime:null,s=Q.bufferInfo(n||e,r,this.config.maxBufferHole);if(u.logger.log("media seeking to "+(Object(c.isFiniteNumber)(r)?r.toFixed(3):r)),i===bt){var o=this.fragCurrent;if(0===s.len&&o){var a=t.maxFragLookUpTolerance,l=o.start-a,d=o.start+o.duration+a;r<l||r>d?(o.loader&&(u.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),o.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=vt):u.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else i===Rt&&(0===s.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=vt);e&&(this.lastCurrentTime=r),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=r),this.tick()},r.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},r.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},r.onHandlerDestroyed=function(){this.state=mt,this.fragmentTracker=null},r.computeLivePosition=function(t,e){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*e.targetduration;return t+Math.max(0,e.totalduration-n)},i}(ft);function Mt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var kt,Nt=function(t){var e,n;function i(e,n){var i;return(i=t.call(this,e,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADING,l.default.MANIFEST_PARSED,l.default.LEVEL_LOADED,l.default.LEVELS_UPDATED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_LOAD_EMERGENCY_ABORTED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_SWITCHED,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED)||this).fragmentTracker=n,i.config=e.config,i.audioCodecSwap=!1,i._state=mt,i.stallReported=!1,i.gapController=null,i.altAudio=!1,i.audioOnly=!1,i.bitrateTest=!1,i}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r,o,d,h=i.prototype;return h.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=n.startLevel;-1===i&&(n.config.testBandwidth?(i=0,this.bitrateTest=!0):i=n.nextAutoLevel),this.level=n.nextLoadLevel=i,this.loadedmetadata=!1}e>0&&-1===t&&(u.logger.log("override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=vt,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=mt},h.stopLoad=function(){this.forceStartLoad=!1,t.prototype.stopLoad.call(this)},h.doTick=function(){switch(this.state){case Ct:this.fragLoadError=0;break;case vt:this._doTickIdle();break;case Ot:var t=this.levels[this.level];t&&t.details&&(this.state=vt);break;case Et:var e=window.performance.now(),n=this.retryDate;(!n||e>=n||this.media&&this.media.seeking)&&(u.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=vt)}this._checkBuffer(),this._checkFragmentChanged()},h._doTickIdle=function(){var t=this.hls,e=t.config,n=this.media;if(void 0!==this.levelLastLoaded&&(n||!this.startFragRequested&&e.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var i;i=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var r=t.nextLoadLevel,s=this.levels[r];if(s){var o,a=s.bitrate;o=a?Math.max(8*e.maxBufferSize/a,e.maxBufferLength):e.maxBufferLength,o=Math.min(o,e.maxMaxBufferLength);var c=i<e.maxBufferHole?Math.max(2,e.maxBufferHole):e.maxBufferHole,d=Q.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,i,c),h=d.len;if(!(h>=o)){u.logger.trace("buffer length of "+h.toFixed(3)+" is below max of "+o.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=r;var A=s.details;if(!A||A.live&&this.levelLastLoaded!==r)this.state=Ot;else{if(this._streamEnded(d,A)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(l.default.BUFFER_EOS,p),void(this.state=Rt)}this._fetchPayloadOrEos(i,d,A)}}}}},h._fetchPayloadOrEos=function(t,e,n){var i=this.fragPrevious,r=(this.level,n.fragments),s=r.length;if(0!==s){var o,a=r[0].start,c=r[s-1].start+r[s-1].duration,l=e.end;if(n.initSegment&&!n.initSegment.data)o=n.initSegment;else if(n.live){var d=this.config.initialLiveManifestSize;if(s<d)return void u.logger.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+d);if(null===(o=this._ensureFragmentAtLivePoint(n,l,a,c,i,r)))return}else l<a&&(o=r[0]);o||(o=this._findFragment(a,i,s,r,l,c,n)),o&&(o.encrypted?this._loadKey(o,n):this._loadFragment(o,n,t,l))}},h._ensureFragmentAtLivePoint=function(t,e,n,i,r,s){var o,a=this.hls.config,l=this.media,d=1/0;if(void 0!==a.liveMaxLatencyDuration?d=a.liveMaxLatencyDuration:Object(c.isFiniteNumber)(a.liveMaxLatencyDurationCount)&&(d=a.liveMaxLatencyDurationCount*t.targetduration),e<Math.max(n-a.maxFragLookUpTolerance,i-d)){var h=this.liveSyncPosition=this.computeLivePosition(n,t);e=h,l&&!l.paused&&l.readyState&&l.duration>h&&h>l.currentTime&&(u.logger.log("buffer end: "+e.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),l.currentTime=h),this.nextLoadPosition=h}if(t.PTSKnown&&e>i&&l&&l.readyState)return null;if(this.startFragRequested&&!t.PTSKnown&&r)if(t.hasProgramDateTime)u.logger.log("live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),o=lt(s,r.endProgramDateTime,a.maxFragLookUpTolerance);else{var A=r.sn+1;if(A>=t.startSN&&A<=t.endSN){var p=s[A-t.startSN];r.cc===p.cc&&(o=p,u.logger.log("live playlist, switching playlist, load frag with next SN: "+o.sn))}o||(o=G.search(s,(function(t){return r.cc-t.cc})))&&u.logger.log("live playlist, switching playlist, load frag with same CC: "+o.sn)}return o},h._findFragment=function(t,e,n,i,r,s,o){var a,c=this.hls.config;r<s?a=ut(e,i,r,r>s-c.maxFragLookUpTolerance?0:c.maxFragLookUpTolerance):a=i[n-1];if(a){var l=a.sn-o.startSN,d=e&&a.level===e.level,h=i[l-1],A=i[l+1];if(e&&a.sn===e.sn)if(d&&!a.backtracked)if(a.sn<o.endSN){var p=e.deltaPTS;p&&p>c.maxBufferHole&&e.dropped&&l?(a=h,u.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(a=A,this.fragmentTracker.getState(a)!==V&&u.logger.log("Re-loading fragment with SN: "+a.sn))}else a=null;else a.backtracked&&(A&&A.backtracked?(u.logger.warn("Already backtracked from fragment "+A.sn+", will not backtrack to fragment "+a.sn+". Loading fragment "+A.sn),a=A):(u.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),a.dropped=0,h?(a=h).backtracked=!0:l&&(a=null)))}return a},h._loadKey=function(t,e){u.logger.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], level "+this.level),this.state=_t,this.hls.trigger(l.default.KEY_LOADING,{frag:t})},h._loadFragment=function(t,e,n,i){var r=this.fragmentTracker.getState(t);this.fragCurrent=t,"initSegment"!==t.sn&&(this.startFragRequested=!0),Object(c.isFiniteNumber)(t.sn)&&!t.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),t.backtracked||r===U||r===H?(t.autoLevel=this.hls.autoLevelEnabled,t.bitrateTest=this.bitrateTest,u.logger.log("Loading "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(n.toFixed(3))+", bufferEnd: "+parseFloat(i.toFixed(3))),this.hls.trigger(l.default.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new Z(this.hls,"main")),this.state=bt):r===F&&this._reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t)},h.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,s.MAIN)},h.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.endPTS+.5):null},h._checkFragmentChanged=function(){var t,e,n=this.media;if(n&&n.readyState&&!1===n.seeking&&((e=n.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=e),Q.isBuffered(n,e)?t=this.getBufferedFrag(e):Q.isBuffered(n,e+.1)&&(t=this.getBufferedFrag(e+.1)),t)){var i=t;if(i!==this.fragPlaying){this.hls.trigger(l.default.FRAG_CHANGED,{frag:i});var r=i.level;this.fragPlaying&&this.fragPlaying.level===r||this.hls.trigger(l.default.LEVEL_SWITCHED,{level:r}),this.fragPlaying=i}}},h.immediateLevelSwitch=function(){if(u.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t,e=this.media;e?(t=e.paused)||e.pause():t=!0,this.previouslyPaused=t}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},h.immediateLevelSwitchEnd=function(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,t.currentTime>0&&Q.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())},h.nextLevelSwitch=function(){var t=this.media;if(t&&t.readyState){var e,n=this.getBufferedFrag(t.currentTime);if(n&&n.startPTS>1&&this.flushMainBuffer(0,n.startPTS-1),t.paused)e=0;else{var i=this.hls.nextLoadLevel,r=this.levels[i],s=this.fragLastKbps;e=s&&this.fragCurrent?this.fragCurrent.duration*r.bitrate/(1e3*s)+1:0}var o=this.getBufferedFrag(t.currentTime+e);if(o){var a=this.followingBufferedFrag(o);if(a){var c=this.fragCurrent;c&&c.loader&&c.loader.abort(),this.fragCurrent=null;var l=Math.max(o.endPTS,a.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,a.duration));this.flushMainBuffer(l,Number.POSITIVE_INFINITY)}}}},h.flushMainBuffer=function(t,e){this.state=Ct;var n={startOffset:t,endOffset:e};this.altAudio&&(n.type="video"),this.hls.trigger(l.default.BUFFER_FLUSHING,n)},h.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("seeked",this.onvseeked),e.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition),this.gapController=new At(n,e,this.fragmentTracker,this.hls)},h.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(u.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var e=this.levels;e&&e.forEach((function(t){t.details&&t.details.fragments.forEach((function(t){t.backtracked=void 0}))})),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},h.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:void 0;Object(c.isFiniteNumber)(e)&&u.logger.log("media seeked to "+e.toFixed(3)),this.tick()},h.onManifestLoading=function(){u.logger.log("trigger BUFFER_RESET"),this.hls.trigger(l.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},h.onManifestParsed=function(t){var e,n=!1,i=!1;t.levels.forEach((function(t){(e=t.audioCodec)&&(-1!==e.indexOf("mp4a.40.2")&&(n=!0),-1!==e.indexOf("mp4a.40.5")&&(i=!0))})),this.audioCodecSwitch=n&&i,this.audioCodecSwitch&&u.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=t.altAudio,this.levels=t.levels,this.startFragRequested=!1;var r=this.config;(r.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(r.startPosition)},h.onLevelLoaded=function(t){var e=t.details,n=t.level,i=this.levels[this.levelLastLoaded],r=this.levels[n],s=e.totalduration,o=0;if(u.logger.log("level "+n+" loaded ["+e.startSN+","+e.endSN+"],duration:"+s),e.live){var a=r.details;a&&e.fragments.length>0?(it(a,e),o=e.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,a),e.PTSKnown&&Object(c.isFiniteNumber)(o)?u.logger.log("live playlist sliding:"+o.toFixed(3)):(u.logger.log("live playlist - outdated PTS, unknown sliding"),ct(this.fragPrevious,i,e))):(u.logger.log("live playlist - first load, unknown sliding"),e.PTSKnown=!1,ct(this.fragPrevious,i,e))}else e.PTSKnown=!1;if(r.details=e,this.levelLastLoaded=n,this.hls.trigger(l.default.LEVEL_UPDATED,{details:e,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var d=e.startTimeOffset;Object(c.isFiniteNumber)(d)?(d<0&&(u.logger.log("negative start time offset "+d+", count from end of last fragment"),d=o+s+d),u.logger.log("start time offset found in playlist, adjust startPosition to "+d),this.startPosition=d):e.live?(this.startPosition=this.computeLivePosition(o,e),u.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===Ot&&(this.state=vt),this.tick()},h.onKeyLoaded=function(){this.state===_t&&(this.state=vt,this.tick())},h.onFragLoaded=function(t){var e=this.fragCurrent,n=this.hls,i=this.levels,r=this.media,s=t.frag;if(this.state===bt&&e&&"main"===s.type&&s.level===e.level&&s.sn===e.sn){var o=t.stats,a=i[e.level],c=a.details;if(this.bitrateTest=!1,this.stats=o,u.logger.log("Loaded "+e.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+e.level),s.bitrateTest&&n.nextLoadLevel)this.state=vt,this.startFragRequested=!1,o.tparsed=o.tbuffered=window.performance.now(),n.trigger(l.default.FRAG_BUFFERED,{stats:o,frag:e,id:"main"}),this.tick();else if("initSegment"===s.sn)this.state=vt,o.tparsed=o.tbuffered=window.performance.now(),c.initSegment.data=t.payload,n.trigger(l.default.FRAG_BUFFERED,{stats:o,frag:e,id:"main"}),this.tick();else{u.logger.log("Parsing "+e.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+e.level+", cc "+e.cc),this.state=St,this.pendingBuffering=!0,this.appended=!1,s.bitrateTest&&(s.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:s}));var d=!(r&&r.seeking)&&(c.PTSKnown||!c.live),h=c.initSegment?c.initSegment.data:[],A=this._getAudioCodec(a);(this.demuxer=this.demuxer||new Z(this.hls,"main")).push(t.payload,h,A,a.videoCodec,e,c.totalduration,d)}}this.fragLoadError=0},h.onFragParsingInitSegment=function(t){var e=this.fragCurrent,n=t.frag;if(e&&"main"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===St){var i,r,s=t.tracks;if(this.audioOnly=s.audio&&!s.video,this.altAudio&&!this.audioOnly&&delete s.audio,r=s.audio){var o=this.levels[this.level].audioCodec,a=navigator.userAgent.toLowerCase();o&&this.audioCodecSwap&&(u.logger.log("swapping playlist audio codec"),o=-1!==o.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==r.metadata.channelCount&&-1===a.indexOf("firefox")&&(o="mp4a.40.5"),-1!==a.indexOf("android")&&"audio/mpeg"!==r.container&&(o="mp4a.40.2",u.logger.log("Android: force audio codec to "+o)),r.levelCodec=o,r.id=t.id}for(i in(r=s.video)&&(r.levelCodec=this.levels[this.level].videoCodec,r.id=t.id),this.hls.trigger(l.default.BUFFER_CODECS,s),s){r=s[i],u.logger.log("main track:"+i+",container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var c=r.initSegment;c&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,{type:i,data:c,parent:"main",content:"initSegment"}))}this.tick()}},h.onFragParsingData=function(t){var e=this,n=this.fragCurrent,i=t.frag;if(n&&"main"===t.id&&i.sn===n.sn&&i.level===n.level&&("audio"!==t.type||!this.altAudio)&&this.state===St){var r=this.levels[this.level],s=n;if(Object(c.isFiniteNumber)(t.endPTS)||(t.endPTS=t.startPTS+n.duration,t.endDTS=t.startDTS+n.duration),!0===t.hasAudio&&s.addElementaryStream(m.AUDIO),!0===t.hasVideo&&s.addElementaryStream(m.VIDEO),u.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(s.dropped=t.dropped,s.dropped)if(s.backtracked)u.logger.warn("Already backtracked on this fragment, appending with the gap",s.sn);else{var o=r.details;if(!o||s.sn!==o.startSN)return u.logger.warn("missing video frame(s), backtracking fragment",s.sn),this.fragmentTracker.removeFragment(s),s.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=vt,this.fragPrevious=s,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();u.logger.warn("missing video frame(s) on first frag, appending with gap",s.sn)}else s.backtracked=!1;var a=nt(r.details,s,t.startPTS,t.endPTS,t.startDTS,t.endDTS),d=this.hls;d.trigger(l.default.LEVEL_PTS_UPDATED,{details:r.details,level:this.level,drift:a,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach((function(n){n&&n.length&&e.state===St&&(e.appended=!0,e.pendingBuffering=!0,d.trigger(l.default.BUFFER_APPENDING,{type:t.type,data:n,parent:"main",content:"data"}))})),this.tick()}},h.onFragParsed=function(t){var e=this.fragCurrent,n=t.frag;e&&"main"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===St&&(this.stats.tparsed=window.performance.now(),this.state=Tt,this._checkAppendedParsed())},h.onAudioTrackSwitching=function(t){var e=this.altAudio,n=!!t.url,i=t.id;if(!n){if(this.mediaBuffer!==this.media){u.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r.loader&&(u.logger.log("switching to main audio track, cancel main fragment load"),r.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=vt}var s=this.hls;e&&s.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),s.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:i})}},h.onAudioTrackSwitched=function(t){var e=t.id,n=!!this.hls.audioTracks[e].url;if(n){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(u.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=n,this.tick()},h.onBufferCreated=function(t){var e,n,i=t.tracks,r=!1;for(var s in i){var o=i[s];"main"===o.id?(n=s,e=o,"video"===s&&(this.videoBuffer=i[s].buffer)):r=!0}r&&e?(u.logger.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=e.buffer):this.mediaBuffer=this.media},h.onBufferAppended=function(t){if("main"===t.parent){var e=this.state;e!==St&&e!==Tt||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},h._checkAppendedParsed=function(){if(!(this.state!==Tt||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var e=this.mediaBuffer?this.mediaBuffer:this.media;u.logger.log("main buffered : "+ot.toString(e.buffered)),this.fragPrevious=t;var n=this.stats;n.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(l.default.FRAG_BUFFERED,{stats:n,frag:t,id:"main"}),this.state=vt}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},h.onError=function(t){var e=t.frag||this.fragCurrent;if(!e||"main"===e.type){var n=!!this.media&&Q.isBuffered(this.media,this.media.currentTime)&&Q.isBuffered(this.media,this.media.currentTime+.5);switch(t.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:if(!t.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var i=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);u.logger.warn("mediaController: frag loading failed, retry in "+i+" ms"),this.retryDate=window.performance.now()+i,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=Et}else u.logger.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=It;break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==It&&(t.fatal?(this.state=It,u.logger.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==Ot||(this.state=vt));break;case a.ErrorDetails.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==St&&this.state!==Tt||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=vt):(u.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},h._reduceMaxBufferLength=function(t){var e=this.config;return e.maxMaxBufferLength>=t&&(e.maxMaxBufferLength/=2,u.logger.warn("main:reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},h._checkBuffer=function(){var t=this.media;if(t&&0!==t.readyState){var e=(this.mediaBuffer?this.mediaBuffer:t).buffered;!this.loadedmetadata&&e.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,e)}},h.onFragLoadEmergencyAborted=function(){this.state=vt,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},h.onBufferFlushed=function(){var t=this.mediaBuffer?this.mediaBuffer:this.media;if(t){var e=this.audioOnly?m.AUDIO:m.VIDEO;this.fragmentTracker.detectEvictedFragments(e,t.buffered)}this.state=vt,this.fragPrevious=null},h.onLevelsUpdated=function(t){this.levels=t.levels},h.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},h._seekToStartPos=function(){var t=this.media,e=t.currentTime,n=this.startPosition;if(e!==n&&n>=0){if(t.seeking)return void u.logger.log("could not seek to "+n+", already seeking at "+e);var i=(t.buffered.length?t.buffered.start(0):0)-n;i>0&&i<this.config.maxBufferHole&&(u.logger.log("adjusting start position by "+i+" to match buffer start"),n+=i,this.startPosition=n),u.logger.log("seek to target start position "+n+" from current time "+e+". ready state "+t.readyState),t.currentTime=n}},h._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&(u.logger.log("swapping playlist audio codec"),e&&(e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),e},r=i,(o=[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,u.logger.log("main stream-controller: "+e+"->"+t),this.hls.trigger(l.default.STREAM_STATE_TRANSITION,{previousState:e,nextState:t})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getBufferedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(t){this._liveSyncPosition=t}}])&&Mt(r.prototype,o),d&&Mt(r,d),i}(Lt);function Pt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Dt=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.MANIFEST_LOADED,l.default.LEVEL_LOADED,l.default.AUDIO_TRACK_SWITCHED,l.default.FRAG_LOADED,l.default.ERROR)||this).canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,kt=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r,s,o,c=i.prototype;return c.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},c.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},c.startLoad=function(){var t=this._levels;this.canload=!0,this.levelRetryCount=0,t&&t.forEach((function(t){t.loadError=0;var e=t.details;e&&e.live&&(t.details=void 0)})),null!==this.timer&&this.loadLevel()},c.stopLoad=function(){this.canload=!1},c.onManifestLoaded=function(t){var e,n=[],i=[],r={},s=null,o=!1,c=!1;if(t.levels.forEach((function(t){var e=t.attrs;t.loadError=0,t.fragmentError=!1,o=o||!!t.videoCodec,c=c||!!t.audioCodec,kt&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0),(s=r[t.bitrate])?s.url.push(t.url):(t.url=[t.url],t.urlId=0,r[t.bitrate]=t,n.push(t)),e&&(e.AUDIO&&tt(s||t,"audio",e.AUDIO),e.SUBTITLES&&tt(s||t,"text",e.SUBTITLES))})),o&&c&&(n=n.filter((function(t){return!!t.videoCodec}))),n=n.filter((function(t){var e=t.audioCodec,n=t.videoCodec;return(!e||C(e,"audio"))&&(!n||C(n,"video"))})),t.audioTracks&&(i=t.audioTracks.filter((function(t){return!t.audioCodec||C(t.audioCodec,"audio")}))).forEach((function(t,e){t.id=e})),n.length>0){e=n[0].bitrate,n.sort((function(t,e){return t.bitrate-e.bitrate})),this._levels=n;for(var d=0;d<n.length;d++)if(n[d].bitrate===e){this._firstLevel=d,u.logger.log("manifest loaded,"+n.length+" level(s) found, first bitrate:"+e);break}var h=c&&!o;this.hls.trigger(l.default.MANIFEST_PARSED,{levels:n,audioTracks:i,firstLevel:this._firstLevel,stats:t.stats,audio:c,video:o,altAudio:!h&&i.some((function(t){return!!t.url}))})}else this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},c.setLevelInternal=function(t){var e=this._levels,n=this.hls;if(t>=0&&t<e.length){if(this.clearTimer(),this.currentLevelIndex!==t){u.logger.log("switching to level "+t),this.currentLevelIndex=t;var i=e[t];i.level=t,n.trigger(l.default.LEVEL_SWITCHING,i)}var r=e[t],s=r.details;if(!s||s.live){var o=r.urlId;n.trigger(l.default.LEVEL_LOADING,{url:r.url[o],level:t,id:o})}}else n.trigger(l.default.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})},c.onError=function(t){if(t.fatal)t.type===a.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var e,n=!1,i=!1;switch(t.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:e=t.frag.level,i=!0;break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:e=t.context.level,n=!0;break;case a.ErrorDetails.REMUX_ALLOC_ERROR:e=t.level,n=!0}void 0!==e&&this.recoverLevel(t,e,n,i)}},c.recoverLevel=function(t,e,n,i){var r,s,o,a=this,c=this.hls.config,l=t.details,d=this._levels[e];if(d.loadError++,d.fragmentError=i,n){if(!(this.levelRetryCount+1<=c.levelLoadingMaxRetry))return u.logger.error("level controller, cannot recover from "+l+" error"),this.currentLevelIndex=null,this.clearTimer(),void(t.fatal=!0);s=Math.min(Math.pow(2,this.levelRetryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return a.loadLevel()}),s),t.levelRetry=!0,this.levelRetryCount++,u.logger.warn("level controller, "+l+", retry in "+s+" ms, current retry count is "+this.levelRetryCount)}(n||i)&&((r=d.url.length)>1&&d.loadError<r?(d.urlId=(d.urlId+1)%r,d.details=void 0,u.logger.warn("level controller, "+l+" for level "+e+": switching to redundant URL-id "+d.urlId)):-1===this.manualLevelIndex?(o=0===e?this._levels.length-1:e-1,u.logger.warn("level controller, "+l+": switch to "+o),this.hls.nextAutoLevel=this.currentLevelIndex=o):i&&(u.logger.warn("level controller, "+l+": reload a fragment"),this.currentLevelIndex=null))},c.onFragLoaded=function(t){var e=t.frag;if(void 0!==e&&"main"===e.type){var n=this._levels[e.level];void 0!==n&&(n.fragmentError=!1,n.loadError=0,this.levelRetryCount=0)}},c.onLevelLoaded=function(t){var e=this,n=t.level,i=t.details;if(n===this.currentLevelIndex){var r=this._levels[n];if(r.fragmentError||(r.loadError=0,this.levelRetryCount=0),i.live){var s=st(r.details,i,t.stats.trequest);u.logger.log("live playlist, reload in "+Math.round(s)+" ms"),this.timer=setTimeout((function(){return e.loadLevel()}),s)}else this.clearTimer()}},c.onAudioTrackSwitched=function(t){var e=this.hls.audioTracks[t.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var i=-1,r=0;r<n.audioGroupIds.length;r++)if(n.audioGroupIds[r]===e){i=r;break}i!==n.urlId&&(n.urlId=i,this.startLoad())}},c.loadLevel=function(){if(u.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var t=this._levels[this.currentLevelIndex];if("object"==typeof t&&t.url.length>0){var e=this.currentLevelIndex,n=t.urlId,i=t.url[n];u.logger.log("Attempt loading level index "+e+" with URL-id "+n),this.hls.trigger(l.default.LEVEL_LOADING,{url:i,level:e,id:n})}}},c.removeLevel=function(t,e){var n=this.levels.filter((function(n,i){return i!==t||n.url.length>1&&void 0!==e&&(n.url=n.url.filter((function(t,n){return n!==e})),n.urlId=0,!0)})).map((function(t,e){var n=t.details;return n&&n.fragments&&n.fragments.forEach((function(t){t.level=e})),t}));this._levels=n,this.hls.trigger(l.default.LEVELS_UPDATED,{levels:n})},r=i,(s=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e=this._levels;e&&(t=Math.min(t,e.length-1),this.currentLevelIndex===t&&e[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}])&&Pt(r.prototype,s),o&&Pt(r,o),i}(A),Bt=n("./src/demux/id3.js");function Ut(t,e){var n;try{n=new Event("addtrack")}catch(t){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=t,e.dispatchEvent(n)}function Ft(t){if(null==t?void 0:t.cues)for(;t.cues.length>0;)t.removeCue(t.cues[0])}var Ht=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.FRAG_PARSING_METADATA,l.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,n.media=void 0,n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=i.prototype;return r.destroy=function(){A.prototype.destroy.call(this)},r.onMediaAttached=function(t){this.media=t.media,this.media},r.onMediaDetaching=function(){Ft(this.id3Track),this.id3Track=void 0,this.media=void 0},r.getID3Track=function(t){for(var e=0;e<t.length;e++){var n=t[e];if("metadata"===n.kind&&"id3"===n.label)return Ut(n,this.media),n}return this.media.addTextTrack("metadata","id3")},r.onFragParsingMetadata=function(t){var e=t.frag,n=t.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var i=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,r=0;r<n.length;r++){var s=Bt.default.getID3Frames(n[r].data);if(s){var o=Math.max(n[r].pts,0),a=r<n.length-1?n[r+1].pts:e.endPTS;a||(a=e.start+e.duration),a-o<=0&&(a=o+.25);for(var c=0;c<s.length;c++){var l=s[c];if(!Bt.default.isTimeStampFrame(l)){var u=new i(o,a,"");u.value=l,this.id3Track.addCue(u)}}}}},r.onLiveBackBufferReached=function(t){var e=t.bufferEnd,n=this.id3Track;if(n&&n.cues&&n.cues.length){var i=function(t,e){if(e<t[0].endTime)return t[0];if(e>t[t.length-1].endTime)return t[t.length-1];for(var n=0,i=t.length-1;n<=i;){var r=Math.floor((i+n)/2);if(e<t[r].endTime)i=r-1;else{if(!(e>t[r].endTime))return t[r];n=r+1}}return t[n].endTime-e<e-t[i].endTime?t[n]:t[i]}(n.cues,e);if(i)for(;n.cues[0]!==i;)n.removeCue(n.cues[0])}},i}(A);var Vt=function(){function t(t){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}var e=t.prototype;return e.sample=function(t,e){var n=Math.pow(this.alpha_,t);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=t},e.getTotalWeight=function(){return this.totalWeight_},e.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_},t}(),jt=function(){function t(t,e,n,i){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=t,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Vt(e),this.fast_=new Vt(n)}var e=t.prototype;return e.sample=function(t,e){var n=(t=Math.max(t,this.minDelayMs_))/1e3,i=8*e/n;this.fast_.sample(n,i),this.slow_.sample(n,i)},e.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},e.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.destroy=function(){},t}();function Gt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Qt=window.performance,zt=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.FRAG_LOADING,l.default.FRAG_LOADED,l.default.FRAG_BUFFERED,l.default.ERROR)||this).lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=e,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(n)),n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r,s,o,d=i.prototype;return d.destroy=function(){this.clearTimer(),A.prototype.destroy.call(this)},d.onFragLoading=function(t){var e=t.frag;if("main"===e.type&&(this.timer||(this.fragCurrent=e,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var n,i,r=this.hls,s=r.config,o=e.level;r.levels[o].details.live?(n=s.abrEwmaFastLive,i=s.abrEwmaSlowLive):(n=s.abrEwmaFastVoD,i=s.abrEwmaSlowVoD),this._bwEstimator=new jt(r,i,n,s.abrEwmaDefaultEstimate)}},d._abandonRulesCheck=function(){var t=this.hls,e=t.media,n=this.fragCurrent;if(n){var i=n.loader;if(!i||i.stats&&i.stats.aborted)return u.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var r=i.stats;if(e&&r&&(!e.paused&&0!==e.playbackRate||!e.readyState)&&n.autoLevel&&n.level){var s=Qt.now()-r.trequest,o=Math.abs(e.playbackRate);if(s>500*n.duration/o){var a=t.levels,c=Math.max(1,r.bw?r.bw/8:1e3*r.loaded/s),d=a[n.level];if(!d)return;var h=d.realBitrate?Math.max(d.realBitrate,d.bitrate):d.bitrate,A=r.total?r.total:Math.max(r.loaded,Math.round(n.duration*h/8)),p=e.currentTime,f=(A-r.loaded)/c,m=(Q.bufferInfo(e,p,t.config.maxBufferHole).end-p)/o;if(m<2*n.duration/o&&f>m){var g,v,y=t.minAutoLevel;for(v=n.level-1;v>y;v--){var _=a[v].realBitrate?Math.max(a[v].realBitrate,a[v].bitrate):a[v].bitrate;if(n.duration*_/(6.4*c)<m)break}g<f&&(u.logger.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+g.toFixed(1)+"<"+f.toFixed(1)+":"+m.toFixed(1)),t.nextLoadLevel=v,this._bwEstimator.sample(s,r.loaded),i.abort(),this.clearTimer(),t.trigger(l.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:r}))}}}}},d.onFragLoaded=function(t){var e=t.frag;if("main"===e.type&&Object(c.isFiniteNumber)(e.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=e.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[e.level],i=(n.loaded?n.loaded.bytes:0)+t.stats.loaded,r=(n.loaded?n.loaded.duration:0)+t.frag.duration;n.loaded={bytes:i,duration:r},n.realBitrate=Math.round(8*i/r)}if(t.frag.bitrateTest){var s=t.stats;s.tparsed=s.tbuffered=s.tload,this.onFragBuffered(t)}}},d.onFragBuffered=function(t){var e=t.stats,n=t.frag;if(!0!==e.aborted&&"main"===n.type&&Object(c.isFiniteNumber)(n.sn)&&(!n.bitrateTest||e.tload===e.tbuffered)){var i=e.tparsed-e.trequest;u.logger.log("latency/loading/parsing/append/kbps:"+Math.round(e.tfirst-e.trequest)+"/"+Math.round(e.tload-e.tfirst)+"/"+Math.round(e.tparsed-e.tload)+"/"+Math.round(e.tbuffered-e.tparsed)+"/"+Math.round(8*e.loaded/(e.tbuffered-e.trequest))),this._bwEstimator.sample(i,e.loaded),e.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}},d.onError=function(t){switch(t.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},d.clearTimer=function(){clearInterval(this.timer),this.timer=null},d._findBestLevel=function(t,e,n,i,r,s,o,a,c){for(var l=r;l>=i;l--){var d=c[l];if(d){var h=d.details,A=h?h.totalduration/h.fragments.length:e,p=!!h&&h.live,f=void 0;f=l<=t?o*n:a*n;var m=c[l].realBitrate?Math.max(c[l].realBitrate,c[l].bitrate):c[l].bitrate,g=m*A/f;if(u.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+l+"/"+Math.round(f)+"/"+m+"/"+A+"/"+s+"/"+g),f>m&&(!g||p&&!this.bitrateTestDelay||g<s))return l}}return-1},r=i,(s=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this._bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var n=this._nextABRAutoLevel;return-1!==t&&(n=Math.min(t,n)),n},set:function(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function(){var t=this.hls,e=t.maxAutoLevel,n=t.levels,i=t.config,r=t.minAutoLevel,s=t.media,o=this.lastLoadedFragLevel,a=this.fragCurrent?this.fragCurrent.duration:0,c=s?s.currentTime:0,l=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,h=(Q.bufferInfo(s,c,i.maxBufferHole).end-c)/l,A=this._findBestLevel(o,a,d,r,e,h,i.abrBandWidthFactor,i.abrBandWidthUpFactor,n);if(A>=0)return A;u.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=a?Math.min(a,i.maxStarvationDelay):i.maxStarvationDelay,f=i.abrBandWidthFactor,m=i.abrBandWidthUpFactor;if(0===h){var g=this.bitrateTestDelay;g&&(p=(a?Math.min(a,i.maxLoadingDelay):i.maxLoadingDelay)-g,u.logger.trace("bitrate test took "+Math.round(1e3*g)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),f=m=1)}return A=this._findBestLevel(o,a,d,r,e,h+p,f,m,n),Math.max(A,0)}}])&&Gt(r.prototype,s),o&&Gt(r,o),i}(A);var Wt=q(),Kt=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.MANIFEST_PARSED,l.default.BUFFER_RESET,l.default.BUFFER_APPENDING,l.default.BUFFER_CODECS,l.default.BUFFER_EOS,l.default.BUFFER_FLUSHING,l.default.LEVEL_PTS_UPDATED,l.default.LEVEL_UPDATED)||this)._msDuration=null,n._levelDuration=null,n._levelTargetDuration=10,n._live=null,n._objectUrl=null,n._needsFlush=!1,n._needsEos=!1,n.config=void 0,n.audioTimestampOffset=void 0,n.bufferCodecEventsExpected=0,n._bufferCodecEventsTotal=0,n.media=null,n.mediaSource=null,n.segments=[],n.parent=void 0,n.appending=!1,n.appended=0,n.appendError=0,n.flushBufferCounter=0,n.tracks={},n.pendingTracks={},n.sourceBuffer={},n.flushRange=[],n._onMediaSourceOpen=function(){u.logger.log("media source opened"),n.hls.trigger(l.default.MEDIA_ATTACHED,{media:n.media});var t=n.mediaSource;t&&t.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},n._onMediaSourceClose=function(){u.logger.log("media source closed")},n._onMediaSourceEnded=function(){u.logger.log("media source ended")},n._onSBUpdateEnd=function(){if(n.audioTimestampOffset&&n.sourceBuffer.audio){var t=n.sourceBuffer.audio;u.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+n.audioTimestampOffset),t.timestampOffset=n.audioTimestampOffset,delete n.audioTimestampOffset}n._needsFlush&&n.doFlush(),n._needsEos&&n.checkEos(),n.appending=!1;var e=n.parent,i=n.segments.reduce((function(t,n){return n.parent===e?t+1:t}),0),r={},s=n.sourceBuffer;for(var o in s){var a=s[o];if(!a)throw Error("handling source buffer update end error: source buffer for "+o+" uninitilized and unable to update buffered TimeRanges.");r[o]=a.buffered}n.hls.trigger(l.default.BUFFER_APPENDED,{parent:e,pending:i,timeRanges:r}),n._needsFlush||n.doAppending(),n.updateMediaElementDuration(),0===i&&n.flushLiveBackBuffer()},n._onSBUpdateError=function(t){u.logger.error("sourceBuffer error:",t),n.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},n.config=e.config,n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=i.prototype;return r.destroy=function(){A.prototype.destroy.call(this)},r.onLevelPtsUpdated=function(t){var e=t.type,n=this.tracks.audio;if("audio"===e&&n&&"audio/mpeg"===n.container){var i=this.sourceBuffer.audio;if(!i)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(i.timestampOffset-t.start)>.1){var r=i.updating;try{i.abort()}catch(t){u.logger.warn("can not abort audio buffer: "+t)}r?this.audioTimestampOffset=t.start:(u.logger.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+t.start),i.timestampOffset=t.start)}}},r.onManifestParsed=function(t){var e=2;(t.audio&&!t.video||!t.altAudio)&&(e=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=e,u.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},r.onMediaAttaching=function(t){var e=this.media=t.media;if(e&&Wt){var n=this.mediaSource=new Wt;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),e.src=window.URL.createObjectURL(n),this._objectUrl=e.src}},r.onMediaDetaching=function(){u.logger.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(t){u.logger.warn("onMediaDetaching:"+t.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):u.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(l.default.MEDIA_DETACHED)},r.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.pendingTracks,n=Object.keys(e).length;(n&&!t||2===n)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())},r.onBufferReset=function(){var t=this.sourceBuffer;for(var e in t){var n=t[e];try{n&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this._onSBUpdateEnd),n.removeEventListener("error",this._onSBUpdateError))}catch(t){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},r.onBufferCodecs=function(t){var e=this;Object.keys(this.sourceBuffer).length||(Object.keys(t).forEach((function(n){e.pendingTracks[n]=t[n]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},r.createSourceBuffers=function(t){var e=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(var i in t)if(!e[i]){var r=t[i];if(!r)throw Error("source buffer exists for track "+i+", however track does not");var s=r.levelCodec||r.codec,o=r.container+";codecs="+s;u.logger.log("creating sourceBuffer("+o+")");try{var c=e[i]=n.addSourceBuffer(o);c.addEventListener("updateend",this._onSBUpdateEnd),c.addEventListener("error",this._onSBUpdateError),this.tracks[i]={buffer:c,codec:s,id:r.id,container:r.container,levelCodec:r.levelCodec}}catch(t){u.logger.error("error while trying to add sourceBuffer:"+t.message),this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:t,mimeType:o})}}this.hls.trigger(l.default.BUFFER_CREATED,{tracks:this.tracks})},r.onBufferAppending=function(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())},r.onBufferEos=function(t){for(var e in this.sourceBuffer)if(!t.type||t.type===e){var n=this.sourceBuffer[e];n&&!n.ended&&(n.ended=!0,u.logger.log(e+" sourceBuffer now EOS"))}this.checkEos()},r.checkEos=function(){var t=this.sourceBuffer,e=this.mediaSource;if(e&&"open"===e.readyState){for(var n in t){var i=t[n];if(i){if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}}u.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{e.endOfStream()}catch(t){u.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},r.onBufferFlushing=function(t){t.type?this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}):(this.flushRange.push({start:t.startOffset,end:t.endOffset,type:"video"}),this.flushRange.push({start:t.startOffset,end:t.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},r.flushLiveBackBuffer=function(){if(this._live){var t=this.config.liveBackBufferLength;if(isFinite(t)&&!(t<0))if(this.media)for(var e=this.media.currentTime,n=this.sourceBuffer,i=Object.keys(n),r=e-Math.max(t,this._levelTargetDuration),s=i.length-1;s>=0;s--){var o=i[s],a=n[o];if(a){var c=a.buffered;c.length>0&&r>c.start(0)&&this.removeBufferRange(o,a,0,r)&&this.hls.trigger(l.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:r})}}else u.logger.error("flushLiveBackBuffer called without attaching media")}},r.onLevelUpdated=function(t){var e=t.details;e.fragments.length>0&&(this._levelDuration=e.totalduration+e.fragments[0].start,this._levelTargetDuration=e.averagetargetduration||e.targetduration||10,this._live=e.live,this.updateMediaElementDuration())},r.updateMediaElementDuration=function(){var t,e=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var n in this.sourceBuffer){var i=this.sourceBuffer[n];if(i&&!0===i.updating)return}t=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===e.liveDurationInfinity?(u.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>t||!Object(c.isFiniteNumber)(t))&&(u.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},r.doFlush=function(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var e=0,n=this.sourceBuffer;try{for(var i in n){var r=n[i];r&&(e+=r.buffered.length)}}catch(t){u.logger.error("error while accessing sourceBuffer.buffered")}this.appended=e,this.hls.trigger(l.default.BUFFER_FLUSHED)}},r.doAppending=function(){var t=this.config,e=this.hls,n=this.segments,i=this.sourceBuffer;if(Object.keys(i).length){if(!this.media||this.media.error)return this.segments=[],void u.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var r=n.shift();if(r)try{var s=i[r.type];if(!s)return void this._onSBUpdateEnd();if(s.updating)return void n.unshift(r);s.ended=!1,this.parent=r.parent,s.appendBuffer(r.data),this.appendError=0,this.appended++,this.appending=!0}catch(i){u.logger.error("error while trying to append buffer:"+i.message),n.unshift(r);var o={type:a.ErrorTypes.MEDIA_ERROR,parent:r.parent,details:"",fatal:!1};22===i.code?(this.segments=[],o.details=a.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,o.details=a.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>t.appendErrorMaxRetry&&(u.logger.log("fail "+t.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],o.fatal=!0)),e.trigger(l.default.ERROR,o)}}}},r.flushBuffer=function(t,e,n){var i=this.sourceBuffer;if(!Object.keys(i).length)return!0;var r="null";if(this.media&&(r=this.media.currentTime.toFixed(3)),u.logger.log("flushBuffer,pos/start/end: "+r+"/"+t+"/"+e),this.flushBufferCounter>=this.appended)return u.logger.warn("abort flushing too many retries"),!0;var s=i[n];if(s){if(s.ended=!1,s.updating)return u.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(n,s,t,e))return this.flushBufferCounter++,!1}return u.logger.log("buffer flushed"),!0},r.removeBufferRange=function(t,e,n,i){try{for(var r=0;r<e.buffered.length;r++){var s=e.buffered.start(r),o=e.buffered.end(r),a=Math.max(s,n),c=Math.min(o,i);if(Math.min(c,o)-a>.5){var l="null";return this.media&&(l=this.media.currentTime.toString()),u.logger.log("sb remove "+t+" ["+a+","+c+"], of ["+s+","+o+"], pos:"+l),e.remove(a,c),!0}}}catch(t){u.logger.warn("removeBufferRange failed",t)}return!1},i}(A);function qt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Yt=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.FPS_DROP_LEVEL_CAPPING,l.default.MEDIA_ATTACHING,l.default.MANIFEST_PARSED,l.default.LEVELS_UPDATED,l.default.BUFFER_CODECS,l.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n.clientRect=null,n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r,s,o,a=i.prototype;return a.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},a.onFpsDropLevelCapping=function(t){i.isLevelAllowed(t.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(t.droppedLevel)},a.onMediaAttaching=function(t){this.media=t.media instanceof window.HTMLVideoElement?t.media:null},a.onManifestParsed=function(t){var e=this.hls;this.restrictedLevels=[],this.levels=t.levels,this.firstLevel=t.firstLevel,e.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onBufferCodecs=function(t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()},a.onLevelsUpdated=function(t){this.levels=t.levels},a.onMediaDetaching=function(){this.stopCapping()},a.detectPlayerSize=function(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t-1),e.autoLevelCapping>this.autoLevelCapping&&e.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},a.getMaxLevel=function(t){var e=this;if(!this.levels)return-1;var n=this.levels.filter((function(n,r){return i.isLevelAllowed(r,e.restrictedLevels)&&r<=t}));return this.clientRect=null,i.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},a.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},a.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var n=t.getBoundingClientRect();e.width=n.width,e.height=n.height,e.width||e.height||(e.width=n.right-n.left||t.width||0,e.height=n.bottom-n.top||t.height||0)}return this.clientRect=e,e},i.isLevelAllowed=function(t,e){return void 0===e&&(e=[]),-1===e.indexOf(t)},i.getMaxLevelByMediaSize=function(t,e,n){if(!t||t&&!t.length)return-1;for(var i,r,s=t.length-1,o=0;o<t.length;o+=1){var a=t[o];if((a.width>=e||a.height>=n)&&(i=a,!(r=t[o+1])||i.width!==r.width||i.height!==r.height)){s=o;break}}return s},r=i,o=[{key:"contentScaleFactor",get:function(){var t=1;try{t=window.devicePixelRatio}catch(t){}return t}}],(s=[{key:"mediaWidth",get:function(){return this.getDimensions().width*i.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*i.contentScaleFactor}}])&&qt(r.prototype,s),o&&qt(r,o),i}(A);var $t=window.performance,Xt=function(t){var e,n;function i(e){return t.call(this,e,l.default.MEDIA_ATTACHING)||this}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=i.prototype;return r.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},r.onMediaAttaching=function(t){var e=this.hls.config;e.capLevelOnFPSDrop&&("function"==typeof(this.video=t.media instanceof window.HTMLVideoElement?t.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),e.fpsDroppedMonitoringPeriod))},r.checkFPS=function(t,e,n){var i=$t.now();if(e){if(this.lastTime){var r=i-this.lastTime,s=n-this.lastDroppedFrames,o=e-this.lastDecodedFrames,a=1e3*s/r,c=this.hls;if(c.trigger(l.default.FPS_DROP,{currentDropped:s,currentDecoded:o,totalDroppedFrames:n}),a>0&&s>c.config.fpsDroppedMonitoringThreshold*o){var d=c.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+d),d>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=d)&&(d-=1,c.trigger(l.default.FPS_DROP_LEVEL_CAPPING,{level:d,droppedLevel:c.currentLevel}),c.autoLevelCapping=d,c.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=n,this.lastDecodedFrames=e}},r.checkFPSInterval=function(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},i}(A),Jt=function(){function t(t){t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}var e=t.prototype;return e.destroy=function(){this.abort(),this.loader=null},e.abort=function(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},e.load=function(t,e,n){this.context=t,this.config=e,this.callbacks=n,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()},e.loadInternal=function(){var t,e=this.context;t=this.loader=new window.XMLHttpRequest;var n=this.stats;n.tfirst=0,n.loaded=0;var i=this.xhrSetup;try{if(i)try{i(t,e.url)}catch(n){t.open("GET",e.url,!0),i(t,e.url)}t.readyState||t.open("GET",e.url,!0)}catch(n){return void this.callbacks.onError({code:t.status,text:n.message},e,t)}e.rangeEnd&&t.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=e.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()},e.readystatechange=function(t){var e=t.currentTarget,n=e.readyState,i=this.stats,r=this.context,s=this.config;if(!i.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(window.performance.now(),i.trequest)),4===n){var o=e.status;if(o>=200&&o<300){var a,c;i.tload=Math.max(i.tfirst,window.performance.now()),c="arraybuffer"===r.responseType?(a=e.response).byteLength:(a=e.responseText).length,i.loaded=i.total=c;var l={url:e.responseURL,data:a};this.callbacks.onSuccess(l,i,r,e)}else i.retry>=s.maxRetry||o>=400&&o<499?(u.logger.error(o+" while loading "+r.url),this.callbacks.onError({code:o,text:e.statusText},r,e)):(u.logger.warn(o+" while loading "+r.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)},e.loadtimeout=function(){u.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},e.loadprogress=function(t){var e=t.currentTarget,n=this.stats;n.loaded=t.loaded,t.lengthComputable&&(n.total=t.total);var i=this.callbacks.onProgress;i&&i(n,this.context,null,e)},t}();function Zt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var te=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.MANIFEST_LOADING,l.default.MANIFEST_PARSED,l.default.AUDIO_TRACK_LOADED,l.default.AUDIO_TRACK_SWITCHED,l.default.LEVEL_LOADED,l.default.ERROR)||this)._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r,s,o,c=i.prototype;return c.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},c.onManifestParsed=function(t){var e=this.tracks=t.audioTracks||[];this.hls.trigger(l.default.AUDIO_TRACKS_UPDATED,{audioTracks:e}),this._selectAudioGroup(this.hls.nextLoadLevel)},c.onAudioTrackLoaded=function(t){if(t.id>=this.tracks.length)u.logger.warn("Invalid audio track id:",t.id);else{if(u.logger.log("audioTrack "+t.id+" loaded"),this.tracks[t.id].details=t.details,t.details.live&&!this.hasInterval()){var e=1e3*t.details.targetduration;this.setInterval(e)}!t.details.live&&this.hasInterval()&&this.clearInterval()}},c.onAudioTrackSwitched=function(t){var e=this.tracks[t.id].groupId;e&&this.audioGroupId!==e&&(this.audioGroupId=e)},c.onLevelLoaded=function(t){this._selectAudioGroup(t.level)},c.onError=function(t){t.type===a.ErrorTypes.NETWORK_ERROR&&(t.fatal&&this.clearInterval(),t.details===a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(u.logger.warn("Network failure on audio-track id:",t.context.id),this._handleLoadError()))},c._setAudioTrack=function(t){if(this._trackId===t&&this.tracks[this._trackId].details)u.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(t<0||t>=this.tracks.length)u.logger.warn("Invalid id passed to audio-track controller");else{var e=this.tracks[t];u.logger.log("Now switching to audio-track index "+t),this.clearInterval(),this._trackId=t;var n=e.url,i=e.type,r=e.id;this.hls.trigger(l.default.AUDIO_TRACK_SWITCHING,{id:r,type:i,url:n}),this._loadTrackDetailsIfNeeded(e)}},c.doTick=function(){this._updateTrack(this._trackId)},c._selectAudioGroup=function(t){var e=this.hls.levels[t];if(e&&e.audioGroupIds){var n=e.audioGroupIds[e.urlId];this.audioGroupId!==n&&(this.audioGroupId=n,this._selectInitialAudioTrack())}},c._selectInitialAudioTrack=function(){var t=this,e=this.tracks;if(e.length){var n=this.tracks[this._trackId],i=null;if(n&&(i=n.name),this._selectDefaultTrack){var r=e.filter((function(t){return t.default}));r.length?e=r:u.logger.warn("No default audio tracks defined")}var s=!1,o=function(){e.forEach((function(e){s||t.audioGroupId&&e.groupId!==t.audioGroupId||i&&i!==e.name||(t._setAudioTrack(e.id),s=!0)}))};o(),s||(i=null,o()),s||(u.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},c._needsTrackLoading=function(t){var e=t.details,n=t.url;return!(e&&!e.live)&&!!n},c._loadTrackDetailsIfNeeded=function(t){if(this._needsTrackLoading(t)){var e=t.url,n=t.id;u.logger.log("loading audio-track playlist for id: "+n),this.hls.trigger(l.default.AUDIO_TRACK_LOADING,{url:e,id:n})}},c._updateTrack=function(t){if(!(t<0||t>=this.tracks.length)){this.clearInterval(),this._trackId=t,u.logger.log("trying to update audio-track "+t);var e=this.tracks[t];this._loadTrackDetailsIfNeeded(e)}},c._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var t=this._trackId,e=this.tracks[t],n=e.name,i=e.language,r=e.groupId;u.logger.warn("Loading failed on audio track id: "+t+", group-id: "+r+', name/language: "'+n+'" / "'+i+'"');for(var s=t,o=0;o<this.tracks.length;o++){if(!this.trackIdBlacklist[o])if(this.tracks[o].name===n){s=o;break}}s!==t?(u.logger.log("Attempting audio-track fallback id:",s,"group-id:",this.tracks[s].groupId),this._setAudioTrack(s)):u.logger.warn('No fallback audio-track found for name/language: "'+n+'" / "'+i+'"')},r=i,(s=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(t){this._setAudioTrack(t),this._selectDefaultTrack=!1}}])&&Zt(r.prototype,s),o&&Zt(r,o),i}(ft);function ee(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var ne=window.performance,ie=function(t){var e,n;function i(e,n){var i;return(i=t.call(this,e,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.AUDIO_TRACKS_UPDATED,l.default.AUDIO_TRACK_SWITCHING,l.default.AUDIO_TRACK_LOADED,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.FRAG_PARSING_INIT_SEGMENT,l.default.FRAG_PARSING_DATA,l.default.FRAG_PARSED,l.default.ERROR,l.default.BUFFER_RESET,l.default.BUFFER_CREATED,l.default.BUFFER_APPENDED,l.default.BUFFER_FLUSHED,l.default.INIT_PTS_FOUND)||this).fragmentTracker=n,i.config=e.config,i.audioCodecSwap=!1,i._state=mt,i.initPTS=[],i.waitingFragment=null,i.videoTrackCC=null,i.waitingVideoCC=null,i}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r,s,o,d=i.prototype;return d.onInitPtsFound=function(t){var e=t.id,n=t.frag.cc,i=t.initPTS;"main"===e&&(this.initPTS[n]=i,this.videoTrackCC=n,u.logger.log("InitPTS for cc: "+n+" found from main: "+i),this.state===xt&&this.tick())},d.startLoad=function(t){if(this.tracks){var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&-1===t?(u.logger.log("audio:override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=vt):(this.lastCurrentTime=this.startPosition?this.startPosition:t,this.state=gt),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=t,this.state=mt},d.doTick=function(){var t,e,n,i=this.hls,r=i.config;switch(this.state){case It:case yt:case Ct:break;case gt:this.state=wt,this.loadedmetadata=!1;break;case vt:var s=this.tracks;if(!s)break;if(!this.media&&(this.startFragRequested||!r.startFragPrefetch))break;if(this.loadedmetadata)t=this.media.currentTime;else if(void 0===(t=this.nextLoadPosition))break;var o=this.mediaBuffer?this.mediaBuffer:this.media,a=this.videoBuffer?this.videoBuffer:this.media,d=t<r.maxBufferHole?Math.max(2,r.maxBufferHole):r.maxBufferHole,h=Q.bufferInfo(o,t,d),A=Q.bufferInfo(a,t,d),p=h.len,f=h.end,m=this.fragPrevious,g=Math.min(r.maxBufferLength,r.maxMaxBufferLength),v=Math.max(g,A.len),y=this.audioSwitch,_=this.trackId;if((p<v||y)&&_<s.length){if(void 0===(n=s[_].details)){this.state=wt;break}if(!y&&this._streamEnded(h,n))return this.hls.trigger(l.default.BUFFER_EOS,{type:"audio"}),void(this.state=Rt);var b,E=n.fragments,w=E.length,S=E[0].start,T=E[w-1].start+E[w-1].duration;if(y)if(n.live&&!n.PTSKnown)u.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),f=0;else if(f=t,n.PTSKnown&&t<S){if(!(h.end>S||h.nextStart))return;u.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=S+.05}if(n.initSegment&&!n.initSegment.data)b=n.initSegment;else if(f<=S){if(b=E[0],null!==this.videoTrackCC&&b.cc!==this.videoTrackCC&&(b=function(t,e){return G.search(t,(function(t){return t.cc<e?1:t.cc>e?-1:0}))}(E,this.videoTrackCC)),n.live&&b.loadIdx&&b.loadIdx===this.fragLoadIdx){var C=h.nextStart?h.nextStart:S;return u.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(C+.05)),void(this.media.currentTime=C+.05)}}else{var R,I=r.maxFragLookUpTolerance,x=m?E[m.sn-E[0].sn+1]:void 0;f<T?(f>T-I&&(I=0),R=x&&!dt(f,I,x)?x:G.search(E,(function(t){return dt(f,I,t)}))):R=E[w-1],R&&(b=R,S=R.start,m&&b.level===m.level&&b.sn===m.sn&&(b.sn<n.endSN?(b=E[b.sn+1-n.startSN],this.fragmentTracker.getState(b)!==V&&u.logger.log("SN just loaded, load next one: "+b.sn)):b=null))}b&&(b.encrypted?(u.logger.log("Loading key for "+b.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+_),this.state=_t,i.trigger(l.default.KEY_LOADING,{frag:b})):(this.fragCurrent=b,(y||this.fragmentTracker.getState(b)===U)&&(u.logger.log("Loading "+b.sn+", cc: "+b.cc+" of ["+n.startSN+" ,"+n.endSN+"],track "+_+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+t+", bufferEnd: "+f.toFixed(3)),"initSegment"!==b.sn&&(this.startFragRequested=!0),Object(c.isFiniteNumber)(b.sn)&&(this.nextLoadPosition=b.start+b.duration),i.trigger(l.default.FRAG_LOADING,{frag:b}),this.state=bt)))}break;case wt:(e=this.tracks[this.trackId])&&e.details&&(this.state=vt);break;case Et:var O=ne.now(),L=this.retryDate,M=(o=this.media)&&o.seeking;(!L||O>=L||M)&&(u.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=vt);break;case xt:var k=this.waitingFragment;if(k){var N=k.frag.cc;if(void 0!==this.initPTS[N])this.waitingFragment=null,this.state=bt,this.onFragLoaded(k);else if(this.videoTrackCC!==this.waitingVideoCC)u.logger.log("Waiting fragment cc ("+N+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var P=Q.bufferInfo(this.mediaBuffer,this.media.currentTime,r.maxBufferHole);dt(P.end,r.maxFragLookUpTolerance,k.frag)<0&&(u.logger.log("Waiting fragment cc ("+N+") @ "+k.frag.start+" cancelled because another fragment at "+P.end+" is needed"),this.clearWaitingFragment())}}else this.state=vt}},d.clearWaitingFragment=function(){var t=this.waitingFragment;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=vt)},d.onMediaAttached=function(t){var e=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),e.addEventListener("seeking",this.onvseeking),e.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)},d.onMediaDetaching=function(){var t=this.media;t&&t.ended&&(u.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},d.onAudioTracksUpdated=function(t){u.logger.log("audio tracks updated"),this.tracks=t.audioTracks},d.onAudioTrackSwitching=function(t){var e=!!t.url;this.trackId=t.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=yt,e?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),e&&(this.audioSwitch=!0,this.state=vt),this.tick()},d.onAudioTrackLoaded=function(t){var e=t.details,n=t.id,i=this.tracks[n],r=e.totalduration,s=0;if(u.logger.log("track "+n+" loaded ["+e.startSN+","+e.endSN+"],duration:"+r),e.live){var o=i.details;o&&e.fragments.length>0?(it(o,e),s=e.fragments[0].start,e.PTSKnown?u.logger.log("live audio playlist sliding:"+s.toFixed(3)):u.logger.log("live audio playlist - outdated PTS, unknown sliding")):(e.PTSKnown=!1,u.logger.log("live audio playlist - first load, unknown sliding"))}else e.PTSKnown=!1;if(i.details=e,!this.startFragRequested){if(-1===this.startPosition){var a=e.startTimeOffset;Object(c.isFiniteNumber)(a)?(u.logger.log("start time offset found in playlist, adjust startPosition to "+a),this.startPosition=a):e.live?(this.startPosition=this.computeLivePosition(s,e),u.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===wt&&(this.state=vt),this.tick()},d.onKeyLoaded=function(){this.state===_t&&(this.state=vt,this.tick())},d.onFragLoaded=function(t){var e=this.fragCurrent,n=t.frag;if(this.state===bt&&e&&"audio"===n.type&&n.level===e.level&&n.sn===e.sn){var i=this.tracks[this.trackId],r=i.details,s=r.totalduration,o=e.level,a=e.sn,c=e.cc,d=this.config.defaultAudioCodec||i.audioCodec||"mp4a.40.2",h=this.stats=t.stats;if("initSegment"===a)this.state=vt,h.tparsed=h.tbuffered=ne.now(),r.initSegment.data=t.payload,this.hls.trigger(l.default.FRAG_BUFFERED,{stats:h,frag:e,id:"audio"}),this.tick();else{this.state=St,this.appended=!1,this.demuxer||(this.demuxer=new Z(this.hls,"audio"));var A=this.initPTS[c],p=r.initSegment?r.initSegment.data:[];if(void 0!==A){this.pendingBuffering=!0,u.logger.log("Demuxing "+a+" of ["+r.startSN+" ,"+r.endSN+"],track "+o);this.demuxer.push(t.payload,p,d,null,e,s,!1,A)}else u.logger.log("Unknown video PTS for cc "+c+", waiting for video PTS before demuxing audio frag "+a+" of ["+r.startSN+" ,"+r.endSN+"],track "+o),this.waitingFragment=t,this.waitingVideoCC=this.videoTrackCC,this.state=xt}}this.fragLoadError=0},d.onFragParsingInitSegment=function(t){var e=this.fragCurrent,n=t.frag;if(e&&"audio"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===St){var i,r=t.tracks;if(r.video&&delete r.video,i=r.audio){i.levelCodec=i.codec,i.id=t.id,this.hls.trigger(l.default.BUFFER_CODECS,r),u.logger.log("audio track:audio,container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var s=i.initSegment;if(s){var o={type:"audio",data:s,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[o]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(l.default.BUFFER_APPENDING,o))}this.tick()}}},d.onFragParsingData=function(t){var e=this,n=this.fragCurrent,i=t.frag;if(n&&"audio"===t.id&&"audio"===t.type&&i.sn===n.sn&&i.level===n.level&&this.state===St){var r=this.trackId,s=this.tracks[r],o=this.hls;Object(c.isFiniteNumber)(t.endPTS)||(t.endPTS=t.startPTS+n.duration,t.endDTS=t.startDTS+n.duration),n.addElementaryStream(m.AUDIO),u.logger.log("parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb),nt(s.details,n,t.startPTS,t.endPTS);var d=this.media,h=!1;if(this.audioSwitch)if(d&&d.readyState){var A=d.currentTime;u.logger.log("switching audio track : currentTime:"+A),A>=t.startPTS&&(u.logger.log("switching audio track : flushing all audio"),this.state=Ct,o.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),h=!0,this.audioSwitch=!1,o.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:r}))}else this.audioSwitch=!1,o.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:r});var p=this.pendingData;if(!p)return u.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void o.trigger(l.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([t.data1,t.data2].forEach((function(e){e&&e.length&&p.push({type:t.type,data:e,parent:"audio",content:"data"})})),!h&&p.length&&(p.forEach((function(t){e.state===St&&(e.pendingBuffering=!0,e.hls.trigger(l.default.BUFFER_APPENDING,t))})),this.pendingData=[],this.appended=!0)),this.tick()}},d.onFragParsed=function(t){var e=this.fragCurrent,n=t.frag;e&&"audio"===t.id&&n.sn===e.sn&&n.level===e.level&&this.state===St&&(this.stats.tparsed=ne.now(),this.state=Tt,this._checkAppendedParsed())},d.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},d.onBufferCreated=function(t){var e=t.tracks.audio;e&&(this.mediaBuffer=e.buffer,this.loadedmetadata=!0),t.tracks.video&&(this.videoBuffer=t.tracks.video.buffer)},d.onBufferAppended=function(t){if("audio"===t.parent){var e=this.state;e!==St&&e!==Tt||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}},d._checkAppendedParsed=function(){if(!(this.state!==Tt||this.appended&&this.pendingBuffering)){var t=this.fragCurrent,e=this.stats,n=this.hls;if(t){this.fragPrevious=t,e.tbuffered=ne.now(),n.trigger(l.default.FRAG_BUFFERED,{stats:e,frag:t,id:"audio"});var i=this.mediaBuffer?this.mediaBuffer:this.media;i&&u.logger.log("audio buffered : "+ot.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(l.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=vt}this.tick()}},d.onError=function(t){var e=t.frag;if(!e||"audio"===e.type)switch(t.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:var n=t.frag;if(n&&"audio"!==n.type)break;if(!t.fatal){var i=this.fragLoadError;i?i++:i=1;var r=this.config;if(i<=r.fragLoadingMaxRetry){this.fragLoadError=i;var s=Math.min(Math.pow(2,i-1)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);u.logger.warn("AudioStreamController: frag loading failed, retry in "+s+" ms"),this.retryDate=ne.now()+s,this.state=Et}else u.logger.error("AudioStreamController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=It}break;case a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==It&&(this.state=t.fatal?It:vt,u.logger.warn("AudioStreamController: "+t.details+" while loading frag, now switching to "+this.state+" state ..."));break;case a.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===t.parent&&(this.state===St||this.state===Tt)){var o=this.mediaBuffer,c=this.media.currentTime;if(o&&Q.isBuffered(o,c)&&Q.isBuffered(o,c+.5)){var d=this.config;d.maxMaxBufferLength>=d.maxBufferLength&&(d.maxMaxBufferLength/=2,u.logger.warn("AudioStreamController: reduce max buffer length to "+d.maxMaxBufferLength+"s")),this.state=vt}else u.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Ct,this.hls.trigger(l.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},d.onBufferFlushed=function(){var t=this,e=this.pendingData;e&&e.length?(u.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),e.forEach((function(e){t.hls.trigger(l.default.BUFFER_APPENDING,e)})),this.appended=!0,this.pendingData=[],this.state=Tt):(this.state=vt,this.fragPrevious=null,this.tick())},r=i,(s=[{key:"state",set:function(t){if(this.state!==t){var e=this.state;this._state=t,u.logger.log("audio stream:"+e+"->"+t)}},get:function(){return this._state}}])&&ee(r.prototype,s),o&&ee(r,o),i}(Lt),re=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var t={"":!0,lr:!0,rl:!0},e={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(t){return"string"==typeof t&&(!!e[t.toLowerCase()]&&t.toLowerCase())}function i(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}function r(e,r,s){var o=this,a={enumerable:!0};o.hasBeenReset=!1;var c="",l=!1,u=e,d=r,h=s,A=null,p="",f=!0,m="auto",g="start",v=50,y="middle",_=50,b="middle";Object.defineProperty(o,"id",i({},a,{get:function(){return c},set:function(t){c=""+t}})),Object.defineProperty(o,"pauseOnExit",i({},a,{get:function(){return l},set:function(t){l=!!t}})),Object.defineProperty(o,"startTime",i({},a,{get:function(){return u},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");u=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},a,{get:function(){return d},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},a,{get:function(){return h},set:function(t){h=""+t,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},a,{get:function(){return A},set:function(t){A=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},a,{get:function(){return p},set:function(e){var n=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");p=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},a,{get:function(){return f},set:function(t){f=!!t,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},a,{get:function(){return m},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},a,{get:function(){return g},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},a,{get:function(){return v},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},a,{get:function(){return y},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},a,{get:function(){return _},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},a,{get:function(){return b},set:function(t){var e=n(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");b=e,this.hasBeenReset=!0}})),o.displayState=void 0}return r.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},r}(),se=function(){return{decode:function(t){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))}}};function oe(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new se,this.regionList=[]}function ae(){this.values=Object.create(null)}function ce(t,e,n,i){var r=i?t.split(i):[t];for(var s in r)if("string"==typeof r[s]){var o=r[s].split(n);if(2===o.length)e(o[0],o[1])}}ae.prototype={set:function(t,e){this.get(t)||""===e||(this.values[t]=e)},get:function(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e},has:function(t){return t in this.values},alt:function(t,e,n){for(var i=0;i<n.length;++i)if(e===n[i]){this.set(t,e);break}},integer:function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},percent:function(t,e){return!!(e.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(e=parseFloat(e))>=0&&e<=100)&&(this.set(t,e),!0)}};var le=new re(0,0,0),ue="middle"===le.align?"middle":"center";function de(t,e,n){var i=t;function r(){var e=function(t){function e(t,e,n,i){return 3600*(0|t)+60*(0|e)+(0|n)+(0|i)/1e3}var n=t.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?e(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?e(n[1],n[2],0,n[4]):e(0,n[1],n[2],n[4]):null}(t);if(null===e)throw new Error("Malformed timestamp: "+i);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function s(){t=t.replace(/^\s+/,"")}if(s(),e.startTime=r(),s(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+i);t=t.substr(3),s(),e.endTime=r(),s(),function(t,e){var i=new ae;ce(t,(function(t,e){switch(t){case"region":for(var r=n.length-1;r>=0;r--)if(n[r].id===e){i.set(t,n[r].region);break}break;case"vertical":i.alt(t,e,["rl","lr"]);break;case"line":var s=e.split(","),o=s[0];i.integer(t,o),i.percent(t,o)&&i.set("snapToLines",!1),i.alt(t,o,["auto"]),2===s.length&&i.alt("lineAlign",s[1],["start",ue,"end"]);break;case"position":s=e.split(","),i.percent(t,s[0]),2===s.length&&i.alt("positionAlign",s[1],["start",ue,"end","line-left","line-right","auto"]);break;case"size":i.percent(t,e);break;case"align":i.alt(t,e,["start",ue,"end","left","right"])}}),/:/,/\s/),e.region=i.get("region",null),e.vertical=i.get("vertical","");var r=i.get("line","auto");"auto"===r&&-1===le.line&&(r=-1),e.line=r,e.lineAlign=i.get("lineAlign","start"),e.snapToLines=i.get("snapToLines",!0),e.size=i.get("size",100),e.align=i.get("align",ue);var s=i.get("position","auto");"auto"===s&&50===le.position&&(s="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=s}(t,e)}function he(t){return t.replace(/<br(?: \/)?>/gi,"\n")}oe.prototype={parse:function(t){var e=this;function n(){var t=e.buffer,n=0;for(t=he(t);n<t.length&&"\r"!==t[n]&&"\n"!==t[n];)++n;var i=t.substr(0,n);return"\r"===t[n]&&++n,"\n"===t[n]&&++n,e.buffer=t.substr(n),i}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var i;if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var r=(i=n()).match(/^(Ã¯Â»Â¿)?WEBVTT([ \t].*)?$/);if(!r||!r[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var s=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(s?s=!1:i=n(),e.state){case"HEADER":/:/.test(i)?ce(i,(function(t,e){}),/:/):i||(e.state="ID");continue;case"NOTE":i||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){e.state="NOTE";break}if(!i)continue;if(e.cue=new re(0,0,""),e.state="CUE",-1===i.indexOf("--\x3e")){e.cue.id=i;continue}case"CUE":try{de(i,e.cue,e.regionList)}catch(t){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var o=-1!==i.indexOf("--\x3e");if(!i||o&&(s=!0)){e.oncue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}e.cue.text&&(e.cue.text+="\n"),e.cue.text+=i;continue;case"BADCUE":i||(e.state="ID");continue}}}catch(t){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var t=this;try{if(t.buffer+=t.decoder.decode(),(t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state)throw new Error("Malformed WebVTT signature.")}catch(t){throw t}return t.onflush&&t.onflush(),this}};var Ae=oe;function pe(t,e,n,i){for(var r,s,o,a,c,l=[],u=window.VTTCue||TextTrackCue,d=0;d<i.rows.length;d++)if(o=!0,a=0,c="",!(r=i.rows[d]).isEmpty()){for(var h=0;h<r.chars.length;h++)r.chars[h].uchar.match(/\s/)&&o?a++:(c+=r.chars[h].uchar,o=!1);r.cueStartTime=e,e===n&&(n+=1e-4),s=new u(e,n,he(c.trim())),a>=16?a--:a++,navigator.userAgent.match(/Firefox\//)?s.line=d+1:s.line=d>7?d-2:d+1,s.align="left",s.position=Math.max(0,Math.min(100,a/32*100)),l.push(s),t&&t.addCue(s)}return l}var fe,me={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ge=function(t){var e=t;return me.hasOwnProperty(t)&&(e=me[t]),String.fromCharCode(e)},ve=15,ye=100,_e={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},be={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Ee={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},we={25:2,26:4,29:6,30:8,31:10,27:13,28:15},Se=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(t){t[t.ERROR=0]="ERROR",t[t.TEXT=1]="TEXT",t[t.WARNING=2]="WARNING",t[t.INFO=2]="INFO",t[t.DEBUG=3]="DEBUG",t[t.DATA=3]="DATA"}(fe||(fe={}));var Te=function(){function t(){this.time=null,this.verboseLevel=fe.ERROR}return t.prototype.log=function(t,e){this.verboseLevel>=t&&u.logger.log(this.time+" ["+t+"] "+e)},t}(),Ce=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].toString(16));return e},Re=function(){function t(t,e,n,i,r){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=n||!1,this.background=i||"black",this.flash=r||!1}var e=t.prototype;return e.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],n=0;n<e.length;n++){var i=e[n];t.hasOwnProperty(i)&&(this[i]=t[i])}},e.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},e.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},e.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),Ie=function(){function t(t,e,n,i,r,s){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new Re(e,n,i,r,s)}var e=t.prototype;return e.reset=function(){this.uchar=" ",this.penState.reset()},e.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},e.setPenState=function(t){this.penState.copy(t)},e.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},e.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},e.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),xe=function(){function t(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<ye;e++)this.chars.push(new Ie);this.logger=t,this.pos=0,this.currPenState=new Re}var e=t.prototype;return e.equals=function(t){for(var e=!0,n=0;n<ye;n++)if(!this.chars[n].equals(t.chars[n])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<ye;e++)this.chars[e].copy(t.chars[e])},e.isEmpty=function(){for(var t=!0,e=0;e<ye;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(fe.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>ye&&(this.logger.log(fe.DEBUG,"Too large cursor position "+this.pos),this.pos=ye)},e.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var n=this.pos+1;n<e+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(e)},e.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.insertChar=function(t){t>=144&&this.backSpace();var e=ge(t);this.pos>=ye?this.logger.log(fe.ERROR,"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},e.clearFromPos=function(t){var e;for(e=t;e<ye;e++)this.chars[e].reset()},e.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.getTextString=function(){for(var t=[],e=!0,n=0;n<ye;n++){var i=this.chars[n].uchar;" "!==i&&(e=!1),t.push(i)}return e?"":t.join("")},e.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),Oe=function(){function t(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<ve;e++)this.rows.push(new xe(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var e=t.prototype;return e.reset=function(){for(var t=0;t<ve;t++)this.rows[t].clear();this.currRow=14},e.equals=function(t){for(var e=!0,n=0;n<ve;n++)if(!this.rows[n].equals(t.rows[n])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<ve;e++)this.rows[e].copy(t.rows[e])},e.isEmpty=function(){for(var t=!0,e=0;e<ve;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.backSpace=function(){this.rows[this.currRow].backSpace()},e.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.insertChar=function(t){this.rows[this.currRow].insertChar(t)},e.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},e.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},e.setCursor=function(t){this.logger.log(fe.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},e.setPAC=function(t){this.logger.log(fe.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var n=0;n<ve;n++)this.rows[n].clear();var i=this.currRow+1-this.nrRollUpRows,r=this.lastOutputScreen;if(r){var s=r.rows[i].cueStartTime,o=this.logger.time;if(s&&null!==o&&s<o)for(var a=0;a<this.nrRollUpRows;a++)this.rows[e-this.nrRollUpRows+a+1].copy(r.rows[i+a])}}this.currRow=e;var c=this.rows[this.currRow];if(null!==t.indent){var l=t.indent,u=Math.max(l-1,0);c.setCursor(t.indent),t.color=c.chars[u].penState.foreground}var d={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(d)},e.setBkgData=function(t){this.logger.log(fe.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},e.setRollUpRows=function(t){this.nrRollUpRows=t},e.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(fe.TEXT,this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(fe.INFO,"Rolling up")}else this.logger.log(fe.DEBUG,"roll_up but nrRollUpRows not set yet")},e.getDisplayText=function(t){t=t||!1;for(var e=[],n="",i=-1,r=0;r<ve;r++){var s=this.rows[r].getTextString();s&&(i=r+1,t?e.push("Row "+i+": '"+s+"'"):e.push(s.trim()))}return e.length>0&&(n=t?"["+e.join(" | ")+"]":e.join("\n")),n},e.getTextAndFormat=function(){return this.rows},t}(),Le=function(){function t(t,e,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new Oe(n),this.nonDisplayedMemory=new Oe(n),this.lastOutputScreen=new Oe(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var e=t.prototype;return e.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},e.getHandler=function(){return this.outputFilter},e.setHandler=function(t){this.outputFilter=t},e.setPAC=function(t){this.writeScreen.setPAC(t)},e.setBkgData=function(t){this.writeScreen.setBkgData(t)},e.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(fe.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},e.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(fe.INFO,n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(fe.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.ccRCL=function(){this.logger.log(fe.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.ccBS=function(){this.logger.log(fe.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.ccAOF=function(){},e.ccAON=function(){},e.ccDER=function(){this.logger.log(fe.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.ccRU=function(t){this.logger.log(fe.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},e.ccFON=function(){this.logger.log(fe.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.ccRDC=function(){this.logger.log(fe.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.ccTR=function(){this.logger.log(fe.INFO,"TR"),this.setMode("MODE_TEXT")},e.ccRTD=function(){this.logger.log(fe.INFO,"RTD"),this.setMode("MODE_TEXT")},e.ccEDM=function(){this.logger.log(fe.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.ccCR=function(){this.logger.log(fe.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.ccENM=function(){this.logger.log(fe.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.ccEOC=function(){if(this.logger.log(fe.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(fe.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.ccTO=function(t){this.logger.log(fe.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},e.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var n=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(fe.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},e.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},e.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),Me=function(){function t(t,e,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var i=new Te;this.channels=[null,new Le(t,e,i),new Le(t+1,n,i)],this.cmdHistory={a:null,b:null},this.logger=i}var e=t.prototype;return e.getHandler=function(t){return this.channels[t].getHandler()},e.setHandler=function(t,e){this.channels[t].setHandler(e)},e.addData=function(t,e){var n,i,r,s=!1;this.logger.time=t;for(var o=0;o<e.length;o+=2)if(i=127&e[o],r=127&e[o+1],0!==i||0!==r){if(this.logger.log(fe.DATA,"["+Ce([e[o],e[o+1]])+"] -> ("+Ce([i,r])+")"),(n=this.parseCmd(i,r))||(n=this.parseMidrow(i,r)),n||(n=this.parsePAC(i,r)),n||(n=this.parseBackgroundAttributes(i,r)),!n&&(s=this.parseChars(i,r))){var a=this.currentChannel;if(a&&a>0)this.channels[a].insertChars(s);else this.logger.log(fe.WARNING,"No channel found yet. TEXT-MODE?")}n||s||this.logger.log(fe.WARNING,"Couldn't parse cleaned data "+Ce([i,r])+" orig: "+Ce([e[o],e[o+1]]))}},e.parseCmd=function(t,e){var n=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47)&&!((23===t||31===t)&&e>=33&&e<=35))return!1;if(Ne(t,e,n))return ke(null,null,n),this.logger.log(fe.DEBUG,"Repeated command ("+Ce([t,e])+") is dropped"),!0;var i=20===t||21===t||23===t?1:2,r=this.channels[i];return 20===t||21===t||28===t||29===t?32===e?r.ccRCL():33===e?r.ccBS():34===e?r.ccAOF():35===e?r.ccAON():36===e?r.ccDER():37===e?r.ccRU(2):38===e?r.ccRU(3):39===e?r.ccRU(4):40===e?r.ccFON():41===e?r.ccRDC():42===e?r.ccTR():43===e?r.ccRTD():44===e?r.ccEDM():45===e?r.ccCR():46===e?r.ccENM():47===e&&r.ccEOC():r.ccTO(e-32),ke(t,e,n),this.currentChannel=i,!0},e.parseMidrow=function(t,e){var n=0;if((17===t||25===t)&&e>=32&&e<=47){if((n=17===t?1:2)!==this.currentChannel)return this.logger.log(fe.ERROR,"Mismatch channel in midrow parsing"),!1;var i=this.channels[n];return!!i&&(i.ccMIDROW(e),this.logger.log(fe.DEBUG,"MIDROW ("+Ce([t,e])+")"),!0)}return!1},e.parsePAC=function(t,e){var n,i=this.cmdHistory;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127)&&!((16===t||24===t)&&e>=64&&e<=95))return!1;if(Ne(t,e,i))return ke(null,null,i),!0;var r=t<=23?1:2;n=e>=64&&e<=95?1===r?_e[t]:Ee[t]:1===r?be[t]:we[t];var s=this.channels[r];return!!s&&(s.setPAC(this.interpretPAC(n,e)),ke(t,e,i),this.currentChannel=r,!0)},e.interpretPAC=function(t,e){var n=e,i={color:null,italics:!1,indent:null,underline:!1,row:t};return n=e>95?e-96:e-64,i.underline=1==(1&n),n<=13?i.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(i.italics=!0,i.color="white"):i.indent=4*Math.floor((n-16)/2),i},e.parseChars=function(t,e){var n,i=null,r=null;if(t>=25?(n=2,r=t-8):(n=1,r=t),r>=17&&r<=19){var s=e;s=17===r?e+80:18===r?e+112:e+144,this.logger.log(fe.INFO,"Special char '"+ge(s)+"' in channel "+n),i=[s]}else t>=32&&t<=127&&(i=0===e?[t]:[t,e]);if(i){var o=Ce(i);this.logger.log(fe.DEBUG,"Char codes =  "+o.join(",")),ke(t,e,this.cmdHistory)}return i},e.parseBackgroundAttributes=function(t,e){var n;if(!((16===t||24===t)&&e>=32&&e<=47)&&!((23===t||31===t)&&e>=45&&e<=47))return!1;var i={};16===t||24===t?(n=Math.floor((e-32)/2),i.background=Se[n],e%2==1&&(i.background=i.background+"_semi")):45===e?i.background="transparent":(i.foreground="black",47===e&&(i.underline=!0));var r=t<=23?1:2;return this.channels[r].setBkgData(i),ke(t,e,this.cmdHistory),!0},e.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory={a:null,b:null}},e.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var n=this.channels[e];n&&n.cueSplitAtTime(t)}},t}();function ke(t,e,n){n.a=t,n.b=e}function Ne(t,e,n){return n.a===t&&n.b===e}var Pe=Me,De=function(){function t(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var e=t.prototype;return e.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},e.newCue=function(t,e,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},e.reset=function(){this.cueRanges=[]},t}(),Be=function(t,e,n){return t.substr(n||0,e.length)===e},Ue=function(t){for(var e=5381,n=t.length;n;)e=33*e^t.charCodeAt(--n);return(e>>>0).toString()},Fe={parse:function(t,e,n,i,r,s){var o,a=Object(Bt.utf8ArrayToStr)(new Uint8Array(t)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),l="00:00.000",u=0,d=0,h=0,A=[],p=!0,f=!1,m=new Ae;m.oncue=function(t){var e=n[i],r=n.ccOffset;e&&e.new&&(void 0!==d?r=n.ccOffset=e.start:function(t,e,n){var i=t[e],r=t[i.prevCC];if(!r||!r.new&&i.new)return t.ccOffset=t.presentationOffset=i.start,void(i.new=!1);for(;r&&r.new;)t.ccOffset+=i.start-r.start,i.new=!1,r=t[(i=r).prevCC];t.presentationOffset=n}(n,i,h)),h&&(r=h-n.presentationOffset),f&&(t.startTime+=r-d,t.endTime+=r-d),t.id=Ue(t.startTime.toString())+Ue(t.endTime.toString())+Ue(t.text),t.text=decodeURIComponent(encodeURIComponent(t.text)),t.endTime>0&&A.push(t)},m.onparsingerror=function(t){o=t},m.onflush=function(){o&&s?s(o):r(A)},a.forEach((function(t){if(p){if(Be(t,"X-TIMESTAMP-MAP=")){p=!1,f=!0,t.substr(16).split(",").forEach((function(t){Be(t,"LOCAL:")?l=t.substr(6):Be(t,"MPEGTS:")&&(u=parseInt(t.substr(7)))}));try{e+(9e4*n[i].start||0)<0&&(e+=8589934592),u-=e,d=function(t){var e=parseInt(t.substr(-3)),n=parseInt(t.substr(-6,2)),i=parseInt(t.substr(-9,2)),r=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;if(!(Object(c.isFiniteNumber)(e)&&Object(c.isFiniteNumber)(n)&&Object(c.isFiniteNumber)(i)&&Object(c.isFiniteNumber)(r)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*n,e+=6e4*i,e+36e5*r}(l)/1e3,h=u/9e4}catch(t){f=!1,o=t}return}""===t&&(p=!1)}m.parse(t+"\n")})),m.flush()}};function He(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ve(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}var je=function(t){var e,n;function i(e){var n;if((n=t.call(this,e,l.default.MEDIA_ATTACHING,l.default.MEDIA_DETACHING,l.default.FRAG_PARSING_USERDATA,l.default.FRAG_DECRYPTED,l.default.MANIFEST_LOADING,l.default.MANIFEST_LOADED,l.default.FRAG_LOADED,l.default.INIT_PTS_FOUND)||this).media=null,n.config=void 0,n.enabled=!0,n.Cues=void 0,n.textTracks=[],n.tracks=[],n.initPTS=[],n.unparsedVttFrags=[],n.captionsTracks={},n.nonNativeCaptionsTracks={},n.captionsProperties=void 0,n.cea608Parser1=void 0,n.cea608Parser2=void 0,n.lastSn=-1,n.prevCC=-1,n.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},n.hls=e,n.config=e.config,n.Cues=e.config.cueHandler,n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode},textTrack3:{label:n.config.captionsTextTrack3Label,languageCode:n.config.captionsTextTrack3LanguageCode},textTrack4:{label:n.config.captionsTextTrack4Label,languageCode:n.config.captionsTextTrack4LanguageCode}},n.config.enableCEA708Captions){var i=new De(He(n),"textTrack1"),r=new De(He(n),"textTrack2"),s=new De(He(n),"textTrack3"),o=new De(He(n),"textTrack4");n.cea608Parser1=new Pe(1,i,r),n.cea608Parser2=new Pe(3,s,o)}return n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=i.prototype;return r.addCues=function(t,e,n,i,r){for(var s,o,a,c,u=!1,d=r.length;d--;){var h=r[d],A=(s=h[0],o=h[1],a=e,c=n,Math.min(o,c)-Math.max(s,a));if(A>=0&&(h[0]=Math.min(h[0],e),h[1]=Math.max(h[1],n),u=!0,A/(n-e)>.5))return}if(u||r.push([e,n]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[t],e,n,i);else{var p=this.Cues.newCue(null,e,n,i);this.hls.trigger(l.default.CUES_PARSED,{type:"captions",cues:p,track:t})}},r.onInitPtsFound=function(t){var e=this,n=t.frag,i=t.id,r=t.initPTS,s=this.unparsedVttFrags;"main"===i&&(this.initPTS[n.cc]=r),s.length&&(this.unparsedVttFrags=[],s.forEach((function(t){e.onFragLoaded(t)})))},r.getExistingTrack=function(t){var e=this.media;if(e)for(var n=0;n<e.textTracks.length;n++){var i=e.textTracks[n];if(i[t])return i}return null},r.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},r.createNativeTrack=function(t){if(!this.captionsTracks[t]){var e=this.captionsProperties,n=this.captionsTracks,i=this.media,r=e[t],s=r.label,o=r.languageCode,a=this.getExistingTrack(t);if(a)n[t]=a,Ft(n[t]),Ut(n[t],i);else{var c=this.createTextTrack("captions",s,o);c&&(c[t]=!0,n[t]=c)}}},r.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var n={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(l.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},r.createTextTrack=function(t,e,n){var i=this.media;if(i)return i.addTextTrack(t,e,n)},r.destroy=function(){t.prototype.destroy.call(this)},r.onMediaAttaching=function(t){this.media=t.media,this._cleanTracks()},r.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach((function(e){Ft(t[e]),delete t[e]})),this.nonNativeCaptionsTracks={}},r.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},r._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var n=0;n<e.length;n++)Ft(e[n])}},r.onManifestLoaded=function(t){var e=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var n=t.subtitles||[],i=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=t.subtitles||[],this.config.renderTextTracksNatively){var r=this.media?this.media.textTracks:[];this.tracks.forEach((function(t,n){var i;if(n<r.length){for(var s=null,o=0;o<r.length;o++)if(Ve(r[o],t)){s=r[o];break}s&&(i=s)}i||(i=e.createTextTrack("subtitles",t.name,t.lang)),t.default?i.mode=e.hls.subtitleDisplay?"showing":"hidden":i.mode="disabled",e.textTracks.push(i)}))}else if(!i&&this.tracks&&this.tracks.length){var s=this.tracks.map((function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}));this.hls.trigger(l.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:s})}}this.config.enableCEA708Captions&&t.captions&&t.captions.forEach((function(t){var n=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(n){var i="textTrack"+n[1],r=e.captionsProperties[i];r&&(r.label=t.name,t.lang&&(r.languageCode=t.lang),r.media=t)}}))},r.onFragLoaded=function(t){var e=t.frag,n=t.payload,i=this.cea608Parser1,r=this.cea608Parser2,s=this.initPTS,o=this.lastSn,a=this.unparsedVttFrags;if("main"===e.type){var u=e.sn;e.sn!==o+1&&i&&r&&(i.reset(),r.reset()),this.lastSn=u}else if("subtitle"===e.type)if(n.byteLength){if(!Object(c.isFiniteNumber)(s[e.cc]))return a.push(t),void(s.length&&this.hls.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e}));var d=e.decryptdata;null!=d&&null!=d.key&&"AES-128"===d.method||this._parseVTTs(e,n)}else this.hls.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})},r._parseVTTs=function(t,e){var n=this,i=this.hls,r=this.prevCC,s=this.textTracks,o=this.vttCCs;o[t.cc]||(o[t.cc]={start:t.start,prevCC:r,new:!0},this.prevCC=t.cc),Fe.parse(e,this.initPTS[t.cc],o,t.cc,(function(e){if(n.config.renderTextTracksNatively){var r=s[t.level];if("disabled"===r.mode)return void i.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t});e.forEach((function(t){if(!r.cues.getCueById(t.id))try{if(r.addCue(t),!r.cues.getCueById(t.id))throw new Error("addCue is failed for: "+t)}catch(n){u.logger.debug("Failed occurred on adding cues: "+n);var e=new window.TextTrackCue(t.startTime,t.endTime,t.text);e.id=t.id,r.addCue(e)}}))}else{var o=n.tracks[t.level].default?"default":"subtitles"+t.level;i.trigger(l.default.CUES_PARSED,{type:"subtitles",cues:e,track:o})}i.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(e){u.logger.log("Failed to parse VTT cue: "+e),i.trigger(l.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})}))},r.onFragDecrypted=function(t){var e=t.frag,n=t.payload;if("subtitle"===e.type){if(!Object(c.isFiniteNumber)(this.initPTS[e.cc]))return void this.unparsedVttFrags.push(t);this._parseVTTs(e,n)}},r.onFragParsingUserdata=function(t){var e=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&e&&n)for(var i=0;i<t.samples.length;i++){var r=t.samples[i].bytes;if(r){var s=this.extractCea608Data(r);e.addData(t.samples[i].pts,s[0]),n.addData(t.samples[i].pts,s[1])}}},r.extractCea608Data=function(t){for(var e=31&t[0],n=2,i=[[],[]],r=0;r<e;r++){var s=t[n++],o=127&t[n++],a=127&t[n++],c=3&s;0===o&&0===a||0!=(4&s)&&(0!==c&&1!==c||(i[c].push(o),i[c].push(a)))}return i},i}(A);function Ge(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Qe(t){for(var e=[],n=0;n<t.length;n++){var i=t[n];"subtitles"===i.kind&&i.label&&e.push(t[n])}return e}var ze=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.MANIFEST_LOADED,l.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],n.trackId=-1,n.media=null,n.stopped=!0,n.subtitleDisplay=!0,n.queuedDefaultTrack=null,n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r,s,o,a=i.prototype;return a.destroy=function(){A.prototype.destroy.call(this)},a.onMediaAttached=function(t){var e=this;this.media=t.media,this.media&&(Object(c.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){e.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},a.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(c.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),Qe(this.media.textTracks).forEach((function(t){Ft(t)})),this.subtitleTrack=-1,this.media=null)},a.onManifestLoaded=function(t){var e=this,n=t.subtitles||[];this.tracks=n,this.hls.trigger(l.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach((function(t){t.default&&(e.media?e.subtitleTrack=t.id:e.queuedDefaultTrack=t.id)}))},a.onSubtitleTrackLoaded=function(t){var e=this,n=t.id,i=t.details,r=this.trackId,s=this.tracks,o=s[r];if(n>=s.length||n!==r||!o||this.stopped)this._clearReloadTimer();else if(u.logger.log("subtitle track "+n+" loaded"),i.live){var a=st(o.details,i,t.stats.trequest);u.logger.log("Reloading live subtitle playlist in "+a+"ms"),this.timer=setTimeout((function(){e._loadCurrentTrack()}),a)}else this._clearReloadTimer()},a.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},a.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},a._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},a._loadCurrentTrack=function(){var t=this.trackId,e=this.tracks,n=this.hls,i=e[t];t<0||!i||i.details&&!i.details.live||(u.logger.log("Loading subtitle track "+t),n.trigger(l.default.SUBTITLE_TRACK_LOADING,{url:i.url,id:t}))},a._toggleTrackModes=function(t){var e=this.media,n=this.subtitleDisplay,i=this.trackId;if(e){var r=Qe(e.textTracks);if(-1===t)[].slice.call(r).forEach((function(t){t.mode="disabled"}));else{var s=r[i];s&&(s.mode="disabled")}var o=r[t];o&&(o.mode=n?"showing":"hidden")}},a._setSubtitleTrackInternal=function(t){var e=this.hls,n=this.tracks;!Object(c.isFiniteNumber)(t)||t<-1||t>=n.length||(this.trackId=t,u.logger.log("Switching to subtitle track "+t),e.trigger(l.default.SUBTITLE_TRACK_SWITCH,{id:t}),this._loadCurrentTrack())},a._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=Qe(this.media.textTracks),n=0;n<e.length;n++)if("hidden"===e[n].mode)t=n;else if("showing"===e[n].mode){t=n;break}this.subtitleTrack=t}},r=i,(s=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.trackId!==t&&(this._toggleTrackModes(t),this._setSubtitleTrackInternal(t))}}])&&Ge(r.prototype,s),o&&Ge(r,o),i}(A),We=n("./src/crypt/decrypter.js");var Ke,qe=window.performance,Ye=function(t){var e,n;function i(e,n){var i;return(i=t.call(this,e,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHING,l.default.ERROR,l.default.KEY_LOADED,l.default.FRAG_LOADED,l.default.SUBTITLE_TRACKS_UPDATED,l.default.SUBTITLE_TRACK_SWITCH,l.default.SUBTITLE_TRACK_LOADED,l.default.SUBTITLE_FRAG_PROCESSED,l.default.LEVEL_UPDATED)||this).fragmentTracker=n,i.config=e.config,i.state=mt,i.tracks=[],i.tracksBuffered=[],i.currentTrackId=-1,i.decrypter=new We.default(e,e.config),i.lastAVStart=0,i._onMediaSeeking=i.onMediaSeeking.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(i)),i}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r=i.prototype;return r.onSubtitleFragProcessed=function(t){var e=t.frag,n=t.success;if(this.fragPrevious=e,this.state=vt,n){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var r,s=e.start,o=0;o<i.length;o++)if(s>=i[o].start&&s<=i[o].end){r=i[o];break}var a=e.start+e.duration;r?r.end=a:(r={start:s,end:a},i.push(r))}}},r.onMediaAttached=function(t){var e=t.media;this.media=e,e.addEventListener("seeking",this._onMediaSeeking),this.state=vt},r.onMediaDetaching=function(){var t=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(e){t.tracksBuffered[e.id]=[]})),this.media=null,this.state=mt)},r.onError=function(t){var e=t.frag;e&&"subtitle"===e.type&&(this.state=vt)},r.onSubtitleTracksUpdated=function(t){var e=this;u.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=t.subtitleTracks,this.tracks.forEach((function(t){e.tracksBuffered[t.id]=[]}))},r.onSubtitleTrackSwitch=function(t){if(this.currentTrackId=t.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId){var e=this.tracks[this.currentTrackId];e&&e.details&&this.setInterval(500)}else this.clearInterval()},r.onSubtitleTrackLoaded=function(t){var e=t.id,n=t.details,i=this.currentTrackId,r=this.tracks,s=r[i];e>=r.length||e!==i||!s||(n.live&&function(t,e,n){void 0===n&&(n=0);var i=-1;rt(t,e,(function(t,e,n){e.start=t.start,i=n}));var r=e.fragments;if(i<0)r.forEach((function(t){t.start+=n}));else for(var s=i+1;s<r.length;s++)r[s].start=r[s-1].start+r[s-1].duration}(s.details,n,this.lastAVStart),s.details=n,this.setInterval(500))},r.onKeyLoaded=function(){this.state===_t&&(this.state=vt)},r.onFragLoaded=function(t){var e=this.fragCurrent,n=t.frag.decryptdata,i=t.frag,r=this.hls;if(this.state===bt&&e&&"subtitle"===t.frag.type&&e.sn===t.frag.sn&&t.payload.byteLength>0&&n&&n.key&&"AES-128"===n.method){var s=qe.now();this.decrypter.decrypt(t.payload,n.key.buffer,n.iv.buffer,(function(t){var e=qe.now();r.trigger(l.default.FRAG_DECRYPTED,{frag:i,payload:t,stats:{tstart:s,tdecrypt:e}})}))}},r.onLevelUpdated=function(t){var e=t.details.fragments;this.lastAVStart=e.length?e[0].start:0},r.doTick=function(){if(this.media)switch(this.state){case vt:var t=this.config,e=this.currentTrackId,n=this.fragmentTracker,i=this.media,r=this.tracks;if(!r||!r[e]||!r[e].details)break;var s,o=t.maxBufferHole,a=t.maxFragLookUpTolerance,c=Math.min(t.maxBufferLength,t.maxMaxBufferLength),d=Q.bufferedInfo(this._getBuffered(),i.currentTime,o),h=d.end,A=d.len,p=r[e].details,f=p.fragments,m=f.length,g=f[m-1].start+f[m-1].duration;if(A>c)return;var v=this.fragPrevious;h<g?(v&&p.hasProgramDateTime&&(s=lt(f,v.endProgramDateTime,a)),s||(s=ut(v,f,h,a))):s=f[m-1],s&&s.encrypted?(u.logger.log("Loading key for "+s.sn),this.state=_t,this.hls.trigger(l.default.KEY_LOADING,{frag:s})):s&&n.getState(s)===U&&(this.fragCurrent=s,this.state=bt,this.hls.trigger(l.default.FRAG_LOADING,{frag:s}))}else this.state=vt},r.stopLoad=function(){this.lastAVStart=0,t.prototype.stopLoad.call(this)},r._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},r.onMediaSeeking=function(){this.fragPrevious=null},i}(Lt);!function(t){t.WIDEVINE="com.widevine.alpha",t.PLAYREADY="com.microsoft.playready"}(Ke||(Ke={}));var $e="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function Xe(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Je=function(t){var e,n;function i(e){var n;return(n=t.call(this,e,l.default.MEDIA_ATTACHED,l.default.MEDIA_DETACHED,l.default.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,n._licenseXhrSetup=void 0,n._emeEnabled=void 0,n._requestMediaKeySystemAccess=void 0,n._drmSystemOptions=void 0,n._config=void 0,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._requestLicenseFailureCount=0,n.mediaKeysPromise=null,n._onMediaEncrypted=function(t){if(u.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!n.mediaKeysPromise)return u.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void n.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var e=function(e){n._media&&(n._attemptSetMediaKeys(e),n._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};n.mediaKeysPromise.then(e).catch(e)},n._config=e.config,n._widevineLicenseUrl=n._config.widevineLicenseUrl,n._licenseXhrSetup=n._config.licenseXhrSetup,n._emeEnabled=n._config.emeEnabled,n._requestMediaKeySystemAccess=n._config.requestMediaKeySystemAccessFunc,n._drmSystemOptions=e.config.drmSystemOptions,n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var r,s,o,c=i.prototype;return c.getLicenseServerUrl=function(t){switch(t){case Ke.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},c._attemptKeySystemAccess=function(t,e,n){var i=this,r=function(t,e,n,i){if(t===Ke.WIDEVINE)return function(t,e,n){var i={audioCapabilities:[],videoCapabilities:[]};return t.forEach((function(t){i.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:n.audioRobustness||""})})),e.forEach((function(t){i.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:n.videoRobustness||""})})),[i]}(e,n,i);throw new Error("Unknown key-system: "+t)}(t,e,n,this._drmSystemOptions);u.logger.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(t,r);this.mediaKeysPromise=s.then((function(e){return i._onMediaKeySystemAccessObtained(t,e)})),s.catch((function(e){u.logger.error('Failed to obtain key-system "'+t+'" access:',e)}))},c._onMediaKeySystemAccessObtained=function(t,e){var n=this;u.logger.log('Access for key-system "'+t+'" obtained');var i={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(i);var r=Promise.resolve().then((function(){return e.createMediaKeys()})).then((function(e){return i.mediaKeys=e,u.logger.log('Media-keys created for key-system "'+t+'"'),n._onMediaKeysCreated(),e}));return r.catch((function(t){u.logger.error("Failed to create media-keys:",t)})),r},c._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach((function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))}))},c._onNewMediaKeySession=function(t){var e=this;u.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",(function(n){e._onKeySessionMessage(t,n.message)}),!1)},c._onKeySessionMessage=function(t,e){u.logger.log("Got EME message event, creating license request"),this._requestLicense(e,(function(e){u.logger.log("Received license data (length: "+(e?e.byteLength:e)+"), updating key-session"),t.update(e)}))},c._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return u.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});u.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},c._generateRequestWithPreferredKeySession=function(t,e){var n=this,i=this._mediaKeysList[0];if(!i)return u.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(i.mediaKeysSessionInitialized)u.logger.warn("Key-Session already initialized but requested again");else{var r=i.mediaKeysSession;if(!r)return u.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!e)return u.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});u.logger.log('Generating key-session request for "'+t+'" init data type'),i.mediaKeysSessionInitialized=!0,r.generateRequest(t,e).then((function(){u.logger.debug("Key-session generation succeeded")})).catch((function(t){u.logger.error("Error generating key-session request:",t),n.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},c._createLicenseXhr=function(t,e,n){var i=new XMLHttpRequest,r=this._licenseXhrSetup;try{if(r)try{r(i,t)}catch(e){i.open("POST",t,!0),r(i,t)}i.readyState||i.open("POST",t,!0)}catch(t){throw new Error("issue setting up KeySystem license XHR "+t)}return i.responseType="arraybuffer",i.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,i,t,e,n),i},c._onLicenseRequestReadyStageChange=function(t,e,n,i){if(4===t.readyState)if(200===t.status)this._requestLicenseFailureCount=0,u.logger.log("License request succeeded"),"arraybuffer"!==t.responseType&&u.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),i(t.response);else{if(u.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var r=3-this._requestLicenseFailureCount+1;u.logger.warn("Retrying license request, "+r+" attempts left"),this._requestLicense(n,i)}},c._generateLicenseRequestChallenge=function(t,e){if(t.mediaKeySystemDomain===Ke.WIDEVINE)return e;throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},c._requestLicense=function(t,e){u.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return u.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var i=this.getLicenseServerUrl(n.mediaKeySystemDomain),r=this._createLicenseXhr(i,t,e);u.logger.log("Sending license request to URL: "+i);var s=this._generateLicenseRequestChallenge(n,t);r.send(s)}catch(t){u.logger.error("Failure requesting DRM license: "+t),this.hls.trigger(l.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},c.onMediaAttached=function(t){if(this._emeEnabled){var e=t.media;this._media=e,e.addEventListener("encrypted",this._onMediaEncrypted)}},c.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch((function(){}))}))).then((function(){return t.setMediaKeys(null)})).catch((function(){})))},c.onManifestParsed=function(t){if(this._emeEnabled){var e=t.levels.map((function(t){return t.audioCodec})),n=t.levels.map((function(t){return t.videoCodec}));this._attemptKeySystemAccess(Ke.WIDEVINE,e,n)}},r=i,(s=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&Xe(r.prototype,s),o&&Xe(r,o),i}(A);function Ze(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function tn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ze(Object(n),!0).forEach((function(e){en(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function en(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var nn=tn(tn({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Jt,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:zt,bufferController:Kt,capLevelController:Yt,fpsController:Xt,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:$e,testBandwidth:!0},{cueHandler:i,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Ye,subtitleTrackController:ze,timelineController:je,audioStreamController:ie,audioTrackController:te,emeController:Je});function rn(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function sn(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?rn(Object(n),!0).forEach((function(e){on(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):rn(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function on(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function an(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function cn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ln(t,e,n){return e&&cn(t.prototype,e),n&&cn(t,n),t}var un=function(t){var e,n;function i(e){var n;void 0===e&&(e={}),(n=t.call(this)||this).config=void 0,n._autoLevelCapping=void 0,n.abrController=void 0,n.capLevelController=void 0,n.levelController=void 0,n.streamController=void 0,n.networkControllers=void 0,n.audioTrackController=void 0,n.subtitleTrackController=void 0,n.emeController=void 0,n.coreComponents=void 0,n.media=null,n.url=null;var r=i.DefaultConfig;if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");n.config=sn(sn({},r),e);var s=an(n).config;if(void 0!==s.liveMaxLatencyDurationCount&&s.liveMaxLatencyDurationCount<=s.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==s.liveMaxLatencyDuration&&(void 0===s.liveSyncDuration||s.liveMaxLatencyDuration<=s.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(u.enableLogs)(s.debug),n._autoLevelCapping=-1;var o=n.abrController=new s.abrController(an(n)),a=new s.bufferController(an(n)),c=n.capLevelController=new s.capLevelController(an(n)),l=new s.fpsController(an(n)),d=new P(an(n)),h=new D(an(n)),A=new B(an(n)),p=new Ht(an(n)),f=n.levelController=new Dt(an(n)),m=new j(an(n)),g=[f,n.streamController=new Nt(an(n),m)],v=s.audioStreamController;v&&g.push(new v(an(n),m)),n.networkControllers=g;var y=[d,h,A,o,a,c,l,p,m];if(v=s.audioTrackController){var _=new v(an(n));n.audioTrackController=_,y.push(_)}if(v=s.subtitleTrackController){var b=new v(an(n));n.subtitleTrackController=b,g.push(b)}if(v=s.emeController){var E=new v(an(n));n.emeController=E,y.push(E)}return(v=s.subtitleStreamController)&&g.push(new v(an(n),m)),(v=s.timelineController)&&y.push(new v(an(n))),n.coreComponents=y,n}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n,i.isSupported=function(){return function(){var t=q();if(!t)return!1;var e=self.SourceBuffer||self.WebKitSourceBuffer,n=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!n&&!!i}()},ln(i,null,[{key:"version",get:function(){return"0.14.12"}},{key:"Events",get:function(){return l.default}},{key:"ErrorTypes",get:function(){return a.ErrorTypes}},{key:"ErrorDetails",get:function(){return a.ErrorDetails}},{key:"DefaultConfig",get:function(){return i.defaultConfig?i.defaultConfig:nn},set:function(t){i.defaultConfig=t}}]);var r=i.prototype;return r.destroy=function(){u.logger.log("destroy"),this.trigger(l.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(t){t.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},r.attachMedia=function(t){u.logger.log("attachMedia"),this.media=t,this.trigger(l.default.MEDIA_ATTACHING,{media:t})},r.detachMedia=function(){u.logger.log("detachMedia"),this.trigger(l.default.MEDIA_DETACHING),this.media=null},r.loadSource=function(t){t=o.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),u.logger.log("loadSource:"+t),this.url=t,this.trigger(l.default.MANIFEST_LOADING,{url:t})},r.startLoad=function(t){void 0===t&&(t=-1),u.logger.log("startLoad("+t+")"),this.networkControllers.forEach((function(e){e.startLoad(t)}))},r.stopLoad=function(){u.logger.log("stopLoad"),this.networkControllers.forEach((function(t){t.stopLoad()}))},r.swapAudioCodec=function(){u.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},r.recoverMediaError=function(){u.logger.log("recoverMediaError");var t=this.media;this.detachMedia(),t&&this.attachMedia(t)},r.removeLevel=function(t,e){void 0===e&&(e=0),this.levelController.removeLevel(t,e)},ln(i,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){u.logger.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){u.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){u.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){u.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){u.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",set:function(t){var e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){u.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"bandwidthEstimate",get:function(){var t=this.abrController._bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var t=this.levels,e=this.config.minAutoBitrate,n=t?t.length:0,i=0;i<n;i++){if((t[i].realBitrate?Math.max(t[i].realBitrate,t[i].bitrate):t[i].bitrate)>e)return i}return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}}]),i}($);un.defaultConfig=void 0},"./src/polyfills/number.js":
/*!*********************************!*\
  !*** ./src/polyfills/number.js ***!
  \*********************************/
/*! exports provided: isFiniteNumber, MAX_SAFE_INTEGER */function(t,e,n){n.r(e),n.d(e,"isFiniteNumber",(function(){return i})),n.d(e,"MAX_SAFE_INTEGER",(function(){return r}));var i=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},r=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":
/*!*************************************!*\
  !*** ./src/utils/get-self-scope.js ***!
  \*************************************/
/*! exports provided: getSelfScope */function(t,e,n){function i(){return"undefined"==typeof window?self:window}n.r(e),n.d(e,"getSelfScope",(function(){return i}))},"./src/utils/logger.js":
/*!*****************************!*\
  !*** ./src/utils/logger.js ***!
  \*****************************/
/*! exports provided: enableLogs, logger */function(t,e,n){n.r(e),n.d(e,"enableLogs",(function(){return u})),n.d(e,"logger",(function(){return d}));var i=n(/*! ./get-self-scope */"./src/utils/get-self-scope.js");function r(){}var s={trace:r,debug:r,log:r,warn:r,info:r,error:r},o=s;function a(t,e){return e="["+t+"] > "+e}var c=Object(i.getSelfScope)();function l(t){var e=c.console[t];return e?function(){for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];i[0]&&(i[0]=a(t,i[0])),e.apply(c.console,i)}:r}var u=function(t){if(c.console&&!0===t||"object"==typeof t){!function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];n.forEach((function(e){o[e]=t[e]?t[e].bind(t):l(e)}))}(t,"debug","log","info","warn","error");try{o.log()}catch(t){o=s}}else o=s},d=o}}).default})),
/**
  @license
                                 Apache License
                         Version 2.0, January 2004
                      http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

    "License" shall mean the terms and conditions for use, reproduction,
    and distribution as defined by Sections 1 through 9 of this document.

    "Licensor" shall mean the copyright owner or entity authorized by
    the copyright owner that is granting the License.

    "Legal Entity" shall mean the union of the acting entity and all
    other entities that control, are controlled by, or are under common
    control with that entity. For the purposes of this definition,
    "control" means (i) the power, direct or indirect, to cause the
    direction or management of such entity, whether by contract or
    otherwise, or (ii) ownership of fifty percent (50%) or more of the
    outstanding shares, or (iii) beneficial ownership of such entity.

    "You" (or "Your") shall mean an individual or Legal Entity
    exercising permissions granted by this License.

    "Source" form shall mean the preferred form for making modifications,
    including but not limited to software source code, documentation
    source, and configuration files.

    "Object" form shall mean any form resulting from mechanical
    transformation or translation of a Source form, including but
    not limited to compiled object code, generated documentation,
    and conversions to other media types.

    "Work" shall mean the work of authorship, whether in Source or
    Object form, made available under the License, as indicated by a
    copyright notice that is included in or attached to the work
    (an example is provided in the Appendix below).

    "Derivative Works" shall mean any work, whether in Source or Object
    form, that is based on (or derived from) the Work and for which the
    editorial revisions, annotations, elaborations, or other modifications
    represent, as a whole, an original work of authorship. For the purposes
    of this License, Derivative Works shall not include works that remain
    separable from, or merely link (or bind by name) to the interfaces of,
    the Work and Derivative Works thereof.

    "Contribution" shall mean any work of authorship, including
    the original version of the Work and any modifications or additions
    to that Work or Derivative Works thereof, that is intentionally
    submitted to Licensor for inclusion in the Work by the copyright owner
    or by an individual or Legal Entity authorized to submit on behalf of
    the copyright owner. For the purposes of this definition, "submitted"
    means any form of electronic, verbal, or written communication sent
    to the Licensor or its representatives, including but not limited to
    communication on electronic mailing lists, source code control systems,
    and issue tracking systems that are managed by, or on behalf of, the
    Licensor for the purpose of discussing and improving the Work, but
    excluding communication that is conspicuously marked or otherwise
    designated in writing by the copyright owner as "Not a Contribution."

    "Contributor" shall mean Licensor and any individual or Legal Entity
    on behalf of whom a Contribution has been received by Licensor and
    subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    copyright license to reproduce, prepare Derivative Works of,
    publicly display, publicly perform, sublicense, and distribute the
    Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    (except as stated in this section) patent license to make, have made,
    use, offer to sell, sell, import, and otherwise transfer the Work,
    where such license applies only to those patent claims licensable
    by such Contributor that are necessarily infringed by their
    Contribution(s) alone or by combination of their Contribution(s)
    with the Work to which such Contribution(s) was submitted. If You
    institute patent litigation against any entity (including a
    cross-claim or counterclaim in a lawsuit) alleging that the Work
    or a Contribution incorporated within the Work constitutes direct
    or contributory patent infringement, then any patent licenses
    granted to You under this License for that Work shall terminate
    as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
    Work or Derivative Works thereof in any medium, with or without
    modifications, and in Source or Object form, provided that You
    meet the following conditions:

    (a) You must give any other recipients of the Work or
        Derivative Works a copy of this License; and

    (b) You must cause any modified files to carry prominent notices
        stating that You changed the files; and

    (c) You must retain, in the Source form of any Derivative Works
        that You distribute, all copyright, patent, trademark, and
        attribution notices from the Source form of the Work,
        excluding those notices that do not pertain to any part of
        the Derivative Works; and

    (d) If the Work includes a "NOTICE" text file as part of its
        distribution, then any Derivative Works that You distribute must
        include a readable copy of the attribution notices contained
        within such NOTICE file, excluding those notices that do not
        pertain to any part of the Derivative Works, in at least one
        of the following places: within a NOTICE text file distributed
        as part of the Derivative Works; within the Source form or
        documentation, if provided along with the Derivative Works; or,
        within a display generated by the Derivative Works, if and
        wherever such third-party notices normally appear. The contents
        of the NOTICE file are for informational purposes only and
        do not modify the License. You may add Your own attribution
        notices within Derivative Works that You distribute, alongside
        or as an addendum to the NOTICE text from the Work, provided
        that such additional attribution notices cannot be construed
        as modifying the License.

    You may add Your own copyright statement to Your modifications and
    may provide additional or different license terms and conditions
    for use, reproduction, or distribution of Your modifications, or
    for any such Derivative Works as a whole, provided Your use,
    reproduction, and distribution of the Work otherwise complies with
    the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
    any Contribution intentionally submitted for inclusion in the Work
    by You to the Licensor shall be under the terms and conditions of
    this License, without any additional terms or conditions.
    Notwithstanding the above, nothing herein shall supersede or modify
    the terms of any separate license agreement you may have executed
    with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
    names, trademarks, service marks, or product names of the Licensor,
    except as required for reasonable and customary use in describing the
    origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
    agreed to in writing, Licensor provides the Work (and each
    Contributor provides its Contributions) on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied, including, without limitation, any warranties or conditions
    of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
    PARTICULAR PURPOSE. You are solely responsible for determining the
    appropriateness of using or redistributing the Work and assume any
    risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
    whether in tort (including negligence), contract, or otherwise,
    unless required by applicable law (such as deliberate and grossly
    negligent acts) or agreed to in writing, shall any Contributor be
    liable to You for damages, including any direct, indirect, special,
    incidental, or consequential damages of any character arising as a
    result of this License or out of the use or inability to use the
    Work (including but not limited to damages for loss of goodwill,
    work stoppage, computer failure or malfunction, or any and all
    other commercial damages or losses), even if such Contributor
    has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
    the Work or Derivative Works thereof, You may choose to offer,
    and charge a fee for, acceptance of support, warranty, indemnity,
    or other liability obligations and/or rights consistent with this
    License. However, in accepting such obligations, You may act only
    on Your own behalf and on Your sole responsibility, not on behalf
    of any other Contributor, and only if You agree to indemnify,
    defend, and hold each Contributor harmless for any liability
    incurred by, or claims asserted against, such Contributor by reason
    of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

    To apply the Apache License to your work, attach the following
    boilerplate notice, with the fields enclosed by brackets "[]"
    replaced with your own identifying information. (Don't include
    the brackets!)  The text should be enclosed in the appropriate
    comment syntax for the file format. We also recommend that a
    file or class name and description of purpose be included on the
    same "printed page" as the copyright notice for easier
    identification within third-party archives.

 Copyright (c) 2015-2018 Google, Inc., Netflix, Inc., Microsoft Corp. and contributors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 

 **/
/**
  @license
                                 Apache License
                         Version 2.0, January 2004
                      http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

    "License" shall mean the terms and conditions for use, reproduction,
    and distribution as defined by Sections 1 through 9 of this document.

    "Licensor" shall mean the copyright owner or entity authorized by
    the copyright owner that is granting the License.

    "Legal Entity" shall mean the union of the acting entity and all
    other entities that control, are controlled by, or are under common
    control with that entity. For the purposes of this definition,
    "control" means (i) the power, direct or indirect, to cause the
    direction or management of such entity, whether by contract or
    otherwise, or (ii) ownership of fifty percent (50%) or more of the
    outstanding shares, or (iii) beneficial ownership of such entity.

    "You" (or "Your") shall mean an individual or Legal Entity
    exercising permissions granted by this License.

    "Source" form shall mean the preferred form for making modifications,
    including but not limited to software source code, documentation
    source, and configuration files.

    "Object" form shall mean any form resulting from mechanical
    transformation or translation of a Source form, including but
    not limited to compiled object code, generated documentation,
    and conversions to other media types.

    "Work" shall mean the work of authorship, whether in Source or
    Object form, made available under the License, as indicated by a
    copyright notice that is included in or attached to the work
    (an example is provided in the Appendix below).

    "Derivative Works" shall mean any work, whether in Source or Object
    form, that is based on (or derived from) the Work and for which the
    editorial revisions, annotations, elaborations, or other modifications
    represent, as a whole, an original work of authorship. For the purposes
    of this License, Derivative Works shall not include works that remain
    separable from, or merely link (or bind by name) to the interfaces of,
    the Work and Derivative Works thereof.

    "Contribution" shall mean any work of authorship, including
    the original version of the Work and any modifications or additions
    to that Work or Derivative Works thereof, that is intentionally
    submitted to Licensor for inclusion in the Work by the copyright owner
    or by an individual or Legal Entity authorized to submit on behalf of
    the copyright owner. For the purposes of this definition, "submitted"
    means any form of electronic, verbal, or written communication sent
    to the Licensor or its representatives, including but not limited to
    communication on electronic mailing lists, source code control systems,
    and issue tracking systems that are managed by, or on behalf of, the
    Licensor for the purpose of discussing and improving the Work, but
    excluding communication that is conspicuously marked or otherwise
    designated in writing by the copyright owner as "Not a Contribution."

    "Contributor" shall mean Licensor and any individual or Legal Entity
    on behalf of whom a Contribution has been received by Licensor and
    subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    copyright license to reproduce, prepare Derivative Works of,
    publicly display, publicly perform, sublicense, and distribute the
    Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    (except as stated in this section) patent license to make, have made,
    use, offer to sell, sell, import, and otherwise transfer the Work,
    where such license applies only to those patent claims licensable
    by such Contributor that are necessarily infringed by their
    Contribution(s) alone or by combination of their Contribution(s)
    with the Work to which such Contribution(s) was submitted. If You
    institute patent litigation against any entity (including a
    cross-claim or counterclaim in a lawsuit) alleging that the Work
    or a Contribution incorporated within the Work constitutes direct
    or contributory patent infringement, then any patent licenses
    granted to You under this License for that Work shall terminate
    as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
    Work or Derivative Works thereof in any medium, with or without
    modifications, and in Source or Object form, provided that You
    meet the following conditions:

    (a) You must give any other recipients of the Work or
        Derivative Works a copy of this License; and

    (b) You must cause any modified files to carry prominent notices
        stating that You changed the files; and

    (c) You must retain, in the Source form of any Derivative Works
        that You distribute, all copyright, patent, trademark, and
        attribution notices from the Source form of the Work,
        excluding those notices that do not pertain to any part of
        the Derivative Works; and

    (d) If the Work includes a "NOTICE" text file as part of its
        distribution, then any Derivative Works that You distribute must
        include a readable copy of the attribution notices contained
        within such NOTICE file, excluding those notices that do not
        pertain to any part of the Derivative Works, in at least one
        of the following places: within a NOTICE text file distributed
        as part of the Derivative Works; within the Source form or
        documentation, if provided along with the Derivative Works; or,
        within a display generated by the Derivative Works, if and
        wherever such third-party notices normally appear. The contents
        of the NOTICE file are for informational purposes only and
        do not modify the License. You may add Your own attribution
        notices within Derivative Works that You distribute, alongside
        or as an addendum to the NOTICE text from the Work, provided
        that such additional attribution notices cannot be construed
        as modifying the License.

    You may add Your own copyright statement to Your modifications and
    may provide additional or different license terms and conditions
    for use, reproduction, or distribution of Your modifications, or
    for any such Derivative Works as a whole, provided Your use,
    reproduction, and distribution of the Work otherwise complies with
    the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
    any Contribution intentionally submitted for inclusion in the Work
    by You to the Licensor shall be under the terms and conditions of
    this License, without any additional terms or conditions.
    Notwithstanding the above, nothing herein shall supersede or modify
    the terms of any separate license agreement you may have executed
    with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
    names, trademarks, service marks, or product names of the Licensor,
    except as required for reasonable and customary use in describing the
    origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
    agreed to in writing, Licensor provides the Work (and each
    Contributor provides its Contributions) on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied, including, without limitation, any warranties or conditions
    of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
    PARTICULAR PURPOSE. You are solely responsible for determining the
    appropriateness of using or redistributing the Work and assume any
    risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
    whether in tort (including negligence), contract, or otherwise,
    unless required by applicable law (such as deliberate and grossly
    negligent acts) or agreed to in writing, shall any Contributor be
    liable to You for damages, including any direct, indirect, special,
    incidental, or consequential damages of any character arising as a
    result of this License or out of the use or inability to use the
    Work (including but not limited to damages for loss of goodwill,
    work stoppage, computer failure or malfunction, or any and all
    other commercial damages or losses), even if such Contributor
    has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
    the Work or Derivative Works thereof, You may choose to offer,
    and charge a fee for, acceptance of support, warranty, indemnity,
    or other liability obligations and/or rights consistent with this
    License. However, in accepting such obligations, You may act only
    on Your own behalf and on Your sole responsibility, not on behalf
    of any other Contributor, and only if You agree to indemnify,
    defend, and hold each Contributor harmless for any liability
    incurred by, or claims asserted against, such Contributor by reason
    of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

    To apply the Apache License to your work, attach the following
    boilerplate notice, with the fields enclosed by brackets "[]"
    replaced with your own identifying information. (Don't include
    the brackets!)  The text should be enclosed in the appropriate
    comment syntax for the file format. We also recommend that a
    file or class name and description of purpose be included on the
    same "printed page" as the copyright notice for easier
    identification within third-party archives.

 Copyright (c) 2015-2018 Google, Inc., Netflix, Inc., Microsoft Corp. and contributors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 

 **/
function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define("rxjs",["exports"],e):e(t.rxjs={})}(this,(function(t){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */
var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function n(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var i=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t};function r(t){return"function"==typeof t}var s=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){var e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else s&&console.log("RxJS: Back to a better error behavior. Thank you. <3");s=t},get useDeprecatedSynchronousErrorHandling(){return s}};function a(t){setTimeout((function(){throw t}),0)}var c={closed:!0,next:function(t){},error:function(t){if(o.useDeprecatedSynchronousErrorHandling)throw t;a(t)},complete:function(){}},l=Array.isArray||function(t){return t&&"number"==typeof t.length};function u(t){return null!==t&&"object"==typeof t}var d=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(t,e){return e+1+") "+t.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),h=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n=this,i=n._parentOrParents,s=n._ctorUnsubscribe,o=n._unsubscribe,a=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,i instanceof t)i.remove(this);else if(null!==i)for(var c=0;c<i.length;++c){i[c].remove(this)}if(r(o)){s&&(this._unsubscribe=void 0);try{o.call(this)}catch(t){e=t instanceof d?A(t.errors):[t]}}if(l(a)){c=-1;for(var h=a.length;++c<h;){var p=a[c];if(u(p))try{p.unsubscribe()}catch(t){e=e||[],t instanceof d?e=e.concat(A(t.errors)):e.push(t)}}}if(e)throw new d(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var i=n;(n=new t)._subscriptions=[i]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var r=n._parentOrParents;if(null===r)n._parentOrParents=this;else if(r instanceof t){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}var s=this._subscriptions;return null===s?this._subscriptions=[n]:s.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=function(t){return t.closed=!0,t}(new t),t}();function A(t){return t.reduce((function(t,e){return t.concat(e instanceof d?e.errors:e)}),[])}var p="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),f=function(t){function e(n,i,r){var s=t.call(this)||this;switch(s.syncErrorValue=null,s.syncErrorThrown=!1,s.syncErrorThrowable=!1,s.isStopped=!1,arguments.length){case 0:s.destination=c;break;case 1:if(!n){s.destination=c;break}if("object"==typeof n){n instanceof e?(s.syncErrorThrowable=n.syncErrorThrowable,s.destination=n,n.add(s)):(s.syncErrorThrowable=!0,s.destination=new m(s,n));break}default:s.syncErrorThrowable=!0,s.destination=new m(s,n,i,r)}return s}return n(e,t),e.prototype[p]=function(){return this},e.create=function(t,n,i){var r=new e(t,n,i);return r.syncErrorThrowable=!1,r},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(h),m=function(t){function e(e,n,i,s){var o,a=t.call(this)||this;a._parentSubscriber=e;var l=a;return r(n)?o=n:n&&(o=n.next,i=n.error,s=n.complete,n!==c&&(r((l=Object.create(n)).unsubscribe)&&a.add(l.unsubscribe.bind(l)),l.unsubscribe=a.unsubscribe.bind(a))),a._context=l,a._next=o,a._error=i,a._complete=s,a}return n(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=o.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):a(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;a(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};o.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw t;a(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return o.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(a(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(f);function g(t){for(;t;){var e=t,n=e.closed,i=e.destination,r=e.isStopped;if(n||r)return!1;t=i&&i instanceof f?i:null}return!0}var v="function"==typeof Symbol&&Symbol.observable||"@@observable";function y(t){return t}function _(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return b(t)}function b(t){return 0===t.length?y:1===t.length?t[0]:function(e){return t.reduce((function(t,e){return e(t)}),e)}}var E=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var i=this.operator,r=function(t,e,n){if(t){if(t instanceof f)return t;if(t[p])return t[p]()}return t||e||n?new f(t,e,n):new f(c)}(t,e,n);if(i?r.add(i.call(r,this.source)):r.add(this.source||o.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),o.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){o.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),g(t)?t.error(e):console.warn(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=w(e))((function(e,i){var r;r=n.subscribe((function(e){try{t(e)}catch(t){i(t),r&&r.unsubscribe()}}),i,e)}))},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[v]=function(){return this},t.prototype.pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 0===t.length?this:b(t)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=w(t))((function(t,n){var i;e.subscribe((function(t){return i=t}),(function(t){return n(t)}),(function(){return t(i)}))}))},t.create=function(e){return new t(e)},t}();function w(t){if(t||(t=o.Promise||Promise),!t)throw new Error("no Promise impl found");return t}var S=function(){function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t}(),T=function(t){function e(e,n){var i=t.call(this)||this;return i.subject=e,i.subscriber=n,i.closed=!1,i}return n(e,t),e.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var t=this.subject,e=t.observers;if(this.subject=null,e&&0!==e.length&&!t.isStopped&&!t.closed){var n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},e}(h),C=function(t){function e(e){var n=t.call(this,e)||this;return n.destination=e,n}return n(e,t),e}(f),R=function(t){function e(){var e=t.call(this)||this;return e.observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return n(e,t),e.prototype[p]=function(){return new C(this)},e.prototype.lift=function(t){var e=new I(this,this);return e.operator=t,e},e.prototype.next=function(t){if(this.closed)throw new S;if(!this.isStopped)for(var e=this.observers,n=e.length,i=e.slice(),r=0;r<n;r++)i[r].next(t)},e.prototype.error=function(t){if(this.closed)throw new S;this.hasError=!0,this.thrownError=t,this.isStopped=!0;for(var e=this.observers,n=e.length,i=e.slice(),r=0;r<n;r++)i[r].error(t);this.observers.length=0},e.prototype.complete=function(){if(this.closed)throw new S;this.isStopped=!0;for(var t=this.observers,e=t.length,n=t.slice(),i=0;i<e;i++)n[i].complete();this.observers.length=0},e.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},e.prototype._trySubscribe=function(e){if(this.closed)throw new S;return t.prototype._trySubscribe.call(this,e)},e.prototype._subscribe=function(t){if(this.closed)throw new S;return this.hasError?(t.error(this.thrownError),h.EMPTY):this.isStopped?(t.complete(),h.EMPTY):(this.observers.push(t),new T(this,t))},e.prototype.asObservable=function(){var t=new E;return t.source=this,t},e.create=function(t,e){return new I(t,e)},e}(E),I=function(t){function e(e,n){var i=t.call(this)||this;return i.destination=e,i.source=n,i}return n(e,t),e.prototype.next=function(t){var e=this.destination;e&&e.next&&e.next(t)},e.prototype.error=function(t){var e=this.destination;e&&e.error&&this.destination.error(t)},e.prototype.complete=function(){var t=this.destination;t&&t.complete&&this.destination.complete()},e.prototype._subscribe=function(t){return this.source?this.source.subscribe(t):h.EMPTY},e}(R);function x(){return function(t){return t.lift(new L(t))}}var O,L=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var n=this.connectable;n._refCount++;var i=new M(t,n),r=e.subscribe(i);return i.closed||(i.connection=n.connect()),r},t}(),M=function(t){function e(e,n){var i=t.call(this,e)||this;return i.connectable=n,i}return n(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,i=t._connection;this.connection=null,!i||n&&i!==n||i.unsubscribe()}}else this.connection=null},e}(f),k=function(t){function e(e,n){var i=t.call(this)||this;return i.source=e,i.subjectFactory=n,i._refCount=0,i._isComplete=!1,i}return n(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new h).add(this.source.subscribe(new P(this.getSubject(),this))),t.closed&&(this._connection=null,t=h.EMPTY)),t},e.prototype.refCount=function(){return x()(this)},e}(E),N={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:(O=k.prototype)._subscribe},_isComplete:{value:O._isComplete,writable:!0},getSubject:{value:O.getSubject},connect:{value:O.connect},refCount:{value:O.refCount}},P=function(t){function e(e,n){var i=t.call(this,e)||this;return i.connectable=n,i}return n(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e}(C);!function(t){function e(e,n){var i=t.call(this,e)||this;return i.connectable=n,i}n(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var n=this.connection,i=t._connection;this.connection=null,!i||n&&i!==n||i.unsubscribe()}}else this.connection=null}}(f);var D=function(){function t(t,e,n,i){this.keySelector=t,this.elementSelector=e,this.durationSelector=n,this.subjectSelector=i}return t.prototype.call=function(t,e){return e.subscribe(new B(t,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},t}(),B=function(t){function e(e,n,i,r,s){var o=t.call(this,e)||this;return o.keySelector=n,o.elementSelector=i,o.durationSelector=r,o.subjectSelector=s,o.groups=null,o.attemptedToUnsubscribe=!1,o.count=0,o}return n(e,t),e.prototype._next=function(t){var e;try{e=this.keySelector(t)}catch(t){return void this.error(t)}this._group(t,e)},e.prototype._group=function(t,e){var n=this.groups;n||(n=this.groups=new Map);var i,r=n.get(e);if(this.elementSelector)try{i=this.elementSelector(t)}catch(t){this.error(t)}else i=t;if(!r){r=this.subjectSelector?this.subjectSelector():new R,n.set(e,r);var s=new F(e,r,this);if(this.destination.next(s),this.durationSelector){var o=void 0;try{o=this.durationSelector(new F(e,r))}catch(t){return void this.error(t)}this.add(o.subscribe(new U(e,r,this)))}}r.closed||r.next(i)},e.prototype._error=function(t){var e=this.groups;e&&(e.forEach((function(e,n){e.error(t)})),e.clear()),this.destination.error(t)},e.prototype._complete=function(){var t=this.groups;t&&(t.forEach((function(t,e){t.complete()})),t.clear()),this.destination.complete()},e.prototype.removeGroup=function(t){this.groups.delete(t)},e.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&t.prototype.unsubscribe.call(this))},e}(f),U=function(t){function e(e,n,i){var r=t.call(this,n)||this;return r.key=e,r.group=n,r.parent=i,r}return n(e,t),e.prototype._next=function(t){this.complete()},e.prototype._unsubscribe=function(){var t=this.parent,e=this.key;this.key=this.parent=null,t&&t.removeGroup(e)},e}(f),F=function(t){function e(e,n,i){var r=t.call(this)||this;return r.key=e,r.groupSubject=n,r.refCountSubscription=i,r}return n(e,t),e.prototype._subscribe=function(t){var e=new h,n=this.refCountSubscription,i=this.groupSubject;return n&&!n.closed&&e.add(new H(n)),e.add(i.subscribe(t)),e},e}(E),H=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,e.count++,n}return n(e,t),e.prototype.unsubscribe=function(){var e=this.parent;e.closed||this.closed||(t.prototype.unsubscribe.call(this),e.count-=1,0===e.count&&e.attemptedToUnsubscribe&&e.unsubscribe())},e}(h),V=function(t){function e(e){var n=t.call(this)||this;return n._value=e,n}return n(e,t),Object.defineProperty(e.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),e.prototype._subscribe=function(e){var n=t.prototype._subscribe.call(this,e);return n&&!n.closed&&e.next(this._value),n},e.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new S;return this._value},e.prototype.next=function(e){t.prototype.next.call(this,this._value=e)},e}(R),j=function(t){function e(e,n){return t.call(this)||this}return n(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(h),G=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i.pending=!1,i}return n(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(i,this.id,e),this},e.prototype.requestAsyncId=function(t,e,n){return void 0===n&&(n=0),setInterval(t.flush.bind(t,this),n)},e.prototype.recycleAsyncId=function(t,e,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var n=!1,i=void 0;try{this.work(t)}catch(t){n=!0,i=!!t&&t||new Error(t)}if(n)return this.unsubscribe(),i},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,n=e.actions,i=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==i&&n.splice(i,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(j),Q=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return n(e,t),e.prototype.schedule=function(e,n){return void 0===n&&(n=0),n>0?t.prototype.schedule.call(this,e,n):(this.delay=n,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,n){return n>0||this.closed?t.prototype.execute.call(this,e,n):this._execute(e,n)},e.prototype.requestAsyncId=function(e,n,i){return void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0?t.prototype.requestAsyncId.call(this,e,n,i):e.flush(this)},e}(G),z=function(){function t(e,n){void 0===n&&(n=t.now),this.SchedulerAction=e,this.now=n}return t.prototype.schedule=function(t,e,n){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(n,e)},t.now=function(){return Date.now()},t}(),W=function(t){function e(n,i){void 0===i&&(i=z.now);var r=t.call(this,n,(function(){return e.delegate&&e.delegate!==r?e.delegate.now():i()}))||this;return r.actions=[],r.active=!1,r.scheduled=void 0,r}return n(e,t),e.prototype.schedule=function(n,i,r){return void 0===i&&(i=0),e.delegate&&e.delegate!==this?e.delegate.schedule(n,i,r):t.prototype.schedule.call(this,n,i,r)},e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}},e}(z),K=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e}(W),q=new K(Q),Y=q,$=new E((function(t){return t.complete()}));function X(t){return t?function(t){return new E((function(e){return t.schedule((function(){return e.complete()}))}))}(t):$}function J(t){return t&&"function"==typeof t.schedule}var Z,tt=function(t){return function(e){for(var n=0,i=t.length;n<i&&!e.closed;n++)e.next(t[n]);e.complete()}};function et(t,e){return new E((function(n){var i=new h,r=0;return i.add(e.schedule((function(){r!==t.length?(n.next(t[r++]),n.closed||i.add(this.schedule())):n.complete()}))),i}))}function nt(t,e){return e?et(t,e):new E(tt(t))}function it(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return J(n)?(t.pop(),et(t,n)):nt(t)}function rt(t,e){return new E(e?function(n){return e.schedule(st,0,{error:t,subscriber:n})}:function(e){return e.error(t)})}function st(t){var e=t.error;t.subscriber.error(e)}(Z=t.NotificationKind||(t.NotificationKind={})).NEXT="N",Z.ERROR="E",Z.COMPLETE="C";var ot=function(){function t(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}},t.prototype.accept=function(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)},t.prototype.toObservable=function(){switch(this.kind){case"N":return it(this.value);case"E":return rt(this.error);case"C":return X()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();var at=function(){function t(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return e.subscribe(new ct(t,this.scheduler,this.delay))},t}(),ct=function(t){function e(e,n,i){void 0===i&&(i=0);var r=t.call(this,e)||this;return r.scheduler=n,r.delay=i,r}return n(e,t),e.dispatch=function(t){var e=t.notification,n=t.destination;e.observe(n),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.destination.add(this.scheduler.schedule(e.dispatch,this.delay,new lt(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(ot.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(ot.createError(t)),this.unsubscribe()},e.prototype._complete=function(){this.scheduleMessage(ot.createComplete()),this.unsubscribe()},e}(f),lt=function(t,e){this.notification=t,this.destination=e},ut=function(t){function e(e,n,i){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=t.call(this)||this;return r.scheduler=i,r._events=[],r._infiniteTimeWindow=!1,r._bufferSize=e<1?1:e,r._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(r._infiniteTimeWindow=!0,r.next=r.nextInfiniteTimeWindow):r.next=r.nextTimeWindow,r}return n(e,t),e.prototype.nextInfiniteTimeWindow=function(e){var n=this._events;n.push(e),n.length>this._bufferSize&&n.shift(),t.prototype.next.call(this,e)},e.prototype.nextTimeWindow=function(e){this._events.push(new dt(this._getNow(),e)),this._trimBufferThenGetEvents(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,n=this._infiniteTimeWindow,i=n?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,s=i.length;if(this.closed)throw new S;if(this.isStopped||this.hasError?e=h.EMPTY:(this.observers.push(t),e=new T(this,t)),r&&t.add(t=new ct(t,r)),n)for(var o=0;o<s&&!t.closed;o++)t.next(i[o]);else for(o=0;o<s&&!t.closed;o++)t.next(i[o].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||Y).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,n=this._windowTime,i=this._events,r=i.length,s=0;s<r&&!(t-i[s].time<n);)s++;return r>e&&(s=Math.max(s,r-e)),s>0&&i.splice(0,s),i},e}(R),dt=function(t,e){this.time=t,this.value=e},ht=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.value=null,e.hasNext=!1,e.hasCompleted=!1,e}return n(e,t),e.prototype._subscribe=function(e){return this.hasError?(e.error(this.thrownError),h.EMPTY):this.hasCompleted&&this.hasNext?(e.next(this.value),e.complete(),h.EMPTY):t.prototype._subscribe.call(this,e)},e.prototype.next=function(t){this.hasCompleted||(this.value=t,this.hasNext=!0)},e.prototype.error=function(e){this.hasCompleted||t.prototype.error.call(this,e)},e.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&t.prototype.next.call(this,this.value),t.prototype.complete.call(this)},e}(R),At=1,pt=Promise.resolve(),ft={};function mt(t){return t in ft&&(delete ft[t],!0)}var gt=function(t){var e=At++;return ft[e]=!0,pt.then((function(){return mt(e)&&t()})),e},vt=function(t){mt(t)},yt=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return n(e,t),e.prototype.requestAsyncId=function(e,n,i){return void 0===i&&(i=0),null!==i&&i>0?t.prototype.requestAsyncId.call(this,e,n,i):(e.actions.push(this),e.scheduled||(e.scheduled=gt(e.flush.bind(e,null))))},e.prototype.recycleAsyncId=function(e,n,i){if(void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,i);0===e.actions.length&&(vt(n),e.scheduled=void 0)},e}(G),_t=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,i=-1,r=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++i<r&&(t=n.shift()));if(this.active=!1,e){for(;++i<r&&(t=n.shift());)t.unsubscribe();throw e}},e}(W),bt=new _t(yt),Et=bt,wt=new W(G),St=wt,Tt=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.scheduler=e,i.work=n,i}return n(e,t),e.prototype.requestAsyncId=function(e,n,i){return void 0===i&&(i=0),null!==i&&i>0?t.prototype.requestAsyncId.call(this,e,n,i):(e.actions.push(this),e.scheduled||(e.scheduled=requestAnimationFrame((function(){return e.flush(null)}))))},e.prototype.recycleAsyncId=function(e,n,i){if(void 0===i&&(i=0),null!==i&&i>0||null===i&&this.delay>0)return t.prototype.recycleAsyncId.call(this,e,n,i);0===e.actions.length&&(cancelAnimationFrame(n),e.scheduled=void 0)},e}(G),Ct=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.flush=function(t){this.active=!0,this.scheduled=void 0;var e,n=this.actions,i=-1,r=n.length;t=t||n.shift();do{if(e=t.execute(t.state,t.delay))break}while(++i<r&&(t=n.shift()));if(this.active=!1,e){for(;++i<r&&(t=n.shift());)t.unsubscribe();throw e}},e}(W),Rt=new Ct(Tt),It=Rt,xt=function(t){function e(e,n){void 0===e&&(e=Ot),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=t.call(this,e,(function(){return i.frame}))||this;return i.maxFrames=n,i.frame=0,i.index=-1,i}return n(e,t),e.prototype.flush=function(){for(var t,e,n=this.actions,i=this.maxFrames;(e=n[0])&&e.delay<=i&&(n.shift(),this.frame=e.delay,!(t=e.execute(e.state,e.delay))););if(t){for(;e=n.shift();)e.unsubscribe();throw t}},e.frameTimeFactor=10,e}(W),Ot=function(t){function e(e,n,i){void 0===i&&(i=e.index+=1);var r=t.call(this,e,n)||this;return r.scheduler=e,r.work=n,r.index=i,r.active=!0,r.index=e.index=i,r}return n(e,t),e.prototype.schedule=function(n,i){if(void 0===i&&(i=0),!this.id)return t.prototype.schedule.call(this,n,i);this.active=!1;var r=new e(this.scheduler,this.work);return this.add(r),r.schedule(n,i)},e.prototype.requestAsyncId=function(t,n,i){void 0===i&&(i=0),this.delay=t.frame+i;var r=t.actions;return r.push(this),r.sort(e.sortActions),!0},e.prototype.recycleAsyncId=function(t,e,n){void 0===n&&(n=0)},e.prototype._execute=function(e,n){if(!0===this.active)return t.prototype._execute.call(this,e,n)},e.sortActions=function(t,e){return t.delay===e.delay?t.index===e.index?0:t.index>e.index?1:-1:t.delay>e.delay?1:-1},e}(G);function Lt(){}var Mt=function(){function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t}(),kt=function(){function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t}(),Nt=function(){function t(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return t.prototype=Object.create(Error.prototype),t}();function Pt(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Dt(t,e))}}var Dt=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new Bt(t,this.project,this.thisArg))},t}(),Bt=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.project=n,r.count=0,r.thisArg=i||r,r}return n(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(f);function Ut(t){var e=this,n=t.args,i=t.subscriber,r=t.params,s=r.callbackFunc,o=r.context,a=r.scheduler,c=r.subject;if(!c){c=r.subject=new ht;try{s.apply(o,n.concat([function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=t.length<=1?t[0]:t;e.add(a.schedule(Ft,0,{value:i,subject:c}))}]))}catch(t){c.error(t)}}this.add(c.subscribe(i))}function Ft(t){var e=t.value,n=t.subject;n.next(e),n.complete()}function Ht(t){var e=this,n=t.params,i=t.subscriber,r=t.context,s=n.callbackFunc,o=n.args,a=n.scheduler,c=n.subject;if(!c){c=n.subject=new ht;try{s.apply(r,o.concat([function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var i=t.shift();if(i)e.add(a.schedule(jt,0,{err:i,subject:c}));else{var r=t.length<=1?t[0]:t;e.add(a.schedule(Vt,0,{value:r,subject:c}))}}]))}catch(t){this.add(a.schedule(jt,0,{err:t,subject:c}))}}this.add(c.subscribe(i))}function Vt(t){var e=t.value,n=t.subject;n.next(e),n.complete()}function jt(t){var e=t.err;t.subject.error(e)}var Gt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.notifyNext=function(t,e,n,i,r){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(f),Qt=function(t){function e(e,n,i){var r=t.call(this)||this;return r.parent=e,r.outerValue=n,r.outerIndex=i,r.index=0,r}return n(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(f);var zt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",Wt=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function Kt(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var qt=function(t){if(t&&"function"==typeof t[v])return i=t,function(t){var e=i[v]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(Wt(t))return tt(t);if(Kt(t))return n=t,function(t){return n.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,a),t};if(t&&"function"==typeof t[zt])return e=t,function(t){for(var n=e[zt]();;){var i=void 0;try{i=n.next()}catch(e){return t.error(e),t}if(i.done){t.complete();break}if(t.next(i.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t};var e,n,i,r=u(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+r+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function Yt(t,e,n,i,r){if(void 0===r&&(r=new Qt(t,n,i)),!r.closed)return e instanceof E?e.subscribe(r):qt(e)(r)}var $t={};var Xt=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Jt(t,this.resultSelector))},t}(),Jt=function(t){function e(e,n){var i=t.call(this,e)||this;return i.resultSelector=n,i.active=0,i.values=[],i.observables=[],i}return n(e,t),e.prototype._next=function(t){this.values.push($t),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var n=0;n<e;n++){var i=t[n];this.add(Yt(this,i,void 0,n))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,n){var i=this.values,r=i[n],s=this.toRespond?r===$t?--this.toRespond:this.toRespond:0;i[n]=e,0===s&&(this.resultSelector?this._tryResultSelector(i):this.destination.next(i.slice()))},e.prototype._tryResultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Gt);function Zt(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[v]}(t))return function(t,e){return new E((function(n){var i=new h;return i.add(e.schedule((function(){var r=t[v]();i.add(r.subscribe({next:function(t){i.add(e.schedule((function(){return n.next(t)})))},error:function(t){i.add(e.schedule((function(){return n.error(t)})))},complete:function(){i.add(e.schedule((function(){return n.complete()})))}}))}))),i}))}(t,e);if(Kt(t))return function(t,e){return new E((function(n){var i=new h;return i.add(e.schedule((function(){return t.then((function(t){i.add(e.schedule((function(){n.next(t),i.add(e.schedule((function(){return n.complete()})))})))}),(function(t){i.add(e.schedule((function(){return n.error(t)})))}))}))),i}))}(t,e);if(Wt(t))return et(t,e);if(function(t){return t&&"function"==typeof t[zt]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new E((function(n){var i,r=new h;return r.add((function(){i&&"function"==typeof i.return&&i.return()})),r.add(e.schedule((function(){i=t[zt](),r.add(e.schedule((function(){if(!n.closed){var t,e;try{var r=i.next();t=r.value,e=r.done}catch(t){return void n.error(t)}e?n.complete():(n.next(t),this.schedule())}})))}))),r}))}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function te(t,e){return e?Zt(t,e):t instanceof E?t:new E(qt(t))}var ee=function(t){function e(e){var n=t.call(this)||this;return n.parent=e,n}return n(e,t),e.prototype._next=function(t){this.parent.notifyNext(t)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},e}(f),ne=(function(t){function e(e,n,i){var r=t.call(this)||this;return r.parent=e,r.outerValue=n,r.outerIndex=i,r}n(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this)},e.prototype._error=function(t){this.parent.notifyError(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(f),function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.destination.complete()},e}(f));!function(t){function e(){return null!==t&&t.apply(this,arguments)||this}n(e,t),e.prototype.notifyNext=function(t,e,n,i){this.destination.next(e)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()}}(f);function ie(t,e){if(!e.closed)return t instanceof E?t.subscribe(e):qt(t)(e)}function re(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?function(i){return i.pipe(re((function(n,i){return te(t(n,i)).pipe(Pt((function(t,r){return e(n,t,i,r)})))}),n))}:("number"==typeof e&&(n=e),function(e){return e.lift(new se(t,n))})}var se=function(){function t(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=e}return t.prototype.call=function(t,e){return e.subscribe(new oe(t,this.project,this.concurrent))},t}(),oe=function(t){function e(e,n,i){void 0===i&&(i=Number.POSITIVE_INFINITY);var r=t.call(this,e)||this;return r.project=n,r.concurrent=i,r.hasCompleted=!1,r.buffer=[],r.active=0,r.index=0,r}return n(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new ee(this),n=this.destination;n.add(e);var i=ie(t,e);i!==e&&n.add(i)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(ne),ae=re;function ce(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),re(y,t)}function le(){return ce(1)}function ue(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return le()(it.apply(void 0,t))}function de(t){return new E((function(e){var n;try{n=t()}catch(t){return void e.error(t)}return(n?te(n):X()).subscribe(e)}))}function he(t,e){return new E((function(n){var i=t.length;if(0!==i)for(var r=new Array(i),s=0,o=0,a=function(a){var c=te(t[a]),l=!1;n.add(c.subscribe({next:function(t){l||(l=!0,o++),r[a]=t},error:function(t){return n.error(t)},complete:function(){++s!==i&&l||(o===i&&n.next(e?e.reduce((function(t,e,n){return t[e]=r[n],t}),{}):r),n.complete())}}))},c=0;c<i;c++)a(c);else n.complete()}))}function Ae(t,e,n,i,r){var s;if(function(t){return t&&"function"==typeof t.addEventListener&&"function"==typeof t.removeEventListener}(t)){var o=t;t.addEventListener(e,n,r),s=function(){return o.removeEventListener(e,n,r)}}else if(function(t){return t&&"function"==typeof t.on&&"function"==typeof t.off}(t)){var a=t;t.on(e,n),s=function(){return a.off(e,n)}}else if(function(t){return t&&"function"==typeof t.addListener&&"function"==typeof t.removeListener}(t)){var c=t;t.addListener(e,n),s=function(){return c.removeListener(e,n)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var l=0,u=t.length;l<u;l++)Ae(t[l],e,n,i,r)}i.add(s)}function pe(t){var e=t.subscriber,n=t.condition;if(!e.closed){if(t.needIterate)try{t.state=t.iterate(t.state)}catch(t){return void e.error(t)}else t.needIterate=!0;if(n){var i=void 0;try{i=n(t.state)}catch(t){return void e.error(t)}if(!i)return void e.complete();if(e.closed)return}var r;try{r=t.resultSelector(t.state)}catch(t){return void e.error(t)}if(!e.closed&&(e.next(r),!e.closed))return this.schedule(t)}}function fe(t){return!l(t)&&t-parseFloat(t)+1>=0}function me(t){var e=t.subscriber,n=t.counter,i=t.period;e.next(n),this.schedule({subscriber:e,counter:n+1,period:i},i)}function ge(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=Number.POSITIVE_INFINITY,i=null,r=t[t.length-1];return J(r)?(i=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(n=t.pop())):"number"==typeof r&&(n=t.pop()),null===i&&1===t.length&&t[0]instanceof E?t[0]:ce(n)(nt(t,i))}var ve=new E(Lt);function ye(t){var e=t.keys,n=t.index,i=t.subscriber,r=t.subscription,s=t.obj;if(!i.closed)if(n<e.length){var o=e[n];i.next([o,s[o]]),r.add(this.schedule({keys:e,index:n+1,subscriber:i,subscription:r,obj:s}))}else i.complete()}function _e(t,e){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=t,n.thisArg=e,n}function be(t,e){return function(n){return n.lift(new Ee(t,e))}}var Ee=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new we(t,this.predicate,this.thisArg))},t}(),we=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.predicate=n,r.thisArg=i,r.count=0,r}return n(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}e&&this.destination.next(t)},e}(f);function Se(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){if(!l(t[0]))return t[0];t=t[0]}return nt(t,void 0).lift(new Te)}var Te=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Ce(t))},t}(),Ce=function(t){function e(e){var n=t.call(this,e)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return n(e,t),e.prototype._next=function(t){this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{for(var n=0;n<e&&!this.hasFirst;n++){var i=Yt(this,t[n],void 0,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},e.prototype.notifyNext=function(t,e,n){if(!this.hasFirst){this.hasFirst=!0;for(var i=0;i<this.subscriptions.length;i++)if(i!==n){var r=this.subscriptions[i];r.unsubscribe(),this.remove(r)}this.subscriptions=null}this.destination.next(e)},e}(Gt);function Re(t){var e=t.start,n=t.index,i=t.count,r=t.subscriber;n>=i?r.complete():(r.next(e),r.closed||(t.index=n+1,t.start=e+1,this.schedule(t)))}function Ie(t,e,n){void 0===t&&(t=0);var i=-1;return fe(e)?i=Number(e)<1?1:Number(e):J(e)&&(n=e),J(n)||(n=St),new E((function(e){var r=fe(t)?t:+t-n.now();return n.schedule(xe,r,{index:0,period:i,subscriber:e})}))}function xe(t){var e=t.index,n=t.period,i=t.subscriber;if(i.next(e),!i.closed){if(-1===n)return i.complete();t.index=e+1,this.schedule(t,n)}}function Oe(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return"function"==typeof n&&t.pop(),nt(t,void 0).lift(new Le(n))}var Le=function(){function t(t){this.resultSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Me(t,this.resultSelector))},t}(),Me=function(t){function e(e,n,i){void 0===i&&(i=Object.create(null));var r=t.call(this,e)||this;return r.resultSelector=n,r.iterators=[],r.active=0,r.resultSelector="function"==typeof n?n:void 0,r}return n(e,t),e.prototype._next=function(t){var e=this.iterators;l(t)?e.push(new Ne(t)):"function"==typeof t[zt]?e.push(new ke(t[zt]())):e.push(new Pe(this.destination,this,t))},e.prototype._complete=function(){var t=this.iterators,e=t.length;if(this.unsubscribe(),0!==e){this.active=e;for(var n=0;n<e;n++){var i=t[n];if(i.stillUnsubscribed)this.destination.add(i.subscribe());else this.active--}}else this.destination.complete()},e.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},e.prototype.checkIterators=function(){for(var t=this.iterators,e=t.length,n=this.destination,i=0;i<e;i++){if("function"==typeof(o=t[i]).hasValue&&!o.hasValue())return}var r=!1,s=[];for(i=0;i<e;i++){var o,a=(o=t[i]).next();if(o.hasCompleted()&&(r=!0),a.done)return void n.complete();s.push(a.value)}this.resultSelector?this._tryresultSelector(s):n.next(s),r&&n.complete()},e.prototype._tryresultSelector=function(t){var e;try{e=this.resultSelector.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(f),ke=function(){function t(t){this.iterator=t,this.nextResult=t.next()}return t.prototype.hasValue=function(){return!0},t.prototype.next=function(){var t=this.nextResult;return this.nextResult=this.iterator.next(),t},t.prototype.hasCompleted=function(){var t=this.nextResult;return Boolean(t&&t.done)},t}(),Ne=function(){function t(t){this.array=t,this.index=0,this.length=0,this.length=t.length}return t.prototype[zt]=function(){return this},t.prototype.next=function(t){var e=this.index++,n=this.array;return e<this.length?{value:n[e],done:!1}:{value:null,done:!0}},t.prototype.hasValue=function(){return this.array.length>this.index},t.prototype.hasCompleted=function(){return this.array.length===this.index},t}(),Pe=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.parent=n,r.observable=i,r.stillUnsubscribed=!0,r.buffer=[],r.isComplete=!1,r}return n(e,t),e.prototype[zt]=function(){return this},e.prototype.next=function(){var t=this.buffer;return 0===t.length&&this.isComplete?{value:null,done:!0}:{value:t.shift(),done:!1}},e.prototype.hasValue=function(){return this.buffer.length>0},e.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},e.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},e.prototype.notifyNext=function(t){this.buffer.push(t),this.parent.checkIterators()},e.prototype.subscribe=function(){return ie(this.observable,new ee(this))},e}(ne);function De(t){return function(e){return e.lift(new Be(t))}}var Be=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Ue(t,this.durationSelector))},t}(),Ue=function(t){function e(e,n){var i=t.call(this,e)||this;return i.durationSelector=n,i.hasValue=!1,i}return n(e,t),e.prototype._next=function(t){if(this.value=t,this.hasValue=!0,!this.throttled){var e=void 0;try{e=(0,this.durationSelector)(t)}catch(t){return this.destination.error(t)}var n=ie(e,new ee(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},e.prototype.clearThrottle=function(){var t=this,e=t.value,n=t.hasValue,i=t.throttled;i&&(this.remove(i),this.throttled=void 0,i.unsubscribe()),n&&(this.value=void 0,this.hasValue=!1,this.destination.next(e))},e.prototype.notifyNext=function(){this.clearThrottle()},e.prototype.notifyComplete=function(){this.clearThrottle()},e}(ne);var Fe=function(){function t(t){this.closingNotifier=t}return t.prototype.call=function(t,e){return e.subscribe(new He(t,this.closingNotifier))},t}(),He=function(t){function e(e,n){var i=t.call(this,e)||this;return i.buffer=[],i.add(ie(n,new ee(i))),i}return n(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype.notifyNext=function(){var t=this.buffer;this.buffer=[],this.destination.next(t)},e}(ne);var Ve=function(){function t(t,e){this.bufferSize=t,this.startBufferEvery=e,this.subscriberClass=e&&t!==e?Ge:je}return t.prototype.call=function(t,e){return e.subscribe(new this.subscriberClass(t,this.bufferSize,this.startBufferEvery))},t}(),je=function(t){function e(e,n){var i=t.call(this,e)||this;return i.bufferSize=n,i.buffer=[],i}return n(e,t),e.prototype._next=function(t){var e=this.buffer;e.push(t),e.length==this.bufferSize&&(this.destination.next(e),this.buffer=[])},e.prototype._complete=function(){var e=this.buffer;e.length>0&&this.destination.next(e),t.prototype._complete.call(this)},e}(f),Ge=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.bufferSize=n,r.startBufferEvery=i,r.buffers=[],r.count=0,r}return n(e,t),e.prototype._next=function(t){var e=this,n=e.bufferSize,i=e.startBufferEvery,r=e.buffers,s=e.count;this.count++,s%i==0&&r.push([]);for(var o=r.length;o--;){var a=r[o];a.push(t),a.length===n&&(r.splice(o,1),this.destination.next(a))}},e.prototype._complete=function(){for(var e=this.buffers,n=this.destination;e.length>0;){var i=e.shift();i.length>0&&n.next(i)}t.prototype._complete.call(this)},e}(f);var Qe=function(){function t(t,e,n,i){this.bufferTimeSpan=t,this.bufferCreationInterval=e,this.maxBufferSize=n,this.scheduler=i}return t.prototype.call=function(t,e){return e.subscribe(new We(t,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},t}(),ze=function(){this.buffer=[]},We=function(t){function e(e,n,i,r,s){var o=t.call(this,e)||this;o.bufferTimeSpan=n,o.bufferCreationInterval=i,o.maxBufferSize=r,o.scheduler=s,o.contexts=[];var a=o.openContext();if(o.timespanOnly=null==i||i<0,o.timespanOnly){var c={subscriber:o,context:a,bufferTimeSpan:n};o.add(a.closeAction=s.schedule(Ke,n,c))}else{var l={subscriber:o,context:a},u={bufferTimeSpan:n,bufferCreationInterval:i,subscriber:o,scheduler:s};o.add(a.closeAction=s.schedule(Ye,n,l)),o.add(s.schedule(qe,i,u))}return o}return n(e,t),e.prototype._next=function(t){for(var e,n=this.contexts,i=n.length,r=0;r<i;r++){var s=n[r],o=s.buffer;o.push(t),o.length==this.maxBufferSize&&(e=s)}e&&this.onBufferFull(e)},e.prototype._error=function(e){this.contexts.length=0,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts,n=this.destination;e.length>0;){var i=e.shift();n.next(i.buffer)}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.contexts=null},e.prototype.onBufferFull=function(t){this.closeContext(t);var e=t.closeAction;if(e.unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){t=this.openContext();var n=this.bufferTimeSpan,i={subscriber:this,context:t,bufferTimeSpan:n};this.add(t.closeAction=this.scheduler.schedule(Ke,n,i))}},e.prototype.openContext=function(){var t=new ze;return this.contexts.push(t),t},e.prototype.closeContext=function(t){this.destination.next(t.buffer);var e=this.contexts;(e?e.indexOf(t):-1)>=0&&e.splice(e.indexOf(t),1)},e}(f);function Ke(t){var e=t.subscriber,n=t.context;n&&e.closeContext(n),e.closed||(t.context=e.openContext(),t.context.closeAction=this.schedule(t,t.bufferTimeSpan))}function qe(t){var e=t.bufferCreationInterval,n=t.bufferTimeSpan,i=t.subscriber,r=t.scheduler,s=i.openContext();i.closed||(i.add(s.closeAction=r.schedule(Ye,n,{subscriber:i,context:s})),this.schedule(t,e))}function Ye(t){var e=t.subscriber,n=t.context;e.closeContext(n)}var $e=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new Xe(t,this.openings,this.closingSelector))},t}(),Xe=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.closingSelector=i,r.contexts=[],r.add(Yt(r,n)),r}return n(e,t),e.prototype._next=function(t){for(var e=this.contexts,n=e.length,i=0;i<n;i++)e[i].buffer.push(t)},e.prototype._error=function(e){for(var n=this.contexts;n.length>0;){var i=n.shift();i.subscription.unsubscribe(),i.buffer=null,i.subscription=null}this.contexts=null,t.prototype._error.call(this,e)},e.prototype._complete=function(){for(var e=this.contexts;e.length>0;){var n=e.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,t.prototype._complete.call(this)},e.prototype.notifyNext=function(t,e){t?this.closeBuffer(t):this.openBuffer(e)},e.prototype.notifyComplete=function(t){this.closeBuffer(t.context)},e.prototype.openBuffer=function(t){try{var e=this.closingSelector.call(this,t);e&&this.trySubscribe(e)}catch(t){this._error(t)}},e.prototype.closeBuffer=function(t){var e=this.contexts;if(e&&t){var n=t.buffer,i=t.subscription;this.destination.next(n),e.splice(e.indexOf(t),1),this.remove(i),i.unsubscribe()}},e.prototype.trySubscribe=function(t){var e=this.contexts,n=new h,i={buffer:[],subscription:n};e.push(i);var r=Yt(this,t,i);!r||r.closed?this.closeBuffer(i):(r.context=i,this.add(r),n.add(r))},e}(Gt);var Je=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Ze(t,this.closingSelector))},t}(),Ze=function(t){function e(e,n){var i=t.call(this,e)||this;return i.closingSelector=n,i.subscribing=!1,i.openBuffer(),i}return n(e,t),e.prototype._next=function(t){this.buffer.push(t)},e.prototype._complete=function(){var e=this.buffer;e&&this.destination.next(e),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},e.prototype.notifyNext=function(){this.openBuffer()},e.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},e.prototype.openBuffer=function(){var t=this.closingSubscription;t&&(this.remove(t),t.unsubscribe());var e,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{e=(0,this.closingSelector)()}catch(t){return this.error(t)}t=new h,this.closingSubscription=t,this.add(t),this.subscribing=!0,t.add(ie(e,new ee(this))),this.subscribing=!1},e}(ne);var tn=function(){function t(t){this.selector=t}return t.prototype.call=function(t,e){return e.subscribe(new en(t,this.selector,this.caught))},t}(),en=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.selector=n,r.caught=i,r}return n(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=void 0;try{n=this.selector(e,this.caught)}catch(e){return void t.prototype.error.call(this,e)}this._unsubscribeAndRecycle();var i=new ee(this);this.add(i);var r=ie(n,i);r!==i&&this.add(r)}},e}(ne);function nn(t,e){return re(t,e,1)}var rn=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new sn(t,this.predicate,this.source))},t}(),sn=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.predicate=n,r.source=i,r.count=0,r.index=0,r}return n(e,t),e.prototype._next=function(t){this.predicate?this._tryPredicate(t):this.count++},e.prototype._tryPredicate=function(t){var e;try{e=this.predicate(t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e&&this.count++},e.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},e}(f);var on=function(){function t(t){this.durationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new an(t,this.durationSelector))},t}(),an=function(t){function e(e,n){var i=t.call(this,e)||this;return i.durationSelector=n,i.hasValue=!1,i}return n(e,t),e.prototype._next=function(t){try{var e=this.durationSelector.call(this,t);e&&this._tryNext(t,e)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.emitValue(),this.destination.complete()},e.prototype._tryNext=function(t,e){var n=this.durationSubscription;this.value=t,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=ie(e,new ee(this)))&&!n.closed&&this.add(this.durationSubscription=n)},e.prototype.notifyNext=function(){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){if(this.hasValue){var e=this.value,n=this.durationSubscription;n&&(this.durationSubscription=void 0,n.unsubscribe(),this.remove(n)),this.value=void 0,this.hasValue=!1,t.prototype._next.call(this,e)}},e}(ne);var cn=function(){function t(t,e){this.dueTime=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new ln(t,this.dueTime,this.scheduler))},t}(),ln=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.dueTime=n,r.scheduler=i,r.debouncedSubscription=null,r.lastValue=null,r.hasValue=!1,r}return n(e,t),e.prototype._next=function(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(un,this.dueTime,this))},e.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},e.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var t=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}},e.prototype.clearDebounce=function(){var t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)},e}(f);function un(t){t.debouncedNext()}function dn(t){return void 0===t&&(t=null),function(e){return e.lift(new hn(t))}}var hn=function(){function t(t){this.defaultValue=t}return t.prototype.call=function(t,e){return e.subscribe(new An(t,this.defaultValue))},t}(),An=function(t){function e(e,n){var i=t.call(this,e)||this;return i.defaultValue=n,i.isEmpty=!0,i}return n(e,t),e.prototype._next=function(t){this.isEmpty=!1,this.destination.next(t)},e.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},e}(f);function pn(t){return t instanceof Date&&!isNaN(+t)}var fn=function(){function t(t,e){this.delay=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new mn(t,this.delay,this.scheduler))},t}(),mn=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.delay=n,r.scheduler=i,r.queue=[],r.active=!1,r.errored=!1,r}return n(e,t),e.dispatch=function(t){for(var e=t.source,n=e.queue,i=t.scheduler,r=t.destination;n.length>0&&n[0].time-i.now()<=0;)n.shift().notification.observe(r);if(n.length>0){var s=Math.max(0,n[0].time-i.now());this.schedule(t,s)}else this.unsubscribe(),e.active=!1},e.prototype._schedule=function(t){this.active=!0,this.destination.add(t.schedule(e.dispatch,this.delay,{source:this,destination:this.destination,scheduler:t}))},e.prototype.scheduleNotification=function(t){if(!0!==this.errored){var e=this.scheduler,n=new gn(e.now()+this.delay,t);this.queue.push(n),!1===this.active&&this._schedule(e)}},e.prototype._next=function(t){this.scheduleNotification(ot.createNext(t))},e.prototype._error=function(t){this.errored=!0,this.queue=[],this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.scheduleNotification(ot.createComplete()),this.unsubscribe()},e}(f),gn=function(t,e){this.time=t,this.notification=e};var vn=function(){function t(t){this.delayDurationSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new yn(t,this.delayDurationSelector))},t}(),yn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.delayDurationSelector=n,i.completed=!1,i.delayNotifierSubscriptions=[],i.index=0,i}return n(e,t),e.prototype.notifyNext=function(t,e,n,i,r){this.destination.next(t),this.removeSubscription(r),this.tryComplete()},e.prototype.notifyError=function(t,e){this._error(t)},e.prototype.notifyComplete=function(t){var e=this.removeSubscription(t);e&&this.destination.next(e),this.tryComplete()},e.prototype._next=function(t){var e=this.index++;try{var n=this.delayDurationSelector(t,e);n&&this.tryDelay(n,t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},e.prototype.removeSubscription=function(t){t.unsubscribe();var e=this.delayNotifierSubscriptions.indexOf(t);return-1!==e&&this.delayNotifierSubscriptions.splice(e,1),t.outerValue},e.prototype.tryDelay=function(t,e){var n=Yt(this,t,e);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},e.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},e}(Gt),_n=function(t){function e(e,n){var i=t.call(this)||this;return i.source=e,i.subscriptionDelay=n,i}return n(e,t),e.prototype._subscribe=function(t){this.subscriptionDelay.subscribe(new bn(t,this.source))},e}(E),bn=function(t){function e(e,n){var i=t.call(this)||this;return i.parent=e,i.source=n,i.sourceSubscribed=!1,i}return n(e,t),e.prototype._next=function(t){this.subscribeToSource()},e.prototype._error=function(t){this.unsubscribe(),this.parent.error(t)},e.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},e.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},e}(f);var En=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new wn(t))},t}(),wn=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype._next=function(t){t.observe(this.destination)},e}(f);var Sn=function(){function t(t,e){this.keySelector=t,this.flushes=e}return t.prototype.call=function(t,e){return e.subscribe(new Tn(t,this.keySelector,this.flushes))},t}(),Tn=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.keySelector=n,r.values=new Set,i&&r.add(ie(i,new ee(r))),r}return n(e,t),e.prototype.notifyNext=function(){this.values.clear()},e.prototype.notifyError=function(t){this._error(t)},e.prototype._next=function(t){this.keySelector?this._useKeySelector(t):this._finalizeNext(t,t)},e.prototype._useKeySelector=function(t){var e,n=this.destination;try{e=this.keySelector(t)}catch(t){return void n.error(t)}this._finalizeNext(e,t)},e.prototype._finalizeNext=function(t,e){var n=this.values;n.has(t)||(n.add(t),this.destination.next(e))},e}(ne);function Cn(t,e){return function(n){return n.lift(new Rn(t,e))}}var Rn=function(){function t(t,e){this.compare=t,this.keySelector=e}return t.prototype.call=function(t,e){return e.subscribe(new In(t,this.compare,this.keySelector))},t}(),In=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.keySelector=i,r.hasKey=!1,"function"==typeof n&&(r.compare=n),r}return n(e,t),e.prototype.compare=function(t,e){return t===e},e.prototype._next=function(t){var e;try{var n=this.keySelector;e=n?n(t):t}catch(t){return this.destination.error(t)}var i=!1;if(this.hasKey)try{i=(0,this.compare)(this.key,e)}catch(t){return this.destination.error(t)}else this.hasKey=!0;i||(this.key=e,this.destination.next(t))},e}(f);function xn(t){return void 0===t&&(t=Mn),function(e){return e.lift(new On(t))}}var On=function(){function t(t){this.errorFactory=t}return t.prototype.call=function(t,e){return e.subscribe(new Ln(t,this.errorFactory))},t}(),Ln=function(t){function e(e,n){var i=t.call(this,e)||this;return i.errorFactory=n,i.hasValue=!1,i}return n(e,t),e.prototype._next=function(t){this.hasValue=!0,this.destination.next(t)},e.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var t=void 0;try{t=this.errorFactory()}catch(e){t=e}this.destination.error(t)},e}(f);function Mn(){return new kt}function kn(t){return function(e){return 0===t?X():e.lift(new Nn(t))}}var Nn=function(){function t(t){if(this.total=t,this.total<0)throw new Mt}return t.prototype.call=function(t,e){return e.subscribe(new Pn(t,this.total))},t}(),Pn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.total=n,i.count=0,i}return n(e,t),e.prototype._next=function(t){var e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))},e}(f);var Dn=function(){function t(t,e,n){this.predicate=t,this.thisArg=e,this.source=n}return t.prototype.call=function(t,e){return e.subscribe(new Bn(t,this.predicate,this.thisArg,this.source))},t}(),Bn=function(t){function e(e,n,i,r){var s=t.call(this,e)||this;return s.predicate=n,s.thisArg=i,s.source=r,s.index=0,s.thisArg=i||s,s}return n(e,t),e.prototype.notifyComplete=function(t){this.destination.next(t),this.destination.complete()},e.prototype._next=function(t){var e=!1;try{e=this.predicate.call(this.thisArg,t,this.index++,this.source)}catch(t){return void this.destination.error(t)}e||this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(f);var Un=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Fn(t))},t}(),Fn=function(t){function e(e){var n=t.call(this,e)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return n(e,t),e.prototype._next=function(t){this.hasSubscription||(this.hasSubscription=!0,this.add(ie(t,new ee(this))))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(ne);var Hn=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new Vn(t,this.project))},t}(),Vn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.project=n,i.hasSubscription=!1,i.hasCompleted=!1,i.index=0,i}return n(e,t),e.prototype._next=function(t){this.hasSubscription||this.tryNext(t)},e.prototype.tryNext=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this.hasSubscription=!0,this._innerSub(e)},e.prototype._innerSub=function(t){var e=new ee(this),n=this.destination;n.add(e);var i=ie(t,e);i!==e&&n.add(i)},e.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this.destination.next(t)},e.prototype.notifyError=function(t){this.destination.error(t)},e.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},e}(ne);var jn=function(){function t(t,e,n){this.project=t,this.concurrent=e,this.scheduler=n}return t.prototype.call=function(t,e){return e.subscribe(new Gn(t,this.project,this.concurrent,this.scheduler))},t}(),Gn=function(t){function e(e,n,i,r){var s=t.call(this,e)||this;return s.project=n,s.concurrent=i,s.scheduler=r,s.index=0,s.active=0,s.hasCompleted=!1,i<Number.POSITIVE_INFINITY&&(s.buffer=[]),s}return n(e,t),e.dispatch=function(t){var e=t.subscriber,n=t.result,i=t.value,r=t.index;e.subscribeToProjection(n,i,r)},e.prototype._next=function(t){var n=this.destination;if(n.closed)this._complete();else{var i=this.index++;if(this.active<this.concurrent){n.next(t);try{var r=(0,this.project)(t,i);if(this.scheduler){var s={subscriber:this,result:r,value:t,index:i};this.destination.add(this.scheduler.schedule(e.dispatch,0,s))}else this.subscribeToProjection(r,t,i)}catch(t){n.error(t)}}else this.buffer.push(t)}},e.prototype.subscribeToProjection=function(t,e,n){this.active++,this.destination.add(ie(t,new ee(this)))},e.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},e.prototype.notifyNext=function(t){this._next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},e}(ne);var Qn=function(){function t(t){this.callback=t}return t.prototype.call=function(t,e){return e.subscribe(new zn(t,this.callback))},t}(),zn=function(t){function e(e,n){var i=t.call(this,e)||this;return i.add(new h(n)),i}return n(e,t),e}(f);var Wn=function(){function t(t,e,n,i){this.predicate=t,this.source=e,this.yieldIndex=n,this.thisArg=i}return t.prototype.call=function(t,e){return e.subscribe(new Kn(t,this.predicate,this.source,this.yieldIndex,this.thisArg))},t}(),Kn=function(t){function e(e,n,i,r,s){var o=t.call(this,e)||this;return o.predicate=n,o.source=i,o.yieldIndex=r,o.thisArg=s,o.index=0,o}return n(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete(),this.unsubscribe()},e.prototype._next=function(t){var e=this.predicate,n=this.thisArg,i=this.index++;try{e.call(n||this,t,i,this.source)&&this.notifyComplete(this.yieldIndex?i:t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},e}(f);var qn=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Yn(t))},t}(),Yn=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype._next=function(t){},e}(f);var $n=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new Xn(t))},t}(),Xn=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype.notifyComplete=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype._next=function(t){this.notifyComplete(!1)},e.prototype._complete=function(){this.notifyComplete(!0)},e}(f);function Jn(t){return function(e){return 0===t?X():e.lift(new Zn(t))}}var Zn=function(){function t(t){if(this.total=t,this.total<0)throw new Mt}return t.prototype.call=function(t,e){return e.subscribe(new ti(t,this.total))},t}(),ti=function(t){function e(e,n){var i=t.call(this,e)||this;return i.total=n,i.ring=new Array,i.count=0,i}return n(e,t),e.prototype._next=function(t){var e=this.ring,n=this.total,i=this.count++;e.length<n?e.push(t):e[i%n]=t},e.prototype._complete=function(){var t=this.destination,e=this.count;if(e>0)for(var n=this.count>=this.total?this.total:this.count,i=this.ring,r=0;r<n;r++){var s=e++%n;t.next(i[s])}t.complete()},e}(f);var ei=function(){function t(t){this.value=t}return t.prototype.call=function(t,e){return e.subscribe(new ni(t,this.value))},t}(),ni=function(t){function e(e,n){var i=t.call(this,e)||this;return i.value=n,i}return n(e,t),e.prototype._next=function(t){this.destination.next(this.value)},e}(f);var ii=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new ri(t))},t}(),ri=function(t){function e(e){return t.call(this,e)||this}return n(e,t),e.prototype._next=function(t){this.destination.next(ot.createNext(t))},e.prototype._error=function(t){var e=this.destination;e.next(ot.createError(t)),e.complete()},e.prototype._complete=function(){var t=this.destination;t.next(ot.createComplete()),t.complete()},e}(f);function si(t,e){var n=!1;return arguments.length>=2&&(n=!0),function(i){return i.lift(new oi(t,e,n))}}var oi=function(){function t(t,e,n){void 0===n&&(n=!1),this.accumulator=t,this.seed=e,this.hasSeed=n}return t.prototype.call=function(t,e){return e.subscribe(new ai(t,this.accumulator,this.seed,this.hasSeed))},t}(),ai=function(t){function e(e,n,i,r){var s=t.call(this,e)||this;return s.accumulator=n,s._seed=i,s.hasSeed=r,s.index=0,s}return n(e,t),Object.defineProperty(e.prototype,"seed",{get:function(){return this._seed},set:function(t){this.hasSeed=!0,this._seed=t},enumerable:!0,configurable:!0}),e.prototype._next=function(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)},e.prototype._tryNext=function(t){var e,n=this.index++;try{e=this.accumulator(this.seed,t,n)}catch(t){this.destination.error(t)}this.seed=e,this.destination.next(e)},e}(f);function ci(t,e){return arguments.length>=2?function(n){return _(si(t,e),Jn(1),dn(e))(n)}:function(e){return _(si((function(e,n,i){return t(e,n,i+1)})),Jn(1))(e)}}var li=function(){function t(t,e,n){this.accumulator=t,this.seed=e,this.concurrent=n}return t.prototype.call=function(t,e){return e.subscribe(new ui(t,this.accumulator,this.seed,this.concurrent))},t}(),ui=function(t){function e(e,n,i,r){var s=t.call(this,e)||this;return s.accumulator=n,s.acc=i,s.concurrent=r,s.hasValue=!1,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return n(e,t),e.prototype._next=function(t){if(this.active<this.concurrent){var e=this.index++,n=this.destination,i=void 0;try{i=(0,this.accumulator)(this.acc,t,e)}catch(t){return n.error(t)}this.active++,this._innerSub(i)}else this.buffer.push(t)},e.prototype._innerSub=function(t){var e=new ee(this),n=this.destination;n.add(e);var i=ie(t,e);i!==e&&n.add(i)},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},e.prototype.notifyNext=function(t){var e=this.destination;this.acc=t,this.hasValue=!0,e.next(t)},e.prototype.notifyComplete=function(){var t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},e}(ne);function di(t,e){return function(n){var i;if(i="function"==typeof t?t:function(){return t},"function"==typeof e)return n.lift(new hi(i,e));var r=Object.create(n,N);return r.source=n,r.subjectFactory=i,r}}var hi=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var n=this.selector,i=this.subjectFactory(),r=n(i).subscribe(t);return r.add(e.subscribe(i)),r},t}();var Ai=function(){function t(t){this.nextSources=t}return t.prototype.call=function(t,e){return e.subscribe(new pi(t,this.nextSources))},t}(),pi=function(t){function e(e,n){var i=t.call(this,e)||this;return i.destination=e,i.nextSources=n,i}return n(e,t),e.prototype.notifyError=function(){this.subscribeToNextSource()},e.prototype.notifyComplete=function(){this.subscribeToNextSource()},e.prototype._error=function(t){this.subscribeToNextSource(),this.unsubscribe()},e.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},e.prototype.subscribeToNextSource=function(){var t=this.nextSources.shift();if(t){var e=new ee(this),n=this.destination;n.add(e);var i=ie(t,e);i!==e&&n.add(i)}else this.destination.complete()},e}(ne);var fi=function(){function t(){}return t.prototype.call=function(t,e){return e.subscribe(new mi(t))},t}(),mi=function(t){function e(e){var n=t.call(this,e)||this;return n.hasPrev=!1,n}return n(e,t),e.prototype._next=function(t){var e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)},e}(f);function gi(t,e){return function(n){for(var i=n,r=0;r<e;r++){var s=null!=i?i[t[r]]:void 0;if(void 0===s)return;i=s}return i}}var vi=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new yi(t,this.count,this.source))},t}(),yi=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.count=n,r.source=i,r}return n(e,t),e.prototype.complete=function(){if(!this.isStopped){var e=this.source,n=this.count;if(0===n)return t.prototype.complete.call(this);n>-1&&(this.count=n-1),e.subscribe(this._unsubscribeAndRecycle())}},e}(f);var _i=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new bi(t,this.notifier,e))},t}(),bi=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.notifier=n,r.source=i,r.sourceIsBeingSubscribedTo=!0,r}return n(e,t),e.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},e.prototype.notifyComplete=function(){if(!1===this.sourceIsBeingSubscribedTo)return t.prototype.complete.call(this)},e.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return t.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},e.prototype._unsubscribe=function(){var t=this.notifications,e=this.retriesSubscription;t&&(t.unsubscribe(),this.notifications=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype._unsubscribeAndRecycle=function(){var e=this._unsubscribe;return this._unsubscribe=null,t.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=e,this},e.prototype.subscribeToRetries=function(){var e;this.notifications=new R;try{e=(0,this.notifier)(this.notifications)}catch(e){return t.prototype.complete.call(this)}this.retries=e,this.retriesSubscription=ie(e,new ee(this))},e}(ne);var Ei=function(){function t(t,e){this.count=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new wi(t,this.count,this.source))},t}(),wi=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.count=n,r.source=i,r}return n(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.source,i=this.count;if(0===i)return t.prototype.error.call(this,e);i>-1&&(this.count=i-1),n.subscribe(this._unsubscribeAndRecycle())}},e}(f);var Si=function(){function t(t,e){this.notifier=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new Ti(t,this.notifier,this.source))},t}(),Ti=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.notifier=n,r.source=i,r}return n(e,t),e.prototype.error=function(e){if(!this.isStopped){var n=this.errors,i=this.retries,r=this.retriesSubscription;if(i)this.errors=void 0,this.retriesSubscription=void 0;else{n=new R;try{i=(0,this.notifier)(n)}catch(e){return t.prototype.error.call(this,e)}r=ie(i,new ee(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=i,this.retriesSubscription=r,n.next(e)}},e.prototype._unsubscribe=function(){var t=this.errors,e=this.retriesSubscription;t&&(t.unsubscribe(),this.errors=void 0),e&&(e.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},e.prototype.notifyNext=function(){var t=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=t,this.source.subscribe(this)},e}(ne);var Ci=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new Ri(t),i=e.subscribe(n);return i.add(ie(this.notifier,new ee(n))),i},t}(),Ri=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.hasValue=!1,e}return n(e,t),e.prototype._next=function(t){this.value=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.emitValue()},e.prototype.notifyComplete=function(){this.emitValue()},e.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},e}(ne);var Ii=function(){function t(t,e){this.period=t,this.scheduler=e}return t.prototype.call=function(t,e){return e.subscribe(new xi(t,this.period,this.scheduler))},t}(),xi=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.period=n,r.scheduler=i,r.hasValue=!1,r.add(i.schedule(Oi,n,{subscriber:r,period:n})),r}return n(e,t),e.prototype._next=function(t){this.lastValue=t,this.hasValue=!0},e.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},e}(f);function Oi(t){var e=t.subscriber,n=t.period;e.notifyNext(),this.schedule(t,n)}var Li=function(){function t(t,e){this.compareTo=t,this.comparator=e}return t.prototype.call=function(t,e){return e.subscribe(new Mi(t,this.compareTo,this.comparator))},t}(),Mi=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.compareTo=n,r.comparator=i,r._a=[],r._b=[],r._oneComplete=!1,r.destination.add(n.subscribe(new ki(e,r))),r}return n(e,t),e.prototype._next=function(t){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(t),this.checkValues())},e.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},e.prototype.checkValues=function(){for(var t=this,e=t._a,n=t._b,i=t.comparator;e.length>0&&n.length>0;){var r=e.shift(),s=n.shift(),o=!1;try{o=i?i(r,s):r===s}catch(t){this.destination.error(t)}o||this.emit(!1)}},e.prototype.emit=function(t){var e=this.destination;e.next(t),e.complete()},e.prototype.nextB=function(t){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(t),this.checkValues())},e.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},e}(f),ki=function(t){function e(e,n){var i=t.call(this,e)||this;return i.parent=n,i}return n(e,t),e.prototype._next=function(t){this.parent.nextB(t)},e.prototype._error=function(t){this.parent.error(t),this.unsubscribe()},e.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},e}(f);function Ni(){return new R}var Pi=function(){function t(t,e){this.predicate=t,this.source=e}return t.prototype.call=function(t,e){return e.subscribe(new Di(t,this.predicate,this.source))},t}(),Di=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.predicate=n,r.source=i,r.seenValue=!1,r.index=0,r}return n(e,t),e.prototype.applySingleValue=function(t){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=t)},e.prototype._next=function(t){var e=this.index++;this.predicate?this.tryNext(t,e):this.applySingleValue(t)},e.prototype.tryNext=function(t,e){try{this.predicate(t,e,this.source)&&this.applySingleValue(t)}catch(t){this.destination.error(t)}},e.prototype._complete=function(){var t=this.destination;this.index>0?(t.next(this.seenValue?this.singleValue:void 0),t.complete()):t.error(new kt)},e}(f);var Bi=function(){function t(t){this.total=t}return t.prototype.call=function(t,e){return e.subscribe(new Ui(t,this.total))},t}(),Ui=function(t){function e(e,n){var i=t.call(this,e)||this;return i.total=n,i.count=0,i}return n(e,t),e.prototype._next=function(t){++this.count>this.total&&this.destination.next(t)},e}(f);var Fi=function(){function t(t){if(this._skipCount=t,this._skipCount<0)throw new Mt}return t.prototype.call=function(t,e){return 0===this._skipCount?e.subscribe(new f(t)):e.subscribe(new Hi(t,this._skipCount))},t}(),Hi=function(t){function e(e,n){var i=t.call(this,e)||this;return i._skipCount=n,i._count=0,i._ring=new Array(n),i}return n(e,t),e.prototype._next=function(t){var e=this._skipCount,n=this._count++;if(n<e)this._ring[n]=t;else{var i=n%e,r=this._ring,s=r[i];r[i]=t,this.destination.next(s)}},e}(f);var Vi=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){return e.subscribe(new ji(t,this.notifier))},t}(),ji=function(t){function e(e,n){var i=t.call(this,e)||this;i.hasValue=!1;var r=new ee(i);i.add(r),i.innerSubscription=r;var s=ie(n,r);return s!==r&&(i.add(s),i.innerSubscription=s),i}return n(e,t),e.prototype._next=function(e){this.hasValue&&t.prototype._next.call(this,e)},e.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},e.prototype.notifyComplete=function(){},e}(ne);var Gi=function(){function t(t){this.predicate=t}return t.prototype.call=function(t,e){return e.subscribe(new Qi(t,this.predicate))},t}(),Qi=function(t){function e(e,n){var i=t.call(this,e)||this;return i.predicate=n,i.skipping=!0,i.index=0,i}return n(e,t),e.prototype._next=function(t){var e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)},e.prototype.tryCallPredicate=function(t){try{var e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(t){this.destination.error(t)}},e}(f);var zi=function(t){function e(e,n,i){void 0===n&&(n=0),void 0===i&&(i=Et);var r=t.call(this)||this;return r.source=e,r.delayTime=n,r.scheduler=i,(!fe(n)||n<0)&&(r.delayTime=0),i&&"function"==typeof i.schedule||(r.scheduler=Et),r}return n(e,t),e.create=function(t,n,i){return void 0===n&&(n=0),void 0===i&&(i=Et),new e(t,n,i)},e.dispatch=function(t){var e=t.source,n=t.subscriber;return this.add(e.subscribe(n))},e.prototype._subscribe=function(t){var n=this.delayTime,i=this.source;return this.scheduler.schedule(e.dispatch,n,{source:i,subscriber:t})},e}(E);var Wi=function(){function t(t,e){this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return new zi(e,this.delay,this.scheduler).subscribe(t)},t}();function Ki(t,e){return"function"==typeof e?function(n){return n.pipe(Ki((function(n,i){return te(t(n,i)).pipe(Pt((function(t,r){return e(n,t,i,r)})))})))}:function(e){return e.lift(new qi(t))}}var qi=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new Yi(t,this.project))},t}(),Yi=function(t){function e(e,n){var i=t.call(this,e)||this;return i.project=n,i.index=0,i}return n(e,t),e.prototype._next=function(t){var e,n=this.index++;try{e=this.project(t,n)}catch(t){return void this.destination.error(t)}this._innerSub(e)},e.prototype._innerSub=function(t){var e=this.innerSubscription;e&&e.unsubscribe();var n=new ee(this),i=this.destination;i.add(n),this.innerSubscription=ie(t,n),this.innerSubscription!==n&&i.add(this.innerSubscription)},e.prototype._complete=function(){var e=this.innerSubscription;e&&!e.closed||t.prototype._complete.call(this),this.unsubscribe()},e.prototype._unsubscribe=function(){this.innerSubscription=void 0},e.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&t.prototype._complete.call(this)},e.prototype.notifyNext=function(t){this.destination.next(t)},e}(ne);var $i=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,e){var n=new Xi(t),i=ie(this.notifier,new ee(n));return i&&!n.seenValue?(n.add(i),e.subscribe(n)):n},t}(),Xi=function(t){function e(e){var n=t.call(this,e)||this;return n.seenValue=!1,n}return n(e,t),e.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},e.prototype.notifyComplete=function(){},e}(ne);var Ji=function(){function t(t,e){this.predicate=t,this.inclusive=e}return t.prototype.call=function(t,e){return e.subscribe(new Zi(t,this.predicate,this.inclusive))},t}(),Zi=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.predicate=n,r.inclusive=i,r.index=0,r}return n(e,t),e.prototype._next=function(t){var e,n=this.destination;try{e=this.predicate(t,this.index++)}catch(t){return void n.error(t)}this.nextOrComplete(t,e)},e.prototype.nextOrComplete=function(t,e){var n=this.destination;Boolean(e)?n.next(t):(this.inclusive&&n.next(t),n.complete())},e}(f);var tr=function(){function t(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}return t.prototype.call=function(t,e){return e.subscribe(new er(t,this.nextOrObserver,this.error,this.complete))},t}(),er=function(t){function e(e,n,i,s){var o=t.call(this,e)||this;return o._tapNext=Lt,o._tapError=Lt,o._tapComplete=Lt,o._tapError=i||Lt,o._tapComplete=s||Lt,r(n)?(o._context=o,o._tapNext=n):n&&(o._context=n,o._tapNext=n.next||Lt,o._tapError=n.error||Lt,o._tapComplete=n.complete||Lt),o}return n(e,t),e.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},e.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},e.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},e}(f),nr={leading:!0,trailing:!1};var ir=function(){function t(t,e,n){this.durationSelector=t,this.leading=e,this.trailing=n}return t.prototype.call=function(t,e){return e.subscribe(new rr(t,this.durationSelector,this.leading,this.trailing))},t}(),rr=function(t){function e(e,n,i,r){var s=t.call(this,e)||this;return s.destination=e,s.durationSelector=n,s._leading=i,s._trailing=r,s._hasValue=!1,s}return n(e,t),e.prototype._next=function(t){this._hasValue=!0,this._sendValue=t,this._throttled||(this._leading?this.send():this.throttle(t))},e.prototype.send=function(){var t=this._hasValue,e=this._sendValue;t&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},e.prototype.throttle=function(t){var e=this.tryDurationSelector(t);e&&this.add(this._throttled=ie(e,new ee(this)))},e.prototype.tryDurationSelector=function(t){try{return this.durationSelector(t)}catch(t){return this.destination.error(t),null}},e.prototype.throttlingDone=function(){var t=this._throttled,e=this._trailing;t&&t.unsubscribe(),this._throttled=void 0,e&&this.send()},e.prototype.notifyNext=function(){this.throttlingDone()},e.prototype.notifyComplete=function(){this.throttlingDone()},e}(ne);var sr=function(){function t(t,e,n,i){this.duration=t,this.scheduler=e,this.leading=n,this.trailing=i}return t.prototype.call=function(t,e){return e.subscribe(new or(t,this.duration,this.scheduler,this.leading,this.trailing))},t}(),or=function(t){function e(e,n,i,r,s){var o=t.call(this,e)||this;return o.duration=n,o.scheduler=i,o.leading=r,o.trailing=s,o._hasTrailingValue=!1,o._trailingValue=null,o}return n(e,t),e.prototype._next=function(t){this.throttled?this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(ar,this.duration,{subscriber:this})),this.leading?this.destination.next(t):this.trailing&&(this._trailingValue=t,this._hasTrailingValue=!0))},e.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},e.prototype.clearThrottle=function(){var t=this.throttled;t&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),t.unsubscribe(),this.remove(t),this.throttled=null)},e}(f);function ar(t){t.subscriber.clearThrottle()}var cr=function(t,e){this.value=t,this.interval=e};function lr(t,e,n){return void 0===n&&(n=St),function(i){var r=pn(t),s=r?+t-n.now():Math.abs(t);return i.lift(new ur(s,r,e,n))}}var ur=function(){function t(t,e,n,i){this.waitFor=t,this.absoluteTimeout=e,this.withObservable=n,this.scheduler=i}return t.prototype.call=function(t,e){return e.subscribe(new dr(t,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},t}(),dr=function(t){function e(e,n,i,r,s){var o=t.call(this,e)||this;return o.absoluteTimeout=n,o.waitFor=i,o.withObservable=r,o.scheduler=s,o.scheduleTimeout(),o}return n(e,t),e.dispatchTimeout=function(t){var e=t.withObservable;t._unsubscribeAndRecycle(),t.add(ie(e,new ee(t)))},e.prototype.scheduleTimeout=function(){var t=this.action;t?this.action=t.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(e.dispatchTimeout,this.waitFor,this))},e.prototype._next=function(e){this.absoluteTimeout||this.scheduleTimeout(),t.prototype._next.call(this,e)},e.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},e}(ne);var hr=function(t,e){this.value=t,this.timestamp=e};function Ar(t,e,n){return 0===n?[e]:(t.push(e),t)}var pr=function(){function t(t){this.windowBoundaries=t}return t.prototype.call=function(t,e){var n=new fr(t),i=e.subscribe(n);return i.closed||n.add(ie(this.windowBoundaries,new ee(n))),i},t}(),fr=function(t){function e(e){var n=t.call(this,e)||this;return n.window=new R,e.next(n.window),n}return n(e,t),e.prototype.notifyNext=function(){this.openWindow()},e.prototype.notifyError=function(t){this._error(t)},e.prototype.notifyComplete=function(){this._complete()},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t)},e.prototype._complete=function(){this.window.complete(),this.destination.complete()},e.prototype._unsubscribe=function(){this.window=null},e.prototype.openWindow=function(){var t=this.window;t&&t.complete();var e=this.destination,n=this.window=new R;e.next(n)},e}(ne);var mr=function(){function t(t,e){this.windowSize=t,this.startWindowEvery=e}return t.prototype.call=function(t,e){return e.subscribe(new gr(t,this.windowSize,this.startWindowEvery))},t}(),gr=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.destination=e,r.windowSize=n,r.startWindowEvery=i,r.windows=[new R],r.count=0,e.next(r.windows[0]),r}return n(e,t),e.prototype._next=function(t){for(var e=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,i=this.windowSize,r=this.windows,s=r.length,o=0;o<s&&!this.closed;o++)r[o].next(t);var a=this.count-i+1;if(a>=0&&a%e==0&&!this.closed&&r.shift().complete(),++this.count%e==0&&!this.closed){var c=new R;r.push(c),n.next(c)}},e.prototype._error=function(t){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().complete();this.destination.complete()},e.prototype._unsubscribe=function(){this.count=0,this.windows=null},e}(f);var vr=function(){function t(t,e,n,i){this.windowTimeSpan=t,this.windowCreationInterval=e,this.maxWindowSize=n,this.scheduler=i}return t.prototype.call=function(t,e){return e.subscribe(new _r(t,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},t}(),yr=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._numberOfNextedValues=0,e}return n(e,t),e.prototype.next=function(e){this._numberOfNextedValues++,t.prototype.next.call(this,e)},Object.defineProperty(e.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),e}(R),_r=function(t){function e(e,n,i,r,s){var o=t.call(this,e)||this;o.destination=e,o.windowTimeSpan=n,o.windowCreationInterval=i,o.maxWindowSize=r,o.scheduler=s,o.windows=[];var a=o.openWindow();if(null!==i&&i>=0){var c={subscriber:o,window:a,context:null},l={windowTimeSpan:n,windowCreationInterval:i,subscriber:o,scheduler:s};o.add(s.schedule(wr,n,c)),o.add(s.schedule(Er,i,l))}else{var u={subscriber:o,window:a,windowTimeSpan:n};o.add(s.schedule(br,n,u))}return o}return n(e,t),e.prototype._next=function(t){for(var e=this.windows,n=e.length,i=0;i<n;i++){var r=e[i];r.closed||(r.next(t),r.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(r))}},e.prototype._error=function(t){for(var e=this.windows;e.length>0;)e.shift().error(t);this.destination.error(t)},e.prototype._complete=function(){for(var t=this.windows;t.length>0;){var e=t.shift();e.closed||e.complete()}this.destination.complete()},e.prototype.openWindow=function(){var t=new yr;return this.windows.push(t),this.destination.next(t),t},e.prototype.closeWindow=function(t){t.complete();var e=this.windows;e.splice(e.indexOf(t),1)},e}(f);function br(t){var e=t.subscriber,n=t.windowTimeSpan,i=t.window;i&&e.closeWindow(i),t.window=e.openWindow(),this.schedule(t,n)}function Er(t){var e=t.windowTimeSpan,n=t.subscriber,i=t.scheduler,r=t.windowCreationInterval,s=n.openWindow(),o=this,a={action:o,subscription:null},c={subscriber:n,window:s,context:a};a.subscription=i.schedule(wr,e,c),o.add(a.subscription),o.schedule(t,r)}function wr(t){var e=t.subscriber,n=t.window,i=t.context;i&&i.action&&i.subscription&&i.action.remove(i.subscription),e.closeWindow(n)}var Sr=function(){function t(t,e){this.openings=t,this.closingSelector=e}return t.prototype.call=function(t,e){return e.subscribe(new Tr(t,this.openings,this.closingSelector))},t}(),Tr=function(t){function e(e,n,i){var r=t.call(this,e)||this;return r.openings=n,r.closingSelector=i,r.contexts=[],r.add(r.openSubscription=Yt(r,n,n)),r}return n(e,t),e.prototype._next=function(t){var e=this.contexts;if(e)for(var n=e.length,i=0;i<n;i++)e[i].window.next(t)},e.prototype._error=function(e){var n=this.contexts;if(this.contexts=null,n)for(var i=n.length,r=-1;++r<i;){var s=n[r];s.window.error(e),s.subscription.unsubscribe()}t.prototype._error.call(this,e)},e.prototype._complete=function(){var e=this.contexts;if(this.contexts=null,e)for(var n=e.length,i=-1;++i<n;){var r=e[i];r.window.complete(),r.subscription.unsubscribe()}t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.contexts;if(this.contexts=null,t)for(var e=t.length,n=-1;++n<e;){var i=t[n];i.window.unsubscribe(),i.subscription.unsubscribe()}},e.prototype.notifyNext=function(t,e,n,i,r){if(t===this.openings){var s=void 0;try{s=(0,this.closingSelector)(e)}catch(t){return this.error(t)}var o=new R,a=new h,c={window:o,subscription:a};this.contexts.push(c);var l=Yt(this,s,c);l.closed?this.closeWindow(this.contexts.length-1):(l.context=c,a.add(l)),this.destination.next(o)}else this.closeWindow(this.contexts.indexOf(t))},e.prototype.notifyError=function(t){this.error(t)},e.prototype.notifyComplete=function(t){t!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(t.context))},e.prototype.closeWindow=function(t){if(-1!==t){var e=this.contexts,n=e[t],i=n.window,r=n.subscription;e.splice(t,1),i.complete(),r.unsubscribe()}},e}(Gt);var Cr=function(){function t(t){this.closingSelector=t}return t.prototype.call=function(t,e){return e.subscribe(new Rr(t,this.closingSelector))},t}(),Rr=function(t){function e(e,n){var i=t.call(this,e)||this;return i.destination=e,i.closingSelector=n,i.openWindow(),i}return n(e,t),e.prototype.notifyNext=function(t,e,n,i,r){this.openWindow(r)},e.prototype.notifyError=function(t){this._error(t)},e.prototype.notifyComplete=function(t){this.openWindow(t)},e.prototype._next=function(t){this.window.next(t)},e.prototype._error=function(t){this.window.error(t),this.destination.error(t),this.unsubscribeClosingNotification()},e.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},e.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},e.prototype.openWindow=function(t){void 0===t&&(t=null),t&&(this.remove(t),t.unsubscribe());var e=this.window;e&&e.complete();var n,i=this.window=new R;this.destination.next(i);try{n=(0,this.closingSelector)()}catch(t){return this.destination.error(t),void this.window.error(t)}this.add(this.closingNotification=Yt(this,n))},e}(Gt);var Ir=function(){function t(t,e){this.observables=t,this.project=e}return t.prototype.call=function(t,e){return e.subscribe(new xr(t,this.observables,this.project))},t}(),xr=function(t){function e(e,n,i){var r=t.call(this,e)||this;r.observables=n,r.project=i,r.toRespond=[];var s=n.length;r.values=new Array(s);for(var o=0;o<s;o++)r.toRespond.push(o);for(o=0;o<s;o++){var a=n[o];r.add(Yt(r,a,void 0,o))}return r}return n(e,t),e.prototype.notifyNext=function(t,e,n){this.values[n]=e;var i=this.toRespond;if(i.length>0){var r=i.indexOf(n);-1!==r&&i.splice(r,1)}},e.prototype.notifyComplete=function(){},e.prototype._next=function(t){if(0===this.toRespond.length){var e=[t].concat(this.values);this.project?this._tryProject(e):this.destination.next(e)}},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(t){return void this.destination.error(t)}this.destination.next(e)},e}(Gt);var Or=Object.freeze({audit:De,auditTime:function(t,e){return void 0===e&&(e=St),De((function(){return Ie(t,e)}))},buffer:function(t){return function(e){return e.lift(new Fe(t))}},bufferCount:function(t,e){return void 0===e&&(e=null),function(n){return n.lift(new Ve(t,e))}},bufferTime:function(t){var e=arguments.length,n=St;J(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],e--);var i=null;e>=2&&(i=arguments[1]);var r=Number.POSITIVE_INFINITY;return e>=3&&(r=arguments[2]),function(e){return e.lift(new Qe(t,i,r,n))}},bufferToggle:function(t,e){return function(n){return n.lift(new $e(t,e))}},bufferWhen:function(t){return function(e){return e.lift(new Je(t))}},catchError:function(t){return function(e){var n=new tn(t),i=e.lift(n);return n.caught=i}},combineAll:function(t){return function(e){return e.lift(new Xt(t))}},combineLatest:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=null;return"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&l(t[0])&&(t=t[0].slice()),function(e){return e.lift.call(te([e].concat(t)),new Xt(n))}},concat:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(ue.apply(void 0,[e].concat(t)))}},concatAll:le,concatMap:nn,concatMapTo:function(t,e){return nn((function(){return t}),e)},count:function(t){return function(e){return e.lift(new rn(t,e))}},debounce:function(t){return function(e){return e.lift(new on(t))}},debounceTime:function(t,e){return void 0===e&&(e=St),function(n){return n.lift(new cn(t,e))}},defaultIfEmpty:dn,delay:function(t,e){void 0===e&&(e=St);var n=pn(t)?+t-e.now():Math.abs(t);return function(t){return t.lift(new fn(n,e))}},delayWhen:function(t,e){return e?function(n){return new _n(n,e).lift(new vn(t))}:function(e){return e.lift(new vn(t))}},dematerialize:function(){return function(t){return t.lift(new En)}},distinct:function(t,e){return function(n){return n.lift(new Sn(t,e))}},distinctUntilChanged:Cn,distinctUntilKeyChanged:function(t,e){return Cn((function(n,i){return e?e(n[t],i[t]):n[t]===i[t]}))},elementAt:function(t,e){if(t<0)throw new Mt;var n=arguments.length>=2;return function(i){return i.pipe(be((function(e,n){return n===t})),kn(1),n?dn(e):xn((function(){return new Mt})))}},endWith:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return ue(e,it.apply(void 0,t))}},every:function(t,e){return function(n){return n.lift(new Dn(t,e,n))}},exhaust:function(){return function(t){return t.lift(new Un)}},exhaustMap:function t(e,n){return n?function(i){return i.pipe(t((function(t,i){return te(e(t,i)).pipe(Pt((function(e,r){return n(t,e,i,r)})))})))}:function(t){return t.lift(new Hn(e))}},expand:function(t,e,n){return void 0===e&&(e=Number.POSITIVE_INFINITY),e=(e||0)<1?Number.POSITIVE_INFINITY:e,function(i){return i.lift(new jn(t,e,n))}},filter:be,finalize:function(t){return function(e){return e.lift(new Qn(t))}},find:function(t,e){if("function"!=typeof t)throw new TypeError("predicate is not a function");return function(n){return n.lift(new Wn(t,n,!1,e))}},findIndex:function(t,e){return function(n){return n.lift(new Wn(t,n,!0,e))}},first:function(t,e){var n=arguments.length>=2;return function(i){return i.pipe(t?be((function(e,n){return t(e,n,i)})):y,kn(1),n?dn(e):xn((function(){return new kt})))}},groupBy:function(t,e,n,i){return function(r){return r.lift(new D(t,e,n,i))}},ignoreElements:function(){return function(t){return t.lift(new qn)}},isEmpty:function(){return function(t){return t.lift(new $n)}},last:function(t,e){var n=arguments.length>=2;return function(i){return i.pipe(t?be((function(e,n){return t(e,n,i)})):y,Jn(1),n?dn(e):xn((function(){return new kt})))}},map:Pt,mapTo:function(t){return function(e){return e.lift(new ei(t))}},materialize:function(){return function(t){return t.lift(new ii)}},max:function(t){return ci("function"==typeof t?function(e,n){return t(e,n)>0?e:n}:function(t,e){return t>e?t:e})},merge:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(ge.apply(void 0,[e].concat(t)))}},mergeAll:ce,mergeMap:re,flatMap:ae,mergeMapTo:function(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof e?re((function(){return t}),e,n):("number"==typeof e&&(n=e),re((function(){return t}),n))},mergeScan:function(t,e,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(i){return i.lift(new li(t,e,n))}},min:function(t){return ci("function"==typeof t?function(e,n){return t(e,n)<0?e:n}:function(t,e){return t<e?t:e})},multicast:di,observeOn:function(t,e){return void 0===e&&(e=0),function(n){return n.lift(new at(t,e))}},onErrorResumeNext:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return 1===t.length&&l(t[0])&&(t=t[0]),function(e){return e.lift(new Ai(t))}},pairwise:function(){return function(t){return t.lift(new fi)}},partition:function(t,e){return function(n){return[be(t,e)(n),be(_e(t,e))(n)]}},pluck:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(e){return Pt(gi(t,n))(e)}},publish:function(t){return t?di((function(){return new R}),t):di(new R)},publishBehavior:function(t){return function(e){return di(new V(t))(e)}},publishLast:function(){return function(t){return di(new ht)(t)}},publishReplay:function(t,e,n,i){n&&"function"!=typeof n&&(i=n);var r="function"==typeof n?n:void 0,s=new ut(t,e,i);return function(t){return di((function(){return s}),r)(t)}},race:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return 1===t.length&&l(t[0])&&(t=t[0]),e.lift.call(Se.apply(void 0,[e].concat(t)))}},reduce:ci,repeat:function(t){return void 0===t&&(t=-1),function(e){return 0===t?X():t<0?e.lift(new vi(-1,e)):e.lift(new vi(t-1,e))}},repeatWhen:function(t){return function(e){return e.lift(new _i(t))}},retry:function(t){return void 0===t&&(t=-1),function(e){return e.lift(new Ei(t,e))}},retryWhen:function(t){return function(e){return e.lift(new Si(t,e))}},refCount:x,sample:function(t){return function(e){return e.lift(new Ci(t))}},sampleTime:function(t,e){return void 0===e&&(e=St),function(n){return n.lift(new Ii(t,e))}},scan:si,sequenceEqual:function(t,e){return function(n){return n.lift(new Li(t,e))}},share:function(){return function(t){return x()(di(Ni)(t))}},shareReplay:function(t,e,n){var i;return i=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},function(t){return t.lift(function(t){var e,n,i=t.bufferSize,r=void 0===i?Number.POSITIVE_INFINITY:i,s=t.windowTime,o=void 0===s?Number.POSITIVE_INFINITY:s,a=t.refCount,c=t.scheduler,l=0,u=!1,d=!1;return function(t){var i;l++,!e||u?(u=!1,e=new ut(r,o,c),i=e.subscribe(this),n=t.subscribe({next:function(t){e.next(t)},error:function(t){u=!0,e.error(t)},complete:function(){d=!0,n=void 0,e.complete()}})):i=e.subscribe(this),this.add((function(){l--,i.unsubscribe(),n&&!d&&a&&0===l&&(n.unsubscribe(),n=void 0,e=void 0)}))}}(i))}},single:function(t){return function(e){return e.lift(new Pi(t,e))}},skip:function(t){return function(e){return e.lift(new Bi(t))}},skipLast:function(t){return function(e){return e.lift(new Fi(t))}},skipUntil:function(t){return function(e){return e.lift(new Vi(t))}},skipWhile:function(t){return function(e){return e.lift(new Gi(t))}},startWith:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[t.length-1];return J(n)?(t.pop(),function(e){return ue(t,e,n)}):function(e){return ue(t,e)}},subscribeOn:function(t,e){return void 0===e&&(e=0),function(n){return n.lift(new Wi(t,e))}},switchAll:function(){return Ki(y)},switchMap:Ki,switchMapTo:function(t,e){return e?Ki((function(){return t}),e):Ki((function(){return t}))},take:kn,takeLast:Jn,takeUntil:function(t){return function(e){return e.lift(new $i(t))}},takeWhile:function(t,e){return void 0===e&&(e=!1),function(n){return n.lift(new Ji(t,e))}},tap:function(t,e,n){return function(i){return i.lift(new tr(t,e,n))}},throttle:function(t,e){return void 0===e&&(e=nr),function(n){return n.lift(new ir(t,!!e.leading,!!e.trailing))}},throttleTime:function(t,e,n){return void 0===e&&(e=St),void 0===n&&(n=nr),function(i){return i.lift(new sr(t,e,n.leading,n.trailing))}},throwIfEmpty:xn,timeInterval:function(t){return void 0===t&&(t=St),function(e){return de((function(){return e.pipe(si((function(e,n){var i=e.current;return{value:n,current:t.now(),last:i}}),{current:t.now(),value:void 0,last:void 0}),Pt((function(t){var e=t.current,n=t.last,i=t.value;return new cr(i,e-n)})))}))}},timeout:function(t,e){return void 0===e&&(e=St),lr(t,rt(new Nt),e)},timeoutWith:lr,timestamp:function(t){return void 0===t&&(t=St),Pt((function(e){return new hr(e,t.now())}))},toArray:function(){return ci(Ar,[])},window:function(t){return function(e){return e.lift(new pr(t))}},windowCount:function(t,e){return void 0===e&&(e=0),function(n){return n.lift(new mr(t,e))}},windowTime:function(t){var e=St,n=null,i=Number.POSITIVE_INFINITY;return J(arguments[3])&&(e=arguments[3]),J(arguments[2])?e=arguments[2]:fe(arguments[2])&&(i=Number(arguments[2])),J(arguments[1])?e=arguments[1]:fe(arguments[1])&&(n=Number(arguments[1])),function(r){return r.lift(new vr(t,n,i,e))}},windowToggle:function(t,e){return function(n){return n.lift(new Sr(t,e))}},windowWhen:function(t){return function(e){return e.lift(new Cr(t))}},withLatestFrom:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){var n;"function"==typeof t[t.length-1]&&(n=t.pop());var i=t;return e.lift(new Ir(i,n))}},zip:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return e.lift.call(Oe.apply(void 0,[e].concat(t)))}},zipAll:function(t){return function(e){return e.lift(new Le(t))}}}),Lr=function(t,e){void 0===e&&(e=Number.POSITIVE_INFINITY),this.subscribedFrame=t,this.unsubscribedFrame=e},Mr=function(){function t(){this.subscriptions=[]}return t.prototype.logSubscribedFrame=function(){return this.subscriptions.push(new Lr(this.scheduler.now())),this.subscriptions.length-1},t.prototype.logUnsubscribedFrame=function(t){var e=this.subscriptions,n=e[t];e[t]=new Lr(n.subscribedFrame,this.scheduler.now())},t}();function kr(t,e){for(var n=0,i=e.length;n<i;n++)for(var r=e[n],s=Object.getOwnPropertyNames(r.prototype),o=0,a=s.length;o<a;o++){var c=s[o];t.prototype[c]=r.prototype[c]}}var Nr=function(t){function e(e,n){var i=t.call(this,(function(t){var e=this,n=e.logSubscribedFrame(),i=new h;return i.add(new h((function(){e.logUnsubscribedFrame(n)}))),e.scheduleMessages(t),i}))||this;return i.messages=e,i.subscriptions=[],i.scheduler=n,i}return n(e,t),e.prototype.scheduleMessages=function(t){for(var e=this.messages.length,n=0;n<e;n++){var i=this.messages[n];t.add(this.scheduler.schedule((function(t){var e=t.message,n=t.subscriber;e.notification.observe(n)}),i.frame,{message:i,subscriber:t}))}},e}(E);kr(Nr,[Mr]);var Pr=function(t){function e(e,n){var i=t.call(this)||this;return i.messages=e,i.subscriptions=[],i.scheduler=n,i}return n(e,t),e.prototype._subscribe=function(e){var n=this,i=n.logSubscribedFrame(),r=new h;return r.add(new h((function(){n.logUnsubscribedFrame(i)}))),r.add(t.prototype._subscribe.call(this,e)),r},e.prototype.setup=function(){for(var t=this,e=t.messages.length,n=0;n<e;n++)!function(){var e=t.messages[n];t.scheduler.schedule((function(){e.notification.observe(t)}),e.frame)}()},e}(R);kr(Pr,[Mr]);var Dr=function(t){function e(e){var n=t.call(this,Ot,750)||this;return n.assertDeepEqual=e,n.hotObservables=[],n.coldObservables=[],n.flushTests=[],n.runMode=!1,n}return n(e,t),e.prototype.createTime=function(t){var n=t.indexOf("|");if(-1===n)throw new Error('marble diagram for time should have a completion marker "|"');return n*e.frameTimeFactor},e.prototype.createColdObservable=function(t,n,i){if(-1!==t.indexOf("^"))throw new Error('cold observable cannot have subscription offset "^"');if(-1!==t.indexOf("!"))throw new Error('cold observable cannot have unsubscription marker "!"');var r=e.parseMarbles(t,n,i,void 0,this.runMode),s=new Nr(r,this);return this.coldObservables.push(s),s},e.prototype.createHotObservable=function(t,n,i){if(-1!==t.indexOf("!"))throw new Error('hot observable cannot have unsubscription marker "!"');var r=e.parseMarbles(t,n,i,void 0,this.runMode),s=new Pr(r,this);return this.hotObservables.push(s),s},e.prototype.materializeInnerObservable=function(t,e){var n=this,i=[];return t.subscribe((function(t){i.push({frame:n.frame-e,notification:ot.createNext(t)})}),(function(t){i.push({frame:n.frame-e,notification:ot.createError(t)})}),(function(){i.push({frame:n.frame-e,notification:ot.createComplete()})})),i},e.prototype.expectObservable=function(t,n){var i=this;void 0===n&&(n=null);var r,s=[],o={actual:s,ready:!1},a=e.parseMarblesAsSubscriptions(n,this.runMode),c=a.subscribedFrame===Number.POSITIVE_INFINITY?0:a.subscribedFrame,l=a.unsubscribedFrame;this.schedule((function(){r=t.subscribe((function(t){var e=t;t instanceof E&&(e=i.materializeInnerObservable(e,i.frame)),s.push({frame:i.frame,notification:ot.createNext(e)})}),(function(t){s.push({frame:i.frame,notification:ot.createError(t)})}),(function(){s.push({frame:i.frame,notification:ot.createComplete()})}))}),c),l!==Number.POSITIVE_INFINITY&&this.schedule((function(){return r.unsubscribe()}),l),this.flushTests.push(o);var u=this.runMode;return{toBe:function(t,n,i){o.ready=!0,o.expected=e.parseMarbles(t,n,i,!0,u)}}},e.prototype.expectSubscriptions=function(t){var n={actual:t,ready:!1};this.flushTests.push(n);var i=this.runMode;return{toBe:function(t){var r="string"==typeof t?[t]:t;n.ready=!0,n.expected=r.map((function(t){return e.parseMarblesAsSubscriptions(t,i)}))}}},e.prototype.flush=function(){for(var e=this,n=this.hotObservables;n.length>0;)n.shift().setup();t.prototype.flush.call(this),this.flushTests=this.flushTests.filter((function(t){return!t.ready||(e.assertDeepEqual(t.actual,t.expected),!1)}))},e.parseMarblesAsSubscriptions=function(t,e){var n=this;if(void 0===e&&(e=!1),"string"!=typeof t)return new Lr(Number.POSITIVE_INFINITY);for(var i,r=t.length,s=-1,o=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,c=0,l=function(r){var l=c,d=function(t){l+=t*n.frameTimeFactor},h=t[r];switch(h){case" ":e||d(1);break;case"-":d(1);break;case"(":s=c,d(1);break;case")":s=-1,d(1);break;case"^":if(o!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");o=s>-1?s:c,d(1);break;case"!":if(a!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");a=s>-1?s:c;break;default:if(e&&h.match(/^[0-9]$/)&&(0===r||" "===t[r-1])){var A=t.slice(r).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(A){r+=A[0].length-1;var p=parseFloat(A[1]),f=void 0;switch(A[2]){case"ms":f=p;break;case"s":f=1e3*p;break;case"m":f=1e3*p*60}d(f/u.frameTimeFactor);break}}throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+h+"'.")}c=l,i=r},u=this,d=0;d<r;d++)l(d),d=i;return a<0?new Lr(o):new Lr(o,a)},e.parseMarbles=function(t,e,n,i,r){var s=this;if(void 0===i&&(i=!1),void 0===r&&(r=!1),-1!==t.indexOf("!"))throw new Error('conventional marble diagrams cannot have the unsubscription marker "!"');for(var o,a=t.length,c=[],l=r?t.replace(/^[ ]+/,"").indexOf("^"):t.indexOf("^"),u=-1===l?0:l*-this.frameTimeFactor,d="object"!=typeof e?function(t){return t}:function(t){return i&&e[t]instanceof Nr?e[t].messages:e[t]},h=-1,A=function(e){var i=u,a=function(t){i+=t*s.frameTimeFactor},l=void 0,A=t[e];switch(A){case" ":r||a(1);break;case"-":case"^":a(1);break;case"(":h=u,a(1);break;case")":h=-1,a(1);break;case"|":l=ot.createComplete(),a(1);break;case"#":l=ot.createError(n||"error"),a(1);break;default:if(r&&A.match(/^[0-9]$/)&&(0===e||" "===t[e-1])){var f=t.slice(e).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(f){e+=f[0].length-1;var m=parseFloat(f[1]),g=void 0;switch(f[2]){case"ms":g=m;break;case"s":g=1e3*m;break;case"m":g=1e3*m*60}a(g/p.frameTimeFactor);break}}l=ot.createNext(d(A)),a(1)}l&&c.push({frame:h>-1?h:u,notification:l}),u=i,o=e},p=this,f=0;f<a;f++)A(f),f=o;return c},e.prototype.run=function(t){var n=e.frameTimeFactor,i=this.maxFrames;e.frameTimeFactor=1,this.maxFrames=Number.POSITIVE_INFINITY,this.runMode=!0,W.delegate=this;var r={cold:this.createColdObservable.bind(this),hot:this.createHotObservable.bind(this),flush:this.flush.bind(this),expectObservable:this.expectObservable.bind(this),expectSubscriptions:this.expectSubscriptions.bind(this)};try{var s=t(r);return this.flush(),s}finally{e.frameTimeFactor=n,this.maxFrames=i,this.runMode=!1,W.delegate=void 0}},e}(xt),Br=Object.freeze({TestScheduler:Dr}),Ur="undefined"!=typeof window&&window,Fr="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Hr="undefined"!=typeof global&&global,Vr=Ur||Hr||Fr;function jr(t,e){return void 0===e&&(e=null),new Yr({method:"GET",url:t,headers:e})}function Gr(t,e,n){return new Yr({method:"POST",url:t,body:e,headers:n})}function Qr(t,e){return new Yr({method:"DELETE",url:t,headers:e})}function zr(t,e,n){return new Yr({method:"PUT",url:t,body:e,headers:n})}function Wr(t,e,n){return new Yr({method:"PATCH",url:t,body:e,headers:n})}!function(){if(!Vr)throw new Error("RxJS could not find any global context (window, self, global)")}();var Kr=Pt((function(t,e){return t.response}));function qr(t,e){return Kr(new Yr({method:"GET",url:t,responseType:"json",headers:e}))}var Yr=function(t){function e(e){var n=t.call(this)||this,i={async:!0,createXHR:function(){return this.crossDomain?function(){if(Vr.XMLHttpRequest)return new Vr.XMLHttpRequest;if(Vr.XDomainRequest)return new Vr.XDomainRequest;throw new Error("CORS is not supported by your browser")}():function(){if(Vr.XMLHttpRequest)return new Vr.XMLHttpRequest;var t=void 0;try{for(var e=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;n<3;n++)try{if(t=e[n],new Vr.ActiveXObject(t))break}catch(t){}return new Vr.ActiveXObject(t)}catch(t){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!0,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof e)i.url=e;else for(var r in e)e.hasOwnProperty(r)&&(i[r]=e[r]);return n.request=i,n}var i;return n(e,t),e.prototype._subscribe=function(t){return new $r(t,this.request)},e.create=((i=function(t){return new e(t)}).get=jr,i.post=Gr,i.delete=Qr,i.put=zr,i.patch=Wr,i.getJSON=qr,i),e}(E),$r=function(t){function e(e,n){var i=t.call(this,e)||this;i.request=n,i.done=!1;var r=n.headers=n.headers||{};return n.crossDomain||i.getHeader(r,"X-Requested-With")||(r["X-Requested-With"]="XMLHttpRequest"),i.getHeader(r,"Content-Type")||Vr.FormData&&n.body instanceof Vr.FormData||void 0===n.body||(r["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),n.body=i.serializeBody(n.body,i.getHeader(n.headers,"Content-Type")),i.send(),i}return n(e,t),e.prototype.next=function(t){this.done=!0;var e,n=this,i=n.xhr,r=n.request,s=n.destination;try{e=new Xr(t,i,r)}catch(t){return s.error(t)}s.next(e)},e.prototype.send=function(){var t=this.request,e=this.request,n=e.user,i=e.method,r=e.url,s=e.async,o=e.password,a=e.headers,c=e.body;try{var l=this.xhr=t.createXHR();this.setupEvents(l,t),n?l.open(i,r,s,n,o):l.open(i,r,s),s&&(l.timeout=t.timeout,l.responseType=t.responseType),"withCredentials"in l&&(l.withCredentials=!!t.withCredentials),this.setHeaders(l,a),c?l.send(c):l.send()}catch(t){this.error(t)}},e.prototype.serializeBody=function(t,e){if(!t||"string"==typeof t)return t;if(Vr.FormData&&t instanceof Vr.FormData)return t;if(e){var n=e.indexOf(";");-1!==n&&(e=e.substring(0,n))}switch(e){case"application/x-www-form-urlencoded":return Object.keys(t).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])})).join("&");case"application/json":return JSON.stringify(t);default:return t}},e.prototype.setHeaders=function(t,e){for(var n in e)e.hasOwnProperty(n)&&t.setRequestHeader(n,e[n])},e.prototype.getHeader=function(t,e){for(var n in t)if(n.toLowerCase()===e.toLowerCase())return t[n]},e.prototype.setupEvents=function(t,e){var n=e.progressSubscriber;function i(t){var e,n=i,r=n.subscriber,s=n.progressSubscriber,o=n.request;s&&s.error(t);try{e=new ts(this,o)}catch(t){e=t}r.error(e)}if(t.ontimeout=i,i.request=e,i.subscriber=this,i.progressSubscriber=n,t.upload&&"withCredentials"in t){var r,s;if(n)r=function(t){r.progressSubscriber.next(t)},Vr.XDomainRequest?t.onprogress=r:t.upload.onprogress=r,r.progressSubscriber=n;s=function(t){var e,n=s,i=n.progressSubscriber,r=n.subscriber,o=n.request;i&&i.error(t);try{e=new Jr("ajax error",this,o)}catch(t){e=t}r.error(e)},t.onerror=s,s.request=e,s.subscriber=this,s.progressSubscriber=n}function o(t){}function a(t){var e=a,n=e.subscriber,i=e.progressSubscriber,r=e.request;if(4===this.readyState){var s=1223===this.status?204:this.status,o="text"===this.responseType?this.response||this.responseText:this.response;if(0===s&&(s=o?200:0),s<400)i&&i.complete(),n.next(t),n.complete();else{i&&i.error(t);var c=void 0;try{c=new Jr("ajax error "+s,this,r)}catch(t){c=t}n.error(c)}}}t.onreadystatechange=o,o.subscriber=this,o.progressSubscriber=n,o.request=e,t.onload=a,a.subscriber=this,a.progressSubscriber=n,a.request=e},e.prototype.unsubscribe=function(){var e=this.done,n=this.xhr;!e&&n&&4!==n.readyState&&"function"==typeof n.abort&&n.abort(),t.prototype.unsubscribe.call(this)},e}(f),Xr=function(t,e,n){this.originalEvent=t,this.xhr=e,this.request=n,this.status=e.status,this.responseType=e.responseType||n.responseType,this.response=Zr(this.responseType,e)},Jr=function(){function t(t,e,n){return Error.call(this),this.message=t,this.name="AjaxError",this.xhr=e,this.request=n,this.status=e.status,this.responseType=e.responseType||n.responseType,this.response=Zr(this.responseType,e),this}return t.prototype=Object.create(Error.prototype),t}();function Zr(t,e){switch(t){case"json":return function(t){return"response"in t?t.responseType?t.response:JSON.parse(t.response||t.responseText||"null"):JSON.parse(t.responseText||"null")}(e);case"xml":return e.responseXML;default:return"response"in e?e.response:e.responseText}}var ts=function(t,e){return Jr.call(this,"ajax timeout",t,e),this.name="AjaxTimeoutError",this},es=Yr.create,ns=Object.freeze({ajax:es,AjaxResponse:Xr,AjaxError:Jr,AjaxTimeoutError:ts}),is={url:"",deserializer:function(t){return JSON.parse(t.data)},serializer:function(t){return JSON.stringify(t)}},rs=function(t){function e(e,n){var r=t.call(this)||this;if(e instanceof E)r.destination=n,r.source=e;else{var s=r._config=i({},is);if(r._output=new R,"string"==typeof e)s.url=e;else for(var o in e)e.hasOwnProperty(o)&&(s[o]=e[o]);if(!s.WebSocketCtor&&WebSocket)s.WebSocketCtor=WebSocket;else if(!s.WebSocketCtor)throw new Error("no WebSocket constructor can be found");r.destination=new ut}return r}return n(e,t),e.prototype.lift=function(t){var n=new e(this._config,this.destination);return n.operator=t,n.source=this,n},e.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new ut),this._output=new R},e.prototype.multiplex=function(t,e,n){var i=this;return new E((function(r){try{i.next(t())}catch(t){r.error(t)}var s=i.subscribe((function(t){try{n(t)&&r.next(t)}catch(t){r.error(t)}}),(function(t){return r.error(t)}),(function(){return r.complete()}));return function(){try{i.next(e())}catch(t){r.error(t)}s.unsubscribe()}}))},e.prototype._connectSocket=function(){var t=this,e=this._config,n=e.WebSocketCtor,i=e.protocol,r=e.url,s=e.binaryType,o=this._output,a=null;try{a=i?new n(r,i):new n(r),this._socket=a,s&&(this._socket.binaryType=s)}catch(t){return void o.error(t)}var c=new h((function(){t._socket=null,a&&1===a.readyState&&a.close()}));a.onopen=function(e){if(!t._socket)return a.close(),void t._resetState();var n=t._config.openObserver;n&&n.next(e);var i=t.destination;t.destination=f.create((function(e){if(1===a.readyState)try{var n=t._config.serializer;a.send(n(e))}catch(e){t.destination.error(e)}}),(function(e){var n=t._config.closingObserver;n&&n.next(void 0),e&&e.code?a.close(e.code,e.reason):o.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),t._resetState()}),(function(){var e=t._config.closingObserver;e&&e.next(void 0),a.close(),t._resetState()})),i&&i instanceof ut&&c.add(i.subscribe(t.destination))},a.onerror=function(e){t._resetState(),o.error(e)},a.onclose=function(e){t._resetState();var n=t._config.closeObserver;n&&n.next(e),e.wasClean?o.complete():o.error(e)},a.onmessage=function(e){try{var n=t._config.deserializer;o.next(n(e))}catch(t){o.error(t)}}},e.prototype._subscribe=function(t){var e=this,n=this.source;return n?n.subscribe(t):(this._socket||this._connectSocket(),this._output.subscribe(t),t.add((function(){var t=e._socket;0===e._output.observers.length&&(t&&1===t.readyState&&t.close(),e._resetState())})),t)},e.prototype.unsubscribe=function(){var e=this._socket;e&&1===e.readyState&&e.close(),this._resetState(),t.prototype.unsubscribe.call(this)},e}(I);var ss=Or,os=Br,as=ns,cs=Object.freeze({webSocket:function(t){return new rs(t)},WebSocketSubject:rs}),ls=Object.freeze({fromFetch:function(t,e){void 0===e&&(e={});var n=e.selector,r=function(t,e){var n={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(n[i]=t[i]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(t);r<i.length;r++)e.indexOf(i[r])<0&&(n[i[r]]=t[i[r]])}return n}(e,["selector"]);return new E((function(e){var s,o=new AbortController,a=o.signal,c=!0,l=!1,u=new h;if(u.add((function(){l=!0,c&&o.abort()})),r){if(r.signal)if(r.signal.aborted)o.abort();else{var d=r.signal,A=function(){a.aborted||o.abort()};d.addEventListener("abort",A),u.add((function(){return d.removeEventListener("abort",A)}))}s=i({},r,{signal:a})}else s={signal:a};return fetch(t,s).then((function(t){n?u.add(te(n(t)).subscribe((function(t){return e.next(t)}),(function(t){c=!1,l||e.error(t)}),(function(){c=!1,e.complete()}))):(c=!1,e.next(t),e.complete())})).catch((function(t){c=!1,l||e.error(t)})),u}))}});t.operators=ss,t.testing=os,t.ajax=as,t.webSocket=cs,t.fetch=ls,t.Observable=E,t.ConnectableObservable=k,t.GroupedObservable=F,t.observable=v,t.Subject=R,t.BehaviorSubject=V,t.ReplaySubject=ut,t.AsyncSubject=ht,t.asap=Et,t.asapScheduler=bt,t.async=St,t.asyncScheduler=wt,t.queue=Y,t.queueScheduler=q,t.animationFrame=It,t.animationFrameScheduler=Rt,t.VirtualTimeScheduler=xt,t.VirtualAction=Ot,t.Scheduler=z,t.Subscription=h,t.Subscriber=f,t.Notification=ot,t.pipe=_,t.noop=Lt,t.identity=y,t.isObservable=function(t){return!!t&&(t instanceof E||"function"==typeof t.lift&&"function"==typeof t.subscribe)},t.ArgumentOutOfRangeError=Mt,t.EmptyError=kt,t.ObjectUnsubscribedError=S,t.UnsubscriptionError=d,t.TimeoutError=Nt,t.bindCallback=function t(e,n,i){if(n){if(!J(n))return function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];return t(e,i).apply(void 0,r).pipe(Pt((function(t){return l(t)?n.apply(void 0,t):n(t)})))};i=n}return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r,s=this,o={context:s,subject:r,callbackFunc:e,scheduler:i};return new E((function(n){if(i){var a={args:t,subscriber:n,params:o};return i.schedule(Ut,0,a)}if(!r){r=new ht;try{e.apply(s,t.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];r.next(t.length<=1?t[0]:t),r.complete()}]))}catch(t){g(r)?r.error(t):console.warn(t)}}return r.subscribe(n)}))}},t.bindNodeCallback=function t(e,n,i){if(n){if(!J(n))return function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];return t(e,i).apply(void 0,r).pipe(Pt((function(t){return l(t)?n.apply(void 0,t):n(t)})))};i=n}return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r={subject:void 0,args:t,callbackFunc:e,scheduler:i,context:this};return new E((function(n){var s=r.context,o=r.subject;if(i)return i.schedule(Ht,0,{params:r,subscriber:n,context:s});if(!o){o=r.subject=new ht;try{e.apply(s,t.concat([function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t.shift();n?o.error(n):(o.next(t.length<=1?t[0]:t),o.complete())}]))}catch(t){g(o)?o.error(t):console.warn(t)}}return o.subscribe(n)}))}},t.combineLatest=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=void 0,i=void 0;return J(t[t.length-1])&&(i=t.pop()),"function"==typeof t[t.length-1]&&(n=t.pop()),1===t.length&&l(t[0])&&(t=t[0]),nt(t,i).lift(new Xt(n))},t.concat=ue,t.defer=de,t.empty=X,t.forkJoin=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(1===t.length){var n=t[0];if(l(n))return he(n,null);if(u(n)&&Object.getPrototypeOf(n)===Object.prototype){var i=Object.keys(n);return he(i.map((function(t){return n[t]})),i)}}if("function"==typeof t[t.length-1]){var r=t.pop();return he(t=1===t.length&&l(t[0])?t[0]:t,null).pipe(Pt((function(t){return r.apply(void 0,t)})))}return he(t,null)},t.from=te,t.fromEvent=function t(e,n,i,s){return r(i)&&(s=i,i=void 0),s?t(e,n,i).pipe(Pt((function(t){return l(t)?s.apply(void 0,t):s(t)}))):new E((function(t){Ae(e,n,(function(e){arguments.length>1?t.next(Array.prototype.slice.call(arguments)):t.next(e)}),t,i)}))},t.fromEventPattern=function t(e,n,i){return i?t(e,n).pipe(Pt((function(t){return l(t)?i.apply(void 0,t):i(t)}))):new E((function(t){var i,s=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.next(1===e.length?e[0]:e)};try{i=e(s)}catch(e){return void t.error(e)}if(r(n))return function(){return n(s,i)}}))},t.generate=function(t,e,n,i,r){var s,o;if(1==arguments.length){var a=t;o=a.initialState,e=a.condition,n=a.iterate,s=a.resultSelector||y,r=a.scheduler}else void 0===i||J(i)?(o=t,s=y,r=i):(o=t,s=i);return new E((function(t){var i=o;if(r)return r.schedule(pe,0,{subscriber:t,iterate:n,condition:e,resultSelector:s,state:i});for(;;){if(e){var a=void 0;try{a=e(i)}catch(e){return void t.error(e)}if(!a){t.complete();break}}var c=void 0;try{c=s(i)}catch(e){return void t.error(e)}if(t.next(c),t.closed)break;try{i=n(i)}catch(e){return void t.error(e)}}}))},t.iif=function(t,e,n){return void 0===e&&(e=$),void 0===n&&(n=$),de((function(){return t()?e:n}))},t.interval=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=St),(!fe(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=St),new E((function(n){return n.add(e.schedule(me,t,{subscriber:n,counter:0,period:t})),n}))},t.merge=ge,t.never=function(){return ve},t.of=it,t.onErrorResumeNext=function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(0===e.length)return $;var i=e[0],r=e.slice(1);return 1===e.length&&l(i)?t.apply(void 0,i):new E((function(e){var n=function(){return e.add(t.apply(void 0,r).subscribe(e))};return te(i).subscribe({next:function(t){e.next(t)},error:n,complete:n})}))},t.pairs=function(t,e){return new E(e?function(n){var i=Object.keys(t),r=new h;return r.add(e.schedule(ye,0,{keys:i,index:0,subscriber:n,subscription:r,obj:t})),r}:function(e){for(var n=Object.keys(t),i=0;i<n.length&&!e.closed;i++){var r=n[i];t.hasOwnProperty(r)&&e.next([r,t[r]])}e.complete()})},t.partition=function(t,e,n){return[be(e,n)(new E(qt(t))),be(_e(e,n))(new E(qt(t)))]},t.race=Se,t.range=function(t,e,n){return void 0===t&&(t=0),new E((function(i){void 0===e&&(e=t,t=0);var r=0,s=t;if(n)return n.schedule(Re,0,{index:r,count:e,start:t,subscriber:i});for(;;){if(r++>=e){i.complete();break}if(i.next(s++),i.closed)break}}))},t.throwError=rt,t.timer=Ie,t.using=function(t,e){return new E((function(n){var i,r;try{i=t()}catch(t){return void n.error(t)}try{r=e(i)}catch(t){return void n.error(t)}var s=(r?te(r):$).subscribe(n);return function(){s.unsubscribe(),i&&i.unsubscribe()}}))},t.zip=Oe,t.scheduled=Zt,t.EMPTY=$,t.NEVER=ve,t.config=o,Object.defineProperty(t,"__esModule",{value:!0})}));
/**
 * @license rxcomp v1.0.0-beta.21
 * (c) 2022 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
var rxcomp=function(t,e,n){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,a(t,e)}function o(t){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},o(t)}function a(t,e){return a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},a(t,e)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function l(t,e,n){return l=c()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&a(r,n.prototype),r},l.apply(null,arguments)}function u(t){var e="function"==typeof Map?new Map:void 0;return u=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return l(t,arguments,o(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),a(i,t)},u(t)}var d={},h={},A=function(){var t=n.prototype;function n(){this.rxcompId=-1,this.unsubscribe$=new e.Subject,this.changes$=new e.ReplaySubject(1)}return t.onInit=function(){},t.onChanges=function(t){},t.onView=function(){},t.onDestroy=function(){},t.pushChanges=function(){p(this).module.instances&&(this.changes$.next(this),this.onView())},t.onParentDidChange=function(t){p(this).module.resolveInputsOutputs(this,t),this.onChanges(t),this.pushChanges()},n.getInputsTokens=function(t,e,n){var i,r={};return null==(i=this.meta.inputs)||i.forEach((function(t){var i=n.resolveAttribute(t,e);i&&(r[t]=i)})),r},n}();function p(t){return d[t.rxcompId]}A.meta=void 0;var f=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(A),m=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).class="",e.keys=[],e}s(e,t);var n=e.prototype;return n.onInit=function(){var t=this,e=p(this).node;Array.prototype.slice.call(e.classList).forEach((function(e){t.keys.push(e)}))},n.onChanges=function(){var t=p(this).node,e=[],n=this.class;if("object"==typeof n)for(var i in n)n[i]&&e.push(i);else"string"==typeof n&&(e=n.split(/\s+/));e=e.concat(this.keys),t.setAttribute("class",e.join(" "))},e}(f);m.meta={selector:"[[class]]",inputs:["class"]};var g=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(u(Error)),v=function(t){function e(e,n,i,r,s){var o,a="ExpressionError in "+i.constructor.name+' "'+r+'"\n\t\t'+e.message;(o=t.call(this,a)||this).module=void 0,o.instance=void 0,o.expression=void 0,o.params=void 0,o.template=void 0,o.name=e.name,o.module=n,o.instance=i,o.expression=r,o.params=s;var c=p(i).node;return o.template=c.outerHTML,o}return s(e,t),e}(u(Error)),y=function(){function t(t,e){this.next=void 0,this.interceptor=void 0,this.next=t,this.interceptor=e}return t.prototype.handle=function(t){return this.interceptor.intercept(t,this.next)},t}(),_=function(){function t(){}return t.prototype.handle=function(t){return e.of(t)},t}(),b=[],E=new e.ReplaySubject(1),w=E.pipe(n.switchMap((function(t){return b.reduceRight((function(t,e){return new y(t,e)}),new _).handle(t)})),n.tap((function(t){t&&console.error(t)}))),S=function(t){function i(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).event="",e}return s(i,t),i.prototype.onInit=function(){var t=p(this),i=t.module,r=t.node,s=t.parentInstance,o=t.selector,a=this.event=o.replace(/\[|\]|\(|\)/g,""),c=e.fromEvent(r,a).pipe(n.shareReplay(1)),l=r.getAttribute("("+a+")");if(l){var u=i.makeFunction(l,["$event"]);c.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){i.resolve(u,s,t)}))}else s[a+"$"]=c},i}(f);S.meta={selector:"[("+["mousedown","mouseup","mousemove","click","dblclick","mouseover","mouseout","mouseenter","mouseleave","contextmenu","touchstart","touchmove","touchend","keydown","keyup","input","change","loaded"].join(")],[(")+")]"};var T=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(A),C=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.prototype.pushChanges=function(){var t=p(this),e=t.module,n=t.node;e.instances&&(this.changes$.next(this),e.parse(n,this),this.onView())},e}(A),R=["constructor","rxcompId","onInit","onChanges","onDestroy","pushChanges","changes$","unsubscribe$"],I=function(t){function e(n,i){var r;return void 0===i&&(i={}),r=t.call(this)||this,i=e.mergeDescriptors(n,n,i),i=e.mergeDescriptors(Object.getPrototypeOf(n),n,i),Object.defineProperties(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r),i),r}s(e,t);var n=e.prototype;return n.pushChanges=function(){var e=this,n=p(this);n.keys||(n.keys=Object.keys(n.parentInstance).filter((function(t){return-1===R.indexOf(t)}))),n.module.instances&&n.keys.forEach((function(t){e[t]=n.parentInstance[t]})),t.prototype.pushChanges.call(this)},n.onParentDidChange=function(t){this.onChanges(t),this.pushChanges()},e.mergeDescriptors=function(t,e,n){void 0===n&&(n={});for(var i=Object.getOwnPropertyNames(t),r=function(){var r=i.shift();if(-1===R.indexOf(r)&&!n.hasOwnProperty(r)){var s=Object.getOwnPropertyDescriptor(t,r);"function"==typeof s.value&&(s.value=function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e[r].apply(e,n)}),n[r]=s}};i.length;)r();return n},e}(C),x=function(t){function e(e,n,i,r,s,o,a){var c;return(c=t.call(this,a)||this).index=void 0,c.count=void 0,c[e]=n,c[i]=r,c.index=s,c.count=o,c}return s(e,t),r(e,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),e}(I),O=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).instances=[],e.forbegin=void 0,e.forend=void 0,e.tokens=void 0,e}s(e,t);var n=e.prototype;return n.onInit=function(){var t=p(this).node,e=this.forbegin=document.createComment("*for begin");e.rxcompId=t.rxcompId,t.parentNode.replaceChild(e,t);var n=this.forend=document.createComment("*for end");e.parentNode.insertBefore(n,e.nextSibling),t.removeAttribute("*for")},n.onChanges=function(){for(var t=p(this),e=t.module,n=t.node,i=this.tokens,r=this.for||[],s=Array.isArray(r),o=s?r:Object.keys(r),a=o.length,c=this.instances.length,l=0;l<Math.max(c,a);l++)if(l<a){var u=s?l:o[l],d=s?o[u]:r[u];if(l<c){var h=this.instances[l];h[i.key]=u,h[i.value]=d}else{var A=n.cloneNode(!0);delete A.rxcompId,this.forend.parentNode.insertBefore(A,this.forend);var f=[i.key,u,i.value,d,l,a,t.parentInstance],m=e.makeInstance(A,x,t.selector,t.parentInstance,f,void 0,!0);m&&(e.compile(A,m),e.makeInstanceSubscription(m,t.parentInstance),this.instances.push(m))}}else{var g=p(this.instances[l]).node;g.parentNode.removeChild(g),e.remove(g)}this.instances.length=o.length},e.getInputsTokens=function(t,n,i){var r={},s=n.getAttribute("*for");if(s){var o=e.getForExpressionTokens(s);t.tokens=o,r.for=o.iterable}return r},e.getForExpressionTokens=function(t){if(null===t)throw new Error("invalid for");if(-1===t.trim().indexOf("let ")||-1===t.trim().indexOf(" of "))throw new Error("invalid for");var e=t.split(";").map((function(t){return t.trim()})).filter((function(t){return""!==t})),n=e[0].split(" of ").map((function(t){return t.trim()})),i=n[0].replace(/\s*let\s*/,""),r=n[1],s="index",o=i.match(/\[(.+)\s*,\s*(.+)\]/);if(o&&(s=o[1],i=o[2]),e.length>1){var a=e[1].split(/\s*let\s*|\s*=\s*index/).map((function(t){return t.trim()}));3===a.length&&(s=a[1])}return{key:s,value:i,iterable:r}},e}(T);O.meta={selector:"[*for]",inputs:["for"]};var L=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),r(e,[{key:"target",get:function(){return this.target_},set:function(t){if(this.target_!==t){this.target_=t;var e=p(this).node;t?e.setAttribute("target",t):e.removeAttribute("target")}}}]),e}(f);L.meta={selector:"[[target]]",inputs:["target"]};var M=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),r(e,[{key:"href",get:function(){return this.href_},set:function(t){if(this.href_!==t){this.href_=t;var e=p(this).node;t?e.setAttribute("href",t):e.removeAttribute("href")}}}]),e}(f);M.meta={selector:"[[href]]",inputs:["href"]};var k=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).ifbegin=void 0,e.ifend=void 0,e.clonedNode=void 0,e.element=void 0,e}s(e,t);var n=e.prototype;return n.onInit=function(){var t=p(this).node,e=this.ifbegin=document.createComment("*if begin");e.rxcompId=t.rxcompId,t.parentNode.replaceChild(e,t);var n=this.ifend=document.createComment("*if end");e.parentNode.insertBefore(n,e.nextSibling);var i=t.cloneNode(!0);i.removeAttribute("*if"),this.clonedNode=i,this.element=i.cloneNode(!0)},n.onChanges=function(){var t=p(this).module,e=this.element;if(Boolean(this.if)){if(!e.parentNode){var n=this.ifend;n.parentNode.insertBefore(e,n),t.compile(e)}}else e.parentNode&&(t.remove(e,this),e.parentNode.removeChild(e),this.element=this.clonedNode.cloneNode(!0))},e}(T);k.meta={selector:"[*if]",inputs:["if"]};var N=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),r(e,[{key:"innerHTML",get:function(){return this.innerHTML_},set:function(t){this.innerHTML_!==t&&(this.innerHTML_=t,p(this).node.innerHTML=null==t?"":t)}}]),e}(f);N.meta={selector:"[innerHTML]",inputs:["innerHTML"]};var P=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).active=!1,e}return s(e,t),e.prototype.onToggle=function(){this.active=!this.active,this.pushChanges()},e}(C);P.meta={selector:"json-component",inputs:["item"],template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ json </span>\n\t\t\t\t\t<span *if="active">- json </span>\n\t\t\t\t\t<span [innerHTML]="item"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item">\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item | json"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var D=function(){function t(){}return t.transform=function(t){return t},t}();D.meta=void 0;var B=[T,C,f],U=function(){function t(){}return t.bootstrap=function(t){if(!t)throw new g("missing moduleFactory");if(!t.meta)throw new g("missing moduleFactory meta");if(!t.meta.bootstrap)throw new g("missing bootstrap");if(!t.meta.bootstrap.meta)throw new g("missing bootstrap meta");if(!t.meta.bootstrap.meta.selector)throw new g("missing bootstrap meta selector");var e=this.resolveMeta(t),n=new t;return n.meta=e,e.imports.forEach((function(t){t.prototype.onInit.call(n)})),n},t.querySelector=function(t){return document.querySelector(t)},t.resolveMeta=function(t){var e=this.resolveImportedMeta(t),n=t.meta.bootstrap,i=this.querySelector(n.meta.selector);if(!i)throw new g("missing node "+n.meta.selector);var r=i.innerHTML,s=this.resolvePipes(e),o=this.resolveFactories(e);return this.sortFactories(o),o.unshift(n),{factories:o,pipes:s,selectors:this.unwrapSelectors(o),bootstrap:n,node:i,nodeInnerHTML:r,imports:t.meta.imports||[]}},t.resolveImportedMeta=function(t){var e=this,n=Object.assign({imports:[],declarations:[],pipes:[],exports:[]},t.meta);return n.imports=(t.meta.imports||[]).map((function(t){return e.resolveImportedMeta(t)})),n},t.resolvePipes=function(t,e){var n=this,i=t.imports.map((function(t){return n.resolvePipes(t,!0)})),r={};return(e?t.exports:t.declarations).filter((function(t){return t.prototype instanceof D})).forEach((function(t){return r[t.meta.name]=t})),Object.assign.apply(Object,[{}].concat(i,[r]))},t.resolveFactories=function(t,e){var n,i=this,r=t.imports.map((function(t){return i.resolveFactories(t,!0)})),s=(e?t.exports:t.declarations).filter((function(t){return t.prototype instanceof A}));return(n=Array.prototype.concat).call.apply(n,[s].concat(r))},t.sortFactories=function(t){t.sort((function(t,e){var n=B.reduce((function(e,n,i){return t.prototype instanceof n?i:e}),-1)-B.reduce((function(t,n,i){return e.prototype instanceof n?i:t}),-1);return 0===n?(t.meta.hosts?1:0)-(e.meta.hosts?1:0):n}))},t.getExpressions=function(t){var e=[];return t.replace(/\.([\w\-\_]+)|\[(.+?\]*)(\=)(.*?)\]|\[(.+?\]*)\]|([\w\-\_]+)/g,(function(t,n,i,r,s,o,a){return n&&e.push((function(t){return t.classList.contains(n)})),i&&e.push((function(t){return t.hasAttribute(i)&&t.getAttribute(i)===s||t.hasAttribute("["+i+"]")&&t.getAttribute("["+i+"]")===s})),o&&e.push((function(t){return t.hasAttribute(o)||t.hasAttribute("["+o+"]")})),a&&e.push((function(t){return t.nodeName.toLowerCase()===a.toLowerCase()})),""})),e},t.unwrapSelectors=function(t){var e=this,n=[];return t.forEach((function(t){t.meta&&t.meta.selector&&t.meta.selector.split(",").forEach((function(i){i=i.trim();var r=[],s=i.replace(/\:not\((.+?)\)/g,(function(t,n){return r=e.getExpressions(n),""})),o=e.getExpressions(s);n.push((function(e){var n=o.reduce((function(t,n){return t&&n(e)}),!0),s=r.reduce((function(t,n){return t||n(e)}),!1);return!(!n||s)&&{node:e,factory:t,selector:i}}))}))})),n},t}(),F="undefined"!=typeof window&&void 0!==window.document,H="undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("Node.js")||"undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("jsdom"),V="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,j="object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,G=V,Q=!V&&F,z=j,W=function(){function t(){}return t.encode=function(t,e){return void 0===e&&(e=[K]),e.reduce((function(t,e){return e(t)}),t)},t.decode=function(t,e){return void 0===e&&(e=[Y]),e.reduce((function(t,e){return e(t)}),t)},t.encodeJson=function(t){return this.encode(t,[K])},t.decodeJson=function(t){return this.decode(t,[Y])},t.encodeBase64=function(t){return this.encode(t,[K,$])},t.decodeBase64=function(t){return this.decode(t,[X,Y])},t}();function K(t,e,n){var i;try{var r=[],s=JSON.stringify(t,(function(t,n){if("object"==typeof n&&null!=n){if(-1!==r.indexOf(n))return e;r.push(n)}return n}),n);i=s}catch(t){}return i}function q(t,e){return function(n){return K(n,t,e)}}function Y(t){var e;if(t)try{e=JSON.parse(t)}catch(t){}return e}function $(t){var e;try{e=Q?btoa(t):Buffer.from(t).toString("base64")}catch(n){e=t}return e}function X(t){var e;try{e=Q?atob(t):Buffer.from(t,"base64").toString()}catch(n){e=t}return e}var J=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.transform=function(t){return W.encode(t,[q("#ref",2)])},e}(D);J.meta={name:"json"};var Z="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||void 0,tt=0,et=function(){function t(){this.meta=void 0,this.instances=void 0,this.unsubscribe$=new e.Subject}var i=t.prototype;return i.onInit=function(){},i.compile=function(e,n){var i,r=this;return t.querySelectorsAll(e,this.meta.selectors,[]).map((function(t){i&&i!==t.node&&(n=void 0);var e=r.makeInstance(t.node,t.factory,t.selector,n);return t.factory.prototype instanceof C&&(i=t.node),e})).filter((function(t){return void 0!==t}))},i.makeInstance=function(e,n,i,r,s,o,a){if(void 0===a&&(a=!1),r||e.parentNode){var c=n.meta;if(!(r=r||this.getParentInstance(e.parentNode)))return;var u=l(n,s||[]);o&&Object.keys(o).forEach((function(t){Object.defineProperty(u,t,{value:o[t],configurable:!1,enumerable:!1,writable:!0})}));var d=t.makeContext(this,u,r,e,n,i);return u instanceof I||(this.makeHosts(c,u,e),d.inputs=this.makeInputs(c,u,e,n),d.outputs=this.makeOutputs(c,u),this.resolveInputsOutputs(u,r)),u.onInit(),a||this.makeInstanceSubscription(u,r),u}},i.makeInstanceSubscription=function(t,e){e instanceof A&&e.changes$.pipe(n.takeUntil(t.unsubscribe$)).subscribe((function(e){t.onParentDidChange(e)}))},i.makeFunction=function(e,n){void 0===n&&(n=["$instance"]),e=t.parseExpression(e);var i="with(this) {\n\treturn (function ("+n.join(",")+", $$module) {\n\t\ttry {\n\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\treturn "+e+";\n\t\t} catch(error) {\n\t\t\t$$module.nextError(error, this, "+JSON.stringify(e)+", arguments);\n\t\t}\n\t}.bind(this)).apply(this, arguments);\n}",r=new Function(i);return r.expression=e,r},i.resolveInputsOutputs=function(t,e){var n=p(t),i=n.parentInstance,r=n.inputs;for(var s in r){var o=r[s],a=this.resolve(o,i,t);t[s]=a}},i.resolveAttribute=function(t,e){var n=null;if(e.hasAttribute("["+t+"]"))n=e.getAttribute("["+t+"]");else if(e.hasAttribute("*"+t))n=e.getAttribute("*"+t);else if(e.hasAttribute(t)&&(n=e.getAttribute(t))){var i=n.replace(/({{)|(}})|(")/g,(function(t,e,n,i){return e?'"+':n?'+"':i?'"':""}));n='"'+i+'"'}return n},i.resolve=function(t,e,n){return t.apply(e,[n,this])},i.parse=function(t,e){for(var n=0;n<t.childNodes.length;n++){var i=t.childNodes[n];if(1===i.nodeType){var r=i;nt(r)||this.parse(r,e)}else if(3===i.nodeType){var s=i;this.parseTextNode(s,e)}}},i.remove=function(e,n){var i=n?p(n):void 0;return t.traverseDown(e,(function(e){var n=e.rxcompId;n&&(0===t.deleteContext(n,i).length&&delete e.rxcompId)})),e},i.destroy=function(){this.unsubscribe$.next(),this.unsubscribe$.complete(),this.remove(this.meta.node),this.meta.node.innerHTML=this.meta.nodeInnerHTML},i.nextError=function(t,e,n,i){var r=new v(t,this,e,n,i);E.next(r)},i.makeContext=function(e,n,i,r){return t.makeContext(this,e,n,i,e.constructor,r)},i.makeHosts=function(t,e,n){t.hosts&&Object.keys(t.hosts).forEach((function(i){var r=t.hosts[i];e[i]=rt(e,r,n)}))},i.makeInputs=function(t,e,n,i){var r=this,s={},o=i.getInputsTokens(e,n,this);return Object.keys(o).forEach((function(t){s[t]=r.makeFunction(o[t])})),s},i.makeOutput=function(t,i){var r=this,s=p(t),o=s.node,a=s.parentInstance,c=o.getAttribute("("+i+")"),l=c?this.makeFunction(c,["$event"]):null,u=(new e.Subject).pipe(n.tap((function(t){l&&r.resolve(l,a,t)})));return u.pipe(n.takeUntil(t.unsubscribe$)).subscribe(),t[i]=u,u},i.makeOutputs=function(t,e){var n=this,i={};return t.outputs&&t.outputs.forEach((function(t){var r=n.makeOutput(e,t);r&&(i[t]=r)})),i},i.getInstance=function(t){if(t===document)return Z;var e=it(t);return e?e.instance:void 0},i.getParentInstance=function(e){var n=this;return t.traverseUp(e,(function(t){return n.getInstance(t)}))},i.parseTextNode=function(t,e){var n=this,i=t.nodeExpressions;if(i||(i=this.parseTextNodeExpression(t.wholeText)),i.length){var r=i.reduce((function(t,i){var r;return"function"==typeof i?null==(r=n.resolve(i,e,e))&&(r=""):r=i,t+r}),"");if(t.nodeValue!==r){var s=document.createTextNode(r);s.nodeExpressions=i,t.parentNode.replaceChild(s,t)}}else t.nodeExpressions=i},i.pushFragment=function(t,e,n,i){var r=t.substring(e,n);i.push(r)},i.parseTextNodeExpression=function(t){for(var e,n=[],i=/\{{2}((([^{}])|(\{([^{}]|(\{.*?\}))+?\}))*?)\}{2}/g,r=0;null!==(e=i.exec(t));){var s=i.lastIndex-e[0].length;if(s>r&&this.pushFragment(t,s,r,n),r=i.lastIndex,e[1]){var o=this.makeFunction(e[1]);n.push(o)}}var a=t.length;return a>r&&this.pushFragment(t,r,a,n),n.find((function(t){return"function"==typeof t}))?n:[]},t.makeContext=function(t,e,n,i,r,s){e.rxcompId=++tt;var o={module:t,instance:e,parentInstance:n,node:i,factory:r,selector:s},a=i.rxcompId=i.rxcompId||e.rxcompId;return(h[a]||(h[a]=[])).push(o),d[e.rxcompId]=o,o},t.parseExpression=function(e){for(var n=/(\()([^\(\)]*)(\))/;e.match(n);)e=e.replace(n,(function(e){return"â"+t.parsePipes(arguments.length<=2?void 0:arguments[2])+"â"}));return e=(e=t.parsePipes(e)).replace(/(â)|(â)/g,(function(t){return(arguments.length<=1?void 0:arguments[1])?"(":")"})),t.parseOptionalChaining(e)},t.parsePipes=function(e){for(var n=/(.*?[^\|])\|([^\|]+)/;e.match(n);)e=e.replace(n,(function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var s=i[0].trim(),o=t.parsePipeParams(i[1]),a=o.shift().trim();return"$$pipes."+a+".transformâ"+[s].concat(o)+"â"}));return e},t.parsePipeParams=function(t){for(var e=[],n=0,i="",r=0,s=t.length;n<s;){var o=t.substr(n,1);"{"!==o&&"("!==o&&"["!==o||r++,"}"!==o&&")"!==o&&"]"!==o||r--,":"===o&&0===r?(i.length&&e.push(i.trim()),i=""):i+=o,n++}return i.length&&e.push(i.trim()),e},t.parseOptionalChaining=function(t){var e;return t=t.replace(/(\w+(\?\.))+([\.|\w]+)/g,(function(t){for(var n=t.split("?."),i=0;i<n.length-1;i++){var r=i>0?"("+n[i]+" = "+e+")":n[i],s=n[i+1];e=i>0?r+"."+s:"("+r+" ? "+r+"."+s+" : void 0)"}return e||""}))},t.deleteContext=function(t,e){var n=[],i=h[t];return i&&(i.forEach((function(t){if(t===e)n.push(e);else{var i=t.instance;i.unsubscribe$.next(),i.unsubscribe$.complete(),i.onDestroy(),delete d[i.rxcompId]}})),n.length?h[t]=n:delete h[t]),n},t.matchSelectors=function(t,e,n){for(var i=0;i<e.length;i++){var r=e[i](t);if(r){var s=r.factory;if(s.prototype instanceof C&&s.meta.template&&(t.innerHTML=s.meta.template),n.push(r),s.prototype instanceof T)break}}return n},t.querySelectorsAll=function(t,e,n){if(1===t.nodeType){var i=this.matchSelectors(t,e,[]);if(n=n.concat(i),i.find((function(t){return t.factory.prototype instanceof T})))return n;for(var r=t.childNodes,s=0;s<r.length;s++)n=this.querySelectorsAll(r[s],e,n)}return n},t.traverseUp=function(t,e,n){if(void 0===n&&(n=0),t){var i=e(t,n);return i||this.traverseUp(t.parentNode,e,n+1)}},t.traverseDown=function(t,e,n){if(void 0===n&&(n=0),t){var i=e(t,n);if(i)return i;if(1===t.nodeType)for(var r=0,s=t.childNodes.length;r<s&&!i;)i=this.traverseDown(t.childNodes[r],e,n+1),r++;return i}},t.traversePrevious=function(t,e,n){if(void 0===n&&(n=0),t){var i=e(t,n);return i||this.traversePrevious(t.previousSibling,e,n+1)}},t.traverseNext=function(t,e,n){if(void 0===n&&(n=0),t){var i=e(t,n);return i||this.traverseNext(t.nextSibling,e,n+1)}},t}();function nt(t){var e,n=t.rxcompId;if(n){var i=h[n];i&&(e=i.reduce((function(t,e){return e.instance instanceof I?t||e:e.instance instanceof C?e:t}),void 0))}return e}function it(t){var e=nt(t);if(!(e&&e.factory.prototype instanceof T))return e}function rt(t,e,n){if(n||(n=p(t).node),n.rxcompId){var i=h[n.rxcompId];if(i)for(var r=0;r<i.length;r++){var s=i[r];if(s.instance!==t&&s.instance instanceof e)return s.instance}}return n.parentNode?rt(t,e,n.parentNode):void 0}et.forRoot=void 0,et.meta=void 0;var st=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),r(e,[{key:"src",get:function(){return this.src_},set:function(t){if(this.src_!==t){this.src_=t;var e=p(this).node;t?e.setAttribute("src",t):e.removeAttribute("src")}}}]),e}(f);st.meta={selector:"[[src]]",inputs:["src"]};var ot=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).style=void 0,e.previousStyle=void 0,e}return s(e,t),e.prototype.onChanges=function(){var t=p(this).node,e=this.style,n=this.previousStyle;if(n)for(var i in n)if(!e||!e[i]){var r=i.split(".").shift();t.style.removeProperty(r)}if(e)for(var s in e)if(!n||n[s]!==e[s]){var o=s.split("."),a=o.shift(),c=e[s]+(o.length?o[0]:"");t.style.setProperty(a,c)}this.previousStyle=e},e}(f);ot.meta={selector:"[[style]]",inputs:["style"]};var at=[m,S,O,M,L,k,N,P,st,ot],ct=[J],lt=function(t){function e(){var e;return e=t.call(this)||this,w.pipe(n.takeUntil(e.unsubscribe$)).subscribe(),e}return s(e,t),e}(et);lt.meta={declarations:[].concat(at,ct),exports:[].concat(at,ct)};var ut=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.bootstrap=function(t){if(!Q)throw new g("missing platform browser, Window not found");if(!t)throw new g("missing moduleFactory");if(!t.meta)throw new g("missing moduleFactory meta");if(!t.meta.bootstrap)throw new g("missing bootstrap");if(!t.meta.bootstrap.meta)throw new g("missing bootstrap meta");if(!t.meta.bootstrap.meta.selector)throw new g("missing bootstrap meta selector");var e=this.resolveMeta(t),n=new t;if(n.meta=e,e.imports.forEach((function(t){t.prototype.onInit.call(n)})),Z.rxcomp_hydrate_){var i,r=e.node.cloneNode();r.innerHTML=e.nodeInnerHTML=Z.rxcomp_hydrate_.innerHTML;var s=n.compile(r,Z);n.instances=s,s[0].pushChanges(),null==(i=e.node.parentNode)||i.replaceChild(r,e.node)}else{var o=n.compile(e.node,Z);n.instances=o,o[0].pushChanges()}return n},e}(U);var dt=function(){function t(){}return t.makeKey=function(t,e){var n="rxcomp-hydrate-"+t+"-"+(e?ht(e):"");return n=n.replace(/(\s+)|(\W+)/g,(function(){return(arguments.length<=1?void 0:arguments[1])?"":"_"})),n},t.has=function(t){return null!==document.querySelector("#"+t)},t.get=function(t){var e=document.querySelector("#"+t);if(e&&e.firstChild){var n=e.firstChild.nodeValue;return n?W.decode(n,[Y]):void 0}},t.set=function(t,e){var n=W.encode(e,[K]);if(n){var i=document.createTextNode(n),r=document.querySelector("#"+t);r?r.replaceChild(i,r.firstChild):((r=document.createElement("script")).setAttribute("id",t),r.setAttribute("type","text/template"),r.append(i),document.head.append(r))}},t.remove=function(t){var e=document.querySelector("#"+t);e&&e.parentNode&&e.parentNode.removeChild(e)},t}();function ht(t,e){return void 0===e&&(e=""),"number"==typeof t?e+="-"+t.toString():"string"==typeof t?e+="-"+t.substr(0,20):t&&Array.isArray(t)?e+="-"+t.map((function(t){return ht(t)})).join(""):t&&"object"==typeof t&&(e+="-"+Object.keys(t).map((function(e){return e+ht(t[e])})).join("-")),e}return t.Browser=ut,t.ClassDirective=m,t.Component=C,t.Context=I,t.CoreModule=lt,t.DefaultErrorHandler=_,t.Directive=f,t.ErrorInterceptorHandler=y,t.ErrorInterceptors=b,t.EventDirective=S,t.ExpressionError=v,t.Factory=A,t.ForItem=x,t.ForStructure=O,t.HrefDirective=M,t.HrefTargetDirective=L,t.IfStructure=k,t.InnerHtmlDirective=N,t.JsonComponent=P,t.JsonPipe=J,t.Module=et,t.ModuleError=g,t.PLATFORM_BROWSER=F,t.PLATFORM_JS_DOM=H,t.PLATFORM_NODE=V,t.PLATFORM_WEB_WORKER=j,t.Pipe=D,t.Platform=U,t.Serializer=W,t.SrcDirective=st,t.Structure=T,t.StyleDirective=ot,t.TransferService=dt,t.WINDOW=Z,t.decodeBase64=X,t.decodeJson=Y,t.encodeBase64=$,t.encodeJson=K,t.encodeJsonWithOptions=q,t.errors$=w,t.getContext=p,t.getContextByNode=it,t.getHost=rt,t.getLocationComponents=function(t){for(var e,n="",i="",r="",s="",o="",a="",c="",l=/^((http\:|https\:)?\/\/)?((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])|locahost)?(\:([^\/]+))?(\.?\/[^\?]+)?(\?[^\#]+)?(\#.+)?$/g,u=[];null!==(e=l.exec(t));)u.push(e);for(var d=0,h=u;d<h.length;d++){var A=h[d];n=A[2]||"",i=r=A[3]||"",s=A[11]||"",o=A[12]||"",a=A[13]||"",c=A[14]||""}return{href:t,protocol:n,host:i,hostname:r,port:s,pathname:o,search:a,hash:c}},t.getParsableContextByElement=nt,t.isPlatformBrowser=Q,t.isPlatformServer=G,t.isPlatformWorker=z,t.nextError$=E,t.optionsToKey=ht,Object.defineProperty(t,"__esModule",{value:!0}),t}({},rxjs,rxjs.operators);
/**
 * @license rxcomp-form v1.0.0-beta.18
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */this.rxcomp=this.rxcomp||{},this.rxcomp.form=function(t,e,n,i){function r(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}function o(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var a=function(t){function n(){return t.apply(this,arguments)||this}return o(n,t),n.prototype.onChanges=function(t){var n=e.getContext(this).node,i=this.control.flags;Object.keys(i).forEach((function(t){i[t]?n.classList.add(t):n.classList.remove(t)}))},s(n,[{key:"control",get:function(){return{}}}]),n}(e.Directive);a.meta={selector:"",hosts:{host:a}};var c=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),s(e,[{key:"control",get:function(){if(this.formArray)return this.formArray;if(!this.host)throw"missing form collection";return this.host.control.get(this.formArrayName)}}]),e}(a);c.meta={selector:"[formArray],[formArrayName]",inputs:["formArray","formArrayName"],hosts:{host:a}};var l=function(t){function r(){return t.apply(this,arguments)||this}o(r,t);var a=r.prototype;return a.onInit=function(){var t=this,r=e.getContext(this).node;n.fromEvent(r,"input").pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onChange(e)})),n.fromEvent(r,"change").pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onChange(e)})),n.fromEvent(r,"blur").pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onBlur(e)}))},a.onChanges=function(t){var n=e.getContext(this).node;this.formControlName&&(n.name=this.formControlName);var i=this.control,r=i.flags;Object.keys(r).forEach((function(t){r[t]?n.classList.add(t):n.classList.remove(t)})),this.writeValue(i.value)},a.writeValue=function(t){e.getContext(this).node.value=null==t?"":t},a.onChange=function(t){var n=e.getContext(this).node;this.control.value=""===n.value?null:n.value},a.onBlur=function(t){this.control.touched=!0},a.setDisabledState=function(t){e.getContext(this).node.disabled=t},s(r,[{key:"control",get:function(){if(this.formControl)return this.formControl;if(!this.host)throw"missing form collection";return this.host.control.get(this.formControlName)}}]),r}(e.Directive);l.meta={selector:"",inputs:["formControl","formControlName","value"],hosts:{host:a}};var u=function(t){function r(){return t.apply(this,arguments)||this}o(r,t);var s=r.prototype;return s.onInit=function(){var t=this,r=e.getContext(this).node;n.fromEvent(r,"change").pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onChange(e)})),n.fromEvent(r,"blur").pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onBlur(e)}))},s.writeValue=function(t){var n=e.getContext(this).node;t===this.value?n.setAttribute("checked",t):n.removeAttribute("checked")},s.setDisabledState=function(t){e.getContext(this).node.disabled=t},s.onChange=function(t){var n=e.getContext(this).node;this.control.value=n.checked?this.value:!0!==this.value&&null},s.onBlur=function(t){this.control.touched=!0},r}(l);u.meta={selector:"input[type=checkbox][formControl],input[type=checkbox][formControlName]",inputs:["formControl","formControlName","value"],hosts:{host:a}};var d=function(t){function n(){return t.apply(this,arguments)||this}return o(n,t),n.prototype.onChanges=function(t){var n=e.getContext(this).node,i=this.control.flags;Object.keys(i).forEach((function(t){i[t]?n.classList.add(t):n.classList.remove(t)}))},s(n,[{key:"control",get:function(){if(this.formField)return this.formField;if(!this.host)throw"missing form collection";return this.host.control.get(this.formFieldName)}}]),n}(e.Component);d.meta={selector:"[formField],[formFieldName]",inputs:["formField","formFieldName"],hosts:{host:a}};var h=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),s(e,[{key:"control",get:function(){if(this.formGroup)return this.formGroup;if(!this.host)throw"missing form collection";return this.host.control.get(this.formGroupName)}}]),e}(a);h.meta={selector:"[formGroup],[formGroupName]",inputs:["formGroup","formGroupName"],hosts:{host:a}};var A=function(t){function n(){return t.apply(this,arguments)||this}o(n,t);var i=n.prototype;return i.writeValue=function(t){e.getContext(this).node.value=null==t?"":t},i.onChange=function(t){var n=e.getContext(this).node;this.control.value=""===n.value?null:n.value},i.onBlur=function(t){this.control.touched=!0},n}(l);A.meta={selector:"input[type=text][formControl],input[type=text][formControlName],input[type=email][formControl],input[type=email][formControlName],input[type=password][formControl],input[type=password][formControlName],textarea[formControl],textarea[formControlName]",inputs:["formControl","formControlName"],hosts:{host:a}};var p=function(t){function n(){return t.apply(this,arguments)||this}return o(n,t),n.prototype.onChanges=function(t){e.getContext(this).node.setAttribute("placeholder",this.placeholder||"")},n}(e.Directive);p.meta={selector:"input[placeholder],textarea[placeholder]",inputs:["placeholder"]};var f=function(t){function r(){return t.apply(this,arguments)||this}o(r,t);var s=r.prototype;return s.onInit=function(){var t=this,r=e.getContext(this).node;n.fromEvent(r,"change").pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onChange(e)})),n.fromEvent(r,"blur").pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onBlur(e)}))},s.writeValue=function(t){var n=e.getContext(this).node;n.checked=n.value===t},s.setDisabledState=function(t){e.getContext(this).node.disabled=t},s.onChange=function(t){var n=e.getContext(this).node;n.checked&&(this.control.value=n.value)},s.onBlur=function(t){this.control.touched=!0},r}(l);f.meta={selector:"input[type=radio][formControl],input[type=radio][formControlName]",inputs:["formControl","formControlName"],hosts:{host:a}};var m=function(t){function n(){return t.apply(this,arguments)||this}o(n,t);var i=n.prototype;return i.writeValue=function(t){e.getContext(this).node.value=null==t?"":t},i.setDisabledState=function(t){e.getContext(this).node.disabled=t},i.onChange=function(t){var n=e.getContext(this).node;this.control.value=""===n.value?null:n.value},i.onBlur=function(t){this.control.touched=!0},n}(l);m.meta={selector:"select[formControl],select[formControlName]",inputs:["formControl","formControlName"],hosts:{host:a}};var g=function(t){function r(){return t.apply(this,arguments)||this}return o(r,t),r.prototype.onInit=function(){var t=e.getContext(this),r=t.module,s=t.node,o=t.selector,a=t.parentInstance,c=this.event=o.replace(/\[|\]|\(|\)/g,""),l=s,u=this.event$=n.fromEvent(l,"submit").pipe(i.tap((function(t){t.preventDefault()})),i.shareReplay(1)),d=s.getAttribute("("+c+")");if(d){var h=r.makeFunction(d,["$event"]);u.pipe(i.takeUntil(this.unsubscribe$)).subscribe((function(t){r.resolve(h,a,t)}))}else a[c+"$"]=u},r}(e.Directive);g.meta={selector:"[(submit)]"};var v=function(){function t(t,e){this.validator=t,this.params$=new n.BehaviorSubject(e)}return t.prototype.validate=function(t){return this.validator(t,this.params)},s(t,[{key:"params",get:function(){return this.params$.getValue()},set:function(t){if(t){var e=this.params;Object.keys(t).reduce((function(n,i){return n||!e||e[i]!==t[i]}),!1)&&this.params$.next(t)}}}]),t}();function y(){return new v((function(t,e){return null}))}function _(){return new v((function(t,e){return null==t||0===t.length?{required:!0}:null}))}function b(){return new v((function(t,e){return!0===t?null:{required:!0}}))}function E(t){return new v((function(t,e){var n=e.min;return t&&n?(t=parseFloat(t),!isNaN(t)&&t<n?{min:{min:n,actual:t}}:null):null}),{min:t})}function w(t){return new v((function(t,e){var n=e.max;return t&&n?(t=parseFloat(t),!isNaN(t)&&t>n?{max:{max:n,actual:t}}:null):null}),{max:t})}function S(t){return new v((function(t,e){var n=e.minlength;if(!t||!n)return null;var i=t?t.length:0;return i<n?{minlength:{requiredLength:n,actualLength:i}}:null}),{minlength:t})}function T(t){return new v((function(t,e){var n=e.maxlength;if(!t||!n)return null;var i=t?t.length:0;return i>n?{minlength:{requiredLength:n,actualLength:i}}:null}),{maxlength:t})}function C(t){return new v((function(t,e){var n=e.pattern;if(!t||!n)return null;var i=function(t){var e;t instanceof RegExp?e=t:"string"==typeof t&&(t="$"===(t="^"===t.charAt(0)?t:"^"+t).charAt(t.length-1)?t:t+"$",e=new RegExp(t));return e||new RegExp("")}(n);return i.test(t)?null:{pattern:{requiredPattern:i.toString(),actualValue:t}}}),{pattern:t})}function R(){var t=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return new v((function(e,n){return e?t.test(e)?null:{email:!0}:null}))}var I=Object.freeze({__proto__:null,NullValidator:y,RequiredValidator:_,RequiredTrueValidator:b,MinValidator:E,MaxValidator:w,MinLengthValidator:S,MaxLengthValidator:T,PatternValidator:C,EmailValidator:R}),x=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.prototype.onInit=function(){var t=this.validator=R();this.host&&this.host.control.addValidators(t)},e}(e.Directive);x.meta={selector:"[email][formControl],[email][formControlName]",inputs:["email"],hosts:{host:l}};var O=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).maxlength=Number.POSITIVE_INFINITY,e}o(e,t);var n=e.prototype;return n.onInit=function(){this.validator=T(this.maxlength),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(t){this.validator&&(this.validator.params={maxlength:this.maxlength})},e}(e.Directive);O.meta={selector:"[maxlength][formControl],[maxlength][formControlName]",inputs:["maxlength"],hosts:{host:l}};var L=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).max=Number.POSITIVE_INFINITY,e}o(e,t);var n=e.prototype;return n.onInit=function(){this.validator=w(this.max),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(t){this.validator&&(this.validator.params={max:this.max})},e}(e.Directive);L.meta={selector:"[max][formControl],[max][formControlName]",inputs:["max"],hosts:{host:l}};var M=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).minlength=Number.NEGATIVE_INFINITY,e}o(e,t);var n=e.prototype;return n.onInit=function(){this.validator=S(this.minlength),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(t){this.validator&&(this.validator.params={minlength:this.minlength})},e}(e.Directive);M.meta={selector:"[minlength][formControl],[minlength][formControlName]",inputs:["minlength"],hosts:{host:l}};var k=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).min=Number.NEGATIVE_INFINITY,e}o(e,t);var n=e.prototype;return n.onInit=function(){this.validator=E(this.min),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(t){this.validator&&(this.validator.params={min:this.min})},e}(e.Directive);k.meta={selector:"[min][formControl],[min][formControlName]",inputs:["min"],hosts:{host:l}};var N=function(t){function e(){return t.apply(this,arguments)||this}o(e,t);var n=e.prototype;return n.onInit=function(){this.pattern&&(this.validator=C(this.pattern),this.host&&this.host.control.addValidators(this.validator))},n.onChanges=function(t){this.validator&&(this.validator.params={pattern:this.pattern})},e}(e.Directive);N.meta={selector:"[pattern][formControl],[pattern][formControlName]",inputs:["pattern"],hosts:{host:l}};var P=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.prototype.onInit=function(){this.validator=b(),this.host&&this.host.control.addValidators(this.validator)},e}(e.Directive);P.meta={selector:"[requiredTrue][formControl],[requiredTrue][formControlName]",inputs:["requiredTrue"],hosts:{host:l}};var D=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e.prototype.onInit=function(){this.validator=_(),this.host&&this.host.control.addValidators(this.validator)},e}(e.Directive);D.meta={selector:"[required][formControl],[required][formControlName]",inputs:["required"],hosts:{host:l}};var B,U=[c,u,d,h,A,p,f,m,g,x,L,O,k,M,N,D,P],F=[],H=function(t){function e(){return t.apply(this,arguments)||this}return o(e,t),e}(e.Module);H.meta={declarations:[].concat(U,F),exports:[].concat(U,F)},function(t){t.Pending="pending",t.Valid="valid",t.Invalid="invalid",t.Disabled="disabled",t.Hidden="hidden"}(B||(B={}));var V=B,j=function(){function t(t){var e=this;this.value_=void 0,this.submitted_=!1,this.touched_=!1,this.dirty_=!1,this.valueSubject=new n.BehaviorSubject(null),this.statusSubject=new n.BehaviorSubject(null),this.validatorsSubject=(new n.ReplaySubject).pipe(i.switchAll()),this.value$=this.valueSubject.pipe(i.distinctUntilChanged(),i.skip(1),i.tap((function(){e.submitted_=!1,e.dirty_=!0,e.statusSubject.next(null)})),i.shareReplay(1)),this.status$=n.merge(this.statusSubject,this.validatorsSubject).pipe(i.switchMap((function(){return e.validate$(e.value)})),i.shareReplay(1)),this.changes$=n.merge(this.value$,this.status$).pipe(i.map((function(){return e.value})),i.auditTime(1),i.shareReplay(1)),this.validators=t?Array.isArray(t)?t:[t]:[]}var e=t.prototype;return e.initSubjects_=function(){this.switchValidators_()},e.switchValidators_=function(){var t=this.validators.map((function(t){return t.params$})),e=t.length?n.combineLatest(t):n.of(t);this.validatorsSubject.next(e)},e.initObservables_=function(){},e.validate$=function(t){var e=this;return this.status===V.Disabled||this.status===V.Hidden||this.submitted_||!this.validators.length?(this.errors_={},this.status===V.Invalid&&(this.status=V.Valid),n.of(this.errors_)):n.combineLatest(this.validators.map((function(e){var i=e.validate(t);return n.isObservable(i)?i:n.of(i)}))).pipe(i.map((function(t){return e.errors_=Object.assign.apply(Object,[{}].concat(t)),e.status=0===Object.keys(e.errors_).length?V.Valid:V.Invalid,e.errors_})))},e.reset=function(t){this.status=t||V.Pending,this.value_=null,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)},e.patch=function(t){this.value_=t,this.dirty_=!0,this.submitted_=!1,this.statusSubject.next(null)},e.addValidators=function(){var t;(t=this.validators).push.apply(t,arguments),this.switchValidators_()},e.replaceValidators=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.validators=e,this.switchValidators_()},e.clearValidators=function(){this.validators=[],this.switchValidators_()},s(t,[{key:"errors",get:function(){return this.errors_},set:function(t){this.errors_=t}},{key:"pending",get:function(){return this.status===V.Pending}},{key:"valid",get:function(){return this.status!==V.Invalid}},{key:"invalid",get:function(){return this.status===V.Invalid}},{key:"disabled",get:function(){return this.status===V.Disabled},set:function(t){t?this.status!==V.Disabled&&(this.status=V.Disabled,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)):this.status===V.Disabled&&(this.status=V.Pending,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null))}},{key:"enabled",get:function(){return this.status!==V.Disabled}},{key:"hidden",get:function(){return this.status===V.Hidden},set:function(t){t?this.status!==V.Hidden&&(this.status=V.Hidden,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)):this.status===V.Hidden&&(this.status=V.Pending,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null))}},{key:"visible",get:function(){return this.status!==V.Hidden}},{key:"submitted",get:function(){return this.submitted_},set:function(t){this.submitted_=t,this.statusSubject.next(null)}},{key:"dirty",get:function(){return this.dirty_}},{key:"pristine",get:function(){return!this.dirty_}},{key:"touched",get:function(){return this.touched_},set:function(t){this.touched_=t,this.statusSubject.next(null)}},{key:"untouched",get:function(){return!this.touched_}},{key:"flags",get:function(){return{untouched:this.untouched,touched:this.touched,pristine:this.pristine,dirty:this.dirty,pending:this.pending,enabled:this.enabled,disabled:this.disabled,hidden:this.hidden,visible:this.visible,valid:this.valid,invalid:this.invalid,submitted:this.submitted}}},{key:"value",get:function(){return this.value_},set:function(t){this.value_=t,this.valueSubject.next(t)}}]),t}(),G=function(t){function e(e,n){var i;return void 0===e&&(e=null),(i=t.call(this,n)||this).value_=e,i.status=V.Pending,i.errors={},i.initSubjects_(),i.initObservables_(),i.statusSubject.next(null),i}return o(e,t),e}(j),Q=function(t){function e(e,i){var r;return(r=t.call(this,i)||this).changesChildren=new n.BehaviorSubject(void 0),r.controls=e,r.initControls_(),r.initSubjects_(),r.initObservables_(),r}o(e,t);var r=e.prototype;return r.initControl_=function(t,e){var n=t instanceof j?t:new G(t);return n.addValidators.apply(n,this.validators),n.name=e,n},r.initControls_=function(){var t=this;return this.forEach_((function(e,n){t.init(e,n)})),this.controls},r.initSubjects_=function(){this.changesChildren=this.changesChildren.pipe(i.switchAll()),this.switchSubjects_()},r.switchSubjects_=function(){var t=this.reduce_((function(t,e){return t.push(e.changes$),t}),[]),e=t.length?n.combineLatest(t):n.of(t);this.changesChildren.next(e)},r.initObservables_=function(){var t=this;this.changes$=this.changesChildren.pipe(i.map((function(){return t.value})),i.shareReplay(1))},r.validate=function(t){var e;if(this.status===V.Disabled||this.status===V.Hidden)e=[];else{var n=this.validators.map((function(e){return e.validate(t)})).filter((function(t){return null!==t}));e=this.reduce_((function(t,e){return t.concat(e.errors)}),n),this.status=0===e.length?V.Valid:V.Invalid}return e},r.forEach_=function(t){var e=this;Object.keys(this.controls).forEach((function(n){return t(e.controls[n],n)}))},r.reduce_=function(t,e){return this.forEach_((function(n,i){e=t(e,n,i)})),e},r.all_=function(t,e){return this.reduce_((function(n,i){return n&&i[t]===e}),!0)},r.any_=function(t,e){return this.reduce_((function(n,i){return n||i[t]===e}),!1)},r.reset=function(){this.forEach_((function(t){return t.reset()}))},r.patch=function(t){t&&this.forEach_((function(e,n){null!=t[n]&&e.patch(t[n])}))},r.init=function(t,e){this.controls[e]=this.initControl_(t,e)},r.get=function(t){return this.controls[t]},r.set=function(t,e){delete this.controls[e],this.controls[e]=this.initControl_(t,e),this.switchSubjects_()},r.add=function(t,e){this.controls[e]=this.initControl_(t,e),this.switchSubjects_()},r.remove=function(t){var e=this,n=Object.keys(this.controls).find((function(n){return e.controls[n]===t?n:null}));n&&this.removeKey(n)},r.removeKey=function(t){var e=void 0!==this.controls[t];delete this.controls[t],e&&this.switchSubjects_()},r.addValidators=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.forEach_((function(t){return t.addValidators.apply(t,e)}))},r.replaceValidators=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.forEach_((function(t){return t.replaceValidators.apply(t,e)}))},r.clearValidators=function(){this.forEach_((function(t){return t.clearValidators()}))},s(e,[{key:"valid",get:function(){return this.all_("valid",!0)}},{key:"invalid",get:function(){return this.any_("invalid",!0)}},{key:"pending",get:function(){return this.any_("pending",!0)}},{key:"disabled",get:function(){return this.all_("disabled",!0)},set:function(t){this.forEach_((function(e){e.disabled=t}))}},{key:"enabled",get:function(){return this.any_("enabled",!0)}},{key:"hidden",get:function(){return this.all_("hidden",!0)},set:function(t){this.forEach_((function(e){e.hidden=t}))}},{key:"visible",get:function(){return this.any_("visible",!0)}},{key:"submitted",get:function(){return this.all_("submitted",!0)},set:function(t){this.forEach_((function(e){e.submitted=t}))}},{key:"dirty",get:function(){return this.any_("dirty",!0)}},{key:"pristine",get:function(){return this.all_("pristine",!0)}},{key:"touched",get:function(){return this.all_("touched",!0)},set:function(t){this.forEach_((function(e){e.touched=t}))}},{key:"untouched",get:function(){return this.any_("untouched",!0)}},{key:"value",get:function(){return this.reduce_((function(t,e,n){return t[n]=e.value,t}),{})},set:function(t){this.forEach_((function(e,n){e.value=t[n]}))}},{key:"errors",get:function(){return this.reduce_((function(t,e){return Object.assign(t,e.errors)}),{})},set:function(t){}}]),e}(j),z=function(t){function e(e,n){return void 0===e&&(e=[]),t.call(this,e,n)||this}o(e,t);var n=e.prototype;return n.forEach_=function(t){this.controls.forEach((function(e,n){return t(e,n)}))},n.init=function(t,e){this.controls.length=Math.max(this.controls.length,e),this.controls[e]=this.initControl_(t,e)},n.set=function(t,e){this.controls.splice(e,1,this.initControl_(t,e)),this.switchSubjects_()},n.add=function(t,e){this.controls.length=Math.max(this.controls.length,e),this.controls[e]=this.initControl_(t,e),this.switchSubjects_()},n.push=function(t){this.controls.push(this.initControl_(t,this.controls.length)),this.switchSubjects_()},n.insert=function(t,e){this.controls.splice(e,0,this.initControl_(t,e)),this.switchSubjects_()},n.remove=function(t){var e=this.controls.indexOf(t);-1!==e&&this.removeKey(e)},n.removeKey=function(t){this.controls.length>t&&(this.controls.splice(t,1),this.switchSubjects_())},n.at=function(t){return this.controls[t]},s(e,[{key:"value",get:function(){return this.reduce_((function(t,e,n){return t[n]=e.value,t}),[])}},{key:"length",get:function(){return this.controls.length}}]),e}(Q);var W=function(t){function e(e,n){return void 0===e&&(e={}),t.call(this,e,n)||this}return o(e,t),e}(Q);return t.EmailValidator=R,t.FormAbstract=j,t.FormAbstractCollection=Q,t.FormAbstractCollectionDirective=a,t.FormArray=z,t.FormArrayDirective=c,t.FormCheckboxDirective=u,t.FormControl=G,t.FormEmailDirective=x,t.FormFieldComponent=d,t.FormGroup=W,t.FormGroupDirective=h,t.FormInputDirective=A,t.FormMaxDirective=L,t.FormMaxLengthDirective=O,t.FormMinDirective=k,t.FormMinLengthDirective=M,t.FormModule=H,t.FormPatternDirective=N,t.FormPlaceholderDirective=p,t.FormRadioDirective=f,t.FormRequiredDirective=D,t.FormRequiredTrueDirective=P,t.FormSelectDirective=m,t.FormStatus=V,t.FormValidator=v,t.MaxLengthValidator=T,t.MaxValidator=w,t.MinLengthValidator=S,t.MinValidator=E,t.NullValidator=y,t.PatternValidator=C,t.RequiredTrueValidator=b,t.RequiredValidator=_,t.Validators=I,t.formArray=function(t,e){return void 0===t&&(t=[]),new z(t,e)},t.formGroup=function(t,e){return void 0===t&&(t={}),new W(t,e)},t}({},rxcomp,rxjs,rxjs.operators),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).window=t.window||{})}(this,(function(t){
/*!
	 * EasePack 3.12.2
	 * https://greensock.com
	 *
	 * @license Copyright 2008-2023, GreenSock. All rights reserved.
	 * Subject to the terms at https://greensock.com/standard-license or for
	 * Club GreenSock members, the agreement issued with that membership.
	 * @author: Jack Doyle, jack@greensock.com
	*/
var e,n,i=function(){return e||"undefined"!=typeof window&&(e=window.gsap)&&e.registerPlugin&&e},r=function(t,e){return!!(void 0===t?e:t&&!~(t+"").indexOf("false"))},s=function(t){if(e=t||i()){n=e.registerEase;var r,s=e.parseEase(),o=function(t){return function(e){var n=.5+e/2;t.config=function(e){return t(2*(1-e)*e*n+e*e)}}};for(r in s)s[r].config||o(s[r]);for(r in n("slow",u),n("expoScale",d),n("rough",h),A)"version"!==r&&e.core.globals(r,A[r])}},o=function(t,e,n){var i=(t=Math.min(1,t||.7))<1?e||0===e?e:.7:0,s=(1-t)/2,o=s+t,a=r(n);return function(t){var e=t+(.5-t)*i;return t<s?a?1-(t=1-t/s)*t:e-(t=1-t/s)*t*t*t*e:t>o?a?1===t?0:1-(t=(t-o)/s)*t:e+(t-e)*(t=(t-o)/s)*t*t*t:a?1:e}},a=function(t,n,i){var r=Math.log(n/t),s=n-t;return i&&(i=e.parseEase(i)),function(e){return(t*Math.exp(r*(i?i(e):e))-t)/s}},c=function(t,e,n){this.t=t,this.v=e,n&&(this.next=n,n.prev=this,this.c=n.v-e,this.gap=n.t-t)},l=function(t){"object"!=typeof t&&(t={points:+t||20});for(var n,i,s,o,a,l,u,d=t.taper||"none",h=[],A=0,p=0|(+t.points||20),f=p,m=r(t.randomize,!0),g=r(t.clamp),v=e?e.parseEase(t.template):0,y=.4*(+t.strength||1);--f>-1;)n=m?Math.random():1/p*f,i=v?v(n):n,s="none"===d?y:"out"===d?(o=1-n)*o*y:"in"===d?n*n*y:n<.5?(o=2*n)*o*.5*y:(o=2*(1-n))*o*.5*y,m?i+=Math.random()*s-.5*s:f%2?i+=.5*s:i-=.5*s,g&&(i>1?i=1:i<0&&(i=0)),h[A++]={x:n,y:i};for(h.sort((function(t,e){return t.x-e.x})),l=new c(1,1,null),f=p;f--;)a=h[f],l=new c(a.x,a.y,l);return u=new c(0,0,l.t?l:l.next),function(t){var e=u;if(t>e.t){for(;e.next&&t>=e.t;)e=e.next;e=e.prev}else for(;e.prev&&t<=e.t;)e=e.prev;return u=e,e.v+(t-e.t)/e.gap*e.c}},u=o(.7);u.ease=u,u.config=o;var d=a(1,2);d.config=a;var h=l();h.ease=h,h.config=l;var A={SlowMo:u,RoughEase:h,ExpoScaleEase:d};for(var p in A)A[p].register=s,A[p].version="3.12.2";i()&&e.registerPlugin(u),t.EasePack=A,t.ExpoScaleEase=d,t.RoughEase=h,t.SlowMo=u,t.default=A,Object.defineProperty(t,"__esModule",{value:!0})})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).window=t.window||{})}(this,(function(t){function e(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function n(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}
/*!
   * GSAP 3.12.2
   * https://greensock.com
   *
   * @license Copyright 2008-2023, GreenSock. All rights reserved.
   * Subject to the terms at https://greensock.com/standard-license or for
   * Club GreenSock members, the agreement issued with that membership.
   * @author: Jack Doyle, jack@greensock.com
  */var i,r,s,o,a,c,l,u,d,h,A,p,f,m,g,v={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},y={duration:.5,overwrite:!1,delay:0},_=1e8,b=1e-8,E=2*Math.PI,w=E/4,S=0,T=Math.sqrt,C=Math.cos,R=Math.sin,I=function(t){return"string"==typeof t},x=function(t){return"function"==typeof t},O=function(t){return"number"==typeof t},L=function(t){return void 0===t},M=function(t){return"object"==typeof t},k=function(t){return!1!==t},N=function(){return"undefined"!=typeof window},P=function(t){return x(t)||I(t)},D="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},B=Array.isArray,U=/(?:-?\.?\d|\.)+/gi,F=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,H=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,V=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,j=/[+-]=-?[.\d]+/,G=/[^,'"\[\]\s]+/gi,Q=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,z={},W={},K=function(t){return(W=Et(t,z))&&Tn},q=function(t,e){return console.warn("Invalid property",t,"set to",e,"Missing plugin? gsap.registerPlugin()")},Y=function(t,e){return!e&&console.warn(t)},$=function(t,e){return t&&(z[t]=e)&&W&&(W[t]=e)||z},X=function(){return 0},J={suppressEvents:!0,isStart:!0,kill:!1},Z={suppressEvents:!0,kill:!1},tt={suppressEvents:!0},et={},nt=[],it={},rt={},st={},ot=30,at=[],ct="",lt=function(t){var e,n,i=t[0];if(M(i)||x(i)||(t=[t]),!(e=(i._gsap||{}).harness)){for(n=at.length;n--&&!at[n].targetTest(i););e=at[n]}for(n=t.length;n--;)t[n]&&(t[n]._gsap||(t[n]._gsap=new Ue(t[n],e)))||t.splice(n,1);return t},ut=function(t){return t._gsap||lt(ee(t))[0]._gsap},dt=function(t,e,n){return(n=t[e])&&x(n)?t[e]():L(n)&&t.getAttribute&&t.getAttribute(e)||n},ht=function(t,e){return(t=t.split(",")).forEach(e)||t},At=function(t){return Math.round(1e5*t)/1e5||0},pt=function(t){return Math.round(1e7*t)/1e7||0},ft=function(t,e){var n=e.charAt(0),i=parseFloat(e.substr(2));return t=parseFloat(t),"+"===n?t+i:"-"===n?t-i:"*"===n?t*i:t/i},mt=function(t,e){for(var n=e.length,i=0;t.indexOf(e[i])<0&&++i<n;);return i<n},gt=function(){var t,e,n=nt.length,i=nt.slice(0);for(it={},nt.length=0,t=0;t<n;t++)(e=i[t])&&e._lazy&&(e.render(e._lazy[0],e._lazy[1],!0)._lazy=0)},vt=function(t,e,n,i){nt.length&&!r&&gt(),t.render(e,n,i||r&&e<0&&(t._initted||t._startAt)),nt.length&&!r&&gt()},yt=function(t){var e=parseFloat(t);return(e||0===e)&&(t+"").match(G).length<2?e:I(t)?t.trim():t},_t=function(t){return t},bt=function(t,e){for(var n in e)n in t||(t[n]=e[n]);return t},Et=function(t,e){for(var n in e)t[n]=e[n];return t},wt=function t(e,n){for(var i in n)"__proto__"!==i&&"constructor"!==i&&"prototype"!==i&&(e[i]=M(n[i])?t(e[i]||(e[i]={}),n[i]):n[i]);return e},St=function(t,e){var n,i={};for(n in t)n in e||(i[n]=t[n]);return i},Tt=function(t){var e,n=t.parent||o,i=t.keyframes?(e=B(t.keyframes),function(t,n){for(var i in n)i in t||"duration"===i&&e||"ease"===i||(t[i]=n[i])}):bt;if(k(t.inherit))for(;n;)i(t,n.vars.defaults),n=n.parent||n._dp;return t},Ct=function(t,e,n,i,r){void 0===n&&(n="_first"),void 0===i&&(i="_last");var s,o=t[i];if(r)for(s=e[r];o&&o[r]>s;)o=o._prev;return o?(e._next=o._next,o._next=e):(e._next=t[n],t[n]=e),e._next?e._next._prev=e:t[i]=e,e._prev=o,e.parent=e._dp=t,e},Rt=function(t,e,n,i){void 0===n&&(n="_first"),void 0===i&&(i="_last");var r=e._prev,s=e._next;r?r._next=s:t[n]===e&&(t[n]=s),s?s._prev=r:t[i]===e&&(t[i]=r),e._next=e._prev=e.parent=null},It=function(t,e){t.parent&&(!e||t.parent.autoRemoveChildren)&&t.parent.remove&&t.parent.remove(t),t._act=0},xt=function(t,e){if(t&&(!e||e._end>t._dur||e._start<0))for(var n=t;n;)n._dirty=1,n=n.parent;return t},Ot=function(t){for(var e=t.parent;e&&e.parent;)e._dirty=1,e.totalDuration(),e=e.parent;return t},Lt=function(t,e,n,i){return t._startAt&&(r?t._startAt.revert(Z):t.vars.immediateRender&&!t.vars.autoRevert||t._startAt.render(e,!0,i))},Mt=function t(e){return!e||e._ts&&t(e.parent)},kt=function(t){return t._repeat?Nt(t._tTime,t=t.duration()+t._rDelay)*t:0},Nt=function(t,e){var n=Math.floor(t/=e);return t&&n===t?n-1:n},Pt=function(t,e){return(t-e._start)*e._ts+(e._ts>=0?0:e._dirty?e.totalDuration():e._tDur)},Dt=function(t){return t._end=pt(t._start+(t._tDur/Math.abs(t._ts||t._rts||b)||0))},Bt=function(t,e){var n=t._dp;return n&&n.smoothChildTiming&&t._ts&&(t._start=pt(n._time-(t._ts>0?e/t._ts:((t._dirty?t.totalDuration():t._tDur)-e)/-t._ts)),Dt(t),n._dirty||xt(n,t)),t},Ut=function(t,e){var n;if((e._time||!e._dur&&e._initted||e._start<t._time&&(e._dur||!e.add))&&(n=Pt(t.rawTime(),e),(!e._dur||$t(0,e.totalDuration(),n)-e._tTime>b)&&e.render(n,!0)),xt(t,e)._dp&&t._initted&&t._time>=t._dur&&t._ts){if(t._dur<t.duration())for(n=t;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;t._zTime=-1e-8}},Ft=function(t,e,n,i){return e.parent&&It(e),e._start=pt((O(n)?n:n||t!==o?Kt(t,n,e):t._time)+e._delay),e._end=pt(e._start+(e.totalDuration()/Math.abs(e.timeScale())||0)),Ct(t,e,"_first","_last",t._sort?"_start":0),Gt(e)||(t._recent=e),i||Ut(t,e),t._ts<0&&Bt(t,t._tTime),t},Ht=function(t,e){return(z.ScrollTrigger||q("scrollTrigger",e))&&z.ScrollTrigger.create(e,t)},Vt=function(t,e,n,i,s){return We(t,e,s),t._initted?!n&&t._pt&&!r&&(t._dur&&!1!==t.vars.lazy||!t._dur&&t.vars.lazy)&&d!==Te.frame?(nt.push(t),t._lazy=[s,i],1):void 0:1},jt=function t(e){var n=e.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||t(n))},Gt=function(t){var e=t.data;return"isFromStart"===e||"isStart"===e},Qt=function(t,e,n,i){var r=t._repeat,s=pt(e)||0,o=t._tTime/t._tDur;return o&&!i&&(t._time*=s/t._dur),t._dur=s,t._tDur=r?r<0?1e10:pt(s*(r+1)+t._rDelay*r):s,o>0&&!i&&Bt(t,t._tTime=t._tDur*o),t.parent&&Dt(t),n||xt(t.parent,t),t},zt=function(t){return t instanceof He?xt(t):Qt(t,t._dur)},Wt={_start:0,endTime:X,totalDuration:X},Kt=function t(e,n,i){var r,s,o,a=e.labels,c=e._recent||Wt,l=e.duration()>=_?c.endTime(!1):e._dur;return I(n)&&(isNaN(n)||n in a)?(s=n.charAt(0),o="%"===n.substr(-1),r=n.indexOf("="),"<"===s||">"===s?(r>=0&&(n=n.replace(/=/,"")),("<"===s?c._start:c.endTime(c._repeat>=0))+(parseFloat(n.substr(1))||0)*(o?(r<0?c:i).totalDuration()/100:1)):r<0?(n in a||(a[n]=l),a[n]):(s=parseFloat(n.charAt(r-1)+n.substr(r+1)),o&&i&&(s=s/100*(B(i)?i[0]:i).totalDuration()),r>1?t(e,n.substr(0,r-1),i)+s:l+s)):null==n?l:+n},qt=function(t,e,n){var i,r,s=O(e[1]),o=(s?2:1)+(t<2?0:1),a=e[o];if(s&&(a.duration=e[1]),a.parent=n,t){for(i=a,r=n;r&&!("immediateRender"in i);)i=r.vars.defaults||{},r=k(r.vars.inherit)&&r.parent;a.immediateRender=k(i.immediateRender),t<2?a.runBackwards=1:a.startAt=e[o-1]}return new Xe(e[0],a,e[o+1])},Yt=function(t,e){return t||0===t?e(t):e},$t=function(t,e,n){return n<t?t:n>e?e:n},Xt=function(t,e){return I(t)&&(e=Q.exec(t))?e[1]:""},Jt=[].slice,Zt=function(t,e){return t&&M(t)&&"length"in t&&(!e&&!t.length||t.length-1 in t&&M(t[0]))&&!t.nodeType&&t!==a},te=function(t,e,n){return void 0===n&&(n=[]),t.forEach((function(t){var i;return I(t)&&!e||Zt(t,1)?(i=n).push.apply(i,ee(t)):n.push(t)}))||n},ee=function(t,e,n){return s&&!e&&s.selector?s.selector(t):!I(t)||n||!c&&Ce()?B(t)?te(t,n):Zt(t)?Jt.call(t,0):t?[t]:[]:Jt.call((e||l).querySelectorAll(t),0)},ne=function(t){return t=ee(t)[0]||Y("Invalid scope")||{},function(e){var n=t.current||t.nativeElement||t;return ee(e,n.querySelectorAll?n:n===t?Y("Invalid scope")||l.createElement("div"):t)}},ie=function(t){return t.sort((function(){return.5-Math.random()}))},re=function(t){if(x(t))return t;var e=M(t)?t:{each:t},n=ke(e.ease),i=e.from||0,r=parseFloat(e.base)||0,s={},o=i>0&&i<1,a=isNaN(i)||o,c=e.axis,l=i,u=i;return I(i)?l=u={center:.5,edges:.5,end:1}[i]||0:!o&&a&&(l=i[0],u=i[1]),function(t,o,d){var h,A,p,f,m,g,v,y,b,E=(d||e).length,w=s[E];if(!w){if(!(b="auto"===e.grid?0:(e.grid||[1,_])[1])){for(v=-_;v<(v=d[b++].getBoundingClientRect().left)&&b<E;);b--}for(w=s[E]=[],h=a?Math.min(b,E)*l-.5:i%b,A=b===_?0:a?E*u/b-.5:i/b|0,v=0,y=_,g=0;g<E;g++)p=g%b-h,f=A-(g/b|0),w[g]=m=c?Math.abs("y"===c?f:p):T(p*p+f*f),m>v&&(v=m),m<y&&(y=m);"random"===i&&ie(w),w.max=v-y,w.min=y,w.v=E=(parseFloat(e.amount)||parseFloat(e.each)*(b>E?E-1:c?"y"===c?E/b:b:Math.max(b,E/b))||0)*("edges"===i?-1:1),w.b=E<0?r-E:r,w.u=Xt(e.amount||e.each)||0,n=n&&E<0?Le(n):n}return E=(w[t]-w.min)/w.max||0,pt(w.b+(n?n(E):E)*w.v)+w.u}},se=function(t){var e=Math.pow(10,((t+"").split(".")[1]||"").length);return function(n){var i=pt(Math.round(parseFloat(n)/t)*t*e);return(i-i%1)/e+(O(n)?0:Xt(n))}},oe=function(t,e){var n,i,r=B(t);return!r&&M(t)&&(n=r=t.radius||_,t.values?(t=ee(t.values),(i=!O(t[0]))&&(n*=n)):t=se(t.increment)),Yt(e,r?x(t)?function(e){return i=t(e),Math.abs(i-e)<=n?i:e}:function(e){for(var r,s,o=parseFloat(i?e.x:e),a=parseFloat(i?e.y:0),c=_,l=0,u=t.length;u--;)(r=i?(r=t[u].x-o)*r+(s=t[u].y-a)*s:Math.abs(t[u]-o))<c&&(c=r,l=u);return l=!n||c<=n?t[l]:e,i||l===e||O(e)?l:l+Xt(e)}:se(t))},ae=function(t,e,n,i){return Yt(B(t)?!e:!0===n?!!(n=0):!i,(function(){return B(t)?t[~~(Math.random()*t.length)]:(n=n||1e-5)&&(i=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((t-n/2+Math.random()*(e-t+.99*n))/n)*n*i)/i}))},ce=function(t,e,n){return Yt(n,(function(n){return t[~~e(n)]}))},le=function(t){for(var e,n,i,r,s=0,o="";~(e=t.indexOf("random(",s));)i=t.indexOf(")",e),r="["===t.charAt(e+7),n=t.substr(e+7,i-e-7).match(r?G:U),o+=t.substr(s,e-s)+ae(r?n:+n[0],r?0:+n[1],+n[2]||1e-5),s=i+1;return o+t.substr(s,t.length-s)},ue=function(t,e,n,i,r){var s=e-t,o=i-n;return Yt(r,(function(e){return n+((e-t)/s*o||0)}))},de=function(t,e,n){var i,r,s,o=t.labels,a=_;for(i in o)(r=o[i]-e)<0==!!n&&r&&a>(r=Math.abs(r))&&(s=i,a=r);return s},he=function(t,e,n){var i,r,o,a=t.vars,c=a[e],l=s,u=t._ctx;if(c)return i=a[e+"Params"],r=a.callbackScope||t,n&&nt.length&&gt(),u&&(s=u),o=i?c.apply(r,i):c.call(r),s=l,o},Ae=function(t){return It(t),t.scrollTrigger&&t.scrollTrigger.kill(!!r),t.progress()<1&&he(t,"onInterrupt"),t},pe=[],fe=function(t){if(N()&&t){var e=(t=!t.name&&t.default||t).name,n=x(t),i=e&&!n&&t.init?function(){this._props=[]}:t,r={init:X,render:an,add:Qe,kill:ln,modifier:cn,rawVars:0},s={targetTest:0,get:0,getSetter:nn,aliases:{},register:0};if(Ce(),t!==i){if(rt[e])return;bt(i,bt(St(t,r),s)),Et(i.prototype,Et(r,St(t,s))),rt[i.prop=e]=i,t.targetTest&&(at.push(i),et[e]=1),e=("css"===e?"CSS":e.charAt(0).toUpperCase()+e.substr(1))+"Plugin"}$(e,i),t.register&&t.register(Tn,i,hn)}else t&&pe.push(t)},me=255,ge={aqua:[0,me,me],lime:[0,me,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,me],navy:[0,0,128],white:[me,me,me],olive:[128,128,0],yellow:[me,me,0],orange:[me,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[me,0,0],pink:[me,192,203],cyan:[0,me,me],transparent:[me,me,me,0]},ve=function(t,e,n){return(6*(t+=t<0?1:t>1?-1:0)<1?e+(n-e)*t*6:t<.5?n:3*t<2?e+(n-e)*(2/3-t)*6:e)*me+.5|0},ye=function(t,e,n){var i,r,s,o,a,c,l,u,d,h,A=t?O(t)?[t>>16,t>>8&me,t&me]:0:ge.black;if(!A){if(","===t.substr(-1)&&(t=t.substr(0,t.length-1)),ge[t])A=ge[t];else if("#"===t.charAt(0)){if(t.length<6&&(i=t.charAt(1),r=t.charAt(2),s=t.charAt(3),t="#"+i+i+r+r+s+s+(5===t.length?t.charAt(4)+t.charAt(4):"")),9===t.length)return[(A=parseInt(t.substr(1,6),16))>>16,A>>8&me,A&me,parseInt(t.substr(7),16)/255];A=[(t=parseInt(t.substr(1),16))>>16,t>>8&me,t&me]}else if("hsl"===t.substr(0,3))if(A=h=t.match(U),e){if(~t.indexOf("="))return A=t.match(F),n&&A.length<4&&(A[3]=1),A}else o=+A[0]%360/360,a=+A[1]/100,i=2*(c=+A[2]/100)-(r=c<=.5?c*(a+1):c+a-c*a),A.length>3&&(A[3]*=1),A[0]=ve(o+1/3,i,r),A[1]=ve(o,i,r),A[2]=ve(o-1/3,i,r);else A=t.match(U)||ge.transparent;A=A.map(Number)}return e&&!h&&(i=A[0]/me,r=A[1]/me,s=A[2]/me,c=((l=Math.max(i,r,s))+(u=Math.min(i,r,s)))/2,l===u?o=a=0:(d=l-u,a=c>.5?d/(2-l-u):d/(l+u),o=l===i?(r-s)/d+(r<s?6:0):l===r?(s-i)/d+2:(i-r)/d+4,o*=60),A[0]=~~(o+.5),A[1]=~~(100*a+.5),A[2]=~~(100*c+.5)),n&&A.length<4&&(A[3]=1),A},_e=function(t){var e=[],n=[],i=-1;return t.split(Ee).forEach((function(t){var r=t.match(H)||[];e.push.apply(e,r),n.push(i+=r.length+1)})),e.c=n,e},be=function(t,e,n){var i,r,s,o,a="",c=(t+a).match(Ee),l=e?"hsla(":"rgba(",u=0;if(!c)return t;if(c=c.map((function(t){return(t=ye(t,e,1))&&l+(e?t[0]+","+t[1]+"%,"+t[2]+"%,"+t[3]:t.join(","))+")"})),n&&(s=_e(t),(i=n.c).join(a)!==s.c.join(a)))for(o=(r=t.replace(Ee,"1").split(H)).length-1;u<o;u++)a+=r[u]+(~i.indexOf(u)?c.shift()||l+"0,0,0,0)":(s.length?s:c.length?c:n).shift());if(!r)for(o=(r=t.split(Ee)).length-1;u<o;u++)a+=r[u]+c[u];return a+r[o]},Ee=function(){var t,e="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(t in ge)e+="|"+t+"\\b";return new RegExp(e+")","gi")}(),we=/hsl[a]?\(/,Se=function(t){var e,n=t.join(" ");if(Ee.lastIndex=0,Ee.test(n))return e=we.test(n),t[1]=be(t[1],e),t[0]=be(t[0],e,_e(t[1])),!0},Te=function(){var t,e,n,i,r,s,o=Date.now,d=500,h=33,p=o(),f=p,m=1e3/240,g=m,v=[],y=function n(a){var c,l,u,A,y=o()-f,_=!0===a;if(y>d&&(p+=y-h),((c=(u=(f+=y)-p)-g)>0||_)&&(A=++i.frame,r=u-1e3*i.time,i.time=u/=1e3,g+=c+(c>=m?4:m-c),l=1),_||(t=e(n)),l)for(s=0;s<v.length;s++)v[s](u,r,A,a)};return i={time:0,frame:0,tick:function(){y(!0)},deltaRatio:function(t){return r/(1e3/(t||60))},wake:function(){u&&(!c&&N()&&(a=c=window,l=a.document||{},z.gsap=Tn,(a.gsapVersions||(a.gsapVersions=[])).push(Tn.version),K(W||a.GreenSockGlobals||!a.gsap&&a||{}),n=a.requestAnimationFrame,pe.forEach(fe)),t&&i.sleep(),e=n||function(t){return setTimeout(t,g-1e3*i.time+1|0)},A=1,y(2))},sleep:function(){(n?a.cancelAnimationFrame:clearTimeout)(t),A=0,e=X},lagSmoothing:function(t,e){d=t||1/0,h=Math.min(e||33,d)},fps:function(t){m=1e3/(t||240),g=1e3*i.time+m},add:function(t,e,n){var r=e?function(e,n,s,o){t(e,n,s,o),i.remove(r)}:t;return i.remove(t),v[n?"unshift":"push"](r),Ce(),r},remove:function(t,e){~(e=v.indexOf(t))&&v.splice(e,1)&&s>=e&&s--},_listeners:v}}(),Ce=function(){return!A&&Te.wake()},Re={},Ie=/^[\d.\-M][\d.\-,\s]/,xe=/["']/g,Oe=function(t){for(var e,n,i,r={},s=t.substr(1,t.length-3).split(":"),o=s[0],a=1,c=s.length;a<c;a++)n=s[a],e=a!==c-1?n.lastIndexOf(","):n.length,i=n.substr(0,e),r[o]=isNaN(i)?i.replace(xe,"").trim():+i,o=n.substr(e+1).trim();return r},Le=function(t){return function(e){return 1-t(1-e)}},Me=function t(e,n){for(var i,r=e._first;r;)r instanceof He?t(r,n):!r.vars.yoyoEase||r._yoyo&&r._repeat||r._yoyo===n||(r.timeline?t(r.timeline,n):(i=r._ease,r._ease=r._yEase,r._yEase=i,r._yoyo=n)),r=r._next},ke=function(t,e){return t&&(x(t)?t:Re[t]||function(t){var e,n,i,r,s=(t+"").split("("),o=Re[s[0]];return o&&s.length>1&&o.config?o.config.apply(null,~t.indexOf("{")?[Oe(s[1])]:(e=t,n=e.indexOf("(")+1,i=e.indexOf(")"),r=e.indexOf("(",n),e.substring(n,~r&&r<i?e.indexOf(")",i+1):i)).split(",").map(yt)):Re._CE&&Ie.test(t)?Re._CE("",t):o}(t))||e},Ne=function(t,e,n,i){void 0===n&&(n=function(t){return 1-e(1-t)}),void 0===i&&(i=function(t){return t<.5?e(2*t)/2:1-e(2*(1-t))/2});var r,s={easeIn:e,easeOut:n,easeInOut:i};return ht(t,(function(t){for(var e in Re[t]=z[t]=s,Re[r=t.toLowerCase()]=n,s)Re[r+("easeIn"===e?".in":"easeOut"===e?".out":".inOut")]=Re[t+"."+e]=s[e]})),s},Pe=function(t){return function(e){return e<.5?(1-t(1-2*e))/2:.5+t(2*(e-.5))/2}},De=function t(e,n,i){var r=n>=1?n:1,s=(i||(e?.3:.45))/(n<1?n:1),o=s/E*(Math.asin(1/r)||0),a=function(t){return 1===t?1:r*Math.pow(2,-10*t)*R((t-o)*s)+1},c="out"===e?a:"in"===e?function(t){return 1-a(1-t)}:Pe(a);return s=E/s,c.config=function(n,i){return t(e,n,i)},c},Be=function t(e,n){void 0===n&&(n=1.70158);var i=function(t){return t?--t*t*((n+1)*t+n)+1:0},r="out"===e?i:"in"===e?function(t){return 1-i(1-t)}:Pe(i);return r.config=function(n){return t(e,n)},r};ht("Linear,Quad,Cubic,Quart,Quint,Strong",(function(t,e){var n=e<5?e+1:e;Ne(t+",Power"+(n-1),e?function(t){return Math.pow(t,n)}:function(t){return t},(function(t){return 1-Math.pow(1-t,n)}),(function(t){return t<.5?Math.pow(2*t,n)/2:1-Math.pow(2*(1-t),n)/2}))})),Re.Linear.easeNone=Re.none=Re.Linear.easeIn,Ne("Elastic",De("in"),De("out"),De()),p=7.5625,m=1/(f=2.75),Ne("Bounce",(function(t){return 1-g(1-t)}),g=function(t){return t<m?p*t*t:t<.7272727272727273?p*Math.pow(t-1.5/f,2)+.75:t<.9090909090909092?p*(t-=2.25/f)*t+.9375:p*Math.pow(t-2.625/f,2)+.984375}),Ne("Expo",(function(t){return t?Math.pow(2,10*(t-1)):0})),Ne("Circ",(function(t){return-(T(1-t*t)-1)})),Ne("Sine",(function(t){return 1===t?1:1-C(t*w)})),Ne("Back",Be("in"),Be("out"),Be()),Re.SteppedEase=Re.steps=z.SteppedEase={config:function(t,e){void 0===t&&(t=1);var n=1/t,i=t+(e?0:1),r=e?1:0;return function(t){return((i*$t(0,.99999999,t)|0)+r)*n}}},y.ease=Re["quad.out"],ht("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(t){return ct+=t+","+t+"Params,"}));var Ue=function(t,e){this.id=S++,t._gsap=this,this.target=t,this.harness=e,this.get=e?e.get:dt,this.set=e?e.getSetter:nn},Fe=function(){function t(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,Qt(this,+t.duration,1,1),this.data=t.data,s&&(this._ctx=s,s.data.push(this)),A||Te.wake()}var e=t.prototype;return e.delay=function(t){return t||0===t?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+t-this._delay),this._delay=t,this):this._delay},e.duration=function(t){return arguments.length?this.totalDuration(this._repeat>0?t+(t+this._rDelay)*this._repeat:t):this.totalDuration()&&this._dur},e.totalDuration=function(t){return arguments.length?(this._dirty=0,Qt(this,this._repeat<0?t:(t-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(t,e){if(Ce(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Bt(this,t),!n._dp||n.parent||Ut(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&t<this._tDur||this._ts<0&&t>0||!this._tDur&&!t)&&Ft(this._dp,this,this._start-this._delay)}return(this._tTime!==t||!this._dur&&!e||this._initted&&Math.abs(this._zTime)===b||!t&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=t),vt(this,t,e)),this},e.time=function(t,e){return arguments.length?this.totalTime(Math.min(this.totalDuration(),t+kt(this))%(this._dur+this._rDelay)||(t?this._dur:0),e):this._time},e.totalProgress=function(t,e){return arguments.length?this.totalTime(this.totalDuration()*t,e):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},e.progress=function(t,e){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?t:1-t)+kt(this),e):this.duration()?Math.min(1,this._time/this._dur):this.ratio},e.iteration=function(t,e){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(t-1)*n,e):this._repeat?Nt(this._tTime,n)+1:1},e.timeScale=function(t){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===t)return this;var e=this.parent&&this._ts?Pt(this.parent._time,this):this._tTime;return this._rts=+t||0,this._ts=this._ps||-1e-8===t?0:this._rts,this.totalTime($t(-Math.abs(this._delay),this._tDur,e),!0),Dt(this),Ot(this)},e.paused=function(t){return arguments.length?(this._ps!==t&&(this._ps=t,t?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Ce(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==b&&(this._tTime-=b)))),this):this._ps},e.startTime=function(t){if(arguments.length){this._start=t;var e=this.parent||this._dp;return e&&(e._sort||!this.parent)&&Ft(e,this,t-this._delay),this}return this._start},e.endTime=function(t){return this._start+(k(t)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(t){var e=this.parent||this._dp;return e?t&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Pt(e.rawTime(t),this):this._tTime:this._tTime},e.revert=function(t){void 0===t&&(t=tt);var e=r;return r=t,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(t),this.totalTime(-.01,t.suppressEvents)),"nested"!==this.data&&!1!==t.kill&&this.kill(),r=e,this},e.globalTime=function(t){for(var e=this,n=arguments.length?t:e.rawTime();e;)n=e._start+n/(e._ts||1),e=e._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1/0:this._sat.globalTime(t):n},e.repeat=function(t){return arguments.length?(this._repeat=t===1/0?-2:t,zt(this)):-2===this._repeat?1/0:this._repeat},e.repeatDelay=function(t){if(arguments.length){var e=this._time;return this._rDelay=t,zt(this),e?this.time(e):this}return this._rDelay},e.yoyo=function(t){return arguments.length?(this._yoyo=t,this):this._yoyo},e.seek=function(t,e){return this.totalTime(Kt(this,t),k(e))},e.restart=function(t,e){return this.play().totalTime(t?-this._delay:0,k(e))},e.play=function(t,e){return null!=t&&this.seek(t,e),this.reversed(!1).paused(!1)},e.reverse=function(t,e){return null!=t&&this.seek(t||this.totalDuration(),e),this.reversed(!0).paused(!1)},e.pause=function(t,e){return null!=t&&this.seek(t,e),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(t){return arguments.length?(!!t!==this.reversed()&&this.timeScale(-this._rts||(t?-1e-8:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},e.isActive=function(){var t,e=this.parent||this._dp,n=this._start;return!(e&&!(this._ts&&this._initted&&e.isActive()&&(t=e.rawTime(!0))>=n&&t<this.endTime(!0)-b))},e.eventCallback=function(t,e,n){var i=this.vars;return arguments.length>1?(e?(i[t]=e,n&&(i[t+"Params"]=n),"onUpdate"===t&&(this._onUpdate=e)):delete i[t],this):i[t]},e.then=function(t){var e=this;return new Promise((function(n){var i=x(t)?t:_t,r=function(){var t=e.then;e.then=null,x(i)&&(i=i(e))&&(i.then||i===e)&&(e.then=t),n(i),e.then=t};e._initted&&1===e.totalProgress()&&e._ts>=0||!e._tTime&&e._ts<0?r():e._prom=r}))},e.kill=function(){Ae(this)},t}();bt(Fe.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var He=function(t){function i(e,i){var r;return void 0===e&&(e={}),(r=t.call(this,e)||this).labels={},r.smoothChildTiming=!!e.smoothChildTiming,r.autoRemoveChildren=!!e.autoRemoveChildren,r._sort=k(e.sortChildren),o&&Ft(e.parent||o,n(r),i),e.reversed&&r.reverse(),e.paused&&r.paused(!0),e.scrollTrigger&&Ht(n(r),e.scrollTrigger),r}e(i,t);var s=i.prototype;return s.to=function(t,e,n){return qt(0,arguments,this),this},s.from=function(t,e,n){return qt(1,arguments,this),this},s.fromTo=function(t,e,n,i){return qt(2,arguments,this),this},s.set=function(t,e,n){return e.duration=0,e.parent=this,Tt(e).repeatDelay||(e.repeat=0),e.immediateRender=!!e.immediateRender,new Xe(t,e,Kt(this,n),1),this},s.call=function(t,e,n){return Ft(this,Xe.delayedCall(0,t,e),n)},s.staggerTo=function(t,e,n,i,r,s,o){return n.duration=e,n.stagger=n.stagger||i,n.onComplete=s,n.onCompleteParams=o,n.parent=this,new Xe(t,n,Kt(this,r)),this},s.staggerFrom=function(t,e,n,i,r,s,o){return n.runBackwards=1,Tt(n).immediateRender=k(n.immediateRender),this.staggerTo(t,e,n,i,r,s,o)},s.staggerFromTo=function(t,e,n,i,r,s,o,a){return i.startAt=n,Tt(i).immediateRender=k(i.immediateRender),this.staggerTo(t,e,i,r,s,o,a)},s.render=function(t,e,n){var i,s,a,c,l,u,d,h,A,p,f,m,g=this._time,v=this._dirty?this.totalDuration():this._tDur,y=this._dur,_=t<=0?0:pt(t),E=this._zTime<0!=t<0&&(this._initted||!y);if(this!==o&&_>v&&t>=0&&(_=v),_!==this._tTime||n||E){if(g!==this._time&&y&&(_+=this._time-g,t+=this._time-g),i=_,A=this._start,u=!(h=this._ts),E&&(y||(g=this._zTime),(t||!e)&&(this._zTime=t)),this._repeat){if(f=this._yoyo,l=y+this._rDelay,this._repeat<-1&&t<0)return this.totalTime(100*l+t,e,n);if(i=pt(_%l),_===v?(c=this._repeat,i=y):((c=~~(_/l))&&c===_/l&&(i=y,c--),i>y&&(i=y)),p=Nt(this._tTime,l),!g&&this._tTime&&p!==c&&this._tTime-p*l-this._dur<=0&&(p=c),f&&1&c&&(i=y-i,m=1),c!==p&&!this._lock){var w=f&&1&p,S=w===(f&&1&c);if(c<p&&(w=!w),g=w?0:_%y?y:_,this._lock=1,this.render(g||(m?0:pt(c*l)),e,!y)._lock=0,this._tTime=_,!e&&this.parent&&he(this,"onRepeat"),this.vars.repeatRefresh&&!m&&(this.invalidate()._lock=1),g&&g!==this._time||u!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(y=this._dur,v=this._tDur,S&&(this._lock=2,g=w?y:-1e-4,this.render(g,!0),this.vars.repeatRefresh&&!m&&this.invalidate()),this._lock=0,!this._ts&&!u)return this;Me(this,m)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(d=function(t,e,n){var i;if(n>e)for(i=t._first;i&&i._start<=n;){if("isPause"===i.data&&i._start>e)return i;i=i._next}else for(i=t._last;i&&i._start>=n;){if("isPause"===i.data&&i._start<e)return i;i=i._prev}}(this,pt(g),pt(i)),d&&(_-=i-(i=d._start))),this._tTime=_,this._time=i,this._act=!h,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=t,g=0),!g&&i&&!e&&!c&&(he(this,"onStart"),this._tTime!==_))return this;if(i>=g&&t>=0)for(s=this._first;s;){if(a=s._next,(s._act||i>=s._start)&&s._ts&&d!==s){if(s.parent!==this)return this.render(t,e,n);if(s.render(s._ts>0?(i-s._start)*s._ts:(s._dirty?s.totalDuration():s._tDur)+(i-s._start)*s._ts,e,n),i!==this._time||!this._ts&&!u){d=0,a&&(_+=this._zTime=-1e-8);break}}s=a}else{s=this._last;for(var T=t<0?t:i;s;){if(a=s._prev,(s._act||T<=s._end)&&s._ts&&d!==s){if(s.parent!==this)return this.render(t,e,n);if(s.render(s._ts>0?(T-s._start)*s._ts:(s._dirty?s.totalDuration():s._tDur)+(T-s._start)*s._ts,e,n||r&&(s._initted||s._startAt)),i!==this._time||!this._ts&&!u){d=0,a&&(_+=this._zTime=T?-1e-8:b);break}}s=a}}if(d&&!e&&(this.pause(),d.render(i>=g?0:-1e-8)._zTime=i>=g?1:-1,this._ts))return this._start=A,Dt(this),this.render(t,e,n);this._onUpdate&&!e&&he(this,"onUpdate",!0),(_===v&&this._tTime>=this.totalDuration()||!_&&g)&&(A!==this._start&&Math.abs(h)===Math.abs(this._ts)||this._lock||((t||!y)&&(_===v&&this._ts>0||!_&&this._ts<0)&&It(this,1),e||t<0&&!g||!_&&!g&&v||(he(this,_===v&&t>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(_<v&&this.timeScale()>0)&&this._prom())))}return this},s.add=function(t,e){var n=this;if(O(e)||(e=Kt(this,e,t)),!(t instanceof Fe)){if(B(t))return t.forEach((function(t){return n.add(t,e)})),this;if(I(t))return this.addLabel(t,e);if(!x(t))return this;t=Xe.delayedCall(0,t)}return this!==t?Ft(this,t,e):this},s.getChildren=function(t,e,n,i){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=!0),void 0===i&&(i=-_);for(var r=[],s=this._first;s;)s._start>=i&&(s instanceof Xe?e&&r.push(s):(n&&r.push(s),t&&r.push.apply(r,s.getChildren(!0,e,n)))),s=s._next;return r},s.getById=function(t){for(var e=this.getChildren(1,1,1),n=e.length;n--;)if(e[n].vars.id===t)return e[n]},s.remove=function(t){return I(t)?this.removeLabel(t):x(t)?this.killTweensOf(t):(Rt(this,t),t===this._recent&&(this._recent=this._last),xt(this))},s.totalTime=function(e,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=pt(Te.time-(this._ts>0?e/this._ts:(this.totalDuration()-e)/-this._ts))),t.prototype.totalTime.call(this,e,n),this._forcing=0,this):this._tTime},s.addLabel=function(t,e){return this.labels[t]=Kt(this,e),this},s.removeLabel=function(t){return delete this.labels[t],this},s.addPause=function(t,e,n){var i=Xe.delayedCall(0,e||X,n);return i.data="isPause",this._hasPause=1,Ft(this,i,Kt(this,t))},s.removePause=function(t){var e=this._first;for(t=Kt(this,t);e;)e._start===t&&"isPause"===e.data&&It(e),e=e._next},s.killTweensOf=function(t,e,n){for(var i=this.getTweensOf(t,n),r=i.length;r--;)Ve!==i[r]&&i[r].kill(t,e);return this},s.getTweensOf=function(t,e){for(var n,i=[],r=ee(t),s=this._first,o=O(e);s;)s instanceof Xe?mt(s._targets,r)&&(o?(!Ve||s._initted&&s._ts)&&s.globalTime(0)<=e&&s.globalTime(s.totalDuration())>e:!e||s.isActive())&&i.push(s):(n=s.getTweensOf(r,e)).length&&i.push.apply(i,n),s=s._next;return i},s.tweenTo=function(t,e){e=e||{};var n,i=this,r=Kt(i,t),s=e,o=s.startAt,a=s.onStart,c=s.onStartParams,l=s.immediateRender,u=Xe.to(i,bt({ease:e.ease||"none",lazy:!1,immediateRender:!1,time:r,overwrite:"auto",duration:e.duration||Math.abs((r-(o&&"time"in o?o.time:i._time))/i.timeScale())||b,onStart:function(){if(i.pause(),!n){var t=e.duration||Math.abs((r-(o&&"time"in o?o.time:i._time))/i.timeScale());u._dur!==t&&Qt(u,t,0,1).render(u._time,!0,!0),n=1}a&&a.apply(u,c||[])}},e));return l?u.render(0):u},s.tweenFromTo=function(t,e,n){return this.tweenTo(e,bt({startAt:{time:Kt(this,t)}},n))},s.recent=function(){return this._recent},s.nextLabel=function(t){return void 0===t&&(t=this._time),de(this,Kt(this,t))},s.previousLabel=function(t){return void 0===t&&(t=this._time),de(this,Kt(this,t),1)},s.currentLabel=function(t){return arguments.length?this.seek(t,!0):this.previousLabel(this._time+b)},s.shiftChildren=function(t,e,n){void 0===n&&(n=0);for(var i,r=this._first,s=this.labels;r;)r._start>=n&&(r._start+=t,r._end+=t),r=r._next;if(e)for(i in s)s[i]>=n&&(s[i]+=t);return xt(this)},s.invalidate=function(e){var n=this._first;for(this._lock=0;n;)n.invalidate(e),n=n._next;return t.prototype.invalidate.call(this,e)},s.clear=function(t){void 0===t&&(t=!0);for(var e,n=this._first;n;)e=n._next,this.remove(n),n=e;return this._dp&&(this._time=this._tTime=this._pTime=0),t&&(this.labels={}),xt(this)},s.totalDuration=function(t){var e,n,i,r=0,s=this,a=s._last,c=_;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-t:t));if(s._dirty){for(i=s.parent;a;)e=a._prev,a._dirty&&a.totalDuration(),(n=a._start)>c&&s._sort&&a._ts&&!s._lock?(s._lock=1,Ft(s,a,n-a._delay,1)._lock=0):c=n,n<0&&a._ts&&(r-=n,(!i&&!s._dp||i&&i.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-Infinity),c=0),a._end>r&&a._ts&&(r=a._end),a=e;Qt(s,s===o&&s._time>r?s._time:r,1,1),s._dirty=0}return s._tDur},i.updateRoot=function(t){if(o._ts&&(vt(o,Pt(t,o)),d=Te.frame),Te.frame>=ot){ot+=v.autoSleep||120;var e=o._first;if((!e||!e._ts)&&v.autoSleep&&Te._listeners.length<2){for(;e&&!e._ts;)e=e._next;e||Te.sleep()}}},i}(Fe);bt(He.prototype,{_lock:0,_hasPause:0,_forcing:0});var Ve,je,Ge=function(t,e,n,i,r,s,o){var a,c,l,u,d,h,A,p,f=new hn(this._pt,t,e,0,1,on,null,r),m=0,g=0;for(f.b=n,f.e=i,n+="",(A=~(i+="").indexOf("random("))&&(i=le(i)),s&&(s(p=[n,i],t,e),n=p[0],i=p[1]),c=n.match(V)||[];a=V.exec(i);)u=a[0],d=i.substring(m,a.index),l?l=(l+1)%5:"rgba("===d.substr(-5)&&(l=1),u!==c[g++]&&(h=parseFloat(c[g-1])||0,f._pt={_next:f._pt,p:d||1===g?d:",",s:h,c:"="===u.charAt(1)?ft(h,u)-h:parseFloat(u)-h,m:l&&l<4?Math.round:0},m=V.lastIndex);return f.c=m<i.length?i.substring(m,i.length):"",f.fp=o,(j.test(i)||A)&&(f.e=0),this._pt=f,f},Qe=function(t,e,n,i,r,s,o,a,c,l){x(i)&&(i=i(r||0,t,s));var u,d=t[e],h="get"!==n?n:x(d)?c?t[e.indexOf("set")||!x(t["get"+e.substr(3)])?e:"get"+e.substr(3)](c):t[e]():d,A=x(d)?c?tn:Ze:Je;if(I(i)&&(~i.indexOf("random(")&&(i=le(i)),"="===i.charAt(1)&&((u=ft(h,i)+(Xt(h)||0))||0===u)&&(i=u)),!l||h!==i||je)return isNaN(h*i)||""===i?(!d&&!(e in t)&&q(e,i),Ge.call(this,t,e,h,i,A,a||v.stringFilter,c)):(u=new hn(this._pt,t,e,+h||0,i-(h||0),"boolean"==typeof d?sn:rn,0,A),c&&(u.fp=c),o&&u.modifier(o,this,t),this._pt=u)},ze=function(t,e,n,i,r,s){var o,a,c,l;if(rt[t]&&!1!==(o=new rt[t]).init(r,o.rawVars?e[t]:function(t,e,n,i,r){if(x(t)&&(t=qe(t,r,e,n,i)),!M(t)||t.style&&t.nodeType||B(t)||D(t))return I(t)?qe(t,r,e,n,i):t;var s,o={};for(s in t)o[s]=qe(t[s],r,e,n,i);return o}(e[t],i,r,s,n),n,i,s)&&(n._pt=a=new hn(n._pt,r,t,0,1,o.render,o,0,o.priority),n!==h))for(c=n._ptLookup[n._targets.indexOf(r)],l=o._props.length;l--;)c[o._props[l]]=a;return o},We=function t(e,n,s){var a,c,l,u,d,h,A,p,f,m,g,v,E,w=e.vars,S=w.ease,T=w.startAt,C=w.immediateRender,R=w.lazy,I=w.onUpdate,x=w.onUpdateParams,O=w.callbackScope,L=w.runBackwards,M=w.yoyoEase,N=w.keyframes,P=w.autoRevert,D=e._dur,B=e._startAt,U=e._targets,F=e.parent,H=F&&"nested"===F.data?F.vars.targets:U,V="auto"===e._overwrite&&!i,j=e.timeline;if(j&&(!N||!S)&&(S="none"),e._ease=ke(S,y.ease),e._yEase=M?Le(ke(!0===M?S:M,y.ease)):0,M&&e._yoyo&&!e._repeat&&(M=e._yEase,e._yEase=e._ease,e._ease=M),e._from=!j&&!!w.runBackwards,!j||N&&!w.stagger){if(v=(p=U[0]?ut(U[0]).harness:0)&&w[p.prop],a=St(w,et),B&&(B._zTime<0&&B.progress(1),n<0&&L&&C&&!P?B.render(-1,!0):B.revert(L&&D?Z:J),B._lazy=0),T){if(It(e._startAt=Xe.set(U,bt({data:"isStart",overwrite:!1,parent:F,immediateRender:!0,lazy:!B&&k(R),startAt:null,delay:0,onUpdate:I,onUpdateParams:x,callbackScope:O,stagger:0},T))),e._startAt._dp=0,e._startAt._sat=e,n<0&&(r||!C&&!P)&&e._startAt.revert(Z),C&&D&&n<=0&&s<=0)return void(n&&(e._zTime=n))}else if(L&&D&&!B)if(n&&(C=!1),l=bt({overwrite:!1,data:"isFromStart",lazy:C&&!B&&k(R),immediateRender:C,stagger:0,parent:F},a),v&&(l[p.prop]=v),It(e._startAt=Xe.set(U,l)),e._startAt._dp=0,e._startAt._sat=e,n<0&&(r?e._startAt.revert(Z):e._startAt.render(-1,!0)),e._zTime=n,C){if(!n)return}else t(e._startAt,b,b);for(e._pt=e._ptCache=0,R=D&&k(R)||R&&!D,c=0;c<U.length;c++){if(A=(d=U[c])._gsap||lt(U)[c]._gsap,e._ptLookup[c]=m={},it[A.id]&&nt.length&&gt(),g=H===U?c:H.indexOf(d),p&&!1!==(f=new p).init(d,v||a,e,g,H)&&(e._pt=u=new hn(e._pt,d,f.name,0,1,f.render,f,0,f.priority),f._props.forEach((function(t){m[t]=u})),f.priority&&(h=1)),!p||v)for(l in a)rt[l]&&(f=ze(l,a,e,g,d,H))?f.priority&&(h=1):m[l]=u=Qe.call(e,d,l,"get",a[l],g,H,0,w.stringFilter);e._op&&e._op[c]&&e.kill(d,e._op[c]),V&&e._pt&&(Ve=e,o.killTweensOf(d,m,e.globalTime(n)),E=!e.parent,Ve=0),e._pt&&R&&(it[A.id]=1)}h&&dn(e),e._onInit&&e._onInit(e)}e._onUpdate=I,e._initted=(!e._op||e._pt)&&!E,N&&n<=0&&j.render(_,!0,!0)},Ke=function(t,e,n,i){var r,s,o=e.ease||i||"power1.inOut";if(B(e))s=n[t]||(n[t]=[]),e.forEach((function(t,n){return s.push({t:n/(e.length-1)*100,v:t,e:o})}));else for(r in e)s=n[r]||(n[r]=[]),"ease"===r||s.push({t:parseFloat(t),v:e[r],e:o})},qe=function(t,e,n,i,r){return x(t)?t.call(e,n,i,r):I(t)&&~t.indexOf("random(")?le(t):t},Ye=ct+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",$e={};ht(Ye+",id,stagger,delay,duration,paused,scrollTrigger",(function(t){return $e[t]=1}));var Xe=function(t){function s(e,r,s,a){var c;"number"==typeof r&&(s.duration=r,r=s,s=null);var l,u,d,h,A,p,f,m,g=(c=t.call(this,a?r:Tt(r))||this).vars,y=g.duration,_=g.delay,b=g.immediateRender,E=g.stagger,w=g.overwrite,S=g.keyframes,T=g.defaults,C=g.scrollTrigger,R=g.yoyoEase,I=r.parent||o,x=(B(e)||D(e)?O(e[0]):"length"in r)?[e]:ee(e);if(c._targets=x.length?lt(x):Y("GSAP target "+e+" not found. https://greensock.com",!v.nullTargetWarn)||[],c._ptLookup=[],c._overwrite=w,S||E||P(y)||P(_)){if(r=c.vars,(l=c.timeline=new He({data:"nested",defaults:T||{},targets:I&&"nested"===I.data?I.vars.targets:x})).kill(),l.parent=l._dp=n(c),l._start=0,E||P(y)||P(_)){if(h=x.length,f=E&&re(E),M(E))for(A in E)~Ye.indexOf(A)&&(m||(m={}),m[A]=E[A]);for(u=0;u<h;u++)(d=St(r,$e)).stagger=0,R&&(d.yoyoEase=R),m&&Et(d,m),p=x[u],d.duration=+qe(y,n(c),u,p,x),d.delay=(+qe(_,n(c),u,p,x)||0)-c._delay,!E&&1===h&&d.delay&&(c._delay=_=d.delay,c._start+=_,d.delay=0),l.to(p,d,f?f(u,p,x):0),l._ease=Re.none;l.duration()?y=_=0:c.timeline=0}else if(S){Tt(bt(l.vars.defaults,{ease:"none"})),l._ease=ke(S.ease||r.ease||"none");var L,N,U,F=0;if(B(S))S.forEach((function(t){return l.to(x,t,">")})),l.duration();else{for(A in d={},S)"ease"===A||"easeEach"===A||Ke(A,S[A],d,S.easeEach);for(A in d)for(L=d[A].sort((function(t,e){return t.t-e.t})),F=0,u=0;u<L.length;u++)(U={ease:(N=L[u]).e,duration:(N.t-(u?L[u-1].t:0))/100*y})[A]=N.v,l.to(x,U,F),F+=U.duration;l.duration()<y&&l.to({},{duration:y-l.duration()})}}y||c.duration(y=l.duration())}else c.timeline=0;return!0!==w||i||(Ve=n(c),o.killTweensOf(x),Ve=0),Ft(I,n(c),s),r.reversed&&c.reverse(),r.paused&&c.paused(!0),(b||!y&&!S&&c._start===pt(I._time)&&k(b)&&Mt(n(c))&&"nested"!==I.data)&&(c._tTime=-1e-8,c.render(Math.max(0,-_)||0)),C&&Ht(n(c),C),c}e(s,t);var a=s.prototype;return a.render=function(t,e,n){var i,s,o,a,c,l,u,d,h,A=this._time,p=this._tDur,f=this._dur,m=t<0,g=t>p-b&&!m?p:t<b?0:t;if(f){if(g!==this._tTime||!t||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==m){if(i=g,d=this.timeline,this._repeat){if(a=f+this._rDelay,this._repeat<-1&&m)return this.totalTime(100*a+t,e,n);if(i=pt(g%a),g===p?(o=this._repeat,i=f):((o=~~(g/a))&&o===g/a&&(i=f,o--),i>f&&(i=f)),(l=this._yoyo&&1&o)&&(h=this._yEase,i=f-i),c=Nt(this._tTime,a),i===A&&!n&&this._initted)return this._tTime=g,this;o!==c&&(d&&this._yEase&&Me(d,l),!this.vars.repeatRefresh||l||this._lock||(this._lock=n=1,this.render(pt(a*o),!0).invalidate()._lock=0))}if(!this._initted){if(Vt(this,m?t:i,n,e,g))return this._tTime=0,this;if(A!==this._time)return this;if(f!==this._dur)return this.render(t,e,n)}if(this._tTime=g,this._time=i,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=u=(h||this._ease)(i/f),this._from&&(this.ratio=u=1-u),i&&!A&&!e&&!o&&(he(this,"onStart"),this._tTime!==g))return this;for(s=this._pt;s;)s.r(u,s.d),s=s._next;d&&d.render(t<0?t:!i&&l?-1e-8:d._dur*d._ease(i/this._dur),e,n)||this._startAt&&(this._zTime=t),this._onUpdate&&!e&&(m&&Lt(this,t,0,n),he(this,"onUpdate")),this._repeat&&o!==c&&this.vars.onRepeat&&!e&&this.parent&&he(this,"onRepeat"),g!==this._tDur&&g||this._tTime!==g||(m&&!this._onUpdate&&Lt(this,t,0,!0),(t||!f)&&(g===this._tDur&&this._ts>0||!g&&this._ts<0)&&It(this,1),e||m&&!A||!(g||A||l)||(he(this,g===p?"onComplete":"onReverseComplete",!0),this._prom&&!(g<p&&this.timeScale()>0)&&this._prom()))}}else!function(t,e,n,i){var s,o,a,c=t.ratio,l=e<0||!e&&(!t._start&&jt(t)&&(t._initted||!Gt(t))||(t._ts<0||t._dp._ts<0)&&!Gt(t))?0:1,u=t._rDelay,d=0;if(u&&t._repeat&&(d=$t(0,t._tDur,e),o=Nt(d,u),t._yoyo&&1&o&&(l=1-l),o!==Nt(t._tTime,u)&&(c=1-l,t.vars.repeatRefresh&&t._initted&&t.invalidate())),l!==c||r||i||t._zTime===b||!e&&t._zTime){if(!t._initted&&Vt(t,e,i,n,d))return;for(a=t._zTime,t._zTime=e||(n?b:0),n||(n=e&&!a),t.ratio=l,t._from&&(l=1-l),t._time=0,t._tTime=d,s=t._pt;s;)s.r(l,s.d),s=s._next;e<0&&Lt(t,e,0,!0),t._onUpdate&&!n&&he(t,"onUpdate"),d&&t._repeat&&!n&&t.parent&&he(t,"onRepeat"),(e>=t._tDur||e<0)&&t.ratio===l&&(l&&It(t,1),n||r||(he(t,l?"onComplete":"onReverseComplete",!0),t._prom&&t._prom()))}else t._zTime||(t._zTime=e)}(this,t,e,n);return this},a.targets=function(){return this._targets},a.invalidate=function(e){return(!e||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(e),t.prototype.invalidate.call(this,e)},a.resetTo=function(t,e,n,i){A||Te.wake(),this._ts||this.play();var r=Math.min(this._dur,(this._dp._time-this._start)*this._ts);return this._initted||We(this,r),function(t,e,n,i,r,s,o){var a,c,l,u,d=(t._pt&&t._ptCache||(t._ptCache={}))[e];if(!d)for(d=t._ptCache[e]=[],l=t._ptLookup,u=t._targets.length;u--;){if((a=l[u][e])&&a.d&&a.d._pt)for(a=a.d._pt;a&&a.p!==e&&a.fp!==e;)a=a._next;if(!a)return je=1,t.vars[e]="+=0",We(t,o),je=0,1;d.push(a)}for(u=d.length;u--;)(a=(c=d[u])._pt||c).s=!i&&0!==i||r?a.s+(i||0)+s*a.c:i,a.c=n-a.s,c.e&&(c.e=At(n)+Xt(c.e)),c.b&&(c.b=a.s+Xt(c.b))}(this,t,e,n,i,this._ease(r/this._dur),r)?this.resetTo(t,e,n,i):(Bt(this,0),this.parent||Ct(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},a.kill=function(t,e){if(void 0===e&&(e="all"),!(t||e&&"all"!==e))return this._lazy=this._pt=0,this.parent?Ae(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(t,e,Ve&&!0!==Ve.vars.overwrite)._first||Ae(this),this.parent&&n!==this.timeline.totalDuration()&&Qt(this,this._dur*this.timeline._tDur/n,0,1),this}var i,r,s,o,a,c,l,u=this._targets,d=t?ee(t):u,h=this._ptLookup,A=this._pt;if((!e||"all"===e)&&function(t,e){for(var n=t.length,i=n===e.length;i&&n--&&t[n]===e[n];);return n<0}(u,d))return"all"===e&&(this._pt=0),Ae(this);for(i=this._op=this._op||[],"all"!==e&&(I(e)&&(a={},ht(e,(function(t){return a[t]=1})),e=a),e=function(t,e){var n,i,r,s,o=t[0]?ut(t[0]).harness:0,a=o&&o.aliases;if(!a)return e;for(i in n=Et({},e),a)if(i in n)for(r=(s=a[i].split(",")).length;r--;)n[s[r]]=n[i];return n}(u,e)),l=u.length;l--;)if(~d.indexOf(u[l]))for(a in r=h[l],"all"===e?(i[l]=e,o=r,s={}):(s=i[l]=i[l]||{},o=e),o)(c=r&&r[a])&&("kill"in c.d&&!0!==c.d.kill(a)||Rt(this,c,"_pt"),delete r[a]),"all"!==s&&(s[a]=1);return this._initted&&!this._pt&&A&&Ae(this),this},s.to=function(t,e){return new s(t,e,arguments[2])},s.from=function(t,e){return qt(1,arguments)},s.delayedCall=function(t,e,n,i){return new s(e,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:t,onComplete:e,onReverseComplete:e,onCompleteParams:n,onReverseCompleteParams:n,callbackScope:i})},s.fromTo=function(t,e,n){return qt(2,arguments)},s.set=function(t,e){return e.duration=0,e.repeatDelay||(e.repeat=0),new s(t,e)},s.killTweensOf=function(t,e,n){return o.killTweensOf(t,e,n)},s}(Fe);bt(Xe.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),ht("staggerTo,staggerFrom,staggerFromTo",(function(t){Xe[t]=function(){var e=new He,n=Jt.call(arguments,0);return n.splice("staggerFromTo"===t?5:4,0,0),e[t].apply(e,n)}}));var Je=function(t,e,n){return t[e]=n},Ze=function(t,e,n){return t[e](n)},tn=function(t,e,n,i){return t[e](i.fp,n)},en=function(t,e,n){return t.setAttribute(e,n)},nn=function(t,e){return x(t[e])?Ze:L(t[e])&&t.setAttribute?en:Je},rn=function(t,e){return e.set(e.t,e.p,Math.round(1e6*(e.s+e.c*t))/1e6,e)},sn=function(t,e){return e.set(e.t,e.p,!!(e.s+e.c*t),e)},on=function(t,e){var n=e._pt,i="";if(!t&&e.b)i=e.b;else if(1===t&&e.e)i=e.e;else{for(;n;)i=n.p+(n.m?n.m(n.s+n.c*t):Math.round(1e4*(n.s+n.c*t))/1e4)+i,n=n._next;i+=e.c}e.set(e.t,e.p,i,e)},an=function(t,e){for(var n=e._pt;n;)n.r(t,n.d),n=n._next},cn=function(t,e,n,i){for(var r,s=this._pt;s;)r=s._next,s.p===i&&s.modifier(t,e,n),s=r},ln=function(t){for(var e,n,i=this._pt;i;)n=i._next,i.p===t&&!i.op||i.op===t?Rt(this,i,"_pt"):i.dep||(e=1),i=n;return!e},un=function(t,e,n,i){i.mSet(t,e,i.m.call(i.tween,n,i.mt),i)},dn=function(t){for(var e,n,i,r,s=t._pt;s;){for(e=s._next,n=i;n&&n.pr>s.pr;)n=n._next;(s._prev=n?n._prev:r)?s._prev._next=s:i=s,(s._next=n)?n._prev=s:r=s,s=e}t._pt=i},hn=function(){function t(t,e,n,i,r,s,o,a,c){this.t=e,this.s=i,this.c=r,this.p=n,this.r=s||rn,this.d=o||this,this.set=a||Je,this.pr=c||0,this._next=t,t&&(t._prev=this)}return t.prototype.modifier=function(t,e,n){this.mSet=this.mSet||this.set,this.set=un,this.m=t,this.mt=n,this.tween=e},t}();ht(ct+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(t){return et[t]=1})),z.TweenMax=z.TweenLite=Xe,z.TimelineLite=z.TimelineMax=He,o=new He({sortChildren:!1,defaults:y,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),v.stringFilter=Se;var An=[],pn={},fn=[],mn=0,gn=0,vn=function(t){return(pn[t]||fn).map((function(t){return t()}))},yn=function(){var t=Date.now(),e=[];t-mn>2&&(vn("matchMediaInit"),An.forEach((function(t){var n,i,r,s,o=t.queries,c=t.conditions;for(i in o)(n=a.matchMedia(o[i]).matches)&&(r=1),n!==c[i]&&(c[i]=n,s=1);s&&(t.revert(),r&&e.push(t))})),vn("matchMediaRevert"),e.forEach((function(t){return t.onMatch(t)})),mn=t,vn("matchMedia"))},_n=function(){function t(t,e){this.selector=e&&ne(e),this.data=[],this._r=[],this.isReverted=!1,this.id=gn++,t&&this.add(t)}var e=t.prototype;return e.add=function(t,e,n){x(t)&&(n=e,e=t,t=x);var i=this,r=function(){var t,r=s,o=i.selector;return r&&r!==i&&r.data.push(i),n&&(i.selector=ne(n)),s=i,t=e.apply(i,arguments),x(t)&&i._r.push(t),s=r,i.selector=o,i.isReverted=!1,t};return i.last=r,t===x?r(i):t?i[t]=r:r},e.ignore=function(t){var e=s;s=null,t(this),s=e},e.getTweens=function(){var e=[];return this.data.forEach((function(n){return n instanceof t?e.push.apply(e,n.getTweens()):n instanceof Xe&&!(n.parent&&"nested"===n.parent.data)&&e.push(n)})),e},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(t,e){var n=this;if(t){var i=this.getTweens();this.data.forEach((function(t){"isFlip"===t.data&&(t.revert(),t.getChildren(!0,!0,!1).forEach((function(t){return i.splice(i.indexOf(t),1)})))})),i.map((function(t){return{g:t.globalTime(0),t:t}})).sort((function(t,e){return e.g-t.g||-1/0})).forEach((function(e){return e.t.revert(t)})),this.data.forEach((function(e){return!(e instanceof Xe)&&e.revert&&e.revert(t)})),this._r.forEach((function(e){return e(t,n)})),this.isReverted=!0}else this.data.forEach((function(t){return t.kill&&t.kill()}));if(this.clear(),e)for(var r=An.length;r--;)An[r].id===this.id&&An.splice(r,1)},e.revert=function(t){this.kill(t||{})},t}(),bn=function(){function t(t){this.contexts=[],this.scope=t}var e=t.prototype;return e.add=function(t,e,n){M(t)||(t={matches:t});var i,r,o,c=new _n(0,n||this.scope),l=c.conditions={};for(r in s&&!c.selector&&(c.selector=s.selector),this.contexts.push(c),e=c.add("onMatch",e),c.queries=t,t)"all"===r?o=1:(i=a.matchMedia(t[r]))&&(An.indexOf(c)<0&&An.push(c),(l[r]=i.matches)&&(o=1),i.addListener?i.addListener(yn):i.addEventListener("change",yn));return o&&e(c),this},e.revert=function(t){this.kill(t||{})},e.kill=function(t){this.contexts.forEach((function(e){return e.kill(t,!0)}))},t}(),En={registerPlugin:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((function(t){return fe(t)}))},timeline:function(t){return new He(t)},getTweensOf:function(t,e){return o.getTweensOf(t,e)},getProperty:function(t,e,n,i){I(t)&&(t=ee(t)[0]);var r=ut(t||{}).get,s=n?_t:yt;return"native"===n&&(n=""),t?e?s((rt[e]&&rt[e].get||r)(t,e,n,i)):function(e,n,i){return s((rt[e]&&rt[e].get||r)(t,e,n,i))}:t},quickSetter:function(t,e,n){if((t=ee(t)).length>1){var i=t.map((function(t){return Tn.quickSetter(t,e,n)})),r=i.length;return function(t){for(var e=r;e--;)i[e](t)}}t=t[0]||{};var s=rt[e],o=ut(t),a=o.harness&&(o.harness.aliases||{})[e]||e,c=s?function(e){var i=new s;h._pt=0,i.init(t,n?e+n:e,h,0,[t]),i.render(1,i),h._pt&&an(1,h)}:o.set(t,a);return s?c:function(e){return c(t,a,n?e+n:e,o,1)}},quickTo:function(t,e,n){var i,r=Tn.to(t,Et(((i={})[e]="+=0.1",i.paused=!0,i),n||{})),s=function(t,n,i){return r.resetTo(e,t,n,i)};return s.tween=r,s},isTweening:function(t){return o.getTweensOf(t,!0).length>0},defaults:function(t){return t&&t.ease&&(t.ease=ke(t.ease,y.ease)),wt(y,t||{})},config:function(t){return wt(v,t||{})},registerEffect:function(t){var e=t.name,n=t.effect,i=t.plugins,r=t.defaults,s=t.extendTimeline;(i||"").split(",").forEach((function(t){return t&&!rt[t]&&!z[t]&&Y(e+" effect requires "+t+" plugin.")})),st[e]=function(t,e,i){return n(ee(t),bt(e||{},r),i)},s&&(He.prototype[e]=function(t,n,i){return this.add(st[e](t,M(n)?n:(i=n)&&{},this),i)})},registerEase:function(t,e){Re[t]=ke(e)},parseEase:function(t,e){return arguments.length?ke(t,e):Re},getById:function(t){return o.getById(t)},exportRoot:function(t,e){void 0===t&&(t={});var n,i,r=new He(t);for(r.smoothChildTiming=k(t.smoothChildTiming),o.remove(r),r._dp=0,r._time=r._tTime=o._time,n=o._first;n;)i=n._next,!e&&!n._dur&&n instanceof Xe&&n.vars.onComplete===n._targets[0]||Ft(r,n,n._start-n._delay),n=i;return Ft(o,r,0),r},context:function(t,e){return t?new _n(t,e):s},matchMedia:function(t){return new bn(t)},matchMediaRefresh:function(){return An.forEach((function(t){var e,n,i=t.conditions;for(n in i)i[n]&&(i[n]=!1,e=1);e&&t.revert()}))||yn()},addEventListener:function(t,e){var n=pn[t]||(pn[t]=[]);~n.indexOf(e)||n.push(e)},removeEventListener:function(t,e){var n=pn[t],i=n&&n.indexOf(e);i>=0&&n.splice(i,1)},utils:{wrap:function t(e,n,i){var r=n-e;return B(e)?ce(e,t(0,e.length),n):Yt(i,(function(t){return(r+(t-e)%r)%r+e}))},wrapYoyo:function t(e,n,i){var r=n-e,s=2*r;return B(e)?ce(e,t(0,e.length-1),n):Yt(i,(function(t){return e+((t=(s+(t-e)%s)%s||0)>r?s-t:t)}))},distribute:re,random:ae,snap:oe,normalize:function(t,e,n){return ue(t,e,0,1,n)},getUnit:Xt,clamp:function(t,e,n){return Yt(n,(function(n){return $t(t,e,n)}))},splitColor:ye,toArray:ee,selector:ne,mapRange:ue,pipe:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(t){return e.reduce((function(t,e){return e(t)}),t)}},unitize:function(t,e){return function(n){return t(parseFloat(n))+(e||Xt(n))}},interpolate:function t(e,n,i,r){var s=isNaN(e+n)?0:function(t){return(1-t)*e+t*n};if(!s){var o,a,c,l,u,d=I(e),h={};if(!0===i&&(r=1)&&(i=null),d)e={p:e},n={p:n};else if(B(e)&&!B(n)){for(c=[],l=e.length,u=l-2,a=1;a<l;a++)c.push(t(e[a-1],e[a]));l--,s=function(t){t*=l;var e=Math.min(u,~~t);return c[e](t-e)},i=n}else r||(e=Et(B(e)?[]:{},e));if(!c){for(o in n)Qe.call(h,e,o,"get",n[o]);s=function(t){return an(t,h)||(d?e.p:e)}}}return Yt(i,s)},shuffle:ie},install:K,effects:st,ticker:Te,updateRoot:He.updateRoot,plugins:rt,globalTimeline:o,core:{PropTween:hn,globals:$,Tween:Xe,Timeline:He,Animation:Fe,getCache:ut,_removeLinkedListItem:Rt,reverting:function(){return r},context:function(t){return t&&s&&(s.data.push(t),t._ctx=s),s},suppressOverwrites:function(t){return i=t}}};ht("to,from,fromTo,delayedCall,set,killTweensOf",(function(t){return En[t]=Xe[t]})),Te.add(He.updateRoot),h=En.to({},{duration:0});var wn=function(t,e){for(var n=t._pt;n&&n.p!==e&&n.op!==e&&n.fp!==e;)n=n._next;return n},Sn=function(t,e){return{name:t,rawVars:1,init:function(t,n,i){i._onInit=function(t){var i,r;if(I(n)&&(i={},ht(n,(function(t){return i[t]=1})),n=i),e){for(r in i={},n)i[r]=e(n[r]);n=i}!function(t,e){var n,i,r,s=t._targets;for(n in e)for(i=s.length;i--;)(r=t._ptLookup[i][n])&&(r=r.d)&&(r._pt&&(r=wn(r,n)),r&&r.modifier&&r.modifier(e[n],t,s[i],n))}(t,n)}}}},Tn=En.registerPlugin({name:"attr",init:function(t,e,n,i,r){var s,o,a;for(s in this.tween=n,e)a=t.getAttribute(s)||"",(o=this.add(t,"setAttribute",(a||0)+"",e[s],i,r,0,0,s)).op=s,o.b=a,this._props.push(s)},render:function(t,e){for(var n=e._pt;n;)r?n.set(n.t,n.p,n.b,n):n.r(t,n.d),n=n._next}},{name:"endArray",init:function(t,e){for(var n=e.length;n--;)this.add(t,n,t[n]||0,e[n],0,0,0,0,0,1)}},Sn("roundProps",se),Sn("modifiers"),Sn("snap",oe))||En;Xe.version=He.version=Tn.version="3.12.2",u=1,N()&&Ce();var Cn,Rn,In,xn,On,Ln,Mn,kn,Nn=Re.Power0,Pn=Re.Power1,Dn=Re.Power2,Bn=Re.Power3,Un=Re.Power4,Fn=Re.Linear,Hn=Re.Quad,Vn=Re.Cubic,jn=Re.Quart,Gn=Re.Quint,Qn=Re.Strong,zn=Re.Elastic,Wn=Re.Back,Kn=Re.SteppedEase,qn=Re.Bounce,Yn=Re.Sine,$n=Re.Expo,Xn=Re.Circ,Jn={},Zn=180/Math.PI,ti=Math.PI/180,ei=Math.atan2,ni=/([A-Z])/g,ii=/(left|right|width|margin|padding|x)/i,ri=/[\s,\(]\S/,si={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},oi=function(t,e){return e.set(e.t,e.p,Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},ai=function(t,e){return e.set(e.t,e.p,1===t?e.e:Math.round(1e4*(e.s+e.c*t))/1e4+e.u,e)},ci=function(t,e){return e.set(e.t,e.p,t?Math.round(1e4*(e.s+e.c*t))/1e4+e.u:e.b,e)},li=function(t,e){var n=e.s+e.c*t;e.set(e.t,e.p,~~(n+(n<0?-.5:.5))+e.u,e)},ui=function(t,e){return e.set(e.t,e.p,t?e.e:e.b,e)},di=function(t,e){return e.set(e.t,e.p,1!==t?e.b:e.e,e)},hi=function(t,e,n){return t.style[e]=n},Ai=function(t,e,n){return t.style.setProperty(e,n)},pi=function(t,e,n){return t._gsap[e]=n},fi=function(t,e,n){return t._gsap.scaleX=t._gsap.scaleY=n},mi=function(t,e,n,i,r){var s=t._gsap;s.scaleX=s.scaleY=n,s.renderTransform(r,s)},gi=function(t,e,n,i,r){var s=t._gsap;s[e]=n,s.renderTransform(r,s)},vi="transform",yi=vi+"Origin",_i=function t(e,n){var i=this,r=this.target,s=r.style;if(e in Jn&&s){if(this.tfm=this.tfm||{},"transform"===e)return si.transform.split(",").forEach((function(e){return t.call(i,e,n)}));if(~(e=si[e]||e).indexOf(",")?e.split(",").forEach((function(t){return i.tfm[t]=Ui(r,t)})):this.tfm[e]=r._gsap.x?r._gsap[e]:Ui(r,e),this.props.indexOf(vi)>=0)return;r._gsap.svg&&(this.svgo=r.getAttribute("data-svg-origin"),this.props.push(yi,n,"")),e=vi}(s||n)&&this.props.push(e,n,s[e])},bi=function(t){t.translate&&(t.removeProperty("translate"),t.removeProperty("scale"),t.removeProperty("rotate"))},Ei=function(){var t,e,n=this.props,i=this.target,r=i.style,s=i._gsap;for(t=0;t<n.length;t+=3)n[t+1]?i[n[t]]=n[t+2]:n[t+2]?r[n[t]]=n[t+2]:r.removeProperty("--"===n[t].substr(0,2)?n[t]:n[t].replace(ni,"-$1").toLowerCase());if(this.tfm){for(e in this.tfm)s[e]=this.tfm[e];s.svg&&(s.renderTransform(),i.setAttribute("data-svg-origin",this.svgo||"")),(t=Mn())&&t.isStart||r[vi]||(bi(r),s.uncache=1)}},wi=function(t,e){var n={target:t,props:[],revert:Ei,save:_i};return t._gsap||Tn.core.getCache(t),e&&e.split(",").forEach((function(t){return n.save(t)})),n},Si=function(t,e){var n=Rn.createElementNS?Rn.createElementNS((e||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),t):Rn.createElement(t);return n.style?n:Rn.createElement(t)},Ti=function t(e,n,i){var r=getComputedStyle(e);return r[n]||r.getPropertyValue(n.replace(ni,"-$1").toLowerCase())||r.getPropertyValue(n)||!i&&t(e,Ri(n)||n,1)||""},Ci="O,Moz,ms,Ms,Webkit".split(","),Ri=function(t,e,n){var i=(e||On).style,r=5;if(t in i&&!n)return t;for(t=t.charAt(0).toUpperCase()+t.substr(1);r--&&!(Ci[r]+t in i););return r<0?null:(3===r?"ms":r>=0?Ci[r]:"")+t},Ii=function(){"undefined"!=typeof window&&window.document&&(Cn=window,Rn=Cn.document,In=Rn.documentElement,On=Si("div")||{style:{}},Si("div"),vi=Ri(vi),yi=vi+"Origin",On.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",kn=!!Ri("perspective"),Mn=Tn.core.reverting,xn=1)},xi=function t(e){var n,i=Si("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),r=this.parentNode,s=this.nextSibling,o=this.style.cssText;if(In.appendChild(i),i.appendChild(this),this.style.display="block",e)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=t}catch(t){}else this._gsapBBox&&(n=this._gsapBBox());return r&&(s?r.insertBefore(this,s):r.appendChild(this)),In.removeChild(i),this.style.cssText=o,n},Oi=function(t,e){for(var n=e.length;n--;)if(t.hasAttribute(e[n]))return t.getAttribute(e[n])},Li=function(t){var e;try{e=t.getBBox()}catch(n){e=xi.call(t,!0)}return e&&(e.width||e.height)||t.getBBox===xi||(e=xi.call(t,!0)),!e||e.width||e.x||e.y?e:{x:+Oi(t,["x","cx","x1"])||0,y:+Oi(t,["y","cy","y1"])||0,width:0,height:0}},Mi=function(t){return!(!t.getCTM||t.parentNode&&!t.ownerSVGElement||!Li(t))},ki=function(t,e){if(e){var n=t.style;e in Jn&&e!==yi&&(e=vi),n.removeProperty?("ms"!==e.substr(0,2)&&"webkit"!==e.substr(0,6)||(e="-"+e),n.removeProperty(e.replace(ni,"-$1").toLowerCase())):n.removeAttribute(e)}},Ni=function(t,e,n,i,r,s){var o=new hn(t._pt,e,n,0,1,s?di:ui);return t._pt=o,o.b=i,o.e=r,t._props.push(n),o},Pi={deg:1,rad:1,turn:1},Di={grid:1,flex:1},Bi=function t(e,n,i,r){var s,o,a,c,l=parseFloat(i)||0,u=(i+"").trim().substr((l+"").length)||"px",d=On.style,h=ii.test(n),A="svg"===e.tagName.toLowerCase(),p=(A?"client":"offset")+(h?"Width":"Height"),f=100,m="px"===r,g="%"===r;return r===u||!l||Pi[r]||Pi[u]?l:("px"!==u&&!m&&(l=t(e,n,i,"px")),c=e.getCTM&&Mi(e),!g&&"%"!==u||!Jn[n]&&!~n.indexOf("adius")?(d[h?"width":"height"]=f+(m?u:r),o=~n.indexOf("adius")||"em"===r&&e.appendChild&&!A?e:e.parentNode,c&&(o=(e.ownerSVGElement||{}).parentNode),o&&o!==Rn&&o.appendChild||(o=Rn.body),(a=o._gsap)&&g&&a.width&&h&&a.time===Te.time&&!a.uncache?At(l/a.width*f):((g||"%"===u)&&!Di[Ti(o,"display")]&&(d.position=Ti(e,"position")),o===e&&(d.position="static"),o.appendChild(On),s=On[p],o.removeChild(On),d.position="absolute",h&&g&&((a=ut(o)).time=Te.time,a.width=o[p]),At(m?s*l/f:s&&l?f/s*l:0))):(s=c?e.getBBox()[h?"width":"height"]:e[p],At(g?l/s*f:l/100*s)))},Ui=function(t,e,n,i){var r;return xn||Ii(),e in si&&"transform"!==e&&~(e=si[e]).indexOf(",")&&(e=e.split(",")[0]),Jn[e]&&"transform"!==e?(r=Yi(t,i),r="transformOrigin"!==e?r[e]:r.svg?r.origin:$i(Ti(t,yi))+" "+r.zOrigin+"px"):(!(r=t.style[e])||"auto"===r||i||~(r+"").indexOf("calc("))&&(r=ji[e]&&ji[e](t,e,n)||Ti(t,e)||dt(t,e)||("opacity"===e?1:0)),n&&!~(r+"").trim().indexOf(" ")?Bi(t,e,r,n)+n:r},Fi=function(t,e,n,i){if(!n||"none"===n){var r=Ri(e,t,1),s=r&&Ti(t,r,1);s&&s!==n?(e=r,n=s):"borderColor"===e&&(n=Ti(t,"borderTopColor"))}var o,a,c,l,u,d,h,A,p,f,m,g=new hn(this._pt,t.style,e,0,1,on),y=0,_=0;if(g.b=n,g.e=i,n+="","auto"===(i+="")&&(t.style[e]=i,i=Ti(t,e)||i,t.style[e]=n),Se(o=[n,i]),i=o[1],c=(n=o[0]).match(H)||[],(i.match(H)||[]).length){for(;a=H.exec(i);)h=a[0],p=i.substring(y,a.index),u?u=(u+1)%5:"rgba("!==p.substr(-5)&&"hsla("!==p.substr(-5)||(u=1),h!==(d=c[_++]||"")&&(l=parseFloat(d)||0,m=d.substr((l+"").length),"="===h.charAt(1)&&(h=ft(l,h)+m),A=parseFloat(h),f=h.substr((A+"").length),y=H.lastIndex-f.length,f||(f=f||v.units[e]||m,y===i.length&&(i+=f,g.e+=f)),m!==f&&(l=Bi(t,e,d,f)||0),g._pt={_next:g._pt,p:p||1===_?p:",",s:l,c:A-l,m:u&&u<4||"zIndex"===e?Math.round:0});g.c=y<i.length?i.substring(y,i.length):""}else g.r="display"===e&&"none"===i?di:ui;return j.test(i)&&(g.e=0),this._pt=g,g},Hi={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},Vi=function(t,e){if(e.tween&&e.tween._time===e.tween._dur){var n,i,r,s=e.t,o=s.style,a=e.u,c=s._gsap;if("all"===a||!0===a)o.cssText="",i=1;else for(r=(a=a.split(",")).length;--r>-1;)n=a[r],Jn[n]&&(i=1,n="transformOrigin"===n?yi:vi),ki(s,n);i&&(ki(s,vi),c&&(c.svg&&s.removeAttribute("transform"),Yi(s,1),c.uncache=1,bi(o)))}},ji={clearProps:function(t,e,n,i,r){if("isFromStart"!==r.data){var s=t._pt=new hn(t._pt,e,n,0,0,Vi);return s.u=i,s.pr=-10,s.tween=r,t._props.push(n),1}}},Gi=[1,0,0,1,0,0],Qi={},zi=function(t){return"matrix(1, 0, 0, 1, 0, 0)"===t||"none"===t||!t},Wi=function(t){var e=Ti(t,vi);return zi(e)?Gi:e.substr(7).match(F).map(At)},Ki=function(t,e){var n,i,r,s,o=t._gsap||ut(t),a=t.style,c=Wi(t);return o.svg&&t.getAttribute("transform")?"1,0,0,1,0,0"===(c=[(r=t.transform.baseVal.consolidate().matrix).a,r.b,r.c,r.d,r.e,r.f]).join(",")?Gi:c:(c!==Gi||t.offsetParent||t===In||o.svg||(r=a.display,a.display="block",(n=t.parentNode)&&t.offsetParent||(s=1,i=t.nextElementSibling,In.appendChild(t)),c=Wi(t),r?a.display=r:ki(t,"display"),s&&(i?n.insertBefore(t,i):n?n.appendChild(t):In.removeChild(t))),e&&c.length>6?[c[0],c[1],c[4],c[5],c[12],c[13]]:c)},qi=function(t,e,n,i,r,s){var o,a,c,l=t._gsap,u=r||Ki(t,!0),d=l.xOrigin||0,h=l.yOrigin||0,A=l.xOffset||0,p=l.yOffset||0,f=u[0],m=u[1],g=u[2],v=u[3],y=u[4],_=u[5],b=e.split(" "),E=parseFloat(b[0])||0,w=parseFloat(b[1])||0;n?u!==Gi&&(a=f*v-m*g)&&(c=E*(-m/a)+w*(f/a)-(f*_-m*y)/a,E=E*(v/a)+w*(-g/a)+(g*_-v*y)/a,w=c):(E=(o=Li(t)).x+(~b[0].indexOf("%")?E/100*o.width:E),w=o.y+(~(b[1]||b[0]).indexOf("%")?w/100*o.height:w)),i||!1!==i&&l.smooth?(y=E-d,_=w-h,l.xOffset=A+(y*f+_*g)-y,l.yOffset=p+(y*m+_*v)-_):l.xOffset=l.yOffset=0,l.xOrigin=E,l.yOrigin=w,l.smooth=!!i,l.origin=e,l.originIsAbsolute=!!n,t.style[yi]="0px 0px",s&&(Ni(s,l,"xOrigin",d,E),Ni(s,l,"yOrigin",h,w),Ni(s,l,"xOffset",A,l.xOffset),Ni(s,l,"yOffset",p,l.yOffset)),t.setAttribute("data-svg-origin",E+" "+w)},Yi=function(t,e){var n=t._gsap||new Ue(t);if("x"in n&&!e&&!n.uncache)return n;var i,r,s,o,a,c,l,u,d,h,A,p,f,m,g,y,_,b,E,w,S,T,C,R,I,x,O,L,M,k,N,P,D=t.style,B=n.scaleX<0,U="px",F="deg",H=getComputedStyle(t),V=Ti(t,yi)||"0";return i=r=s=c=l=u=d=h=A=0,o=a=1,n.svg=!(!t.getCTM||!Mi(t)),H.translate&&("none"===H.translate&&"none"===H.scale&&"none"===H.rotate||(D[vi]=("none"!==H.translate?"translate3d("+(H.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+("none"!==H.rotate?"rotate("+H.rotate+") ":"")+("none"!==H.scale?"scale("+H.scale.split(" ").join(",")+") ":"")+("none"!==H[vi]?H[vi]:"")),D.scale=D.rotate=D.translate="none"),m=Ki(t,n.svg),n.svg&&(n.uncache?(I=t.getBBox(),V=n.xOrigin-I.x+"px "+(n.yOrigin-I.y)+"px",R=""):R=!e&&t.getAttribute("data-svg-origin"),qi(t,R||V,!!R||n.originIsAbsolute,!1!==n.smooth,m)),p=n.xOrigin||0,f=n.yOrigin||0,m!==Gi&&(b=m[0],E=m[1],w=m[2],S=m[3],i=T=m[4],r=C=m[5],6===m.length?(o=Math.sqrt(b*b+E*E),a=Math.sqrt(S*S+w*w),c=b||E?ei(E,b)*Zn:0,(d=w||S?ei(w,S)*Zn+c:0)&&(a*=Math.abs(Math.cos(d*ti))),n.svg&&(i-=p-(p*b+f*w),r-=f-(p*E+f*S))):(P=m[6],k=m[7],O=m[8],L=m[9],M=m[10],N=m[11],i=m[12],r=m[13],s=m[14],l=(g=ei(P,M))*Zn,g&&(R=T*(y=Math.cos(-g))+O*(_=Math.sin(-g)),I=C*y+L*_,x=P*y+M*_,O=T*-_+O*y,L=C*-_+L*y,M=P*-_+M*y,N=k*-_+N*y,T=R,C=I,P=x),u=(g=ei(-w,M))*Zn,g&&(y=Math.cos(-g),N=S*(_=Math.sin(-g))+N*y,b=R=b*y-O*_,E=I=E*y-L*_,w=x=w*y-M*_),c=(g=ei(E,b))*Zn,g&&(R=b*(y=Math.cos(g))+E*(_=Math.sin(g)),I=T*y+C*_,E=E*y-b*_,C=C*y-T*_,b=R,T=I),l&&Math.abs(l)+Math.abs(c)>359.9&&(l=c=0,u=180-u),o=At(Math.sqrt(b*b+E*E+w*w)),a=At(Math.sqrt(C*C+P*P)),g=ei(T,C),d=Math.abs(g)>2e-4?g*Zn:0,A=N?1/(N<0?-N:N):0),n.svg&&(R=t.getAttribute("transform"),n.forceCSS=t.setAttribute("transform","")||!zi(Ti(t,vi)),R&&t.setAttribute("transform",R))),Math.abs(d)>90&&Math.abs(d)<270&&(B?(o*=-1,d+=c<=0?180:-180,c+=c<=0?180:-180):(a*=-1,d+=d<=0?180:-180)),e=e||n.uncache,n.x=i-((n.xPercent=i&&(!e&&n.xPercent||(Math.round(t.offsetWidth/2)===Math.round(-i)?-50:0)))?t.offsetWidth*n.xPercent/100:0)+U,n.y=r-((n.yPercent=r&&(!e&&n.yPercent||(Math.round(t.offsetHeight/2)===Math.round(-r)?-50:0)))?t.offsetHeight*n.yPercent/100:0)+U,n.z=s+U,n.scaleX=At(o),n.scaleY=At(a),n.rotation=At(c)+F,n.rotationX=At(l)+F,n.rotationY=At(u)+F,n.skewX=d+F,n.skewY=h+F,n.transformPerspective=A+U,(n.zOrigin=parseFloat(V.split(" ")[2])||0)&&(D[yi]=$i(V)),n.xOffset=n.yOffset=0,n.force3D=v.force3D,n.renderTransform=n.svg?ir:kn?nr:Ji,n.uncache=0,n},$i=function(t){return(t=t.split(" "))[0]+" "+t[1]},Xi=function(t,e,n){var i=Xt(e);return At(parseFloat(e)+parseFloat(Bi(t,"x",n+"px",i)))+i},Ji=function(t,e){e.z="0px",e.rotationY=e.rotationX="0deg",e.force3D=0,nr(t,e)},Zi="0deg",tr="0px",er=") ",nr=function(t,e){var n=e||this,i=n.xPercent,r=n.yPercent,s=n.x,o=n.y,a=n.z,c=n.rotation,l=n.rotationY,u=n.rotationX,d=n.skewX,h=n.skewY,A=n.scaleX,p=n.scaleY,f=n.transformPerspective,m=n.force3D,g=n.target,v=n.zOrigin,y="",_="auto"===m&&t&&1!==t||!0===m;if(v&&(u!==Zi||l!==Zi)){var b,E=parseFloat(l)*ti,w=Math.sin(E),S=Math.cos(E);E=parseFloat(u)*ti,b=Math.cos(E),s=Xi(g,s,w*b*-v),o=Xi(g,o,-Math.sin(E)*-v),a=Xi(g,a,S*b*-v+v)}f!==tr&&(y+="perspective("+f+er),(i||r)&&(y+="translate("+i+"%, "+r+"%) "),(_||s!==tr||o!==tr||a!==tr)&&(y+=a!==tr||_?"translate3d("+s+", "+o+", "+a+") ":"translate("+s+", "+o+er),c!==Zi&&(y+="rotate("+c+er),l!==Zi&&(y+="rotateY("+l+er),u!==Zi&&(y+="rotateX("+u+er),d===Zi&&h===Zi||(y+="skew("+d+", "+h+er),1===A&&1===p||(y+="scale("+A+", "+p+er),g.style[vi]=y||"translate(0, 0)"},ir=function(t,e){var n,i,r,s,o,a=e||this,c=a.xPercent,l=a.yPercent,u=a.x,d=a.y,h=a.rotation,A=a.skewX,p=a.skewY,f=a.scaleX,m=a.scaleY,g=a.target,v=a.xOrigin,y=a.yOrigin,_=a.xOffset,b=a.yOffset,E=a.forceCSS,w=parseFloat(u),S=parseFloat(d);h=parseFloat(h),A=parseFloat(A),(p=parseFloat(p))&&(A+=p=parseFloat(p),h+=p),h||A?(h*=ti,A*=ti,n=Math.cos(h)*f,i=Math.sin(h)*f,r=Math.sin(h-A)*-m,s=Math.cos(h-A)*m,A&&(p*=ti,o=Math.tan(A-p),r*=o=Math.sqrt(1+o*o),s*=o,p&&(o=Math.tan(p),n*=o=Math.sqrt(1+o*o),i*=o)),n=At(n),i=At(i),r=At(r),s=At(s)):(n=f,s=m,i=r=0),(w&&!~(u+"").indexOf("px")||S&&!~(d+"").indexOf("px"))&&(w=Bi(g,"x",u,"px"),S=Bi(g,"y",d,"px")),(v||y||_||b)&&(w=At(w+v-(v*n+y*r)+_),S=At(S+y-(v*i+y*s)+b)),(c||l)&&(o=g.getBBox(),w=At(w+c/100*o.width),S=At(S+l/100*o.height)),o="matrix("+n+","+i+","+r+","+s+","+w+","+S+")",g.setAttribute("transform",o),E&&(g.style[vi]=o)},rr=function(t,e,n,i,r){var s,o,a=360,c=I(r),l=parseFloat(r)*(c&&~r.indexOf("rad")?Zn:1)-i,u=i+l+"deg";return c&&("short"===(s=r.split("_")[1])&&(l%=a)!==l%180&&(l+=l<0?a:-360),"cw"===s&&l<0?l=(l+36e9)%a-~~(l/a)*a:"ccw"===s&&l>0&&(l=(l-36e9)%a-~~(l/a)*a)),t._pt=o=new hn(t._pt,e,n,i,l,ai),o.e=u,o.u="deg",t._props.push(n),o},sr=function(t,e){for(var n in e)t[n]=e[n];return t},or=function(t,e,n){var i,r,s,o,a,c,l,u=sr({},n._gsap),d=n.style;for(r in u.svg?(s=n.getAttribute("transform"),n.setAttribute("transform",""),d[vi]=e,i=Yi(n,1),ki(n,vi),n.setAttribute("transform",s)):(s=getComputedStyle(n)[vi],d[vi]=e,i=Yi(n,1),d[vi]=s),Jn)(s=u[r])!==(o=i[r])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(r)<0&&(a=Xt(s)!==(l=Xt(o))?Bi(n,r,s,l):parseFloat(s),c=parseFloat(o),t._pt=new hn(t._pt,i,r,a,c-a,oi),t._pt.u=l||0,t._props.push(r));sr(i,u)};ht("padding,margin,Width,Radius",(function(t,e){var n="Top",i="Right",r="Bottom",s="Left",o=(e<3?[n,i,r,s]:[n+s,n+i,r+i,r+s]).map((function(n){return e<2?t+n:"border"+n+t}));ji[e>1?"border"+t:t]=function(t,e,n,i,r){var s,a;if(arguments.length<4)return s=o.map((function(e){return Ui(t,e,n)})),5===(a=s.join(" ")).split(s[0]).length?s[0]:a;s=(i+"").split(" "),a={},o.forEach((function(t,e){return a[t]=s[e]=s[e]||s[(e-1)/2|0]})),t.init(e,a,r)}}));var ar,cr,lr,ur={name:"css",register:Ii,targetTest:function(t){return t.style&&t.nodeType},init:function(t,e,n,i,r){var s,o,a,c,l,u,d,h,A,p,f,m,g,y,_,b,E,w,S,T,C=this._props,R=t.style,x=n.vars.startAt;for(d in xn||Ii(),this.styles=this.styles||wi(t),b=this.styles.props,this.tween=n,e)if("autoRound"!==d&&(o=e[d],!rt[d]||!ze(d,e,n,i,t,r)))if(l=typeof o,u=ji[d],"function"===l&&(l=typeof(o=o.call(n,i,t,r))),"string"===l&&~o.indexOf("random(")&&(o=le(o)),u)u(this,t,d,o,n)&&(_=1);else if("--"===d.substr(0,2))s=(getComputedStyle(t).getPropertyValue(d)+"").trim(),o+="",Ee.lastIndex=0,Ee.test(s)||(h=Xt(s),A=Xt(o)),A?h!==A&&(s=Bi(t,d,s,A)+A):h&&(o+=h),this.add(R,"setProperty",s,o,i,r,0,0,d),C.push(d),b.push(d,0,R[d]);else if("undefined"!==l){if(x&&d in x?(s="function"==typeof x[d]?x[d].call(n,i,t,r):x[d],I(s)&&~s.indexOf("random(")&&(s=le(s)),Xt(s+"")||(s+=v.units[d]||Xt(Ui(t,d))||""),"="===(s+"").charAt(1)&&(s=Ui(t,d))):s=Ui(t,d),c=parseFloat(s),(p="string"===l&&"="===o.charAt(1)&&o.substr(0,2))&&(o=o.substr(2)),a=parseFloat(o),d in si&&("autoAlpha"===d&&(1===c&&"hidden"===Ui(t,"visibility")&&a&&(c=0),b.push("visibility",0,R.visibility),Ni(this,R,"visibility",c?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==d&&"transform"!==d&&~(d=si[d]).indexOf(",")&&(d=d.split(",")[0])),f=d in Jn)if(this.styles.save(d),m||((g=t._gsap).renderTransform&&!e.parseTransform||Yi(t,e.parseTransform),y=!1!==e.smoothOrigin&&g.smooth,(m=this._pt=new hn(this._pt,R,vi,0,1,g.renderTransform,g,0,-1)).dep=1),"scale"===d)this._pt=new hn(this._pt,g,"scaleY",g.scaleY,(p?ft(g.scaleY,p+a):a)-g.scaleY||0,oi),this._pt.u=0,C.push("scaleY",d),d+="X";else{if("transformOrigin"===d){b.push(yi,0,R[yi]),w=void 0,S=void 0,T=void 0,w=(E=o).split(" "),S=w[0],T=w[1]||"50%","top"!==S&&"bottom"!==S&&"left"!==T&&"right"!==T||(E=S,S=T,T=E),w[0]=Hi[S]||S,w[1]=Hi[T]||T,o=w.join(" "),g.svg?qi(t,o,0,y,0,this):((A=parseFloat(o.split(" ")[2])||0)!==g.zOrigin&&Ni(this,g,"zOrigin",g.zOrigin,A),Ni(this,R,d,$i(s),$i(o)));continue}if("svgOrigin"===d){qi(t,o,1,y,0,this);continue}if(d in Qi){rr(this,g,d,c,p?ft(c,p+o):o);continue}if("smoothOrigin"===d){Ni(this,g,"smooth",g.smooth,o);continue}if("force3D"===d){g[d]=o;continue}if("transform"===d){or(this,o,t);continue}}else d in R||(d=Ri(d)||d);if(f||(a||0===a)&&(c||0===c)&&!ri.test(o)&&d in R)a||(a=0),(h=(s+"").substr((c+"").length))!==(A=Xt(o)||(d in v.units?v.units[d]:h))&&(c=Bi(t,d,s,A)),this._pt=new hn(this._pt,f?g:R,d,c,(p?ft(c,p+a):a)-c,f||"px"!==A&&"zIndex"!==d||!1===e.autoRound?oi:li),this._pt.u=A||0,h!==A&&"%"!==A&&(this._pt.b=s,this._pt.r=ci);else if(d in R)Fi.call(this,t,d,s,p?p+o:o);else if(d in t)this.add(t,d,s||t[d],p?p+o:o,i,r);else if("parseTransform"!==d){q(d,o);continue}f||(d in R?b.push(d,0,R[d]):b.push(d,1,s||t[d])),C.push(d)}_&&dn(this)},render:function(t,e){if(e.tween._time||!Mn())for(var n=e._pt;n;)n.r(t,n.d),n=n._next;else e.styles.revert()},get:Ui,aliases:si,getSetter:function(t,e,n){var i=si[e];return i&&i.indexOf(",")<0&&(e=i),e in Jn&&e!==yi&&(t._gsap.x||Ui(t,"x"))?n&&Ln===n?"scale"===e?fi:pi:(Ln=n||{})&&("scale"===e?mi:gi):t.style&&!L(t.style[e])?hi:~e.indexOf("-")?Ai:nn(t,e)},core:{_removeProperty:ki,_getMatrix:Ki}};Tn.utils.checkPrefix=Ri,Tn.core.getStyleSaver=wi,lr=ht((ar="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(cr="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(t){Jn[t]=1})),ht(cr,(function(t){v.units[t]="deg",Qi[t]=1})),si[lr[13]]=ar+","+cr,ht("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(t){var e=t.split(":");si[e[1]]=lr[e[0]]})),ht("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(t){v.units[t]="px"})),Tn.registerPlugin(ur);var dr=Tn.registerPlugin(ur)||Tn,hr=dr.core.Tween;t.Back=Wn,t.Bounce=qn,t.CSSPlugin=ur,t.Circ=Xn,t.Cubic=Vn,t.Elastic=zn,t.Expo=$n,t.Linear=Fn,t.Power0=Nn,t.Power1=Pn,t.Power2=Dn,t.Power3=Bn,t.Power4=Un,t.Quad=Hn,t.Quart=jn,t.Quint=Gn,t.Sine=Yn,t.SteppedEase=Kn,t.Strong=Qn,t.TimelineLite=He,t.TimelineMax=He,t.TweenLite=Xe,t.TweenMax=hr,t.default=dr,t.gsap=dr,"undefined"==typeof window||window!==t?Object.defineProperty(t,"__esModule",{value:!0}):delete window.default})),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.QRious=e()}(this,(function(){var t=function(){},e=Object.prototype.hasOwnProperty,n=Array.prototype.slice;function i(t,i,r){for(var s,o,a=0,c=(r=n.call(arguments,2)).length;a<c;a++)for(s in o=r[a])t&&!e.call(o,s)||(i[s]=o[s])}var r=function(e,n,r,s){var o=this;return"string"!=typeof e&&(s=r,r=n,n=e,e=null),"function"!=typeof n&&(s=r,r=n,n=function(){return o.apply(this,arguments)}),i(!1,n,o,s),n.prototype=function(e,n){var r;return"function"==typeof Object.create?r=Object.create(e):(t.prototype=e,r=new t,t.prototype=null),n&&i(!0,r,n),r}(o.prototype,r),n.prototype.constructor=n,n.class_=e||o.class_,n.super_=o,n};function s(){}s.class_="Nevis",s.super_=Object,s.extend=r;var o=s,a=o.extend((function(t,e,n){this.qrious=t,this.element=e,this.element.qrious=t,this.enabled=Boolean(n)}),{draw:function(t){},getElement:function(){return this.enabled||(this.enabled=!0,this.render()),this.element},getModuleSize:function(t){var e=this.qrious,n=e.padding||0,i=Math.floor((e.size-2*n)/t.width);return Math.max(1,i)},getOffset:function(t){var e=this.qrious,n=e.padding;if(null!=n)return n;var i=this.getModuleSize(t),r=Math.floor((e.size-i*t.width)/2);return Math.max(0,r)},render:function(t){this.enabled&&(this.resize(),this.reset(),this.draw(t))},reset:function(){},resize:function(){}}),c=a.extend({draw:function(t){var e,n,i=this.qrious,r=this.getModuleSize(t),s=this.getOffset(t),o=this.element.getContext("2d");for(o.fillStyle=i.foreground,o.globalAlpha=i.foregroundAlpha,e=0;e<t.width;e++)for(n=0;n<t.width;n++)t.buffer[n*t.width+e]&&o.fillRect(r*e+s,r*n+s,r,r)},reset:function(){var t=this.qrious,e=this.element.getContext("2d"),n=t.size;e.lineWidth=1,e.clearRect(0,0,n,n),e.fillStyle=t.background,e.globalAlpha=t.backgroundAlpha,e.fillRect(0,0,n,n)},resize:function(){var t=this.element;t.width=t.height=this.qrious.size}}),l=o.extend(null,{BLOCK:[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28]}),u=o.extend(null,{BLOCKS:[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30],FINAL_FORMAT:[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107],LEVELS:{L:1,M:2,Q:3,H:4}}),d=o.extend(null,{EXPONENT:[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0],LOG:[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175]}),h=o.extend(null,{BLOCK:[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177]}),A=o.extend((function(t){var e,n,i,r,s,o=t.value.length;for(this._badness=[],this._level=u.LEVELS[t.level],this._polynomial=[],this._value=t.value,this._version=0,this._stringBuffer=[];this._version<40&&(this._version++,i=4*(this._level-1)+16*(this._version-1),r=u.BLOCKS[i++],s=u.BLOCKS[i++],e=u.BLOCKS[i++],n=u.BLOCKS[i],!(o<=(i=e*(r+s)+s-3+(this._version<=9)))););this._dataBlock=e,this._eccBlock=n,this._neccBlock1=r,this._neccBlock2=s;var a=this.width=17+4*this._version;this.buffer=A._createArray(a*a),this._ecc=A._createArray(e+(e+n)*(r+s)+s),this._mask=A._createArray((a*(a+1)+1)/2),this._insertFinders(),this._insertAlignments(),this.buffer[8+a*(a-8)]=1,this._insertTimingGap(),this._reverseMask(),this._insertTimingRowAndColumn(),this._insertVersion(),this._syncMask(),this._convertBitStream(o),this._calculatePolynomial(),this._appendEccToData(),this._interleaveBlocks(),this._pack(),this._finish()}),{_addAlignment:function(t,e){var n,i=this.buffer,r=this.width;for(i[t+r*e]=1,n=-2;n<2;n++)i[t+n+r*(e-2)]=1,i[t-2+r*(e+n+1)]=1,i[t+2+r*(e+n)]=1,i[t+n+1+r*(e+2)]=1;for(n=0;n<2;n++)this._setMask(t-1,e+n),this._setMask(t+1,e-n),this._setMask(t-n,e-1),this._setMask(t+n,e+1)},_appendData:function(t,e,n,i){var r,s,o,a=this._polynomial,c=this._stringBuffer;for(s=0;s<i;s++)c[n+s]=0;for(s=0;s<e;s++){if(255!==(r=d.LOG[c[t+s]^c[n]]))for(o=1;o<i;o++)c[n+o-1]=c[n+o]^d.EXPONENT[A._modN(r+a[i-o])];else for(o=n;o<n+i;o++)c[o]=c[o+1];c[n+i-1]=255===r?0:d.EXPONENT[A._modN(r+a[0])]}},_appendEccToData:function(){var t,e=0,n=this._dataBlock,i=this._calculateMaxLength(),r=this._eccBlock;for(t=0;t<this._neccBlock1;t++)this._appendData(e,n,i,r),e+=n,i+=r;for(t=0;t<this._neccBlock2;t++)this._appendData(e,n+1,i,r),e+=n+1,i+=r},_applyMask:function(t){var e,n,i,r,s=this.buffer,o=this.width;switch(t){case 0:for(r=0;r<o;r++)for(i=0;i<o;i++)i+r&1||this._isMasked(i,r)||(s[i+r*o]^=1);break;case 1:for(r=0;r<o;r++)for(i=0;i<o;i++)1&r||this._isMasked(i,r)||(s[i+r*o]^=1);break;case 2:for(r=0;r<o;r++)for(e=0,i=0;i<o;i++,e++)3===e&&(e=0),e||this._isMasked(i,r)||(s[i+r*o]^=1);break;case 3:for(n=0,r=0;r<o;r++,n++)for(3===n&&(n=0),e=n,i=0;i<o;i++,e++)3===e&&(e=0),e||this._isMasked(i,r)||(s[i+r*o]^=1);break;case 4:for(r=0;r<o;r++)for(e=0,n=r>>1&1,i=0;i<o;i++,e++)3===e&&(e=0,n=!n),n||this._isMasked(i,r)||(s[i+r*o]^=1);break;case 5:for(n=0,r=0;r<o;r++,n++)for(3===n&&(n=0),e=0,i=0;i<o;i++,e++)3===e&&(e=0),(i&r&1)+!(!e|!n)||this._isMasked(i,r)||(s[i+r*o]^=1);break;case 6:for(n=0,r=0;r<o;r++,n++)for(3===n&&(n=0),e=0,i=0;i<o;i++,e++)3===e&&(e=0),(i&r&1)+(e&&e===n)&1||this._isMasked(i,r)||(s[i+r*o]^=1);break;case 7:for(n=0,r=0;r<o;r++,n++)for(3===n&&(n=0),e=0,i=0;i<o;i++,e++)3===e&&(e=0),(e&&e===n)+(i+r&1)&1||this._isMasked(i,r)||(s[i+r*o]^=1)}},_calculateMaxLength:function(){return this._dataBlock*(this._neccBlock1+this._neccBlock2)+this._neccBlock2},_calculatePolynomial:function(){var t,e,n=this._eccBlock,i=this._polynomial;for(i[0]=1,t=0;t<n;t++){for(i[t+1]=1,e=t;e>0;e--)i[e]=i[e]?i[e-1]^d.EXPONENT[A._modN(d.LOG[i[e]]+t)]:i[e-1];i[0]=d.EXPONENT[A._modN(d.LOG[i[0]]+t)]}for(t=0;t<=n;t++)i[t]=d.LOG[i[t]]},_checkBadness:function(){var t,e,n,i,r,s=0,o=this._badness,a=this.buffer,c=this.width;for(r=0;r<c-1;r++)for(i=0;i<c-1;i++)(a[i+c*r]&&a[i+1+c*r]&&a[i+c*(r+1)]&&a[i+1+c*(r+1)]||!(a[i+c*r]||a[i+1+c*r]||a[i+c*(r+1)]||a[i+1+c*(r+1)]))&&(s+=A.N2);var l=0;for(r=0;r<c;r++){for(n=0,o[0]=0,t=0,i=0;i<c;i++)t===(e=a[i+c*r])?o[n]++:o[++n]=1,l+=(t=e)?1:-1;s+=this._getBadness(n)}l<0&&(l=-l);var u=0,d=l;for(d+=d<<2,d<<=1;d>c*c;)d-=c*c,u++;for(s+=u*A.N4,i=0;i<c;i++){for(n=0,o[0]=0,t=0,r=0;r<c;r++)t===(e=a[i+c*r])?o[n]++:o[++n]=1,t=e;s+=this._getBadness(n)}return s},_convertBitStream:function(t){var e,n,i=this._ecc,r=this._version;for(n=0;n<t;n++)i[n]=this._value.charCodeAt(n);var s=this._stringBuffer=i.slice(),o=this._calculateMaxLength();t>=o-2&&(t=o-2,r>9&&t--);var a=t;if(r>9){for(s[a+2]=0,s[a+3]=0;a--;)e=s[a],s[a+3]|=255&e<<4,s[a+2]=e>>4;s[2]|=255&t<<4,s[1]=t>>4,s[0]=64|t>>12}else{for(s[a+1]=0,s[a+2]=0;a--;)e=s[a],s[a+2]|=255&e<<4,s[a+1]=e>>4;s[1]|=255&t<<4,s[0]=64|t>>4}for(a=t+3-(r<10);a<o;)s[a++]=236,s[a++]=17},_getBadness:function(t){var e,n=0,i=this._badness;for(e=0;e<=t;e++)i[e]>=5&&(n+=A.N1+i[e]-5);for(e=3;e<t-1;e+=2)i[e-2]===i[e+2]&&i[e+2]===i[e-1]&&i[e-1]===i[e+1]&&3*i[e-1]===i[e]&&(0===i[e-3]||e+3>t||3*i[e-3]>=4*i[e]||3*i[e+3]>=4*i[e])&&(n+=A.N3);return n},_finish:function(){var t,e;this._stringBuffer=this.buffer.slice();var n=0,i=3e4;for(e=0;e<8&&(this._applyMask(e),(t=this._checkBadness())<i&&(i=t,n=e),7!==n);e++)this.buffer=this._stringBuffer.slice();n!==e&&this._applyMask(n),i=u.FINAL_FORMAT[n+(this._level-1<<3)];var r=this.buffer,s=this.width;for(e=0;e<8;e++,i>>=1)1&i&&(r[s-1-e+8*s]=1,e<6?r[8+s*e]=1:r[8+s*(e+1)]=1);for(e=0;e<7;e++,i>>=1)1&i&&(r[8+s*(s-7+e)]=1,e?r[6-e+8*s]=1:r[7+8*s]=1)},_interleaveBlocks:function(){var t,e,n=this._dataBlock,i=this._ecc,r=this._eccBlock,s=0,o=this._calculateMaxLength(),a=this._neccBlock1,c=this._neccBlock2,l=this._stringBuffer;for(t=0;t<n;t++){for(e=0;e<a;e++)i[s++]=l[t+e*n];for(e=0;e<c;e++)i[s++]=l[a*n+t+e*(n+1)]}for(e=0;e<c;e++)i[s++]=l[a*n+t+e*(n+1)];for(t=0;t<r;t++)for(e=0;e<a+c;e++)i[s++]=l[o+t+e*r];this._stringBuffer=i},_insertAlignments:function(){var t,e,n,i=this._version,r=this.width;if(i>1)for(t=l.BLOCK[i],n=r-7;;){for(e=r-7;e>t-3&&(this._addAlignment(e,n),!(e<t));)e-=t;if(n<=t+9)break;n-=t,this._addAlignment(6,n),this._addAlignment(n,6)}},_insertFinders:function(){var t,e,n,i,r=this.buffer,s=this.width;for(t=0;t<3;t++){for(e=0,i=0,1===t&&(e=s-7),2===t&&(i=s-7),r[i+3+s*(e+3)]=1,n=0;n<6;n++)r[i+n+s*e]=1,r[i+s*(e+n+1)]=1,r[i+6+s*(e+n)]=1,r[i+n+1+s*(e+6)]=1;for(n=1;n<5;n++)this._setMask(i+n,e+1),this._setMask(i+1,e+n+1),this._setMask(i+5,e+n),this._setMask(i+n+1,e+5);for(n=2;n<4;n++)r[i+n+s*(e+2)]=1,r[i+2+s*(e+n+1)]=1,r[i+4+s*(e+n)]=1,r[i+n+1+s*(e+4)]=1}},_insertTimingGap:function(){var t,e,n=this.width;for(e=0;e<7;e++)this._setMask(7,e),this._setMask(n-8,e),this._setMask(7,e+n-7);for(t=0;t<8;t++)this._setMask(t,7),this._setMask(t+n-8,7),this._setMask(t,n-8)},_insertTimingRowAndColumn:function(){var t,e=this.buffer,n=this.width;for(t=0;t<n-14;t++)1&t?(this._setMask(8+t,6),this._setMask(6,8+t)):(e[8+t+6*n]=1,e[6+n*(8+t)]=1)},_insertVersion:function(){var t,e,n,i,r=this.buffer,s=this._version,o=this.width;if(s>6)for(t=h.BLOCK[s-7],e=17,n=0;n<6;n++)for(i=0;i<3;i++,e--)1&(e>11?s>>e-12:t>>e)?(r[5-n+o*(2-i+o-11)]=1,r[2-i+o-11+o*(5-n)]=1):(this._setMask(5-n,2-i+o-11),this._setMask(2-i+o-11,5-n))},_isMasked:function(t,e){var n=A._getMaskBit(t,e);return 1===this._mask[n]},_pack:function(){var t,e,n,i=1,r=1,s=this.width,o=s-1,a=s-1,c=(this._dataBlock+this._eccBlock)*(this._neccBlock1+this._neccBlock2)+this._neccBlock2;for(e=0;e<c;e++)for(t=this._stringBuffer[e],n=0;n<8;n++,t<<=1){128&t&&(this.buffer[o+s*a]=1);do{r?o--:(o++,i?0!==a?a--:(i=!i,6===(o-=2)&&(o--,a=9)):a!==s-1?a++:(i=!i,6===(o-=2)&&(o--,a-=8))),r=!r}while(this._isMasked(o,a))}},_reverseMask:function(){var t,e,n=this.width;for(t=0;t<9;t++)this._setMask(t,8);for(t=0;t<8;t++)this._setMask(t+n-8,8),this._setMask(8,t);for(e=0;e<7;e++)this._setMask(8,e+n-7)},_setMask:function(t,e){var n=A._getMaskBit(t,e);this._mask[n]=1},_syncMask:function(){var t,e,n=this.width;for(e=0;e<n;e++)for(t=0;t<=e;t++)this.buffer[t+n*e]&&this._setMask(t,e)}},{_createArray:function(t){var e,n=[];for(e=0;e<t;e++)n[e]=0;return n},_getMaskBit:function(t,e){var n;return t>e&&(n=t,t=e,e=n),n=e,n+=e*e,n>>=1,n+=t},_modN:function(t){for(;t>=255;)t=((t-=255)>>8)+(255&t);return t},N1:3,N2:3,N3:40,N4:10}),p=A,f=a.extend({draw:function(){this.element.src=this.qrious.toDataURL()},reset:function(){this.element.src=""},resize:function(){var t=this.element;t.width=t.height=this.qrious.size}}),m=o.extend((function(t,e,n,i){this.name=t,this.modifiable=Boolean(e),this.defaultValue=n,this._valueTransformer=i}),{transform:function(t){var e=this._valueTransformer;return"function"==typeof e?e(t,this):t}}),g=o.extend(null,{abs:function(t){return null!=t?Math.abs(t):null},hasOwn:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},noop:function(){},toUpperCase:function(t){return null!=t?t.toUpperCase():null}}),v=o.extend((function(t){this.options={},t.forEach((function(t){this.options[t.name]=t}),this)}),{exists:function(t){return null!=this.options[t]},get:function(t,e){return v._get(this.options[t],e)},getAll:function(t){var e,n=this.options,i={};for(e in n)g.hasOwn(n,e)&&(i[e]=v._get(n[e],t));return i},init:function(t,e,n){var i,r;for(i in"function"!=typeof n&&(n=g.noop),this.options)g.hasOwn(this.options,i)&&(r=this.options[i],v._set(r,r.defaultValue,e),v._createAccessor(r,e,n));this._setAll(t,e,!0)},set:function(t,e,n){return this._set(t,e,n)},setAll:function(t,e){return this._setAll(t,e)},_set:function(t,e,n,i){var r=this.options[t];if(!r)throw new Error("Invalid option: "+t);if(!r.modifiable&&!i)throw new Error("Option cannot be modified: "+t);return v._set(r,e,n)},_setAll:function(t,e,n){if(!t)return!1;var i,r=!1;for(i in t)g.hasOwn(t,i)&&this._set(i,t[i],e,n)&&(r=!0);return r}},{_createAccessor:function(t,e,n){var i={get:function(){return v._get(t,e)}};t.modifiable&&(i.set=function(i){v._set(t,i,e)&&n(i,t)}),Object.defineProperty(e,t.name,i)},_get:function(t,e){return e["_"+t.name]},_set:function(t,e,n){var i="_"+t.name,r=n[i],s=t.transform(null!=e?e:t.defaultValue);return n[i]=s,s!==r}}),y=v,_=o.extend((function(){this._services={}}),{getService:function(t){var e=this._services[t];if(!e)throw new Error("Service is not being managed with name: "+t);return e},setService:function(t,e){if(this._services[t])throw new Error("Service is already managed with name: "+t);e&&(this._services[t]=e)}}),b=new y([new m("background",!0,"white"),new m("backgroundAlpha",!0,1,g.abs),new m("element"),new m("foreground",!0,"black"),new m("foregroundAlpha",!0,1,g.abs),new m("level",!0,"L",g.toUpperCase),new m("mime",!0,"image/png"),new m("padding",!0,null,g.abs),new m("size",!0,100,g.abs),new m("value",!0,"")]),E=new _,w=o.extend((function(t){b.init(t,this,this.update.bind(this));var e=b.get("element",this),n=E.getService("element"),i=e&&n.isCanvas(e)?e:n.createCanvas(),r=e&&n.isImage(e)?e:n.createImage();this._canvasRenderer=new c(this,i,!0),this._imageRenderer=new f(this,r,r===e),this.update()}),{get:function(){return b.getAll(this)},set:function(t){b.setAll(t,this)&&this.update()},toDataURL:function(t){return this.canvas.toDataURL(t||this.mime)},update:function(){var t=new p({level:this.level,value:this.value});this._canvasRenderer.render(t),this._imageRenderer.render(t)}},{use:function(t){E.setService(t.getName(),t)}});Object.defineProperties(w.prototype,{canvas:{get:function(){return this._canvasRenderer.getElement()}},image:{get:function(){return this._imageRenderer.getElement()}}});var S=w,T=o.extend({getName:function(){}}).extend({createCanvas:function(){},createImage:function(){},getName:function(){return"element"},isCanvas:function(t){},isImage:function(t){}}).extend({createCanvas:function(){return document.createElement("canvas")},createImage:function(){return document.createElement("img")},isCanvas:function(t){return t instanceof HTMLCanvasElement},isImage:function(t){return t instanceof HTMLImageElement}});return S.use(new T),S})),
/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 */
function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).html2canvas=e()}(this,(function(){
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};function e(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}var n=function(){return n=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)};function i(t,e,n,i){return new(n||(n=Promise))((function(r,s){function o(t){try{c(i.next(t))}catch(t){s(t)}}function a(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((i=i.apply(t,e||[])).next())}))}function r(t,e){var n,i,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(s){return function(a){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,i=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=o.trys,(r=r.length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,a])}}}function s(t,e,n){if(n||2===arguments.length)for(var i,r=0,s=e.length;r<s;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||e)}for(var o=function(){function t(t,e,n,i){this.left=t,this.top=e,this.width=n,this.height=i}return t.prototype.add=function(e,n,i,r){return new t(this.left+e,this.top+n,this.width+i,this.height+r)},t.fromClientRect=function(e,n){return new t(n.left+e.windowBounds.left,n.top+e.windowBounds.top,n.width,n.height)},t.fromDOMRectList=function(e,n){var i=Array.from(n).find((function(t){return 0!==t.width}));return i?new t(i.left+e.windowBounds.left,i.top+e.windowBounds.top,i.width,i.height):t.EMPTY},t.EMPTY=new t(0,0,0,0),t}(),a=function(t,e){return o.fromClientRect(t,e.getBoundingClientRect())},c=function(t){for(var e=[],n=0,i=t.length;n<i;){var r=t.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){var s=t.charCodeAt(n++);56320==(64512&s)?e.push(((1023&r)<<10)+(1023&s)+65536):(e.push(r),n--)}else e.push(r)}return e},l=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var n=t.length;if(!n)return"";for(var i=[],r=-1,s="";++r<n;){var o=t[r];o<=65535?i.push(o):(o-=65536,i.push(55296+(o>>10),o%1024+56320)),(r+1===n||i.length>16384)&&(s+=String.fromCharCode.apply(String,i),i.length=0)}return s},u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d="undefined"==typeof Uint8Array?[]:new Uint8Array(256),h=0;h<u.length;h++)d[u.charCodeAt(h)]=h;for(var A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p="undefined"==typeof Uint8Array?[]:new Uint8Array(256),f=0;f<A.length;f++)p[A.charCodeAt(f)]=f;for(var m=function(t,e,n){return t.slice?t.slice(e,n):new Uint16Array(Array.prototype.slice.call(t,e,n))},g=function(){function t(t,e,n,i,r,s){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=i,this.index=r,this.data=s}return t.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=((e=this.index[t>>5])<<2)+(31&t),this.data[e];if(t<=65535)return e=((e=this.index[2048+(t-55296>>5)])<<2)+(31&t),this.data[e];if(t<this.highStart)return e=2080+(t>>11),e=this.index[e],e+=t>>5&63,e=((e=this.index[e])<<2)+(31&t),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y="undefined"==typeof Uint8Array?[]:new Uint8Array(256),_=0;_<v.length;_++)y[v.charCodeAt(_)]=_;var b=10,E=13,w=15,S=17,T=18,C=19,R=20,I=21,x=22,O=24,L=25,M=26,k=27,N=28,P=30,D=32,B=33,U=34,F=35,H=37,V=38,j=39,G=40,Q=42,z=[9001,65288],W="Ã",K="Ã·",q=function(t,e){var n,i,r,s=function(t){var e,n,i,r,s,o=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var l="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(o):new Array(o),u=Array.isArray(l)?l:new Uint8Array(l);for(e=0;e<a;e+=4)n=p[t.charCodeAt(e)],i=p[t.charCodeAt(e+1)],r=p[t.charCodeAt(e+2)],s=p[t.charCodeAt(e+3)],u[c++]=n<<2|i>>4,u[c++]=(15&i)<<4|r>>2,u[c++]=(3&r)<<6|63&s;return l}(t),o=Array.isArray(s)?function(t){for(var e=t.length,n=[],i=0;i<e;i+=4)n.push(t[i+3]<<24|t[i+2]<<16|t[i+1]<<8|t[i]);return n}(s):new Uint32Array(s),a=Array.isArray(s)?function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n.push(t[i+1]<<8|t[i]);return n}(s):new Uint16Array(s),c=m(a,12,o[4]/2),l=2===o[5]?m(a,(24+o[4])/2):(n=o,i=Math.ceil((24+o[4])/4),n.slice?n.slice(i,r):new Uint32Array(Array.prototype.slice.call(n,i,r)));return new g(o[0],o[1],o[2],o[3],c,l)}("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),Y=[P,36],$=[1,2,3,5],X=[b,8],J=[k,M],Z=$.concat(X),tt=[V,j,G,U,F],et=[w,E],nt=function(t,e,n,i){var r=i[n];if(Array.isArray(t)?-1!==t.indexOf(r):t===r)for(var s=n;s<=i.length;){if((c=i[++s])===e)return!0;if(c!==b)break}if(r===b)for(s=n;s>0;){var o=i[--s];if(Array.isArray(t)?-1!==t.indexOf(o):t===o)for(var a=n;a<=i.length;){var c;if((c=i[++a])===e)return!0;if(c!==b)break}if(o!==b)break}return!1},it=function(t,e){for(var n=t;n>=0;){var i=e[n];if(i!==b)return i;n--}return 0},rt=function(t,e,n,i,r){if(0===n[i])return W;var s=i-1;if(Array.isArray(r)&&!0===r[s])return W;var o=s-1,a=s+1,c=e[s],l=o>=0?e[o]:0,u=e[a];if(2===c&&3===u)return W;if(-1!==$.indexOf(c))return"!";if(-1!==$.indexOf(u))return W;if(-1!==X.indexOf(u))return W;if(8===it(s,e))return K;if(11===q.get(t[s]))return W;if((c===D||c===B)&&11===q.get(t[a]))return W;if(7===c||7===u)return W;if(9===c)return W;if(-1===[b,E,w].indexOf(c)&&9===u)return W;if(-1!==[S,T,C,O,N].indexOf(u))return W;if(it(s,e)===x)return W;if(nt(23,x,s,e))return W;if(nt([S,T],I,s,e))return W;if(nt(12,12,s,e))return W;if(c===b)return K;if(23===c||23===u)return W;if(16===u||16===c)return K;if(-1!==[E,w,I].indexOf(u)||14===c)return W;if(36===l&&-1!==et.indexOf(c))return W;if(c===N&&36===u)return W;if(u===R)return W;if(-1!==Y.indexOf(u)&&c===L||-1!==Y.indexOf(c)&&u===L)return W;if(c===k&&-1!==[H,D,B].indexOf(u)||-1!==[H,D,B].indexOf(c)&&u===M)return W;if(-1!==Y.indexOf(c)&&-1!==J.indexOf(u)||-1!==J.indexOf(c)&&-1!==Y.indexOf(u))return W;if(-1!==[k,M].indexOf(c)&&(u===L||-1!==[x,w].indexOf(u)&&e[a+1]===L)||-1!==[x,w].indexOf(c)&&u===L||c===L&&-1!==[L,N,O].indexOf(u))return W;if(-1!==[L,N,O,S,T].indexOf(u))for(var d=s;d>=0;){if((h=e[d])===L)return W;if(-1===[N,O].indexOf(h))break;d--}if(-1!==[k,M].indexOf(u))for(d=-1!==[S,T].indexOf(c)?o:s;d>=0;){var h;if((h=e[d])===L)return W;if(-1===[N,O].indexOf(h))break;d--}if(V===c&&-1!==[V,j,U,F].indexOf(u)||-1!==[j,U].indexOf(c)&&-1!==[j,G].indexOf(u)||-1!==[G,F].indexOf(c)&&u===G)return W;if(-1!==tt.indexOf(c)&&-1!==[R,M].indexOf(u)||-1!==tt.indexOf(u)&&c===k)return W;if(-1!==Y.indexOf(c)&&-1!==Y.indexOf(u))return W;if(c===O&&-1!==Y.indexOf(u))return W;if(-1!==Y.concat(L).indexOf(c)&&u===x&&-1===z.indexOf(t[a])||-1!==Y.concat(L).indexOf(u)&&c===T)return W;if(41===c&&41===u){for(var A=n[s],p=1;A>0&&41===e[--A];)p++;if(p%2!=0)return W}return c===D&&u===B?W:K},st=function(t,e){e||(e={lineBreak:"normal",wordBreak:"normal"});var n=function(t,e){void 0===e&&(e="strict");var n=[],i=[],r=[];return t.forEach((function(t,s){var o=q.get(t);if(o>50?(r.push(!0),o-=50):r.push(!1),-1!==["normal","auto","loose"].indexOf(e)&&-1!==[8208,8211,12316,12448].indexOf(t))return i.push(s),n.push(16);if(4===o||11===o){if(0===s)return i.push(s),n.push(P);var a=n[s-1];return-1===Z.indexOf(a)?(i.push(i[s-1]),n.push(a)):(i.push(s),n.push(P))}return i.push(s),31===o?n.push("strict"===e?I:H):o===Q||29===o?n.push(P):43===o?t>=131072&&t<=196605||t>=196608&&t<=262141?n.push(H):n.push(P):void n.push(o)})),[i,n,r]}(t,e.lineBreak),i=n[0],r=n[1],s=n[2];"break-all"!==e.wordBreak&&"break-word"!==e.wordBreak||(r=r.map((function(t){return-1!==[L,P,Q].indexOf(t)?H:t})));var o="keep-all"===e.wordBreak?s.map((function(e,n){return e&&t[n]>=19968&&t[n]<=40959})):void 0;return[i,r,o]},ot=function(){function t(t,e,n,i){this.codePoints=t,this.required="!"===e,this.start=n,this.end=i}return t.prototype.slice=function(){return l.apply(void 0,this.codePoints.slice(this.start,this.end))},t}(),at=45,ct=43,lt=-1,ut=function(t){return t>=48&&t<=57},dt=function(t){return ut(t)||t>=65&&t<=70||t>=97&&t<=102},ht=function(t){return 10===t||9===t||32===t},At=function(t){return function(t){return function(t){return t>=97&&t<=122}(t)||function(t){return t>=65&&t<=90}(t)}(t)||function(t){return t>=128}(t)||95===t},pt=function(t){return At(t)||ut(t)||t===at},ft=function(t){return t>=0&&t<=8||11===t||t>=14&&t<=31||127===t},mt=function(t,e){return 92===t&&10!==e},gt=function(t,e,n){return t===at?At(e)||mt(e,n):!!At(t)||!(92!==t||!mt(t,e))},vt=function(t,e,n){return t===ct||t===at?!!ut(e)||46===e&&ut(n):ut(46===t?e:t)},yt=function(t){var e=0,n=1;t[e]!==ct&&t[e]!==at||(t[e]===at&&(n=-1),e++);for(var i=[];ut(t[e]);)i.push(t[e++]);var r=i.length?parseInt(l.apply(void 0,i),10):0;46===t[e]&&e++;for(var s=[];ut(t[e]);)s.push(t[e++]);var o=s.length,a=o?parseInt(l.apply(void 0,s),10):0;69!==t[e]&&101!==t[e]||e++;var c=1;t[e]!==ct&&t[e]!==at||(t[e]===at&&(c=-1),e++);for(var u=[];ut(t[e]);)u.push(t[e++]);var d=u.length?parseInt(l.apply(void 0,u),10):0;return n*(r+a*Math.pow(10,-o))*Math.pow(10,c*d)},_t={type:2},bt={type:3},Et={type:4},wt={type:13},St={type:8},Tt={type:21},Ct={type:9},Rt={type:10},It={type:11},xt={type:12},Ot={type:14},Lt={type:23},Mt={type:1},kt={type:25},Nt={type:24},Pt={type:26},Dt={type:27},Bt={type:28},Ut={type:29},Ft={type:31},Ht={type:32},Vt=function(){function t(){this._value=[]}return t.prototype.write=function(t){this._value=this._value.concat(c(t))},t.prototype.read=function(){for(var t=[],e=this.consumeToken();e!==Ht;)t.push(e),e=this.consumeToken();return t},t.prototype.consumeToken=function(){var t=this.consumeCodePoint();switch(t){case 34:return this.consumeStringToken(34);case 35:var e=this.peekCodePoint(0),n=this.peekCodePoint(1),i=this.peekCodePoint(2);if(pt(e)||mt(n,i)){var r=gt(e,n,i)?2:1;return{type:5,value:this.consumeName(),flags:r}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),wt;break;case 39:return this.consumeStringToken(39);case 40:return _t;case 41:return bt;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ot;break;case ct:if(vt(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case 44:return Et;case at:var s=t,o=this.peekCodePoint(0),a=this.peekCodePoint(1);if(vt(s,o,a))return this.reconsumeCodePoint(t),this.consumeNumericToken();if(gt(s,o,a))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();if(o===at&&62===a)return this.consumeCodePoint(),this.consumeCodePoint(),Nt;break;case 46:if(vt(t,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(t),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var c=this.consumeCodePoint();if(42===c&&47===(c=this.consumeCodePoint()))return this.consumeToken();if(c===lt)return this.consumeToken()}break;case 58:return Pt;case 59:return Dt;case 60:if(33===this.peekCodePoint(0)&&this.peekCodePoint(1)===at&&this.peekCodePoint(2)===at)return this.consumeCodePoint(),this.consumeCodePoint(),kt;break;case 64:var u=this.peekCodePoint(0),d=this.peekCodePoint(1),h=this.peekCodePoint(2);if(gt(u,d,h))return{type:7,value:this.consumeName()};break;case 91:return Bt;case 92:if(mt(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),this.consumeIdentLikeToken();break;case 93:return Ut;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),St;break;case 123:return It;case 125:return xt;case 117:case 85:var A=this.peekCodePoint(0),p=this.peekCodePoint(1);return A!==ct||!dt(p)&&63!==p||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(t),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ct;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),Tt;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Rt;break;case lt:return Ht}return ht(t)?(this.consumeWhiteSpace(),Ft):ut(t)?(this.reconsumeCodePoint(t),this.consumeNumericToken()):At(t)?(this.reconsumeCodePoint(t),this.consumeIdentLikeToken()):{type:6,value:l(t)}},t.prototype.consumeCodePoint=function(){var t=this._value.shift();return void 0===t?-1:t},t.prototype.reconsumeCodePoint=function(t){this._value.unshift(t)},t.prototype.peekCodePoint=function(t){return t>=this._value.length?-1:this._value[t]},t.prototype.consumeUnicodeRangeToken=function(){for(var t=[],e=this.consumeCodePoint();dt(e)&&t.length<6;)t.push(e),e=this.consumeCodePoint();for(var n=!1;63===e&&t.length<6;)t.push(e),e=this.consumeCodePoint(),n=!0;if(n)return{type:30,start:parseInt(l.apply(void 0,t.map((function(t){return 63===t?48:t}))),16),end:parseInt(l.apply(void 0,t.map((function(t){return 63===t?70:t}))),16)};var i=parseInt(l.apply(void 0,t),16);if(this.peekCodePoint(0)===at&&dt(this.peekCodePoint(1))){this.consumeCodePoint(),e=this.consumeCodePoint();for(var r=[];dt(e)&&r.length<6;)r.push(e),e=this.consumeCodePoint();return{type:30,start:i,end:parseInt(l.apply(void 0,r),16)}}return{type:30,start:i,end:i}},t.prototype.consumeIdentLikeToken=function(){var t=this.consumeName();return"url"===t.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:19,value:t}):{type:20,value:t}},t.prototype.consumeUrlToken=function(){var t=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===lt)return{type:22,value:""};var e=this.peekCodePoint(0);if(39===e||34===e){var n=this.consumeStringToken(this.consumeCodePoint());return 0===n.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===lt||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),Lt)}for(;;){var i=this.consumeCodePoint();if(i===lt||41===i)return{type:22,value:l.apply(void 0,t)};if(ht(i))return this.consumeWhiteSpace(),this.peekCodePoint(0)===lt||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:22,value:l.apply(void 0,t)}):(this.consumeBadUrlRemnants(),Lt);if(34===i||39===i||40===i||ft(i))return this.consumeBadUrlRemnants(),Lt;if(92===i){if(!mt(i,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),Lt;t.push(this.consumeEscapedCodePoint())}else t.push(i)}},t.prototype.consumeWhiteSpace=function(){for(;ht(this.peekCodePoint(0));)this.consumeCodePoint()},t.prototype.consumeBadUrlRemnants=function(){for(;;){var t=this.consumeCodePoint();if(41===t||t===lt)return;mt(t,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},t.prototype.consumeStringSlice=function(t){for(var e="";t>0;){var n=Math.min(5e4,t);e+=l.apply(void 0,this._value.splice(0,n)),t-=n}return this._value.shift(),e},t.prototype.consumeStringToken=function(t){for(var e="",n=0;;){var i=this._value[n];if(i===lt||void 0===i||i===t)return{type:0,value:e+=this.consumeStringSlice(n)};if(10===i)return this._value.splice(0,n),Mt;if(92===i){var r=this._value[n+1];r!==lt&&void 0!==r&&(10===r?(e+=this.consumeStringSlice(n),n=-1,this._value.shift()):mt(i,r)&&(e+=this.consumeStringSlice(n),e+=l(this.consumeEscapedCodePoint()),n=-1))}n++}},t.prototype.consumeNumber=function(){var t=[],e=4,n=this.peekCodePoint(0);for(n!==ct&&n!==at||t.push(this.consumeCodePoint());ut(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(46===n&&ut(i))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;ut(this.peekCodePoint(0));)t.push(this.consumeCodePoint());n=this.peekCodePoint(0),i=this.peekCodePoint(1);var r=this.peekCodePoint(2);if((69===n||101===n)&&((i===ct||i===at)&&ut(r)||ut(i)))for(t.push(this.consumeCodePoint(),this.consumeCodePoint()),e=8;ut(this.peekCodePoint(0));)t.push(this.consumeCodePoint());return[yt(t),e]},t.prototype.consumeNumericToken=function(){var t=this.consumeNumber(),e=t[0],n=t[1],i=this.peekCodePoint(0),r=this.peekCodePoint(1),s=this.peekCodePoint(2);return gt(i,r,s)?{type:15,number:e,flags:n,unit:this.consumeName()}:37===i?(this.consumeCodePoint(),{type:16,number:e,flags:n}):{type:17,number:e,flags:n}},t.prototype.consumeEscapedCodePoint=function(){var t=this.consumeCodePoint();if(dt(t)){for(var e=l(t);dt(this.peekCodePoint(0))&&e.length<6;)e+=l(this.consumeCodePoint());ht(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(e,16);return 0===n||function(t){return t>=55296&&t<=57343}(n)||n>1114111?65533:n}return t===lt?65533:t},t.prototype.consumeName=function(){for(var t="";;){var e=this.consumeCodePoint();if(pt(e))t+=l(e);else{if(!mt(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),t;t+=l(this.consumeEscapedCodePoint())}}},t}(),jt=function(){function t(t){this._tokens=t}return t.create=function(e){var n=new Vt;return n.write(e),new t(n.read())},t.parseValue=function(e){return t.create(e).parseComponentValue()},t.parseValues=function(e){return t.create(e).parseComponentValues()},t.prototype.parseComponentValue=function(){for(var t=this.consumeToken();31===t.type;)t=this.consumeToken();if(32===t.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(t);var e=this.consumeComponentValue();do{t=this.consumeToken()}while(31===t.type);if(32===t.type)return e;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},t.prototype.parseComponentValues=function(){for(var t=[];;){var e=this.consumeComponentValue();if(32===e.type)return t;t.push(e),t.push()}},t.prototype.consumeComponentValue=function(){var t=this.consumeToken();switch(t.type){case 11:case 28:case 2:return this.consumeSimpleBlock(t.type);case 19:return this.consumeFunction(t)}return t},t.prototype.consumeSimpleBlock=function(t){for(var e={type:t,values:[]},n=this.consumeToken();;){if(32===n.type||Xt(n,t))return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue()),n=this.consumeToken()}},t.prototype.consumeFunction=function(t){for(var e={name:t.value,values:[],type:18};;){var n=this.consumeToken();if(32===n.type||3===n.type)return e;this.reconsumeToken(n),e.values.push(this.consumeComponentValue())}},t.prototype.consumeToken=function(){var t=this._tokens.shift();return void 0===t?Ht:t},t.prototype.reconsumeToken=function(t){this._tokens.unshift(t)},t}(),Gt=function(t){return 15===t.type},Qt=function(t){return 17===t.type},zt=function(t){return 20===t.type},Wt=function(t){return 0===t.type},Kt=function(t,e){return zt(t)&&t.value===e},qt=function(t){return 31!==t.type},Yt=function(t){return 31!==t.type&&4!==t.type},$t=function(t){var e=[],n=[];return t.forEach((function(t){if(4===t.type){if(0===n.length)throw new Error("Error parsing function args, zero tokens for arg");return e.push(n),void(n=[])}31!==t.type&&n.push(t)})),n.length&&e.push(n),e},Xt=function(t,e){return 11===e&&12===t.type||(28===e&&29===t.type||2===e&&3===t.type)},Jt=function(t){return 17===t.type||15===t.type},Zt=function(t){return 16===t.type||Jt(t)},te=function(t){return t.length>1?[t[0],t[1]]:[t[0]]},ee={type:17,number:0,flags:4},ne={type:16,number:50,flags:4},ie={type:16,number:100,flags:4},re=function(t,e,n){var i=t[0],r=t[1];return[se(i,e),se(void 0!==r?r:i,n)]},se=function(t,e){if(16===t.type)return t.number/100*e;if(Gt(t))switch(t.unit){case"rem":case"em":return 16*t.number;default:return t.number}return t.number},oe="grad",ae="turn",ce=function(t,e){if(15===e.type)switch(e.unit){case"deg":return Math.PI*e.number/180;case oe:return Math.PI/200*e.number;case"rad":return e.number;case ae:return 2*Math.PI*e.number}throw new Error("Unsupported angle type")},le=function(t){return 15===t.type&&("deg"===t.unit||t.unit===oe||"rad"===t.unit||t.unit===ae)},ue=function(t){switch(t.filter(zt).map((function(t){return t.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[ee,ee];case"to top":case"bottom":return de(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[ee,ie];case"to right":case"left":return de(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[ie,ie];case"to bottom":case"top":return de(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[ie,ee];case"to left":case"right":return de(270)}return 0},de=function(t){return Math.PI*t/180},he=function(t,e){if(18===e.type){var n=_e[e.name];if(void 0===n)throw new Error('Attempting to parse an unsupported color function "'+e.name+'"');return n(t,e.values)}if(5===e.type){if(3===e.value.length){var i=e.value.substring(0,1),r=e.value.substring(1,2),s=e.value.substring(2,3);return fe(parseInt(i+i,16),parseInt(r+r,16),parseInt(s+s,16),1)}if(4===e.value.length){i=e.value.substring(0,1),r=e.value.substring(1,2),s=e.value.substring(2,3);var o=e.value.substring(3,4);return fe(parseInt(i+i,16),parseInt(r+r,16),parseInt(s+s,16),parseInt(o+o,16)/255)}if(6===e.value.length){i=e.value.substring(0,2),r=e.value.substring(2,4),s=e.value.substring(4,6);return fe(parseInt(i,16),parseInt(r,16),parseInt(s,16),1)}if(8===e.value.length){i=e.value.substring(0,2),r=e.value.substring(2,4),s=e.value.substring(4,6),o=e.value.substring(6,8);return fe(parseInt(i,16),parseInt(r,16),parseInt(s,16),parseInt(o,16)/255)}}if(20===e.type){var a=Ee[e.value.toUpperCase()];if(void 0!==a)return a}return Ee.TRANSPARENT},Ae=function(t){return 0==(255&t)},pe=function(t){var e=255&t,n=255&t>>8,i=255&t>>16,r=255&t>>24;return e<255?"rgba("+r+","+i+","+n+","+e/255+")":"rgb("+r+","+i+","+n+")"},fe=function(t,e,n,i){return(t<<24|e<<16|n<<8|Math.round(255*i)<<0)>>>0},me=function(t,e){if(17===t.type)return t.number;if(16===t.type){var n=3===e?1:255;return 3===e?t.number/100*n:Math.round(t.number/100*n)}return 0},ge=function(t,e){var n=e.filter(Yt);if(3===n.length){var i=n.map(me),r=i[0],s=i[1],o=i[2];return fe(r,s,o,1)}if(4===n.length){var a=n.map(me),c=(r=a[0],s=a[1],o=a[2],a[3]);return fe(r,s,o,c)}return 0};function ve(t,e,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(e-t)*n*6+t:n<.5?e:n<2/3?6*(e-t)*(2/3-n)+t:t}var ye=function(t,e){var n=e.filter(Yt),i=n[0],r=n[1],s=n[2],o=n[3],a=(17===i.type?de(i.number):ce(t,i))/(2*Math.PI),c=Zt(r)?r.number/100:0,l=Zt(s)?s.number/100:0,u=void 0!==o&&Zt(o)?se(o,1):1;if(0===c)return fe(255*l,255*l,255*l,1);var d=l<=.5?l*(c+1):l+c-l*c,h=2*l-d,A=ve(h,d,a+1/3),p=ve(h,d,a),f=ve(h,d,a-1/3);return fe(255*A,255*p,255*f,u)},_e={hsl:ye,hsla:ye,rgb:ge,rgba:ge},be=function(t,e){return he(t,jt.create(e).parseComponentValue())},Ee={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},we={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map((function(t){if(zt(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Se={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Te=function(t,e){var n=he(t,e[0]),i=e[1];return i&&Zt(i)?{color:n,stop:i}:{color:n,stop:null}},Ce=function(t,e){var n=t[0],i=t[t.length-1];null===n.stop&&(n.stop=ee),null===i.stop&&(i.stop=ie);for(var r=[],s=0,o=0;o<t.length;o++){var a=t[o].stop;if(null!==a){var c=se(a,e);c>s?r.push(c):r.push(s),s=c}else r.push(null)}var l=null;for(o=0;o<r.length;o++){var u=r[o];if(null===u)null===l&&(l=o);else if(null!==l){for(var d=o-l,h=(u-r[l-1])/(d+1),A=1;A<=d;A++)r[l+A-1]=h*A;l=null}}return t.map((function(t,n){return{color:t.color,stop:Math.max(Math.min(1,r[n]/e),0)}}))},Re=function(t,e,n){var i="number"==typeof t?t:function(t,e,n){var i=e/2,r=n/2,s=se(t[0],e)-i,o=r-se(t[1],n);return(Math.atan2(o,s)+2*Math.PI)%(2*Math.PI)}(t,e,n),r=Math.abs(e*Math.sin(i))+Math.abs(n*Math.cos(i)),s=e/2,o=n/2,a=r/2,c=Math.sin(i-Math.PI/2)*a,l=Math.cos(i-Math.PI/2)*a;return[r,s-l,s+l,o-c,o+c]},Ie=function(t,e){return Math.sqrt(t*t+e*e)},xe=function(t,e,n,i,r){return[[0,0],[0,e],[t,0],[t,e]].reduce((function(t,e){var s=e[0],o=e[1],a=Ie(n-s,i-o);return(r?a<t.optimumDistance:a>t.optimumDistance)?{optimumCorner:e,optimumDistance:a}:t}),{optimumDistance:r?1/0:-1/0,optimumCorner:null}).optimumCorner},Oe=function(t,e){var n=de(180),i=[];return $t(e).forEach((function(e,r){if(0===r){var s=e[0];if(20===s.type&&-1!==["top","left","right","bottom"].indexOf(s.value))return void(n=ue(e));if(le(s))return void(n=(ce(t,s)+de(270))%de(360))}var o=Te(t,e);i.push(o)})),{angle:n,stops:i,type:1}},Le="closest-side",Me="farthest-side",ke="closest-corner",Ne="farthest-corner",Pe="circle",De="ellipse",Be="cover",Ue="contain",Fe=function(t,e){var n=0,i=3,r=[],s=[];return $t(e).forEach((function(e,o){var a=!0;if(0===o?a=e.reduce((function(t,e){if(zt(e))switch(e.value){case"center":return s.push(ne),!1;case"top":case"left":return s.push(ee),!1;case"right":case"bottom":return s.push(ie),!1}else if(Zt(e)||Jt(e))return s.push(e),!1;return t}),a):1===o&&(a=e.reduce((function(t,e){if(zt(e))switch(e.value){case Pe:return n=0,!1;case De:return n=1,!1;case Ue:case Le:return i=0,!1;case Me:return i=1,!1;case ke:return i=2,!1;case Be:case Ne:return i=3,!1}else if(Jt(e)||Zt(e))return Array.isArray(i)||(i=[]),i.push(e),!1;return t}),a)),a){var c=Te(t,e);r.push(c)}})),{size:i,shape:n,stops:r,position:s,type:2}},He=function(t,e){if(22===e.type){var n={url:e.value,type:0};return t.cache.addImage(e.value),n}if(18===e.type){var i=je[e.name];if(void 0===i)throw new Error('Attempting to parse an unsupported image function "'+e.name+'"');return i(t,e.values)}throw new Error("Unsupported image type "+e.type)};var Ve,je={"linear-gradient":function(t,e){var n=de(180),i=[];return $t(e).forEach((function(e,r){if(0===r){var s=e[0];if(20===s.type&&"to"===s.value)return void(n=ue(e));if(le(s))return void(n=ce(t,s))}var o=Te(t,e);i.push(o)})),{angle:n,stops:i,type:1}},"-moz-linear-gradient":Oe,"-ms-linear-gradient":Oe,"-o-linear-gradient":Oe,"-webkit-linear-gradient":Oe,"radial-gradient":function(t,e){var n=0,i=3,r=[],s=[];return $t(e).forEach((function(e,o){var a=!0;if(0===o){var c=!1;a=e.reduce((function(t,e){if(c)if(zt(e))switch(e.value){case"center":return s.push(ne),t;case"top":case"left":return s.push(ee),t;case"right":case"bottom":return s.push(ie),t}else(Zt(e)||Jt(e))&&s.push(e);else if(zt(e))switch(e.value){case Pe:return n=0,!1;case De:return n=1,!1;case"at":return c=!0,!1;case Le:return i=0,!1;case Be:case Me:return i=1,!1;case Ue:case ke:return i=2,!1;case Ne:return i=3,!1}else if(Jt(e)||Zt(e))return Array.isArray(i)||(i=[]),i.push(e),!1;return t}),a)}if(a){var l=Te(t,e);r.push(l)}})),{size:i,shape:n,stops:r,position:s,type:2}},"-moz-radial-gradient":Fe,"-ms-radial-gradient":Fe,"-o-radial-gradient":Fe,"-webkit-radial-gradient":Fe,"-webkit-gradient":function(t,e){var n=de(180),i=[],r=1;return $t(e).forEach((function(e,n){var s=e[0];if(0===n){if(zt(s)&&"linear"===s.value)return void(r=1);if(zt(s)&&"radial"===s.value)return void(r=2)}if(18===s.type)if("from"===s.name){var o=he(t,s.values[0]);i.push({stop:ee,color:o})}else if("to"===s.name){o=he(t,s.values[0]);i.push({stop:ie,color:o})}else if("color-stop"===s.name){var a=s.values.filter(Yt);if(2===a.length){o=he(t,a[1]);var c=a[0];Qt(c)&&i.push({stop:{type:16,number:100*c.number,flags:c.flags},color:o})}}})),1===r?{angle:(n+de(180))%de(360),stops:i,type:r}:{size:3,shape:0,stops:i,position:[],type:r}}},Ge={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(0===e.length)return[];var n=e[0];return 20===n.type&&"none"===n.value?[]:e.filter((function(t){return Yt(t)&&function(t){return!(20===t.type&&"none"===t.value||18===t.type&&!je[t.name])}(t)})).map((function(e){return He(t,e)}))}},Qe={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(t,e){return e.map((function(t){if(zt(t))switch(t.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},ze={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(t,e){return $t(e).map((function(t){return t.filter(Zt)})).map(te)}},We={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(t,e){return $t(e).map((function(t){return t.filter(zt).map((function(t){return t.value})).join(" ")})).map(Ke)}},Ke=function(t){switch(t){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(t){t.AUTO="auto",t.CONTAIN="contain",t.COVER="cover"}(Ve||(Ve={}));var qe,Ye={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(t,e){return $t(e).map((function(t){return t.filter($e)}))}},$e=function(t){return zt(t)||Zt(t)},Xe=function(t){return{name:"border-"+t+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Je=Xe("top"),Ze=Xe("right"),tn=Xe("bottom"),en=Xe("left"),nn=function(t){return{name:"border-radius-"+t,initialValue:"0 0",prefix:!1,type:1,parse:function(t,e){return te(e.filter(Zt))}}},rn=nn("top-left"),sn=nn("top-right"),on=nn("bottom-right"),an=nn("bottom-left"),cn=function(t){return{name:"border-"+t+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(t,e){switch(e){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},ln=cn("top"),un=cn("right"),dn=cn("bottom"),hn=cn("left"),An=function(t){return{name:"border-"+t+"-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Gt(e)?e.number:0}}},pn=An("top"),fn=An("right"),mn=An("bottom"),gn=An("left"),vn={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},yn={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(t,e){return"rtl"===e?1:0}},_n={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(t,e){return e.filter(zt).reduce((function(t,e){return t|bn(e.value)}),0)}},bn=function(t){switch(t){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},En={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},wn={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(t,e){return 20===e.type&&"normal"===e.value?0:17===e.type||15===e.type?e.number:0}};!function(t){t.NORMAL="normal",t.STRICT="strict"}(qe||(qe={}));var Sn,Tn={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){return"strict"===e?qe.STRICT:qe.NORMAL}},Cn={name:"line-height",initialValue:"normal",prefix:!1,type:4},Rn=function(t,e){return zt(t)&&"normal"===t.value?1.2*e:17===t.type?e*t.number:Zt(t)?se(t,e):e},In={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(t,e){return 20===e.type&&"none"===e.value?null:He(t,e)}},xn={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(t,e){return"inside"===e?0:1}},On={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},Ln=function(t){return{name:"margin-"+t,initialValue:"0",prefix:!1,type:4}},Mn=Ln("top"),kn=Ln("right"),Nn=Ln("bottom"),Pn=Ln("left"),Dn={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(t,e){return e.filter(zt).map((function(t){switch(t.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}}))}},Bn={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){return"break-word"===e?"break-word":"normal"}},Un=function(t){return{name:"padding-"+t,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Fn=Un("top"),Hn=Un("right"),Vn=Un("bottom"),jn=Un("left"),Gn={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(t,e){switch(e){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Qn={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(t,e){switch(e){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},zn={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return 1===e.length&&Kt(e[0],"none")?[]:$t(e).map((function(e){for(var n={color:Ee.TRANSPARENT,offsetX:ee,offsetY:ee,blur:ee},i=0,r=0;r<e.length;r++){var s=e[r];Jt(s)?(0===i?n.offsetX=s:1===i?n.offsetY=s:n.blur=s,i++):n.color=he(t,s)}return n}))}},Wn={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Kn={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(t,e){if(20===e.type&&"none"===e.value)return null;if(18===e.type){var n=qn[e.name];if(void 0===n)throw new Error('Attempting to parse an unsupported transform function "'+e.name+'"');return n(e.values)}return null}},qn={matrix:function(t){var e=t.filter((function(t){return 17===t.type})).map((function(t){return t.number}));return 6===e.length?e:null},matrix3d:function(t){var e=t.filter((function(t){return 17===t.type})).map((function(t){return t.number})),n=e[0],i=e[1];e[2],e[3];var r=e[4],s=e[5];e[6],e[7],e[8],e[9],e[10],e[11];var o=e[12],a=e[13];return e[14],e[15],16===e.length?[n,i,r,s,o,a]:null}},Yn={type:16,number:50,flags:4},$n=[Yn,Yn],Xn={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(t,e){var n=e.filter(Zt);return 2!==n.length?$n:[n[0],n[1]]}},Jn={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(t,e){switch(e){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(t){t.NORMAL="normal",t.BREAK_ALL="break-all",t.KEEP_ALL="keep-all"}(Sn||(Sn={}));for(var Zn={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"break-all":return Sn.BREAK_ALL;case"keep-all":return Sn.KEEP_ALL;default:return Sn.NORMAL}}},ti={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(t,e){if(20===e.type)return{auto:!0,order:0};if(Qt(e))return{auto:!1,order:e.number};throw new Error("Invalid z-index number parsed")}},ei=function(t,e){if(15===e.type)switch(e.unit.toLowerCase()){case"s":return 1e3*e.number;case"ms":return e.number}throw new Error("Unsupported time type")},ni={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(t,e){return Qt(e)?e.number:1}},ii={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},ri={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(t,e){return e.filter(zt).map((function(t){switch(t.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(t){return 0!==t}))}},si={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(t,e){var n=[],i=[];return e.forEach((function(t){switch(t.type){case 20:case 0:n.push(t.value);break;case 17:n.push(t.number.toString());break;case 4:i.push(n.join(" ")),n.length=0}})),n.length&&i.push(n.join(" ")),i.map((function(t){return-1===t.indexOf(" ")?t:"'"+t+"'"}))}},oi={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},ai={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(t,e){return Qt(e)?e.number:zt(e)&&"bold"===e.value?700:400}},ci={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return e.filter(zt).map((function(t){return t.value}))}},li={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(t,e){switch(e){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},ui=function(t,e){return 0!=(t&e)},di={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(t,e){if(0===e.length)return[];var n=e[0];return 20===n.type&&"none"===n.value?[]:e}},hi={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return null;var n=e[0];if(20===n.type&&"none"===n.value)return null;for(var i=[],r=e.filter(qt),s=0;s<r.length;s++){var o=r[s],a=r[s+1];if(20===o.type){var c=a&&Qt(a)?a.number:1;i.push({counter:o.value,increment:c})}}return i}},Ai={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return[];for(var n=[],i=e.filter(qt),r=0;r<i.length;r++){var s=i[r],o=i[r+1];if(zt(s)&&"none"!==s.value){var a=o&&Qt(o)?o.number:0;n.push({counter:s.value,reset:a})}}return n}},pi={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(t,e){return e.filter(Gt).map((function(e){return ei(t,e)}))}},fi={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(t,e){if(0===e.length)return null;var n=e[0];if(20===n.type&&"none"===n.value)return null;var i=[],r=e.filter(Wt);if(r.length%2!=0)return null;for(var s=0;s<r.length;s+=2){var o=r[s].value,a=r[s+1].value;i.push({open:o,close:a})}return i}},mi=function(t,e,n){if(!t)return"";var i=t[Math.min(e,t.length-1)];return i?n?i.open:i.close:""},gi={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(t,e){return 1===e.length&&Kt(e[0],"none")?[]:$t(e).map((function(e){for(var n={color:255,offsetX:ee,offsetY:ee,blur:ee,spread:ee,inset:!1},i=0,r=0;r<e.length;r++){var s=e[r];Kt(s,"inset")?n.inset=!0:Jt(s)?(0===i?n.offsetX=s:1===i?n.offsetY=s:2===i?n.blur=s:n.spread=s,i++):n.color=he(t,s)}return n}))}},vi={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(t,e){var n=[];return e.filter(zt).forEach((function(t){switch(t.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2)}})),[0,1,2].forEach((function(t){-1===n.indexOf(t)&&n.push(t)})),n}},yi={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},_i={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(t,e){return Gt(e)?e.number:0}},bi=function(){function t(t,e){var n,i;this.animationDuration=Si(t,pi,e.animationDuration),this.backgroundClip=Si(t,we,e.backgroundClip),this.backgroundColor=Si(t,Se,e.backgroundColor),this.backgroundImage=Si(t,Ge,e.backgroundImage),this.backgroundOrigin=Si(t,Qe,e.backgroundOrigin),this.backgroundPosition=Si(t,ze,e.backgroundPosition),this.backgroundRepeat=Si(t,We,e.backgroundRepeat),this.backgroundSize=Si(t,Ye,e.backgroundSize),this.borderTopColor=Si(t,Je,e.borderTopColor),this.borderRightColor=Si(t,Ze,e.borderRightColor),this.borderBottomColor=Si(t,tn,e.borderBottomColor),this.borderLeftColor=Si(t,en,e.borderLeftColor),this.borderTopLeftRadius=Si(t,rn,e.borderTopLeftRadius),this.borderTopRightRadius=Si(t,sn,e.borderTopRightRadius),this.borderBottomRightRadius=Si(t,on,e.borderBottomRightRadius),this.borderBottomLeftRadius=Si(t,an,e.borderBottomLeftRadius),this.borderTopStyle=Si(t,ln,e.borderTopStyle),this.borderRightStyle=Si(t,un,e.borderRightStyle),this.borderBottomStyle=Si(t,dn,e.borderBottomStyle),this.borderLeftStyle=Si(t,hn,e.borderLeftStyle),this.borderTopWidth=Si(t,pn,e.borderTopWidth),this.borderRightWidth=Si(t,fn,e.borderRightWidth),this.borderBottomWidth=Si(t,mn,e.borderBottomWidth),this.borderLeftWidth=Si(t,gn,e.borderLeftWidth),this.boxShadow=Si(t,gi,e.boxShadow),this.color=Si(t,vn,e.color),this.direction=Si(t,yn,e.direction),this.display=Si(t,_n,e.display),this.float=Si(t,En,e.cssFloat),this.fontFamily=Si(t,si,e.fontFamily),this.fontSize=Si(t,oi,e.fontSize),this.fontStyle=Si(t,li,e.fontStyle),this.fontVariant=Si(t,ci,e.fontVariant),this.fontWeight=Si(t,ai,e.fontWeight),this.letterSpacing=Si(t,wn,e.letterSpacing),this.lineBreak=Si(t,Tn,e.lineBreak),this.lineHeight=Si(t,Cn,e.lineHeight),this.listStyleImage=Si(t,In,e.listStyleImage),this.listStylePosition=Si(t,xn,e.listStylePosition),this.listStyleType=Si(t,On,e.listStyleType),this.marginTop=Si(t,Mn,e.marginTop),this.marginRight=Si(t,kn,e.marginRight),this.marginBottom=Si(t,Nn,e.marginBottom),this.marginLeft=Si(t,Pn,e.marginLeft),this.opacity=Si(t,ni,e.opacity);var r=Si(t,Dn,e.overflow);this.overflowX=r[0],this.overflowY=r[r.length>1?1:0],this.overflowWrap=Si(t,Bn,e.overflowWrap),this.paddingTop=Si(t,Fn,e.paddingTop),this.paddingRight=Si(t,Hn,e.paddingRight),this.paddingBottom=Si(t,Vn,e.paddingBottom),this.paddingLeft=Si(t,jn,e.paddingLeft),this.paintOrder=Si(t,vi,e.paintOrder),this.position=Si(t,Qn,e.position),this.textAlign=Si(t,Gn,e.textAlign),this.textDecorationColor=Si(t,ii,null!==(n=e.textDecorationColor)&&void 0!==n?n:e.color),this.textDecorationLine=Si(t,ri,null!==(i=e.textDecorationLine)&&void 0!==i?i:e.textDecoration),this.textShadow=Si(t,zn,e.textShadow),this.textTransform=Si(t,Wn,e.textTransform),this.transform=Si(t,Kn,e.transform),this.transformOrigin=Si(t,Xn,e.transformOrigin),this.visibility=Si(t,Jn,e.visibility),this.webkitTextStrokeColor=Si(t,yi,e.webkitTextStrokeColor),this.webkitTextStrokeWidth=Si(t,_i,e.webkitTextStrokeWidth),this.wordBreak=Si(t,Zn,e.wordBreak),this.zIndex=Si(t,ti,e.zIndex)}return t.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},t.prototype.isTransparent=function(){return Ae(this.backgroundColor)},t.prototype.isTransformed=function(){return null!==this.transform},t.prototype.isPositioned=function(){return 0!==this.position},t.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},t.prototype.isFloating=function(){return 0!==this.float},t.prototype.isInlineLevel=function(){return ui(this.display,4)||ui(this.display,33554432)||ui(this.display,268435456)||ui(this.display,536870912)||ui(this.display,67108864)||ui(this.display,134217728)},t}(),Ei=function(t,e){this.content=Si(t,di,e.content),this.quotes=Si(t,fi,e.quotes)},wi=function(t,e){this.counterIncrement=Si(t,hi,e.counterIncrement),this.counterReset=Si(t,Ai,e.counterReset)},Si=function(t,e,n){var i=new Vt,r=null!=n?n.toString():e.initialValue;i.write(r);var s=new jt(i.read());switch(e.type){case 2:var o=s.parseComponentValue();return e.parse(t,zt(o)?o.value:e.initialValue);case 0:return e.parse(t,s.parseComponentValue());case 1:return e.parse(t,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(e.format){case"angle":return ce(t,s.parseComponentValue());case"color":return he(t,s.parseComponentValue());case"image":return He(t,s.parseComponentValue());case"length":var a=s.parseComponentValue();return Jt(a)?a:ee;case"length-percentage":var c=s.parseComponentValue();return Zt(c)?c:ee;case"time":return ei(t,s.parseComponentValue())}}},Ti=function(t,e){var n=function(t){switch(t.getAttribute("data-html2canvas-debug")){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}}(t);return 1===n||e===n},Ci=function(t,e){this.context=t,this.textNodes=[],this.elements=[],this.flags=0,Ti(e,3),this.styles=new bi(t,window.getComputedStyle(e,null)),Or(e)&&(this.styles.animationDuration.some((function(t){return t>0}))&&(e.style.animationDuration="0s"),null!==this.styles.transform&&(e.style.transform="none")),this.bounds=a(this.context,e),Ti(e,4)&&(this.flags|=16)},Ri="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ii="undefined"==typeof Uint8Array?[]:new Uint8Array(256),xi=0;xi<Ri.length;xi++)Ii[Ri.charCodeAt(xi)]=xi;for(var Oi=function(t,e,n){return t.slice?t.slice(e,n):new Uint16Array(Array.prototype.slice.call(t,e,n))},Li=function(){function t(t,e,n,i,r,s){this.initialValue=t,this.errorValue=e,this.highStart=n,this.highValueIndex=i,this.index=r,this.data=s}return t.prototype.get=function(t){var e;if(t>=0){if(t<55296||t>56319&&t<=65535)return e=((e=this.index[t>>5])<<2)+(31&t),this.data[e];if(t<=65535)return e=((e=this.index[2048+(t-55296>>5)])<<2)+(31&t),this.data[e];if(t<this.highStart)return e=2080+(t>>11),e=this.index[e],e+=t>>5&63,e=((e=this.index[e])<<2)+(31&t),this.data[e];if(t<=1114111)return this.data[this.highValueIndex]}return this.errorValue},t}(),Mi="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ki="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ni=0;Ni<Mi.length;Ni++)ki[Mi.charCodeAt(Ni)]=Ni;var Pi,Di=8,Bi=9,Ui=11,Fi=12,Hi=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(String.fromCodePoint)return String.fromCodePoint.apply(String,t);var n=t.length;if(!n)return"";for(var i=[],r=-1,s="";++r<n;){var o=t[r];o<=65535?i.push(o):(o-=65536,i.push(55296+(o>>10),o%1024+56320)),(r+1===n||i.length>16384)&&(s+=String.fromCharCode.apply(String,i),i.length=0)}return s},Vi=function(t,e){var n,i,r,s=function(t){var e,n,i,r,s,o=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);var l="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(o):new Array(o),u=Array.isArray(l)?l:new Uint8Array(l);for(e=0;e<a;e+=4)n=Ii[t.charCodeAt(e)],i=Ii[t.charCodeAt(e+1)],r=Ii[t.charCodeAt(e+2)],s=Ii[t.charCodeAt(e+3)],u[c++]=n<<2|i>>4,u[c++]=(15&i)<<4|r>>2,u[c++]=(3&r)<<6|63&s;return l}(t),o=Array.isArray(s)?function(t){for(var e=t.length,n=[],i=0;i<e;i+=4)n.push(t[i+3]<<24|t[i+2]<<16|t[i+1]<<8|t[i]);return n}(s):new Uint32Array(s),a=Array.isArray(s)?function(t){for(var e=t.length,n=[],i=0;i<e;i+=2)n.push(t[i+1]<<8|t[i]);return n}(s):new Uint16Array(s),c=Oi(a,12,o[4]/2),l=2===o[5]?Oi(a,(24+o[4])/2):(n=o,i=Math.ceil((24+o[4])/4),n.slice?n.slice(i,r):new Uint32Array(Array.prototype.slice.call(n,i,r)));return new Li(o[0],o[1],o[2],o[3],c,l)}("AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA="),ji="Ã",Gi=function(t){return Vi.get(t)},Qi=function(t,e,n){var i=n-2,r=e[i],s=e[n-1],o=e[n];if(2===s&&3===o)return ji;if(2===s||3===s||4===s)return"Ã·";if(2===o||3===o||4===o)return"Ã·";if(s===Di&&-1!==[Di,Bi,Ui,Fi].indexOf(o))return ji;if(!(s!==Ui&&s!==Bi||o!==Bi&&10!==o))return ji;if((s===Fi||10===s)&&10===o)return ji;if(13===o||5===o)return ji;if(7===o)return ji;if(1===s)return ji;if(13===s&&14===o){for(;5===r;)r=e[--i];if(14===r)return ji}if(15===s&&15===o){for(var a=0;15===r;)a++,r=e[--i];if(a%2==0)return ji}return"Ã·"},zi=function(t){var e=function(t){for(var e=[],n=0,i=t.length;n<i;){var r=t.charCodeAt(n++);if(r>=55296&&r<=56319&&n<i){var s=t.charCodeAt(n++);56320==(64512&s)?e.push(((1023&r)<<10)+(1023&s)+65536):(e.push(r),n--)}else e.push(r)}return e}(t),n=e.length,i=0,r=0,s=e.map(Gi);return{next:function(){if(i>=n)return{done:!0,value:null};for(var t=ji;i<n&&(t=Qi(0,s,++i))===ji;);if(t!==ji||i===n){var o=Hi.apply(null,e.slice(r,i));return r=i,{value:o,done:!1}}return{done:!0,value:null}}}},Wi=function(t){return 0===t[0]&&255===t[1]&&0===t[2]&&255===t[3]},Ki=function(t,e,n,i,r){var s="http://www.w3.org/2000/svg",o=document.createElementNS(s,"svg"),a=document.createElementNS(s,"foreignObject");return o.setAttributeNS(null,"width",t.toString()),o.setAttributeNS(null,"height",e.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",n.toString()),a.setAttributeNS(null,"y",i.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),o.appendChild(a),a.appendChild(r),o},qi=function(t){return new Promise((function(e,n){var i=new Image;i.onload=function(){return e(i)},i.onerror=n,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(t))}))},Yi={get SUPPORT_RANGE_BOUNDS(){var t=function(t){if(t.createRange){var e=t.createRange();if(e.getBoundingClientRect){var n=t.createElement("boundtest");n.style.height="123px",n.style.display="block",t.body.appendChild(n),e.selectNode(n);var i=e.getBoundingClientRect(),r=Math.round(i.height);if(t.body.removeChild(n),123===r)return!0}}return!1}(document);return Object.defineProperty(Yi,"SUPPORT_RANGE_BOUNDS",{value:t}),t},get SUPPORT_WORD_BREAKING(){var t=Yi.SUPPORT_RANGE_BOUNDS&&function(t){var e=t.createElement("boundtest");e.style.width="50px",e.style.display="block",e.style.fontSize="12px",e.style.letterSpacing="0px",e.style.wordSpacing="0px",t.body.appendChild(e);var n=t.createRange();e.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var i=e.firstChild,r=c(i.data).map((function(t){return l(t)})),s=0,o={},a=r.every((function(t,e){n.setStart(i,s),n.setEnd(i,s+t.length);var r=n.getBoundingClientRect();s+=t.length;var a=r.x>o.x||r.y>o.y;return o=r,0===e||a}));return t.body.removeChild(e),a}(document);return Object.defineProperty(Yi,"SUPPORT_WORD_BREAKING",{value:t}),t},get SUPPORT_SVG_DRAWING(){var t=function(t){var e=new Image,n=t.createElement("canvas"),i=n.getContext("2d");if(!i)return!1;e.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{i.drawImage(e,0,0),n.toDataURL()}catch(t){return!1}return!0}(document);return Object.defineProperty(Yi,"SUPPORT_SVG_DRAWING",{value:t}),t},get SUPPORT_FOREIGNOBJECT_DRAWING(){var t="function"==typeof Array.from&&"function"==typeof window.fetch?function(t){var e=t.createElement("canvas"),n=100;e.width=n,e.height=n;var i=e.getContext("2d");if(!i)return Promise.reject(!1);i.fillStyle="rgb(0, 255, 0)",i.fillRect(0,0,n,n);var r=new Image,s=e.toDataURL();r.src=s;var o=Ki(n,n,0,0,r);return i.fillStyle="red",i.fillRect(0,0,n,n),qi(o).then((function(e){i.drawImage(e,0,0);var r=i.getImageData(0,0,n,n).data;i.fillStyle="red",i.fillRect(0,0,n,n);var o=t.createElement("div");return o.style.backgroundImage="url("+s+")",o.style.height="100px",Wi(r)?qi(Ki(n,n,0,0,o)):Promise.reject(!1)})).then((function(t){return i.drawImage(t,0,0),Wi(i.getImageData(0,0,n,n).data)})).catch((function(){return!1}))}(document):Promise.resolve(!1);return Object.defineProperty(Yi,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:t}),t},get SUPPORT_CORS_IMAGES(){var t=void 0!==(new Image).crossOrigin;return Object.defineProperty(Yi,"SUPPORT_CORS_IMAGES",{value:t}),t},get SUPPORT_RESPONSE_TYPE(){var t="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Yi,"SUPPORT_RESPONSE_TYPE",{value:t}),t},get SUPPORT_CORS_XHR(){var t="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Yi,"SUPPORT_CORS_XHR",{value:t}),t},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var t=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(Yi,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:t}),t}},$i=function(t,e){this.text=t,this.bounds=e},Xi=function(t,e){var n=e.ownerDocument;if(n){var i=n.createElement("html2canvaswrapper");i.appendChild(e.cloneNode(!0));var r=e.parentNode;if(r){r.replaceChild(i,e);var s=a(t,i);return i.firstChild&&r.replaceChild(i.firstChild,i),s}}return o.EMPTY},Ji=function(t,e,n){var i=t.ownerDocument;if(!i)throw new Error("Node has no owner document");var r=i.createRange();return r.setStart(t,e),r.setEnd(t,e+n),r},Zi=function(t){if(Yi.SUPPORT_NATIVE_TEXT_SEGMENTATION){var e=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(e.segment(t)).map((function(t){return t.segment}))}return function(t){for(var e,n=zi(t),i=[];!(e=n.next()).done;)e.value&&i.push(e.value.slice());return i}(t)},tr=function(t,e){return 0!==e.letterSpacing?Zi(t):function(t,e){if(Yi.SUPPORT_NATIVE_TEXT_SEGMENTATION){var n=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(n.segment(t)).map((function(t){return t.segment}))}return nr(t,e)}(t,e)},er=[32,160,4961,65792,65793,4153,4241],nr=function(t,e){for(var n,i=function(t,e){var n=c(t),i=st(n,e),r=i[0],s=i[1],o=i[2],a=n.length,l=0,u=0;return{next:function(){if(u>=a)return{done:!0,value:null};for(var t=W;u<a&&(t=rt(n,s,r,++u,o))===W;);if(t!==W||u===a){var e=new ot(n,t,l,u);return l=u,{value:e,done:!1}}return{done:!0,value:null}}}}(t,{lineBreak:e.lineBreak,wordBreak:"break-word"===e.overflowWrap?"break-word":e.wordBreak}),r=[],s=function(){if(n.value){var t=n.value.slice(),e=c(t),i="";e.forEach((function(t){-1===er.indexOf(t)?i+=l(t):(i.length&&r.push(i),r.push(l(t)),i="")})),i.length&&r.push(i)}};!(n=i.next()).done;)s();return r},ir=function(t,e,n){this.text=rr(e.data,n.textTransform),this.textBounds=function(t,e,n,i){var r=tr(e,n),s=[],a=0;return r.forEach((function(e){if(n.textDecorationLine.length||e.trim().length>0)if(Yi.SUPPORT_RANGE_BOUNDS){var r=Ji(i,a,e.length).getClientRects();if(r.length>1){var c=Zi(e),l=0;c.forEach((function(e){s.push(new $i(e,o.fromDOMRectList(t,Ji(i,l+a,e.length).getClientRects()))),l+=e.length}))}else s.push(new $i(e,o.fromDOMRectList(t,r)))}else{var u=i.splitText(e.length);s.push(new $i(e,Xi(t,i))),i=u}else Yi.SUPPORT_RANGE_BOUNDS||(i=i.splitText(e.length));a+=e.length})),s}(t,this.text,n,e)},rr=function(t,e){switch(e){case 1:return t.toLowerCase();case 3:return t.replace(sr,or);case 2:return t.toUpperCase();default:return t}},sr=/(^|\s|:|-|\(|\))([a-z])/g,or=function(t,e,n){return t.length>0?e+n.toUpperCase():t},ar=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.src=n.currentSrc||n.src,i.intrinsicWidth=n.naturalWidth,i.intrinsicHeight=n.naturalHeight,i.context.cache.addImage(i.src),i}return e(n,t),n}(Ci),cr=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.canvas=n,i.intrinsicWidth=n.width,i.intrinsicHeight=n.height,i}return e(n,t),n}(Ci),lr=function(t){function n(e,n){var i=t.call(this,e,n)||this,r=new XMLSerializer,s=a(e,n);return n.setAttribute("width",s.width+"px"),n.setAttribute("height",s.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(n)),i.intrinsicWidth=n.width.baseVal.value,i.intrinsicHeight=n.height.baseVal.value,i.context.cache.addImage(i.svg),i}return e(n,t),n}(Ci),ur=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.value=n.value,i}return e(n,t),n}(Ci),dr=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.start=n.start,i.reversed="boolean"==typeof n.reversed&&!0===n.reversed,i}return e(n,t),n}(Ci),hr=[{type:15,flags:0,unit:"px",number:3}],Ar=[{type:16,flags:0,number:50}],pr="checkbox",fr="radio",mr="password",gr=707406591,vr=function(t){function n(e,n){var i,r,s,a=t.call(this,e,n)||this;switch(a.type=n.type.toLowerCase(),a.checked=n.checked,a.value=0===(r=(i=n).type===mr?new Array(i.value.length+1).join("â¢"):i.value).length?i.placeholder||"":r,a.type!==pr&&a.type!==fr||(a.styles.backgroundColor=3739148031,a.styles.borderTopColor=a.styles.borderRightColor=a.styles.borderBottomColor=a.styles.borderLeftColor=2779096575,a.styles.borderTopWidth=a.styles.borderRightWidth=a.styles.borderBottomWidth=a.styles.borderLeftWidth=1,a.styles.borderTopStyle=a.styles.borderRightStyle=a.styles.borderBottomStyle=a.styles.borderLeftStyle=1,a.styles.backgroundClip=[0],a.styles.backgroundOrigin=[0],a.bounds=(s=a.bounds).width>s.height?new o(s.left+(s.width-s.height)/2,s.top,s.height,s.height):s.width<s.height?new o(s.left,s.top+(s.height-s.width)/2,s.width,s.width):s),a.type){case pr:a.styles.borderTopRightRadius=a.styles.borderTopLeftRadius=a.styles.borderBottomRightRadius=a.styles.borderBottomLeftRadius=hr;break;case fr:a.styles.borderTopRightRadius=a.styles.borderTopLeftRadius=a.styles.borderBottomRightRadius=a.styles.borderBottomLeftRadius=Ar}return a}return e(n,t),n}(Ci),yr=function(t){function n(e,n){var i=t.call(this,e,n)||this,r=n.options[n.selectedIndex||0];return i.value=r&&r.text||"",i}return e(n,t),n}(Ci),_r=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.value=n.value,i}return e(n,t),n}(Ci),br=function(t){function n(e,n){var i=t.call(this,e,n)||this;i.src=n.src,i.width=parseInt(n.width,10)||0,i.height=parseInt(n.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){i.tree=Tr(e,n.contentWindow.document.documentElement);var r=n.contentWindow.document.documentElement?be(e,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):Ee.TRANSPARENT,s=n.contentWindow.document.body?be(e,getComputedStyle(n.contentWindow.document.body).backgroundColor):Ee.TRANSPARENT;i.backgroundColor=Ae(r)?Ae(s)?i.styles.backgroundColor:s:r}}catch(t){}return i}return e(n,t),n}(Ci),Er=["OL","UL","MENU"],wr=function(t,e,n,i){for(var r=e.firstChild,s=void 0;r;r=s)if(s=r.nextSibling,Ir(r)&&r.data.trim().length>0)n.textNodes.push(new ir(t,r,n.styles));else if(xr(r))if(Qr(r)&&r.assignedNodes)r.assignedNodes().forEach((function(e){return wr(t,e,n,i)}));else{var o=Sr(t,r);o.styles.isVisible()&&(Cr(r,o,i)?o.flags|=4:Rr(o.styles)&&(o.flags|=2),-1!==Er.indexOf(r.tagName)&&(o.flags|=8),n.elements.push(o),r.slot,r.shadowRoot?wr(t,r.shadowRoot,o,i):jr(r)||Pr(r)||Gr(r)||wr(t,r,o,i))}},Sr=function(t,e){return Fr(e)?new ar(t,e):Br(e)?new cr(t,e):Pr(e)?new lr(t,e):Mr(e)?new ur(t,e):kr(e)?new dr(t,e):Nr(e)?new vr(t,e):Gr(e)?new yr(t,e):jr(e)?new _r(t,e):Hr(e)?new br(t,e):new Ci(t,e)},Tr=function(t,e){var n=Sr(t,e);return n.flags|=4,wr(t,e,n,n),n},Cr=function(t,e,n){return e.styles.isPositionedWithZIndex()||e.styles.opacity<1||e.styles.isTransformed()||Dr(t)&&n.styles.isTransparent()},Rr=function(t){return t.isPositioned()||t.isFloating()},Ir=function(t){return t.nodeType===Node.TEXT_NODE},xr=function(t){return t.nodeType===Node.ELEMENT_NODE},Or=function(t){return xr(t)&&void 0!==t.style&&!Lr(t)},Lr=function(t){return"object"==typeof t.className},Mr=function(t){return"LI"===t.tagName},kr=function(t){return"OL"===t.tagName},Nr=function(t){return"INPUT"===t.tagName},Pr=function(t){return"svg"===t.tagName},Dr=function(t){return"BODY"===t.tagName},Br=function(t){return"CANVAS"===t.tagName},Ur=function(t){return"VIDEO"===t.tagName},Fr=function(t){return"IMG"===t.tagName},Hr=function(t){return"IFRAME"===t.tagName},Vr=function(t){return"STYLE"===t.tagName},jr=function(t){return"TEXTAREA"===t.tagName},Gr=function(t){return"SELECT"===t.tagName},Qr=function(t){return"SLOT"===t.tagName},zr=function(t){return t.tagName.indexOf("-")>0},Wr=function(){function t(){this.counters={}}return t.prototype.getCounterValue=function(t){var e=this.counters[t];return e&&e.length?e[e.length-1]:1},t.prototype.getCounterValues=function(t){var e=this.counters[t];return e||[]},t.prototype.pop=function(t){var e=this;t.forEach((function(t){return e.counters[t].pop()}))},t.prototype.parse=function(t){var e=this,n=t.counterIncrement,i=t.counterReset,r=!0;null!==n&&n.forEach((function(t){var n=e.counters[t.counter];n&&0!==t.increment&&(r=!1,n.length||n.push(1),n[Math.max(0,n.length-1)]+=t.increment)}));var s=[];return r&&i.forEach((function(t){var n=e.counters[t.counter];s.push(t.counter),n||(n=e.counters[t.counter]=[]),n.push(t.reset)})),s},t}(),Kr={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},qr={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Ô¿","Ô¾","Ô½","Ô¼","Ô»","Ôº","Ô¹","Ô¸","Ô·","Ô¶","Ôµ","Ô´","Ô³","Ô²","Ô±"]},Yr={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["××³","××³","××³","××³","××³","××³","××³","××³","××³","××³","×ª","×©","×¨","×§","×¦","×¤","×¢","×¡","× ","×","×","×","××","××","××","××","××","×","×","×","×","×","×","×","×","×","×"]},$r={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["áµ","á°","á¯","á´","á®","á­","á¬","á«","áª","á©","á¨","á§","á¦","á¥","á¤","á³","á¢","á¡","á ","á","á","á","á²","á","á","á","á","á","á","á±","á","á","á","á","á","á","á"]},Xr=function(t,e,n,i,r,s){return t<e||t>n?os(t,r,s.length>0):i.integers.reduce((function(e,n,r){for(;t>=n;)t-=n,e+=i.values[r];return e}),"")+s},Jr=function(t,e,n,i){var r="";do{n||t--,r=i(t)+r,t/=e}while(t*e>=e);return r},Zr=function(t,e,n,i,r){var s=n-e+1;return(t<0?"-":"")+(Jr(Math.abs(t),s,i,(function(t){return l(Math.floor(t%s)+e)}))+r)},ts=function(t,e,n){void 0===n&&(n=". ");var i=e.length;return Jr(Math.abs(t),i,!1,(function(t){return e[Math.floor(t%i)]}))+n},es=function(t,e,n,i,r,s){if(t<-9999||t>9999)return os(t,4,r.length>0);var o=Math.abs(t),a=r;if(0===o)return e[0]+a;for(var c=0;o>0&&c<=4;c++){var l=o%10;0===l&&ui(s,1)&&""!==a?a=e[l]+a:l>1||1===l&&0===c||1===l&&1===c&&ui(s,2)||1===l&&1===c&&ui(s,4)&&t>100||1===l&&c>1&&ui(s,8)?a=e[l]+(c>0?n[c-1]:"")+a:1===l&&c>0&&(a=n[c-1]+a),o=Math.floor(o/10)}return(t<0?i:"")+a},ns="åç¾åè¬",is="æ¾ä½°ä»è¬",rs="ãã¤ãã¹",ss="ë§ì´ëì¤",os=function(t,e,n){var i=n?". ":"",r=n?"ã":"",s=n?", ":"",o=n?" ":"";switch(e){case 0:return"â¢"+o;case 1:return"â¦"+o;case 2:return"â¾"+o;case 5:var a=Zr(t,48,57,!0,i);return a.length<4?"0"+a:a;case 4:return ts(t,"ãä¸äºä¸åäºå­ä¸å«ä¹",r);case 6:return Xr(t,1,3999,Kr,3,i).toLowerCase();case 7:return Xr(t,1,3999,Kr,3,i);case 8:return Zr(t,945,969,!1,i);case 9:return Zr(t,97,122,!1,i);case 10:return Zr(t,65,90,!1,i);case 11:return Zr(t,1632,1641,!0,i);case 12:case 49:return Xr(t,1,9999,qr,3,i);case 35:return Xr(t,1,9999,qr,3,i).toLowerCase();case 13:return Zr(t,2534,2543,!0,i);case 14:case 30:return Zr(t,6112,6121,!0,i);case 15:return ts(t,"å­ä¸å¯å¯è¾°å·³åæªç³éæäº¥",r);case 16:return ts(t,"ç²ä¹ä¸ä¸æå·±åºè¾å£¬ç¸",r);case 17:case 48:return es(t,"é¶ä¸äºä¸åäºå­ä¸å«ä¹",ns,"è² ",r,14);case 47:return es(t,"é¶å£¹è²³åèä¼é¸ææç",is,"è² ",r,15);case 42:return es(t,"é¶ä¸äºä¸åäºå­ä¸å«ä¹",ns,"è´",r,14);case 41:return es(t,"é¶å£¹è´°åèä¼éææç",is,"è´",r,15);case 26:return es(t,"ãä¸äºä¸åäºå­ä¸å«ä¹","åç¾åä¸",rs,r,0);case 25:return es(t,"é¶å£±å¼ååä¼å­ä¸å«ä¹","æ¾ç¾åä¸",rs,r,7);case 31:return es(t,"ìì¼ì´ì¼ì¬ì¤ì¡ì¹ íêµ¬","ì­ë°±ì²ë§",ss,s,7);case 33:return es(t,"é¶ä¸äºä¸åäºå­ä¸å«ä¹","åç¾åè¬",ss,s,0);case 32:return es(t,"é¶å£¹è²³ååäºå­ä¸å«ä¹","æ¾ç¾å",ss,s,7);case 18:return Zr(t,2406,2415,!0,i);case 20:return Xr(t,1,19999,$r,3,i);case 21:return Zr(t,2790,2799,!0,i);case 22:return Zr(t,2662,2671,!0,i);case 22:return Xr(t,1,10999,Yr,3,i);case 23:return ts(t,"ããããããããããããããããã¡ã¤ã¦ã¨ãªã«ã¬ã­ã®ã¯ã²ãµã¸ã»ã¾ã¿ãããããããããããããããã");case 24:return ts(t,"ããã¯ã«ã»ã¸ã¨ã¡ãã¬ããããããããã¤ã­ãªããããã®ãããã¾ããµããã¦ãããããã¿ããã²ããã");case 27:return Zr(t,3302,3311,!0,i);case 28:return ts(t,"ã¢ã¤ã¦ã¨ãªã«ã­ã¯ã±ã³ãµã·ã¹ã»ã½ã¿ããããããããããããããããã ã¡ã¢ã¤ã¦ã¨ã©ãªã«ã¬ã­ã¯ã°ã±ã²ã³",r);case 29:return ts(t,"ã¤ã­ãããããããªãã«ã²ã¯ã«ã¨ã¿ã¬ã½ãããã©ã ã¦ã°ããªã¯ã¤ãã±ãã³ã¨ãã¢ãµã­ã¦ã¡ãã·ã±ãã¢ã»ã¹",r);case 34:return Zr(t,3792,3801,!0,i);case 37:return Zr(t,6160,6169,!0,i);case 38:return Zr(t,4160,4169,!0,i);case 39:return Zr(t,2918,2927,!0,i);case 40:return Zr(t,1776,1785,!0,i);case 43:return Zr(t,3046,3055,!0,i);case 44:return Zr(t,3174,3183,!0,i);case 45:return Zr(t,3664,3673,!0,i);case 46:return Zr(t,3872,3881,!0,i);default:return Zr(t,48,57,!0,i)}},as="data-html2canvas-ignore",cs=function(){function t(t,e,n){if(this.context=t,this.options=n,this.scrolledElements=[],this.referenceElement=e,this.counters=new Wr,this.quoteDepth=0,!e.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(e.ownerDocument.documentElement,!1)}return t.prototype.toIFrame=function(t,e){var n=this,s=us(t,e);if(!s.contentWindow)return Promise.reject("Unable to find iframe window");var o=t.defaultView.pageXOffset,a=t.defaultView.pageYOffset,c=s.contentWindow,l=c.document,u=As(s).then((function(){return i(n,void 0,void 0,(function(){var t,n;return r(this,(function(i){switch(i.label){case 0:return this.scrolledElements.forEach(vs),c&&(c.scrollTo(e.left,e.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||c.scrollY===e.top&&c.scrollX===e.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(c.scrollX-e.left,c.scrollY-e.top,0,0))),t=this.options.onclone,void 0===(n=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:l.fonts&&l.fonts.ready?[4,l.fonts.ready]:[3,2];case 1:i.sent(),i.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,hs(l)]:[3,4];case 3:i.sent(),i.label=4;case 4:return"function"==typeof t?[2,Promise.resolve().then((function(){return t(l,n)})).then((function(){return s}))]:[2,s]}}))}))}));return l.open(),l.write(ms(document.doctype)+"<html></html>"),gs(this.referenceElement.ownerDocument,o,a),l.replaceChild(l.adoptNode(this.documentElement),l.documentElement),l.close(),u},t.prototype.createElementClone=function(t){if(Ti(t,2),Br(t))return this.createCanvasClone(t);if(Ur(t))return this.createVideoClone(t);if(Vr(t))return this.createStyleClone(t);var e=t.cloneNode(!1);return Fr(e)&&(Fr(t)&&t.currentSrc&&t.currentSrc!==t.src&&(e.src=t.currentSrc,e.srcset=""),"lazy"===e.loading&&(e.loading="eager")),zr(e)?this.createCustomElementClone(e):e},t.prototype.createCustomElementClone=function(t){var e=document.createElement("html2canvascustomelement");return fs(t.style,e),e},t.prototype.createStyleClone=function(t){try{var e=t.sheet;if(e&&e.cssRules){var n=[].slice.call(e.cssRules,0).reduce((function(t,e){return e&&"string"==typeof e.cssText?t+e.cssText:t}),""),i=t.cloneNode(!1);return i.textContent=n,i}}catch(t){if(this.context.logger.error("Unable to access cssRules property",t),"SecurityError"!==t.name)throw t}return t.cloneNode(!1)},t.prototype.createCanvasClone=function(t){var e;if(this.options.inlineImages&&t.ownerDocument){var n=t.ownerDocument.createElement("img");try{return n.src=t.toDataURL(),n}catch(e){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",t)}}var i=t.cloneNode(!1);try{i.width=t.width,i.height=t.height;var r=t.getContext("2d"),s=i.getContext("2d");if(s)if(!this.options.allowTaint&&r)s.putImageData(r.getImageData(0,0,t.width,t.height),0,0);else{var o=null!==(e=t.getContext("webgl2"))&&void 0!==e?e:t.getContext("webgl");if(o){var a=o.getContextAttributes();!1===(null==a?void 0:a.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",t)}s.drawImage(t,0,0)}return i}catch(e){this.context.logger.info("Unable to clone canvas as it is tainted",t)}return i},t.prototype.createVideoClone=function(t){var e=t.ownerDocument.createElement("canvas");e.width=t.offsetWidth,e.height=t.offsetHeight;var n=e.getContext("2d");try{return n&&(n.drawImage(t,0,0,e.width,e.height),this.options.allowTaint||n.getImageData(0,0,e.width,e.height)),e}catch(e){this.context.logger.info("Unable to clone video as it is tainted",t)}var i=t.ownerDocument.createElement("canvas");return i.width=t.offsetWidth,i.height=t.offsetHeight,i},t.prototype.appendChildNode=function(t,e,n){xr(e)&&("SCRIPT"===e.tagName||e.hasAttribute(as)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(e))||this.options.copyStyles&&xr(e)&&Vr(e)||t.appendChild(this.cloneNode(e,n))},t.prototype.cloneChildNodes=function(t,e,n){for(var i=this,r=t.shadowRoot?t.shadowRoot.firstChild:t.firstChild;r;r=r.nextSibling)if(xr(r)&&Qr(r)&&"function"==typeof r.assignedNodes){var s=r.assignedNodes();s.length&&s.forEach((function(t){return i.appendChildNode(e,t,n)}))}else this.appendChildNode(e,r,n)},t.prototype.cloneNode=function(t,e){if(Ir(t))return document.createTextNode(t.data);if(!t.ownerDocument)return t.cloneNode(!1);var n=t.ownerDocument.defaultView;if(n&&xr(t)&&(Or(t)||Lr(t))){var i=this.createElementClone(t);i.style.transitionProperty="none";var r=n.getComputedStyle(t),s=n.getComputedStyle(t,":before"),o=n.getComputedStyle(t,":after");this.referenceElement===t&&Or(i)&&(this.clonedReferenceElement=i),Dr(i)&&Es(i);var a=this.counters.parse(new wi(this.context,r)),c=this.resolvePseudoContent(t,i,s,Pi.BEFORE);zr(t)&&(e=!0),Ur(t)||this.cloneChildNodes(t,i,e),c&&i.insertBefore(c,i.firstChild);var l=this.resolvePseudoContent(t,i,o,Pi.AFTER);return l&&i.appendChild(l),this.counters.pop(a),(r&&(this.options.copyStyles||Lr(t))&&!Hr(t)||e)&&fs(r,i),0===t.scrollTop&&0===t.scrollLeft||this.scrolledElements.push([i,t.scrollLeft,t.scrollTop]),(jr(t)||Gr(t))&&(jr(i)||Gr(i))&&(i.value=t.value),i}return t.cloneNode(!1)},t.prototype.resolvePseudoContent=function(t,e,n,i){var r=this;if(n){var s=n.content,o=e.ownerDocument;if(o&&s&&"none"!==s&&"-moz-alt-content"!==s&&"none"!==n.display){this.counters.parse(new wi(this.context,n));var a=new Ei(this.context,n),c=o.createElement("html2canvaspseudoelement");fs(n,c),a.content.forEach((function(e){if(0===e.type)c.appendChild(o.createTextNode(e.value));else if(22===e.type){var n=o.createElement("img");n.src=e.value,n.style.opacity="1",c.appendChild(n)}else if(18===e.type){if("attr"===e.name){var i=e.values.filter(zt);i.length&&c.appendChild(o.createTextNode(t.getAttribute(i[0].value)||""))}else if("counter"===e.name){var s=e.values.filter(Yt),l=s[0],u=s[1];if(l&&zt(l)){var d=r.counters.getCounterValue(l.value),h=u&&zt(u)?On.parse(r.context,u.value):3;c.appendChild(o.createTextNode(os(d,h,!1)))}}else if("counters"===e.name){var A=e.values.filter(Yt),p=(l=A[0],A[1]);u=A[2];if(l&&zt(l)){var f=r.counters.getCounterValues(l.value),m=u&&zt(u)?On.parse(r.context,u.value):3,g=p&&0===p.type?p.value:"",v=f.map((function(t){return os(t,m,!1)})).join(g);c.appendChild(o.createTextNode(v))}}}else if(20===e.type)switch(e.value){case"open-quote":c.appendChild(o.createTextNode(mi(a.quotes,r.quoteDepth++,!0)));break;case"close-quote":c.appendChild(o.createTextNode(mi(a.quotes,--r.quoteDepth,!1)));break;default:c.appendChild(o.createTextNode(e.value))}})),c.className=ys+" "+_s;var l=i===Pi.BEFORE?" "+ys:" "+_s;return Lr(e)?e.className.baseValue+=l:e.className+=l,c}}},t.destroy=function(t){return!!t.parentNode&&(t.parentNode.removeChild(t),!0)},t}();!function(t){t[t.BEFORE=0]="BEFORE",t[t.AFTER=1]="AFTER"}(Pi||(Pi={}));var ls,us=function(t,e){var n=t.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=e.width.toString(),n.height=e.height.toString(),n.scrolling="no",n.setAttribute(as,"true"),t.body.appendChild(n),n},ds=function(t){return new Promise((function(e){t.complete?e():t.src?(t.onload=e,t.onerror=e):e()}))},hs=function(t){return Promise.all([].slice.call(t.images,0).map(ds))},As=function(t){return new Promise((function(e,n){var i=t.contentWindow;if(!i)return n("No window assigned for iframe");var r=i.document;i.onload=t.onload=function(){i.onload=t.onload=null;var n=setInterval((function(){r.body.childNodes.length>0&&"complete"===r.readyState&&(clearInterval(n),e(t))}),50)}}))},ps=["all","d","content"],fs=function(t,e){for(var n=t.length-1;n>=0;n--){var i=t.item(n);-1===ps.indexOf(i)&&e.style.setProperty(i,t.getPropertyValue(i))}return e},ms=function(t){var e="";return t&&(e+="<!DOCTYPE ",t.name&&(e+=t.name),t.internalSubset&&(e+=t.internalSubset),t.publicId&&(e+='"'+t.publicId+'"'),t.systemId&&(e+='"'+t.systemId+'"'),e+=">"),e},gs=function(t,e,n){t&&t.defaultView&&(e!==t.defaultView.pageXOffset||n!==t.defaultView.pageYOffset)&&t.defaultView.scrollTo(e,n)},vs=function(t){var e=t[0],n=t[1],i=t[2];e.scrollLeft=n,e.scrollTop=i},ys="___html2canvas___pseudoelement_before",_s="___html2canvas___pseudoelement_after",bs='{\n    content: "" !important;\n    display: none !important;\n}',Es=function(t){ws(t,"."+ys+":before"+bs+"\n         ."+_s+":after"+bs)},ws=function(t,e){var n=t.ownerDocument;if(n){var i=n.createElement("style");i.textContent=e,t.appendChild(i)}},Ss=function(){function t(){}return t.getOrigin=function(e){var n=t._link;return n?(n.href=e,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},t.isSameOrigin=function(e){return t.getOrigin(e)===t._origin},t.setContext=function(e){t._link=e.document.createElement("a"),t._origin=t.getOrigin(e.location.href)},t._origin="about:blank",t}(),Ts=function(){function t(t,e){this.context=t,this._options=e,this._cache={}}return t.prototype.addImage=function(t){var e=Promise.resolve();return this.has(t)?e:Ms(t)||xs(t)?((this._cache[t]=this.loadImage(t)).catch((function(){})),e):e},t.prototype.match=function(t){return this._cache[t]},t.prototype.loadImage=function(t){return i(this,void 0,void 0,(function(){var e,n,i,s,o=this;return r(this,(function(r){switch(r.label){case 0:return e=Ss.isSameOrigin(t),n=!Os(t)&&!0===this._options.useCORS&&Yi.SUPPORT_CORS_IMAGES&&!e,i=!Os(t)&&!e&&!Ms(t)&&"string"==typeof this._options.proxy&&Yi.SUPPORT_CORS_XHR&&!n,e||!1!==this._options.allowTaint||Os(t)||Ms(t)||i||n?(s=t,i?[4,this.proxy(s)]:[3,2]):[2];case 1:s=r.sent(),r.label=2;case 2:return this.context.logger.debug("Added image "+t.substring(0,256)),[4,new Promise((function(t,e){var i=new Image;i.onload=function(){return t(i)},i.onerror=e,(Ls(s)||n)&&(i.crossOrigin="anonymous"),i.src=s,!0===i.complete&&setTimeout((function(){return t(i)}),500),o._options.imageTimeout>0&&setTimeout((function(){return e("Timed out ("+o._options.imageTimeout+"ms) loading image")}),o._options.imageTimeout)}))];case 3:return[2,r.sent()]}}))}))},t.prototype.has=function(t){return void 0!==this._cache[t]},t.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},t.prototype.proxy=function(t){var e=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var i=t.substring(0,256);return new Promise((function(r,s){var o=Yi.SUPPORT_RESPONSE_TYPE?"blob":"text",a=new XMLHttpRequest;a.onload=function(){if(200===a.status)if("text"===o)r(a.response);else{var t=new FileReader;t.addEventListener("load",(function(){return r(t.result)}),!1),t.addEventListener("error",(function(t){return s(t)}),!1),t.readAsDataURL(a.response)}else s("Failed to proxy resource "+i+" with status code "+a.status)},a.onerror=s;var c=n.indexOf("?")>-1?"&":"?";if(a.open("GET",""+n+c+"url="+encodeURIComponent(t)+"&responseType="+o),"text"!==o&&a instanceof XMLHttpRequest&&(a.responseType=o),e._options.imageTimeout){var l=e._options.imageTimeout;a.timeout=l,a.ontimeout=function(){return s("Timed out ("+l+"ms) proxying "+i)}}a.send()}))},t}(),Cs=/^data:image\/svg\+xml/i,Rs=/^data:image\/.*;base64,/i,Is=/^data:image\/.*/i,xs=function(t){return Yi.SUPPORT_SVG_DRAWING||!ks(t)},Os=function(t){return Is.test(t)},Ls=function(t){return Rs.test(t)},Ms=function(t){return"blob"===t.substr(0,4)},ks=function(t){return"svg"===t.substr(-3).toLowerCase()||Cs.test(t)},Ns=function(){function t(t,e){this.type=0,this.x=t,this.y=e}return t.prototype.add=function(e,n){return new t(this.x+e,this.y+n)},t}(),Ps=function(t,e,n){return new Ns(t.x+(e.x-t.x)*n,t.y+(e.y-t.y)*n)},Ds=function(){function t(t,e,n,i){this.type=1,this.start=t,this.startControl=e,this.endControl=n,this.end=i}return t.prototype.subdivide=function(e,n){var i=Ps(this.start,this.startControl,e),r=Ps(this.startControl,this.endControl,e),s=Ps(this.endControl,this.end,e),o=Ps(i,r,e),a=Ps(r,s,e),c=Ps(o,a,e);return n?new t(this.start,i,o,c):new t(c,a,s,this.end)},t.prototype.add=function(e,n){return new t(this.start.add(e,n),this.startControl.add(e,n),this.endControl.add(e,n),this.end.add(e,n))},t.prototype.reverse=function(){return new t(this.end,this.endControl,this.startControl,this.start)},t}(),Bs=function(t){return 1===t.type},Us=function(t){var e=t.styles,n=t.bounds,i=re(e.borderTopLeftRadius,n.width,n.height),r=i[0],s=i[1],o=re(e.borderTopRightRadius,n.width,n.height),a=o[0],c=o[1],l=re(e.borderBottomRightRadius,n.width,n.height),u=l[0],d=l[1],h=re(e.borderBottomLeftRadius,n.width,n.height),A=h[0],p=h[1],f=[];f.push((r+a)/n.width),f.push((A+u)/n.width),f.push((s+p)/n.height),f.push((c+d)/n.height);var m=Math.max.apply(Math,f);m>1&&(r/=m,s/=m,a/=m,c/=m,u/=m,d/=m,A/=m,p/=m);var g=n.width-a,v=n.height-d,y=n.width-u,_=n.height-p,b=e.borderTopWidth,E=e.borderRightWidth,w=e.borderBottomWidth,S=e.borderLeftWidth,T=se(e.paddingTop,t.bounds.width),C=se(e.paddingRight,t.bounds.width),R=se(e.paddingBottom,t.bounds.width),I=se(e.paddingLeft,t.bounds.width);this.topLeftBorderDoubleOuterBox=r>0||s>0?Fs(n.left+S/3,n.top+b/3,r-S/3,s-b/3,ls.TOP_LEFT):new Ns(n.left+S/3,n.top+b/3),this.topRightBorderDoubleOuterBox=r>0||s>0?Fs(n.left+g,n.top+b/3,a-E/3,c-b/3,ls.TOP_RIGHT):new Ns(n.left+n.width-E/3,n.top+b/3),this.bottomRightBorderDoubleOuterBox=u>0||d>0?Fs(n.left+y,n.top+v,u-E/3,d-w/3,ls.BOTTOM_RIGHT):new Ns(n.left+n.width-E/3,n.top+n.height-w/3),this.bottomLeftBorderDoubleOuterBox=A>0||p>0?Fs(n.left+S/3,n.top+_,A-S/3,p-w/3,ls.BOTTOM_LEFT):new Ns(n.left+S/3,n.top+n.height-w/3),this.topLeftBorderDoubleInnerBox=r>0||s>0?Fs(n.left+2*S/3,n.top+2*b/3,r-2*S/3,s-2*b/3,ls.TOP_LEFT):new Ns(n.left+2*S/3,n.top+2*b/3),this.topRightBorderDoubleInnerBox=r>0||s>0?Fs(n.left+g,n.top+2*b/3,a-2*E/3,c-2*b/3,ls.TOP_RIGHT):new Ns(n.left+n.width-2*E/3,n.top+2*b/3),this.bottomRightBorderDoubleInnerBox=u>0||d>0?Fs(n.left+y,n.top+v,u-2*E/3,d-2*w/3,ls.BOTTOM_RIGHT):new Ns(n.left+n.width-2*E/3,n.top+n.height-2*w/3),this.bottomLeftBorderDoubleInnerBox=A>0||p>0?Fs(n.left+2*S/3,n.top+_,A-2*S/3,p-2*w/3,ls.BOTTOM_LEFT):new Ns(n.left+2*S/3,n.top+n.height-2*w/3),this.topLeftBorderStroke=r>0||s>0?Fs(n.left+S/2,n.top+b/2,r-S/2,s-b/2,ls.TOP_LEFT):new Ns(n.left+S/2,n.top+b/2),this.topRightBorderStroke=r>0||s>0?Fs(n.left+g,n.top+b/2,a-E/2,c-b/2,ls.TOP_RIGHT):new Ns(n.left+n.width-E/2,n.top+b/2),this.bottomRightBorderStroke=u>0||d>0?Fs(n.left+y,n.top+v,u-E/2,d-w/2,ls.BOTTOM_RIGHT):new Ns(n.left+n.width-E/2,n.top+n.height-w/2),this.bottomLeftBorderStroke=A>0||p>0?Fs(n.left+S/2,n.top+_,A-S/2,p-w/2,ls.BOTTOM_LEFT):new Ns(n.left+S/2,n.top+n.height-w/2),this.topLeftBorderBox=r>0||s>0?Fs(n.left,n.top,r,s,ls.TOP_LEFT):new Ns(n.left,n.top),this.topRightBorderBox=a>0||c>0?Fs(n.left+g,n.top,a,c,ls.TOP_RIGHT):new Ns(n.left+n.width,n.top),this.bottomRightBorderBox=u>0||d>0?Fs(n.left+y,n.top+v,u,d,ls.BOTTOM_RIGHT):new Ns(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=A>0||p>0?Fs(n.left,n.top+_,A,p,ls.BOTTOM_LEFT):new Ns(n.left,n.top+n.height),this.topLeftPaddingBox=r>0||s>0?Fs(n.left+S,n.top+b,Math.max(0,r-S),Math.max(0,s-b),ls.TOP_LEFT):new Ns(n.left+S,n.top+b),this.topRightPaddingBox=a>0||c>0?Fs(n.left+Math.min(g,n.width-E),n.top+b,g>n.width+E?0:Math.max(0,a-E),Math.max(0,c-b),ls.TOP_RIGHT):new Ns(n.left+n.width-E,n.top+b),this.bottomRightPaddingBox=u>0||d>0?Fs(n.left+Math.min(y,n.width-S),n.top+Math.min(v,n.height-w),Math.max(0,u-E),Math.max(0,d-w),ls.BOTTOM_RIGHT):new Ns(n.left+n.width-E,n.top+n.height-w),this.bottomLeftPaddingBox=A>0||p>0?Fs(n.left+S,n.top+Math.min(_,n.height-w),Math.max(0,A-S),Math.max(0,p-w),ls.BOTTOM_LEFT):new Ns(n.left+S,n.top+n.height-w),this.topLeftContentBox=r>0||s>0?Fs(n.left+S+I,n.top+b+T,Math.max(0,r-(S+I)),Math.max(0,s-(b+T)),ls.TOP_LEFT):new Ns(n.left+S+I,n.top+b+T),this.topRightContentBox=a>0||c>0?Fs(n.left+Math.min(g,n.width+S+I),n.top+b+T,g>n.width+S+I?0:a-S+I,c-(b+T),ls.TOP_RIGHT):new Ns(n.left+n.width-(E+C),n.top+b+T),this.bottomRightContentBox=u>0||d>0?Fs(n.left+Math.min(y,n.width-(S+I)),n.top+Math.min(v,n.height+b+T),Math.max(0,u-(E+C)),d-(w+R),ls.BOTTOM_RIGHT):new Ns(n.left+n.width-(E+C),n.top+n.height-(w+R)),this.bottomLeftContentBox=A>0||p>0?Fs(n.left+S+I,n.top+_,Math.max(0,A-(S+I)),p-(w+R),ls.BOTTOM_LEFT):new Ns(n.left+S+I,n.top+n.height-(w+R))};!function(t){t[t.TOP_LEFT=0]="TOP_LEFT",t[t.TOP_RIGHT=1]="TOP_RIGHT",t[t.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",t[t.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(ls||(ls={}));var Fs=function(t,e,n,i,r){var s=(Math.sqrt(2)-1)/3*4,o=n*s,a=i*s,c=t+n,l=e+i;switch(r){case ls.TOP_LEFT:return new Ds(new Ns(t,l),new Ns(t,l-a),new Ns(c-o,e),new Ns(c,e));case ls.TOP_RIGHT:return new Ds(new Ns(t,e),new Ns(t+o,e),new Ns(c,l-a),new Ns(c,l));case ls.BOTTOM_RIGHT:return new Ds(new Ns(c,e),new Ns(c,e+a),new Ns(t+o,l),new Ns(t,l));case ls.BOTTOM_LEFT:default:return new Ds(new Ns(c,l),new Ns(c-o,l),new Ns(t,e+a),new Ns(t,e))}},Hs=function(t){return[t.topLeftBorderBox,t.topRightBorderBox,t.bottomRightBorderBox,t.bottomLeftBorderBox]},Vs=function(t){return[t.topLeftPaddingBox,t.topRightPaddingBox,t.bottomRightPaddingBox,t.bottomLeftPaddingBox]},js=function(t,e,n){this.offsetX=t,this.offsetY=e,this.matrix=n,this.type=0,this.target=6},Gs=function(t,e){this.path=t,this.target=e,this.type=1},Qs=function(t){this.opacity=t,this.type=2,this.target=6},zs=function(t){return 1===t.type},Ws=function(t,e){return t.length===e.length&&t.some((function(t,n){return t===e[n]}))},Ks=function(t){this.element=t,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},qs=function(){function t(t,e){if(this.container=t,this.parent=e,this.effects=[],this.curves=new Us(this.container),this.container.styles.opacity<1&&this.effects.push(new Qs(this.container.styles.opacity)),null!==this.container.styles.transform){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,r=this.container.styles.transform;this.effects.push(new js(n,i,r))}if(0!==this.container.styles.overflowX){var s=Hs(this.curves),o=Vs(this.curves);Ws(s,o)?this.effects.push(new Gs(s,6)):(this.effects.push(new Gs(s,2)),this.effects.push(new Gs(o,4)))}}return t.prototype.getEffects=function(t){for(var e=-1===[2,3].indexOf(this.container.styles.position),n=this.parent,i=this.effects.slice(0);n;){var r=n.effects.filter((function(t){return!zs(t)}));if(e||0!==n.container.styles.position||!n.parent){if(i.unshift.apply(i,r),e=-1===[2,3].indexOf(n.container.styles.position),0!==n.container.styles.overflowX){var s=Hs(n.curves),o=Vs(n.curves);Ws(s,o)||i.unshift(new Gs(o,6))}}else i.unshift.apply(i,r);n=n.parent}return i.filter((function(e){return ui(e.target,t)}))},t}(),Ys=function(t,e,n,i){t.container.elements.forEach((function(r){var s=ui(r.flags,4),o=ui(r.flags,2),a=new qs(r,t);ui(r.styles.display,2048)&&i.push(a);var c=ui(r.flags,8)?[]:i;if(s||o){var l=s||r.styles.isPositioned()?n:e,u=new Ks(a);if(r.styles.isPositioned()||r.styles.opacity<1||r.styles.isTransformed()){var d=r.styles.zIndex.order;if(d<0){var h=0;l.negativeZIndex.some((function(t,e){return d>t.element.container.styles.zIndex.order?(h=e,!1):h>0})),l.negativeZIndex.splice(h,0,u)}else if(d>0){var A=0;l.positiveZIndex.some((function(t,e){return d>=t.element.container.styles.zIndex.order?(A=e+1,!1):A>0})),l.positiveZIndex.splice(A,0,u)}else l.zeroOrAutoZIndexOrTransformedOrOpacity.push(u)}else r.styles.isFloating()?l.nonPositionedFloats.push(u):l.nonPositionedInlineLevel.push(u);Ys(a,u,s?u:n,c)}else r.styles.isInlineLevel()?e.inlineLevel.push(a):e.nonInlineLevel.push(a),Ys(a,e,n,c);ui(r.flags,8)&&$s(r,c)}))},$s=function(t,e){for(var n=t instanceof dr?t.start:1,i=t instanceof dr&&t.reversed,r=0;r<e.length;r++){var s=e[r];s.container instanceof ur&&"number"==typeof s.container.value&&0!==s.container.value&&(n=s.container.value),s.listValue=os(n,s.container.styles.listStyleType,!0),n+=i?-1:1}},Xs=function(t,e){switch(e){case 0:return Zs(t.topLeftBorderBox,t.topLeftPaddingBox,t.topRightBorderBox,t.topRightPaddingBox);case 1:return Zs(t.topRightBorderBox,t.topRightPaddingBox,t.bottomRightBorderBox,t.bottomRightPaddingBox);case 2:return Zs(t.bottomRightBorderBox,t.bottomRightPaddingBox,t.bottomLeftBorderBox,t.bottomLeftPaddingBox);default:return Zs(t.bottomLeftBorderBox,t.bottomLeftPaddingBox,t.topLeftBorderBox,t.topLeftPaddingBox)}},Js=function(t,e){var n=[];return Bs(t)?n.push(t.subdivide(.5,!1)):n.push(t),Bs(e)?n.push(e.subdivide(.5,!0)):n.push(e),n},Zs=function(t,e,n,i){var r=[];return Bs(t)?r.push(t.subdivide(.5,!1)):r.push(t),Bs(n)?r.push(n.subdivide(.5,!0)):r.push(n),Bs(i)?r.push(i.subdivide(.5,!0).reverse()):r.push(i),Bs(e)?r.push(e.subdivide(.5,!1).reverse()):r.push(e),r},to=function(t){var e=t.bounds,n=t.styles;return e.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},eo=function(t){var e=t.styles,n=t.bounds,i=se(e.paddingLeft,n.width),r=se(e.paddingRight,n.width),s=se(e.paddingTop,n.width),o=se(e.paddingBottom,n.width);return n.add(i+e.borderLeftWidth,s+e.borderTopWidth,-(e.borderRightWidth+e.borderLeftWidth+i+r),-(e.borderTopWidth+e.borderBottomWidth+s+o))},no=function(t,e,n){var i=function(t,e){return 0===t?e.bounds:2===t?eo(e):to(e)}(oo(t.styles.backgroundOrigin,e),t),r=function(t,e){return 0===t?e.bounds:2===t?eo(e):to(e)}(oo(t.styles.backgroundClip,e),t),s=so(oo(t.styles.backgroundSize,e),n,i),o=s[0],a=s[1],c=re(oo(t.styles.backgroundPosition,e),i.width-o,i.height-a);return[ao(oo(t.styles.backgroundRepeat,e),c,s,i,r),Math.round(i.left+c[0]),Math.round(i.top+c[1]),o,a]},io=function(t){return zt(t)&&t.value===Ve.AUTO},ro=function(t){return"number"==typeof t},so=function(t,e,n){var i=e[0],r=e[1],s=e[2],o=t[0],a=t[1];if(!o)return[0,0];if(Zt(o)&&a&&Zt(a))return[se(o,n.width),se(a,n.height)];var c=ro(s);if(zt(o)&&(o.value===Ve.CONTAIN||o.value===Ve.COVER))return ro(s)?n.width/n.height<s!=(o.value===Ve.COVER)?[n.width,n.width/s]:[n.height*s,n.height]:[n.width,n.height];var l=ro(i),u=ro(r),d=l||u;if(io(o)&&(!a||io(a)))return l&&u?[i,r]:c||d?d&&c?[l?i:r*s,u?r:i/s]:[l?i:n.width,u?r:n.height]:[n.width,n.height];if(c){var h=0,A=0;return Zt(o)?h=se(o,n.width):Zt(a)&&(A=se(a,n.height)),io(o)?h=A*s:a&&!io(a)||(A=h/s),[h,A]}var p=null,f=null;if(Zt(o)?p=se(o,n.width):a&&Zt(a)&&(f=se(a,n.height)),null===p||a&&!io(a)||(f=l&&u?p/i*r:n.height),null!==f&&io(o)&&(p=l&&u?f/r*i:n.width),null!==p&&null!==f)return[p,f];throw new Error("Unable to calculate background-size for element")},oo=function(t,e){var n=t[e];return void 0===n?t[0]:n},ao=function(t,e,n,i,r){var s=e[0],o=e[1],a=n[0],c=n[1];switch(t){case 2:return[new Ns(Math.round(i.left),Math.round(i.top+o)),new Ns(Math.round(i.left+i.width),Math.round(i.top+o)),new Ns(Math.round(i.left+i.width),Math.round(c+i.top+o)),new Ns(Math.round(i.left),Math.round(c+i.top+o))];case 3:return[new Ns(Math.round(i.left+s),Math.round(i.top)),new Ns(Math.round(i.left+s+a),Math.round(i.top)),new Ns(Math.round(i.left+s+a),Math.round(i.height+i.top)),new Ns(Math.round(i.left+s),Math.round(i.height+i.top))];case 1:return[new Ns(Math.round(i.left+s),Math.round(i.top+o)),new Ns(Math.round(i.left+s+a),Math.round(i.top+o)),new Ns(Math.round(i.left+s+a),Math.round(i.top+o+c)),new Ns(Math.round(i.left+s),Math.round(i.top+o+c))];default:return[new Ns(Math.round(r.left),Math.round(r.top)),new Ns(Math.round(r.left+r.width),Math.round(r.top)),new Ns(Math.round(r.left+r.width),Math.round(r.height+r.top)),new Ns(Math.round(r.left),Math.round(r.height+r.top))]}},co="Hidden Text",lo=function(){function t(t){this._data={},this._document=t}return t.prototype.parseMetrics=function(t,e){var n=this._document.createElement("div"),i=this._document.createElement("img"),r=this._document.createElement("span"),s=this._document.body;n.style.visibility="hidden",n.style.fontFamily=t,n.style.fontSize=e,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",s.appendChild(n),i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",r.style.fontFamily=t,r.style.fontSize=e,r.style.margin="0",r.style.padding="0",r.appendChild(this._document.createTextNode(co)),n.appendChild(r),n.appendChild(i);var o=i.offsetTop-r.offsetTop+2;n.removeChild(r),n.appendChild(this._document.createTextNode(co)),n.style.lineHeight="normal",i.style.verticalAlign="super";var a=i.offsetTop-n.offsetTop+2;return s.removeChild(n),{baseline:o,middle:a}},t.prototype.getMetrics=function(t,e){var n=t+" "+e;return void 0===this._data[n]&&(this._data[n]=this.parseMetrics(t,e)),this._data[n]},t}(),uo=function(t,e){this.context=t,this.options=e},ho=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i._activeEffects=[],i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),n.canvas||(i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px"),i.fontMetrics=new lo(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),i}return e(n,t),n.prototype.applyEffects=function(t){for(var e=this;this._activeEffects.length;)this.popEffect();t.forEach((function(t){return e.applyEffect(t)}))},n.prototype.applyEffect=function(t){this.ctx.save(),function(t){return 2===t.type}(t)&&(this.ctx.globalAlpha=t.opacity),function(t){return 0===t.type}(t)&&(this.ctx.translate(t.offsetX,t.offsetY),this.ctx.transform(t.matrix[0],t.matrix[1],t.matrix[2],t.matrix[3],t.matrix[4],t.matrix[5]),this.ctx.translate(-t.offsetX,-t.offsetY)),zs(t)&&(this.path(t.path),this.ctx.clip()),this._activeEffects.push(t)},n.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},n.prototype.renderStack=function(t){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return t.element.container.styles.isVisible()?[4,this.renderStackContent(t)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},n.prototype.renderNode=function(t){return i(this,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return ui(t.container.flags,16),t.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(t)]:[3,3];case 1:return e.sent(),[4,this.renderNodeContent(t)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},n.prototype.renderTextWithLetterSpacing=function(t,e,n){var i=this;0===e?this.ctx.fillText(t.text,t.bounds.left,t.bounds.top+n):Zi(t.text).reduce((function(e,r){return i.ctx.fillText(r,e,t.bounds.top+n),e+i.ctx.measureText(r).width}),t.bounds.left)},n.prototype.createFontStyle=function(t){var e=t.fontVariant.filter((function(t){return"normal"===t||"small-caps"===t})).join(""),n=go(t.fontFamily).join(", "),i=Gt(t.fontSize)?""+t.fontSize.number+t.fontSize.unit:t.fontSize.number+"px";return[[t.fontStyle,e,t.fontWeight,i,n].join(" "),n,i]},n.prototype.renderTextNode=function(t,e){return i(this,void 0,void 0,(function(){var n,i,s,o,a,c,l,u,d=this;return r(this,(function(r){return n=this.createFontStyle(e),i=n[0],s=n[1],o=n[2],this.ctx.font=i,this.ctx.direction=1===e.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",a=this.fontMetrics.getMetrics(s,o),c=a.baseline,l=a.middle,u=e.paintOrder,t.textBounds.forEach((function(t){u.forEach((function(n){switch(n){case 0:d.ctx.fillStyle=pe(e.color),d.renderTextWithLetterSpacing(t,e.letterSpacing,c);var i=e.textShadow;i.length&&t.text.trim().length&&(i.slice(0).reverse().forEach((function(n){d.ctx.shadowColor=pe(n.color),d.ctx.shadowOffsetX=n.offsetX.number*d.options.scale,d.ctx.shadowOffsetY=n.offsetY.number*d.options.scale,d.ctx.shadowBlur=n.blur.number,d.renderTextWithLetterSpacing(t,e.letterSpacing,c)})),d.ctx.shadowColor="",d.ctx.shadowOffsetX=0,d.ctx.shadowOffsetY=0,d.ctx.shadowBlur=0),e.textDecorationLine.length&&(d.ctx.fillStyle=pe(e.textDecorationColor||e.color),e.textDecorationLine.forEach((function(e){switch(e){case 1:d.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top+c),t.bounds.width,1);break;case 2:d.ctx.fillRect(t.bounds.left,Math.round(t.bounds.top),t.bounds.width,1);break;case 3:d.ctx.fillRect(t.bounds.left,Math.ceil(t.bounds.top+l),t.bounds.width,1)}})));break;case 1:e.webkitTextStrokeWidth&&t.text.trim().length&&(d.ctx.strokeStyle=pe(e.webkitTextStrokeColor),d.ctx.lineWidth=e.webkitTextStrokeWidth,d.ctx.lineJoin=window.chrome?"miter":"round",d.ctx.strokeText(t.text,t.bounds.left,t.bounds.top+c)),d.ctx.strokeStyle="",d.ctx.lineWidth=0,d.ctx.lineJoin="miter"}}))})),[2]}))}))},n.prototype.renderReplacedElement=function(t,e,n){if(n&&t.intrinsicWidth>0&&t.intrinsicHeight>0){var i=eo(t),r=Vs(e);this.path(r),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,t.intrinsicWidth,t.intrinsicHeight,i.left,i.top,i.width,i.height),this.ctx.restore()}},n.prototype.renderNodeContent=function(t){return i(this,void 0,void 0,(function(){var e,i,s,a,c,l,u,d,h,A,p,f,m,g,v,y,_,b;return r(this,(function(r){switch(r.label){case 0:this.applyEffects(t.getEffects(4)),e=t.container,i=t.curves,s=e.styles,a=0,c=e.textNodes,r.label=1;case 1:return a<c.length?(l=c[a],[4,this.renderTextNode(l,s)]):[3,4];case 2:r.sent(),r.label=3;case 3:return a++,[3,1];case 4:if(!(e instanceof ar))return[3,8];r.label=5;case 5:return r.trys.push([5,7,,8]),[4,this.context.cache.match(e.src)];case 6:return v=r.sent(),this.renderReplacedElement(e,i,v),[3,8];case 7:return r.sent(),this.context.logger.error("Error loading image "+e.src),[3,8];case 8:if(e instanceof cr&&this.renderReplacedElement(e,i,e.canvas),!(e instanceof lr))return[3,12];r.label=9;case 9:return r.trys.push([9,11,,12]),[4,this.context.cache.match(e.svg)];case 10:return v=r.sent(),this.renderReplacedElement(e,i,v),[3,12];case 11:return r.sent(),this.context.logger.error("Error loading svg "+e.svg.substring(0,255)),[3,12];case 12:return e instanceof br&&e.tree?[4,new n(this.context,{scale:this.options.scale,backgroundColor:e.backgroundColor,x:0,y:0,width:e.width,height:e.height}).render(e.tree)]:[3,14];case 13:u=r.sent(),e.width&&e.height&&this.ctx.drawImage(u,0,0,e.width,e.height,e.bounds.left,e.bounds.top,e.bounds.width,e.bounds.height),r.label=14;case 14:if(e instanceof vr&&(d=Math.min(e.bounds.width,e.bounds.height),e.type===pr?e.checked&&(this.ctx.save(),this.path([new Ns(e.bounds.left+.39363*d,e.bounds.top+.79*d),new Ns(e.bounds.left+.16*d,e.bounds.top+.5549*d),new Ns(e.bounds.left+.27347*d,e.bounds.top+.44071*d),new Ns(e.bounds.left+.39694*d,e.bounds.top+.5649*d),new Ns(e.bounds.left+.72983*d,e.bounds.top+.23*d),new Ns(e.bounds.left+.84*d,e.bounds.top+.34085*d),new Ns(e.bounds.left+.39363*d,e.bounds.top+.79*d)]),this.ctx.fillStyle=pe(gr),this.ctx.fill(),this.ctx.restore()):e.type===fr&&e.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(e.bounds.left+d/2,e.bounds.top+d/2,d/4,0,2*Math.PI,!0),this.ctx.fillStyle=pe(gr),this.ctx.fill(),this.ctx.restore())),Ao(e)&&e.value.length){switch(h=this.createFontStyle(s),_=h[0],A=h[1],p=this.fontMetrics.getMetrics(_,A).baseline,this.ctx.font=_,this.ctx.fillStyle=pe(s.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=fo(e.styles.textAlign),b=eo(e),f=0,e.styles.textAlign){case 1:f+=b.width/2;break;case 2:f+=b.width}m=b.add(f,0,0,-b.height/2+1),this.ctx.save(),this.path([new Ns(b.left,b.top),new Ns(b.left+b.width,b.top),new Ns(b.left+b.width,b.top+b.height),new Ns(b.left,b.top+b.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new $i(e.value,m),s.letterSpacing,p),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!ui(e.styles.display,2048))return[3,20];if(null===e.styles.listStyleImage)return[3,19];if(0!==(g=e.styles.listStyleImage).type)return[3,18];v=void 0,y=g.url,r.label=15;case 15:return r.trys.push([15,17,,18]),[4,this.context.cache.match(y)];case 16:return v=r.sent(),this.ctx.drawImage(v,e.bounds.left-(v.width+10),e.bounds.top),[3,18];case 17:return r.sent(),this.context.logger.error("Error loading list-style-image "+y),[3,18];case 18:return[3,20];case 19:t.listValue&&-1!==e.styles.listStyleType&&(_=this.createFontStyle(s)[0],this.ctx.font=_,this.ctx.fillStyle=pe(s.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",b=new o(e.bounds.left,e.bounds.top+se(e.styles.paddingTop,e.bounds.width),e.bounds.width,Rn(s.lineHeight,s.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new $i(t.listValue,b),s.letterSpacing,Rn(s.lineHeight,s.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),r.label=20;case 20:return[2]}}))}))},n.prototype.renderStackContent=function(t){return i(this,void 0,void 0,(function(){var e,n,i,s,o,a,c,l,u,d,h,A,p,f,m;return r(this,(function(r){switch(r.label){case 0:return ui(t.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(t.element)];case 1:r.sent(),e=0,n=t.negativeZIndex,r.label=2;case 2:return e<n.length?(m=n[e],[4,this.renderStack(m)]):[3,5];case 3:r.sent(),r.label=4;case 4:return e++,[3,2];case 5:return[4,this.renderNodeContent(t.element)];case 6:r.sent(),i=0,s=t.nonInlineLevel,r.label=7;case 7:return i<s.length?(m=s[i],[4,this.renderNode(m)]):[3,10];case 8:r.sent(),r.label=9;case 9:return i++,[3,7];case 10:o=0,a=t.nonPositionedFloats,r.label=11;case 11:return o<a.length?(m=a[o],[4,this.renderStack(m)]):[3,14];case 12:r.sent(),r.label=13;case 13:return o++,[3,11];case 14:c=0,l=t.nonPositionedInlineLevel,r.label=15;case 15:return c<l.length?(m=l[c],[4,this.renderStack(m)]):[3,18];case 16:r.sent(),r.label=17;case 17:return c++,[3,15];case 18:u=0,d=t.inlineLevel,r.label=19;case 19:return u<d.length?(m=d[u],[4,this.renderNode(m)]):[3,22];case 20:r.sent(),r.label=21;case 21:return u++,[3,19];case 22:h=0,A=t.zeroOrAutoZIndexOrTransformedOrOpacity,r.label=23;case 23:return h<A.length?(m=A[h],[4,this.renderStack(m)]):[3,26];case 24:r.sent(),r.label=25;case 25:return h++,[3,23];case 26:p=0,f=t.positiveZIndex,r.label=27;case 27:return p<f.length?(m=f[p],[4,this.renderStack(m)]):[3,30];case 28:r.sent(),r.label=29;case 29:return p++,[3,27];case 30:return[2]}}))}))},n.prototype.mask=function(t){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(t.slice(0).reverse()),this.ctx.closePath()},n.prototype.path=function(t){this.ctx.beginPath(),this.formatPath(t),this.ctx.closePath()},n.prototype.formatPath=function(t){var e=this;t.forEach((function(t,n){var i=Bs(t)?t.start:t;0===n?e.ctx.moveTo(i.x,i.y):e.ctx.lineTo(i.x,i.y),Bs(t)&&e.ctx.bezierCurveTo(t.startControl.x,t.startControl.y,t.endControl.x,t.endControl.y,t.end.x,t.end.y)}))},n.prototype.renderRepeat=function(t,e,n,i){this.path(t),this.ctx.fillStyle=e,this.ctx.translate(n,i),this.ctx.fill(),this.ctx.translate(-n,-i)},n.prototype.resizeImage=function(t,e,n){var i;if(t.width===e&&t.height===n)return t;var r=(null!==(i=this.canvas.ownerDocument)&&void 0!==i?i:document).createElement("canvas");return r.width=Math.max(1,e),r.height=Math.max(1,n),r.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,e,n),r},n.prototype.renderBackgroundImage=function(t){return i(this,void 0,void 0,(function(){var e,n,i,s,o,a;return r(this,(function(c){switch(c.label){case 0:e=t.styles.backgroundImage.length-1,n=function(n){var s,o,a,c,l,u,d,h,A,p,f,m,g,v,y,_,b,E,w,S,T,C,R,I,x,O,L,M,k,N,P;return r(this,(function(r){switch(r.label){case 0:if(0!==n.type)return[3,5];s=void 0,o=n.url,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,i.context.cache.match(o)];case 2:return s=r.sent(),[3,4];case 3:return r.sent(),i.context.logger.error("Error loading background-image "+o),[3,4];case 4:return s&&(a=no(t,e,[s.width,s.height,s.width/s.height]),_=a[0],C=a[1],R=a[2],w=a[3],S=a[4],v=i.ctx.createPattern(i.resizeImage(s,w,S),"repeat"),i.renderRepeat(_,v,C,R)),[3,6];case 5:1===n.type?(c=no(t,e,[null,null,null]),_=c[0],C=c[1],R=c[2],w=c[3],S=c[4],l=Re(n.angle,w,S),u=l[0],d=l[1],h=l[2],A=l[3],p=l[4],(f=document.createElement("canvas")).width=w,f.height=S,m=f.getContext("2d"),g=m.createLinearGradient(d,A,h,p),Ce(n.stops,u).forEach((function(t){return g.addColorStop(t.stop,pe(t.color))})),m.fillStyle=g,m.fillRect(0,0,w,S),w>0&&S>0&&(v=i.ctx.createPattern(f,"repeat"),i.renderRepeat(_,v,C,R))):function(t){return 2===t.type}(n)&&(y=no(t,e,[null,null,null]),_=y[0],b=y[1],E=y[2],w=y[3],S=y[4],T=0===n.position.length?[ne]:n.position,C=se(T[0],w),R=se(T[T.length-1],S),I=function(t,e,n,i,r){var s=0,o=0;switch(t.size){case 0:0===t.shape?s=o=Math.min(Math.abs(e),Math.abs(e-i),Math.abs(n),Math.abs(n-r)):1===t.shape&&(s=Math.min(Math.abs(e),Math.abs(e-i)),o=Math.min(Math.abs(n),Math.abs(n-r)));break;case 2:if(0===t.shape)s=o=Math.min(Ie(e,n),Ie(e,n-r),Ie(e-i,n),Ie(e-i,n-r));else if(1===t.shape){var a=Math.min(Math.abs(n),Math.abs(n-r))/Math.min(Math.abs(e),Math.abs(e-i)),c=xe(i,r,e,n,!0),l=c[0],u=c[1];o=a*(s=Ie(l-e,(u-n)/a))}break;case 1:0===t.shape?s=o=Math.max(Math.abs(e),Math.abs(e-i),Math.abs(n),Math.abs(n-r)):1===t.shape&&(s=Math.max(Math.abs(e),Math.abs(e-i)),o=Math.max(Math.abs(n),Math.abs(n-r)));break;case 3:if(0===t.shape)s=o=Math.max(Ie(e,n),Ie(e,n-r),Ie(e-i,n),Ie(e-i,n-r));else if(1===t.shape){a=Math.max(Math.abs(n),Math.abs(n-r))/Math.max(Math.abs(e),Math.abs(e-i));var d=xe(i,r,e,n,!1);l=d[0],u=d[1],o=a*(s=Ie(l-e,(u-n)/a))}}return Array.isArray(t.size)&&(s=se(t.size[0],i),o=2===t.size.length?se(t.size[1],r):s),[s,o]}(n,C,R,w,S),x=I[0],O=I[1],x>0&&O>0&&(L=i.ctx.createRadialGradient(b+C,E+R,0,b+C,E+R,x),Ce(n.stops,2*x).forEach((function(t){return L.addColorStop(t.stop,pe(t.color))})),i.path(_),i.ctx.fillStyle=L,x!==O?(M=t.bounds.left+.5*t.bounds.width,k=t.bounds.top+.5*t.bounds.height,P=1/(N=O/x),i.ctx.save(),i.ctx.translate(M,k),i.ctx.transform(1,0,0,N,0,0),i.ctx.translate(-M,-k),i.ctx.fillRect(b,P*(E-k)+k,w,S*P),i.ctx.restore()):i.ctx.fill())),r.label=6;case 6:return e--,[2]}}))},i=this,s=0,o=t.styles.backgroundImage.slice(0).reverse(),c.label=1;case 1:return s<o.length?(a=o[s],[5,n(a)]):[3,4];case 2:c.sent(),c.label=3;case 3:return s++,[3,1];case 4:return[2]}}))}))},n.prototype.renderSolidBorder=function(t,e,n){return i(this,void 0,void 0,(function(){return r(this,(function(i){return this.path(Xs(n,e)),this.ctx.fillStyle=pe(t),this.ctx.fill(),[2]}))}))},n.prototype.renderDoubleBorder=function(t,e,n,s){return i(this,void 0,void 0,(function(){var i,o;return r(this,(function(r){switch(r.label){case 0:return e<3?[4,this.renderSolidBorder(t,n,s)]:[3,2];case 1:return r.sent(),[2];case 2:return i=function(t,e){switch(e){case 0:return Zs(t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox,t.topRightBorderBox,t.topRightBorderDoubleOuterBox);case 1:return Zs(t.topRightBorderBox,t.topRightBorderDoubleOuterBox,t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox);case 2:return Zs(t.bottomRightBorderBox,t.bottomRightBorderDoubleOuterBox,t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox);default:return Zs(t.bottomLeftBorderBox,t.bottomLeftBorderDoubleOuterBox,t.topLeftBorderBox,t.topLeftBorderDoubleOuterBox)}}(s,n),this.path(i),this.ctx.fillStyle=pe(t),this.ctx.fill(),o=function(t,e){switch(e){case 0:return Zs(t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox,t.topRightBorderDoubleInnerBox,t.topRightPaddingBox);case 1:return Zs(t.topRightBorderDoubleInnerBox,t.topRightPaddingBox,t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox);case 2:return Zs(t.bottomRightBorderDoubleInnerBox,t.bottomRightPaddingBox,t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox);default:return Zs(t.bottomLeftBorderDoubleInnerBox,t.bottomLeftPaddingBox,t.topLeftBorderDoubleInnerBox,t.topLeftPaddingBox)}}(s,n),this.path(o),this.ctx.fill(),[2]}}))}))},n.prototype.renderNodeBackgroundAndBorders=function(t){return i(this,void 0,void 0,(function(){var e,n,i,s,o,a,c,l,u=this;return r(this,(function(r){switch(r.label){case 0:return this.applyEffects(t.getEffects(2)),e=t.container.styles,n=!Ae(e.backgroundColor)||e.backgroundImage.length,i=[{style:e.borderTopStyle,color:e.borderTopColor,width:e.borderTopWidth},{style:e.borderRightStyle,color:e.borderRightColor,width:e.borderRightWidth},{style:e.borderBottomStyle,color:e.borderBottomColor,width:e.borderBottomWidth},{style:e.borderLeftStyle,color:e.borderLeftColor,width:e.borderLeftWidth}],s=po(oo(e.backgroundClip,0),t.curves),n||e.boxShadow.length?(this.ctx.save(),this.path(s),this.ctx.clip(),Ae(e.backgroundColor)||(this.ctx.fillStyle=pe(e.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(t.container)]):[3,2];case 1:r.sent(),this.ctx.restore(),e.boxShadow.slice(0).reverse().forEach((function(e){u.ctx.save();var n,i,r,s,o,a=Hs(t.curves),c=e.inset?0:1e4,l=(n=a,i=-c+(e.inset?1:-1)*e.spread.number,r=(e.inset?1:-1)*e.spread.number,s=e.spread.number*(e.inset?-2:2),o=e.spread.number*(e.inset?-2:2),n.map((function(t,e){switch(e){case 0:return t.add(i,r);case 1:return t.add(i+s,r);case 2:return t.add(i+s,r+o);case 3:return t.add(i,r+o)}return t})));e.inset?(u.path(a),u.ctx.clip(),u.mask(l)):(u.mask(a),u.ctx.clip(),u.path(l)),u.ctx.shadowOffsetX=e.offsetX.number+c,u.ctx.shadowOffsetY=e.offsetY.number,u.ctx.shadowColor=pe(e.color),u.ctx.shadowBlur=e.blur.number,u.ctx.fillStyle=e.inset?pe(e.color):"rgba(0,0,0,1)",u.ctx.fill(),u.ctx.restore()})),r.label=2;case 2:o=0,a=0,c=i,r.label=3;case 3:return a<c.length?0!==(l=c[a]).style&&!Ae(l.color)&&l.width>0?2!==l.style?[3,5]:[4,this.renderDashedDottedBorder(l.color,l.width,o,t.curves,2)]:[3,11]:[3,13];case 4:return r.sent(),[3,11];case 5:return 3!==l.style?[3,7]:[4,this.renderDashedDottedBorder(l.color,l.width,o,t.curves,3)];case 6:return r.sent(),[3,11];case 7:return 4!==l.style?[3,9]:[4,this.renderDoubleBorder(l.color,l.width,o,t.curves)];case 8:return r.sent(),[3,11];case 9:return[4,this.renderSolidBorder(l.color,o,t.curves)];case 10:r.sent(),r.label=11;case 11:o++,r.label=12;case 12:return a++,[3,3];case 13:return[2]}}))}))},n.prototype.renderDashedDottedBorder=function(t,e,n,s,o){return i(this,void 0,void 0,(function(){var i,a,c,l,u,d,h,A,p,f,m,g,v,y,_,b;return r(this,(function(r){return this.ctx.save(),i=function(t,e){switch(e){case 0:return Js(t.topLeftBorderStroke,t.topRightBorderStroke);case 1:return Js(t.topRightBorderStroke,t.bottomRightBorderStroke);case 2:return Js(t.bottomRightBorderStroke,t.bottomLeftBorderStroke);default:return Js(t.bottomLeftBorderStroke,t.topLeftBorderStroke)}}(s,n),a=Xs(s,n),2===o&&(this.path(a),this.ctx.clip()),Bs(a[0])?(c=a[0].start.x,l=a[0].start.y):(c=a[0].x,l=a[0].y),Bs(a[1])?(u=a[1].end.x,d=a[1].end.y):(u=a[1].x,d=a[1].y),h=0===n||2===n?Math.abs(c-u):Math.abs(l-d),this.ctx.beginPath(),3===o?this.formatPath(i):this.formatPath(a.slice(0,2)),A=e<3?3*e:2*e,p=e<3?2*e:e,3===o&&(A=e,p=e),f=!0,h<=2*A?f=!1:h<=2*A+p?(A*=m=h/(2*A+p),p*=m):(g=Math.floor((h+p)/(A+p)),v=(h-g*A)/(g-1),p=(y=(h-(g+1)*A)/g)<=0||Math.abs(p-v)<Math.abs(p-y)?v:y),f&&(3===o?this.ctx.setLineDash([0,A+p]):this.ctx.setLineDash([A,p])),3===o?(this.ctx.lineCap="round",this.ctx.lineWidth=e):this.ctx.lineWidth=2*e+1.1,this.ctx.strokeStyle=pe(t),this.ctx.stroke(),this.ctx.setLineDash([]),2===o&&(Bs(a[0])&&(_=a[3],b=a[0],this.ctx.beginPath(),this.formatPath([new Ns(_.end.x,_.end.y),new Ns(b.start.x,b.start.y)]),this.ctx.stroke()),Bs(a[1])&&(_=a[1],b=a[2],this.ctx.beginPath(),this.formatPath([new Ns(_.end.x,_.end.y),new Ns(b.start.x,b.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},n.prototype.render=function(t){return i(this,void 0,void 0,(function(){var e;return r(this,(function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=pe(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),i=new qs(t,null),r=new Ks(i),Ys(i,r,r,s=[]),$s(i.container,s),e=r,[4,this.renderStack(e)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}var i,r,s}))}))},n}(uo),Ao=function(t){return t instanceof _r||(t instanceof yr||t instanceof vr&&t.type!==fr&&t.type!==pr)},po=function(t,e){switch(t){case 0:return Hs(e);case 2:return function(t){return[t.topLeftContentBox,t.topRightContentBox,t.bottomRightContentBox,t.bottomLeftContentBox]}(e);default:return Vs(e)}},fo=function(t){switch(t){case 1:return"center";case 2:return"right";default:return"left"}},mo=["-apple-system","system-ui"],go=function(t){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?t.filter((function(t){return-1===mo.indexOf(t)})):t},vo=function(t){function n(e,n){var i=t.call(this,e,n)||this;return i.canvas=n.canvas?n.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=n,i.canvas.width=Math.floor(n.width*n.scale),i.canvas.height=Math.floor(n.height*n.scale),i.canvas.style.width=n.width+"px",i.canvas.style.height=n.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-n.x,-n.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),i}return e(n,t),n.prototype.render=function(t){return i(this,void 0,void 0,(function(){var e,n;return r(this,(function(i){switch(i.label){case 0:return e=Ki(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,t),[4,yo(e)];case 1:return n=i.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=pe(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},n}(uo),yo=function(t){return new Promise((function(e,n){var i=new Image;i.onload=function(){e(i)},i.onerror=n,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(t))}))},_o=function(){function t(t){var e=t.id,n=t.enabled;this.id=e,this.enabled=n,this.start=Date.now()}return t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,s([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},t.prototype.getTime=function(){return Date.now()-this.start},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,s([this.id,this.getTime()+"ms"],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,s([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,s([this.id,this.getTime()+"ms"],t)):this.info.apply(this,t))},t.instances={},t}(),bo=function(){function t(e,n){var i;this.windowBounds=n,this.instanceName="#"+t.instanceCount++,this.logger=new _o({id:this.instanceName,enabled:e.logging}),this.cache=null!==(i=e.cache)&&void 0!==i?i:new Ts(this,e)}return t.instanceCount=1,t}();"undefined"!=typeof window&&Ss.setContext(window);var Eo=function(t,e){return i(void 0,void 0,void 0,(function(){var i,s,c,l,u,d,h,A,p,f,m,g,v,y,_,b,E,w,S,T,C,R,I,x,O,L,M,k,N,P,D,B,U,F,H,V,j,G;return r(this,(function(r){switch(r.label){case 0:if(!t||"object"!=typeof t)return[2,Promise.reject("Invalid element provided as first argument")];if(!(i=t.ownerDocument))throw new Error("Element is not attached to a Document");if(!(s=i.defaultView))throw new Error("Document is not attached to a Window");return c={allowTaint:null!==(R=e.allowTaint)&&void 0!==R&&R,imageTimeout:null!==(I=e.imageTimeout)&&void 0!==I?I:15e3,proxy:e.proxy,useCORS:null!==(x=e.useCORS)&&void 0!==x&&x},l=n({logging:null===(O=e.logging)||void 0===O||O,cache:e.cache},c),u={windowWidth:null!==(L=e.windowWidth)&&void 0!==L?L:s.innerWidth,windowHeight:null!==(M=e.windowHeight)&&void 0!==M?M:s.innerHeight,scrollX:null!==(k=e.scrollX)&&void 0!==k?k:s.pageXOffset,scrollY:null!==(N=e.scrollY)&&void 0!==N?N:s.pageYOffset},d=new o(u.scrollX,u.scrollY,u.windowWidth,u.windowHeight),h=new bo(l,d),A=null!==(P=e.foreignObjectRendering)&&void 0!==P&&P,p={allowTaint:null!==(D=e.allowTaint)&&void 0!==D&&D,onclone:e.onclone,ignoreElements:e.ignoreElements,inlineImages:A,copyStyles:A},h.logger.debug("Starting document clone with size "+d.width+"x"+d.height+" scrolled to "+-d.left+","+-d.top),f=new cs(h,t,p),(m=f.clonedReferenceElement)?[4,f.toIFrame(i,d)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return g=r.sent(),v=Dr(m)||"HTML"===m.tagName?function(t){var e=t.body,n=t.documentElement;if(!e||!n)throw new Error("Unable to get document size");var i=Math.max(Math.max(e.scrollWidth,n.scrollWidth),Math.max(e.offsetWidth,n.offsetWidth),Math.max(e.clientWidth,n.clientWidth)),r=Math.max(Math.max(e.scrollHeight,n.scrollHeight),Math.max(e.offsetHeight,n.offsetHeight),Math.max(e.clientHeight,n.clientHeight));return new o(0,0,i,r)}(m.ownerDocument):a(h,m),y=v.width,_=v.height,b=v.left,E=v.top,w=wo(h,m,e.backgroundColor),S={canvas:e.canvas,backgroundColor:w,scale:null!==(U=null!==(B=e.scale)&&void 0!==B?B:s.devicePixelRatio)&&void 0!==U?U:1,x:(null!==(F=e.x)&&void 0!==F?F:0)+b,y:(null!==(H=e.y)&&void 0!==H?H:0)+E,width:null!==(V=e.width)&&void 0!==V?V:Math.ceil(y),height:null!==(j=e.height)&&void 0!==j?j:Math.ceil(_)},A?(h.logger.debug("Document cloned, using foreign object rendering"),[4,new vo(h,S).render(m)]):[3,3];case 2:return T=r.sent(),[3,5];case 3:return h.logger.debug("Document cloned, element located at "+b+","+E+" with size "+y+"x"+_+" using computed rendering"),h.logger.debug("Starting DOM parsing"),C=Tr(h,m),w===C.styles.backgroundColor&&(C.styles.backgroundColor=Ee.TRANSPARENT),h.logger.debug("Starting renderer for element at "+S.x+","+S.y+" with size "+S.width+"x"+S.height),[4,new ho(h,S).render(C)];case 4:T=r.sent(),r.label=5;case 5:return(null===(G=e.removeContainer)||void 0===G||G)&&(cs.destroy(g)||h.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),h.logger.debug("Finished rendering"),[2,T]}}))}))},wo=function(t,e,n){var i=e.ownerDocument,r=i.documentElement?be(t,getComputedStyle(i.documentElement).backgroundColor):Ee.TRANSPARENT,s=i.body?be(t,getComputedStyle(i.body).backgroundColor):Ee.TRANSPARENT,o="string"==typeof n?be(t,n):null===n?Ee.TRANSPARENT:4294967295;return e===i.documentElement?Ae(r)?Ae(s)?o:s:r:o};return function(t,e){return void 0===e&&(e={}),Eo(t,e)}})),
/**
 * @license beta-bhere-development v1.0.33-canary.0
 * (c) 2023 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE={})}(this,(function(t){
/**
	 * @license
	 * Copyright 2010-2022 Three.js Authors
	 * SPDX-License-Identifier: MIT
	 */
const e="138",n=100,i=300,r=301,s=302,o=303,a=304,c=306,l=307,u=1e3,d=1001,h=1002,A=1003,p=1004,f=1005,m=1006,g=1007,v=1008,y=1009,_=1012,b=1014,E=1015,w=1016,S=1020,T=1023,C=1026,R=1027,I=33776,x=33777,O=33778,L=33779,M=35840,k=35841,N=35842,P=35843,D=37492,B=37496,U=37808,F=37809,H=37810,V=37811,j=37812,G=37813,Q=37814,z=37815,W=37816,K=37817,q=37818,Y=37819,$=37820,X=37821,J=36492,Z=2300,tt=2301,et=2302,nt=2400,it=2401,rt=2402,st=2500,ot=2501,at=3e3,ct=3001,lt=7680,ut=35044,dt=35048,ht="300 es",At=1035;class pt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let e=0,i=n.length;e<i;e++)n[e].call(this,t);t.target=null}}}const ft=[];for(let t=0;t<256;t++)ft[t]=(t<16?"0":"")+t.toString(16);let mt=1234567;const gt=Math.PI/180,vt=180/Math.PI;function yt(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ft[255&t]+ft[t>>8&255]+ft[t>>16&255]+ft[t>>24&255]+"-"+ft[255&e]+ft[e>>8&255]+"-"+ft[e>>16&15|64]+ft[e>>24&255]+"-"+ft[63&n|128]+ft[n>>8&255]+"-"+ft[n>>16&255]+ft[n>>24&255]+ft[255&i]+ft[i>>8&255]+ft[i>>16&255]+ft[i>>24&255]).toUpperCase()}function _t(t,e,n){return Math.max(e,Math.min(n,t))}function bt(t,e){return(t%e+e)%e}function Et(t,e,n){return(1-n)*t+n*e}function wt(t){return 0==(t&t-1)&&0!==t}function St(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Tt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Ct=Object.freeze({__proto__:null,DEG2RAD:gt,RAD2DEG:vt,generateUUID:yt,clamp:_t,euclideanModulo:bt,mapLinear:function(t,e,n,i,r){return i+(t-e)*(r-i)/(n-e)},inverseLerp:function(t,e,n){return t!==e?(n-t)/(e-t):0},lerp:Et,damp:function(t,e,n,i){return Et(t,e,1-Math.exp(-n*i))},pingpong:function(t,e=1){return e-Math.abs(bt(t,2*e)-e)},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){return void 0!==t&&(mt=t%2147483647),mt=16807*mt%2147483647,(mt-1)/2147483646},degToRad:function(t){return t*gt},radToDeg:function(t){return t*vt},isPowerOfTwo:wt,ceilPowerOfTwo:St,floorPowerOfTwo:Tt,setQuaternionFromProperEuler:function(t,e,n,i,r){const s=Math.cos,o=Math.sin,a=s(n/2),c=o(n/2),l=s((e+i)/2),u=o((e+i)/2),d=s((e-i)/2),h=o((e-i)/2),A=s((i-e)/2),p=o((i-e)/2);switch(r){case"XYX":t.set(a*u,c*d,c*h,a*l);break;case"YZY":t.set(c*h,a*u,c*d,a*l);break;case"ZXZ":t.set(c*d,c*h,a*u,a*l);break;case"XZX":t.set(a*u,c*p,c*A,a*l);break;case"YXY":t.set(c*A,a*u,c*p,a*l);break;case"ZYZ":t.set(c*p,c*A,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}});class Rt{constructor(t=0,e=0){this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,n=this.y,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6],this.y=i[1]*e+i[4]*n+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const n=Math.cos(e),i=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*n-s*i+t.x,this.y=r*i+s*n+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Rt.prototype.isVector2=!0;class It{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,s,o,a,c){const l=this.elements;return l[0]=t,l[1]=i,l[2]=o,l[3]=e,l[4]=r,l[5]=a,l[6]=n,l[7]=s,l[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this}extractBasis(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[3],a=n[6],c=n[1],l=n[4],u=n[7],d=n[2],h=n[5],A=n[8],p=i[0],f=i[3],m=i[6],g=i[1],v=i[4],y=i[7],_=i[2],b=i[5],E=i[8];return r[0]=s*p+o*g+a*_,r[3]=s*f+o*v+a*b,r[6]=s*m+o*y+a*E,r[1]=c*p+l*g+u*_,r[4]=c*f+l*v+u*b,r[7]=c*m+l*y+u*E,r[2]=d*p+h*g+A*_,r[5]=d*f+h*v+A*b,r[8]=d*m+h*y+A*E,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8];return e*s*l-e*o*c-n*r*l+n*o*a+i*r*c-i*s*a}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=l*s-o*c,d=o*a-l*r,h=c*r-s*a,A=e*u+n*d+i*h;if(0===A)return this.set(0,0,0,0,0,0,0,0,0);const p=1/A;return t[0]=u*p,t[1]=(i*c-l*n)*p,t[2]=(o*n-i*s)*p,t[3]=d*p,t[4]=(l*e-i*a)*p,t[5]=(i*r-o*e)*p,t[6]=h*p,t[7]=(n*a-c*e)*p,t[8]=(s*e-n*r)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,n,i,r,s,o){const a=Math.cos(r),c=Math.sin(r);return this.set(n*a,n*c,-n*(a*s+c*o)+s+t,-i*c,i*a,-i*(-c*s+a*o)+o+e,0,0,1),this}scale(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),i=this.elements,r=i[0],s=i[3],o=i[6],a=i[1],c=i[4],l=i[7];return i[0]=e*r+n*a,i[3]=e*s+n*c,i[6]=e*o+n*l,i[1]=-n*r+e*a,i[4]=-n*s+e*c,i[7]=-n*o+e*l,this}translate(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<9;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<9;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function xt(t){for(let e=t.length-1;e>=0;--e)if(t[e]>65535)return!0;return!1}It.prototype.isMatrix3=!0;const Ot={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Lt(t,e){return new Ot[t](e)}function Mt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}const kt={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Nt={h:0,s:0,l:0},Pt={h:0,s:0,l:0};function Dt(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function Bt(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function Ut(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}class Ft{constructor(t,e,n){return void 0===e&&void 0===n?this.set(t):this.setRGB(t,e,n)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this}setRGB(t,e,n){return this.r=t,this.g=e,this.b=n,this}setHSL(t,e,n){if(t=bt(t,1),e=_t(e,0,1),n=_t(n,0,1),0===e)this.r=this.g=this.b=n;else{const i=n<=.5?n*(1+e):n+e-n*e,r=2*n-i;this.r=Dt(r,i,t+1/3),this.g=Dt(r,i,t),this.b=Dt(r,i,t-1/3)}return this}setStyle(t){function e(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const i=n[1],r=n[2];switch(i){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,e(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,e(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(r)){const n=parseFloat(t[1])/360,i=parseInt(t[2],10)/100,r=parseInt(t[3],10)/100;return e(t[4]),this.setHSL(n,i,r)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],e=t.length;if(3===e)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===e)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return t&&t.length>0?this.setColorName(t):this}setColorName(t){const e=kt[t.toLowerCase()];return void 0!==e?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Bt(t.r),this.g=Bt(t.g),this.b=Bt(t.b),this}copyLinearToSRGB(t){return this.r=Ut(t.r),this.g=Ut(t.g),this.b=Ut(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(t){const e=this.r,n=this.g,i=this.b,r=Math.max(e,n,i),s=Math.min(e,n,i);let o,a;const c=(s+r)/2;if(s===r)o=0,a=0;else{const t=r-s;switch(a=c<=.5?t/(r+s):t/(2-r-s),r){case e:o=(n-i)/t+(n<i?6:0);break;case n:o=(i-e)/t+2;break;case i:o=(e-n)/t+4}o/=6}return t.h=o,t.s=a,t.l=c,t}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(t,e,n){return this.getHSL(Nt),Nt.h+=t,Nt.s+=e,Nt.l+=n,this.setHSL(Nt.h,Nt.s,Nt.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,n){return this.r=t.r+(e.r-t.r)*n,this.g=t.g+(e.g-t.g)*n,this.b=t.b+(e.b-t.b)*n,this}lerpHSL(t,e){this.getHSL(Nt),t.getHSL(Pt);const n=Et(Nt.h,Pt.h,e),i=Et(Nt.s,Pt.s,e),r=Et(Nt.l,Pt.l,e);return this.setHSL(n,i,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let Ht;Ft.NAMES=kt,Ft.prototype.isColor=!0,Ft.prototype.r=1,Ft.prototype.g=1,Ft.prototype.b=1;class Vt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===Ht&&(Ht=Mt("canvas")),Ht.width=t.width,Ht.height=t.height;const n=Ht.getContext("2d");t instanceof ImageData?n.putImageData(t,0,0):n.drawImage(t,0,0,t.width,t.height),e=Ht}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Mt("canvas");e.width=t.width,e.height=t.height;const n=e.getContext("2d");n.drawImage(t,0,0,t.width,t.height);const i=n.getImageData(0,0,t.width,t.height),r=i.data;for(let t=0;t<r.length;t++)r[t]=255*Bt(r[t]/255);return n.putImageData(i,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Bt(e[t]/255)):e[t]=Bt(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class jt{constructor(t=null){this.uuid=yt(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(null!==i){let t;if(Array.isArray(i)){t=[];for(let e=0,n=i.length;e<n;e++)i[e].isDataTexture?t.push(Gt(i[e].image)):t.push(Gt(i[e]))}else t=Gt(i);n.url=t}return e||(t.images[this.uuid]=n),n}}function Gt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Vt.getDataURL(t):t.data?{data:Array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}jt.prototype.isSource=!0;let Qt=0;class zt extends pt{constructor(t=zt.DEFAULT_IMAGE,e=zt.DEFAULT_MAPPING,n=1001,i=1001,r=1006,s=1008,o=1023,a=1009,c=1,l=3e3){super(),Object.defineProperty(this,"id",{value:Qt++}),this.uuid=yt(),this.name="",this.source=new jt(t),this.mipmaps=[],this.mapping=e,this.wrapS=n,this.wrapT=i,this.magFilter=r,this.minFilter=s,this.anisotropy=c,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Rt(0,0),this.repeat=new Rt(1,1),this.center=new Rt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new It,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=l,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e||(t.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==i)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case u:t.x=t.x-Math.floor(t.x);break;case d:t.x=t.x<0?0:1;break;case h:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case u:t.y=t.y-Math.floor(t.y);break;case d:t.y=t.y<0?0:1;break;case h:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}zt.DEFAULT_IMAGE=null,zt.DEFAULT_MAPPING=i,zt.prototype.isTexture=!0;class Wt{constructor(t=0,e=0,n=0,i=1){this.x=t,this.y=e,this.z=n,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,n,i){return this.x=t,this.y=e,this.z=n,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*n+s[8]*i+s[12]*r,this.y=s[1]*e+s[5]*n+s[9]*i+s[13]*r,this.z=s[2]*e+s[6]*n+s[10]*i+s[14]*r,this.w=s[3]*e+s[7]*n+s[11]*i+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,n,i,r;const s=.01,o=.1,a=t.elements,c=a[0],l=a[4],u=a[8],d=a[1],h=a[5],A=a[9],p=a[2],f=a[6],m=a[10];if(Math.abs(l-d)<s&&Math.abs(u-p)<s&&Math.abs(A-f)<s){if(Math.abs(l+d)<o&&Math.abs(u+p)<o&&Math.abs(A+f)<o&&Math.abs(c+h+m-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(c+1)/2,a=(h+1)/2,g=(m+1)/2,v=(l+d)/4,y=(u+p)/4,_=(A+f)/4;return t>a&&t>g?t<s?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(t),i=v/n,r=y/n):a>g?a<s?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(a),n=v/i,r=_/i):g<s?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(g),n=y/r,i=_/r),this.set(n,i,r,e),this}let g=Math.sqrt((f-A)*(f-A)+(u-p)*(u-p)+(d-l)*(d-l));return Math.abs(g)<.001&&(g=1),this.x=(f-A)/g,this.y=(u-p)/g,this.z=(d-l)/g,this.w=Math.acos((c+h+m-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Wt.prototype.isVector4=!0;class Kt extends pt{constructor(t,e,n={}){super(),this.width=t,this.height=e,this.depth=1,this.scissor=new Wt(0,0,t,e),this.scissorTest=!1,this.viewport=new Wt(0,0,t,e);const i={width:t,height:e,depth:1};this.texture=new zt(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:m,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(t,e,n=1){this.width===t&&this.height===e&&this.depth===n||(this.width=t,this.height=e,this.depth=n,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.image=Object.assign({},t.texture.image),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}Kt.prototype.isWebGLRenderTarget=!0;class qt extends zt{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=A,this.minFilter=A,this.wrapR=d,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}qt.prototype.isDataArrayTexture=!0;class Yt extends Kt{constructor(t,e,n){super(t,e),this.depth=n,this.texture=new qt(null,t,e,n),this.texture.isRenderTargetTexture=!0}}Yt.prototype.isWebGLArrayRenderTarget=!0;class $t extends zt{constructor(t=null,e=1,n=1,i=1){super(null),this.image={data:t,width:e,height:n,depth:i},this.magFilter=A,this.minFilter=A,this.wrapR=d,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}$t.prototype.isData3DTexture=!0;class Xt extends Kt{constructor(t,e,n){super(t,e),this.depth=n,this.texture=new $t(null,t,e,n),this.texture.isRenderTargetTexture=!0}}Xt.prototype.isWebGL3DRenderTarget=!0;class Jt extends Kt{constructor(t,e,n,i={}){super(t,e,i);const r=this.texture;this.texture=[];for(let t=0;t<n;t++)this.texture[t]=r.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,n=1){if(this.width!==t||this.height!==e||this.depth!==n){this.width=t,this.height=e,this.depth=n;for(let i=0,r=this.texture.length;i<r;i++)this.texture[i].image.width=t,this.texture[i].image.height=e,this.texture[i].image.depth=n;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.depthTexture=t.depthTexture,this.texture.length=0;for(let e=0,n=t.texture.length;e<n;e++)this.texture[e]=t.texture[e].clone();return this}}Jt.prototype.isWebGLMultipleRenderTargets=!0;class Zt{constructor(t=0,e=0,n=0,i=1){this._x=t,this._y=e,this._z=n,this._w=i}static slerp(t,e,n,i){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(t,e,i)}static slerpFlat(t,e,n,i,r,s,o){let a=n[i+0],c=n[i+1],l=n[i+2],u=n[i+3];const d=r[s+0],h=r[s+1],A=r[s+2],p=r[s+3];if(0===o)return t[e+0]=a,t[e+1]=c,t[e+2]=l,void(t[e+3]=u);if(1===o)return t[e+0]=d,t[e+1]=h,t[e+2]=A,void(t[e+3]=p);if(u!==p||a!==d||c!==h||l!==A){let t=1-o;const e=a*d+c*h+l*A+u*p,n=e>=0?1:-1,i=1-e*e;if(i>Number.EPSILON){const r=Math.sqrt(i),s=Math.atan2(r,e*n);t=Math.sin(t*s)/r,o=Math.sin(o*s)/r}const r=o*n;if(a=a*t+d*r,c=c*t+h*r,l=l*t+A*r,u=u*t+p*r,t===1-o){const t=1/Math.sqrt(a*a+c*c+l*l+u*u);a*=t,c*=t,l*=t,u*=t}}t[e]=a,t[e+1]=c,t[e+2]=l,t[e+3]=u}static multiplyQuaternionsFlat(t,e,n,i,r,s){const o=n[i],a=n[i+1],c=n[i+2],l=n[i+3],u=r[s],d=r[s+1],h=r[s+2],A=r[s+3];return t[e]=o*A+l*u+a*h-c*d,t[e+1]=a*A+l*d+c*u-o*h,t[e+2]=c*A+l*h+o*d-a*u,t[e+3]=l*A-o*u-a*d-c*h,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,n,i){return this._x=t,this._y=e,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,i=t._y,r=t._z,s=t._order,o=Math.cos,a=Math.sin,c=o(n/2),l=o(i/2),u=o(r/2),d=a(n/2),h=a(i/2),A=a(r/2);switch(s){case"XYZ":this._x=d*l*u+c*h*A,this._y=c*h*u-d*l*A,this._z=c*l*A+d*h*u,this._w=c*l*u-d*h*A;break;case"YXZ":this._x=d*l*u+c*h*A,this._y=c*h*u-d*l*A,this._z=c*l*A-d*h*u,this._w=c*l*u+d*h*A;break;case"ZXY":this._x=d*l*u-c*h*A,this._y=c*h*u+d*l*A,this._z=c*l*A+d*h*u,this._w=c*l*u-d*h*A;break;case"ZYX":this._x=d*l*u-c*h*A,this._y=c*h*u+d*l*A,this._z=c*l*A-d*h*u,this._w=c*l*u+d*h*A;break;case"YZX":this._x=d*l*u+c*h*A,this._y=c*h*u+d*l*A,this._z=c*l*A-d*h*u,this._w=c*l*u-d*h*A;break;case"XZY":this._x=d*l*u-c*h*A,this._y=c*h*u-d*l*A,this._z=c*l*A+d*h*u,this._w=c*l*u+d*h*A;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const n=e/2,i=Math.sin(n);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,n=e[0],i=e[4],r=e[8],s=e[1],o=e[5],a=e[9],c=e[2],l=e[6],u=e[10],d=n+o+u;if(d>0){const t=.5/Math.sqrt(d+1);this._w=.25/t,this._x=(l-a)*t,this._y=(r-c)*t,this._z=(s-i)*t}else if(n>o&&n>u){const t=2*Math.sqrt(1+n-o-u);this._w=(l-a)/t,this._x=.25*t,this._y=(i+s)/t,this._z=(r+c)/t}else if(o>u){const t=2*Math.sqrt(1+o-n-u);this._w=(r-c)/t,this._x=(i+s)/t,this._y=.25*t,this._z=(a+l)/t}else{const t=2*Math.sqrt(1+u-n-o);this._w=(s-i)/t,this._x=(r+c)/t,this._y=(a+l)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let n=t.dot(e)+1;return n<Number.EPSILON?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(_t(this.dot(t),-1,1)))}rotateTowards(t,e){const n=this.angleTo(t);if(0===n)return this;const i=Math.min(1,e/n);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t,e){return void 0!==e?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(t,e)):this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const n=t._x,i=t._y,r=t._z,s=t._w,o=e._x,a=e._y,c=e._z,l=e._w;return this._x=n*l+s*o+i*c-r*a,this._y=i*l+s*a+r*o-n*c,this._z=r*l+s*c+n*a-i*o,this._w=s*l-n*o-i*a-r*c,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,i=this._y,r=this._z,s=this._w;let o=s*t._w+n*t._x+i*t._y+r*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=n,this._y=i,this._z=r,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*n+e*this._x,this._y=t*i+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(a),l=Math.atan2(c,o),u=Math.sin((1-e)*l)/c,d=Math.sin(e*l)/c;return this._w=s*u+this._w*d,this._x=n*u+this._x*d,this._y=i*u+this._y*d,this._z=r*u+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,n){return this.copy(t).slerp(e,n)}random(){const t=Math.random(),e=Math.sqrt(1-t),n=Math.sqrt(t),i=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(i),n*Math.sin(r),n*Math.cos(r),e*Math.sin(i))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Zt.prototype.isQuaternion=!0;class te{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}set(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(ne.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(ne.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6]*i,this.y=r[1]*e+r[4]*n+r[7]*i,this.z=r[2]*e+r[5]*n+r[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,n=this.y,i=this.z,r=t.elements,s=1/(r[3]*e+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*e+r[4]*n+r[8]*i+r[12])*s,this.y=(r[1]*e+r[5]*n+r[9]*i+r[13])*s,this.z=(r[2]*e+r[6]*n+r[10]*i+r[14])*s,this}applyQuaternion(t){const e=this.x,n=this.y,i=this.z,r=t.x,s=t.y,o=t.z,a=t.w,c=a*e+s*i-o*n,l=a*n+o*e-r*i,u=a*i+r*n-s*e,d=-r*e-s*n-o*i;return this.x=c*a+d*-r+l*-o-u*-s,this.y=l*a+d*-s+u*-r-c*-o,this.z=u*a+d*-o+c*-s-l*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,n=this.y,i=this.z,r=t.elements;return this.x=r[0]*e+r[4]*n+r[8]*i,this.y=r[1]*e+r[5]*n+r[9]*i,this.z=r[2]*e+r[6]*n+r[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this}cross(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)}crossVectors(t,e){const n=t.x,i=t.y,r=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-r*o,this.y=r*s-n*a,this.z=n*o-i*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)}projectOnPlane(t){return ee.copy(this).projectOnVector(t),this.sub(ee)}reflect(t){return this.sub(ee.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(_t(n,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return e*e+n*n+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,n){const i=Math.sin(e)*t;return this.x=i*Math.sin(n),this.y=Math.cos(e)*t,this.z=i*Math.cos(n),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,n=Math.sqrt(1-t**2);return this.x=n*Math.cos(e),this.y=n*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}te.prototype.isVector3=!0;const ee=new te,ne=new Zt;class ie{constructor(t=new te(1/0,1/0,1/0),e=new te(-1/0,-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,c=t.length;a<c;a+=3){const c=t[a],l=t[a+1],u=t[a+2];c<e&&(e=c),l<n&&(n=l),u<i&&(i=u),c>r&&(r=c),l>s&&(s=l),u>o&&(o=u)}return this.min.set(e,n,i),this.max.set(r,s,o),this}setFromBufferAttribute(t){let e=1/0,n=1/0,i=1/0,r=-1/0,s=-1/0,o=-1/0;for(let a=0,c=t.count;a<c;a++){const c=t.getX(a),l=t.getY(a),u=t.getZ(a);c<e&&(e=c),l<n&&(n=l),u<i&&(i=u),c>r&&(r=c),l>s&&(s=l),u>o&&(o=u)}return this.min.set(e,n,i),this.max.set(r,s,o),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=se.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const n=t.geometry;if(void 0!==n)if(e&&null!=n.attributes&&void 0!==n.attributes.position){const e=n.attributes.position;for(let n=0,i=e.count;n<i;n++)se.fromBufferAttribute(e,n).applyMatrix4(t.matrixWorld),this.expandByPoint(se)}else null===n.boundingBox&&n.computeBoundingBox(),oe.copy(n.boundingBox),oe.applyMatrix4(t.matrixWorld),this.union(oe);const i=t.children;for(let t=0,n=i.length;t<n;t++)this.expandByObject(i[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,se),se.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ae),pe.subVectors(this.max,Ae),ae.subVectors(t.a,Ae),ce.subVectors(t.b,Ae),le.subVectors(t.c,Ae),ue.subVectors(ce,ae),de.subVectors(le,ce),he.subVectors(ae,le);let e=[0,-ue.z,ue.y,0,-de.z,de.y,0,-he.z,he.y,ue.z,0,-ue.x,de.z,0,-de.x,he.z,0,-he.x,-ue.y,ue.x,0,-de.y,de.x,0,-he.y,he.x,0];return!!ge(e,ae,ce,le,pe)&&(e=[1,0,0,0,1,0,0,0,1],!!ge(e,ae,ce,le,pe)&&(fe.crossVectors(ue,de),e=[fe.x,fe.y,fe.z],ge(e,ae,ce,le,pe)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return se.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(se).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(re[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),re[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),re[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),re[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),re[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),re[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),re[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),re[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(re)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}ie.prototype.isBox3=!0;const re=[new te,new te,new te,new te,new te,new te,new te,new te],se=new te,oe=new ie,ae=new te,ce=new te,le=new te,ue=new te,de=new te,he=new te,Ae=new te,pe=new te,fe=new te,me=new te;function ge(t,e,n,i,r){for(let s=0,o=t.length-3;s<=o;s+=3){me.fromArray(t,s);const o=r.x*Math.abs(me.x)+r.y*Math.abs(me.y)+r.z*Math.abs(me.z),a=e.dot(me),c=n.dot(me),l=i.dot(me);if(Math.max(-Math.max(a,c,l),Math.min(a,c,l))>o)return!1}return!0}const ve=new ie,ye=new te,_e=new te,be=new te;class Ee{constructor(t=new te,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const n=this.center;void 0!==e?n.copy(e):ve.setFromPoints(t).getCenter(n);let i=0;for(let e=0,r=t.length;e<r;e++)i=Math.max(i,n.distanceToSquared(t[e]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const n=this.center.distanceToSquared(t);return e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){be.subVectors(t,this.center);const e=be.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),n=.5*(t-this.radius);this.center.add(be.multiplyScalar(n/t)),this.radius+=n}return this}union(t){return!0===this.center.equals(t.center)?_e.set(0,0,1).multiplyScalar(t.radius):_e.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(ye.copy(t.center).add(_e)),this.expandByPoint(ye.copy(t.center).sub(_e)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const we=new te,Se=new te,Te=new te,Ce=new te,Re=new te,Ie=new te,xe=new te;class Oe{constructor(t=new te,e=new te(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,we)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=we.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(we.copy(this.direction).multiplyScalar(e).add(this.origin),we.distanceToSquared(t))}distanceSqToSegment(t,e,n,i){Se.copy(t).add(e).multiplyScalar(.5),Te.copy(e).sub(t).normalize(),Ce.copy(this.origin).sub(Se);const r=.5*t.distanceTo(e),s=-this.direction.dot(Te),o=Ce.dot(this.direction),a=-Ce.dot(Te),c=Ce.lengthSq(),l=Math.abs(1-s*s);let u,d,h,A;if(l>0)if(u=s*a-o,d=s*o-a,A=r*l,u>=0)if(d>=-A)if(d<=A){const t=1/l;u*=t,d*=t,h=u*(u+s*d+2*o)+d*(s*u+d+2*a)+c}else d=r,u=Math.max(0,-(s*d+o)),h=-u*u+d*(d+2*a)+c;else d=-r,u=Math.max(0,-(s*d+o)),h=-u*u+d*(d+2*a)+c;else d<=-A?(u=Math.max(0,-(-s*r+o)),d=u>0?-r:Math.min(Math.max(-r,-a),r),h=-u*u+d*(d+2*a)+c):d<=A?(u=0,d=Math.min(Math.max(-r,-a),r),h=d*(d+2*a)+c):(u=Math.max(0,-(s*r+o)),d=u>0?r:Math.min(Math.max(-r,-a),r),h=-u*u+d*(d+2*a)+c);else d=s>0?-r:r,u=Math.max(0,-(s*d+o)),h=-u*u+d*(d+2*a)+c;return n&&n.copy(this.direction).multiplyScalar(u).add(this.origin),i&&i.copy(Te).multiplyScalar(d).add(Se),h}intersectSphere(t,e){we.subVectors(t.center,this.origin);const n=we.dot(this.direction),i=we.dot(we)-n*n,r=t.radius*t.radius;if(i>r)return null;const s=Math.sqrt(r-i),o=n-s,a=n+s;return o<0&&a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null}intersectPlane(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let n,i,r,s,o,a;const c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,d=this.origin;return c>=0?(n=(t.min.x-d.x)*c,i=(t.max.x-d.x)*c):(n=(t.max.x-d.x)*c,i=(t.min.x-d.x)*c),l>=0?(r=(t.min.y-d.y)*l,s=(t.max.y-d.y)*l):(r=(t.max.y-d.y)*l,s=(t.min.y-d.y)*l),n>s||r>i?null:((r>n||n!=n)&&(n=r),(s<i||i!=i)&&(i=s),u>=0?(o=(t.min.z-d.z)*u,a=(t.max.z-d.z)*u):(o=(t.max.z-d.z)*u,a=(t.min.z-d.z)*u),n>a||o>i?null:((o>n||n!=n)&&(n=o),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,e)))}intersectsBox(t){return null!==this.intersectBox(t,we)}intersectTriangle(t,e,n,i,r){Re.subVectors(e,t),Ie.subVectors(n,t),xe.crossVectors(Re,Ie);let s,o=this.direction.dot(xe);if(o>0){if(i)return null;s=1}else{if(!(o<0))return null;s=-1,o=-o}Ce.subVectors(this.origin,t);const a=s*this.direction.dot(Ie.crossVectors(Ce,Ie));if(a<0)return null;const c=s*this.direction.dot(Re.cross(Ce));if(c<0)return null;if(a+c>o)return null;const l=-s*Ce.dot(xe);return l<0?null:this.at(l/o,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Le{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(t,e,n,i,r,s,o,a,c,l,u,d,h,A,p,f){const m=this.elements;return m[0]=t,m[4]=e,m[8]=n,m[12]=i,m[1]=r,m[5]=s,m[9]=o,m[13]=a,m[2]=c,m[6]=l,m[10]=u,m[14]=d,m[3]=h,m[7]=A,m[11]=p,m[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Le).fromArray(this.elements)}copy(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this}copyPosition(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,n=t.elements,i=1/Me.setFromMatrixColumn(t,0).length(),r=1/Me.setFromMatrixColumn(t,1).length(),s=1/Me.setFromMatrixColumn(t,2).length();return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=0,e[8]=n[8]*s,e[9]=n[9]*s,e[10]=n[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,i=t.y,r=t.z,s=Math.cos(n),o=Math.sin(n),a=Math.cos(i),c=Math.sin(i),l=Math.cos(r),u=Math.sin(r);if("XYZ"===t.order){const t=s*l,n=s*u,i=o*l,r=o*u;e[0]=a*l,e[4]=-a*u,e[8]=c,e[1]=n+i*c,e[5]=t-r*c,e[9]=-o*a,e[2]=r-t*c,e[6]=i+n*c,e[10]=s*a}else if("YXZ"===t.order){const t=a*l,n=a*u,i=c*l,r=c*u;e[0]=t+r*o,e[4]=i*o-n,e[8]=s*c,e[1]=s*u,e[5]=s*l,e[9]=-o,e[2]=n*o-i,e[6]=r+t*o,e[10]=s*a}else if("ZXY"===t.order){const t=a*l,n=a*u,i=c*l,r=c*u;e[0]=t-r*o,e[4]=-s*u,e[8]=i+n*o,e[1]=n+i*o,e[5]=s*l,e[9]=r-t*o,e[2]=-s*c,e[6]=o,e[10]=s*a}else if("ZYX"===t.order){const t=s*l,n=s*u,i=o*l,r=o*u;e[0]=a*l,e[4]=i*c-n,e[8]=t*c+r,e[1]=a*u,e[5]=r*c+t,e[9]=n*c-i,e[2]=-c,e[6]=o*a,e[10]=s*a}else if("YZX"===t.order){const t=s*a,n=s*c,i=o*a,r=o*c;e[0]=a*l,e[4]=r-t*u,e[8]=i*u+n,e[1]=u,e[5]=s*l,e[9]=-o*l,e[2]=-c*l,e[6]=n*u+i,e[10]=t-r*u}else if("XZY"===t.order){const t=s*a,n=s*c,i=o*a,r=o*c;e[0]=a*l,e[4]=-u,e[8]=c*l,e[1]=t*u+r,e[5]=s*l,e[9]=n*u-i,e[2]=i*u-n,e[6]=o*l,e[10]=r*u+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ne,t,Pe)}lookAt(t,e,n){const i=this.elements;return Ue.subVectors(t,e),0===Ue.lengthSq()&&(Ue.z=1),Ue.normalize(),De.crossVectors(n,Ue),0===De.lengthSq()&&(1===Math.abs(n.z)?Ue.x+=1e-4:Ue.z+=1e-4,Ue.normalize(),De.crossVectors(n,Ue)),De.normalize(),Be.crossVectors(Ue,De),i[0]=De.x,i[4]=Be.x,i[8]=Ue.x,i[1]=De.y,i[5]=Be.y,i[9]=Ue.y,i[2]=De.z,i[6]=Be.z,i[10]=Ue.z,this}multiply(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const n=t.elements,i=e.elements,r=this.elements,s=n[0],o=n[4],a=n[8],c=n[12],l=n[1],u=n[5],d=n[9],h=n[13],A=n[2],p=n[6],f=n[10],m=n[14],g=n[3],v=n[7],y=n[11],_=n[15],b=i[0],E=i[4],w=i[8],S=i[12],T=i[1],C=i[5],R=i[9],I=i[13],x=i[2],O=i[6],L=i[10],M=i[14],k=i[3],N=i[7],P=i[11],D=i[15];return r[0]=s*b+o*T+a*x+c*k,r[4]=s*E+o*C+a*O+c*N,r[8]=s*w+o*R+a*L+c*P,r[12]=s*S+o*I+a*M+c*D,r[1]=l*b+u*T+d*x+h*k,r[5]=l*E+u*C+d*O+h*N,r[9]=l*w+u*R+d*L+h*P,r[13]=l*S+u*I+d*M+h*D,r[2]=A*b+p*T+f*x+m*k,r[6]=A*E+p*C+f*O+m*N,r[10]=A*w+p*R+f*L+m*P,r[14]=A*S+p*I+f*M+m*D,r[3]=g*b+v*T+y*x+_*k,r[7]=g*E+v*C+y*O+_*N,r[11]=g*w+v*R+y*L+_*P,r[15]=g*S+v*I+y*M+_*D,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],n=t[4],i=t[8],r=t[12],s=t[1],o=t[5],a=t[9],c=t[13],l=t[2],u=t[6],d=t[10],h=t[14];return t[3]*(+r*a*u-i*c*u-r*o*d+n*c*d+i*o*h-n*a*h)+t[7]*(+e*a*h-e*c*d+r*s*d-i*s*h+i*c*l-r*a*l)+t[11]*(+e*c*u-e*o*h-r*s*u+n*s*h+r*o*l-n*c*l)+t[15]*(-i*o*l-e*a*u+e*o*d+i*s*u-n*s*d+n*a*l)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,n){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=n),this}invert(){const t=this.elements,e=t[0],n=t[1],i=t[2],r=t[3],s=t[4],o=t[5],a=t[6],c=t[7],l=t[8],u=t[9],d=t[10],h=t[11],A=t[12],p=t[13],f=t[14],m=t[15],g=u*f*c-p*d*c+p*a*h-o*f*h-u*a*m+o*d*m,v=A*d*c-l*f*c-A*a*h+s*f*h+l*a*m-s*d*m,y=l*p*c-A*u*c+A*o*h-s*p*h-l*o*m+s*u*m,_=A*u*a-l*p*a-A*o*d+s*p*d+l*o*f-s*u*f,b=e*g+n*v+i*y+r*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const E=1/b;return t[0]=g*E,t[1]=(p*d*r-u*f*r-p*i*h+n*f*h+u*i*m-n*d*m)*E,t[2]=(o*f*r-p*a*r+p*i*c-n*f*c-o*i*m+n*a*m)*E,t[3]=(u*a*r-o*d*r-u*i*c+n*d*c+o*i*h-n*a*h)*E,t[4]=v*E,t[5]=(l*f*r-A*d*r+A*i*h-e*f*h-l*i*m+e*d*m)*E,t[6]=(A*a*r-s*f*r-A*i*c+e*f*c+s*i*m-e*a*m)*E,t[7]=(s*d*r-l*a*r+l*i*c-e*d*c-s*i*h+e*a*h)*E,t[8]=y*E,t[9]=(A*u*r-l*p*r-A*n*h+e*p*h+l*n*m-e*u*m)*E,t[10]=(s*p*r-A*o*r+A*n*c-e*p*c-s*n*m+e*o*m)*E,t[11]=(l*o*r-s*u*r-l*n*c+e*u*c+s*n*h-e*o*h)*E,t[12]=_*E,t[13]=(l*p*i-A*u*i+A*n*d-e*p*d-l*n*f+e*u*f)*E,t[14]=(A*o*i-s*p*i-A*n*a+e*p*a+s*n*f-e*o*f)*E,t[15]=(s*u*i-l*o*i+l*n*a-e*u*a-s*n*d+e*o*d)*E,this}scale(t){const e=this.elements,n=t.x,i=t.y,r=t.z;return e[0]*=n,e[4]*=i,e[8]*=r,e[1]*=n,e[5]*=i,e[9]*=r,e[2]*=n,e[6]*=i,e[10]*=r,e[3]*=n,e[7]*=i,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,i))}makeTranslation(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),n=Math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),n=Math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const n=Math.cos(e),i=Math.sin(e),r=1-n,s=t.x,o=t.y,a=t.z,c=r*s,l=r*o;return this.set(c*s+n,c*o-i*a,c*a+i*o,0,c*o+i*a,l*o+n,l*a-i*s,0,c*a-i*o,l*a+i*s,r*a*a+n,0,0,0,0,1),this}makeScale(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this}makeShear(t,e,n,i,r,s){return this.set(1,n,r,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,n){const i=this.elements,r=e._x,s=e._y,o=e._z,a=e._w,c=r+r,l=s+s,u=o+o,d=r*c,h=r*l,A=r*u,p=s*l,f=s*u,m=o*u,g=a*c,v=a*l,y=a*u,_=n.x,b=n.y,E=n.z;return i[0]=(1-(p+m))*_,i[1]=(h+y)*_,i[2]=(A-v)*_,i[3]=0,i[4]=(h-y)*b,i[5]=(1-(d+m))*b,i[6]=(f+g)*b,i[7]=0,i[8]=(A+v)*E,i[9]=(f-g)*E,i[10]=(1-(d+p))*E,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,n){const i=this.elements;let r=Me.set(i[0],i[1],i[2]).length();const s=Me.set(i[4],i[5],i[6]).length(),o=Me.set(i[8],i[9],i[10]).length();this.determinant()<0&&(r=-r),t.x=i[12],t.y=i[13],t.z=i[14],ke.copy(this);const a=1/r,c=1/s,l=1/o;return ke.elements[0]*=a,ke.elements[1]*=a,ke.elements[2]*=a,ke.elements[4]*=c,ke.elements[5]*=c,ke.elements[6]*=c,ke.elements[8]*=l,ke.elements[9]*=l,ke.elements[10]*=l,e.setFromRotationMatrix(ke),n.x=r,n.y=s,n.z=o,this}makePerspective(t,e,n,i,r,s){void 0===s&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*r/(e-t),c=2*r/(n-i),l=(e+t)/(e-t),u=(n+i)/(n-i),d=-(s+r)/(s-r),h=-2*s*r/(s-r);return o[0]=a,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=c,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=d,o[14]=h,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(t,e,n,i,r,s){const o=this.elements,a=1/(e-t),c=1/(n-i),l=1/(s-r),u=(e+t)*a,d=(n+i)*c,h=(s+r)*l;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-d,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-h,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(t){const e=this.elements,n=t.elements;for(let t=0;t<16;t++)if(e[t]!==n[t])return!1;return!0}fromArray(t,e=0){for(let n=0;n<16;n++)this.elements[n]=t[n+e];return this}toArray(t=[],e=0){const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}}Le.prototype.isMatrix4=!0;const Me=new te,ke=new Le,Ne=new te(0,0,0),Pe=new te(1,1,1),De=new te,Be=new te,Ue=new te,Fe=new Le,He=new Zt;class Ve{constructor(t=0,e=0,n=0,i=Ve.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,n,i=this._order){return this._x=t,this._y=e,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,n=!0){const i=t.elements,r=i[0],s=i[4],o=i[8],a=i[1],c=i[5],l=i[9],u=i[2],d=i[6],h=i[10];switch(e){case"XYZ":this._y=Math.asin(_t(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-l,h),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(d,c),this._z=0);break;case"YXZ":this._x=Math.asin(-_t(l,-1,1)),Math.abs(l)<.9999999?(this._y=Math.atan2(o,h),this._z=Math.atan2(a,c)):(this._y=Math.atan2(-u,r),this._z=0);break;case"ZXY":this._x=Math.asin(_t(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-s,c)):(this._y=0,this._z=Math.atan2(a,r));break;case"ZYX":this._y=Math.asin(-_t(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(d,h),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-s,c));break;case"YZX":this._z=Math.asin(_t(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-l,c),this._y=Math.atan2(-u,r)):(this._x=0,this._y=Math.atan2(o,h));break;case"XZY":this._z=Math.asin(-_t(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,c),this._y=Math.atan2(o,r)):(this._x=Math.atan2(-l,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===n&&this._onChangeCallback(),this}setFromQuaternion(t,e,n){return Fe.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Fe,e,n)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return He.setFromEuler(this),this.setFromQuaternion(He,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}}Ve.prototype.isEuler=!0,Ve.DefaultOrder="XYZ",Ve.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class je{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let Ge=0;const Qe=new te,ze=new Zt,We=new Le,Ke=new te,qe=new te,Ye=new te,$e=new Zt,Xe=new te(1,0,0),Je=new te(0,1,0),Ze=new te(0,0,1),tn={type:"added"},en={type:"removed"};class nn extends pt{constructor(){super(),Object.defineProperty(this,"id",{value:Ge++}),this.uuid=yt(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=nn.DefaultUp.clone();const t=new te,e=new Ve,n=new Zt,i=new te(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Le},normalMatrix:{value:new It}}),this.matrix=new Le,this.matrixWorld=new Le,this.matrixAutoUpdate=nn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new je,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ze.setFromAxisAngle(t,e),this.quaternion.multiply(ze),this}rotateOnWorldAxis(t,e){return ze.setFromAxisAngle(t,e),this.quaternion.premultiply(ze),this}rotateX(t){return this.rotateOnAxis(Xe,t)}rotateY(t){return this.rotateOnAxis(Je,t)}rotateZ(t){return this.rotateOnAxis(Ze,t)}translateOnAxis(t,e){return Qe.copy(t).applyQuaternion(this.quaternion),this.position.add(Qe.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Xe,t)}translateY(t){return this.translateOnAxis(Je,t)}translateZ(t){return this.translateOnAxis(Ze,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(We.copy(this.matrixWorld).invert())}lookAt(t,e,n){t.isVector3?Ke.copy(t):Ke.set(t,e,n);const i=this.parent;this.updateWorldMatrix(!0,!1),qe.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?We.lookAt(qe,Ke,this.up):We.lookAt(Ke,qe,this.up),this.quaternion.setFromRotationMatrix(We),i&&(We.extractRotation(i.matrixWorld),ze.setFromRotationMatrix(We),this.quaternion.premultiply(ze.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(tn)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(en)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(en)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),We.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),We.multiply(t.parent.matrixWorld)),t.applyMatrix4(We),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let n=0,i=this.children.length;n<i;n++){const i=this.children[n].getObjectByProperty(t,e);if(void 0!==i)return i}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qe,t,Ye),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qe,$e,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let n=0,i=e.length;n<i;n++)e[n].updateMatrixWorld(t)}updateWorldMatrix(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,n=t.length;e<n;e++)t[e].updateWorldMatrix(!1,!0)}}toJSON(t){const e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const i={};function r(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.toJSON(t)),n.uuid}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),!0===this.castShadow&&(i.castShadow=!0),!0===this.receiveShadow&&(i.receiveShadow=!0),!1===this.visible&&(i.visible=!1),!1===this.frustumCulled&&(i.frustumCulled=!1),0!==this.renderOrder&&(i.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(i.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const n=e.shapes;if(Array.isArray(n))for(let e=0,i=n.length;e<i;e++){const i=n[e];r(t.shapes,i)}else r(t.shapes,n)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let n=0,i=this.material.length;n<i;n++)e.push(r(t.materials,this.material[n]));i.material=e}else i.material=r(t.materials,this.material);if(this.children.length>0){i.children=[];for(let e=0;e<this.children.length;e++)i.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let e=0;e<this.animations.length;e++){const n=this.animations[e];i.animations.push(r(t.animations,n))}}if(e){const e=s(t.geometries),i=s(t.materials),r=s(t.textures),o=s(t.images),a=s(t.shapes),c=s(t.skeletons),l=s(t.animations),u=s(t.nodes);e.length>0&&(n.geometries=e),i.length>0&&(n.materials=i),r.length>0&&(n.textures=r),o.length>0&&(n.images=o),a.length>0&&(n.shapes=a),c.length>0&&(n.skeletons=c),l.length>0&&(n.animations=l),u.length>0&&(n.nodes=u)}return n.object=i,n;function s(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const n=t.children[e];this.add(n.clone())}return this}}nn.DefaultUp=new te(0,1,0),nn.DefaultMatrixAutoUpdate=!0,nn.prototype.isObject3D=!0;const rn=new te,sn=new te,on=new te,an=new te,cn=new te,ln=new te,un=new te,dn=new te,hn=new te,An=new te;class pn{constructor(t=new te,e=new te,n=new te){this.a=t,this.b=e,this.c=n}static getNormal(t,e,n,i){i.subVectors(n,e),rn.subVectors(t,e),i.cross(rn);const r=i.lengthSq();return r>0?i.multiplyScalar(1/Math.sqrt(r)):i.set(0,0,0)}static getBarycoord(t,e,n,i,r){rn.subVectors(i,e),sn.subVectors(n,e),on.subVectors(t,e);const s=rn.dot(rn),o=rn.dot(sn),a=rn.dot(on),c=sn.dot(sn),l=sn.dot(on),u=s*c-o*o;if(0===u)return r.set(-2,-1,-1);const d=1/u,h=(c*a-o*l)*d,A=(s*l-o*a)*d;return r.set(1-h-A,A,h)}static containsPoint(t,e,n,i){return this.getBarycoord(t,e,n,i,an),an.x>=0&&an.y>=0&&an.x+an.y<=1}static getUV(t,e,n,i,r,s,o,a){return this.getBarycoord(t,e,n,i,an),a.set(0,0),a.addScaledVector(r,an.x),a.addScaledVector(s,an.y),a.addScaledVector(o,an.z),a}static isFrontFacing(t,e,n,i){return rn.subVectors(n,e),sn.subVectors(t,e),rn.cross(sn).dot(i)<0}set(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this}setFromPointsAndIndices(t,e,n,i){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,n,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,n),this.c.fromBufferAttribute(t,i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return rn.subVectors(this.c,this.b),sn.subVectors(this.a,this.b),.5*rn.cross(sn).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return pn.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return pn.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,n,i,r){return pn.getUV(t,this.a,this.b,this.c,e,n,i,r)}containsPoint(t){return pn.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return pn.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const n=this.a,i=this.b,r=this.c;let s,o;cn.subVectors(i,n),ln.subVectors(r,n),dn.subVectors(t,n);const a=cn.dot(dn),c=ln.dot(dn);if(a<=0&&c<=0)return e.copy(n);hn.subVectors(t,i);const l=cn.dot(hn),u=ln.dot(hn);if(l>=0&&u<=l)return e.copy(i);const d=a*u-l*c;if(d<=0&&a>=0&&l<=0)return s=a/(a-l),e.copy(n).addScaledVector(cn,s);An.subVectors(t,r);const h=cn.dot(An),A=ln.dot(An);if(A>=0&&h<=A)return e.copy(r);const p=h*c-a*A;if(p<=0&&c>=0&&A<=0)return o=c/(c-A),e.copy(n).addScaledVector(ln,o);const f=l*A-h*u;if(f<=0&&u-l>=0&&h-A>=0)return un.subVectors(r,i),o=(u-l)/(u-l+(h-A)),e.copy(i).addScaledVector(un,o);const m=1/(f+p+d);return s=p*m,o=d*m,e.copy(n).addScaledVector(cn,s).addScaledVector(ln,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let fn=0;class mn extends pt{constructor(){super(),Object.defineProperty(this,"id",{value:fn++}),this.uuid=yt(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=n,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=lt,this.stencilZFail=lt,this.stencilZPass=lt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const i=this[e];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(t){const e=[];for(const n in t){const i=t[n];delete i.metadata,e.push(i)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(t).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(t).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(t).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(t).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(t).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),e){const e=i(t.textures),r=i(t.images);e.length>0&&(n.textures=e),r.length>0&&(n.images=r)}return n}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let n=null;if(null!==e){const t=e.length;n=new Array(t);for(let i=0;i!==t;++i)n[i]=e[i].clone()}return this.clippingPlanes=n,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}mn.prototype.isMaterial=!0,mn.fromType=function(){return null};class gn extends mn{constructor(t){super(),this.type="MeshBasicMaterial",this.color=new Ft(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}gn.prototype.isMeshBasicMaterial=!0;const vn=new te,yn=new Rt;class _n{constructor(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this}copyArray(t){return this.array.set(t),this}copyColorsArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new Ft),e[n++]=r.r,e[n++]=r.g,e[n++]=r.b}return this}copyVector2sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new Rt),e[n++]=r.x,e[n++]=r.y}return this}copyVector3sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new te),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z}return this}copyVector4sArray(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new Wt),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z,e[n++]=r.w}return this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,n=this.count;e<n;e++)yn.fromBufferAttribute(this,e),yn.applyMatrix3(t),this.setXY(e,yn.x,yn.y);else if(3===this.itemSize)for(let e=0,n=this.count;e<n;e++)vn.fromBufferAttribute(this,e),vn.applyMatrix3(t),this.setXYZ(e,vn.x,vn.y,vn.z);return this}applyMatrix4(t){for(let e=0,n=this.count;e<n;e++)vn.x=this.getX(e),vn.y=this.getY(e),vn.z=this.getZ(e),vn.applyMatrix4(t),this.setXYZ(e,vn.x,vn.y,vn.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)vn.x=this.getX(e),vn.y=this.getY(e),vn.z=this.getZ(e),vn.applyNormalMatrix(t),this.setXYZ(e,vn.x,vn.y,vn.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)vn.x=this.getX(e),vn.y=this.getY(e),vn.z=this.getZ(e),vn.transformDirection(t),this.setXYZ(e,vn.x,vn.y,vn.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){return this.array[t*this.itemSize]}setX(t,e){return this.array[t*this.itemSize]=e,this}getY(t){return this.array[t*this.itemSize+1]}setY(t,e){return this.array[t*this.itemSize+1]=e,this}getZ(t){return this.array[t*this.itemSize+2]}setZ(t,e){return this.array[t*this.itemSize+2]=e,this}getW(t){return this.array[t*this.itemSize+3]}setW(t,e){return this.array[t*this.itemSize+3]=e,this}setXY(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this}setXYZ(t,e,n,i){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=i,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==ut&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}}_n.prototype.isBufferAttribute=!0;class bn extends _n{constructor(t,e,n){super(new Int8Array(t),e,n)}}class En extends _n{constructor(t,e,n){super(new Uint8Array(t),e,n)}}class wn extends _n{constructor(t,e,n){super(new Uint8ClampedArray(t),e,n)}}class Sn extends _n{constructor(t,e,n){super(new Int16Array(t),e,n)}}class Tn extends _n{constructor(t,e,n){super(new Uint16Array(t),e,n)}}class Cn extends _n{constructor(t,e,n){super(new Int32Array(t),e,n)}}class Rn extends _n{constructor(t,e,n){super(new Uint32Array(t),e,n)}}class In extends _n{constructor(t,e,n){super(new Uint16Array(t),e,n)}}In.prototype.isFloat16BufferAttribute=!0;class xn extends _n{constructor(t,e,n){super(new Float32Array(t),e,n)}}class On extends _n{constructor(t,e,n){super(new Float64Array(t),e,n)}}let Ln=0;const Mn=new Le,kn=new nn,Nn=new te,Pn=new ie,Dn=new ie,Bn=new te;class Un extends pt{constructor(){super(),Object.defineProperty(this,"id",{value:Ln++}),this.uuid=yt(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(xt(t)?Rn:Tn)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,n=0){this.groups.push({start:t,count:e,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new It).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(t),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Mn.makeRotationFromQuaternion(t),this.applyMatrix4(Mn),this}rotateX(t){return Mn.makeRotationX(t),this.applyMatrix4(Mn),this}rotateY(t){return Mn.makeRotationY(t),this.applyMatrix4(Mn),this}rotateZ(t){return Mn.makeRotationZ(t),this.applyMatrix4(Mn),this}translate(t,e,n){return Mn.makeTranslation(t,e,n),this.applyMatrix4(Mn),this}scale(t,e,n){return Mn.makeScale(t,e,n),this.applyMatrix4(Mn),this}lookAt(t){return kn.lookAt(t),kn.updateMatrix(),this.applyMatrix4(kn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Nn).negate(),this.translate(Nn.x,Nn.y,Nn.z),this}setFromPoints(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n];e.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new xn(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ie);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new te(-1/0,-1/0,-1/0),new te(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Pn.setFromBufferAttribute(n),this.morphTargetsRelative?(Bn.addVectors(this.boundingBox.min,Pn.min),this.boundingBox.expandByPoint(Bn),Bn.addVectors(this.boundingBox.max,Pn.max),this.boundingBox.expandByPoint(Bn)):(this.boundingBox.expandByPoint(Pn.min),this.boundingBox.expandByPoint(Pn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Ee);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new te,1/0);if(t){const n=this.boundingSphere.center;if(Pn.setFromBufferAttribute(t),e)for(let t=0,n=e.length;t<n;t++){const n=e[t];Dn.setFromBufferAttribute(n),this.morphTargetsRelative?(Bn.addVectors(Pn.min,Dn.min),Pn.expandByPoint(Bn),Bn.addVectors(Pn.max,Dn.max),Pn.expandByPoint(Bn)):(Pn.expandByPoint(Dn.min),Pn.expandByPoint(Dn.max))}Pn.getCenter(n);let i=0;for(let e=0,r=t.count;e<r;e++)Bn.fromBufferAttribute(t,e),i=Math.max(i,n.distanceToSquared(Bn));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],o=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Bn.fromBufferAttribute(s,e),o&&(Nn.fromBufferAttribute(t,e),Bn.add(Nn)),i=Math.max(i,n.distanceToSquared(Bn))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=t.array,i=e.position.array,r=e.normal.array,s=e.uv.array,o=i.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new _n(new Float32Array(4*o),4));const a=this.getAttribute("tangent").array,c=[],l=[];for(let t=0;t<o;t++)c[t]=new te,l[t]=new te;const u=new te,d=new te,h=new te,A=new Rt,p=new Rt,f=new Rt,m=new te,g=new te;function v(t,e,n){u.fromArray(i,3*t),d.fromArray(i,3*e),h.fromArray(i,3*n),A.fromArray(s,2*t),p.fromArray(s,2*e),f.fromArray(s,2*n),d.sub(u),h.sub(u),p.sub(A),f.sub(A);const r=1/(p.x*f.y-f.x*p.y);isFinite(r)&&(m.copy(d).multiplyScalar(f.y).addScaledVector(h,-p.y).multiplyScalar(r),g.copy(h).multiplyScalar(p.x).addScaledVector(d,-f.x).multiplyScalar(r),c[t].add(m),c[e].add(m),c[n].add(m),l[t].add(g),l[e].add(g),l[n].add(g))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let t=0,e=y.length;t<e;++t){const e=y[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)v(n[t+0],n[t+1],n[t+2])}const _=new te,b=new te,E=new te,w=new te;function S(t){E.fromArray(r,3*t),w.copy(E);const e=c[t];_.copy(e),_.sub(E.multiplyScalar(E.dot(e))).normalize(),b.crossVectors(w,e);const n=b.dot(l[t])<0?-1:1;a[4*t]=_.x,a[4*t+1]=_.y,a[4*t+2]=_.z,a[4*t+3]=n}for(let t=0,e=y.length;t<e;++t){const e=y[t],i=e.start;for(let t=i,r=i+e.count;t<r;t+=3)S(n[t+0]),S(n[t+1]),S(n[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new _n(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let t=0,e=n.count;t<e;t++)n.setXYZ(t,0,0,0);const i=new te,r=new te,s=new te,o=new te,a=new te,c=new te,l=new te,u=new te;if(t)for(let d=0,h=t.count;d<h;d+=3){const h=t.getX(d+0),A=t.getX(d+1),p=t.getX(d+2);i.fromBufferAttribute(e,h),r.fromBufferAttribute(e,A),s.fromBufferAttribute(e,p),l.subVectors(s,r),u.subVectors(i,r),l.cross(u),o.fromBufferAttribute(n,h),a.fromBufferAttribute(n,A),c.fromBufferAttribute(n,p),o.add(l),a.add(l),c.add(l),n.setXYZ(h,o.x,o.y,o.z),n.setXYZ(A,a.x,a.y,a.z),n.setXYZ(p,c.x,c.y,c.z)}else for(let t=0,o=e.count;t<o;t+=3)i.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),l.subVectors(s,r),u.subVectors(i,r),l.cross(u),n.setXYZ(t+0,l.x,l.y,l.z),n.setXYZ(t+1,l.x,l.y,l.z),n.setXYZ(t+2,l.x,l.y,l.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const i in n){if(void 0===t.attributes[i])continue;const r=n[i].array,s=t.attributes[i],o=s.array,a=s.itemSize*e,c=Math.min(o.length,r.length-a);for(let t=0,e=a;t<c;t++,e++)r[e]=o[t]}return this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,n=t.count;e<n;e++)Bn.fromBufferAttribute(t,e),Bn.normalize(),t.setXYZ(e,Bn.x,Bn.y,Bn.z)}toNonIndexed(){function t(t,e){const n=t.array,i=t.itemSize,r=t.normalized,s=new n.constructor(e.length*i);let o=0,a=0;for(let r=0,c=e.length;r<c;r++){o=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*i;for(let t=0;t<i;t++)s[a++]=n[o++]}return new _n(s,i,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Un,n=this.index.array,i=this.attributes;for(const r in i){const s=t(i[r],n);e.setAttribute(r,s)}const r=this.morphAttributes;for(const i in r){const s=[],o=r[i];for(let e=0,i=o.length;e<i;e++){const i=t(o[e],n);s.push(i)}e.morphAttributes[i]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,n=s.length;t<n;t++){const n=s[t];e.addGroup(n.start,n.count,n.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const n=this.attributes;for(const e in n){const i=n[e];t.data.attributes[e]=i.toJSON(t.data)}const i={};let r=!1;for(const e in this.morphAttributes){const n=this.morphAttributes[e],s=[];for(let e=0,i=n.length;e<i;e++){const i=n[e];s.push(i.toJSON(t.data))}s.length>0&&(i[e]=s,r=!0)}r&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const n=t.index;null!==n&&this.setIndex(n.clone(e));const i=t.attributes;for(const t in i){const n=i[t];this.setAttribute(t,n.clone(e))}const r=t.morphAttributes;for(const t in r){const n=[],i=r[t];for(let t=0,r=i.length;t<r;t++)n.push(i[t].clone(e));this.morphAttributes[t]=n}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Un.prototype.isBufferGeometry=!0;const Fn=new Le,Hn=new Oe,Vn=new Ee,jn=new te,Gn=new te,Qn=new te,zn=new te,Wn=new te,Kn=new te,qn=new te,Yn=new te,$n=new te,Xn=new Rt,Jn=new Rt,Zn=new Rt,ti=new te,ei=new te;class ni extends nn{constructor(t=new Un,e=new gn){super(),this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(t,e){const n=this.geometry,i=this.material,r=this.matrixWorld;if(void 0===i)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Vn.copy(n.boundingSphere),Vn.applyMatrix4(r),!1===t.ray.intersectsSphere(Vn))return;if(Fn.copy(r).invert(),Hn.copy(t.ray).applyMatrix4(Fn),null!==n.boundingBox&&!1===Hn.intersectsBox(n.boundingBox))return;let s;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position,a=n.morphAttributes.position,c=n.morphTargetsRelative,l=n.attributes.uv,u=n.attributes.uv2,d=n.groups,h=n.drawRange;if(null!==r)if(Array.isArray(i))for(let n=0,A=d.length;n<A;n++){const A=d[n],p=i[A.materialIndex];for(let n=Math.max(A.start,h.start),i=Math.min(r.count,Math.min(A.start+A.count,h.start+h.count));n<i;n+=3){const i=r.getX(n),d=r.getX(n+1),h=r.getX(n+2);s=ii(this,p,t,Hn,o,a,c,l,u,i,d,h),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=A.materialIndex,e.push(s))}}else{for(let n=Math.max(0,h.start),d=Math.min(r.count,h.start+h.count);n<d;n+=3){const d=r.getX(n),h=r.getX(n+1),A=r.getX(n+2);s=ii(this,i,t,Hn,o,a,c,l,u,d,h,A),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}}else if(void 0!==o)if(Array.isArray(i))for(let n=0,r=d.length;n<r;n++){const r=d[n],A=i[r.materialIndex];for(let n=Math.max(r.start,h.start),i=Math.min(o.count,Math.min(r.start+r.count,h.start+h.count));n<i;n+=3){s=ii(this,A,t,Hn,o,a,c,l,u,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let n=Math.max(0,h.start),r=Math.min(o.count,h.start+h.count);n<r;n+=3){s=ii(this,i,t,Hn,o,a,c,l,u,n,n+1,n+2),s&&(s.faceIndex=Math.floor(n/3),e.push(s))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function ii(t,e,n,i,r,s,o,a,c,l,u,d){jn.fromBufferAttribute(r,l),Gn.fromBufferAttribute(r,u),Qn.fromBufferAttribute(r,d);const h=t.morphTargetInfluences;if(s&&h){qn.set(0,0,0),Yn.set(0,0,0),$n.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=h[t],n=s[t];0!==e&&(zn.fromBufferAttribute(n,l),Wn.fromBufferAttribute(n,u),Kn.fromBufferAttribute(n,d),o?(qn.addScaledVector(zn,e),Yn.addScaledVector(Wn,e),$n.addScaledVector(Kn,e)):(qn.addScaledVector(zn.sub(jn),e),Yn.addScaledVector(Wn.sub(Gn),e),$n.addScaledVector(Kn.sub(Qn),e)))}jn.add(qn),Gn.add(Yn),Qn.add($n)}t.isSkinnedMesh&&(t.boneTransform(l,jn),t.boneTransform(u,Gn),t.boneTransform(d,Qn));const A=function(t,e,n,i,r,s,o,a){let c;if(c=1===e.side?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,2!==e.side,a),null===c)return null;ei.copy(a),ei.applyMatrix4(t.matrixWorld);const l=n.ray.origin.distanceTo(ei);return l<n.near||l>n.far?null:{distance:l,point:ei.clone(),object:t}}(t,e,n,i,jn,Gn,Qn,ti);if(A){a&&(Xn.fromBufferAttribute(a,l),Jn.fromBufferAttribute(a,u),Zn.fromBufferAttribute(a,d),A.uv=pn.getUV(ti,jn,Gn,Qn,Xn,Jn,Zn,new Rt)),c&&(Xn.fromBufferAttribute(c,l),Jn.fromBufferAttribute(c,u),Zn.fromBufferAttribute(c,d),A.uv2=pn.getUV(ti,jn,Gn,Qn,Xn,Jn,Zn,new Rt));const t={a:l,b:u,c:d,normal:new te,materialIndex:0};pn.getNormal(jn,Gn,Qn,t.normal),A.face=t}return A}ni.prototype.isMesh=!0;class ri extends Un{constructor(t=1,e=1,n=1,i=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:i,heightSegments:r,depthSegments:s};const o=this;i=Math.floor(i),r=Math.floor(r),s=Math.floor(s);const a=[],c=[],l=[],u=[];let d=0,h=0;function A(t,e,n,i,r,s,A,p,f,m,g){const v=s/f,y=A/m,_=s/2,b=A/2,E=p/2,w=f+1,S=m+1;let T=0,C=0;const R=new te;for(let s=0;s<S;s++){const o=s*y-b;for(let a=0;a<w;a++){const d=a*v-_;R[t]=d*i,R[e]=o*r,R[n]=E,c.push(R.x,R.y,R.z),R[t]=0,R[e]=0,R[n]=p>0?1:-1,l.push(R.x,R.y,R.z),u.push(a/f),u.push(1-s/m),T+=1}}for(let t=0;t<m;t++)for(let e=0;e<f;e++){const n=d+e+w*t,i=d+e+w*(t+1),r=d+(e+1)+w*(t+1),s=d+(e+1)+w*t;a.push(n,i,s),a.push(i,r,s),C+=6}o.addGroup(h,C,g),h+=C,d+=T}A("z","y","x",-1,-1,n,e,t,s,r,0),A("z","y","x",1,-1,n,e,-t,s,r,1),A("x","z","y",1,1,t,n,e,i,s,2),A("x","z","y",1,-1,t,n,-e,i,s,3),A("x","y","z",1,-1,t,e,n,i,r,4),A("x","y","z",-1,-1,t,e,-n,i,r,5),this.setIndex(a),this.setAttribute("position",new xn(c,3)),this.setAttribute("normal",new xn(l,3)),this.setAttribute("uv",new xn(u,2))}static fromJSON(t){return new ri(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function si(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}function oi(t){const e={};for(let n=0;n<t.length;n++){const i=si(t[n]);for(const t in i)e[t]=i[t]}return e}const ai={clone:si,merge:oi};class ci extends mn{constructor(t){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=si(t.uniforms),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const n in this.uniforms){const i=this.uniforms[n].value;i&&i.isTexture?e.uniforms[n]={type:"t",value:i.toJSON(t).uuid}:i&&i.isColor?e.uniforms[n]={type:"c",value:i.getHex()}:i&&i.isVector2?e.uniforms[n]={type:"v2",value:i.toArray()}:i&&i.isVector3?e.uniforms[n]={type:"v3",value:i.toArray()}:i&&i.isVector4?e.uniforms[n]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?e.uniforms[n]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?e.uniforms[n]={type:"m4",value:i.toArray()}:e.uniforms[n]={value:i}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const n={};for(const t in this.extensions)!0===this.extensions[t]&&(n[t]=!0);return Object.keys(n).length>0&&(e.extensions=n),e}}ci.prototype.isShaderMaterial=!0;class li extends nn{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Le,this.projectionMatrix=new Le,this.projectionMatrixInverse=new Le}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}li.prototype.isCamera=!0;class ui extends li{constructor(t=50,e=1,n=.1,i=2e3){super(),this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*vt*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*gt*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*vt*Math.atan(Math.tan(.5*gt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,n,i,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*gt*this.fov)/this.zoom,n=2*e,i=this.aspect*n,r=-.5*i;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,o=s.fullHeight;r+=s.offsetX*i/t,e-=s.offsetY*n/o,i*=s.width/t,n*=s.height/o}const o=this.filmOffset;0!==o&&(r+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,e,e-n,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}ui.prototype.isPerspectiveCamera=!0;const di=90;class hi extends nn{constructor(t,e,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const i=new ui(di,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new te(1,0,0)),this.add(i);const r=new ui(di,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new te(-1,0,0)),this.add(r);const s=new ui(di,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new te(0,1,0)),this.add(s);const o=new ui(di,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new te(0,-1,0)),this.add(o);const a=new ui(di,1,t,e);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new te(0,0,1)),this.add(a);const c=new ui(di,1,t,e);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new te(0,0,-1)),this.add(c)}update(t,e){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[i,r,s,o,a,c]=this.children,l=t.xr.enabled,u=t.getRenderTarget();t.xr.enabled=!1;const d=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,i),t.setRenderTarget(n,1),t.render(e,r),t.setRenderTarget(n,2),t.render(e,s),t.setRenderTarget(n,3),t.render(e,o),t.setRenderTarget(n,4),t.render(e,a),n.texture.generateMipmaps=d,t.setRenderTarget(n,5),t.render(e,c),t.setRenderTarget(u),t.xr.enabled=l,n.texture.needsPMREMUpdate=!0}}class Ai extends zt{constructor(t,e,n,i,s,o,a,c,l,u){super(t=void 0!==t?t:[],e=void 0!==e?e:r,n,i,s,o,a,c,l,u),this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}Ai.prototype.isCubeTexture=!0;class pi extends Kt{constructor(t,e={}){super(t,t,e);const n={width:t,height:t,depth:1},i=[n,n,n,n,n,n];this.texture=new Ai(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:m}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.format=T,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},i=new ri(5,5,5),r=new ci({name:"CubemapFromEquirect",uniforms:si(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const s=new ni(i,r),o=e.minFilter;e.minFilter===v&&(e.minFilter=m);return new hi(1,10,this).update(t,s),e.minFilter=o,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,n,i){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,n,i);t.setRenderTarget(r)}}pi.prototype.isWebGLCubeRenderTarget=!0;const fi=new te,mi=new te,gi=new It;class vi{constructor(t=new te(1,0,0),e=0){this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,n,i){return this.normal.set(t,e,n),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,n){const i=fi.subVectors(n,e).cross(mi.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const n=t.delta(fi),i=this.normal.dot(n);if(0===i)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/i;return r<0||r>1?null:e.copy(n).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),n=this.distanceToPoint(t.end);return e<0&&n>0||n<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const n=e||gi.getNormalMatrix(t),i=this.coplanarPoint(fi).applyMatrix4(t),r=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}vi.prototype.isPlane=!0;const yi=new Ee,_i=new te;class bi{constructor(t=new vi,e=new vi,n=new vi,i=new vi,r=new vi,s=new vi){this.planes=[t,e,n,i,r,s]}set(t,e,n,i,r,s){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(s),this}copy(t){const e=this.planes;for(let n=0;n<6;n++)e[n].copy(t.planes[n]);return this}setFromProjectionMatrix(t){const e=this.planes,n=t.elements,i=n[0],r=n[1],s=n[2],o=n[3],a=n[4],c=n[5],l=n[6],u=n[7],d=n[8],h=n[9],A=n[10],p=n[11],f=n[12],m=n[13],g=n[14],v=n[15];return e[0].setComponents(o-i,u-a,p-d,v-f).normalize(),e[1].setComponents(o+i,u+a,p+d,v+f).normalize(),e[2].setComponents(o+r,u+c,p+h,v+m).normalize(),e[3].setComponents(o-r,u-c,p-h,v-m).normalize(),e[4].setComponents(o-s,u-l,p-A,v-g).normalize(),e[5].setComponents(o+s,u+l,p+A,v+g).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),yi.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(yi)}intersectsSprite(t){return yi.center.set(0,0,0),yi.radius=.7071067811865476,yi.applyMatrix4(t.matrixWorld),this.intersectsSphere(yi)}intersectsSphere(t){const e=this.planes,n=t.center,i=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(n)<i)return!1}return!0}intersectsBox(t){const e=this.planes;for(let n=0;n<6;n++){const i=e[n];if(_i.x=i.normal.x>0?t.max.x:t.min.x,_i.y=i.normal.y>0?t.max.y:t.min.y,_i.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(_i)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let n=0;n<6;n++)if(e[n].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Ei(){let t=null,e=!1,n=null,i=null;function r(e,s){n(e,s),i=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==n&&(i=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function wi(t,e){const n=e.isWebGL2,i=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),i.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const n=i.get(e);n&&(t.deleteBuffer(n.buffer),i.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=i.get(e);return void((!t||t.version<e.version)&&i.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=i.get(e);void 0===s?i.set(e,function(e,i){const r=e.array,s=e.usage,o=t.createBuffer();let a;if(t.bindBuffer(i,o),t.bufferData(i,r,s),e.onUploadCallback(),r instanceof Float32Array)a=5126;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(r instanceof Int16Array)a=5122;else if(r instanceof Uint32Array)a=5125;else if(r instanceof Int32Array)a=5124;else if(r instanceof Int8Array)a=5120;else if(r instanceof Uint8Array)a=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);a=5121}return{buffer:o,type:a,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(!function(e,i,r){const s=i.array,o=i.updateRange;t.bindBuffer(r,e),-1===o.count?t.bufferSubData(r,0,s):(n?t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s,o.offset,o.count):t.bufferSubData(r,o.offset*s.BYTES_PER_ELEMENT,s.subarray(o.offset,o.offset+o.count)),o.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class Si extends Un{constructor(t=1,e=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:i};const r=t/2,s=e/2,o=Math.floor(n),a=Math.floor(i),c=o+1,l=a+1,u=t/o,d=e/a,h=[],A=[],p=[],f=[];for(let t=0;t<l;t++){const e=t*d-s;for(let n=0;n<c;n++){const i=n*u-r;A.push(i,-e,0),p.push(0,0,1),f.push(n/o),f.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const n=e+c*t,i=e+c*(t+1),r=e+1+c*(t+1),s=e+1+c*t;h.push(n,i,s),h.push(i,r,s)}this.setIndex(h),this.setAttribute("position",new xn(A,3)),this.setAttribute("normal",new xn(p,3)),this.setAttribute("uv",new xn(f,2))}static fromJSON(t){return new Si(t.width,t.height,t.widthSegments,t.heightSegments)}}const Ti={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ]\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tfloat texelIndex = float( vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Ci={common:{diffuse:{value:new Ft(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new It},uv2Transform:{value:new It},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Rt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ft(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ft(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new It}},sprite:{diffuse:{value:new Ft(16777215)},opacity:{value:1},center:{value:new Rt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new It}}},Ri={basic:{uniforms:oi([Ci.common,Ci.specularmap,Ci.envmap,Ci.aomap,Ci.lightmap,Ci.fog]),vertexShader:Ti.meshbasic_vert,fragmentShader:Ti.meshbasic_frag},lambert:{uniforms:oi([Ci.common,Ci.specularmap,Ci.envmap,Ci.aomap,Ci.lightmap,Ci.emissivemap,Ci.fog,Ci.lights,{emissive:{value:new Ft(0)}}]),vertexShader:Ti.meshlambert_vert,fragmentShader:Ti.meshlambert_frag},phong:{uniforms:oi([Ci.common,Ci.specularmap,Ci.envmap,Ci.aomap,Ci.lightmap,Ci.emissivemap,Ci.bumpmap,Ci.normalmap,Ci.displacementmap,Ci.fog,Ci.lights,{emissive:{value:new Ft(0)},specular:{value:new Ft(1118481)},shininess:{value:30}}]),vertexShader:Ti.meshphong_vert,fragmentShader:Ti.meshphong_frag},standard:{uniforms:oi([Ci.common,Ci.envmap,Ci.aomap,Ci.lightmap,Ci.emissivemap,Ci.bumpmap,Ci.normalmap,Ci.displacementmap,Ci.roughnessmap,Ci.metalnessmap,Ci.fog,Ci.lights,{emissive:{value:new Ft(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ti.meshphysical_vert,fragmentShader:Ti.meshphysical_frag},toon:{uniforms:oi([Ci.common,Ci.aomap,Ci.lightmap,Ci.emissivemap,Ci.bumpmap,Ci.normalmap,Ci.displacementmap,Ci.gradientmap,Ci.fog,Ci.lights,{emissive:{value:new Ft(0)}}]),vertexShader:Ti.meshtoon_vert,fragmentShader:Ti.meshtoon_frag},matcap:{uniforms:oi([Ci.common,Ci.bumpmap,Ci.normalmap,Ci.displacementmap,Ci.fog,{matcap:{value:null}}]),vertexShader:Ti.meshmatcap_vert,fragmentShader:Ti.meshmatcap_frag},points:{uniforms:oi([Ci.points,Ci.fog]),vertexShader:Ti.points_vert,fragmentShader:Ti.points_frag},dashed:{uniforms:oi([Ci.common,Ci.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ti.linedashed_vert,fragmentShader:Ti.linedashed_frag},depth:{uniforms:oi([Ci.common,Ci.displacementmap]),vertexShader:Ti.depth_vert,fragmentShader:Ti.depth_frag},normal:{uniforms:oi([Ci.common,Ci.bumpmap,Ci.normalmap,Ci.displacementmap,{opacity:{value:1}}]),vertexShader:Ti.meshnormal_vert,fragmentShader:Ti.meshnormal_frag},sprite:{uniforms:oi([Ci.sprite,Ci.fog]),vertexShader:Ti.sprite_vert,fragmentShader:Ti.sprite_frag},background:{uniforms:{uvTransform:{value:new It},t2D:{value:null}},vertexShader:Ti.background_vert,fragmentShader:Ti.background_frag},cube:{uniforms:oi([Ci.envmap,{opacity:{value:1}}]),vertexShader:Ti.cube_vert,fragmentShader:Ti.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ti.equirect_vert,fragmentShader:Ti.equirect_frag},distanceRGBA:{uniforms:oi([Ci.common,Ci.displacementmap,{referencePosition:{value:new te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ti.distanceRGBA_vert,fragmentShader:Ti.distanceRGBA_frag},shadow:{uniforms:oi([Ci.lights,Ci.fog,{color:{value:new Ft(0)},opacity:{value:1}}]),vertexShader:Ti.shadow_vert,fragmentShader:Ti.shadow_frag}};function Ii(t,e,n,i,r,s){const o=new Ft(0);let a,l,u=!0===r?0:1,d=null,h=0,A=null;function p(t,e){n.buffers.color.setClear(t.r,t.g,t.b,e,s)}return{getClearColor:function(){return o},setClearColor:function(t,e=1){o.set(t),u=e,p(o,u)},getClearAlpha:function(){return u},setClearAlpha:function(t){u=t,p(o,u)},render:function(n,r){let s=!1,f=!0===r.isScene?r.background:null;f&&f.isTexture&&(f=e.get(f));const m=t.xr,g=m.getSession&&m.getSession();g&&"additive"===g.environmentBlendMode&&(f=null),null===f?p(o,u):f&&f.isColor&&(p(f,1),s=!0),(t.autoClear||s)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),f&&(f.isCubeTexture||f.mapping===c)?(void 0===l&&(l=new ni(new ri(1,1,1),new ci({name:"BackgroundCubeMaterial",uniforms:si(Ri.cube.uniforms),vertexShader:Ri.cube.vertexShader,fragmentShader:Ri.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(l)),l.material.uniforms.envMap.value=f,l.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,d===f&&h===f.version&&A===t.toneMapping||(l.material.needsUpdate=!0,d=f,h=f.version,A=t.toneMapping),n.unshift(l,l.geometry,l.material,0,0,null)):f&&f.isTexture&&(void 0===a&&(a=new ni(new Si(2,2),new ci({name:"BackgroundMaterial",uniforms:si(Ri.background.uniforms),vertexShader:Ri.background.vertexShader,fragmentShader:Ri.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(a)),a.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),a.material.uniforms.uvTransform.value.copy(f.matrix),d===f&&h===f.version&&A===t.toneMapping||(a.material.needsUpdate=!0,d=f,h=f.version,A=t.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function xi(t,e,n,i){const r=t.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},c=h(null);let l=c;function u(e){return i.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return i.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function h(t){const e=[],n=[],i=[];for(let t=0;t<r;t++)e[t]=0,n[t]=0,i[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:i,object:t,attributes:{},index:null}}function A(){const t=l.newAttributes;for(let e=0,n=t.length;e<n;e++)t[e]=0}function p(t){f(t,0)}function f(n,r){const s=l.newAttributes,o=l.enabledAttributes,a=l.attributeDivisors;if(s[n]=1,0===o[n]&&(t.enableVertexAttribArray(n),o[n]=1),a[n]!==r){(i.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,r),a[n]=r}}function m(){const e=l.newAttributes,n=l.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function g(e,n,r,s,o,a){!0!==i.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,n,r,s,o,a):t.vertexAttribIPointer(e,n,r,o,a)}function v(){y(),l!==c&&(l=c,u(l.object))}function y(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(r,c,d,v,y){let _=!1;if(o){const e=function(e,n,r){const o=!0===r.wireframe;let c=a[e.id];void 0===c&&(c={},a[e.id]=c);let l=c[n.id];void 0===l&&(l={},c[n.id]=l);let u=l[o];void 0===u&&(u=h(i.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),l[o]=u);return u}(v,d,c);l!==e&&(l=e,u(l.object)),_=function(t,e){const n=l.attributes,i=t.attributes;let r=0;for(const t in i){const e=n[t],s=i[t];if(void 0===e)return!0;if(e.attribute!==s)return!0;if(e.data!==s.data)return!0;r++}return l.attributesNum!==r||l.index!==e}(v,y),_&&function(t,e){const n={},i=t.attributes;let r=0;for(const t in i){const e=i[t],s={};s.attribute=e,e.data&&(s.data=e.data),n[t]=s,r++}l.attributes=n,l.attributesNum=r,l.index=e}(v,y)}else{const t=!0===c.wireframe;l.geometry===v.id&&l.program===d.id&&l.wireframe===t||(l.geometry=v.id,l.program=d.id,l.wireframe=t,_=!0)}!0===r.isInstancedMesh&&(_=!0),null!==y&&n.update(y,34963),_&&(!function(r,s,o,a){if(!1===i.isWebGL2&&(r.isInstancedMesh||a.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;A();const c=a.attributes,l=o.getAttributes(),u=s.defaultAttributeValues;for(const e in l){const i=l[e];if(i.location>=0){let s=c[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,o=s.itemSize,c=n.get(s);if(void 0===c)continue;const l=c.buffer,u=c.type,d=c.bytesPerElement;if(s.isInterleavedBufferAttribute){const n=s.data,c=n.stride,h=s.offset;if(n.isInstancedInterleavedBuffer){for(let t=0;t<i.locationSize;t++)f(i.location+t,n.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let t=0;t<i.locationSize;t++)p(i.location+t);t.bindBuffer(34962,l);for(let t=0;t<i.locationSize;t++)g(i.location+t,o/i.locationSize,u,e,c*d,(h+o/i.locationSize*t)*d)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<i.locationSize;t++)f(i.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<i.locationSize;t++)p(i.location+t);t.bindBuffer(34962,l);for(let t=0;t<i.locationSize;t++)g(i.location+t,o/i.locationSize,u,e,o*d,o/i.locationSize*t*d)}}else if(void 0!==u){const n=u[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(i.location,n);break;case 3:t.vertexAttrib3fv(i.location,n);break;case 4:t.vertexAttrib4fv(i.location,n);break;default:t.vertexAttrib1fv(i.location,n)}}}}m()}(r,c,d,v),null!==y&&t.bindBuffer(34963,n.get(y).buffer))},reset:v,resetDefaultState:y,dispose:function(){v();for(const t in a){const e=a[t];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete a[t]}},releaseStatesOfGeometry:function(t){if(void 0===a[t.id])return;const e=a[t.id];for(const t in e){const n=e[t];for(const t in n)d(n[t].object),delete n[t];delete e[t]}delete a[t.id]},releaseStatesOfProgram:function(t){for(const e in a){const n=a[e];if(void 0===n[t.id])continue;const i=n[t.id];for(const t in i)d(i[t].object),delete i[t];delete n[t.id]}},initAttributes:A,enableAttribute:p,disableUnusedAttributes:m}}function Oi(t,e,n,i){const r=i.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,i){t.drawArrays(s,e,i),n.update(i,s,1)},this.renderInstances=function(i,o,a){if(0===a)return;let c,l;if(r)c=t,l="drawArraysInstanced";else if(c=e.get("ANGLE_instanced_arrays"),l="drawArraysInstancedANGLE",null===c)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[l](s,i,o,a),n.update(o,s,a)}}function Li(t,e,n){let i;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let o=void 0!==n.precision?n.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const c=s||e.has("WEBGL_draw_buffers"),l=!0===n.logarithmicDepthBuffer,u=t.getParameter(34930),d=t.getParameter(35660),h=t.getParameter(3379),A=t.getParameter(34076),p=t.getParameter(34921),f=t.getParameter(36347),m=t.getParameter(36348),g=t.getParameter(36349),v=d>0,y=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:c,getMaxAnisotropy:function(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const n=e.get("EXT_texture_filter_anisotropic");i=t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:r,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:d,maxTextureSize:h,maxCubemapSize:A,maxAttributes:p,maxVertexUniforms:f,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:s?t.getParameter(36183):0}}function Mi(t){const e=this;let n=null,i=0,r=!1,s=!1;const o=new vi,a=new It,c={value:null,needsUpdate:!1};function l(){c.value!==n&&(c.value=n,c.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(t,n,i,r){const s=null!==t?t.length:0;let l=null;if(0!==s){if(l=c.value,!0!==r||null===l){const e=i+4*s,r=n.matrixWorldInverse;a.getNormalMatrix(r),(null===l||l.length<e)&&(l=new Float32Array(e));for(let e=0,n=i;e!==s;++e,n+=4)o.copy(t[e]).applyMatrix4(r,a),o.normal.toArray(l,n),l[n+3]=o.constant}c.value=l,c.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,l}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const o=0!==t.length||e||0!==i||r;return r=e,n=u(t,s,0),i=t.length,o},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,l()},this.setState=function(e,o,a){const d=e.clippingPlanes,h=e.clipIntersection,A=e.clipShadows,p=t.get(e);if(!r||null===d||0===d.length||s&&!A)s?u(null):l();else{const t=s?0:i,e=4*t;let r=p.clippingState||null;c.value=r,r=u(d,o,e,a);for(let t=0;t!==e;++t)r[t]=n[t];p.clippingState=r,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=t}}}function ki(t){let e=new WeakMap;function n(t,e){return e===o?t.mapping=r:e===a&&(t.mapping=s),t}function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===o||s===a){if(e.has(r)){return n(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const o=new pi(s.height/2);return o.fromEquirectangularTexture(t,r),e.set(r,o),r.addEventListener("dispose",i),n(o.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}Ri.physical={uniforms:oi([Ri.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Rt(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Ft(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Rt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Ft(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Ft(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ti.meshphysical_vert,fragmentShader:Ti.meshphysical_frag};class Ni extends li{constructor(t=-1,e=1,n=1,i=-1,r=.1,s=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=i,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,n,i,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=i,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let r=n-t,s=n+t,o=i+e,a=i-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}Ni.prototype.isOrthographicCamera=!0;const Pi=[.125,.215,.35,.446,.526,.582],Di=20,Bi=new Ni,Ui=new Ft;let Fi=null;const Hi=(1+Math.sqrt(5))/2,Vi=1/Hi,ji=[new te(1,1,1),new te(-1,1,1),new te(1,1,-1),new te(-1,1,-1),new te(0,Hi,Vi),new te(0,Hi,-Vi),new te(Vi,0,Hi),new te(-Vi,0,Hi),new te(Hi,Vi,0),new te(-Hi,Vi,0)];class Gi{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,n=.1,i=100){Fi=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,n,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Ki(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Wi(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Fi),t.scissorTest=!1,zi(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===r||t.mapping===s?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Fi=this._renderer.getRenderTarget();const n=e||this._allocateTargets();return this._textureToCubeUV(t,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize-32,n={magFilter:m,minFilter:m,generateMipmaps:!1,type:w,format:T,encoding:at,depthBuffer:!1},i=Qi(t,e,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Qi(t,e,n);const{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],n=[],i=[];let r=t;const s=t-4+1+Pi.length;for(let o=0;o<s;o++){const s=Math.pow(2,r);n.push(s);let a=1/s;o>t-4?a=Pi[o-t+4-1]:0===o&&(a=0),i.push(a);const c=1/(s-1),l=-c/2,u=1+c/2,d=[l,l,u,l,u,u,l,l,u,u,l,u],h=6,A=6,p=3,f=2,m=1,g=new Float32Array(p*A*h),v=new Float32Array(f*A*h),y=new Float32Array(m*A*h);for(let t=0;t<h;t++){const e=t%3*2/3-1,n=t>2?0:-1,i=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];g.set(i,p*A*t),v.set(d,f*A*t);const r=[t,t,t,t,t,t];y.set(r,m*A*t)}const _=new Un;_.setAttribute("position",new _n(g,p)),_.setAttribute("uv",new _n(v,f)),_.setAttribute("faceIndex",new _n(y,m)),e.push(_),r>4&&r--}return{lodPlanes:e,sizeLods:n,sigmas:i}}(i)),this._blurMaterial=function(t,e,n){const i=new Float32Array(Di),r=new te(0,1,0);return new ci({name:"SphericalGaussianBlur",defines:{n:Di,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:qi(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(i,t,e)}return i}_compileMaterial(t){const e=new ni(this._lodPlanes[0],t);this._renderer.compile(e,Bi)}_sceneToCubeUV(t,e,n,i){const r=new ui(90,1,e,n),s=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,c=a.autoClear,l=a.toneMapping;a.getClearColor(Ui),a.toneMapping=0,a.autoClear=!1;const u=new gn({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),d=new ni(new ri,u);let h=!1;const A=t.background;A?A.isColor&&(u.color.copy(A),t.background=null,h=!0):(u.color.copy(Ui),h=!0);for(let e=0;e<6;e++){const n=e%3;0===n?(r.up.set(0,s[e],0),r.lookAt(o[e],0,0)):1===n?(r.up.set(0,0,s[e]),r.lookAt(0,o[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,o[e]));const c=this._cubeSize;zi(i,n*c,e>2?c:0,c,c),a.setRenderTarget(i),h&&a.render(d,r),a.render(t,r)}d.geometry.dispose(),d.material.dispose(),a.toneMapping=l,a.autoClear=c,t.background=A}_textureToCubeUV(t,e){const n=this._renderer,i=t.mapping===r||t.mapping===s;i?(null===this._cubemapMaterial&&(this._cubemapMaterial=Ki()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Wi());const o=i?this._cubemapMaterial:this._equirectMaterial,a=new ni(this._lodPlanes[0],o);o.uniforms.envMap.value=t;const c=this._cubeSize;zi(e,0,0,3*c,2*c),n.setRenderTarget(e),n.render(a,Bi)}_applyPMREM(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const n=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),i=ji[(e-1)%ji.length];this._blur(t,e-1,e,n,i)}e.autoClear=n}_blur(t,e,n,i,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,n,i,"latitudinal",r),this._halfBlur(s,t,n,n,i,"longitudinal",r)}_halfBlur(t,e,n,i,r,s,o){const a=this._renderer,c=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const l=new ni(this._lodPlanes[i],c),u=c.uniforms,d=this._sizeLods[n]-1,h=isFinite(r)?Math.PI/(2*d):2*Math.PI/39,A=r/h,p=isFinite(r)?1+Math.floor(3*A):Di;p>Di&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const f=[];let m=0;for(let t=0;t<Di;++t){const e=t/A,n=Math.exp(-e*e/2);f.push(n),0===t?m+=n:t<p&&(m+=2*n)}for(let t=0;t<f.length;t++)f[t]=f[t]/m;u.envMap.value=t.texture,u.samples.value=p,u.weights.value=f,u.latitudinal.value="latitudinal"===s,o&&(u.poleAxis.value=o);const{_lodMax:g}=this;u.dTheta.value=h,u.mipInt.value=g-n;const v=this._sizeLods[i];zi(e,3*v*(i>g-4?i-g+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(e),a.render(l,Bi)}}function Qi(t,e,n){const i=new Kt(t,e,n);return i.texture.mapping=c,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function zi(t,e,n,i,r){t.viewport.set(e,n,i,r),t.scissor.set(e,n,i,r)}function Wi(){return new ci({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:qi(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Ki(){return new ci({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:qi(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function qi(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Yi(t){let e=new WeakMap,n=null;function i(t){const n=t.target;n.removeEventListener("dispose",i);const r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(c){if(c&&c.isTexture){const l=c.mapping,u=l===o||l===a,d=l===r||l===s;if(u||d){if(c.isRenderTargetTexture&&!0===c.needsPMREMUpdate){c.needsPMREMUpdate=!1;let i=e.get(c);return null===n&&(n=new Gi(t)),i=u?n.fromEquirectangular(c,i):n.fromCubemap(c,i),e.set(c,i),i.texture}if(e.has(c))return e.get(c).texture;{const r=c.image;if(u&&r&&r.height>0||d&&r&&function(t){let e=0;const n=6;for(let i=0;i<n;i++)void 0!==t[i]&&e++;return e===n}(r)){null===n&&(n=new Gi(t));const r=u?n.fromEquirectangular(c):n.fromCubemap(c);return e.set(c,r),c.addEventListener("dispose",i),r.texture}return null}}}return c},dispose:function(){e=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function $i(t){const e={};function n(n){if(void 0!==e[n])return e[n];let i;switch(n){case"WEBGL_depth_texture":i=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=t.getExtension(n)}return e[n]=i,i}return{has:function(t){return null!==n(t)},init:function(t){t.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(t){const e=n(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Xi(t,e,n,i){const r={},s=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);a.removeEventListener("dispose",o),delete r[a.id];const c=s.get(a);c&&(e.remove(c),s.delete(a)),i.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(t){const n=[],i=t.index,r=t.attributes.position;let o=0;if(null!==i){const t=i.array;o=i.version;for(let e=0,i=t.length;e<i;e+=3){const i=t[e+0],r=t[e+1],s=t[e+2];n.push(i,r,r,s,s,i)}}else{const t=r.array;o=r.version;for(let e=0,i=t.length/3-1;e<i;e+=3){const t=e+0,i=e+1,r=e+2;n.push(t,i,i,r,r,t)}}const a=new(xt(n)?Rn:Tn)(n,1);a.version=o;const c=s.get(t);c&&e.remove(c),s.set(t,a)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",o),r[e.id]=!0,n.memory.geometries++),e},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const i=t.morphAttributes;for(const t in i){const n=i[t];for(let t=0,i=n.length;t<i;t++)e.update(n[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&a(t)}else a(t);return s.get(t)}}}function Ji(t,e,n,i){const r=i.isWebGL2;let s,o,a;this.setMode=function(t){s=t},this.setIndex=function(t){o=t.type,a=t.bytesPerElement},this.render=function(e,i){t.drawElements(s,i,o,e*a),n.update(i,s,1)},this.renderInstances=function(i,c,l){if(0===l)return;let u,d;if(r)u=t,d="drawElementsInstanced";else if(u=e.get("ANGLE_instanced_arrays"),d="drawElementsInstancedANGLE",null===u)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[d](s,c,o,i*a,l),n.update(c,s,l)}}function Zi(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,i){switch(e.calls++,n){case 4:e.triangles+=i*(t/3);break;case 1:e.lines+=i*(t/2);break;case 3:e.lines+=i*(t-1);break;case 2:e.lines+=i*t;break;case 0:e.points+=i*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function tr(t,e){return t[0]-e[0]}function er(t,e){return Math.abs(e[1])-Math.abs(t[1])}function nr(t,e){let n=1;const i=e.isInterleavedBufferAttribute?e.data.array:e.array;i instanceof Int8Array?n=127:i instanceof Int16Array?n=32767:i instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",i),t.divideScalar(n)}function ir(t,e,n){const i={},r=new Float32Array(8),s=new WeakMap,o=new Wt,a=[];for(let t=0;t<8;t++)a[t]=[t,0];return{update:function(c,l,u,d){const h=c.morphTargetInfluences;if(!0===e.isWebGL2){const A=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,p=void 0!==A?A.length:0;let f=s.get(l);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const v=void 0!==l.morphAttributes.position,y=void 0!==l.morphAttributes.normal,_=void 0!==l.morphAttributes.color,b=l.morphAttributes.position||[],w=l.morphAttributes.normal||[],S=l.morphAttributes.color||[];let C=0;!0===v&&(C=1),!0===y&&(C=2),!0===_&&(C=3);let R=l.attributes.position.count*C,I=1;R>e.maxTextureSize&&(I=Math.ceil(R/e.maxTextureSize),R=e.maxTextureSize);const x=new Float32Array(R*I*4*p),O=new qt(x,R,I,p);O.format=T,O.type=E,O.needsUpdate=!0;const L=4*C;for(let k=0;k<p;k++){const N=b[k],P=w[k],D=S[k],B=R*I*4*k;for(let U=0;U<N.count;U++){const F=U*L;!0===v&&(o.fromBufferAttribute(N,U),!0===N.normalized&&nr(o,N),x[B+F+0]=o.x,x[B+F+1]=o.y,x[B+F+2]=o.z,x[B+F+3]=0),!0===y&&(o.fromBufferAttribute(P,U),!0===P.normalized&&nr(o,P),x[B+F+4]=o.x,x[B+F+5]=o.y,x[B+F+6]=o.z,x[B+F+7]=0),!0===_&&(o.fromBufferAttribute(D,U),!0===D.normalized&&nr(o,P),x[B+F+8]=o.x,x[B+F+9]=o.y,x[B+F+10]=o.z,x[B+F+11]=4===D.itemSize?o.w:1)}}function M(){O.dispose(),s.delete(l),l.removeEventListener("dispose",M)}f={count:p,texture:O,size:new Rt(R,I)},s.set(l,f),l.addEventListener("dispose",M)}let m=0;for(let H=0;H<h.length;H++)m+=h[H];const g=l.morphTargetsRelative?1:1-m;d.getUniforms().setValue(t,"morphTargetBaseInfluence",g),d.getUniforms().setValue(t,"morphTargetInfluences",h),d.getUniforms().setValue(t,"morphTargetsTexture",f.texture,n),d.getUniforms().setValue(t,"morphTargetsTextureSize",f.size)}else{const V=void 0===h?0:h.length;let j=i[l.id];if(void 0===j||j.length!==V){j=[];for(let K=0;K<V;K++)j[K]=[K,0];i[l.id]=j}for(let q=0;q<V;q++){const Y=j[q];Y[0]=q,Y[1]=h[q]}j.sort(er);for(let $=0;$<8;$++)$<V&&j[$][1]?(a[$][0]=j[$][0],a[$][1]=j[$][1]):(a[$][0]=Number.MAX_SAFE_INTEGER,a[$][1]=0);a.sort(tr);const G=l.morphAttributes.position,Q=l.morphAttributes.normal;let z=0;for(let X=0;X<8;X++){const J=a[X],Z=J[0],tt=J[1];Z!==Number.MAX_SAFE_INTEGER&&tt?(G&&l.getAttribute("morphTarget"+X)!==G[Z]&&l.setAttribute("morphTarget"+X,G[Z]),Q&&l.getAttribute("morphNormal"+X)!==Q[Z]&&l.setAttribute("morphNormal"+X,Q[Z]),r[X]=tt,z+=tt):(G&&!0===l.hasAttribute("morphTarget"+X)&&l.deleteAttribute("morphTarget"+X),Q&&!0===l.hasAttribute("morphNormal"+X)&&l.deleteAttribute("morphNormal"+X),r[X]=0)}const W=l.morphTargetsRelative?1:1-z;d.getUniforms().setValue(t,"morphTargetBaseInfluence",W),d.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function rr(t,e,n,i){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),n.remove(e.instanceMatrix),null!==e.instanceColor&&n.remove(e.instanceColor)}return{update:function(t){const o=i.render.frame,a=t.geometry,c=e.get(t,a);return r.get(c)!==o&&(e.update(c),r.set(c,o)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),n.update(t.instanceMatrix,34962),null!==t.instanceColor&&n.update(t.instanceColor,34962)),c},dispose:function(){r=new WeakMap}}}const sr=new zt,or=new qt,ar=new $t,cr=new Ai,lr=[],ur=[],dr=new Float32Array(16),hr=new Float32Array(9),Ar=new Float32Array(4);function pr(t,e,n){const i=t[0];if(i<=0||i>0)return t;const r=e*n;let s=lr[r];if(void 0===s&&(s=new Float32Array(r),lr[r]=s),0!==e){i.toArray(s,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(s,r)}return s}function fr(t,e){if(t.length!==e.length)return!1;for(let n=0,i=t.length;n<i;n++)if(t[n]!==e[n])return!1;return!0}function mr(t,e){for(let n=0,i=e.length;n<i;n++)t[n]=e[n]}function gr(t,e){let n=ur[e];void 0===n&&(n=new Int32Array(e),ur[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function vr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function yr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(fr(n,e))return;t.uniform2fv(this.addr,e),mr(n,e)}}function _r(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(fr(n,e))return;t.uniform3fv(this.addr,e),mr(n,e)}}function br(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(fr(n,e))return;t.uniform4fv(this.addr,e),mr(n,e)}}function Er(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(fr(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),mr(n,e)}else{if(fr(n,i))return;Ar.set(i),t.uniformMatrix2fv(this.addr,!1,Ar),mr(n,i)}}function wr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(fr(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),mr(n,e)}else{if(fr(n,i))return;hr.set(i),t.uniformMatrix3fv(this.addr,!1,hr),mr(n,i)}}function Sr(t,e){const n=this.cache,i=e.elements;if(void 0===i){if(fr(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),mr(n,e)}else{if(fr(n,i))return;dr.set(i),t.uniformMatrix4fv(this.addr,!1,dr),mr(n,i)}}function Tr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Cr(t,e){const n=this.cache;fr(n,e)||(t.uniform2iv(this.addr,e),mr(n,e))}function Rr(t,e){const n=this.cache;fr(n,e)||(t.uniform3iv(this.addr,e),mr(n,e))}function Ir(t,e){const n=this.cache;fr(n,e)||(t.uniform4iv(this.addr,e),mr(n,e))}function xr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Or(t,e){const n=this.cache;fr(n,e)||(t.uniform2uiv(this.addr,e),mr(n,e))}function Lr(t,e){const n=this.cache;fr(n,e)||(t.uniform3uiv(this.addr,e),mr(n,e))}function Mr(t,e){const n=this.cache;fr(n,e)||(t.uniform4uiv(this.addr,e),mr(n,e))}function kr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2D(e||sr,r)}function Nr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture3D(e||ar,r)}function Pr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTextureCube(e||cr,r)}function Dr(t,e,n){const i=this.cache,r=n.allocateTextureUnit();i[0]!==r&&(t.uniform1i(this.addr,r),i[0]=r),n.setTexture2DArray(e||or,r)}function Br(t,e){t.uniform1fv(this.addr,e)}function Ur(t,e){const n=pr(e,this.size,2);t.uniform2fv(this.addr,n)}function Fr(t,e){const n=pr(e,this.size,3);t.uniform3fv(this.addr,n)}function Hr(t,e){const n=pr(e,this.size,4);t.uniform4fv(this.addr,n)}function Vr(t,e){const n=pr(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function jr(t,e){const n=pr(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function Gr(t,e){const n=pr(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function Qr(t,e){t.uniform1iv(this.addr,e)}function zr(t,e){t.uniform2iv(this.addr,e)}function Wr(t,e){t.uniform3iv(this.addr,e)}function Kr(t,e){t.uniform4iv(this.addr,e)}function qr(t,e){t.uniform1uiv(this.addr,e)}function Yr(t,e){t.uniform2uiv(this.addr,e)}function $r(t,e){t.uniform3uiv(this.addr,e)}function Xr(t,e){t.uniform4uiv(this.addr,e)}function Jr(t,e,n){const i=e.length,r=gr(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTexture2D(e[t]||sr,r[t])}function Zr(t,e,n){const i=e.length,r=gr(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTexture3D(e[t]||ar,r[t])}function ts(t,e,n){const i=e.length,r=gr(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTextureCube(e[t]||cr,r[t])}function es(t,e,n){const i=e.length,r=gr(n,i);t.uniform1iv(this.addr,r);for(let t=0;t!==i;++t)n.setTexture2DArray(e[t]||or,r[t])}function ns(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return vr;case 35664:return yr;case 35665:return _r;case 35666:return br;case 35674:return Er;case 35675:return wr;case 35676:return Sr;case 5124:case 35670:return Tr;case 35667:case 35671:return Cr;case 35668:case 35672:return Rr;case 35669:case 35673:return Ir;case 5125:return xr;case 36294:return Or;case 36295:return Lr;case 36296:return Mr;case 35678:case 36198:case 36298:case 36306:case 35682:return kr;case 35679:case 36299:case 36307:return Nr;case 35680:case 36300:case 36308:case 36293:return Pr;case 36289:case 36303:case 36311:case 36292:return Dr}}(e.type)}function is(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Br;case 35664:return Ur;case 35665:return Fr;case 35666:return Hr;case 35674:return Vr;case 35675:return jr;case 35676:return Gr;case 5124:case 35670:return Qr;case 35667:case 35671:return zr;case 35668:case 35672:return Wr;case 35669:case 35673:return Kr;case 5125:return qr;case 36294:return Yr;case 36295:return $r;case 36296:return Xr;case 35678:case 36198:case 36298:case 36306:case 35682:return Jr;case 35679:case 36299:case 36307:return Zr;case 35680:case 36300:case 36308:case 36293:return ts;case 36289:case 36303:case 36311:case 36292:return es}}(e.type)}function rs(t){this.id=t,this.seq=[],this.map={}}is.prototype.updateCache=function(t){const e=this.cache;t instanceof Float32Array&&e.length!==t.length&&(this.cache=new Float32Array(t.length)),mr(e,t)},rs.prototype.setValue=function(t,e,n){const i=this.seq;for(let r=0,s=i.length;r!==s;++r){const s=i[r];s.setValue(t,e[s.id],n)}};const ss=/(\w+)(\])?(\[|\.)?/g;function os(t,e){t.seq.push(e),t.map[e.id]=e}function as(t,e,n){const i=t.name,r=i.length;for(ss.lastIndex=0;;){const s=ss.exec(i),o=ss.lastIndex;let a=s[1];const c="]"===s[2],l=s[3];if(c&&(a|=0),void 0===l||"["===l&&o+2===r){os(n,void 0===l?new ns(a,t,e):new is(a,t,e));break}{let t=n.map[a];void 0===t&&(t=new rs(a),os(n,t)),n=t}}}function cs(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);as(n,t.getUniformLocation(e,n.name),this)}}function ls(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),i}cs.prototype.setValue=function(t,e,n,i){const r=this.map[e];void 0!==r&&r.setValue(t,n,i)},cs.prototype.setOptional=function(t,e,n){const i=e[n];void 0!==i&&this.setValue(t,n,i)},cs.upload=function(t,e,n,i){for(let r=0,s=e.length;r!==s;++r){const s=e[r],o=n[s.id];!1!==o.needsUpdate&&s.setValue(t,o.value,i)}},cs.seqWithValue=function(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const r=t[i];r.id in e&&n.push(r)}return n};let us=0;function ds(t,e,n){const i=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();return i&&""===r?"":n.toUpperCase()+"\n\n"+r+"\n\n"+function(t){const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=t+1+": "+e[t];return e.join("\n")}(t.getShaderSource(e))}function hs(t,e){const n=function(t){switch(t){case at:return["Linear","( value )"];case ct:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function As(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ps(t){return""!==t}function fs(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function ms(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const gs=/^[ \t]*#include +<([\w\d./]+)>/gm;function vs(t){return t.replace(gs,ys)}function ys(t,e){const n=Ti[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return vs(n)}const _s=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,bs=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Es(t){return t.replace(bs,Ss).replace(_s,ws)}function ws(t,e,n,i){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Ss(t,e,n,i)}function Ss(t,e,n,i){let r="";for(let t=parseInt(e);t<parseInt(n);t++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function Ts(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Cs(t,e,n,i){const o=t.getContext(),a=n.defines;let u=n.vertexShader,d=n.fragmentShader;const h=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),A=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case r:case s:e="ENVMAP_TYPE_CUBE";break;case c:case l:e="ENVMAP_TYPE_CUBE_UV"}return e}(n),p=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case s:case l:e="ENVMAP_MODE_REFRACTION"}return e}(n),f=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),m=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const n=Math.log2(e/32+1)+3,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:i,maxMip:n}}(n),g=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ps).join("\n")}(n),v=function(t){const e=[];for(const n in t){const i=t[n];!1!==i&&e.push("#define "+n+" "+i)}return e.join("\n")}(a),y=o.createProgram();let _,b,E=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(_=[v].filter(ps).join("\n"),_.length>0&&(_+="\n"),b=[g,v].filter(ps).join("\n"),b.length>0&&(b+="\n")):(_=[Ts(n),"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ps).join("\n"),b=[g,Ts(n),"#define SHADER_NAME "+n.shaderName,v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+A:"",n.envMap?"#define "+p:"",n.envMap?"#define "+f:"",m?"#define CUBEUV_TEXEL_WIDTH "+m.texelWidth:"",m?"#define CUBEUV_TEXEL_HEIGHT "+m.texelHeight:"",m?"#define CUBEUV_MAX_MIP "+m.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Ti.tonemapping_pars_fragment:"",0!==n.toneMapping?As("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Ti.encodings_pars_fragment,hs("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ps).join("\n")),u=vs(u),u=fs(u,n),u=ms(u,n),d=vs(d),d=fs(d,n),d=ms(d,n),u=Es(u),d=Es(d),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(E="#version 300 es\n",_=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,b=["#define varying in",n.glslVersion===ht?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===ht?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+b);const w=E+b+d,S=ls(o,35633,E+_+u),T=ls(o,35632,w);if(o.attachShader(y,S),o.attachShader(y,T),void 0!==n.index0AttributeName?o.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(y,0,"position"),o.linkProgram(y),t.debug.checkShaderErrors){const t=o.getProgramInfoLog(y).trim(),e=o.getShaderInfoLog(S).trim(),n=o.getShaderInfoLog(T).trim();let i=!0,r=!0;if(!1===o.getProgramParameter(y,35714)){i=!1;const e=ds(o,S,"vertex"),n=ds(o,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(y,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+n)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==n||(r=!1);r&&(this.diagnostics={runnable:i,programLog:t,vertexShader:{log:e,prefix:_},fragmentShader:{log:n,prefix:b}})}let C,R;return o.deleteShader(S),o.deleteShader(T),this.getUniforms=function(){return void 0===C&&(C=new cs(o,y)),C},this.getAttributes=function(){return void 0===R&&(R=function(t,e){const n={},i=t.getProgramParameter(e,35721);for(let r=0;r<i;r++){const i=t.getActiveAttrib(e,r),s=i.name;let o=1;35674===i.type&&(o=2),35675===i.type&&(o=3),35676===i.type&&(o=4),n[s]={type:i.type,location:t.getAttribLocation(e,s),locationSize:o}}return n}(o,y)),R},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=us++,this.cacheKey=e,this.usedTimes=1,this.program=y,this.vertexShader=S,this.fragmentShader=T,this}let Rs=0;class Is{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,n=t.fragmentShader,i=this._getShaderStage(e),r=this._getShaderStage(n),s=this._getShaderCacheForMaterial(t);return!1===s.has(i)&&(s.add(i),i.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;return!1===e.has(t)&&e.set(t,new Set),e.get(t)}_getShaderStage(t){const e=this.shaderCache;if(!1===e.has(t)){const n=new xs;e.set(t,n)}return e.get(t)}}class xs{constructor(){this.id=Rs++,this.usedTimes=0}}function Os(t,e,n,i,r,s,o){const a=new je,u=new Is,d=[],h=r.isWebGL2,A=r.logarithmicDepthBuffer,p=r.floatVertexTextures,f=r.maxVertexUniforms,m=r.vertexTextures;let g=r.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,a,d,y,_){const b=y.fog,E=_.geometry,w=s.isMeshStandardMaterial?y.environment:null,S=(s.isMeshStandardMaterial?n:e).get(s.envMap||w),T=!S||S.mapping!==c&&S.mapping!==l?null:S.image.height,C=v[s.type],R=_.isSkinnedMesh?function(t){const e=t.skeleton.bones;if(p)return 1024;{const t=f,n=Math.floor((t-20)/4),i=Math.min(n,e.length);return i<e.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+e.length+" bones. This GPU supports "+i+"."),0):i}}(_):0;null!==s.precision&&(g=r.getMaxPrecision(s.precision),g!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",g,"instead."));const I=E.morphAttributes.position||E.morphAttributes.normal||E.morphAttributes.color,x=void 0!==I?I.length:0;let O,L,M,k,N=0;if(void 0!==E.morphAttributes.position&&(N=1),void 0!==E.morphAttributes.normal&&(N=2),void 0!==E.morphAttributes.color&&(N=3),C){const t=Ri[C];O=t.vertexShader,L=t.fragmentShader}else O=s.vertexShader,L=s.fragmentShader,u.update(s),M=u.getVertexShaderID(s),k=u.getFragmentShaderID(s);const P=t.getRenderTarget(),D=s.alphaTest>0,B=s.clearcoat>0;return{isWebGL2:h,shaderID:C,shaderName:s.type,vertexShader:O,fragmentShader:L,defines:s.defines,customVertexShaderID:M,customFragmentShaderID:k,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:g,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:m,outputEncoding:null===P?t.outputEncoding:!0===P.isXRRenderTarget?P.texture.encoding:at,map:!!s.map,matcap:!!s.matcap,envMap:!!S,envMapMode:S&&S.mapping,envMapCubeUVHeight:T,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===ct,clearcoat:B,clearcoatMap:B&&!!s.clearcoatMap,clearcoatRoughnessMap:B&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:B&&!!s.clearcoatNormalMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:D,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!E.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!E.attributes.color&&4===E.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!b,useFog:s.fog,fogExp2:b&&b.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:A,skinning:!0===_.isSkinnedMesh&&R>0,maxBones:R,useVertexTexture:p,morphTargets:void 0!==E.morphAttributes.position,morphNormals:void 0!==E.morphAttributes.normal,morphColors:void 0!==E.morphAttributes.color,morphTargetsCount:x,morphTextureStride:N,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&d.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,depthPacking:void 0!==s.depthPacking&&s.depthPacking,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||i.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.customVertexShaderID),n.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.maxBones),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection)}(n,e),function(t,e){a.disableAll(),e.isWebGL2&&a.enable(0);e.supportsVertexTextures&&a.enable(1);e.instancing&&a.enable(2);e.instancingColor&&a.enable(3);e.map&&a.enable(4);e.matcap&&a.enable(5);e.envMap&&a.enable(6);e.lightMap&&a.enable(7);e.aoMap&&a.enable(8);e.emissiveMap&&a.enable(9);e.bumpMap&&a.enable(10);e.normalMap&&a.enable(11);e.objectSpaceNormalMap&&a.enable(12);e.tangentSpaceNormalMap&&a.enable(13);e.clearcoat&&a.enable(14);e.clearcoatMap&&a.enable(15);e.clearcoatRoughnessMap&&a.enable(16);e.clearcoatNormalMap&&a.enable(17);e.displacementMap&&a.enable(18);e.specularMap&&a.enable(19);e.roughnessMap&&a.enable(20);e.metalnessMap&&a.enable(21);e.gradientMap&&a.enable(22);e.alphaMap&&a.enable(23);e.alphaTest&&a.enable(24);e.vertexColors&&a.enable(25);e.vertexAlphas&&a.enable(26);e.vertexUvs&&a.enable(27);e.vertexTangents&&a.enable(28);e.uvsVertexOnly&&a.enable(29);e.fog&&a.enable(30);t.push(a.mask),a.disableAll(),e.useFog&&a.enable(0);e.flatShading&&a.enable(1);e.logarithmicDepthBuffer&&a.enable(2);e.skinning&&a.enable(3);e.useVertexTexture&&a.enable(4);e.morphTargets&&a.enable(5);e.morphNormals&&a.enable(6);e.morphColors&&a.enable(7);e.premultipliedAlpha&&a.enable(8);e.shadowMapEnabled&&a.enable(9);e.physicallyCorrectLights&&a.enable(10);e.doubleSided&&a.enable(11);e.flipSided&&a.enable(12);e.depthPacking&&a.enable(13);e.dithering&&a.enable(14);e.specularIntensityMap&&a.enable(15);e.specularColorMap&&a.enable(16);e.transmission&&a.enable(17);e.transmissionMap&&a.enable(18);e.thicknessMap&&a.enable(19);e.sheen&&a.enable(20);e.sheenColorMap&&a.enable(21);e.sheenRoughnessMap&&a.enable(22);e.decodeVideoTexture&&a.enable(23);e.opaque&&a.enable(24);t.push(a.mask)}(n,e),n.push(t.outputEncoding)),n.push(e.customProgramCacheKey),n.join()},getUniforms:function(t){const e=v[t.type];let n;if(e){const t=Ri[e];n=ai.clone(t.uniforms)}else n=t.uniforms;return n},acquireProgram:function(e,n){let i;for(let t=0,e=d.length;t<e;t++){const e=d[t];if(e.cacheKey===n){i=e,++i.usedTimes;break}}return void 0===i&&(i=new Cs(t,n,e,s),d.push(i)),i},releaseProgram:function(t){if(0==--t.usedTimes){const e=d.indexOf(t);d[e]=d[d.length-1],d.pop(),t.destroy()}},releaseShaderCache:function(t){u.remove(t)},programs:d,dispose:function(){u.dispose()}}}function Ls(){let t=new WeakMap;return{get:function(e){let n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,i){t.get(e)[n]=i},dispose:function(){t=new WeakMap}}}function Ms(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function ks(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Ns(){const t=[];let e=0;const n=[],i=[],r=[];function s(n,i,r,s,o,a){let c=t[e];return void 0===c?(c={id:n.id,object:n,geometry:i,material:r,groupOrder:s,renderOrder:n.renderOrder,z:o,group:a},t[e]=c):(c.id=n.id,c.object=n,c.geometry=i,c.material=r,c.groupOrder=s,c.renderOrder=n.renderOrder,c.z=o,c.group=a),e++,c}return{opaque:n,transmissive:i,transparent:r,init:function(){e=0,n.length=0,i.length=0,r.length=0},push:function(t,e,o,a,c,l){const u=s(t,e,o,a,c,l);o.transmission>0?i.push(u):!0===o.transparent?r.push(u):n.push(u)},unshift:function(t,e,o,a,c,l){const u=s(t,e,o,a,c,l);o.transmission>0?i.unshift(u):!0===o.transparent?r.unshift(u):n.unshift(u)},finish:function(){for(let n=e,i=t.length;n<i;n++){const e=t[n];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||Ms),i.length>1&&i.sort(e||ks),r.length>1&&r.sort(e||ks)}}}function Ps(){let t=new WeakMap;return{get:function(e,n){let i;return!1===t.has(e)?(i=new Ns,t.set(e,[i])):n>=t.get(e).length?(i=new Ns,t.get(e).push(i)):i=t.get(e)[n],i},dispose:function(){t=new WeakMap}}}function Ds(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new te,color:new Ft};break;case"SpotLight":n={position:new te,direction:new te,color:new Ft,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new te,color:new Ft,distance:0,decay:0};break;case"HemisphereLight":n={direction:new te,skyColor:new Ft,groundColor:new Ft};break;case"RectAreaLight":n={color:new Ft,position:new te,halfWidth:new te,halfHeight:new te}}return t[e.id]=n,n}}}let Bs=0;function Us(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Fs(t,e){const n=new Ds,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Rt};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Rt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let t=0;t<9;t++)r.probe.push(new te);const s=new te,o=new Le,a=new Le;return{setup:function(s,o){let a=0,c=0,l=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let u=0,d=0,h=0,A=0,p=0,f=0,m=0,g=0;s.sort(Us);const v=!0!==o?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],o=e.color,y=e.intensity,_=e.distance,b=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)a+=o.r*y*v,c+=o.g*y*v,l+=o.b*y*v;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],y);else if(e.isDirectionalLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*v),e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.directionalShadow[u]=n,r.directionalShadowMap[u]=b,r.directionalShadowMatrix[u]=e.shadow.matrix,f++}r.directional[u]=t,u++}else if(e.isSpotLight){const t=n.get(e);if(t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(o).multiplyScalar(y*v),t.distance=_,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,r.spotShadow[h]=n,r.spotShadowMap[h]=b,r.spotShadowMatrix[h]=e.shadow.matrix,g++}r.spot[h]=t,h++}else if(e.isRectAreaLight){const t=n.get(e);t.color.copy(o).multiplyScalar(y),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[A]=t,A++}else if(e.isPointLight){const t=n.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*v),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,n=i.get(e);n.shadowBias=t.bias,n.shadowNormalBias=t.normalBias,n.shadowRadius=t.radius,n.shadowMapSize=t.mapSize,n.shadowCameraNear=t.camera.near,n.shadowCameraFar=t.camera.far,r.pointShadow[d]=n,r.pointShadowMap[d]=b,r.pointShadowMatrix[d]=e.shadow.matrix,m++}r.point[d]=t,d++}else if(e.isHemisphereLight){const t=n.get(e);t.skyColor.copy(e.color).multiplyScalar(y*v),t.groundColor.copy(e.groundColor).multiplyScalar(y*v),r.hemi[p]=t,p++}}A>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=Ci.LTC_FLOAT_1,r.rectAreaLTC2=Ci.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=Ci.LTC_HALF_1,r.rectAreaLTC2=Ci.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=a,r.ambient[1]=c,r.ambient[2]=l;const y=r.hash;y.directionalLength===u&&y.pointLength===d&&y.spotLength===h&&y.rectAreaLength===A&&y.hemiLength===p&&y.numDirectionalShadows===f&&y.numPointShadows===m&&y.numSpotShadows===g||(r.directional.length=u,r.spot.length=h,r.rectArea.length=A,r.point.length=d,r.hemi.length=p,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=m,r.pointShadowMap.length=m,r.spotShadow.length=g,r.spotShadowMap.length=g,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=m,r.spotShadowMatrix.length=g,y.directionalLength=u,y.pointLength=d,y.spotLength=h,y.rectAreaLength=A,y.hemiLength=p,y.numDirectionalShadows=f,y.numPointShadows=m,y.numSpotShadows=g,r.version=Bs++)},setupView:function(t,e){let n=0,i=0,c=0,l=0,u=0;const d=e.matrixWorldInverse;for(let e=0,h=t.length;e<h;e++){const h=t[e];if(h.isDirectionalLight){const t=r.directional[n];t.direction.setFromMatrixPosition(h.matrixWorld),s.setFromMatrixPosition(h.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(d),n++}else if(h.isSpotLight){const t=r.spot[c];t.position.setFromMatrixPosition(h.matrixWorld),t.position.applyMatrix4(d),t.direction.setFromMatrixPosition(h.matrixWorld),s.setFromMatrixPosition(h.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(d),c++}else if(h.isRectAreaLight){const t=r.rectArea[l];t.position.setFromMatrixPosition(h.matrixWorld),t.position.applyMatrix4(d),a.identity(),o.copy(h.matrixWorld),o.premultiply(d),a.extractRotation(o),t.halfWidth.set(.5*h.width,0,0),t.halfHeight.set(0,.5*h.height,0),t.halfWidth.applyMatrix4(a),t.halfHeight.applyMatrix4(a),l++}else if(h.isPointLight){const t=r.point[i];t.position.setFromMatrixPosition(h.matrixWorld),t.position.applyMatrix4(d),i++}else if(h.isHemisphereLight){const t=r.hemi[u];t.direction.setFromMatrixPosition(h.matrixWorld),t.direction.transformDirection(d),t.direction.normalize(),u++}}},state:r}}function Hs(t,e){const n=new Fs(t,e),i=[],r=[];return{init:function(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:n},setupLights:function(t){n.setup(i,t)},setupLightsView:function(t){n.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){r.push(t)}}}function Vs(t,e){let n=new WeakMap;return{get:function(i,r=0){let s;return!1===n.has(i)?(s=new Hs(t,e),n.set(i,[s])):r>=n.get(i).length?(s=new Hs(t,e),n.get(i).push(s)):s=n.get(i)[r],s},dispose:function(){n=new WeakMap}}}class js extends mn{constructor(t){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}js.prototype.isMeshDepthMaterial=!0;class Gs extends mn{constructor(t){super(),this.type="MeshDistanceMaterial",this.referencePosition=new te,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}Gs.prototype.isMeshDistanceMaterial=!0;function Qs(t,e,n){let i=new bi;const r=new Rt,s=new Rt,o=new Wt,a=new js({depthPacking:3201}),c=new Gs,l={},u=n.maxTextureSize,d={0:1,1:0,2:2},h=new ci({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Rt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const f=new Un;f.setAttribute("position",new _n(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new ni(f,h),v=this;function y(n,i){const r=e.update(g);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,t.setRenderTarget(n.mapPass),t.clear(),t.renderBufferDirect(i,null,r,h,g,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,t.setRenderTarget(n.map),t.clear(),t.renderBufferDirect(i,null,r,p,g,null)}function _(e,n,i,r,s,o){let u=null;const h=!0===i.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(u=void 0!==h?h:!0===i.isPointLight?c:a,t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const t=u.uuid,e=n.uuid;let i=l[t];void 0===i&&(i={},l[t]=i);let r=i[e];void 0===r&&(r=u.clone(),i[e]=r),u=r}return u.visible=n.visible,u.wireframe=n.wireframe,u.side=3===o?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:d[n.side],u.alphaMap=n.alphaMap,u.alphaTest=n.alphaTest,u.clipShadows=n.clipShadows,u.clippingPlanes=n.clippingPlanes,u.clipIntersection=n.clipIntersection,u.displacementMap=n.displacementMap,u.displacementScale=n.displacementScale,u.displacementBias=n.displacementBias,u.wireframeLinewidth=n.wireframeLinewidth,u.linewidth=n.linewidth,!0===i.isPointLight&&!0===u.isMeshDistanceMaterial&&(u.referencePosition.setFromMatrixPosition(i.matrixWorld),u.nearDistance=r,u.farDistance=s),u}function b(n,r,s,o,a){if(!1===n.visible)return;if(n.layers.test(r.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||i.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,n.matrixWorld);const i=e.update(n),r=n.material;if(Array.isArray(r)){const e=i.groups;for(let c=0,l=e.length;c<l;c++){const l=e[c],u=r[l.materialIndex];if(u&&u.visible){const e=_(n,u,o,s.near,s.far,a);t.renderBufferDirect(s,null,i,e,n,l)}}}else if(r.visible){const e=_(n,r,o,s.near,s.far,a);t.renderBufferDirect(s,null,i,e,n,null)}}const c=n.children;for(let t=0,e=c.length;t<e;t++)b(c[t],r,s,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,n,a){if(!1===v.enabled)return;if(!1===v.autoUpdate&&!1===v.needsUpdate)return;if(0===e.length)return;const c=t.getRenderTarget(),l=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),h=t.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(let c=0,l=e.length;c<l;c++){const l=e[c],d=l.shadow;if(void 0===d){console.warn("THREE.WebGLShadowMap:",l,"has no shadow.");continue}if(!1===d.autoUpdate&&!1===d.needsUpdate)continue;r.copy(d.mapSize);const p=d.getFrameExtents();if(r.multiply(p),s.copy(d.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/p.x),r.x=s.x*p.x,d.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/p.y),r.y=s.y*p.y,d.mapSize.y=s.y)),null===d.map&&!d.isPointLightShadow&&3===this.type){const t={minFilter:m,magFilter:m,format:T};d.map=new Kt(r.x,r.y,t),d.map.texture.name=l.name+".shadowMap",d.mapPass=new Kt(r.x,r.y,t),d.camera.updateProjectionMatrix()}if(null===d.map){const t={minFilter:A,magFilter:A,format:T};d.map=new Kt(r.x,r.y,t),d.map.texture.name=l.name+".shadowMap",d.camera.updateProjectionMatrix()}t.setRenderTarget(d.map),t.clear();const f=d.getViewportCount();for(let t=0;t<f;t++){const e=d.getViewport(t);o.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),h.viewport(o),d.updateMatrices(l,t),i=d.getFrustum(),b(n,a,d.camera,l,this.type)}d.isPointLightShadow||3!==this.type||y(d,a),d.needsUpdate=!1}v.needsUpdate=!1,t.setRenderTarget(c,l,d)}}function zs(t,e,i){const r=i.isWebGL2;const s=new function(){let e=!1;const n=new Wt;let i=null;const r=new Wt(0,0,0,0);return{setMask:function(n){i===n||e||(t.colorMask(n,n,n,n),i=n)},setLocked:function(t){e=t},setClear:function(e,i,s,o,a){!0===a&&(e*=o,i*=o,s*=o),n.set(e,i,s,o),!1===r.equals(n)&&(t.clearColor(e,i,s,o),r.copy(n))},reset:function(){e=!1,i=null,r.set(-1,0,0,0)}}},o=new function(){let e=!1,n=null,i=null,r=null;return{setTest:function(t){t?F(2929):H(2929)},setMask:function(i){n===i||e||(t.depthMask(i),n=i)},setFunc:function(e){if(i!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);i=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,n=null,i=null,r=null}}},a=new function(){let e=!1,n=null,i=null,r=null,s=null,o=null,a=null,c=null,l=null;return{setTest:function(t){e||(t?F(2960):H(2960))},setMask:function(i){n===i||e||(t.stencilMask(i),n=i)},setFunc:function(e,n,o){i===e&&r===n&&s===o||(t.stencilFunc(e,n,o),i=e,r=n,s=o)},setOp:function(e,n,i){o===e&&a===n&&c===i||(t.stencilOp(e,n,i),o=e,a=n,c=i)},setLocked:function(t){e=t},setClear:function(e){l!==e&&(t.clearStencil(e),l=e)},reset:function(){e=!1,n=null,i=null,r=null,s=null,o=null,a=null,c=null,l=null}}};let c={},l={},u=new WeakMap,d=[],h=null,A=!1,p=null,f=null,m=null,g=null,v=null,y=null,_=null,b=!1,E=null,w=null,S=null,T=null,C=null;const R=t.getParameter(35661);let I=!1,x=0;const O=t.getParameter(7938);-1!==O.indexOf("WebGL")?(x=parseFloat(/^WebGL (\d)/.exec(O)[1]),I=x>=1):-1!==O.indexOf("OpenGL ES")&&(x=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),I=x>=2);let L=null,M={};const k=t.getParameter(3088),N=t.getParameter(2978),P=(new Wt).fromArray(k),D=(new Wt).fromArray(N);function B(e,n,i){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<i;e++)t.texImage2D(n+e,0,6408,1,1,0,6408,5121,r);return s}const U={};function F(e){!0!==c[e]&&(t.enable(e),c[e]=!0)}function H(e){!1!==c[e]&&(t.disable(e),c[e]=!1)}U[3553]=B(3553,3553,1),U[34067]=B(34067,34069,6),s.setClear(0,0,0,1),o.setClear(1),a.setClear(0),F(2929),o.setFunc(3),Q(!1),z(1),F(2884),G(0);const V={[n]:32774,101:32778,102:32779};if(r)V[103]=32775,V[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(V[103]=t.MIN_EXT,V[104]=t.MAX_EXT)}const j={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function G(e,i,r,s,o,a,c,l){if(0!==e){if(!1===A&&(F(3042),A=!0),5===e)o=o||i,a=a||r,c=c||s,i===f&&o===v||(t.blendEquationSeparate(V[i],V[o]),f=i,v=o),r===m&&s===g&&a===y&&c===_||(t.blendFuncSeparate(j[r],j[s],j[a],j[c]),m=r,g=s,y=a,_=c),p=e,b=null;else if(e!==p||l!==b){if(f===n&&v===n||(t.blendEquation(32774),f=n,v=n),l)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}m=null,g=null,y=null,_=null,p=e,b=l}}else!0===A&&(H(3042),A=!1)}function Q(e){E!==e&&(e?t.frontFace(2304):t.frontFace(2305),E=e)}function z(e){0!==e?(F(2884),e!==w&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):H(2884),w=e}function W(e,n,i){e?(F(32823),T===n&&C===i||(t.polygonOffset(n,i),T=n,C=i)):H(32823)}function K(e){void 0===e&&(e=33984+R-1),L!==e&&(t.activeTexture(e),L=e)}return{buffers:{color:s,depth:o,stencil:a},enable:F,disable:H,bindFramebuffer:function(e,n){return l[e]!==n&&(t.bindFramebuffer(e,n),l[e]=n,r&&(36009===e&&(l[36160]=n),36160===e&&(l[36009]=n)),!0)},drawBuffers:function(n,r){let s=d,o=!1;if(n)if(s=u.get(r),void 0===s&&(s=[],u.set(r,s)),n.isWebGLMultipleRenderTargets){const t=n.texture;if(s.length!==t.length||36064!==s[0]){for(let e=0,n=t.length;e<n;e++)s[e]=36064+e;s.length=t.length,o=!0}}else 36064!==s[0]&&(s[0]=36064,o=!0);else 1029!==s[0]&&(s[0]=1029,o=!0);o&&(i.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return h!==e&&(t.useProgram(e),h=e,!0)},setBlending:G,setMaterial:function(t,e){2===t.side?H(2884):F(2884);let n=1===t.side;e&&(n=!n),Q(n),1===t.blending&&!1===t.transparent?G(0):G(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),o.setFunc(t.depthFunc),o.setTest(t.depthTest),o.setMask(t.depthWrite),s.setMask(t.colorWrite);const i=t.stencilWrite;a.setTest(i),i&&(a.setMask(t.stencilWriteMask),a.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),a.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),W(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?F(32926):H(32926)},setFlipSided:Q,setCullFace:z,setLineWidth:function(e){e!==S&&(I&&t.lineWidth(e),S=e)},setPolygonOffset:W,setScissorTest:function(t){t?F(3089):H(3089)},activeTexture:K,bindTexture:function(e,n){null===L&&K();let i=M[L];void 0===i&&(i={type:void 0,texture:void 0},M[L]=i),i.type===e&&i.texture===n||(t.bindTexture(e,n||U[e]),i.type=e,i.texture=n)},unbindTexture:function(){const e=M[L];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===P.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),P.copy(e))},viewport:function(e){!1===D.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),D.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===r&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),c={},L=null,M={},l={},u=new WeakMap,d=[],h=null,A=!1,p=null,f=null,m=null,g=null,v=null,y=null,_=null,b=!1,E=null,w=null,S=null,T=null,C=null,P.set(0,0,t.canvas.width,t.canvas.height),D.set(0,0,t.canvas.width,t.canvas.height),s.reset(),o.reset(),a.reset()}}}function Ws(t,e,n,i,r,s,o){const a=r.isWebGL2,c=r.maxTextures,l=r.maxCubemapSize,I=r.maxTextureSize,x=r.maxSamples,O=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,L=new WeakMap;let M;const k=new WeakMap;let N=!1;try{N="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function P(t,e){return N?new OffscreenCanvas(t,e):Mt("canvas")}function D(t,e,n,i){let r=1;if((t.width>i||t.height>i)&&(r=i/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const i=e?Tt:Math.floor,s=i(r*t.width),o=i(r*t.height);void 0===M&&(M=P(s,o));const a=n?P(s,o):M;a.width=s,a.height=o;return a.getContext("2d").drawImage(t,0,0,s,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+o+")."),a}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function B(t){return wt(t.width)&&wt(t.height)}function U(t,e){return t.generateMipmaps&&e&&t.minFilter!==A&&t.minFilter!==m}function F(e){t.generateMipmap(e)}function H(n,i,r,s,o=!1){if(!1===a)return i;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let c=i;return 6403===i&&(5126===r&&(c=33326),5131===r&&(c=33325),5121===r&&(c=33321)),33319===i&&(5126===r&&(c=33328),5131===r&&(c=33327),5121===r&&(c=33323)),6408===i&&(5126===r&&(c=34836),5131===r&&(c=34842),5121===r&&(c=s===ct&&!1===o?35907:32856),32819===r&&(c=32854),32820===r&&(c=32855)),33325!==c&&33326!==c&&33327!==c&&33328!==c&&34842!==c&&34836!==c||e.get("EXT_color_buffer_float"),c}function V(t,e,n){return!0===U(t,n)||t.isFramebufferTexture&&t.minFilter!==A&&t.minFilter!==m?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function j(t){return t===A||t===p||t===f?9728:9729}function G(t){const e=t.target;e.removeEventListener("dispose",G),function(t){const e=i.get(t);if(void 0===e.__webglInit)return;const n=t.source,r=k.get(n);if(r){const i=r[e.__cacheKey];i.usedTimes--,0===i.usedTimes&&z(t),0===Object.keys(r).length&&k.delete(n)}i.remove(t)}(e),e.isVideoTexture&&L.delete(e)}function Q(e){const n=e.target;n.removeEventListener("dispose",Q),function(e){const n=e.texture,r=i.get(e),s=i.get(n);void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),o.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer&&t.deleteRenderbuffer(r.__webglColorRenderbuffer),r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer);if(e.isWebGLMultipleRenderTargets)for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),o.memory.textures--),i.remove(n[e])}i.remove(n),i.remove(e)}(n)}function z(e){const n=i.get(e);t.deleteTexture(n.__webglTexture);const r=e.source;delete k.get(r)[n.__cacheKey],o.memory.textures--}let W=0;function K(t,e){const r=i.get(t);if(t.isVideoTexture&&function(t){const e=o.render.frame;L.get(t)!==e&&(L.set(t,e),t.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&r.__version!==t.version){const n=t.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void J(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+e),n.bindTexture(3553,r.__webglTexture)}const q={[u]:10497,[d]:33071,[h]:33648},Y={[A]:9728,[p]:9984,[f]:9986,[m]:9729,[g]:9985,[v]:9987};function $(n,s,o){if(o?(t.texParameteri(n,10242,q[s.wrapS]),t.texParameteri(n,10243,q[s.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,q[s.wrapR]),t.texParameteri(n,10240,Y[s.magFilter]),t.texParameteri(n,10241,Y[s.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),s.wrapS===d&&s.wrapT===d||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,j(s.magFilter)),t.texParameteri(n,10241,j(s.minFilter)),s.minFilter!==A&&s.minFilter!==m&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const o=e.get("EXT_texture_filter_anisotropic");if(s.type===E&&!1===e.has("OES_texture_float_linear"))return;if(!1===a&&s.type===w&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||i.get(s).__currentAnisotropy)&&(t.texParameterf(n,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),i.get(s).__currentAnisotropy=s.anisotropy)}}function X(e,n){let i=!1;void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",G));const r=n.source;let s=k.get(r);void 0===s&&(s={},k.set(r,s));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(n);if(a!==e.__cacheKey){void 0===s[a]&&(s[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,i=!0),s[a].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&z(n)),e.__cacheKey=a,e.__webglTexture=s[a].texture}return i}function J(e,i,r){let o=3553;i.isDataArrayTexture&&(o=35866),i.isData3DTexture&&(o=32879);const c=X(e,i),l=i.source;if(n.activeTexture(33984+r),n.bindTexture(o,e.__webglTexture),l.version!==l.__currentVersion||!0===c){t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const r=function(t){return!a&&(t.wrapS!==d||t.wrapT!==d||t.minFilter!==A&&t.minFilter!==m)}(i)&&!1===B(i.image);let c=D(i.image,r,!1,I);c=rt(i,c);const u=B(c)||a,h=s.convert(i.format,i.encoding);let p,f=s.convert(i.type),g=H(i.internalFormat,h,f,i.encoding,i.isVideoTexture);$(o,i,u);const v=i.mipmaps,y=a&&!0!==i.isVideoTexture,w=void 0===e.__version,x=V(i,c,u);if(i.isDepthTexture)g=6402,a?g=i.type===E?36012:i.type===b?33190:i.type===S?35056:33189:i.type===E&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),i.format===C&&6402===g&&i.type!==_&&i.type!==b&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=_,f=s.convert(i.type)),i.format===R&&6402===g&&(g=34041,i.type!==S&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=S,f=s.convert(i.type))),y&&w?n.texStorage2D(3553,1,g,c.width,c.height):n.texImage2D(3553,0,g,c.width,c.height,0,h,f,null);else if(i.isDataTexture)if(v.length>0&&u){y&&w&&n.texStorage2D(3553,x,g,v[0].width,v[0].height);for(let t=0,e=v.length;t<e;t++)p=v[t],y?n.texSubImage2D(3553,t,0,0,p.width,p.height,h,f,p.data):n.texImage2D(3553,t,g,p.width,p.height,0,h,f,p.data);i.generateMipmaps=!1}else y?(w&&n.texStorage2D(3553,x,g,c.width,c.height),n.texSubImage2D(3553,0,0,0,c.width,c.height,h,f,c.data)):n.texImage2D(3553,0,g,c.width,c.height,0,h,f,c.data);else if(i.isCompressedTexture){y&&w&&n.texStorage2D(3553,x,g,v[0].width,v[0].height);for(let t=0,e=v.length;t<e;t++)p=v[t],i.format!==T?null!==h?y?n.compressedTexSubImage2D(3553,t,0,0,p.width,p.height,h,p.data):n.compressedTexImage2D(3553,t,g,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):y?n.texSubImage2D(3553,t,0,0,p.width,p.height,h,f,p.data):n.texImage2D(3553,t,g,p.width,p.height,0,h,f,p.data)}else if(i.isDataArrayTexture)y?(w&&n.texStorage3D(35866,x,g,c.width,c.height,c.depth),n.texSubImage3D(35866,0,0,0,0,c.width,c.height,c.depth,h,f,c.data)):n.texImage3D(35866,0,g,c.width,c.height,c.depth,0,h,f,c.data);else if(i.isData3DTexture)y?(w&&n.texStorage3D(32879,x,g,c.width,c.height,c.depth),n.texSubImage3D(32879,0,0,0,0,c.width,c.height,c.depth,h,f,c.data)):n.texImage3D(32879,0,g,c.width,c.height,c.depth,0,h,f,c.data);else if(i.isFramebufferTexture)y&&w?n.texStorage2D(3553,x,g,c.width,c.height):n.texImage2D(3553,0,g,c.width,c.height,0,h,f,null);else if(v.length>0&&u){y&&w&&n.texStorage2D(3553,x,g,v[0].width,v[0].height);for(let t=0,e=v.length;t<e;t++)p=v[t],y?n.texSubImage2D(3553,t,0,0,h,f,p):n.texImage2D(3553,t,g,h,f,p);i.generateMipmaps=!1}else y?(w&&n.texStorage2D(3553,x,g,c.width,c.height),n.texSubImage2D(3553,0,0,0,h,f,c)):n.texImage2D(3553,0,g,h,f,c);U(i,u)&&F(o),l.__currentVersion=l.version,i.onUpdate&&i.onUpdate(i)}e.__version=i.version}function Z(e,r,o,a,c){const l=s.convert(o.format,o.encoding),u=s.convert(o.type),d=H(o.internalFormat,l,u,o.encoding);i.get(r).__hasExternalTextures||(32879===c||35866===c?n.texImage3D(c,0,d,r.width,r.height,r.depth,0,l,u,null):n.texImage2D(c,0,d,r.width,r.height,0,l,u,null)),n.bindFramebuffer(36160,e),it(r)?O.framebufferTexture2DMultisampleEXT(36160,a,c,i.get(o).__webglTexture,0,nt(r)):t.framebufferTexture2D(36160,a,c,i.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function tt(e,n,i){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let r=33189;if(i||it(n)){const e=n.depthTexture;e&&e.isDepthTexture&&(e.type===E?r=36012:e.type===b&&(r=33190));const i=nt(n);it(n)?O.renderbufferStorageMultisampleEXT(36161,i,r,n.width,n.height):t.renderbufferStorageMultisample(36161,i,r,n.width,n.height)}else t.renderbufferStorage(36161,r,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){const r=nt(n);i&&!1===it(n)?t.renderbufferStorageMultisample(36161,r,35056,n.width,n.height):it(n)?O.renderbufferStorageMultisampleEXT(36161,r,35056,n.width,n.height):t.renderbufferStorage(36161,34041,n.width,n.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,r=s.convert(e.format,e.encoding),o=s.convert(e.type),a=H(e.internalFormat,r,o,e.encoding),c=nt(n);i&&!1===it(n)?t.renderbufferStorageMultisample(36161,c,a,n.width,n.height):it(n)?O.renderbufferStorageMultisampleEXT(36161,c,a,n.width,n.height):t.renderbufferStorage(36161,a,n.width,n.height)}t.bindRenderbuffer(36161,null)}function et(e){const r=i.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),K(r.depthTexture,0);const s=i.get(r.depthTexture).__webglTexture,o=nt(r);if(r.depthTexture.format===C)it(r)?O.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,o):t.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==R)throw new Error("Unknown depthTexture format");it(r)?O.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,o):t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let i=0;i<6;i++)n.bindFramebuffer(36160,r.__webglFramebuffer[i]),r.__webglDepthbuffer[i]=t.createRenderbuffer(),tt(r.__webglDepthbuffer[i],e,!1)}else n.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),tt(r.__webglDepthbuffer,e,!1);n.bindFramebuffer(36160,null)}function nt(t){return Math.min(x,t.samples)}function it(t){const n=i.get(t);return a&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function rt(t,n){const i=t.encoding,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===At||i!==at&&(i===ct?!1===a?!0===e.has("EXT_sRGB")&&r===T?(t.format=At,t.minFilter=m,t.generateMipmaps=!1):n=Vt.sRGBToLinear(n):r===T&&s===y||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",i)),n}this.allocateTextureUnit=function(){const t=W;return t>=c&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+c),W+=1,t},this.resetTextureUnits=function(){W=0},this.setTexture2D=K,this.setTexture2DArray=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?J(r,t,e):(n.activeTexture(33984+e),n.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=i.get(t);t.version>0&&r.__version!==t.version?J(r,t,e):(n.activeTexture(33984+e),n.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(e,r){const o=i.get(e);e.version>0&&o.__version!==e.version?function(e,i,r){if(6!==i.image.length)return;const o=X(e,i),c=i.source;if(n.activeTexture(33984+r),n.bindTexture(34067,e.__webglTexture),c.version!==c.__currentVersion||!0===o){t.pixelStorei(37440,i.flipY),t.pixelStorei(37441,i.premultiplyAlpha),t.pixelStorei(3317,i.unpackAlignment),t.pixelStorei(37443,0);const r=i.isCompressedTexture||i.image[0].isCompressedTexture,o=i.image[0]&&i.image[0].isDataTexture,u=[];for(let t=0;t<6;t++)u[t]=r||o?o?i.image[t].image:i.image[t]:D(i.image[t],!1,!0,l),u[t]=rt(i,u[t]);const d=u[0],h=B(d)||a,A=s.convert(i.format,i.encoding),p=s.convert(i.type),f=H(i.internalFormat,A,p,i.encoding),m=a&&!0!==i.isVideoTexture,g=void 0===e.__version;let v,y=V(i,d,h);if($(34067,i,h),r){m&&g&&n.texStorage2D(34067,y,f,d.width,d.height);for(let t=0;t<6;t++){v=u[t].mipmaps;for(let e=0;e<v.length;e++){const r=v[e];i.format!==T?null!==A?m?n.compressedTexSubImage2D(34069+t,e,0,0,r.width,r.height,A,r.data):n.compressedTexImage2D(34069+t,e,f,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):m?n.texSubImage2D(34069+t,e,0,0,r.width,r.height,A,p,r.data):n.texImage2D(34069+t,e,f,r.width,r.height,0,A,p,r.data)}}}else{v=i.mipmaps,m&&g&&(v.length>0&&y++,n.texStorage2D(34067,y,f,u[0].width,u[0].height));for(let t=0;t<6;t++)if(o){m?n.texSubImage2D(34069+t,0,0,0,u[t].width,u[t].height,A,p,u[t].data):n.texImage2D(34069+t,0,f,u[t].width,u[t].height,0,A,p,u[t].data);for(let e=0;e<v.length;e++){const i=v[e].image[t].image;m?n.texSubImage2D(34069+t,e+1,0,0,i.width,i.height,A,p,i.data):n.texImage2D(34069+t,e+1,f,i.width,i.height,0,A,p,i.data)}}else{m?n.texSubImage2D(34069+t,0,0,0,A,p,u[t]):n.texImage2D(34069+t,0,f,A,p,u[t]);for(let e=0;e<v.length;e++){const i=v[e];m?n.texSubImage2D(34069+t,e+1,0,0,A,p,i.image[t]):n.texImage2D(34069+t,e+1,f,A,p,i.image[t])}}}U(i,h)&&F(34067),c.__currentVersion=c.version,i.onUpdate&&i.onUpdate(i)}e.__version=i.version}(o,e,r):(n.activeTexture(33984+r),n.bindTexture(34067,o.__webglTexture))},this.rebindTextures=function(t,e,n){const r=i.get(t);void 0!==e&&Z(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==n&&et(t)},this.setupRenderTarget=function(e){const c=e.texture,l=i.get(e),u=i.get(c);e.addEventListener("dispose",Q),!0!==e.isWebGLMultipleRenderTargets&&(void 0===u.__webglTexture&&(u.__webglTexture=t.createTexture()),u.__version=c.version,o.memory.textures++);const d=!0===e.isWebGLCubeRenderTarget,h=!0===e.isWebGLMultipleRenderTargets,A=B(e)||a;if(d){l.__webglFramebuffer=[];for(let e=0;e<6;e++)l.__webglFramebuffer[e]=t.createFramebuffer()}else if(l.__webglFramebuffer=t.createFramebuffer(),h)if(r.drawBuffers){const n=e.texture;for(let e=0,r=n.length;e<r;e++){const r=i.get(n[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(a&&e.samples>0&&!1===it(e)){l.__webglMultisampledFramebuffer=t.createFramebuffer(),l.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,l.__webglColorRenderbuffer);const i=s.convert(c.format,c.encoding),r=s.convert(c.type),o=H(c.internalFormat,i,r,c.encoding),a=nt(e);t.renderbufferStorageMultisample(36161,a,o,e.width,e.height),n.bindFramebuffer(36160,l.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,l.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(l.__webglDepthRenderbuffer=t.createRenderbuffer(),tt(l.__webglDepthRenderbuffer,e,!0)),n.bindFramebuffer(36160,null)}if(d){n.bindTexture(34067,u.__webglTexture),$(34067,c,A);for(let t=0;t<6;t++)Z(l.__webglFramebuffer[t],e,c,36064,34069+t);U(c,A)&&F(34067),n.unbindTexture()}else if(h){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=i.get(s);n.bindTexture(3553,o.__webglTexture),$(3553,s,A),Z(l.__webglFramebuffer,e,s,36064+r,3553),U(s,A)&&F(3553)}n.unbindTexture()}else{let t=3553;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(a?t=e.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(t,u.__webglTexture),$(t,c,A),Z(l.__webglFramebuffer,e,c,36064,t),U(c,A)&&F(t),n.unbindTexture()}e.depthBuffer&&et(e)},this.updateRenderTargetMipmap=function(t){const e=B(t)||a,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,o=r.length;s<o;s++){const o=r[s];if(U(o,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=i.get(o).__webglTexture;n.bindTexture(e,r),F(e),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(a&&e.samples>0&&!1===it(e)){const r=e.width,s=e.height;let o=16384;const a=[36064],c=e.stencilBuffer?33306:36096;e.depthBuffer&&a.push(c);const l=i.get(e),u=void 0!==l.__ignoreDepthValues&&l.__ignoreDepthValues;!1===u&&(e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024)),n.bindFramebuffer(36008,l.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,l.__webglFramebuffer),!0===u&&(t.invalidateFramebuffer(36008,[c]),t.invalidateFramebuffer(36009,[c])),t.blitFramebuffer(0,0,r,s,0,0,r,s,o,9728),t.invalidateFramebuffer(36008,a),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,l.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=et,this.setupFrameBufferTexture=Z,this.useMultisampledRTT=it}function Ks(t,e,n){const i=n.isWebGL2;return{convert:function(t,n=null){let r;if(t===y)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1010===t)return 5120;if(1011===t)return 5122;if(t===_)return 5123;if(1013===t)return 5124;if(t===b)return 5125;if(t===E)return 5126;if(t===w)return i?5131:(r=e.get("OES_texture_half_float"),null!==r?r.HALF_FLOAT_OES:null);if(1021===t)return 6406;if(t===T)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===C)return 6402;if(t===R)return 34041;if(1028===t)return 6403;if(1022===t)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(t===At)return r=e.get("EXT_sRGB"),null!==r?r.SRGB_ALPHA_EXT:null;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1033===t)return 36249;if(t===I||t===x||t===O||t===L)if(n===ct){if(r=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===r)return null;if(t===I)return r.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===x)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===O)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===L)return r.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(r=e.get("WEBGL_compressed_texture_s3tc"),null===r)return null;if(t===I)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===x)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===O)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===L)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(t===M||t===k||t===N||t===P){if(r=e.get("WEBGL_compressed_texture_pvrtc"),null===r)return null;if(t===M)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===k)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===N)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===P)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===t)return r=e.get("WEBGL_compressed_texture_etc1"),null!==r?r.COMPRESSED_RGB_ETC1_WEBGL:null;if(t===D||t===B){if(r=e.get("WEBGL_compressed_texture_etc"),null===r)return null;if(t===D)return n===ct?r.COMPRESSED_SRGB8_ETC2:r.COMPRESSED_RGB8_ETC2;if(t===B)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:r.COMPRESSED_RGBA8_ETC2_EAC}if(t===U||t===F||t===H||t===V||t===j||t===G||t===Q||t===z||t===W||t===K||t===q||t===Y||t===$||t===X){if(r=e.get("WEBGL_compressed_texture_astc"),null===r)return null;if(t===U)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:r.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===F)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:r.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===H)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:r.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===V)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:r.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===j)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:r.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===G)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:r.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===Q)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:r.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===z)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:r.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===W)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:r.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===K)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:r.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===q)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:r.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===Y)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:r.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===$)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:r.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===X)return n===ct?r.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:r.COMPRESSED_RGBA_ASTC_12x12_KHR}if(t===J){if(r=e.get("EXT_texture_compression_bptc"),null===r)return null;if(t===J)return n===ct?r.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:r.COMPRESSED_RGBA_BPTC_UNORM_EXT}return t===S?i?34042:(r=e.get("WEBGL_depth_texture"),null!==r?r.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class qs extends ui{constructor(t=[]){super(),this.cameras=t}}qs.prototype.isArrayCamera=!0;class Ys extends nn{constructor(){super(),this.type="Group"}}Ys.prototype.isGroup=!0;const $s={type:"move"};class Xs{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Ys,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Ys,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new te,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new te),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Ys,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new te,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new te),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,n){let i=null,r=null,s=null;const o=this._targetRay,a=this._grip,c=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState)if(null!==o&&(i=e.getPose(t.targetRaySpace,n),null!==i&&(o.matrix.fromArray(i.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),i.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(i.linearVelocity)):o.hasLinearVelocity=!1,i.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(i.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent($s))),c&&t.hand){s=!0;for(const i of t.hand.values()){const t=e.getJointPose(i,n);if(void 0===c.joints[i.jointName]){const t=new Ys;t.matrixAutoUpdate=!1,t.visible=!1,c.joints[i.jointName]=t,c.add(t)}const r=c.joints[i.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const i=c.joints["index-finger-tip"],r=c.joints["thumb-tip"],o=i.position.distanceTo(r.position),a=.02,l=.005;c.inputState.pinching&&o>a+l?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputState.pinching&&o<=a-l&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(r=e.getPose(t.gripSpace,n),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==i),null!==a&&(a.visible=null!==r),null!==c&&(c.visible=null!==s),this}}class Js extends zt{constructor(t,e,n,i,r,s,o,a,c,l){if((l=void 0!==l?l:C)!==C&&l!==R)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&l===C&&(n=_),void 0===n&&l===R&&(n=S),super(null,i,r,s,o,a,l,n,c),this.image={width:t,height:e},this.magFilter=void 0!==o?o:A,this.minFilter=void 0!==a?a:A,this.flipY=!1,this.generateMipmaps=!1}}Js.prototype.isDepthTexture=!0;class Zs extends pt{constructor(t,e){super();const n=this;let i=null,r=1,s=null,o="local-floor",a=null,c=null,l=null,u=null,d=null;const h=e.getContextAttributes();let A=null,p=null;const f=[],m=new Map,g=new ui;g.layers.enable(1),g.viewport=new Wt;const v=new ui;v.layers.enable(2),v.viewport=new Wt;const b=[g,v],E=new qs;E.layers.enable(1),E.layers.enable(2);let w=null,I=null;function x(t){const e=m.get(t.inputSource);e&&e.dispatchEvent({type:t.type,data:t.inputSource})}function O(){m.forEach((function(t,e){t.disconnect(e)})),m.clear(),w=null,I=null,t.setRenderTarget(A),u=null,l=null,c=null,i=null,p=null,D.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function L(t){const e=i.inputSources;for(let t=0;t<f.length;t++)m.set(e[t],f[t]);for(let e=0;e<t.removed.length;e++){const n=t.removed[e],i=m.get(n);i&&(i.dispatchEvent({type:"disconnected",data:n}),m.delete(n))}for(let e=0;e<t.added.length;e++){const n=t.added[e],i=m.get(n);i&&i.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=f[t];return void 0===e&&(e=new Xs,f[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=f[t];return void 0===e&&(e=new Xs,f[t]=e),e.getGripSpace()},this.getHand=function(t){let e=f[t];return void 0===e&&(e=new Xs,f[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return s},this.getBaseLayer=function(){return null!==l?l:u},this.getBinding=function(){return c},this.getFrame=function(){return d},this.getSession=function(){return i},this.setSession=async function(a){if(i=a,null!==i){if(A=t.getRenderTarget(),i.addEventListener("select",x),i.addEventListener("selectstart",x),i.addEventListener("selectend",x),i.addEventListener("squeeze",x),i.addEventListener("squeezestart",x),i.addEventListener("squeezeend",x),i.addEventListener("end",O),i.addEventListener("inputsourceschange",L),!0!==h.xrCompatible&&await e.makeXRCompatible(),void 0===i.renderState.layers||!1===t.capabilities.isWebGL2){const n={antialias:void 0!==i.renderState.layers||h.antialias,alpha:h.alpha,depth:h.depth,stencil:h.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(i,e,n),i.updateRenderState({baseLayer:u}),p=new Kt(u.framebufferWidth,u.framebufferHeight,{format:T,type:y,encoding:t.outputEncoding})}else{let n=null,s=null,o=null;h.depth&&(o=h.stencil?35056:33190,n=h.stencil?R:C,s=h.stencil?S:_);const a={colorFormat:t.outputEncoding===ct?35907:32856,depthFormat:o,scaleFactor:r};c=new XRWebGLBinding(i,e),l=c.createProjectionLayer(a),i.updateRenderState({layers:[l]}),p=new Kt(l.textureWidth,l.textureHeight,{format:T,type:y,depthTexture:new Js(l.textureWidth,l.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:h.stencil,encoding:t.outputEncoding,samples:h.antialias?4:0});t.properties.get(p).__ignoreDepthValues=l.ignoreDepthValues}p.isXRRenderTarget=!0,this.setFoveation(1),s=await i.requestReferenceSpace(o),D.setContext(i),D.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const M=new te,k=new te;function N(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===i)return;E.near=v.near=g.near=t.near,E.far=v.far=g.far=t.far,w===E.near&&I===E.far||(i.updateRenderState({depthNear:E.near,depthFar:E.far}),w=E.near,I=E.far);const e=t.parent,n=E.cameras;N(E,e);for(let t=0;t<n.length;t++)N(n[t],e);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),t.position.copy(E.position),t.quaternion.copy(E.quaternion),t.scale.copy(E.scale),t.matrix.copy(E.matrix),t.matrixWorld.copy(E.matrixWorld);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===n.length?function(t,e,n){M.setFromMatrixPosition(e.matrixWorld),k.setFromMatrixPosition(n.matrixWorld);const i=M.distanceTo(k),r=e.projectionMatrix.elements,s=n.projectionMatrix.elements,o=r[14]/(r[10]-1),a=r[14]/(r[10]+1),c=(r[9]+1)/r[5],l=(r[9]-1)/r[5],u=(r[8]-1)/r[0],d=(s[8]+1)/s[0],h=o*u,A=o*d,p=i/(-u+d),f=p*-u;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(p),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const m=o+p,g=a+p,v=h-f,y=A+(i-f),_=c*a/g*m,b=l*a/g*m;t.projectionMatrix.makePerspective(v,y,_,b,m,g)}(E,g,v):E.projectionMatrix.copy(g.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){return null!==l?l.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(t){null!==l&&(l.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let P=null;const D=new Ei;D.setAnimationLoop((function(e,n){if(a=n.getViewerPose(s),d=n,null!==a){const e=a.views;null!==u&&(t.setRenderTargetFramebuffer(p,u.framebuffer),t.setRenderTarget(p));let n=!1;e.length!==E.cameras.length&&(E.cameras.length=0,n=!0);for(let i=0;i<e.length;i++){const r=e[i];let s=null;if(null!==u)s=u.getViewport(r);else{const e=c.getViewSubImage(l,r);s=e.viewport,0===i&&(t.setRenderTargetTextures(p,e.colorTexture,l.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(p))}const o=b[i];o.matrix.fromArray(r.transform.matrix),o.projectionMatrix.fromArray(r.projectionMatrix),o.viewport.set(s.x,s.y,s.width,s.height),0===i&&E.matrix.copy(o.matrix),!0===n&&E.cameras.push(o)}}const r=i.inputSources;for(let t=0;t<f.length;t++){const e=f[t],i=r[t];e.update(i,n,s)}P&&P(e,n),d=null})),this.setAnimationLoop=function(t){P=t},this.dispose=function(){}}}function to(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap),n.alphaTest>0&&(e.alphaTest.value=n.alphaTest);const i=t.get(n).envMap;let r,s;i&&(e.envMap.value=i,e.flipEnvMap.value=i.isCubeTexture&&!1===i.isRenderTargetTexture?-1:1,e.reflectivity.value=n.reflectivity,e.ior.value=n.ior,e.refractionRatio.value=n.refractionRatio),n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap?r=n.clearcoatRoughnessMap:n.specularIntensityMap?r=n.specularIntensityMap:n.specularColorMap?r=n.specularColorMap:n.transmissionMap?r=n.transmissionMap:n.thicknessMap?r=n.thicknessMap:n.sheenColorMap?r=n.sheenColorMap:n.sheenRoughnessMap&&(r=n.sheenRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),e.uvTransform.value.copy(r.matrix)),n.aoMap?s=n.aoMap:n.lightMap&&(s=n.lightMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uv2Transform.value.copy(s.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(e.emissiveMap.value=n.emissiveMap),n.bumpMap&&(e.bumpMap.value=n.bumpMap,e.bumpScale.value=n.bumpScale,1===n.side&&(e.bumpScale.value*=-1)),n.normalMap&&(e.normalMap.value=n.normalMap,e.normalScale.value.copy(n.normalScale),1===n.side&&e.normalScale.value.negate()),n.displacementMap&&(e.displacementMap.value=n.displacementMap,e.displacementScale.value=n.displacementScale,e.displacementBias.value=n.displacementBias);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,i,r,s,o){i.isMeshBasicMaterial?e(t,i):i.isMeshLambertMaterial?(e(t,i),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,i)):i.isMeshToonMaterial?(e(t,i),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshPhongMaterial?(e(t,i),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshStandardMaterial?(e(t,i),i.isMeshPhysicalMaterial?function(t,e,i){n(t,e),t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,i,o):n(t,i)):i.isMeshMatcapMaterial?(e(t,i),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDepthMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isMeshDistanceMaterial?(e(t,i),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,i)):i.isMeshNormalMaterial?(e(t,i),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,i)):i.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,i),i.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,i)):i.isPointsMaterial?function(t,e,n,i){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*i,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,i,r,s):i.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,i):i.isShadowMaterial?(t.color.value.copy(i.color),t.opacity.value=i.opacity):i.isShaderMaterial&&(i.uniformsNeedUpdate=!1)}}}function eo(t={}){const e=void 0!==t.canvas?t.canvas:function(){const t=Mt("canvas");return t.style.display="block",t}(),n=void 0!==t.context?t.context:null,i=void 0===t.depth||t.depth,r=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,o=void 0===t.premultipliedAlpha||t.premultipliedAlpha,a=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,c=void 0!==t.powerPreference?t.powerPreference:"default",l=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let u;u=void 0!==t.context?n.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let d=null,h=null;const A=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=at,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const f=this;let m=!1,g=0,_=0,b=null,S=-1,C=null;const R=new Wt,I=new Wt;let x=null,O=e.width,L=e.height,M=1,k=null,N=null;const P=new Wt(0,0,O,L),D=new Wt(0,0,O,L);let B=!1;const U=new bi;let F=!1,H=!1,V=null;const j=new Le,G=new Rt,Q=new te,z={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function W(){return null===b?M:1}let K,q,Y,$,X,J,Z,tt,et,nt,it,rt,st,ot,ct,lt,ut,dt,ht,At,pt,ft,mt,gt=n;function vt(t,n){for(let i=0;i<t.length;i++){const r=t[i],s=e.getContext(r,n);if(null!==s)return s}return null}try{const t={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:c,failIfMajorPerformanceCaveat:l};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r138"),e.addEventListener("webglcontextlost",bt,!1),e.addEventListener("webglcontextrestored",Et,!1),null===gt){const e=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&e.shift(),gt=vt(e,t),null===gt)throw vt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===gt.getShaderPrecisionFormat&&(gt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function yt(){K=new $i(gt),q=new Li(gt,K,t),K.init(q),ft=new Ks(gt,K,q),Y=new zs(gt,K,q),$=new Zi(gt),X=new Ls,J=new Ws(gt,K,Y,X,q,ft,$),Z=new ki(f),tt=new Yi(f),et=new wi(gt,q),mt=new xi(gt,K,et,q),nt=new Xi(gt,et,$,mt),it=new rr(gt,nt,et,$),ht=new ir(gt,q,J),lt=new Mi(X),rt=new Os(f,Z,tt,K,q,mt,lt),st=new to(X),ot=new Ps,ct=new Vs(K,q),dt=new Ii(f,Z,Y,it,u,o),ut=new Qs(f,it,q),At=new Oi(gt,K,$,q),pt=new Ji(gt,K,$,q),$.programs=rt.programs,f.capabilities=q,f.extensions=K,f.properties=X,f.renderLists=ot,f.shadowMap=ut,f.state=Y,f.info=$}yt();const _t=new Zs(f,gt);function bt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function Et(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;const t=$.autoReset,e=ut.enabled,n=ut.autoUpdate,i=ut.needsUpdate,r=ut.type;yt(),$.autoReset=t,ut.enabled=e,ut.autoUpdate=n,ut.needsUpdate=i,ut.type=r}function wt(t){const e=t.target;e.removeEventListener("dispose",wt),function(t){(function(t){const e=X.get(t).programs;void 0!==e&&(e.forEach((function(t){rt.releaseProgram(t)})),t.isShaderMaterial&&rt.releaseShaderCache(t))})(t),X.remove(t)}(e)}this.xr=_t,this.getContext=function(){return gt},this.getContextAttributes=function(){return gt.getContextAttributes()},this.forceContextLoss=function(){const t=K.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=K.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return M},this.setPixelRatio=function(t){void 0!==t&&(M=t,this.setSize(O,L,!1))},this.getSize=function(t){return t.set(O,L)},this.setSize=function(t,n,i){_t.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(O=t,L=n,e.width=Math.floor(t*M),e.height=Math.floor(n*M),!1!==i&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return t.set(O*M,L*M).floor()},this.setDrawingBufferSize=function(t,n,i){O=t,L=n,M=i,e.width=Math.floor(t*i),e.height=Math.floor(n*i),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return t.copy(R)},this.getViewport=function(t){return t.copy(P)},this.setViewport=function(t,e,n,i){t.isVector4?P.set(t.x,t.y,t.z,t.w):P.set(t,e,n,i),Y.viewport(R.copy(P).multiplyScalar(M).floor())},this.getScissor=function(t){return t.copy(D)},this.setScissor=function(t,e,n,i){t.isVector4?D.set(t.x,t.y,t.z,t.w):D.set(t,e,n,i),Y.scissor(I.copy(D).multiplyScalar(M).floor())},this.getScissorTest=function(){return B},this.setScissorTest=function(t){Y.setScissorTest(B=t)},this.setOpaqueSort=function(t){k=t},this.setTransparentSort=function(t){N=t},this.getClearColor=function(t){return t.copy(dt.getClearColor())},this.setClearColor=function(){dt.setClearColor.apply(dt,arguments)},this.getClearAlpha=function(){return dt.getClearAlpha()},this.setClearAlpha=function(){dt.setClearAlpha.apply(dt,arguments)},this.clear=function(t=!0,e=!0,n=!0){let i=0;t&&(i|=16384),e&&(i|=256),n&&(i|=1024),gt.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",bt,!1),e.removeEventListener("webglcontextrestored",Et,!1),ot.dispose(),ct.dispose(),X.dispose(),Z.dispose(),tt.dispose(),it.dispose(),mt.dispose(),rt.dispose(),_t.dispose(),_t.removeEventListener("sessionstart",Ct),_t.removeEventListener("sessionend",It),V&&(V.dispose(),V=null),xt.stop()},this.renderBufferDirect=function(t,e,n,i,r,s){null===e&&(e=z);const o=r.isMesh&&r.matrixWorld.determinant()<0,a=function(t,e,n,i,r){!0!==e.isScene&&(e=z);J.resetTextureUnits();const s=e.fog,o=i.isMeshStandardMaterial?e.environment:null,a=null===b?f.outputEncoding:!0===b.isXRRenderTarget?b.texture.encoding:at,c=(i.isMeshStandardMaterial?tt:Z).get(i.envMap||o),l=!0===i.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,u=!!i.normalMap&&!!n.attributes.tangent,d=!!n.morphAttributes.position,A=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,m=i.toneMapped?f.toneMapping:0,g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==g?g.length:0,y=X.get(i),_=h.state.lights;if(!0===F&&(!0===H||t!==C)){const e=t===C&&i.id===S;lt.setState(i,t,e)}let E=!1;i.version===y.__version?y.needsLights&&y.lightsStateVersion!==_.state.version||y.outputEncoding!==a||r.isInstancedMesh&&!1===y.instancing?E=!0:r.isInstancedMesh||!0!==y.instancing?r.isSkinnedMesh&&!1===y.skinning?E=!0:r.isSkinnedMesh||!0!==y.skinning?y.envMap!==c||i.fog&&y.fog!==s?E=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===lt.numPlanes&&y.numIntersection===lt.numIntersection?(y.vertexAlphas!==l||y.vertexTangents!==u||y.morphTargets!==d||y.morphNormals!==A||y.morphColors!==p||y.toneMapping!==m||!0===q.isWebGL2&&y.morphTargetsCount!==v)&&(E=!0):E=!0:E=!0:E=!0:(E=!0,y.__version=i.version);let w=y.currentProgram;!0===E&&(w=Pt(i,e,r));let T=!1,R=!1,I=!1;const x=w.getUniforms(),O=y.uniforms;Y.useProgram(w.program)&&(T=!0,R=!0,I=!0);i.id!==S&&(S=i.id,R=!0);if(T||C!==t){if(x.setValue(gt,"projectionMatrix",t.projectionMatrix),q.logarithmicDepthBuffer&&x.setValue(gt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),C!==t&&(C=t,R=!0,I=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshStandardMaterial||i.envMap){const e=x.map.cameraPosition;void 0!==e&&e.setValue(gt,Q.setFromMatrixPosition(t.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial)&&x.setValue(gt,"isOrthographic",!0===t.isOrthographicCamera),(i.isMeshPhongMaterial||i.isMeshToonMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.isShadowMaterial||r.isSkinnedMesh)&&x.setValue(gt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){x.setOptional(gt,r,"bindMatrix"),x.setOptional(gt,r,"bindMatrixInverse");const t=r.skeleton;t&&(q.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),x.setValue(gt,"boneTexture",t.boneTexture,J),x.setValue(gt,"boneTextureSize",t.boneTextureSize)):x.setOptional(gt,t,"boneMatrices"))}const k=n.morphAttributes;(void 0!==k.position||void 0!==k.normal||void 0!==k.color&&!0===q.isWebGL2)&&ht.update(r,n,i,w);(R||y.receiveShadow!==r.receiveShadow)&&(y.receiveShadow=r.receiveShadow,x.setValue(gt,"receiveShadow",r.receiveShadow));R&&(x.setValue(gt,"toneMappingExposure",f.toneMappingExposure),y.needsLights&&(P=I,(N=O).ambientLightColor.needsUpdate=P,N.lightProbe.needsUpdate=P,N.directionalLights.needsUpdate=P,N.directionalLightShadows.needsUpdate=P,N.pointLights.needsUpdate=P,N.pointLightShadows.needsUpdate=P,N.spotLights.needsUpdate=P,N.spotLightShadows.needsUpdate=P,N.rectAreaLights.needsUpdate=P,N.hemisphereLights.needsUpdate=P),s&&i.fog&&st.refreshFogUniforms(O,s),st.refreshMaterialUniforms(O,i,M,L,V),cs.upload(gt,y.uniformsList,O,J));var N,P;i.isShaderMaterial&&!0===i.uniformsNeedUpdate&&(cs.upload(gt,y.uniformsList,O,J),i.uniformsNeedUpdate=!1);i.isSpriteMaterial&&x.setValue(gt,"center",r.center);return x.setValue(gt,"modelViewMatrix",r.modelViewMatrix),x.setValue(gt,"normalMatrix",r.normalMatrix),x.setValue(gt,"modelMatrix",r.matrixWorld),w}(t,e,n,i,r);Y.setMaterial(i,o);let c=n.index;const l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;let u,d=1;!0===i.wireframe&&(c=nt.getWireframeAttribute(n),d=2),mt.setup(r,i,a,n,c);let A=At;null!==c&&(u=et.get(c),A=pt,A.setIndex(u));const p=null!==c?c.count:l.count,m=n.drawRange.start*d,g=n.drawRange.count*d,v=null!==s?s.start*d:0,y=null!==s?s.count*d:1/0,_=Math.max(m,v),E=Math.min(p,m+g,v+y)-1,w=Math.max(0,E-_+1);if(0!==w){if(r.isMesh)!0===i.wireframe?(Y.setLineWidth(i.wireframeLinewidth*W()),A.setMode(1)):A.setMode(4);else if(r.isLine){let t=i.linewidth;void 0===t&&(t=1),Y.setLineWidth(t*W()),r.isLineSegments?A.setMode(1):r.isLineLoop?A.setMode(2):A.setMode(3)}else r.isPoints?A.setMode(0):r.isSprite&&A.setMode(4);if(r.isInstancedMesh)A.renderInstances(_,w,r.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);A.renderInstances(_,w,t)}else A.render(_,w)}},this.compile=function(t,e){h=ct.get(t),h.init(),p.push(h),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(h.pushLight(t),t.castShadow&&h.pushShadow(t))})),h.setupLights(f.physicallyCorrectLights),t.traverse((function(e){const n=e.material;if(n)if(Array.isArray(n))for(let i=0;i<n.length;i++){Pt(n[i],t,e)}else Pt(n,t,e)})),p.pop(),h=null};let St=null;function Ct(){xt.stop()}function It(){xt.start()}const xt=new Ei;function Ot(t,e,n,i){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)n=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)h.pushLight(t),t.castShadow&&h.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||U.intersectsSprite(t)){i&&Q.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=it.update(t),r=t.material;r.visible&&d.push(t,e,r,n,Q.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==$.render.frame&&(t.skeleton.update(),t.skeleton.frame=$.render.frame),!t.frustumCulled||U.intersectsObject(t))){i&&Q.setFromMatrixPosition(t.matrixWorld).applyMatrix4(j);const e=it.update(t),r=t.material;if(Array.isArray(r)){const i=e.groups;for(let s=0,o=i.length;s<o;s++){const o=i[s],a=r[o.materialIndex];a&&a.visible&&d.push(t,e,a,n,Q.z,o)}}else r.visible&&d.push(t,e,r,n,Q.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)Ot(r[t],e,n,i)}function Lt(t,e,n,i){const r=t.opaque,o=t.transmissive,a=t.transparent;h.setupLightsView(n),o.length>0&&function(t,e,n){const i=q.isWebGL2;null===V&&(V=new Kt(1,1,{generateMipmaps:!0,type:null!==ft.convert(w)?w:y,minFilter:v,samples:i&&!0===s?4:0}));f.getDrawingBufferSize(G),i?V.setSize(G.x,G.y):V.setSize(Tt(G.x),Tt(G.y));const r=f.getRenderTarget();f.setRenderTarget(V),f.clear();const o=f.toneMapping;f.toneMapping=0,kt(t,e,n),f.toneMapping=o,J.updateMultisampleRenderTarget(V),J.updateRenderTargetMipmap(V),f.setRenderTarget(r)}(r,e,n),i&&Y.viewport(R.copy(i)),r.length>0&&kt(r,e,n),o.length>0&&kt(o,e,n),a.length>0&&kt(a,e,n),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function kt(t,e,n){const i=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],o=s.object,a=s.geometry,c=null===i?s.material:i,l=s.group;o.layers.test(n.layers)&&Nt(o,e,n,a,c,l)}}function Nt(t,e,n,i,r,s){t.onBeforeRender(f,e,n,i,r,s),t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(f,e,n,i,t,s),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,f.renderBufferDirect(n,e,i,r,t,s),r.side=0,r.needsUpdate=!0,f.renderBufferDirect(n,e,i,r,t,s),r.side=2):f.renderBufferDirect(n,e,i,r,t,s),t.onAfterRender(f,e,n,i,r,s)}function Pt(t,e,n){!0!==e.isScene&&(e=z);const i=X.get(t),r=h.state.lights,s=h.state.shadowsArray,o=r.state.version,a=rt.getParameters(t,r.state,s,e,n),c=rt.getProgramCacheKey(a);let l=i.programs;i.environment=t.isMeshStandardMaterial?e.environment:null,i.fog=e.fog,i.envMap=(t.isMeshStandardMaterial?tt:Z).get(t.envMap||i.environment),void 0===l&&(t.addEventListener("dispose",wt),l=new Map,i.programs=l);let u=l.get(c);if(void 0!==u){if(i.currentProgram===u&&i.lightsStateVersion===o)return Dt(t,a),u}else a.uniforms=rt.getUniforms(t),t.onBuild(n,a,f),t.onBeforeCompile(a,f),u=rt.acquireProgram(a,c),l.set(c,u),i.uniforms=a.uniforms;const d=i.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(d.clippingPlanes=lt.uniform),Dt(t,a),i.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),i.lightsStateVersion=o,i.needsLights&&(d.ambientLightColor.value=r.state.ambient,d.lightProbe.value=r.state.probe,d.directionalLights.value=r.state.directional,d.directionalLightShadows.value=r.state.directionalShadow,d.spotLights.value=r.state.spot,d.spotLightShadows.value=r.state.spotShadow,d.rectAreaLights.value=r.state.rectArea,d.ltc_1.value=r.state.rectAreaLTC1,d.ltc_2.value=r.state.rectAreaLTC2,d.pointLights.value=r.state.point,d.pointLightShadows.value=r.state.pointShadow,d.hemisphereLights.value=r.state.hemi,d.directionalShadowMap.value=r.state.directionalShadowMap,d.directionalShadowMatrix.value=r.state.directionalShadowMatrix,d.spotShadowMap.value=r.state.spotShadowMap,d.spotShadowMatrix.value=r.state.spotShadowMatrix,d.pointShadowMap.value=r.state.pointShadowMap,d.pointShadowMatrix.value=r.state.pointShadowMatrix);const A=u.getUniforms(),p=cs.seqWithValue(A.seq,d);return i.currentProgram=u,i.uniformsList=p,u}function Dt(t,e){const n=X.get(t);n.outputEncoding=e.outputEncoding,n.instancing=e.instancing,n.skinning=e.skinning,n.morphTargets=e.morphTargets,n.morphNormals=e.morphNormals,n.morphColors=e.morphColors,n.morphTargetsCount=e.morphTargetsCount,n.numClippingPlanes=e.numClippingPlanes,n.numIntersection=e.numClipIntersection,n.vertexAlphas=e.vertexAlphas,n.vertexTangents=e.vertexTangents,n.toneMapping=e.toneMapping}xt.setAnimationLoop((function(t){St&&St(t)})),"undefined"!=typeof window&&xt.setContext(window),this.setAnimationLoop=function(t){St=t,_t.setAnimationLoop(t),null===t?xt.stop():xt.start()},_t.addEventListener("sessionstart",Ct),_t.addEventListener("sessionend",It),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===m)return;!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===_t.enabled&&!0===_t.isPresenting&&(!0===_t.cameraAutoUpdate&&_t.updateCamera(e),e=_t.getCamera()),!0===t.isScene&&t.onBeforeRender(f,t,e,b),h=ct.get(t,p.length),h.init(),p.push(h),j.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),U.setFromProjectionMatrix(j),H=this.localClippingEnabled,F=lt.init(this.clippingPlanes,H,e),d=ot.get(t,A.length),d.init(),A.push(d),Ot(t,e,0,f.sortObjects),d.finish(),!0===f.sortObjects&&d.sort(k,N),!0===F&&lt.beginShadows();const n=h.state.shadowsArray;if(ut.render(n,t,e),!0===F&&lt.endShadows(),!0===this.info.autoReset&&this.info.reset(),dt.render(d,t),h.setupLights(f.physicallyCorrectLights),e.isArrayCamera){const n=e.cameras;for(let e=0,i=n.length;e<i;e++){const i=n[e];Lt(d,t,i,i.viewport)}}else Lt(d,t,e);null!==b&&(J.updateMultisampleRenderTarget(b),J.updateRenderTargetMipmap(b)),!0===t.isScene&&t.onAfterRender(f,t,e),mt.resetDefaultState(),S=-1,C=null,p.pop(),h=p.length>0?p[p.length-1]:null,A.pop(),d=A.length>0?A[A.length-1]:null},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(t,e,n){X.get(t.texture).__webglTexture=e,X.get(t.depthTexture).__webglTexture=n;const i=X.get(t);i.__hasExternalTextures=!0,i.__hasExternalTextures&&(i.__autoAllocateDepthBuffer=void 0===n,i.__autoAllocateDepthBuffer||!0===K.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),i.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const n=X.get(t);n.__webglFramebuffer=e,n.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,n=0){b=t,g=e,_=n;let i=!0;if(t){const e=X.get(t);void 0!==e.__useDefaultFramebuffer?(Y.bindFramebuffer(36160,null),i=!1):void 0===e.__webglFramebuffer?J.setupRenderTarget(t):e.__hasExternalTextures&&J.rebindTextures(t,X.get(t.texture).__webglTexture,X.get(t.depthTexture).__webglTexture)}let r=null,s=!1,o=!1;if(t){const n=t.texture;(n.isData3DTexture||n.isDataArrayTexture)&&(o=!0);const i=X.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=i[e],s=!0):r=q.isWebGL2&&t.samples>0&&!1===J.useMultisampledRTT(t)?X.get(t).__webglMultisampledFramebuffer:i,R.copy(t.viewport),I.copy(t.scissor),x=t.scissorTest}else R.copy(P).multiplyScalar(M).floor(),I.copy(D).multiplyScalar(M).floor(),x=B;if(Y.bindFramebuffer(36160,r)&&q.drawBuffers&&i&&Y.drawBuffers(t,r),Y.viewport(R),Y.scissor(I),Y.setScissorTest(x),s){const i=X.get(t.texture);gt.framebufferTexture2D(36160,36064,34069+e,i.__webglTexture,n)}else if(o){const i=X.get(t.texture),r=e||0;gt.framebufferTextureLayer(36160,36064,i.__webglTexture,n||0,r)}S=-1},this.readRenderTargetPixels=function(t,e,n,i,r,s,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=X.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){Y.bindFramebuffer(36160,a);try{const o=t.texture,a=o.format,c=o.type;if(a!==T&&ft.convert(a)!==gt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const l=c===w&&(K.has("EXT_color_buffer_half_float")||q.isWebGL2&&K.has("EXT_color_buffer_float"));if(!(c===y||ft.convert(c)===gt.getParameter(35738)||c===E&&(q.isWebGL2||K.has("OES_texture_float")||K.has("WEBGL_color_buffer_float"))||l))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===gt.checkFramebufferStatus(36160)?e>=0&&e<=t.width-i&&n>=0&&n<=t.height-r&&gt.readPixels(e,n,i,r,ft.convert(a),ft.convert(c),s):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const t=null!==b?X.get(b).__webglFramebuffer:null;Y.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,n=0){if(!0!==e.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const i=Math.pow(2,-n),r=Math.floor(e.image.width*i),s=Math.floor(e.image.height*i);J.setTexture2D(e,0),gt.copyTexSubImage2D(3553,n,0,0,t.x,t.y,r,s),Y.unbindTexture()},this.copyTextureToTexture=function(t,e,n,i=0){const r=e.image.width,s=e.image.height,o=ft.convert(n.format),a=ft.convert(n.type);J.setTexture2D(n,0),gt.pixelStorei(37440,n.flipY),gt.pixelStorei(37441,n.premultiplyAlpha),gt.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?gt.texSubImage2D(3553,i,t.x,t.y,r,s,o,a,e.image.data):e.isCompressedTexture?gt.compressedTexSubImage2D(3553,i,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):gt.texSubImage2D(3553,i,t.x,t.y,o,a,e.image),0===i&&n.generateMipmaps&&gt.generateMipmap(3553),Y.unbindTexture()},this.copyTextureToTexture3D=function(t,e,n,i,r=0){if(f.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,o=t.max.y-t.min.y+1,a=t.max.z-t.min.z+1,c=ft.convert(i.format),l=ft.convert(i.type);let u;if(i.isData3DTexture)J.setTexture3D(i,0),u=32879;else{if(!i.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(i,0),u=35866}gt.pixelStorei(37440,i.flipY),gt.pixelStorei(37441,i.premultiplyAlpha),gt.pixelStorei(3317,i.unpackAlignment);const d=gt.getParameter(3314),h=gt.getParameter(32878),A=gt.getParameter(3316),p=gt.getParameter(3315),m=gt.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;gt.pixelStorei(3314,g.width),gt.pixelStorei(32878,g.height),gt.pixelStorei(3316,t.min.x),gt.pixelStorei(3315,t.min.y),gt.pixelStorei(32877,t.min.z),n.isDataTexture||n.isData3DTexture?gt.texSubImage3D(u,r,e.x,e.y,e.z,s,o,a,c,l,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),gt.compressedTexSubImage3D(u,r,e.x,e.y,e.z,s,o,a,c,g.data)):gt.texSubImage3D(u,r,e.x,e.y,e.z,s,o,a,c,l,g),gt.pixelStorei(3314,d),gt.pixelStorei(32878,h),gt.pixelStorei(3316,A),gt.pixelStorei(3315,p),gt.pixelStorei(32877,m),0===r&&i.generateMipmaps&&gt.generateMipmap(u),Y.unbindTexture()},this.initTexture=function(t){J.setTexture2D(t,0),Y.unbindTexture()},this.resetState=function(){g=0,_=0,b=null,Y.reset(),mt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}eo.prototype.isWebGLRenderer=!0;class no extends eo{}no.prototype.isWebGL1Renderer=!0;class io{constructor(t,e=25e-5){this.name="",this.color=new Ft(t),this.density=e}clone(){return new io(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}io.prototype.isFogExp2=!0;class ro{constructor(t,e=1,n=1e3){this.name="",this.color=new Ft(t),this.near=e,this.far=n}clone(){return new ro(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}ro.prototype.isFog=!0;class so extends nn{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.autoUpdate=t.autoUpdate,this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}}so.prototype.isScene=!0;class oo{constructor(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=yt()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=yt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(e,this.stride);return n.setUsage(this.usage),n}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=yt()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}oo.prototype.isInterleavedBuffer=!0;const ao=new te;class co{constructor(t,e,n,i=!1){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,n=this.data.count;e<n;e++)ao.x=this.getX(e),ao.y=this.getY(e),ao.z=this.getZ(e),ao.applyMatrix4(t),this.setXYZ(e,ao.x,ao.y,ao.z);return this}applyNormalMatrix(t){for(let e=0,n=this.count;e<n;e++)ao.x=this.getX(e),ao.y=this.getY(e),ao.z=this.getZ(e),ao.applyNormalMatrix(t),this.setXYZ(e,ao.x,ao.y,ao.z);return this}transformDirection(t){for(let e=0,n=this.count;e<n;e++)ao.x=this.getX(e),ao.y=this.getY(e),ao.z=this.getZ(e),ao.transformDirection(t),this.setXYZ(e,ao.x,ao.y,ao.z);return this}setX(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){return this.data.array[t*this.data.stride+this.offset]}getY(t){return this.data.array[t*this.data.stride+this.offset+1]}getZ(t){return this.data.array[t*this.data.stride+this.offset+2]}getW(t){return this.data.array[t*this.data.stride+this.offset+3]}setXY(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this}setXYZ(t,e,n,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this}setXYZW(t,e,n,i,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=i,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return new _n(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new co(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const n=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[n+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}co.prototype.isInterleavedBufferAttribute=!0;class lo extends mn{constructor(t){super(),this.type="SpriteMaterial",this.color=new Ft(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this}}let uo;lo.prototype.isSpriteMaterial=!0;const ho=new te,Ao=new te,po=new te,fo=new Rt,mo=new Rt,go=new Le,vo=new te,yo=new te,_o=new te,bo=new Rt,Eo=new Rt,wo=new Rt;class So extends nn{constructor(t){if(super(),this.type="Sprite",void 0===uo){uo=new Un;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new oo(t,5);uo.setIndex([0,1,2,0,2,3]),uo.setAttribute("position",new co(e,3,0,!1)),uo.setAttribute("uv",new co(e,2,3,!1))}this.geometry=uo,this.material=void 0!==t?t:new lo,this.center=new Rt(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ao.setFromMatrixScale(this.matrixWorld),go.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),po.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Ao.multiplyScalar(-po.z);const n=this.material.rotation;let i,r;0!==n&&(r=Math.cos(n),i=Math.sin(n));const s=this.center;To(vo.set(-.5,-.5,0),po,s,Ao,i,r),To(yo.set(.5,-.5,0),po,s,Ao,i,r),To(_o.set(.5,.5,0),po,s,Ao,i,r),bo.set(0,0),Eo.set(1,0),wo.set(1,1);let o=t.ray.intersectTriangle(vo,yo,_o,!1,ho);if(null===o&&(To(yo.set(-.5,.5,0),po,s,Ao,i,r),Eo.set(0,1),o=t.ray.intersectTriangle(vo,_o,yo,!1,ho),null===o))return;const a=t.ray.origin.distanceTo(ho);a<t.near||a>t.far||e.push({distance:a,point:ho.clone(),uv:pn.getUV(ho,vo,yo,_o,bo,Eo,wo,new Rt),face:null,object:this})}copy(t){return super.copy(t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function To(t,e,n,i,r,s){fo.subVectors(t,n).addScalar(.5).multiply(i),void 0!==r?(mo.x=s*fo.x-r*fo.y,mo.y=r*fo.x+s*fo.y):mo.copy(fo),t.copy(e),t.x+=mo.x,t.y+=mo.y,t.applyMatrix4(go)}So.prototype.isSprite=!0;const Co=new te,Ro=new te;class Io extends nn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,n=e.length;t<n;t++){const n=e[t];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const n=this.levels;let i;for(i=0;i<n.length&&!(e<n[i].distance);i++);return n.splice(i,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let n,i;for(n=1,i=e.length;n<i&&!(t<e[n].distance);n++);return e[n-1].object}return null}raycast(t,e){if(this.levels.length>0){Co.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(Co);this.getObjectForDistance(n).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){Co.setFromMatrixPosition(t.matrixWorld),Ro.setFromMatrixPosition(this.matrixWorld);const n=Co.distanceTo(Ro)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r&&n>=e[i].distance;i++)e[i-1].object.visible=!1,e[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const n=this.levels;for(let t=0,i=n.length;t<i;t++){const i=n[t];e.object.levels.push({object:i.object.uuid,distance:i.distance})}return e}}const xo=new te,Oo=new Wt,Lo=new Wt,Mo=new te,ko=new Le;class No extends ni{constructor(t,e){super(t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Le,this.bindMatrixInverse=new Le}copy(t){return super.copy(t),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Wt,e=this.geometry.attributes.skinWeight;for(let n=0,i=e.count;n<i;n++){t.x=e.getX(n),t.y=e.getY(n),t.z=e.getZ(n),t.w=e.getW(n);const i=1/t.manhattanLength();i!==1/0?t.multiplyScalar(i):t.set(1,0,0,0),e.setXYZW(n,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const n=this.skeleton,i=this.geometry;Oo.fromBufferAttribute(i.attributes.skinIndex,t),Lo.fromBufferAttribute(i.attributes.skinWeight,t),xo.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const i=Lo.getComponent(t);if(0!==i){const r=Oo.getComponent(t);ko.multiplyMatrices(n.bones[r].matrixWorld,n.boneInverses[r]),e.addScaledVector(Mo.copy(xo).applyMatrix4(ko),i)}}return e.applyMatrix4(this.bindMatrixInverse)}}No.prototype.isSkinnedMesh=!0;class Po extends nn{constructor(){super(),this.type="Bone"}}Po.prototype.isBone=!0;class Do extends zt{constructor(t=null,e=1,n=1,i,r,s,o,a,c=1003,l=1003,u,d){super(null,s,o,a,c,l,i,r,u,d),this.image={data:t,width:e,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Do.prototype.isDataTexture=!0;const Bo=new Le,Uo=new Le;class Fo{constructor(t=[],e=[]){this.uuid=yt(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Le)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Le;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let i=0,r=t.length;i<r;i++){const r=t[i]?t[i].matrixWorld:Uo;Bo.multiplyMatrices(r,e[i]),Bo.toArray(n,16*i)}null!==i&&(i.needsUpdate=!0)}clone(){return new Fo(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=St(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const n=new Do(e,t,t,T,E);return n.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=n,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,n=this.bones.length;e<n;e++){const n=this.bones[e];if(n.name===t)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let n=0,i=t.bones.length;n<i;n++){const i=t.bones[n];let r=e[i];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),r=new Po),this.bones.push(r),this.boneInverses.push((new Le).fromArray(t.boneInverses[n]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,n=this.boneInverses;for(let i=0,r=e.length;i<r;i++){const r=e[i];t.bones.push(r.uuid);const s=n[i];t.boneInverses.push(s.toArray())}return t}}class Ho extends _n{constructor(t,e,n,i=1){"number"==typeof n&&(i=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(t,e,n),this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}Ho.prototype.isInstancedBufferAttribute=!0;const Vo=new Le,jo=new Le,Go=[],Qo=new ni;class zo extends ni{constructor(t,e,n){super(t,e),this.instanceMatrix=new Ho(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(t){return super.copy(t),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const n=this.matrixWorld,i=this.count;if(Qo.geometry=this.geometry,Qo.material=this.material,void 0!==Qo.material)for(let r=0;r<i;r++){this.getMatrixAt(r,Vo),jo.multiplyMatrices(n,Vo),Qo.matrixWorld=jo,Qo.raycast(t,Go);for(let t=0,n=Go.length;t<n;t++){const n=Go[t];n.instanceId=r,n.object=this,e.push(n)}Go.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Ho(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}zo.prototype.isInstancedMesh=!0;class Wo extends mn{constructor(t){super(),this.type="LineBasicMaterial",this.color=new Ft(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this}}Wo.prototype.isLineBasicMaterial=!0;const Ko=new te,qo=new te,Yo=new Le,$o=new Oe,Xo=new Ee;class Jo extends nn{constructor(t=new Un,e=new Wo){super(),this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let t=1,i=e.count;t<i;t++)Ko.fromBufferAttribute(e,t-1),qo.fromBufferAttribute(e,t),n[t]=n[t-1],n[t]+=Ko.distanceTo(qo);t.setAttribute("lineDistance",new xn(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Line.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Xo.copy(n.boundingSphere),Xo.applyMatrix4(i),Xo.radius+=r,!1===t.ray.intersectsSphere(Xo))return;Yo.copy(i).invert(),$o.copy(t.ray).applyMatrix4(Yo);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,c=new te,l=new te,u=new te,d=new te,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const i=n.index,r=n.attributes.position;if(null!==i){for(let n=Math.max(0,s.start),o=Math.min(i.count,s.start+s.count)-1;n<o;n+=h){const s=i.getX(n),o=i.getX(n+1);c.fromBufferAttribute(r,s),l.fromBufferAttribute(r,o);if($o.distanceSqToSegment(c,l,d,u)>a)continue;d.applyMatrix4(this.matrixWorld);const h=t.ray.origin.distanceTo(d);h<t.near||h>t.far||e.push({distance:h,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,s.start),i=Math.min(r.count,s.start+s.count)-1;n<i;n+=h){c.fromBufferAttribute(r,n),l.fromBufferAttribute(r,n+1);if($o.distanceSqToSegment(c,l,d,u)>a)continue;d.applyMatrix4(this.matrixWorld);const i=t.ray.origin.distanceTo(d);i<t.near||i>t.far||e.push({distance:i,point:u.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Jo.prototype.isLine=!0;const Zo=new te,ta=new te;class ea extends Jo{constructor(t,e){super(t,e),this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let t=0,i=e.count;t<i;t+=2)Zo.fromBufferAttribute(e,t),ta.fromBufferAttribute(e,t+1),n[t]=0===t?0:n[t-1],n[t+1]=n[t]+Zo.distanceTo(ta);t.setAttribute("lineDistance",new xn(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else t.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}ea.prototype.isLineSegments=!0;class na extends Jo{constructor(t,e){super(t,e),this.type="LineLoop"}}na.prototype.isLineLoop=!0;class ia extends mn{constructor(t){super(),this.type="PointsMaterial",this.color=new Ft(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this}}ia.prototype.isPointsMaterial=!0;const ra=new Le,sa=new Oe,oa=new Ee,aa=new te;class ca extends nn{constructor(t=new Un,e=new ia){super(),this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t){return super.copy(t),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const n=this.geometry,i=this.matrixWorld,r=t.params.Points.threshold,s=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),oa.copy(n.boundingSphere),oa.applyMatrix4(i),oa.radius+=r,!1===t.ray.intersectsSphere(oa))return;ra.copy(i).invert(),sa.copy(t.ray).applyMatrix4(ra);const o=r/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position;if(null!==r){for(let n=Math.max(0,s.start),c=Math.min(r.count,s.start+s.count);n<c;n++){const s=r.getX(n);aa.fromBufferAttribute(o,s),la(aa,s,a,i,t,e,this)}}else{for(let n=Math.max(0,s.start),r=Math.min(o.count,s.start+s.count);n<r;n++)aa.fromBufferAttribute(o,n),la(aa,n,a,i,t,e,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function la(t,e,n,i,r,s,o){const a=sa.distanceSqToPoint(t);if(a<n){const n=new te;sa.closestPointToPoint(t,n),n.applyMatrix4(i);const c=r.ray.origin.distanceTo(n);if(c<r.near||c>r.far)return;s.push({distance:c,distanceToRay:Math.sqrt(a),point:n,index:e,face:null,object:o})}}ca.prototype.isPoints=!0;class ua extends zt{constructor(t,e,n,i,r,s,o,a,c){super(t,e,n,i,r,s,o,a,c),this.minFilter=void 0!==s?s:m,this.magFilter=void 0!==r?r:m,this.generateMipmaps=!1;const l=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){l.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}ua.prototype.isVideoTexture=!0;class da extends zt{constructor(t,e,n){super({width:t,height:e}),this.format=n,this.magFilter=A,this.minFilter=A,this.generateMipmaps=!1,this.needsUpdate=!0}}da.prototype.isFramebufferTexture=!0;class ha extends zt{constructor(t,e,n,i,r,s,o,a,c,l,u,d){super(null,s,o,a,c,l,i,r,u,d),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}ha.prototype.isCompressedTexture=!0;class Aa extends zt{constructor(t,e,n,i,r,s,o,a,c){super(t,e,n,i,r,s,o,a,c),this.needsUpdate=!0}}Aa.prototype.isCanvasTexture=!0;class pa extends Un{constructor(t=1,e=8,n=0,i=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:i},e=Math.max(3,e);const r=[],s=[],o=[],a=[],c=new te,l=new Rt;s.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let r=0,u=3;r<=e;r++,u+=3){const d=n+r/e*i;c.x=t*Math.cos(d),c.y=t*Math.sin(d),s.push(c.x,c.y,c.z),o.push(0,0,1),l.x=(s[u]/t+1)/2,l.y=(s[u+1]/t+1)/2,a.push(l.x,l.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new xn(s,3)),this.setAttribute("normal",new xn(o,3)),this.setAttribute("uv",new xn(a,2))}static fromJSON(t){return new pa(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class fa extends Un{constructor(t=1,e=1,n=1,i=8,r=1,s=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:i,heightSegments:r,openEnded:s,thetaStart:o,thetaLength:a};const c=this;i=Math.floor(i),r=Math.floor(r);const l=[],u=[],d=[],h=[];let A=0;const p=[],f=n/2;let m=0;function g(n){const r=A,s=new Rt,p=new te;let g=0;const v=!0===n?t:e,y=!0===n?1:-1;for(let t=1;t<=i;t++)u.push(0,f*y,0),d.push(0,y,0),h.push(.5,.5),A++;const _=A;for(let t=0;t<=i;t++){const e=t/i*a+o,n=Math.cos(e),r=Math.sin(e);p.x=v*r,p.y=f*y,p.z=v*n,u.push(p.x,p.y,p.z),d.push(0,y,0),s.x=.5*n+.5,s.y=.5*r*y+.5,h.push(s.x,s.y),A++}for(let t=0;t<i;t++){const e=r+t,i=_+t;!0===n?l.push(i,i+1,e):l.push(i+1,i,e),g+=3}c.addGroup(m,g,!0===n?1:2),m+=g}!function(){const s=new te,g=new te;let v=0;const y=(e-t)/n;for(let c=0;c<=r;c++){const l=[],m=c/r,v=m*(e-t)+t;for(let t=0;t<=i;t++){const e=t/i,r=e*a+o,c=Math.sin(r),p=Math.cos(r);g.x=v*c,g.y=-m*n+f,g.z=v*p,u.push(g.x,g.y,g.z),s.set(c,y,p).normalize(),d.push(s.x,s.y,s.z),h.push(e,1-m),l.push(A++)}p.push(l)}for(let t=0;t<i;t++)for(let e=0;e<r;e++){const n=p[e][t],i=p[e+1][t],r=p[e+1][t+1],s=p[e][t+1];l.push(n,i,s),l.push(i,r,s),v+=6}c.addGroup(m,v,0),m+=v}(),!1===s&&(t>0&&g(!0),e>0&&g(!1)),this.setIndex(l),this.setAttribute("position",new xn(u,3)),this.setAttribute("normal",new xn(d,3)),this.setAttribute("uv",new xn(h,2))}static fromJSON(t){return new fa(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ma extends fa{constructor(t=1,e=1,n=8,i=1,r=!1,s=0,o=2*Math.PI){super(0,t,e,n,i,r,s,o),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:s,thetaLength:o}}static fromJSON(t){return new ma(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class ga extends Un{constructor(t=[],e=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:i};const r=[],s=[];function o(t,e,n,i){const r=i+1,s=[];for(let i=0;i<=r;i++){s[i]=[];const o=t.clone().lerp(n,i/r),a=e.clone().lerp(n,i/r),c=r-i;for(let t=0;t<=c;t++)s[i][t]=0===t&&i===r?o:o.clone().lerp(a,t/c)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const n=Math.floor(e/2);e%2==0?(a(s[t][n+1]),a(s[t+1][n]),a(s[t][n])):(a(s[t][n+1]),a(s[t+1][n+1]),a(s[t+1][n]))}}function a(t){r.push(t.x,t.y,t.z)}function c(e,n){const i=3*e;n.x=t[i+0],n.y=t[i+1],n.z=t[i+2]}function l(t,e,n,i){i<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=i/2/Math.PI+.5)}function u(t){return Math.atan2(t.z,-t.x)}!function(t){const n=new te,i=new te,r=new te;for(let s=0;s<e.length;s+=3)c(e[s+0],n),c(e[s+1],i),c(e[s+2],r),o(n,i,r,t)}(i),function(t){const e=new te;for(let n=0;n<r.length;n+=3)e.x=r[n+0],e.y=r[n+1],e.z=r[n+2],e.normalize().multiplyScalar(t),r[n+0]=e.x,r[n+1]=e.y,r[n+2]=e.z}(n),function(){const t=new te;for(let n=0;n<r.length;n+=3){t.x=r[n+0],t.y=r[n+1],t.z=r[n+2];const i=u(t)/2/Math.PI+.5,o=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(i,1-o)}var e;(function(){const t=new te,e=new te,n=new te,i=new te,o=new Rt,a=new Rt,c=new Rt;for(let d=0,h=0;d<r.length;d+=9,h+=6){t.set(r[d+0],r[d+1],r[d+2]),e.set(r[d+3],r[d+4],r[d+5]),n.set(r[d+6],r[d+7],r[d+8]),o.set(s[h+0],s[h+1]),a.set(s[h+2],s[h+3]),c.set(s[h+4],s[h+5]),i.copy(t).add(e).add(n).divideScalar(3);const A=u(i);l(o,h+0,t,A),l(a,h+2,e,A),l(c,h+4,n,A)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],n=s[t+2],i=s[t+4],r=Math.max(e,n,i),o=Math.min(e,n,i);r>.9&&o<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),i<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new xn(r,3)),this.setAttribute("normal",new xn(r.slice(),3)),this.setAttribute("uv",new xn(s,2)),0===i?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new ga(t.vertices,t.indices,t.radius,t.details)}}class va extends ga{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2,i=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new va(t.radius,t.detail)}}const ya=new te,_a=new te,ba=new te,Ea=new pn;class wa extends Un{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const n=4,i=Math.pow(10,n),r=Math.cos(gt*e),s=t.getIndex(),o=t.getAttribute("position"),a=s?s.count:o.count,c=[0,0,0],l=["a","b","c"],u=new Array(3),d={},h=[];for(let t=0;t<a;t+=3){s?(c[0]=s.getX(t),c[1]=s.getX(t+1),c[2]=s.getX(t+2)):(c[0]=t,c[1]=t+1,c[2]=t+2);const{a:e,b:n,c:a}=Ea;if(e.fromBufferAttribute(o,c[0]),n.fromBufferAttribute(o,c[1]),a.fromBufferAttribute(o,c[2]),Ea.getNormal(ba),u[0]=`${Math.round(e.x*i)},${Math.round(e.y*i)},${Math.round(e.z*i)}`,u[1]=`${Math.round(n.x*i)},${Math.round(n.y*i)},${Math.round(n.z*i)}`,u[2]=`${Math.round(a.x*i)},${Math.round(a.y*i)},${Math.round(a.z*i)}`,u[0]!==u[1]&&u[1]!==u[2]&&u[2]!==u[0])for(let t=0;t<3;t++){const e=(t+1)%3,n=u[t],i=u[e],s=Ea[l[t]],o=Ea[l[e]],a=`${n}_${i}`,A=`${i}_${n}`;A in d&&d[A]?(ba.dot(d[A].normal)<=r&&(h.push(s.x,s.y,s.z),h.push(o.x,o.y,o.z)),d[A]=null):a in d||(d[a]={index0:c[t],index1:c[e],normal:ba.clone()})}}for(const t in d)if(d[t]){const{index0:e,index1:n}=d[t];ya.fromBufferAttribute(o,e),_a.fromBufferAttribute(o,n),h.push(ya.x,ya.y,ya.z),h.push(_a.x,_a.y,_a.z)}this.setAttribute("position",new xn(h,3))}}}class Sa{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const n=this.getUtoTmapping(t);return this.getPoint(n,e)}getPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e}getSpacedPoints(t=5){const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,i=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)n=this.getPoint(s/t),r+=n.distanceTo(i),e.push(r),i=n;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const n=this.getLengths();let i=0;const r=n.length;let s;s=e||t*n[r-1];let o,a=0,c=r-1;for(;a<=c;)if(i=Math.floor(a+(c-a)/2),o=n[i]-s,o<0)a=i+1;else{if(!(o>0)){c=i;break}c=i-1}if(i=c,n[i]===s)return i/(r-1);const l=n[i];return(i+(s-l)/(n[i+1]-l))/(r-1)}getTangent(t,e){const n=1e-4;let i=t-n,r=t+n;i<0&&(i=0),r>1&&(r=1);const s=this.getPoint(i),o=this.getPoint(r),a=e||(s.isVector2?new Rt:new te);return a.copy(o).sub(s).normalize(),a}getTangentAt(t,e){const n=this.getUtoTmapping(t);return this.getTangent(n,e)}computeFrenetFrames(t,e){const n=new te,i=[],r=[],s=[],o=new te,a=new Le;for(let e=0;e<=t;e++){const n=e/t;i[e]=this.getTangentAt(n,new te)}r[0]=new te,s[0]=new te;let c=Number.MAX_VALUE;const l=Math.abs(i[0].x),u=Math.abs(i[0].y),d=Math.abs(i[0].z);l<=c&&(c=l,n.set(1,0,0)),u<=c&&(c=u,n.set(0,1,0)),d<=c&&n.set(0,0,1),o.crossVectors(i[0],n).normalize(),r[0].crossVectors(i[0],o),s[0].crossVectors(i[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),o.crossVectors(i[e-1],i[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(_t(i[e-1].dot(i[e]),-1,1));r[e].applyMatrix4(a.makeRotationAxis(o,t))}s[e].crossVectors(i[e],r[e])}if(!0===e){let e=Math.acos(_t(r[0].dot(r[t]),-1,1));e/=t,i[0].dot(o.crossVectors(r[0],r[t]))>0&&(e=-e);for(let n=1;n<=t;n++)r[n].applyMatrix4(a.makeRotationAxis(i[n],e*n)),s[n].crossVectors(i[n],r[n])}return{tangents:i,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Ta extends Sa{constructor(t=0,e=0,n=1,i=1,r=0,s=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=o,this.aRotation=a}getPoint(t,e){const n=e||new Rt,i=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=i;for(;r>i;)r-=i;r<Number.EPSILON&&(r=s?0:i),!0!==this.aClockwise||s||(r===i?r=-i:r-=i);const o=this.aStartAngle+t*r;let a=this.aX+this.xRadius*Math.cos(o),c=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=a-this.aX,i=c-this.aY;a=n*t-i*e+this.aX,c=n*e+i*t+this.aY}return n.set(a,c)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}Ta.prototype.isEllipseCurve=!0;class Ca extends Ta{constructor(t,e,n,i,r,s){super(t,e,n,n,i,r,s),this.type="ArcCurve"}}function Ra(){let t=0,e=0,n=0,i=0;function r(r,s,o,a){t=r,e=o,n=-3*r+3*s-2*o-a,i=2*r-2*s+o+a}return{initCatmullRom:function(t,e,n,i,s){r(e,n,s*(n-t),s*(i-e))},initNonuniformCatmullRom:function(t,e,n,i,s,o,a){let c=(e-t)/s-(n-t)/(s+o)+(n-e)/o,l=(n-e)/o-(i-e)/(o+a)+(i-n)/a;c*=o,l*=o,r(e,n,c,l)},calc:function(r){const s=r*r;return t+e*r+n*s+i*(s*r)}}}Ca.prototype.isArcCurve=!0;const Ia=new te,xa=new Ra,Oa=new Ra,La=new Ra;class Ma extends Sa{constructor(t=[],e=!1,n="centripetal",i=.5){super(),this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=n,this.tension=i}getPoint(t,e=new te){const n=e,i=this.points,r=i.length,s=(r-(this.closed?0:1))*t;let o,a,c=Math.floor(s),l=s-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/r)+1)*r:0===l&&c===r-1&&(c=r-2,l=1),this.closed||c>0?o=i[(c-1)%r]:(Ia.subVectors(i[0],i[1]).add(i[0]),o=Ia);const u=i[c%r],d=i[(c+1)%r];if(this.closed||c+2<r?a=i[(c+2)%r]:(Ia.subVectors(i[r-1],i[r-2]).add(i[r-1]),a=Ia),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(d),t),i=Math.pow(d.distanceToSquared(a),t);n<1e-4&&(n=1),e<1e-4&&(e=n),i<1e-4&&(i=n),xa.initNonuniformCatmullRom(o.x,u.x,d.x,a.x,e,n,i),Oa.initNonuniformCatmullRom(o.y,u.y,d.y,a.y,e,n,i),La.initNonuniformCatmullRom(o.z,u.z,d.z,a.z,e,n,i)}else"catmullrom"===this.curveType&&(xa.initCatmullRom(o.x,u.x,d.x,a.x,this.tension),Oa.initCatmullRom(o.y,u.y,d.y,a.y,this.tension),La.initCatmullRom(o.z,u.z,d.z,a.z,this.tension));return n.set(xa.calc(l),Oa.calc(l),La.calc(l)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new te).fromArray(n))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function ka(t,e,n,i,r){const s=.5*(i-e),o=.5*(r-n),a=t*t;return(2*n-2*i+s+o)*(t*a)+(-3*n+3*i-2*s-o)*a+s*t+n}function Na(t,e,n,i){return function(t,e){const n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,i)}function Pa(t,e,n,i,r){return function(t,e){const n=1-t;return n*n*n*e}(t,e)+function(t,e){const n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,i)+function(t,e){return t*t*t*e}(t,r)}Ma.prototype.isCatmullRomCurve3=!0;class Da extends Sa{constructor(t=new Rt,e=new Rt,n=new Rt,i=new Rt){super(),this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new Rt){const n=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(Pa(t,i.x,r.x,s.x,o.x),Pa(t,i.y,r.y,s.y,o.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Da.prototype.isCubicBezierCurve=!0;class Ba extends Sa{constructor(t=new te,e=new te,n=new te,i=new te){super(),this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=i}getPoint(t,e=new te){const n=e,i=this.v0,r=this.v1,s=this.v2,o=this.v3;return n.set(Pa(t,i.x,r.x,s.x,o.x),Pa(t,i.y,r.y,s.y,o.y),Pa(t,i.z,r.z,s.z,o.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}Ba.prototype.isCubicBezierCurve3=!0;class Ua extends Sa{constructor(t=new Rt,e=new Rt){super(),this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Rt){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const n=e||new Rt;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Ua.prototype.isLineCurve=!0;class Fa extends Sa{constructor(t=new te,e=new te){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=t,this.v2=e}getPoint(t,e=new te){const n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Ha extends Sa{constructor(t=new Rt,e=new Rt,n=new Rt){super(),this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new Rt){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Na(t,i.x,r.x,s.x),Na(t,i.y,r.y,s.y)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Ha.prototype.isQuadraticBezierCurve=!0;class Va extends Sa{constructor(t=new te,e=new te,n=new te){super(),this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=n}getPoint(t,e=new te){const n=e,i=this.v0,r=this.v1,s=this.v2;return n.set(Na(t,i.x,r.x,s.x),Na(t,i.y,r.y,s.y),Na(t,i.z,r.z,s.z)),n}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}Va.prototype.isQuadraticBezierCurve3=!0;class ja extends Sa{constructor(t=[]){super(),this.type="SplineCurve",this.points=t}getPoint(t,e=new Rt){const n=e,i=this.points,r=(i.length-1)*t,s=Math.floor(r),o=r-s,a=i[0===s?s:s-1],c=i[s],l=i[s>i.length-2?i.length-1:s+1],u=i[s>i.length-3?i.length-1:s+2];return n.set(ka(o,a.x,c.x,l.x,u.x),ka(o,a.y,c.y,l.y,u.y)),n}copy(t){super.copy(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,n=this.points.length;e<n;e++){const n=this.points[e];t.points.push(n.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,n=t.points.length;e<n;e++){const n=t.points[e];this.points.push((new Rt).fromArray(n))}return this}}ja.prototype.isSplineCurve=!0;var Ga=Object.freeze({__proto__:null,ArcCurve:Ca,CatmullRomCurve3:Ma,CubicBezierCurve:Da,CubicBezierCurve3:Ba,EllipseCurve:Ta,LineCurve:Ua,LineCurve3:Fa,QuadraticBezierCurve:Ha,QuadraticBezierCurve3:Va,SplineCurve:ja});class Qa extends Sa{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new Ua(e,t))}getPoint(t,e){const n=t*this.getLength(),i=this.getCurveLengths();let r=0;for(;r<i.length;){if(i[r]>=n){const t=i[r]-n,s=this.curves[r],o=s.getLength(),a=0===o?0:1-t/o;return s.getPointAt(a,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let n=0,i=this.curves.length;n<i;n++)e+=this.curves[n].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const s=r[i],o=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,a=s.getPoints(o);for(let t=0;t<a.length;t++){const i=a[t];n&&n.equals(i)||(e.push(i),n=i)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push(n.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,n=this.curves.length;e<n;e++){const n=this.curves[e];t.curves.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,n=t.curves.length;e<n;e++){const n=t.curves[e];this.curves.push((new Ga[n.type]).fromJSON(n))}return this}}class za extends Qa{constructor(t){super(),this.type="Path",this.currentPoint=new Rt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,n=t.length;e<n;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const n=new Ua(this.currentPoint.clone(),new Rt(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,n,i){const r=new Ha(this.currentPoint.clone(),new Rt(t,e),new Rt(n,i));return this.curves.push(r),this.currentPoint.set(n,i),this}bezierCurveTo(t,e,n,i,r,s){const o=new Da(this.currentPoint.clone(),new Rt(t,e),new Rt(n,i),new Rt(r,s));return this.curves.push(o),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),n=new ja(e);return this.curves.push(n),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,n,i,r,s){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,n,i,r,s),this}absarc(t,e,n,i,r,s){return this.absellipse(t,e,n,n,i,r,s),this}ellipse(t,e,n,i,r,s,o,a){const c=this.currentPoint.x,l=this.currentPoint.y;return this.absellipse(t+c,e+l,n,i,r,s,o,a),this}absellipse(t,e,n,i,r,s,o,a){const c=new Ta(t,e,n,i,r,s,o,a);if(this.curves.length>0){const t=c.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(c);const l=c.getPoint(1);return this.currentPoint.copy(l),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Wa extends za{constructor(t){super(t),this.uuid=yt(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let n=0,i=this.holes.length;n<i;n++)e[n]=this.holes[n].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push(n.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,n=this.holes.length;e<n;e++){const n=this.holes[e];t.holes.push(n.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,n=t.holes.length;e<n;e++){const n=t.holes[e];this.holes.push((new za).fromJSON(n))}return this}}const Ka=function(t,e,n=2){const i=e&&e.length,r=i?e[0]*n:t.length;let s=qa(t,0,r,n,!0);const o=[];if(!s||s.next===s.prev)return o;let a,c,l,u,d,h,A;if(i&&(s=function(t,e,n,i){const r=[];let s,o,a,c,l;for(s=0,o=e.length;s<o;s++)a=e[s]*i,c=s<o-1?e[s+1]*i:t.length,l=qa(t,a,c,i,!1),l===l.next&&(l.steiner=!0),r.push(sc(l));for(r.sort(ec),s=0;s<r.length;s++)nc(r[s],n),n=Ya(n,n.next);return n}(t,e,s,n)),t.length>80*n){a=l=t[0],c=u=t[1];for(let e=n;e<r;e+=n)d=t[e],h=t[e+1],d<a&&(a=d),h<c&&(c=h),d>l&&(l=d),h>u&&(u=h);A=Math.max(l-a,u-c),A=0!==A?1/A:0}return $a(s,o,n,a,c,A),o};function qa(t,e,n,i,r){let s,o;if(r===function(t,e,n,i){let r=0;for(let s=e,o=n-i;s<n;s+=i)r+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return r}(t,e,n,i)>0)for(s=e;s<n;s+=i)o=fc(s,t[s],t[s+1],o);else for(s=n-i;s>=e;s-=i)o=fc(s,t[s],t[s+1],o);return o&&lc(o,o.next)&&(mc(o),o=o.next),o}function Ya(t,e){if(!t)return t;e||(e=t);let n,i=t;do{if(n=!1,i.steiner||!lc(i,i.next)&&0!==cc(i.prev,i,i.next))i=i.next;else{if(mc(i),i=e=i.prev,i===i.next)break;n=!0}}while(n||i!==e);return e}function $a(t,e,n,i,r,s,o){if(!t)return;!o&&s&&function(t,e,n,i){let r=t;do{null===r.z&&(r.z=rc(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,i,r,s,o,a,c,l=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,i=n,a=0,e=0;e<l&&(a++,i=i.nextZ,i);e++);for(c=l;a>0||c>0&&i;)0!==a&&(0===c||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,c--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;n=i}s.nextZ=null,l*=2}while(o>1)}(r)}(t,i,r,s);let a,c,l=t;for(;t.prev!==t.next;)if(a=t.prev,c=t.next,s?Ja(t,i,r,s):Xa(t))e.push(a.i/n),e.push(t.i/n),e.push(c.i/n),mc(t),t=c.next,l=c.next;else if((t=c)===l){o?1===o?$a(t=Za(Ya(t),e,n),e,n,i,r,s,2):2===o&&tc(t,e,n,i,r,s):$a(Ya(t),e,n,i,r,s,1);break}}function Xa(t){const e=t.prev,n=t,i=t.next;if(cc(e,n,i)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(oc(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&cc(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Ja(t,e,n,i){const r=t.prev,s=t,o=t.next;if(cc(r,s,o)>=0)return!1;const a=r.x<s.x?r.x<o.x?r.x:o.x:s.x<o.x?s.x:o.x,c=r.y<s.y?r.y<o.y?r.y:o.y:s.y<o.y?s.y:o.y,l=r.x>s.x?r.x>o.x?r.x:o.x:s.x>o.x?s.x:o.x,u=r.y>s.y?r.y>o.y?r.y:o.y:s.y>o.y?s.y:o.y,d=rc(a,c,e,n,i),h=rc(l,u,e,n,i);let A=t.prevZ,p=t.nextZ;for(;A&&A.z>=d&&p&&p.z<=h;){if(A!==t.prev&&A!==t.next&&oc(r.x,r.y,s.x,s.y,o.x,o.y,A.x,A.y)&&cc(A.prev,A,A.next)>=0)return!1;if(A=A.prevZ,p!==t.prev&&p!==t.next&&oc(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&cc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;A&&A.z>=d;){if(A!==t.prev&&A!==t.next&&oc(r.x,r.y,s.x,s.y,o.x,o.y,A.x,A.y)&&cc(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;p&&p.z<=h;){if(p!==t.prev&&p!==t.next&&oc(r.x,r.y,s.x,s.y,o.x,o.y,p.x,p.y)&&cc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Za(t,e,n){let i=t;do{const r=i.prev,s=i.next.next;!lc(r,s)&&uc(r,i,i.next,s)&&Ac(r,s)&&Ac(s,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(s.i/n),mc(i),mc(i.next),i=t=s),i=i.next}while(i!==t);return Ya(i)}function tc(t,e,n,i,r,s){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&ac(o,t)){let a=pc(o,t);return o=Ya(o,o.next),a=Ya(a,a.next),$a(o,e,n,i,r,s),void $a(a,e,n,i,r,s)}t=t.next}o=o.next}while(o!==t)}function ec(t,e){return t.x-e.x}function nc(t,e){if(e=function(t,e){let n=e;const i=t.x,r=t.y;let s,o=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=i&&t>o){if(o=t,t===i){if(r===n.y)return n;if(r===n.next.y)return n.next}s=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!s)return null;if(i===o)return s;const a=s,c=s.x,l=s.y;let u,d=1/0;n=s;do{i>=n.x&&n.x>=c&&i!==n.x&&oc(r<l?i:o,r,c,l,r<l?o:i,r,n.x,n.y)&&(u=Math.abs(r-n.y)/(i-n.x),Ac(n,t)&&(u<d||u===d&&(n.x>s.x||n.x===s.x&&ic(s,n)))&&(s=n,d=u)),n=n.next}while(n!==a);return s}(t,e),e){const n=pc(e,t);Ya(e,e.next),Ya(n,n.next)}}function ic(t,e){return cc(t.prev,t,e.prev)<0&&cc(e.next,t,t.next)<0}function rc(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function sc(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function oc(t,e,n,i,r,s,o,a){return(r-o)*(e-a)-(t-o)*(s-a)>=0&&(t-o)*(i-a)-(n-o)*(e-a)>=0&&(n-o)*(s-a)-(r-o)*(i-a)>=0}function ac(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&uc(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Ac(t,e)&&Ac(e,t)&&function(t,e){let n=t,i=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(cc(t.prev,t,e.prev)||cc(t,e.prev,e))||lc(t,e)&&cc(t.prev,t,t.next)>0&&cc(e.prev,e,e.next)>0)}function cc(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function lc(t,e){return t.x===e.x&&t.y===e.y}function uc(t,e,n,i){const r=hc(cc(t,e,n)),s=hc(cc(t,e,i)),o=hc(cc(n,i,t)),a=hc(cc(n,i,e));return r!==s&&o!==a||(!(0!==r||!dc(t,n,e))||(!(0!==s||!dc(t,i,e))||(!(0!==o||!dc(n,t,i))||!(0!==a||!dc(n,e,i)))))}function dc(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function hc(t){return t>0?1:t<0?-1:0}function Ac(t,e){return cc(t.prev,t,t.next)<0?cc(t,e,t.next)>=0&&cc(t,t.prev,e)>=0:cc(t,e,t.prev)<0||cc(t,t.next,e)<0}function pc(t,e){const n=new gc(t.i,t.x,t.y),i=new gc(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,s.next=i,i.prev=s,i}function fc(t,e,n,i){const r=new gc(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function mc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function gc(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class vc{static area(t){const e=t.length;let n=0;for(let i=e-1,r=0;r<e;i=r++)n+=t[i].x*t[r].y-t[r].x*t[i].y;return.5*n}static isClockWise(t){return vc.area(t)<0}static triangulateShape(t,e){const n=[],i=[],r=[];yc(t),_c(n,t);let s=t.length;e.forEach(yc);for(let t=0;t<e.length;t++)i.push(s),s+=e[t].length,_c(n,e[t]);const o=Ka(n,i);for(let t=0;t<o.length;t+=3)r.push(o.slice(t,t+3));return r}}function yc(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function _c(t,e){for(let n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}class bc extends Un{constructor(t=new Wa([new Rt(.5,.5),new Rt(-.5,.5),new Rt(-.5,-.5),new Rt(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,i=[],r=[];for(let e=0,n=t.length;e<n;e++){s(t[e])}function s(t){const s=[],o=void 0!==e.curveSegments?e.curveSegments:12,a=void 0!==e.steps?e.steps:1;let c=void 0!==e.depth?e.depth:1,l=void 0===e.bevelEnabled||e.bevelEnabled,u=void 0!==e.bevelThickness?e.bevelThickness:.2,d=void 0!==e.bevelSize?e.bevelSize:u-.1,h=void 0!==e.bevelOffset?e.bevelOffset:0,A=void 0!==e.bevelSegments?e.bevelSegments:3;const p=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:Ec;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=e.amount);let m,g,v,y,_,b=!1;p&&(m=p.getSpacedPoints(a),b=!0,l=!1,g=p.computeFrenetFrames(a,!1),v=new te,y=new te,_=new te),l||(A=0,u=0,d=0,h=0);const E=t.extractPoints(o);let w=E.shape;const S=E.holes;if(!vc.isClockWise(w)){w=w.reverse();for(let t=0,e=S.length;t<e;t++){const e=S[t];vc.isClockWise(e)&&(S[t]=e.reverse())}}const T=vc.triangulateShape(w,S),C=w;for(let t=0,e=S.length;t<e;t++){const e=S[t];w=w.concat(e)}function R(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const I=w.length,x=T.length;function O(t,e,n){let i,r,s;const o=t.x-e.x,a=t.y-e.y,c=n.x-t.x,l=n.y-t.y,u=o*o+a*a,d=o*l-a*c;if(Math.abs(d)>Number.EPSILON){const d=Math.sqrt(u),h=Math.sqrt(c*c+l*l),A=e.x-a/d,p=e.y+o/d,f=((n.x-l/h-A)*l-(n.y+c/h-p)*c)/(o*l-a*c);i=A+o*f-t.x,r=p+a*f-t.y;const m=i*i+r*r;if(m<=2)return new Rt(i,r);s=Math.sqrt(m/2)}else{let t=!1;o>Number.EPSILON?c>Number.EPSILON&&(t=!0):o<-Number.EPSILON?c<-Number.EPSILON&&(t=!0):Math.sign(a)===Math.sign(l)&&(t=!0),t?(i=-a,r=o,s=Math.sqrt(u)):(i=o,r=a,s=Math.sqrt(u/2))}return new Rt(i/s,r/s)}const L=[];for(let t=0,e=C.length,n=e-1,i=t+1;t<e;t++,n++,i++)n===e&&(n=0),i===e&&(i=0),L[t]=O(C[t],C[n],C[i]);const M=[];let k,N=L.concat();for(let t=0,e=S.length;t<e;t++){const e=S[t];k=[];for(let t=0,n=e.length,i=n-1,r=t+1;t<n;t++,i++,r++)i===n&&(i=0),r===n&&(r=0),k[t]=O(e[t],e[i],e[r]);M.push(k),N=N.concat(k)}for(let t=0;t<A;t++){const e=t/A,n=u*Math.cos(e*Math.PI/2),i=d*Math.sin(e*Math.PI/2)+h;for(let t=0,e=C.length;t<e;t++){const e=R(C[t],L[t],i);B(e.x,e.y,-n)}for(let t=0,e=S.length;t<e;t++){const e=S[t];k=M[t];for(let t=0,r=e.length;t<r;t++){const r=R(e[t],k[t],i);B(r.x,r.y,-n)}}}const P=d+h;for(let t=0;t<I;t++){const e=l?R(w[t],N[t],P):w[t];b?(y.copy(g.normals[0]).multiplyScalar(e.x),v.copy(g.binormals[0]).multiplyScalar(e.y),_.copy(m[0]).add(y).add(v),B(_.x,_.y,_.z)):B(e.x,e.y,0)}for(let t=1;t<=a;t++)for(let e=0;e<I;e++){const n=l?R(w[e],N[e],P):w[e];b?(y.copy(g.normals[t]).multiplyScalar(n.x),v.copy(g.binormals[t]).multiplyScalar(n.y),_.copy(m[t]).add(y).add(v),B(_.x,_.y,_.z)):B(n.x,n.y,c/a*t)}for(let t=A-1;t>=0;t--){const e=t/A,n=u*Math.cos(e*Math.PI/2),i=d*Math.sin(e*Math.PI/2)+h;for(let t=0,e=C.length;t<e;t++){const e=R(C[t],L[t],i);B(e.x,e.y,c+n)}for(let t=0,e=S.length;t<e;t++){const e=S[t];k=M[t];for(let t=0,r=e.length;t<r;t++){const r=R(e[t],k[t],i);b?B(r.x,r.y+m[a-1].y,m[a-1].x+n):B(r.x,r.y,c+n)}}}function D(t,e){let n=t.length;for(;--n>=0;){const i=n;let r=n-1;r<0&&(r=t.length-1);for(let t=0,n=a+2*A;t<n;t++){const n=I*t,s=I*(t+1);F(e+i+n,e+r+n,e+r+s,e+i+s)}}}function B(t,e,n){s.push(t),s.push(e),s.push(n)}function U(t,e,r){H(t),H(e),H(r);const s=i.length/3,o=f.generateTopUV(n,i,s-3,s-2,s-1);V(o[0]),V(o[1]),V(o[2])}function F(t,e,r,s){H(t),H(e),H(s),H(e),H(r),H(s);const o=i.length/3,a=f.generateSideWallUV(n,i,o-6,o-3,o-2,o-1);V(a[0]),V(a[1]),V(a[3]),V(a[1]),V(a[2]),V(a[3])}function H(t){i.push(s[3*t+0]),i.push(s[3*t+1]),i.push(s[3*t+2])}function V(t){r.push(t.x),r.push(t.y)}!function(){const t=i.length/3;if(l){let t=0,e=I*t;for(let t=0;t<x;t++){const n=T[t];U(n[2]+e,n[1]+e,n[0]+e)}t=a+2*A,e=I*t;for(let t=0;t<x;t++){const n=T[t];U(n[0]+e,n[1]+e,n[2]+e)}}else{for(let t=0;t<x;t++){const e=T[t];U(e[2],e[1],e[0])}for(let t=0;t<x;t++){const e=T[t];U(e[0]+I*a,e[1]+I*a,e[2]+I*a)}}n.addGroup(t,i.length/3-t,0)}(),function(){const t=i.length/3;let e=0;D(C,e),e+=C.length;for(let t=0,n=S.length;t<n;t++){const n=S[t];D(n,e),e+=n.length}n.addGroup(t,i.length/3-t,1)}()}this.setAttribute("position",new xn(i,3)),this.setAttribute("uv",new xn(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,n){if(n.shapes=[],Array.isArray(t))for(let e=0,i=t.length;e<i;e++){const i=t[e];n.shapes.push(i.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudePath&&(n.options.extrudePath=e.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}const i=t.options.extrudePath;return void 0!==i&&(t.options.extrudePath=(new Ga[i.type]).fromJSON(i)),new bc(n,t.options)}}const Ec={generateTopUV:function(t,e,n,i,r){const s=e[3*n],o=e[3*n+1],a=e[3*i],c=e[3*i+1],l=e[3*r],u=e[3*r+1];return[new Rt(s,o),new Rt(a,c),new Rt(l,u)]},generateSideWallUV:function(t,e,n,i,r,s){const o=e[3*n],a=e[3*n+1],c=e[3*n+2],l=e[3*i],u=e[3*i+1],d=e[3*i+2],h=e[3*r],A=e[3*r+1],p=e[3*r+2],f=e[3*s],m=e[3*s+1],g=e[3*s+2];return Math.abs(a-u)<Math.abs(o-l)?[new Rt(o,1-c),new Rt(l,1-d),new Rt(h,1-p),new Rt(f,1-g)]:[new Rt(a,1-c),new Rt(u,1-d),new Rt(A,1-p),new Rt(m,1-g)]}};class wc extends ga{constructor(t=1,e=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new wc(t.radius,t.detail)}}class Sc extends Un{constructor(t=[new Rt(0,.5),new Rt(.5,0),new Rt(0,-.5)],e=12,n=0,i=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:i},e=Math.floor(e),i=_t(i,0,2*Math.PI);const r=[],s=[],o=[],a=[],c=[],l=1/e,u=new te,d=new Rt,h=new te,A=new te,p=new te;let f=0,m=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:f=t[e+1].x-t[e].x,m=t[e+1].y-t[e].y,h.x=1*m,h.y=-f,h.z=0*m,p.copy(h),h.normalize(),a.push(h.x,h.y,h.z);break;case t.length-1:a.push(p.x,p.y,p.z);break;default:f=t[e+1].x-t[e].x,m=t[e+1].y-t[e].y,h.x=1*m,h.y=-f,h.z=0*m,A.copy(h),h.x+=p.x,h.y+=p.y,h.z+=p.z,h.normalize(),a.push(h.x,h.y,h.z),p.copy(A)}for(let r=0;r<=e;r++){const h=n+r*l*i,A=Math.sin(h),p=Math.cos(h);for(let n=0;n<=t.length-1;n++){u.x=t[n].x*A,u.y=t[n].y,u.z=t[n].x*p,s.push(u.x,u.y,u.z),d.x=r/e,d.y=n/(t.length-1),o.push(d.x,d.y);const i=a[3*n+0]*A,l=a[3*n+1],h=a[3*n+0]*p;c.push(i,l,h)}}for(let n=0;n<e;n++)for(let e=0;e<t.length-1;e++){const i=e+n*t.length,s=i,o=i+t.length,a=i+t.length+1,c=i+1;r.push(s,o,c),r.push(a,c,o)}this.setIndex(r),this.setAttribute("position",new xn(s,3)),this.setAttribute("uv",new xn(o,2)),this.setAttribute("normal",new xn(c,3))}static fromJSON(t){return new Sc(t.points,t.segments,t.phiStart,t.phiLength)}}class Tc extends ga{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Tc(t.radius,t.detail)}}class Cc extends Un{constructor(t=.5,e=1,n=8,i=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:s},n=Math.max(3,n);const o=[],a=[],c=[],l=[];let u=t;const d=(e-t)/(i=Math.max(1,i)),h=new te,A=new Rt;for(let t=0;t<=i;t++){for(let t=0;t<=n;t++){const i=r+t/n*s;h.x=u*Math.cos(i),h.y=u*Math.sin(i),a.push(h.x,h.y,h.z),c.push(0,0,1),A.x=(h.x/e+1)/2,A.y=(h.y/e+1)/2,l.push(A.x,A.y)}u+=d}for(let t=0;t<i;t++){const e=t*(n+1);for(let t=0;t<n;t++){const i=t+e,r=i,s=i+n+1,a=i+n+2,c=i+1;o.push(r,s,c),o.push(s,a,c)}}this.setIndex(o),this.setAttribute("position",new xn(a,3)),this.setAttribute("normal",new xn(c,3)),this.setAttribute("uv",new xn(l,2))}static fromJSON(t){return new Cc(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Rc extends Un{constructor(t=new Wa([new Rt(0,.5),new Rt(-.5,-.5),new Rt(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const n=[],i=[],r=[],s=[];let o=0,a=0;if(!1===Array.isArray(t))c(t);else for(let e=0;e<t.length;e++)c(t[e]),this.addGroup(o,a,e),o+=a,a=0;function c(t){const o=i.length/3,c=t.extractPoints(e);let l=c.shape;const u=c.holes;!1===vc.isClockWise(l)&&(l=l.reverse());for(let t=0,e=u.length;t<e;t++){const e=u[t];!0===vc.isClockWise(e)&&(u[t]=e.reverse())}const d=vc.triangulateShape(l,u);for(let t=0,e=u.length;t<e;t++){const e=u[t];l=l.concat(e)}for(let t=0,e=l.length;t<e;t++){const e=l[t];i.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=d.length;t<e;t++){const e=d[t],i=e[0]+o,r=e[1]+o,s=e[2]+o;n.push(i,r,s),a+=3}}this.setIndex(n),this.setAttribute("position",new xn(i,3)),this.setAttribute("normal",new xn(r,3)),this.setAttribute("uv",new xn(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let n=0,i=t.length;n<i;n++){const i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const n=[];for(let i=0,r=t.shapes.length;i<r;i++){const r=e[t.shapes[i]];n.push(r)}return new Rc(n,t.curveSegments)}}class Ic extends Un{constructor(t=1,e=32,n=16,i=0,r=2*Math.PI,s=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:i,phiLength:r,thetaStart:s,thetaLength:o},e=Math.max(3,Math.floor(e)),n=Math.max(2,Math.floor(n));const a=Math.min(s+o,Math.PI);let c=0;const l=[],u=new te,d=new te,h=[],A=[],p=[],f=[];for(let h=0;h<=n;h++){const m=[],g=h/n;let v=0;0==h&&0==s?v=.5/e:h==n&&a==Math.PI&&(v=-.5/e);for(let n=0;n<=e;n++){const a=n/e;u.x=-t*Math.cos(i+a*r)*Math.sin(s+g*o),u.y=t*Math.cos(s+g*o),u.z=t*Math.sin(i+a*r)*Math.sin(s+g*o),A.push(u.x,u.y,u.z),d.copy(u).normalize(),p.push(d.x,d.y,d.z),f.push(a+v,1-g),m.push(c++)}l.push(m)}for(let t=0;t<n;t++)for(let i=0;i<e;i++){const e=l[t][i+1],r=l[t][i],o=l[t+1][i],c=l[t+1][i+1];(0!==t||s>0)&&h.push(e,r,c),(t!==n-1||a<Math.PI)&&h.push(r,o,c)}this.setIndex(h),this.setAttribute("position",new xn(A,3)),this.setAttribute("normal",new xn(p,3)),this.setAttribute("uv",new xn(f,2))}static fromJSON(t){return new Ic(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class xc extends ga{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new xc(t.radius,t.detail)}}class Oc extends Un{constructor(t=1,e=.4,n=8,i=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:i,arc:r},n=Math.floor(n),i=Math.floor(i);const s=[],o=[],a=[],c=[],l=new te,u=new te,d=new te;for(let s=0;s<=n;s++)for(let h=0;h<=i;h++){const A=h/i*r,p=s/n*Math.PI*2;u.x=(t+e*Math.cos(p))*Math.cos(A),u.y=(t+e*Math.cos(p))*Math.sin(A),u.z=e*Math.sin(p),o.push(u.x,u.y,u.z),l.x=t*Math.cos(A),l.y=t*Math.sin(A),d.subVectors(u,l).normalize(),a.push(d.x,d.y,d.z),c.push(h/i),c.push(s/n)}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*t+e-1,r=(i+1)*(t-1)+e-1,o=(i+1)*(t-1)+e,a=(i+1)*t+e;s.push(n,r,a),s.push(r,o,a)}this.setIndex(s),this.setAttribute("position",new xn(o,3)),this.setAttribute("normal",new xn(a,3)),this.setAttribute("uv",new xn(c,2))}static fromJSON(t){return new Oc(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Lc extends Un{constructor(t=1,e=.4,n=64,i=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:i,p:r,q:s},n=Math.floor(n),i=Math.floor(i);const o=[],a=[],c=[],l=[],u=new te,d=new te,h=new te,A=new te,p=new te,f=new te,m=new te;for(let o=0;o<=n;++o){const v=o/n*r*Math.PI*2;g(v,r,s,t,h),g(v+.01,r,s,t,A),f.subVectors(A,h),m.addVectors(A,h),p.crossVectors(f,m),m.crossVectors(p,f),p.normalize(),m.normalize();for(let t=0;t<=i;++t){const r=t/i*Math.PI*2,s=-e*Math.cos(r),A=e*Math.sin(r);u.x=h.x+(s*m.x+A*p.x),u.y=h.y+(s*m.y+A*p.y),u.z=h.z+(s*m.z+A*p.z),a.push(u.x,u.y,u.z),d.subVectors(u,h).normalize(),c.push(d.x,d.y,d.z),l.push(o/n),l.push(t/i)}}for(let t=1;t<=n;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),s=(i+1)*t+e,a=(i+1)*(t-1)+e;o.push(n,r,a),o.push(r,s,a)}function g(t,e,n,i,r){const s=Math.cos(t),o=Math.sin(t),a=n/e*t,c=Math.cos(a);r.x=i*(2+c)*.5*s,r.y=i*(2+c)*o*.5,r.z=i*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new xn(a,3)),this.setAttribute("normal",new xn(c,3)),this.setAttribute("uv",new xn(l,2))}static fromJSON(t){return new Lc(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Mc extends Un{constructor(t=new Va(new te(-1,-1,0),new te(-1,1,0),new te(1,1,0)),e=64,n=1,i=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:n,radialSegments:i,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const o=new te,a=new te,c=new Rt;let l=new te;const u=[],d=[],h=[],A=[];function p(r){l=t.getPointAt(r/e,l);const c=s.normals[r],h=s.binormals[r];for(let t=0;t<=i;t++){const e=t/i*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);a.x=s*c.x+r*h.x,a.y=s*c.y+r*h.y,a.z=s*c.z+r*h.z,a.normalize(),d.push(a.x,a.y,a.z),o.x=l.x+n*a.x,o.y=l.y+n*a.y,o.z=l.z+n*a.z,u.push(o.x,o.y,o.z)}}!function(){for(let t=0;t<e;t++)p(t);p(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let n=0;n<=i;n++)c.x=t/e,c.y=n/i,h.push(c.x,c.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=i;e++){const n=(i+1)*(t-1)+(e-1),r=(i+1)*t+(e-1),s=(i+1)*t+e,o=(i+1)*(t-1)+e;A.push(n,r,o),A.push(r,s,o)}}()}(),this.setIndex(A),this.setAttribute("position",new xn(u,3)),this.setAttribute("normal",new xn(d,3)),this.setAttribute("uv",new xn(h,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Mc((new Ga[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class kc extends Un{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],n=new Set,i=new te,r=new te;if(null!==t.index){const s=t.attributes.position,o=t.index;let a=t.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let t=0,c=a.length;t<c;++t){const c=a[t],l=c.start;for(let t=l,a=l+c.count;t<a;t+=3)for(let a=0;a<3;a++){const c=o.getX(t+a),l=o.getX(t+(a+1)%3);i.fromBufferAttribute(s,c),r.fromBufferAttribute(s,l),!0===Nc(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,o=s.count/3;t<o;t++)for(let o=0;o<3;o++){const a=3*t+o,c=3*t+(o+1)%3;i.fromBufferAttribute(s,a),r.fromBufferAttribute(s,c),!0===Nc(i,r,n)&&(e.push(i.x,i.y,i.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new xn(e,3))}}}function Nc(t,e,n){const i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==n.has(i)&&!0!==n.has(r)&&(n.add(i),n.add(r),!0)}var Pc=Object.freeze({__proto__:null,BoxGeometry:ri,BoxBufferGeometry:ri,CircleGeometry:pa,CircleBufferGeometry:pa,ConeGeometry:ma,ConeBufferGeometry:ma,CylinderGeometry:fa,CylinderBufferGeometry:fa,DodecahedronGeometry:va,DodecahedronBufferGeometry:va,EdgesGeometry:wa,ExtrudeGeometry:bc,ExtrudeBufferGeometry:bc,IcosahedronGeometry:wc,IcosahedronBufferGeometry:wc,LatheGeometry:Sc,LatheBufferGeometry:Sc,OctahedronGeometry:Tc,OctahedronBufferGeometry:Tc,PlaneGeometry:Si,PlaneBufferGeometry:Si,PolyhedronGeometry:ga,PolyhedronBufferGeometry:ga,RingGeometry:Cc,RingBufferGeometry:Cc,ShapeGeometry:Rc,ShapeBufferGeometry:Rc,SphereGeometry:Ic,SphereBufferGeometry:Ic,TetrahedronGeometry:xc,TetrahedronBufferGeometry:xc,TorusGeometry:Oc,TorusBufferGeometry:Oc,TorusKnotGeometry:Lc,TorusKnotBufferGeometry:Lc,TubeGeometry:Mc,TubeBufferGeometry:Mc,WireframeGeometry:kc});class Dc extends mn{constructor(t){super(),this.type="ShadowMaterial",this.color=new Ft(0),this.transparent=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this}}Dc.prototype.isShadowMaterial=!0;class Bc extends ci{constructor(t){super(t),this.type="RawShaderMaterial"}}Bc.prototype.isRawShaderMaterial=!0;class Uc extends mn{constructor(t){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Ft(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Uc.prototype.isMeshStandardMaterial=!0;class Fc extends Uc{constructor(t){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Rt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return _t(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new Ft(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Ft(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Ft(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}Fc.prototype.isMeshPhysicalMaterial=!0;class Hc extends mn{constructor(t){super(),this.type="MeshPhongMaterial",this.color=new Ft(16777215),this.specular=new Ft(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this}}Hc.prototype.isMeshPhongMaterial=!0;class Vc extends mn{constructor(t){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Ft(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Vc.prototype.isMeshToonMaterial=!0;class jc extends mn{constructor(t){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}jc.prototype.isMeshNormalMaterial=!0;class Gc extends mn{constructor(t){super(),this.type="MeshLambertMaterial",this.color=new Ft(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this}}Gc.prototype.isMeshLambertMaterial=!0;class Qc extends mn{constructor(t){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Ft(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Rt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this}}Qc.prototype.isMeshMatcapMaterial=!0;class zc extends Wo{constructor(t){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}zc.prototype.isLineDashedMaterial=!0;const Wc={ShadowMaterial:Dc,SpriteMaterial:lo,RawShaderMaterial:Bc,ShaderMaterial:ci,PointsMaterial:ia,MeshPhysicalMaterial:Fc,MeshStandardMaterial:Uc,MeshPhongMaterial:Hc,MeshToonMaterial:Vc,MeshNormalMaterial:jc,MeshLambertMaterial:Gc,MeshDepthMaterial:js,MeshDistanceMaterial:Gs,MeshBasicMaterial:gn,MeshMatcapMaterial:Qc,LineDashedMaterial:zc,LineBasicMaterial:Wo,Material:mn};mn.fromType=function(t){return new Wc[t]};const Kc={arraySlice:function(t,e,n){return Kc.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let t=0;t!==e;++t)n[t]=t;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedArray:function(t,e,n){const i=t.length,r=new t.constructor(i);for(let s=0,o=0;o!==i;++s){const i=n[s]*e;for(let n=0;n!==e;++n)r[o++]=t[i+n]}return r},flattenJSON:function(t,e,n,i){let r=1,s=t[0];for(;void 0!==s&&void 0===s[i];)s=t[r++];if(void 0===s)return;let o=s[i];if(void 0!==o)if(Array.isArray(o))do{o=s[i],void 0!==o&&(e.push(s.time),n.push.apply(n,o)),s=t[r++]}while(void 0!==s);else if(void 0!==o.toArray)do{o=s[i],void 0!==o&&(e.push(s.time),o.toArray(n,n.length)),s=t[r++]}while(void 0!==s);else do{o=s[i],void 0!==o&&(e.push(s.time),n.push(o)),s=t[r++]}while(void 0!==s)},subclip:function(t,e,n,i,r=30){const s=t.clone();s.name=e;const o=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],a=e.getValueSize(),c=[],l=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<n||s>=i)){c.push(e.times[t]);for(let n=0;n<a;++n)l.push(e.values[t*a+n])}}0!==c.length&&(e.times=Kc.convertArray(c,e.times.constructor),e.values=Kc.convertArray(l,e.values.constructor),o.push(e))}s.tracks=o;let a=1/0;for(let t=0;t<s.tracks.length;++t)a>s.tracks[t].times[0]&&(a=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*a);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,n=t,i=30){i<=0&&(i=30);const r=n.tracks.length,s=e/i;for(let e=0;e<r;++e){const i=n.tracks[e],r=i.ValueTypeName;if("bool"===r||"string"===r)continue;const o=t.tracks.find((function(t){return t.name===i.name&&t.ValueTypeName===r}));if(void 0===o)continue;let a=0;const c=i.getValueSize();i.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let l=0;const u=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(l=u/3);const d=i.times.length-1;let h;if(s<=i.times[0]){const t=a,e=c-a;h=Kc.arraySlice(i.values,t,e)}else if(s>=i.times[d]){const t=d*c+a,e=t+c-a;h=Kc.arraySlice(i.values,t,e)}else{const t=i.createInterpolant(),e=a,n=c-a;t.evaluate(s),h=Kc.arraySlice(t.resultBuffer,e,n)}if("quaternion"===r){(new Zt).fromArray(h).normalize().conjugate().toArray(h)}const A=o.times.length;for(let t=0;t<A;++t){const e=t*u+l;if("quaternion"===r)Zt.multiplyQuaternionsFlat(o.values,e,h,0,o.values,e);else{const t=u-2*l;for(let n=0;n<t;++n)o.values[e+n]-=h[n]}}}return t.blendMode=ot,t}};class qc{constructor(t,e,n,i){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new e.constructor(n),this.sampleValues=e,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let n=this._cachedIndex,i=e[n],r=e[n-1];t:{e:{let s;n:{i:if(!(t<i)){for(let s=n+2;;){if(void 0===i){if(t<r)break i;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,r)}if(n===s)break;if(r=i,i=e[++n],t<i)break e}s=e.length;break n}if(t>=r)break t;{const o=e[1];t<o&&(n=2,r=o);for(let s=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(n===s)break;if(i=r,r=e[--n-1],t>=r)break e}s=n,n=0}}for(;n<s;){const i=n+s>>>1;t<e[i]?s=i:n=i+1}if(i=e[n],r=e[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,t,i);if(void 0===i)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,r,t)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,t,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i;for(let t=0;t!==i;++t)e[t]=n[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}qc.prototype.beforeStart_=qc.prototype.copySampleValue_,qc.prototype.afterEnd_=qc.prototype.copySampleValue_;class Yc extends qc{constructor(t,e,n,i){super(t,e,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:nt,endingEnd:nt}}intervalChanged_(t,e,n){const i=this.parameterPositions;let r=t-2,s=t+1,o=i[r],a=i[s];if(void 0===o)switch(this.getSettings_().endingStart){case it:r=t,o=2*e-n;break;case rt:r=i.length-2,o=e+i[r]-i[r+1];break;default:r=t,o=n}if(void 0===a)switch(this.getSettings_().endingEnd){case it:s=t,a=2*n-e;break;case rt:s=1,a=n+i[1]-i[0];break;default:s=t-1,a=e}const c=.5*(n-e),l=this.valueSize;this._weightPrev=c/(e-o),this._weightNext=c/(a-n),this._offsetPrev=r*l,this._offsetNext=s*l}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=a-o,l=this._offsetPrev,u=this._offsetNext,d=this._weightPrev,h=this._weightNext,A=(n-e)/(i-e),p=A*A,f=p*A,m=-d*f+2*d*p-d*A,g=(1+d)*f+(-1.5-2*d)*p+(-.5+d)*A+1,v=(-1-h)*f+(1.5+h)*p+.5*A,y=h*f-h*p;for(let t=0;t!==o;++t)r[t]=m*s[l+t]+g*s[c+t]+v*s[a+t]+y*s[u+t];return r}}class $c extends qc{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=t*o,c=a-o,l=(n-e)/(i-e),u=1-l;for(let t=0;t!==o;++t)r[t]=s[c+t]*u+s[a+t]*l;return r}}class Xc extends qc{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t){return this.copySampleValue_(t-1)}}class Jc{constructor(t,e,n,i){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Kc.convertArray(e,this.TimeBufferType),this.values=Kc.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let n;if(e.toJSON!==this.toJSON)n=e.toJSON(t);else{n={name:t.name,times:Kc.convertArray(t.times,Array),values:Kc.convertArray(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(n.interpolation=e)}return n.type=t.ValueTypeName,n}InterpolantFactoryMethodDiscrete(t){return new Xc(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new $c(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new Yc(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case Z:e=this.InterpolantFactoryMethodDiscrete;break;case tt:e=this.InterpolantFactoryMethodLinear;break;case et:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Z;case this.InterpolantFactoryMethodLinear:return tt;case this.InterpolantFactoryMethodSmooth:return et}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let n=0,i=e.length;n!==i;++n)e[n]*=t}return this}trim(t,e){const n=this.times,i=n.length;let r=0,s=i-1;for(;r!==i&&n[r]<t;)++r;for(;-1!==s&&n[s]>e;)--s;if(++s,0!==r||s!==i){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=Kc.arraySlice(n,r,s),this.values=Kc.arraySlice(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const i=n[e];if("number"==typeof i&&isNaN(i)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,i),t=!1;break}if(null!==s&&s>i){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,i,s),t=!1;break}s=i}if(void 0!==i&&Kc.isTypedArray(i))for(let e=0,n=i.length;e!==n;++e){const n=i[e];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,n),t=!1;break}}return t}optimize(){const t=Kc.arraySlice(this.times),e=Kc.arraySlice(this.values),n=this.getValueSize(),i=this.getInterpolation()===et,r=t.length-1;let s=1;for(let o=1;o<r;++o){let r=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(i)r=!0;else{const t=o*n,i=t-n,s=t+n;for(let o=0;o!==n;++o){const n=e[t+o];if(n!==e[i+o]||n!==e[s+o]){r=!0;break}}}if(r){if(o!==s){t[s]=t[o];const i=o*n,r=s*n;for(let t=0;t!==n;++t)e[r+t]=e[i+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*n,i=s*n,o=0;o!==n;++o)e[i+o]=e[t+o];++s}return s!==t.length?(this.times=Kc.arraySlice(t,0,s),this.values=Kc.arraySlice(e,0,s*n)):(this.times=t,this.values=e),this}clone(){const t=Kc.arraySlice(this.times,0),e=Kc.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createInterpolant=this.createInterpolant,n}}Jc.prototype.TimeBufferType=Float32Array,Jc.prototype.ValueBufferType=Float32Array,Jc.prototype.DefaultInterpolation=tt;class Zc extends Jc{}Zc.prototype.ValueTypeName="bool",Zc.prototype.ValueBufferType=Array,Zc.prototype.DefaultInterpolation=Z,Zc.prototype.InterpolantFactoryMethodLinear=void 0,Zc.prototype.InterpolantFactoryMethodSmooth=void 0;class tl extends Jc{}tl.prototype.ValueTypeName="color";class el extends Jc{}el.prototype.ValueTypeName="number";class nl extends qc{constructor(t,e,n,i){super(t,e,n,i)}interpolate_(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=(n-e)/(i-e);let c=t*o;for(let t=c+o;c!==t;c+=4)Zt.slerpFlat(r,0,s,c-o,s,c,a);return r}}class il extends Jc{InterpolantFactoryMethodLinear(t){return new nl(this.times,this.values,this.getValueSize(),t)}}il.prototype.ValueTypeName="quaternion",il.prototype.DefaultInterpolation=tt,il.prototype.InterpolantFactoryMethodSmooth=void 0;class rl extends Jc{}rl.prototype.ValueTypeName="string",rl.prototype.ValueBufferType=Array,rl.prototype.DefaultInterpolation=Z,rl.prototype.InterpolantFactoryMethodLinear=void 0,rl.prototype.InterpolantFactoryMethodSmooth=void 0;class sl extends Jc{}sl.prototype.ValueTypeName="vector";class ol{constructor(t,e=-1,n,i=2500){this.name=t,this.tracks=n,this.duration=e,this.blendMode=i,this.uuid=yt(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],n=t.tracks,i=1/(t.fps||1);for(let t=0,r=n.length;t!==r;++t)e.push(al(n[t]).scale(i));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],n=t.tracks,i={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,i=n.length;t!==i;++t)e.push(Jc.toJSON(n[t]));return i}static CreateFromMorphTargetSequence(t,e,n,i){const r=e.length,s=[];for(let t=0;t<r;t++){let o=[],a=[];o.push((t+r-1)%r,t,(t+1)%r),a.push(0,1,0);const c=Kc.getKeyframeOrder(o);o=Kc.sortedArray(o,1,c),a=Kc.sortedArray(a,1,c),i||0!==o[0]||(o.push(r),a.push(a[0])),s.push(new el(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/n))}return new this(t,-1,s)}static findByName(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<n.length;t++)if(n[t].name===e)return n[t];return null}static CreateClipsFromMorphTargetSequences(t,e,n){const i={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.name.match(r);if(s&&s.length>1){const t=s[1];let e=i[t];e||(i[t]=e=[]),e.push(n)}}const s=[];for(const t in i)s.push(this.CreateFromMorphTargetSequence(t,i[t],e,n));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,i,r){if(0!==n.length){const s=[],o=[];Kc.flattenJSON(n,s,o,i),0!==s.length&&r.push(new t(e,s,o))}},i=[],r=t.name||"default",s=t.fps||30,o=t.blendMode;let a=t.length||-1;const c=t.hierarchy||[];for(let t=0;t<c.length;t++){const r=c[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let n=0;n<r[e].morphTargets.length;n++)t[r[e].morphTargets[n]]=-1;for(const n in t){const t=[],s=[];for(let i=0;i!==r[e].morphTargets.length;++i){const i=r[e];t.push(i.time),s.push(i.morphTarget===n?1:0)}i.push(new el(".morphTargetInfluence["+n+"]",t,s))}a=t.length*s}else{const s=".bones["+e[t].name+"]";n(sl,s+".position",r,"pos",i),n(il,s+".quaternion",r,"rot",i),n(sl,s+".scale",r,"scl",i)}}if(0===i.length)return null;return new this(r,a,i,o)}resetDuration(){let t=0;for(let e=0,n=this.tracks.length;e!==n;++e){const n=this.tracks[e];t=Math.max(t,n.times[n.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function al(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return el;case"vector":case"vector2":case"vector3":case"vector4":return sl;case"color":return tl;case"quaternion":return il;case"bool":case"boolean":return Zc;case"string":return rl}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];Kc.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const cl={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class ll{constructor(t,e,n){const i=this;let r,s=!1,o=0,a=0;const c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){a++,!1===s&&void 0!==i.onStart&&i.onStart(t,o,a),s=!0},this.itemEnd=function(t){o++,void 0!==i.onProgress&&i.onProgress(t,o,a),o===a&&(s=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(t){void 0!==i.onError&&i.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return c.push(t,e),this},this.removeHandler=function(t){const e=c.indexOf(t);return-1!==e&&c.splice(e,2),this},this.getHandler=function(t){for(let e=0,n=c.length;e<n;e+=2){const n=c[e],i=c[e+1];if(n.global&&(n.lastIndex=0),n.test(t))return i}return null}}}const ul=new ll;class dl{constructor(t){this.manager=void 0!==t?t:ul,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const n=this;return new Promise((function(i,r){n.load(t,i,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const hl={};class Al extends dl{constructor(t){super(t)}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=cl.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==hl[t])return void hl[t].push({onLoad:e,onProgress:n,onError:i});hl[t]=[],hl[t].push({onLoad:e,onProgress:n,onError:i});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const n=hl[t],i=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,o=0!==s;let a=0;const c=new ReadableStream({start(t){!function e(){i.read().then((({done:i,value:r})=>{if(i)t.close();else{a+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:s});for(let t=0,e=n.length;t<e;t++){const e=n[t];e.onProgress&&e.onProgress(i)}t.enqueue(r),e()}}))}()}});return new Response(c)}throw Error(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),n=e&&e[1]?e[1].toLowerCase():void 0,i=new TextDecoder(n);return t.arrayBuffer().then((t=>i.decode(t)))}}})).then((e=>{cl.add(t,e);const n=hl[t];delete hl[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onLoad&&i.onLoad(e)}})).catch((e=>{const n=hl[t];if(void 0===n)throw this.manager.itemError(t),e;delete hl[t];for(let t=0,i=n.length;t<i;t++){const i=n[t];i.onError&&i.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class pl extends dl{constructor(t){super(t)}load(t,e,n,i){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=cl.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o=Mt("img");function a(){l(),cl.add(t,this),e&&e(this),r.manager.itemEnd(t)}function c(e){l(),i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)}function l(){o.removeEventListener("load",a,!1),o.removeEventListener("error",c,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",c,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(t),o.src=t,o}}class fl extends dl{constructor(t){super(t)}load(t,e,n,i){const r=new Ai,s=new pl(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let o=0;function a(n){s.load(t[n],(function(t){r.images[n]=t,o++,6===o&&(r.needsUpdate=!0,e&&e(r))}),void 0,i)}for(let e=0;e<t.length;++e)a(e);return r}}class ml extends dl{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Do,o=new Al(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(r.withCredentials),o.load(t,(function(t){const n=r.parse(t);n&&(void 0!==n.image?s.image=n.image:void 0!==n.data&&(s.image.width=n.width,s.image.height=n.height,s.image.data=n.data),s.wrapS=void 0!==n.wrapS?n.wrapS:d,s.wrapT=void 0!==n.wrapT?n.wrapT:d,s.magFilter=void 0!==n.magFilter?n.magFilter:m,s.minFilter=void 0!==n.minFilter?n.minFilter:m,s.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(s.encoding=n.encoding),void 0!==n.flipY&&(s.flipY=n.flipY),void 0!==n.format&&(s.format=n.format),void 0!==n.type&&(s.type=n.type),void 0!==n.mipmaps&&(s.mipmaps=n.mipmaps,s.minFilter=v),1===n.mipmapCount&&(s.minFilter=m),void 0!==n.generateMipmaps&&(s.generateMipmaps=n.generateMipmaps),s.needsUpdate=!0,e&&e(s,n))}),n,i),s}}class gl extends dl{constructor(t){super(t)}load(t,e,n,i){const r=new zt,s=new pl(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),n,i),r}}class vl extends nn{constructor(t,e=1){super(),this.type="Light",this.color=new Ft(t),this.intensity=e}dispose(){}copy(t){return super.copy(t),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}vl.prototype.isLight=!0;class yl extends vl{constructor(t,e,n){super(t,n),this.type="HemisphereLight",this.position.copy(nn.DefaultUp),this.updateMatrix(),this.groundColor=new Ft(e)}copy(t){return vl.prototype.copy.call(this,t),this.groundColor.copy(t.groundColor),this}}yl.prototype.isHemisphereLight=!0;const _l=new Le,bl=new te,El=new te;class wl{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Rt(512,512),this.map=null,this.mapPass=null,this.matrix=new Le,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new bi,this._frameExtents=new Rt(1,1),this._viewportCount=1,this._viewports=[new Wt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,n=this.matrix;bl.setFromMatrixPosition(t.matrixWorld),e.position.copy(bl),El.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(El),e.updateMatrixWorld(),_l.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_l),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Sl extends wl{constructor(){super(new ui(50,1,.5,500)),this.focus=1}updateMatrices(t){const e=this.camera,n=2*vt*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;n===e.fov&&i===e.aspect&&r===e.far||(e.fov=n,e.aspect=i,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}Sl.prototype.isSpotLightShadow=!0;class Tl extends vl{constructor(t,e,n=0,i=Math.PI/3,r=0,s=1){super(t,e),this.type="SpotLight",this.position.copy(nn.DefaultUp),this.updateMatrix(),this.target=new nn,this.distance=n,this.angle=i,this.penumbra=r,this.decay=s,this.shadow=new Sl}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Tl.prototype.isSpotLight=!0;const Cl=new Le,Rl=new te,Il=new te;class xl extends wl{constructor(){super(new ui(90,1,.5,500)),this._frameExtents=new Rt(4,2),this._viewportCount=6,this._viewports=[new Wt(2,1,1,1),new Wt(0,1,1,1),new Wt(3,1,1,1),new Wt(1,1,1,1),new Wt(3,0,1,1),new Wt(1,0,1,1)],this._cubeDirections=[new te(1,0,0),new te(-1,0,0),new te(0,0,1),new te(0,0,-1),new te(0,1,0),new te(0,-1,0)],this._cubeUps=[new te(0,1,0),new te(0,1,0),new te(0,1,0),new te(0,1,0),new te(0,0,1),new te(0,0,-1)]}updateMatrices(t,e=0){const n=this.camera,i=this.matrix,r=t.distance||n.far;r!==n.far&&(n.far=r,n.updateProjectionMatrix()),Rl.setFromMatrixPosition(t.matrixWorld),n.position.copy(Rl),Il.copy(n.position),Il.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(Il),n.updateMatrixWorld(),i.makeTranslation(-Rl.x,-Rl.y,-Rl.z),Cl.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Cl)}}xl.prototype.isPointLightShadow=!0;class Ol extends vl{constructor(t,e,n=0,i=1){super(t,e),this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new xl}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}Ol.prototype.isPointLight=!0;class Ll extends wl{constructor(){super(new Ni(-5,5,5,-5,.5,500))}}Ll.prototype.isDirectionalLightShadow=!0;class Ml extends vl{constructor(t,e){super(t,e),this.type="DirectionalLight",this.position.copy(nn.DefaultUp),this.updateMatrix(),this.target=new nn,this.shadow=new Ll}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}Ml.prototype.isDirectionalLight=!0;class kl extends vl{constructor(t,e){super(t,e),this.type="AmbientLight"}}kl.prototype.isAmbientLight=!0;class Nl extends vl{constructor(t,e,n=10,i=10){super(t,e),this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}Nl.prototype.isRectAreaLight=!0;class Pl{constructor(){this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new te)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*i),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*n),e.addScaledVector(s[4],n*i*1.092548),e.addScaledVector(s[5],i*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],n*r*1.092548),e.addScaledVector(s[8],.546274*(n*n-i*i)),e}getIrradianceAt(t,e){const n=t.x,i=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*i),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*n),e.addScaledVector(s[4],.858086*n*i),e.addScaledVector(s[5],.858086*i*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*n*r),e.addScaledVector(s[8],.429043*(n*n-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(t.coefficients[n],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this}toArray(t=[],e=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}static getBasisAt(t,e){const n=t.x,i=t.y,r=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*r,e[3]=.488603*n,e[4]=1.092548*n*i,e[5]=1.092548*i*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*n*r,e[8]=.546274*(n*n-i*i)}}Pl.prototype.isSphericalHarmonics3=!0;class Dl extends vl{constructor(t=new Pl,e=1){super(void 0,e),this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}Dl.prototype.isLightProbe=!0;class Bl extends dl{constructor(t){super(t),this.textures={}}load(t,e,n,i){const r=this,s=new Al(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}parse(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const i=mn.fromType(t.type);if(void 0!==t.uuid&&(i.uuid=t.uuid),void 0!==t.name&&(i.name=t.name),void 0!==t.color&&void 0!==i.color&&i.color.setHex(t.color),void 0!==t.roughness&&(i.roughness=t.roughness),void 0!==t.metalness&&(i.metalness=t.metalness),void 0!==t.sheen&&(i.sheen=t.sheen),void 0!==t.sheenColor&&(i.sheenColor=(new Ft).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(i.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==i.emissive&&i.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==i.specular&&i.specular.setHex(t.specular),void 0!==t.specularIntensity&&(i.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==i.specularColor&&i.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(i.shininess=t.shininess),void 0!==t.clearcoat&&(i.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(i.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.transmission&&(i.transmission=t.transmission),void 0!==t.thickness&&(i.thickness=t.thickness),void 0!==t.attenuationDistance&&(i.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==i.attenuationColor&&i.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(i.fog=t.fog),void 0!==t.flatShading&&(i.flatShading=t.flatShading),void 0!==t.blending&&(i.blending=t.blending),void 0!==t.combine&&(i.combine=t.combine),void 0!==t.side&&(i.side=t.side),void 0!==t.shadowSide&&(i.shadowSide=t.shadowSide),void 0!==t.opacity&&(i.opacity=t.opacity),void 0!==t.transparent&&(i.transparent=t.transparent),void 0!==t.alphaTest&&(i.alphaTest=t.alphaTest),void 0!==t.depthTest&&(i.depthTest=t.depthTest),void 0!==t.depthWrite&&(i.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(i.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(i.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(i.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(i.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(i.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(i.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(i.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(i.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(i.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(i.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(i.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(i.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(i.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(i.rotation=t.rotation),1!==t.linewidth&&(i.linewidth=t.linewidth),void 0!==t.dashSize&&(i.dashSize=t.dashSize),void 0!==t.gapSize&&(i.gapSize=t.gapSize),void 0!==t.scale&&(i.scale=t.scale),void 0!==t.polygonOffset&&(i.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(i.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(i.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(i.dithering=t.dithering),void 0!==t.alphaToCoverage&&(i.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(i.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.toneMapped&&(i.toneMapped=t.toneMapped),void 0!==t.userData&&(i.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?i.vertexColors=t.vertexColors>0:i.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(i.uniforms[e]={},r.type){case"t":i.uniforms[e].value=n(r.value);break;case"c":i.uniforms[e].value=(new Ft).setHex(r.value);break;case"v2":i.uniforms[e].value=(new Rt).fromArray(r.value);break;case"v3":i.uniforms[e].value=(new te).fromArray(r.value);break;case"v4":i.uniforms[e].value=(new Wt).fromArray(r.value);break;case"m3":i.uniforms[e].value=(new It).fromArray(r.value);break;case"m4":i.uniforms[e].value=(new Le).fromArray(r.value);break;default:i.uniforms[e].value=r.value}}if(void 0!==t.defines&&(i.defines=t.defines),void 0!==t.vertexShader&&(i.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(i.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)i.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(i.flatShading=1===t.shading),void 0!==t.size&&(i.size=t.size),void 0!==t.sizeAttenuation&&(i.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(i.map=n(t.map)),void 0!==t.matcap&&(i.matcap=n(t.matcap)),void 0!==t.alphaMap&&(i.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(i.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(i.bumpScale=t.bumpScale),void 0!==t.normalMap&&(i.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(i.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),i.normalScale=(new Rt).fromArray(e)}return void 0!==t.displacementMap&&(i.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(i.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(i.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(i.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(i.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(i.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(i.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(i.specularMap=n(t.specularMap)),void 0!==t.specularIntensityMap&&(i.specularIntensityMap=n(t.specularIntensityMap)),void 0!==t.specularColorMap&&(i.specularColorMap=n(t.specularColorMap)),void 0!==t.envMap&&(i.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(i.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(i.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(i.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(i.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(i.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(i.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(i.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(i.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(i.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(i.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(i.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(i.clearcoatNormalScale=(new Rt).fromArray(t.clearcoatNormalScale)),void 0!==t.transmissionMap&&(i.transmissionMap=n(t.transmissionMap)),void 0!==t.thicknessMap&&(i.thicknessMap=n(t.thicknessMap)),void 0!==t.sheenColorMap&&(i.sheenColorMap=n(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(i.sheenRoughnessMap=n(t.sheenRoughnessMap)),i}setTextures(t){return this.textures=t,this}}class Ul{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let n=0,i=t.length;n<i;n++)e+=String.fromCharCode(t[n]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Fl extends Un{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}Fl.prototype.isInstancedBufferGeometry=!0;class Hl extends dl{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Al(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}parse(t){const e={},n={};function i(t,i){if(void 0!==e[i])return e[i];const r=t.interleavedBuffers[i],s=function(t,e){if(void 0!==n[e])return n[e];const i=t.arrayBuffers[e],r=new Uint32Array(i).buffer;return n[e]=r,r}(t,r.buffer),o=Lt(r.type,s),a=new oo(o,r.stride);return a.uuid=r.uuid,e[i]=a,a}const r=t.isInstancedBufferGeometry?new Fl:new Un,s=t.data.index;if(void 0!==s){const t=Lt(s.type,s.array);r.setIndex(new _n(t,1))}const o=t.data.attributes;for(const e in o){const n=o[e];let s;if(n.isInterleavedBufferAttribute){const e=i(t.data,n.data);s=new co(e,n.itemSize,n.offset,n.normalized)}else{const t=Lt(n.type,n.array);s=new(n.isInstancedBufferAttribute?Ho:_n)(t,n.itemSize,n.normalized)}void 0!==n.name&&(s.name=n.name),void 0!==n.usage&&s.setUsage(n.usage),void 0!==n.updateRange&&(s.updateRange.offset=n.updateRange.offset,s.updateRange.count=n.updateRange.count),r.setAttribute(e,s)}const a=t.data.morphAttributes;if(a)for(const e in a){const n=a[e],s=[];for(let e=0,r=n.length;e<r;e++){const r=n[e];let o;if(r.isInterleavedBufferAttribute){const e=i(t.data,r.data);o=new co(e,r.itemSize,r.offset,r.normalized)}else{const t=Lt(r.type,r.array);o=new _n(t,r.itemSize,r.normalized)}void 0!==r.name&&(o.name=r.name),s.push(o)}r.morphAttributes[e]=s}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const c=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==c)for(let t=0,e=c.length;t!==e;++t){const e=c[t];r.addGroup(e.start,e.count,e.materialIndex)}const l=t.data.boundingSphere;if(void 0!==l){const t=new te;void 0!==l.center&&t.fromArray(l.center),r.boundingSphere=new Ee(t,l.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}const Vl={UVMapping:i,CubeReflectionMapping:r,CubeRefractionMapping:s,EquirectangularReflectionMapping:o,EquirectangularRefractionMapping:a,CubeUVReflectionMapping:c,CubeUVRefractionMapping:l},jl={RepeatWrapping:u,ClampToEdgeWrapping:d,MirroredRepeatWrapping:h},Gl={NearestFilter:A,NearestMipmapNearestFilter:p,NearestMipmapLinearFilter:f,LinearFilter:m,LinearMipmapNearestFilter:g,LinearMipmapLinearFilter:v};class Ql extends dl{constructor(t){super(t),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,n,i){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=cl.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(n){cl.add(t,n),e&&e(n),r.manager.itemEnd(t)})).catch((function(e){i&&i(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}}let zl;Ql.prototype.isImageBitmapLoader=!0;const Wl={getContext:function(){return void 0===zl&&(zl=new(window.AudioContext||window.webkitAudioContext)),zl},setContext:function(t){zl=t}};class Kl extends dl{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Al(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{const t=n.slice(0);Wl.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}}class ql extends Dl{constructor(t,e,n=1){super(void 0,n);const i=(new Ft).set(t),r=(new Ft).set(e),s=new te(i.r,i.g,i.b),o=new te(r.r,r.g,r.b),a=Math.sqrt(Math.PI),c=a*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(s).sub(o).multiplyScalar(c)}}ql.prototype.isHemisphereLightProbe=!0;class Yl extends Dl{constructor(t,e=1){super(void 0,e);const n=(new Ft).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Yl.prototype.isAmbientLightProbe=!0;const $l=new Le,Xl=new Le,Jl=new Le;class Zl{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=tu(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=tu();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function tu(){return("undefined"==typeof performance?Date:performance).now()}const eu=new te,nu=new Zt,iu=new te,ru=new te;class su extends nn{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const ou=new te,au=new Zt,cu=new te,lu=new te;class uu{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let n=0;n<e.length;n++)t+=e[n];return t/e.length}}class du{constructor(t,e,n){let i,r,s;switch(this.binding=t,this.valueSize=n,e){case"quaternion":i=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":i=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:i=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const n=this.buffer,i=this.valueSize,r=t*i+i;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==i;++t)n[r+t]=n[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(n,r,0,t,i)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,n=this.valueSize,i=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,i,0,t,n),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,n=this.buffer,i=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(n,i,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(n[t]!==n[t+e]){o.setValue(n,i);break}}saveOriginalState(){const t=this.binding,e=this.buffer,n=this.valueSize,i=n*this._origIndex;t.getValue(e,i);for(let t=n,r=i;t!==r;++t)e[t]=e[i+t%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let n=t;n<e;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[e+n]=this.buffer[t+n]}_select(t,e,n,i,r){if(i>=.5)for(let i=0;i!==r;++i)t[e+i]=t[n+i]}_slerp(t,e,n,i){Zt.slerpFlat(t,e,t,e,t,n,i)}_slerpAdditive(t,e,n,i,r){const s=this._workIndex*r;Zt.multiplyQuaternionsFlat(t,s,t,e,t,n),Zt.slerpFlat(t,e,t,e,t,s,i)}_lerp(t,e,n,i,r){const s=1-i;for(let o=0;o!==r;++o){const r=e+o;t[r]=t[r]*s+t[n+o]*i}}_lerpAdditive(t,e,n,i,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[n+s]*i}}}const hu="\\[\\]\\.:\\/",Au=new RegExp("[\\[\\]\\.:\\/]","g"),pu="[^\\[\\]\\.:\\/]",fu="[^"+hu.replace("\\.","")+"]",mu=/((?:WC+[\/:])*)/.source.replace("WC",pu),gu=/(WCOD+)?/.source.replace("WCOD",fu),vu=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pu),yu=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pu),_u=new RegExp("^"+mu+gu+vu+yu+"$"),bu=["material","materials","bones"];class Eu{constructor(t,e,n){this.path=e,this.parsedPath=n||Eu.parseTrackName(e),this.node=Eu.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,n){return t&&t.isAnimationObjectGroup?new Eu.Composite(t,e,n):new Eu(t,e,n)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Au,"")}static parseTrackName(t){const e=_u.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&-1!==i){const t=n.nodeName.substring(i+1);-1!==bu.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const s=n(r.children);if(s)return s}return null},i=n(t.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)t[e++]=n[i]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,n=e.objectName,i=e.propertyName;let r=e.propertyIndex;if(t||(t=Eu.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let i=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===i){i=e;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==i){if(void 0===t[i])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[i]}}const s=t[i];if(void 0===s){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+i+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}a=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(a=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Eu.Composite=class{constructor(t,e,n){const i=n||Eu.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,i)}getValue(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(t,e)}setValue(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,n=t.length;e!==n;++e)t[e].unbind()}},Eu.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Eu.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Eu.prototype.GetterByBindingType=[Eu.prototype._getValue_direct,Eu.prototype._getValue_array,Eu.prototype._getValue_arrayElement,Eu.prototype._getValue_toArray],Eu.prototype.SetterByBindingTypeAndVersioning=[[Eu.prototype._setValue_direct,Eu.prototype._setValue_direct_setNeedsUpdate,Eu.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Eu.prototype._setValue_array,Eu.prototype._setValue_array_setNeedsUpdate,Eu.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Eu.prototype._setValue_arrayElement,Eu.prototype._setValue_arrayElement_setNeedsUpdate,Eu.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Eu.prototype._setValue_fromArray,Eu.prototype._setValue_fromArray_setNeedsUpdate,Eu.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class wu{constructor(){this.uuid=yt(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,n=this._paths,i=this._parsedPaths,r=this._bindings,s=r.length;let o,a=t.length,c=this.nCachedObjects_;for(let l=0,u=arguments.length;l!==u;++l){const u=arguments[l],d=u.uuid;let h=e[d];if(void 0===h){h=a++,e[d]=h,t.push(u);for(let t=0,e=s;t!==e;++t)r[t].push(new Eu(u,n[t],i[t]))}else if(h<c){o=t[h];const a=--c,l=t[a];e[l.uuid]=h,t[h]=l,e[d]=a,t[a]=u;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[a];let o=e[h];e[h]=s,void 0===o&&(o=new Eu(u,n[t],i[t])),e[a]=o}}else t[h]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_;for(let s=0,o=arguments.length;s!==o;++s){const o=arguments[s],a=o.uuid,c=e[a];if(void 0!==c&&c>=r){const s=r++,l=t[s];e[l.uuid]=c,t[c]=l,e[a]=s,t[s]=o;for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[s],r=e[c];e[c]=i,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,i=n.length;let r=this.nCachedObjects_,s=t.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,c=e[a];if(void 0!==c)if(delete e[a],c<r){const o=--r,a=t[o],l=--s,u=t[l];e[a.uuid]=c,t[c]=a,e[u.uuid]=o,t[o]=u,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t],i=e[o],r=e[l];e[c]=i,e[o]=r,e.pop()}}else{const r=--s,o=t[r];r>0&&(e[o.uuid]=c),t[c]=o,t.pop();for(let t=0,e=i;t!==e;++t){const e=n[t];e[c]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const n=this._bindingsIndicesByPath;let i=n[t];const r=this._bindings;if(void 0!==i)return r[i];const s=this._paths,o=this._parsedPaths,a=this._objects,c=a.length,l=this.nCachedObjects_,u=new Array(c);i=r.length,n[t]=i,s.push(t),o.push(e),r.push(u);for(let n=l,i=a.length;n!==i;++n){const i=a[n];u[n]=new Eu(i,t,e)}return u}unsubscribe_(t){const e=this._bindingsIndicesByPath,n=e[t];if(void 0!==n){const i=this._paths,r=this._parsedPaths,s=this._bindings,o=s.length-1,a=s[o];e[t[o]]=n,s[n]=a,s.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}wu.prototype.isAnimationObjectGroup=!0;class Su{constructor(t,e,n=null,i=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=n,this.blendMode=i;const r=e.tracks,s=r.length,o=new Array(s),a={endingStart:nt,endingEnd:nt};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,i=t._clip.duration,r=i/n,s=n/i;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,n){return t.crossFadeFrom(this,e,n)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,n){const i=this._mixer,r=i.time,s=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=i._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,c=o.sampleValues;return a[0]=r,a[1]=r+n,c[0]=t/s,c[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,n,i){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const i=(t-r)*n;if(i<0||0===n)return;this._startTime=null,e=n*i}e*=this._updateTimeScale(t);const s=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===ot)for(let n=0,i=t.length;n!==i;++n)t[n].evaluate(s),e[n].accumulateAdditive(o);else for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(s),e[n].accumulate(i,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const n=this._weightInterpolant;if(null!==n){const i=n.evaluate(t)[0];e*=i,t>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){e*=n.evaluate(t)[0],t>n.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,n=this.loop;let i=this.time+t,r=this._loopCount;const s=2202===n;if(0===t)return-1===r?i:s&&1==(1&r)?e-i:i;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(i>=e)i=e;else{if(!(i<0)){this.time=i;break t}i=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),i>=e||i<0){const n=Math.floor(i/e);i-=e*n,r+=Math.abs(n);const o=this.repetitions-r;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=t>0?e:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=i;if(s&&1==(1&r))return e-i}return i}_setEndings(t,e,n){const i=this._interpolantSettings;n?(i.endingStart=it,i.endingEnd=it):(i.endingStart=t?this.zeroSlopeAtStart?it:nt:rt,i.endingEnd=e?this.zeroSlopeAtEnd?it:nt:rt)}_scheduleFading(t,e,n){const i=this._mixer,r=i.time;let s=this._weightInterpolant;null===s&&(s=i._lendControlInterpolant(),this._weightInterpolant=s);const o=s.parameterPositions,a=s.sampleValues;return o[0]=r,a[0]=e,o[1]=r+t,a[1]=n,this}}class Tu extends pt{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const n=t._localRoot||this._root,i=t._clip.tracks,r=i.length,s=t._propertyBindings,o=t._interpolants,a=n.uuid,c=this._bindingsByRootAndName;let l=c[a];void 0===l&&(l={},c[a]=l);for(let t=0;t!==r;++t){const r=i[t],c=r.name;let u=l[c];if(void 0!==u)++u.referenceCount,s[t]=u;else{if(u=s[t],void 0!==u){null===u._cacheIndex&&(++u.referenceCount,this._addInactiveBinding(u,a,c));continue}const i=e&&e._propertyBindings[t].binding.parsedPath;u=new du(Eu.create(n,c,i),r.ValueTypeName,r.getValueSize()),++u.referenceCount,this._addInactiveBinding(u,a,c),s[t]=u}o[t].resultBuffer=u.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,i=this._actionsByClip[n];this._bindAction(t,i&&i.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,n){const i=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=i.length,i.push(t),s.actionByRoot[n]=t}_removeInactiveAction(t){const e=this._actions,n=e[e.length-1],i=t._cacheIndex;n._cacheIndex=i,e[i]=n,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,o=s[r],a=o.knownActions,c=a[a.length-1],l=t._byClipCacheIndex;c._byClipCacheIndex=l,a[l]=c,a.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,n=e.length;t!==n;++t){const n=e[t];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,n=t._cacheIndex,i=this._nActiveActions++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackAction(t){const e=this._actions,n=t._cacheIndex,i=--this._nActiveActions,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_addInactiveBinding(t,e,n){const i=this._bindingsByRootAndName,r=this._bindings;let s=i[e];void 0===s&&(s={},i[e]=s),s[n]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,n=t.binding,i=n.rootNode.uuid,r=n.path,s=this._bindingsByRootAndName,o=s[i],a=e[e.length-1],c=t._cacheIndex;a._cacheIndex=c,e[c]=a,e.pop(),delete o[r],0===Object.keys(o).length&&delete s[i]}_lendBinding(t){const e=this._bindings,n=t._cacheIndex,i=this._nActiveBindings++,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_takeBackBinding(t){const e=this._bindings,n=t._cacheIndex,i=--this._nActiveBindings,r=e[i];t._cacheIndex=i,e[i]=t,r._cacheIndex=n,e[n]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new $c(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n}_takeBackControlInterpolant(t){const e=this._controlInterpolants,n=t.__cacheIndex,i=--this._nActiveControlInterpolants,r=e[i];t.__cacheIndex=i,e[i]=t,r.__cacheIndex=n,e[n]=r}clipAction(t,e,n){const i=e||this._root,r=i.uuid;let s="string"==typeof t?ol.findByName(i,t):t;const o=null!==s?s.uuid:t,a=this._actionsByClip[o];let c=null;if(void 0===n&&(n=null!==s?s.blendMode:st),void 0!==a){const t=a.actionByRoot[r];if(void 0!==t&&t.blendMode===n)return t;c=a.knownActions[0],null===s&&(s=c._clip)}if(null===s)return null;const l=new Su(this,s,e,n);return this._bindAction(l,c),this._addInactiveAction(l,o,r),l}existingAction(t,e){const n=e||this._root,i=n.uuid,r="string"==typeof t?ol.findByName(n,t):t,s=r?r.uuid:t,o=this._actionsByClip[s];return void 0!==o&&o.actionByRoot[i]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,i=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let o=0;o!==n;++o){e[o]._update(i,t,r,s)}const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,n=t.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){const t=r.knownActions;for(let n=0,i=t.length;n!==i;++n){const i=t[n];this._deactivateAction(i);const r=i._cacheIndex,s=e[e.length-1];i._cacheIndex=null,i._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(i)}delete i[n]}}uncacheRoot(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const i=n[t].actionByRoot[e];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}const i=this._bindingsByRootAndName[e];if(void 0!==i)for(const t in i){const e=i[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}Tu.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Cu{constructor(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}clone(){return new Cu(void 0===this.value.clone?this.value:this.value.clone())}}class Ru extends oo{constructor(t,e,n=1){super(t,e),this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}Ru.prototype.isInstancedInterleavedBuffer=!0;class Iu{constructor(t,e,n,i,r){this.buffer=t,this.type=e,this.itemSize=n,this.elementSize=i,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}Iu.prototype.isGLBufferAttribute=!0;function xu(t,e){return t.distance-e.distance}function Ou(t,e,n,i){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===i){const i=t.children;for(let t=0,r=i.length;t<r;t++)Ou(i[t],e,n,!0)}}const Lu=new Rt;class Mu{constructor(t=new Rt(1/0,1/0),e=new Rt(-1/0,-1/0)){this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,n=t.length;e<n;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const n=Lu.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return Lu.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}Mu.prototype.isBox2=!0;const ku=new te,Nu=new te;class Pu{constructor(t=new te,e=new te){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){ku.subVectors(t,this.start),Nu.subVectors(this.end,this.start);const n=Nu.dot(Nu);let i=Nu.dot(ku)/n;return e&&(i=_t(i,0,1)),i}closestPointToPoint(t,e,n){const i=this.closestPointToPointParameter(t,e);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Du=new te;const Bu=new te,Uu=new Le,Fu=new Le;class Hu extends ea{constructor(t){const e=Vu(t),n=new Un,i=[],r=[],s=new Ft(0,0,1),o=new Ft(0,1,0);for(let t=0;t<e.length;t++){const n=e[t];n.parent&&n.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(s.r,s.g,s.b),r.push(o.r,o.g,o.b))}n.setAttribute("position",new xn(i,3)),n.setAttribute("color",new xn(r,3));super(n,new Wo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,n=this.geometry,i=n.getAttribute("position");Fu.copy(this.root.matrixWorld).invert();for(let t=0,n=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(Uu.multiplyMatrices(Fu,r.matrixWorld),Bu.setFromMatrixPosition(Uu),i.setXYZ(n,Bu.x,Bu.y,Bu.z),Uu.multiplyMatrices(Fu,r.parent.matrixWorld),Bu.setFromMatrixPosition(Uu),i.setXYZ(n+1,Bu.x,Bu.y,Bu.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}}function Vu(t){const e=[];!0===t.isBone&&e.push(t);for(let n=0;n<t.children.length;n++)e.push.apply(e,Vu(t.children[n]));return e}const ju=new te,Gu=new Ft,Qu=new Ft;class zu extends ea{constructor(t=10,e=10,n=4473924,i=8947848){n=new Ft(n),i=new Ft(i);const r=e/2,s=t/e,o=t/2,a=[],c=[];for(let t=0,l=0,u=-o;t<=e;t++,u+=s){a.push(-o,0,u,o,0,u),a.push(u,0,-o,u,0,o);const e=t===r?n:i;e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3,e.toArray(c,l),l+=3}const l=new Un;l.setAttribute("position",new xn(a,3)),l.setAttribute("color",new xn(c,3));super(l,new Wo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Wu=new te,Ku=new te,qu=new te;const Yu=new te,$u=new li;function Xu(t,e,n,i,r,s,o){Yu.set(r,s,o).unproject(i);const a=e[t];if(void 0!==a){const t=n.getAttribute("position");for(let e=0,n=a.length;e<n;e++)t.setXYZ(a[e],Yu.x,Yu.y,Yu.z)}}const Ju=new ie;class Zu extends ea{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Un;r.setIndex(new _n(n,1)),r.setAttribute("position",new _n(i,3)),super(r,new Wo({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Ju.setFromObject(this.object),Ju.isEmpty())return;const e=Ju.min,n=Ju.max,i=this.geometry.attributes.position,r=i.array;r[0]=n.x,r[1]=n.y,r[2]=n.z,r[3]=e.x,r[4]=n.y,r[5]=n.z,r[6]=e.x,r[7]=e.y,r[8]=n.z,r[9]=n.x,r[10]=e.y,r[11]=n.z,r[12]=n.x,r[13]=n.y,r[14]=e.z,r[15]=e.x,r[16]=n.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=n.x,r[22]=e.y,r[23]=e.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t){return ea.prototype.copy.call(this,t),this.object=t.object,this}}const td=new te;let ed,nd;class id extends ea{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Un;n.setAttribute("position",new xn(e,3)),n.setAttribute("color",new xn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Wo({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,n){const i=new Ft,r=this.geometry.attributes.color.array;return i.set(t),i.toArray(r,0),i.toArray(r,3),i.set(e),i.toArray(r,6),i.toArray(r,9),i.set(n),i.toArray(r,12),i.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const rd=new Float32Array(1),sd=new Int32Array(rd.buffer);Sa.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Sa.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},za.prototype.fromPoints=function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)},zu.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Hu.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},dl.prototype.extractUrlBase=function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Ul.extractUrlBase(t)},dl.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Mu.prototype.center=function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},Mu.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Mu.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Mu.prototype.size=function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)},ie.prototype.center=function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},ie.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},ie.prototype.isIntersectionBox=function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},ie.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},ie.prototype.size=function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)},Ve.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},Ee.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},bi.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Pu.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},It.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},It.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},It.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},It.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},It.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},It.prototype.getInverse=function(t){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},Le.prototype.extractPosition=function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},Le.prototype.flattenToArrayOffset=function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},Le.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new te).setFromMatrixColumn(this,3)},Le.prototype.setRotationFromQuaternion=function(t){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(t)},Le.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Le.prototype.multiplyVector3=function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Le.prototype.multiplyVector4=function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Le.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Le.prototype.rotateAxis=function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},Le.prototype.crossVector=function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Le.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Le.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Le.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Le.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Le.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Le.prototype.applyToBufferAttribute=function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},Le.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Le.prototype.makeFrustum=function(t,e,n,i,r,s){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,i,n,r,s)},Le.prototype.getInverse=function(t){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(t).invert()},vi.prototype.isIntersectionLine=function(t){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(t)},Zt.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Zt.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Oe.prototype.isIntersectionBox=function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},Oe.prototype.isIntersectionPlane=function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},Oe.prototype.isIntersectionSphere=function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},pn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},pn.prototype.barycoordFromPoint=function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},pn.prototype.midpoint=function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},pn.prototypenormal=function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},pn.prototype.plane=function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)},pn.barycoordFromPoint=function(t,e,n,i,r){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),pn.getBarycoord(t,e,n,i,r)},pn.normal=function(t,e,n,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),pn.getNormal(t,e,n,i)},Wa.prototype.extractAllPoints=function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},Wa.prototype.extrude=function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new bc(this,t)},Wa.prototype.makeGeometry=function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Rc(this,t)},Rt.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Rt.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},Rt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},te.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},te.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},te.prototype.getPositionFromMatrix=function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},te.prototype.getScaleFromMatrix=function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},te.prototype.getColumnFromMatrix=function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},te.prototype.applyProjection=function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},te.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},te.prototype.distanceToManhattan=function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},te.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Wt.prototype.fromAttribute=function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},Wt.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},nn.prototype.getChildByName=function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},nn.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},nn.prototype.translate=function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},nn.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},nn.prototype.applyMatrix=function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(nn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),ni.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(ni.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),No.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},ui.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(vl.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(_n.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===dt},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(dt)}}}),_n.prototype.setDynamic=function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?dt:ut),this},_n.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},_n.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Un.prototype.addIndex=function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},Un.prototype.addAttribute=function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new _n(arguments[1],arguments[2])))},Un.prototype.addDrawCall=function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},Un.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Un.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Un.prototype.removeAttribute=function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},Un.prototype.applyMatrix=function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)},Object.defineProperties(Un.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),oo.prototype.setDynamic=function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?dt:ut),this},oo.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},bc.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},bc.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},bc.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},so.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Cu.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(mn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Ft}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(ci.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),eo.prototype.clearTarget=function(t,e,n,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,i)},eo.prototype.animate=function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},eo.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},eo.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},eo.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},eo.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},eo.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},eo.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},eo.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},eo.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},eo.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},eo.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},eo.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},eo.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},eo.prototype.enableScissorTest=function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},eo.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},eo.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},eo.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},eo.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},eo.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},eo.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},eo.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},eo.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},eo.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},eo.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(eo.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?ct:at}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(Qs.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Kt.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),su.prototype.load=function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Kl).load(t,(function(t){e.setBuffer(t)})),this},uu.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},hi.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)},hi.prototype.clear=function(t,e,n,i){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(t,e,n,i)},Vt.crossOrigin=void 0,Vt.loadTexture=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const r=new gl;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,n,void 0,i);return e&&(s.mapping=e),s},Vt.loadTextureCube=function(t,e,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const r=new fl;r.setCrossOrigin(this.crossOrigin);const s=r.load(t,n,void 0,i);return e&&(s.mapping=e),s},Vt.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Vt.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const od={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:e}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=e),t.ACESFilmicToneMapping=4,t.AddEquation=n,t.AddOperation=2,t.AdditiveAnimationBlendMode=ot,t.AdditiveBlending=2,t.AlphaFormat=1021,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=kl,t.AmbientLightProbe=Yl,t.AnimationClip=ol,t.AnimationLoader=class extends dl{constructor(t){super(t)}load(t,e,n,i){const r=this,s=new Al(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(n){try{e(r.parse(JSON.parse(n)))}catch(e){i?i(e):console.error(e),r.manager.itemError(t)}}),n,i)}parse(t){const e=[];for(let n=0;n<t.length;n++){const i=ol.parse(t[n]);e.push(i)}return e}},t.AnimationMixer=Tu,t.AnimationObjectGroup=wu,t.AnimationUtils=Kc,t.ArcCurve=Ca,t.ArrayCamera=qs,t.ArrowHelper=class extends nn{constructor(t=new te(0,0,1),e=new te(0,0,0),n=1,i=16776960,r=.2*n,s=.2*r){super(),this.type="ArrowHelper",void 0===ed&&(ed=new Un,ed.setAttribute("position",new xn([0,0,0,0,1,0],3)),nd=new fa(0,.5,1,5,1),nd.translate(0,-.5,0)),this.position.copy(e),this.line=new Jo(ed,new Wo({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ni(nd,new gn({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{td.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(td,e)}}setLength(t,e=.2*t,n=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}},t.Audio=su,t.AudioAnalyser=uu,t.AudioContext=Wl,t.AudioListener=class extends nn{constructor(){super(),this.type="AudioListener",this.context=Wl.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Zl}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(eu,nu,iu),ru.set(0,0,-1).applyQuaternion(nu),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(eu.x,t),e.positionY.linearRampToValueAtTime(eu.y,t),e.positionZ.linearRampToValueAtTime(eu.z,t),e.forwardX.linearRampToValueAtTime(ru.x,t),e.forwardY.linearRampToValueAtTime(ru.y,t),e.forwardZ.linearRampToValueAtTime(ru.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(eu.x,eu.y,eu.z),e.setOrientation(ru.x,ru.y,ru.z,n.x,n.y,n.z)}},t.AudioLoader=Kl,t.AxesHelper=id,t.AxisHelper=function(t){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new id(t)},t.BackSide=1,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.BinaryTextureLoader=function(t){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new ml(t)},t.Bone=Po,t.BooleanKeyframeTrack=Zc,t.BoundingBoxHelper=function(t,e){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Zu(t,e)},t.Box2=Mu,t.Box3=ie,t.Box3Helper=class extends ea{constructor(t,e=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Un;i.setIndex(new _n(n,1)),i.setAttribute("position",new xn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(i,new Wo({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}},t.BoxBufferGeometry=ri,t.BoxGeometry=ri,t.BoxHelper=Zu,t.BufferAttribute=_n,t.BufferGeometry=Un,t.BufferGeometryLoader=Hl,t.ByteType=1010,t.Cache=cl,t.Camera=li,t.CameraHelper=class extends ea{constructor(t){const e=new Un,n=new Wo({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],r=[],s={},o=new Ft(16755200),a=new Ft(16711680),c=new Ft(43775),l=new Ft(16777215),u=new Ft(3355443);function d(t,e,n){h(t,n),h(e,n)}function h(t,e){i.push(0,0,0),r.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(i.length/3-1)}d("n1","n2",o),d("n2","n4",o),d("n4","n3",o),d("n3","n1",o),d("f1","f2",o),d("f2","f4",o),d("f4","f3",o),d("f3","f1",o),d("n1","f1",o),d("n2","f2",o),d("n3","f3",o),d("n4","f4",o),d("p","n1",a),d("p","n2",a),d("p","n3",a),d("p","n4",a),d("u1","u2",c),d("u2","u3",c),d("u3","u1",c),d("c","t",l),d("p","c",u),d("cn1","cn2",u),d("cn3","cn4",u),d("cf1","cf2",u),d("cf3","cf4",u),e.setAttribute("position",new xn(i,3)),e.setAttribute("color",new xn(r,3)),super(e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}update(){const t=this.geometry,e=this.pointMap;$u.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Xu("c",e,t,$u,0,0,-1),Xu("t",e,t,$u,0,0,1),Xu("n1",e,t,$u,-1,-1,-1),Xu("n2",e,t,$u,1,-1,-1),Xu("n3",e,t,$u,-1,1,-1),Xu("n4",e,t,$u,1,1,-1),Xu("f1",e,t,$u,-1,-1,1),Xu("f2",e,t,$u,1,-1,1),Xu("f3",e,t,$u,-1,1,1),Xu("f4",e,t,$u,1,1,1),Xu("u1",e,t,$u,.7,1.1,-1),Xu("u2",e,t,$u,-.7,1.1,-1),Xu("u3",e,t,$u,0,2,-1),Xu("cf1",e,t,$u,-1,0,1),Xu("cf2",e,t,$u,1,0,1),Xu("cf3",e,t,$u,0,-1,1),Xu("cf4",e,t,$u,0,1,1),Xu("cn1",e,t,$u,-1,0,-1),Xu("cn2",e,t,$u,1,0,-1),Xu("cn3",e,t,$u,0,-1,-1),Xu("cn4",e,t,$u,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},t.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},t.CanvasTexture=Aa,t.CatmullRomCurve3=Ma,t.CineonToneMapping=3,t.CircleBufferGeometry=pa,t.CircleGeometry=pa,t.ClampToEdgeWrapping=d,t.Clock=Zl,t.Color=Ft,t.ColorKeyframeTrack=tl,t.CompressedTexture=ha,t.CompressedTextureLoader=class extends dl{constructor(t){super(t)}load(t,e,n,i){const r=this,s=[],o=new ha,a=new Al(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(r.withCredentials);let c=0;function l(l){a.load(t[l],(function(t){const n=r.parse(t,!0);s[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},c+=1,6===c&&(1===n.mipmapCount&&(o.minFilter=m),o.image=s,o.format=n.format,o.needsUpdate=!0,e&&e(o))}),n,i)}if(Array.isArray(t))for(let e=0,n=t.length;e<n;++e)l(e);else a.load(t,(function(t){const n=r.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<n.mipmapCount;t++)s[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+t]),s[e].format=n.format,s[e].width=n.width,s[e].height=n.height}o.image=s}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=m),o.format=n.format,o.needsUpdate=!0,e&&e(o)}),n,i);return o}},t.ConeBufferGeometry=ma,t.ConeGeometry=ma,t.CubeCamera=hi,t.CubeReflectionMapping=r,t.CubeRefractionMapping=s,t.CubeTexture=Ai,t.CubeTextureLoader=fl,t.CubeUVReflectionMapping=c,t.CubeUVRefractionMapping=l,t.CubicBezierCurve=Da,t.CubicBezierCurve3=Ba,t.CubicInterpolant=Yc,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=Sa,t.CurvePath=Qa,t.CustomBlending=5,t.CustomToneMapping=5,t.CylinderBufferGeometry=fa,t.CylinderGeometry=fa,t.Cylindrical=class{constructor(t=1,e=0,n=0){return this.radius=t,this.theta=e,this.y=n,this}set(t,e,n){return this.radius=t,this.theta=e,this.y=n,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}clone(){return(new this.constructor).copy(this)}},t.Data3DTexture=$t,t.DataArrayTexture=qt,t.DataTexture=Do,t.DataTexture2DArray=function(t,e,n,i){return console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),new qt(t,e,n,i)},t.DataTexture3D=function(t,e,n,i){return console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),new $t(t,e,n,i)},t.DataTextureLoader=ml,t.DataUtils=class{static toHalfFloat(t){t>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),t=65504),rd[0]=t;const e=sd[0];let n=e>>16&32768,i=e>>12&2047;const r=e>>23&255;return r<103?n:r>142?(n|=31744,n|=(255==r?0:1)&&8388607&e,n):r<113?(i|=2048,n|=(i>>114-r)+(i>>113-r&1),n):(n|=r-112<<10|i>>1,n+=1&i,n)}},t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=ul,t.DepthFormat=C,t.DepthStencilFormat=R,t.DepthTexture=Js,t.DirectionalLight=Ml,t.DirectionalLightHelper=class extends nn{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let i=new Un;i.setAttribute("position",new xn([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Wo({fog:!1,toneMapped:!1});this.lightPlane=new Jo(i,r),this.add(this.lightPlane),i=new Un,i.setAttribute("position",new xn([0,0,0,0,0,1],3)),this.targetLine=new Jo(i,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Wu.setFromMatrixPosition(this.light.matrixWorld),Ku.setFromMatrixPosition(this.light.target.matrixWorld),qu.subVectors(Ku,Wu),this.lightPlane.lookAt(Ku),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Ku),this.targetLine.scale.z=qu.length()}},t.DiscreteInterpolant=Xc,t.DodecahedronBufferGeometry=va,t.DodecahedronGeometry=va,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicBufferAttribute=function(t,e){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new _n(t,e).setUsage(dt)},t.DynamicCopyUsage=35050,t.DynamicDrawUsage=dt,t.DynamicReadUsage=35049,t.EdgesGeometry=wa,t.EdgesHelper=function(t,e){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new ea(new wa(t.geometry),new Wo({color:void 0!==e?e:16777215}))},t.EllipseCurve=Ta,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=o,t.EquirectangularRefractionMapping=a,t.Euler=Ve,t.EventDispatcher=pt,t.ExtrudeBufferGeometry=bc,t.ExtrudeGeometry=bc,t.FaceColors=1,t.FileLoader=Al,t.FlatShading=1,t.Float16BufferAttribute=In,t.Float32Attribute=function(t,e){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new xn(t,e)},t.Float32BufferAttribute=xn,t.Float64Attribute=function(t,e){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new On(t,e)},t.Float64BufferAttribute=On,t.FloatType=E,t.Fog=ro,t.FogExp2=io,t.Font=function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},t.FontLoader=function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},t.FramebufferTexture=da,t.FrontSide=0,t.Frustum=bi,t.GLBufferAttribute=Iu,t.GLSL1="100",t.GLSL3=ht,t.GreaterDepth=6,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=zu,t.Group=Ys,t.HalfFloatType=w,t.HemisphereLight=yl,t.HemisphereLightHelper=class extends nn{constructor(t,e,n){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const i=new Tc(e);i.rotateY(.5*Math.PI),this.material=new gn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=i.getAttribute("position"),s=new Float32Array(3*r.count);i.setAttribute("color",new _n(s,3)),this.add(new ni(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Gu.copy(this.light.color),Qu.copy(this.light.groundColor);for(let t=0,n=e.count;t<n;t++){const i=t<n/2?Gu:Qu;e.setXYZ(t,i.r,i.g,i.b)}e.needsUpdate=!0}t.lookAt(ju.setFromMatrixPosition(this.light.matrixWorld).negate())}},t.HemisphereLightProbe=ql,t.IcosahedronBufferGeometry=wc,t.IcosahedronGeometry=wc,t.ImageBitmapLoader=Ql,t.ImageLoader=pl,t.ImageUtils=Vt,t.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")},t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=Ho,t.InstancedBufferGeometry=Fl,t.InstancedInterleavedBuffer=Ru,t.InstancedMesh=zo,t.Int16Attribute=function(t,e){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Sn(t,e)},t.Int16BufferAttribute=Sn,t.Int32Attribute=function(t,e){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Cn(t,e)},t.Int32BufferAttribute=Cn,t.Int8Attribute=function(t,e){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new bn(t,e)},t.Int8BufferAttribute=bn,t.IntType=1013,t.InterleavedBuffer=oo,t.InterleavedBufferAttribute=co,t.Interpolant=qc,t.InterpolateDiscrete=Z,t.InterpolateLinear=tt,t.InterpolateSmooth=et,t.InvertStencilOp=5386,t.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},t.KeepStencilOp=lt,t.KeyframeTrack=Jc,t.LOD=Io,t.LatheBufferGeometry=Sc,t.LatheGeometry=Sc,t.Layers=je,t.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},t.LessDepth=2,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=vl,t.LightProbe=Dl,t.Line=Jo,t.Line3=Pu,t.LineBasicMaterial=Wo,t.LineCurve=Ua,t.LineCurve3=Fa,t.LineDashedMaterial=zc,t.LineLoop=na,t.LinePieces=1,t.LineSegments=ea,t.LineStrip=0,t.LinearEncoding=at,t.LinearFilter=m,t.LinearInterpolant=$c,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=v,t.LinearMipmapNearestFilter=g,t.LinearToneMapping=1,t.Loader=dl,t.LoaderUtils=Ul,t.LoadingManager=ll,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=mn,t.MaterialLoader=Bl,t.Math=Ct,t.MathUtils=Ct,t.Matrix3=It,t.Matrix4=Le,t.MaxEquation=104,t.Mesh=ni,t.MeshBasicMaterial=gn,t.MeshDepthMaterial=js,t.MeshDistanceMaterial=Gs,t.MeshFaceMaterial=function(t){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),t},t.MeshLambertMaterial=Gc,t.MeshMatcapMaterial=Qc,t.MeshNormalMaterial=jc,t.MeshPhongMaterial=Hc,t.MeshPhysicalMaterial=Fc,t.MeshStandardMaterial=Uc,t.MeshToonMaterial=Vc,t.MinEquation=103,t.MirroredRepeatWrapping=h,t.MixOperation=1,t.MultiMaterial=function(t=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),t.isMultiMaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},t.MultiplyBlending=4,t.MultiplyOperation=0,t.NearestFilter=A,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=f,t.NearestMipmapNearestFilter=p,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColors=0,t.NoToneMapping=0,t.NormalAnimationBlendMode=st,t.NormalBlending=1,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=el,t.Object3D=nn,t.ObjectLoader=class extends dl{constructor(t){super(t)}load(t,e,n,i){const r=this,s=""===this.path?Ul.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const o=new Al(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(t,(function(n){let s=null;try{s=JSON.parse(n)}catch(e){return void 0!==i&&i(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const o=s.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?r.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,i)}async loadAsync(t,e){const n=""===this.path?Ul.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||n;const i=new Al(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials);const r=await i.loadAsync(t,e),s=JSON.parse(r),o=s.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const n=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,i),s=this.parseImages(t.images,(function(){void 0!==e&&e(c)})),o=this.parseTextures(t.textures,s),a=this.parseMaterials(t.materials,o),c=this.parseObject(t.object,r,a,o,n),l=this.parseSkeletons(t.skeletons,c);if(this.bindSkeletons(c,l),void 0!==e){let t=!1;for(const e in s)if(s[e]instanceof HTMLImageElement){t=!0;break}!1===t&&e(c)}return c}async parseAsync(t){const e=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),i=this.parseGeometries(t.geometries,n),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),o=this.parseMaterials(t.materials,s),a=this.parseObject(t.object,i,o,s,e),c=this.parseSkeletons(t.skeletons,a);return this.bindSkeletons(a,c),a}parseShapes(t){const e={};if(void 0!==t)for(let n=0,i=t.length;n<i;n++){const i=(new Wa).fromJSON(t[n]);e[i.uuid]=i}return e}parseSkeletons(t,e){const n={},i={};if(e.traverse((function(t){t.isBone&&(i[t.uuid]=t)})),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new Fo).fromJSON(t[e],i);n[r.uuid]=r}return n}parseGeometries(t,e){const n={};if(void 0!==t){const i=new Hl;for(let r=0,s=t.length;r<s;r++){let s;const o=t[r];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":s=i.parse(o);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:o.type in Pc?s=Pc[o.type].fromJSON(o,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),!0===s.isBufferGeometry&&void 0!==o.userData&&(s.userData=o.userData),n[o.uuid]=s}}return n}parseMaterials(t,e){const n={},i={};if(void 0!==t){const r=new Bl;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];if("MultiMaterial"===s.type){const t=[];for(let e=0;e<s.materials.length;e++){const i=s.materials[e];void 0===n[i.uuid]&&(n[i.uuid]=r.parse(i)),t.push(n[i.uuid])}i[s.uuid]=t}else void 0===n[s.uuid]&&(n[s.uuid]=r.parse(s)),i[s.uuid]=n[s.uuid]}}return i}parseAnimations(t){const e={};if(void 0!==t)for(let n=0;n<t.length;n++){const i=t[n],r=ol.parse(i);e[r.uuid]=r}return e}parseImages(t,e){const n=this,i={};let r;function s(t){if("string"==typeof t){const e=t;return function(t){return n.manager.itemStart(t),r.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:n.resourcePath+e)}return t.data?{data:Lt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const n=new ll(e);r=new pl(n),r.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],r=n.url;if(Array.isArray(r)){const t=[];for(let e=0,n=r.length;e<n;e++){const n=s(r[e]);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new Do(n.data,n.width,n.height)))}i[n.uuid]=new jt(t)}else{const t=s(n.url);i[n.uuid]=new jt(t)}}}return i}async parseImagesAsync(t){const e=this,n={};let i;async function r(t){if("string"==typeof t){const n=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:e.resourcePath+n;return await i.loadAsync(r)}return t.data?{data:Lt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){i=new pl(this.manager),i.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.url;if(Array.isArray(s)){const t=[];for(let e=0,n=s.length;e<n;e++){const n=s[e],i=await r(n);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new Do(i.data,i.width,i.height)))}n[i.uuid]=new jt(t)}else{const t=await r(i.url);n[i.uuid]=new jt(t)}}}return n}parseTextures(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const i={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const o=e[s.image],a=o.data;let c;Array.isArray(a)?(c=new Ai,6===a.length&&(c.needsUpdate=!0)):(c=a&&a.data?new Do:new zt,a&&(c.needsUpdate=!0)),c.source=o,c.uuid=s.uuid,void 0!==s.name&&(c.name=s.name),void 0!==s.mapping&&(c.mapping=n(s.mapping,Vl)),void 0!==s.offset&&c.offset.fromArray(s.offset),void 0!==s.repeat&&c.repeat.fromArray(s.repeat),void 0!==s.center&&c.center.fromArray(s.center),void 0!==s.rotation&&(c.rotation=s.rotation),void 0!==s.wrap&&(c.wrapS=n(s.wrap[0],jl),c.wrapT=n(s.wrap[1],jl)),void 0!==s.format&&(c.format=s.format),void 0!==s.type&&(c.type=s.type),void 0!==s.encoding&&(c.encoding=s.encoding),void 0!==s.minFilter&&(c.minFilter=n(s.minFilter,Gl)),void 0!==s.magFilter&&(c.magFilter=n(s.magFilter,Gl)),void 0!==s.anisotropy&&(c.anisotropy=s.anisotropy),void 0!==s.flipY&&(c.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(c.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(c.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(c.userData=s.userData),i[s.uuid]=c}return i}parseObject(t,e,n,i,r){let s,o,a;function c(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function l(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];void 0===n[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(n[r])}return e}return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),n[t]}}function u(t){return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),i[t]}switch(t.type){case"Scene":s=new so,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new Ft(t.background):s.background=u(t.background)),void 0!==t.environment&&(s.environment=u(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new ro(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new io(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new ui(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Ni(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new kl(t.color,t.intensity);break;case"DirectionalLight":s=new Ml(t.color,t.intensity);break;case"PointLight":s=new Ol(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new Nl(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new Tl(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new yl(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new Dl).fromJSON(t);break;case"SkinnedMesh":o=c(t.geometry),a=l(t.material),s=new No(o,a),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":o=c(t.geometry),a=l(t.material),s=new ni(o,a);break;case"InstancedMesh":o=c(t.geometry),a=l(t.material);const e=t.count,n=t.instanceMatrix,i=t.instanceColor;s=new zo(o,a,e),s.instanceMatrix=new Ho(new Float32Array(n.array),16),void 0!==i&&(s.instanceColor=new Ho(new Float32Array(i.array),i.itemSize));break;case"LOD":s=new Io;break;case"Line":s=new Jo(c(t.geometry),l(t.material));break;case"LineLoop":s=new na(c(t.geometry),l(t.material));break;case"LineSegments":s=new ea(c(t.geometry),l(t.material));break;case"PointCloud":case"Points":s=new ca(c(t.geometry),l(t.material));break;case"Sprite":s=new So(l(t.material));break;case"Group":s=new Ys;break;case"Bone":s=new Po;break;default:s=new nn}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const o=t.children;for(let t=0;t<o.length;t++)s.add(this.parseObject(o[t],e,n,i,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const n=e[t];s.animations.push(r[n])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const n=e[t],i=s.getObjectByProperty("uuid",n.object);void 0!==i&&s.addLevel(i,n.distance)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const n=e[t.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(n,t.bindMatrix)}}))}setTexturePath(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}},t.ObjectSpaceNormalMap=1,t.OctahedronBufferGeometry=Tc,t.OctahedronGeometry=Tc,t.OneFactor=201,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=205,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=Ni,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.PMREMGenerator=Gi,t.ParametricGeometry=function(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new Un},t.Particle=function(t){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new So(t)},t.ParticleBasicMaterial=function(t){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new ia(t)},t.ParticleSystem=function(t,e){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new ca(t,e)},t.ParticleSystemMaterial=function(t){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new ia(t)},t.Path=za,t.PerspectiveCamera=ui,t.Plane=vi,t.PlaneBufferGeometry=Si,t.PlaneGeometry=Si,t.PlaneHelper=class extends Jo{constructor(t,e=1,n=16776960){const i=n,r=new Un;r.setAttribute("position",new xn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),r.computeBoundingSphere(),super(r,new Wo({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new Un;s.setAttribute("position",new xn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeBoundingSphere(),this.add(new ni(s,new gn({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(t)}},t.PointCloud=function(t,e){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new ca(t,e)},t.PointCloudMaterial=function(t){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new ia(t)},t.PointLight=Ol,t.PointLightHelper=class extends ni{constructor(t,e,n){super(new Ic(e,4,2),new gn({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},t.Points=ca,t.PointsMaterial=ia,t.PolarGridHelper=class extends ea{constructor(t=10,e=16,n=8,i=64,r=4473924,s=8947848){r=new Ft(r),s=new Ft(s);const o=[],a=[];for(let n=0;n<=e;n++){const i=n/e*(2*Math.PI),c=Math.sin(i)*t,l=Math.cos(i)*t;o.push(0,0,0),o.push(c,0,l);const u=1&n?r:s;a.push(u.r,u.g,u.b),a.push(u.r,u.g,u.b)}for(let e=0;e<=n;e++){const c=1&e?r:s,l=t-t/n*e;for(let t=0;t<i;t++){let e=t/i*(2*Math.PI),n=Math.sin(e)*l,r=Math.cos(e)*l;o.push(n,0,r),a.push(c.r,c.g,c.b),e=(t+1)/i*(2*Math.PI),n=Math.sin(e)*l,r=Math.cos(e)*l,o.push(n,0,r),a.push(c.r,c.g,c.b)}}const c=new Un;c.setAttribute("position",new xn(o,3)),c.setAttribute("color",new xn(a,3));super(c,new Wo({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},t.PolyhedronBufferGeometry=ga,t.PolyhedronGeometry=ga,t.PositionalAudio=class extends su{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(ou,au,cu),lu.set(0,0,1).applyQuaternion(au);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(ou.x,t),e.positionY.linearRampToValueAtTime(ou.y,t),e.positionZ.linearRampToValueAtTime(ou.z,t),e.orientationX.linearRampToValueAtTime(lu.x,t),e.orientationY.linearRampToValueAtTime(lu.y,t),e.orientationZ.linearRampToValueAtTime(lu.z,t)}else e.setPosition(ou.x,ou.y,ou.z),e.setOrientation(lu.x,lu.y,lu.z)}},t.PropertyBinding=Eu,t.PropertyMixer=du,t.QuadraticBezierCurve=Ha,t.QuadraticBezierCurve3=Va,t.Quaternion=Zt,t.QuaternionKeyframeTrack=il,t.QuaternionLinearInterpolant=nl,t.REVISION=e,t.RGBADepthPacking=3201,t.RGBAFormat=T,t.RGBAIntegerFormat=1033,t.RGBA_ASTC_10x10_Format=Y,t.RGBA_ASTC_10x5_Format=W,t.RGBA_ASTC_10x6_Format=K,t.RGBA_ASTC_10x8_Format=q,t.RGBA_ASTC_12x10_Format=$,t.RGBA_ASTC_12x12_Format=X,t.RGBA_ASTC_4x4_Format=U,t.RGBA_ASTC_5x4_Format=F,t.RGBA_ASTC_5x5_Format=H,t.RGBA_ASTC_6x5_Format=V,t.RGBA_ASTC_6x6_Format=j,t.RGBA_ASTC_8x5_Format=G,t.RGBA_ASTC_8x6_Format=Q,t.RGBA_ASTC_8x8_Format=z,t.RGBA_BPTC_Format=J,t.RGBA_ETC2_EAC_Format=B,t.RGBA_PVRTC_2BPPV1_Format=P,t.RGBA_PVRTC_4BPPV1_Format=N,t.RGBA_S3TC_DXT1_Format=x,t.RGBA_S3TC_DXT3_Format=O,t.RGBA_S3TC_DXT5_Format=L,t.RGBFormat=1022,t.RGB_ETC1_Format=36196,t.RGB_ETC2_Format=D,t.RGB_PVRTC_2BPPV1_Format=k,t.RGB_PVRTC_4BPPV1_Format=M,t.RGB_S3TC_DXT1_Format=I,t.RGFormat=1030,t.RGIntegerFormat=1031,t.RawShaderMaterial=Bc,t.Ray=Oe,t.Raycaster=class{constructor(t,e,n=0,i=1/0){this.ray=new Oe(t,e),this.near=n,this.far=i,this.camera=null,this.layers=new je,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,n=[]){return Ou(t,this,n,e),n.sort(xu),n}intersectObjects(t,e=!0,n=[]){for(let i=0,r=t.length;i<r;i++)Ou(t[i],this,n,e);return n.sort(xu),n}},t.RectAreaLight=Nl,t.RedFormat=1028,t.RedIntegerFormat=1029,t.ReinhardToneMapping=2,t.RepeatWrapping=u,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingBufferGeometry=Cc,t.RingGeometry=Cc,t.Scene=so,t.SceneUtils=od,t.ShaderChunk=Ti,t.ShaderLib=Ri,t.ShaderMaterial=ci,t.ShadowMaterial=Dc,t.Shape=Wa,t.ShapeBufferGeometry=Rc,t.ShapeGeometry=Rc,t.ShapePath=class{constructor(){this.type="ShapePath",this.color=new Ft,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new za,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,n,i){return this.currentPath.quadraticCurveTo(t,e,n,i),this}bezierCurveTo(t,e,n,i,r,s){return this.currentPath.bezierCurveTo(t,e,n,i,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t,e){function n(t){const e=[];for(let n=0,i=t.length;n<i;n++){const i=t[n],r=new Wa;r.curves=i.curves,e.push(r)}return e}function i(t,e){const n=e.length;let i=!1;for(let r=n-1,s=0;s<n;r=s++){let n=e[r],o=e[s],a=o.x-n.x,c=o.y-n.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(n=e[s],a=-a,o=e[r],c=-c),t.y<n.y||t.y>o.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=c*(t.x-n.x)-a*(t.y-n.y);if(0===e)return!0;if(e<0)continue;i=!i}}else{if(t.y!==n.y)continue;if(o.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=o.x)return!0}}return i}const r=vc.isClockWise,s=this.subPaths;if(0===s.length)return[];if(!0===e)return n(s);let o,a,c;const l=[];if(1===s.length)return a=s[0],c=new Wa,c.curves=a.curves,l.push(c),l;let u=!r(s[0].getPoints());u=t?!u:u;const d=[],h=[];let A,p,f=[],m=0;h[m]=void 0,f[m]=[];for(let e=0,n=s.length;e<n;e++)a=s[e],A=a.getPoints(),o=r(A),o=t?!o:o,o?(!u&&h[m]&&m++,h[m]={s:new Wa,p:A},h[m].s.curves=a.curves,u&&m++,f[m]=[]):f[m].push({h:a,p:A[0]});if(!h[0])return n(s);if(h.length>1){let t=!1,e=0;for(let t=0,e=h.length;t<e;t++)d[t]=[];for(let n=0,r=h.length;n<r;n++){const r=f[n];for(let s=0;s<r.length;s++){const o=r[s];let a=!0;for(let r=0;r<h.length;r++)i(o.p,h[r].p)&&(n!==r&&e++,a?(a=!1,d[r].push(o)):t=!0);a&&d[n].push(o)}}e>0&&!1===t&&(f=d)}for(let t=0,e=h.length;t<e;t++){c=h[t].s,l.push(c),p=f[t];for(let t=0,e=p.length;t<e;t++)c.holes.push(p[t].h)}return l}},t.ShapeUtils=vc,t.ShortType=1011,t.Skeleton=Fo,t.SkeletonHelper=Hu,t.SkinnedMesh=No,t.SmoothShading=2,t.Sphere=Ee,t.SphereBufferGeometry=Ic,t.SphereGeometry=Ic,t.Spherical=class{constructor(t=1,e=0,n=0){return this.radius=t,this.phi=e,this.theta=n,this}set(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(_t(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},t.SphericalHarmonics3=Pl,t.SplineCurve=ja,t.SpotLight=Tl,t.SpotLightHelper=class extends nn{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new Un,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,n=32;t<n;t++,e++){const r=t/n*Math.PI*2,s=e/n*Math.PI*2;i.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}n.setAttribute("position",new xn(i,3));const r=new Wo({fog:!1,toneMapped:!1});this.cone=new ea(n,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Du.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Du),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},t.Sprite=So,t.SpriteMaterial=lo,t.SrcAlphaFactor=204,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=ut,t.StaticReadUsage=35045,t.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new ui,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new ui,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,Jl.copy(t.projectionMatrix);const n=e.eyeSep/2,i=n*e.near/e.focus,r=e.near*Math.tan(gt*e.fov*.5)/e.zoom;let s,o;Xl.elements[12]=-n,$l.elements[12]=n,s=-r*e.aspect+i,o=r*e.aspect+i,Jl.elements[0]=2*e.near/(o-s),Jl.elements[8]=(o+s)/(o-s),this.cameraL.projectionMatrix.copy(Jl),s=-r*e.aspect-i,o=r*e.aspect-i,Jl.elements[0]=2*e.near/(o-s),Jl.elements[8]=(o+s)/(o-s),this.cameraR.projectionMatrix.copy(Jl)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Xl),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply($l)}},t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=rl,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronBufferGeometry=xc,t.TetrahedronGeometry=xc,t.TextGeometry=function(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new Un},t.Texture=zt,t.TextureLoader=gl,t.TorusBufferGeometry=Oc,t.TorusGeometry=Oc,t.TorusKnotBufferGeometry=Lc,t.TorusKnotGeometry=Lc,t.Triangle=pn,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeBufferGeometry=Mc,t.TubeGeometry=Mc,t.UVMapping=i,t.Uint16Attribute=function(t,e){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Tn(t,e)},t.Uint16BufferAttribute=Tn,t.Uint32Attribute=function(t,e){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Rn(t,e)},t.Uint32BufferAttribute=Rn,t.Uint8Attribute=function(t,e){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new En(t,e)},t.Uint8BufferAttribute=En,t.Uint8ClampedAttribute=function(t,e){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new wn(t,e)},t.Uint8ClampedBufferAttribute=wn,t.Uniform=Cu,t.UniformsLib=Ci,t.UniformsUtils=ai,t.UnsignedByteType=y,t.UnsignedInt248Type=S,t.UnsignedIntType=b,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShortType=_,t.VSMShadowMap=3,t.Vector2=Rt,t.Vector3=te,t.Vector4=Wt,t.VectorKeyframeTrack=sl,t.Vertex=function(t,e,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new te(t,e,n)},t.VertexColors=2,t.VideoTexture=ua,t.WebGL1Renderer=no,t.WebGL3DRenderTarget=Xt,t.WebGLArrayRenderTarget=Yt,t.WebGLCubeRenderTarget=pi,t.WebGLMultipleRenderTargets=Jt,t.WebGLMultisampleRenderTarget=function(t,e,n){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.');const i=new Kt(t,e,n);return i.samples=4,i},t.WebGLRenderTarget=Kt,t.WebGLRenderTargetCube=function(t,e,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new pi(t,n)},t.WebGLRenderer=eo,t.WebGLUtils=Ks,t.WireframeGeometry=kc,t.WireframeHelper=function(t,e){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new ea(new kc(t.geometry),new Wo({color:void 0!==e?e:16777215}))},t.WrapAroundEnding=rt,t.XHRLoader=function(t){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Al(t)},t.ZeroCurvatureEnding=nt,t.ZeroFactor=200,t.ZeroSlopeEnding=it,t.ZeroStencilOp=0,t._SRGBAFormat=At,t.sRGBEncoding=ct,Object.defineProperty(t,"__esModule",{value:!0})}));
/**
 * @license beta-bhere-development v1.0.33-canary.0
 * (c) 2023 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
var BHere=function(t,e,n,i,r,s){function o(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var a=o(s);const c='\n\x3c!-- service --\x3e\n<div class="group--service">\n\t<button type="button" class="btn--back" [title]="\'title_back\' | label" (click)="onBack($event)" *if="isBackButtonVisible">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t</button>\n\t<button type="button" class="btn--view-mode" [title]="\'title_view_mode\' | label" (click)="toggleMode($event)" *if="state.mode != \'embed\'">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == \'virtual-tour\'"><use xlink:href="#live-meeting"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == \'live-meeting\'"><use xlink:href="#virtual-tour"></use></svg>\n\t</button>\n\t<button type="button" class="btn--volume" [title]="\'title_volume\' | label" [class]="{ muted: state.volumeMuted }" (click)="toggleVolume($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.volumeMuted"><use xlink:href="#volume-on"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.volumeMuted"><use xlink:href="#volume-off"></use></svg>\n\t</button>\n\t<button type="button" class="btn--fullscreen" [title]="\'title_fullscreen\' | label" [class]="{ muted: state.fullScreen }" (click)="toggleFullScreen($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.fullScreen"><use xlink:href="#fullscreen-on"></use></svg>\n\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.fullScreen"><use xlink:href="#fullscreen-off"></use></svg>\n\t</button>\n\t<button type="button" class="btn--navmap" [title]="\'title_navmap\' | label" [class]="{ active: state.showNavmap }" (click)="toggleNavmap($event)" *if="navmap && state.mode != \'live-meeting\'">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navmap"></use></svg>\n\t</button>\n</div>\n',l='\n\x3c!-- controls --\x3e\n<div class="group--controls" *if="state.live">\n\t<div class="group--actions">\n\t\t<button type="button" class="btn--call" [title]="\'title_disconnect\' | label" (click)="disconnect()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#call"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--cam" [title]="\'title_mute_camera\' | label" [class]="{ muted: state.cameraMuted, disabled: !local }" (click)="toggleCamera()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--mic" [title]="\'title_mute_mic\' | label" [class]="{ muted: state.audioMuted, disabled: !local || silenced }" (click)="toggleAudio()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--screen" [title]="\'title_share_screen\' | label" [class]="{ active: screen }" (click)="toggleScreen()" *if="(\'screenShare\' | flag) && (state.role == \'publisher\' || state.role == \'attendee\' || controlling)">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#screen"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--chat" [title]="\'title_chat\' | label" [class]="{ active: state.chatDirty }" (click)="toggleChat()" *if="(\'chat\' | flag)">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#chat"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--navinfo" [title]="\'title_navinfo\' | label" [class]="{ active: state.showNavInfo }" (click)="toggleNavInfo()" *if="showNavInfoToggler">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navinfo"></use></svg>\n\t\t</button>\n\t</div>\n</div>\n',u='\n\x3c!-- media --\x3e\n<div class="group--media" media-player>\n\t<button type="button" class="btn--play" [title]="\'title_play\' | label" (click)="onPlay()" *if="!playing">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#play"></use></svg>\n\t</button>\n\t<button type="button" class="btn--pause" [title]="\'title_pause\' | label" (click)="onPause()" *if="playing">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#pause"></use></svg>\n\t</button>\n\t<div class="track" (click)="onTrack($event)">\n\t\t<div class="track__progress" [style]="{ transform: \'scale(\' + this.progress + \', 1)\'}"></div>\n\t</div>\n</div>\n',d='\n\x3c!-- ar-vr --\x3e\n<div class="group--ar-vr">\n\t<button type="button" class="btn--ar" [title]="\'title_ar\' | label" [href]="view?.ar" (click)="tryInAr()" *if="view?.ar">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#ar"></use></svg> <span>Try in AR</span>\n\t</button>\n\t<button type="button" class="btn--vr" [title]="\'title_vr\' | label" [class]="{ disabled: vrService.isDisabled() }" (click)="vrService.toggleVR()">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#vr"></use></svg> <span [innerHTML]="vrService.getLabel()"></span>\n\t</button>\n</div>\n',h='\n\x3c!-- like --\x3e\n<div class="group--heart" *if="view && (\'like\' | flag)">\n\t<svg class="love" [class]="{ active: view.showLove }" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#heart"></use></svg>\n\t<button type="button" class="btn--heart" [class]="{ active: view.showLove }" (click)="addLike($event)">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#heart"></use></svg>\n\t\t<span class="badge" [innerHTML]="view.likes" *if="view.likes"></span>\n\t</button>\n</div>\n<div class="group--spacer" *if="!view || !(\'like\' | flag)"></div>\n',A='\n\x3c!-- chat --\x3e\n<div class="group--chat" *if="state.chat" agora-chat (close)="onChatClose()"></div>\n',p='\n\x3c!-- lock --\x3e\n<div class="ui__lock" [class]="{ spying: spying }" *if="locked || controlling"></div>\n',f='\n\x3c!-- navmap --\x3e\n<div class="group--navmap" *if="navmap && state.showNavmap && state.mode != \'live-meeting\'">\n\t<img draggable="false" [src]="navmap.asset | asset" *if="navmap.asset" />\n\t<div class="navmap__item" [style]="{ left: item.position[0] * 100 + \'%\', top: item.position[1] * 100 + \'%\' }" (click)="onNavmapItem(item)" *for="let item of navmap.items">\n\t\t<img draggable="false" [src]="\'textures/ui/nav-point.png\' | asset" />\n\t\t<div class="title" [innerHTML]="item.title" *if="item.title"></div>\n\t</div>\n</div>\n',m="\n\x3c!-- background --\x3e\n<div class=\"background\" [class]=\"{ 'background--image': ('background.image' | env), 'background--video': ('background.video' | env) }\" *if=\"state.status != 'connected'\">\n\t<img [src]=\"'background.image' | env | asset\" *if=\"'background.image' | env\" />\n\t<video [src]=\"'background.video' | env | asset\" *if=\"'background.video' | env\" oncanplay=\"this.muted = true; this.classList.add('ready');\" playsinline autoplay muted loop></video>\n</div>\n",g='\n\x3c!-- logo --\x3e\n<a class="btn--logo" [routerLink]="\':lang.access\' | route" *if="state.status != \'connected\'">\n\t<img [src]="\'logo\' | env" *if="\'logo\' | env" />\n\t<svg viewBox="0 0 270 98" *if="!(\'logo\' | env)"><use xlink:href="#b-here"></use></svg>\n</a>\n',v='\n\x3c!-- credits --\x3e\n<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener" *if="state.status != \'connected\'">\n\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n</a>\n',y='\n\x3c!-- copyright --\x3e\n<span *if="\'gdprRoutes\' | flag"> <span [innerHTML]="\'copyright\' | label"></span> <span *if="\'privacy_policy\' | label">-</span> <a [routerLink]="\':lang.privacy\' | route" class="btn--colophon" [innerHTML]="\'privacy_policy\' | label"></a> <span *if="\'terms_of_service\' | label">-</span> <a [routerLink]="\':lang.terms\' | route" class="btn--colophon" [innerHTML]="\'terms_of_service\' | label"></a></span>\n',_='\n\x3c!-- language --\x3e\n<div class="group--language" language *if="state.status != \'connected\'"></div>\n',b=`\n\x3c!-- Virtual Tour --\x3e\n<div class="ui virtual-tour" [class]="uiClass" *if="state.status == 'connected' && isVirtualTourUser">\n\t\x3c!-- world --\x3e\n\t<div class="ui__body">\n\t\t<div class="world" world [view]="view" [views]="pathViews" (navTo)="onNavTo($event)" (navLink)="onNavLink($event)"></div>\n\t</div>\n\t\n\x3c!-- remote sidebar --\x3e\n<div class="group--remote" [class]="remoteClass" *if="state.live">\n\t<div class="agora-stream" (toggleControl)="onToggleControl($event)" (toggleSpy)="onToggleSpy($event)" agora-stream [stream]="remote" type="remote" *for="let remote of remotes">\n\t\t<div class="agora-stream__player"></div>\n\t\t<div class="agora-stream__info" [class]="{ spyed: state.spying == streamId, controlling: state.controlling == streamId }">\n\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t<div class="id" [innerHTML]="stream.clientInfo.name || streamId" *if="stream.clientInfo"></div>\n\t\t\t<button type="button" class="btn--control" [title]="'title_control' | label" (click)="onToggleControl(streamId)" *if="state.role === 'publisher'">\n\t\t\t\t<svg class="control" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#control"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="btn--spy" [title]="'title_spy' | label" (click)="onToggleSpy(streamId)" *if="state.role === 'publisher'">\n\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#spy"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t<div class="group--members" *if="state.mode == 'virtual-tour'">\n\t\t<div class="members" *if="state.role === 'publisher'">\n\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t\t</div>\n\t\t<div class="credits">\n\t\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</div>\n\x3c!-- remote screen --\x3e\n<div class="group--remote-screen" *if="remoteScreen">\n\t<div class="agora-stream" agora-stream [stream]="remoteScreen" type="remote">\n\t\t<div class="agora-stream__player"></div>\n\t\t<div class="agora-stream__info">\n\t\t\t<div class="id" [innerHTML]="stream.clientInfo.name || streamId" *if="stream.clientInfo"></div>\n\t\t</div>\n\t</div>\n</div>\n\n\t<div class="group--header">\n\t\t${c}\n\t\t\n\x3c!-- local streams --\x3e\n<div class="group--local" [class]="{ publisher: state.role == 'publisher', viewer: state.role == 'viewer' }" *if="state.live">\n\t<button type="button" class="btn--silence" [title]="'title_silence' | label" [class]="{ active: state.silencing }" (click)="onToggleSilence()" *if="state.role === 'publisher'">\n\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t</button>\n\t<button type="button" class="btn--control" [title]="'title_control' | label" [class]="{ active: state.controlling == state.uid }" (click)="onToggleControl(state.uid)" *if="state.role == 'publisher'">\n\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#control"></use></svg>\n\t</button>\n\t<div class="agora-stream" *if="!local"></div>\n\t<div class="agora-stream" agora-stream [stream]="local" type="local" *if="local">\n\t\t<div class="agora-stream__player"></div>\n\t\t<div class="agora-stream__info">\n\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t</div>\n\t</div>\n\t<div class="agora-stream agora-stream--screen" agora-stream [stream]="screen" type="local" *if="screen && hasScreenViewItem">\n\t\t<div class="agora-stream__player"></div>\n\t</div>\n</div>\n\n\t</div>\n\t<div class="group--footer">\n\t\t${l}\n\t\t${u}\n\t\t${d}\n\t\t${h}\n\t</div>\n\t\n\x3c!-- members --\x3e\n<div class="group--members" *if="state.mode == 'live-meeting'">\n\t<div class="members" *if="state.role === 'publisher'">\n\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t</div>\n\t<div class="credits">\n\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t</a>\n\t</div>\n</div>\n\n\t${A}\n\t${p}\n\t${f}\n</div>\n`,E=`\n\x3c!-- Self Service Tour --\x3e\n<div class="ui" [class]="uiClass" *if="state.status == 'connected' && state.mode == 'self-service-tour'">\n\t\x3c!-- world --\x3e\n\t<div class="ui__body">\n\t\t<div class="world" world [view]="view" [views]="pathViews" (navTo)="onNavTo($event)" (navLink)="onNavLink($event)"></div>\n\t</div>\n\t<div class="group--header">\n\t\t${c}\n\t</div>\n\t<div class="group--footer">\n\t\t<div class="group--spacer"></div>\n\t\t${u}\n\t\t${d}\n\t\t${h}\n\t</div>\n\t${f}\n</div>\n`,w=`\n\x3c!-- Embed --\x3e\n<div class="ui" [class]="uiClass" *if="state.status == 'connected' && state.mode == 'embed'">\n\t\x3c!-- world --\x3e\n\t<div class="ui__body">\n\t\t<div class="world" world [view]="view" [views]="pathViews" (navTo)="onNavTo($event)" (navLink)="onNavLink($event)"></div>\n\t</div>\n\t<div class="group--header">\n\t\t${c}\n\t</div>\n\t<div class="group--footer">\n\t\t<div class="group--spacer"></div>\n\t\t${u}\n\t\t${d}\n\t\t${h}\n\t</div>\n</div>\n`;class S{static merge(t,e){return null===e?e:t?(e&&"object"==typeof e&&Object.keys(e).forEach((n=>{const i=e[n];"object"!=typeof i||Array.isArray(i)?t[n]=i:t[n]=this.merge(t[n],i)})),t):e&&"object"==typeof e?Object.assign({},e):e}}const T="undefined"!=typeof module&&module.exports,C=null!=(T?{get:()=>{}}:new URLSearchParams(window.location.search)).get("debug");!T&&document.querySelector("base").getAttribute("href");const R=!T&&(window&&-1!==window.location.host.indexOf("herokuapp")),I=!T&&(window&&-1!==window.location.host.indexOf("vercel.app")),x=R||I,O=!T&&(x||window&&("41789"===window.location.port||"5000"===window.location.port||"6443"===window.location.port||"actarian.github.io"===window.location.host)),L=!T&&(window&&-1!==["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.host.split(":")[0])),M={STATIC:O,DEVELOPMENT:L,PRODUCTION:!L};const k={channelName:"BHere",flags:{heroku:R,vercel:I,deployed:x},navs:{iconMinScale:1,iconMaxScale:1.4},url:{},languages:["it","en"],defaultLanguage:"it",labels:{},data:{},fields:[]},N=window.STATIC?{appKey:"8b0cae93d47a44e48e97e7fd0404be4e",channelName:"BHere",flags:{production:!1,useProxy:!0,useToken:!1,usePrefetch:!0,useExtendedUserInfo:!0,useEncryptedUrl:!0,gdprRoutes:!0,selfService:!0,guidedTourRequest:!0,guidedTourAccess:!0,ssoLogin:!1,ssoRegister:!1,editor:!0,editorAssetScreen:!0,menu:!0,menuEmbed:!0,navmaps:!0,screenShare:!0,chat:!0,ar:!0,like:!0,hideNavInfo:!0,useIframe:!0,attendee:!0,streamer:!0,viewer:!0,smartDevice:!0,selfServiceProposition:!1,navInfoAnimated:!1,navInfoImportantAnimated:!1,navMoveAnimated:!0,navMoveImportantAnimated:!0,navPointAnimated:!1,navPointImportantAnimated:!1,navTitleAnimated:!1,navTitleImportantAnimated:!1,navTransparentAnimated:!0,navTransparentImportantAnimated:!0,useTextureEnvironment:!0,usePaths:!0,antialias:!0,alpha:!1,premultipliedAlpha:!1},sso:{issuer:"bhere-sso",origin:"http://localhost:3010",loginUrl:"http://localhost:3010/sso/login?redirectUrl={redirectUrl}",logoutUrl:"http://localhost:3010/sso/logout?redirectUrl={redirectUrl}",registerUrl:"http://localhost:3010/sso/register?redirectUrl={redirectUrl}",verifyTokenUrl:"http://localhost:3010/sso/verifytoken?verifyToken={verifytoken}"},navs:{iconMinScale:1,iconMaxScale:1.4},profiles:{streamer:"480p_2",attendee:"1080p_2",publisher:"1080p_2",screen:"1080p_2"},logo:null,selfServiceAudio:null,colors:{menuBackground:"#000000",menuForeground:"#ffffff",menuOverBackground:"#0099ff",menuOverForeground:"#ffffff",menuBackBackground:"#0099ff",menuBackForeground:"#000000",menuBackOverBackground:"#0099ff",menuBackOverForeground:"#ffffff"},editor:{disabledViewTypes:["waiting-room"],disabledViewItemTypes:["texture"]},assets:"/docs/",dist:"/dist/",workers:{image:"./js/workers/image.service.worker.js",prefetch:"./js/workers/prefetch.service.worker.js"},textures:{envMap:"textures/envMap/studio_small_03_2k.hdr",grid:"textures/grid/grid.jpg"},toneMappingExposure:1,githubDocs:"https://raw.githubusercontent.com/actarian/b-here/beta-bhere-sso/docs/",template:{email:{supportRequest:"/email/support-request.html"}}}:{appKey:"8b0cae93d47a44e48e97e7fd0404be4e",channelName:"BHere",flags:{production:!0,useProxy:!1,useToken:!1,usePrefetch:!0,useExtendedUserInfo:!1,useEncryptedUrl:!1,gdprRoutes:!1,selfService:!0,guidedTourRequest:!0,guidedTourAccess:!0,ssoLogin:!1,ssoRegister:!1,editor:!1,editorAssetScreen:!1,menu:!0,menuEmbed:!1,navmaps:!1,screenShare:!1,chat:!1,ar:!0,like:!0,hideNavInfo:!0,useIframe:!0,attendee:!0,streamer:!0,viewer:!0,smartDevice:!0,selfServiceProposition:!1,navInfoAnimated:!1,navInfoImportantAnimated:!1,navMoveAnimated:!1,navMoveImportantAnimated:!1,navPointAnimated:!1,navPointImportantAnimated:!1,navTitleAnimated:!1,navTitleImportantAnimated:!1,navTransparentAnimated:!1,navTransparentImportantAnimated:!1,useTextureEnvironment:!0,usePaths:!1,antialias:!0,alpha:!1,premultipliedAlpha:!1},navs:{iconMinScale:1,iconMaxScale:1.4},profiles:{streamer:"480p_2",attendee:"1080p_2",publisher:"1080p_2",screen:"720p_2"},logo:null,selfServiceAudio:null,colors:{menuBackground:"#000000",menuForeground:"#ffffff",menuOverBackground:"#0099ff",menuOverForeground:"#ffffff",menuBackBackground:"#0099ff",menuBackForeground:"#000000",menuBackOverBackground:"#0099ff",menuBackOverForeground:"#ffffff"},editor:{disabledViewTypes:["waiting-room","room-3d","media"],disabledViewItemTypes:["texture"]},assets:"/Modules/B-Here/Client/docs/",dist:"/Modules/B-Here/Client/dist/",workers:{image:"/Modules/B-Here/Client/docs/js/workers/image.service.worker.js",prefetch:"/Modules/B-Here/Client/docs/js/workers/prefetch.service.worker.js"},textures:{envMap:"textures/envMap/studio_small_03_2k.hdr",grid:"textures/grid/grid.jpg"},toneMappingExposure:1,githubDocs:"https://raw.githubusercontent.com/actarian/b-here/beta-bhere-sso/docs/",template:{email:{supportRequest:"/template/modules/b-here/email/support-request.cshtml"}}};let P=Object.assign({port:5e3,fontFamily:"Work Sans, sans-serif",colors:{menuBackground:"#000000",menuForeground:"#ffffff",menuOverBackground:"#0099ff",menuOverForeground:"#ffffff",menuBackBackground:"#0099ff",menuBackForeground:"#000000",menuBackOverBackground:"#0099ff",menuBackOverForeground:"#ffffff"},editor:{disabledViewTypes:["waiting-room","room-3d","media"],disabledViewItemTypes:["texture"]},renderOrder:{panorama:0,room:10,plane:20,tile:30,model:40,banner:50,nav:60,panel:70,menu:80,debug:90,pointer:100}},k,N);P=S.merge(P,window.bhere);const D=new class{get STATIC(){return M.STATIC}set STATIC(t){M.STATIC=!0===t||"true"===t,console.log("Environment.STATIC.set",M.STATIC)}get href(){return x?this.githubDocs:this.assets}getAbsoluteUrl(t,e){let n=`${window.location.origin}${t}`;return Object.keys(e).forEach((t=>{n=n.replace(`$${t}`,e[t])})),n}getPath(t){return this.isLocal(t)?this.href+t:t}isLocal(t){return-1===t.indexOf("://")}merge(t){t&&S.merge(this,t)}constructor(t){t&&Object.assign(this,t)}}(P);console.log("environment",D);
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */
var B=function(){return B=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},B.apply(this,arguments)},U=function(){return U=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},U.apply(this,arguments)},F=function(t){return void 0===t&&(t={}),{arrayFormat:t.arrayFormat||"none",booleanFormat:t.booleanFormat||"none",nullFormat:t.nullFormat||"default"}},H=function(t){return encodeURIComponent(t)},V=function(t){return decodeURIComponent(t)},j=function(t,e,n){return null===e?function(t,e){return"hidden"===e.nullFormat?"":"string"===e.nullFormat?t+"=null":t}(t,n):"boolean"==typeof e?function(t,e,n){return"empty-true"===n.booleanFormat&&e?t:t+"="+("unicode"===n.booleanFormat?e?"â":"â":e.toString())}(t,e,n):Array.isArray(e)?function(t,e,n){var i=function(t){return"index"===t.arrayFormat?function(t,e){return t+"["+e+"]"}:"brackets"===t.arrayFormat?function(t){return t+"[]"}:function(t){return t}}(n);return e.map((function(e,n){return i(t,n)+"="+H(e)})).join("&")}(t,e,n):t+"="+H(e)},G=function(t){var e=t.indexOf("?");return-1===e?t:t.slice(e+1)},Q=function(t){var e=t.indexOf("["),n=-1!==e;return{hasBrackets:n,name:n?t.slice(0,e):t}},z=function(t,e){var n=F(e);return G(t).split("&").reduce((function(t,e){var i=e.split("="),r=i[0],s=i[1],o=Q(r),a=o.hasBrackets,c=o.name,l=t[c],u=function(t,e){if(void 0===t)return"empty-true"===e.booleanFormat||null;if("string"===e.booleanFormat){if("true"===t)return!0;if("false"===t)return!1}if("unicode"===e.booleanFormat){if("â"===V(t))return!0;if("â"===V(t))return!1}return"string"===e.nullFormat&&"null"===t?null:V(t)}(s,n);return t[c]=void 0===l?a?[u]:u:(Array.isArray(l)?l:[l]).concat(u),t}),{})},W=function(t,e){var n=F(e);return Object.keys(t).filter((function(e){return void 0!==t[e]})).map((function(e){return j(e,t[e],n)})).filter(Boolean).join("&")},K=/[^!$'()*+,;|:]/g,q=function(t){return t.replace(K,(function(t){return encodeURIComponent(t)}))},Y={default:q,uri:encodeURI,uriComponent:encodeURIComponent,none:function(t){return t},legacy:encodeURI},$={default:decodeURIComponent,uri:decodeURI,uriComponent:decodeURIComponent,none:function(t){return t},legacy:decodeURIComponent},X=function(t,e,n){var i=Y[e]||q;return n?String(t).split("/").map(i).join("/"):i(String(t))},J=function(t){return"("+(t?t.replace(/(^<|>$)/g,""):"[a-zA-Z0-9-_.~%':|=+\\*@$]+")+")"},Z=[{name:"url-parameter",pattern:/^:([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(t){return new RegExp(J(t[2]))}},{name:"url-parameter-splat",pattern:/^\*([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/,regex:/([^?]*)/},{name:"url-parameter-matrix",pattern:/^;([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})(<(.+?)>)?/,regex:function(t){return new RegExp(";"+t[1]+"="+J(t[2]))}},{name:"query-parameter",pattern:/^(?:\?|&)(?::)?([a-zA-Z0-9-_]*[a-zA-Z0-9]{1})/},{name:"delimiter",pattern:/^(\/|\?)/,regex:function(t){return new RegExp("\\"+t[0])}},{name:"sub-delimiter",pattern:/^(!|&|-|_|\.|;)/,regex:function(t){return new RegExp(t[0])}},{name:"fragment",pattern:/^([0-9a-zA-Z]+)/,regex:function(t){return new RegExp(t[0])}}],tt=function t(e,n){if(void 0===n&&(n=[]),!Z.some((function(i){var r=e.match(i.pattern);return!!r&&(n.push({type:i.name,match:r[0],val:r.slice(1,2),otherVal:r.slice(2),regex:i.regex instanceof Function?i.regex(r):i.regex}),r[0].length<e.length&&(n=t(e.substr(r[0].length),n)),!0)})))throw new Error("Could not parse path '"+e+"'");return n},et=function(t){return null!=t},nt={urlParamsEncoding:"default"},it=function(){function t(t,e){if(!t)throw new Error("Missing path in Path constructor");this.path=t,this.options=U(U({},nt),e),this.tokens=tt(t),this.hasUrlParams=this.tokens.filter((function(t){return/^url-parameter/.test(t.type)})).length>0,this.hasSpatParam=this.tokens.filter((function(t){return/splat$/.test(t.type)})).length>0,this.hasMatrixParams=this.tokens.filter((function(t){return/matrix$/.test(t.type)})).length>0,this.hasQueryParams=this.tokens.filter((function(t){return/^query-parameter/.test(t.type)})).length>0,this.spatParams=this.getParams("url-parameter-splat"),this.urlParams=this.getParams(/^url-parameter/),this.queryParams=this.getParams("query-parameter"),this.params=this.urlParams.concat(this.queryParams),this.source=this.tokens.filter((function(t){return void 0!==t.regex})).map((function(t){return t.regex.source})).join("")}return t.createPath=function(e,n){return new t(e,n)},t.prototype.isQueryParam=function(t){return-1!==this.queryParams.indexOf(t)},t.prototype.isSpatParam=function(t){return-1!==this.spatParams.indexOf(t)},t.prototype.test=function(t,e){var n=this,i=U(U({caseSensitive:!1,strictTrailingSlash:!1},this.options),e),r=function(t,e){return e||"\\/"===t?t:t.replace(/\\\/$/,"")+"(?:\\/)?"}(this.source,i.strictTrailingSlash),s=this.urlTest(t,r+(this.hasQueryParams?"(\\?.*$|$)":"$"),i.caseSensitive,i.urlParamsEncoding);if(!s||!this.hasQueryParams)return s;var o=z(t,i.queryParams);return 0===Object.keys(o).filter((function(t){return!n.isQueryParam(t)})).length?(Object.keys(o).forEach((function(t){return s[t]=o[t]})),s):null},t.prototype.partialTest=function(t,e){var n=this,i=U(U({caseSensitive:!1,delimited:!0},this.options),e),r=function(t,e){return e?/(\/)$/.test(t)?t:t+"(\\/|\\?|\\.|;|$)":t}(this.source,i.delimited),s=this.urlTest(t,r,i.caseSensitive,i.urlParamsEncoding);if(!s)return s;if(!this.hasQueryParams)return s;var o=z(t,i.queryParams);return Object.keys(o).filter((function(t){return n.isQueryParam(t)})).forEach((function(t){return function(t,e,n){void 0===n&&(n="");var i=t[e];return t[e]=void 0===i?n:Array.isArray(i)?i.concat(n):[i,n],t}(s,t,o[t])})),s},t.prototype.build=function(t,e){var n=this;void 0===t&&(t={});var i=U(U({ignoreConstraints:!1,ignoreSearch:!1,queryParams:{}},this.options),e),r=Object.keys(t).filter((function(t){return!n.isQueryParam(t)})).reduce((function(e,r){if(!et(t[r]))return e;var s=t[r],o=n.isSpatParam(r);return"boolean"==typeof s?e[r]=s:Array.isArray(s)?e[r]=s.map((function(t){return X(t,i.urlParamsEncoding,o)})):e[r]=X(s,i.urlParamsEncoding,o),e}),{});if(this.urlParams.some((function(e){return!et(t[e])}))){var s=this.urlParams.filter((function(e){return!et(t[e])}));throw new Error("Cannot build path: '"+this.path+"' requires missing parameters { "+s.join(", ")+" }")}if(!i.ignoreConstraints&&!this.tokens.filter((function(t){return/^url-parameter/.test(t.type)&&!/-splat$/.test(t.type)})).every((function(t){return new RegExp("^"+J(t.otherVal[0])+"$").test(r[t.val])})))throw new Error("Some parameters of '"+this.path+"' are of invalid format");var o=this.tokens.filter((function(t){return!1===/^query-parameter/.test(t.type)})).map((function(t){return"url-parameter-matrix"===t.type?";"+t.val+"="+r[t.val[0]]:/^url-parameter/.test(t.type)?r[t.val[0]]:t.match})).join("");if(i.ignoreSearch)return o;var a=this.queryParams.filter((function(e){return-1!==Object.keys(t).indexOf(e)})).reduce((function(e,n){return e[n]=t[n],e}),{}),c=W(a,i.queryParams);return c?o+"?"+c:o},t.prototype.getParams=function(t){var e=t instanceof RegExp?function(e){return t.test(e.type)}:function(e){return e.type===t};return this.tokens.filter(e).map((function(t){return t.val[0]}))},t.prototype.urlTest=function(t,e,n,i){var r=this,s=new RegExp("^"+e,n?"":"i"),o=t.match(s);return o?this.urlParams.length?o.slice(1,this.urlParams.length+1).reduce((function(t,e,n){return t[r.urlParams[n]]=($[i]||decodeURIComponent)(e),t}),{}):{}:null},t}(),rt=function(t){var e="";return t.reduce((function(t,n){var i,r,s,o,a=null!=(r=null===(i=n.parser)||void 0===i?void 0:i.urlParams.reduce((function(t,e){return t[e]="url",t}),{}))?r:{},c=null!=(o=null===(s=n.parser)||void 0===s?void 0:s.queryParams.reduce((function(t,e){return t[e]="query",t}),a))?o:{};return void 0!==n.name&&(t[e=e?e+"."+n.name:n.name]=c),t}),{})},st=function t(e,n,i,r,s){void 0===r&&(r={});for(var o=r.queryParamsMode,a=void 0===o?"default":o,c=r.strictTrailingSlash,l=void 0!==c&&c,u=r.strongMatching,d=void 0===u||u,h=r.caseSensitive,A=void 0!==h&&h,p=1===e.length&&""===e[0].name,f=function(e){var o,c=null,u=void 0,h=n;if("/"===s&&"/"===e.path&&(h="/"+n),e.children.length||(c=e.parser.test(h,{caseSensitive:A,strictTrailingSlash:l,queryParams:r.queryParams,urlParamsEncoding:r.urlParamsEncoding})),c||(c=e.parser.partialTest(h,{delimited:d,caseSensitive:A,queryParams:r.queryParams,urlParamsEncoding:r.urlParamsEncoding})),c){var f=e.parser.build(c,{ignoreSearch:!0,urlParamsEncoding:r.urlParamsEncoding});l||e.children.length||(f=f.replace(/\/$/,"")),u=0===h.toLowerCase().indexOf(f.toLowerCase())?h.slice(f.length):h,l||e.children.length||(u=u.replace(/^\/\?/,"?"));var m=function(t,e,n){var i=F(n);if(""===G(t))return{querystring:"",removedParams:{}};var r=t.split("&").reduce((function(t,n){var i=t[0],r=t[1],s=n.split("=")[0],o=Q(s).name;return-1===e.indexOf(o)?[i.concat(n),r]:[i,r.concat(n)]}),[[],[]]),s=r[0],o=r[1];return{querystring:s.join("&"),removedParams:z(o.join("&"),i)}}((o=h.replace(f,""),o.split("?")[1]||""),e.parser.queryParams,r.queryParams).querystring;if(u=function(t){return t.split("?")[0]}(u)+(m?"?"+m:""),l||p||"/"!==u||/\/$/.test(f)||(u=""),i.segments.push(e),Object.keys(c).forEach((function(t){return i.params[t]=c[t]})),!p&&!u.length)return{value:i};if(!p&&"strict"!==a&&0===u.indexOf("?")){var g=z(u.slice(1),r.queryParams);return Object.keys(g).forEach((function(t){return i.params[t]=g[t]})),{value:i}}var v=e.getNonAbsoluteChildren();return v.length?{value:t(v,u,i,r,f)}:{value:null}}},m=0,g=e;m<g.length;m++){var v=f(g[m]);if("object"==typeof v)return v.value}return null};
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var ot=function(t){return function(e,n){var i,r,s,o,a,c,l=e.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1"),u=n.path.replace(/<.*?>/g,"").split("?")[0].replace(/(.+)\/$/,"$1");if("/"===l)return 1;if("/"===u)return-1;if(null===(i=e.parser)||void 0===i?void 0:i.hasSpatParam)return 1;if(null===(r=n.parser)||void 0===r?void 0:r.hasSpatParam)return-1;var d=(l.match(/\//g)||[]).length,h=(u.match(/\//g)||[]).length;if(d<h)return 1;if(d>h)return-1;var A=null!=(o=null===(s=e.parser)||void 0===s?void 0:s.urlParams.length)?o:0,p=null!=(c=null===(a=n.parser)||void 0===a?void 0:a.urlParams.length)?c:0;if(A<p)return-1;if(A>p)return 1;var f=(l.split("/").slice(-1)[0]||"").length,m=(u.split("/").slice(-1)[0]||"").length;return f<m?1:f>m?-1:t.indexOf(e)-t.indexOf(n)}},at=function(){function t(t,e,n,i){return void 0===t&&(t=""),void 0===e&&(e=""),void 0===n&&(n=[]),void 0===i&&(i={}),this.name=t,this.absolute=/^~/.test(e),this.path=this.absolute?e.slice(1):e,this.parser=this.path?new it(this.path):null,this.children=[],this.parent=i.parent,this.checkParents(),this.add(n,i.onAdd,!i.finalSort&&!1!==i.sort),i.finalSort&&this.sortDescendants(),this}return t.prototype.getParentSegments=function(t){return void 0===t&&(t=[]),this.parent&&this.parent.parser?this.parent.getParentSegments(t.concat(this.parent)):t.reverse()},t.prototype.setParent=function(t){this.parent=t,this.checkParents()},t.prototype.setPath=function(t){void 0===t&&(t=""),this.path=t,this.parser=t?new it(t):null},t.prototype.add=function(e,n,i){var r=this;if(void 0===i&&(i=!0),null==e)return this;if(e instanceof Array)return e.forEach((function(t){return r.add(t,n,i)})),this;if(!(e instanceof t||e instanceof Object))throw new Error("RouteNode.add() expects routes to be an Object or an instance of RouteNode.");if(e instanceof t)e.setParent(this),this.addRouteNode(e,i);else{if(!e.name||!e.path)throw new Error("RouteNode.add() expects routes to have a name and a path defined.");var s=new t(e.name,e.path,e.children,{finalSort:!1,onAdd:n,parent:this,sort:i}),o=s.getParentSegments([s]).map((function(t){return t.name})).join(".");n&&n(B(B({},e),{name:o})),this.addRouteNode(s,i)}return this},t.prototype.addNode=function(e,n){return this.add(new t(e,n)),this},t.prototype.getPath=function(t){var e,n=this.getSegmentsByName(t);return n?(e=n)?e.map((function(t){return t.path})).join(""):null:null},t.prototype.getNonAbsoluteChildren=function(){return this.children.filter((function(t){return!t.absolute}))},t.prototype.sortChildren=function(){var t,e;this.children.length&&(t=this.children,e=t.slice(0),t.sort(ot(e)))},t.prototype.sortDescendants=function(){this.sortChildren(),this.children.forEach((function(t){return t.sortDescendants()}))},t.prototype.buildPath=function(t,e,n){void 0===e&&(e={}),void 0===n&&(n={});var i=this.getSegmentsByName(t);if(!i)throw new Error("[route-node][buildPath] '{routeName}' is not defined");return function(t,e,n){void 0===e&&(e={}),void 0===n&&(n={});for(var i=n.queryParamsMode,r=void 0===i?"default":i,s=n.trailingSlashMode,o=void 0===s?"default":s,a=[],c=[],l=0,u=t;l<u.length;l++){var d=u[l].parser;d&&(a.push.apply(a,d.queryParams),c.push.apply(c,d.urlParams),c.push.apply(c,d.spatParams))}if("loose"===r){var h=Object.keys(e).reduce((function(t,e){return-1===a.indexOf(e)&&-1===c.indexOf(e)?t.concat(e):t}),[]);a.push.apply(a,h)}var A=a.reduce((function(t,n){return-1!==Object.keys(e).indexOf(n)&&(t[n]=e[n]),t}),{}),p=W(A,n.queryParams),f=t.reduce((function(t,i){var r,s,o=null!=(s=null===(r=i.parser)||void 0===r?void 0:r.build(e,{ignoreSearch:!0,queryParams:n.queryParams,urlParamsEncoding:n.urlParamsEncoding}))?s:"";return i.absolute?o:t+o}),"").replace(/\/\/{1,}/g,"/"),m=f;return"always"===o?m=/\/$/.test(f)?f:f+"/":"never"===o&&"/"!==f&&(m=/\/$/.test(f)?f.slice(0,-1):f),m+(p?"?"+p:"")}(i,e,n)},t.prototype.buildState=function(t,e){void 0===e&&(e={});var n=this.getSegmentsByName(t);return n&&n.length?{name:t,params:e,meta:rt(n)}:null},t.prototype.matchPath=function(t,e){void 0===e&&(e={}),""!==t||e.strictTrailingSlash||(t="/");var n=this.getSegmentsMatchingPath(t,e);if(!n)return null;var i=n.segments;if(i[0].absolute){var r=i[0].getParentSegments();i.reverse(),i.push.apply(i,r),i.reverse()}var s=i[i.length-1].findSlashChild();return s&&i.push(s),function(t){return t&&t.segments&&t.segments.length?{name:t.segments.map((function(t){return t.name})).filter((function(t){return t})).join("."),params:t.params,meta:rt(t.segments)}:null}(n)},t.prototype.addRouteNode=function(t,e){void 0===e&&(e=!0);var n=t.name.split(".");if(1===n.length){if(-1!==this.children.map((function(t){return t.name})).indexOf(t.name))throw new Error('Alias "'+t.name+'" is already defined in route node');if(-1!==this.children.map((function(t){return t.path})).indexOf(t.path))throw new Error('Path "'+t.path+'" is already defined in route node');this.children.push(t),e&&this.sortChildren()}else{var i=this.getSegmentsByName(n.slice(0,-1).join("."));if(!i)throw new Error("Could not add route named '"+t.name+"', parent is missing.");t.name=n[n.length-1],i[i.length-1].add(t)}return this},t.prototype.checkParents=function(){if(this.absolute&&this.hasParentsParams())throw new Error("[RouteNode] A RouteNode with an abolute path cannot have parents with route parameters")},t.prototype.hasParentsParams=function(){if(this.parent&&this.parent.parser){var t=this.parent.parser;return t.hasUrlParams||t.hasSpatParam||t.hasMatrixParams||t.hasQueryParams||this.parent.hasParentsParams()}return!1},t.prototype.findAbsoluteChildren=function(){return this.children.reduce((function(t,e){return t.concat(e.absolute?e:[]).concat(e.findAbsoluteChildren())}),[])},t.prototype.findSlashChild=function(){return this.getNonAbsoluteChildren().filter((function(t){return t.parser&&/^\/(\?|$)/.test(t.parser.path)}))[0]},t.prototype.getSegmentsByName=function(t){var e=[],n=this.parser?[this]:this.children,i=(this.parser?[""]:[]).concat(t.split(".")).every((function(t){var i=function(t,e){var n=e.filter((function(e){return e.name===t}));return n.length?n[0]:void 0}(t,n);return!!i&&(n=i.children,e.push(i),!0)}));return i?e:null},t.prototype.getSegmentsMatchingPath=function(t,e){var n=(this.parser?[this]:this.children).reduce((function(t,e){return t.concat(e,e.findAbsoluteChildren())}),[]),i=st(n,t,{segments:[],params:{}},e);return i&&1===i.segments.length&&""===i.segments[0].name?null:i},t}();var ct=function(t){var e,n=t.Symbol;return"function"==typeof n?n.observable?e=n.observable:(e=n("observable"),n.observable=e):e="@@observable",e}("undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof module?module:Function("return this")()),lt=function(t){return t.split(".").reduce((function(t,e){return t.concat(t.length?t[t.length-1]+"."+e:e)}),[])},ut=function(t){return t&&t.meta&&t.meta.params},dt=function(t,e){return ut(e)&&null!=e.meta.params[t]?Object.keys(e.meta.params[t]).reduce((function(t,n){return t[n]=e.params[n],t}),{}):{}};
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */
var ht=function(){return ht=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},ht.apply(this,arguments)},At={trailingSlashMode:"default",queryParamsMode:"default",strictTrailingSlash:!1,autoCleanUp:!0,allowNotFound:!1,strongMatching:!0,rewritePathOnMatch:!0,caseSensitive:!1,urlParamsEncoding:"default"};var pt="NOT_STARTED",ft="NO_START_PATH_OR_STATE",mt="ALREADY_STARTED",gt="ROUTE_NOT_FOUND",vt="SAME_STATES",yt="CANNOT_DEACTIVATE",_t="CANNOT_ACTIVATE",bt="TRANSITION_ERR",Et="CANCELLED",wt="@@router5/UNKNOWN_ROUTE",St="$start",Tt="$stop",Ct="$$start",Rt="$$cancel",It="$$success",xt="$$error";function Ot(t){var e=0,n=null;return t.getState=function(){return n},t.setState=function(t){n=t},t.makeState=function(n,i,r,s,o){return{name:n,params:ht(ht({},t.config.defaultParams[n]),i),path:r,meta:s?ht(ht({},s),{id:void 0===o?++e:o}):void 0}},t.makeNotFoundState=function(e,n){return t.makeState(wt,{path:e},e,{options:n})},t.areStatesEqual=function(e,n,i){if(void 0===i&&(i=!0),e.name!==n.name)return!1;var r=function(e){return t.rootNode.getSegmentsByName(e).map((function(t){return t.parser.urlParams})).reduce((function(t,e){return t.concat(e)}),[])},s=i?r(e.name):Object.keys(e.params),o=i?r(n.name):Object.keys(n.params);return s.length===o.length&&s.every((function(t){return e.params[t]===n.params[t]}))},t.areStatesDescendants=function(t,e){return!!new RegExp("^"+t.name+"\\.(.*)$").test(e.name)&&Object.keys(t.params).every((function(n){return t.params[n]===e.params[n]}))},t.forwardState=function(e,n){var i=t.config.forwardMap[e]||e;return{name:i,params:ht(ht(ht({},t.config.defaultParams[e]),t.config.defaultParams[i]),n)}},t.buildState=function(e,n){var i=t.forwardState(e,n),r=i.name,s=i.params;return t.rootNode.buildState(r,s)},t}var Lt={onStart:St,onStop:Tt,onTransitionSuccess:It,onTransitionStart:Ct,onTransitionError:xt,onTransitionCancel:Rt};function Mt(t){var e=[];function n(e){var n=t.executeFactory(e),i=Object.keys(Lt).map((function(e){if(n[e])return t.addEventListener(Lt[e],n[e])})).filter(Boolean);return function(){i.forEach((function(t){return t()})),n.teardown&&n.teardown()}}return t.getPlugins=function(){return e},t.usePlugin=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=t.map((function(t){return e.push(t),n(t)}));return function(){e=e.filter((function(e){return-1===t.indexOf(e)})),r.forEach((function(t){return t()}))}},t}function kt(t){var e=[],n=[];return t.useMiddleware=function(){for(var i=[],r=0;r<arguments.length;r++)i[r]=arguments[r];var s=i.map((function(i){var r=t.executeFactory(i);return e.push(i),n.push(r),function(){e=e.filter((function(t){return t!==i})),n=n.filter((function(t){return t!==r}))}}));return function(){return s.forEach((function(t){return t()}))}},t.clearMiddleware=function(){return e=[],n=[],t},t.getMiddlewareFactories=function(){return e},t.getMiddlewareFunctions=function(){return n},t}function Nt(t){var e={};function n(e){var n="object"==typeof e,i=n?e.next.bind(e):e,r=t.addEventListener(It,(function(t,e){i({route:t,previousRoute:e})}));return n?{unsubscribe:r}:r}function i(){var t;return(t={subscribe:function(t){if("object"!=typeof t||null===t)throw new TypeError("Expected the observer to be an object.");return n(t)}})[ct]=function(){return this},t}return t.invokeEventListeners=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];(e[t]||[]).forEach((function(t){return t.apply(void 0,n)}))},t.removeEventListener=function(t,n){e[t]=e[t].filter((function(t){return t!==n}))},t.addEventListener=function(n,i){return e[n]=(e[n]||[]).concat(i),function(){return t.removeEventListener(n,i)}},t.subscribe=n,t[ct]=i,t["@@observable"]=i,t}function Pt(t,e,n){var i=e.isCancelled,r=e.toState,s=e.fromState,o=e.errorKey,a=void 0===o?void 0:o,c=Array.isArray(t)?t:Object.keys(t),l=function(t){return"object"==typeof t&&void 0!==t.name&&void 0!==t.params&&void 0!==t.path},u=function(t,e,n,r){var o=function(t,e){t?r(t):e&&e!==n&&l(e)?(function(t,e){return e.name!==t.name||e.params!==t.params||e.path!==t.path}(e,n)&&console.error("[router5][transition] Warning: state values (name, params, path) were changed during transition process."),r(null,function(t,e){return ht(ht(ht({},e),t),{meta:ht(ht({},e.meta),t.meta)})}(e,n))):r(null,n)},a=t.call(null,n,s,o);i()?o(null):"boolean"==typeof a?o(a?null:e):l(a)?o(null,a):a&&"function"==typeof a.then&&a.then((function(t){t instanceof Error?o({error:t},null):o(null,t)}),(function(t){t instanceof Error?(console.error(t.stack||t),o(ht(ht({},e),{promiseError:t}),null)):o("object"==typeof t?ht(ht({},e),t):e,null)}))},d=function(e,r){var s;if(i())n();else if(e)n(e);else if(c.length){var o="string"==typeof c[0],l=a&&o?((s={})[a]=c[0],s):{},h=o?t[c[0]]:c[0];c=c.slice(1),u(h,l,r,d)}else n(null,r)};d(null,r)}function Dt(t,e,n,i,r){var s=!1,o=!1,a=t.getOptions(),c=t.getLifecycleFunctions(),l=c[0],u=c[1],d=t.getMiddlewareFunctions(),h=function(){return s},A=function(t,e){return ht(ht({},t),e instanceof Object?e:{error:e})},p=e.name===wt,f={isCancelled:h,toState:e,fromState:n},m=function(t,e){var n,i=t.meta&&t.meta&&t.meta.options||{},r=e?lt(e.name):[],s=lt(t.name),o=Math.min(r.length,s.length);n=!e||i.reload?0:ut(e)||ut(t)?function(){var n,i=function(){var i=r[n],o=s[n];if(i!==o)return{value:n};var a=dt(i,t),c=dt(o,e);return Object.keys(a).length!==Object.keys(c).length?{value:n}:0===Object.keys(a).length?"continue":Object.keys(a).some((function(t){return c[t]!==a[t]}))?{value:n}:void 0};for(n=0;n<o;n+=1){var a=i();if("object"==typeof a)return a.value}return n}():0;var a=r.slice(n).reverse(),c=s.slice(n);return{intersection:e&&n>0?r[n-1]:"",toDeactivate:a,toActivate:c}}(e,n),g=m.toDeactivate,v=m.toActivate,y=!n||i.forceDeactivate?[]:function(t,e,n){var i=g.filter((function(t){return l[t]})).reduce((function(t,e){var n;return ht(ht({},t),((n={})[e]=l[e],n))}),{});Pt(i,ht(ht({},f),{errorKey:"segment"}),(function(t){return n(t?A({code:yt},t):null)}))},_=p?[]:function(t,e,n){var i=v.filter((function(t){return u[t]})).reduce((function(t,e){var n;return ht(ht({},t),((n={})[e]=u[e],n))}),{});Pt(i,ht(ht({},f),{errorKey:"segment"}),(function(t){return n(t?A({code:_t},t):null)}))},b=d.length?function(t,e,n){return Pt(d,ht({},f),(function(e,i){return n(e?A({code:bt},e):null,i||t)}))}:[];return Pt([].concat(y).concat(_).concat(b),f,(function(n,i){if(o=!0,!h()){if(!n&&a.autoCleanUp){var s=lt(e.name);Object.keys(l).forEach((function(e){-1===s.indexOf(e)&&t.clearCanDeactivate(e)}))}r(n,i||e)}})),function(){s||o||(s=!0,r({code:Et},null))}}var Bt=function(){};function Ut(t){var e;function n(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var r=e[0],s=e[e.length-1],o="function"==typeof s?s:Bt,a="object"==typeof e[1]?e[1]:{},c="object"==typeof e[2]?e[2]:{};if(t.isStarted()){var l=t.buildState(r,a);if(!l)return o(u={code:gt}),void t.invokeEventListeners(xt,null,t.getState(),u);var u,d=t.makeState(l.name,l.params,t.buildPath(l.name,l.params),{params:l.meta,options:c}),h=!!t.getState()&&t.areStatesEqual(t.getState(),d,!1);if(h&&!c.reload&&!c.force)return o(u={code:vt}),void t.invokeEventListeners(xt,d,t.getState(),u);var A=t.getState();return c.skipTransition?(o(null,d),Bt):t.transitionToState(d,A,c,(function(e,i){if(e)if(e.redirect){var r=e.redirect;n(r.name,r.params,ht(ht({},c),{force:!0,redirected:!0}),o)}else o(e);else t.invokeEventListeners(It,i,A,c),o(null,i)}))}o({code:pt})}return t.navigate=n,t.navigate=n,t.navigateToDefault=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var r="object"==typeof e[0]?e[0]:{},s=2===e.length?e[1]:"function"==typeof e[0]?e[0]:Bt,o=t.getOptions();return o.defaultRoute?n(o.defaultRoute,o.defaultParams,r,s):function(){}},t.cancel=function(){return e&&(e("navigate"),e=null),t},t.transitionToState=function(n,i,r,s){return void 0===r&&(r={}),void 0===s&&(s=Bt),t.cancel(),t.invokeEventListeners(Ct,n,i),e=Dt(t,n,i,r,(function(r,o){e=null,o=o||n,r?(r.code===Et?t.invokeEventListeners(Rt,n,i):t.invokeEventListeners(xt,n,i,r),s(r)):(t.setState(o),s(null,o))}))},t}var Ft=function(){};function Ht(t){var e=!1;return t.isStarted=function(){return e},t.start=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var r,s,o=t.getOptions(),a=n[n.length-1],c="function"==typeof a?a:Ft,l="function"!=typeof n[0]?n[0]:void 0;if(e)return c({code:mt}),t;e=!0,t.invokeEventListeners(St);var u=function(e,n,i){void 0===i&&(i=!0),e||t.invokeEventListeners(It,n,null,{replace:!0}),e&&i&&t.invokeEventListeners(xt,n,null,e),c(e,n)};if(void 0===l&&!o.defaultRoute)return u({code:ft});if("string"==typeof l?r=l:"object"==typeof l&&(s=l),s)t.setState(s),u(null,s);else{s=void 0===r?null:t.matchPath(r);var d=function(){return t.navigateToDefault({replace:!0},c)},h=function(e){return t.navigate(e.name,e.params,{replace:!0,reload:!0,redirected:!0},c)},A=function(e){t.transitionToState(e,t.getState(),{},(function(t,e){t?t.redirect?h(t.redirect):o.defaultRoute?d():u(t,null,!1):u(null,e)}))};s?A(s):o.defaultRoute?d():o.allowNotFound?A(t.makeNotFoundState(r,{replace:!0})):u({code:gt,path:r},null)}return t},t.stop=function(){return e&&(t.setState(null),e=!1,t.invokeEventListeners(Tt)),t},t}var Vt=function(t){return"function"==typeof t?t:function(){return function(){return t}}};function jt(t){var e={},n={},i={},r={};return t.getLifecycleFactories=function(){return[e,n]},t.getLifecycleFunctions=function(){return[i,r]},t.canDeactivate=function(n,r){var s=Vt(r);return e[n]=s,i[n]=t.executeFactory(s),t},t.clearCanDeactivate=function(n){return e[n]=void 0,i[n]=void 0,t},t.canActivate=function(e,i){var s=Vt(i);return n[e]=s,r[e]=t.executeFactory(s),t},t}var Gt=function(t,e,n){void 0===t&&(t=[]),void 0===e&&(e={}),void 0===n&&(n={});return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(e){return t.reduce((function(t,e){return e(t)}),e)}}(function(t){return function(e){var n=ht(ht({},At),t);return e.getOptions=function(){return n},e.setOption=function(t,i){return n[t]=i,e},e}}(e),function(t){return function(e){var n=t;return e.setDependency=function(t,i){return n[t]=i,e},e.setDependencies=function(t){return Object.keys(t).forEach((function(n){return e.setDependency(n,t[n])})),e},e.getDependencies=function(){return n},e.getInjectables=function(){return[e,e.getDependencies()]},e.executeFactory=function(t){return t.apply(void 0,e.getInjectables())},e}}(n),Nt,Ot,Ht,jt,Ut,Mt,kt,function(t){return function(e){e.forward=function(t,n){return e.config.forwardMap[t]=n,e};var n=t instanceof at?t:new at("","",t,{onAdd:i});function i(t){t.canActivate&&e.canActivate(t.name,t.canActivate),t.forwardTo&&e.forward(t.name,t.forwardTo),t.decodeParams&&(e.config.decoders[t.name]=t.decodeParams),t.encodeParams&&(e.config.encoders[t.name]=t.encodeParams),t.defaultParams&&(e.config.defaultParams[t.name]=t.defaultParams)}return e.rootNode=n,e.add=function(t,r){return n.add(t,i,!r),r&&n.sortDescendants(),e},e.addNode=function(t,i,r){return n.addNode(t,i),r&&e.canActivate(t,r),e},e.isActive=function(t,n,i,r){void 0===n&&(n={}),void 0===i&&(i=!1),void 0===r&&(r=!0);var s=e.getState();return!!s&&(i||s.name===t?e.areStatesEqual(e.makeState(t,n),s,r):e.areStatesDescendants(e.makeState(t,n),s))},e.buildPath=function(t,n){if(t===wt)return n.path;var i=ht(ht({},e.config.defaultParams[t]),n),r=e.getOptions(),s=r.trailingSlashMode,o=r.queryParamsMode,a=r.queryParams,c=e.config.encoders[t]?e.config.encoders[t](i):i;return e.rootNode.buildPath(t,c,{trailingSlashMode:s,queryParamsMode:o,queryParams:a,urlParamsEncoding:e.getOptions().urlParamsEncoding})},e.matchPath=function(t,n){var i=e.getOptions(),r=e.rootNode.matchPath(t,i);if(r){var s=r.name,o=r.params,a=r.meta,c=e.config.decoders[s]?e.config.decoders[s](o):o,l=e.forwardState(s,c),u=l.name,d=l.params,h=!1===i.rewritePathOnMatch?t:e.buildPath(u,d);return e.makeState(u,d,h,{params:a,source:n})}return null},e.setRootPath=function(t){e.rootNode.setPath(t)},e}}(t))({config:{decoders:{},encoders:{},defaultParams:{},forwardMap:{}}})},Qt=function(){return Qt=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},Qt.apply(this,arguments)};function zt(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var i=Array(t),r=0;for(e=0;e<n;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,r++)i[r]=s[o];return i}var Wt=function(t){return function(){return t}},Kt=function(){},qt="undefined"!=typeof window&&window.history,Yt=function(t){try{return encodeURI(decodeURI(t))}catch(e){return t}},$t=qt?{getBase:function(){return window.location.pathname},pushState:function(t,e,n){return window.history.pushState(t,e,n)},replaceState:function(t,e,n){return window.history.replaceState(t,e,n)},addPopstateListener:function(t,e){var n=e.useHash&&!(-1===window.navigator.userAgent.indexOf("Trident"));return window.addEventListener("popstate",t),n&&window.addEventListener("hashchange",t),function(){window.removeEventListener("popstate",t),n&&window.removeEventListener("hashchange",t)}},getLocation:function(t){var e=t.useHash?window.location.hash.replace(new RegExp("^#"+t.hashPrefix),""):window.location.pathname.replace(new RegExp("^"+t.base),"");return(Yt(e)||"/")+window.location.search},getState:function(){return window.history.state},getHash:function(){return window.location.hash}}:{getBase:Wt(""),pushState:Kt,replaceState:Kt,addPopstateListener:Kt,getLocation:Wt(""),getState:Wt(null),getHash:Wt("")},Xt={forceDeactivate:!0,useHash:!1,hashPrefix:"",base:"",mergeState:!1,preserveHash:!0},Jt="popstate";function Zt(t,e){void 0===e&&(e=$t);var n,i=Qt(Qt({},Xt),t),r={forceDeactivate:i.forceDeactivate,source:Jt};return function(t){var s=t.getOptions(),o=t.start;t.buildUrl=function(e,n){return(i.base||"")+(i.useHash?"#"+i.hashPrefix:"")+t.buildPath(e,n)};function a(t,n,r){var s=t?{meta:t.meta,name:t.name,params:t.params,path:t.path}:t,o=!0===i.mergeState?Qt(Qt({},e.getState()),s):s;r?e.replaceState(o,"",n):e.pushState(o,"",n)}function c(n){var o=t.getState(),c=!n.state||!n.state.name,l=c?t.matchPath(e.getLocation(i),Jt):t.makeState(n.state.name,n.state.params,n.state.path,Qt(Qt({},n.state.meta),{source:Jt}),n.state.meta.id),u=s.defaultRoute,d=s.defaultParams;l?o&&t.areStatesEqual(l,o,!1)||t.transitionToState(l,o,r,(function(e,n){if(e)if(e.redirect){var i=e.redirect,s=i.name,h=i.params;t.navigate(s,h,Qt(Qt({},r),{replace:!0,force:!0,redirected:!0}))}else if(e.code===yt){var A=t.buildUrl(o.name,o.params);c||a(l,A,!0)}else u&&t.navigate(u,d,Qt(Qt({},r),{reload:!0,replace:!0}));else t.invokeEventListeners(It,n,o,{replace:!0})})):u&&t.navigateToDefault(Qt(Qt({},r),{reload:!0,replace:!0}))}function l(){n&&(n(),n=void 0)}return t.matchUrl=function(e){return t.matchPath(function(t){var e=t.match(/^(?:http|https):\/\/(?:[0-9a-z_\-.:]+?)(?=\/)(.*)$/),n=(e?e[1]:t).match(/^(.+?)(#.+?)?(\?.+)?$/);if(!n)throw new Error("[router5] Could not parse url "+t);var r=n[1],s=n[2]||"",o=n[3]||"";return(i.useHash?s.replace(new RegExp("^#"+i.hashPrefix),""):i.base?r.replace(new RegExp("^"+i.base),""):r)+o}(e))},t.start=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return 0===n.length||"function"==typeof n[0]?o.apply(void 0,zt([e.getLocation(i)],n)):o.apply(void 0,n),t},t.replaceHistoryState=function(n,i,r){void 0===i&&(i={}),void 0===r&&(r="");var s=t.buildState(n,i),o=t.makeState(s.name,s.params,t.buildPath(s.name,s.params),{params:s.meta}),a=t.buildUrl(n,i);t.lastKnownState=o,e.replaceState(o,r,a)},{onStart:function(){i.useHash&&!i.base&&(i.base=e.getBase()),n=e.addPopstateListener(c,i)},onStop:l,teardown:l,onTransitionSuccess:function(n,r,s){var o=e.getState(),c=o&&o.meta&&o.name&&o.params,l=r&&t.areStatesEqual(r,n,!1),u=s.replace||!c||l,d=t.buildUrl(n.name,n.params);null===r&&!1===i.useHash&&!0===i.preserveHash&&(d+=e.getHash()),a(n,d,u)},onPopState:c}}}class te{static get router(){return this.router_}static get route(){let t=null;const e=this.router_;return e&&(t=e.getState()),t}static useBrowser(t){if(!Array.isArray(t)||!t.length)return void(this.event$=n.EMPTY);this.routes=t;const e=Gt(t,{allowNotFound:!1,autoCleanUp:!0,defaultRoute:"index",defaultParams:{},queryParams:{arrayFormat:"default",nullFormat:"default",booleanFormat:"default"},queryParamsMode:"default",trailingSlashMode:"default",strictTrailingSlash:!1,caseSensitive:!1,urlParamsEncoding:"default"});this.router_=e,e.usePlugin(Zt({useHash:!1})),e.start(),this.event$=n.from(e).pipe(i.startWith({route:e.getState(),previousRoute:null}))}static useBrowser$(t){return this.useBrowser(t),this.event$}static setRouterLink(t,e,n){void 0===t&&(t="it.access"),void 0===e&&(e=null),void 0===n&&(n={reload:!0});const i=this.router_;if(i)try{i.navigate(t,e,n)}catch(t){console.log("RouterService.setRouterLink.error",t)}}static replaceHistoryState(t,e){const n=this.router_;if(n)try{n.replaceHistoryState(t,e)}catch(t){console.log("RouterService.replaceHistoryState.error",t)}}static setCurrentParams(t){const e=this.router_;if(e)try{const n=this.route;n&&e.replaceHistoryState(n.name,t)}catch(t){console.log("RouterService.setCurrentParams.error",t)}}static buildPath(t,e){void 0===e&&(e=null);let n=null;const i=this.router_;if(i)try{n=i.buildPath(t,e)}catch(t){console.log("RouterService.buildPath.error",t)}return n}static buildUrl(t,e){void 0===e&&(e=null);let n=null;const i=this.router_;if(i)try{n=i.buildUrl(t,e)}catch(t){console.log("RouterService.buildUrl.error",t)}return n}static isActive(t,e,n,i){void 0===n&&(n=!1),void 0===i&&(i=!0);let r=!1;const s=this.router_;if(s)try{r=s.isActive(t,e,n,i)}catch(t){console.log("RouterService.isActive.error",t)}return r}}te.routes=[],te.router_=null;class ee{static set state(t){this.state$.next(t)}static get state(){return this.state$.getValue()}static patchState(t){t=Object.assign({},this.state,t),this.state=t}}ee.state$=new n.BehaviorSubject({});const ne={Publisher:"publisher",Attendee:"attendee",Streamer:"streamer",Viewer:"viewer",SmartDevice:"smart-device",SelfService:"self-service",Embed:"embed"};class ie{constructor(t){t&&Object.assign(this,t)}}const re=/^\d{9}-\d{4}-\d{13}(-\d+)?$/;class se{get roleIndex(){return se.getRoleIndex(this.role)}set roleIndex(t){if(se.getRoleIndex(this.role)!==t){const e=Object.keys(ne)[t];this.role=ne[e]}}constructor(t){if(this.userId=ee.state.user?ee.state.user.id:0,this.role=ee.state.role||ne.Viewer,this.timestamp=(new Date).valueOf().toString(),this.pathId=null,"string"==typeof t){if(!t.match(re))return console.warn("MeetingId","invalid meetingId",t),null;t=se.decompose(t)}"object"==typeof t&&(t.id&&(this.id=t.id),t.userId&&(this.userId=t.userId),t.role&&(this.role=t.role),t.roleIndex&&(this.roleIndex=t.roleIndex),t.timestamp&&(this.timestamp=t.timestamp),t.pathId&&(this.pathId=t.pathId))}toString(){return se.compose(this.userId,this.roleIndex,this.timestamp,this.pathId)}toRoles(){const t=this.userId,e=this.timestamp,n=this.pathId;return{id:se.compose(t,se.getRoleIndex(ne.Publisher),e,n),idAttendee:se.compose(t,se.getRoleIndex(ne.Attendee),e,n),idStreamer:se.compose(t,se.getRoleIndex(ne.Streamer),e,n),idViewer:se.compose(t,se.getRoleIndex(ne.Viewer),e,n),idSmartDevice:se.compose(t,se.getRoleIndex(ne.SmartDevice),e,n),idSelfService:se.compose(t,se.getRoleIndex(ne.SelfService),e,n)}}static compose(t,e,n,i){return`${se.padded(t,9)}-${se.padded(e,4)}-${n}${i?`-${i}`:""}`}static decompose(t){const e=t.split("-");return{userId:parseInt(e[0]),roleIndex:parseInt(e[1]),timestamp:parseInt(e[2]),pathId:e[3]?parseInt(e[3]):null}}static generateMeetingId(){return(new se).toRoles()}static getRoleIndex(t){return Object.keys(ne).reduce(((e,n,i)=>ne[n]===t?i:e),-1)}static padded(t,e){const n="000000000000"+t;return n.substring(n.length-e)}}class oe{get meetingId(){return this.link?new se(this.link):null}constructor(t){if("string"==typeof(t=t||window.location.href)&&(t=oe.decompose(t)),"object"==typeof t){if(Object.assign(this,t),t.user){const e=oe.getName(t.user);if(e&&(this.name=e),D.flags.useExtendedUserInfo){const e=oe.getFirstName(t.user);e&&(this.firstName=e);const n=oe.getLastName(t.user);n&&(this.lastName=n);const i=oe.getEmail(t.user);i&&(this.email=i)}}t.name&&(this.name=t.name),D.flags.useExtendedUserInfo&&(t.firstName&&(this.firstName=t.firstName),t.lastName&&(this.lastName=t.lastName),t.email&&(this.email=t.email))}this.link=this.link||null,this.name=this.name||null,this.firstName=this.firstName||null,this.lastName=this.lastName||null,this.email=this.email||null,this.role=this.role||null,this.viewId=this.viewId||null,this.pathId=this.pathId||null,this.embedViewId=this.embedViewId||null,this.support=this.support||!1}toParams(t){void 0===t&&(t=!1);let e={};return this.link&&(e.link=this.link),D.flags.useExtendedUserInfo?(this.firstName&&(e.firstName=this.firstName),this.lastName&&(e.lastName=this.lastName),this.email&&(e.email=this.email)):this.name&&(e.name=this.name),this.role&&!t&&(e.role=this.role),this.viewId&&(e.viewId=this.viewId),this.pathId&&(e.pathId=this.pathId),this.support&&(e.support=this.support),D.flags.useEncryptedUrl&&(e={p:oe.encrypt(e)}),e}toString(t){let e;return void 0===t&&(t=!1),e=D.flags.useExtendedUserInfo?{link:this.link,firstName:this.firstName,lastName:this.lastName,email:this.email,role:t?null:this.role,viewId:this.viewId,pathId:this.pathId,support:this.support}:{link:this.link,name:this.name,role:t?null:this.role,viewId:this.viewId,pathId:this.pathId,support:this.support},oe.compose(e)}toUrl(){const t=this.toParams();return oe.getCurrentUrl(t)}toAccessCodeUrl(){const t=this.toParams();return oe.getAccessCodeUrl(t)}toGuidedTourUrl(){const t=this.toParams();return oe.getGuidedTourUrl(t)}copyToClipBoard(t){void 0===t&&(t=!1);const e=document.createElement("input");e.style.position="absolute",e.style.top="1000vh",document.querySelector("body").appendChild(e);const n=this.toParams(!0);e.value=window.location.origin+(t?oe.getAccessCodeUrl(n):oe.getGuidedTourUrl(n)),e.focus(),e.select(),e.setSelectionRange(0,99999),document.execCommand("copy"),e.parentNode.removeChild(e),alert(`link copiato!\n ${e.value}`)}replaceUrl(){te.setCurrentParams(this.toParams())}static replaceWithOptions(t){const e=oe.decompose(window.location.href),n=new oe(Object.assign(e,t));return n.replaceUrl(),n}static replaceWithUser(t){return this.replaceWithOptions({user:t})}static replaceWithName(t){return this.replaceWithOptions({name:t})}static replaceWithLink(t){return this.replaceWithOptions({link:t})}static getCurrentUrl(t){void 0===t&&(t=null);const e=te.route;if(e){const n=e.name;return te.buildUrl(n,t)}}static getAccessCodeUrl(t){void 0===t&&(t=null);const e=te.route;if(e){const n=`${e.params.lang}.accessCode`;return te.buildUrl(n,t)}}static getGuidedTourUrl(t){void 0===t&&(t=null);const e=te.route;if(e){const n=`${e.params.lang}.guidedTour`;return te.buildUrl(n,t)}}static getName(t){return t&&t.firstName&&t.lastName?`${t.firstName} ${t.lastName}`:null}static getFirstName(t){return t&&t.firstName?t.firstName:null}static getLastName(t){return t&&t.lastName?t.lastName:null}static getEmail(t){return t&&t.email?t.email:null}static compose(t){if(D.flags.useEncryptedUrl){return`?p=${oe.encrypt(t)}`}return`?${(t=Object.keys(t).map((e=>({key:e,value:t[e]}))).filter((t=>null!=t.value&&!1!==t.value)).map((t=>`${t.key}=${t.value}`))).join("&")}`}static decompose(t){let e={};if(D.flags.useEncryptedUrl){const n=new URLSearchParams(t.split("?")[1]);n.has("p")&&(e=oe.decrypt(n.get("p")))}else if(t.indexOf("?")>-1){new URLSearchParams(t.split("?")[1]).forEach(((t,n)=>{switch(n){case"viewId":case"pathId":case"embedViewId":t=t?parseInt(t):null;break;case"support":t=!!t&&"true"===t}e[n]=t}))}return e}static decrypt(t){return JSON.parse(window.atob(t))}static encrypt(t){return window.btoa(JSON.stringify(t))}static validateParams(t){if(D.flags.useEncryptedUrl){return{p:oe.encrypt(t)}}return t}}class ae extends t.Structure{getFactory(t){let e=null;const n=te.routes.find((e=>e.name===t.name));return n&&(e=n.factory),e}onInit(){this.route$().pipe(i.switchMap((t=>this.factory$(t))),i.takeUntil(this.unsubscribe$)).subscribe((t=>{}))}route$(){return te.event$.pipe(i.map((t=>{const e=t.route;return this.route=e,e})))}factory$(e){const r=this.getFactory(e),{module:s,node:o}=t.getContext(this);return this.factory_=r,n.of(r).pipe(i.tap((()=>{this.element&&(this.element.parentNode.removeChild(this.element),s.remove(this.element,this),this.element=void 0,this.instance=void 0)})),i.map((()=>{if(r&&r.meta.template){let t=document.createElement("div");t.innerHTML=r.meta.template,1===t.children.length&&(t=t.firstElementChild),o.appendChild(t);const n=s.makeInstance(t,r,r.meta.selector,this,void 0,{route:e});return s.compile(t,n),this.instance=n,this.element=t,{element:t,instance:n}}})))}onChanges(){}}ae.meta={selector:"router-outlet,[router-outlet]",hosts:{host:ae}};class ce extends t.Component{onInit(){this.state={};const e=new oe;if(e.link){const n=e.toGuidedTourUrl(),{node:i}=t.getContext(this);new QRious({element:i.querySelector(".qrcode"),value:n,size:256})}else window.location.href=window.location.origin+oe.getGuidedTourUrl()}}function le(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ue(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?le(Object(n),!0).forEach((function(e){de(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function de(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}ce.meta={selector:"[access-code-component]",hosts:{host:ae},template:`\n\t\t<div class="page page--access-code">\n\t\t\t${m}\n\t\t\t\x3c!-- access-code --\x3e\n\t\t\t<div class="ui ui--info ui--info-centered">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\t\t<div class="title" [innerHTML]="'access_code_title' | label"></div>\n\t\t\t\t\t\t<div class="picture">\n\t\t\t\t\t\t\t<canvas class="qrcode"></canvas>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t${g}\n\t\t\t${v}\n\t\t\t${_}\n\t\t</div>\n\t`};class he extends t.Component{get group(){if(this.formGroup)return this.formGroup;if(!this.host)throw"missing form collection";return this.host.control}getControl(t){return this.group.get(t)}}function Ae(t){return new e.FormGroup(function(t){const n=t.reduce(((t,n,i)=>{const r=[];if(n.required&&r.push("checkbox"===n.type?e.Validators.RequiredTrueValidator():e.Validators.RequiredValidator()),"email"===n.type&&r.push(e.Validators.EmailValidator()),"url"===n.type&&r.push(e.Validators.PatternValidator("(https?://(?:www.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9].[^s]{2,}|www.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9].[^s]{2,}|https?://(?:www.|(?!www))[a-zA-Z0-9]+.[^s]{2,}|www.[a-zA-Z0-9]+.[^s]{2,})")),null!=n.pattern&&r.push(e.Validators.PatternValidator(n.pattern)),t[n.name]=new e.FormControl(null!=n.value?n.value:null,r),"select"===n.type||"custom-select"===n.type){const e=(n.options||[]).slice();e.unshift({id:null,name:"select"}),t[n.name].options=e}return t}),{});return n}(t))}function pe(t,e){const n=t.reduce(((t,e,n)=>(e.test&&(t[e.name]=e.test),t)),{});e.patch(n)}he.meta={selector:"[controls]",inputs:["formGroup","fields"],hosts:{host:e.FormAbstractCollectionDirective},template:'\n\t\t<div *for="let field of fields">\n\t\t\t<div *if="[\'text\', \'email\', \'url\'].indexOf(field.type) !== -1" control-text [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'select\'" control-select [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'custom-select\'" control-custom-select [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'textarea\'" control-textarea [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<div *if="field.type == \'checkbox\'" control-checkbox [control]="getControl(field.name)" [label]="field.label | label"></div>\n\t\t\t<input *if="field.type == \'hidden\'" [name]="field.name" [formControl]="getControl(field.name)" value="" type="text" style="display:none !important;" />\n\t\t</div>\n\t'};class fe extends t.Pipe{static get labels(){return D.labels}static transform(t){if("@copy"===t)return this.getCopy();const e=fe.labels;let n=null!=e[t]?e[t]:t;return"string"==typeof n&&-1!==n.indexOf("@copy")&&(n=n.replace("@copy",this.getCopy())),n}static getKeys(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return fe.transform(e.map((t=>t.replace("-","_"))).join("_"))}static getCopy(){return`Â©${(new Date).getFullYear()}`}}fe.meta={name:"label"};class me{static has(t){return new URLSearchParams(window.location.search).has(t)}static get(t){return new URLSearchParams(window.location.search).get(t)}static set(t,e){const n=new URLSearchParams(window.location.search);"string"==typeof t?n.set(t,e):n.set(t,""),this.pushParams(n)}static delete(t){const e=new URLSearchParams(window.location.search);e.has(t)&&(e.delete(t),this.pushParams(e))}static pushParams(t){if(window.history&&window.history.pushState){const e=document.title,n=`${window.location.href.split("?")[0]}?${t.toString()}`;window.history.pushState(t.toString(),e,n)}}static replace(t,e){const n=window.history;if(n&&n.replaceState){const i=window.location,r=document.title;if("/"===i.pathname){const t=i.origin+e+i.search;n.replaceState(n.state,r,t)}else if(-1!==i.href.indexOf(t)){const s=i.href.replace(t,e);n.replaceState(n.state,r,s)}}}static deserialize(t){const e=this.get("params");return this.decode(t,e)}static serialize(t,e){const n=this.deserialize(),i=this.encode(t,e,n);this.set("params",i)}static decode(t,e){let n=null;if(e){const t=window.atob(e);n=JSON.parse(t)}return t&&n&&(n=n[t]),n||null}static encode(t,e,n){n=n||{};let i=null;"string"==typeof t?n[t]=e:n=t;const r=JSON.stringify(n);return i=window.btoa(r),i}}class ge{static get lang(){return this.lang$.getValue()}static set lang(t){this.lang!==t&&this.lang$.next(t)}static setAlternates(t,e){this.languages=e,this.lang=t}static setRoute(t,e){const n=t.params.lang,i=D.languages.map((i=>{const r="it"===i?"Italiano":"English",s=t.name.replace(new RegExp(`(^${n}$)|(^${n}.)`),((t,e,n,r)=>e?i:`${i}.`)),o=e.find((t=>t.name===s));return o?{name:o.name,params:t.params,href:o.path,lang:o.defaultParams.lang,title:r}:null})).filter((t=>null!==t));this.setAlternates(n,i)}static get hasLanguages(){return this.languages.length>1}static get activeLanguage(){return this.languages.find((t=>t.lang===this.lang))}static getDefaultLanguages(){return D.alternates||[]}static getDefaultLanguage(){return D.defaultLanguage||(this.languages?this.languages[0].lang:null)}static setLanguage(t){this.lang=t.lang}static setLanguage$(t){if("string"==typeof t&&(t=this.languages.find((e=>e.lang===t))),!t)return;const e=D.flags.production?`/api/${t.lang}/labels/`:`./api/${t.lang}/labels.json`;return n.from(fetch(e).then((t=>t.json()))).pipe(i.tap((e=>{D.labels=e,te.replaceHistoryState(t.name,t.params);const n=this.activeLanguage.href.split("?")[0],i=t.href.split("?")[0];me.replace(n,i),this.lang=t.lang})))}static setLanguage$_(t){return n.from(fetch(t.href).then((t=>t.text()))).pipe(i.tap((e=>{const n=/(window\.labels\s*=\s*\n*\s*\{((\{.+?\})|.)+?\})/gms.exec(e);n&&(new Function(n[0]).call(window),fe.setLabels());const i=/(window\.bhere\s*=\s*\n*\s*\{((\{.+?\})|.)+?\})/gms.exec(e);if(i){const t={};new Function(i[0].replace("window","this")).call(t),t.bhere&&S.merge(D,t.bhere)}me.replace(this.activeLanguage.href,t.href),this.lang=t.lang})))}static toggleLanguages(){this.showLanguages=!this.showLanguages,this.pushChanges()}}ge.languages=ge.getDefaultLanguages(),ge.lang$=new n.BehaviorSubject(ge.getDefaultLanguage());class ve extends t.Pipe{static transform(t){return t.replace(":lang",ge.lang)}}ve.meta={name:"route"};const ye=[["480p_1",640,480,15,500,!0],["480p_2",640,480,30,1e3,!0],["480p_3",480,480,15,400,!0],["480p_4",640,480,30,750,!0],["480p_6",480,480,30,600,!0],["480p_8",848,480,15,610,!0],["480p_9",848,480,30,930,!0],["480p_10",640,480,10,400,!0],["720p_1",1280,720,15,1130,!0],["720p_2",1280,720,30,2e3,!0],["720p_3",1280,720,30,1710,!0],["720p_5",960,720,15,910,!0],["720p_6",960,720,30,1380,!0],["1080p_1",1920,1080,15,2080,!1],["1080p_2",1920,1080,30,3e3,!1],["1080p_3",1920,1080,30,3150,!1],["1080p_5",1920,1080,60,4780,!1]].map((t=>({profile:t[0],resolution:{width:t[1],height:t[2]},frameRate:{min:t[3],max:t[3]},bitrate:{min:t[4],max:t[4]},compatible:t[5]})));function _e(t){let e=D.profiles.streamer;switch(t.role){case ne.Publisher:case ne.SmartDevice:e=D.profiles.publisher||D.profiles.streamer;break;case ne.Attendee:e=D.profiles.attendee||D.profiles.streamer}return ye.find((t=>t.profile===e))}const be="idle",Ee="checklist",we="link",Se="login",Te="name",Ce="device",Re="should-connect",Ie="connecting",xe="connected",Oe="addLike",Le="agoraEvent",Me="channelMembers",ke="chatMessage",Ne="chatTypingBegin",Pe="chatTypingEnd",De="controlInfo",Be="currentTimeMedia",Ue="menuToggle",Fe="mode",He="navInfo",Ve="navLink",je="navLinkClose",Ge="navToGrid",Qe="navToView",ze="playMedia",We="playModel",Ke="remoteSilencing",qe="requestControl",Ye="requestControlDismiss",$e="requestSpy",Xe="requestSpyDismiss",Je="selectItem",Ze="setSnapshot",tn="showPanel",en="slideChange",nn="supportRequest",rn="supportRequestAccepted",sn="supportRequestRejected",on="vrEnded",an="vrStarted",cn="vrState",ln="zoomMedia",un="virtual-tour",dn="live-meeting",hn="self-service-tour",An="embed",pn="none";class fn{constructor(t){Object.assign(this,t)}}class mn extends fn{}class gn extends fn{}class vn extends fn{}class yn extends fn{}class _n extends fn{}class bn extends fn{}class En extends fn{}class wn extends fn{}class Sn{static http$(t,e,r,s){let o=null;return n.from(fetch(e,{method:t,headers:{Accept:"application/json","Content-Type":"application/json"},body:-1!==["POST","PUT","PATCH"].indexOf(t)?JSON.stringify(r):void 0}).then((t=>{o=t;try{const e=t.headers.get("content-type");let n;return n=e&&-1!==e.indexOf("application/json")?t.json():t.text(),t.ok?n:n.then((t=>Promise.reject(t)))}catch(e){return t.ok?(console.warn("HttpService.http$","Cannot parse response"),Promise.resolve()):Promise.reject(e)}}))).pipe(i.catchError((t=>n.throwError(this.getError(t,o)))))}static get$(t,e,n){const i=this.query(e);return this.http$("GET",`${t}${i}`,void 0,n)}static delete$(t){return this.http$("DELETE",t)}static post$(t,e){return this.http$("POST",t,e)}static put$(t,e){return this.http$("PUT",t,e)}static patch$(t,e){return this.http$("PATCH",t,e)}static query(t){return""}static getError(t,e){let n="object"==typeof t?t:{};return n.status||(n.status=e?e.status:0),n.statusCode||(n.statusCode=e?e.status:0),n.statusMessage||(n.statusMessage=e?e.statusText:t),n}}class Tn{static setUser(t){this.user$.next(t)}static me$(){return Sn.get$("/api/user/me").pipe(i.map((t=>this.mapUser(t))),i.catchError((t=>{if(404===t.status||404===t.statusCode)return n.of(null);throw t})),i.switchMap((t=>(this.setUser(t),this.user$))))}static login$(t){return Sn.post$("/api/user/login",t).pipe(i.map((t=>this.mapUser(t))),i.tap((t=>this.setUser(t))))}static logout$(){return Sn.get$("/api/user/logout").pipe(i.map((t=>this.mapUser(t))),i.tap((t=>this.setUser(null))))}static guidedTour$(t){return Sn.post$("/api/user/guided-tour",t).pipe(i.map((t=>this.mapUser(t))),i.tap((t=>this.setUser(t))))}static selfServiceTour$(t){return Sn.post$("/api/user/self-service-tour",t).pipe(i.map((t=>this.mapUser(t))),i.tap((t=>this.setUser(t))))}static selfServiceSupportRequest$(t,e,n){const r={user:t,meetingId:e,link:n};return Sn.post$("/api/user/self-service-support-request",r).pipe(i.tap((e=>{D.flags.production||fetch(D.template.email.supportRequest).then((t=>t.text())).then((e=>{e=(e=e.replace("{{username}}",oe.getName(t))).replace("{{href}}",n);const i=(new DOMParser).parseFromString(e,"text/html");setTimeout((()=>{const t=window.open();t.document.head.innerHTML=i.querySelector("head").innerHTML,t.document.body.innerHTML=i.querySelector("body").innerHTML}),3e3)}))})))}static resolve$(t,e){return"login"===e?this.login$(t):"guided-tour"===e?this.guidedTour$(t):"self-service-tour"===e?this.selfServiceTour$(t):void 0}static log$(t){return Sn.post$("/api/user/log",t)}static temporaryUser$(t){return void 0===t&&(t=ne.Embed),n.of({id:this.uuid(),type:t,username:t}).pipe(i.map((t=>this.mapUser(t))),i.switchMap((t=>(this.setUser(t),this.user$))))}static overrideUser$(t){return void 0===t&&(t=ne.Embed),this.me$().pipe(i.switchMap((e=>e?(e.type=t,e.username=t,this.user$):this.temporaryUser$(t))))}static uuid(){return(new Date).getTime()}static mapUser(t){return new ie(t)}static getMode(t){let e;switch(t){case ne.Attendee:case ne.Streamer:case ne.Viewer:case ne.Publisher:e=un;break;case ne.SelfService:e=hn;break;case ne.SmartDevice:e=dn;break;case ne.Embed:e=An;break;default:e=pn}return e}}Tn.user$=new n.BehaviorSubject(null);let Cn=0;class Rn{constructor(t){t&&Object.assign(this,t)}toJson(){return JSON.stringify(this)}static newEvent(t,e,n){console.log("WebhookEvent.newEvent",t,e,n);const i=new Rn,r=(new Date).getTime();return i.timestamp=r,i.id=`${r}-${++Cn}`,i.action=t,i.data=e,n&&(i.extra="string"==typeof n?JSON.parse(n):n),ee.state.link&&(i.meetingId=ee.state.link,i.userSessionId=ee.state.uid,i.userRole=ee.state.role,i.fullName=ee.state.name),i}static parseEvent(t){if(t&&"data"in t){const e="string"==typeof t.data?JSON.parse(t.data):t.data;return"action"in e?new Rn(e):null}return null}}class In{static internal$_(t){return n.of(t).pipe(i.tap((t=>{console.log("WebhookService.internal$_.postMessage",t),window.parent&&window.parent.postMessage(t.action,t.toJson())})),i.switchMap((t=>this.event$_.pipe(i.filter((t=>t.id==t.id)),i.first()))),i.map((e=>(console.log("WebhookService.internal$_.handleResponse_",t,e),this.handleResponse_(t,e)))),i.catchError((e=>this.handleError_(t,e))))}static send$_(t,e){return Sn.post$(t,e).pipe(i.map((t=>this.handleResponse_(e,t))),i.catchError((t=>this.handleError_(e,t))))}static send$(t,e,i){if(console.log("WebhookService.send$",t,e,i),this.enabled){const r=Rn.newEvent(t,e,i),s=D.webhook.uris.map((t=>"internal"===t?this.internal$_(r):this.send$_(t,r)));return n.forkJoin(s)}return n.of(null)}static handleResponse_(t,e){console.log("WebhookService.handleResponse_",e);const n=Object.assign({},t);return n.remoteStatus=1,n.remoteResponse=e,n}static handleError_(t,e){const i=Object.assign({},t);return i.remoteStatus=0,i.remoteError=e,n.of(i)}static get enabled(){const t=D.webhook,e=t&&t.uris&&t.uris.length>0;return e&&(t.methods=t.methods||{},t.methods.nav=t.methods.nav||[]),e}}In.event$_=n.fromEvent(window,"message").pipe(i.map((t=>Rn.parseEvent(t))),i.filter((t=>null!==t)),i.shareReplay(1));class xn extends t.Component{onInit(){this.state={status:"access"},window.onSSOPopupClose=t=>{"success"===t?(alert("Login Successful"),Tn.me$().pipe(i.first()).subscribe((t=>{const e=ve.transform(":lang.selfServiceTour"),n=D.pathMapper&&D.pathMapper.ssoLogin?D.pathMapper.ssoLogin(t):null;n?te.setRouterLink(e,oe.validateParams({pathId:n})):te.setRouterLink(e)}))):alert("Login Failed")}}onSelfServiceTourRequest(){this.initRequestForm(),this.state.status="self-service-tour",this.pushChanges(),O&&-1!==window.navigator.userAgent.indexOf("OculusBrowser")&&(this.test(),this.onSubmit())}onGuidedTourRequest(){this.initRequestForm(),this.state.status="guided-tour",this.pushChanges()}onSSOLogin(t){const e=`${location.protocol}//${location.host}/sso/login`;return window.open(e,"BHere | SSO Login","left=20,top=20,width=600,height=600,toolbar=1,resizable=0"),t.preventDefault(),!1}onSSORegister(t){const e=`${location.protocol}//${location.host}/sso/register`;return window.open(e,"BHere | SSO Register","left=20,top=20,width=600,height=600,toolbar=1,resizable=0"),t.preventDefault(),!1}onGuidedTourAccess(){Tn.logout$().pipe(i.first()).subscribe((()=>{te.setRouterLink(ve.transform(":lang.guidedTour"))}))}onLogin(){this.initLoginForm(),this.state.status="login",this.pushChanges()}initRequestForm(){this.formSubscription&&this.formSubscription.unsubscribe();const t=this.data=D.data||{roles:[{id:1,name:"Show room"},{id:2,name:"Architetto"},{id:3,name:"Interior designer"},{id:4,name:"Privato"},{id:5,name:"Altro"}]},e=this.fields=D.fields||[{type:"text",name:"firstName",label:"access_first_name",required:!0,test:"Jhon"},{type:"text",name:"lastName",label:"access_last_name",required:!0,test:"Appleseed"},{type:"email",name:"email",label:"access_email",required:!0,test:"jhonappleseed@gmail.com"},{type:"custom-select",name:"role",label:"access_role",required:!0,options:t.roles,test:t.roles[0].id},{type:"checkbox",name:"privacy",label:"access_privacy_disclaimer",required:!0,test:!0}];e.push({type:"hidden",name:"checkField",value:"",test:""}),D.antiforgery&&e.push({type:"none",name:"checkRequest",value:D.antiforgery,test:D.antiforgery});const n=this.form=Ae(e);this.controls=n.controls,this.formSubscription=n.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.pushChanges()})),this.error=null}initLoginForm(){this.formSubscription&&this.formSubscription.unsubscribe();const t=this.form=new e.FormGroup({username:new e.FormControl(null,e.Validators.RequiredValidator()),password:new e.FormControl(null,e.Validators.RequiredValidator()),checkRequest:window.antiforgery||"",checkField:""});this.controls=t.controls,this.formSubscription=t.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.pushChanges()})),this.error=null}test(){"login"===this.state.status?this.form.patch({username:"publisher",password:"publisher",checkRequest:window.antiforgery||"",checkField:""}):pe(this.fields,this.form)}reset(){this.form.reset()}onBack(){this.state.status="access",this.pushChanges()}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=this.form.value,e=ue({},t),n=this.controls;Object.keys(e).forEach((t=>{if(n[t].options){const i=n[t].options;e[t]=i.find((n=>n.id===e[t])).name}}));const r=this.state.status;Tn.resolve$(t,r).pipe(i.first()).subscribe((t=>{switch(r){case"guided-tour":this.onHandleHook("GuidedTour",e).pipe(i.first()).subscribe((t=>{this.state.status="guided-tour-success",this.pushChanges()}));break;case"self-service-tour":this.onHandleHook("SelfServiceTour",e).pipe(i.first()).subscribe((e=>{const n=ve.transform(":lang.selfServiceTour"),i=D.pathMapper&&D.pathMapper.selfService?D.pathMapper.selfService(t):null;i?te.setRouterLink(n,oe.validateParams({pathId:i})):te.setRouterLink(n)}));break;case"login":te.setRouterLink(ve.transform(":lang.guidedTour"))}this.form.reset()}),(t=>{console.log("AccessComponent.error",t),this.error=t,this.pushChanges()}))}else this.form.touched=!0}isValid(){return this.form.valid}onHandleHook(t,e){const n=e;return In.send$(t,n,null)}}xn.meta={selector:"[access-component]",hosts:{host:ae},template:`\n\t\t<div class="page page--access">\n\t\t\t\x3c!-- background --\x3e\n\t\t\t<div class="background" [class]="{ 'background--image': ('background.image' | env), 'background--video': ('background.video' | env) }" *if="state.status != 'connected'">\n\t\t\t\t<img [src]="'background.image' | env | asset" *if="'background.image' | env" />\n\t\t\t\t<video [src]="'background.video' | env | asset" *if="'background.video' | env" oncanplay="this.muted = true; this.classList.add('ready');" playsinline autoplay muted loop></video>\n\t\t\t</div>\n\t\t\t\x3c!-- access --\x3e\n\t\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'access'">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\t\t<div class="title" [innerHTML]="'access_title' | label"></div>\n\t\t\t\t\t\t<div *if="'selfService' | flag">\n\t\t\t\t\t\t\t<button type="button" class="btn--next" (click)="onSelfServiceTourRequest($event)">\n\t\t\t\t\t\t\t\t<span [innerHTML]="'access_tour' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div *if="'guidedTourRequest' | flag">\n\t\t\t\t\t\t\t<div class="info" [innerHTML]="'access_or' | label"></div>\n\t\t\t\t\t\t\t<button type="button" class="btn--next" (click)="onGuidedTourRequest($event)">\n\t\t\t\t\t\t\t\t<span [innerHTML]="'access_guided_tour' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div *if="'guidedTourAccess' | flag">\n\t\t\t\t\t\t\t<div class="info" [innerHTML]="'access_has_meeting_id' | label"></div>\n\t\t\t\t\t\t\t<button type="button" class="btn--next" (click)="onGuidedTourAccess($event)">\n\t\t\t\t\t\t\t\t<span [innerHTML]="'access_guided_tour_cta' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div *if="'ssoLogin' | flag">\n\t\t\t\t\t\t\t<div class="info" [innerHTML]="'access_sso_login_info' | label"></div>\n\t\t\t\t\t\t\t<button type="button" class="btn--next" (click)="onSSOLogin($event)">\n\t\t\t\t\t\t\t\t<span [innerHTML]="'access_sso_login_cta' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div *if="'ssoRegister' | flag">\n\t\t\t\t\t\t\t<div class="info" [innerHTML]="'access_sso_register_info' | label"></div>\n\t\t\t\t\t\t\t<button type="button" class="btn--next" (click)="onSSORegister($event)">\n\t\t\t\t\t\t\t\t<span [innerHTML]="'access_sso_register_cta' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- guided-tour --\x3e\n\t\t\t<div class="ui ui--info" *if="state.status == 'self-service-tour' || state.status == 'guided-tour'">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\t\t\t<div class="title" *if="state.status == 'self-service-tour'" [innerHTML]="'access_fill_fields' | label"></div>\n\t\t\t\t\t\t\t<div class="title" *if="state.status == 'guided-tour'" [innerHTML]="'access_guided_tour_request' | label"></div>\n\t\t\t\t\t\t\t\x3c!-- controls --\x3e\n\t\t\t\t\t\t\t<div controls [formGroup]="form" [fields]="fields"></div>\n\t\t\t\t\t\t\t<div class="group--error" *if="error">\n\t\t\t\t\t\t\t\t<span class="status-code" [innerHTML]="error.statusCode"></span>\n\t\t\t\t\t\t\t\t<span class="status-message" [innerHTML]="error.statusMessage"></span>\n\t\t\t\t\t\t\t\t<span class="friendly-message" [innerHTML]="error.friendlyMessage"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\x3c!-- <div class="info" *if="isValid()" [innerHTML]="'access_take_part' | label"></div> --\x3e\n\t\t\t\t\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t\t\t\t<span *if="!form.submitted" [innerHTML]="'access_send' | label"></span>\n\t\t\t\t\t\t\t\t<span *if="form.submitted" [innerHTML]="'access_sent' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type="button" class="btn--mode" (click)="onBack($event)">\n\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t\t\t\t\t\t\t\t<span [innerHTML]="'access_back' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<test-component [form]="form" (test)="test($event)" (reset)="reset($event)"></test-component>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- guided-tour success --\x3e\n\t\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'guided-tour-success'">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\t\t<div class="title" [innerHTML]="'access_request_sent' | label"></div>\n\t\t\t\t\t\t<div class="info" [innerHTML]="'access_info_request' | label"></div>\n\t\t\t\t\t\t<button type="button" class="btn--mode" (click)="onBack($event)">\n\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t\t\t\t\t\t\t<span [innerHTML]="'access_back' | label"></span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- login --\x3e\n\t\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'login'">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\t\t\t<div class="title" [innerHTML]="'access_login' | label"></div>\n\t\t\t\t\t\t\t<input name="checkField" [formControl]="controls.checkField" value="" type="text" style="display:none !important;" />\n\t\t\t\t\t\t\t<div control-text [control]="controls.username" [label]="'access_username' | label"></div>\n\t\t\t\t\t\t\t<div control-password [control]="controls.password" [label]="'access_password' | label"></div>\n\t\t\t\t\t\t\t<div class="group--error" *if="error">\n\t\t\t\t\t\t\t\t<span class="status-code" [innerHTML]="error.statusCode"></span>\n\t\t\t\t\t\t\t\t<span class="status-message" [innerHTML]="error.statusMessage"></span>\n\t\t\t\t\t\t\t\t<span class="friendly-message" [innerHTML]="error.friendlyMessage"></span>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="info" *if="isValid()" [innerHTML]="'access_cta' | label"></div>\n\t\t\t\t\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t\t\t\t<span [innerHTML]="'access_cta' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type="button" class="btn--mode" (click)="onBack($event)">\n\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t\t\t\t\t\t\t\t<span [innerHTML]="'access_back' | label"></span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<test-component [form]="form" (test)="test($event)" (reset)="reset($event)"></test-component>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</form>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<header>\n\t\t\t\t\x3c!-- logo --\x3e\n\t\t\t\t<div class="btn--logo" (click)="onBack($event)">\n\t\t\t\t\t<img [src]="'logo' | env" *if="'logo' | env" />\n\t\t\t\t\t<svg viewBox="0 0 270 98" *if="!('logo' | env)"><use xlink:href="#b-here"></use></svg>\n\t\t\t\t</div>\n\t\t\t\t${_}\n\t\t\t</header>\n\t\t\t<footer>\n\t\t\t\t<span class="group--colophon" *if="state.status != 'connected'">\n\t\t\t\t\t${v}\n\t\t\t\t\t${y}\n\t\t\t\t</span>\n\t\t\t\t\x3c!-- login --\x3e\n\t\t\t\t<button type="button" class="btn--absolute" (click)="onLogin($event)" *if="state.status == 'access'">\n\t\t\t\t\t<span [innerHTML]="'access_cta' | label"></span> <svg class="lock" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#lock"></use></svg>\n\t\t\t\t</button>\n\t\t\t</footer>\n\t\t</div>\n\t`};class On{static emoji$(){return null!=On.items_?n.of(On.items_):Sn.get$(`${D.assets}api/emoji/emoji.json`).pipe(i.map((t=>(On.items_=t,t))))}}class Ln extends t.Component{onInit(){this.items=[],On.emoji$().pipe(i.first()).subscribe((t=>{setTimeout((()=>{this.items=t,this.pushChanges()}),1)}))}onSelect(t){this.emoji.next(t)}onClose(t){this.close.next()}}Ln.meta={selector:"[agora-chat-emoji]",outputs:["emoji","close"]};class Mn{static message(t){this.message$.next(t)}static in(t){this.in$.next(t)}static sendBack(t){t=Object.assign({},t,{remoteId:t.clientId}),this.in$.next(t)}static out(t){this.out$.next(t)}}Mn.message$=new n.ReplaySubject(1),Mn.in$=new n.ReplaySubject(1),Mn.send=Mn.in,Mn.out$=new n.ReplaySubject(1);var kn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Nn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Pn={exports:{}};!function(t,e){t.exports=function(){function t(t,e){return e.forEach((function(e){e&&"string"!=typeof e&&!Array.isArray(e)&&Object.keys(e).forEach((function(n){if("default"!==n&&!(n in t)){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}}))})),Object.freeze(t)}let e=!0,n=!0;function i(t,e,n){const i=t.match(e);return i&&i.length>=n&&parseInt(i[n],10)}function r(t,e,n){if(!t.RTCPeerConnection)return;const i=t.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(t,i){if(t!==e)return r.apply(this,arguments);const s=t=>{const e=n(t);e&&(i.handleEvent?i.handleEvent(e):i(e))};return this._eventMap=this._eventMap||{},this._eventMap[e]||(this._eventMap[e]=new Map),this._eventMap[e].set(i,s),r.apply(this,[t,s])};const s=i.removeEventListener;i.removeEventListener=function(t,n){if(t!==e||!this._eventMap||!this._eventMap[e])return s.apply(this,arguments);if(!this._eventMap[e].has(n))return s.apply(this,arguments);const i=this._eventMap[e].get(n);return this._eventMap[e].delete(n),0===this._eventMap[e].size&&delete this._eventMap[e],0===Object.keys(this._eventMap).length&&delete this._eventMap,s.apply(this,[t,i])},Object.defineProperty(i,"on"+e,{get(){return this["_on"+e]},set(t){this["_on"+e]&&(this.removeEventListener(e,this["_on"+e]),delete this["_on"+e]),t&&this.addEventListener(e,this["_on"+e]=t)},enumerable:!0,configurable:!0})}function s(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(e=t,t?"adapter.js logging disabled":"adapter.js logging enabled")}function o(t){return"boolean"!=typeof t?new Error("Argument type: "+typeof t+". Please use a boolean."):(n=!t,"adapter.js deprecation warnings "+(t?"disabled":"enabled"))}function a(){if("object"==typeof window){if(e)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function c(t,e){n&&console.warn(t+" is deprecated, please use "+e+" instead.")}function l(t){return"[object Object]"===Object.prototype.toString.call(t)}function u(t){return l(t)?Object.keys(t).reduce((function(e,n){const i=l(t[n]),r=i?u(t[n]):t[n],s=i&&!Object.keys(r).length;return void 0===r||s?e:Object.assign(e,{[n]:r})}),{}):t}function d(t,e,n){e&&!n.has(e.id)&&(n.set(e.id,e),Object.keys(e).forEach((i=>{i.endsWith("Id")?d(t,t.get(e[i]),n):i.endsWith("Ids")&&e[i].forEach((e=>{d(t,t.get(e),n)}))})))}function h(t,e,n){const i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===e)return r;const s=[];return t.forEach((t=>{"track"===t.type&&t.trackIdentifier===e.id&&s.push(t)})),s.forEach((e=>{t.forEach((n=>{n.type===i&&n.trackId===e.id&&d(t,n,r)}))})),r}const A=a;function p(t,e){const n=t&&t.navigator;if(!n.mediaDevices)return;const i=function(t){if("object"!=typeof t||t.mandatory||t.optional)return t;const e={};return Object.keys(t).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const i="object"==typeof t[n]?t[n]:{ideal:t[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);const r=function(t,e){return t?t+e.charAt(0).toUpperCase()+e.slice(1):"deviceId"===e?"sourceId":e};if(void 0!==i.ideal){e.optional=e.optional||[];let t={};"number"==typeof i.ideal?(t[r("min",n)]=i.ideal,e.optional.push(t),t={},t[r("max",n)]=i.ideal,e.optional.push(t)):(t[r("",n)]=i.ideal,e.optional.push(t))}void 0!==i.exact&&"number"!=typeof i.exact?(e.mandatory=e.mandatory||{},e.mandatory[r("",n)]=i.exact):["min","max"].forEach((t=>{void 0!==i[t]&&(e.mandatory=e.mandatory||{},e.mandatory[r(t,n)]=i[t])}))})),t.advanced&&(e.optional=(e.optional||[]).concat(t.advanced)),e},r=function(t,r){if(e.version>=61)return r(t);if((t=JSON.parse(JSON.stringify(t)))&&"object"==typeof t.audio){const e=function(t,e,n){e in t&&!(n in t)&&(t[n]=t[e],delete t[e])};e((t=JSON.parse(JSON.stringify(t))).audio,"autoGainControl","googAutoGainControl"),e(t.audio,"noiseSuppression","googNoiseSuppression"),t.audio=i(t.audio)}if(t&&"object"==typeof t.video){let s=t.video.facingMode;s=s&&("object"==typeof s?s:{ideal:s});const o=e.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)){let e;if(delete t.video.facingMode,"environment"===s.exact||"environment"===s.ideal?e=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(e=["front"]),e)return n.mediaDevices.enumerateDevices().then((n=>{let o=(n=n.filter((t=>"videoinput"===t.kind))).find((t=>e.some((e=>t.label.toLowerCase().includes(e)))));return!o&&n.length&&e.includes("back")&&(o=n[n.length-1]),o&&(t.video.deviceId=s.exact?{exact:o.deviceId}:{ideal:o.deviceId}),t.video=i(t.video),A("chrome: "+JSON.stringify(t)),r(t)}))}t.video=i(t.video)}return A("chrome: "+JSON.stringify(t)),r(t)},s=function(t){return e.version>=64?t:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[t.name]||t.name,message:t.message,constraint:t.constraint||t.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(t,e,i){r(t,(t=>{n.webkitGetUserMedia(t,e,(t=>{i&&i(s(t))}))}))}.bind(n),n.mediaDevices.getUserMedia){const t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(e){return r(e,(e=>t(e).then((t=>{if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((t=>{t.stop()})),new DOMException("","NotFoundError");return t}),(t=>Promise.reject(s(t))))))}}}function f(t){t.MediaStream=t.MediaStream||t.webkitMediaStream}function m(t){if("object"==typeof t&&t.RTCPeerConnection&&!("ontrack"in t.RTCPeerConnection.prototype)){Object.defineProperty(t.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(t){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=t)},enumerable:!0,configurable:!0});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=e=>{e.stream.addEventListener("addtrack",(n=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((t=>t.track&&t.track.id===n.track.id)):{track:n.track};const r=new Event("track");r.track=n.track,r.receiver=i,r.transceiver={receiver:i},r.streams=[e.stream],this.dispatchEvent(r)})),e.stream.getTracks().forEach((n=>{let i;i=t.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((t=>t.track&&t.track.id===n.id)):{track:n};const r=new Event("track");r.track=n,r.receiver=i,r.transceiver={receiver:i},r.streams=[e.stream],this.dispatchEvent(r)}))},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)}}else r(t,"track",(t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t)))}function g(t){if("object"==typeof t&&t.RTCPeerConnection&&!("getSenders"in t.RTCPeerConnection.prototype)&&"createDTMFSender"in t.RTCPeerConnection.prototype){const e=function(t,e){return{track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=t.createDTMFSender(e):this._dtmf=null),this._dtmf},_pc:t}};if(!t.RTCPeerConnection.prototype.getSenders){t.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,i){let r=n.apply(this,arguments);return r||(r=e(this,t),this._senders.push(r)),r};const i=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){i.apply(this,arguments);const e=this._senders.indexOf(t);-1!==e&&this._senders.splice(e,1)}}const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){this._senders=this._senders||[],n.apply(this,[t]),t.getTracks().forEach((t=>{this._senders.push(e(this,t))}))};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){this._senders=this._senders||[],i.apply(this,[t]),t.getTracks().forEach((t=>{const e=this._senders.find((e=>e.track===t));e&&this._senders.splice(this._senders.indexOf(e),1)}))}}else if("object"==typeof t&&t.RTCPeerConnection&&"getSenders"in t.RTCPeerConnection.prototype&&"createDTMFSender"in t.RTCPeerConnection.prototype&&t.RTCRtpSender&&!("dtmf"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;t.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t},Object.defineProperty(t.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function v(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[t,n,i]=arguments;if(arguments.length>0&&"function"==typeof t)return e.apply(this,arguments);if(0===e.length&&(0===arguments.length||"function"!=typeof t))return e.apply(this,[]);const r=function(t){const e={};return t.result().forEach((t=>{const n={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach((e=>{n[e]=t.stat(e)})),e[n.id]=n})),e},s=function(t){return new Map(Object.keys(t).map((e=>[e,t[e]])))};if(arguments.length>=2){const i=function(t){n(s(r(t)))};return e.apply(this,[i,t])}return new Promise(((t,n)=>{e.apply(this,[function(e){t(s(r(e)))},n])})).then(n,i)}}function y(t){if(!("object"==typeof t&&t.RTCPeerConnection&&t.RTCRtpSender&&t.RTCRtpReceiver))return;if(!("getStats"in t.RTCRtpSender.prototype)){const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const t=n.apply(this,arguments);return t._pc=this,t}),t.RTCRtpSender.prototype.getStats=function(){const t=this;return this._pc.getStats().then((e=>h(e,t.track,!0)))}}if(!("getStats"in t.RTCRtpReceiver.prototype)){const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t}),r(t,"track",(t=>(t.receiver._pc=t.srcElement,t))),t.RTCRtpReceiver.prototype.getStats=function(){const t=this;return this._pc.getStats().then((e=>h(e,t.track,!1)))}}if(!("getStats"in t.RTCRtpSender.prototype)||!("getStats"in t.RTCRtpReceiver.prototype))return;const e=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof t.MediaStreamTrack){const t=arguments[0];let e,n,i;return this.getSenders().forEach((n=>{n.track===t&&(e?i=!0:e=n)})),this.getReceivers().forEach((e=>(e.track===t&&(n?i=!0:n=e),e.track===t))),i||e&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):e?e.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return e.apply(this,arguments)}}function _(t){t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((t=>this._shimmedLocalStreams[t][0]))};const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addTrack=function(t,n){if(!n)return e.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const i=e.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};const n=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(t){this._shimmedLocalStreams=this._shimmedLocalStreams||{},t.getTracks().forEach((t=>{if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError")}));const e=this.getSenders();n.apply(this,arguments);const i=this.getSenders().filter((t=>-1===e.indexOf(t)));this._shimmedLocalStreams[t.id]=[t].concat(i)};const i=t.RTCPeerConnection.prototype.removeStream;t.RTCPeerConnection.prototype.removeStream=function(t){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[t.id],i.apply(this,arguments)};const r=t.RTCPeerConnection.prototype.removeTrack;t.RTCPeerConnection.prototype.removeTrack=function(t){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},t&&Object.keys(this._shimmedLocalStreams).forEach((e=>{const n=this._shimmedLocalStreams[e].indexOf(t);-1!==n&&this._shimmedLocalStreams[e].splice(n,1),1===this._shimmedLocalStreams[e].length&&delete this._shimmedLocalStreams[e]})),r.apply(this,arguments)}}function b(t,e){if(!t.RTCPeerConnection)return;if(t.RTCPeerConnection.prototype.addTrack&&e.version>=65)return _(t);const n=t.RTCPeerConnection.prototype.getLocalStreams;t.RTCPeerConnection.prototype.getLocalStreams=function(){const t=n.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((t=>this._reverseStreams[t.id]))};const i=t.RTCPeerConnection.prototype.addStream;t.RTCPeerConnection.prototype.addStream=function(e){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach((t=>{if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[e.id]){const n=new t.MediaStream(e.getTracks());this._streams[e.id]=n,this._reverseStreams[n.id]=e,e=n}i.apply(this,[e])};const r=t.RTCPeerConnection.prototype.removeStream;function s(t,e){let n=e.sdp;return Object.keys(t._reverseStreams||[]).forEach((e=>{const i=t._reverseStreams[e],r=t._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:e.type,sdp:n})}t.RTCPeerConnection.prototype.removeStream=function(t){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},r.apply(this,[this._streams[t.id]||t]),delete this._reverseStreams[this._streams[t.id]?this._streams[t.id].id:t.id],delete this._streams[t.id]},t.RTCPeerConnection.prototype.addTrack=function(e,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((t=>t===e)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const r=this._streams[n.id];if(r)r.addTrack(e),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const i=new t.MediaStream([e]);this._streams[n.id]=i,this._reverseStreams[i.id]=n,this.addStream(i)}return this.getSenders().find((t=>t.track===e))},["createOffer","createAnswer"].forEach((function(e){const n=t.RTCPeerConnection.prototype[e],i={[e](){const t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[e=>{const n=s(this,e);t[0].apply(null,[n])},e=>{t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then((t=>s(this,t)))}};t.RTCPeerConnection.prototype[e]=i[e]}));const o=t.RTCPeerConnection.prototype.setLocalDescription;t.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(t,e){let n=e.sdp;return Object.keys(t._reverseStreams||[]).forEach((e=>{const i=t._reverseStreams[e],r=t._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:e.type,sdp:n})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(t.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(t.RTCPeerConnection.prototype,"localDescription",{get(){const t=a.get.apply(this);return""===t.type?t:s(this,t)}}),t.RTCPeerConnection.prototype.removeTrack=function(t){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(t._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let e;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((e=>t.track===e))&&(e=this._streams[n])})),e&&(1===e.getTracks().length?this.removeStream(this._reverseStreams[e.id]):e.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}}function E(t,e){!t.RTCPeerConnection&&t.webkitRTCPeerConnection&&(t.RTCPeerConnection=t.webkitRTCPeerConnection),t.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){const n=t.RTCPeerConnection.prototype[e],i={[e](){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[e]=i[e]}))}function w(t,e){r(t,"negotiationneeded",(t=>{const n=t.target;if(!(e.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return t}))}var S=Object.freeze({__proto__:null,fixNegotiationNeeded:w,shimAddTrackRemoveTrack:b,shimAddTrackRemoveTrackWithNative:_,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&("function"==typeof e?t.navigator.mediaDevices.getDisplayMedia=function(n){return e(n).then((e=>{const i=n.video&&n.video.width,r=n.video&&n.video.height,s=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:s||3}},i&&(n.video.mandatory.maxWidth=i),r&&(n.video.mandatory.maxHeight=r),t.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:g,shimGetStats:v,shimGetUserMedia:p,shimMediaStream:f,shimOnTrack:m,shimPeerConnection:E,shimSenderReceiverGetStats:y});function T(t,e){const n=t&&t.navigator,i=t&&t.MediaStreamTrack;if(n.getUserMedia=function(t,e,i){c("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(t).then(e,i)},!(e.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const t=function(t,e,n){e in t&&!(n in t)&&(t[n]=t[e],delete t[e])},e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),t(n.audio,"autoGainControl","mozAutoGainControl"),t(n.audio,"noiseSuppression","mozNoiseSuppression")),e(n)},i&&i.prototype.getSettings){const e=i.prototype.getSettings;i.prototype.getSettings=function(){const n=e.apply(this,arguments);return t(n,"mozAutoGainControl","autoGainControl"),t(n,"mozNoiseSuppression","noiseSuppression"),n}}if(i&&i.prototype.applyConstraints){const e=i.prototype.applyConstraints;i.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),t(n,"autoGainControl","mozAutoGainControl"),t(n,"noiseSuppression","mozNoiseSuppression")),e.apply(this,[n])}}}}function C(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function R(t,e){if("object"!=typeof t||!t.RTCPeerConnection&&!t.mozRTCPeerConnection)return;!t.RTCPeerConnection&&t.mozRTCPeerConnection&&(t.RTCPeerConnection=t.mozRTCPeerConnection),e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(e){const n=t.RTCPeerConnection.prototype[e],i={[e](){return arguments[0]=new("addIceCandidate"===e?t.RTCIceCandidate:t.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};t.RTCPeerConnection.prototype[e]=i[e]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=t.RTCPeerConnection.prototype.getStats;t.RTCPeerConnection.prototype.getStats=function(){const[t,r,s]=arguments;return i.apply(this,[t||null]).then((t=>{if(e.version<53&&!r)try{t.forEach((t=>{t.type=n[t.type]||t.type}))}catch(e){if("TypeError"!==e.name)throw e;t.forEach(((e,i)=>{t.set(i,Object.assign({},e,{type:n[e.type]||e.type}))}))}return t})).then(r,s)}}function I(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender)return;if(t.RTCRtpSender&&"getStats"in t.RTCRtpSender.prototype)return;const e=t.RTCPeerConnection.prototype.getSenders;e&&(t.RTCPeerConnection.prototype.getSenders=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t});const n=t.RTCPeerConnection.prototype.addTrack;n&&(t.RTCPeerConnection.prototype.addTrack=function(){const t=n.apply(this,arguments);return t._pc=this,t}),t.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function x(t){if("object"!=typeof t||!t.RTCPeerConnection||!t.RTCRtpSender)return;if(t.RTCRtpSender&&"getStats"in t.RTCRtpReceiver.prototype)return;const e=t.RTCPeerConnection.prototype.getReceivers;e&&(t.RTCPeerConnection.prototype.getReceivers=function(){const t=e.apply(this,[]);return t.forEach((t=>t._pc=this)),t}),r(t,"track",(t=>(t.receiver._pc=t.srcElement,t))),t.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function O(t){t.RTCPeerConnection&&!("removeStream"in t.RTCPeerConnection.prototype)&&(t.RTCPeerConnection.prototype.removeStream=function(t){c("removeStream","removeTrack"),this.getSenders().forEach((e=>{e.track&&t.getTracks().includes(e.track)&&this.removeTrack(e)}))})}function L(t){t.DataChannel&&!t.RTCDataChannel&&(t.RTCDataChannel=t.DataChannel)}function M(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.addTransceiver;e&&(t.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let t=arguments[1]&&arguments[1].sendEncodings;void 0===t&&(t=[]),t=[...t];const n=t.length>0;n&&t.forEach((t=>{if("rid"in t&&!/^[a-z0-9]{0,16}$/i.test(t.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in t&&!(parseFloat(t.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in t&&!(parseFloat(t.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const i=e.apply(this,arguments);if(n){const{sender:e}=i,n=e.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=t,e.sendEncodings=t,this.setParametersPromises.push(e.setParameters(n).then((()=>{delete e.sendEncodings})).catch((()=>{delete e.sendEncodings}))))}return i})}function k(t){if("object"!=typeof t||!t.RTCRtpSender)return;const e=t.RTCRtpSender.prototype.getParameters;e&&(t.RTCRtpSender.prototype.getParameters=function(){const t=e.apply(this,arguments);return"encodings"in t||(t.encodings=[].concat(this.sendEncodings||[{}])),t})}function N(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>e.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):e.apply(this,arguments)}}function P(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype.createAnswer;t.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>e.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):e.apply(this,arguments)}}var D=Object.freeze({__proto__:null,shimAddTransceiver:M,shimCreateAnswer:P,shimCreateOffer:N,shimGetDisplayMedia:function(t,e){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const t=new DOMException("getDisplayMedia without video constraints is undefined");return t.name="NotFoundError",t.code=8,Promise.reject(t)}return!0===n.video?n.video={mediaSource:e}:n.video.mediaSource=e,t.navigator.mediaDevices.getUserMedia(n)})},shimGetParameters:k,shimGetUserMedia:T,shimOnTrack:C,shimPeerConnection:R,shimRTCDataChannel:L,shimReceiverGetStats:x,shimRemoveStream:O,shimSenderGetStats:I});function B(t){if("object"==typeof t&&t.RTCPeerConnection){if("getLocalStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in t.RTCPeerConnection.prototype)){const e=t.RTCPeerConnection.prototype.addTrack;t.RTCPeerConnection.prototype.addStream=function(t){this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach((n=>e.call(this,n,t))),t.getVideoTracks().forEach((n=>e.call(this,n,t)))},t.RTCPeerConnection.prototype.addTrack=function(t,...n){return n&&n.forEach((t=>{this._localStreams?this._localStreams.includes(t)||this._localStreams.push(t):this._localStreams=[t]})),e.apply(this,arguments)}}"removeStream"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const e=this._localStreams.indexOf(t);if(-1===e)return;this._localStreams.splice(e,1);const n=t.getTracks();this.getSenders().forEach((t=>{n.includes(t.track)&&this.removeTrack(t)}))})}}function U(t){if("object"==typeof t&&t.RTCPeerConnection&&("getRemoteStreams"in t.RTCPeerConnection.prototype||(t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in t.RTCPeerConnection.prototype))){Object.defineProperty(t.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(t){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=t),this.addEventListener("track",this._onaddstreampoly=t=>{t.streams.forEach((t=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(t))return;this._remoteStreams.push(t);const e=new Event("addstream");e.stream=t,this.dispatchEvent(e)}))})}});const e=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){const t=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((e=>{if(t._remoteStreams||(t._remoteStreams=[]),t._remoteStreams.indexOf(e)>=0)return;t._remoteStreams.push(e);const n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}))}),e.apply(t,arguments)}}}function F(t){if("object"!=typeof t||!t.RTCPeerConnection)return;const e=t.RTCPeerConnection.prototype,n=e.createOffer,i=e.createAnswer,r=e.setLocalDescription,s=e.setRemoteDescription,o=e.addIceCandidate;e.createOffer=function(t,e){const i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return e?(r.then(t,e),Promise.resolve()):r},e.createAnswer=function(t,e){const n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return e?(r.then(t,e),Promise.resolve()):r};let a=function(t,e,n){const i=r.apply(this,[t]);return n?(i.then(e,n),Promise.resolve()):i};e.setLocalDescription=a,a=function(t,e,n){const i=s.apply(this,[t]);return n?(i.then(e,n),Promise.resolve()):i},e.setRemoteDescription=a,a=function(t,e,n){const i=o.apply(this,[t]);return n?(i.then(e,n),Promise.resolve()):i},e.addIceCandidate=a}function H(t){const e=t&&t.navigator;if(e.mediaDevices&&e.mediaDevices.getUserMedia){const t=e.mediaDevices,n=t.getUserMedia.bind(t);e.mediaDevices.getUserMedia=t=>n(V(t))}!e.getUserMedia&&e.mediaDevices&&e.mediaDevices.getUserMedia&&(e.getUserMedia=function(t,n,i){e.mediaDevices.getUserMedia(t).then(n,i)}.bind(e))}function V(t){return t&&void 0!==t.video?Object.assign({},t,{video:u(t.video)}):t}function j(t){if(!t.RTCPeerConnection)return;const e=t.RTCPeerConnection;t.RTCPeerConnection=function(t,n){if(t&&t.iceServers){const e=[];for(let n=0;n<t.iceServers.length;n++){let i=t.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(c("RTCIceServer.url","RTCIceServer.urls"),i=JSON.parse(JSON.stringify(i)),i.urls=i.url,delete i.url,e.push(i)):e.push(t.iceServers[n])}t.iceServers=e}return new e(t,n)},t.RTCPeerConnection.prototype=e.prototype,"generateCertificate"in e&&Object.defineProperty(t.RTCPeerConnection,"generateCertificate",{get:()=>e.generateCertificate})}function G(t){"object"==typeof t&&t.RTCTrackEvent&&"receiver"in t.RTCTrackEvent.prototype&&!("transceiver"in t.RTCTrackEvent.prototype)&&Object.defineProperty(t.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Q(t){const e=t.RTCPeerConnection.prototype.createOffer;t.RTCPeerConnection.prototype.createOffer=function(t){if(t){void 0!==t.offerToReceiveAudio&&(t.offerToReceiveAudio=!!t.offerToReceiveAudio);const e=this.getTransceivers().find((t=>"audio"===t.receiver.track.kind));!1===t.offerToReceiveAudio&&e?"sendrecv"===e.direction?e.setDirection?e.setDirection("sendonly"):e.direction="sendonly":"recvonly"===e.direction&&(e.setDirection?e.setDirection("inactive"):e.direction="inactive"):!0!==t.offerToReceiveAudio||e||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==t.offerToReceiveVideo&&(t.offerToReceiveVideo=!!t.offerToReceiveVideo);const n=this.getTransceivers().find((t=>"video"===t.receiver.track.kind));!1===t.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==t.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return e.apply(this,arguments)}}function z(t){"object"!=typeof t||t.AudioContext||(t.AudioContext=t.webkitAudioContext)}var W=Object.freeze({__proto__:null,shimAudioContext:z,shimCallbacksAPI:F,shimConstraints:V,shimCreateOfferLegacy:Q,shimGetUserMedia:H,shimLocalStreamsAPI:B,shimRTCIceServerUrls:j,shimRemoteStreamsAPI:U,shimTrackEventTransceiver:G}),K="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==kn?kn:"undefined"!=typeof self?self:{};function q(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Y={exports:{}};!function(t){const e={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};e.localCName=e.generateIdentifier(),e.splitLines=function(t){return t.trim().split("\n").map((t=>t.trim()))},e.splitSections=function(t){return t.split("\nm=").map(((t,e)=>(e>0?"m="+t:t).trim()+"\r\n"))},e.getDescription=function(t){const n=e.splitSections(t);return n&&n[0]},e.getMediaSections=function(t){const n=e.splitSections(t);return n.shift(),n},e.matchPrefix=function(t,n){return e.splitLines(t).filter((t=>0===t.indexOf(n)))},e.parseCandidate=function(t){let e;e=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" ");const n={foundation:e[0],component:{1:"rtp",2:"rtcp"}[e[1]]||e[1],protocol:e[2].toLowerCase(),priority:parseInt(e[3],10),ip:e[4],address:e[4],port:parseInt(e[5],10),type:e[7]};for(let t=8;t<e.length;t+=2)switch(e[t]){case"raddr":n.relatedAddress=e[t+1];break;case"rport":n.relatedPort=parseInt(e[t+1],10);break;case"tcptype":n.tcpType=e[t+1];break;case"ufrag":n.ufrag=e[t+1],n.usernameFragment=e[t+1];break;default:void 0===n[e[t]]&&(n[e[t]]=e[t+1])}return n},e.writeCandidate=function(t){const e=[];e.push(t.foundation);const n=t.component;"rtp"===n?e.push(1):"rtcp"===n?e.push(2):e.push(n),e.push(t.protocol.toUpperCase()),e.push(t.priority),e.push(t.address||t.ip),e.push(t.port);const i=t.type;return e.push("typ"),e.push(i),"host"!==i&&t.relatedAddress&&t.relatedPort&&(e.push("raddr"),e.push(t.relatedAddress),e.push("rport"),e.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(e.push("tcptype"),e.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(e.push("ufrag"),e.push(t.usernameFragment||t.ufrag)),"candidate:"+e.join(" ")},e.parseIceOptions=function(t){return t.substring(14).split(" ")},e.parseRtpMap=function(t){let e=t.substring(9).split(" ");const n={payloadType:parseInt(e.shift(),10)};return e=e[0].split("/"),n.name=e[0],n.clockRate=parseInt(e[1],10),n.channels=3===e.length?parseInt(e[2],10):1,n.numChannels=n.channels,n},e.writeRtpMap=function(t){let e=t.payloadType;void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType);const n=t.channels||t.numChannels||1;return"a=rtpmap:"+e+" "+t.name+"/"+t.clockRate+(1!==n?"/"+n:"")+"\r\n"},e.parseExtmap=function(t){const e=t.substring(9).split(" ");return{id:parseInt(e[0],10),direction:e[0].indexOf("/")>0?e[0].split("/")[1]:"sendrecv",uri:e[1],attributes:e.slice(2).join(" ")}},e.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&"sendrecv"!==t.direction?"/"+t.direction:"")+" "+t.uri+(t.attributes?" "+t.attributes:"")+"\r\n"},e.parseFmtp=function(t){const e={};let n;const i=t.substring(t.indexOf(" ")+1).split(";");for(let t=0;t<i.length;t++)n=i[t].trim().split("="),e[n[0].trim()]=n[1];return e},e.writeFmtp=function(t){let e="",n=t.payloadType;if(void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){const i=[];Object.keys(t.parameters).forEach((e=>{void 0!==t.parameters[e]?i.push(e+"="+t.parameters[e]):i.push(e)})),e+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return e},e.parseRtcpFb=function(t){const e=t.substring(t.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},e.writeRtcpFb=function(t){let e="",n=t.payloadType;return void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach((t=>{e+="a=rtcp-fb:"+n+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"})),e},e.parseSsrcMedia=function(t){const e=t.indexOf(" "),n={ssrc:parseInt(t.substring(7,e),10)},i=t.indexOf(":",e);return i>-1?(n.attribute=t.substring(e+1,i),n.value=t.substring(i+1)):n.attribute=t.substring(e+1),n},e.parseSsrcGroup=function(t){const e=t.substring(13).split(" ");return{semantics:e.shift(),ssrcs:e.map((t=>parseInt(t,10)))}},e.getMid=function(t){const n=e.matchPrefix(t,"a=mid:")[0];if(n)return n.substring(6)},e.parseFingerprint=function(t){const e=t.substring(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1].toUpperCase()}},e.getDtlsParameters=function(t,n){return{role:"auto",fingerprints:e.matchPrefix(t+n,"a=fingerprint:").map(e.parseFingerprint)}},e.writeDtlsParameters=function(t,e){let n="a=setup:"+e+"\r\n";return t.fingerprints.forEach((t=>{n+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"})),n},e.parseCryptoLine=function(t){const e=t.substring(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},e.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+("object"==typeof t.keyParams?e.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+"\r\n"},e.parseCryptoKeyParams=function(t){if(0!==t.indexOf("inline:"))return null;const e=t.substring(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},e.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},e.getCryptoParameters=function(t,n){return e.matchPrefix(t+n,"a=crypto:").map(e.parseCryptoLine)},e.getIceParameters=function(t,n){const i=e.matchPrefix(t+n,"a=ice-ufrag:")[0],r=e.matchPrefix(t+n,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substring(12),password:r.substring(10)}:null},e.writeIceParameters=function(t){let e="a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n";return t.iceLite&&(e+="a=ice-lite\r\n"),e},e.parseRtpParameters=function(t){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=e.splitLines(t)[0].split(" ");n.profile=i[2];for(let r=3;r<i.length;r++){const s=i[r],o=e.matchPrefix(t,"a=rtpmap:"+s+" ")[0];if(o){const i=e.parseRtpMap(o),r=e.matchPrefix(t,"a=fmtp:"+s+" ");switch(i.parameters=r.length?e.parseFmtp(r[0]):{},i.rtcpFeedback=e.matchPrefix(t,"a=rtcp-fb:"+s+" ").map(e.parseRtcpFb),n.codecs.push(i),i.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(i.name.toUpperCase())}}}e.matchPrefix(t,"a=extmap:").forEach((t=>{n.headerExtensions.push(e.parseExtmap(t))}));const r=e.matchPrefix(t,"a=rtcp-fb:* ").map(e.parseRtcpFb);return n.codecs.forEach((t=>{r.forEach((e=>{t.rtcpFeedback.find((t=>t.type===e.type&&t.parameter===e.parameter))||t.rtcpFeedback.push(e)}))})),n},e.writeRtpDescription=function(t,n){let i="";i+="m="+t+" ",i+=n.codecs.length>0?"9":"0",i+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",i+=n.codecs.map((t=>void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType)).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((t=>{i+=e.writeRtpMap(t),i+=e.writeFmtp(t),i+=e.writeRtcpFb(t)}));let r=0;return n.codecs.forEach((t=>{t.maxptime>r&&(r=t.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((t=>{i+=e.writeExtmap(t)})),i},e.parseRtpEncodingParameters=function(t){const n=[],i=e.parseRtpParameters(t),r=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),o=e.matchPrefix(t,"a=ssrc:").map((t=>e.parseSsrcMedia(t))).filter((t=>"cname"===t.attribute)),a=o.length>0&&o[0].ssrc;let c;const l=e.matchPrefix(t,"a=ssrc-group:FID").map((t=>t.substring(17).split(" ").map((t=>parseInt(t,10)))));l.length>0&&l[0].length>1&&l[0][0]===a&&(c=l[0][1]),i.codecs.forEach((t=>{if("RTX"===t.name.toUpperCase()&&t.parameters.apt){let e={ssrc:a,codecPayloadType:parseInt(t.parameters.apt,10)};a&&c&&(e.rtx={ssrc:c}),n.push(e),r&&(e=JSON.parse(JSON.stringify(e)),e.fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},n.push(e))}})),0===n.length&&a&&n.push({ssrc:a});let u=e.matchPrefix(t,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substring(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substring(5),10)*.95-16e3:void 0,n.forEach((t=>{t.maxBitrate=u}))),n},e.parseRtcpParameters=function(t){const n={},i=e.matchPrefix(t,"a=ssrc:").map((t=>e.parseSsrcMedia(t))).filter((t=>"cname"===t.attribute))[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);const r=e.matchPrefix(t,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;const s=e.matchPrefix(t,"a=rtcp-mux");return n.mux=s.length>0,n},e.writeRtcpParameters=function(t){let e="";return t.reducedSize&&(e+="a=rtcp-rsize\r\n"),t.mux&&(e+="a=rtcp-mux\r\n"),void 0!==t.ssrc&&t.cname&&(e+="a=ssrc:"+t.ssrc+" cname:"+t.cname+"\r\n"),e},e.parseMsid=function(t){let n;const i=e.matchPrefix(t,"a=msid:");if(1===i.length)return n=i[0].substring(7).split(" "),{stream:n[0],track:n[1]};const r=e.matchPrefix(t,"a=ssrc:").map((t=>e.parseSsrcMedia(t))).filter((t=>"msid"===t.attribute));return r.length>0?(n=r[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},e.parseSctpDescription=function(t){const n=e.parseMLine(t),i=e.matchPrefix(t,"a=max-message-size:");let r;i.length>0&&(r=parseInt(i[0].substring(19),10)),isNaN(r)&&(r=65536);const s=e.matchPrefix(t,"a=sctp-port:");if(s.length>0)return{port:parseInt(s[0].substring(12),10),protocol:n.fmt,maxMessageSize:r};const o=e.matchPrefix(t,"a=sctpmap:");if(o.length>0){const t=o[0].substring(10).split(" ");return{port:parseInt(t[0],10),protocol:t[1],maxMessageSize:r}}},e.writeSctpDescription=function(t,e){let n=[];return n="DTLS/SCTP"!==t.protocol?["m="+t.kind+" 9 "+t.protocol+" "+e.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+e.port+"\r\n"]:["m="+t.kind+" 9 "+t.protocol+" "+e.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+e.port+" "+e.protocol+" 65535\r\n"],void 0!==e.maxMessageSize&&n.push("a=max-message-size:"+e.maxMessageSize+"\r\n"),n.join("")},e.generateSessionId=function(){return Math.random().toString().substr(2,22)},e.writeSessionBoilerplate=function(t,n,i){let r;const s=void 0!==n?n:2;return r=t||e.generateSessionId(),"v=0\r\no="+(i||"thisisadapterortc")+" "+r+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},e.getDirection=function(t,n){const i=e.splitLines(t);for(let t=0;t<i.length;t++)switch(i[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[t].substring(2)}return n?e.getDirection(n):"sendrecv"},e.getKind=function(t){return e.splitLines(t)[0].split(" ")[0].substring(2)},e.isRejected=function(t){return"0"===t.split(" ",2)[1]},e.parseMLine=function(t){const n=e.splitLines(t)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},e.parseOLine=function(t){const n=e.matchPrefix(t,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},e.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;const n=e.splitLines(t);for(let t=0;t<n.length;t++)if(n[t].length<2||"="!==n[t].charAt(1))return!1;return!0},t.exports=e}(Y);var $=Y.exports,X=q($),J=t({__proto__:null,default:X},[$]);function Z(t){if(!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype)return;const e=t.RTCIceCandidate;t.RTCIceCandidate=function(t){if("object"==typeof t&&t.candidate&&0===t.candidate.indexOf("a=")&&((t=JSON.parse(JSON.stringify(t))).candidate=t.candidate.substr(2)),t.candidate&&t.candidate.length){const n=new e(t),i=X.parseCandidate(t.candidate),r=Object.assign(n,i);return r.toJSON=function(){return{candidate:r.candidate,sdpMid:r.sdpMid,sdpMLineIndex:r.sdpMLineIndex,usernameFragment:r.usernameFragment}},r}return new e(t)},t.RTCIceCandidate.prototype=e.prototype,r(t,"icecandidate",(e=>(e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e)))}function tt(t){!t.RTCIceCandidate||t.RTCIceCandidate&&"relayProtocol"in t.RTCIceCandidate.prototype||r(t,"icecandidate",(t=>{if(t.candidate){const e=X.parseCandidate(t.candidate.candidate);"relay"===e.type&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[e.priority>>24])}return t}))}function et(t,e){if(!t.RTCPeerConnection)return;"sctp"in t.RTCPeerConnection.prototype||Object.defineProperty(t.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(t){if(!t||!t.sdp)return!1;const e=X.splitSections(t.sdp);return e.shift(),e.some((t=>{const e=X.parseMLine(t);return e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")}))},i=function(t){const e=t.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;const n=parseInt(e[1],10);return n!=n?-1:n},r=function(t){let n=65536;return"firefox"===e.browser&&(n=e.version<57?-1===t?16384:2147483637:e.version<60?57===e.version?65535:65536:2147483637),n},s=function(t,n){let i=65536;"firefox"===e.browser&&57===e.version&&(i=65535);const r=X.matchPrefix(t.sdp,"a=max-message-size:");return r.length>0?i=parseInt(r[0].substr(19),10):"firefox"===e.browser&&-1!==n&&(i=2147483637),i},o=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===e.browser&&e.version>=76){const{sdpSemantics:t}=this.getConfiguration();"plan-b"===t&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const t=i(arguments[0]),e=r(t),n=s(arguments[0],t);let o;o=0===e&&0===n?Number.POSITIVE_INFINITY:0===e||0===n?Math.max(e,n):Math.min(e,n);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>o}),this._sctp=a}return o.apply(this,arguments)}}function nt(t){if(!t.RTCPeerConnection||!("createDataChannel"in t.RTCPeerConnection.prototype))return;function e(t,e){const n=t.send;t.send=function(){const i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===t.readyState&&e.sctp&&r>e.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+e.sctp.maxMessageSize+" bytes)");return n.apply(t,arguments)}}const n=t.RTCPeerConnection.prototype.createDataChannel;t.RTCPeerConnection.prototype.createDataChannel=function(){const t=n.apply(this,arguments);return e(t,this),t},r(t,"datachannel",(t=>(e(t.channel,t.target),t)))}function it(t){if(!t.RTCPeerConnection||"connectionState"in t.RTCPeerConnection.prototype)return;const e=t.RTCPeerConnection.prototype;Object.defineProperty(e,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(e,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(t){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),t&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=t)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((t=>{const n=e[t];e[t]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=t=>{const e=t.target;if(e._lastConnectionState!==e.connectionState){e._lastConnectionState=e.connectionState;const n=new Event("connectionstatechange",t);e.dispatchEvent(n)}return t},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function rt(t,e){if(!t.RTCPeerConnection)return;if("chrome"===e.browser&&e.version>=71)return;if("safari"===e.browser&&e.version>=605)return;const n=t.RTCPeerConnection.prototype.setRemoteDescription;t.RTCPeerConnection.prototype.setRemoteDescription=function(e){if(e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")){const n=e.sdp.split("\n").filter((t=>"a=extmap-allow-mixed"!==t.trim())).join("\n");t.RTCSessionDescription&&e instanceof t.RTCSessionDescription?arguments[0]=new t.RTCSessionDescription({type:e.type,sdp:n}):e.sdp=n}return n.apply(this,arguments)}}function st(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(t.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===e.browser&&e.version<78||"firefox"===e.browser&&e.version<68||"safari"===e.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ot(t,e){if(!t.RTCPeerConnection||!t.RTCPeerConnection.prototype)return;const n=t.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(t.RTCPeerConnection.prototype.setLocalDescription=function(){let t=arguments[0]||{};if("object"!=typeof t||t.type&&t.sdp)return n.apply(this,arguments);if(t={type:t.type,sdp:t.sdp},!t.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}return t.sdp||"offer"!==t.type&&"answer"!==t.type?n.apply(this,[t]):("offer"===t.type?this.createOffer:this.createAnswer).apply(this).then((t=>n.apply(this,[t])))})}var at=Object.freeze({__proto__:null,removeExtmapAllowMixed:rt,shimAddIceCandidateNullOrEmpty:st,shimConnectionState:it,shimMaxMessageSize:et,shimParameterlessSetLocalDescription:ot,shimRTCIceCandidate:Z,shimRTCIceCandidateRelayProtocol:tt,shimSendThrowTypeError:nt});!function({window:t}={},e={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const n=a,r=function(t){const e={browser:null,version:null};if(void 0===t||!t.navigator)return e.browser="Not a browser.",e;const{navigator:n}=t;if(n.mozGetUserMedia)e.browser="firefox",e.version=i(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===t.isSecureContext&&t.webkitRTCPeerConnection)e.browser="chrome",e.version=i(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=i(n.userAgent,/AppleWebKit\/(\d+)\./,1),e.supportsUnifiedPlan=t.RTCRtpTransceiver&&"currentDirection"in t.RTCRtpTransceiver.prototype}return e}(t),c={browserDetails:r,commonShim:at,extractVersion:i,disableLog:s,disableWarnings:o,sdp:J};switch(r.browser){case"chrome":if(!S||!E||!e.shimChrome)return n("Chrome shim is not included in this adapter release."),c;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),c;n("adapter.js shimming chrome."),c.browserShim=S,st(t,r),ot(t),p(t,r),f(t),E(t,r),m(t),b(t,r),g(t),v(t),y(t),w(t,r),Z(t),tt(t),it(t),et(t,r),nt(t),rt(t,r);break;case"firefox":if(!D||!R||!e.shimFirefox)return n("Firefox shim is not included in this adapter release."),c;n("adapter.js shimming firefox."),c.browserShim=D,st(t,r),ot(t),T(t,r),R(t,r),C(t),O(t),I(t),x(t),L(t),M(t),k(t),N(t),P(t),Z(t),it(t),et(t,r),nt(t);break;case"safari":if(!W||!e.shimSafari)return n("Safari shim is not included in this adapter release."),c;n("adapter.js shimming safari."),c.browserShim=W,st(t,r),ot(t),j(t),Q(t),F(t),B(t),U(t),G(t),H(t),z(t),Z(t),tt(t),et(t,r),nt(t),rt(t,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var ct=function(t){try{return!!t()}catch(t){return!0}},lt=!ct((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),ut=lt,dt=Function.prototype,ht=dt.call,At=ut&&dt.bind.bind(ht,ht),pt=ut?At:function(t){return function(){return ht.apply(t,arguments)}},ft=pt({}.isPrototypeOf),mt=function(t){return t&&t.Math==Math&&t},gt=mt("object"==typeof globalThis&&globalThis)||mt("object"==typeof window&&window)||mt("object"==typeof self&&self)||mt("object"==typeof K&&K)||function(){return this}()||K||Function("return this")(),vt=lt,yt=Function.prototype,_t=yt.apply,bt=yt.call,Et="object"==typeof Reflect&&Reflect.apply||(vt?bt.bind(_t):function(){return bt.apply(_t,arguments)}),wt=pt,St=wt({}.toString),Tt=wt("".slice),Ct=function(t){return Tt(St(t),8,-1)},Rt=Ct,It=pt,xt=function(t){if("Function"===Rt(t))return It(t)},Ot="object"==typeof document&&document.all,Lt={all:Ot,IS_HTMLDDA:void 0===Ot&&void 0!==Ot},Mt=Lt.all,kt=Lt.IS_HTMLDDA?function(t){return"function"==typeof t||t===Mt}:function(t){return"function"==typeof t},Nt={},Pt=!ct((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Dt=lt,Bt=Function.prototype.call,Ut=Dt?Bt.bind(Bt):function(){return Bt.apply(Bt,arguments)},Ft={},Ht={}.propertyIsEnumerable,Vt=Object.getOwnPropertyDescriptor,jt=Vt&&!Ht.call({1:2},1);Ft.f=jt?function(t){var e=Vt(this,t);return!!e&&e.enumerable}:Ht;var Gt,Qt,zt=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},Wt=ct,Kt=Ct,qt=Object,Yt=pt("".split),$t=Wt((function(){return!qt("z").propertyIsEnumerable(0)}))?function(t){return"String"==Kt(t)?Yt(t,""):qt(t)}:qt,Xt=function(t){return null==t},Jt=Xt,Zt=TypeError,te=function(t){if(Jt(t))throw Zt("Can't call method on "+t);return t},ee=$t,ne=te,ie=function(t){return ee(ne(t))},re=kt,se=Lt.all,oe=Lt.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:re(t)||t===se}:function(t){return"object"==typeof t?null!==t:re(t)},ae={},ce=ae,le=gt,ue=kt,de=function(t){return ue(t)?t:void 0},he=function(t,e){return arguments.length<2?de(ce[t])||de(le[t]):ce[t]&&ce[t][e]||le[t]&&le[t][e]},Ae="undefined"!=typeof navigator&&String(navigator.userAgent)||"",pe=gt,fe=Ae,me=pe.process,ge=pe.Deno,ve=me&&me.versions||ge&&ge.version,ye=ve&&ve.v8;ye&&(Qt=(Gt=ye.split("."))[0]>0&&Gt[0]<4?1:+(Gt[0]+Gt[1])),!Qt&&fe&&(!(Gt=fe.match(/Edge\/(\d+)/))||Gt[1]>=74)&&(Gt=fe.match(/Chrome\/(\d+)/))&&(Qt=+Gt[1]);var _e=Qt,be=_e,Ee=ct,we=gt.String,Se=!!Object.getOwnPropertySymbols&&!Ee((function(){var t=Symbol();return!we(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&be&&be<41})),Te=Se&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ce=he,Re=kt,Ie=ft,xe=Object,Oe=Te?function(t){return"symbol"==typeof t}:function(t){var e=Ce("Symbol");return Re(e)&&Ie(e.prototype,xe(t))},Le=String,Me=function(t){try{return Le(t)}catch(t){return"Object"}},ke=kt,Ne=Me,Pe=TypeError,De=function(t){if(ke(t))return t;throw Pe(Ne(t)+" is not a function")},Be=De,Ue=Xt,Fe=function(t,e){var n=t[e];return Ue(n)?void 0:Be(n)},He=Ut,Ve=kt,je=oe,Ge=TypeError,Qe={exports:{}},ze=gt,We=Object.defineProperty,Ke=function(t,e){try{We(ze,t,{value:e,configurable:!0,writable:!0})}catch(n){ze[t]=e}return e},qe="__core-js_shared__",Ye=gt[qe]||Ke(qe,{}),$e=Ye;(Qe.exports=function(t,e){return $e[t]||($e[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Xe=Qe.exports,Je=te,Ze=Object,tn=function(t){return Ze(Je(t))},en=tn,nn=pt({}.hasOwnProperty),rn=Object.hasOwn||function(t,e){return nn(en(t),e)},sn=pt,on=0,an=Math.random(),cn=sn(1..toString),ln=function(t){return"Symbol("+(void 0===t?"":t)+")_"+cn(++on+an,36)},un=Xe,dn=rn,hn=ln,An=Se,pn=Te,fn=gt.Symbol,mn=un("wks"),gn=pn?fn.for||fn:fn&&fn.withoutSetter||hn,vn=function(t){return dn(mn,t)||(mn[t]=An&&dn(fn,t)?fn[t]:gn("Symbol."+t)),mn[t]},yn=Ut,_n=oe,bn=Oe,En=Fe,wn=function(t,e){var n,i;if("string"===e&&Ve(n=t.toString)&&!je(i=He(n,t)))return i;if(Ve(n=t.valueOf)&&!je(i=He(n,t)))return i;if("string"!==e&&Ve(n=t.toString)&&!je(i=He(n,t)))return i;throw Ge("Can't convert object to primitive value")},Sn=TypeError,Tn=vn("toPrimitive"),Cn=function(t,e){if(!_n(t)||bn(t))return t;var n,i=En(t,Tn);if(i){if(void 0===e&&(e="default"),n=yn(i,t,e),!_n(n)||bn(n))return n;throw Sn("Can't convert object to primitive value")}return void 0===e&&(e="number"),wn(t,e)},Rn=Oe,In=function(t){var e=Cn(t,"string");return Rn(e)?e:e+""},xn=oe,On=gt.document,Ln=xn(On)&&xn(On.createElement),Mn=function(t){return Ln?On.createElement(t):{}},Nn=Mn,Pn=!Pt&&!ct((function(){return 7!=Object.defineProperty(Nn("div"),"a",{get:function(){return 7}}).a})),Dn=Pt,Bn=Ut,Un=Ft,Fn=zt,Hn=ie,Vn=In,jn=rn,Gn=Pn,Qn=Object.getOwnPropertyDescriptor;Nt.f=Dn?Qn:function(t,e){if(t=Hn(t),e=Vn(e),Gn)try{return Qn(t,e)}catch(t){}if(jn(t,e))return Fn(!Bn(Un.f,t,e),t[e])};var zn=ct,Wn=kt,Kn=/#|\.prototype\./,qn=function(t,e){var n=$n[Yn(t)];return n==Jn||n!=Xn&&(Wn(e)?zn(e):!!e)},Yn=qn.normalize=function(t){return String(t).replace(Kn,".").toLowerCase()},$n=qn.data={},Xn=qn.NATIVE="N",Jn=qn.POLYFILL="P",Zn=qn,ti=De,ei=lt,ni=xt(xt.bind),ii=function(t,e){return ti(t),void 0===e?t:ei?ni(t,e):function(){return t.apply(e,arguments)}},ri={},si=Pt&&ct((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),oi=oe,ai=String,ci=TypeError,li=function(t){if(oi(t))return t;throw ci(ai(t)+" is not an object")},ui=Pt,di=Pn,hi=si,Ai=li,pi=In,fi=TypeError,mi=Object.defineProperty,gi=Object.getOwnPropertyDescriptor,vi="enumerable",yi="configurable",_i="writable";ri.f=ui?hi?function(t,e,n){if(Ai(t),e=pi(e),Ai(n),"function"==typeof t&&"prototype"===e&&"value"in n&&_i in n&&!n[_i]){var i=gi(t,e);i&&i[_i]&&(t[e]=n.value,n={configurable:yi in n?n[yi]:i[yi],enumerable:vi in n?n[vi]:i[vi],writable:!1})}return mi(t,e,n)}:mi:function(t,e,n){if(Ai(t),e=pi(e),Ai(n),di)try{return mi(t,e,n)}catch(t){}if("get"in n||"set"in n)throw fi("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var bi=ri,Ei=zt,wi=Pt?function(t,e,n){return bi.f(t,e,Ei(1,n))}:function(t,e,n){return t[e]=n,t},Si=gt,Ti=Et,Ci=xt,Ri=kt,Ii=Nt.f,xi=Zn,Oi=ae,Li=ii,Mi=wi,ki=rn,Ni=function(t){var e=function(n,i,r){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,i)}return new t(n,i,r)}return Ti(t,this,arguments)};return e.prototype=t.prototype,e},Pi=function(t,e){var n,i,r,s,o,a,c,l,u,d=t.target,h=t.global,A=t.stat,p=t.proto,f=h?Si:A?Si[d]:(Si[d]||{}).prototype,m=h?Oi:Oi[d]||Mi(Oi,d,{})[d],g=m.prototype;for(s in e)i=!(n=xi(h?s:d+(A?".":"#")+s,t.forced))&&f&&ki(f,s),a=m[s],i&&(c=t.dontCallGetSet?(u=Ii(f,s))&&u.value:f[s]),o=i&&c?c:e[s],i&&typeof a==typeof o||(l=t.bind&&i?Li(o,Si):t.wrap&&i?Ni(o):p&&Ri(o)?Ci(o):o,(t.sham||o&&o.sham||a&&a.sham)&&Mi(l,"sham",!0),Mi(m,s,l),p&&(ki(Oi,r=d+"Prototype")||Mi(Oi,r,{}),Mi(Oi[r],s,o),t.real&&g&&(n||!g[s])&&Mi(g,s,o)))},Di=Math.ceil,Bi=Math.floor,Ui=Math.trunc||function(t){var e=+t;return(e>0?Bi:Di)(e)},Fi=function(t){var e=+t;return e!=e||0===e?0:Ui(e)},Hi=Fi,Vi=Math.max,ji=Math.min,Gi=function(t,e){var n=Hi(t);return n<0?Vi(n+e,0):ji(n,e)},Qi=Fi,zi=Math.min,Wi=function(t){return t>0?zi(Qi(t),9007199254740991):0},Ki=function(t){return Wi(t.length)},qi=ie,Yi=Gi,$i=Ki,Xi=function(t){return function(e,n,i){var r,s=qi(e),o=$i(s),a=Yi(i,o);if(t&&n!=n){for(;o>a;)if((r=s[a++])!=r)return!0}else for(;o>a;a++)if((t||a in s)&&s[a]===n)return t||a||0;return!t&&-1}},Ji={includes:Xi(!0),indexOf:Xi(!1)},Zi=Ji.includes;Pi({target:"Array",proto:!0,forced:ct((function(){return!Array(1).includes()}))},{includes:function(t){return Zi(this,t,arguments.length>1?arguments[1]:void 0)}});var tr=ae,er=function(t){return tr[t+"Prototype"]},nr=er("Array").includes,ir=oe,rr=Ct,sr=vn("match"),or=function(t){var e;return ir(t)&&(void 0!==(e=t[sr])?!!e:"RegExp"==rr(t))},ar=TypeError,cr={};cr[vn("toStringTag")]="z";var lr="[object z]"===String(cr),ur=lr,dr=kt,hr=Ct,Ar=vn("toStringTag"),pr=Object,fr="Arguments"==hr(function(){return arguments}()),mr=ur?hr:function(t){var e,n,i;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=pr(t),Ar))?n:fr?hr(e):"Object"==(i=hr(e))&&dr(e.callee)?"Arguments":i},gr=mr,vr=String,yr=function(t){if("Symbol"===gr(t))throw TypeError("Cannot convert a Symbol value to a string");return vr(t)},_r=vn("match"),br=Pi,Er=function(t){if(or(t))throw ar("The method doesn't accept regular expressions");return t},wr=te,Sr=yr,Tr=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[_r]=!1,"/./"[t](e)}catch(t){}}return!1},Cr=pt("".indexOf);br({target:"String",proto:!0,forced:!Tr("includes")},{includes:function(t){return!!~Cr(Sr(wr(this)),Sr(Er(t)),arguments.length>1?arguments[1]:void 0)}});var Rr=er("String").includes,Ir=ft,xr=nr,Or=Rr,Lr=Array.prototype,Mr=String.prototype,kr=q((function(t){var e=t.includes;return t===Lr||Ir(Lr,t)&&e===Lr.includes?xr:"string"==typeof t||t===Mr||Ir(Mr,t)&&e===Mr.includes?Or:e})),Nr={exports:{}},Pr=Pi,Dr=Pt,Br=ri.f;Pr({target:"Object",stat:!0,forced:Object.defineProperty!==Br,sham:!Dr},{defineProperty:Br});var Ur=ae.Object,Fr=Nr.exports=function(t,e,n){return Ur.defineProperty(t,e,n)};Ur.defineProperty.sham&&(Fr.sham=!0);var Hr=q(Nr.exports),Vr=Ct,jr=Array.isArray||function(t){return"Array"==Vr(t)},Gr=TypeError,Qr=In,zr=ri,Wr=zt,Kr=function(t,e,n){var i=Qr(e);i in t?zr.f(t,i,Wr(0,n)):t[i]=n},qr=kt,Yr=Ye,$r=pt(Function.toString);qr(Yr.inspectSource)||(Yr.inspectSource=function(t){return $r(t)});var Xr=Yr.inspectSource,Jr=pt,Zr=ct,ts=kt,es=mr,ns=Xr,is=function(){},rs=[],ss=he("Reflect","construct"),os=/^\s*(?:class|function)\b/,as=Jr(os.exec),cs=!os.exec(is),ls=function(t){if(!ts(t))return!1;try{return ss(is,rs,t),!0}catch(t){return!1}},us=function(t){if(!ts(t))return!1;switch(es(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return cs||!!as(os,ns(t))}catch(t){return!0}};us.sham=!0;var ds=!ss||Zr((function(){var t;return ls(ls.call)||!ls(Object)||!ls((function(){t=!0}))||t}))?us:ls,hs=jr,As=ds,ps=oe,fs=vn("species"),ms=Array,gs=function(t){var e;return hs(t)&&(e=t.constructor,(As(e)&&(e===ms||hs(e.prototype))||ps(e)&&null===(e=e[fs]))&&(e=void 0)),void 0===e?ms:e},vs=function(t,e){return new(gs(t))(0===e?0:e)},ys=ct,_s=_e,bs=vn("species"),Es=Pi,ws=ct,Ss=jr,Ts=oe,Cs=tn,Rs=Ki,Is=function(t){if(t>9007199254740991)throw Gr("Maximum allowed index exceeded");return t},xs=Kr,Os=vs,Ls=function(t){return _s>=51||!ys((function(){var e=[];return(e.constructor={})[bs]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Ms=_e,ks=vn("isConcatSpreadable"),Ns=Ms>=51||!ws((function(){var t=[];return t[ks]=!1,t.concat()[0]!==t})),Ps=function(t){if(!Ts(t))return!1;var e=t[ks];return void 0!==e?!!e:Ss(t)};Es({target:"Array",proto:!0,arity:1,forced:!Ns||!Ls("concat")},{concat:function(t){var e,n,i,r,s,o=Cs(this),a=Os(o,0),c=0;for(e=-1,i=arguments.length;e<i;e++)if(Ps(s=-1===e?o:arguments[e]))for(r=Rs(s),Is(c+r),n=0;n<r;n++,c++)n in s&&xs(a,c,s[n]);else Is(c+1),xs(a,c++,s);return a.length=c,a}});var Ds={},Bs={},Us=rn,Fs=ie,Hs=Ji.indexOf,Vs=Bs,js=pt([].push),Gs=function(t,e){var n,i=Fs(t),r=0,s=[];for(n in i)!Us(Vs,n)&&Us(i,n)&&js(s,n);for(;e.length>r;)Us(i,n=e[r++])&&(~Hs(s,n)||js(s,n));return s},Qs=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],zs=Gs,Ws=Qs,Ks=Object.keys||function(t){return zs(t,Ws)},qs=Pt,Ys=si,$s=ri,Xs=li,Js=ie,Zs=Ks;Ds.f=qs&&!Ys?Object.defineProperties:function(t,e){Xs(t);for(var n,i=Js(e),r=Zs(e),s=r.length,o=0;s>o;)$s.f(t,n=r[o++],i[n]);return t};var to,eo=he("document","documentElement"),no=ln,io=Xe("keys"),ro=function(t){return io[t]||(io[t]=no(t))},so=li,oo=Ds,ao=Qs,co=Bs,lo=eo,uo=Mn,ho="prototype",Ao="script",po=ro("IE_PROTO"),fo=function(){},mo=function(t){return"<"+Ao+">"+t+"</"+Ao+">"},go=function(t){t.write(mo("")),t.close();var e=t.parentWindow.Object;return t=null,e},vo=function(){try{to=new ActiveXObject("htmlfile")}catch(t){}var t,e,n;vo="undefined"!=typeof document?document.domain&&to?go(to):(e=uo("iframe"),n="java"+Ao+":",e.style.display="none",lo.appendChild(e),e.src=String(n),(t=e.contentWindow.document).open(),t.write(mo("document.F=Object")),t.close(),t.F):go(to);for(var i=ao.length;i--;)delete vo[ho][ao[i]];return vo()};co[po]=!0;var yo=Object.create||function(t,e){var n;return null!==t?(fo[ho]=so(t),n=new fo,fo[ho]=null,n[po]=t):n=vo(),void 0===e?n:oo.f(n,e)},_o={},bo=Gs,Eo=Qs.concat("length","prototype");_o.f=Object.getOwnPropertyNames||function(t){return bo(t,Eo)};var wo={},So=Gi,To=Ki,Co=Kr,Ro=Array,Io=Math.max,xo=function(t,e,n){for(var i=To(t),r=So(e,i),s=So(void 0===n?i:n,i),o=Ro(Io(s-r,0)),a=0;r<s;r++,a++)Co(o,a,t[r]);return o.length=a,o},Oo=Ct,Lo=ie,Mo=_o.f,ko=xo,No="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];wo.f=function(t){return No&&"Window"==Oo(t)?function(t){try{return Mo(t)}catch(t){return ko(No)}}(t):Mo(Lo(t))};var Po={};Po.f=Object.getOwnPropertySymbols;var Do=wi,Bo=function(t,e,n,i){return i&&i.enumerable?t[e]=n:Do(t,e,n),t},Uo=ri,Fo=function(t,e,n){return Uo.f(t,e,n)},Ho={},Vo=vn;Ho.f=Vo;var jo,Go,Qo,zo=ae,Wo=rn,Ko=Ho,qo=ri.f,Yo=function(t){var e=zo.Symbol||(zo.Symbol={});Wo(e,t)||qo(e,t,{value:Ko.f(t)})},$o=Ut,Xo=he,Jo=vn,Zo=Bo,ta=function(){var t=Xo("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,i=Jo("toPrimitive");e&&!e[i]&&Zo(e,i,(function(t){return $o(n,this)}),{arity:1})},ea=mr,na=lr?{}.toString:function(){return"[object "+ea(this)+"]"},ia=lr,ra=ri.f,sa=wi,oa=rn,aa=na,ca=vn("toStringTag"),la=function(t,e,n,i){if(t){var r=n?t:t.prototype;oa(r,ca)||ra(r,ca,{configurable:!0,value:e}),i&&!ia&&sa(r,"toString",aa)}},ua=kt,da=gt.WeakMap,ha=ua(da)&&/native code/.test(String(da)),Aa=gt,pa=oe,fa=wi,ma=rn,ga=Ye,va=ro,ya=Bs,_a="Object already initialized",ba=Aa.TypeError,Ea=Aa.WeakMap;if(ha||ga.state){var wa=ga.state||(ga.state=new Ea);wa.get=wa.get,wa.has=wa.has,wa.set=wa.set,jo=function(t,e){if(wa.has(t))throw ba(_a);return e.facade=t,wa.set(t,e),e},Go=function(t){return wa.get(t)||{}},Qo=function(t){return wa.has(t)}}else{var Sa=va("state");ya[Sa]=!0,jo=function(t,e){if(ma(t,Sa))throw ba(_a);return e.facade=t,fa(t,Sa,e),e},Go=function(t){return ma(t,Sa)?t[Sa]:{}},Qo=function(t){return ma(t,Sa)}}var Ta={set:jo,get:Go,has:Qo,enforce:function(t){return Qo(t)?Go(t):jo(t,{})},getterFor:function(t){return function(e){var n;if(!pa(e)||(n=Go(e)).type!==t)throw ba("Incompatible receiver, "+t+" required");return n}}},Ca=ii,Ra=$t,Ia=tn,xa=Ki,Oa=vs,La=pt([].push),Ma=function(t){var e=1==t,n=2==t,i=3==t,r=4==t,s=6==t,o=7==t,a=5==t||s;return function(c,l,u,d){for(var h,A,p=Ia(c),f=Ra(p),m=Ca(l,u),g=xa(f),v=0,y=d||Oa,_=e?y(c,g):n||o?y(c,0):void 0;g>v;v++)if((a||v in f)&&(A=m(h=f[v],v,p),t))if(e)_[v]=A;else if(A)switch(t){case 3:return!0;case 5:return h;case 6:return v;case 2:La(_,h)}else switch(t){case 4:return!1;case 7:La(_,h)}return s?-1:i||r?r:_}},ka={forEach:Ma(0),map:Ma(1),filter:Ma(2),some:Ma(3),every:Ma(4),find:Ma(5),findIndex:Ma(6),filterReject:Ma(7)},Na=Pi,Pa=gt,Da=Ut,Ba=pt,Ua=Pt,Fa=Se,Ha=ct,Va=rn,ja=ft,Ga=li,Qa=ie,za=In,Wa=yr,Ka=zt,qa=yo,Ya=Ks,$a=_o,Xa=wo,Ja=Po,Za=Nt,tc=ri,ec=Ds,nc=Ft,ic=Bo,rc=Fo,sc=Xe,oc=Bs,ac=ln,cc=vn,lc=Ho,uc=Yo,dc=ta,hc=la,Ac=Ta,pc=ka.forEach,fc=ro("hidden"),mc="Symbol",gc="prototype",vc=Ac.set,yc=Ac.getterFor(mc),_c=Object[gc],bc=Pa.Symbol,Ec=bc&&bc[gc],wc=Pa.TypeError,Sc=Pa.QObject,Tc=Za.f,Cc=tc.f,Rc=Xa.f,Ic=nc.f,xc=Ba([].push),Oc=sc("symbols"),Lc=sc("op-symbols"),Mc=sc("wks"),kc=!Sc||!Sc[gc]||!Sc[gc].findChild,Nc=Ua&&Ha((function(){return 7!=qa(Cc({},"a",{get:function(){return Cc(this,"a",{value:7}).a}})).a}))?function(t,e,n){var i=Tc(_c,e);i&&delete _c[e],Cc(t,e,n),i&&t!==_c&&Cc(_c,e,i)}:Cc,Pc=function(t,e){var n=Oc[t]=qa(Ec);return vc(n,{type:mc,tag:t,description:e}),Ua||(n.description=e),n},Dc=function(t,e,n){t===_c&&Dc(Lc,e,n),Ga(t);var i=za(e);return Ga(n),Va(Oc,i)?(n.enumerable?(Va(t,fc)&&t[fc][i]&&(t[fc][i]=!1),n=qa(n,{enumerable:Ka(0,!1)})):(Va(t,fc)||Cc(t,fc,Ka(1,{})),t[fc][i]=!0),Nc(t,i,n)):Cc(t,i,n)},Bc=function(t,e){Ga(t);var n=Qa(e),i=Ya(n).concat(Vc(n));return pc(i,(function(e){Ua&&!Da(Uc,n,e)||Dc(t,e,n[e])})),t},Uc=function(t){var e=za(t),n=Da(Ic,this,e);return!(this===_c&&Va(Oc,e)&&!Va(Lc,e))&&(!(n||!Va(this,e)||!Va(Oc,e)||Va(this,fc)&&this[fc][e])||n)},Fc=function(t,e){var n=Qa(t),i=za(e);if(n!==_c||!Va(Oc,i)||Va(Lc,i)){var r=Tc(n,i);return!r||!Va(Oc,i)||Va(n,fc)&&n[fc][i]||(r.enumerable=!0),r}},Hc=function(t){var e=Rc(Qa(t)),n=[];return pc(e,(function(t){Va(Oc,t)||Va(oc,t)||xc(n,t)})),n},Vc=function(t){var e=t===_c,n=Rc(e?Lc:Qa(t)),i=[];return pc(n,(function(t){!Va(Oc,t)||e&&!Va(_c,t)||xc(i,Oc[t])})),i};Fa||(bc=function(){if(ja(Ec,this))throw wc("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?Wa(arguments[0]):void 0,e=ac(t),n=function(t){this===_c&&Da(n,Lc,t),Va(this,fc)&&Va(this[fc],e)&&(this[fc][e]=!1),Nc(this,e,Ka(1,t))};return Ua&&kc&&Nc(_c,e,{configurable:!0,set:n}),Pc(e,t)},ic(Ec=bc[gc],"toString",(function(){return yc(this).tag})),ic(bc,"withoutSetter",(function(t){return Pc(ac(t),t)})),nc.f=Uc,tc.f=Dc,ec.f=Bc,Za.f=Fc,$a.f=Xa.f=Hc,Ja.f=Vc,lc.f=function(t){return Pc(cc(t),t)},Ua&&rc(Ec,"description",{configurable:!0,get:function(){return yc(this).description}})),Na({global:!0,constructor:!0,wrap:!0,forced:!Fa,sham:!Fa},{Symbol:bc}),pc(Ya(Mc),(function(t){uc(t)})),Na({target:mc,stat:!0,forced:!Fa},{useSetter:function(){kc=!0},useSimple:function(){kc=!1}}),Na({target:"Object",stat:!0,forced:!Fa,sham:!Ua},{create:function(t,e){return void 0===e?qa(t):Bc(qa(t),e)},defineProperty:Dc,defineProperties:Bc,getOwnPropertyDescriptor:Fc}),Na({target:"Object",stat:!0,forced:!Fa},{getOwnPropertyNames:Hc}),dc(),hc(bc,mc),oc[fc]=!0;var jc=Se&&!!Symbol.for&&!!Symbol.keyFor,Gc=Pi,Qc=he,zc=rn,Wc=yr,Kc=Xe,qc=jc,Yc=Kc("string-to-symbol-registry"),$c=Kc("symbol-to-string-registry");Gc({target:"Symbol",stat:!0,forced:!qc},{for:function(t){var e=Wc(t);if(zc(Yc,e))return Yc[e];var n=Qc("Symbol")(e);return Yc[e]=n,$c[n]=e,n}});var Xc=Pi,Jc=rn,Zc=Oe,tl=Me,el=jc,nl=Xe("symbol-to-string-registry");Xc({target:"Symbol",stat:!0,forced:!el},{keyFor:function(t){if(!Zc(t))throw TypeError(tl(t)+" is not a symbol");if(Jc(nl,t))return nl[t]}});var il=pt([].slice),rl=jr,sl=kt,ol=Ct,al=yr,cl=pt([].push),ll=Pi,ul=he,dl=Et,hl=Ut,Al=pt,pl=ct,fl=kt,ml=Oe,gl=il,vl=function(t){if(sl(t))return t;if(rl(t)){for(var e=t.length,n=[],i=0;i<e;i++){var r=t[i];"string"==typeof r?cl(n,r):"number"!=typeof r&&"Number"!=ol(r)&&"String"!=ol(r)||cl(n,al(r))}var s=n.length,o=!0;return function(t,e){if(o)return o=!1,e;if(rl(this))return e;for(var i=0;i<s;i++)if(n[i]===t)return e}}},yl=Se,_l=String,bl=ul("JSON","stringify"),El=Al(/./.exec),wl=Al("".charAt),Sl=Al("".charCodeAt),Tl=Al("".replace),Cl=Al(1..toString),Rl=/[\uD800-\uDFFF]/g,Il=/^[\uD800-\uDBFF]$/,xl=/^[\uDC00-\uDFFF]$/,Ol=!yl||pl((function(){var t=ul("Symbol")();return"[null]"!=bl([t])||"{}"!=bl({a:t})||"{}"!=bl(Object(t))})),Ll=pl((function(){return'"\\udf06\\ud834"'!==bl("\udf06\ud834")||'"\\udead"'!==bl("\udead")})),Ml=function(t,e){var n=gl(arguments),i=vl(e);if(fl(i)||void 0!==t&&!ml(t))return n[1]=function(t,e){if(fl(i)&&(e=hl(i,this,_l(t),e)),!ml(e))return e},dl(bl,null,n)},kl=function(t,e,n){var i=wl(n,e-1),r=wl(n,e+1);return El(Il,t)&&!El(xl,r)||El(xl,t)&&!El(Il,i)?"\\u"+Cl(Sl(t,0),16):t};bl&&ll({target:"JSON",stat:!0,arity:3,forced:Ol||Ll},{stringify:function(t,e,n){var i=gl(arguments),r=dl(Ol?Ml:bl,null,i);return Ll&&"string"==typeof r?Tl(r,Rl,kl):r}});var Nl=Po,Pl=tn;Pi({target:"Object",stat:!0,forced:!Se||ct((function(){Nl.f(1)}))},{getOwnPropertySymbols:function(t){var e=Nl.f;return e?e(Pl(t)):[]}}),Yo("asyncIterator"),Yo("hasInstance"),Yo("isConcatSpreadable"),Yo("iterator"),Yo("match"),Yo("matchAll"),Yo("replace"),Yo("search"),Yo("species"),Yo("split");var Dl=ta;Yo("toPrimitive"),Dl();var Bl=he,Ul=la;Yo("toStringTag"),Ul(Bl("Symbol"),"Symbol"),Yo("unscopables"),la(gt.JSON,"JSON",!0);var Fl,Hl,Vl,jl=ae.Symbol,Gl={},Ql=Pt,zl=rn,Wl=Function.prototype,Kl=Ql&&Object.getOwnPropertyDescriptor,ql=zl(Wl,"name"),Yl={EXISTS:ql,PROPER:ql&&"something"===function(){}.name,CONFIGURABLE:ql&&(!Ql||Ql&&Kl(Wl,"name").configurable)},$l=!ct((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Xl=rn,Jl=kt,Zl=tn,tu=$l,eu=ro("IE_PROTO"),nu=Object,iu=nu.prototype,ru=tu?nu.getPrototypeOf:function(t){var e=Zl(t);if(Xl(e,eu))return e[eu];var n=e.constructor;return Jl(n)&&e instanceof n?n.prototype:e instanceof nu?iu:null},su=ct,ou=kt,au=oe,cu=yo,lu=ru,uu=Bo,du=vn("iterator"),hu=!1;[].keys&&("next"in(Vl=[].keys())?(Hl=lu(lu(Vl)))!==Object.prototype&&(Fl=Hl):hu=!0);var Au=!au(Fl)||su((function(){var t={};return Fl[du].call(t)!==t}));ou((Fl=Au?{}:cu(Fl))[du])||uu(Fl,du,(function(){return this}));var pu={IteratorPrototype:Fl,BUGGY_SAFARI_ITERATORS:hu},fu=pu.IteratorPrototype,mu=yo,gu=zt,vu=la,yu=Gl,_u=function(){return this},bu=pt,Eu=De,wu=kt,Su=String,Tu=TypeError,Cu=function(t,e,n){try{return bu(Eu(Object.getOwnPropertyDescriptor(t,e)[n]))}catch(t){}},Ru=li,Iu=function(t){if("object"==typeof t||wu(t))return t;throw Tu("Can't set "+Su(t)+" as a prototype")},xu=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Cu(Object.prototype,"__proto__","set"))(n,[]),e=n instanceof Array}catch(t){}return function(n,i){return Ru(n),Iu(i),e?t(n,i):n.__proto__=i,n}}():void 0),Ou=Pi,Lu=Ut,Mu=function(t,e,n,i){var r=e+" Iterator";return t.prototype=mu(fu,{next:gu(+!i,n)}),vu(t,r,!1,!0),yu[r]=_u,t},ku=ru,Nu=la,Pu=Bo,Du=Gl,Bu=pu,Uu=Yl.PROPER,Fu=Bu.BUGGY_SAFARI_ITERATORS,Hu=vn("iterator"),Vu="keys",ju="values",Gu="entries",Qu=function(){return this},zu=function(t,e,n,i,r,s,o){Mu(n,e,i);var a,c,l,u=function(t){if(t===r&&f)return f;if(!Fu&&t in A)return A[t];switch(t){case Vu:case ju:case Gu:return function(){return new n(this,t)}}return function(){return new n(this)}},d=e+" Iterator",h=!1,A=t.prototype,p=A[Hu]||A["@@iterator"]||r&&A[r],f=!Fu&&p||u(r),m="Array"==e&&A.entries||p;if(m&&(a=ku(m.call(new t)))!==Object.prototype&&a.next&&(Nu(a,d,!0,!0),Du[d]=Qu),Uu&&r==ju&&p&&p.name!==ju&&(h=!0,f=function(){return Lu(p,this)}),r)if(c={values:u(ju),keys:s?f:u(Vu),entries:u(Gu)},o)for(l in c)(Fu||h||!(l in A))&&Pu(A,l,c[l]);else Ou({target:e,proto:!0,forced:Fu||h},c);return o&&A[Hu]!==f&&Pu(A,Hu,f,{name:r}),Du[e]=f,c},Wu=function(t,e){return{value:t,done:e}},Ku=ie,qu=Gl,Yu=Ta;ri.f;var $u=zu,Xu=Wu,Ju="Array Iterator",Zu=Yu.set,td=Yu.getterFor(Ju);$u(Array,"Array",(function(t,e){Zu(this,{type:Ju,target:Ku(t),index:0,kind:e})}),(function(){var t=td(this),e=t.target,n=t.kind,i=t.index++;return!e||i>=e.length?(t.target=void 0,Xu(void 0,!0)):Xu("keys"==n?i:"values"==n?e[i]:[i,e[i]],!1)}),"values"),qu.Arguments=qu.Array;var ed={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},nd=gt,id=mr,rd=wi,sd=Gl,od=vn("toStringTag");for(var ad in ed){var cd=nd[ad],ld=cd&&cd.prototype;ld&&id(ld)!==od&&rd(ld,od,ad),sd[ad]=sd.Array}var ud=jl,dd=vn,hd=ri.f,Ad=dd("metadata"),pd=Function.prototype;void 0===pd[Ad]&&hd(pd,Ad,{value:null}),Yo("dispose"),Yo("metadata");var fd=ud;Yo("asyncDispose");var md=pt,gd=he("Symbol"),vd=gd.keyFor,yd=md(gd.prototype.valueOf),_d=gd.isRegisteredSymbol||function(t){try{return void 0!==vd(yd(t))}catch(t){return!1}};Pi({target:"Symbol",stat:!0},{isRegisteredSymbol:_d});for(var bd=Xe,Ed=he,wd=pt,Sd=Oe,Td=vn,Cd=Ed("Symbol"),Rd=Cd.isWellKnownSymbol,Id=Ed("Object","getOwnPropertyNames"),xd=wd(Cd.prototype.valueOf),Od=bd("wks"),Ld=0,Md=Id(Cd),kd=Md.length;Ld<kd;Ld++)try{var Nd=Md[Ld];Sd(Cd[Nd])&&Td(Nd)}catch(t){}var Pd=function(t){if(Rd&&Rd(t))return!0;try{for(var e=xd(t),n=0,i=Id(Od),r=i.length;n<r;n++)if(Od[i[n]]==e)return!0}catch(t){}return!1};Pi({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:Pd}),Yo("matcher"),Yo("observable"),Pi({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:_d}),Pi({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:Pd}),Yo("metadataKey"),Yo("patternMatch"),Yo("replaceAll");var Dd=q(fd),Bd=pt,Ud=Fi,Fd=yr,Hd=te,Vd=Bd("".charAt),jd=Bd("".charCodeAt),Gd=Bd("".slice),Qd=function(t){return function(e,n){var i,r,s=Fd(Hd(e)),o=Ud(n),a=s.length;return o<0||o>=a?t?"":void 0:(i=jd(s,o))<55296||i>56319||o+1===a||(r=jd(s,o+1))<56320||r>57343?t?Vd(s,o):i:t?Gd(s,o,o+2):r-56320+(i-55296<<10)+65536}},zd=(Qd(!1),Qd(!0)),Wd=yr,Kd=Ta,qd=zu,Yd=Wu,$d="String Iterator",Xd=Kd.set,Jd=Kd.getterFor($d);qd(String,"String",(function(t){Xd(this,{type:$d,string:Wd(t),index:0})}),(function(){var t,e=Jd(this),n=e.string,i=e.index;return i>=n.length?Yd(void 0,!0):(t=zd(n,i),e.index+=t.length,Yd(t,!1))}));var Zd=q(Ho.f("iterator"));function th(t){return th="function"==typeof Dd&&"symbol"==typeof Zd?function(t){return typeof t}:function(t){return t&&"function"==typeof Dd&&t.constructor===Dd&&t!==Dd.prototype?"symbol":typeof t},th(t)}var eh=q(Ho.f("toPrimitive"));function nh(t){var e=function(t,e){if("object"!==th(t)||null===t)return t;var n=t[eh];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==th(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"===th(e)?e:String(e)}function ih(t,e,n){return(e=nh(e))in t?Hr(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var rh=er("Array").keys,sh=mr,oh=rn,ah=ft,ch=rh,lh=Array.prototype,uh={DOMTokenList:!0,NodeList:!0},dh=q((function(t){var e=t.keys;return t===lh||ah(lh,t)&&e===lh.keys||oh(uh,sh(t))?ch:e})),hh=Me,Ah=TypeError,ph=xo,fh=Math.floor,mh=function(t,e){var n=t.length,i=fh(n/2);return n<8?gh(t,e):vh(t,mh(ph(t,0,i),e),mh(ph(t,i),e),e)},gh=function(t,e){for(var n,i,r=t.length,s=1;s<r;){for(i=s,n=t[s];i&&e(t[i-1],n)>0;)t[i]=t[--i];i!==s++&&(t[i]=n)}return t},vh=function(t,e,n,i){for(var r=e.length,s=n.length,o=0,a=0;o<r||a<s;)t[o+a]=o<r&&a<s?i(e[o],n[a])<=0?e[o++]:n[a++]:o<r?e[o++]:n[a++];return t},yh=mh,_h=ct,bh=function(t,e){var n=[][t];return!!n&&_h((function(){n.call(null,e||function(){return 1},1)}))},Eh=Ae.match(/firefox\/(\d+)/i),wh=!!Eh&&+Eh[1],Sh=/MSIE|Trident/.test(Ae),Th=Ae.match(/AppleWebKit\/(\d+)\./),Ch=!!Th&&+Th[1],Rh=Pi,Ih=pt,xh=De,Oh=tn,Lh=Ki,Mh=function(t,e){if(!delete t[e])throw Ah("Cannot delete property "+hh(e)+" of "+hh(t))},kh=yr,Nh=ct,Ph=yh,Dh=bh,Bh=wh,Uh=Sh,Fh=_e,Hh=Ch,Vh=[],jh=Ih(Vh.sort),Gh=Ih(Vh.push),Qh=Nh((function(){Vh.sort(void 0)})),zh=Nh((function(){Vh.sort(null)})),Wh=Dh("sort"),Kh=!Nh((function(){if(Fh)return Fh<70;if(!(Bh&&Bh>3)){if(Uh)return!0;if(Hh)return Hh<603;var t,e,n,i,r="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(i=0;i<47;i++)Vh.push({k:e+i,v:n})}for(Vh.sort((function(t,e){return e.v-t.v})),i=0;i<Vh.length;i++)e=Vh[i].k.charAt(0),r.charAt(r.length-1)!==e&&(r+=e);return"DGBEFHACIJK"!==r}}));Rh({target:"Array",proto:!0,forced:Qh||!zh||!Wh||!Kh},{sort:function(t){void 0!==t&&xh(t);var e=Oh(this);if(Kh)return void 0===t?jh(e):jh(e,t);var n,i,r=[],s=Lh(e);for(i=0;i<s;i++)i in e&&Gh(r,e[i]);for(Ph(r,function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:kh(e)>kh(n)?1:-1}}(t)),n=Lh(r),i=0;i<n;)e[i]=r[i++];for(;i<s;)Mh(e,i++);return e}});var qh=er("Array").sort,Yh=ft,$h=qh,Xh=Array.prototype,Jh=q((function(t){var e=t.sort;return t===Xh||Yh(Xh,t)&&e===Xh.sort?$h:e})),Zh=he,tA=_o,eA=Po,nA=li,iA=pt([].concat),rA=Zh("Reflect","ownKeys")||function(t){var e=tA.f(nA(t)),n=eA.f;return n?iA(e,n(t)):e},sA=rn,oA=rA,aA=Nt,cA=ri,lA=oe,uA=wi,dA=Error,hA=pt("".replace),AA=String(dA("zxcasd").stack),pA=/\n\s*at [^:]*:[^\n]*/,fA=pA.test(AA),mA=zt,gA=!ct((function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",mA(1,7)),7!==t.stack)})),vA=wi,yA=function(t,e){if(fA&&"string"==typeof t&&!dA.prepareStackTrace)for(;e--;)t=hA(t,pA,"");return t},_A=gA,bA=Error.captureStackTrace,EA=Gl,wA=vn("iterator"),SA=Array.prototype,TA=mr,CA=Fe,RA=Xt,IA=Gl,xA=vn("iterator"),OA=function(t){if(!RA(t))return CA(t,xA)||CA(t,"@@iterator")||IA[TA(t)]},LA=Ut,MA=De,kA=li,NA=Me,PA=OA,DA=TypeError,BA=Ut,UA=li,FA=Fe,HA=ii,VA=Ut,jA=li,GA=Me,QA=function(t){return void 0!==t&&(EA.Array===t||SA[wA]===t)},zA=Ki,WA=ft,KA=function(t,e){var n=arguments.length<2?PA(t):e;if(MA(n))return kA(LA(n,t));throw DA(NA(t)+" is not iterable")},qA=OA,YA=function(t,e,n){var i,r;UA(t);try{if(!(i=FA(t,"return"))){if("throw"===e)throw n;return n}i=BA(i,t)}catch(t){r=!0,i=t}if("throw"===e)throw n;if(r)throw i;return UA(i),n},$A=TypeError,XA=function(t,e){this.stopped=t,this.result=e},JA=XA.prototype,ZA=function(t,e,n){var i,r,s,o,a,c,l,u=n&&n.that,d=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_RECORD),A=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),f=HA(e,u),m=function(t){return i&&YA(i,"normal",t),new XA(!0,t)},g=function(t){return d?(jA(t),p?f(t[0],t[1],m):f(t[0],t[1])):p?f(t,m):f(t)};if(h)i=t.iterator;else if(A)i=t;else{if(!(r=qA(t)))throw $A(GA(t)+" is not iterable");if(QA(r)){for(s=0,o=zA(t);o>s;s++)if((a=g(t[s]))&&WA(JA,a))return a;return new XA(!1)}i=KA(t,r)}for(c=h?t.next:i.next;!(l=VA(c,i)).done;){try{a=g(l.value)}catch(t){YA(i,"throw",t)}if("object"==typeof a&&a&&WA(JA,a))return a}return new XA(!1)},tp=yr,ep=Pi,np=ft,ip=ru,rp=xu,sp=function(t,e,n){for(var i=oA(e),r=cA.f,s=aA.f,o=0;o<i.length;o++){var a=i[o];sA(t,a)||n&&sA(n,a)||r(t,a,s(e,a))}},op=yo,ap=wi,cp=zt,lp=function(t,e){lA(e)&&"cause"in e&&uA(t,"cause",e.cause)},up=function(t,e,n,i){_A&&(bA?bA(t,e):vA(t,"stack",yA(n,i)))},dp=ZA,hp=function(t,e){return void 0===t?arguments.length<2?"":e:tp(t)},Ap=vn("toStringTag"),pp=Error,fp=[].push,mp=function(t,e){var n,i=np(gp,this);rp?n=rp(pp(),i?ip(this):gp):(n=i?this:op(gp),ap(n,Ap,"Error")),void 0!==e&&ap(n,"message",hp(e)),up(n,mp,n.stack,1),arguments.length>2&&lp(n,arguments[2]);var r=[];return dp(t,fp,{that:r}),ap(n,"errors",r),n};rp?rp(mp,pp):sp(mp,pp,{name:!0});var gp=mp.prototype=op(pp.prototype,{constructor:cp(1,mp),message:cp(1,""),name:cp(1,"AggregateError")});ep({global:!0,constructor:!0,arity:2},{AggregateError:mp});var vp,yp,_p,bp,Ep="undefined"!=typeof process&&"process"==Ct(process),wp=he,Sp=Fo,Tp=Pt,Cp=vn("species"),Rp=ft,Ip=TypeError,xp=ds,Op=Me,Lp=TypeError,Mp=li,kp=function(t){if(xp(t))return t;throw Lp(Op(t)+" is not a constructor")},Np=Xt,Pp=vn("species"),Dp=function(t,e){var n,i=Mp(t).constructor;return void 0===i||Np(n=Mp(i)[Pp])?e:kp(n)},Bp=TypeError,Up=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ae),Fp=gt,Hp=Et,Vp=ii,jp=kt,Gp=rn,Qp=ct,zp=eo,Wp=il,Kp=Mn,qp=function(t,e){if(t<e)throw Bp("Not enough arguments");return t},Yp=Up,$p=Ep,Xp=Fp.setImmediate,Jp=Fp.clearImmediate,Zp=Fp.process,tf=Fp.Dispatch,ef=Fp.Function,nf=Fp.MessageChannel,rf=Fp.String,sf=0,of={},af="onreadystatechange";Qp((function(){vp=Fp.location}));var cf=function(t){if(Gp(of,t)){var e=of[t];delete of[t],e()}},lf=function(t){return function(){cf(t)}},uf=function(t){cf(t.data)},df=function(t){Fp.postMessage(rf(t),vp.protocol+"//"+vp.host)};Xp&&Jp||(Xp=function(t){qp(arguments.length,1);var e=jp(t)?t:ef(t),n=Wp(arguments,1);return of[++sf]=function(){Hp(e,void 0,n)},yp(sf),sf},Jp=function(t){delete of[t]},$p?yp=function(t){Zp.nextTick(lf(t))}:tf&&tf.now?yp=function(t){tf.now(lf(t))}:nf&&!Yp?(bp=(_p=new nf).port2,_p.port1.onmessage=uf,yp=Vp(bp.postMessage,bp)):Fp.addEventListener&&jp(Fp.postMessage)&&!Fp.importScripts&&vp&&"file:"!==vp.protocol&&!Qp(df)?(yp=df,Fp.addEventListener("message",uf,!1)):yp=af in Kp("script")?function(t){zp.appendChild(Kp("script"))[af]=function(){zp.removeChild(this),cf(t)}}:function(t){setTimeout(lf(t),0)});var hf={set:Xp,clear:Jp},Af=function(){this.head=null,this.tail=null};Af.prototype={add:function(t){var e={item:t,next:null},n=this.tail;n?n.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var pf,ff,mf,gf,vf,yf=Af,_f=/ipad|iphone|ipod/i.test(Ae)&&"undefined"!=typeof Pebble,bf=/web0s(?!.*chrome)/i.test(Ae),Ef=gt,wf=ii,Sf=Nt.f,Tf=hf.set,Cf=yf,Rf=Up,If=_f,xf=bf,Of=Ep,Lf=Ef.MutationObserver||Ef.WebKitMutationObserver,Mf=Ef.document,kf=Ef.process,Nf=Ef.Promise,Pf=Sf(Ef,"queueMicrotask"),Df=Pf&&Pf.value;if(!Df){var Bf=new Cf,Uf=function(){var t,e;for(Of&&(t=kf.domain)&&t.exit();e=Bf.get();)try{e()}catch(t){throw Bf.head&&pf(),t}t&&t.enter()};Rf||Of||xf||!Lf||!Mf?!If&&Nf&&Nf.resolve?((gf=Nf.resolve(void 0)).constructor=Nf,vf=wf(gf.then,gf),pf=function(){vf(Uf)}):Of?pf=function(){kf.nextTick(Uf)}:(Tf=wf(Tf,Ef),pf=function(){Tf(Uf)}):(ff=!0,mf=Mf.createTextNode(""),new Lf(Uf).observe(mf,{characterData:!0}),pf=function(){mf.data=ff=!ff}),Df=function(t){Bf.head||pf(),Bf.add(t)}}var Ff=Df,Hf=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Vf=gt.Promise,jf="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Gf=!jf&&!Ep&&"object"==typeof window&&"object"==typeof document,Qf=gt,zf=Vf,Wf=kt,Kf=Zn,qf=Xr,Yf=vn,$f=Gf,Xf=jf,Jf=_e,Zf=zf&&zf.prototype,tm=Yf("species"),em=!1,nm=Wf(Qf.PromiseRejectionEvent),im=Kf("Promise",(function(){var t=qf(zf),e=t!==String(zf);if(!e&&66===Jf)return!0;if(!Zf.catch||!Zf.finally)return!0;if(!Jf||Jf<51||!/native code/.test(t)){var n=new zf((function(t){t(1)})),i=function(t){t((function(){}),(function(){}))};if((n.constructor={})[tm]=i,!(em=n.then((function(){}))instanceof i))return!0}return!e&&($f||Xf)&&!nm})),rm={CONSTRUCTOR:im,REJECTION_EVENT:nm,SUBCLASSING:em},sm={},om=De,am=TypeError,cm=function(t){var e,n;this.promise=new t((function(t,i){if(void 0!==e||void 0!==n)throw am("Bad Promise constructor");e=t,n=i})),this.resolve=om(e),this.reject=om(n)};sm.f=function(t){return new cm(t)};var lm,um,dm=Pi,hm=Ep,Am=gt,pm=Ut,fm=Bo,mm=la,gm=function(t){var e=wp(t);Tp&&e&&!e[Cp]&&Sp(e,Cp,{configurable:!0,get:function(){return this}})},vm=De,ym=kt,_m=oe,bm=function(t,e){if(Rp(e,t))return t;throw Ip("Incorrect invocation")},Em=Dp,wm=hf.set,Sm=Ff,Tm=function(t,e){try{1==arguments.length?console.error(t):console.error(t,e)}catch(t){}},Cm=Hf,Rm=yf,Im=Ta,xm=Vf,Om=rm,Lm=sm,Mm="Promise",km=Om.CONSTRUCTOR,Nm=Om.REJECTION_EVENT,Pm=Im.getterFor(Mm),Dm=Im.set,Bm=xm&&xm.prototype,Um=xm,Fm=Bm,Hm=Am.TypeError,Vm=Am.document,jm=Am.process,Gm=Lm.f,Qm=Gm,zm=!!(Vm&&Vm.createEvent&&Am.dispatchEvent),Wm="unhandledrejection",Km=function(t){var e;return!(!_m(t)||!ym(e=t.then))&&e},qm=function(t,e){var n,i,r,s=e.value,o=1==e.state,a=o?t.ok:t.fail,c=t.resolve,l=t.reject,u=t.domain;try{a?(o||(2===e.rejection&&Zm(e),e.rejection=1),!0===a?n=s:(u&&u.enter(),n=a(s),u&&(u.exit(),r=!0)),n===t.promise?l(Hm("Promise-chain cycle")):(i=Km(n))?pm(i,n,c,l):c(n)):l(s)}catch(t){u&&!r&&u.exit(),l(t)}},Ym=function(t,e){t.notified||(t.notified=!0,Sm((function(){for(var n,i=t.reactions;n=i.get();)qm(n,t);t.notified=!1,e&&!t.rejection&&Xm(t)})))},$m=function(t,e,n){var i,r;zm?((i=Vm.createEvent("Event")).promise=e,i.reason=n,i.initEvent(t,!1,!0),Am.dispatchEvent(i)):i={promise:e,reason:n},!Nm&&(r=Am["on"+t])?r(i):t===Wm&&Tm("Unhandled promise rejection",n)},Xm=function(t){pm(wm,Am,(function(){var e,n=t.facade,i=t.value;if(Jm(t)&&(e=Cm((function(){hm?jm.emit("unhandledRejection",i,n):$m(Wm,n,i)})),t.rejection=hm||Jm(t)?2:1,e.error))throw e.value}))},Jm=function(t){return 1!==t.rejection&&!t.parent},Zm=function(t){pm(wm,Am,(function(){var e=t.facade;hm?jm.emit("rejectionHandled",e):$m("rejectionhandled",e,t.value)}))},tg=function(t,e,n){return function(i){t(e,i,n)}},eg=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Ym(t,!0))},ng=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw Hm("Promise can't be resolved itself");var i=Km(e);i?Sm((function(){var n={done:!1};try{pm(i,e,tg(ng,n,t),tg(eg,n,t))}catch(e){eg(n,e,t)}})):(t.value=e,t.state=1,Ym(t,!1))}catch(e){eg({done:!1},e,t)}}};km&&(Fm=(Um=function(t){bm(this,Fm),vm(t),pm(lm,this);var e=Pm(this);try{t(tg(ng,e),tg(eg,e))}catch(t){eg(e,t)}}).prototype,(lm=function(t){Dm(this,{type:Mm,done:!1,notified:!1,parent:!1,reactions:new Rm,rejection:!1,state:0,value:void 0})}).prototype=fm(Fm,"then",(function(t,e){var n=Pm(this),i=Gm(Em(this,Um));return n.parent=!0,i.ok=!ym(t)||t,i.fail=ym(e)&&e,i.domain=hm?jm.domain:void 0,0==n.state?n.reactions.add(i):Sm((function(){qm(i,n)})),i.promise})),um=function(){var t=new lm,e=Pm(t);this.promise=t,this.resolve=tg(ng,e),this.reject=tg(eg,e)},Lm.f=Gm=function(t){return t===Um||void 0===t?new um(t):Qm(t)}),dm({global:!0,constructor:!0,wrap:!0,forced:km},{Promise:Um}),mm(Um,Mm,!1,!0),gm(Mm);var ig=vn("iterator"),rg=!1;try{var sg=0,og={next:function(){return{done:!!sg++}},return:function(){rg=!0}};og[ig]=function(){return this},Array.from(og,(function(){throw 2}))}catch(t){}var ag=Vf,cg=function(t,e){if(!e&&!rg)return!1;var n=!1;try{var i={};i[ig]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch(t){}return n},lg=rm.CONSTRUCTOR||!cg((function(t){ag.all(t).then(void 0,(function(){}))})),ug=Ut,dg=De,hg=sm,Ag=Hf,pg=ZA;Pi({target:"Promise",stat:!0,forced:lg},{all:function(t){var e=this,n=hg.f(e),i=n.resolve,r=n.reject,s=Ag((function(){var n=dg(e.resolve),s=[],o=0,a=1;pg(t,(function(t){var c=o++,l=!1;a++,ug(n,e,t).then((function(t){l||(l=!0,s[c]=t,--a||i(s))}),r)})),--a||i(s)}));return s.error&&r(s.value),n.promise}});var fg=Pi,mg=rm.CONSTRUCTOR;Vf&&Vf.prototype,fg({target:"Promise",proto:!0,forced:mg,real:!0},{catch:function(t){return this.then(void 0,t)}});var gg=Ut,vg=De,yg=sm,_g=Hf,bg=ZA;Pi({target:"Promise",stat:!0,forced:lg},{race:function(t){var e=this,n=yg.f(e),i=n.reject,r=_g((function(){var r=vg(e.resolve);bg(t,(function(t){gg(r,e,t).then(n.resolve,i)}))}));return r.error&&i(r.value),n.promise}});var Eg=Ut,wg=sm;Pi({target:"Promise",stat:!0,forced:rm.CONSTRUCTOR},{reject:function(t){var e=wg.f(this);return Eg(e.reject,void 0,t),e.promise}});var Sg=li,Tg=oe,Cg=sm,Rg=function(t,e){if(Sg(t),Tg(e)&&e.constructor===t)return e;var n=Cg.f(t);return(0,n.resolve)(e),n.promise},Ig=Pi,xg=Vf,Og=rm.CONSTRUCTOR,Lg=Rg,Mg=he("Promise"),kg=!Og;Ig({target:"Promise",stat:!0,forced:!0},{resolve:function(t){return Lg(kg&&this===Mg?xg:this,t)}});var Ng=Ut,Pg=De,Dg=sm,Bg=Hf,Ug=ZA;Pi({target:"Promise",stat:!0,forced:lg},{allSettled:function(t){var e=this,n=Dg.f(e),i=n.resolve,r=n.reject,s=Bg((function(){var n=Pg(e.resolve),r=[],s=0,o=1;Ug(t,(function(t){var a=s++,c=!1;o++,Ng(n,e,t).then((function(t){c||(c=!0,r[a]={status:"fulfilled",value:t},--o||i(r))}),(function(t){c||(c=!0,r[a]={status:"rejected",reason:t},--o||i(r))}))})),--o||i(r)}));return s.error&&r(s.value),n.promise}});var Fg=Ut,Hg=De,Vg=he,jg=sm,Gg=Hf,Qg=ZA,zg="No one promise resolved";Pi({target:"Promise",stat:!0,forced:lg},{any:function(t){var e=this,n=Vg("AggregateError"),i=jg.f(e),r=i.resolve,s=i.reject,o=Gg((function(){var i=Hg(e.resolve),o=[],a=0,c=1,l=!1;Qg(t,(function(t){var u=a++,d=!1;c++,Fg(i,e,t).then((function(t){d||l||(l=!0,r(t))}),(function(t){d||l||(d=!0,o[u]=t,--c||s(new n(o,zg)))}))})),--c||s(new n(o,zg))}));return o.error&&s(o.value),i.promise}});var Wg=Pi,Kg=Vf,qg=ct,Yg=he,$g=kt,Xg=Dp,Jg=Rg,Zg=Kg&&Kg.prototype;Wg({target:"Promise",proto:!0,real:!0,forced:!!Kg&&qg((function(){Zg.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=Xg(this,Yg("Promise")),n=$g(t);return this.then(n?function(n){return Jg(e,t()).then((function(){return n}))}:t,n?function(n){return Jg(e,t()).then((function(){throw n}))}:t)}});var tv=ae.Promise,ev=q(tv);const nv=()=>{};function iv(){const t={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:nv};return t.promise=new ev(((e,n)=>{t.resolve=n=>{t.isFinished||(t.isResolved=!0,t.isFinished=!0,e(n),t.value=n)},t.reject=e=>{t.isFinished||(t.isRejected=!0,t.isFinished=!0,n(e))}})),t}const rv=new Map,sv=new Map,ov=new Map;var av,cv;!function(t){t.WIN_10="Windows 10",t.WIN_81="Windows 8.1",t.WIN_8="Windows 8",t.WIN_7="Windows 7",t.WIN_VISTA="Windows Vista",t.WIN_SERVER_2003="Windows Server 2003",t.WIN_XP="Windows XP",t.WIN_2000="Windows 2000",t.ANDROID="Android",t.HARMONY_OS="HarmonyOS",t.OPEN_BSD="Open BSD",t.SUN_OS="Sun OS",t.LINUX="Linux",t.IOS="iOS",t.MAC_OS="Mac OS",t.QNX="QNX",t.UNIX="UNIX",t.BEOS="BeOS",t.OS_2="OS/2",t.SEARCH_BOT="Search Bot"}(av||(av={})),function(t){t.CHROME="Chrome",t.SAFARI="Safari",t.EDGE="Edge",t.FIREFOX="Firefox",t.OPERA="OPR",t.QQ="QQBrowser",t.WECHAT="MicroMessenger"}(cv||(cv={}));var lv={exports:{}};!function(t,e){!function(n,i){var r="function",s="undefined",o="object",a="string",c="major",l="model",u="name",d="type",h="vendor",A="version",p="architecture",f="console",m="mobile",g="tablet",v="smarttv",y="wearable",_="embedded",b="Amazon",E="Apple",w="ASUS",S="BlackBerry",T="Browser",C="Chrome",R="Firefox",I="Google",x="Huawei",O="LG",L="Microsoft",M="Motorola",k="Opera",N="Samsung",P="Sharp",D="Sony",B="Xiaomi",U="Zebra",F="Facebook",H="Chromium OS",V="Mac OS",j=function(t){for(var e={},n=0;n<t.length;n++)e[t[n].toUpperCase()]=t[n];return e},G=function(t,e){return typeof t===a&&-1!==Q(e).indexOf(Q(t))},Q=function(t){return t.toLowerCase()},z=function(t,e){if(typeof t===a)return t=t.replace(/^\s\s*/,""),typeof e===s?t:t.substring(0,350)},W=function(t,e){for(var n,s,a,c,l,u,d=0;d<e.length&&!l;){var h=e[d],A=e[d+1];for(n=s=0;n<h.length&&!l&&h[n];)if(l=h[n++].exec(t))for(a=0;a<A.length;a++)u=l[++s],typeof(c=A[a])===o&&c.length>0?2===c.length?typeof c[1]==r?this[c[0]]=c[1].call(this,u):this[c[0]]=c[1]:3===c.length?typeof c[1]!==r||c[1].exec&&c[1].test?this[c[0]]=u?u.replace(c[1],c[2]):i:this[c[0]]=u?c[1].call(this,u,c[2]):i:4===c.length&&(this[c[0]]=u?c[3].call(this,u.replace(c[1],c[2])):i):this[c]=u||i;d+=2}},K=function(t,e){for(var n in e)if(typeof e[n]===o&&e[n].length>0){for(var r=0;r<e[n].length;r++)if(G(e[n][r],t))return"?"===n?i:n}else if(G(e[n],t))return"?"===n?i:n;return t},q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Y={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[A,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[A,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,A],[/opios[\/ ]+([\w\.]+)/i],[A,[u,k+" Mini"]],[/\bopr\/([\w\.]+)/i],[A,[u,k]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[u,A],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[A,[u,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[A,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[A,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[A,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[A,[u,"IE"]],[/yabrowser\/([\w\.]+)/i],[A,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure "+T],A],[/\bfocus\/([\w\.]+)/i],[A,[u,R+" Focus"]],[/\bopt\/([\w\.]+)/i],[A,[u,k+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[A,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[A,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[A,[u,k+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[A,[u,"MIUI "+T]],[/fxios\/([-\w\.]+)/i],[A,[u,R]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 "+T]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 "+T],A],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],A],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,A],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,F],A],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,A],[/\bgsa\/([\w\.]+) .*safari\//i],[A,[u,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[A,[u,C+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,C+" WebView"],A],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[A,[u,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,A],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[A,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[A,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[A,K,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,A],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],A],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[A,[u,R+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[u,A],[/(cobalt)\/([\w\.]+)/i],[u,[A,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,Q]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,"",Q]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,Q]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[l,[h,N],[d,g]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[l,[h,N],[d,m]],[/\((ip(?:hone|od)[\w ]*);/i],[l,[h,E],[d,m]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[l,[h,E],[d,g]],[/(macintosh);/i],[l,[h,E]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[l,[h,P],[d,m]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[l,[h,x],[d,g]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[l,[h,x],[d,m]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[l,/_/g," "],[h,B],[d,m]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[l,/_/g," "],[h,B],[d,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[l,[h,"OPPO"],[d,m]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[l,[h,"Vivo"],[d,m]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[l,[h,"Realme"],[d,m]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[l,[h,M],[d,m]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[l,[h,M],[d,g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[l,[h,O],[d,g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[l,[h,O],[d,m]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[l,[h,"Lenovo"],[d,g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[l,/_/g," "],[h,"Nokia"],[d,m]],[/(pixel c)\b/i],[l,[h,I],[d,g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[l,[h,I],[d,m]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[l,[h,D],[d,m]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[l,"Xperia Tablet"],[h,D],[d,g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[l,[h,"OnePlus"],[d,m]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[l,[h,b],[d,g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[l,/(.+)/g,"Fire Phone $1"],[h,b],[d,m]],[/(playbook);[-\w\),; ]+(rim)/i],[l,h,[d,g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[l,[h,S],[d,m]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[l,[h,w],[d,g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[l,[h,w],[d,m]],[/(nexus 9)/i],[l,[h,"HTC"],[d,g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[h,[l,/_/g," "],[d,m]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[l,[h,"Acer"],[d,g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[l,[h,"Meizu"],[d,m]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[h,l,[d,m]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[h,l,[d,g]],[/(surface duo)/i],[l,[h,L],[d,g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[l,[h,"Fairphone"],[d,m]],[/(u304aa)/i],[l,[h,"AT&T"],[d,m]],[/\bsie-(\w*)/i],[l,[h,"Siemens"],[d,m]],[/\b(rct\w+) b/i],[l,[h,"RCA"],[d,g]],[/\b(venue[\d ]{2,7}) b/i],[l,[h,"Dell"],[d,g]],[/\b(q(?:mv|ta)\w+) b/i],[l,[h,"Verizon"],[d,g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[l,[h,"Barnes & Noble"],[d,g]],[/\b(tm\d{3}\w+) b/i],[l,[h,"NuVision"],[d,g]],[/\b(k88) b/i],[l,[h,"ZTE"],[d,g]],[/\b(nx\d{3}j) b/i],[l,[h,"ZTE"],[d,m]],[/\b(gen\d{3}) b.+49h/i],[l,[h,"Swiss"],[d,m]],[/\b(zur\d{3}) b/i],[l,[h,"Swiss"],[d,g]],[/\b((zeki)?tb.*\b) b/i],[l,[h,"Zeki"],[d,g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[h,"Dragon Touch"],l,[d,g]],[/\b(ns-?\w{0,9}) b/i],[l,[h,"Insignia"],[d,g]],[/\b((nxa|next)-?\w{0,9}) b/i],[l,[h,"NextBook"],[d,g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[h,"Voice"],l,[d,m]],[/\b(lvtel\-)?(v1[12]) b/i],[[h,"LvTel"],l,[d,m]],[/\b(ph-1) /i],[l,[h,"Essential"],[d,m]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[l,[h,"Envizen"],[d,g]],[/\b(trio[-\w\. ]+) b/i],[l,[h,"MachSpeed"],[d,g]],[/\btu_(1491) b/i],[l,[h,"Rotor"],[d,g]],[/(shield[\w ]+) b/i],[l,[h,"Nvidia"],[d,g]],[/(sprint) (\w+)/i],[h,l,[d,m]],[/(kin\.[onetw]{3})/i],[[l,/\./g," "],[h,L],[d,m]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[l,[h,U],[d,g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[l,[h,U],[d,m]],[/smart-tv.+(samsung)/i],[h,[d,v]],[/hbbtv.+maple;(\d+)/i],[[l,/^/,"SmartTV"],[h,N],[d,v]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[h,O],[d,v]],[/(apple) ?tv/i],[h,[l,E+" TV"],[d,v]],[/crkey/i],[[l,C+"cast"],[h,I],[d,v]],[/droid.+aft(\w)( bui|\))/i],[l,[h,b],[d,v]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[l,[h,P],[d,v]],[/(bravia[\w ]+)( bui|\))/i],[l,[h,D],[d,v]],[/(mitv-\w{5}) bui/i],[l,[h,B],[d,v]],[/Hbbtv.*(technisat) (.*);/i],[h,l,[d,v]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[h,z],[l,z],[d,v]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[d,v]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[h,l,[d,f]],[/droid.+; (shield) bui/i],[l,[h,"Nvidia"],[d,f]],[/(playstation [345portablevi]+)/i],[l,[h,D],[d,f]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[l,[h,L],[d,f]],[/((pebble))app/i],[h,l,[d,y]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[l,[h,E],[d,y]],[/droid.+; (glass) \d/i],[l,[h,I],[d,y]],[/droid.+; (wt63?0{2,3})\)/i],[l,[h,U],[d,y]],[/(quest( 2| pro)?)/i],[l,[h,F],[d,y]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[h,[d,_]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[l,[d,m]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[l,[d,g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[d,g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[d,m]],[/(android[-\w\. ]{0,9});.+buil/i],[l,[h,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[A,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[A,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[u,A],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[A,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,A],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[A,K,q]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[A,K,q]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[A,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,V],[A,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[A,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,A],[/\(bb(10);/i],[A,[u,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[A,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[A,[u,R+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[A,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[A,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[A,[u,C+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,H],A],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,A],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],A],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[u,A]]},$=function(t,e){if(typeof t===o&&(e=t,t=i),!(this instanceof $))return new $(t,e).getResult();var f=typeof n!==s&&n.navigator?n.navigator:i,v=t||(f&&f.userAgent?f.userAgent:""),y=f&&f.userAgentData?f.userAgentData:i,_=e?function(t,e){var n={};for(var i in t)e[i]&&e[i].length%2==0?n[i]=e[i].concat(t[i]):n[i]=t[i];return n}(Y,e):Y;return this.getBrowser=function(){var t={};return t[u]=i,t[A]=i,W.call(t,v,_.browser),t[c]=function(t){return typeof t===a?t.replace(/[^\d\.]/g,"").split(".")[0]:i}(t[A]),f&&f.brave&&typeof f.brave.isBrave==r&&(t[u]="Brave"),t},this.getCPU=function(){var t={};return t[p]=i,W.call(t,v,_.cpu),t},this.getDevice=function(){var t={};return t[h]=i,t[l]=i,t[d]=i,W.call(t,v,_.device),!t[d]&&y&&y.mobile&&(t[d]=m),"Macintosh"==t[l]&&f&&typeof f.standalone!==s&&f.maxTouchPoints&&f.maxTouchPoints>2&&(t[l]="iPad",t[d]=g),t},this.getEngine=function(){var t={};return t[u]=i,t[A]=i,W.call(t,v,_.engine),t},this.getOS=function(){var t={};return t[u]=i,t[A]=i,W.call(t,v,_.os),!t[u]&&y&&"Unknown"!=y.platform&&(t[u]=y.platform.replace(/chrome os/i,H).replace(/macos/i,V)),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return v},this.setUA=function(t){return v=typeof t===a&&t.length>350?z(t,350):t,this},this.setUA(v),this};$.VERSION="0.7.34",$.BROWSER=j([u,A,c]),$.CPU=j([p]),$.DEVICE=j([l,h,d,f,m,v,g,y,_]),$.ENGINE=$.OS=j([u,A]),t.exports&&(e=t.exports=$),e.UAParser=$;var X=typeof n!==s&&(n.jQuery||n.Zepto);if(X&&!X.ua){var J=new $;X.ua=J.getResult(),X.ua.get=function(){return J.getUA()},X.ua.set=function(t){J.setUA(t);var e=J.getResult();for(var n in e)X.ua[n]=e[n]}}}("object"==typeof window?window:K)}(lv,lv.exports);const uv=new(q(lv.exports));let dv=uv.getResult(),hv=null;function Av(t){if(!hv){t&&uv.setUA(t),dv=uv.getResult();const e=function(t){if("Blink"===t.engine.name&&"WeChat"!==t.browser.name)return cv.CHROME;switch(t.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return cv.CHROME;case"Safari":case"Mobile Safari":return cv.SAFARI;case"Edge":return cv.EDGE;case"Firefox":return cv.FIREFOX;case"QQBrowser":return cv.QQ;case"Opera":return cv.OPERA;case"WeChat":return cv.WECHAT;default:return t.browser.name||""}}(dv),n=function(t){let e;return e="Blink"===t.engine.name?t.engine.version||"":t.browser.version||"",e.split(".")[0]}(dv),i=function(t){return"Windows"===t.os.name?t.os.version?t.os.name+" "+t.os.version:t.os.name:t.os.name||""}(dv),r=dv.os.version;if(!(e&&n&&i&&r))return{name:e,version:n,os:i,osVersion:r};hv={name:e,version:n,os:i,osVersion:r}}return hv}function pv(){return Av().os}function fv(){const t=Av();return"".concat(t.os," ").concat(t.osVersion)}function mv(){const t=Av();return!!("WebKit"===dv.engine.name&&t.os===av.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&t.name!==cv.SAFARI||Ev()&&t.name!==cv.SAFARI)}function gv(){const t=Av();if(mv()){if(t.os===av.MAC_OS)return!0;if(t.os===av.IOS){const t=dv.os.version&&dv.os.version.split(".");if(t&&14===Number(t[0])&&t[1]&&Number(t[1])>=3)return!0;if(t&&Number(t[0])>14)return!0}}return!1}function vv(){return"WebKit"===dv.engine.name}function yv(){return Av().name===cv.CHROME}function _v(){return Av().name===cv.SAFARI}function bv(){return Av().name===cv.FIREFOX}function Ev(){return Av().os===av.IOS}function wv(t){const e=Av();return!(e.name!==cv.CHROME||!e.osVersion)&&Number(e.version)>=t}function Sv(t){const e=Av();return!(e.name!==cv.EDGE||!e.osVersion)&&Number(e.version)>=t}function Tv(t){const e=Av();return!(e.name!==cv.OPERA||!e.osVersion)&&Number(e.version)>=t}function Cv(){const t=Av();return!(t.name!==cv.CHROME||!t.osVersion)&&Number(t.version)<=90}function Rv(){const t=Av();if(t.os!==av.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return Number(e[0])<14||14===Number(e[0])&&Number(e[1])<=6}function Iv(){const t=Av();if(t.os!==av.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return 15===Number(e[0])}function xv(){const t=Av();if(t.os!==av.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return 16===Number(e[0])}function Ov(){const t=Av();if(t.os!==av.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return 15===Number(e[0])&&Number(e[1])>=1}function Lv(){return _v()&&navigator.maxTouchPoints>0}function Mv(){return Av().name===cv.WECHAT}function kv(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Nv(){const t=Av();return t.name!==cv.EDGE&&t.name!==cv.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Pv(){return pv()===av.ANDROID}function Dv(){const t=Av();return Pv()&&(t.name===cv.CHROME||t.name===cv.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var Bv;!function(t){t.UNEXPECTED_ERROR="UNEXPECTED_ERROR",t.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",t.TIMEOUT="TIMEOUT",t.INVALID_PARAMS="INVALID_PARAMS",t.NOT_READABLE="NOT_READABLE",t.NOT_SUPPORTED="NOT_SUPPORTED",t.INVALID_OPERATION="INVALID_OPERATION",t.OPERATION_ABORTED="OPERATION_ABORTED",t.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",t.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",t.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",t.DATACHANNEL_FAILED="DATACHANNEL_FAILED",t.NETWORK_ERROR="NETWORK_ERROR",t.NETWORK_TIMEOUT="NETWORK_TIMEOUT",t.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",t.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",t.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",t.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",t.ELECTRON_IS_NULL="ELECTRON_IS_NULL",t.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",t.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",t.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",t.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",t.PERMISSION_DENIED="PERMISSION_DENIED",t.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",t.TRACK_IS_DISABLED="TRACK_IS_DISABLED",t.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",t.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",t.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",t.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",t.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",t.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",t.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",t.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",t.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",t.UID_CONFLICT="UID_CONFLICT",t.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",t.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",t.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",t.INVALID_TRACK="INVALID_TRACK",t.SENDER_NOT_FOUND="SENDER_NOT_FOUND",t.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",t.SET_ANSWER_FAILED="SET_ANSWER_FAILED",t.ICE_FAILED="ICE_FAILED",t.PC_CLOSED="PC_CLOSED",t.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",t.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",t.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",t.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",t.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",t.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",t.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",t.INVALID_REMOTE_USER="INVALID_REMOTE_USER",t.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",t.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",t.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",t.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",t.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",t.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",t.WS_ABORT="WS_ABORT",t.WS_DISCONNECT="WS_DISCONNECT",t.WS_ERR="WS_ERR",t.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",t.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",t.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",t.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",t.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",t.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",t.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",t.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",t.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",t.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",t.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",t.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",t.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",t.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",t.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",t.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",t.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",t.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",t.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",t.INVALID_PLUGIN="INVALID_PLUGIN",t.DISCONNECT_P2P="DISCONNECT_P2P",t.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",t.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",t.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",t.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",t.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",t.PROHIBITED_OPERATION="PROHIBITED_OPERATION",t.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(Bv||(Bv={}));let Uv=class extends Error{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(e),ih(this,"code",void 0),ih(this,"message",void 0),ih(this,"data",void 0),ih(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(e),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error",e=arguments.length>1?arguments[1]:void 0;return"error"===t&&(e||console).error(this.toString()),"warning"===t&&(e||console).warn(this.toString()),this}throw(t){throw this.print("error",t),this}};function Fv(t,e){if("boolean"!=typeof t)throw new Uv(Bv.INVALID_PARAMS,"Invalid ".concat(e,": The value is of the boolean type."))}function Hv(t,e,n){if(!kr(n).call(n,t))throw new Uv(Bv.INVALID_PARAMS,"".concat(e," can only be set as ").concat(JSON.stringify(n)))}function Vv(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4;if(t<n||t>i||(!(arguments.length>4&&void 0!==arguments[4])||arguments[4])&&!function(t){return"number"==typeof t&&t%1==0}(t))throw new Uv(Bv.INVALID_PARAMS,"invalid ".concat(e,": the value range is [").concat(n,", ").concat(i,"]. integer only"))}function jv(t,e){if("number"!=typeof t){if(!(t.min||t.max||t.ideal||t.exact))throw new Uv(Bv.INVALID_PARAMS,"".concat(e," is not a valid ConstrainLong"));void 0!==t.min&&Vv(t.min,"".concat(e,".min"),0,1/0),void 0!==t.max&&Vv(t.max,"".concat(e,".max"),1,1/0),void 0!==t.exact&&Vv(t.exact,"".concat(e,".exact"),1,1/0),void 0!==t.ideal&&Vv(t.ideal,"".concat(e,".ideal"),1,1/0)}else Vv(t,e,1,1/0)}function Gv(t,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==t)throw new Uv(Bv.INVALID_PARAMS,"".concat(e||"param"," cannot be empty"));if(!Wv(t,n,i,r))throw new Uv(Bv.INVALID_PARAMS,"Invalid ".concat(e||"string param",": Length of the string: [").concat(n,",").concat(i,"].").concat(r?" ASCII characters only.":""))}function Qv(t,e){if(!Array.isArray(t))throw new Uv(Bv.INVALID_PARAMS,"".concat(e," should be an array"))}function zv(t){return null==t}function Wv(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof t&&t.length<=n&&t.length>=e&&(!i||function(t){if("string"!=typeof t)return!1;for(let e=0;e<t.length;e+=1){const n=t.charCodeAt(e);if(n<0||n>255)return!1}return!0}(t))}function Kv(t,e,n){if("getBigUint64"in DataView.prototype)return t.getBigUint64(e,n);const i=t.getUint32(e,n),r=t.getUint32(e+4,n),s=Number(!!n),o=Number(!n);return BigInt(i*o+r*s)<<BigInt(32)|BigInt(i*s+r*o)}function qv(t,e,n,i){if("setBigUint64"in DataView.prototype)return t.setBigUint64(e,n,i);const r=Number(n>>BigInt(32)),s=Number(n&BigInt(4294967295));i?(t.setUint32(e+4,r,i),t.setUint32(e,s,i)):(t.setUint32(e,r,i),t.setUint32(e+4,s,i))}var Yv,$v;!function(t){t.COVERED="COVERED",t.POSITION="POSITION",t.SIZE="SIZE",t.STYLE="STYLE"}(Yv||(Yv={})),function(t){t.UNMOUNTED="UNMOUNTED",t.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}($v||($v={}));const Xv=new class{constructor(){ih(this,"_clientSize",null),ih(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),ih(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),ih(this,"getStyle",(t=>window.getComputedStyle(t,null))),ih(this,"checkCssVisibleProperty",(t=>{var e;let n=!0;const i=this.getStyle(t),{display:r,visibility:s,opacity:o,filter:a}=i;return("none"===r||kr(e=["hidden","collapse"]).call(e,s)||Number(o)<.1)&&(n=!1),!!n&&(a&&a.split(" ").filter((t=>{var e;const n=t.split("(")[0];return kr(e=["brightness","blur","opacity"]).call(e,n)})).map((t=>{const[e,n]=t.split(/\(|\)/);return[e,Number(n.match(/^[0-9\.]+/))]})).forEach((t=>{const[e,i]=t;switch(e){case"brightness":(i<.1||i>3)&&(n=!1);break;case"blur":i>3&&(n=!1);break;case"opacity":i<.1&&(n=!1)}})),n)})),ih(this,"checkPropertyUpToAllParentNodes",((t,e)=>{let n=!0,i=!0;const r=t=>e(t);let s=t;for(;s&&i;)r(s)||(n=!1,i=!1),s=s.parentElement,s||(i=!1);return n})),ih(this,"checkActualCssVisibleIncludeInherit",(t=>this.checkPropertyUpToAllParentNodes(t,this.checkCssVisibleProperty))),ih(this,"getSizeAboutClient",(t=>{const{width:e,height:n,left:i,right:r,top:s,bottom:o}=t.getBoundingClientRect(),a=this.getClientWidth(),c=this.getClientHeight();return{width:e,height:n,left:i,right:r,top:s,bottom:o,clientWidth:a,clientHeight:c,clientMin:Math.min(a,c)}})),ih(this,"checkActualSize",(()=>{const{width:t,height:e,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(t,e,n)})),ih(this,"elementFromPoint",((t,e)=>document.elementFromPoint?document.elementFromPoint(t,e):null)),ih(this,"checkCoverForAPoint",((t,e,n)=>{const i=this.elementFromPoint(t,e);return null!==i&&i!==n})),ih(this,"getPointPositionList",(()=>{const{width:t,height:e,left:n,top:i}=this._clientSize,r=t/6,s=e/6,o=[],a=10**6;for(let t=0;t<5;t++)for(let e=0;e<5;e++){const c=(n*a+(0===t?.1:4===t?(r*t*a-1e5)/a:r*t)*a)/a,l=(i*a+(0===e?.1:4===e?(s*e*a-1e5)/a:s*e)*a)/a;o.push({x:c,y:l})}return[...o]})),ih(this,"checkElementCover",(t=>this.getPointPositionList().map((e=>this.checkCoverForAPoint(e.x,e.y,t))).filter((t=>!!t)).length>6)),ih(this,"checkSizeIsVisible",((t,e,n)=>(t>50||n/t<=10)&&(e>50||n/e<=10))),ih(this,"checkSizeOfPartInClient",(()=>{const{left:t,right:e,top:n,bottom:i,clientHeight:r,clientWidth:s,clientMin:o}=this._clientSize;let a,c,l,u;if(t<0)a=0;else{if(!(t<s))return!1;a=t}if(e<0)return!1;if(c=e<s?e:s,n<0)l=0;else{if(!(n<r))return!1;l=n}if(i<0)return!1;u=i<r?i:r;const d=c-a,h=u-l;return this.checkSizeIsVisible(d,h,o)})),ih(this,"returnHiddenResult",(t=>(this._clientSize=null,{visible:!1,reason:t}))),ih(this,"checkOneElementVisible",(t=>{if(t instanceof HTMLElement){if(this.checkElementIsMountedOnDom(t)){if(this.checkActualCssVisibleIncludeInherit(t)){if(this._clientSize=this.getSizeAboutClient(t),this.checkElementCover(t))return this.returnHiddenResult(Yv.COVERED);{const t=this.checkActualSize(),e=this.checkSizeOfPartInClient();return t&&!e?this.returnHiddenResult(Yv.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Yv.SIZE)}}return this.returnHiddenResult(Yv.STYLE)}return this.returnHiddenResult($v.UNMOUNTED)}return this.returnHiddenResult($v.INVALID_HTML_ELEMENT)})),ih(this,"checkElementIsMountedOnDom",(t=>this.checkPropertyUpToAllParentNodes(t,(t=>"HTML"!==t.nodeName.toUpperCase()?null!==t.parentElement:!!document.documentElement))))}};function Jv(t){return(new TextEncoder).encode(t)}const Zv=function(t,e){const n=new Uint8Array(t.byteLength+e.byteLength);return n.set(new Uint8Array(t),0),n.set(new Uint8Array(e),t.byteLength),n},ty=async t=>{const e=function(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let t=0;t<e.length;t+=1)n[t]=e.charCodeAt(t);return n}("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),n=await window.crypto.subtle.importKey("spki",e,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),i=Jv(t),r=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,i);return function(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}(new Uint8Array(r))},ey=async t=>function(t,e){let n="";return new Uint8Array(t).forEach((t=>{n+=t.toString(e).padStart(2,"0")})),n}(await crypto.subtle.digest("SHA-256",Jv(t)),16);class ny{constructor(){ih(this,"_events",{}),ih(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map((t=>t.listener)):[]}on(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];-1===this._indexOfListener(n,e)&&n.push({listener:e,once:!1})}once(t,e){this._events[t]||(this._events[t]=[]);const n=this._events[t];-1===this._indexOfListener(n,e)&&n.push({listener:e,once:!0})}off(t,e){if(!this._events[t])return;const n=this._events[t],i=this._indexOfListener(n,e);-1!==i&&n.splice(i,1),0===this._events[t].length&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const e=this._events[t].map((t=>t));for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(let n=0;n<e.length;n+=1){const r=e[n];r.once&&this.off(t,r.listener),r.listener.apply(this,i||[])}}safeEmit(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];[...this._events[t]||[]].forEach((e=>{e.once&&this.off(t,e.listener);try{e.listener.apply(this,n)}catch(e){console.error("safeEmit event:".concat(t," error ").concat(null==e?void 0:e.toString()))}}))}_indexOfListener(t,e){let n=t.length;for(;n--;)if(t[n].listener===e)return n;return-1}}let iy=null;function ry(){if(iy)return iy;if(window.electron)return iy=window.electron;if(!window.require)return null;try{return iy=window.require("electron"),iy}catch(t){return null}}var sy,oy,ay,cy,ly,uy,dy,hy;function Ay(t){return Vv(t.timeout,"config.timeout",0,1e5),Vv(t.timeoutFactor,"config.timeoutFactor",0,100,!1),Vv(t.maxRetryCount,"config.maxRetryConfig",0,1/0),Vv(t.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function py(t){if(!Array.isArray(t)||t.length<1)return!1;try{t.forEach((t=>{if(!t.urls)throw Error()}))}catch(t){return!1}return!0}function fy(t){return Gv(t.turnServerURL,"turnServerURL"),Gv(t.username,"username"),Gv(t.password,"password"),t.udpport&&Vv(t.udpport,"udpport",1,99999,!0),t.forceturn&&Fv(t.forceturn,"forceturn"),t.security&&Fv(t.security,"security"),t.tcpport&&Vv(t.tcpport,"tcpport",1,99999,!0),!0}function my(t){return void 0!==t.level&&Hv(t.level,"level",[1,2,3]),void 0!==t.delay&&Vv(t.delay,"delay",0,3e3,!0),!0}function gy(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return 0===t.getListeners(e).length?ev.reject(new Uv(Bv.UNEXPECTED_ERROR,"can not emit promise")):new ev(((n,r)=>{t.emit(e,...i,n,r)}))}function vy(t,e){if(0===t.getListeners(e).length)return ev.resolve();for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return gy(t,e,...i)}function yy(t,e){if(0===t.getListeners(e).length)return null;for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return _y(t,e,...i)}function _y(t,e){let n=null,i=null;for(var r=arguments.length,s=new Array(r>2?r-2:0),o=2;o<r;o++)s[o-2]=arguments[o];if(t.emit(e,...s,(t=>{n=t}),(t=>{i=t})),null!==i)throw i;if(null===n)throw new Uv(Bv.UNEXPECTED_ERROR,"handler is not sync");return n}!function(t){t.CREATE_CLIENT="createClient",t.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",t.SET_AREA="setArea",t.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",t.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",t.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",t.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",t.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",t.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",t.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",t.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",t.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",t.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",t.START_PROXY_SERVER="Client.startProxyServer",t.STOP_PROXY_SERVER="Client.stopProxyServer",t.SET_PROXY_SERVER="Client.setProxyServer",t.SET_TURN_SERVER="Client.setTurnServer",t.SET_CLIENT_ROLE="Client.setClientRole",t.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",t.ENABLE_DUAL_STREAM="Client.enableDualStream",t.DISABLE_DUAL_STREAM="Client.disableDualStream",t.JOIN="Client.join",t.LEAVE="Client.leave",t.PUBLISH="Client.publish",t.UNPUBLISH="Client.unpublish",t.SUBSCRIBE="Client.subscribe",t.MASS_SUBSCRIBE="Client.massSubscribe",t.MASS_UNSUBSCRIBE="Client.massUnsubscribe",t.UNSUBSCRIBE="Client.unsubscribe",t.RENEW_TOKEN="Client.renewToken",t.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",t.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",t.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",t.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",t.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",t.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",t.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",t.DATACHANNEL_FAILBACK="Client._datachannelFailback",t.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",t.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",t.START_LIVE_STREAMING="Client.startLiveStreaming",t.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",t.STOP_LIVE_STREAMING="Client.stopLiveStreaming",t.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",t.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",t.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",t.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",t.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",t.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",t.SET_CONFIG_DISTRIBUTE="_configDistribute",t.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",t.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",t.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",t.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",t.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",t.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",t.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",t.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",t.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",t.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",t.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",t.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",t.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",t.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",t.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",t.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",t.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",t.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",t.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",t.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",t.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",t.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",t.STREAM_TYPE_CHANGE="streamTypeChange",t.CONNECTION_STATE_CHANGE="connectionStateChange",t.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",t.IMAGE_MODERATION_UPLOAD="imageModerationUpload"}(sy||(sy={})),function(t){t.TRACER="tracer"}(oy||(oy={})),function(t){t[t.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",t[t.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",t[t.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(ay||(ay={})),function(t){t.LEAVE="LEAVE",t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.UID_BANNED="UID_BANNED",t.IP_BANNED="IP_BANNED",t.CHANNEL_BANNED="CHANNEL_BANNED",t.FALLBACK="FALLBACK",t.LICENSE_MISSING="LICENSE_MISSING",t.LICENSE_EXPIRED="LICENSE_EXPIRED",t.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",t.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",t.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",t.LICENSE_ILLEGAL="LICENSE_ILLEGAL",t.TOKEN_EXPIRE="TOKEN_EXPIRE"}(cy||(cy={})),function(t){t.CONNECTION_STATE_CHANGE="connection-state-change",t.MEDIA_RECONNECT_START="media-reconnect-start",t.MEDIA_RECONNECT_END="media-reconnect-end",t.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",t.USER_JOINED="user-joined",t.USER_LEAVED="user-left",t.USER_PUBLISHED="user-published",t.USER_UNPUBLISHED="user-unpublished",t.USER_INFO_UPDATED="user-info-updated",t.CLIENT_BANNED="client-banned",t.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",t.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",t.VOLUME_INDICATOR="volume-indicator",t.CRYPT_ERROR="crypt-error",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGED="stream-type-changed",t.STREAM_FALLBACK="stream-fallback",t.RECEIVE_METADATA="receive-metadata",t.STREAM_MESSAGE="stream-message",t.LIVE_STREAMING_ERROR="live-streaming-error",t.LIVE_STREAMING_WARNING="live-streaming-warning",t.INJECT_STREAM_STATUS="stream-inject-status",t.EXCEPTION="exception",t.ERROR="error",t.P2P_LOST="p2p_lost",t.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",t.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",t.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",t.PUBLISHED_USER_LIST="published-user-list",t.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",t.CONTENT_INSPECT_ERROR="content-inspect-error",t.CONTENT_INSPECT_RESULT="content-inspect-result",t.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(ly||(ly={})),function(t){t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK"}(uy||(uy={})),function(t){t.ONLINE="ONLINE",t.OFFLINE="OFFLINE"}(dy||(dy={})),function(t){t.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",t.ONLINE="ONLINE",t.OFFLINE="OFFLINE"}(hy||(hy={}));const by=new class extends ny{set networkState(t){this.emit(hy.NETWORK_STATE_CHANGE,t,this._networkState),t===dy.ONLINE?this.emit(hy.ONLINE):t===dy.OFFLINE&&(this.onlineWaiter=new ev((t=>{this.once(hy.ONLINE,(()=>{this.onlineWaiter=void 0,t(dy.ONLINE)}))})),this.emit(hy.OFFLINE)),this._networkState=t}get networkState(){return this._networkState}get isOnline(){return this._networkState===dy.ONLINE}constructor(){super(),ih(this,"_moduleName","network-indicator"),ih(this,"_networkState",dy.ONLINE),ih(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=dy.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=dy.OFFLINE}))}};function Ey(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function wy(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ey(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ey(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Sy(t,e){const n=t.indexOf(e);-1!==n&&t.splice(n,1)}function Ty(t){const e=[];return t.forEach((t=>{-1===e.indexOf(t)&&e.push(t)})),e}function Cy(t){void 0!==ev?ev.resolve().then(t):setTimeout(t,0)}function Ry(t){return JSON.parse(JSON.stringify(t))}function Iy(t){try{return Ry(t)}catch(e){return t}}const xy={};function Oy(t,e){xy[e]||(xy[e]=!0,t())}function Ly(t){const e=window.atob(t),n=new Uint8Array(new ArrayBuffer(e.length));for(let t=0;t<e.length;t+=1)n[t]=e.charCodeAt(t);return n}function My(t){let e="";for(let n=0;n<t.length;n+=1)e+=String.fromCharCode(t[n]);return window.btoa(e)}function ky(t){return window.TextEncoder?(new TextEncoder).encode(t).length:t.length}function Ny(t){let e=0;return/DingTalk/i.test(navigator.userAgent)&&t.realFormData&&(t=t.realFormData),t.forEach((t=>{e+="string"==typeof t?ky(t):t.size})),e+138}function Py(t){const e=new Uv(Bv.TIMEOUT,"timeout");return new ev(((n,i)=>{window.setTimeout((()=>i(e)),t)}))}function Dy(t){return new ev((e=>{window.setTimeout(e,t)}))}function By(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,e=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,t).toLowerCase();return n.length===t?"".concat(e).concat(n):"".concat(e).concat(n)+By(t-n.length,"")}function Uy(){return By(32,"").toUpperCase()}const Fy=()=>{},Hy=new class{constructor(){ih(this,"fnMap",new Map)}throttleByKey(t,e,n,i){for(var r=arguments.length,s=new Array(r>4?r-4:0),o=4;o<r;o++)s[o-4]=arguments[o];if(this.fnMap.has(e)){const r=this.fnMap.get(e);if(r.threshold!==n){r.fn(...r.args),clearTimeout(r.timer);const o=window.setTimeout((()=>{const t=this.fnMap.get(e);t&&t.fn(...t.args),this.fnMap.delete(e)}),n);this.fnMap.set(e,{fn:t,threshold:n,timer:o,args:s,skipFn:i})}else r.skipFn&&r.skipFn(...r.args),this.fnMap.set(e,wy(wy({},r),{},{fn:t,args:s,skipFn:i}))}else{const r=window.setTimeout((()=>{const t=this.fnMap.get(e);t&&t.fn(...t.args),this.fnMap.delete(e)}),n);this.fnMap.set(e,{fn:t,threshold:n,timer:r,args:s,skipFn:i})}}},Vy=Hy.throttleByKey.bind(Hy);function jy(t){return"object"==typeof t&&null!==t&&!(t instanceof RegExp)}function Gy(t,e){if(!jy(t)||!jy(e))return e;if(Array.isArray(t)&&!Array.isArray(e)||!Array.isArray(t)&&Array.isArray(e))return e;if(Array.isArray(e)&&Array.isArray(t)){const n=[...t];for(let i=0;i<e.length;i++)n[i]=Gy(t[i],e[i]);return n}{const n=wy({},t);for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(Object.prototype.hasOwnProperty.call(t,i)?n[i]=Gy(t[i],e[i]):n[i]=e[i]);return n}}let Qy=1,zy=console;class Wy{static setLogger(t){zy=t}constructor(t){ih(this,"lockingPromise",ev.resolve()),ih(this,"locks",0),ih(this,"name",""),ih(this,"lockId",void 0),this.lockId=Qy++,t&&(this.name=t),zy.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let e;this.locks+=1,zy.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof t?t:""));const n=new ev((n=>{e=()=>{this.locks-=1,zy.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof t?t:"")),n()}})),i=this.lockingPromise.then((()=>e));return this.lockingPromise=this.lockingPromise.then((()=>n)),i}}function Ky(t,e){return function(n,i,r){const s=r.value;if("function"!=typeof s)throw new Error("Cannot use mutex on object property.");return r.value=async function(){const n=this[e];if(!n)throw new Error("mutex property key ".concat(e," doesn't exist on ").concat(t));const r=await n.lock("From ".concat(t,".").concat(i));try{for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return await s.apply(this,a)}finally{r()}},r}}const qy={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Yy(t,e){const n=Math.floor(e.timeout*Math.pow(e.timeoutFactor,t));return Math.min(e.maxRetryTimeout,n)}function $y(t,e,n,i){const r=Object.assign({},qy,i);let s=r.timeout;const o=async()=>{await function(t){return new ev((e=>{window.setTimeout(e,t)}))}(s),s*=r.timeoutFactor,s=Math.min(r.maxRetryTimeout,s)};let a=!1;const c=new ev((async(i,s)=>{e=e||(()=>!1),n=n||(()=>!0);for(let c=0;c<r.maxRetryCount;c+=1){if(a)return s(new Uv(Bv.OPERATION_ABORTED));try{const n=await t();if(!e(n,c))return i(n);if(c+1===r.maxRetryCount)return i(n);await o()}catch(t){if(!n(t,c))return s(t);if(c+1===r.maxRetryCount)return s(t);await o()}}}));return c.cancel=()=>a=!0,c}var Xy=De,Jy=tn,Zy=$t,t_=Ki,e_=TypeError,n_=function(t){return function(e,n,i,r){Xy(n);var s=Jy(e),o=Zy(s),a=t_(s),c=t?a-1:0,l=t?-1:1;if(i<2)for(;;){if(c in o){r=o[c],c+=l;break}if(c+=l,t?c<0:a<=c)throw e_("Reduce of empty array with no initial value")}for(;t?c>=0:a>c;c+=l)c in o&&(r=n(r,o[c],c,s));return r}},i_=[n_(!1),n_(!0)][0];Pi({target:"Array",proto:!0,forced:!Ep&&_e>79&&_e<83||!bh("reduce")},{reduce:function(t){var e=arguments.length;return i_(this,t,e,e>1?arguments[1]:void 0)}});var r_=er("Array").reduce,s_=ft,o_=r_,a_=Array.prototype,c_=q((function(t){var e=t.reduce;return t===a_||s_(a_,t)&&e===a_.reduce?o_:e}));let l_=class{constructor(t){ih(this,"input",[]),ih(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return 0===this.input.length?0:c_(t=this.input).call(t,((t,e)=>t+e))/this.input.length}};var u_,d_={exports:{}},h_=function(t,e){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return t.apply(e,n)}},A_=h_,p_=Object.prototype.toString,f_=(u_=Object.create(null),function(t){var e=p_.call(t);return u_[e]||(u_[e]=e.slice(8,-1).toLowerCase())});function m_(t){return t=t.toLowerCase(),function(e){return f_(e)===t}}function g_(t){return Array.isArray(t)}function v_(t){return void 0===t}var y_=m_("ArrayBuffer");function __(t){return null!==t&&"object"==typeof t}function b_(t){if("object"!==f_(t))return!1;var e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}var E_=m_("Date"),w_=m_("File"),S_=m_("Blob"),T_=m_("FileList");function C_(t){return"[object Function]"===p_.call(t)}var R_=m_("URLSearchParams");function I_(t,e){if(null!=t)if("object"!=typeof t&&(t=[t]),g_(t))for(var n=0,i=t.length;n<i;n++)e.call(null,t[n],n,t);else for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.call(null,t[r],r,t)}var x_,O_=(x_="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(t){return x_&&t instanceof x_}),L_={isArray:g_,isArrayBuffer:y_,isBuffer:function(t){return null!==t&&!v_(t)&&null!==t.constructor&&!v_(t.constructor)&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)},isFormData:function(t){var e="[object FormData]";return t&&("function"==typeof FormData&&t instanceof FormData||p_.call(t)===e||C_(t.toString)&&t.toString()===e)},isArrayBufferView:function(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&y_(t.buffer)},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:__,isPlainObject:b_,isUndefined:v_,isDate:E_,isFile:w_,isBlob:S_,isFunction:C_,isStream:function(t){return __(t)&&C_(t.pipe)},isURLSearchParams:R_,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:I_,merge:function t(){var e={};function n(n,i){b_(e[i])&&b_(n)?e[i]=t(e[i],n):b_(n)?e[i]=t({},n):g_(n)?e[i]=n.slice():e[i]=n}for(var i=0,r=arguments.length;i<r;i++)I_(arguments[i],n);return e},extend:function(t,e,n){return I_(e,(function(e,i){t[i]=n&&"function"==typeof e?A_(e,n):e})),t},trim:function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},stripBOM:function(t){return 65279===t.charCodeAt(0)&&(t=t.slice(1)),t},inherits:function(t,e,n,i){t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,n&&Object.assign(t.prototype,n)},toFlatObject:function(t,e,n){var i,r,s,o={};e=e||{};do{for(r=(i=Object.getOwnPropertyNames(t)).length;r-- >0;)o[s=i[r]]||(e[s]=t[s],o[s]=!0);t=Object.getPrototypeOf(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},kindOf:f_,kindOfTest:m_,endsWith:function(t,e,n){t=String(t),(void 0===n||n>t.length)&&(n=t.length),n-=e.length;var i=t.indexOf(e,n);return-1!==i&&i===n},toArray:function(t){if(!t)return null;var e=t.length;if(v_(e))return null;for(var n=new Array(e);e-- >0;)n[e]=t[e];return n},isTypedArray:O_,isFileList:T_},M_=L_;function k_(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var N_=function(t,e,n){if(!e)return t;var i;if(n)i=n(e);else if(M_.isURLSearchParams(e))i=e.toString();else{var r=[];M_.forEach(e,(function(t,e){null!=t&&(M_.isArray(t)?e+="[]":t=[t],M_.forEach(t,(function(t){M_.isDate(t)?t=t.toISOString():M_.isObject(t)&&(t=JSON.stringify(t)),r.push(k_(e)+"="+k_(t))})))})),i=r.join("&")}if(i){var s=t.indexOf("#");-1!==s&&(t=t.slice(0,s)),t+=(-1===t.indexOf("?")?"?":"&")+i}return t},P_=L_;function D_(){this.handlers=[]}D_.prototype.use=function(t,e,n){return this.handlers.push({fulfilled:t,rejected:e,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},D_.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},D_.prototype.forEach=function(t){P_.forEach(this.handlers,(function(e){null!==e&&t(e)}))};var B_,U_,F_=D_,H_=L_;function V_(){if(U_)return B_;U_=1;var t=L_;function e(t,e,n,i,r){Error.call(this),this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),r&&(this.response=r)}t.inherits(e,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var n=e.prototype,i={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(t){i[t]={value:t}})),Object.defineProperties(e,i),Object.defineProperty(n,"isAxiosError",{value:!0}),e.from=function(i,r,s,o,a,c){var l=Object.create(n);return t.toFlatObject(i,l,(function(t){return t!==Error.prototype})),e.call(l,i.message,r,s,o,a),l.name=i.name,c&&Object.assign(l,c),l},B_=e}var j_,G_,Q_,z_,W_,K_,q_={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function Y_(){if(G_)return j_;G_=1;var t=L_;return j_=function(e,n){n=n||new FormData;var i=[];function r(e){return null===e?"":t.isDate(e)?e.toISOString():t.isArrayBuffer(e)||t.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(s,o){if(t.isPlainObject(s)||t.isArray(s)){if(-1!==i.indexOf(s))throw Error("Circular reference detected in "+o);i.push(s),t.forEach(s,(function(i,s){if(!t.isUndefined(i)){var a,c=o?o+"."+s:s;if(i&&!o&&"object"==typeof i)if(t.endsWith(s,"{}"))i=JSON.stringify(i);else if(t.endsWith(s,"[]")&&(a=t.toArray(i)))return void a.forEach((function(e){!t.isUndefined(e)&&n.append(c,r(e))}));e(i,c)}})),i.pop()}else n.append(o,r(s))}(e),n},j_}function $_(){if(z_)return Q_;z_=1;var t=V_();return Q_=function(e,n,i){var r=i.config.validateStatus;i.status&&r&&!r(i.status)?n(new t("Request failed with status code "+i.status,[t.ERR_BAD_REQUEST,t.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}}function X_(){if(K_)return W_;K_=1;var t=L_;return W_=t.isStandardBrowserEnv()?{write:function(e,n,i,r,s,o){var a=[];a.push(e+"="+encodeURIComponent(n)),t.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),t.isString(r)&&a.push("path="+r),t.isString(s)&&a.push("domain="+s),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},W_}var J_,Z_,tb,eb,nb,ib,rb,sb,ob,ab,cb,lb,ub=function(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)},db=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t},hb=function(t,e){return t&&!ub(e)?db(t,e):e};function Ab(){if(Z_)return J_;Z_=1;var t=L_,e=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return J_=function(n){var i,r,s,o={};return n?(t.forEach(n.split("\n"),(function(n){if(s=n.indexOf(":"),i=t.trim(n.substr(0,s)).toLowerCase(),r=t.trim(n.substr(s+1)),i){if(o[i]&&e.indexOf(i)>=0)return;o[i]="set-cookie"===i?(o[i]?o[i]:[]).concat([r]):o[i]?o[i]+", "+r:r}})),o):o},J_}function pb(){if(eb)return tb;eb=1;var t=L_;return tb=t.isStandardBrowserEnv()?function(){var e,n=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");function r(t){var e=t;return n&&(i.setAttribute("href",e),e=i.href),i.setAttribute("href",e),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:"/"===i.pathname.charAt(0)?i.pathname:"/"+i.pathname}}return e=r(window.location.href),function(n){var i=t.isString(n)?r(n):n;return i.protocol===e.protocol&&i.host===e.host}}():function(){return!0}}function fb(){if(ib)return nb;ib=1;var t=V_();function e(e){t.call(this,null==e?"canceled":e,t.ERR_CANCELED),this.name="CanceledError"}return L_.inherits(e,t,{__CANCEL__:!0}),nb=e}function mb(){return sb||(sb=1,rb=function(t){var e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}),rb}function gb(){if(ab)return ob;ab=1;var t=L_,e=$_(),n=X_(),i=N_,r=hb,s=Ab(),o=pb(),a=q_,c=V_(),l=fb(),u=mb();return ob=function(d){return new Promise((function(h,A){var p,f=d.data,m=d.headers,g=d.responseType;function v(){d.cancelToken&&d.cancelToken.unsubscribe(p),d.signal&&d.signal.removeEventListener("abort",p)}t.isFormData(f)&&t.isStandardBrowserEnv()&&delete m["Content-Type"];var y=new XMLHttpRequest;if(d.auth){var _=d.auth.username||"",b=d.auth.password?unescape(encodeURIComponent(d.auth.password)):"";m.Authorization="Basic "+btoa(_+":"+b)}var E=r(d.baseURL,d.url);function w(){if(y){var t="getAllResponseHeaders"in y?s(y.getAllResponseHeaders()):null,n={data:g&&"text"!==g&&"json"!==g?y.response:y.responseText,status:y.status,statusText:y.statusText,headers:t,config:d,request:y};e((function(t){h(t),v()}),(function(t){A(t),v()}),n),y=null}}if(y.open(d.method.toUpperCase(),i(E,d.params,d.paramsSerializer),!0),y.timeout=d.timeout,"onloadend"in y?y.onloadend=w:y.onreadystatechange=function(){y&&4===y.readyState&&(0!==y.status||y.responseURL&&0===y.responseURL.indexOf("file:"))&&setTimeout(w)},y.onabort=function(){y&&(A(new c("Request aborted",c.ECONNABORTED,d,y)),y=null)},y.onerror=function(){A(new c("Network Error",c.ERR_NETWORK,d,y,y)),y=null},y.ontimeout=function(){var t=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded",e=d.transitional||a;d.timeoutErrorMessage&&(t=d.timeoutErrorMessage),A(new c(t,e.clarifyTimeoutError?c.ETIMEDOUT:c.ECONNABORTED,d,y)),y=null},t.isStandardBrowserEnv()){var S=(d.withCredentials||o(E))&&d.xsrfCookieName?n.read(d.xsrfCookieName):void 0;S&&(m[d.xsrfHeaderName]=S)}"setRequestHeader"in y&&t.forEach(m,(function(t,e){void 0===f&&"content-type"===e.toLowerCase()?delete m[e]:y.setRequestHeader(e,t)})),t.isUndefined(d.withCredentials)||(y.withCredentials=!!d.withCredentials),g&&"json"!==g&&(y.responseType=d.responseType),"function"==typeof d.onDownloadProgress&&y.addEventListener("progress",d.onDownloadProgress),"function"==typeof d.onUploadProgress&&y.upload&&y.upload.addEventListener("progress",d.onUploadProgress),(d.cancelToken||d.signal)&&(p=function(t){y&&(A(!t||t&&t.type?new l:t),y.abort(),y=null)},d.cancelToken&&d.cancelToken.subscribe(p),d.signal&&(d.signal.aborted?p():d.signal.addEventListener("abort",p))),f||(f=null);var T=u(E);T&&-1===["http","https","file"].indexOf(T)?A(new c("Unsupported protocol "+T+":",c.ERR_BAD_REQUEST,d)):y.send(f)}))},ob}var vb=L_,yb=function(t,e){H_.forEach(t,(function(n,i){i!==e&&i.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[i])}))},_b=V_(),bb=q_,Eb=Y_(),wb={"Content-Type":"application/x-www-form-urlencoded"};function Sb(t,e){!vb.isUndefined(t)&&vb.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var Tb,Cb={transitional:bb,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(Tb=gb()),Tb),transformRequest:[function(t,e){if(yb(e,"Accept"),yb(e,"Content-Type"),vb.isFormData(t)||vb.isArrayBuffer(t)||vb.isBuffer(t)||vb.isStream(t)||vb.isFile(t)||vb.isBlob(t))return t;if(vb.isArrayBufferView(t))return t.buffer;if(vb.isURLSearchParams(t))return Sb(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString();var n,i=vb.isObject(t),r=e&&e["Content-Type"];if((n=vb.isFileList(t))||i&&"multipart/form-data"===r){var s=this.env&&this.env.FormData;return Eb(n?{"files[]":t}:t,s&&new s)}return i||"application/json"===r?(Sb(e,"application/json"),function(t,e,n){if(vb.isString(t))try{return(e||JSON.parse)(t),vb.trim(t)}catch(t){if("SyntaxError"!==t.name)throw t}return(n||JSON.stringify)(t)}(t)):t}],transformResponse:[function(t){var e=this.transitional||Cb.transitional,n=e&&e.silentJSONParsing,i=e&&e.forcedJSONParsing,r=!n&&"json"===this.responseType;if(r||i&&vb.isString(t)&&t.length)try{return JSON.parse(t)}catch(t){if(r){if("SyntaxError"===t.name)throw _b.from(t,_b.ERR_BAD_RESPONSE,this,null,this.response);throw t}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:lb?cb:(lb=1,cb=null)},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};vb.forEach(["delete","get","head"],(function(t){Cb.headers[t]={}})),vb.forEach(["post","put","patch"],(function(t){Cb.headers[t]=vb.merge(wb)}));var Rb,Ib,xb=Cb,Ob=L_,Lb=xb;function Mb(){return Ib?Rb:(Ib=1,Rb=function(t){return!(!t||!t.__CANCEL__)})}var kb=L_,Nb=function(t,e,n){var i=this||Lb;return Ob.forEach(n,(function(n){t=n.call(i,t,e)})),t},Pb=Mb(),Db=xb,Bb=fb();function Ub(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Bb}var Fb,Hb,Vb=L_,jb=function(t,e){e=e||{};var n={};function i(t,e){return Vb.isPlainObject(t)&&Vb.isPlainObject(e)?Vb.merge(t,e):Vb.isPlainObject(e)?Vb.merge({},e):Vb.isArray(e)?e.slice():e}function r(n){return Vb.isUndefined(e[n])?Vb.isUndefined(t[n])?void 0:i(void 0,t[n]):i(t[n],e[n])}function s(t){if(!Vb.isUndefined(e[t]))return i(void 0,e[t])}function o(n){return Vb.isUndefined(e[n])?Vb.isUndefined(t[n])?void 0:i(void 0,t[n]):i(void 0,e[n])}function a(n){return n in e?i(t[n],e[n]):n in t?i(void 0,t[n]):void 0}var c={url:s,method:s,data:s,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a};return Vb.forEach(Object.keys(t).concat(Object.keys(e)),(function(t){var e=c[t]||r,i=e(t);Vb.isUndefined(i)&&e!==a||(n[t]=i)})),n};function Gb(){return Hb?Fb:(Hb=1,Fb={version:"0.27.2"})}var Qb=Gb().version,zb=V_(),Wb={};["object","boolean","number","function","string","symbol"].forEach((function(t,e){Wb[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}}));var Kb={};Wb.transitional=function(t,e,n){function i(t,e){return"[Axios v"+Qb+"] Transitional option '"+t+"'"+e+(n?". "+n:"")}return function(n,r,s){if(!1===t)throw new zb(i(r," has been removed"+(e?" in "+e:"")),zb.ERR_DEPRECATED);return e&&!Kb[r]&&(Kb[r]=!0,console.warn(i(r," has been deprecated since v"+e+" and will be removed in the near future"))),!t||t(n,r,s)}};var qb,Yb,$b,Xb,Jb,Zb,tE={assertOptions:function(t,e,n){if("object"!=typeof t)throw new zb("options must be an object",zb.ERR_BAD_OPTION_VALUE);for(var i=Object.keys(t),r=i.length;r-- >0;){var s=i[r],o=e[s];if(o){var a=t[s],c=void 0===a||o(a,s,t);if(!0!==c)throw new zb("option "+s+" must be "+c,zb.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new zb("Unknown option "+s,zb.ERR_BAD_OPTION)}},validators:Wb},eE=L_,nE=N_,iE=F_,rE=function(t){return Ub(t),t.headers=t.headers||{},t.data=Nb.call(t,t.data,t.headers,t.transformRequest),t.headers=kb.merge(t.headers.common||{},t.headers[t.method]||{},t.headers),kb.forEach(["delete","get","head","post","put","patch","common"],(function(e){delete t.headers[e]})),(t.adapter||Db.adapter)(t).then((function(e){return Ub(t),e.data=Nb.call(t,e.data,e.headers,t.transformResponse),e}),(function(e){return Pb(e)||(Ub(t),e&&e.response&&(e.response.data=Nb.call(t,e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)}))},sE=jb,oE=hb,aE=tE,cE=aE.validators;function lE(t){this.defaults=t,this.interceptors={request:new iE,response:new iE}}lE.prototype.request=function(t,e){"string"==typeof t?(e=e||{}).url=t:e=t||{},(e=sE(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var n=e.transitional;void 0!==n&&aE.assertOptions(n,{silentJSONParsing:cE.transitional(cE.boolean),forcedJSONParsing:cE.transitional(cE.boolean),clarifyTimeoutError:cE.transitional(cE.boolean)},!1);var i=[],r=!0;this.interceptors.request.forEach((function(t){"function"==typeof t.runWhen&&!1===t.runWhen(e)||(r=r&&t.synchronous,i.unshift(t.fulfilled,t.rejected))}));var s,o=[];if(this.interceptors.response.forEach((function(t){o.push(t.fulfilled,t.rejected)})),!r){var a=[rE,void 0];for(Array.prototype.unshift.apply(a,i),a=a.concat(o),s=Promise.resolve(e);a.length;)s=s.then(a.shift(),a.shift());return s}for(var c=e;i.length;){var l=i.shift(),u=i.shift();try{c=l(c)}catch(t){u(t);break}}try{s=rE(c)}catch(t){return Promise.reject(t)}for(;o.length;)s=s.then(o.shift(),o.shift());return s},lE.prototype.getUri=function(t){t=sE(this.defaults,t);var e=oE(t.baseURL,t.url);return nE(e,t.params,t.paramsSerializer)},eE.forEach(["delete","get","head","options"],(function(t){lE.prototype[t]=function(e,n){return this.request(sE(n||{},{method:t,url:e,data:(n||{}).data}))}})),eE.forEach(["post","put","patch"],(function(t){function e(e){return function(n,i,r){return this.request(sE(r||{},{method:t,headers:e?{"Content-Type":"multipart/form-data"}:{},url:n,data:i}))}}lE.prototype[t]=e(),lE.prototype[t+"Form"]=e(!0)}));var uE=L_,dE=h_,hE=lE,AE=jb,pE=function t(e){var n=new hE(e),i=dE(hE.prototype.request,n);return uE.extend(i,hE.prototype,n),uE.extend(i,n),i.create=function(n){return t(AE(e,n))},i}(xb);pE.Axios=hE,pE.CanceledError=fb(),pE.CancelToken=function(){if(Yb)return qb;Yb=1;var t=fb();function e(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var n;this.promise=new Promise((function(t){n=t}));var i=this;this.promise.then((function(t){if(i._listeners){var e,n=i._listeners.length;for(e=0;e<n;e++)i._listeners[e](t);i._listeners=null}})),this.promise.then=function(t){var e,n=new Promise((function(t){i.subscribe(t),e=t})).then(t);return n.cancel=function(){i.unsubscribe(e)},n},e((function(e){i.reason||(i.reason=new t(e),n(i.reason))}))}return e.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},e.prototype.subscribe=function(t){this.reason?t(this.reason):this._listeners?this._listeners.push(t):this._listeners=[t]},e.prototype.unsubscribe=function(t){if(this._listeners){var e=this._listeners.indexOf(t);-1!==e&&this._listeners.splice(e,1)}},e.source=function(){var t;return{token:new e((function(e){t=e})),cancel:t}},qb=e}(),pE.isCancel=Mb(),pE.VERSION=Gb().version,pE.toFormData=Y_(),pE.AxiosError=V_(),pE.Cancel=pE.CanceledError,pE.all=function(t){return Promise.all(t)},pE.spread=Xb?$b:(Xb=1,$b=function(t){return function(e){return t.apply(null,e)}}),pE.isAxiosError=function(){if(Zb)return Jb;Zb=1;var t=L_;return Jb=function(e){return t.isObject(e)&&!0===e.isAxiosError}}(),d_.exports=pE,d_.exports.default=pE;var fE=q(d_.exports);function mE(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function gE(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?mE(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):mE(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}let vE,yE=0,_E=0;function bE(t,e,n,i){return new ev(((r,s)=>{e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),yE+=ky(e.data)):n&&(e.data.size?yE+=e.data.size:e.data instanceof FormData?yE+=Ny(e.data):yE+=ky(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,fE.request(e).then((t=>{"string"==typeof t.data?_E+=ky(t.data):t.data instanceof ArrayBuffer||t.data instanceof Uint8Array?_E+=t.data.byteLength:_E+=ky(JSON.stringify(t.data)),i&&r({data:t.data,headers:t.headers}),r(t.data)})).catch((t=>{fE.isCancel(t)?s(new Uv(Bv.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===t.code?s(new Uv(Bv.NETWORK_TIMEOUT,t.message)):t.response?s(new Uv(Bv.NETWORK_RESPONSE_ERROR,t.response.status)):s(new Uv(Bv.NETWORK_ERROR,t.message))}))}))}async function EE(t,e){const n=new Blob([e.data],{type:"buffer"});return await bE(t,gE(gE({},e),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const wE=()=>"HTTPS"===(vE||vE||(vE=(window.location.protocol.split(":")[0]||"").toUpperCase(),vE)),SE=()=>void 0!==window.isSecureContext;function TE(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function CE(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?TE(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TE(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}var RE;!function(t){t.SET_SESSION_ID="SET_SESSION_ID",t.SET_P2P_ID="SET_P2P_id",t.SET_DC_ID="SET_DC_id",t.SET_UID="SET_UID",t.SET_PUB_ID="SET_PUB_ID",t.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",t.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",t.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",t.AVOID_JOIN_START="AVOID_JOIN_START",t.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",t.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",t.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",t.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",t.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",t.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",t.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",t.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",t.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",t.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",t.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",t.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",t.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",t.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",t.RESET_KEY_METRICS="RESET_KEY_METRICS",t.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",t.SET_USE_P2P="SET_USE_P2P"}(RE||(RE={}));class IE{constructor(t,e,n,i){ih(this,"state",void 0),this.state={codec:t,audioCodec:e,mode:n,clientId:i,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(t){this.state=function(t,e){switch(e.type){case RE.SET_SESSION_ID:return CE(CE({},t),{},{sessionId:e.sessionId});case RE.SET_P2P_ID:return CE(CE({},t),{},{p2pId:e.p2pId});case RE.SET_UID:return CE(CE({},t),{},{uid:e.uid});case RE.SET_PUB_ID:return CE(CE({},t),{},{pubId:e.pubId});case RE.KEY_METRIC_CLIENT_CREATED:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{clientCreated:e.metric})});case RE.KEY_METRIC_JOIN_START:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{joinStart:e.metric})});case RE.AVOID_JOIN_START:return CE(CE({},t),{},{avoidJoinStart:e.avoidJoinStart});case RE.KEY_METRIC_JOIN_END:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{joinEnd:e.metric})});case RE.KEY_METRIC_REQUEST_AP_START:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{requestAPStart:e.metric})});case RE.KEY_METRIC_REQUEST_AP_END:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{requestAPEnd:e.metric})});case RE.KEY_METRIC_JOIN_GATEWAY_START:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{joinGatewayStart:e.metric})});case RE.KEY_METRIC_JOIN_GATEWAY_END:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{joinGatewayEnd:e.metric})});case RE.KEY_METRIC_PEER_CONNECTION_START:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{peerConnectionStart:e.metric})});case RE.KEY_METRIC_PEER_CONNECTION_END:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{peerConnectionEnd:e.metric})});case RE.KEY_METRIC_DESCRIPTION_START:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{descriptionStart:e.metric})});case RE.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{signalChannelOpen:e.metric})});case RE.KEY_METRIC_ICE_CONNECTION_END:return CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{iceConnectionEnd:e.metric})});case RE.KEY_METRIC_PUBLISH:{const n=t.keyMetrics.publish,i=n.findIndex((t=>t.trackId===e.metric.trackId));return-1!==i?(n[i]=CE(CE({},n[i]),e.metric),CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{publish:[...n]})})):CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{publish:[...t.keyMetrics.publish,e.metric]})})}case RE.KEY_METRIC_SUBSCRIBE:{const n=t.keyMetrics.subscribe,i=n.findIndex((t=>t.userId===e.metric.userId&&t.type===e.metric.type));return-1!==i?(n[i]=CE(CE({},n[i]),e.metric),CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{subscribe:[...n]})})):CE(CE({},t),{},{keyMetrics:CE(CE({},t.keyMetrics),{},{subscribe:[...t.keyMetrics.subscribe,e.metric]})})}case RE.SET_CLOUD_PROXY_SERVER_MODE:return t.cloudProxyServerMode=e.mode,t;case RE.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof e.index?t.joinChannelServiceRecords=[...t.joinChannelServiceRecords,e.record]:(t.joinChannelServiceRecords[e.index]=CE(CE({},t.joinChannelServiceRecords[e.index]),e.record),t.joinChannelServiceRecords=[...t.joinChannelServiceRecords]),t;case RE.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return t.joinChannelServiceRecords=[],t;case RE.RESET_KEY_METRICS:return t.keyMetrics={publish:[],subscribe:[]},t;case RE.SET_USE_DATACHANNEL:return CE(CE({},t),{},{useDataChannel:e.val});case RE.SET_USE_P2P:return CE(CE({},t),{},{useP2P:e.val});default:return t}}(this.state,t)}set sessionId(t){this.dispatch({type:RE.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}set codec(t){this.state.codec=t}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:RE.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:RE.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:RE.SET_UID,uid:t})}get uid(){return this.state.uid}set pubId(t){this.dispatch({type:RE.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:RE.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:RE.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}set useP2P(t){this.dispatch({type:RE.SET_USE_P2P,val:t})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:RE.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:RE.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:RE.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:RE.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:RE.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:RE.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:RE.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:RE.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:RE.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:RE.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:RE.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:RE.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,e,n,i){this.dispatch({type:RE.KEY_METRIC_PUBLISH,metric:CE(CE({trackId:t,type:e},n&&{publishStart:n}),i&&{publishEnd:i})})}subscribe(t,e,n,i,r,s,o){this.dispatch({type:RE.KEY_METRIC_SUBSCRIBE,metric:CE(CE(CE(CE(CE({userId:t,type:e},n&&{subscribeStart:n}),i&&{subscribeEnd:i}),r&&{firstFrame:r}),s&&{streamAdded:s}),o&&{firstDecoded:o})})}massSubscribe(t,e,n,i){t.forEach((t=>{this.dispatch({type:RE.KEY_METRIC_SUBSCRIBE,metric:CE(CE(CE({userId:t.userId,type:t.type},e&&{subscribeStart:e}),n&&{subscribeEnd:n}),i&&{firstFrame:i})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,e){"gateway"===t.service&&Array.isArray(t.urls)&&(t.urls=t.urls.map((t=>t.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof e?(this.dispatch({type:RE.RECORD_JOIN_CHANNEL_SERVICE,record:CE(CE({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(e<0||e>=this.state.joinChannelServiceRecords.length||this.dispatch({type:RE.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:e}),e)}catch(t){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:RE.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:RE.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(t){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:RE.AVOID_JOIN_START,avoidJoinStart:t})}}const xE=function(t){if(t.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return t;const e=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(e&&e[1]&&e[2]){const t=e[1],n=e[2];return"".concat(t,".").concat(n)}const n=t.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const t=n[1],e=n[2];return"".concat(t,".").concat(100*(Number(e)+1))}return"4.0.0.999"}("4.19.3"),OE=function(){try{return!0===JSON.parse("true")}catch(t){return!0}}(),LE="v4.19.3-0-gb2ca8ca7(11/2/2023, 2:57:33 PM)",ME={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:100,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[]};function kE(t,e,n){var i,r;kr(i=Object.keys(ME)).call(i,t)&&(!n&&kr(r=Object.keys(PE)).call(r,t)||(ME[t]=e))}function NE(t){return ME[t]}const PE={};var DE,BE;!function(t){t.h264="h264",t.h265="h265",t.vp8="vp8",t.vp9="vp9",t.av1="av1"}(DE||(DE={})),function(t){t.opus="opus",t.pcma="pcma",t.pcmu="pcmu",t.g722="g722"}(BE||(BE={}));const UE=new class extends ny{reportLogUploadError(t){this.emit("REPORT_LOG_UPLOAD",t)}};class FE{constructor(t){ih(this,"logger",void 0),ih(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logger.debug(...this.prefixLists,...e)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logger.info(...this.prefixLists,...e)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logger.warning(...this.prefixLists,...e)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];this.logger.error(...this.prefixLists,...e)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}function HE(){const t=new Date;return t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}function VE(){const t=new Date,e=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return e?(null==e?void 0:e[0])+":"+t.getUTCMilliseconds():t.toTimeString().split(" ")[0]+":"+t.getMilliseconds()}const jE={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},GE=Date.now(),QE=t=>{for(const e in jE)if(Object.prototype.hasOwnProperty.call(jE,e)&&jE[e]===t)return e;return"DEFAULT"},zE=new class{constructor(){ih(this,"proxyServerURL",void 0),ih(this,"logLevel",jE.DEBUG),ih(this,"uploadState","collecting"),ih(this,"uploadLogWaitingList",[]),ih(this,"uploadLogUploadingList",[]),ih(this,"uploadErrorCount",0),ih(this,"currentLogID",0),ih(this,"url",void 0),ih(this,"extLog",((t,e)=>{this.appendLogToWaitingList(t,...e)}))}debug(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[jE.DEBUG].concat(e);this.log.apply(this,i)}info(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[jE.INFO].concat(e);this.log.apply(this,i)}warning(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[jE.WARNING].concat(e);this.log.apply(this,i)}warn(){this.warning(...arguments)}error(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[jE.ERROR].concat(e);this.log.apply(this,i)}upload(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const i=[jE.DEBUG].concat(e);this.uploadLog.apply(this,i)}setLogLevel(t){t=Math.min(Math.max(0,t),4),this.logLevel=t}enableLogUpload(){kE("UPLOAD_LOG",!0)}disableLogUpload(){kE("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(t){this.proxyServerURL=t}prefix(t){return new FE(this).prefix(t)}log(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-GE<100)return void setTimeout((()=>{this.log(...e)}),Date.now()-GE);const i=Math.max(0,Math.min(4,e[0]));if(e[0]=HE()+" Agora-SDK [".concat(QE(i),"]:"),this.appendLogToWaitingList(i,...e),i<this.logLevel)return;const r=HE()+" %cAgora-SDK [".concat(QE(i),"]:");let s=[];if(!NE("USE_NEW_LOG"))switch(i){case jE.DEBUG:s=[r,"color: #64B5F6;"].concat(e.slice(1)),console.log.apply(console,s);break;case jE.INFO:s=[r,"color: #1E88E5; font-weight: bold;"].concat(e.slice(1)),console.log.apply(console,s);break;case jE.WARNING:s=[r,"color: #FB8C00; font-weight: bold;"].concat(e.slice(1)),console.warn.apply(console,s);break;case jE.ERROR:s=[r,"color: #B00020; font-weight: bold;"].concat(e.slice(1)),console.error.apply(console,s)}}uploadLog(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(Date.now()-GE<100)return void setTimeout((()=>{this.uploadLog(...e)}),Date.now()-GE);const i=Math.max(0,Math.min(4,e[0]));e[0]=HE()+" Agora-SDK [".concat(QE(i),"]:"),this.appendLogToWaitingList(i,...e)}appendLogToWaitingList(t){if(!NE("UPLOAD_LOG"))return;for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];Array.isArray(n[0])?n[0][0]=VE()+" Agora-SDK [".concat(QE(t),"]:"):n[0]=VE()+" Agora-SDK [".concat(QE(t),"]:");let r="";n.forEach((t=>{"object"==typeof t&&(t=JSON.stringify(t)),r+="".concat(t," ")})),this.uploadLogWaitingList.push({payload_str:r,log_level:t,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const t=this.uploadLogUploadingList,e={sdk_version:xE,process_id:NE("PROCESS_ID"),payload:JSON.stringify(t)};return $y((async()=>{const t=await fE.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(NE("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(NE("LOG_UPLOAD_SERVER"),"/upload/v1")),e,{responseType:"text"});if("OK"!==t.data){const e=new Error("unexpected upload log response");throw e.response=t,e}}),(()=>(this.uploadLogUploadingList=[],!1)),(t=>(t.response?UE.reportLogUploadError({status:t.response.status,data:t.response.data,headers:t.response.headers,message:t.message}):t.request?UE.reportLogUploadError({status:t.request.status,message:t.message}):UE.reportLogUploadError({status:-1,message:t.message}),!0)),{timeout:NE("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:NE("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,NE("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),NE("UPLOAD_LOG_INTERVAL"))})).catch((t=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),NE("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),NE("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}};var WE,KE;function qE(t){return Gv(t.reportId,"params.reportId",0,100,!1),Gv(t.category,"params.category",0,100,!1),Gv(t.event,"params.event",0,100,!1),Gv(t.label,"params.label",0,100,!1),Vv(t.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}!function(t){t.FREE="free",t.UPLOADING="uploading"}(WE||(WE={})),function(t){t[t.MISC=0]="MISC",t[t.INTERNAL_EVENT=1]="INTERNAL_EVENT",t[t.PUBLIC_EVENT=2]="PUBLIC_EVENT",t[t.WEB_EVENT=3]="WEB_EVENT",t[t.INTERNAL_API=4]="INTERNAL_API",t[t.WEB_API=5]="WEB_API",t[t.PUBLIC_API=6]="PUBLIC_API"}(KE||(KE={}));const YE={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var $E,XE,JE,ZE;function tw(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ew(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?tw(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):tw(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}!function(t){t.PUBLISH="publish",t.SUBSCRIBE="subscribe",t.WS_COMPRESSOR_INIT="ws_compressor_init",t.SESSION_INIT="session_init",t.JOIN_CHOOSE_SERVER="join_choose_server",t.REQ_USER_ACCOUNT="req_user_account",t.JOIN_GATEWAY="join_gateway",t.REJOIN_GATEWAY="rejoin_gateway",t.STREAM_SWITCH="stream_switch",t.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",t.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",t.FIRST_VIDEO_RECEIVED="first_video_received",t.FIRST_AUDIO_RECEIVED="first_audio_received",t.FIRST_VIDEO_DECODE="first_video_decode",t.FIRST_AUDIO_DECODE="first_audio_decode",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_UPDATE_STREAM="on_update_stream",t.ON_REMOVE_STREAM="on_remove_stream",t.USER_ANALYTICS="req_user_analytics",t.PC_STATS="pc_stats"}($E||($E={})),function(t){t.SESSION="io.agora.pb.Wrtc.Session",t.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",t.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",t.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",t.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",t.PUBLISH="io.agora.pb.Wrtc.Publish",t.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",t.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",t.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",t.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",t.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",t.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",t.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",t.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",t.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",t.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",t.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",t.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",t.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",t.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",t.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",t.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",t.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",t.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",t.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",t.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",t.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",t.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",t.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",t.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",t.PC_STATS="io.agora.pb.Wrtc.PCStats"}(XE||(XE={})),function(t){t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(JE||(JE={})),function(t){t[t.SESSION=26]="SESSION",t[t.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",t[t.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",t[t.JOIN_GATEWAY=28]="JOIN_GATEWAY",t[t.PUBLISH=30]="PUBLISH",t[t.SUBSCRIBE=29]="SUBSCRIBE",t[t.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",t[t.STREAM_SWITCH=32]="STREAM_SWITCH",t[t.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",t[t.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",t[t.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",t[t.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",t[t.API_INVOKE=41]="API_INVOKE",t[t.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",t[t.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",t[t.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",t[t.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",t[t.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",t[t.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",t[t.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",t[t.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",t[t.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",t[t.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",t[t.WORKER_EVENT=156]="WORKER_EVENT",t[t.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",t[t.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",t[t.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",t[t.USER_ANALYTICS=1e4]="USER_ANALYTICS",t[t.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(ZE||(ZE={}));class nw{constructor(){ih(this,"baseInfoMap",new Map),ih(this,"proxyServer",void 0),ih(this,"eventUploadTimer",void 0),ih(this,"setSessionIdTimer",void 0),ih(this,"url",void 0),ih(this,"backupUrl",void 0),ih(this,"_appId",void 0),ih(this,"keyEventUploadPendingItems",[]),ih(this,"normalEventUploadPendingItems",[]),ih(this,"apiInvokeUploadPendingItems",[]),ih(this,"apiInvokeCount",0),ih(this,"ltsList",[]),ih(this,"lastSendNormalEventTime",Date.now()),ih(this,"customReportCounterTimer",void 0),ih(this,"customReportCount",0),ih(this,"extApiInvoke",(async t=>{for(const e of t){const t=ew(ew({},e),{},{sid:null,invokeId:++this.apiInvokeCount,tag:oy.TRACER});this.sendApiInvoke(t)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),NE("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),NE("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(t){return this.baseInfoMap.get(t)}adjustSessionStartTime(t){if(!this.baseInfoMap.has(t)&&!this.baseInfoMap.get(t))return void zE.error("adjust session ".concat(t," start time, sid is not exist or info is undefined"));const e=this.baseInfoMap.get(t),n=Date.now(),i=e.startTime;e.startTime=n,zE.debug("rewrite session ".concat(t," startTime: ").concat(n," , ").concat(n-i,"ms")),this.baseInfoMap.set(t,e)}setAppId(t){this._appId=t}reportApiInvoke(t,e,n){e.timeout=e.timeout||6e4,e.reportResult=void 0===e.reportResult||e.reportResult;const i=Date.now();this.apiInvokeCount+=1;const r=this.apiInvokeCount,s=()=>({tag:e.tag,invokeId:r,sid:t,name:e.name,apiInvokeTime:i,options:e.options,states:e.states||null}),o=!!NE("SHOW_REPORT_INVOKER_LOG");o&&zE.info("".concat(e.name," start"),e.options);let a=!1;Dy(e.timeout).then((()=>{a||(this.sendApiInvoke(ew(ew({},s()),{},{error:Bv.API_INVOKE_TIMEOUT,success:!1})),zE.debug("".concat(e.name," timeout")))}));const c=new Uv(Bv.UNEXPECTED_ERROR,"".concat(e.name,": this api invoke is end"));return{onSuccess:t=>{const i=()=>{if(a)throw c;return a=!0,this.sendApiInvoke(ew(ew({},s()),{},{success:!0},e.reportResult&&{result:t})),o&&zE.info("".concat(e.name," onSuccess")),t};return n?Vy(i,e.name+"Success",n,(()=>a=!0)):i()},onError:t=>{const i=()=>{if(a)throw t;a=!0,this.sendApiInvoke(ew(ew({},s()),{},{success:!1,error:t})),o&&zE.info("".concat(e.name," onFailure"),t.toString())};return n?Vy(i,e.name+"Error",n,(()=>a=!0)):i()}}}sessionInit(t,e){if(this.baseInfoMap.has(t))return;const n=Date.now(),i=this.createBaseInfo(t,n);i.cname=e.cname;const r=Object.assign({},{willUploadConsoleLog:NE("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:OE?"global":"oversea",areas:NE("AREAS")&&NE("AREAS").join(",")},e.extend),s=Date.now(),o=ew(ew({},i),{},{eventType:$E.SESSION_INIT,appid:e.appid,browser:navigator.userAgent,build:LE,lts:s,elapse:s-n,extend:JSON.stringify(r),mode:e.mode,process:NE("PROCESS_ID"),appType:NE("APP_TYPE"),success:!0,version:xE});this.send({type:XE.SESSION,data:o},!0)}joinChooseServer(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew({},i),{},{eventType:$E.JOIN_CHOOSE_SERVER,lts:r,eventElapse:r-e.lts,chooseServerAddr:e.csAddr,errorCode:e.ec,elapse:r-n.startTime,success:e.succ,chooseServerAddrList:JSON.stringify(e.serverList),uid:e.uid?parseInt(e.uid):null,cid:e.cid?parseInt(e.cid):null,chooseServerIp:e.csIp||"",opid:e.opid,unilbsServerIds:e.unilbsServerIds,extend:e.extend||void 0,isHttp3:e.isHttp3});this.send({type:XE.JOIN_CHOOSE_SERVER,data:s},!0)}reqUserAccount(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew({},i),{},{eventType:$E.REQ_USER_ACCOUNT,lts:r,success:e.success,serverAddress:e.serverAddr,stringUid:e.stringUid,uid:e.uid,errorCode:e.errorCode,elapse:r-n.startTime,eventElapse:r-e.lts,extend:JSON.stringify(e.extend)});this.send({type:XE.REQ_USER_ACCOUNT,data:s},!0)}joinGateway(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info;e.vid&&(i.vid=e.vid),i.uid=e.uid,i.cid=e.cid;const r=Date.now(),{firstSuccess:s,avoidJoinStartTime:o,isProxy:a,addr:c}=e,l=r-(s&&o?o:n.startTime),u=ew(ew({},i),{},{eventType:$E.JOIN_GATEWAY,lts:r,gatewayAddr:e.addr,success:e.succ,errorCode:e.ec,elapse:l,eventElapse:r-e.lts,firstSuccess:s,signalChannel:e.signalChannel}),d=u.success?1:0;if(e.succ&&(n.lastJoinSuccessTime=r),s)this.send({type:XE.JOIN_GATEWAY,data:u},!0);else{let t;if(c)if(a){const e=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=c.match(/p=[0-9]{1,6}/g);t={isSuccess:d,gatewayIp:e&&e.length?e[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:a?1:0}}else{const e=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=c.match(/(:|p=)[0-9]{1,6}/g);t={isSuccess:d,gatewayIp:e&&e.length?e[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(/:|p=/g)[1]:"",isProxy:a?1:0}}else t={isSuccess:d,gatewayIp:"",port:"",isProxy:a?1:0};delete u.success,delete u.eventType,delete u.firstSuccess,u.vid=Number(u.vid);const e=Object.assign({},u,t,{eventType:$E.REJOIN_GATEWAY});this.send({type:XE.RE_JOIN_GATEWAY,data:e},!0)}}joinChannelTimeout(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=Date.now(),r=ew(ew({},n.info),{},{lts:i,timeout:e,elapse:i-n.startTime});this.send({type:XE.JOIN_CHANNEL_TIMEOUT,data:r},!0)}publish(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew({},i),{},{eventType:$E.PUBLISH,lts:r,eventElapse:e.eventElapse,elapse:r-n.startTime,success:e.succ,errorCode:e.ec,videoName:e.videoName,audioName:e.audioName,screenName:e.screenName,screenshare:e.screenshare,audio:e.audio,video:e.video,p2pid:e.p2pid,publishRequestid:e.publishRequestid});this.send({type:XE.PUBLISH,data:s},!0)}subscribe(t,e,n){const i=this.baseInfoMap.get(t);if(!i)return;const r=i.info,s=Date.now(),o=ew(ew({},r),{},{eventType:$E.SUBSCRIBE,lts:s,eventElapse:e.eventElapse,elapse:s-i.startTime,success:e.succ,errorCode:e.ec,video:e.video,audio:e.audio,subscribeRequestid:e.subscribeRequestid,p2pid:e.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof e.peerid?o.peerSuid=e.peerid:o.peer=e.peerid,this.send({type:XE.SUBSCRIBE,data:o},!0)}wsCompressorInit(t){var e;const n=[...dh(e=this.baseInfoMap).call(e)],i=n.length?n[0]:"UnableToGetSid",r=this.baseInfoMap.get(i);if(!r)return;const s=r.info,o=Date.now(),a=ew(ew({},s),{},{eventType:$E.WS_COMPRESSOR_INIT,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,status:t.status?1:2});this.send({type:XE.WS_COMPRESSOR_INIT,data:a},!0)}firstRemoteVideoDecode(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,o=Date.now(),a=ew(ew(ew({},s),i),{},{elapse:o-r.startTime,eventType:e,lts:o,firstDecodeFrame:Math.max(o-r.startTime,0),apEnd:Math.max(i.apEnd-r.startTime,0),apStart:Math.max(i.apStart-r.startTime,0),joinGwEnd:Math.max(i.joinGwEnd-r.startTime,0),joinGwStart:Math.max(i.joinGwStart-r.startTime,0),pcEnd:Math.max(i.pcEnd-r.startTime,0),pcStart:Math.max(i.pcStart-r.startTime,0),subscriberEnd:Math.max(i.subscriberEnd-r.startTime,0),subscriberStart:Math.max(i.subscriberStart-r.startTime,0),videoAddNotify:Math.max(i.videoAddNotify-r.startTime,0)});this.send({type:n,data:a},!0)}firstRemoteFrame(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,o=Date.now(),a=ew(ew(ew({},s),i),{},{elapse:o-r.startTime,eventType:e,lts:o});this.send({type:n,data:a},!0)}pcStats(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew(ew({},i),e),{},{vid:void 0===i.vid?0:Number(i.vid),elapse:r-n.startTime,eventType:$E.PC_STATS,lts:r});this.send({type:XE.PC_STATS,data:s},!0)}updateRemoteRTPCapabilities(t,e){this.reportApiInvoke(t,{name:"Client.updateRemoteRTPCapabilities",options:e,tag:oy.TRACER}).onSuccess()}onGatewayStream(t,e,n,i){const r=this.baseInfoMap.get(t);if(!r)return;const s=r.info,o=Date.now(),a=ew(ew(ew({},s),i),{},{eventType:e,lts:o});this.send({type:n,data:a},!0)}streamSwitch(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew({},i),{},{eventType:$E.STREAM_SWITCH,lts:r,isDual:e.isdual,elapse:r-n.startTime,success:e.succ});this.send({type:XE.STREAM_SWITCH,data:s},!0)}requestProxyAppCenter(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew({},i),{},{eventType:$E.REQUEST_PROXY_APPCENTER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,APAddr:e.APAddr,workerManagerList:e.workerManagerList,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:XE.REQUEST_PROXY_APPCENTER,data:s},!0)}requestProxyWorkerManager(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew({},i),{},{eventType:$E.REQUEST_PROXY_WORKER_MANAGER,lts:r,eventElapse:r-e.lts,elapse:r-n.startTime,workerManagerAddr:e.workerManagerAddr,response:e.response,errorCode:e.ec,success:e.succ});this.send({type:XE.REQUEST_PROXY_WORKER_MANAGER,data:s},!0)}setProxyServer(t){this.proxyServer=t,t?zE.debug("reportProxyServerurl: ".concat(t)):zE.debug("disable reportProxyServerurl: ".concat(t))}peerPublishStatus(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew({},i),{},{subscribeElapse:e.subscribeElapse,peer:e.peer,peerPublishDuration:Math.max(e.audioPublishDuration,e.videoPublishDuration),audiotag:e.audioPublishDuration>0?1:-1,videotag:e.videoPublishDuration>0?1:-1,lts:r,elapse:r-n.startTime,joinChannelSuccessElapse:r-(n.lastJoinSuccessTime||r),peerPublishDurationVideo:e.videoPublishDuration,peerPublishDurationAudio:e.audioPublishDuration});this.send({type:XE.PEER_PUBLISH_STATUS,data:s},!0)}workerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=function(t,e,n){const i=t[e];if(!i||"string"!=typeof i)return[t];t[e]="";const r=ky(JSON.stringify(t));let s=0;const o=[];let a=0;for(let c=0;c<i.length;c++)a+=i.charCodeAt(c)<=127?1:3,a<=n-r||(o[o.length]=wy(wy({},t),{},{[e]:i.substring(s,c)}),s=c,a=i.charCodeAt(c)<=127?1:3);return s!==i.length-1&&(o[o.length]=wy(wy({},t),{},{[e]:i.substring(s)})),o}(ew(ew(ew({},i),e),{},{elapse:r-n.startTime,lts:r,productType:"WebRTC"}),"payload",1300);s.forEach((t=>this.send({type:XE.WORKER_EVENT,data:t},!0)))}apworkerEvent(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew(ew({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:XE.AP_WORKER_EVENT,data:s},!0)}joinWebProxyAP(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew(ew({},i),e),{},{elapse:r-n.startTime,lts:r,extend:e.extend||void 0});this.send({type:XE.JOIN_WEB_PROXY_AP,data:s},!0)}WebSocketQuit(t,e){const n=this.baseInfoMap.get(t);if(!n)return;const i=n.info,r=Date.now(),s=ew(ew(ew({},i),e),{},{elapse:r-n.startTime,lts:r});this.send({type:XE.WEBSOCKET_QUIT,data:s},!0)}async sendCustomReportMessage(t,e){if(this.customReportCount+=e.length,this.customReportCount>NE("CUSTOM_REPORT_LIMIT"))throw new Uv(Bv.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),i=e.map((e=>({type:XE.USER_ANALYTICS,data:ew(ew({sid:t},e),{},{lts:n})})));try{NE("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(i):await this.postDataToStatsCollector(i)}catch(t){throw zE.error("send custom report message failed",t.toString()),new Uv(Bv.CUSTOM_REPORT_SEND_FAILED,t.message)}}sendApiInvoke(t){const e=NE("NOT_REPORT_EVENT");if(t.tag&&kr(e)&&kr(e).call(e,t.tag))return!1;if(null===t.sid)return this.apiInvokeUploadPendingItems.push(t),!1;const n=this.baseInfoMap.get(t.sid);if(!n)return this.apiInvokeUploadPendingItems.push(t),!1;const{cname:i,uid:r,cid:s}=n.info;let o;if(t.lts=t.lts||Date.now(),t.error)if(t.error instanceof Uv){const{code:e,message:n}=t.error;o=e||n||t.error.toString()}else o=t.error.toString();const a={invokeId:t.invokeId,sid:t.sid,cname:i,cid:s,uid:r,lts:t.lts,success:t.success,elapse:t.lts-n.startTime,execElapse:t.lts-t.apiInvokeTime,apiName:t.name,options:t.options?JSON.stringify(t.options):void 0,execStates:t.states?JSON.stringify(t.states):void 0,execResult:t.result?JSON.stringify(t.result):void 0,errorCode:t.error?o:void 0,errorMsg:t.error?JSON.stringify(t.error):void 0};return this.send({type:XE.API_INVOKE,data:a},!1),!0}appendSessionId(){nw.__CLIENT_LIST__.forEach((t=>{if(t._sessionId){const e=this.apiInvokeUploadPendingItems.length;for(let n=0;n<e;n++){const e=this.apiInvokeUploadPendingItems.shift();e&&(e.sid=t._sessionId,this.sendApiInvoke(Object.assign({},e)))}}}))}send(t,e){if(e)return this.keyEventUploadPendingItems.push(t),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(t),this.normalEventUploadPendingItems.length>NE("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(t,e){const n=[],i=[];for(;t.length;){const e=t.shift();n.length<20?n.push(e):i.push(e)}t.push(...i);for(const t of[...n]){var r;-1!==this.ltsList.indexOf(t.data.lts)?(t.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(t.data.lts)):(this.ltsList.push(t.data.lts),Jh(r=this.ltsList).call(r,((t,e)=>t-e)))}return e||(this.lastSendNormalEventTime=Date.now()),NE("ENABLE_EVENT_REPORT")?(n.length&&(NE("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((t=>n=>{NE("EVENT_REPORT_RETRY")&&(e?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(t):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(t),this.normalEventUploadPendingItems.length>NE("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-NE("NORMAL_EVENT_QUEUE_CAPACITY")),zE.warning("report: drop normal events"))))})(n)),t):t}async postDataToStatsCollector2(t){by.networkState===dy.OFFLINE&&await ev.race([by.onlineWaiter,Dy(2*qy.maxRetryTimeout)]);const e=t=>{let e=new Uint8Array;return t.forEach((t=>{const n=Jv(JSON.stringify(t.data)),i=new ArrayBuffer(5),r=(t=>{let e=0;return Object.entries(XE).forEach((n=>{let[i,r]=n;r===t.type&&(e=EventNameToID[i])})),e})(t),s=new DataView(i);s.setUint16(0,n.byteLength,!0),s.setUint8(2,255&r),s.setUint8(3,r>>>8&255),s.setUint8(4,r>>>16&255),e=Zv(e,new Uint8Array(i)),e=Zv(e,n)})),e},n="event";let i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(NE("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(NE("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let r=0;r<2;r+=1){1===r&&(i=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(NE("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(NE("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await bE(i,{timeout:1e4,data:e(t),headers:ew(ew({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(t){if(1===r)throw t;continue}return}}async postDataToStatsCollector(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:t.map((t=>JSON.stringify(t))),vid:(t=>{const e=t&&t.data.sid&&this.baseInfoMap.get(t.data.sid);return e&&e.info.vid&&+e.info.vid||0})(t[0])};by.networkState===dy.OFFLINE&&await ev.race([by.onlineWaiter,Dy(2*qy.maxRetryTimeout)]);const i=e?"/events/proto-raws":"/events/messages";let r=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(NE("EVENT_REPORT_DOMAIN"),"&p=").concat(NE("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(NE("EVENT_REPORT_DOMAIN"),":").concat(NE("STATS_COLLECTOR_PORT")).concat(i));for(let t=0;t<2;t+=1){1===t&&(r=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(NE("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(NE("STATS_COLLECTOR_PORT"),"&d=").concat(i):"https://".concat(NE("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(NE("STATS_COLLECTOR_PORT")).concat(i)));try{e?await EE(r,{timeout:1e4,data:n}):await bE(r,{timeout:1e4,data:n})}catch(e){if(1===t)throw e;continue}return}}createBaseInfo(t,e){const n=Object.assign({},YE);return n.sid=t,this.baseInfoMap.set(t,{info:n,startTime:e}),n}reportResourceTiming(t,e){const n=performance.getEntriesByName(t),i=n[n.length-1];i&&this.reportApiInvoke(e,{name:"Client.resourceTiming",options:i,tag:oy.TRACER}).onSuccess()}}function iw(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(e,n,i){const r=i.value;if("function"==typeof r){const s=t.className||e.__className__||("AgoraRTCClient"===e.constructor.name?"Client":e.constructor.name);i.value=function(){for(var e=arguments.length,i=new Array(e),o=0;o<e;o++)i[o]=arguments[o];let a=i;if(t.argsMap)try{a=t.argsMap(this,...i)}catch(t){zE.warning(t),a=[]}try{JSON.stringify(a)}catch(t){zE.warning("arguments for method ".concat(s,".").concat(String(n)," not serializable for apiInvoke.")),a=[]}const c=(t.report||rw).reportApiInvoke(this._sessionId||null,{name:"".concat(s,".").concat(String(n)),options:a,tag:oy.TRACER,reportResult:t.reportResult},t.throttleTime);try{const e=r.apply(this,i);return e instanceof ev?e.then((e=>(c.onSuccess(t.reportResult&&e),e))).catch((t=>{throw c.onError(t),t})):(c.onSuccess(t.reportResult&&e),e)}catch(t){throw c.onError(t),t}}}return i}}ih(nw,"__CLIENT_LIST__",[]);const rw=new nw;UE.on("REPORT_LOG_UPLOAD",(t=>{t.networkState=by.networkState,rw.reportApiInvoke(null,{name:"logUploadError",options:t,tag:oy.TRACER})}));const sw=["CHINA","GLOBAL"],ow=function(){const t="us".concat("erna","me"),e="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const i=n.join(""),r=[];for(let t=0;t<6;t++)r.push("1");const s=r.join(""),o={};return o[t]=i,o[e]=s,Object.assign(o,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=ow,OE||(ME.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],ME.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],ME.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],ME.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ME.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],ME.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],ME.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",ME.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",ME.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",ME.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",ME.AREAS=["NORTH_AMERICA","OVERSEA"]);const aw=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],cw=[];function lw(t,e){return!!e&&cw.some((n=>n.uid===t&&n.channelName===e))}nw.__CLIENT_LIST__=cw;var uw,dw,hw,Aw,pw,fw,mw,gw,vw,yw,_w,bw,Ew,ww,Sw,Tw,Cw,Rw=er("Array").values,Iw=mr,xw=rn,Ow=ft,Lw=Rw,Mw=Array.prototype,kw={DOMTokenList:!0,NodeList:!0},Nw=q((function(t){var e=t.values;return t===Mw||Ow(Mw,t)&&e===Mw.values||xw(kw,Iw(t))?Lw:e}));function Pw(t,e,n,i){var r,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(r=t[a])&&(o=(s<3?r(o):s>3?r(e,n,o):r(e,n))||o);return s>3&&o&&Object.defineProperty(e,n,o),o}function Dw(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}!function(t){t.L1T1="L1T1",t.L1T2="L1T2",t.L1T3="L1T3",t.L2T1_KEY="L2T1_KEY",t.L2T2_KEY="L2T2_KEY",t.L2T3_KEY="L2T3_KEY",t.L3T1_KEY="L3T1_KEY",t.L3T2_KEY="L3T2_KEY",t.L3T3_KEY="L3T3_KEY"}(uw||(uw={})),function(t){t.CERTIFICATE="certificate",t.CODEC="codec",t.CANDIDATE_PAIR="candidate-pair",t.LOCAL_CANDIDATE="local-candidate",t.REMOTE_CANDIDATE="remote-candidate",t.INBOUND="inbound-rtp",t.TRACK="track",t.OUTBOUND="outbound-rtp",t.PC="peer-connection",t.REMOTE_INBOUND="remote-inbound-rtp",t.REMOTE_OUTBOUND="remote-outbound-rtp",t.TRANSPORT="transport",t.CSRC="csrc",t.DATA_CHANNEL="data-channel",t.STREAM="stream",t.SENDER="sender",t.RECEIVER="receiver"}(dw||(dw={})),function(t){t[t.ACCESS_POINT=101]="ACCESS_POINT",t[t.UNILBS=201]="UNILBS",t[t.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(hw||(hw={})),function(t){t[t.IIIEGAL_APPID=1]="IIIEGAL_APPID",t[t.IIIEGAL_UID=2]="IIIEGAL_UID",t[t.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Aw||(Aw={})),function(t){t[t.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",t[t.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",t[t.INTERNAL_ERROR=8]="INTERNAL_ERROR",t[t.NO_AUTHORIZED=9]="NO_AUTHORIZED",t[t.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",t[t.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",t[t.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",t[t.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",t[t.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",t[t.USER_OVERLOAD=16]="USER_OVERLOAD",t[t.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",t[t.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(pw||(pw={})),function(t){t[t.NO_FLAG_SET=100]="NO_FLAG_SET",t[t.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",t[t.INVALID_FALG_SET=102]="INVALID_FALG_SET",t[t.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",t[t.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",t[t.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",t[t.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",t[t.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",t[t.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",t[t.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",t[t.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",t[t.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",t[t.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",t[t.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",t[t.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",t[t.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",t[t.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",t[t.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",t[t.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(fw||(fw={})),function(t){t[t.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",t[t.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",t[t.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",t[t.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",t[t.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",t[t.K_TICKET_INVALID=7]="K_TICKET_INVALID",t[t.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",t[t.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",t[t.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",t[t.K_UID_BANNED=14]="K_UID_BANNED",t[t.K_IP_BANNED=15]="K_IP_BANNED",t[t.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",t[t.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",t[t.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",t[t.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",t[t.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",t[t.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",t[t.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",t[t.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",t[t.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",t[t.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",t[t.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",t[t.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",t[t.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",t[t.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",t[t.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",t[t.ERR_INVALID_UID=117]="ERR_INVALID_UID",t[t.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",t[t.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",t[t.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",t[t.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",t[t.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",t[t.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",t[t.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",t[t.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",t[t.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",t[t.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",t[t.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",t[t.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",t[t.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",t[t.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",t[t.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",t[t.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",t[t.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",t[t.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",t[t.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",t[t.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",t[t.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",t[t.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",t[t.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",t[t.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",t[t.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",t[t.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",t[t.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",t[t.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",t[t.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",t[t.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",t[t.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",t[t.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",t[t.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",t[t.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",t[t.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",t[t.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",t[t.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(mw||(mw={})),function(t){t.CONNECTING="connecting",t.CONNECTED="connected",t.RECONNECTING="reconnecting",t.CLOSED="closed"}(gw||(gw={})),function(t){t.WS_CONNECTED="ws_connected",t.WS_RECONNECTING="ws_reconnecting",t.WS_CLOSED="ws_closed",t.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",t.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",t.ON_BINARY_DATA="on_binary_data",t.REQUEST_RECOVER="request_recover",t.REQUEST_JOIN_INFO="request_join_info",t.REQUEST_REJOIN_INFO="req_rejoin_info",t.IS_P2P_DISCONNECTED="is_p2p_dis",t.DISCONNECT_P2P="dis_p2p",t.ABORT_P2P_EXECUTION="abort_p2p_execution",t.NEED_RENEW_SESSION="need-sid",t.REPORT_JOIN_GATEWAY="report_join_gateway",t.REQUEST_TIMEOUT="request_timeout",t.REQUEST_SUCCESS="request_success",t.JOIN_RESPONSE="join_response",t.DATACHANNEL_PRECONNECT="datachannel_preconnect",t.DATACHANNEL_CONNECTING="datachannel_connecting",t.DATACHANNEL_FAILBACK="datachannel_failback",t.P2P_START="p2p_start",t.P2P_CONNECTION="p2p_connection",t.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",t.P2P_SUBSCRIBE="p2p_subscribe",t.P2P_UNSUBSCRIBE="p2p_unsubscribe",t.P2P_EXCHANGE_SDP="p2p_exchange_sdp",t.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",t.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(vw||(vw={})),function(t){t.PING="ping",t.PING_BACK="ping_back",t.JOIN="join_v3",t.REJOIN="rejoin_v3",t.LEAVE="leave",t.SET_CLIENT_ROLE="set_client_role",t.PUBLISH="publish",t.PUBLISH_DATASTREAM="publish_datastream",t.UNPUBLISH="unpublish",t.UNPUBLISH_DATASTREAM="unpublish_datastream",t.SUBSCRIBE="subscribe",t.SUBSCRIBE_DATASTREAM="subscribe_datastream",t.SUBSCRIBE_STREAMS="subscribe_streams",t.UNSUBSCRIBE="unsubscribe",t.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",t.UNSUBSCRIBE_STREAMS="unsubscribe_streams",t.SUBSCRIBE_CHANGE="subscribe_change",t.TRAFFIC_STATS="traffic_stats",t.RENEW_TOKEN="renew_token",t.SWITCH_VIDEO_STREAM="switch_video_stream",t.DEFAULT_VIDEO_STREAM="default_video_stream",t.SET_FALLBACK_OPTION="set_fallback_option",t.GATEWAY_INFO="gateway_info",t.CONTROL="control",t.SEND_METADATA="send_metadata",t.DATA_STREAM="data_stream",t.PICK_SVC_LAYER="pick_svc_layer",t.RESTART_ICE="restart_ice",t.CONNECT_PC="connect_pc",t.SET_VIDEO_PROFILE="set_video_profile",t.SET_PARAMETER="set_parameter",t.SET_RTM2_FLAG="set_rtm2_flag"}(yw||(yw={})),function(t){t.PUBLISH_STATS="publish_stats",t.PUBLISH_RELATED_STATS="publish_related_stats",t.SUBSCRIBE_STATS="subscribe_stats",t.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",t.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",t.DENOISER_STATS="denoiser_stats",t.TRANSPORT_STATS="transport_stats",t.EXTENSION_USAGE_STATS="extension_usage_stats"}(_w||(_w={})),function(t){t.ON_USER_ONLINE="on_user_online",t.ON_USER_OFFLINE="on_user_offline",t.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",t.ON_PUBLISH_STREAM="on_publish_stream",t.ON_UPLINK_STATS="on_uplink_stats",t.ON_P2P_LOST="on_p2p_lost",t.ON_REMOVE_STREAM="on_remove_stream",t.ON_ADD_AUDIO_STREAM="on_add_audio_stream",t.ON_ADD_VIDEO_STREAM="on_add_video_stream",t.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",t.ON_USER_BANNED="on_user_banned",t.ON_USER_LICENSE_BANNED="on_user_license_banned",t.ON_NOTIFICATION="on_notification",t.ON_CRYPT_ERROR="on_crypt_error",t.MUTE_AUDIO="mute_audio",t.MUTE_VIDEO="mute_video",t.UNMUTE_AUDIO="unmute_audio",t.UNMUTE_VIDEO="unmute_video",t.ON_P2P_OK="on_p2p_ok",t.RECEIVE_METADATA="receive_metadata",t.ON_DATA_STREAM="on_data_stream",t.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",t.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",t.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",t.ENABLE_LOCAL_VIDEO="enable_local_video",t.DISABLE_LOCAL_VIDEO="disable_local_video",t.ENABLE_LOCAL_AUDIO="enable_local_audio",t.DISABLE_LOCAL_AUDIO="disable_local_audio",t.ON_PUBLISHED_USER_LIST="on_published_user_list"}(bw||(bw={})),function(t){t.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",t.NEED_ANSWER="NEED_ANSWER",t.NEED_RENEGOTIATE="NEED_RENEGOTIATE",t.P2P_LOST="P2P_LOST",t.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",t.NEED_UNPUB="NEED_UNPUB",t.NEED_UNSUB="NEED_UNSUB",t.NEED_UPLOAD="NEED_UPLOAD",t.NEED_CONTROL="NEED_CONTROL",t.START_RECONNECT="START_RECONNECT",t.END_RECONNECT="END_RECONNECT",t.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(Ew||(Ew={})),function(t){t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY"}(ww||(ww={})),function(t){t.CONNECTED="websocket:connected",t.RECONNECTING="websocket:reconnecting",t.WILL_RECONNECT="websocket:will_reconnect",t.CLOSED="websocket:closed",t.FAILED="websocket:failed",t.ON_MESSAGE="websocket:on_message",t.REQUEST_NEW_URLS="websocket:request_new_urls",t.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",t.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(Sw||(Sw={}));class Bw extends Uv{constructor(t){super(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",arguments.length>2?arguments[2]:void 0),ih(this,"name","AgoraRTCException")}print(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return super.print(t,zE)}throw(){super.throw(zE)}}function Uw(t){if("string"!=typeof t||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(t))throw zE.error("Invalid Channel Name ".concat(t)),new Bw(Bv.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Fw(t){if(!("number"==typeof(e=t)&&Math.floor(e)===e&&0<=e&&e<=4294967295||Wv(t,1,255)))throw new Bw(Bv.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var e;"string"==typeof t&&zE.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}!function(t){t.TRANSCODE="mix_streaming",t.RAW="raw_streaming",t.INJECT="inject_streaming"}(Tw||(Tw={})),function(t){t[t.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",t[t.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",t[t.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",t[t.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",t[t.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",t[t.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",t[t.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",t[t.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",t[t.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",t[t.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",t[t.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Cw||(Cw={}));const Hw={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Vw={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function jw(t,e){Gv(t.url,"".concat(e,".url"),1,1e3,!1),zv(t.x)||Vv(t.x,"".concat(e,".x"),0,1e4),zv(t.y)||Vv(t.y,"".concat(e,".y"),0,1e4),zv(t.width)||Vv(t.width,"".concat(e,".width"),0,1e4),zv(t.height)||Vv(t.height,"".concat(e,".height"),0,1e4),zv(t.zOrder)||Vv(t.zOrder,"".concat(e,".zOrder"),0,255),zv(t.alpha)||Vv(t.alpha,"".concat(e,".alpha"),0,1,!1)}const Gw={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Qw={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var zw,Ww,Kw,qw,Yw,$w,Xw,Jw,Zw,tS,eS,nS,iS,rS;function sS(t){if(!t.channelName)throw new Bw(Bv.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof t.uid)throw new Bw(Bv.INVALID_PARAMS,"invalid uid in info, uid must be a number");return t.token&&Gv(t.token,"info.token",1,2047),Fw(t.uid),Uw(t.channelName),!0}!function(t){t.WARNING="@live_uap-warning",t.ERROR="@line_uap-error",t.PUBLISH_STREAM_STATUS="@live_uap-publish-status",t.INJECT_STREAM_STATUS="@live_uap-inject-status",t.WORKER_STATUS="@live_uap-worker-status",t.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(zw||(zw={})),function(t){t.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(Ww||(Ww={})),function(t){t[t.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",t[t.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",t[t.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",t[t.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",t[t.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",t[t.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",t[t.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",t[t.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",t[t.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",t[t.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",t[t.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",t[t.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",t[t.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",t[t.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",t[t.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",t[t.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",t[t.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",t[t.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Kw||(Kw={})),function(t){t.CONNECT_FAILED="connect failed",t.CONNECT_TIMEOUT="connect timeout",t.WS_DISCONNECTED="websocket disconnected",t.REQUEST_TIMEOUT="request timeout",t.REQUEST_FAILED="request failed",t.WAIT_STATUS_TIMEOUT="wait status timeout",t.WAIT_STATUS_ERROR="wait status error",t.BAD_STATE="bad state",t.WS_ABORT="ws abort",t.AP_REQUEST_TIMEOUT="AP request timeout",t.AP_JSON_PARSE_ERROR="AP json parse error",t.AP_REQUEST_ERROR="AP request error",t.AP_REQUEST_ABORT="AP request abort"}(qw||(qw={})),function(t){t[t.SetSdkProfile=0]="SetSdkProfile",t[t.SetSourceChannel=1]="SetSourceChannel",t[t.SetSourceUserId=2]="SetSourceUserId",t[t.SetDestChannel=3]="SetDestChannel",t[t.StartPacketTransfer=4]="StartPacketTransfer",t[t.StopPacketTransfer=5]="StopPacketTransfer",t[t.UpdateDestChannel=6]="UpdateDestChannel",t[t.Reconnect=7]="Reconnect",t[t.SetVideoProfile=8]="SetVideoProfile"}(Yw||(Yw={})),function(t){t.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",t.NETWORK_CONNECTED="NETWORK_CONNECTED",t.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",t.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",t.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",t.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",t.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",t.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",t.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",t.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}($w||($w={})),function(t){t.RELAY_STATE_IDLE="RELAY_STATE_IDLE",t.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",t.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",t.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Xw||(Xw={})),function(t){t.RELAY_OK="RELAY_OK",t.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",t.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",t.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(Jw||(Jw={})),function(t){t.High="high",t.Low="low",t.Audio="audio",t.Screen="screen",t.ScreenLow="screen_low"}(Zw||(Zw={})),function(t){t.DISCONNECT="disconnect",t.CONNECTION_STATE_CHANGE="connection-state-change",t.NETWORK_QUALITY="network-quality",t.STREAM_TYPE_CHANGE="stream-type-change",t.IS_P2P_DISCONNECTED="is-p2p-dis",t.DISCONNECT_P2P="dis-p2p",t.REQUEST_NEW_GATEWAY_LIST="req-gate-url",t.NEED_RENEW_SESSION="need-sid",t.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",t.JOIN_RESPONSE="join-response",t.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",t.RESET_CONNECTION_EVENTS="reset-connection-events",t.DATACHANNEL_PRECONNECT="datachannel_preconnect",t.DATACHANNEL_FAILBACK="datachannel_failback",t.RESET_SIGNAL="reset-signal"}(tS||(tS={})),function(t){t.P2P_DISCONNECTED="P2P_DISCONNECTED",t.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",t.TIMEOUT="TIMEOUT",t.UNKNOWN_REASON="UNKNOWN_REASON"}(eS||(eS={})),function(t){t[t.Nothing=0]="Nothing",t[t.Audio=1]="Audio",t[t.LwoVideo=2]="LwoVideo",t[t.Video=4]="Video",t[t.Data=8]="Data",t[t.DataStream0=256]="DataStream0",t[t.DataStream1=512]="DataStream1",t[t.DataStream2=1024]="DataStream2",t[t.DataStream3=2048]="DataStream3",t[t.DataStream4=4096]="DataStream4",t[t.DataStream5=8192]="DataStream5",t[t.DataStream6=16384]="DataStream6",t[t.DataStream7=32768]="DataStream7"}(nS||(nS={})),function(t){t[t.websocket=0]="websocket",t[t.datachannel=1]="datachannel"}(iS||(iS={})),function(t){t.CHINA="CHINA",t.ASIA="ASIA",t.NORTH_AMERICA="NORTH_AMERICA",t.EUROPE="EUROPE",t.JAPAN="JAPAN",t.INDIA="INDIA",t.KOREA="KOREA",t.HKMC="HKMC",t.US="US",t.OCEANIA="OCEANIA",t.SOUTH_AMERICA="SOUTH_AMERICA",t.AFRICA="AFRICA",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="EXTENSIONS"}(rS||(rS={}));const oS=[rS.AFRICA,rS.ASIA,rS.CHINA,rS.EUROPE,rS.GLOBAL,rS.INDIA,rS.JAPAN,rS.NORTH_AMERICA,rS.OCEANIA,rS.OVERSEA,rS.SOUTH_AMERICA];var aS;!function(t){t.CHINA="CN",t.ASIA="AS",t.NORTH_AMERICA="NA",t.EUROPE="EU",t.JAPAN="JP",t.INDIA="IN",t.KOREA="KR",t.HKMC="HK",t.US="US",t.OCEANIA="OC",t.SOUTH_AMERICA="SA",t.AFRICA="AF",t.OVERSEA="OVERSEA",t.GLOBAL="GLOBAL",t.EXTENSIONS="GLOBAL"}(aS||(aS={}));const cS={CHINA:{},ASIA:{CODE:aS.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:aS.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:aS.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:aS.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:aS.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:aS.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:aS.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:aS.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:aS.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:aS.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:aS.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:aS.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:aS.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var lS,uS,dS,hS,AS,pS,fS,mS,gS,vS,yS,_S,bS,ES,wS,SS,TS,CS,RS,IS,xS,OS;OE&&(cS.CHINA={CODE:aS.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(t){t.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(lS||(lS={}));class LS extends ny{constructor(t,e){super(),ih(this,"onICEConnectionStateChange",void 0),ih(this,"onConnectionStateChange",void 0),ih(this,"onDTLSTransportStateChange",void 0),ih(this,"onDTLSTransportError",void 0),ih(this,"onICETransportStateChange",void 0),ih(this,"onFirstAudioReceived",void 0),ih(this,"onFirstVideoReceived",void 0),ih(this,"onFirstAudioDecoded",void 0),ih(this,"onFirstVideoDecoded",void 0),ih(this,"onFirstVideoDecodedTimeout",void 0),ih(this,"onSelectedLocalCandidateChanged",void 0),ih(this,"onSelectedRemoteCandidateChanged",void 0)}}class MS extends LS{constructor(t,e){super(t,e)}}!function(t){t.SEND="sendonly",t.RECV="recvonly",t.SENDRECV="sendrecv",t.INACTIVE="inactive"}(uS||(uS={})),function(t){t.VIDEO="video",t.AUDIO="audio"}(dS||(dS={})),function(t){t[t.UDP=0]="UDP",t[t.TCP=1]="TCP",t[t.RELAY=2]="RELAY"}(hS||(hS={})),function(t){t[t.FIRST_CONNECTION=0]="FIRST_CONNECTION",t[t.TCP_RESTART=1]="TCP_RESTART",t[t.RELAY_RESTART=2]="RELAY_RESTART",t[t.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",t[t.OLD_RESTART=11]="OLD_RESTART",t[t.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(AS||(AS={})),function(t){t.LocalVideoTrack="videoTrack",t.LocalAudioTrack="audioTrack",t.LocalVideoLowTrack="videoLowTrack"}(pS||(pS={})),function(t){t.New="new",t.Connected="connected",t.Reconnecting="reconnecting",t.Disconnected="disconnected"}(fS||(fS={})),function(t){t.StateChange="stateChange",t.IceConnectionStateChange="iceConnectionStateChange",t.RequestMuteLocal="requestMuteLocal",t.RequestUnmuteLocal="requestUnmuteLocal",t.RequestRePublish="requestRePublish",t.RequestRePublishDataChannel="requestRePublishDataChannel",t.RequestReSubscribe="requestReSubscribe",t.RequestUploadStats="requestUploadStats",t.MediaReconnectStart="MediaReconnectStart",t.MediaReconnectEnd="MediaReconnectEnd",t.NeedSignalRTT="NeedSignalRTT",t.RequestRestartICE="RequestRestartIce",t.PeerConnectionStateChange="PeerConnectionStateChange",t.RequestReconnect="RequestReconnect",t.RequestReconnectPC="RequestReconnectPC",t.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",t.P2PLost="P2PLost",t.UpdateVideoEncoder="UpdateVideoEncoder",t.ConnectionTypeChange="ConnectionTypeChange",t.RequestLowStreamParameter="RequestLowStreamParameter",t.QueryClientConnectionState="QueryClientConnectionState",t.LocalCandidate="LocalCandidate",t.RequestP2PMuteLocal="requestP2PMuteLocal",t.RequestP2PPublish="RequestP2PPublish",t.RequestP2PUnPublish="RequestP2PUnPublish",t.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",t.RequestP2PMuteRemote="RequestP2PMuteRemote",t.RequestP2PRestartICE="RequestP2PRestartICE"}(mS||(mS={})),function(t){t.MUTE_LOCAL_VIDEO="mute_local_video",t.MUTE_LOCAL_AUDIO="mute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.MUTE_REMOTE_VIDEO="mute_remote_video",t.MUTE_REMOTE_AUDIO="mute_remote_audio",t.UNMUTE_REMOTE_VIDEO="unmute_remote_video",t.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(gS||(gS={})),function(t){t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED"}(vS||(vS={})),function(t){t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED"}(yS||(yS={})),function(t){t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(_S||(_S={})),function(t){t.NETWORK_ERROR="NETWORK_ERROR",t.SERVER_ERROR="SERVER_ERROR",t.MULTI_IP="MULTI_IP",t.TIMEOUT="TIMEOUT",t.OFFLINE="OFFLINE",t.LEAVE="LEAVE",t.P2P_FAILED="P2P_FAILED",t.FALLBACK="FALLBACK"}(bS||(bS={})),function(t){t.CONNECTED="transmitter:connected",t.RECONNECTING="transmitter:reconnecting",t.WILL_RECONNECT="transmitter:will_reconnect",t.CLOSED="transmitter:closed",t.FAILED="transmitter:failed",t.ON_MESSAGE="transmitter:on_message",t.REQUEST_NEW_URLS="transmitter:request_new_urls",t.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",t.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",t.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",t.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",t.FAILBACK="transmitter:failback"}(ES||(ES={})),function(t){t.CAMERA_CHANGED="camera-changed",t.MICROPHONE_CHANGED="microphone-changed",t.PLAYBACK_DEVICE_CHANGED="playback-device-changed",t.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",t.AUTOPLAY_FAILED="autoplay-failed",t.SECURITY_POLICY_VIOLATION="security-policy-violation"}(wS||(wS={})),function(t){t[t.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",t[t.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",t[t.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",t[t.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",t[t.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",t[t.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",t[t.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",t[t.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",t[t.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",t[t.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",t[t.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",t[t.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",t[t.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",t[t.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",t[t.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",t[t.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",t[t.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",t[t.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",t[t.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",t[t.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(SS||(SS={})),function(t){t.CONNECTING="CONNECTING",t.RECONNECTING="RECONNECTING",t.CONNECTED="CONNECTED",t.CLOSED="CLOSED"}(TS||(TS={})),function(t){t.CONNECTION_STATE_CHANGE="connection-state-change",t.STATE_CHANGE="state-change",t.INSPECT_RESULT="inspect-result",t.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",t.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(CS||(CS={})),function(t){t[t.CONNECT_AP=0]="CONNECT_AP",t[t.AP_CONNECTED=1]="AP_CONNECTED",t[t.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",t[t.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",t[t.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",t[t.CONNECT_WORKER=5]="CONNECT_WORKER",t[t.WORKER_CONNECTED=6]="WORKER_CONNECTED",t[t.CLOSED=7]="CLOSED"}(RS||(RS={})),function(t){t.CALL="call",t.CANDIDATE="candidate",t.PUBLISH="publish",t.UNPUBLISH="unpublish",t.SUBSCRIBE="subscribe",t.UNSUBSCRIBE="unsubscribe",t.CONTROL="control",t.RESTART_ICE="restart_ice",t.ACK="ack",t.JOIN="join",t.EXCHANGE_SDP="exchange_sdp",t.DO_SUBSCRIBE="do_subscribe",t.DO_UNSUBSCRIBE="do_unsubscribe"}(IS||(IS={})),function(t){t.MUTE_LOCAL_AUDIO="mute_local_audio",t.MUTE_LOCAL_VIDEO="mute_local_video",t.UNMUTE_LOCAL_AUDIO="unmute_local_audio",t.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(xS||(xS={})),function(t){t[t.SUCCESS=1]="SUCCESS",t[t.FAILED=0]="FAILED"}(OS||(OS={}));const kS={[hw.ACCESS_POINT]:{[fw.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[fw.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[fw.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[fw.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[fw.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[fw.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[fw.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[hw.UNILBS]:{[pw.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[pw.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[pw.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[pw.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[pw.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[pw.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[pw.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[pw.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[pw.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[pw.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[pw.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[pw.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[hw.STRING_UID_ALLOCATOR]:{[Aw.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Aw.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Aw.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function NS(t){const e=kS[Math.floor(t/1e4)];if(!e)return{desc:"unkonw error",retry:!1};const n=e[t%1e4];if(!n){if(Math.floor(t/1e4)===hw.ACCESS_POINT){const e=t%1e4;if("1"===e.toString()[0])return{desc:t.toString(),retry:!1};if("2"===e.toString()[0])return{desc:t.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const PS={[mw.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[mw.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[mw.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[mw.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[mw.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[mw.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[mw.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[mw.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[mw.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[mw.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[mw.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[mw.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[mw.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[mw.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[mw.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[mw.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[mw.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[mw.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[mw.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[mw.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[mw.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[mw.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[mw.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[mw.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[mw.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[mw.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[mw.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[mw.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[mw.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[mw.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[mw.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[mw.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[mw.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[mw.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[mw.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[mw.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[mw.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[mw.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[mw.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[mw.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[mw.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[mw.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[mw.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[mw.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[mw.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[mw.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[mw.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[mw.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[mw.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[mw.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[mw.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[mw.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[mw.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[mw.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[mw.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[mw.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[mw.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[mw.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[mw.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[mw.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[mw.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[mw.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[mw.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function DS(t){return PS[t]||{desc:"UNKNOW_ERROR_".concat(t),action:"failed"}}function BS(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function US(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?BS(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):BS(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function FS(t){return t.every((t=>t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING))}function HS(t,e){if("string"==typeof t)return t;const{proxy:n,host:i,port:r}=t;if(e){const t=NE("JOIN_GATEWAY_FALLBACK_PORT")||443;return 443===t?"wss://".concat(i,"/ws/?p=").concat(Number(r)+150):"wss://".concat(i,":").concat(t,"/ws/?p=").concat(Number(r)+150)}return n?"wss://".concat(n,"/ws/?h=").concat(i,"&p=").concat(r):"wss://".concat(i,":").concat(r)}const VS=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,jS=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,GS=/wss:\/\/(.+):([0-9]+)\/?/,QS=/wss:\/\/(.[^\/]+)\/?/;let zS=0;class WS{constructor(t,e){ih(this,"id",0),ih(this,"store",void 0),ih(this,"recordIndex",void 0),ih(this,"websockets",[]),ih(this,"try443PortDuration",2e3),ih(this,"forceCloseWSDuration",5e3),ih(this,"try443PortTimeout",null),ih(this,"forceCloseTimeout",null),ih(this,"isTry443PortFailed",!1),ih(this,"isNormalPortFailed",!1),ih(this,"useDoubleDomain",!1),ih(this,"useProxy",!1),ih(this,"startTime",Date.now()),this.id=++zS,this.try443PortDuration=NE("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=t||5e3,this.store=e}closeAllWebsockets(){this.websockets.forEach((t=>{t.onopen=null,t.onclose=null,t.onmessage=null,t.close()})),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var t;const e=Date.now()-this.startTime;for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];zE.debug("[choose-best-ws ".concat(null===(t=this.store)||void 0===t?void 0:t.clientId," ").concat(this.id,"] ").concat(e,"ms:"),...i)}createWebSocket(t,e,n){this.logger("createWebSocket:",t,{isTry443Port:e,hasTimeoutDetection:n});const i=NE("GATEWAY_DOMAINS"),r=Date.now(),s=[],o=i.find((e=>{var n;return kr(n=t.host).call(n,e)}));o||(this.useDoubleDomain=!1);const a=[];if(this.useDoubleDomain)i.forEach((n=>{a.push(HS(US(US({},t),{},{host:t.host.replace(o,n)}),e))}));else{const n=US({},t);if(e&&o){const t=i.find((t=>t!==o));t&&(n.host=n.host.replace(o,t))}a.push(HS(n,e))}try{a.forEach((t=>{const e=new WebSocket(t);e.binaryType="arraybuffer",s.push(e),this.logger("ws is connecting:",e.url)}))}catch(i){if(this.logger("ws create failed"),s.forEach((t=>t.close())),s.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(t,e,n);if(!e&&443!==Number(t.port))return this.createWebSocket(t,!0,n);throw new Bw(Bv.WS_ERR,"init websocket failed! Error: ".concat(i.toString()))}const c=iv();return this.store&&this.store.recordJoinChannelService({urls:s.map((t=>t.url)),service:"gateway"},this.recordIndex),s.forEach((t=>{t.onopen=()=>{this.logger("onopen: ws ".concat(t.url," open cost ").concat(Date.now()-r,"ms")),this.websockets.forEach((e=>{e!==t&&(e.onopen=null,e.onclose=null,e.onmessage=null,e.close(),this.logger("close backup websocket: ".concat(e.url)))})),this.websockets.length=0,c.resolve(t)},t.onclose=n=>{this.logger("onclose: ws ".concat(t.url," closed cost ").concat(Date.now()-r,"ms state: ").concat(t.readyState)),e?this.isTry443PortFailed=FS(s):this.isNormalPortFailed=FS(s),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(e&&this.isTry443PortFailed||!e&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(n.reason)),c.reject({code:n.code,reason:eS.A_ROUND_WS_FAILED}))},t.onmessage=e=>this.logger("".concat(t.url," onmessage: ").concat(e.data))})),this.websockets.push(...s),n||(()=>{const n=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",c.isResolved),this.websockets.forEach((t=>t.readyState!==WebSocket.OPEN&&t.close()))};if(e||this.useProxy)return this.logger("add 5s timeout at ".concat(e?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout((()=>{if(this.logger("2s timeout, isWebsocket created: ",c.isResolved),c.isResolved)return n();Av().os===av.MAC_OS&&bv()&&n(),this.createWebSocket(t,!0,!0).then((t=>c.resolve(t))).catch((t=>{this.isNormalPortFailed&&c.reject(t),this.logger("try 443 port to create ws failed")})),this.forceCloseTimeout=window.setTimeout(n,this.forceCloseWSDuration)}),this.try443PortDuration)})(),c.promise}chooseBestWebsocket(t,e,n,i){return this.useDoubleDomain=!!e,"string"==typeof t&&(t=function(t){let e,n,i;return[,e,n,i]=t.match(VS)||[],e||([,n,i]=t.match(jS)||[]),n&&i||([,n,i]=t.match(GS)||[]),n&&i||([,n]=t.match(QS)||[]),n||zE.warning("un-destructible url: ",t),{proxy:e,host:n,port:i||"443"}}(t)),this.recordIndex=i,this.useProxy=!!t.proxy,n&&this.useProxy&&(zE.warn("cannot use 443 only when use proxy"),n=!1),this.createWebSocket(t,!!n,!1).finally((()=>this.clearTimeout()))}}function KS(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}class qS extends ny{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var e;kr(e=["tryNext","recover"]).call(e,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,"reconnecting"===this._state?this.emit(Sw.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(Sw.CONNECTED):"closed"===this._state?this.emit(Sw.CLOSED):"failed"===this._state&&this.emit(Sw.FAILED))}resetReconnectCount(t){zE.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;super(),ih(this,"connectionID",0),ih(this,"currentURLIndex",0),ih(this,"urls",[]),ih(this,"_reconnectMode","tryNext"),ih(this,"reconnectReason",void 0),ih(this,"_initMutex",new Wy("websocket")),ih(this,"name",void 0),ih(this,"_state","closed"),ih(this,"reconnectInterrupter",void 0),ih(this,"websocket",void 0),ih(this,"retryConfig",void 0),ih(this,"reconnectCount",0),ih(this,"forceCloseTimeout",5e3),ih(this,"onlineReconnectListener",void 0),ih(this,"useCompress",void 0),ih(this,"tryDoubleDomain",!1),ih(this,"use443PortOnly",!1),ih(this,"wsInflateLength",0),ih(this,"wsDeflateLength",0),ih(this,"closeEstablishingWs",(()=>{})),ih(this,"store",void 0),ih(this,"joinGatewayRecordIndex",void 0),this.store=s,this.name=t,this.retryConfig=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?KS(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):KS(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},e),this.useCompress=n,this.tryDoubleDomain=i,this.use443PortOnly=r;const{timeout:o,timeoutFactor:a}=e,c=Math.max(300,Math.floor(3*o/5)),l=Math.max(1.2,Math.floor(8*a)/10);dy.ONLINE&&(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l),by.on(hy.NETWORK_STATE_CHANGE,((t,e)=>{t!==e&&(this.resetReconnectCount("network state change: ".concat(e," -> ").concat(t)),t===dy.ONLINE?(this.retryConfig.timeout=c,this.retryConfig.timeoutFactor=l):(this.retryConfig.timeout=o,this.retryConfig.timeoutFactor=a))}))}getConnection(){return this.websocket||void 0}async init(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=await this._initMutex.lock();this.forceCloseTimeout=e,this.urls=t,this.state="connecting";try{const t=iv(),e=this.urls[this.currentURLIndex];this.createWebSocketConnection(e).then(t.resolve).catch(t.reject),this.once(Sw.CLOSED,(()=>{t.reject(new Uv(Bv.WS_DISCONNECT))})),this.once(Sw.CONNECTED,t.resolve),await t.promise}catch(t){}finally{n()}}close(t,e){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const t=this.websocket;e?setTimeout((()=>t.close()),500):t.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,e){if(!this.websocket)return void zE.warning("[".concat(this.name,"] can not reconnect, no websocket"));void 0!==t&&(this.reconnectMode=t),zE.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinGatewayRecordIndex&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(e)]},this.joinGatewayRecordIndex);const n=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),n&&n.bind(this.websocket)({code:9999,reason:e})}sendMessage(t){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Uv(Bv.WS_ABORT,"websocket is not ready");try{e||(t=JSON.stringify(t)),this.websocket.send(t)}catch(t){throw new Uv(Bv.WS_ERR,"send websocket message error"+t.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,e=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:e}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t){var e;const n=iv();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const i=t=>{var e;null===(e=this.store)||void 0===e||e.signalChannelOpen(),zE.debug("[".concat(this.name,"] websocket opened:"),t),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n.resolve()},r=async t=>{var e;if(zE.debug("[".concat(this.name,"] websocket close ").concat(null===(e=this.websocket)||void 0===e?void 0:e.url,", code: ").concat(t.code,", reason: ").concat(t.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)n.reject(new Uv(Bv.WS_DISCONNECT,"websocket close: ".concat(t.code))),this.close();else{"connected"===this.state&&(this.reconnectReason=t.reason,this.state="reconnecting");const e=yy(this,Sw.WILL_RECONNECT,this.reconnectMode,t.reason)||this.reconnectMode,i=await this.reconnectWithAction(e);if("closed"===this.state)return void zE.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!i)return n.reject(new Uv(Bv.WS_DISCONNECT,"websocket reconnect failed: ".concat(t.code))),this.close(!0);n.resolve()}},s=t=>{this.emit(Sw.ON_MESSAGE,t)},o=t=>{zE.warn("[".concat(this.connectionID,"] ws open error ").concat(t))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),NE("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=NE("GATEWAY_WSS_ADDRESS")),zE.debug("[".concat(this.name,"] start connect, url:"),t);const a=null===(e=this.store)||void 0===e?void 0:e.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var c;const e=await this.chooseBestWebsocketConnection(t);this.websocket=e,i&&i(this.websocket.url),this.websocket.onclose=r,this.websocket.onmessage=s,this.websocket.onerror=o,null===(c=this.store)||void 0===c||c.recordJoinChannelService({endTs:Date.now(),status:"success"},a),this.joinGatewayRecordIndex=a}catch(t){const e="closed"===this.state,i=t instanceof Uv,s=i&&t.code===Bv.WS_ABORT,o=i&&t.code===Bv.WS_ERR,c=i?t.message:t&&(t.reason||t.toString());zE.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(c)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:s?"aborted":"error",errors:[t]},a),e||o?(n.reject(e?new Uv(Bv.WS_DISCONNECT,"websocket is closed: ".concat(c)):new Uv(Bv.WS_ERR,"init websocket failed: ".concat(c))),o&&zE.error("[".concat(this.name,"] init websocket failed: ").concat(c))):r&&r(t)}return n.promise}async reconnectWithAction(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(0===this.urls.length)return!1;if("closed"===this.state)return!1;zE.warning("[choose-best-ws] action: =>",t),this.onlineReconnectListener||by.isOnline||!by.onlineWaiter||(this.onlineReconnectListener=by.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let n=!0;if(this.reconnectInterrupter=()=>n=!1,e){const e=Yy(this.reconnectCount,this.retryConfig);zE.debug("[".concat(this.name,"] wait ").concat(e,"ms to reconnect websocket, mode: ").concat(t)),await ev.race([Dy(e),this.onlineReconnectListener||new ev((()=>{}))])}if("closed"===this._state||!n)return!1;this.reconnectCount+=1;const i=async(t,e)=>{this.emit(Sw.RECONNECT_CREATE_CONNECTION,e),await this.createWebSocketConnection(t)};try{if("retry"===t)this.emit(Sw.RECONNECT_WAITTING_FINISH,t),await i(this.urls[this.currentURLIndex],t);else if("tryNext"===t){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);zE.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(Sw.RECONNECT_WAITTING_FINISH,t),await i(this.urls[this.currentURLIndex],t)}else"recover"===t&&(zE.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Sw.RECONNECT_WAITTING_FINISH,t),this.urls=await gy(this,Sw.REQUEST_NEW_URLS),this.currentURLIndex=0,await i(this.urls[this.currentURLIndex],t))}catch(n){var r;zE.error("[".concat(this.name,"] reconnect failed ").concat(n&&n.toString()));const i=null==n||null===(r=n.data)||void 0===r?void 0:r.desc;return Array.isArray(i)&&kr(i).call(i,"dynamic key expired")?(this.emit(Sw.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(t,e)}return!0}}class YS extends qS{constructor(t,e){super(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,e){const n=iv(),i=function(t,e){return new WS(t,e)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{zE.debug("[choose-best-ws] close establishing websockets"),i.closeAllWebsockets(),n.reject(new Uv(Bv.WS_ABORT,"choose best websocket aborted"))};const r=NE("GATEWAY_DOMAINS");return zE.debug("[choose-best-ws] currentDomain: ",t,", domains: ",r,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),i.chooseBestWebsocket(t,this.tryDoubleDomain,this.use443PortOnly,e).then(n.resolve).catch(n.reject),n.promise.finally((()=>{this.closeEstablishingWs=void 0}))}}class $S extends qS{constructor(t,e){super(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(t,e){return new ev(((n,i)=>{let r=!1;const s=[];this.closeEstablishingWs=()=>{zE.debug("[choose-best-ws] close establishing websockets"),s.forEach((t=>{t.onclose=null,t.onopen=null,t.onmessage=null,t.close()})),i(new Uv(Bv.WS_ABORT,"choose best websocket aborted"))};const o=NE("GATEWAY_DOMAINS");let a;const c=t.indexOf("?h="),l=o.find((e=>-1!==c?kr(t).call(t,e,c):kr(t).call(t,e)));zE.debug("[choose-best-ws] currentDomain: ",l,", domains: ",o);let u=!this.tryDoubleDomain||!l;if(!u&&l){var d;const h=Date.now();try{o.forEach((e=>{const n=-1===c?t.replace(l,e):t.substr(0,c)+t.substr(c).replace(l,e),i=new WebSocket(n);i.binaryType="arraybuffer",s.push(i),zE.debug("[choose-best-ws] ws is connecting:",i.url)}))}catch(t){for(zE.debug("[choose-best-ws] ws create failed, fallback to single url"),s.forEach((t=>t.close()));s.length;)s.pop();u=!0}null===(d=this.store)||void 0===d||d.recordJoinChannelService({urls:s.map((t=>t.url)),service:"gateway"},e),s.forEach((t=>{t.onopen=()=>{if(r)return;const e=Date.now()-h;zE.debug("[choose-best-ws] ws open cost ".concat(e,"ms")),s.filter((e=>e!==t)).forEach((t=>{zE.debug("[choose-best-ws]close backup websocket: ".concat(t.url)),t.close()})),r=!0,n(t)},t.onclose=t=>{a=t,r||s.find((t=>!(t.readyState===WebSocket.CLOSED||t.readyState===WebSocket.CLOSING)))||(zE.debug("[choose-best-ws] all websocket is closed"),r=!0,i(a))},t.onmessage=e=>{zE.debug("[choose-best-ws]".concat(t.url," onmessage: ").concat(e.data))}})),Dy(this.forceCloseTimeout).then((()=>{s.forEach((t=>{t.readyState!==WebSocket.OPEN&&t.close()}))}))}if(u){var h;let r;zE.debug("[choose-best-ws] use single url: ",t),null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:[t],service:"gateway"},e);try{r=new WebSocket(t),s.push(r),r.binaryType="arraybuffer"}catch(t){const e=new Uv(Bv.WS_ERR,"init websocket failed! Error: ".concat(t.toString()));return zE.error("[".concat(this.name,"]").concat(e)),void i(e)}r.onopen=()=>{n(r)},r.onclose=t=>{i(t)},r.onmessage=t=>{zE.debug("[choose-best-ws]".concat(r.url," onmessage: ").concat(t.data))},Dy(this.forceCloseTimeout).then((()=>{r&&r.readyState!==WebSocket.OPEN&&r.close()}))}})).then((t=>(this.closeEstablishingWs=void 0,t))).catch((t=>{throw this.closeEstablishingWs=void 0,t}))}}class XS extends ny{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===gw.CONNECTED?this.emit(vw.WS_CONNECTED):t===gw.RECONNECTING?this.emit(vw.WS_RECONNECTING,this._websocketReconnectReason):t===gw.CLOSED&&this.emit(vw.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),ih(this,"_disconnectedReason",void 0),ih(this,"_websocketReconnectReason",void 0),ih(this,"_connectionState",gw.CLOSED),ih(this,"reconnectToken",void 0),ih(this,"websocket",void 0),ih(this,"openConnectionTime",void 0),ih(this,"clientId",void 0),ih(this,"lastMsgTime",Date.now()),ih(this,"uploadCache",[]),ih(this,"uploadCacheInterval",void 0),ih(this,"rttRolling",new l_(5)),ih(this,"pingpongTimer",void 0),ih(this,"wsInflateDataTimer",void 0),ih(this,"pingpongTimeoutCount",0),ih(this,"joinResponse",void 0),ih(this,"multiIpOption",void 0),ih(this,"initError",void 0),ih(this,"spec",void 0),ih(this,"store",void 0),ih(this,"onWebsocketMessage",(t=>{if(t.data instanceof ArrayBuffer)return void this.emit(vw.ON_BINARY_DATA,t.data);const e=JSON.parse(t.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(e,"_id")){const t="res-@".concat(e._id);this.emit(t,e._result,e._message)}else if(Object.prototype.hasOwnProperty.call(e,"_type")){if(this.emit(e._type,e._message),e._type===bw.ON_NOTIFICATION&&this.handleNotification(e._message),e._type===bw.ON_USER_BANNED)switch(e._message.error_code){case 14:this.close(cy.UID_BANNED);break;case 15:this.close(cy.IP_BANNED);break;case 16:this.close(cy.CHANNEL_BANNED)}if(e._type===bw.ON_USER_LICENSE_BANNED)switch(e._message.error_code){case mw.ERR_LICENSE_MISSING:this.close(cy.LICENSE_MISSING);break;case mw.ERR_LICENSE_EXPIRED:this.close(cy.LICENSE_EXPIRED);break;case mw.ERR_LICENSE_MINUTES_EXCEEDED:this.close(cy.LICENSE_MINUTES_EXCEEDED);break;case mw.ERR_LICENSE_PERIOD_INVALID:this.close(cy.LICENSE_PERIOD_INVALID);break;case mw.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(cy.LICENSE_MULTIPLE_SDK_SERVICE);break;case mw.ERR_LICENSE_ILLEGAL:this.close(cy.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new YS("gateway-".concat(this.clientId),this.spec.retryConfig,!0,NE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),NE("JOIN_GATEWAY_USE_443PORT_ONLY"),e),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===gw.CONNECTED&&this.reconnect("retry",uy.OFFLINE)}))}async request(t,e,n,i){const r=By(6,""),s={_id:r,_type:t,_message:e},o=this.websocket.connectionID,a=()=>new ev(((e,n)=>{if(this.connectionState===gw.CONNECTED)return e();const i=()=>{this.off(vw.WS_CLOSED,r),e()},r=()=>{this.off(vw.WS_CONNECTED,i),n(new Bw(Bv.WS_ABORT))};this.once(vw.WS_CONNECTED,i),this.once(vw.WS_CLOSED,r),t!==yw.PUBLISH&&t!==yw.SUBSCRIBE&&t!==yw.UNSUBSCRIBE&&t!==yw.UNPUBLISH&&t!==yw.CONTROL&&t!==yw.RESTART_ICE||this.once(vw.DISCONNECT_P2P,(()=>{n(new Bw(Bv.DISCONNECT_P2P))})),t!==yw.PUBLISH&&t!==yw.RESTART_ICE||this.once(vw.ABORT_P2P_EXECUTION,(()=>{n(new Bw(Bv.DISCONNECT_P2P))}))}));if(this.connectionState!==gw.CONNECTING&&this.connectionState!==gw.RECONNECTING||t===yw.JOIN||t===yw.REJOIN||await a(),this.websocket.sendMessage(s,!0),i)return;const c=new ev(((n,i)=>{let s=!1;const a=(i,r)=>{s=!0,n({isSuccess:"success"===i,message:r||{}}),this.off(vw.WS_CLOSED,c),this.off(vw.WS_RECONNECTING,c),this.emit(vw.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(r),a);const c=()=>{i(new Bw(Bv.WS_ABORT,"type: ".concat(t))),this.off(vw.WS_CLOSED,c),this.off(vw.WS_RECONNECTING,c),this.off("res-@".concat(r),a)};this.once(vw.WS_CLOSED,c),this.once(vw.WS_RECONNECTING,c),Dy(NE("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==o||s||(zE.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(vw.REQUEST_TIMEOUT,t,e))}))}));let l=null;try{l=await c}catch(i){if(this.connectionState===gw.CLOSED||t===yw.LEAVE)throw new Bw(Bv.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?i.throw():t===yw.JOIN||t===yw.REJOIN?null:(await a(),await this.request(t,e))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),d=DS(u),h=new Bw(Bv.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(l.message.error_str),{code:u,data:l.message});return"success"===d.action?l.message:(zE.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(u,", message: ").concat(d.desc,", action: ").concat(d.action)),u===mw.ERR_TOO_MANY_BROADCASTERS?t===yw.JOIN||t===yw.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(u===mw.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,zE.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",uy.MULTI_IP)):this.reconnect(d.action,uy.SERVER_ERROR),t===yw.JOIN||t===yw.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new ev((n=>{const i=r=>{(!e||e(r))&&(this.off(t,i),n(r))};this.on(t,i)}))}upload(t,e){const n={_type:t,_message:e};try{this.websocket.sendMessage(n)}catch(t){const e=NE("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==gw.CONNECTED)return;const t=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(t._type,t._message)}),NE("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const n={_type:t,_message:e};this.websocket.sendMessage(n)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ev(((e,n)=>{this.once(vw.WS_CONNECTED,(()=>e(this.joinResponse))),this.once(vw.WS_CLOSED,(()=>n(this.initError||new Bw(Bv.WS_ABORT)))),this.connectionState=gw.CONNECTING,this.websocket.init(t).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||cy.LEAVE,this.connectionState=gw.CLOSED,zE.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===cy.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new YS("gateway-".concat(this.clientId),this.spec.retryConfig,!0,NE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),NE("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(vw.ABORT_P2P_EXECUTION);const t=await gy(this,vw.REQUEST_JOIN_INFO),e=await this.request(yw.JOIN,t);if(!e)return this.emit(vw.REPORT_JOIN_GATEWAY,eS.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(vw.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=gw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Bw(Bv.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=_y(this,vw.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const e=await this.request(yw.REJOIN,t);return!!e&&(this.connectionState=gw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),e.peers&&e.peers.forEach((t=>{this.emit(bw.ON_USER_ONLINE,{uid:t.uid}),t.audio&&this.emit(bw.ON_ADD_AUDIO_STREAM,{uid:t.uid,uint_id:t.uint_id,audio:!0,ssrcId:t.audio_ssrc}),t.video&&this.emit(bw.ON_ADD_VIDEO_STREAM,{uid:t.uid,uint_id:t.uint_id,video:!0,ssrcId:t.video_ssrc}),t.audio_mute?this.emit(bw.MUTE_AUDIO,{uid:t.uid}):this.emit(bw.UNMUTE_AUDIO,{uid:t.uid}),t.video_mute?this.emit(bw.MUTE_VIDEO,{uid:t.uid}):this.emit(bw.UNMUTE_VIDEO,{uid:t.uid}),t.audio_enable_local?this.emit(bw.ENABLE_LOCAL_AUDIO,{uid:t.uid}):this.emit(bw.DISABLE_LOCAL_AUDIO,{uid:t.uid}),t.video_enable_local?this.emit(bw.ENABLE_LOCAL_VIDEO,{uid:t.uid}):this.emit(bw.DISABLE_LOCAL_VIDEO,{uid:t.uid}),t.audio||t.video||this.emit(bw.ON_REMOVE_STREAM,{uid:t.uid,uint_id:t.uint_id})})),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleNotification(t){zE.debug("[".concat(this.clientId,"] receive notification: "),t);const e=DS(t.code);if("success"!==e.action){if("failed"!==e.action)return"quit"===e.action?("ERR_REPEAT_JOIN_CHANNEL"===e.desc&&this.close(cy.UID_BANNED),void this.close()):void this.reconnect(e.action,uy.SERVER_ERROR);zE.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=NE("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(zE.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>NE("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",uy.TIMEOUT):this.request(yw.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const t=Date.now()-e;this.rttRolling.add(t),NE("REPORT_STATS")&&this.send(yw.PING_BACK,{pingpongElapse:t})})).catch((t=>{}))}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:e}=this.websocket.getWsInflateData();0!==t&&0!==e&&this.upload(_w.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Sw.RECONNECT_WAITTING_FINISH,(t=>{this.emit(vw.WS_RECONNECT_WAITTING_FINISH,t)})),this.websocket.on(Sw.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(vw.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(Sw.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Sw.CLOSED,(()=>{this.connectionState=gw.CLOSED})),this.websocket.on(Sw.FAILED,(()=>{this._disconnectedReason=cy.NETWORK_ERROR,this.connectionState=gw.CLOSED})),this.websocket.on(Sw.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===gw.CONNECTED?this.connectionState=gw.RECONNECTING:this.connectionState=gw.CONNECTING})),this.websocket.on(Sw.WILL_RECONNECT,((t,e,n)=>{const i=_y(this,vw.IS_P2P_DISCONNECTED),r=i||"retry"!==t;i&&"retry"===t&&(zE.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),t="tryNext",e=eS.P2P_DISCONNECTED),r&&(zE.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(t)),this.emit(vw.REPORT_JOIN_GATEWAY,e||eS.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(vw.NEED_RENEW_SESSION),this.emit(vw.DISCONNECT_P2P)),n(t)})),this.websocket.on(Sw.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((t=>{zE.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",uy.SERVER_ERROR)})):this.join().catch((t=>{if(this.emit(vw.REPORT_JOIN_GATEWAY,t.message||t.code||eS.UNKNOWN_REASON,this.url||""),t instanceof Bw&&t.code===Bv.UNEXPECTED_RESPONSE&&t.data.code===mw.ERR_NO_AUTHORIZED)return zE.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",uy.SERVER_ERROR);zE.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",uy.SERVER_ERROR):(this.initError=t,this.close())}))})),this.websocket.on(Sw.REQUEST_NEW_URLS,((t,e)=>{gy(this,vw.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)})),this.websocket.on(Sw.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(bw.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}var JS="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",ZS=te,tT=yr,eT=JS,nT=pt("".replace),iT=RegExp("^["+eT+"]+"),rT=RegExp("(^|[^"+eT+"])["+eT+"]+$"),sT=function(t){return function(e){var n=tT(ZS(e));return 1&t&&(n=nT(n,iT,"")),2&t&&(n=nT(n,rT,"$1")),n}},oT={start:sT(1),end:sT(2),trim:sT(3)},aT=Yl.PROPER,cT=ct,lT=JS,uT=oT.trim;Pi({target:"String",proto:!0,forced:function(t){return cT((function(){return!!lT[t]()||"âÂá "!=="âÂá "[t]()||aT&&lT[t].name!==t}))}("trim")},{trim:function(){return uT(this)}});var dT,hT,AT=er("String").trim,pT=ft,fT=AT,mT=String.prototype,gT=q((function(t){var e=t.trim;return"string"==typeof t||t===mT||pT(mT,t)&&e===mT.trim?fT:e}));function vT(t,e,n){return{sampleRate:t,stereo:e,bitrate:n}}function yT(t,e,n,i,r){return{width:t,height:e,frameRate:n,bitrateMin:i,bitrateMax:r}}function _T(t,e,n,i,r){return{width:{max:t},height:{max:e},frameRate:n,bitrateMin:i,bitrateMax:r}}function bT(t,e){return{numSpatialLayers:t,numTemporalLayers:e}}!function(t){t[t.CHOOSE_SERVER=11]="CHOOSE_SERVER",t[t.CLOUD_PROXY=18]="CLOUD_PROXY",t[t.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",t[t.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"}(dT||(dT={})),function(t){t.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",t.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",t.IOS_INTERRUPTION_START="ios-interruption-start",t.IOS_INTERRUPTION_END="ios-interruption-end",t.STATE_CHANGE="state-change"}(hT||(hT={}));const ET={"90p":yT(160,90),"90p_1":yT(160,90),"120p":yT(160,120,15,30,65),"120p_1":yT(160,120,15,30,65),"120p_3":yT(120,120,15,30,50),"120p_4":yT(212,120),"180p":yT(320,180,15,30,140),"180p_1":yT(320,180,15,30,140),"180p_3":yT(180,180,15,30,100),"180p_4":yT(240,180,15,30,120),"240p":yT(320,240,15,40,200),"240p_1":yT(320,240,15,40,200),"240p_3":yT(240,240,15,40,140),"240p_4":yT(424,240,15,40,220),"360p":yT(640,360,15,80,400),"360p_1":yT(640,360,15,80,400),"360p_3":yT(360,360,15,80,260),"360p_4":yT(640,360,30,80,600),"360p_6":yT(360,360,30,80,400),"360p_7":yT(480,360,15,80,320),"360p_8":yT(480,360,30,80,490),"360p_9":yT(640,360,15,80,800),"360p_10":yT(640,360,24,80,800),"360p_11":yT(640,360,24,80,1e3),"480p":yT(640,480,15,100,500),"480p_1":yT(640,480,15,100,500),"480p_2":yT(640,480,30,100,1e3),"480p_3":yT(480,480,15,100,400),"480p_4":yT(640,480,30,100,750),"480p_6":yT(480,480,30,100,600),"480p_8":yT(848,480,15,100,610),"480p_9":yT(848,480,30,100,930),"480p_10":yT(640,480,10,100,400),"720p":yT(1280,720,15,120,1130),"720p_auto":yT(1280,720,30,900,3e3),"720p_1":yT(1280,720,15,120,1130),"720p_2":yT(1280,720,30,120,2e3),"720p_3":yT(1280,720,30,120,1710),"720p_5":yT(960,720,15,120,910),"720p_6":yT(960,720,30,120,1380),"1080p":yT(1920,1080,15,120,2080),"1080p_1":yT(1920,1080,15,120,2080),"1080p_2":yT(1920,1080,30,120,3e3),"1080p_3":yT(1920,1080,30,120,3150),"1080p_5":yT(1920,1080,60,120,4780),"1440p":yT(2560,1440,30,120,4850),"1440p_1":yT(2560,1440,30,120,4850),"1440p_2":yT(2560,1440,60,120,7350),"4k":yT(3840,2160,30,120,8910),"4k_1":yT(3840,2160,30,120,8910),"4k_3":yT(3840,2160,60,120,13500)},wT=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],ST={"480p":_T(640,480,5),"480p_1":_T(640,480,5),"480p_2":_T(640,480,30),"480p_3":_T(640,480,15),"720p":_T(1280,720,5),"720p_auto":yT(1280,720,30,900,3e3),"720p_1":_T(1280,720,5),"720p_2":_T(1280,720,30),"720p_3":_T(1280,720,15),"1080p":_T(1920,1080,5),"1080p_1":_T(1920,1080,5),"1080p_2":_T(1920,1080,30),"1080p_3":_T(1920,1080,15)},TT={"1SL1TL":bT(1,1),"3SL3TL":bT(3,3),"2SL3TL":bT(2,3)};function CT(t){return t||(t="480p_1"),"string"==typeof t?Object.assign({},ET[t]):t}function RT(t){return"string"==typeof t?Object.assign({},ST[t]):t}function IT(t){return"string"==typeof t?Object.assign({},TT[t]):t}const xT={speech_low_quality:vT(16e3,!1),speech_standard:vT(32e3,!1,18),music_standard:vT(48e3,!1),standard_stereo:vT(48e3,!0,56),high_quality:vT(48e3,!1,128),high_quality_stereo:vT(48e3,!0,192)};function OT(t){return"string"==typeof t?Object.assign({},xT[t]):t}const LT=[];function MT(t){return Hv(t,"mediaSource",["screen","window","application"]),!0}var kT,NT,PT,DT,BT,UT,FT,HT,VT,jT;!function(t){t.NEED_RENEGOTIATE="@need_renegotiate",t.NEED_REPLACE_TRACK="@need_replace_track",t.NEED_CLOSE="@need_close",t.NEED_ENABLE_TRACK="@need_enable_track",t.NEED_DISABLE_TRACK="@need_disable_track",t.NEED_SESSION_ID="@need_sid",t.SET_OPTIMIZATION_MODE="@set_optimization_mode",t.GET_STATS="@get_stats",t.GET_RTC_STATS="@get_rtc_stats",t.GET_LOW_VIDEO_TRACK="@get_low_video_track",t.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",t.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",t.NEED_MUTE_TRACK="@need_mute_track",t.NEED_UNMUTE_TRACK="@need_unmute_track"}(kT||(kT={})),function(t){t.SCREEN_TRACK="screen_track",t.CUSTOM_TRACK="custome_track",t.LOW_STREAM="low_stream"}(NT||(NT={})),function(t){t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM"}(PT||(PT={})),function(t){t[t.HIGH_STREAM=0]="HIGH_STREAM",t[t.LOW_STREAM=1]="LOW_STREAM"}(DT||(DT={})),function(t){t[t.DISABLE=0]="DISABLE",t[t.LOW_STREAM=1]="LOW_STREAM",t[t.AUDIO_ONLY=2]="AUDIO_ONLY"}(BT||(BT={})),function(t){t.TRANSCEIVER_UPDATED="transceiver-updated"}(UT||(UT={})),function(t){t.SOURCE_STATE_CHANGE="source-state-change",t.TRACK_ENDED="track-ended",t.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",t.CLOSED="closed"}(FT||(FT={})),function(t){t.FIRST_FRAME_DECODED="first-frame-decoded",t.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(HT||(HT={})),function(t){t.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",t.RECEIVE_TRACK_BUFFER="receive_track_buffer",t.ON_AUDIO_BUFFER="on_audio_buffer",t.UPDATE_SOURCE="update_source"}(VT||(VT={})),function(t){t.UPDATE_TRACK_SOURCE="update-track-source"}(jT||(jT={}));const GT={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},QT={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},zT={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},WT={uplinkNetworkQuality:0,downlinkNetworkQuality:0},KT={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var qT,YT,$T,XT,JT;!function(t){t.ON_TRACK="on_track",t.ON_NODE="on_node"}(qT||(qT={})),function(t){t.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",t.REQUEST_CONSTRAINTS="request_constraints"}(YT||(YT={})),function(t){t.IDLE="IDLE",t.INITING="INITING",t.INITEND="INITEND"}($T||($T={})),function(t){t.STATE_CHANGE="state_change",t.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",t.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",t.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(XT||(XT={})),function(t){t.NONE="none",t.INIT="init",t.CANPLAY="canplay",t.PLAYING="playing",t.PAUSED="paused",t.SUSPEND="suspend",t.STALLED="stalled",t.WAITING="waiting",t.ERROR="error",t.DESTROYED="destroyed",t.ABORT="abort",t.ENDED="ended",t.EMPTIED="emptied",t.LOADEDDATA="loadeddata"}(JT||(JT={}));const ZT={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var tC;!function(t){t.OPEN="open",t.MESSAGE="message",t.CLOSE="close",t.CLOSING="closing",t.ERROR="error"}(tC||(tC={}));class eC extends ny{constructor(t,e){super(),ih(this,"_ID",void 0),ih(this,"_rtpTransceiver",void 0),ih(this,"_lowRtpTransceiver",void 0),ih(this,"_hints",[]),ih(this,"_isClosed",!1),ih(this,"_originMediaStreamTrack",void 0),ih(this,"_mediaStreamTrack",void 0),ih(this,"_external",{}),this._ID=e||By(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,function(t){kr(LT).call(LT,t)||LT.push(t)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const t=rw.reportApiInvoke(null,{name:sy.GET_MEDIA_STREAM_TRACK,options:[],tag:oy.TRACER});this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?t.onSuccess(this._mediaStreamTrack.label):t.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===PT.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const e=LT.indexOf(t);-1!==e&&LT.splice(e,1)}(this),this.emit(FT.CLOSED)}_updateRtpTransceiver(t,e){if(e===PT.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(UT.TRANSCEIVER_UPDATED,t,e)}}class nC extends eC{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}constructor(t,e){super(t,e),ih(this,"_enabled",!0),ih(this,"_muted",!1),ih(this,"_isExternalTrack",!1),ih(this,"_isClosed",!1),ih(this,"_enabledMutex",void 0),ih(this,"processor",void 0),ih(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new Wy("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,e;return null!==(t=null===(e=this._originMediaStreamTrack)||void 0===e?void 0:e.label)&&void 0!==t?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,zE.debug("[".concat(this.getTrackId(),"] close")),this.emit(kT.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vy(this,kT.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){zE.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(FT.TRACK_ENDED)}stateCheck(t,e){if(zE.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(e,"]")),Fv(e,t),this._enabled&&this._muted&&"enabled"===t&&!1===e)throw new Uv(Bv.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",zE);if(!this._enabled&&!this._muted&&"muted"===t&&!0===e)throw new Uv(Bv.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",zE)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function iC(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}const rC=window.AudioContext||window.webkitAudioContext;let sC=null;const oC=new class extends ny{constructor(){super(...arguments),ih(this,"prevState",void 0),ih(this,"curState",void 0),ih(this,"currentTime",void 0),ih(this,"currentTimeStuckAt",void 0),ih(this,"interruptDetectorTrack",void 0),ih(this,"onLocalAudioTrackMute",(()=>{zE.info("ios15-interruption-start"),this.emit(hT.IOS_15_16_INTERRUPTION_START)})),ih(this,"onLocalAudioTrackUnmute",(async()=>{zE.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?zE.info("ios15-interruption-end-canceled"):(sC&&await sC.suspend(),this.emit(hT.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(t){zE.debug("webaudio bindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=t,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(t){zE.debug("webaudio unbindInterruptDetectorTrack ".concat(t.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===t&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function aC(){if(!rC)return void zE.error("your browser is not support web audio");zE.info("create audio context");const t=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?iC(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):iC(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},NE("WEBAUDIO_INIT_OPTIONS"));zE.debug("audio context init option:",JSON.stringify(t)),sC=new rC(t),oC.curState=sC.state,sC.onstatechange=()=>{oC.prevState=oC.curState,oC.curState=sC?sC.state:void 0;const{prevState:t,curState:e}=oC,n="running"===e,i="interrupted"===e,r="running"===t,s="suspended"===t,o="interrupted"===t,a=Av().osVersion;(Ev()||Lv())&&r&&i&&(zE.info("ios".concat(a,"-interruption-start")),oC.emit(hT.IOS_INTERRUPTION_START)),(Ev()||Lv())&&(s||o)&&n&&(zE.info("ios".concat(a,"-interruption-end")),oC.emit(hT.IOS_INTERRUPTION_END)),t!==e&&(zE.debug("AudioContext State Change","".concat(t,"=>").concat(e)),oC.emit(hT.STATE_CHANGE))},setInterval((()=>{var t;const e=null===(t=sC)||void 0===t?void 0:t.currentTime;oC.currentTime!==e?(oC.currentTimeStuckAt&&(zE.debug("AudioContext current time resume at ".concat(e)),oC.currentTimeStuckAt=void 0),oC.currentTime=e):(e!==oC.currentTimeStuckAt&&(rw.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:e},tag:oy.TRACER}).onSuccess(),zE.warning("AudioContext current time stuck at ".concat(e))),oC.currentTimeStuckAt=e)}),5e3),async function(t){const e=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,i=!1,r=!1,s=!1;function o(e){"running"===t.state?a(!1):Ev()||Lv()?"suspended"===t.state&&(a(!0),e&&t.resume().then(l,l)):"closed"!==t.state&&(a(!0),e&&t.resume().then(l,l))}function a(t){if(i!==t){i=t;for(let n=0,i=e;n<i.length;n+=1){const e=i[n];t?window.addEventListener(e,u,{capture:!0,passive:!0}):window.removeEventListener(e,u,{capture:!0,passive:!0})}}}function c(){o(!0)}function l(){o(!1)}function u(){o(!0)}function d(t){if(!s)if(n.paused)if(t){let e;h(!1),s=!0;try{e=n.play(),e?e.then(A,A):(n.addEventListener("playing",A),n.addEventListener("abort",A),n.addEventListener("error",A))}catch(t){A()}}else h(!0);else h(!1)}function h(t){if(r!==t){r=t;for(let n=0,i=e;n<i.length;n++){const e=i[n];t?window.addEventListener(e,p,{capture:!0,passive:!0}):window.removeEventListener(e,p,{capture:!0,passive:!0})}}}function A(){n.removeEventListener("playing",A),n.removeEventListener("abort",A),n.removeEventListener("error",A),s=!1,d(!1)}function p(){d(!0)}if(Ev()){const e=t.createMediaStreamDestination(),i=document.createElement("div");i.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=i.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=e.stream,d(!0)}oC.on(hT.STATE_CHANGE,c),o(!1)}(sC)}function cC(){if(!sC){if(aC(),!sC)throw new Uv(Bv.NOT_SUPPORTED,"can not create audio context");return sC}return sC}function lC(){return!!sC}function uC(t){if(function(){if(null!==dC)return dC;const t=cC(),e=t.createBufferSource(),n=t.createGain(),i=t.createGain();e.connect(n),e.connect(i),e.disconnect(n);let r=!1;try{e.disconnect(n)}catch(t){r=!0}return e.disconnect(),dC=r,r}())return;const e=t.connect,n=t.disconnect;t.connect=(n,i,r)=>{var s;return t._inputNodes||(t._inputNodes=[]),kr(s=t._inputNodes).call(s,n)||(n instanceof AudioNode?(t._inputNodes.push(n),e.call(t,n,i,r)):e.call(t,n,i)),t},t.disconnect=(i,r,s)=>{n.call(t),i?Sy(t._inputNodes,i):t._inputNodes=[];for(const n of t._inputNodes)e.call(t,n)}}let dC=null;function hC(t,e){let n=!1;const i=1/e;if(NE("DISABLE_WEBAUDIO")){const e=window.setInterval((()=>{n?window.clearInterval(e):t(performance.now()/1e3)}),1e3*i)}else{const e=cC();let r=e.createGain();r.gain.value=0,r.connect(e.destination);const s=()=>{if(n)return void(r=null);const o=e.createOscillator();o.onended=s,o.connect(r),o.start(0),o.stop(e.currentTime+i),t(e.currentTime)};s()}return()=>{n=!0}}const AC={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function pC(){return AC}class fC{constructor(){ih(this,"context",void 0),ih(this,"analyserNode",void 0),ih(this,"sourceNode",void 0),this.context=cC(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(t){}this.sourceNode=t,null==t||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||Ev()||Lv()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const e=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(e);for(let n=0;n<t.length;++n)t[n]=e[n]/128-1}const e=c_(t).call(t,((t,e)=>t+e*e),0)/t.length;return Math.max(10*Math.log10(e)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,e;null===(t=this.sourceNode)||void 0===t||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(e=this.sourceNode)||void 0===e||e.connect(this.analyserNode)}catch(t){zE.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class mC extends ny{get processSourceNode(){return this.sourceNode}set processedNode(t){var e;if(!this.isDestroyed&&this._processedNode!==t){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(t){}null===(e=this._processedNode)||void 0===e||e.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),ih(this,"outputNode",void 0),ih(this,"outputTrack",void 0),ih(this,"isPlayed",!1),ih(this,"context",void 0),ih(this,"audioBufferNode",void 0),ih(this,"destNode",void 0),ih(this,"audioOutputLevel",0),ih(this,"volumeLevelAnalyser",void 0),ih(this,"_processedNode",void 0),ih(this,"playNode",void 0),ih(this,"isDestroyed",!1),ih(this,"onNoAudioInput",void 0),ih(this,"isNoAudioInput",!1),ih(this,"_noAudioInputCount",0),this.context=cC(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),uC(this.outputNode),this.volumeLevelAnalyser=new fC}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=t=>{this.emit(VT.ON_AUDIO_BUFFER,function(t){for(let e=0;e<t.outputBuffer.numberOfChannels;e+=1){const n=t.outputBuffer.getChannelData(e);for(let t=0;t<n.length;t+=1)n[t]=0}return t.inputBuffer}(t))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!pC().webAudioMediaStreamDest)throw new Uv(Bv.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){"running"!==this.context.state&&Cy((()=>{oC.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(t){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Ev()||Lv()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const e=this.volumeLevelAnalyser.getAnalyserNode();let n;e.getFloatTimeDomainData?(n=new Float32Array(e.fftSize),e.getFloatTimeDomainData(n)):(n=new Uint8Array(e.fftSize),e.getByteTimeDomainData(n));let i=!1;for(let t=0;t<n.length;t++)0!==n[t]&&(i=!0);return i?(this.isNoAudioInput=!1,!0):(await Dy(200),await this.checkHasAudioInput(t?t+1:1)&&i)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,e;null===(t=this.processedNode)||void 0===t||t.disconnect(),null===(e=this.sourceNode)||void 0===e||e.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?null===(t=this.processedNode)||void 0===t||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class gC extends mC{get isFreeze(){return!1}constructor(t,e,n){var i;if(super(),ih(this,"sourceNode",void 0),ih(this,"track",void 0),ih(this,"clonedTrack",void 0),ih(this,"audioElement",void 0),ih(this,"isCurrentTrackCloned",!1),ih(this,"isRemoteTrack",!1),ih(this,"originVolumeLevelAnalyser",void 0),ih(this,"rebuildWebAudio",(async()=>{if(zE.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void zE.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>zE.info("resume success"))),zE.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const t=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?t.stop():this.isCurrentTrackCloned=!0;const e=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(e),uC(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),uC(this.outputNode),this.emit(VT.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=e,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),"audio"!==t.kind)throw new Uv(Bv.UNEXPECTED_ERROR);this.track=t;const r=new MediaStream([this.track]);if(this.isRemoteTrack=!!e,this.sourceNode=this.context.createMediaStreamSource(r),uC(this.sourceNode),n){const t=n.clone();t.enabled=!0,this.clonedTrack=t,zE.debug("create an unmuted track ".concat(t.id," from the original track ").concat(n.id," to get the volume"));const e=this.context.createMediaStreamSource(new MediaStream([t]));uC(e),this.originVolumeLevelAnalyser=new fC,this.originVolumeLevelAnalyser.updateSource(e)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=r;const s=Av();e&&s.os===av.IOS&&Number(null===(i=s.osVersion)||void 0===i?void 0:i.split(".")[0])<15&&(oC.on(hT.STATE_CHANGE,(()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((t=>{t||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const e=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(e),uC(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(VT.UPDATE_SOURCE),this.audioElement.srcObject=e}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),oC.off("state-change",this.rebuildWebAudio),null===(t=this.originVolumeLevelAnalyser)||void 0===t||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const e=t.clone();e.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=e),zE.debug("create an unmuted track ".concat(e.id," from the original track ").concat(t.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([e]));uC(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function vC(t,e,n){const i=(t,e)=>t?"number"!=typeof t?t.max||t.exact||t.ideal||t.min||e:t:e,r={audio:!!n&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxHeight:i(e.height,1080),maxWidth:i(e.width,1920)}}};return e.frameRate&&"number"!=typeof e.frameRate?(r.video.mandatory.maxFrameRate=e.frameRate.max,r.video.mandatory.minFrameRate=e.frameRate.min):"number"==typeof e.frameRate&&(r.video.mandatory.maxFrameRate=e.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function yC(t,e){const n=await _C(t.mediaSource),{sourceId:i,audio:r}=await function(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new ev(((n,i)=>{const r=document.createElement("div");r.innerText="share screen",r.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const s=document.createElement("div");s.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");const a=document.createElement("div");a.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const c=document.createElement("div");c.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const l=document.createElement("button");l.innerHTML="cancel",l.setAttribute("style","width: 85px;"),l.onclick=()=>{document.body.removeChild(h);const t=new Error("NotAllowedError");t.name="NotAllowedError",i(t)};let u=e;const d=document.createElement("div");if(e){const t=document.createElement("input");t.setAttribute("type","checkbox");const e=document.createElement("span");t.setAttribute("style","margin-right: 6px;"),e.innerText="Share audio",t.checked=u,t.onchange=()=>{u=t.checked},d.appendChild(t),d.appendChild(e)}c.appendChild(d),c.appendChild(l),s.appendChild(o),s.appendChild(a),s.appendChild(c);const h=document.createElement("div");h.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),h.appendChild(r),h.appendChild(s),document.body.appendChild(h),t.map((t=>{if(t.id){const e=document.createElement("div");e.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let i=t.thumbnail;try{const{width:t}=i.getSize();t>1920&&(i=i.resize({width:1920}))}catch(t){throw t&&t.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),t}e.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+i.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+t.name.replace(/[\u00A0-\u9999<>\&]/g,(function(t){return"&#"+t.charCodeAt(0)+";"}))+"</span>",e.onclick=()=>{document.body.removeChild(h),n({sourceId:t.id,audio:u})},a.appendChild(e)}}))}))}(n,e);return await vC(i,t,r)}async function _C(t){let e=["window","screen"];"application"!==t&&"window"!==t||(e=["window"]),"screen"===t&&(e=["screen"]);const n=ry();if(!n)throw console.error("failed to fetch electron, please mount it to window"),new Uv(Bv.ELECTRON_IS_NULL);let i=null;try{var r;i=(null===(r=n.desktopCapturer)||void 0===r?void 0:r.getSources({types:e}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:e})}catch(t){i=null}i&&i.then||(i=new ev(((t,i)=>{n.desktopCapturer.getSources({types:e},((e,n)=>{e?i(e):t(n)}))})));try{return await i}catch(t){throw new Uv(Bv.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,t.toString())}}function bC(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}const EC=new Wy("safari");let wC=!1,SC=!1;async function TC(t,e){let n=0,i=null;for(;n<2;)try{i=await CC(t,e,n>0);break}catch(t){if(t instanceof Uv)throw zE.error("[".concat(e,"] ").concat(t.toString())),t;const i=RC(t.name||t.code||t,t.message);if(i.code===Bv.MEDIA_OPTION_INVALID){zE.debug("[".concat(e,"] detect media option invalid, retry")),n+=1,await Dy(500);continue}throw zE.error("[".concat(e,"] ").concat(i.toString())),i}if(!i)throw new Uv(Bv.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return i}async function CC(t,e,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Uv(Bv.NOT_SUPPORTED,"can not find getUserMedia");n&&(t.video&&(delete t.video.width,delete t.video.height),t.screen&&(delete t.screen.width,delete t.screen.height));const i=pC(),r=new MediaStream;if(t.audioSource&&r.addTrack(t.audioSource),t.videoSource&&r.addTrack(t.videoSource),!t.audio&&!t.video&&!t.screen)return zE.debug("Using Video Source/ Audio Source"),r;if(t.screen)if(ry())t.screen.sourceId?IC(r,await vC(t.screen.sourceId,t.screen,t.screenAudio)):IC(r,await yC(t.screen,t.screenAudio));else if(yv()&&t.screen.extensionId&&t.screen.mandatory){if(!i.getStreamFromExtension)throw new Uv(Bv.NOT_SUPPORTED,"This browser does not support screen sharing");zE.debug("[".concat(e,'] Screen access on chrome stable, looking for extension"'));const n=await(o=t.screen.extensionId,a=e,new ev(((t,e)=>{try{chrome.runtime.sendMessage(o,{getStream:!0},(n=>{if(!n||!n.streamId)return zE.error("[".concat(a,"] No response from Chrome Plugin. Plugin not installed properly"),n),void e(new Uv(Bv.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));t(n.streamId)}))}catch(t){zE.error("[".concat(a,"] AgoraRTC screensharing plugin is not accessible(").concat(o,")"),t.toString()),e(new Uv(Bv.CHROME_PLUGIN_NOT_INSTALL))}})));t.screen.mandatory.chromeMediaSourceId=n,IC(r,await navigator.mediaDevices.getUserMedia({video:{mandatory:t.screen.mandatory}}))}else if(i.getDisplayMedia){var s;t.screen.mediaSource&&MT(t.screen.mediaSource);const n={width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate,displaySurface:null!==(s=t.screen.displaySurface)&&void 0!==s?s:"screen"===t.screen.mediaSource?"monitor":t.screen.mediaSource},{selfBrowserSurface:i,surfaceSwitching:o,systemAudio:a}=t.screen,c={selfBrowserSurface:i,surfaceSwitching:o,systemAudio:a};!i&&delete c.selfBrowserSurface,!o&&delete c.surfaceSwitching,!a&&delete c.systemAudio,zE.debug("[".concat(e,"] getDisplayMedia:"),JSON.stringify({video:n,audio:!!t.screenAudio,controls:c}));const l=await navigator.mediaDevices.getDisplayMedia(function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?bC(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):bC(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({video:n,audio:!!t.screenAudio},c));IC(r,l)}else{if(!bv())throw zE.error("[".concat(e,"] This browser does not support screenSharing")),new Uv(Bv.NOT_SUPPORTED,"This browser does not support screen sharing");{t.screen.mediaSource&&MT(t.screen.mediaSource);const n={video:{mediaSource:t.screen.mediaSource,width:t.screen.width,height:t.screen.height,frameRate:t.screen.frameRate}};zE.debug("[".concat(e,"] getUserMedia: ").concat(JSON.stringify(n))),IC(r,await navigator.mediaDevices.getUserMedia(n))}}var o,a;if(!t.video&&!t.audio)return r;let c={video:t.video,audio:t.audio},l=NE("MEDIA_DEVICE_CONSTRAINTS");if(l)try{"string"==typeof l&&(l=JSON.parse(l)),c=Gy(c,l)}catch(t){}zE.debug("[".concat(e,"] GetUserMedia"),JSON.stringify(c)),Av();let u,d=null;(_v()||Ev()||mv())&&(d=await EC.lock());try{u=await navigator.mediaDevices.getUserMedia(c)}catch(t){throw d&&d(),t}return c.audio&&(wC=!0),c.video&&(SC=!0),IC(r,u),d&&d(),r}function RC(t,e){switch(t){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Uv(Bv.MEDIA_OPTION_INVALID,"".concat(t,": ").concat(e));case"NotFoundError":case"DevicesNotFoundError":return new Uv(Bv.DEVICE_NOT_FOUND,"".concat(t,": ").concat(e));case"NotSupportedError":return new Uv(Bv.NOT_SUPPORTED,"".concat(t,": ").concat(e));case"NotReadableError":return new Uv(Bv.NOT_READABLE,"".concat(t,": ").concat(e));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Uv(Bv.PERMISSION_DENIED,"".concat(t,": ").concat(e));case"ConstraintNotSatisfiedError":return new Uv(Bv.CONSTRAINT_NOT_SATISFIED,"".concat(t,": ").concat(e));default:return zE.error("getUserMedia unexpected error",t),new Uv(Bv.UNEXPECTED_ERROR,"".concat(t,": ").concat(e))}}function IC(t,e){const n=t.getVideoTracks()[0],i=t.getAudioTracks()[0],r=e.getVideoTracks()[0],s=e.getAudioTracks()[0];s&&(i&&t.removeTrack(i),t.addTrack(s)),r&&(n&&t.removeTrack(n),t.addTrack(r))}const xC=new class extends ny{get state(){return this._state}set state(t){t!==this._state&&(this.emit(XT.STATE_CHANGE,t),this._state=t)}constructor(){super(),ih(this,"_state",$T.IDLE),ih(this,"isAccessMicrophonePermission",!1),ih(this,"isAccessCameraPermission",!1),ih(this,"lastAccessMicrophonePermission",!1),ih(this,"lastAccessCameraPermission",!1),ih(this,"checkdeviceMatched",!1),ih(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(NE("ENUMERATE_DEVICES_INTERVAL")||(Pv()||pv()===av.HARMONY_OS)&&Nv())&&this.updateDevicesInfo()}),NE("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((t=>zE.error(t.toString())))}async enumerateDevices(t,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Uv(Bv.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const i=await navigator.mediaDevices.enumerateDevices(),r=this.checkMediaDeviceInfoIsOk(i);let s=!this.isAccessMicrophonePermission&&t,o=!this.isAccessCameraPermission&&e;r.audio&&(s=!1),r.video&&(o=!1);let a=null,c=null,l=null;if(!n&&(s||o)){if(EC.isLocked&&(zE.debug("[device manager] wait GUM lock"),(await EC.lock())(),zE.debug("[device manager] GUM unlock")),wC&&(s=!1,this.isAccessMicrophonePermission=!0),SC&&(o=!1,this.isAccessCameraPermission=!0),zE.debug("[device manager] check media device permissions",t,e,s,o),s&&o){try{l=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(t){const e=RC(t.name||t.code||t,t.message);if(e.code===Bv.PERMISSION_DENIED)throw e;zE.warning("getUserMedia failed in getDevices",e)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(s){try{a=await navigator.mediaDevices.getUserMedia({audio:t})}catch(t){const e=RC(t.name||t.code||t,t.message);if(e.code===Bv.PERMISSION_DENIED)throw e;zE.warning("getUserMedia failed in getDevices",e)}this.isAccessMicrophonePermission=!0}else if(o){try{c=await navigator.mediaDevices.getUserMedia({video:e})}catch(t){const e=RC(t.name||t.code||t,t.message);if(e.code===Bv.PERMISSION_DENIED)throw e;zE.warning("getUserMedia failed in getDevices",e)}this.isAccessCameraPermission=!0}zE.debug("[device manager] mic permission",t,"cam permission",e)}try{const t=await navigator.mediaDevices.enumerateDevices();return a&&a.getTracks().forEach((t=>t.stop())),c&&c.getTracks().forEach((t=>t.stop())),l&&l.getTracks().forEach((t=>t.stop())),a=null,c=null,l=null,t}catch(t){return a&&a.getTracks().forEach((t=>t.stop())),c&&c.getTracks().forEach((t=>t.stop())),l&&l.getTracks().forEach((t=>t.stop())),a=null,c=null,l=null,new Uv(Bv.ENUMERATE_DEVICES_FAILED,t.toString()).throw()}}async getRecordingDevices(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter((t=>"audioinput"===t.kind))}async getCamerasDevices(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,t)).filter((t=>"videoinput"===t.kind))}async getSpeakers(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,t)).filter((t=>"audiooutput"===t.kind))}searchDeviceIdByName(t){let e=null;return this.deviceInfoMap.forEach((n=>{n.device.label===t&&(e=n.device.deviceId)})),e}async getDeviceById(t){const e=(await this.enumerateDevices(!0,!0,!0)).find((e=>e.deviceId===t));if(!e)throw new Uv(Bv.DEVICE_NOT_FOUND,"deviceId: ".concat(t));return e}async init(){this.state=$T.INITING;try{await this.updateDevicesInfo(),this.state=$T.INITEND}catch(t){throw zE.warning("Device Detection functionality cannot start properly.",t.toString()),this.state=$T.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new Uv(Bv.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),t}}async updateDevicesInfo(){const t=await this.enumerateDevices(!0,!0,!0),e=Date.now(),n=[];if(t[0]&&t[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const e=t.find((t=>"audioinput"===t.kind&&"default"===t.deviceId)),n=t.find((t=>"audiooutput"===t.kind&&"default"===t.deviceId));e&&n?n.groupId===e.groupId?zE.debug("[device-check] default input ".concat(e.label," and output ").concat(n.label," is the same group")):zE.warning("[device-check] default input ".concat(e.label," and output ").concat(n.label," is not the same group")):zE.debug("[device-check] default input or output not found")}const i=this.checkMediaDeviceInfoIsOk(t);if(t.forEach((t=>{if(!t.deviceId)return;const i=this.deviceInfoMap.get("".concat(t.kind,"_").concat(t.deviceId));if("ACTIVE"!==(i?i.state:"INACTIVE")){const i={initAt:e,updateAt:e,device:t,state:"ACTIVE"};this.deviceInfoMap.set("".concat(t.kind,"_").concat(t.deviceId),i),n.push(i)}i&&(i.updateAt=e)})),this.deviceInfoMap.forEach(((t,i)=>{"ACTIVE"===t.state&&t.updateAt!==e&&(t.state="INACTIVE",n.push(t))})),this.state!==$T.INITEND)return i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((t=>{switch(t.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(XT.RECORDING_DEVICE_CHANGED,t);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(XT.CAMERA_DEVICE_CHANGED,t);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(XT.PLAYOUT_DEVICE_CHANGED,t)}})),i.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),i.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(t){const e=t.filter((t=>"audioinput"===t.kind)),n=t.filter((t=>"videoinput"===t.kind)),i={audio:!1,video:!1};for(const t of e)if(t.label&&t.deviceId){i.audio=!0;break}for(const t of n)if(t.label&&t.deviceId){i.video=!0;break}return i}};let OC=!1;const LC=new class extends ny{constructor(){super(...arguments),ih(this,"onAutoplayFailed",void 0),ih(this,"onAudioAutoplayFailed",void 0)}};function MC(){if(Av(),!OC){const t=e=>{e.preventDefault(),OC=!1,Dv()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};OC=!0,Dv()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),zE.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),LC.onAutoplayFailed?LC.onAutoplayFailed():LC.onAudioAutoplayFailed?zE.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):zE.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),LC.emit("autoplay-failed")}}function kC(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function NC(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?kC(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kC(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function PC(t,e,n,i){if(!t)return;const r=rw.getBaseInfoBySessionId(t);if(!r)return;const s=r.info,o=Date.now(),a=NC(NC({},s),{},{vid:void 0===s.vid?0:Number(s.vid),lts:o,elapse:o-r.startTime,cbRegistered:LC.onAutoplayFailed||LC.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:e,trackId:i,extend:void 0});rw.send({type:XE.AUTOPLAY_FAILED,data:a},!0)}const DC=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],BC=new class{constructor(){ih(this,"onAutoplayFailed",void 0),ih(this,"elementMap",new Map),ih(this,"elementStateMap",new Map),ih(this,"elementsNeedToResume",[]),ih(this,"sinkIdMap",new Map),ih(this,"autoResumeAfterInterruption",(()=>{Array.from(this.elementMap.entries()).forEach((t=>{let[e,n]=t;const i=this.elementStateMap.get(e),r=n.srcObject.getAudioTracks()[0];Iv()?r&&"live"===r.readyState&&"running"===oC.curState&&(zE.debug("auto resume after interruption for iOS 15"),n.pause(),n.play()):i&&"paused"===i&&r&&"live"===r.readyState&&"running"===oC.curState&&(zE.debug("auto resume after interruption for iOS"),n.play())}))})),ih(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((t=>{let[e,n]=t;const i=n.srcObject.getAudioTracks()[0];i&&"live"===i.readyState&&(zE.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),oC.on(hT.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),oC.on(hT.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),oC.on(hT.STATE_CHANGE,(()=>{Ev()&&"suspended"===oC.prevState&&"running"===oC.curState&&this.autoResumeAfterInterruption()}))}async setSinkID(t,e){const n=this.elementMap.get(t);if(this.sinkIdMap.set(t,e),n)try{await n.setSinkId(e)}catch(t){throw new Uv(Bv.PERMISSION_DENIED,"can not set sink id: "+t.toString())}}play(t,e,n,i){if(this.elementMap.has(e))return;const r=document.createElement("audio");r.autoplay=!0,r.srcObject=new MediaStream([t]),this.bindAudioElementEvents(e,r),this.elementMap.set(e,r),this.elementStateMap.set(e,JT.INIT),this.setVolume(e,n);const s=this.sinkIdMap.get(e);if(s)try{r.setSinkId(s).catch((t=>{zE.warning("[".concat(e,"] set sink id failed"),t.toString())}))}catch(t){zE.warning("[".concat(e,"] set sink id failed"),t.toString())}const o=r.play();o&&o.then&&o.catch((t=>{i&&PC(i,"audio",t.message,e),zE.warning("audio element play warning",t.toString()),this.elementMap.has(e)&&"NotAllowedError"===t.name&&(zE.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(r),Cy((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),MC()})))}))}updateTrack(t,e){const n=this.elementMap.get(t);n&&(n.srcObject=new MediaStream([e]))}isPlaying(t){return this.elementMap.has(t)&&"playing"===this.elementStateMap.get(t)}setVolume(t,e){const n=this.elementMap.get(t);n&&(e=Math.max(0,Math.min(100,e)),n.volume=e/100)}stop(t){const e=this.elementMap.get(t);if(this.sinkIdMap.delete(t),!e)return;const n=this.elementsNeedToResume.indexOf(e);this.elementsNeedToResume.splice(n,1),e.srcObject=null,e.remove(),this.elementMap.delete(t),this.elementStateMap.delete(t)}bindAudioElementEvents(t,e){DC.forEach((n=>{e.addEventListener(n,(n=>{const i=this.elementStateMap.get(t),r="pause"===n.type?"paused":n.type;if(zE.debug("[".concat(t,"] audio-element-status change ").concat(i," => ").concat(r)),"error"===n.type){const n=null==e?void 0:e.error;n&&zE.error("[".concat(t,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(t,r)}))}))}getPlayerState(t){return this.elementStateMap.get(t)||"uninit"}autoResumeAudioElement(){const t=()=>{this.elementsNeedToResume.forEach((t=>{t.play().then((t=>{zE.debug("Auto resume audio element success")})).catch((t=>{zE.warning("Auto resume audio element failed!",t)}))})),this.elementsNeedToResume=[]};new ev((t=>{document.body?t():window.addEventListener("load",(()=>t()))})).then((()=>{Dv()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0))}))}};function UC(){return function(t,e,n){const i=n.value;return"function"==typeof i&&(n.value=function(){this._isClosed&&new Uv(Bv.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",zE);for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=i.apply(this,e);return r instanceof ev?new ev(((t,e)=>{r.then(t).catch(e)})):r}),n}}function FC(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function HC(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?FC(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):FC(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class VC extends ny{constructor(t){super(),ih(this,"name","VideoProcessorDestination"),ih(this,"ID","0"),ih(this,"_source",void 0),ih(this,"videoContext",void 0),ih(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Uv(Bv.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Uv(Bv.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(qT.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(qT.ON_TRACK,void 0)}}class jC extends ny{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,e){super(),ih(this,"constraintsMap",new Map),ih(this,"statsRegistry",[]),ih(this,"usageRegistry",[]),ih(this,"trackId",void 0),ih(this,"direction",void 0),ih(this,"_chained",!1),this.trackId=t,this.direction=e}async getConstraints(){return await gy(this,YT.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,e){var n;return zE.info("processor ".concat(e.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(e,t),vy(this,YT.REQUEST_UPDATE_CONSTRAINTS,Array.from(Nw(n=this.constraintsMap).call(n)))}async requestRevertConstraints(t){var e;if(this.constraintsMap.has(t))return zE.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),vy(this,YT.REQUEST_UPDATE_CONSTRAINTS,Array.from(Nw(e=this.constraintsMap).call(e)))}registerStats(t,e,n){this.statsRegistry.find((n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===e))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:e,cb:n})}unregisterStats(t,e){const n=this.statsRegistry.findIndex((n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===e));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const t=[];for(const{processorID:e,processorName:n,type:i,cb:r}of this.statsRegistry)try{const s=r();t.push({processorID:e,processorName:n,type:i,stats:s})}catch(t){zE.error(new Uv(Bv.UNEXPECTED_ERROR,t.message))}return t}registerUsage(t,e){this.usageRegistry.find((e=>e.processorID===t.ID&&e.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:e})}unregisterUsage(t){const e=this.usageRegistry.findIndex((e=>e.processorID===t.ID&&e.processorName===t.name));-1!==e&&this.usageRegistry.splice(e,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:e}of this.usageRegistry)try{let n=e();n instanceof ev&&(n=await n),t.push(HC(HC({},n),{},{direction:this.direction}))}catch(t){zE.error("gather extension usage error",t)}return t}getDirection(){return this.direction}}class GC extends ny{constructor(t){super(),ih(this,"name","AudioProcessorDestination"),ih(this,"ID","0"),ih(this,"inputTrack",void 0),ih(this,"inputNode",void 0),ih(this,"audioProcessorContext",void 0),ih(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Uv(Bv.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Uv(Bv.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(qT.ON_TRACK,void 0),this.emit(qT.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(qT.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(qT.ON_NODE,this.inputNode))}}class QC extends ny{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,e,n){super(),ih(this,"constraintsMap",new Map),ih(this,"statsRegistry",[]),ih(this,"audioContext",void 0),ih(this,"trackId",void 0),ih(this,"direction",void 0),ih(this,"usageRegistry",[]),ih(this,"_chained",!1),this.audioContext=t,this.trackId=e,this.direction=n}async getConstraints(){return gy(this,YT.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,e){var n;return zE.info("processor ".concat(e.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(e,t),vy(this,YT.REQUEST_UPDATE_CONSTRAINTS,Array.from(Nw(n=this.constraintsMap).call(n)))}async requestRevertConstraints(t){var e;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),vy(this,YT.REQUEST_UPDATE_CONSTRAINTS,Array.from(Nw(e=this.constraintsMap).call(e)))}registerStats(t,e,n){this.statsRegistry.find((n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===e))||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:e,cb:n})}unregisterStats(t,e){const n=this.statsRegistry.findIndex((n=>n.processorID===t.ID&&n.processorName===t.name&&n.type===e));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const t=[];for(const{processorID:e,processorName:n,type:i,cb:r}of this.statsRegistry)try{const s=r();t.push({processorID:e,processorName:n,type:i,stats:s})}catch(t){zE.error(new Uv(Bv.UNEXPECTED_ERROR,t.message))}return t}registerUsage(t,e){this.usageRegistry.find((e=>e.processorID===t.ID&&e.processorName===t.name))||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:e})}unregisterUsage(t){const e=this.usageRegistry.findIndex((e=>e.processorID===t.ID&&e.processorName===t.name));-1!==e&&this.usageRegistry.splice(e,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:e}of this.usageRegistry)try{let n=e();n instanceof ev&&(n=await n),t.push(HC(HC({},n),{},{direction:this.direction}))}catch(t){zE.error("gather extension usage error",t)}return t}getDirection(){return this.direction}}class zC extends ny{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),ih(this,"context",void 0),ih(this,"processSourceNode",void 0),ih(this,"outputTrack",void 0),ih(this,"processedNode",void 0),ih(this,"clonedTrack",void 0),ih(this,"outputNode",void 0),this.outputNode=new WC}setVolume(){}createOutputTrack(){throw new Uv(Bv.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class WC{disconnect(){}connect(){}}let KC=null;class qC{constructor(){ih(this,"state","open"),ih(this,"trigger",void 0),ih(this,"tasks",[]),zE.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout((()=>{this.state="closed",zE.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map((t=>t.key)),"]")),this.trigger=void 0,this.tasks.forEach((t=>{let{func:e}=t;return e()})),this.tasks.length=0,zE.debug("[macro-task-queue] is closed.")}))}enqueue(t,e){"closed"!==this.state&&(this.tasks.push({key:t,func:e}),zE.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof t?t:"")))}runTask(t){if("closed"===this.state)return;const e=this.tasks.findIndex((e=>e.key===t));if(-1!==e){const n=this.tasks.splice(e,1);zE.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof t?t:"")),n[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,zE.debug("[macro-task-queue] is closed."))}}function YC(t){return function(e,n,i){var r;const s=null!==(r=i.value)&&void 0!==r?r:i.get,o=function(){KC&&"open"===KC.state&&KC.runTask(t);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return null==s?void 0:s.apply(this,...n)};return i.value?i.value=o:i.get=o,i}}function $C(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function XC(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?$C(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):$C(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class JC extends nC{get _source(){return this._trackSource}set _source(t){this._trackSource=t}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get processorDestination(){return this._processorDestination}set processorDestination(t){this._processorDestination=t}get isPlaying(){return this._useAudioElement?BC.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(t,e,n,i,r){super(t,n),ih(this,"trackMediaType","audio"),ih(this,"_encoderConfig",void 0),ih(this,"_trackSource",void 0),ih(this,"_enabled",!0),ih(this,"_volume",100),ih(this,"_useAudioElement",!1),ih(this,"_bypassWebAudio",!1),ih(this,"processor",void 0),ih(this,"_processorContext",void 0),ih(this,"_processorDestination",void 0),ih(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=e,this._getOriginVolumeLevel=!!i;const s=()=>{this.processorContext=new QC(this._source.context,this.getTrackId(),"local"),this.processorDestination=new GC(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(VT.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))},o=r&&_v()&&!lC();NE("DISABLE_WEBAUDIO")?(this._source=new zC,this._useAudioElement=!0,this._bypassWebAudio=!0):o?this._source=new zC:(this._source=new gC(t,!1,this._getOriginVolumeLevel?t:void 0),NE("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),s(),!NE("DISABLE_WEBAUDIO")&&o&&(KC||(KC=new qC),KC).enqueue("INIT_WEBAUDIO",(()=>{this._source=new gC(t,!1,this._getOriginVolumeLevel?t:void 0),NE("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),s(),this.emit(jT.UPDATE_TRACK_SOURCE)}))}setVolume(t){Vv(t,"volume",0,1e3),this._volume=t,this._source.setVolume(t/100),this._useAudioElement&&BC.setVolume(this.getTrackId(),t);try{if(this._bypassWebAudio)return void zE.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,vy(this,kT.NEED_REPLACE_TRACK,this).then((()=>{zE.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((t=>{zE.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),t)})))}catch(t){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(t){if(!this._useAudioElement)throw new Uv(Bv.NOT_SUPPORTED,"your browser does not support setting the audio output device");await BC.setSinkID(this.getTrackId(),t)}async setEnabled(t,e,n){return this._setEnabled(t,e,n)}async _setEnabled(t,e,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(zE.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await vy(this,kT.NEED_ENABLE_TRACK,this),zE.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(t," success"))}catch(t){throw n||(this._enabled=!1),zE.error("[".concat(this.getTrackId(),"] setEnabled to true error"),t.toString()),t}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await vy(this,kT.NEED_DISABLE_TRACK,this)}catch(t){throw n||(this._enabled=!0),zE.error("[".concat(this.getTrackId(),"] setEnabled to false error"),t.toString()),t}}}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,zE.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await vy(this,kT.NEED_MUTE_TRACK,this):await vy(this,kT.NEED_UNMUTE_TRACK,this))}getStats(){return Oy((()=>{zE.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning"),yy(this,kT.GET_STATS)||XC({},GT)}setAudioFrameCallback(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!t)return this._source.removeAllListeners(VT.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(VT.ON_AUDIO_BUFFER),this._source.on(VT.ON_AUDIO_BUFFER,(e=>t(e)))}play(){zE.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(zE.debug("[".concat(this.getTrackId(),"] start audio playback in element")),BC.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){zE.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?BC.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];zE.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&BC.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(t,e){this._originMediaStreamTrack!==t&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e&&this._originMediaStreamTrack.stop()),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:t,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vy(this,kT.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(t))}renewMediaStreamTrack(t){return ev.resolve(void 0)}pipe(t){if(this._bypassWebAudio)throw new Uv(Bv.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===t)return t;if(t._source)throw new Uv(Bv.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(!this.processor)return;const e=this.processor;null===(t=this._source.processSourceNode)||void 0===t||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qT.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t),await vy(this,kT.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vy(this,kT.NEED_REPLACE_TRACK,this))})),this.processorDestination.on(qT.ON_NODE,(t=>{this._source.processedNode=t}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qT.ON_TRACK),this.processorDestination.removeAllListeners(qT.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(YT.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(YT.REQUEST_CONSTRAINTS)}}Pw([YC("INIT_WEBAUDIO"),Dw("design:type",Object),Dw("design:paramtypes",[Object])],JC.prototype,"_source",null),Pw([YC("INIT_WEBAUDIO"),Dw("design:type",QC),Dw("design:paramtypes",[QC])],JC.prototype,"processorContext",null),Pw([YC("INIT_WEBAUDIO"),Dw("design:type",GC),Dw("design:paramtypes",[GC])],JC.prototype,"processorDestination",null),Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),Dw("design:type",Function),Dw("design:paramtypes",[Number]),Dw("design:returntype",void 0)],JC.prototype,"setVolume",null),Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],JC.prototype,"setPlaybackDevice",null),Pw([Ky("LocalAudioTrack","_enabledMutex"),iw({argsMap:(t,e)=>[t.getTrackId(),e]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Boolean,Object,Boolean]),Dw("design:returntype",ev)],JC.prototype,"setEnabled",null),Pw([Ky("LocalAudioTrack","_enabledMutex"),iw({argsMap:(t,e)=>[t.getTrackId(),e]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Boolean]),Dw("design:returntype",ev)],JC.prototype,"setMuted",null),Pw([UC(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",Object)],JC.prototype,"getStats",null),Pw([UC(),Dw("design:type",Function),Dw("design:paramtypes",[Object,Number]),Dw("design:returntype",void 0)],JC.prototype,"setAudioFrameCallback",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],JC.prototype,"play",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],JC.prototype,"stop",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],JC.prototype,"close",null),Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",Object)],JC.prototype,"pipe",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],JC.prototype,"unpipe",null);class ZC extends JC{get __className__(){return"MicrophoneAudioTrack"}constructor(t,e,n,i){super(t,e.encoderConfig?OT(e.encoderConfig):{},i,NE("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),ih(this,"_config",void 0),ih(this,"_deviceName","default"),ih(this,"_constraints",void 0),ih(this,"_originalConstraints",void 0),ih(this,"_enabled",!0),this._config=e,this._constraints=n,this._originalConstraints=n,this._deviceName=t.label,"boolean"==typeof e.bypassWebAudio&&(this._bypassWebAudio=e.bypassWebAudio),(Iv()||xv())&&oC.bindInterruptDetectorTrack(this),this.on(jT.UPDATE_TRACK_SOURCE,(()=>{this.bindProcessorContextEvents()})),lC()&&this.bindProcessorContextEvents()}async setDevice(t){if(zE.info("[".concat(this.getTrackId(),"] start set device to ").concat(t)),this._enabled)try{const e=await xC.getDeviceById(t),n={};n.audio=XC({},this._constraints),n.audio.deviceId={exact:t},this._originMediaStreamTrack.stop();let i=null;try{i=await TC(n,this.getTrackId())}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setDevice failed"),t.toString()),i=await TC({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(i.getAudioTracks()[0],!1),this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const e=await xC.getDeviceById(t);this._deviceName=e.label,this._config.microphoneId=t,this._constraints.deviceId={exact:t}}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}zE.info("[".concat(this.getTrackId(),"] set device to ").concat(t," success"))}async setEnabled(t,e,n){if(e)return zE.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(t);if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(zE.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){var i;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(i=this._source.clonedTrack)||void 0===i||i.stop(),n||(this._enabled=!1);try{await vy(this,kT.NEED_DISABLE_TRACK,this)}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setEnabled false failed"),t.toString()),t}return}const r=XC({},this._constraints),s=xC.searchDeviceIdByName(this._deviceName);s&&!r.deviceId&&(r.deviceId=s);try{n||(this._enabled=!0);const t=await TC({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(t.getAudioTracks()[0],!1),await vy(this,kT.NEED_ENABLE_TRACK,this)}catch(t){throw n||(this._enabled=!1),zE.error("[".concat(this.getTrackId(),"] setEnabled true failed"),t.toString()),t}zE.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Iv()||xv())&&oC.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Ev()||Lv())&&this._enabled&&!this._isClosed&&oC.duringInterruption){const t=async()=>{oC.off(hT.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(zE.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};oC.on(hT.IOS_INTERRUPTION_END,t)}else zE.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(FT.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=xC.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId=n),this._constraints=e,this._enabled){this._originMediaStreamTrack.stop();const t=await TC({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(t.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(YT.REQUEST_UPDATE_CONSTRAINTS,(async(t,e,n)=>{try{const n=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(n),e()}catch(t){n(t)}})),this.processorContext.on(YT.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}}Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],ZC.prototype,"setDevice",null),Pw([Ky("MicrophoneAudioTrack","_enabledMutex"),iw({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Boolean,Boolean,Boolean]),Dw("design:returntype",ev)],ZC.prototype,"setEnabled",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],ZC.prototype,"close",null);class tR extends JC{get __className__(){return"BufferSourceAudioTrack"}constructor(t,e,n,i){super(e.createOutputTrack(),n,i),ih(this,"source",void 0),ih(this,"_bufferSource",void 0),this.source=t,this._bufferSource=e,this._bufferSource.on(VT.AUDIO_SOURCE_STATE_CHANGE,(t=>{this.safeEmit(FT.SOURCE_STATE_CHANGE,t)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(t){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(t){t&&this._bufferSource.updateOptions(t),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(t){this._bufferSource.seekAudioBuffer(t)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(t){Vv(t,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(t)}}Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e,t.duration]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",void 0)],tR.prototype,"startProcessAudioBuffer",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],tR.prototype,"pauseProcessAudioBuffer",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Number]),Dw("design:returntype",void 0)],tR.prototype,"seekAudioBuffer",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],tR.prototype,"resumeProcessAudioBuffer",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],tR.prototype,"stopProcessAudioBuffer",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],tR.prototype,"close",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Number]),Dw("design:returntype",void 0)],tR.prototype,"setAudioBufferPlaybackSpeed",null);class eR extends JC{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=cC().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,By(8,"track-mix-")),ih(this,"trackList",void 0),ih(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(t){}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return-1!==this.trackList.indexOf(t)}addAudioTrack(t){-1===this.trackList.indexOf(t)?(zE.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):zE.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(-1!==this.trackList.indexOf(t)){zE.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch(t){}Sy(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach((e=>{e._encoderConfig&&((e._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=e._encoderConfig.bitrate),(e._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=e._encoderConfig.sampleRate),(e._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=e._encoderConfig.sampleSize),e._encoderConfig.stereo&&(t.stereo=!0))})),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach((e=>{e instanceof eR?e.emit(UT.TRANSCEIVER_UPDATED,t):e._updateRtpTransceiver(t)})))}}function nR(t){const e={};t.facingMode&&(e.facingMode=t.facingMode),t.cameraId&&(e.deviceId={exact:t.cameraId});const n=CT(t.encoderConfig);return null!=n.width&&(e.width=n.width),null!=n.height&&(e.height=n.height),!kv()&&n.frameRate&&(e.frameRate=n.frameRate),Av().name===cv.EDGE&&"object"==typeof e.frameRate&&(e.frameRate.max=60),bv()&&(e.frameRate={ideal:30,max:30}),e}function iR(t){const e={};if(kv()||(void 0!==t.AGC&&(e.autoGainControl=t.AGC),void 0!==t.AEC&&(e.echoCancellation=t.AEC),void 0!==t.ANS&&(e.noiseSuppression=t.ANS,yv()&&t.ANS&&(e.googHighpassFilter=t.ANS))),t.encoderConfig){const n=OT(t.encoderConfig);e.channelCount=n.stereo?2:1,e.sampleRate=n.sampleRate,e.sampleSize=n.sampleSize}return t.microphoneId&&(e.deviceId={exact:t.microphoneId}),Pv()&&(e.sampleRate=void 0),e}class rR extends mC{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(VT.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),ih(this,"audioBuffer",void 0),ih(this,"sourceNode",void 0),ih(this,"startPlayTime",0),ih(this,"startPlayOffset",0),ih(this,"pausePlayTime",0),ih(this,"options",void 0),ih(this,"currentLoopCount",0),ih(this,"currentPlaybackSpeed",100),ih(this,"_currentState","stopped"),this.audioBuffer=t,this.options=e,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(t){"stopped"===this.currentState?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):zE.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=t,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(t){}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(t){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const sR=new Map;async function oR(t,e){let n=null;if("string"==typeof t){const e=sR.get(t);if(e)return zE.debug("use cached audio resource: ",t),e;try{n=(await $y((()=>fE.get(t,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(t){throw new Uv(Bv.FETCH_AUDIO_FILE_FAILED,t.toString())}}else{const e=new ev(((e,n)=>{const i=new FileReader;i.onload=t=>{t.target?e(t.target.result):n(new Uv(Bv.READ_LOCAL_AUDIO_FILE_ERROR))},i.onerror=()=>{n(new Uv(Bv.READ_LOCAL_AUDIO_FILE_ERROR))},i.readAsArrayBuffer(t)}));n=await e}const i=await function(t){const e=cC();return new ev(((n,i)=>{e.decodeAudioData(t,(t=>{n(t)}),(t=>{i(new Uv(Bv.DECODE_AUDIO_FILE_FAILED,t.toString()))}))}))}(n);return"string"==typeof t&&e&&sR.set(t,i),i}const aR=t=>{const e=document.createElement("canvas");return e.width=2,e.height=2,new ev(((n,i)=>{e.toBlob((async t=>{if(e.remove(),t){const i=await cR(t);n({buffer:i,width:e.width,height:e.height})}else i(new Uv(Bv.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,1)}))},cR=async t=>{const e=await t.arrayBuffer();return new Uint8Array(e)},lR=new class extends ny{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),ih(this,"_lastHiddenTime",0),ih(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),zE.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};function uR(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function dR(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?uR(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):uR(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class hR{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(zE.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}constructor(t){ih(this,"trackId",void 0),ih(this,"config",void 0),ih(this,"onFirstVideoFrameDecoded",void 0),ih(this,"freezeTimeCounterList",[]),ih(this,"renderFreezeAccTime",0),ih(this,"isKeepLastFrame",!1),ih(this,"timeUpdatedCount",0),ih(this,"freezeTime",0),ih(this,"playbackTime",0),ih(this,"lastTimeUpdatedTime",0),ih(this,"autoplayFailed",!1),ih(this,"videoTrack",void 0),ih(this,"videoElement",void 0),ih(this,"cacheVideoElement",void 0),ih(this,"videoElementCheckInterval",void 0),ih(this,"_videoElementStatus",JT.NONE),ih(this,"isGettingVideoDimensions",!1),ih(this,"startGetVideoDimensions",(()=>{const t=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return zE.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(t,500)};!this.isGettingVideoDimensions&&t()})),ih(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===oC.curState&&(zE.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(fv())),Ov()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),ih(this,"handleVideoEvents",(t=>{switch(t.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=JT.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(t){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=JT.CANPLAY;break;case"stalled":this.videoElementStatus=JT.STALLED;break;case"suspend":this.videoElementStatus=JT.SUSPEND;break;case"pause":this.videoElementStatus=JT.PAUSED,Ev()||Lv()||_v()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(zE.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=JT.WAITING;break;case"abort":this.videoElementStatus=JT.ABORT;break;case"ended":this.videoElementStatus=JT.ENDED;break;case"emptied":this.videoElementStatus=JT.EMPTIED;break;case"error":{this.videoElementStatus=JT.ERROR;const t=this.videoElement.error;t&&zE.error("[".concat(this.trackId,"] media error, code: ").concat(t.code,", message: ").concat(t.message));break}case"timeupdate":{const t=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=t);const e=t-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=t,lR.lastVisibleTime<lR.lastHiddenTime||n<lR.lastHiddenTime||n<lR.lastVisibleTime)return;for(e>NE("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=e),this.playbackTime+=e;this.playbackTime>=6e3;){this.playbackTime-=6e3;const t=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(t),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),ih(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(zE.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(fv())),Ov()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),oC.on(hT.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),oC.on(hT.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return null!==(t=this.videoElement.parentElement)&&void 0!==t?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const e=this.videoElement.play();e&&e.catch&&e.catch((e=>{t&&PC(t,"video",e.message,this.trackId),"NotAllowedError"===e.name?(zE.warning("detected video element autoplay failed",e),this.autoplayFailed=!0,this.handleAutoPlayFailed()):zE.warning("[".concat(this.trackId,"] play warning: "),e)}));const n=Av();if(("Safari"===n.name&&15===Number(n.version)||Iv())&&e&&e.then){const t=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};e.then(t).catch(t)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const e=t.getContext("2d");if(!e)return zE.error("create canvas context failed!"),new ImageData(2,2);e.drawImage(this.videoElement,0,0,t.width,t.height);const n=e.getImageData(0,0,t.width,t.height);return t.remove(),n}async getCurrentFrameToUint8Array(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const i=n.getContext("2d");return i?(i.drawImage(this.videoElement,0,0,n.width,n.height),new ev(((i,r)=>{n.toBlob((async t=>{if(n.remove(),t){const e=await cR(t);i({buffer:e,width:n.width,height:n.height})}else r(new Uv(Bv.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),t,e<0?.1:e>1?1:e)}))):await aR(t)}destroy(){oC.off(hT.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),oC.off(hT.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=JT.INIT,!this.videoElementCheckInterval&&(AR.forEach((t=>{this.videoElement.addEventListener(t,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{(function(t){return t!==document.body&&document.body.contains(t)})(this.videoElement)||(this.videoElementStatus=JT.DESTROYED)}),1e3),NE("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,e;let n;const i=(t,e)=>{if(this.videoElementStatus===JT.PLAYING){if(n){const t=e.presentationTime-n.presentationTime;t>NE("VIDEO_FREEZE_DURATION")&&lR.lastVisibleTime>=lR.lastHiddenTime&&n.timestamp>lR.lastVisibleTime&&n.timestamp>lR.lastHiddenTime&&(this.renderFreezeAccTime+=t)}n=dR(dR({},e),{},{timestamp:t})}var r,s;NE("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(r=(s=this.videoElement).requestVideoFrameCallback)||void 0===r||r.call(s,i))};null===(t=(e=this.videoElement).requestVideoFrameCallback)||void 0===t||t.call(e,i)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Pv()&&(this.videoElement.poster="noposter");const n=Av();"Safari"===n.name&&15===Number(n.version)||Iv()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,bv()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,bv()&&this.videoElement.load());const i=this.videoElement.play();void 0!==i&&i.catch((t=>{zE.debug("[".concat(this.trackId,"] playback interrupted"),t.toString())}))}resetVideoElement(){AR.forEach((t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=JT.NONE}handleAutoPlayFailed(){const t=e=>{e.preventDefault(),this.videoElement.play().then((()=>{zE.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((t=>{zE.error(t)})),this.autoplayFailed=!1,Dv()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Dv()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),MC()}}const AR=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class pR extends hR{constructor(t){super(t),ih(this,"container",void 0),ih(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const e=t.element;e!==this.slot&&(this.destroy(),this.slot=e),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var e;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,n):await aR(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(t){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",NE("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if(null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(t){}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function fR(t){return new ev(((e,n)=>{let i=!1;const r=document.createElement("video");r.setAttribute("autoplay",""),r.setAttribute("muted",""),r.muted=!0,r.autoplay=!0,r.setAttribute("playsinline",""),r.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(r);const s=Ev()?"canplay":"playing";r.addEventListener(s,(()=>{const t=r.videoWidth,n=r.videoHeight;!t&&bv()||(i=!0,r.srcObject=null,r.remove(),e([t,n]))})),r.srcObject=new MediaStream([t]),r.play().catch(Fy),setTimeout((()=>{i||(r.srcObject=null,r.remove(),e([r.videoWidth,r.videoHeight]))}),4e3)}))}const mR=async(t,e,n)=>{const i=function(t){const e=[];for(let n=0;n<t.length;n+=2)e.push(parseInt(t.slice(n,n+2),16));return Uint8Array.from(e)}(function(t){const e="0123456789abcdef";function n(t){let n,i="";for(n=0;n<=3;n++)i+=e.charAt(t>>8*n+4&15)+e.charAt(t>>8*n&15);return i}function i(t,e){const n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function r(t,e,n,r,s,o){return i(function(t,e){return t<<e|t>>>32-e}(i(i(e,t),i(r,o)),s),n)}function s(t,e,n,i,s,o,a){return r(e&n|~e&i,t,e,s,o,a)}function o(t,e,n,i,s,o,a){return r(e&i|n&~i,t,e,s,o,a)}function a(t,e,n,i,s,o,a){return r(e^n^i,t,e,s,o,a)}function c(t,e,n,i,s,o,a){return r(n^(e|~i),t,e,s,o,a)}const l=function(t){let e;const n=1+(t.length+8>>6),i=new Array(16*n);for(e=0;e<16*n;e++)i[e]=0;for(e=0;e<t.length;e++)i[e>>2]|=t.charCodeAt(e)<<e%4*8;return i[e>>2]|=128<<e%4*8,i[16*n-2]=8*t.length,i}(t);let u,d,h,A,p,f=1732584193,m=-271733879,g=-1732584194,v=271733878;for(u=0;u<l.length;u+=16)d=f,h=m,A=g,p=v,f=s(f,m,g,v,l[u+0],7,-680876936),v=s(v,f,m,g,l[u+1],12,-389564586),g=s(g,v,f,m,l[u+2],17,606105819),m=s(m,g,v,f,l[u+3],22,-1044525330),f=s(f,m,g,v,l[u+4],7,-176418897),v=s(v,f,m,g,l[u+5],12,1200080426),g=s(g,v,f,m,l[u+6],17,-1473231341),m=s(m,g,v,f,l[u+7],22,-45705983),f=s(f,m,g,v,l[u+8],7,1770035416),v=s(v,f,m,g,l[u+9],12,-1958414417),g=s(g,v,f,m,l[u+10],17,-42063),m=s(m,g,v,f,l[u+11],22,-1990404162),f=s(f,m,g,v,l[u+12],7,1804603682),v=s(v,f,m,g,l[u+13],12,-40341101),g=s(g,v,f,m,l[u+14],17,-1502002290),m=s(m,g,v,f,l[u+15],22,1236535329),f=o(f,m,g,v,l[u+1],5,-165796510),v=o(v,f,m,g,l[u+6],9,-1069501632),g=o(g,v,f,m,l[u+11],14,643717713),m=o(m,g,v,f,l[u+0],20,-373897302),f=o(f,m,g,v,l[u+5],5,-701558691),v=o(v,f,m,g,l[u+10],9,38016083),g=o(g,v,f,m,l[u+15],14,-660478335),m=o(m,g,v,f,l[u+4],20,-405537848),f=o(f,m,g,v,l[u+9],5,568446438),v=o(v,f,m,g,l[u+14],9,-1019803690),g=o(g,v,f,m,l[u+3],14,-187363961),m=o(m,g,v,f,l[u+8],20,1163531501),f=o(f,m,g,v,l[u+13],5,-1444681467),v=o(v,f,m,g,l[u+2],9,-51403784),g=o(g,v,f,m,l[u+7],14,1735328473),m=o(m,g,v,f,l[u+12],20,-1926607734),f=a(f,m,g,v,l[u+5],4,-378558),v=a(v,f,m,g,l[u+8],11,-2022574463),g=a(g,v,f,m,l[u+11],16,1839030562),m=a(m,g,v,f,l[u+14],23,-35309556),f=a(f,m,g,v,l[u+1],4,-1530992060),v=a(v,f,m,g,l[u+4],11,1272893353),g=a(g,v,f,m,l[u+7],16,-155497632),m=a(m,g,v,f,l[u+10],23,-1094730640),f=a(f,m,g,v,l[u+13],4,681279174),v=a(v,f,m,g,l[u+0],11,-358537222),g=a(g,v,f,m,l[u+3],16,-722521979),m=a(m,g,v,f,l[u+6],23,76029189),f=a(f,m,g,v,l[u+9],4,-640364487),v=a(v,f,m,g,l[u+12],11,-421815835),g=a(g,v,f,m,l[u+15],16,530742520),m=a(m,g,v,f,l[u+2],23,-995338651),f=c(f,m,g,v,l[u+0],6,-198630844),v=c(v,f,m,g,l[u+7],10,1126891415),g=c(g,v,f,m,l[u+14],15,-1416354905),m=c(m,g,v,f,l[u+5],21,-57434055),f=c(f,m,g,v,l[u+12],6,1700485571),v=c(v,f,m,g,l[u+3],10,-1894986606),g=c(g,v,f,m,l[u+10],15,-1051523),m=c(m,g,v,f,l[u+1],21,-2054922799),f=c(f,m,g,v,l[u+8],6,1873313359),v=c(v,f,m,g,l[u+15],10,-30611744),g=c(g,v,f,m,l[u+6],15,-1560198380),m=c(m,g,v,f,l[u+13],21,1309151649),f=c(f,m,g,v,l[u+4],6,-145523070),v=c(v,f,m,g,l[u+11],10,-1120210379),g=c(g,v,f,m,l[u+2],15,718787259),m=c(m,g,v,f,l[u+9],21,-343485551),f=i(f,d),m=i(m,h),g=i(g,A),v=i(v,p);return n(f)+n(m)+n(g)+n(v)}(""+e+n)).slice(0,16),r=i.slice(0,12),s=await window.crypto.subtle.importKey("raw",i,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:r},s,t))},gR=async(t,e,n)=>await mR(t.buffer,e,n);function vR(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function yR(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?vR(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):vR(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class _R extends nC{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==JT.PLAYING)}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,e,n,i,r,s){if(super(t,r),ih(this,"trackMediaType","video"),ih(this,"_player",void 0),ih(this,"isUseScaleResolutionDownBy",!1),ih(this,"_videoVisibleTimer",null),ih(this,"_statsTimer",null),ih(this,"_previousVideoVisibleStatus",void 0),ih(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),ih(this,"_encoderConfig",void 0),ih(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),ih(this,"_optimizationMode",void 0),ih(this,"_videoHeight",void 0),ih(this,"_videoWidth",void 0),ih(this,"_forceBitrateLimit",void 0),ih(this,"_enabled",!0),ih(this,"processorDestination",void 0),ih(this,"_processorContext",void 0),_v()){const{width:e,height:n}=t.getSettings();this._videoWidth=e,this._videoHeight=n}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=e,this._scalabilityMode=n,this._optimizationMode=i,this._hints=s||[],-1===this._hints.indexOf(NT.SCREEN_TRACK))this.updateBitrateFromProfile();else if(function(t,e,n){const i=Av();return!(i.name!==t||!i.osVersion)&&(n?Number(i.version)>=e&&Number(i.version)<=n:Number(i.version)===e)}(cv.CHROME,115)&&-1!==pv().indexOf("Windows")){const e=function(t,e){if("VideoFrame"in window&&"TransformStream"in window&&pC().supportWebRTCInsertableStream){const n=new MediaStreamTrackProcessor(t),i=new MediaStreamTrackGenerator({kind:"video"});let r,s,o=Date.now();const a=()=>{c&&(clearInterval(c),c=void 0),r&&(r.close(),r=void 0),t.stop(),s=void 0,i.removeEventListener("ended",a)};let c=window.setInterval((()=>{if(s&&r&&Date.now()-o>(null!=e?e:1e3))try{"live"===i.readyState?s.enqueue(r.clone()):a()}catch(t){a()}}),null!=e?e:1e3);const l=new TransformStream({transform:(t,e)=>{"live"===i.readyState?(s=e,o=Date.now(),void 0===r?(r=t,e.enqueue(t.clone())):(e.enqueue(r),r=t)):t.close()}});return i.addEventListener("ended",a),n.readable.pipeThrough(l).pipeTo(i.writable),i}}(t);e&&(zE.info("local screen video track begin to inject frame"),this._mediaStreamTrack=e)}e&&-1!==this._hints.indexOf(NT.CUSTOM_TRACK)&&this.setEncoderConfiguration(e),this.processorContext=new jC(this.getTrackId(),"local"),this.processorDestination=new VC(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t){const e=document.getElementById(t);e?t=e:(zE.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}zE.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=yR(yR(yR({},this._getDefaultPlayerConfig()),e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new hR(n):this._player=new pR(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const t=this.getVideoElementVisibleStatus();this.safeEmit(FT.VIDEO_ELEMENT_VISIBLE_STATUS,t)}catch(t){}}),NE("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,zE.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,e){if(!e){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(zE.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await vy(this,kT.NEED_DISABLE_TRACK,this)}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setEnabled to false error"),t.toString()),t}return e||(this._enabled=!1),void zE.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await vy(this,kT.NEED_ENABLE_TRACK,this)}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setEnabled to true error"),t.toString()),t}zE.info("[".concat(this.getTrackId(),"] setEnabled to true success")),e||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,zE.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await vy(this,kT.NEED_MUTE_TRACK,this):await vy(this,kT.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,e){if(!this._enabled)throw new Uv(Bv.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if("720p_auto"===t?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=CT(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const e=nR({encoderConfig:t});(_v()||Ev()||Lv())&&(e.deviceId=void 0),zE.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(e));try{await this._originMediaStreamTrack.applyConstraints(e),this.updateMediaStreamTrackResolution()}catch(t){const e=new Uv(Bv.UNEXPECTED_ERROR,t.toString());throw zE.error("[".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),e}}this._encoderConfig=t,-1===this._hints.indexOf(NT.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await vy(this,kT.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(zE)}}getStats(){return Oy((()=>{zE.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning"),yy(this,kT.GET_STATS)||yR({},QT)}async setBeautyEffect(t){zE.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,e):await aR(t)}async setBitrateLimit(t){if(zE.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await vy(this,kT.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(zE)}}}async setOptimizationMode(t){if("motion"!==t&&"detail"!==t&&"balanced"!==t)return void zE.error(Bv.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const e=this._optimizationMode;try{this._optimizationMode=t,await vy(this,kT.SET_OPTIMIZATION_MODE,this)}catch(t){throw this._optimizationMode=e,zE.error("[".concat(this.getTrackId(),"] set optimization mode failed"),t.toString()),t}zE.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(1===t.numSpatialLayers&&1!==t.numTemporalLayers)return zE.error(Bv.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=t,zE.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){fR(this._originMediaStreamTrack).then((t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e})).catch(Fy)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(t){if(!this._enabled)throw new Uv(Bv.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");zE.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(t)),t=CT(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),this._encoderConfig=t,-1===this._hints.indexOf(NT.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await vy(this,kT.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(zE)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:e,frameRate:n}=this.getMediaStreamTrackSettings();if(!t||!e||!n)return;const[i,r]=function(t,e,n,i){let r;const s=200*Math.pow(n/15,.6)*Math.pow(t*e/640/360,.75),o=s;if("STANDARD_BITRATE"===i)r=4*s;else{if("COMPATIABLE_BITRATE"!==i)return;r=2*s}return[Math.floor(r),Math.floor(o)]}(t,e,n,NE("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=r,this._encoderConfig.bitrateMax=i,zE.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(e,", fps: ").concat(n,"] => [brMax: ").concat(i,", brMin: ").concat(r,"]")))}getVideoElementVisibleStatus(){try{var t,e;const n=null==this||null===(t=this._player)||void 0===t?void 0:t.getContainerElement(),i={track:this,element:null==this||null===(e=this._player)||void 0===e?void 0:e.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:r,slot:s}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&s instanceof HTMLElement){const t=Xv.checkOneElementVisible(r),e=Object.assign({},t);if(e.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=e.visible;const t=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});e.visible?t.onSuccess("Video is visible"):t.onSuccess("Invisible because of ".concat(e.reason))}return e}return}catch(t){throw new Uv(Bv.GET_VIDEO_ELEMENT_VISIBLE_ERROR,t.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new Uv(Bv.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._encoderConfig;t&&(n=yR(yR({},n),CT(t))),n=Iy(n);const i=By(8,"track-video-cloned-"),r=new _R(e?this._mediaStreamTrack.clone():this._mediaStreamTrack,n,Iy(this._scalabilityMode),this._optimizationMode,i,Iy(this._hints));return t&&n&&r.setEncoderConfiguration(n),zE.debug("clone video track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(e)),r}async replaceTrack(t,e){if(!(t instanceof MediaStreamTrack))throw new Uv(Bv.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==t.kind)throw new Uv(Bv.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,e,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!_v()&&!Ev())return;this._statsTimer&&window.clearInterval(this._statsTimer);let t=2,e=wT[t],n=-1,i=Date.now();const r=t=>{t>2||t<0||(i=Date.now(),e=wT[t],this.setSenderConfiguration(e))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval((()=>{const s=this.getStats(),o=yy(this,kT.GET_RTC_STATS);if(s.sendPackets>0&&o){-1===n&&(n=Date.now());const a=Date.now();if(a-n<1e3||a-i<NE("PROFILE_SWITCH_INTERVAL"))return;const c=s.sendFrameRate,l=.6*e.frameRate,u=.9*e.frameRate;"number"==typeof c&&c>0&&c<l?t>0&&(t--,r(t),zE.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(c,", switchProfile to ").concat(t))):o.OutgoingAvailableBandwidth<e.bitrateMin?t>0&&(t--,r(t),zE.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(o.OutgoingAvailableBandwidth,", bitrateMin ").concat(e.bitrateMin,", switchProfile to ").concat(t))):"number"==typeof c&&c>u&&t<wT.length-1&&o.OutgoingAvailableBandwidth>1.2*wT[t+1].bitrateMin&&(t++,r(t),zE.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(c,", OutgoingAvailableBandwidth ").concat(o.OutgoingAvailableBandwidth,", switchProfile to ").concat(t)))}}),NE("CHECK_LOCAL_STATS_INTERVAL"))}bindProcessorDestinationEvents(){this.processorDestination.on(qT.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await vy(this,kT.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await vy(this,kT.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qT.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(YT.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(YT.REQUEST_CONSTRAINTS)}}Pw([iw({argsMap:(t,e,n)=>[t.getTrackId(),"string"==typeof e?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Object,Object]),Dw("design:returntype",void 0)],_R.prototype,"play",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],_R.prototype,"stop",null),Pw([Ky("LocalVideoTrack","_enabledMutex"),iw({argsMap:(t,e)=>[t.getTrackId(),e]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Boolean,Boolean]),Dw("design:returntype",ev)],_R.prototype,"setEnabled",null),Pw([Ky("LocalVideoTrack","_enabledMutex"),iw({argsMap:(t,e)=>[t.getTrackId(),e]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Boolean]),Dw("design:returntype",ev)],_R.prototype,"setMuted",null),Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Object,Boolean]),Dw("design:returntype",ev)],_R.prototype,"setEncoderConfiguration",null),Pw([UC(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",Object)],_R.prototype,"getStats",null),Pw([iw({argsMap:(t,e,n)=>[t.getTrackId(),e,n]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Boolean,Object]),Dw("design:returntype",ev)],_R.prototype,"setBeautyEffect",null),Pw([UC(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ImageData)],_R.prototype,"getCurrentFrameData",null),Pw([UC(),Dw("design:type",Function),Dw("design:paramtypes",[String,Number]),Dw("design:returntype",ev)],_R.prototype,"getCurrentFrameImage",null),Pw([UC(),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",ev)],_R.prototype,"setBitrateLimit",null),Pw([UC(),Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],_R.prototype,"setOptimizationMode",null),Pw([UC(),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",void 0)],_R.prototype,"setScalabiltyMode",null),Pw([UC(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],_R.prototype,"updateMediaStreamTrackResolution",null),Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",Object)],_R.prototype,"pipe",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],_R.prototype,"unpipe",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],_R.prototype,"close",null),Pw([iw({argsMap:(t,e,n)=>[t.getTrackId(),e.label,n]}),Dw("design:type",Function),Dw("design:paramtypes",[MediaStreamTrack,Boolean]),Dw("design:returntype",ev)],_R.prototype,"replaceTrack",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],_R.prototype,"startMonitorStats",null);class bR extends _R{get __className__(){return"CameraVideoTrack"}constructor(t,e,n,i,r,s){super(t,CT(e.encoderConfig),i,r,s),ih(this,"_config",void 0),ih(this,"_originalConstraints",void 0),ih(this,"_constraints",void 0),ih(this,"_enabled",!0),ih(this,"_deviceName","default"),ih(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(Iv()||xv())&&!function(){const t=Av();if(t.os!==av.IOS||!t.osVersion)return!1;const e=t.osVersion.split(".");return 15===Number(e[0])&&Number(e[1])>=2}()&&Mv()&&this._enabled&&!this._isClosed&&(zE.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=e,this._originalConstraints=n,this._constraints=n,this._deviceName=t.label,this._encoderConfig=CT(this._config.encoderConfig),oC.on(hT.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),oC.on(hT.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(t){return"string"==typeof t?this._setDeviceById(t):t.deviceId?this._setDeviceById(t.deviceId):t.facingMode?this._setDeviceByFacingModel(t.facingMode):void 0}async _setDeviceById(t){if(zE.info("[".concat(this.getTrackId(),"] set device to ").concat(t)),this._enabled)try{const e=await xC.getDeviceById(t),n={};n.video=yR({},this._constraints),n.video.deviceId={exact:t},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let i=null;try{i=await TC(n,this.getTrackId())}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setDevice failed"),t.toString()),i=await TC({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),t}await this._updateOriginMediaStreamTrack(i.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=e.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const e=await xC.getDeviceById(t);this._deviceName=e.label,this._config.cameraId=t,this._constraints.deviceId={exact:t}}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}zE.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(t){zE.info("[".concat(this.getTrackId(),"] set facingMode ").concat(t));const e={video:yR(yR({},this._constraints),{},{deviceId:void 0,facingMode:{exact:t}})};if(this._enabled){this._originMediaStreamTrack.stop();let t=null;try{t=await TC(e,this.getTrackId())}catch(e){throw zE.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),e.toString()),t=await TC({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(t.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(t.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=t,this._config.cameraId=void 0,this._constraints=yR({},e.video),zE.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(t,e){if(!e){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(zE.info("[".concat(this.getTrackId(),"] start setEnabled"),t),t){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const t=await TC({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(t.getVideoTracks()[0],!1)}await vy(this,kT.NEED_ENABLE_TRACK,this)}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setEnabled true error"),t.toString()),t}this.updateMediaStreamTrackResolution(),zE.info("[".concat(this.getTrackId(),"] setEnabled to true success")),e||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),e||(this._enabled=!1);try{await vy(this,kT.NEED_DISABLE_TRACK,this)}catch(t){throw zE.error("[".concat(this.getTrackId(),"] setEnabled to false error"),t.toString()),t}zE.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(t,e){if(!this._enabled)throw new Uv(Bv.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");"720p_auto"===t?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),t=CT(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin);const n=Ry(this._config);n.encoderConfig=t;const i=nR(n);(_v()||Ev()||Lv())&&(i.deviceId=void 0),zE.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(i));try{await this._originMediaStreamTrack.applyConstraints(i),this.updateMediaStreamTrackResolution()}catch(t){const e=new Uv(Bv.UNEXPECTED_ERROR,t.toString());throw zE.error("[".concat(this.getTrackId(),"] applyConstraints error"),e.toString()),e}this._config=n,this._constraints=i,this._originalConstraints=i,this._encoderConfig=t,-1===this._hints.indexOf(NT.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await vy(this,kT.NEED_UPDATE_VIDEO_ENCODER,this)}catch(t){return t.throw(zE)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Ev()||Lv())&&this._enabled&&!this._isClosed&&oC.duringInterruption){const t=async()=>{oC.off(hT.IOS_INTERRUPTION_END,t),this._enabled&&!this._isClosed&&(zE.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};oC.on(hT.IOS_INTERRUPTION_END,t)}else zE.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(FT.TRACK_ENDED)}async renewMediaStreamTrack(t){const e=t||this._constraints,n=xC.searchDeviceIdByName(this._deviceName);if(n&&!e.deviceId&&(e.deviceId={exact:n}),this._enabled){const t=await TC({video:e},this.getTrackId());this._constraints=e,await this._updateOriginMediaStreamTrack(t.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),oC.off(hT.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),oC.off(hT.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this._encoderConfig;t&&(n=yR(yR({},n),CT(t))),n=Iy(n);const i=By(8,"track-cam-cloned-"),r=new bR(e?this._mediaStreamTrack.clone():this._mediaStreamTrack,Iy(yR(yR({},this._config),{},{encoderConfig:n})),Iy(this._constraints),Iy(this._scalabilityMode),this._optimizationMode,i);return t&&n&&r.setEncoderConfiguration(n),zE.debug("clone track from ".concat(this.getTrackId()," to ").concat(i,", clone ").concat(e)),r}bindProcessorContextEvents(){this.processorContext.on(YT.REQUEST_UPDATE_CONSTRAINTS,(async(t,e,n)=>{try{const n=Object.assign({},this._originalConstraints,...t);await this.renewMediaStreamTrack(n),e()}catch(t){n(t)}})),this.processorContext.on(YT.REQUEST_CONSTRAINTS,(async t=>{t(this._originMediaStreamTrack.getSettings())}))}}function ER(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function wR(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ER(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ER(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function SR(t,e,n,i){n.optimizationMode&&(i&&i.width&&i.height?(n.encoderConfig=wR(wR({},i),{},{bitrateMin:i.bitrateMin,bitrateMax:i.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(e.contentHint=n.optimizationMode,e.contentHint===n.optimizationMode?zE.debug("[".concat(t,"] set content hint to"),n.optimizationMode):zE.debug("[".concat(t,"] set content hint failed")))):zE.warning("[".concat(t,"] can not apply optimization mode bitrate config, no encoderConfig")))}function TR(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function CR(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?TR(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TR(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",ev)],bR.prototype,"setDevice",null),Pw([Ky("CameraVideoTrack","_enabledMutex"),iw({argsMap:(t,e)=>[t.getTrackId(),e]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Boolean,Boolean]),Dw("design:returntype",ev)],bR.prototype,"setEnabled",null),Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e]}),UC(),Dw("design:type",Function),Dw("design:paramtypes",[Object,Boolean]),Dw("design:returntype",ev)],bR.prototype,"setEncoderConfiguration",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],bR.prototype,"close",null);class RR extends eC{getUserId(){return this._userId}constructor(t,e,n,i){super(t,"track-".concat(t.kind,"-").concat(e,"-").concat(i.clientId,"_").concat(By(5,""))),ih(this,"_userId",void 0),ih(this,"_uintId",void 0),ih(this,"_isDestroyed",!1),ih(this,"store",void 0),ih(this,"processor",void 0),this._userId=e,this._uintId=n,this.store=i}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,zE.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class IR extends RR{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==JT.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(t,e,n,i){super(t,e,n,i),ih(this,"_videoVisibleTimer",null),ih(this,"_previousVideoVisibleStatus",void 0),ih(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),ih(this,"trackMediaType","video"),ih(this,"_videoWidth",void 0),ih(this,"_videoHeight",void 0),ih(this,"_player",void 0),ih(this,"processorDestination",void 0),ih(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new jC(this.getTrackId(),"remote"),this.processorDestination=new VC(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return Oy((()=>{zE.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),yy(this,kT.GET_STATS)||CR({},KT)}play(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t){const e=document.getElementById(t);e?t=e:(zE.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}zE.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(e));const n=CR(CR({fit:"cover"},e),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(n):(t instanceof HTMLVideoElement?this._player=new hR(n):this._player=new pR(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(HT.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const t=this.getVideoElementVisibleStatus();this.safeEmit(HT.VIDEO_ELEMENT_VISIBLE_STATUS,t)}catch(t){}}),NE("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,zE.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){fR(this._originMediaStreamTrack).then((t=>{let[e,n]=t;this._videoHeight=n,this._videoWidth=e})).catch(Fy)}_updatePlayerSource(){zE.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var t,e;const n=null==this||null===(t=this._player)||void 0===t?void 0:t.getContainerElement(),i={track:this,element:null==this||null===(e=this._player)||void 0===e?void 0:e.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:r,slot:s}=i;if(this.isPlaying&&r instanceof HTMLVideoElement&&s instanceof HTMLElement){const t=Xv.checkOneElementVisible(r),e=Object.assign({},t);if(e.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=e.visible;const t=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});e.visible?t.onSuccess("Video is visible"):t.onSuccess("Invisible because of ".concat(e.reason))}return e}return}catch(t){throw new Uv(Bv.GET_VIDEO_ELEMENT_VISIBLE_ERROR,t.message)}}pipe(t){if(this.processor===t)return t;if(t._source)throw new Uv(Bv.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qT.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qT.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}Pw([iw({argsMap:(t,e,n)=>[t.getTrackId(),"string"==typeof e?e:e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),Dw("design:type",Function),Dw("design:paramtypes",[Object,Object]),Dw("design:returntype",void 0)],IR.prototype,"play",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],IR.prototype,"stop",null),Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",Object)],IR.prototype,"pipe",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],IR.prototype,"unpipe",null);class xR extends RR{get isPlaying(){return this._useAudioElement?BC.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(t,e,n,i){super(t,e,n,i),ih(this,"trackMediaType","audio"),ih(this,"_source",void 0),ih(this,"_useAudioElement",!0),ih(this,"_volume",100),ih(this,"processorContext",void 0),ih(this,"processorDestination",void 0),ih(this,"_played",!1),ih(this,"_bypassWebAudio",!1),NE("DISABLE_WEBAUDIO")?(this._source=new zC,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new gC(t,!0),NE("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(VT.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(HT.FIRST_FRAME_DECODED)})),this.processorContext=new QC(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new GC(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(VT.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!t)return this._source.removeAllListeners(VT.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(e),this._source.removeAllListeners(VT.ON_AUDIO_BUFFER),this._source.on(VT.ON_AUDIO_BUFFER,(e=>t(e)))}setVolume(t){this._volume=t,this._useAudioElement?BC.setVolume(this.getTrackId(),t):this._source.setVolume(t/100)}async setPlaybackDevice(t){if(!this._useAudioElement)throw new Uv(Bv.NOT_SUPPORTED,"your browser does not support setting the audio output device");await BC.setSinkID(this.getTrackId(),t)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return Oy((()=>{zE.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),yy(this,kT.GET_STATS)||CR({},zT)}play(){zE.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(zE.debug("[".concat(this.getTrackId(),"] use audio element to play")),BC.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){zE.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?BC.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];zE.debug("[".concat(this.getTrackId(),"] update player source track")),t&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&BC.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(t){if(this._bypassWebAudio)throw new Uv(Bv.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===t)return t;if(t._source)throw new Uv(Bv.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),t}unpipe(){var t;if(this._bypassWebAudio)throw new Uv(Bv.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const e=this.processor;null===(t=this._source.processSourceNode)||void 0===t||t.disconnect(),this.processor._source=!1,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(qT.ON_TRACK,(async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(t)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(qT.ON_NODE,(t=>{this._source.processedNode=t;const e=!t;this._useAudioElement!==e&&(this._played?(this.stop(),this._useAudioElement=e,this.play()):this._useAudioElement=e)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(qT.ON_TRACK),this.processorDestination.removeAllListeners(qT.ON_NODE)}}function OR(t){let e=t.length;for(;--e>=0;)t[e]=0}Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e],throttleTime:300}),Dw("design:type",Function),Dw("design:paramtypes",[Number]),Dw("design:returntype",void 0)],xR.prototype,"setVolume",null),Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e]}),Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],xR.prototype,"setPlaybackDevice",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],xR.prototype,"play",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],xR.prototype,"stop",null),Pw([iw({argsMap:(t,e)=>[t.getTrackId(),e.name]}),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",Object)],xR.prototype,"pipe",null),Pw([iw({argsMap:t=>[t.getTrackId()]}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],xR.prototype,"unpipe",null);const LR=256,MR=286,kR=30,NR=15,PR=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),DR=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),BR=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),UR=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),FR=new Array(576);OR(FR);const HR=new Array(60);OR(HR);const VR=new Array(512);OR(VR);const jR=new Array(256);OR(jR);const GR=new Array(29);OR(GR);const QR=new Array(kR);function zR(t,e,n,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}let WR,KR,qR;function YR(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}OR(QR);const $R=t=>t<256?VR[t]:VR[256+(t>>>7)],XR=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},JR=(t,e,n)=>{t.bi_valid>16-n?(t.bi_buf|=e<<t.bi_valid&65535,XR(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=n-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},ZR=(t,e,n)=>{JR(t,n[2*e],n[2*e+1])},tI=(t,e)=>{let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1},eI=(t,e,n)=>{const i=new Array(16);let r,s,o=0;for(r=1;r<=NR;r++)o=o+n[r-1]<<1,i[r]=o;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=tI(i[e]++,e))}},nI=t=>{let e;for(e=0;e<MR;e++)t.dyn_ltree[2*e]=0;for(e=0;e<kR;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},iI=t=>{t.bi_valid>8?XR(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},rI=(t,e,n,i)=>{const r=2*e,s=2*n;return t[r]<t[s]||t[r]===t[s]&&i[e]<=i[n]},sI=(t,e,n)=>{const i=t.heap[n];let r=n<<1;for(;r<=t.heap_len&&(r<t.heap_len&&rI(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!rI(e,i,t.heap[r],t.depth));)t.heap[n]=t.heap[r],n=r,r<<=1;t.heap[n]=i},oI=(t,e,n)=>{let i,r,s,o,a=0;if(0!==t.sym_next)do{i=255&t.pending_buf[t.sym_buf+a++],i+=(255&t.pending_buf[t.sym_buf+a++])<<8,r=t.pending_buf[t.sym_buf+a++],0===i?ZR(t,r,e):(s=jR[r],ZR(t,s+LR+1,e),o=PR[s],0!==o&&(r-=GR[s],JR(t,r,o)),i--,s=$R(i),ZR(t,s,n),o=DR[s],0!==o&&(i-=QR[s],JR(t,i,o)))}while(a<t.sym_next);ZR(t,256,e)},aI=(t,e)=>{const n=e.dyn_tree,i=e.stat_desc.static_tree,r=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c,l=-1;for(t.heap_len=0,t.heap_max=573,o=0;o<s;o++)0!==n[2*o]?(t.heap[++t.heap_len]=l=o,t.depth[o]=0):n[2*o+1]=0;for(;t.heap_len<2;)c=t.heap[++t.heap_len]=l<2?++l:0,n[2*c]=1,t.depth[c]=0,t.opt_len--,r&&(t.static_len-=i[2*c+1]);for(e.max_code=l,o=t.heap_len>>1;o>=1;o--)sI(t,n,o);c=s;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],sI(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[2*c]=n[2*o]+n[2*a],t.depth[c]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[2*o+1]=n[2*a+1]=c,t.heap[1]=c++,sI(t,n,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],((t,e)=>{const n=e.dyn_tree,i=e.max_code,r=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,d,h,A,p,f=0;for(h=0;h<=NR;h++)t.bl_count[h]=0;for(n[2*t.heap[t.heap_max]+1]=0,l=t.heap_max+1;l<573;l++)u=t.heap[l],h=n[2*n[2*u+1]+1]+1,h>c&&(h=c,f++),n[2*u+1]=h,u>i||(t.bl_count[h]++,A=0,u>=a&&(A=o[u-a]),p=n[2*u],t.opt_len+=p*(h+A),s&&(t.static_len+=p*(r[2*u+1]+A)));if(0!==f){do{for(h=c-1;0===t.bl_count[h];)h--;t.bl_count[h]--,t.bl_count[h+1]+=2,t.bl_count[c]--,f-=2}while(f>0);for(h=c;0!==h;h--)for(u=t.bl_count[h];0!==u;)d=t.heap[--l],d>i||(n[2*d+1]!==h&&(t.opt_len+=(h-n[2*d+1])*n[2*d],n[2*d+1]=h),u--)}})(t,e),eI(n,l,t.bl_count)},cI=(t,e,n)=>{let i,r,s=-1,o=e[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),e[2*(n+1)+1]=65535,i=0;i<=n;i++)r=o,o=e[2*(i+1)+1],++a<c&&r===o||(a<l?t.bl_tree[2*r]+=a:0!==r?(r!==s&&t.bl_tree[2*r]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,s=r,0===o?(c=138,l=3):r===o?(c=6,l=3):(c=7,l=4))},lI=(t,e,n)=>{let i,r,s=-1,o=e[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),i=0;i<=n;i++)if(r=o,o=e[2*(i+1)+1],!(++a<c&&r===o)){if(a<l)do{ZR(t,r,t.bl_tree)}while(0!=--a);else 0!==r?(r!==s&&(ZR(t,r,t.bl_tree),a--),ZR(t,16,t.bl_tree),JR(t,a-3,2)):a<=10?(ZR(t,17,t.bl_tree),JR(t,a-3,3)):(ZR(t,18,t.bl_tree),JR(t,a-11,7));a=0,s=r,0===o?(c=138,l=3):r===o?(c=6,l=3):(c=7,l=4)}};let uI=!1;const dI=(t,e,n,i)=>{JR(t,0+(i?1:0),3),iI(t),XR(t,n),XR(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n};var hI=t=>{uI||((()=>{let t,e,n,i,r;const s=new Array(16);for(n=0,i=0;i<28;i++)for(GR[i]=n,t=0;t<1<<PR[i];t++)jR[n++]=i;for(jR[n-1]=i,r=0,i=0;i<16;i++)for(QR[i]=r,t=0;t<1<<DR[i];t++)VR[r++]=i;for(r>>=7;i<kR;i++)for(QR[i]=r<<7,t=0;t<1<<DR[i]-7;t++)VR[256+r++]=i;for(e=0;e<=NR;e++)s[e]=0;for(t=0;t<=143;)FR[2*t+1]=8,t++,s[8]++;for(;t<=255;)FR[2*t+1]=9,t++,s[9]++;for(;t<=279;)FR[2*t+1]=7,t++,s[7]++;for(;t<=287;)FR[2*t+1]=8,t++,s[8]++;for(eI(FR,287,s),t=0;t<kR;t++)HR[2*t+1]=5,HR[2*t]=tI(t,5);WR=new zR(FR,PR,257,MR,NR),KR=new zR(HR,DR,0,kR,NR),qR=new zR(new Array(0),BR,0,19,7)})(),uI=!0),t.l_desc=new YR(t.dyn_ltree,WR),t.d_desc=new YR(t.dyn_dtree,KR),t.bl_desc=new YR(t.bl_tree,qR),t.bi_buf=0,t.bi_valid=0,nI(t)},AI=(t,e,n,i)=>{let r,s,o=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=(t=>{let e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<LR;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0})(t)),aI(t,t.l_desc),aI(t,t.d_desc),o=(t=>{let e;for(cI(t,t.dyn_ltree,t.l_desc.max_code),cI(t,t.dyn_dtree,t.d_desc.max_code),aI(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*UR[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e})(t),r=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=r&&(r=s)):r=s=n+5,n+4<=r&&-1!==e?dI(t,e,n,i):4===t.strategy||s===r?(JR(t,2+(i?1:0),3),oI(t,FR,HR)):(JR(t,4+(i?1:0),3),((t,e,n,i)=>{let r;for(JR(t,e-257,5),JR(t,n-1,5),JR(t,i-4,4),r=0;r<i;r++)JR(t,t.bl_tree[2*UR[r]+1],3);lI(t,t.dyn_ltree,e-1),lI(t,t.dyn_dtree,n-1)})(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),oI(t,t.dyn_ltree,t.dyn_dtree)),nI(t),i&&iI(t)},pI=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(jR[n]+LR+1)]++,t.dyn_dtree[2*$R(e)]++),t.sym_next===t.sym_end),fI={_tr_init:hI,_tr_stored_block:dI,_tr_flush_block:AI,_tr_tally:pI,_tr_align:t=>{JR(t,2,3),ZR(t,256,FR),(t=>{16===t.bi_valid?(XR(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)})(t)}},mI=(t,e,n,i)=>{let r=65535&t|0,s=t>>>16&65535|0,o=0;for(;0!==n;){o=n>2e3?2e3:n,n-=o;do{r=r+e[i++]|0,s=s+r|0}while(--o);r%=65521,s%=65521}return r|s<<16|0};const gI=new Uint32Array((()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})());var vI=(t,e,n,i)=>{const r=gI,s=i+n;t^=-1;for(let n=i;n<s;n++)t=t>>>8^r[255&(t^e[n])];return-1^t},yI={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},_I={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:bI,_tr_stored_block:EI,_tr_flush_block:wI,_tr_tally:SI,_tr_align:TI}=fI,{Z_NO_FLUSH:CI,Z_PARTIAL_FLUSH:RI,Z_FULL_FLUSH:II,Z_FINISH:xI,Z_BLOCK:OI,Z_OK:LI,Z_STREAM_END:MI,Z_STREAM_ERROR:kI,Z_DATA_ERROR:NI,Z_BUF_ERROR:PI,Z_DEFAULT_COMPRESSION:DI,Z_FILTERED:BI,Z_HUFFMAN_ONLY:UI,Z_RLE:FI,Z_FIXED:HI,Z_DEFAULT_STRATEGY:VI,Z_UNKNOWN:jI,Z_DEFLATED:GI}=_I,QI=286,zI=30,WI=19,KI=2*QI+1,qI=15,YI=258,$I=262,XI=42,JI=113,ZI=666,tx=(t,e)=>(t.msg=yI[e],e),ex=t=>2*t-(t>4?9:0),nx=t=>{let e=t.length;for(;--e>=0;)t[e]=0},ix=t=>{let e,n,i,r=t.w_size;e=t.hash_size,i=e;do{n=t.head[--i],t.head[i]=n>=r?n-r:0}while(--e);e=r,i=e;do{n=t.prev[--i],t.prev[i]=n>=r?n-r:0}while(--e)};let rx=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask;const sx=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))},ox=(t,e)=>{wI(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,sx(t.strm)},ax=(t,e)=>{t.pending_buf[t.pending++]=e},cx=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},lx=(t,e,n,i)=>{let r=t.avail_in;return r>i&&(r=i),0===r?0:(t.avail_in-=r,e.set(t.input.subarray(t.next_in,t.next_in+r),n),1===t.state.wrap?t.adler=mI(t.adler,e,r,n):2===t.state.wrap&&(t.adler=vI(t.adler,e,r,n)),t.next_in+=r,t.total_in+=r,r)},ux=(t,e)=>{let n,i,r=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-$I?t.strstart-(t.w_size-$I):0,l=t.window,u=t.w_mask,d=t.prev,h=t.strstart+YI;let A=l[s+o-1],p=l[s+o];t.prev_length>=t.good_match&&(r>>=2),a>t.lookahead&&(a=t.lookahead);do{if(n=e,l[n+o]===p&&l[n+o-1]===A&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do{}while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<h);if(i=YI-(h-s),s=h-YI,i>o){if(t.match_start=e,o=i,i>=a)break;A=l[s+o-1],p=l[s+o]}}}while((e=d[e&u])>c&&0!=--r);return o<=t.lookahead?o:t.lookahead},dx=t=>{const e=t.w_size;let n,i,r;do{if(i=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-$I)&&(t.window.set(t.window.subarray(e,e+e-i),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),ix(t),i+=e),0===t.strm.avail_in)break;if(n=lx(t.strm,t.window,t.strstart+t.lookahead,i),t.lookahead+=n,t.lookahead+t.insert>=3)for(r=t.strstart-t.insert,t.ins_h=t.window[r],t.ins_h=rx(t,t.ins_h,t.window[r+1]);t.insert&&(t.ins_h=rx(t,t.ins_h,t.window[r+3-1]),t.prev[r&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=r,r++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<$I&&0!==t.strm.avail_in)},hx=(t,e)=>{let n,i,r,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o=0,a=t.strm.avail_in;do{if(n=65535,r=t.bi_valid+42>>3,t.strm.avail_out<r)break;if(r=t.strm.avail_out-r,i=t.strstart-t.block_start,n>i+t.strm.avail_in&&(n=i+t.strm.avail_in),n>r&&(n=r),n<s&&(0===n&&e!==xI||e===CI||n!==i+t.strm.avail_in))break;o=e===xI&&n===i+t.strm.avail_in?1:0,EI(t,0,0,o),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,sx(t.strm),i&&(i>n&&(i=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+i),t.strm.next_out),t.strm.next_out+=i,t.strm.avail_out-=i,t.strm.total_out+=i,t.block_start+=i,n-=i),n&&(lx(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(0===o);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?4:e!==CI&&e!==xI&&0===t.strm.avail_in&&t.strstart===t.block_start?2:(r=t.window_size-t.strstart,t.strm.avail_in>r&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,r+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),r>t.strm.avail_in&&(r=t.strm.avail_in),r&&(lx(t.strm,t.window,t.strstart,r),t.strstart+=r,t.insert+=r>t.w_size-t.insert?t.w_size-t.insert:r),t.high_water<t.strstart&&(t.high_water=t.strstart),r=t.bi_valid+42>>3,r=t.pending_buf_size-r>65535?65535:t.pending_buf_size-r,s=r>t.w_size?t.w_size:r,i=t.strstart-t.block_start,(i>=s||(i||e===xI)&&e!==CI&&0===t.strm.avail_in&&i<=r)&&(n=i>r?r:i,o=e===xI&&0===t.strm.avail_in&&n===i?1:0,EI(t,t.block_start,n,o),t.block_start+=n,sx(t.strm)),o?3:1)},Ax=(t,e)=>{let n,i;for(;;){if(t.lookahead<$I){if(dx(t),t.lookahead<$I&&e===CI)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=rx(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-$I&&(t.match_length=ux(t,n)),t.match_length>=3)if(i=SI(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=rx(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=rx(t,t.ins_h,t.window[t.strstart+1]);else i=SI(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(ox(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,e===xI?(ox(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ox(t,!1),0===t.strm.avail_out)?1:2},px=(t,e)=>{let n,i,r;for(;;){if(t.lookahead<$I){if(dx(t),t.lookahead<$I&&e===CI)return 1;if(0===t.lookahead)break}if(n=0,t.lookahead>=3&&(t.ins_h=rx(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-$I&&(t.match_length=ux(t,n),t.match_length<=5&&(t.strategy===BI||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=SI(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=rx(t,t.ins_h,t.window[t.strstart+3-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(ox(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if(i=SI(t,0,t.window[t.strstart-1]),i&&ox(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=SI(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,e===xI?(ox(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ox(t,!1),0===t.strm.avail_out)?1:2};function fx(t,e,n,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=i,this.func=r}const mx=[new fx(0,0,0,0,hx),new fx(4,4,8,4,Ax),new fx(4,5,16,8,Ax),new fx(4,6,32,32,Ax),new fx(4,4,16,16,px),new fx(8,16,32,32,px),new fx(8,16,128,128,px),new fx(8,32,128,256,px),new fx(32,128,258,1024,px),new fx(32,258,258,4096,px)];function gx(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=GI,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*KI),this.dyn_dtree=new Uint16Array(2*(2*zI+1)),this.bl_tree=new Uint16Array(2*(2*WI+1)),nx(this.dyn_ltree),nx(this.dyn_dtree),nx(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(qI+1),this.heap=new Uint16Array(2*QI+1),nx(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*QI+1),nx(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const vx=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==XI&&57!==e.status&&69!==e.status&&73!==e.status&&91!==e.status&&103!==e.status&&e.status!==JI&&e.status!==ZI?1:0},yx=t=>{if(vx(t))return tx(t,kI);t.total_in=t.total_out=0,t.data_type=jI;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?57:e.wrap?XI:JI,t.adler=2===e.wrap?0:1,e.last_flush=-2,bI(e),LI},_x=t=>{const e=yx(t);var n;return e===LI&&((n=t.state).window_size=2*n.w_size,nx(n.head),n.max_lazy_match=mx[n.level].max_lazy,n.good_match=mx[n.level].good_length,n.nice_match=mx[n.level].nice_length,n.max_chain_length=mx[n.level].max_chain,n.strstart=0,n.block_start=0,n.lookahead=0,n.insert=0,n.match_length=n.prev_length=2,n.match_available=0,n.ins_h=0),e},bx=(t,e,n,i,r,s)=>{if(!t)return kI;let o=1;if(e===DI&&(e=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),r<1||r>9||n!==GI||i<8||i>15||e<0||e>9||s<0||s>HI||8===i&&1!==o)return tx(t,kI);8===i&&(i=9);const a=new gx;return t.state=a,a.strm=t,a.status=XI,a.wrap=o,a.gzhead=null,a.w_bits=i,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=r+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<r+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=s,a.method=n,_x(t)};var Ex=(t,e)=>{if(vx(t)||e>OI||e<0)return t?tx(t,kI):kI;const n=t.state;if(!t.output||0!==t.avail_in&&!t.input||n.status===ZI&&e!==xI)return tx(t,0===t.avail_out?PI:kI);const i=n.last_flush;if(n.last_flush=e,0!==n.pending){if(sx(t),0===t.avail_out)return n.last_flush=-1,LI}else if(0===t.avail_in&&ex(e)<=ex(i)&&e!==xI)return tx(t,PI);if(n.status===ZI&&0!==t.avail_in)return tx(t,PI);if(n.status===XI&&0===n.wrap&&(n.status=JI),n.status===XI){let e=GI+(n.w_bits-8<<4)<<8,i=-1;if(i=n.strategy>=UI||n.level<2?0:n.level<6?1:6===n.level?2:3,e|=i<<6,0!==n.strstart&&(e|=32),e+=31-e%31,cx(n,e),0!==n.strstart&&(cx(n,t.adler>>>16),cx(n,65535&t.adler)),t.adler=1,n.status=JI,sx(t),0!==n.pending)return n.last_flush=-1,LI}if(57===n.status)if(t.adler=0,ax(n,31),ax(n,139),ax(n,8),n.gzhead)ax(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),ax(n,255&n.gzhead.time),ax(n,n.gzhead.time>>8&255),ax(n,n.gzhead.time>>16&255),ax(n,n.gzhead.time>>24&255),ax(n,9===n.level?2:n.strategy>=UI||n.level<2?4:0),ax(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(ax(n,255&n.gzhead.extra.length),ax(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=vI(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(ax(n,0),ax(n,0),ax(n,0),ax(n,0),ax(n,0),ax(n,9===n.level?2:n.strategy>=UI||n.level<2?4:0),ax(n,3),n.status=JI,sx(t),0!==n.pending)return n.last_flush=-1,LI;if(69===n.status){if(n.gzhead.extra){let e=n.pending,i=(65535&n.gzhead.extra.length)-n.gzindex;for(;n.pending+i>n.pending_buf_size;){let r=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>e&&(t.adler=vI(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex+=r,sx(t),0!==n.pending)return n.last_flush=-1,LI;e=0,i-=r}let r=new Uint8Array(n.gzhead.extra);n.pending_buf.set(r.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending+=i,n.gzhead.hcrc&&n.pending>e&&(t.adler=vI(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){let e,i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=vI(t.adler,n.pending_buf,n.pending-i,i)),sx(t),0!==n.pending)return n.last_flush=-1,LI;i=0}e=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,ax(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>i&&(t.adler=vI(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){let e,i=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>i&&(t.adler=vI(t.adler,n.pending_buf,n.pending-i,i)),sx(t),0!==n.pending)return n.last_flush=-1,LI;i=0}e=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,ax(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>i&&(t.adler=vI(t.adler,n.pending_buf,n.pending-i,i))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(sx(t),0!==n.pending))return n.last_flush=-1,LI;ax(n,255&t.adler),ax(n,t.adler>>8&255),t.adler=0}if(n.status=JI,sx(t),0!==n.pending)return n.last_flush=-1,LI}if(0!==t.avail_in||0!==n.lookahead||e!==CI&&n.status!==ZI){let i=0===n.level?hx(n,e):n.strategy===UI?((t,e)=>{let n;for(;;){if(0===t.lookahead&&(dx(t),0===t.lookahead)){if(e===CI)return 1;break}if(t.match_length=0,n=SI(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(ox(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===xI?(ox(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ox(t,!1),0===t.strm.avail_out)?1:2})(n,e):n.strategy===FI?((t,e)=>{let n,i,r,s;const o=t.window;for(;;){if(t.lookahead<=YI){if(dx(t),t.lookahead<=YI&&e===CI)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(r=t.strstart-1,i=o[r],i===o[++r]&&i===o[++r]&&i===o[++r])){s=t.strstart+YI;do{}while(i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&i===o[++r]&&r<s);t.match_length=YI-(s-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(n=SI(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=SI(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(ox(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,e===xI?(ox(t,!0),0===t.strm.avail_out?3:4):t.sym_next&&(ox(t,!1),0===t.strm.avail_out)?1:2})(n,e):mx[n.level].func(n,e);if(3!==i&&4!==i||(n.status=ZI),1===i||3===i)return 0===t.avail_out&&(n.last_flush=-1),LI;if(2===i&&(e===RI?TI(n):e!==OI&&(EI(n,0,0,!1),e===II&&(nx(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),sx(t),0===t.avail_out))return n.last_flush=-1,LI}return e!==xI?LI:n.wrap<=0?MI:(2===n.wrap?(ax(n,255&t.adler),ax(n,t.adler>>8&255),ax(n,t.adler>>16&255),ax(n,t.adler>>24&255),ax(n,255&t.total_in),ax(n,t.total_in>>8&255),ax(n,t.total_in>>16&255),ax(n,t.total_in>>24&255)):(cx(n,t.adler>>>16),cx(n,65535&t.adler)),sx(t),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?LI:MI)},wx=(t,e)=>{let n=e.length;if(vx(t))return kI;const i=t.state,r=i.wrap;if(2===r||1===r&&i.status!==XI||i.lookahead)return kI;if(1===r&&(t.adler=mI(t.adler,e,n,0)),i.wrap=0,n>=i.w_size){0===r&&(nx(i.head),i.strstart=0,i.block_start=0,i.insert=0);let t=new Uint8Array(i.w_size);t.set(e.subarray(n-i.w_size,n),0),e=t,n=i.w_size}const s=t.avail_in,o=t.next_in,a=t.input;for(t.avail_in=n,t.next_in=0,t.input=e,dx(i);i.lookahead>=3;){let t=i.strstart,e=i.lookahead-2;do{i.ins_h=rx(i,i.ins_h,i.window[t+3-1]),i.prev[t&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=t,t++}while(--e);i.strstart=t,i.lookahead=2,dx(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,i.wrap=r,LI},Sx={deflateInit:(t,e)=>bx(t,e,GI,15,8,VI),deflateInit2:bx,deflateReset:_x,deflateResetKeep:yx,deflateSetHeader:(t,e)=>vx(t)||2!==t.state.wrap?kI:(t.state.gzhead=e,LI),deflate:Ex,deflateEnd:t=>{if(vx(t))return kI;const e=t.state.status;return t.state=null,e===JI?tx(t,NI):LI},deflateSetDictionary:wx,deflateInfo:"pako deflate (from Nodeca project)"};const Tx=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Cx={assign:function(t){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(const e in n)Tx(n,e)&&(t[e]=n[e])}}return t},flattenChunks:t=>{let e=0;for(let n=0,i=t.length;n<i;n++)e+=t[n].length;const n=new Uint8Array(e);for(let e=0,i=0,r=t.length;e<r;e++){let r=t[e];n.set(r,i),i+=r.length}return n}};let Rx=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){Rx=!1}const Ix=new Uint8Array(256);for(let t=0;t<256;t++)Ix[t]=t>=252?6:t>=248?5:t>=240?4:t>=224?3:t>=192?2:1;Ix[254]=Ix[254]=1;var xx={string2buf:t=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,n,i,r,s,o=t.length,a=0;for(r=0;r<o;r++)n=t.charCodeAt(r),55296==(64512&n)&&r+1<o&&(i=t.charCodeAt(r+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,r=0;s<a;r++)n=t.charCodeAt(r),55296==(64512&n)&&r+1<o&&(i=t.charCodeAt(r+1),56320==(64512&i)&&(n=65536+(n-55296<<10)+(i-56320),r++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e},buf2string:(t,e)=>{const n=e||t.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let i,r;const s=new Array(2*n);for(r=0,i=0;i<n;){let e=t[i++];if(e<128){s[r++]=e;continue}let o=Ix[e];if(o>4)s[r++]=65533,i+=o-1;else{for(e&=2===o?31:3===o?15:7;o>1&&i<n;)e=e<<6|63&t[i++],o--;o>1?s[r++]=65533:e<65536?s[r++]=e:(e-=65536,s[r++]=55296|e>>10&1023,s[r++]=56320|1023&e)}}return((t,e)=>{if(e<65534&&t.subarray&&Rx)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let i=0;i<e;i++)n+=String.fromCharCode(t[i]);return n})(s,r)},utf8border:(t,e)=>{(e=e||t.length)>t.length&&(e=t.length);let n=e-1;for(;n>=0&&128==(192&t[n]);)n--;return n<0||0===n?e:n+Ix[t[n]]>e?n:e}},Ox=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Lx=Object.prototype.toString,{Z_NO_FLUSH:Mx,Z_SYNC_FLUSH:kx,Z_FULL_FLUSH:Nx,Z_FINISH:Px,Z_OK:Dx,Z_STREAM_END:Bx,Z_DEFAULT_COMPRESSION:Ux,Z_DEFAULT_STRATEGY:Fx,Z_DEFLATED:Hx}=_I;function Vx(t){this.options=Cx.assign({level:Ux,method:Hx,chunkSize:16384,windowBits:15,memLevel:8,strategy:Fx},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ox,this.strm.avail_out=0;let n=Sx.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Dx)throw new Error(yI[n]);if(e.header&&Sx.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"==typeof e.dictionary?xx.string2buf(e.dictionary):"[object ArrayBuffer]"===Lx.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,n=Sx.deflateSetDictionary(this.strm,t),n!==Dx)throw new Error(yI[n]);this._dict_set=!0}}function jx(t,e){const n=new Vx(e);if(n.push(t,!0),n.err)throw n.msg||yI[n.err];return n.result}Vx.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize;let r,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?Px:Mx,"string"==typeof t?n.input=xx.string2buf(t):"[object ArrayBuffer]"===Lx.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),(s===kx||s===Nx)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(r=Sx.deflate(n,s),r===Bx)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),r=Sx.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===Dx;if(0!==n.avail_out){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},Vx.prototype.onData=function(t){this.chunks.push(t)},Vx.prototype.onEnd=function(t){t===Dx&&(this.result=Cx.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var Gx={Deflate:Vx,deflate:jx,deflateRaw:function(t,e){return(e=e||{}).raw=!0,jx(t,e)},gzip:function(t,e){return(e=e||{}).gzip=!0,jx(t,e)},constants:_I};const Qx=16209;var zx=function(t,e){let n,i,r,s,o,a,c,l,u,d,h,A,p,f,m,g,v,y,_,b,E,w,S,T;const C=t.state;n=t.next_in,S=t.input,i=n+(t.avail_in-5),r=t.next_out,T=t.output,s=r-(e-t.avail_out),o=r+(t.avail_out-257),a=C.dmax,c=C.wsize,l=C.whave,u=C.wnext,d=C.window,h=C.hold,A=C.bits,p=C.lencode,f=C.distcode,m=(1<<C.lenbits)-1,g=(1<<C.distbits)-1;t:do{A<15&&(h+=S[n++]<<A,A+=8,h+=S[n++]<<A,A+=8),v=p[h&m];e:for(;;){if(y=v>>>24,h>>>=y,A-=y,y=v>>>16&255,0===y)T[r++]=65535&v;else{if(!(16&y)){if(0==(64&y)){v=p[(65535&v)+(h&(1<<y)-1)];continue e}if(32&y){C.mode=16191;break t}t.msg="invalid literal/length code",C.mode=Qx;break t}_=65535&v,y&=15,y&&(A<y&&(h+=S[n++]<<A,A+=8),_+=h&(1<<y)-1,h>>>=y,A-=y),A<15&&(h+=S[n++]<<A,A+=8,h+=S[n++]<<A,A+=8),v=f[h&g];n:for(;;){if(y=v>>>24,h>>>=y,A-=y,y=v>>>16&255,!(16&y)){if(0==(64&y)){v=f[(65535&v)+(h&(1<<y)-1)];continue n}t.msg="invalid distance code",C.mode=Qx;break t}if(b=65535&v,y&=15,A<y&&(h+=S[n++]<<A,A+=8,A<y&&(h+=S[n++]<<A,A+=8)),b+=h&(1<<y)-1,b>a){t.msg="invalid distance too far back",C.mode=Qx;break t}if(h>>>=y,A-=y,y=r-s,b>y){if(y=b-y,y>l&&C.sane){t.msg="invalid distance too far back",C.mode=Qx;break t}if(E=0,w=d,0===u){if(E+=c-y,y<_){_-=y;do{T[r++]=d[E++]}while(--y);E=r-b,w=T}}else if(u<y){if(E+=c+u-y,y-=u,y<_){_-=y;do{T[r++]=d[E++]}while(--y);if(E=0,u<_){y=u,_-=y;do{T[r++]=d[E++]}while(--y);E=r-b,w=T}}}else if(E+=u-y,y<_){_-=y;do{T[r++]=d[E++]}while(--y);E=r-b,w=T}for(;_>2;)T[r++]=w[E++],T[r++]=w[E++],T[r++]=w[E++],_-=3;_&&(T[r++]=w[E++],_>1&&(T[r++]=w[E++]))}else{E=r-b;do{T[r++]=T[E++],T[r++]=T[E++],T[r++]=T[E++],_-=3}while(_>2);_&&(T[r++]=T[E++],_>1&&(T[r++]=T[E++]))}break}}break}}while(n<i&&r<o);_=A>>3,n-=_,A-=_<<3,h&=(1<<A)-1,t.next_in=n,t.next_out=r,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=r<o?o-r+257:257-(r-o),C.hold=h,C.bits=A};const Wx=15,Kx=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),qx=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Yx=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),$x=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Xx=(t,e,n,i,r,s,o,a)=>{const c=a.bits;let l,u,d,h,A,p,f=0,m=0,g=0,v=0,y=0,_=0,b=0,E=0,w=0,S=0,T=null;const C=new Uint16Array(16),R=new Uint16Array(16);let I,x,O,L=null;for(f=0;f<=Wx;f++)C[f]=0;for(m=0;m<i;m++)C[e[n+m]]++;for(y=c,v=Wx;v>=1&&0===C[v];v--);if(y>v&&(y=v),0===v)return r[s++]=20971520,r[s++]=20971520,a.bits=1,0;for(g=1;g<v&&0===C[g];g++);for(y<g&&(y=g),E=1,f=1;f<=Wx;f++)if(E<<=1,E-=C[f],E<0)return-1;if(E>0&&(0===t||1!==v))return-1;for(R[1]=0,f=1;f<Wx;f++)R[f+1]=R[f]+C[f];for(m=0;m<i;m++)0!==e[n+m]&&(o[R[e[n+m]]++]=m);if(0===t?(T=L=o,p=20):1===t?(T=Kx,L=qx,p=257):(T=Yx,L=$x,p=0),S=0,m=0,f=g,A=s,_=y,b=0,d=-1,w=1<<y,h=w-1,1===t&&w>852||2===t&&w>592)return 1;for(;;){I=f-b,o[m]+1<p?(x=0,O=o[m]):o[m]>=p?(x=L[o[m]-p],O=T[o[m]-p]):(x=96,O=0),l=1<<f-b,u=1<<_,g=u;do{u-=l,r[A+(S>>b)+u]=I<<24|x<<16|O|0}while(0!==u);for(l=1<<f-1;S&l;)l>>=1;if(0!==l?(S&=l-1,S+=l):S=0,m++,0==--C[f]){if(f===v)break;f=e[n+o[m]]}if(f>y&&(S&h)!==d){for(0===b&&(b=y),A+=g,_=f-b,E=1<<_;_+b<v&&(E-=C[_+b],!(E<=0));)_++,E<<=1;if(w+=1<<_,1===t&&w>852||2===t&&w>592)return 1;d=S&h,r[d]=y<<24|_<<16|A-s|0}}return 0!==S&&(r[A+S]=f-b<<24|64<<16|0),a.bits=y,0};const{Z_FINISH:Jx,Z_BLOCK:Zx,Z_TREES:tO,Z_OK:eO,Z_STREAM_END:nO,Z_NEED_DICT:iO,Z_STREAM_ERROR:rO,Z_DATA_ERROR:sO,Z_MEM_ERROR:oO,Z_BUF_ERROR:aO,Z_DEFLATED:cO}=_I,lO=16180,uO=16190,dO=16191,hO=16192,AO=16194,pO=16199,fO=16200,mO=16206,gO=16209,vO=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function yO(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const _O=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<lO||e.mode>16211?1:0},bO=t=>{if(_O(t))return rO;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=lO,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(852),e.distcode=e.distdyn=new Int32Array(592),e.sane=1,e.back=-1,eO},EO=t=>{if(_O(t))return rO;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,bO(t)},wO=(t,e)=>{let n;if(_O(t))return rO;const i=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?rO:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=n,i.wbits=e,EO(t))},SO=(t,e)=>{if(!t)return rO;const n=new yO;t.state=n,n.strm=t,n.window=null,n.mode=lO;const i=wO(t,e);return i!==eO&&(t.state=null),i};let TO,CO,RO=!0;const IO=t=>{if(RO){TO=new Int32Array(512),CO=new Int32Array(32);let e=0;for(;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(Xx(1,t.lens,0,288,TO,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;Xx(2,t.lens,0,32,CO,0,t.work,{bits:5}),RO=!1}t.lencode=TO,t.lenbits=9,t.distcode=CO,t.distbits=5},xO=(t,e,n,i)=>{let r;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),i>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(r=s.wsize-s.wnext,r>i&&(r=i),s.window.set(e.subarray(n-i,n-i+r),s.wnext),(i-=r)?(s.window.set(e.subarray(n-i,n),0),s.wnext=i,s.whave=s.wsize):(s.wnext+=r,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=r))),0};var OO=(t,e)=>{let n,i,r,s,o,a,c,l,u,d,h,A,p,f,m,g,v,y,_,b,E,w,S=0;const T=new Uint8Array(4);let C,R;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(_O(t)||!t.output||!t.input&&0!==t.avail_in)return rO;n=t.state,n.mode===dO&&(n.mode=hO),o=t.next_out,r=t.output,c=t.avail_out,s=t.next_in,i=t.input,a=t.avail_in,l=n.hold,u=n.bits,d=a,h=c,w=eO;t:for(;;)switch(n.mode){case lO:if(0===n.wrap){n.mode=hO;break}for(;u<16;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,T[0]=255&l,T[1]=l>>>8&255,n.check=vI(n.check,T,2,0),l=0,u=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=gO;break}if((15&l)!==cO){t.msg="unknown compression method",n.mode=gO;break}if(l>>>=4,u-=4,E=8+(15&l),0===n.wbits&&(n.wbits=E),E>15||E>n.wbits){t.msg="invalid window size",n.mode=gO;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&l?16189:dO,l=0,u=0;break;case 16181:for(;u<16;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}if(n.flags=l,(255&n.flags)!==cO){t.msg="unknown compression method",n.mode=gO;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=gO;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,n.check=vI(n.check,T,2,0)),l=0,u=0,n.mode=16182;case 16182:for(;u<32;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}n.head&&(n.head.time=l),512&n.flags&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,T[2]=l>>>16&255,T[3]=l>>>24&255,n.check=vI(n.check,T,4,0)),l=0,u=0,n.mode=16183;case 16183:for(;u<16;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,n.check=vI(n.check,T,2,0)),l=0,u=0,n.mode=16184;case 16184:if(1024&n.flags){for(;u<16;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&4&n.wrap&&(T[0]=255&l,T[1]=l>>>8&255,n.check=vI(n.check,T,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&(A=n.length,A>a&&(A=a),A&&(n.head&&(E=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(i.subarray(s,s+A),E)),512&n.flags&&4&n.wrap&&(n.check=vI(n.check,i,A,s)),a-=A,s+=A,n.length-=A),n.length))break t;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===a)break t;A=0;do{E=i[s+A++],n.head&&E&&n.length<65536&&(n.head.name+=String.fromCharCode(E))}while(E&&A<a);if(512&n.flags&&4&n.wrap&&(n.check=vI(n.check,i,A,s)),a-=A,s+=A,E)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===a)break t;A=0;do{E=i[s+A++],n.head&&E&&n.length<65536&&(n.head.comment+=String.fromCharCode(E))}while(E&&A<a);if(512&n.flags&&4&n.wrap&&(n.check=vI(n.check,i,A,s)),a-=A,s+=A,E)break t}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;u<16;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}if(4&n.wrap&&l!==(65535&n.check)){t.msg="header crc mismatch",n.mode=gO;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=dO;break;case 16189:for(;u<32;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}t.adler=n.check=vO(l),l=0,u=0,n.mode=uO;case uO:if(0===n.havedict)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,iO;t.adler=n.check=1,n.mode=dO;case dO:if(e===Zx||e===tO)break t;case hO:if(n.last){l>>>=7&u,u-=7&u,n.mode=mO;break}for(;u<3;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}switch(n.last=1&l,l>>>=1,u-=1,3&l){case 0:n.mode=16193;break;case 1:if(IO(n),n.mode=pO,e===tO){l>>>=2,u-=2;break t}break;case 2:n.mode=16196;break;case 3:t.msg="invalid block type",n.mode=gO}l>>>=2,u-=2;break;case 16193:for(l>>>=7&u,u-=7&u;u<32;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}if((65535&l)!=(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=gO;break}if(n.length=65535&l,l=0,u=0,n.mode=AO,e===tO)break t;case AO:n.mode=16195;case 16195:if(A=n.length,A){if(A>a&&(A=a),A>c&&(A=c),0===A)break t;r.set(i.subarray(s,s+A),o),a-=A,s+=A,c-=A,o+=A,n.length-=A;break}n.mode=dO;break;case 16196:for(;u<14;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}if(n.nlen=257+(31&l),l>>>=5,u-=5,n.ndist=1+(31&l),l>>>=5,u-=5,n.ncode=4+(15&l),l>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=gO;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;u<3;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}n.lens[I[n.have++]]=7&l,l>>>=3,u-=3}for(;n.have<19;)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},w=Xx(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,w){t.msg="invalid code lengths set",n.mode=gO;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;S=n.lencode[l&(1<<n.lenbits)-1],m=S>>>24,g=S>>>16&255,v=65535&S,!(m<=u);){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}if(v<16)l>>>=m,u-=m,n.lens[n.have++]=v;else{if(16===v){for(R=m+2;u<R;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}if(l>>>=m,u-=m,0===n.have){t.msg="invalid bit length repeat",n.mode=gO;break}E=n.lens[n.have-1],A=3+(3&l),l>>>=2,u-=2}else if(17===v){for(R=m+3;u<R;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}l>>>=m,u-=m,E=0,A=3+(7&l),l>>>=3,u-=3}else{for(R=m+7;u<R;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}l>>>=m,u-=m,E=0,A=11+(127&l),l>>>=7,u-=7}if(n.have+A>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=gO;break}for(;A--;)n.lens[n.have++]=E}}if(n.mode===gO)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=gO;break}if(n.lenbits=9,C={bits:n.lenbits},w=Xx(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,w){t.msg="invalid literal/lengths set",n.mode=gO;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},w=Xx(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,w){t.msg="invalid distances set",n.mode=gO;break}if(n.mode=pO,e===tO)break t;case pO:n.mode=fO;case fO:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,zx(t,h),o=t.next_out,r=t.output,c=t.avail_out,s=t.next_in,i=t.input,a=t.avail_in,l=n.hold,u=n.bits,n.mode===dO&&(n.back=-1);break}for(n.back=0;S=n.lencode[l&(1<<n.lenbits)-1],m=S>>>24,g=S>>>16&255,v=65535&S,!(m<=u);){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}if(g&&0==(240&g)){for(y=m,_=g,b=v;S=n.lencode[b+((l&(1<<y+_)-1)>>y)],m=S>>>24,g=S>>>16&255,v=65535&S,!(y+m<=u);){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}l>>>=y,u-=y,n.back+=y}if(l>>>=m,u-=m,n.back+=m,n.length=v,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=dO;break}if(64&g){t.msg="invalid literal/length code",n.mode=gO;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(R=n.extra;u<R;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;S=n.distcode[l&(1<<n.distbits)-1],m=S>>>24,g=S>>>16&255,v=65535&S,!(m<=u);){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}if(0==(240&g)){for(y=m,_=g,b=v;S=n.distcode[b+((l&(1<<y+_)-1)>>y)],m=S>>>24,g=S>>>16&255,v=65535&S,!(y+m<=u);){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}l>>>=y,u-=y,n.back+=y}if(l>>>=m,u-=m,n.back+=m,64&g){t.msg="invalid distance code",n.mode=gO;break}n.offset=v,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(R=n.extra;u<R;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=gO;break}n.mode=16204;case 16204:if(0===c)break t;if(A=h-c,n.offset>A){if(A=n.offset-A,A>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=gO;break}A>n.wnext?(A-=n.wnext,p=n.wsize-A):p=n.wnext-A,A>n.length&&(A=n.length),f=n.window}else f=r,p=o-n.offset,A=n.length;A>c&&(A=c),c-=A,n.length-=A;do{r[o++]=f[p++]}while(--A);0===n.length&&(n.mode=fO);break;case 16205:if(0===c)break t;r[o++]=n.length,c--,n.mode=fO;break;case mO:if(n.wrap){for(;u<32;){if(0===a)break t;a--,l|=i[s++]<<u,u+=8}if(h-=c,t.total_out+=h,n.total+=h,4&n.wrap&&h&&(t.adler=n.check=n.flags?vI(n.check,r,h,o-h):mI(n.check,r,h,o-h)),h=c,4&n.wrap&&(n.flags?l:vO(l))!==n.check){t.msg="incorrect data check",n.mode=gO;break}l=0,u=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;u<32;){if(0===a)break t;a--,l+=i[s++]<<u,u+=8}if(4&n.wrap&&l!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=gO;break}l=0,u=0}n.mode=16208;case 16208:w=nO;break t;case gO:w=sO;break t;case 16210:return oO;default:return rO}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,(n.wsize||h!==t.avail_out&&n.mode<gO&&(n.mode<mO||e!==Jx))&&xO(t,t.output,t.next_out,h-t.avail_out),d-=t.avail_in,h-=t.avail_out,t.total_in+=d,t.total_out+=h,n.total+=h,4&n.wrap&&h&&(t.adler=n.check=n.flags?vI(n.check,r,h,t.next_out-h):mI(n.check,r,h,t.next_out-h)),t.data_type=n.bits+(n.last?64:0)+(n.mode===dO?128:0)+(n.mode===pO||n.mode===AO?256:0),(0===d&&0===h||e===Jx)&&w===eO&&(w=aO),w},LO={inflateReset:EO,inflateReset2:wO,inflateResetKeep:bO,inflateInit:t=>SO(t,15),inflateInit2:SO,inflate:OO,inflateEnd:t=>{if(_O(t))return rO;let e=t.state;return e.window&&(e.window=null),t.state=null,eO},inflateGetHeader:(t,e)=>{if(_O(t))return rO;const n=t.state;return 0==(2&n.wrap)?rO:(n.head=e,e.done=!1,eO)},inflateSetDictionary:(t,e)=>{const n=e.length;let i,r,s;return _O(t)?rO:(i=t.state,0!==i.wrap&&i.mode!==uO?rO:i.mode===uO&&(r=1,r=mI(r,e,n,0),r!==i.check)?sO:(s=xO(t,e,n,n),s?(i.mode=16210,oO):(i.havedict=1,eO)))},inflateInfo:"pako inflate (from Nodeca project)"},MO=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const kO=Object.prototype.toString,{Z_NO_FLUSH:NO,Z_FINISH:PO,Z_OK:DO,Z_STREAM_END:BO,Z_NEED_DICT:UO,Z_STREAM_ERROR:FO,Z_DATA_ERROR:HO,Z_MEM_ERROR:VO}=_I;function jO(t){this.options=Cx.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ox,this.strm.avail_out=0;let n=LO.inflateInit2(this.strm,e.windowBits);if(n!==DO)throw new Error(yI[n]);if(this.header=new MO,LO.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=xx.string2buf(e.dictionary):"[object ArrayBuffer]"===kO.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=LO.inflateSetDictionary(this.strm,e.dictionary),n!==DO)))throw new Error(yI[n])}function GO(t,e){const n=new jO(e);if(n.push(t),n.err)throw n.msg||yI[n.err];return n.result}jO.prototype.push=function(t,e){const n=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=e===~~e?e:!0===e?PO:NO,"[object ArrayBuffer]"===kO.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){for(0===n.avail_out&&(n.output=new Uint8Array(i),n.next_out=0,n.avail_out=i),s=LO.inflate(n,o),s===UO&&r&&(s=LO.inflateSetDictionary(n,r),s===DO?s=LO.inflate(n,o):s===HO&&(s=UO));n.avail_in>0&&s===BO&&n.state.wrap>0&&0!==t[n.next_in];)LO.inflateReset(n),s=LO.inflate(n,o);switch(s){case FO:case HO:case UO:case VO:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||s===BO))if("string"===this.options.to){let t=xx.utf8border(n.output,n.next_out),e=n.next_out-t,r=xx.buf2string(n.output,t);n.next_out=e,n.avail_out=i-e,e&&n.output.set(n.output.subarray(t,t+e),0),this.onData(r)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==DO||0!==a){if(s===BO)return s=LO.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},jO.prototype.onData=function(t){this.chunks.push(t)},jO.prototype.onEnd=function(t){t===DO&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Cx.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var QO={Inflate:jO,inflate:GO,inflateRaw:function(t,e){return(e=e||{}).raw=!0,GO(t,e)},ungzip:GO,constants:_I};const{Deflate:zO,deflate:WO,deflateRaw:KO,gzip:qO}=Gx,{Inflate:YO,inflate:$O,inflateRaw:XO,ungzip:JO}=QO;var ZO,tL=WO,eL=$O;!function(t){t[t.ONE_BYTE=0]="ONE_BYTE",t[t.TWO_BYTE=1]="TWO_BYTE"}(ZO||(ZO={}));class nL{constructor(){ih(this,"_sequence",0),ih(this,"_startTime",Date.now()),ih(this,"isUseOneByte",!0)}get startTime(){const t=Date.now()-this._startTime;return t<Math.pow(2,16)?t:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(t){const e={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:t};if(t.byteLength>128){const n=new Uint8Array(4);n.set([1,0,0,0]);const i={id:0,length:4,data:n.buffer},r={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[i]};e.commonPacketHeader.extension=1,e.extension=r,e.payload=this.compress(t),e.commonPacketHeader.length=8+(e.extension.length+2)+e.payload.byteLength}else e.commonPacketHeader.length=8+e.payload.byteLength;const n=new ArrayBuffer(e.commonPacketHeader.length),i=new Uint8Array(n),r=new DataView(n);let s=0;if(r.setUint16(s,e.commonPacketHeader.extension<<15|e.commonPacketHeader.reserved<<14|e.commonPacketHeader.length,!0),s+=2,r.setUint32(s,e.commonPacketHeader.sequence,!0),s+=4,r.setUint16(s,e.commonStreamHeader,!0),s+=2,e.extension){const t=this.serializeExtension(e.extension);i.set(new Uint8Array(t),s),s+=t.byteLength}if(i.set(new Uint8Array(e.payload),s),s+=e.payload.byteLength,s!==e.commonPacketHeader.length)throw Error("serialize error!");return n}deserialize(t){if(t.byteLength<4)return new ArrayBuffer(0);const e=new DataView(t);let n=0;const i=e.getUint16(n,!0);n+=2;const r=(32768&i)>>15;let s,o;if(e.getUint16(n+2,!0),e.getUint16(n,!0),n+=4,e.getUint16(n,!0),n+=2,r){o=this.deserializeExtension(t.slice(n)),n+=2+o.length,s=t.slice(n);let e=!1;if(o.datas.length>0){const t=o.datas.find((t=>0===t.id));t&&(e=1==(1&new DataView(t.data).getUint32(0,!0)))}s=e?this.decompress(s):s}else s=t.slice(8);return s}serializeExtension(t){const{profile:e,length:n,datas:i}=t,r=new ArrayBuffer(n+2),s=new Uint8Array(r),o=new DataView(r);let a=0;if(o.setUint8(a++,e),o.setUint8(a++,n),i.forEach((t=>{e?(o.setUint8(a++,t.id),o.setUint8(a++,t.length),s.set(new Uint8Array(t.data),a),a+=t.data.byteLength):(o.setUint8(a++,t.id|t.length<<4),s.set(new Uint8Array(t.data),a),a+=t.data.byteLength)})),a!==n+2)throw Error("serialize extension error, is ".concat(a,"!==").concat(n+2));return r}deserializeExtension(t){const e=new DataView(t);let n=0;const i=e.getUint8(n);n++;const r=e.getUint8(n);n++;const s=i===ZO.TWO_BYTE,o=[],a=new DataView(t,2);let c=0;for(;c<r;){let t=0,e=0,n=new ArrayBuffer(0);s?(t=a.getUint8(c),c++,e=a.getUint8(c),c++):(t=15&a.getUint8(c),e=a.getUint8(c)>>4,c++),e>0&&(n=a.buffer.slice(c+2,c+2+e),c+=n.byteLength),o.push({id:t,length:e,data:n})}if(c!==r)throw Error("parse error");return{profile:i,length:r,datas:o}}decompress(t){return eL(new Uint8Array(t))}compress(t){return tL(new Uint8Array(t))}}class iL extends ny{constructor(t,e){super(),ih(this,"_version",1),ih(this,"_type",3),ih(this,"_config",void 0),ih(this,"_originDataChannel",void 0),ih(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),ih(this,"_dataStreamPacketHandler",void 0),ih(this,"_datachannelEventMap",new Map),this._config=t,e&&(this._originDataChannel=e,this._bandDataChannelEvents(e)),this._initPacketHeader(),this._dataStreamPacketHandler=new nL}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return NE("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var t,e;return null!==(t=null===(e=this._originDataChannel)||void 0===e?void 0:e.readyState)&&void 0!==t?t:"connecting"}get _originDataChannelId(){var t,e;return null!==(t=null===(e=this._originDataChannel)||void 0===e?void 0:e.id)&&void 0!==t?t:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new ev(((t,e)=>{if(this._originDataChannel){"open"===this._originDataChannel.readyState&&t();const n=setTimeout((()=>{var t;e(new Uv(Bv.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat(null===(t=this._originDataChannel)||void 0===t?void 0:t.id)))}),1e4);this._originDataChannel.onopen=()=>{clearTimeout(n),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),t()},this._originDataChannel.onerror=()=>{throw clearTimeout(n),new Uv(Bv.DATACHANNEL_CONNECTION_TIMEOUT)}}else e(new Uv(Bv.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))}))}_updateOriginDataChannel(t){this._originDataChannel=t,this._bandDataChannelEvents(t)}_initPacketHeader(){const t=new DataView(this._dataStreamPacketHeader);t.setUint16(0,this._version),t.setUint8(2,this._type),t.setUint8(3,this._config.id)}_bandDataChannelEvents(t){this._unbindDataChannelEvents(t),[tC.OPEN,tC.CLOSE,tC.ERROR].forEach((e=>{const n=()=>{this.emit(e)};this._datachannelEventMap.set(e,n),t.addEventListener(e,n)}))}_unbindDataChannelEvents(t){Array.from(this._datachannelEventMap.entries()).forEach((e=>{let[n,i]=e;t.removeEventListener(n,i)})),this._datachannelEventMap.clear()}}class rL extends iL{constructor(t){super(t),ih(this,"_messageListener",void 0),this._messageListener=t=>{if(t.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const e=t.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(e).getUint8(3)!==this.id)return;let n=t.data.slice(this._dataStreamPacketHeader.byteLength);n=this._dataStreamPacketHandler.deserialize(n),this.emit(tC.MESSAGE,n)}}_updateOriginDataChannel(t){super._updateOriginDataChannel(t),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class sL extends iL{send(t){if(this._originDataChannel){let e=t;e=this._dataStreamPacketHandler.serialize(t);const n=new Uint8Array(this._dataStreamPacketHeader.byteLength+e.byteLength);n.set(new Uint8Array(this._dataStreamPacketHeader),0),n.set(new Uint8Array(e),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(n.buffer)}}}class oL extends ny{constructor(){super(...arguments),ih(this,"resultStorage",new Map)}setLocalAudioStats(t,e,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(n,e)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(n,e))}setLocalVideoStats(t,e,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(n,e)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(n,e)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(n))}setRemoteAudioStats(t,e){const n=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(e))}setRemoteVideoStats(t,e){const n=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(e))}record(t,e,n){if(NE("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const i=this.resultStorage.get(t);if(i&&(i.result.push(n),i.result.length>=5)){var r;const n=kr(r=i.result).call(r,!0);i.isPrevNormal&&!n&&this.emit("exception",aL[t],t,e),!i.isPrevNormal&&n&&this.emit("exception",aL[t]+2e3,t+"_RECOVER",e),i.isPrevNormal=n,i.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&0===t.receiveLevel)}checkAudioInputLevel(t,e){return e instanceof eR&&!e.isActive||!!e.muted||0!==t.sendVolumeLevel}checkFramerateInput(t,e){let n=null;e._encoderConfig&&e._encoderConfig.frameRate&&(n=mL(e._encoderConfig.frameRate));const i=t.captureFrameRate;return!n||!i||!(n>10&&i<5||n<10&&n>=5&&i<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,e){return!!e.muted||0!==t.sendBitrate}checkSendAudioBitrate(t,e){return e instanceof eR&&!e.isActive||!!e.muted||0!==t.sendBitrate}checkVideoDecode(t){return 0===t.receiveBitrate||0!==t.decodeFrameRate}}const aL={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},cL=new class{markSubscribeStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/subscribe-").concat(e))}markPublishStart(t,e){performance.mark("agora-web-sdk/".concat(t,"/publish-").concat(e))}measureFromSubscribeStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/subscribe-").concat(e));if(n.length>0){const t=n[n.length-1];return Math.round(performance.now()-t.startTime)}return 0}measureFromPublishStart(t,e){const n=performance.getEntriesByName("agora-web-sdk/".concat(t,"/publish-").concat(e));if(n.length>0){const t=n[n.length-1];return Math.round(performance.now()-t.startTime)}return 0}};function lL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function uL(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?lL(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lL(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class dL{constructor(t){ih(this,"store",void 0),ih(this,"onStatsException",void 0),ih(this,"onUploadPublishDuration",void 0),ih(this,"onStatsChanged",void 0),ih(this,"localStats",new Map),ih(this,"remoteStats",new Map),ih(this,"updateStatsInterval",void 0),ih(this,"trafficStats",void 0),ih(this,"trafficStatsPeerList",[]),ih(this,"uplinkStats",void 0),ih(this,"exceptionMonitor",void 0),ih(this,"p2pChannel",void 0),ih(this,"scalabilityMode",uw.L1T1),ih(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new oL,this.exceptionMonitor.on("exception",((t,e,n)=>{this.onStatsException&&this.onStatsException(t,e,n)}))}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(pS.LocalAudioTrack)||uL({},GT)}getLocalVideoTrackStats(){return this.localStats.get(pS.LocalVideoTrack)||uL({},QT)}getRemoteAudioTrackStats(t){const e=(t,e)=>{if(!this.trafficStats)return e;const n=this.trafficStats.peer_delay.find((e=>e.peer_uid===t));return n&&(e.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),e},n={};if(t){var i;const r=null===(i=this.remoteStats.get(t))||void 0===i?void 0:i.audioStats;r&&(n[t]=e(t,r))}else Array.from(this.remoteStats.entries()).forEach((t=>{let[i,{audioStats:r}]=t;r&&(n[i]=e(i,r))}));return n}getRemoteNetworkQualityStats(t){const e={};if(t){var n;const i=null===(n=this.remoteStats.get(t))||void 0===n?void 0:n.networkStats;i&&(e[t]=i)}else Array.from(this.remoteStats.entries()).forEach((t=>{let[n,{networkStats:i}]=t;i&&(e[n]=i)}));return e}getRemoteVideoTrackStats(t){const e=(t,e)=>{if(!this.trafficStats)return e;const n=this.trafficStats.peer_delay.find((e=>e.peer_uid===t));return n&&(e.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),e},n={};if(t){var i;const r=null===(i=this.remoteStats.get(t))||void 0===i?void 0:i.videoStats;r&&(n[t]=e(t,r))}else Array.from(this.remoteStats.entries()).forEach((t=>{let[i,{videoStats:r}]=t;r&&(n[i]=e(i,r))}));return n}getRTCStats(){let t=0,e=0,n=0,i=0;const r=this.localStats.get(pS.LocalAudioTrack);r&&(t+=r.sendBytes,e+=r.sendBitrate);const s=this.localStats.get(pS.LocalVideoTrack);s&&(t+=s.sendBytes,e+=s.sendBitrate);const o=this.localStats.get(pS.LocalVideoLowTrack);o&&(t+=o.sendBytes,e+=o.sendBitrate),this.remoteStats.forEach((t=>{let{audioStats:e,videoStats:r}=t;e&&(n+=e.receiveBytes,i+=e.receiveBitrate),r&&(n+=r.receiveBytes,i+=r.receiveBitrate)}));let a=1;return this.trafficStats&&(a+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:a,SendBitrate:e,SendBytes:t,RecvBytes:n,RecvBitrate:i,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter((t=>void 0!==t.B_ppad||void 0!==t.B_ppvd)),t.peer_delay.filter((t=>-1===this.trafficStatsPeerList.indexOf(t.peer_uid))).forEach((t=>{var e;const n=null===(e=this.p2pChannel)||void 0===e?void 0:e.getRemoteMedia(t.peer_uid),i=null!=n&&n.videoSSRC?cL.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,r=null!=n&&n.audioSSRC?cL.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==t.B_ppad&&void 0!==t.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(t.peer_uid,t.B_ppad,t.B_ppvd,i>r?i:r),this.trafficStatsPeerList.push(t.peer_uid))})),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&zE.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,e,n){if(!t)return!1;const i=!!n&&e.framesDecodeFreezeTime>n.framesDecodeFreezeTime,r=!n||e.framesDecodeCount>n.framesDecodeCount;return i||!r}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach((e=>{let[n,i]=e;switch(n){case pS.LocalVideoTrack:case pS.LocalVideoLowTrack:{const e=i,s=uL({},QT),o=t.getStats(),a=t.getLocalMedia(n);if(o){const n=o.videoSend.find((t=>t.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId)));if(n){const i=t.getLocalVideoSize(),r=t.getEncoderConfig(pS.LocalVideoTrack);"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(s.codecType=n.codec),s.sendBytes=n.bytes,s.sendBitrate=e?8*Math.max(0,s.sendBytes-e.sendBytes):0,n.inputFrame?(s.captureFrameRate=n.inputFrame.frameRate,s.captureResolutionHeight=n.inputFrame.height,s.captureResolutionWidth=n.inputFrame.width):i&&(s.captureResolutionWidth=i.width,s.captureResolutionHeight=i.height),n.sentFrame?(s.sendFrameRate=n.sentFrame.frameRate,s.sendResolutionHeight=n.sentFrame.height,s.sendResolutionWidth=n.sentFrame.width):i&&(s.sendResolutionWidth=i.width,s.sendResolutionHeight=i.height),n.avgEncodeMs&&(s.encodeDelay=n.avgEncodeMs),r&&r.bitrateMax&&(s.targetSendBitrate=1e3*r.bitrateMax),s.sendPackets=n.packets,s.sendPacketsLost=n.packetsLost,s.sendJitterMs=n.jitterMs,s.sendRttMs=n.rttMs,s.totalDuration=e?e.totalDuration+1:1,s.totalFreezeTime=e?e.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(s.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(zE.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(s.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var r;this.localStats.set(n,s),((null==e?void 0:e.sendResolutionWidth)!==s.sendResolutionWidth||(null==e?void 0:e.sendResolutionHeight)!==s.sendResolutionHeight)&&(null===(r=this.onStatsChanged)||void 0===r||r.call(this,"resolution",{width:s.sendResolutionWidth,height:s.sendResolutionHeight})),s&&a&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,a.track,s);break}case pS.LocalAudioTrack:{const e=i,r=uL({},GT),s=t.getStats(),o=t.getLocalMedia(n);if(s){const n=s.audioSend.find((t=>t.ssrc===(null==o?void 0:o.ssrcs[0].ssrcId)));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(r.codecType=n.codec),n.inputLevel)r.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const e=t.getLocalAudioVolume();e&&(r.sendVolumeLevel=Math.round(32767*e))}r.sendBytes=n.bytes,r.sendPackets=n.packets,r.sendPacketsLost=n.packetsLost,r.sendJitterMs=n.jitterMs,r.sendRttMs=n.rttMs,r.sendBitrate=e?8*Math.max(0,r.sendBytes-e.sendBytes):0}}this.trafficStats&&(r.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(pS.LocalAudioTrack,r),r&&o&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,o.track,r);break}}}))}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach((e=>{let[n,{videoStats:i,audioStats:r,videoPcStats:s}]=e;const o=r,a=i,c=s,l=uL({},zT),u=uL({},KT),d=uL({},WT),{audioTrack:h,videoTrack:A,audioSSRC:p,videoSSRC:f}=t.getRemoteMedia(n),m=t.getStats(),g=null==m?void 0:m.audioRecv.find((t=>t.ssrc===p)),v=null==m?void 0:m.videoRecv.find((t=>t.ssrc===f)),y=this.trafficStats&&this.trafficStats.peer_delay.find((t=>t.peer_uid===n));if(g&&("opus"!==g.codec&&"aac"!==g.codec&&"PCMU"!==g.codec&&"PCMA"!==g.codec&&"G722"!==g.codec||(l.codecType=g.codec),g.outputLevel?l.receiveLevel=Math.round(32767*g.outputLevel):h&&(l.receiveLevel=Math.round(32767*h.getVolumeLevel())),l.receiveBytes=g.bytes,l.receivePackets=g.packets,l.receivePacketsLost=g.packetsLost,l.packetLossRate=l.receivePacketsLost/(l.receivePackets+l.receivePacketsLost),l.receiveBitrate=o?8*Math.max(0,l.receiveBytes-o.receiveBytes):0,l.totalDuration=o?o.totalDuration+1:1,l.totalFreezeTime=o?o.totalFreezeTime:0,l.freezeRate=l.totalFreezeTime/l.totalDuration,l.receiveDelay=g.jitterBufferMs,l.totalDuration>10&&dL.isRemoteAudioFreeze(h)&&(l.totalFreezeTime+=1)),v){"H264"!==v.codec&&"H265"!==v.codec&&"VP8"!==v.codec&&"VP9"!==v.codec&&"AV1X"!==v.codec&&"AV1"!==v.codec||(u.codecType=v.codec),u.receiveBytes=v.bytes,u.receiveBitrate=a?8*Math.max(0,u.receiveBytes-a.receiveBytes):0,u.decodeFrameRate=v.decodeFrameRate<0?0:v.decodeFrameRate,u.renderFrameRate=v.decodeFrameRate<0?0:v.decodeFrameRate,v.outputFrame&&(u.renderFrameRate=v.outputFrame.frameRate),v.receivedFrame?(u.receiveFrameRate=v.receivedFrame.frameRate,u.receiveResolutionHeight=v.receivedFrame.height,u.receiveResolutionWidth=v.receivedFrame.width):A&&(u.receiveResolutionHeight=A._videoHeight||0,u.receiveResolutionWidth=A._videoWidth||0),void 0!==v.framesRateFirefox&&(u.receiveFrameRate=Math.round(v.framesRateFirefox)),u.receivePackets=v.packets,u.receivePacketsLost=v.packetsLost,u.packetLossRate=u.receivePacketsLost/(u.receivePackets+u.receivePacketsLost),u.totalDuration=a?a.totalDuration+1:1,u.totalFreezeTime=a?a.totalFreezeTime:0,u.receiveDelay=v.jitterBufferMs||0;const e=!!f&&t.getRemoteVideoIsReady(f);A&&e&&dL.isRemoteVideoFreeze(A,v,c)&&(u.totalFreezeTime+=1),u.freezeRate=u.totalFreezeTime/u.totalDuration}y&&(l.end2EndDelay=y.B_ad,u.end2EndDelay=y.B_vd,l.transportDelay=y.B_ed,u.transportDelay=y.B_ed,l.currentPacketLossRate=y.B_ealr4/100,u.currentPacketLossRate=y.B_evlr4/100,d.uplinkNetworkQuality=y.B_punq?y.B_punq:0,d.downlinkNetworkQuality=y.B_pdnq?y.B_pdnq:0),this.remoteStats.set(n,{audioStats:l,videoStats:u,videoPcStats:v,networkStats:d}),h&&this.exceptionMonitor.setRemoteAudioStats(h,l),A&&this.exceptionMonitor.setRemoteVideoStats(A,u)}))}}function hL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function AL(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?hL(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):hL(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function pL(t){return t.match(/^[\.\:\d]+$/)?"".concat(t.replace(/[^\d]/g,"-"),".").concat(NE("TURN_DOMAIN")):(zE.info("Cannot recognized as IP address ".concat(t,". Used As Host instead")),t)}function fL(t,e){var n,i;const r=NE("GATEWAY_DOMAINS");let s=r[1]&&-1!==e.indexOf(r[1])?1:0;t.addresses=t.addresses||[];const o=t.addresses.map((t=>t.domain_prefix?{address:"".concat(t.domain_prefix,".").concat(r[s++%r.length],":").concat(t.port)}:t.ip.match(/^[\.\:\d]+$/)?{ip:t.ip,port:t.port,address:"".concat(t.ip.replace(/[^\d]/g,"-"),".").concat(r[s++%r.length],":").concat(t.port)}:(zE.info("Cannot recognized as IP address ".concat(t.ip,". Used As Host instead")),{ip:t.ip,port:t.port,address:"".concat(t.ip,":").concat(t.port)})));if(null!==(n=t.detail)&&void 0!==n&&n[18]&&"string"==typeof(null===(i=t.detail)||void 0===i?void 0:i[18])){const e=t.detail[18],n=null==e?void 0:e.split(";");for(let t=0;t<n.length;t++){var a;const e=gT(a=n[t]).call(a);o[t]&&e&&(o[t].ip6=e)}}return{gatewayAddrs:o,uid:t.uid,cid:t.cid,cert:t.cert,vid:t.detail&&t.detail[8],uni_lbs_ip:t.detail&&t.detail[1],res:t,csIp:t.detail&&t.detail[502]}}function mL(t){return"number"==typeof t?t:t.exact||t.ideal||t.max||t.min||0}function gL(t){const e=t._encoderConfig;if(!e)return{};const n={resolution:e.width&&e.height?"".concat(mL(e.width),"x").concat(mL(e.height)):void 0,maxVideoBW:e.bitrateMax,minVideoBW:e.bitrateMin};return"number"==typeof e.frameRate?(n.maxFrameRate=e.frameRate,n.minFrameRate=e.frameRate):e.frameRate&&(n.maxFrameRate=e.frameRate.max||e.frameRate.ideal||e.frameRate.exact||e.frameRate.min,n.minFrameRate=e.frameRate.min||e.frameRate.ideal||e.frameRate.exact||e.frameRate.max),n}function vL(t){const e={connectionType:0,googRtt:t.rtt};switch(t.selectedCandidatePair.localCandidate.candidateType){case"relay":{const n=t.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(e.connectionType=1),"tcp"===n&&(e.connectionType=3),"tls"===n&&(e.connectionType=4);break}case"srflx":e.connectionType=2}return e}function yL(t){return t>=0&&t<.17?1:t>=.17&&t<.36?2:t>=.36&&t<.59?3:t>=.59&&t<=1?4:t>1?5:0}function _L(t,e){let n,i,r;switch(e){case dT.CHOOSE_SERVER:i=4096,r="choose server";break;case dT.CLOUD_PROXY:i=1048576,r="proxy";break;case dT.CLOUD_PROXY_5:i=4194304,r="proxy5";break;case dT.CLOUD_PROXY_FALLBACK:i=4194310,r="proxy fallback";break;default:throw new Bw(Bv.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:t.detail&&t.detail[502],retry:!1})}if(t.response_body.forEach((e=>{e.buffer&&e.buffer.flag===i&&(n={code:e.buffer.code,addresses:(e.buffer.edges_services||[]).map((t=>AL(AL({},t),{},{ticket:e.buffer.cert}))),server_ts:t.enter_ts,uid:e.buffer.uid,cid:e.buffer.cid,cname:e.buffer.cname,detail:AL(AL({},e.buffer.detail),t.detail),flag:e.buffer.flag,opid:t.opid,cert:e.buffer.cert})})),!n)throw new Bw(Bv.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:t.detail&&t.detail[502]});return n}async function bL(t,e){return await ev.all(t.addresses.map((async t=>({address:pL(t.ip),tcpport:t.port,udpport:t.port,username:e&&NE("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?e.toString():ow.username,password:e&&NE("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await ey(e.toString()):ow.password}))))}function EL(t,e){const n=e._videoHeight||e.getMediaStreamTrack(!0).getSettings().height;return n?Math.max(n/mL(t.height),1):(zE.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function wL(t){let{candidateType:e,relayProtocol:n,type:i,address:r,port:s,protocol:o}=t;return"local-candidate"===i?{candidateType:e,relayProtocol:n,protocol:o}:{candidateType:e,relayProtocol:n,address:r,port:s,protocol:o}}function SL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}class TL extends ny{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){var e;kr(e=["tryNext","recover"]).call(e,t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,"reconnecting"===this._state?this.emit(ES.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(ES.CONNECTED):"closed"===this._state?this.emit(ES.CLOSED):"failed"===this._state&&this.emit(ES.FAILED))}constructor(t,e,n,i){super(),ih(this,"connectionID",0),ih(this,"currentURLIndex",0),ih(this,"reconnectReason",void 0),ih(this,"_reconnectMode","tryNext"),ih(this,"_name",void 0),ih(this,"_state","closed"),ih(this,"_retryConfig",void 0),ih(this,"_reconnectCount",0),ih(this,"_forceCloseTimeout",5e3),ih(this,"_onlineReconnectListener",void 0),ih(this,"_closeEstablishingTransmitter",(()=>{})),ih(this,"_store",void 0),ih(this,"_joinChannelServiceRecordIndex",void 0),ih(this,"_useCompress",void 0),ih(this,"_inflateLength",0),ih(this,"_deflateLength",0),this._store=i,this._name=t,this._retryConfig=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?SL(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):SL(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},e),this._useCompress=n}resetReconnectCount(t){zE.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,e){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const t=this._transmitter;e?setTimeout((()=>t.close()),500):t.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,e){if(!this._transmitter)return void zE.warning("[".concat(this._name,"] can not reconnect, no websocket"));var n;void 0!==t&&(this.reconnectMode=t),zE.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(n=this._store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(e)]},this._joinChannelServiceRecordIndex));const i=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),i&&i.bind(this._transmitter)({code:9999,reason:e})}getInflateData(){const t=this._inflateLength,e=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:e}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var CL;!function(t){t[t.Default=0]="Default",t[t.Ack=1]="Ack"}(CL||(CL={}));class RL{constructor(t,e,n){ih(this,"version",1),ih(this,"initialRTO",void 0),ih(this,"maxBatchAckCount",void 0),ih(this,"maxRTO",void 0),ih(this,"initialRTT",void 0),ih(this,"ID",void 0),ih(this,"rtt",void 0),ih(this,"packetNumber",1),ih(this,"rtoRatioMap",new Map),ih(this,"timeoutMap",new Map),ih(this,"unorderedPacketQueue",[]),ih(this,"batchAckPacketQueue",[]),ih(this,"lastOrderedPacketNumber",0),ih(this,"batchAckTimer",void 0),ih(this,"sendImpl",void 0),ih(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=e,this.ID=By(7,"transmitter-"),this.initialRTO=void 0!==(null==n?void 0:n.initialRTO)?n.initialRTO:NE("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==(null==n?void 0:n.initialRTT)?n.initialRTT:NE("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==(null==n?void 0:n.initialRTT)?n.initialRTT:NE("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==(null==n?void 0:n.maxBatchAckCount)?n.maxBatchAckCount:NE("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==(null==n?void 0:n.maxRTO)?n.maxRTO:NE("TRANSMITTER_MAX_RTO")}packetize(t,e){return{type:CL.Default,version:this.version,packetNumber:e,payload:t}}serialize(t){switch(t.type){case CL.Default:{let e;e="string"==typeof t.payload?(new TextEncoder).encode(t.payload):t.payload;const n=new ArrayBuffer(e.length+15),i=new DataView(n);return i.setUint16(0,t.version),i.setUint8(2,t.type),i.setUint32(3,t.packetNumber),qv(i,7,BigInt(t.sendTs)),new Uint8Array(i.buffer).set(e,15),n}case CL.Ack:{const e=new ArrayBuffer(16),n=new DataView(e);return n.setUint16(0,t.version),n.setUint8(2,t.type),n.setUint32(3,t.maxAckPacketNumber),n.setUint8(7,t.shift),qv(n,8,BigInt(t.ackSendTs)),e}}}deserialize(t){const e=new DataView(t),n=e.getUint16(0),i=e.getUint8(2);switch(i){case CL.Default:{const r=e.getUint32(3),s=Kv(e,7),o=t.slice(15),a=(new TextDecoder).decode(o);return{version:n,type:i,packetNumber:r,sendTs:Number(s),payload:a}}case CL.Ack:{const t=e.getUint32(3),r=e.getUint8(7),s=Kv(e,8);return{version:n,type:i,maxAckPacketNumber:t,shift:r,ackSendTs:Number(s)}}default:throw zE.error("[".concat(this.ID,"] Unrecognized packet type ").concat(i)),new Error("Unrecognized packet type ".concat(i))}}sendMessage(t){const e=this.packetize(t,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const n=this.calculateRTO(e),i=window.setTimeout((()=>{this.resendMessage(e)}),n);this.timeoutMap.set(e.packetNumber,i),this.sendPacket(e)}onData(t){const e=this.deserialize(t);e.type===CL.Default?this.ack(e):e.type===CL.Ack&&(this.updateRTT(e,Math.round(performance.now())),this.clearRTO(e))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach((t=>{let[e,n]=t;window.clearTimeout(n)})),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const e=this.calculateRTO(t),n=window.setTimeout((()=>{this.resendMessage(t)}),e);this.timeoutMap.set(t.packetNumber,n),this.sendPacket(t)}calculateRTO(t){const e=this.rtoRatioMap.get(t.packetNumber);if(void 0===e)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const n=9*this.rtt/8*e;return this.rtoRatioMap.set(t.packetNumber,e+1),n>this.maxRTO?this.maxRTO:n}}updateRTT(t,e){const n=t.ackSendTs;this.rtt=this.rtt*(7/8)+(e-n-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout((()=>{this.batchAck()}),this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const t=this.unorderedPacketQueue[0];if(!t){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(t.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const e={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:CL.Ack,version:this.version};this.sendPacket(e)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const e={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:CL.Ack,version:this.version};this.sendPacket(e)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:CL.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===CL.Default&&(t.sendTs=Math.round(performance.now()));const e=this.serialize(t);this.sendImpl(e)}clearRTO(t){for(let e=t.maxAckPacketNumber-t.shift;e<=t.maxAckPacketNumber;e++){const t=this.timeoutMap.get(e);void 0!==t&&window.clearTimeout(t),this.timeoutMap.delete(e),this.rtoRatioMap.delete(e)}}}class IL extends TL{constructor(t,e){super(t,e,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),ih(this,"_initMutex",void 0),ih(this,"_reconnectInterrupter",void 0),ih(this,"_url",void 0),ih(this,"_transmitter",void 0),ih(this,"_addresses",void 0),ih(this,"_reliableTransmission",void 0),this._initMutex=new Wy("datachannel");const{timeout:n,timeoutFactor:i}=e,r=Math.max(300,Math.floor(3*n/5)),s=Math.max(1.2,Math.floor(8*i)/10);dy.ONLINE&&(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=s),by.on(hy.NETWORK_STATE_CHANGE,((t,e)=>{t!==e&&(this.resetReconnectCount("network state change: ".concat(e," -> ").concat(t)),t===dy.ONLINE?(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=s):(this._retryConfig.timeout=n,this._retryConfig.timeoutFactor=i))}))}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this._forceCloseTimeout=e;const n=(e,n)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex((t=>t.fingerprint||NE("FINGERPRINT")));const i=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(i).then(e).catch(n),this.once(ES.CLOSED,(()=>n(new Bw(Bv.WS_DISCONNECT)))),this.once(ES.CONNECTED,(()=>e()))};return this._initMutex.lock().then((t=>new ev(((t,e)=>{n(t,e)})).then((()=>{t()})).catch((()=>{t()}))))}sendMessage(t){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new Bw(Bv.WS_ABORT,"datachannel is not ready");try{e||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(t){throw new Bw(Bv.WS_ERR,"send datachannel signal message error"+t.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const e=JSON.stringify(t);return{compressed:e,compressedLength:e.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new ev(((e,n)=>{var i;const r=()=>{zE.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),e()},s=async t=>{var i;if(null===(i=this._closeEstablishingTransmitter)||void 0===i||i.call(this),zE.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(t.code,", reason: ").concat(t.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){"connected"===this.state&&(this.reconnectReason=t.reason,this.state="reconnecting");const i=yy(this,ES.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,r=await this.reconnectWithAction(i);if("closed"===this.state)return void zE.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!r)return n(new Bw(Bv.WS_DISCONNECT,"datachannel reconnect failed: ".concat(t.code))),void this.close(!0);e()}else n(new Bw(Bv.WS_DISCONNECT,"datachannel close: ".concat(t.code))),this.close()},o=t=>{var e;null===(e=this._reliableTransmission)||void 0===e||e.onData(t.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),zE.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const a=null===(i=this._store)||void 0===i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),c=Date.now();gy(this,ES.TO_CONNECT_DATACHANNEL,t).then((t=>{var e,n;if(!t)throw new Error("transmissonInfo not exist yet");const{transmitter:i,close:l}=t;this._transmitter=i,null===(e=this._store)||void 0===e||e.signalChannelOpen();const u=Date.now()-c;zE.debug("[choose dc] dc open cost ".concat(u,"ms")),this._reliableTransmission=new RL((t=>{var e;this._transmitter&&"open"===this._transmitter.readyState&&(null===(e=this._transmitter)||void 0===e||e.send(t))}),(t=>{"string"==typeof t&&this.emit(ES.ON_MESSAGE,t)})),this._closeEstablishingTransmitter=()=>{var t;null===(t=this._reliableTransmission)||void 0===t||t.close(),this._reliableTransmission=void 0,l()},r&&r(),i.onclose=s,i.onmessage=o,null===(n=this._store)||void 0===n||n.recordJoinChannelService({endTs:Date.now(),status:"success"},a),this._joinChannelServiceRecordIndex=a})).catch((t=>{var e;if(null===(e=this._store)||void 0===e||e.recordJoinChannelService({endTs:Date.now(),status:t instanceof Bw&&t.code===Bv.WS_ABORT?"aborted":"error",errors:[t]},a),"closed"!==this.state){if(t instanceof Bw&&t.code===Bv.WS_ERR){const e=new Bw(Bv.WS_ERR,"init datachannel failed! Error: ".concat(t.toString()));return zE.error("[".concat(this._name,"]").concat(e)),void n(e)}s&&s(t)}else n(new Bw(Bv.WS_DISCONNECT,"datachannel is closed: ".concat(t.toString())))}))}))}async reconnectWithAction(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount)return!1;if(!this._addresses)return!1;if("closed"===this.state)return!1;this._onlineReconnectListener||by.networkState!==dy.OFFLINE||(this._onlineReconnectListener=by.onlineWaiter&&by.onlineWaiter.then((()=>{this._onlineReconnectListener=void 0})));let n=!0;if(this._reconnectInterrupter=()=>{n=!1},e){const e=Yy(this._reconnectCount,this._retryConfig);zE.debug("[".concat(this._name,"] wait ").concat(e,"ms to reconnect datachannel, mode: ").concat(t)),await ev.race([Dy(e),this._onlineReconnectListener||new ev((()=>{}))])}if("closed"===this.state||!n)return!1;this._reconnectCount+=1;const i=async(t,e)=>{this.emit(ES.RECONNECT_CREATE_CONNECTION,e),await this.createTransmitterConnection(t)};try{if("retry"===t){const e=this._addresses[this.currentURLIndex];this.emit(ES.RECONNECT_WAITTING_FINISH,t),await i(e,t)}else if("tryNext"===t){this.currentURLIndex+=1;for(let t=this.currentURLIndex;t<this._addresses.length;t++){if(this._addresses[t].fingerprint||NE("FINGERPRINT")){this.currentURLIndex=t;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return zE.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);zE.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const e=this._addresses[this.currentURLIndex];this.emit(ES.RECONNECT_WAITTING_FINISH,t),await i(e,t)}else"recover"===t&&(zE.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(ES.RECONNECT_WAITTING_FINISH,t),this.emit(ES.FAILBACK));return!0}catch(n){var r,s;return zE.error("[".concat(this._name,"] reconnect failed"),n.toString()),null!=n&&null!==(r=n.data)&&void 0!==r&&r.desc&&Array.isArray(n.data.desc)&&n.data.desc.length&&kr(s=n.data.desc).call(s,"dynamic key expired")?(this.emit(ES.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,e)}}}class xL extends ny{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===gw.CONNECTED?this.emit(vw.WS_CONNECTED):t===gw.RECONNECTING?this.emit(vw.WS_RECONNECTING,this._websocketReconnectReason):t===gw.CLOSED&&this.emit(vw.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),ih(this,"_disconnectedReason",void 0),ih(this,"_websocketReconnectReason",void 0),ih(this,"_connectionState",gw.CLOSED),ih(this,"reconnectToken",void 0),ih(this,"websocket",void 0),ih(this,"openConnectionTime",void 0),ih(this,"clientId",void 0),ih(this,"lastMsgTime",Date.now()),ih(this,"uploadCache",[]),ih(this,"uploadCacheInterval",void 0),ih(this,"rttRolling",new l_(5)),ih(this,"pingpongTimer",void 0),ih(this,"inflateDataTimer",void 0),ih(this,"pingpongTimeoutCount",0),ih(this,"joinResponse",void 0),ih(this,"multiIpOption",void 0),ih(this,"initError",void 0),ih(this,"spec",void 0),ih(this,"store",void 0),ih(this,"onWebsocketMessage",(t=>{if(t instanceof ArrayBuffer)return void this.emit(vw.ON_BINARY_DATA,t);const e=JSON.parse(t);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(e,"_id")){const t="res-@".concat(e._id);this.emit(t,e._result,e._message)}else if(Object.prototype.hasOwnProperty.call(e,"_type")&&(this.emit(e._type,e._message),e._type===bw.ON_NOTIFICATION&&this.handleNotification(e._message),e._type===bw.ON_USER_BANNED))switch(e._message.error_code){case 14:this.close(cy.UID_BANNED);break;case 15:this.close(cy.IP_BANNED);break;case 16:this.close(cy.CHANNEL_BANNED)}})),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new IL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,e),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===gw.CONNECTED&&this.reconnect("retry",bS.OFFLINE)}))}async request(t,e,n,i){const r=By(6,""),s={_id:r,_type:t,_message:e},o=this.websocket.connectionID,a=()=>new ev(((e,n)=>{if(this.connectionState===gw.CONNECTED)return e();const i=()=>{this.off(vw.WS_CLOSED,r),e()},r=()=>{this.off(vw.WS_CONNECTED,i),n(new Bw(Bv.WS_ABORT))};this.once(vw.WS_CONNECTED,i),this.once(vw.WS_CLOSED,r),t!==yw.PUBLISH&&t!==yw.SUBSCRIBE&&t!==yw.UNSUBSCRIBE&&t!==yw.UNPUBLISH&&t!==yw.CONTROL&&t!==yw.RESTART_ICE||this.once(vw.DISCONNECT_P2P,(()=>{n(new Bw(Bv.DISCONNECT_P2P))})),t!==yw.PUBLISH&&t!==yw.RESTART_ICE||this.once(vw.ABORT_P2P_EXECUTION,(()=>{n(new Bw(Bv.DISCONNECT_P2P))}))}));if(this.connectionState!==gw.CONNECTING&&this.connectionState!==gw.RECONNECTING||t===yw.JOIN||t===yw.REJOIN||await a(),t===yw.LEAVE&&(this.websocket.unbindDcCloseEventListener(),i=!0),this.websocket.sendMessage(s,!0,!1),i)return;const c=new ev(((n,i)=>{let s=!1;const a=(i,r)=>{s=!0,n({isSuccess:"success"===i,message:r||{}}),this.off(vw.WS_CLOSED,c),this.off(vw.WS_RECONNECTING,c),this.emit(vw.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(r),a);const c=()=>{i(new Bw(Bv.WS_ABORT,"type: ".concat(t))),this.off(vw.WS_CLOSED,c),this.off(vw.WS_RECONNECTING,c),this.off("res-@".concat(r),a)};this.once(vw.WS_CLOSED,c),this.once(vw.WS_RECONNECTING,c),Dy(NE("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==o||s||(zE.warning("dc request timeout, type: ".concat(t)),this.emit(vw.REQUEST_TIMEOUT,t,e))}))}));let l=null;try{l=await c}catch(i){if(this.connectionState===gw.CLOSED||t===yw.LEAVE)throw new Bw(Bv.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?i.throw():t===yw.JOIN||t===yw.REJOIN?null:(await a(),await this.request(t,e))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),d=DS(u),h=new Bw(Bv.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(l.message.error_str),{code:u,data:l.message});return"success"===d.action?l.message:(zE.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(u,", message: ").concat(d.desc,", action: ").concat(d.action)),u===mw.ERR_TOO_MANY_BROADCASTERS?t===yw.JOIN||t===yw.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(u===mw.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,zE.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",bS.MULTI_IP)):this.reconnect(d.action,bS.SERVER_ERROR),t===yw.JOIN||t===yw.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new ev((n=>{const i=r=>{(!e||e(r))&&(this.off(t,i),n(r))};this.on(t,i)}))}upload(t,e){const n={_type:t,_message:e};try{this.websocket.sendMessage(n)}catch(t){const e=NE("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==gw.CONNECTED)return;const t=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(t._type,t._message)}),NE("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const n={_type:t,_message:e};this.websocket.sendMessage(n)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ev(((n,i)=>{this.once(vw.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(vw.WS_CLOSED,(()=>i(this.initError||new Bw(Bv.WS_ABORT)))),this.connectionState=gw.CONNECTING,this.websocket.init(t).catch(i),this.websocket.once(ES.FAILBACK,(()=>{void 0===this.openConnectionTime&&i(new Bw(Bv.INIT_DATACHANNEL_TIMEOUT))})),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval((()=>{this.handleInflateData()}),2e4),setTimeout((()=>{e&&void 0===this.openConnectionTime&&(zE.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),i(new Bw(Bv.INIT_DATACHANNEL_TIMEOUT)))}),NE("DC_JOIN_WITH_FAILBACK"))}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||cy.LEAVE,this.connectionState=gw.CLOSED,zE.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===cy.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new IL("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(vw.ABORT_P2P_EXECUTION);const t=await gy(this,vw.DATACHANNEL_CONNECTING),e=await this.request(yw.JOIN,t);if(!e)return this.emit(vw.REPORT_JOIN_GATEWAY,Bv.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(vw.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=gw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Bw(Bv.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=_y(this,vw.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const e=await this.request(yw.REJOIN,t);return!!e&&(this.connectionState=gw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),e.peers&&e.peers.forEach((t=>{this.emit(bw.ON_USER_ONLINE,{uid:t.uid}),t.audio&&this.emit(bw.ON_ADD_AUDIO_STREAM,{uid:t.uid,uint_id:t.uint_id,audio:!0,ssrcId:t.audio_ssrc}),t.video&&this.emit(bw.ON_ADD_VIDEO_STREAM,{uid:t.uid,uint_id:t.uint_id,video:!0,ssrcId:t.video_ssrc}),t.audio_mute?this.emit(bw.MUTE_AUDIO,{uid:t.uid}):this.emit(bw.UNMUTE_AUDIO,{uid:t.uid}),t.video_mute?this.emit(bw.MUTE_VIDEO,{uid:t.uid}):this.emit(bw.UNMUTE_VIDEO,{uid:t.uid}),t.audio_enable_local?this.emit(bw.ENABLE_LOCAL_AUDIO,{uid:t.uid}):this.emit(bw.DISABLE_LOCAL_AUDIO,{uid:t.uid}),t.video_enable_local?this.emit(bw.ENABLE_LOCAL_VIDEO,{uid:t.uid}):this.emit(bw.DISABLE_LOCAL_VIDEO,{uid:t.uid}),t.audio||t.video||this.emit(bw.ON_REMOVE_STREAM,{uid:t.uid,uint_id:t.uint_id})})),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleNotification(t){zE.debug("[".concat(this.clientId,"] receive notification: "),t);const e=DS(t.code);if("success"!==e.action){if("failed"!==e.action)return"quit"===e.action?("ERR_REPEAT_JOIN_CHANNEL"===e.desc&&this.close(cy.UID_BANNED),void this.close()):void this.reconnect(e.action,bS.SERVER_ERROR);zE.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=NE("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(zE.warning("PINGPONG Timeout. Last Socket Message: ".concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>NE("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",bS.TIMEOUT):this.request(yw.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const t=Date.now()-e;this.rttRolling.add(t),NE("REPORT_STATS")&&this.send(yw.PING_BACK,{pingpongElapse:t})})).catch((t=>{}))}handleInflateData(){const{inflateLength:t,deflateLength:e}=this.websocket.getInflateData();0!==t&&0!==e&&this.upload(_w.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(ES.RECONNECT_WAITTING_FINISH,(t=>{this.emit(vw.WS_RECONNECT_WAITTING_FINISH,t)})),this.websocket.on(ES.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(vw.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(ES.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(ES.CLOSED,(()=>{this.connectionState=gw.CLOSED})),this.websocket.on(ES.FAILED,(()=>{this._disconnectedReason=cy.NETWORK_ERROR,this.connectionState=gw.CLOSED})),this.websocket.on(ES.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===gw.CONNECTED?this.connectionState=gw.RECONNECTING:this.connectionState=gw.CONNECTING})),this.websocket.on(ES.WILL_RECONNECT,((t,e)=>{if(_y(this,vw.IS_P2P_DISCONNECTED)&&"retry"===t)return zE.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(vw.NEED_RENEW_SESSION),this.emit(vw.DISCONNECT_P2P),e("tryNext");"retry"!==t&&(zE.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(vw.NEED_RENEW_SESSION),this.emit(vw.DISCONNECT_P2P)),e(t)})),this.websocket.on(ES.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((t=>{zE.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",bS.SERVER_ERROR)})):this.join().catch((t=>{if(this.emit(vw.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof Bw&&t.code===Bv.UNEXPECTED_RESPONSE&&t.data.code===mw.ERR_NO_AUTHORIZED)return zE.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",bS.SERVER_ERROR);zE.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",bS.SERVER_ERROR):(this.initError=t,this.close())}))})),this.websocket.on(ES.REQUEST_NEW_URLS,((t,e)=>{gy(this,vw.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)})),this.websocket.on(ES.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(bw.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(ES.TO_CONNECT_DATACHANNEL,(async(t,e,n)=>gy(this,vw.DATACHANNEL_PRECONNECT,t).then(e).catch(n))),this.websocket.on(ES.FAILBACK,(()=>{void 0!==this.openConnectionTime&&this.emit(vw.DATACHANNEL_FAILBACK)}))}}class OL extends ny{constructor(t){super(),ih(this,"_signal",void 0),ih(this,"_sequence",0),ih(this,"_userMap",new Map),ih(this,"_encoder",new TextEncoder),this._signal=t}async send(t,e,n,i,r){var s,o,a;"string"!=typeof e&&(e=JSON.stringify(e)),i=null!==(s=i)&&void 0!==s?s:By(6,""),r=null!==(o=r)&&void 0!==o?o:this._sequence++;const c={_id:i,_type:t,_seq:null!==(a=r)&&void 0!==a?a:this._sequence++,_message:e};if(NE("SHOW_P2P_LOG")&&zE.debug("send message",c),this.sendStreamMessage(JSON.stringify(c)),n)return;const l=new ev(((e,n)=>{const r=window.setTimeout((()=>{this.off("res-@".concat(i),s),zE.warning("[external-signal] request timeout, type: ".concat(t)),0===this._userMap.size?n(new Uv(Bv.INVALID_REMOTE_USER)):n(new Uv(Bv.TIMEOUT))}),NE("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),s=(t,i)=>{r&&window.clearTimeout(r),"success"===t?e({isSuccess:!0,message:i}):n(new Uv(Bv.UNEXPECTED_ERROR,i))};this.once("res-@".concat(i),s)}));let u;try{u=await l}catch(n){if(n.code===Bv.TIMEOUT)return await this.send(t,e,!1,i,r);throw n}return u.isSuccess?u.message:void 0}sendStreamMessage(t){this._splitMessage(t).forEach((t=>{this._signal.request(yw.DATA_STREAM,{payload:My(this._encoder.encode(t))})}))}onMessage(t){const{_uid:e}=t;let n;const i=this._userMap.get(e);if(i?n=i.splitMessageMap:(n=new Map,this._userMap.set(e,{isStart:!1,splitMessageMap:n,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in t&&"total"in t){var r;const{id:i,total:s}=t,o=null!==(r=n.get(i))&&void 0!==r?r:[];if(o.push(t),n.has(i)||n.set(i,o),o.length!==s)return;{const r=Jh(o).call(o,((t,e)=>t.index-e.index)).map((t=>t.payload)).join("");n.delete(i),(t=JSON.parse(r))._uid=e}}this.handleReceivedMessage(t)}setStart(t){this._userMap.has(t)?this._userMap.get(t).isStart=!0:this._userMap.set(t,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(t){return this._userMap.delete(t),0===this._userMap.size}ack(t,e,n){this.send(IS.ACK,JSON.stringify({success:!n,message:e}),!0,t)}handleReceivedMessage(t){const e=()=>{this._userMap.forEach((t=>{const{receivedMessagesMap:e,nextExpectedSequenceNumber:n}=t;for(;e.has(n);){const i=e.get(n);e.delete(n),this.receiveMessage(i),t.nextExpectedSequenceNumber++}}))};if(!t)return void e();const{_uid:n,_seq:i}=t,r=this._userMap.get(n),{receivedMessagesMap:s,isStart:o,nextExpectedSequenceNumber:a}=r;i<a?zE.debug("[external-signal] receive old message, seq: ".concat(i)):(s.set(i,t),o&&i===a&&(this.receiveMessage(t),s.delete(a),r.nextExpectedSequenceNumber++,e()))}receiveMessage(t){const{_id:e,_type:n,_message:i,_uid:r}=t;if(NE("SHOW_P2P_LOG")&&zE.debug("æ¶å°æ¶æ¯",t),e)switch(t._type){case IS.PUBLISH:const s=JSON.parse(i);this._signal.emit(n,s,r),this.ack(t._id);break;case IS.CONTROL:case IS.UNPUBLISH:case IS.DO_SUBSCRIBE:case IS.DO_UNSUBSCRIBE:{const e=JSON.parse(i);e.uid=r,gy(this._signal,n,e).then((e=>{this.ack(t._id,e)})).catch((e=>{this.ack(t._id,void 0,!0)}));break}case IS.ACK:{const{success:t,message:n}=JSON.parse(i);this.emit("res-@".concat(e),t?"success":"failed",n);break}case IS.CALL:gy(this,n,i).then((t=>{this.ack(e,t)}));break;case IS.RESTART_ICE:case IS.EXCHANGE_SDP:case IS.SUBSCRIBE:case IS.UNSUBSCRIBE:gy(this._signal,n,i).then((t=>{this.ack(e,t)})).catch((e=>{this.ack(t._id,void 0,!0)}));break;case IS.CANDIDATE:this._signal.emit(n,i),this.ack(e);break;case IS.JOIN:this.emit(n,JSON.parse(i));break;default:this.emit(n,i),this.ack(e)}}_splitMessage(t){if(t.length<OL.MAX_MESSAGE_SIZE)return[t];const e=[],n=By(6,"");let i=0;const r=Math.ceil(t.length/800);for(;t.length>0;){i++;const s=t.slice(0,800);e.push({id:n,index:i,total:r,payload:s}),t=t.slice(800)}return e.map((t=>JSON.stringify(t)))}clear(){this._sequence=0,this._userMap.clear()}}ih(OL,"MAX_MESSAGE_SIZE",1024);class LL extends ny{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===gw.CONNECTED?this.emit(vw.WS_CONNECTED):t===gw.RECONNECTING?this.emit(vw.WS_RECONNECTING,this._websocketReconnectReason):t===gw.CLOSED&&this.emit(vw.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(t,e){super(),ih(this,"_disconnectedReason",void 0),ih(this,"_websocketReconnectReason",void 0),ih(this,"_connectionState",gw.CLOSED),ih(this,"reconnectToken",void 0),ih(this,"_userInRoom",!1),ih(this,"_userOnlineTime",void 0),ih(this,"websocket",void 0),ih(this,"openConnectionTime",void 0),ih(this,"clientId",void 0),ih(this,"lastMsgTime",Date.now()),ih(this,"uploadCache",[]),ih(this,"uploadCacheInterval",void 0),ih(this,"rttRolling",new l_(5)),ih(this,"pingpongTimer",void 0),ih(this,"wsInflateDataTimer",void 0),ih(this,"pingpongTimeoutCount",0),ih(this,"joinResponse",void 0),ih(this,"multiIpOption",void 0),ih(this,"initError",void 0),ih(this,"spec",void 0),ih(this,"store",void 0),ih(this,"_external_signal",void 0),ih(this,"onWebsocketMessage",(t=>{if(t.data instanceof ArrayBuffer)return void this.emit(vw.ON_BINARY_DATA,t.data);const e=JSON.parse(t.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(e,"_id")){const t="res-@".concat(e._id);this.emit(t,e._result,e._message)}else if(Object.prototype.hasOwnProperty.call(e,"_type")){switch(e._type){case bw.ON_DATA_STREAM:return void this.handleDataStream(e._message);case bw.MUTE_AUDIO:case bw.MUTE_VIDEO:case bw.ON_P2P_LOST:return;case bw.ON_USER_ONLINE:this.emit(e._type,e._message);const{uid:t}=e._message;return this._external_signal.setStart(t),void this._external_signal.send(IS.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(e._type,e._message),e._type===bw.ON_NOTIFICATION&&this.handleNotification(e._message),e._type===bw.ON_USER_BANNED)switch(e._message.error_code){case 14:this.close(cy.UID_BANNED);break;case 15:this.close(cy.IP_BANNED);break;case 16:this.close(cy.CHANNEL_BANNED)}if(e._type===bw.ON_USER_LICENSE_BANNED)switch(e._message.error_code){case mw.ERR_LICENSE_MISSING:this.close(cy.LICENSE_MISSING);break;case mw.ERR_LICENSE_EXPIRED:this.close(cy.LICENSE_EXPIRED);break;case mw.ERR_LICENSE_MINUTES_EXCEEDED:this.close(cy.LICENSE_MINUTES_EXCEEDED);break;case mw.ERR_LICENSE_PERIOD_INVALID:this.close(cy.LICENSE_PERIOD_INVALID);break;case mw.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(cy.LICENSE_MULTIPLE_SDK_SERVICE);break;case mw.ERR_LICENSE_ILLEGAL:this.close(cy.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=t.clientId,this.spec=t,this.store=e,this.websocket=new YS("gateway-".concat(this.clientId),this.spec.retryConfig,!0,NE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),NE("JOIN_GATEWAY_USE_443PORT_ONLY"),e),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===gw.CONNECTED&&this.reconnect("retry",uy.OFFLINE)})),this._external_signal=new OL(this),this._handleSignalP2PEvents()}async request(t,e,n,i){const r=By(6,""),s={_id:r,_type:t,_message:e},o=this.websocket.connectionID,a=()=>new ev(((e,n)=>{if(this.connectionState===gw.CONNECTED)return e();const i=()=>{this.off(vw.WS_CLOSED,r),e()},r=()=>{this.off(vw.WS_CONNECTED,i),n(new Uv(Bv.WS_ABORT))};this.once(vw.WS_CONNECTED,i),this.once(vw.WS_CLOSED,r),t!==yw.PUBLISH&&t!==yw.SUBSCRIBE&&t!==yw.UNSUBSCRIBE&&t!==yw.UNPUBLISH&&t!==yw.CONTROL&&t!==yw.RESTART_ICE||this.once(vw.DISCONNECT_P2P,(()=>{n(new Uv(Bv.DISCONNECT_P2P))})),t!==yw.PUBLISH&&t!==yw.RESTART_ICE||this.once(vw.ABORT_P2P_EXECUTION,(()=>{n(new Uv(Bv.DISCONNECT_P2P))}))}));if(this.connectionState!==gw.CONNECTING&&this.connectionState!==gw.RECONNECTING||t===yw.JOIN||t===yw.REJOIN||await a(),this.websocket.sendMessage(s,!0),i)return;const c=new ev(((n,i)=>{let s=!1;const a=(i,r)=>{s=!0,n({isSuccess:"success"===i,message:r||{}}),this.off(vw.WS_CLOSED,c),this.off(vw.WS_RECONNECTING,c),this.emit(vw.REQUEST_SUCCESS,t,e)};this.once("res-@".concat(r),a);const c=()=>{i(new Uv(Bv.WS_ABORT,"type: ".concat(t))),this.off(vw.WS_CLOSED,c),this.off(vw.WS_RECONNECTING,c),this.off("res-@".concat(r),a)};this.once(vw.WS_CLOSED,c),this.once(vw.WS_RECONNECTING,c),Dy(NE("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==o||s||(zE.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(vw.REQUEST_TIMEOUT,t,e))}))}));let l=null;try{l=await c}catch(i){if(this.connectionState===gw.CLOSED||t===yw.LEAVE)throw new Uv(Bv.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?i.throw():t===yw.JOIN||t===yw.REJOIN?null:(await a(),await this.request(t,e))}if(l.isSuccess)return l.message;const u=Number(l.message.error_code||l.message.code),d=DS(u),h=new Uv(Bv.UNEXPECTED_RESPONSE,"".concat(d.desc,": ").concat(l.message.error_str),{code:u,data:l.message});return"success"===d.action?l.message:(zE.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(u,", message: ").concat(d.desc,", action: ").concat(d.action)),u===mw.ERR_TOO_MANY_BROADCASTERS?t===yw.JOIN||t===yw.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===d.action?h.throw():"quit"===d.action?(this.initError=h,this.close(),h.throw()):(u===mw.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=l.message.option,zE.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",uy.MULTI_IP)):this.reconnect(d.action,uy.SERVER_ERROR),t===yw.JOIN||t===yw.REJOIN?null:await this.request(t,e)))}waitMessage(t,e){return new ev((n=>{const i=r=>{(!e||e(r))&&(this.off(t,i),n(r))};this.on(t,i)}))}upload(t,e){const n={_type:t,_message:e};try{this.websocket.sendMessage(n)}catch(t){const e=NE("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>e&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==gw.CONNECTED)return;const t=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(t._type,t._message)}),NE("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,e){const n={_type:t,_message:e};this.websocket.sendMessage(n)}async sendExtensionMessage(t,e,n){return await this.waitTillUserOnline(),await this._external_signal.send(t,e,n)}init(t,e){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new ev(((e,n)=>{this.once(vw.WS_CONNECTED,(()=>e(this.joinResponse))),this.once(vw.WS_CLOSED,(()=>n(this.initError||new Uv(Bv.WS_ABORT)))),this.connectionState=gw.CONNECTING,this.websocket.init(t).catch(n),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4)}))}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||cy.LEAVE,this.connectionState=gw.CLOSED,zE.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===cy.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new YS("gateway-".concat(this.clientId),this.spec.retryConfig,!0,NE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),NE("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(vw.ABORT_P2P_EXECUTION);const t=await gy(this,vw.REQUEST_JOIN_INFO),e=await this.request(yw.JOIN,t);if(!e)return this.emit(vw.REPORT_JOIN_GATEWAY,Bv.TIMEOUT,this.url||""),!1;this.joinResponse=e,this.emit(vw.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=gw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),this._userOnlineTime=(new Date).getTime(),this._external_signal.clear(),!0}async rejoin(){if(!this.reconnectToken)throw new Uv(Bv.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=_y(this,vw.REQUEST_REJOIN_INFO);return t.token=this.reconnectToken,!!await this.request(yw.REJOIN,t)&&(this.connectionState=gw.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0)}reconnect(t,e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,e)}handleDataStream(t){try{var e;const n=Ly(t.payload),i=(new TextDecoder).decode(n),r=JSON.parse(i);"total"in r&&"id"in r||kr(e=Object.values(IS)).call(e,r._type)?(t.seq&&delete t.seq,r._uid=t.uid,this._external_signal.onMessage(r)):this.emit(bw.ON_DATA_STREAM,t)}catch(t){}}handleNotification(t){zE.debug("[".concat(this.clientId,"] receive notification: "),t);const e=DS(t.code);if("success"!==e.action){if("failed"!==e.action)return"quit"===e.action?("ERR_REPEAT_JOIN_CHANNEL"===e.desc&&this.close(cy.UID_BANNED),void this.close()):void this.reconnect(e.action,uy.SERVER_ERROR);zE.error("[".concat(this.clientId,"] ignore error: "),e.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=NE("PING_PONG_TIME_OUT"),e=Date.now();this.pingpongTimeoutCount>=t&&(zE.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(e-this.lastMsgTime,"ms")),e-this.lastMsgTime>NE("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",uy.TIMEOUT):this.request(yw.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const t=Date.now()-e;this.rttRolling.add(t),NE("REPORT_STATS")&&this.send(yw.PING_BACK,{pingpongElapse:t})})).catch((t=>{}))}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:e}=this.websocket.getWsInflateData();0!==t&&0!==e&&this.upload(_w.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:e,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Sw.RECONNECT_WAITTING_FINISH,(t=>{this.emit(vw.WS_RECONNECT_WAITTING_FINISH,t)})),this.websocket.on(Sw.RECONNECT_CREATE_CONNECTION,(t=>{this.emit(vw.WS_RECONNECT_CREATE_CONNECTION,t)})),this.websocket.on(Sw.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Sw.CLOSED,(()=>{this.connectionState=gw.CLOSED})),this.websocket.on(Sw.FAILED,(()=>{this._disconnectedReason=cy.NETWORK_ERROR,this.connectionState=gw.CLOSED})),this.websocket.on(Sw.RECONNECTING,(t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===gw.CONNECTED?this.connectionState=gw.RECONNECTING:this.connectionState=gw.CONNECTING})),this.websocket.on(Sw.WILL_RECONNECT,((t,e,n)=>{if(_y(this,vw.IS_P2P_DISCONNECTED)&&"retry"===t)return zE.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(vw.NEED_RENEW_SESSION),this.emit(vw.DISCONNECT_P2P),n("tryNext");"retry"!==t&&(zE.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(vw.NEED_RENEW_SESSION),this.emit(vw.DISCONNECT_P2P)),n(t)})),this.websocket.on(Sw.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((t=>{zE.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",uy.SERVER_ERROR)})):this.join().catch((t=>{if(this.emit(vw.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof Uv&&t.code===Bv.UNEXPECTED_RESPONSE&&t.data.code===mw.ERR_NO_AUTHORIZED)return zE.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",uy.SERVER_ERROR);zE.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",uy.SERVER_ERROR):(this.initError=t,this.close())}))})),this.websocket.on(Sw.REQUEST_NEW_URLS,((t,e)=>{gy(this,vw.REQUEST_RECOVER,this.multiIpOption).then(t).catch(e)})),this.websocket.on(Sw.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(bw.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}_handleSignalP2PEvents(){this._external_signal.on(IS.JOIN,(async t=>{if(this._userOnlineTime&&this._userOnlineTime<t.onlineTime){const t=await gy(this,vw.P2P_START,void 0),e=await this._external_signal.send(IS.CALL,t);this.emit(vw.P2P_CONNECTION,e,!0)}this._userInRoom=!0,this.emit("user-online")})),this.on(bw.ON_USER_OFFLINE,(async t=>{this._external_signal.clear(),this._userInRoom=!1})),this._external_signal.on(IS.CALL,(async(t,e,n)=>{this._userInRoom=!0,this.emit("user-online");try{e(await gy(this,vw.P2P_START,t))}catch(t){n(t)}}))}async waitTillUserOnline(){return new ev((t=>{if(this._userInRoom)t();else{const e=()=>{this.off("user-online",e),t()};this.on("user-online",e)}}))}}function ML(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function kL(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?ML(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):ML(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const NL=new Map;class PL extends ny{get state(){return this._state}set state(t){if(t===this._state)return;const e=this._state;this._state=t,"DISCONNECTED"===t&&this._disconnectedReason?this.emit(tS.CONNECTION_STATE_CHANGE,t,e,this._disconnectedReason):this.emit(tS.CONNECTION_STATE_CHANGE,t,e)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){zE.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,e){super(),ih(this,"store",void 0),ih(this,"joinInfo",void 0),ih(this,"key",void 0),ih(this,"ntpOffset",0),ih(this,"signal",void 0),ih(this,"role",void 0),ih(this,"inChannelInfo",{joinAt:null,duration:0}),ih(this,"spec",void 0),ih(this,"_state","DISCONNECTED"),ih(this,"_statsCollector",void 0),ih(this,"_disconnectedReason",void 0),ih(this,"isSignalRecover",!1),ih(this,"hasChangeBGPAddress",!1),ih(this,"trafficStatsInterval",void 0),ih(this,"networkQualityInterval",void 0),ih(this,"_joinGatewayStartTime",0),ih(this,"_signalTimeout",!1),ih(this,"_clientRoleOptions",void 0),ih(this,"_isProactiveJoin",!1),this.store=t,this.spec=e,this.signal=this.store.useP2P?new LL(kL(kL({},e),{},{retryConfig:e.websocketRetryConfig}),t):this.store.useDataChannel?new xL(kL(kL({},e),{},{retryConfig:e.websocketRetryConfig}),t):new XS(kL(kL({},e),{},{retryConfig:e.websocketRetryConfig}),t),this._statsCollector=e.statsCollector,this.role=e.role||"audience",this._clientRoleOptions=e.clientRoleOptions,this.handleSignalEvents()}async join(t,e,n){if(this.signal instanceof xL){let e=!1;"disabled"!==t.cloudProxyServer?(zE.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),e=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(zE.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),e=!0):t.apResponse.addresses.some((t=>t.fingerprint))||NE("FINGERPRINT")||(zE.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),e=!0),e&&this.resetSignal()}this.store.joinGatewayStart(),"disabled"!==t.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const i=Date.now();let r=NL.get(t.cname);if(r||(r=new Map,NL.set(t.cname,r)),this._isProactiveJoin=!0,r.has(t.uid)){const e=new Bw(Bv.UID_CONFLICT);throw rw.joinGateway(t.sid,{lts:i,succ:!1,ec:e.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof xL?"1":"0"}),this._isProactiveJoin=!1,e}r.set(t.uid,!0),this.joinInfo=t,this.key=e;let s=0;this.joinGatewayStartTime=i;const o=t.proxyServer;try{let e;if(zE.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof xL?"datachannel":"websocket"," join uid ").concat(s)),this.signal instanceof xL)e=await this.signal.init(t.apResponse.addresses,n);else{const i=t.gatewayAddrs.map((e=>{let{address:n}=e;const[i,r]=n.split(":"),s={host:i,port:r};return t.proxyServer&&(s.proxy=t.proxyServer),s}));e=await this.signal.init(i,n)}s=e.uid,zE.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof xL?"datachannel":"websocket"," join uid ").concat(s," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(e){if(e&&e.code===Bv.INIT_WEBSOCKET_TIMEOUT)throw zE.warning("[".concat(this.store.clientId,"] User join failed"),e.toString()),e;if(e&&e.code===Bv.INIT_DATACHANNEL_TIMEOUT)throw zE.warning("[".concat(this.store.clientId,"] User join datachannel failed"),e.toString()),this.resetSignal(),e;throw zE.error("[".concat(this.store.clientId,"] User join failed"),e.toString()),rw.joinGateway(t.sid,{lts:i,succ:!1,ec:e.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!o,signalChannel:this.signal instanceof xL?"1":"0"}),this._isProactiveJoin=!1,r.delete(t.uid),this.signal.close(),e}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),zE.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((t=>{zE.warning("[".concat(this.store.clientId,"] get traffic stats error"),t.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(tS.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(tS.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(tS.NETWORK_QUALITY,{uplinkNetworkQuality:yL(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:yL(this._statsCollector.trafficStats.B_dnq)}):this.emit(tS.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),s}async leave(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){e!==cy.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==gw.CONNECTED||await function(t,e){return e===1/0?t:ev.race([t,Py(e)])}(this.signal.request(yw.LEAVE,void 0,!0),3e3)}catch(t){zE.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),t)}this.signal.close(e),e!==cy.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,e,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Bw(Bv.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const i={state:"offer",p2p_id:this.store.p2pId,ortc:e,mode:this.spec.mode,extend:NE("PUB_EXTEND"),twcc:!!NE("PUBLISH_TWCC"),rtx:!!NE("USE_PUB_RTX")};try{return(await this.signal.request(yw.PUBLISH,i,!0))._message}catch(i){if(n&&i.data&&i.data.code===mw.ERR_PUBLISH_REQUEST_INVALID)return zE.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),i.toString()),await this.tryUnpubBeforeRepub(t,e),this.publish(t,e,!1);throw i}}async publishDataChannel(t,e,n){var i;if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Bw(Bv.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={stream_id:e.streamId,ordered:e.ordered?1:0,max_retrans_times:null!==(i=e.maxRetransmits)&&void 0!==i?i:10,channel_id:e.channelId,metadata:e.metadata};try{await this.signal.request(yw.PUBLISH_DATASTREAM,r,!0)}catch(i){if(n&&i.data&&i.data.code===mw.ERR_PUBLISH_REQUEST_INVALID)return zE.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),i.toString()),await this.tryUnpubDataChannelBeforeRepub(t,e),this.publishDataChannel(t,e,!1);throw i}}async unpublish(t,e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Bw(Bv.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(yw.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(t){zE.warning("[".concat(this.store.clientId,"] unpublish warning: "),t)}}async unpublishDataChannel(t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Bw(Bv.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ev.all(t.map((t=>this.signal.request(yw.UNPUBLISH_DATASTREAM,{channel_id:t},!0))))}catch(t){zE.warning("unpublish datachannels warning: ",t)}}async subscribe(t,e,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Bw(Bv.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const i={stream_id:t,stream_type:e.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!NE("SUBSCRIBE_TWCC"),rtx:!!NE("USE_SUB_RTX"),extend:NE("SUB_EXTEND"),ssrcId:e.ssrcId,svc:Array.isArray(NE("SVC"))&&0!==NE("SVC").length?NE("SVC"):void 0};try{return(await this.signal.request(yw.SUBSCRIBE,i,!0))._message}catch(i){if(n&&i.data&&i.data.code===mw.ERR_SUBSCRIBE_REQUEST_INVALID)return zE.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),i.toString()),await this.tryUnsubBeforeResub(t,e),await this.subscribe(t,e,!1);throw i}}async subscribeDataChannel(t,e,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Bw(Bv.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const i={uid:t,stream_id:e.id,channel_id:e.datachannelId};try{return void await this.signal.request(yw.SUBSCRIBE_DATASTREAM,i,!0)}catch(i){if(n&&i.data&&i.data.code===mw.ERR_SUBSCRIBE_REQUEST_INVALID)return zE.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),i.toString()),await this.tryUnsubDataChannelBeforeResub(t,e),await this.subscribeDataChannel(t,e,!1);throw i}}async subscribeAll(t,e){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Bw(Bv.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!NE("USE_SUB_RTX")};try{return await this.signal.request(yw.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(e&&n.data&&n.data.code===mw.ERR_SUBSCRIBE_REQUEST_INVALID)return zE.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw n}}async setVideoProfile(t){const e=function(t){if(!(t.bitrateMax&&t.bitrateMin&&t.frameRate&&t.height&&t.width))return;let e=t.frameRate,n=t.width,i=t.height,r=!0;return"number"!=typeof e&&(e=e.exact||e.ideal||e.max||e.min||0,e||(r=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(r=!1)),"number"!=typeof i&&(i=i.exact||i.ideal||i.max||i.min||0,e||(r=!1)),r?{stream_type:0,width:n,height:i,fps:e,start_bps:1e3*t.bitrateMax,min_bps:1e3*t.bitrateMin,target_bps:1e3*t.bitrateMax}:void 0}(t);if(e)return this.signal.request(yw.SET_VIDEO_PROFILE,e);zE.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,e){try{await this.signal.request(yw.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:e},!0)}catch(t){zE.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),t)}}async unsubscribeDataChannel(t,e){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Bw(Bv.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await ev.all(t.map((t=>this.signal.request(yw.UNSUBSCRIBE_DATASTREAM,{stream_id:t,uid:e},!0))))}catch(t){zE.warning("unsubscribeDataChannel warning: ",t)}}async massUnsubscribe(t){try{await this.signal.request(yw.UNSUBSCRIBE_STREAMS,t,!0)}catch(t){zE.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),t)}}async reconnectPC(t){const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=t;return{gatewayEstablishParams:await this.signal.request(yw.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(yw.GATEWAY_INFO)}async renewToken(t){await this.signal.request(yw.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,e){if(e&&(this._clientRoleOptions=Object.assign({},e)),"CONNECTED"!==this.state)return void(this.role=t);let n,i=0;"audience"===t?this._clientRoleOptions&&this._clientRoleOptions.delay?(n=this._clientRoleOptions.delay,i=1):i=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:i=0,await this.signal.request(yw.SET_CLIENT_ROLE,{role:t,level:i,delay:n,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,e){await this.signal.request(yw.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:e})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(yw.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,e){await this.signal.request(yw.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:e})}async pickSVCLayer(t,e){await this.signal.request(yw.PICK_SVC_LAYER,{stream_id:t,spatial_layer:e.spatialLayer,temporal_layer:e.temporalLayer})}async setRTM2Flag(t){await this.signal.request(yw.SET_RTM2_FLAG,{rtm2_flag:t})}async sendExtensionMessage(t,e,n){if(this.signal instanceof LL)return this.signal.sendExtensionMessage(t,e,n)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),kL({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(yw.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=NL.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(t){let e;return e=t.startsWith("dc")?t.match(/(dc\:\/\/)?([^:]+):(\d+)/):t.match(/(wss\:\/\/)?([^:]+):(\d+)/),e?{username:ow.username,password:ow.password,turnServerURL:e[2],tcpport:parseInt(e[3])+30,udpport:parseInt(e[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(kL(kL({},ow),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const t=await this.signal.request(yw.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),null!=t.ntp_offset&&(this.ntpOffset=t.ntp_offset),t.peer_delay.forEach((t=>{const e=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((e=>e.peer_uid===t.peer_uid));e&&e.B_st!==t.B_st&&Cy((()=>{this.emit(tS.STREAM_TYPE_CHANGE,t.peer_uid,t.B_st)}))})),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new Bw(Bv.UNEXPECTED_ERROR,"can not generate join message, no join info");const e=Object.assign({},this.joinInfo.apResponse);let n=NE("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch(t){n=void 0}n&&n.length>128&&(n=void 0);const i=kL({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:xE,browser:navigator.userAgent,process_id:NE("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:e,extend:NE("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:NE("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:NE("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof NE("SUBSCRIBE_AUDIO_FILTER_TOPN")?NE("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof NE("ENABLE_PUBLISH_AUDIO_FILTER")?NE("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof NE("ENABLE_USER_LICENSE_CHECK")?NE("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===NE("USE_PUB_RTX")||!0===NE("USE_SUB_RTX")||void 0,disableFEC:NE("DISABLE_FEC"),enableNTPReport:!!NE("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!NE("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:"boolean"==typeof NE("ENABLE_DATASTREAM_2")?NE("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:"number"==typeof NE("RTM2_FLAG")?NE("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!NE("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:"boolean"==typeof NE("USE_XR")?NE("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(i.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(i.aes_mode=this.joinInfo.aesmode,NE("ENCRYPT_AES")?(i.aes_secret=this.joinInfo.aespassword,i.aes_encrypt=!0):i.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(i.aes_salt=this.joinInfo.aessalt)),e.addresses[this.signal.websocket.currentURLIndex]&&(i.ap_response.ticket=e.addresses[this.signal.websocket.currentURLIndex].ticket,delete e.addresses),void 0!==this.joinInfo.defaultVideoStream&&(i.default_video_stream=this.joinInfo.defaultVideoStream),i}getRejoinMessage(){if(!this.joinInfo)throw new Bw(Bv.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(vw.WS_RECONNECT_WAITTING_FINISH,(t=>{var e;kr(e=["tryNext","recover"]).call(e,t)&&this.joinInfo&&rw.adjustSessionStartTime(this.joinInfo.sid)})),this.signal.on(vw.WS_RECONNECT_CREATE_CONNECTION,(t=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(vw.WS_RECONNECTING,(t=>{this.joinInfo&&rw.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||uy.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",rw.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(vw.WS_CLOSED,(t=>{let e;switch(t){case cy.LEAVE:e=uy.LEAVE;break;case cy.UID_BANNED:case cy.IP_BANNED:case cy.CHANNEL_BANNED:case cy.SERVER_ERROR:e=uy.SERVER_ERROR;break;case cy.FALLBACK:e=uy.FALLBACK;break;case cy.LICENSE_MISSING:case cy.LICENSE_EXPIRED:case cy.LICENSE_MINUTES_EXCEEDED:case cy.LICENSE_PERIOD_INVALID:case cy.LICENSE_MULTIPLE_SDK_SERVICE:case cy.LICENSE_ILLEGAL:case cy.TOKEN_EXPIRE:e=t;break;default:e=uy.NETWORK_ERROR}zE.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(e||"undefined -> "+uy.NETWORK_ERROR)),this.joinInfo&&rw.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===cy.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e}),this._disconnectedReason=t,t!==cy.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(vw.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(zE.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),rw.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof xL?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void zE.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));kE("EVENT_REPORT_DOMAIN",t[1]),kE("EVENT_REPORT_BACKUP_DOMAIN",t[1]),kE("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}})),this.signal.on(bw.ON_UPLINK_STATS,(t=>{this._statsCollector.updateUplinkStats(t)})),this.signal.on(vw.REQUEST_RECOVER,((t,e,n)=>{if(!this.joinInfo)return n(new Bw(Bv.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,gy(this,tS.REQUEST_NEW_GATEWAY_LIST).then(e).catch(n)})),this.signal.on(vw.REQUEST_JOIN_INFO,(async t=>{var e;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void t(this.getJoinMessage({ortc:{}}));const{iceParameters:n,dtlsParameters:i,rtpCapabilities:r}=await gy(this,tS.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(e=this.joinInfo)||void 0===e?void 0:e.turnServer});t(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:i,rtpCapabilities:r,version:"2"}}))})),this.signal.on(vw.REQUEST_REJOIN_INFO,(t=>{t(this.getRejoinMessage())})),this.signal.on(vw.REPORT_JOIN_GATEWAY,((t,e)=>{this.joinInfo&&(rw.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:e,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof xL?"1":"0"}),this._isProactiveJoin=!1)})),this.signal.on(vw.IS_P2P_DISCONNECTED,(t=>{t(_y(this,tS.IS_P2P_DISCONNECTED))})),this.signal.on(vw.DISCONNECT_P2P,(()=>{this.emit(tS.DISCONNECT_P2P)})),this.signal.on(vw.NEED_RENEW_SESSION,(()=>{this.emit(tS.NEED_RENEW_SESSION)})),this.signal.on(vw.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(vw.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(vw.JOIN_RESPONSE,(t=>{const e=this.getCurrentGatewayAddress();this.emit(tS.JOIN_RESPONSE,t,e)})),this.signal.on(vw.DATACHANNEL_PRECONNECT,(async(t,e,n)=>{this.updateTurnConfigFromSignal();const i=this.getCurrentGatewayAddress();return gy(this,tS.DATACHANNEL_PRECONNECT,t,i).then(e).catch(n)})),this.signal.on(vw.DATACHANNEL_CONNECTING,(async t=>{const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await gy(this,tS.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:e,dtlsParameters:n,rtpCapabilities:i,version:"2"}}))})),this.signal.on(vw.DATACHANNEL_FAILBACK,(()=>{zE.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(tS.DATACHANNEL_FAILBACK)}))}async tryUnsubBeforeResub(t,e){try{await this.signal.request(yw.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[e]},!0)}catch(t){throw zE.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),t),t}}async tryUnsubDataChannelBeforeResub(t,e){try{await this.signal.request(yw.UNSUBSCRIBE,{stream_id:e.id},!0)}catch(t){throw zE.warning("unsubscribe datachannel warning",t),t}}async tryUnpubBeforeRepub(t,e){try{await this.signal.request(yw.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(t){throw zE.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),t),t}}async tryUnpubDataChannelBeforeRepub(t,e){try{await this.signal.request(yw.UNPUBLISH_DATASTREAM,{channnel_id:e.channelId},!0)}catch(t){throw zE.warning("unpublish datastream warning: ",t),t}}async tryMassUnsubBeforeResub(t){const e={users:t.map((t=>({stream_id:t.stream_id,stream_type:t.stream_type})))};try{await this.signal.request(yw.UNSUBSCRIBE_STREAMS,e,!0)}catch(t){throw zE.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),t),t}}async muteLocal(t,e){const n={action:t.find((t=>t.stream_type===Zw.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:e};try{await this.signal.request(yw.CONTROL,n,!0,!0)}catch(t){throw zE.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),t),t}}async unmuteLocal(t,e){const n={action:t.find((t=>t.stream_type===Zw.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:e};try{await this.signal.request(yw.CONTROL,n,!0,!0)}catch(t){throw zE.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),t),t}}async muteRemote(t,e){const n={action:t===dS.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:e};try{await this.signal.request(yw.CONTROL,n,!0,!0)}catch(t){throw zE.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),t),t}}async unmuteRemote(t,e){const n={action:t===dS.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:e};try{await this.signal.request(yw.CONTROL,n,!0,!0)}catch(t){throw zE.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),t),t}}uploadStats(t,e){this.signal.upload(t,e)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const e={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(yw.RESTART_ICE,e,!0)}catch(t){throw zE.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),t),t}}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,uy.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!NE("GATEWAY_WSS_ADDRESS"))return null!==(t=this.joinInfo)&&void 0!==t&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(yw.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(cy.FALLBACK)),this.store.useDataChannel=!1,this.signal=new XS(kL(kL({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(tS.RESET_SIGNAL,iS.websocket)}}let DL=0,BL=0;function UL(t,e,n,i){return new ev(((r,s)=>{e.timeout=e.timeout||NE("HTTP_CONNECT_TIMEOUT"),e.responseType=e.responseType||"json",e.data&&!n?(e.data=JSON.stringify(e.data),DL+=ky(e.data)):n&&(e.data.size?DL+=e.data.size:e.data instanceof FormData?DL+=Ny(e.data):DL+=ky(JSON.stringify(e.data))),e.headers=e.headers||{},e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.method="POST",e.url=t,fE.request(e).then((t=>{"string"==typeof t.data?BL+=ky(t.data):t.data instanceof ArrayBuffer||t.data instanceof Uint8Array?BL+=t.data.byteLength:BL+=ky(JSON.stringify(t.data)),i&&r({data:t.data,headers:t.headers}),r(t.data)})).catch((t=>{fE.isCancel(t)?s(new Bw(Bv.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===t.code?s(new Bw(Bv.NETWORK_TIMEOUT,t.message)):t.response?s(new Bw(Bv.NETWORK_RESPONSE_ERROR,t.response.status)):s(new Bw(Bv.NETWORK_ERROR,t.message))}))}))}
/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */!function(){var t;function e(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var n,i="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},r=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof K&&K];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function s(t,e){if(e)t:{var n=r;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in n))break t;n=n[o]}(e=e(s=n[t=t[t.length-1]]))!=s&&null!=e&&i(n,t,{configurable:!0,writable:!0,value:e})}}function o(t){return(t={next:t})[Symbol.iterator]=function(){return this},t}function a(t){var n="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return n?n.call(t):{next:e(t)}}if(s("Symbol",(function(t){function e(t,e){this.A=t,i(this,"description",{configurable:!0,writable:!0,value:e})}if(t)return t;e.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function t(i){if(this instanceof t)throw new TypeError("Symbol is not a constructor");return new e(n+(i||"")+"_"+r++,i)}})),s("Symbol.iterator",(function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var n="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),s=0;s<n.length;s++){var a=r[n[s]];"function"==typeof a&&"function"!=typeof a.prototype[t]&&i(a.prototype,t,{configurable:!0,writable:!0,value:function(){return o(e(this))}})}return t})),"function"==typeof Object.setPrototypeOf)n=Object.setPrototypeOf;else{var c;t:{var l={};try{l.__proto__={a:!0},c=l.a;break t}catch(t){}c=!1}n=c?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var u=n;function d(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function h(t){if(t.m)throw new TypeError("Generator is already running");t.m=!0}function A(t,e){return t.h=3,{value:e}}function p(t){this.g=new d,this.G=t}function f(t,e,n,i){try{var r=e.call(t.g.j,n);if(!(r instanceof Object))throw new TypeError("Iterator result "+r+" is not an object");if(!r.done)return t.g.m=!1,r;var s=r.value}catch(e){return t.g.j=null,t.g.s(e),m(t)}return t.g.j=null,i.call(t.g,s),m(t)}function m(t){for(;t.g.h;)try{var e=t.G(t.g);if(e)return t.g.m=!1,{value:e.value,done:!1}}catch(e){t.g.v=void 0,t.g.s(e)}if(t.g.m=!1,t.g.l){if(e=t.g.l,t.g.l=null,e.F)throw e.D;return{value:e.return,done:!0}}return{value:void 0,done:!0}}function g(t){this.next=function(e){return t.o(e)},this.throw=function(e){return t.s(e)},this.return=function(e){return function(t,e){h(t.g);var n=t.g.j;return n?f(t,"return"in n?n.return:function(t){return{value:t,done:!0}},e,t.g.return):(t.g.return(e),m(t))}(t,e)},this[Symbol.iterator]=function(){return this}}function v(t,e){return e=new g(new p(e)),u&&t.prototype&&u(e,t.prototype),e}if(d.prototype.o=function(t){this.v=t},d.prototype.s=function(t){this.l={D:t,F:!0},this.h=this.C||this.u},d.prototype.return=function(t){this.l={return:t},this.h=this.u},p.prototype.o=function(t){return h(this.g),this.g.j?f(this,this.g.j.next,t,this.g.o):(this.g.o(t),m(this))},p.prototype.s=function(t){return h(this.g),this.g.j?f(this,this.g.j.throw,t,this.g.o):(this.g.s(t),m(this))},s("Array.prototype.entries",(function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,i=!1,r={next:function(){if(!i&&n<t.length){var r=n++;return{value:e(r,t[r]),done:!1}}return i=!0,{done:!0,value:void 0}}};return r[Symbol.iterator]=function(){return r},r}(this,(function(t,e){return[t,e]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var y=function(t,e){for(var n=0;n<t.length;n++)e(t[n])},_=function(t){return t.replace(/\r?\n|\r/g,"\r\n")},b=function(t,e,n){return e instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof e.name?e.name:"blob",e.name===n&&"[object Blob]"!==Object.prototype.toString.call(e)||(e=new File([e],n)),[String(t),e]):[String(t),String(e)]},E=function(t,e){if(t.length<e)throw new TypeError(e+" argument required, but only "+t.length+" present.")},w="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,S=w.FormData,T=w.XMLHttpRequest&&w.XMLHttpRequest.prototype.send,C=w.Request&&w.fetch,R=w.navigator&&w.navigator.sendBeacon,I=w.Element&&w.Element.prototype,x=w.Symbol&&Symbol.toStringTag;x&&(Blob.prototype[x]||(Blob.prototype[x]="Blob"),"File"in w&&!File.prototype[x]&&(File.prototype[x]="File"));try{new File([],"")}catch(t){w.File=function(t,e,n){return t=new Blob(t,n||{}),Object.defineProperties(t,{name:{value:e},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),x&&Object.defineProperty(t,x,{value:"File"}),t}}var O=function(t){return t.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},L=function(t){this.i=[];var e=this;t&&y(t.elements,(function(t){if(t.name&&!t.disabled&&"submit"!==t.type&&"button"!==t.type&&!t.matches("form fieldset[disabled] *"))if("file"===t.type){var n=t.files&&t.files.length?t.files:[new File([],"",{type:"application/octet-stream"})];y(n,(function(n){e.append(t.name,n)}))}else"select-multiple"===t.type||"select-one"===t.type?y(t.options,(function(n){!n.disabled&&n.selected&&e.append(t.name,n.value)})):"checkbox"===t.type||"radio"===t.type?t.checked&&e.append(t.name,t.value):(n="textarea"===t.type?_(t.value):t.value,e.append(t.name,n))}))};if((t=L.prototype).append=function(t,e,n){E(arguments,2),this.i.push(b(t,e,n))},t.delete=function(t){E(arguments,1);var e=[];t=String(t),y(this.i,(function(n){n[0]!==t&&e.push(n)})),this.i=e},t.entries=function t(){var e,n=this;return v(t,(function(t){if(1==t.h&&(e=0),3!=t.h)return e<n.i.length?t=A(t,n.i[e]):(t.h=0,t=void 0),t;e++,t.h=2}))},t.forEach=function(t,e){E(arguments,1);for(var n=a(this),i=n.next();!i.done;i=n.next()){var r=a(i.value);i=r.next().value,r=r.next().value,t.call(e,r,i,this)}},t.get=function(t){E(arguments,1);var e=this.i;t=String(t);for(var n=0;n<e.length;n++)if(e[n][0]===t)return e[n][1];return null},t.getAll=function(t){E(arguments,1);var e=[];return t=String(t),y(this.i,(function(n){n[0]===t&&e.push(n[1])})),e},t.has=function(t){E(arguments,1),t=String(t);for(var e=0;e<this.i.length;e++)if(this.i[e][0]===t)return!0;return!1},t.keys=function t(){var e,n,i,r=this;return v(t,(function(t){if(1==t.h&&(e=a(r),n=e.next()),3!=t.h)return n.done?void(t.h=0):(i=n.value,A(t,a(i).next().value));n=e.next(),t.h=2}))},t.set=function(t,e,n){E(arguments,2),t=String(t);var i=[],r=b(t,e,n),s=!0;y(this.i,(function(e){e[0]===t?s&&(s=!i.push(r)):i.push(e)})),s&&i.push(r),this.i=i},t.values=function t(){var e,n,i,r,s=this;return v(t,(function(t){if(1==t.h&&(e=a(s),n=e.next()),3!=t.h)return n.done?void(t.h=0):(i=n.value,(r=a(i)).next(),A(t,r.next().value));n=e.next(),t.h=2}))},L.prototype._asNative=function(){for(var t=new S,e=a(this),n=e.next();!n.done;n=e.next()){var i=a(n.value);n=i.next().value,i=i.next().value,t.append(n,i)}return t},L.prototype._blob=function(){var t="----formdata-polyfill-"+Math.random(),e=[],n="--"+t+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(t,i){return"string"==typeof t?e.push(n+O(_(i))+'"\r\n\r\n'+_(t)+"\r\n"):e.push(n+O(_(i))+'"; filename="'+O(t.name)+'"\r\nContent-Type: '+(t.type||"application/octet-stream")+"\r\n\r\n",t,"\r\n")})),e.push("--"+t+"--"),new Blob(e,{type:"multipart/form-data; boundary="+t})},L.prototype[Symbol.iterator]=function(){return this.entries()},L.prototype.toString=function(){return"[object FormData]"},I&&!I.matches&&(I.matches=I.matchesSelector||I.mozMatchesSelector||I.msMatchesSelector||I.oMatchesSelector||I.webkitMatchesSelector||function(t){for(var e=(t=(this.document||this.ownerDocument).querySelectorAll(t)).length;0<=--e&&t.item(e)!==this;);return-1<e}),x&&(L.prototype[x]="FormData"),T){var M=w.XMLHttpRequest.prototype.setRequestHeader;w.XMLHttpRequest.prototype.setRequestHeader=function(t,e){M.call(this,t,e),"content-type"===t.toLowerCase()&&(this.B=!0)},w.XMLHttpRequest.prototype.send=function(t){t instanceof L?(t=t._blob(),this.B||this.setRequestHeader("Content-Type",t.type),T.call(this,t)):T.call(this,t)}}C&&(w.fetch=function(t,e){return e&&e.body&&e.body instanceof L&&(e.body=e.body._blob()),C.call(this,t,e)}),R&&(w.navigator.sendBeacon=function(t,e){return e instanceof L&&(e=e._asNative()),R.call(this,t,e)}),w.FormData=L}}();const FL=()=>{const t=NE("AREAS");return 0===t.length&&t.push(rS.GLOBAL),c_(t).call(t,((t,e,n)=>{const i=HL(e);return i?0===n?i:"".concat(t,",").concat(i):t}),"")},HL=t=>t===rS.OVERSEA?"".concat(aS.ASIA,",").concat(aS.EUROPE,",").concat(aS.AFRICA,",").concat(aS.NORTH_AMERICA,",").concat(aS.SOUTH_AMERICA,",").concat(aS.OCEANIA):aS[t],VL=t=>{const e={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return t.map((t=>{const n=cS[t],i=Object.keys(n);i&&i.map((t=>{"CODE"!==t&&(e[t]=e[t].concat(n[t]))}))})),e},jL={GLOBAL:{ASIA:[rS.CHINA,rS.JAPAN,rS.INDIA,rS.KOREA,rS.HKMC],EUROPE:[],NORTH_AMERICA:[rS.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},GL=Object.keys(jL[rS.GLOBAL]),QL=[rS.CHINA,rS.NORTH_AMERICA,rS.EUROPE,rS.ASIA,rS.JAPAN,rS.INDIA,rS.OCEANIA,rS.SOUTH_AMERICA,rS.AFRICA,rS.KOREA,rS.HKMC,rS.US],zL=function(t,e){let n=[];if(kr(t).call(t,rS.GLOBAL)){const s=[rS.GLOBAL,rS.OVERSEA],o=Object.keys(cS);if(e===rS.GLOBAL)throw new Bw(Bv.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(e===rS.CHINA)n=[rS.OVERSEA];else if(r=e,kr(GL).call(GL,r)){const t=(i=e,jL[rS.GLOBAL][i]||[]),r=[...s,e,...t];n=o.filter((t=>!kr(r).call(r,t)))}else if(function(t){let e=!1;return GL.forEach((n=>{var i;kr(i=jL[rS.GLOBAL][n]).call(i,t)&&(e=!0)})),e}(e)){const t=function(t){let e;return GL.forEach((n=>{var i;kr(i=jL[rS.GLOBAL][n]).call(i,t)&&(e=n)})),e}(e),i=[...s,t,e];n=o.filter((t=>!kr(i).call(i,t)))}else n=t;n=function(t){const e=[];return QL.forEach((n=>{kr(t).call(t,n)&&e.push(n)})),e.concat(t.filter((t=>!kr(QL).call(QL,t))))}(n)}else n=t;var i,r;return n};function WL(t){var e,n;if(!t&&kr(e=NE("AREAS")).call(e,rS.EXTENSIONS))return zE.debug("update area from ap : reset"),void KL(sw,!0);if(!kr(n=NE("AREAS")).call(n,rS.GLOBAL)||!t)return;let i=cS.EXTENSIONS;i&&(i={CODE:HL(rS.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(t,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(t,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(t,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(t,".agora.io"),"cds-ap-web-2-".concat(t,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(t,".agora.io"),"sua-ap-web-2-".concat(t,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(t,".agora.io"),"uap-ap-web-2-".concat(t,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(t,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(t,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(t,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(t,".agora.io")]},zE.debug("update area from ap success: ".concat(t,",config is "),i),kE("AREAS",[rS.EXTENSIONS],!0),Object.keys(i).map((t=>{kE(t,"LOG_UPLOAD_SERVER"===t||"EVENT_REPORT_DOMAIN"===t||"EVENT_REPORT_BACKUP_DOMAIN"===t||"PROXY_SERVER_TYPE3"===t?i[t][0]:i[t])})))}function KL(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=rw.reportApiInvoke(null,{name:sy.SET_AREA,options:t,tag:oy.TRACER});try{let i=[];if("string"==typeof t&&(i=[t]),Array.isArray(t)&&(t.forEach((t=>{if(!kr(oS).call(oS,t))throw new Bw(Bv.INVALID_PARAMS,"invalid area code")})),i=t),"[object Object]"===Object.prototype.toString.call(t)){const{areaCode:e,excludedArea:n}=t;if(!e)throw new Bw(Bv.INVALID_PARAMS,"area code is needed");let r=e;"string"==typeof e&&(r=[e]),i=n?zL(r,n):r}if(!e){if(PE.AREAS){const t=new Bw(Bv.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(t),void zE.warning("setArea is prohibited because of config-distribute")}if(kr(i).call(i,rS.GLOBAL)&&NE("AREAS")===rS.EXTENSIONS){const t=new Bw(Bv.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(t),void zE.warning("setArea is prohibited because of ap extensions")}}kE("AREAS",i,e);const r=VL(i);Object.keys(r).map((t=>{kE(t,"LOG_UPLOAD_SERVER"===t||"EVENT_REPORT_DOMAIN"===t||"EVENT_REPORT_BACKUP_DOMAIN"===t||"PROXY_SERVER_TYPE3"===t?r[t][0]:r[t])})),zE.debug("set area success:",i.join(","))}catch(t){throw n.onError(t),t}n.onSuccess()}function qL(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function YL(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?qL(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):qL(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}let $L=1;function XL(t,e,n,i,r){$L+=1;const s={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:$L,requestId:$L,version:xE,cname:n.cname},o={service_name:e,json_body:JSON.stringify(s)};let a,c,l=t[0];return $y((async()=>{a=Date.now();const t=await UL(l,{data:o,cancelToken:i,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-a,0!==t.code){const e=new Bw(Bv.UNEXPECTED_RESPONSE,"live streaming ap error, code"+t.code,{retry:!0,responseTime:c});throw zE.error(e.toString()),e}const n=JSON.parse(t.json_body);if(200!==n.code){const t=new Bw(Bv.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw zE.error(t.toString()),t}if(!n.servers||0===n.servers.length){const t=new Bw(Bv.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw zE.error(t.toString()),t}const r=function(t,e){return{addressList:t.servers.map((t=>"wss://".concat(t.address.replace(/\./g,"-"),".").concat(NE("WORKER_DOMAIN"),":").concat(t.wss,"?serviceName=").concat(encodeURIComponent(e)))),workerToken:t.workerToken,vid:t.vid}}(n,e);return NE("LIVE_STREAMING_ADDRESS")&&(r.addressList=NE("LIVE_STREAMING_ADDRESS")instanceof Array?NE("LIVE_STREAMING_ADDRESS"):[NE("LIVE_STREAMING_ADDRESS")]),YL(YL({},r),{},{responseTime:c})}),((i,r)=>(rw.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:e,responseDetail:JSON.stringify(i.addressList),firstSuccess:0===r,responseTime:c,serverIp:t[r%t.length]}),!1)),((i,r)=>(rw.apworkerEvent(n.sid,{success:!1,sc:i.data&&i.data.code||200,serviceName:e,responseTime:c,serverIp:t[r%t.length]}),!!(i.code!==Bv.OPERATION_ABORTED&&i.code!==Bv.UNEXPECTED_RESPONSE||i.data&&i.data.retry)&&(l=t[(r+1)%t.length],!0))),r)}let JL=1;function ZL(t,e,n,i){let{url:r,areaCode:s}=t;const o=Date.now();let a;const[c,l]=rM(e,s,[dT.CHOOSE_SERVER]);let u=by.networkState;return $y((async()=>{u&&by.networkState===dy.OFFLINE&&by.onlineWaiter&&await ev.race([by.onlineWaiter,Dy(i&&i.maxRetryTimeout||qy.maxRetryTimeout)]),u=by.networkState;const{data:t,headers:s}=await UL(r,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a="1"===s.http3?1:-1,rw.reportResourceTiming(r,e.sid),eM(t,r,e,o,[dT.CHOOSE_SERVER],a);const l=_L(t,dT.CHOOSE_SERVER);return nM(l),fL(l,r)}),(t=>(t&&rw.joinChooseServer(e.sid,{lts:o,succ:!0,csAddr:r,opid:l,serverList:t.gatewayAddrs.map((t=>t.address)),ec:null,cid:t.cid.toString(),uid:t.uid.toString(),csIp:t.csIp,unilbsServerIds:[dT.CHOOSE_SERVER].toString(),isHttp3:a}),!1)),(t=>t.code!==Bv.OPERATION_ABORTED&&(t.code===Bv.CAN_NOT_GET_GATEWAY_SERVER?t.data.retry:(rw.joinChooseServer(e.sid,{lts:o,succ:!1,csAddr:r,serverList:null,opid:l,ec:t.code,csIp:t.data&&t.data.csIp,unilbsServerIds:[dT.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:u}),isHttp3:a}),zE.warning("[".concat(e.clientId,"] Choose server network error, retry"),t),!0))),i)}function tM(t,e,n,i){let r,{url:s,areaCode:o,serviceIds:a}=t;const c=Date.now(),[l,u]=rM(e,o,a);let d;return $y((async()=>{d&&by.networkState===dy.OFFLINE&&by.onlineWaiter&&await ev.race([by.onlineWaiter,Dy(i&&i.maxRetryTimeout||qy.maxRetryTimeout)]),d=by.networkState;const{data:t,headers:o}=await UL(s,{data:l,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);r="1"===o.http3?1:-1,rw.reportResourceTiming(s,e.sid),eM(t,s,e,c,a,r);const u=_L(t,dT.CHOOSE_SERVER),h=_L(t,"proxy5"===e.cloudProxyServer?dT.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?dT.CLOUD_PROXY:dT.CLOUD_PROXY_FALLBACK);return nM(u),{gatewayInfo:fL(u,s),proxyInfo:h,url:s}}),(t=>(t.gatewayInfo&&rw.joinChooseServer(e.sid,{lts:c,succ:!0,csAddr:s,serverList:t.gatewayInfo.gatewayAddrs.map((t=>t.address)),ec:null,opid:u,cid:t.gatewayInfo.cid.toString(),uid:t.gatewayInfo.uid.toString(),csIp:t.gatewayInfo.csIp,unilbsServerIds:a.toString(),isHttp3:r}),t.proxyInfo&&rw.joinWebProxyAP(e.sid,{lts:c,sucess:1,apServerAddr:s,turnServerAddrList:t.proxyInfo.addresses.map((t=>t.ip)).join(","),errorCode:null,eventType:e.cloudProxyServer,unilbsServerIds:a.toString()}),!1)),(t=>t.code!==Bv.OPERATION_ABORTED&&(t.code===Bv.CAN_NOT_GET_GATEWAY_SERVER?t.data.retry:(rw.joinWebProxyAP(e.sid,{lts:c,sucess:0,apServerAddr:s,turnServerAddrList:null,errorCode:t.code,eventType:e.cloudProxyServer,unilbsServerIds:a.toString(),extend:JSON.stringify({networkState:d})}),zE.warning("[".concat(e.clientId,"] multi unilbs network error, retry"),t),!0))),i)}const eM=(t,e,n,i,r,s)=>{const o=[],a=o=>{4096===o.flag?rw.joinChooseServer(n.sid,{lts:i,succ:!1,csAddr:e,opid:t.opid,serverList:null,ec:o.error.message,csIp:o.error.data&&o.error.data.csIp,unilbsServerIds:r.toString(),isHttp3:s}):1048576!==o.flag&&4194304!==o.flag&&4194310!==o.flag||rw.joinWebProxyAP(n.sid,{lts:i,sucess:0,apServerAddr:e,turnServerAddrList:null,errorCode:o.error.code,eventType:n.cloudProxyServer,unilbsServerIds:r.toString()})};if(t.response_body.forEach((e=>{const n=e.buffer.code;if(23===e.uri&&0===n&&!e.buffer.edges_services)if(4194310===e.buffer.flag)zE.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),e.buffer.edges_services=[];else{const n={error:new Bw(Bv.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:t.detail[502]}),flag:e.buffer.flag};o.push(n),a(n)}if(0!==n){const i=NS(n),r={error:new Bw(Bv.CAN_NOT_GET_GATEWAY_SERVER,i.desc,{desc:i.desc,retry:i.retry,csIp:t.detail[502]}),flag:e.buffer.flag};4194310===e.buffer.flag?zE.warning(r.error.toString()):o.push(r),a(r)}})),o.length)throw zE.warning("[".concat(n.clientId,"] multi unilbs ").concat(e," failed, ").concat(o.map((t=>"flag: ".concat(t.flag,", message: ").concat(t.error.message,", retry: ").concat(t.error.data.retry))).join(" | "))),new Bw(Bv.CAN_NOT_GET_GATEWAY_SERVER,o.map((t=>"flag: ".concat(t.flag,", message: ").concat(t.error.message))).join(" | "),{retry:!!o.find((t=>t.error.data.retry)),csIp:t.detail[502],desc:[...new Set(o.map((t=>{var e;return null==t||null===(e=t.error)||void 0===e||null===(e=e.data)||void 0===e?void 0:e.desc})).filter((t=>!!t)))]})},nM=t=>{var e,n,i,r;if(t.addresses&&0===t.addresses.length&&0===t.code)throw new Bw(Bv.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:t.detail&&t.detail[502]});if(NE("AP_AREA")&&(null!==(i=t.detail)&&void 0!==i&&i[23]&&"string"==typeof(null===(r=t.detail)||void 0===r?void 0:r[23])?WL(t.detail[23].toLowerCase()):WL()),null!==(e=t.detail)&&void 0!==e&&e[19]&&"string"==typeof(null===(n=t.detail)||void 0===n?void 0:n[19])){const e=t.detail[19],n=null==e?void 0:e.split(";");for(let e=0;e<n.length;e++){var s;const i=gT(s=n[e]).call(s);t.addresses[e]&&n&&(t.addresses[e].fingerprint=i)}}if(NE("GATEWAY_ADDRESS")&&NE("GATEWAY_ADDRESS").length>0){zE.debug("assign gateway address to",NE("GATEWAY_ADDRESS"));const e=NE("GATEWAY_ADDRESS").map((e=>{var n,i;const r=null!==(n=null===(i=t.addresses.find((t=>t.ip===e.ip&&t.port===e.port)))||void 0===i?void 0:i.fingerprint)&&void 0!==n?n:"";return{ip:e.ip,port:e.port,ticket:t.addresses[0]&&t.addresses[0].ticket,fingerprint:r}}));t.addresses=e}},iM=(t,e)=>{if(t.response_body&&t.response_body.length){const e=t.response_body[0];if(0!==e.buffer.code){const t=NS(e.buffer.code);throw new Bw(Bv.UPDATE_TICKET_FAILED,"[".concat(e.buffer.code,"]: ").concat(t.desc),{retry:t.retry})}return e.buffer.ticket}throw zE.debug("update ticket request received ap response without response body:",e),new Bw(Bv.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},rM=(t,e,n)=>{const i=Math.floor(Math.random()*10**12),r={appid:t.appId,client_ts:Date.now(),opid:i,sid:t.sid,request_bodies:[{uri:22,buffer:{cname:t.cname,detail:YL({6:t.stringUid,11:e,12:NE("USE_NEW_TOKEN")?"1":void 0,22:e},NE("AP_RTM")?{26:"RTM2"}:{}),key:t.token,service_ids:n,uid:t.uid||0}}]};r.request_bodies.forEach((e=>{t.multiIP&&t.multiIP.gateway_ip&&(e.buffer.detail[5]=JSON.stringify({vocs_ip:[t.multiIP.uni_lbs_ip],vos_ip:[t.multiIP.gateway_ip]}))}));const s=new FormData;return s.append("request",JSON.stringify(r)),[s,i]},sM=(t,e)=>{const n=Math.floor(Math.random()*10**12),i={appid:t.appId,client_ts:Date.now(),opid:n,sid:t.sid,request_bodies:[{uri:28,buffer:{cname:t.cname,detail:{1:"",6:t.stringUid,12:"1"},token:t.token,service_ids:e,uid:t.uid||0,edges_services:t.apResponse.addresses.map((t=>({ip:t.ip,port:t.port})))}}]},r=new FormData;return r.append("request",JSON.stringify(i)),[r,n]};let oM=0;function aM(t){return ev.all(t.map((t=>t.then((t=>{throw t}),(t=>t))))).then((t=>{throw t}),(t=>t))}const cM=async t=>{let{fragementLength:e,referenceList:n,asyncMapHandler:i,allFailedhandler:r,promisesCollector:s}=t,o=0;const a=e;let c,l=0;const u=async()=>{const t=(()=>{const t=o*a,e=t+a;return n.slice(t,e).map(i)})();s&&s.push(...t);try{c=await aM(t)}catch(t){if(l+=a,o++,!(l>=n.length))return void await u();r(t)}t.forEach((t=>t.cancel()))};return await u(),c};async function lM(t,e,n,i){const r=async function(t,e,n,i){let r=null;const s=[],o=async()=>{const r=NE("WEBCS_DOMAIN").slice(0,NE("AJAX_REQUEST_CONCURRENT")).map((e=>({url:t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:FL()}))),o=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:r.map((t=>t.url))}),a=await cM({fragementLength:NE("FRAGEMENT_LENGTH"),referenceList:r,asyncMapHandler:i=>(zE.debug("[".concat(t.clientId,"] Connect to choose_server:"),i.url),ZL(i,t,e,n)),allFailedhandler:t=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:t},o),t[0]},promisesCollector:s});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},o),a},a=async()=>{if(await Dy(1e3),null!==r)return r;const o=NE("WEBCS_DOMAIN_BACKUP_LIST").map((e=>({url:t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2"),areaCode:FL()}))),a=i.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:o.map((t=>t.url))}),c=await cM({fragementLength:NE("FRAGEMENT_LENGTH"),referenceList:o,asyncMapHandler:i=>(zE.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),i.url),ZL(i,t,e,n)),allFailedhandler:t=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:t},a),t[0]},promisesCollector:s});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c};try{return r=await aM([o(),a()]),s.length&&s.forEach((t=>t.cancel&&"function"==typeof t.cancel&&t.cancel())),r}catch(t){throw t[0]}}(t,e,n,i);return{gatewayInfo:await r}}async function uM(t,e,n,i,r){const s=t.cloudProxyServer;if("disabled"===s){if(!i)return;if(t.useLocalAccessPoint)return await lM(t,e,n,r);if(NE("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:i,proxyInfo:s}=await AM(t,e,n,r);return t.turnServer&&"auto"!==t.turnServer.mode||(t.turnServer={mode:"manual",servers:s.map((t=>({turnServerURL:t.address,tcpport:t.tcpport||ow.tcpport,udpport:t.udpport||ow.udpport,username:t.username||ow.username,password:t.password||ow.password,forceturn:!1,security:!0})))}),{gatewayInfo:i}}return await lM(t,e,n,r)}const{proxyInfo:o,gatewayInfo:a}=await AM(t,e,n,r),c={gatewayInfo:a};return t.turnServer={mode:"manual",servers:o.map((t=>({turnServerURL:t.address,tcpport:"proxy3"===s?void 0:t.tcpport?t.tcpport:ow.tcpport,udpport:"proxy4"===s?void 0:t.udpport?t.udpport:ow.udpport,username:t.username||ow.username,password:t.password||ow.password,forceturn:"proxy4"!==s,security:"proxy5"===s})))},zE.debug("[".concat(t.clientId,"] set proxy server: ").concat(t.proxyServer,", mode: ").concat(s)),c}async function dM(t,e,n,i,r){const s=NE("ACCOUNT_REGISTER").slice(0,NE("AJAX_REQUEST_CONCURRENT"));let o=[];o=e.proxyServer?s.map((t=>"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"))):s.map((t=>"https://".concat(t,"/api/v1")));const a=null==r?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:o});try{const s=await async function(t,e,n,i,r){const s=Date.now(),o={sid:n.sid,opid:10,appid:n.appId,string_uid:e};let a=t[0];const c=await $y((()=>UL(a+"".concat(-1===a.indexOf("?")?"?":"&","action=stringuid"),{data:o,cancelToken:i,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((n,i)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw zE.error("Invalid Uint Uid ".concat(e," => ").concat(n.uid),n),rw.reqUserAccount(o.sid,{lts:s,success:!1,serverAddr:a,stringUid:o.string_uid,uid:n.uid,errorCode:Bv.INVALID_UINT_UID_FROM_STRING_UID,extend:o}),new Bw(Bv.INVALID_UINT_UID_FROM_STRING_UID);return rw.reqUserAccount(o.sid,{lts:s,success:!0,serverAddr:a,stringUid:o.string_uid,uid:n.uid,errorCode:null,extend:o}),!1}const r=NS(n.code);return r.retry&&(a=t[(i+1)%t.length]),rw.reqUserAccount(o.sid,{lts:s,success:!1,serverAddr:a,stringUid:o.string_uid,uid:n.uid,errorCode:r.desc,extend:o}),r.retry}),((e,n)=>e.code!==Bv.OPERATION_ABORTED&&(rw.reqUserAccount(o.sid,{lts:s,success:!1,serverAddr:a,stringUid:o.string_uid,uid:null,errorCode:e.code,extend:o}),a=t[(n+1)%t.length],!0)),r);if(0!==c.code){const t=NS(c.code);throw new Bw(Bv.UNEXPECTED_RESPONSE,t.desc)}return c}(o,t,e,n,i);return null==r||r.recordJoinChannelService({status:"success",endTs:Date.now()},a),s.uid}catch(t){throw null==r||r.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[t]},a),t}}async function hM(t,e,n){const i=NE("CDS_AP").slice(0,NE("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"):"https://".concat(e,"/api/v1?action=config"))).map((i=>function(t,e,n,i){const r=Av(),s={flag:64,cipher_method:0,features:{device:r.name,system:r.os,system_general:navigator.userAgent,vendor:e.appId,version:xE,cname:e.cname,sid:e.sid,session_id:e.sid,detail:"",proxyServer:e.proxyServer}};return $y((()=>UL(t,{data:s,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(t=>t.code!==Bv.OPERATION_ABORTED),i)}(i,t,e,n)));let r=null,s=null,o={};try{r=await aM(i)}catch(t){if(t.code===Bv.OPERATION_ABORTED)throw t;s=t}if(i.forEach((t=>t.cancel())),rw.reportApiInvoke(t.sid,{name:sy.REQUEST_CONFIG_DISTRIBUTE,options:{error:s,res:r}}).onSuccess(),r&&r.test_tags)try{o=function(t){if(!t.test_tags)return{};const e=t.test_tags,n=Object.keys(e),i={};return n.forEach((t=>{var n;const r=gT(n=t.slice(4)).call(n),s=JSON.parse(e[t])[1];i[r]=s})),i}(r)}catch(t){}return o}async function AM(t,e,n,i){const r=NE("PROXY_SERVER_TYPE3"),s=(t,e,n)=>{let i=n||r;return Array.isArray(i)&&(i=e%2==0?r[1]:r[0]),"https://".concat(i,"/ap/?url=").concat(t)};let o=null;const a=[],c=async()=>{const r=NE("WEBCS_DOMAIN").slice(0,NE("AJAX_REQUEST_CONCURRENT")).map(((e,n)=>{let i;return i="disabled"===t.cloudProxyServer&&t.proxyServer?s("".concat(e,"/api/v2/transpond/webrtc?v=2"),n,t.proxyServer):"disabled"===t.cloudProxyServer||"fallback"===t.cloudProxyServer?"https://".concat(e,"/api/v2/transpond/webrtc?v=2"):s("".concat(e,"/api/v2/transpond/webrtc?v=2"),n),{url:i,areaCode:FL(),serviceIds:[dT.CHOOSE_SERVER,"proxy5"===t.cloudProxyServer?dT.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?dT.CLOUD_PROXY:dT.CLOUD_PROXY_FALLBACK]}})),o=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:r.map((t=>t.url))}),c=await cM({fragementLength:NE("FRAGEMENT_LENGTH"),referenceList:r,asyncMapHandler:i=>(zE.debug("[".concat(t.clientId,"] Connect to choose_server:"),i.url),tM(i,t,e,n)),allFailedhandler:t=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:t},o),t[0]},promisesCollector:a});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},o),c},l=async()=>{if(await Dy(1e3),null!==o)return o;const r=NE("WEBCS_DOMAIN_BACKUP_LIST").map(((e,n)=>{let i;return i="disabled"===t.cloudProxyServer&&t.proxyServer?s("".concat(e,"/api/v2/transpond/webrtc?v=2"),n,t.proxyServer):"disabled"===t.cloudProxyServer||"fallback"===t.cloudProxyServer?"https://".concat(e,"/api/v2/transpond/webrtc?v=2"):s("".concat(e,"/api/v2/transpond/webrtc?v=2"),n),{url:i,areaCode:FL(),serviceIds:[dT.CHOOSE_SERVER,"proxy5"===t.cloudProxyServer?dT.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?dT.CLOUD_PROXY:dT.CLOUD_PROXY_FALLBACK]}})),c=i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:r.map((t=>t.url))}),l=await cM({fragementLength:NE("FRAGEMENT_LENGTH"),referenceList:r,asyncMapHandler:i=>(zE.debug("[".concat(t.clientId,"] Connect to backup choose_server:"),i.url),tM(i,t,e,n)),allFailedhandler:t=>{throw i.recordJoinChannelService({endTs:Date.now(),status:"error",errors:t},c),t[0]},promisesCollector:a});return i.recordJoinChannelService({endTs:Date.now(),status:"success"},c),l};let u,d,h;try{({gatewayInfo:u,proxyInfo:d,url:h}=await aM([c(),l()]))}catch(t){throw t[0]}if(a.length&&a.forEach((t=>t.cancel&&"function"==typeof t.cancel&&t.cancel())),!u||!d)throw new Bw(Bv.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(t.apUrl=h,"disabled"!==t.cloudProxyServer&&Array.isArray(r)&&h){const e=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];kr(r).call(r,e)&&(t.proxyServer=e,zE.setProxyServer(e),rw.setProxyServer(e))}return o={gatewayInfo:u,proxyInfo:await bL(d,u.uid)},o}async function pM(t,e,n,i){const r=NE("UAP_AP").slice(0,NE("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap")));return await XL(r,t,e,n,i)}async function fM(t,e,n){const i=NE("UAP_AP").slice(0,NE("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap"))).map((i=>function(t,e,n,i){const r={command:"convergeAllocateEdge",sid:e.sid,appId:e.appId,token:e.token,ts:Date.now(),version:xE,cname:e.cname,uid:e.uid.toString(),requestId:JL,seq:JL};JL+=1;const s={service_name:"tele_channel",json_body:JSON.stringify(r)};return $y((async()=>{const e=await UL(t,{data:s,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==e.code){const t=new Bw(Bv.UNEXPECTED_RESPONSE,"cross channel ap error, code"+e.code,{retry:!0});throw zE.error(t.toString()),t}const i=JSON.parse(e.json_body);if(200!==i.code){const t=new Bw(Bv.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(i.code,", reason: ").concat(i.reason));throw zE.error(t.toString()),t}if(!i.servers||0===i.servers.length){const t=new Bw(Bv.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw zE.error(t.toString()),t}return{vid:i.vid,workerToken:i.workerToken,addressList:(NE("CHANNEL_MEDIA_RELAY_SERVERS")||i.servers).map((t=>"wss://".concat(t.address.replace(/\./g,"-"),".").concat(NE("WORKER_DOMAIN"),":").concat(t.wss)))}}),void 0,(t=>!!(t.code!==Bv.OPERATION_ABORTED&&t.code!==Bv.UNEXPECTED_RESPONSE||t.data&&t.data.retry)),i)}(i,t,e,n)));try{const t=await aM(i);return i.forEach((t=>t.cancel())),t}catch(t){throw t[0]}}async function mM(t,e,n){let i=null;const r=[],s=async s=>{const o=NE(s?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v2/transpond/webrtc?v=2"):"https://".concat(e,"/api/v2/transpond/webrtc?v=2")));return s&&(await Dy(1e3),null!==i)?i:await cM({fragementLength:NE("FRAGEMENT_LENGTH"),referenceList:o,asyncMapHandler:i=>(zE.debug("[".concat(t.clientId,"] update ticket, Connect to ").concat(s?"backup":""," choose_server:"),i),function(t,e,n,i){const[r]=sM(e,[dT.CHOOSE_SERVER]);let s=by.networkState;return $y((async()=>{s&&by.networkState===dy.OFFLINE&&by.onlineWaiter&&await ev.race([by.onlineWaiter,Dy(i&&i.maxRetryTimeout||qy.maxRetryTimeout)]),s=by.networkState;const e=await UL(t,{data:r,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0);return iM(e,t)}),(()=>!1),(t=>t.code!==Bv.OPERATION_ABORTED&&(t.code===Bv.UPDATE_TICKET_FAILED?t.data.retry:(zE.warning("[".concat(e.clientId,"] update ticket network error, retry"),t),!0))),i)}(i,t,e,n)),allFailedhandler:t=>{throw t[0]},promisesCollector:r})};try{return i=await aM([s(!1),s(!0)]),r.length&&r.forEach((t=>t.cancel&&"function"==typeof t.cancel&&t.cancel())),i}catch(t){throw t[0]}}function gM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function vM(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?gM(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gM(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class yM extends ny{constructor(){super(),ih(this,"configs",void 0),ih(this,"joinInfo",void 0),ih(this,"cancelToken",void 0),ih(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),ih(this,"interval",void 0),ih(this,"mutex",new Wy("config-distribute")),ih(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,e){this.joinInfo=t,this.cancelToken=e,this.interval&&this.stopGetConfigDistribute(),NE("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),NE("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,rw.reportApiInvoke(null,{options:void 0,name:sy.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:oy.TRACER}).onSuccess(JSON.stringify(PE))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void zE.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const e=await this.mutex.lock();try{t=await hM(this.joinInfo,this.cancelToken,this.retryConfig),zE.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(t){const e=new Bw(Bv.NETWORK_RESPONSE_ERROR,t);zE.warning("[config-distribute] ".concat(e.toString()))}finally{e()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var e;(e=t)&&e.uplink&&e.id&&void 0!==e.uplink.max_bitrate&&void 0!==e.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(lS.UPDATE_BITRATE_LIMIT,t):this.emit(lS.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&vM({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var e;const n=Jh(e=Object.keys(t).filter((t=>/^webrtc_ng_global_parameter/.test(t)))).call(e);for(let e=0;e<n.length;e++)for(let i=n.length-1;i>e;i--){const e=n[i];if("number"==typeof t[e].__priority){const r=t[e].__priority,s=n[i-1];if("number"==typeof t[s].__priority){if(!(r>t[s].__priority))continue;{const t=e;n[i]=n[i-1],n[i-1]=t}}else{const t=e;n[i]=n[i-1],n[i-1]=t}}}const i={};n.forEach((e=>{const n=t[e],r=n.__expires;Object.keys(n).forEach((t=>{"__priority"===t||"__expires"===t||Object.prototype.hasOwnProperty.call(i,t)||(i[t]=vM({value:n[t]},r&&{expires:r}))}))}));try{!function(t){try{const e=Date.now();Object.keys(t).forEach((n=>{switch(n){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call(ME,n)){const{value:i,expires:r}=t[n];if(r&&r<=e)return;PE[n]=i,ME[n]=i,zE.debug("Update global parameters from config distribute",n,i)}}}))}catch(e){zE.error("Error update config immediately: ".concat(t),e.message)}}(i);const t=JSON.stringify(i),e=window.btoa(t);window.localStorage.setItem("websdk_ng_global_parameter",e),zE.debug("Caching global parameters ".concat(t))}catch(t){zE.error("Error caching global parameters:",t.message)}}}function _M(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function bM(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?_M(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):_M(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class EM extends ny{constructor(t,e,n,i){super(),ih(this,"spec",void 0),ih(this,"token",void 0),ih(this,"websocket",void 0),ih(this,"pingpongTimer",void 0),ih(this,"reconnectMode","retry"),ih(this,"serviceMode",void 0),ih(this,"reqId",0),ih(this,"commandReqId",0),ih(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),ih(this,"handleWebSocketMessage",(t=>{if(!t.data)return;const e=JSON.parse(t.data);e.requestId?this.emit("@".concat(e.requestId,"-").concat(e.sid),e):this.serviceMode===Tw.INJECT?this.emit(zw.INJECT_STREAM_STATUS,e):(rw.workerEvent(this.spec.sid,{actionType:"status",serverCode:e.code,workerType:this.serviceMode===Tw.TRANSCODE?1:2}),this.emit(zw.PUBLISH_STREAM_STATUS,e))})),this.spec=e,this.token=t,this.serviceMode=i,this.websocket=new $S("live-streaming",n),this.websocket.on(Sw.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Sw.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Sw.REQUEST_NEW_URLS,((t,e)=>{gy(this,zw.REQUEST_NEW_ADDRESS).then(t).catch(e)})),this.websocket.on(Sw.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(t){return this.websocket.init(t)}async request(t,e,n,i){this.reqId+=1,"request"===t&&(this.commandReqId+=1);const r=this.commandReqId,s=this.reqId;if(!s||!this.websocket)throw new Bw(Bv.UNEXPECTED_ERROR);const o=bM({command:t,sdkVersion:"4.19.3"===xE?"0.0.1":xE,seq:s,requestId:s,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},e);if("closed"===this.websocket.state)throw new Bw(Bv.WS_DISCONNECT);const a=()=>new ev(((t,e)=>{this.websocket.once(Sw.CLOSED,(()=>e(new Bw(Bv.WS_ABORT)))),this.websocket.once(Sw.CONNECTED,t)}));"connected"!==this.websocket.state&&await a(),o.clientRequest&&(o.clientRequest.workerToken=this.token);const c=new ev(((t,e)=>{const n=()=>{e(new Bw(Bv.WS_ABORT))};this.websocket.once(Sw.RECONNECTING,n),this.websocket.once(Sw.CLOSED,n),this.once("@".concat(s,"-").concat(this.spec.sid),(e=>{t(e)}))}));i&&rw.workerEvent(this.spec.sid,bM(bM({},i),{},{requestId:r,actionType:"request",payload:JSON.stringify(e.clientRequest),serverCode:0,code:0}));const l=Date.now();this.websocket.sendMessage(o);let u=null;try{u=await c}catch(i){if("closed"===this.websocket.state)throw i;return await a(),await this.request(t,e,n)}return i&&rw.workerEvent(this.spec.sid,bM(bM({},i),{},{requestId:r,actionType:"response",payload:JSON.stringify(u.serverResponse),serverCode:u.code,success:200===u.code,responseTime:Date.now()-l})),200!==u.code&&this.handleResponseError(u),u}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t="4.19.3"===xE?"0.0.1":xE;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case Kw.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void zE.warning("live stream response already exists stream");case Kw.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Kw.LIVE_STREAM_RESPONSE_BAD_STREAM:case Kw.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Bw(Bv.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case Kw.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===t.serverResponse.command||"UninjectStream"===t.serverResponse.command)return;throw new Bw(Bv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Kw.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Bw(Bv.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case Kw.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new Bw(Bv.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(zw.WARNING,e,t.serverResponse.url)}case Kw.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const e=new Bw(Bv.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(zw.WARNING,e,t.serverResponse.url)}case Kw.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Bw(Bv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Kw.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Bw(Bv.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case Kw.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const e=new Bw(Bv.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(zw.WARNING,e,t.serverResponse.url)}case Kw.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Bw(Bv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case Kw.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Bw(Bv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Kw.LIVE_STREAM_RESPONSE_WORKER_LOST:case Kw.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===t.serverResponse.command||"UninjectStream"===t.serverResponse.command)return;throw new Bw(Bv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Kw.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===t.serverResponse.command||"UninjectStream"===t.serverResponse.command)return;if("UpdateTranscoding"===t.serverResponse.command||"ControlStream"===t.serverResponse.command)return new Bw(Bv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new Bw(Bv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Kw.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Kw.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Kw.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Kw.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Bw(Bv.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(Fy)}),6e3)}}function wM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function SM(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wM(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wM(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class TM extends ny{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qy,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:qy;super(),ih(this,"onLiveStreamWarning",void 0),ih(this,"onLiveStreamError",void 0),ih(this,"onInjectStatusChange",void 0),ih(this,"spec",void 0),ih(this,"retryTimeout",1e4),ih(this,"connection",void 0),ih(this,"httpRetryConfig",void 0),ih(this,"wsRetryConfig",void 0),ih(this,"streamingTasks",new Map),ih(this,"isStartingStreamingTask",!1),ih(this,"taskMutex",new Wy("live-streaming")),ih(this,"cancelToken",fE.CancelToken.source()),ih(this,"transcodingConfig",void 0),ih(this,"injectConfig",SM({},Qw)),ih(this,"injectLoopTimes",0),ih(this,"uapResponse",void 0),ih(this,"lastTaskId",1),ih(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=n,this.wsRetryConfig=e}async setTranscodingConfig(t){const e=SM(SM({},Gw),t);66!==e.videoCodecProfile&&77!==e.videoCodecProfile&&100!==e.videoCodecProfile&&(zE.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(e.videoCodecProfile," -> 100")),e.videoCodecProfile=100),e.transcodingUsers||(e.transcodingUsers=e.userConfigs),e.transcodingUsers&&(e.transcodingUsers=e.transcodingUsers.map((t=>SM(SM(SM({},Hw),t),{},{zOrder:t.zOrder?t.zOrder+1:1})))),function(t){zv(t.width)||Vv(t.width,"config.width",0,1e4),zv(t.height)||Vv(t.height,"config.height",0,1e4),zv(t.videoBitrate)||Vv(t.videoBitrate,"config.videoBitrate",1,1e6),zv(t.videoFrameRate)||Vv(t.videoFrameRate,"config.videoFrameRate"),zv(t.lowLatency)||Fv(t.lowLatency,"config.lowLatency"),zv(t.audioSampleRate)||Hv(t.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),zv(t.audioBitrate)||Vv(t.audioBitrate,"config.audioBitrate",1,128),zv(t.audioChannels)||Hv(t.audioChannels,"config.audioChannels",[1,2,3,4,5]),zv(t.videoGop)||Vv(t.videoGop,"config.videoGop"),zv(t.videoCodecProfile)||Hv(t.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),zv(t.userCount)||Vv(t.userCount,"config.userCount",0,17),zv(t.backgroundColor)||Vv(t.backgroundColor,"config.backgroundColor",0,16777215),zv(t.userConfigExtraInfo)||Gv(t.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),t.transcodingUsers&&!zv(t.transcodingUsers)&&(Qv(t.transcodingUsers,"config.transcodingUsers"),t.transcodingUsers.forEach(((t,e)=>{Fw(t.uid),zv(t.x)||Vv(t.x,"transcodingUser[".concat(e,"].x"),0,1e4),zv(t.y)||Vv(t.y,"transcodingUser[".concat(e,"].y"),0,1e4),zv(t.width)||Vv(t.width,"transcodingUser[".concat(e,"].width"),0,1e4),zv(t.height)||Vv(t.height,"transcodingUser[".concat(e,"].height"),0,1e4),zv(t.zOrder)||Vv(t.zOrder-1,"transcodingUser[".concat(e,"].zOrder"),0,100),zv(t.alpha)||Vv(t.alpha,"transcodingUser[".concat(e,"].alpha"),0,1,!1)}))),zv(t.watermark)||jw(t.watermark,"watermark"),zv(t.backgroundImage)||jw(t.backgroundImage,"backgroundImage"),t.images&&!zv(t.images)&&(Qv(t.images,"config.images"),t.images.forEach(((t,e)=>{jw(t,"images[".concat(e,"]"))})))}(e);const n=[];e.images&&n.push(...e.images.map((t=>SM(SM(SM({},Vw),t),{},{zOrder:255})))),e.backgroundImage&&(n.push(SM(SM(SM({},Vw),e.backgroundImage),{},{zOrder:0})),delete e.backgroundImage),e.watermark&&(n.push(SM(SM(SM({},Vw),e.watermark),{},{zOrder:255})),delete e.watermark),e.images=n,e.transcodingUsers&&(e.userConfigs=e.transcodingUsers.map((t=>SM({},t))),e.userCount=e.transcodingUsers.length,delete e.transcodingUsers);const i=(e.userConfigs||[]).map((t=>"number"==typeof t.uid?ev.resolve(t.uid):dM(t.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await ev.all(i)).forEach(((t,n)=>{e.userConfigs&&e.userConfigs[n]&&(e.userConfigs[n].uid=t)})),this.transcodingConfig=e,this.connection)try{var r;const t=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(Nw(r=this.streamingTasks).call(r)).map((t=>t.taskId)).join("#")});zE.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(t.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(t){if(!t.data||!t.data.retry)throw t;t.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((e=>{zE.warning("[".concat(this.spec.clientId,"] live streaming receive error"),t.toString(),"try to republish",e.url),this.startLiveStreamingTask(e.url,e.mode,t).then((()=>{zE.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(e.url," success"))})).catch((t=>{zE.error("[".concat(this.spec.clientId,"] live streaming republish failed"),e.url,t.toString()),this.onLiveStreamError&&this.onLiveStreamError(e.url,t)}))}))}}setInjectStreamConfig(t,e){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=e}async startLiveStreamingTask(t,e,n){var i;if(Array.from(Nw(i=this.streamingTasks).call(i)).find((t=>t.mode===Tw.INJECT))&&e===Tw.INJECT)return new Bw(Bv.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&e===Tw.TRANSCODE)throw new Bw(Bv.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let r={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};zE.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(e));const s=await this.taskMutex.lock();if(!this.connection&&n)return void s();if(this.streamingTasks.get(t)&&!n)return s(),new Bw(Bv.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(e))}catch(t){throw s(),t}switch(e){case Tw.TRANSCODE:r.transcodingConfig=SM({},this.transcodingConfig);break;case Tw.RAW:break;case Tw.INJECT:r={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(r.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const o=this.lastTaskId++;try{const i=new ev(((e,i)=>{Dy(this.retryTimeout).then((()=>{if(n)return i(n);const e=this.statusError.get(t);return e?(this.statusError.delete(t),i(e)):void 0}))})),a=await ev.race([this.connection.request("request",{clientRequest:r},!0,{url:t,command:"PublishStream",workerType:e===Tw.TRANSCODE?1:2,requestByUser:!n,tid:o.toString()}),i]);this.isStartingStreamingTask=!1,zE.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(a.code)),this.streamingTasks.set(t,{clientRequest:r,mode:e,url:t,taskId:o}),s()}catch(i){if(s(),this.isStartingStreamingTask=!1,!i.data||!i.data.retry||n)throw i;return i.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,e,i)):await this.startLiveStreamingTask(t,e,i)}}stopLiveStreamingTask(t){return new ev(((e,n)=>{const i=this.streamingTasks.get(t);if(!i||!this.connection)return new Bw(Bv.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const r=i.mode;i.abortTask=()=>{zE.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),e()},this.connection.request("request",{clientRequest:{command:r===Tw.INJECT?"UninjectStream":"UnpublishStream",url:i.url}},!1,{url:t,command:"UnPublishStream",workerType:r===Tw.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((n=>{zE.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(t),0===this.streamingTasks.size&&r!==Tw.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),e(),r===Tw.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Cw.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)})).catch(n)}))}async controlInjectStream(t,e,n,i){const r=this.streamingTasks.get(t);if(!r||!this.connection||r.mode!==Tw.INJECT)throw new Bw(Bv.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:e,audioVolume:n,position:i}})).serverResponse}resetAllTask(){var t;const e=Array.from(Nw(t=this.streamingTasks).call(t));this.terminate();for(const t of e)this.startLiveStreamingTask(t.url,t.mode).catch((e=>{this.onLiveStreamError&&this.onLiveStreamError(t.url,e)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=fE.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new Bw(Bv.UNEXPECTED_ERROR,"live streaming connection has already connected");const e=await gy(this,Ww.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=e,this.connection=new EM(e.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(zw.WARNING,((t,e)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(e,t))),this.connection.on(zw.PUBLISH_STREAM_STATUS,(t=>this.handlePublishStreamServer(t))),this.connection.on(zw.INJECT_STREAM_STATUS,(t=>this.handleInjectStreamServerStatus(t))),this.connection.on(zw.REQUEST_NEW_ADDRESS,((e,n)=>{if(!this.connection)return n(new Bw(Bv.UNEXPECTED_ERROR,"can not get new live streaming address list"));gy(this,Ww.REQUEST_WORKER_MANAGER_LIST,t).then((t=>{this.uapResponse=t,e(t.addressList)})).catch(n)})),await this.connection.init(e.addressList),this.connection}handlePublishStreamServer(t){const e=t.serverStatus&&t.serverStatus.url||"empty_url",n=this.streamingTasks.get(e),i=t.reason;switch(t.code){case Kw.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Kw.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Kw.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Kw.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const i=new Bw(Bv.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(n)return zE.error(i.toString()),this.onLiveStreamError&&this.onLiveStreamError(e,i);if(!this.isStartingStreamingTask)return;this.statusError.set(e,i)}case Kw.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new Bw(Bv.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,i);return this.onLiveStreamWarning&&this.onLiveStreamWarning(e,t)}case Kw.LIVE_STREAM_RESPONSE_WORKER_LOST:case Kw.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var r;if(!this.connection)return;this.connection.tryNextAddress();const e=Array.from(Nw(r=this.streamingTasks).call(r));for(const n of e)n.abortTask?n.abortTask():(zE.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new Bw(Bv.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then((()=>{zE.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)})).catch((t=>{zE.error(t.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,t)})));return}}}handleInjectStreamServerStatus(t){const e=Number(t.uid),n=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Cw.INJECT_STREAM_STATUS_START_SUCCESS,e,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Cw.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,e,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Cw.INJECT_STREAM_STATUS_START_UNAUTHORIZED,e,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Cw.INJECT_STREAM_STATUS_BROKEN,e,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Cw.INJECT_STREAM_STATUS_START_TIMEOUT,e,n),void this.streamingTasks.delete(n);default:return void zE.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class CM{constructor(){ih(this,"destChannelMediaInfos",new Map),ih(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){sS(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){sS(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Uw(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function RM(t){if(!(t instanceof CM))return new Bw(Bv.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const e=t.getSrcChannelMediaInfo(),n=t.getDestChannelMediaInfo();return e?0===n.size?new Bw(Bv.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new Bw(Bv.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class IM extends ny{constructor(t,e,n){super(),ih(this,"ws",void 0),ih(this,"requestId",1),ih(this,"heartBeatTimer",void 0),ih(this,"joinInfo",void 0),ih(this,"clientId",void 0),ih(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),ih(this,"onClose",(t=>{this.emit("close"),this.dispose()})),ih(this,"onMessage",(t=>{const e=JSON.parse(t.data);if(!e||"serverResponse"!==e.command||!e.requestId)return e&&"serverStatus"===e.command&&e.serverStatus&&e.serverStatus.command?(this.emit("status",e.serverStatus),void this.emit(e.serverStatus.command,e.serverStatus)):void 0;this.emit("req_".concat(e.requestId),e)})),this.joinInfo=t,this.clientId=e,this.ws=new $S("cross-channel-".concat(this.clientId),n),this.ws.on(Sw.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(Sw.CONNECTED,this.onOpen),this.ws.on(Sw.ON_MESSAGE,this.onMessage),this.ws.on(Sw.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(t){const e=this.requestId++;return t.requestId=e,t.seq=e,this.ws.sendMessage(t),e}waitStatus(t){return new ev(((e,n)=>{const i=window.setTimeout((()=>{n(new Bw(Bv.TIMEOUT,"wait status timeout, status: ".concat(t)))}),5e3);this.once(t,(r=>{window.clearTimeout(i),r.state&&0!==r.state?n(new Bw(Bv.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):e(void 0)})),this.once("dispose",(()=>{window.clearTimeout(i),n(new Bw(Bv.WS_ABORT))}))}))}async request(t){if("closed"===this.ws.state)throw new Bw(Bv.WS_DISCONNECT);const e=()=>new ev(((t,e)=>{this.ws.once(Sw.CLOSED,(()=>e(new Bw(Bv.WS_ABORT)))),this.ws.once(Sw.CONNECTED,t)}));"connected"!==this.ws.state&&await e();const n=this.sendMessage(t),i=new ev(((t,e)=>{const i=()=>{e(new Bw(Bv.WS_ABORT))};this.ws.once(Sw.RECONNECTING,i),this.ws.once(Sw.CLOSED,i),this.once("req_".concat(n),t),Dy(3e3).then((()=>{this.removeAllListeners("req_".concat(n)),this.ws.off(Sw.RECONNECTING,i),this.ws.off(Sw.CLOSED,i),e(new Bw(Bv.TIMEOUT,"cross channel ws request timeout"))}))})),r=await i;if(!r||200!==r.code)throw new Bw(Bv.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(r)));return r}async connect(t){this.ws.removeAllListeners(Sw.REQUEST_NEW_URLS),this.ws.on(Sw.REQUEST_NEW_URLS,(e=>{e(t)})),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const e=this.requestId++;return t.requestId=e,this.ws.sendMessage(t),e}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class xM extends ny{set state(t){t!==this._state&&(t!==Xw.RELAY_STATE_FAILURE&&(this.errorCode=Jw.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,e,n,i,r){super(),ih(this,"joinInfo",void 0),ih(this,"sid",void 0),ih(this,"clientId",void 0),ih(this,"cancelToken",fE.CancelToken.source()),ih(this,"workerToken",void 0),ih(this,"requestId",0),ih(this,"signal",void 0),ih(this,"prevChannelMediaConfig",void 0),ih(this,"httpRetryConfig",void 0),ih(this,"_resolution",void 0),ih(this,"_state",Xw.RELAY_STATE_IDLE),ih(this,"errorCode",Jw.RELAY_OK),ih(this,"onStatus",(t=>{zE.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(t))),t&&t.command&&("onAudioPacketReceived"===t.command&&this.emit("event",$w.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===t.command&&this.emit("event",$w.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===t.command&&(this.errorCode=Jw.SRC_TOKEN_EXPIRED,this.state=Xw.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===t.command&&(this.errorCode=Jw.DEST_TOKEN_EXPIRED,this.state=Xw.RELAY_STATE_FAILURE))})),ih(this,"onReconnect",(async()=>{zE.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",$w.NETWORK_DISCONNECTED),this.state=Xw.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((t=>{this.state!==Xw.RELAY_STATE_IDLE&&(zE.error("auto restart channel media relay failed",t.toString()),this.errorCode=Jw.SERVER_CONNECTION_LOST,this.state=Xw.RELAY_STATE_FAILURE)}))})),this.joinInfo=t,this.clientId=e,this.sid=Uy(),this.signal=new IM(this.joinInfo,this.clientId,n),this.httpRetryConfig=i,this._resolution=r}async startChannelMediaRelay(t){if(this.state!==Xw.RELAY_STATE_IDLE)throw new Bw(Bv.INVALID_OPERATION);this.state=Xw.RELAY_STATE_CONNECTING,await this.connect(),zE.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(t){if(t.data&&t.data.serverResponse&&"SetSourceChannel"===t.data.serverResponse.command)throw new Bw(Bv.CROSS_CHANNEL_FAILED_JOIN_SRC);if(t.data&&t.data.serverResponse&&"SetDestChannelStatus"===t.serverResponse.command)throw new Bw(Bv.CROSS_CHANNEL_FAILED_JOIN_DEST);if(t.data&&t.data.serverResponse&&"StartPacketTransfer"===t.serverResponse.command)throw new Bw(Bv.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw t}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==Xw.RELAY_STATE_RUNNING)throw new Bw(Bv.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==Xw.RELAY_STATE_RUNNING)throw new Bw(Bv.INVALID_OPERATION);const e=this.genMessage(Yw.SetVideoProfile);await this.signal.request(e),zE.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),zE.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Xw.RELAY_STATE_IDLE,this.dispose()}dispose(){zE.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=fE.CancelToken.source(),this.state=Xw.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await fM(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",$w.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const e=this.genMessage(Yw.StopPacketTransfer);await this.signal.request(e),await this.signal.waitStatus("Normal Quit"),zE.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage(Yw.SetSdkProfile,t);await this.signal.request(n),zE.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const i=this.genMessage(Yw.SetSourceChannel,t);await this.signal.request(i),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",$w.PACKET_JOINED_SRC_CHANNEL),zE.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const r=this.genMessage(Yw.SetSourceUserId,t);await this.signal.request(r),zE.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const s=this.genMessage(Yw.SetDestChannel,t);await this.signal.request(s),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",$w.PACKET_JOINED_DEST_CHANNEL),zE.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const o=this.genMessage(Yw.StartPacketTransfer,t);await this.signal.request(o),this.emit("event",$w.PACKET_SENT_TO_DEST_CHANNEL),this.state=Xw.RELAY_STATE_RUNNING,zE.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const e=this.genMessage(Yw.UpdateDestChannel,t);await this.signal.request(e),this.emit("event",$w.PACKET_UPDATE_DEST_CHANNEL),zE.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Yw.StopPacketTransfer);await this.signal.request(t),zE.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,e){const n=[],i=[],r=[];this.requestId+=1;const s={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:xE,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.19.3"===s.sdkVersion&&(s.sdkVersion="0.0.1");let o=null,a=null;switch(t){case Yw.SetSdkProfile:return s.clientRequest={command:"SetSdkProfile",type:"multi_channel"},s;case Yw.SetSourceChannel:if(a=e&&e.getSrcChannelMediaInfo(),!a)throw new Bw(Bv.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceChannel",uid:"0",channelName:a.channelName,token:a.token||this.joinInfo.appId},s;case Yw.SetSourceUserId:if(a=e&&e.getSrcChannelMediaInfo(),!a)throw new Bw(Bv.UNEXPECTED_ERROR,"can not find source config");return s.clientRequest={command:"SetSourceUserId",uid:a.uid+""},s;case Yw.SetDestChannel:if(o=e&&e.getDestChannelMediaInfo(),!o)throw new Bw(Bv.UNEXPECTED_ERROR,"can not find dest config");return o.forEach((t=>{n.push(t.channelName),i.push(t.uid+""),r.push(t.token||this.joinInfo.appId)})),s.clientRequest={command:"SetDestChannel",channelName:n,uid:i,token:r},s;case Yw.StartPacketTransfer:return s.clientRequest={command:"StartPacketTransfer"},s;case Yw.Reconnect:return s.clientRequest={command:"Reconnect"},s;case Yw.StopPacketTransfer:return s.clientRequest={command:"StopPacketTransfer"},s;case Yw.UpdateDestChannel:if(o=e&&e.getDestChannelMediaInfo(),!o)throw new Bw(Bv.UNEXPECTED_ERROR,"can not find dest config");return o.forEach((t=>{n.push(t.channelName),i.push(t.uid+""),r.push(t.token||this.joinInfo.appId)})),s.clientRequest={command:"UpdateDestChannel",channelName:n,uid:i,token:r},s;case Yw.SetVideoProfile:s.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return s}}class OM{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(t,e){ih(this,"uid",void 0),ih(this,"_uintid",void 0),ih(this,"_trust_in_room_",!0),ih(this,"_trust_audio_enabled_state_",!0),ih(this,"_trust_video_enabled_state_",!0),ih(this,"_trust_audio_mute_state_",!0),ih(this,"_trust_video_mute_state_",!0),ih(this,"_audio_muted_",!1),ih(this,"_video_muted_",!1),ih(this,"_audio_enabled_",!0),ih(this,"_video_enabled_",!0),ih(this,"_audio_added_",!1),ih(this,"_video_added_",!1),ih(this,"_trust_video_stream_added_state_",!0),ih(this,"_trust_audio_stream_added_state_",!0),ih(this,"_audioTrack",void 0),ih(this,"_videoTrack",void 0),ih(this,"_dataChannels",[]),ih(this,"_audioSSRC",void 0),ih(this,"_videoSSRC",void 0),ih(this,"_audioOrtc",void 0),ih(this,"_videoOrtc",void 0),ih(this,"_cname",void 0),ih(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=e}}var LM=tv,MM=sm;Pi({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var t=MM.f(this);return{promise:t.promise,resolve:t.resolve,reject:t.reject}}});var kM=sm,NM=Hf;Pi({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=kM.f(this),n=NM(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}});var PM=q(LM),DM=Ho.f("asyncIterator"),BM=q(DM);function UM(t,e){this.v=t,this.k=e}function FM(t){var e,n;function i(e,n){try{var s=t[e](n),o=s.value,a=o instanceof UM;PM.resolve(a?o.v:o).then((function(n){if(a){var c="return"===e?"return":"next";if(!o.k||n.done)return i(c,n);n=t[c](n).value}r(s.done?"return":"normal",n)}),(function(t){i("throw",t)}))}catch(t){r("throw",t)}}function r(t,r){switch(t){case"return":e.resolve({value:r,done:!0});break;case"throw":e.reject(r);break;default:e.resolve({value:r,done:!1})}(e=e.next)?i(e.key,e.arg):n=null}this._invoke=function(t,r){return new PM((function(s,o){var a={key:t,arg:r,resolve:s,reject:o,next:null};n?n=n.next=a:(e=n=a,i(t,r))}))},"function"!=typeof t.return&&(this.return=void 0)}function HM(t){return function(){return new FM(t.apply(this,arguments))}}function VM(t){return new UM(t,0)}function jM(t){var e={},n=!1;function i(e,i){return n=!0,{done:!1,value:new UM(i=new PM((function(n){n(t[e](i))})),1)}}return e[void 0!==Dd&&Zd||"@@iterator"]=function(){return this},e.next=function(t){return n?(n=!1,t):i("next",t)},"function"==typeof t.throw&&(e.throw=function(t){if(n)throw n=!1,t;return i("throw",t)}),"function"==typeof t.return&&(e.return=function(t){return n?(n=!1,t):i("return",t)}),e}FM.prototype["function"==typeof Dd&&BM||"@@asyncIterator"]=function(){return this},FM.prototype.next=function(t){return this._invoke("next",t)},FM.prototype.throw=function(t){return this._invoke("throw",t)},FM.prototype.return=function(t){return this._invoke("return",t)};var GM=q(DM),QM={exports:{}};!function(t,e){t.exports=(()=>{var t={8:(t,e,n)=>{n.r(e),n.d(e,{Parser:()=>E,Printer:()=>R,parse:()=>L,print:()=>M});const i="\n",r="".concat("\r").concat(i),s=" ";let o;function a(t){return t>="0"&&t<="9"}function c(t){return t>="!"&&t<="~"}function l(t){return c(t)||t>="Â"&&t<="Ã¿"}function u(t){return"!"===t||t>="#"&&t<="'"||t>="*"&&t<="+"||t>="-"&&t<="."||t>="0"&&t<="9"||t>="A"&&t<="Z"||t>="^"&&t<="~"}function d(t){return t>="1"&&t<="9"}function h(t){return t>="A"&&t<="Z"||t>="a"&&t<="z"}function A(t){return"d"===t||"h"===t||"m"===t||"s"===t}function p(t){return t>""&&t<"\t"||t>"\v"&&t<"\f"||t>""&&t<"Ã¿"}function f(t){return h(t)||a(t)||"+"===t||"/"===t}function m(t){return a(t)||h(t)||"+"===t||"/"===t||"-"===t||"_"===t}function g(t){return h(t)||a(t)||"+"===t||"/"===t}function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){_(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function _(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t.VERSION="v",t.ORIGIN="o",t.SESSION_NAME="s",t.INFORMATION="i",t.URI="u",t.EMAIL="e",t.PHONE="p",t.CONNECTION="c",t.BANDWIDTH="b",t.TIME="t",t.REPEAT="r",t.ZONE_ADJUSTMENTS="z",t.KEY="k",t.ATTRIBUTE="a",t.MEDIA="m"}(o||(o={}));class b{consumeText(t,e){let n=e;for(;n<t.length;){const e=t[n];if("\0"===e||"\r"===e||e===i)break;n+=1}if(n-e==0)throw new Error("Invalid text, at ".concat(t));return n}consumeUnicastAddress(t,e,n){return this.consumeTill(t,e,s)}consumeOneOrMore(t,e,n){let i=e;for(;n(t[i]);)i++;if(i-e==0)throw new Error("Invalid rule at ".concat(e,"."));return i}consumeSpace(t,e){if(t[e]===s)return e+1;throw new Error("Invalid space at ".concat(e,"."))}consumeIP4Address(t,e){let n=e;for(let e=0;e<4;e++)if(n=this.consumeDecimalUChar(t,n),3!==e){if("."!==t[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(t,e){let n=e;for(let e=0;e<3&&a(t[n]);e++,n++);if(n-e==0)throw new Error("Invalid decimal uchar.");const i=parseInt(t.slice(e,n));if(i>=0&&i<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(t,e){let n=this.consumeHexpart(t,e);return":"===t[n]?(n+=1,n=this.consumeIP4Address(t,n),n):n}consumeHexpart(t,e){let n=e;if(":"===t[n]&&":"===t[n+1]){n+=2;try{n=this.consumeHexseq(t,n)}catch(t){}return n}if(n=this.consumeHexseq(t,n),":"===t[n]&&":"===t[n+1]){n+=2;try{n=this.consumeHexseq(t,n)}catch(t){}return n}return n}consumeHexseq(t,e){let n=e;for(;n=this.consumeHex4(t,n),":"===t[n]&&":"!==t[n+1];)n+=1;return n}consumeHex4(t,e){let n=0;for(;n<4;n++)if(!((i=t[e+n])>="0"&&i<="9"||i>="a"&&i<="f"||i>="A"&&i<="F")){if(0===n)throw new Error("Invalid hex 4");break}var i;return e+n}consumeFQDN(t,e){let n=e;for(;a(t[n])||h(t[n])||"-"===t[n]||"."===t[n];)n+=1;if(n-e<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(t,e){return this.consumeOneOrMore(t,e,l)}consumeMulticastAddress(t,e,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(t,e);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(t,e);default:try{return this.consumeFQDN(t,e)}catch(n){return this.consumeExtnAddr(t,e)}}}consumeIP6MulticastAddress(t,e){const n=this.consumeHexpart(t,e);return"/"===t[n]?this.consumeInteger(t,n+1):n}consumeIP4MulticastAddress(t,e){let n=e+3;const i=t.slice(e,n),r=parseInt(i);if(r<224||r>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let e=0;e<3;e++){if("."!==t[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(t,n)}return"/"===t[n]&&(n+=1),n=this.consumeTTL(t,n),"/"===t[n]&&(n=this.consumeInteger(t,n)),n}consumeInteger(t,e){if(!d(t[e]))throw new Error("Invalid integer.");for(e+=1;a(t[e]);)e+=1;return e}consumeTTL(t,e){if("0"===t[e])return e+1;if(!d(t[e]))throw new Error("Invalid TTL.");e+=1;for(let n=0;n<2&&a(t[e]);n++)e+=1;return e}consumeToken(t,e){return this.consumeOneOrMore(t,e,u)}consumeTime(t,e){let n=e;if("0"===t[n])return n+1;for(d(t[n])&&(n+=1);a(t[n]);)n++;if(n-e<10)throw new Error("Invalid time");return n}consumeAddress(t,e){return this.consumeTill(t,e,s)}consumeTypedTime(t,e){let n=e;return n=this.consumeOneOrMore(t,n,a),A(t[n])?n+1:n}consumeRepeatInterval(t,e){if(!d(t[e]))throw new Error("Invalid repeat interval");for(e+=1;a(t[e]);)e+=1;return A(t[e])&&(e+=1),e}consumePort(t,e){return this.consumeOneOrMore(t,e,a)}consume(t,e,n){for(let i=0;i<n.length;i++){if(e+i>=t.length)throw new Error("consume exceeding value length");if(t[e+i]!==n[i])throw new Error("consume ".concat(n," failed at ").concat(i))}return e+n.length}consumeTill(t,e,n){let i=e;for(;i<t.length&&("string"!=typeof n||t[i]!==n)&&("function"!=typeof n||!n(t[i]));)i++;return i}}class E extends b{constructor(){super(),_(this,"records",[]),_(this,"currentLine",0)}parse(t){const e=this.probeEOL(t);this.records=t.split(e).filter((t=>!!t.trim())).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),i=this.parseOrigin(),r=this.parseSessionName(),s=this.parseInformation(),o=this.parseUri(),a=this.parseEmail(),c=this.parsePhone(),l=this.parseConnection(),u=this.parseBandWidth(),d=this.parseTimeFields(),h=this.parseKey(),A=this.parseSessionAttribute(),p=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:i,sessionName:r,information:s,uri:o,emails:a,phones:c,connection:l,bandwidths:u,timeFields:d,key:h,attributes:A,mediaDescriptions:p}}getCurrentRecord(){const t=this.records[this.currentLine];if(!t)throw new Error("Record doesn't exit.");return t}probeEOL(t){for(let e=0;e<t.length;e++)if(t[e]===i)return"\r"===t[e-1]?r:i;throw new Error("Invalid newline character.")}parseLine(t,e){if(t.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=t[0];if("="!==t[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:t.slice(2),line:e,cur:0}}parseSessionAttribute(){const t=new S;for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==o.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,(t=>u(t)&&":"!==t)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,p)),t.parse(n),this.currentLine++}return t.digest()}parseMediaAttributes(t){const e=new T(t);for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==o.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,(t=>u(t)&&":"!==t)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,p)),e.parse(n),this.currentLine++}return e.digest()}parseKey(){const t=this.getCurrentRecord();if(t.type===o.KEY){if("prompt"===t.value||"clear:"===t.value||"base64:"===t.value||"uri:"===t.value)return t.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const t=this.getCurrentRecord();if(t.type===o.ZONE_ADJUSTMENTS){const e=[];for(;;)try{const n=this.extract(t,this.consumeTime);this.consumeSpaceForRecord(t);let i=!1;"-"===t.value[t.cur]&&(i=!0,t.cur+=1);const r=this.extract(t,this.consumeTypedTime);e.push({time:n,typedTime:r,back:i})}catch(t){break}if(0===e.length)throw new Error("Invalid zone adjustments");return this.currentLine++,e}return[]}parseRepeat(){const t=[];for(;;){const e=this.getCurrentRecord();if(e.type!==o.REPEAT)break;{const n=this.extract(e,this.consumeRepeatInterval),i=this.parseTypedTime(e);t.push({repeatInterval:n,typedTimes:i}),this.currentLine++}}return t}parseTypedTime(t){const e=[];for(;;)try{this.consumeSpaceForRecord(t),e.push(this.extract(t,this.consumeTypedTime))}catch(t){break}if(0===e.length)throw new Error("Invalid typed time.");return e}parseTime(){const t=this.getCurrentRecord(),e=this.extract(t,this.consumeTime);this.consumeSpaceForRecord(t);const n=this.extract(t,this.consumeTime);return this.currentLine++,{startTime:e,stopTime:n}}parseBandWidth(){const t=[];for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==o.BANDWIDTH)break;{const n=this.extractOneOrMore(e,u);if(":"!==e.value[e.cur])throw new Error("Invalid bandwidth field.");e.cur++;const i=this.extractOneOrMore(e,a);t.push({bwtype:n,bandwidth:i}),this.currentLine++}}return t}parseVersion(){const t=this.getCurrentRecord();if(t.type!==o.VERSION)throw new Error("first sdp record must be version");const e=t.value.slice(0,this.consumeOneOrMore(t.value,0,a));if(e.length!==t.value.length)throw new Error('invalid proto version, "v='.concat(t.value,'"'));return this.currentLine++,e}parseOrigin(){const t=this.getCurrentRecord();if(t.type!==o.ORIGIN)throw new Error("second line of sdp must be origin");const e=this.extractOneOrMore(t,l);this.consumeSpaceForRecord(t);const n=this.extractOneOrMore(t,a);this.consumeSpaceForRecord(t);const i=this.extractOneOrMore(t,a);this.consumeSpaceForRecord(t);const r=this.extractOneOrMore(t,u);this.consumeSpaceForRecord(t);const s=this.extractOneOrMore(t,u);this.consumeSpaceForRecord(t);const c=this.extract(t,this.consumeUnicastAddress);return this.currentLine++,{username:e,sessId:n,sessVersion:i,nettype:r,addrtype:s,unicastAddress:c}}parseSessionName(){const t=this.getCurrentRecord();if(t.type===o.SESSION_NAME){const e=this.extract(t,this.consumeText);return this.currentLine++,e}}parseInformation(){const t=this.getCurrentRecord();if(t.type!==o.INFORMATION)return;const e=this.extract(t,this.consumeText);return this.currentLine++,e}parseUri(){const t=this.getCurrentRecord();if(t.type===o.URI)return this.currentLine++,t.value}parseEmail(){const t=[];for(;;){const e=this.getCurrentRecord();if(e.type!==o.EMAIL)break;t.push(e.value),this.currentLine++}return t}parsePhone(){const t=[];for(;;){const e=this.getCurrentRecord();if(e.type!==o.PHONE)break;t.push(e.value),this.currentLine++}return t}parseConnection(){const t=this.getCurrentRecord();if(t.type===o.CONNECTION){const e=this.extractOneOrMore(t,u);this.consumeSpaceForRecord(t);const n=this.extractOneOrMore(t,u);this.consumeSpaceForRecord(t);const i=this.extract(t,this.consumeAddress);return this.currentLine++,{nettype:e,addrtype:n,address:i}}}parseMedia(){const t=this.getCurrentRecord(),e=this.extract(t,this.consumeToken);this.consumeSpaceForRecord(t);let n=this.extract(t,this.consumePort);"/"===t.value[t.cur]&&(t.cur+=1,n+=this.extract(t,this.consumeInteger)),this.consumeSpaceForRecord(t);const i=[];for(i.push(this.extract(t,this.consumeToken));"/"===t.value[t.cur];)t.cur+=1,i.push(this.extract(t,this.consumeToken));if(0===i.length)throw new Error("Invalid proto");const r=this.parseFmt(t);return this.currentLine++,{mediaType:e,port:n,protos:i,fmts:r}}parseTimeFields(){const t=[];for(;this.getCurrentRecord().type===o.TIME;){const e=this.parseTime(),n=this.parseRepeat(),i=this.parseZone();t.push({time:e,repeats:n,zones:i})}return t}parseMediaDescription(){const t=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===o.MEDIA;){const e=this.parseMedia(),n=this.parseInformation(),i=this.parseConnections(),r=this.parseBandWidth(),s=this.parseKey(),o=this.parseMediaAttributes(e);t.push({media:e,information:n,connections:i,bandwidths:r,key:s,attributes:o})}return t}parseConnections(){const t=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===o.CONNECTION;)t.push(this.parseConnection());return t}parseFmt(t){const e=[];for(;;)try{this.consumeSpaceForRecord(t),e.push(this.extract(t,this.consumeToken))}catch(t){break}if(0===e.length)throw new Error("Invalid fmts");return e}extract(t,e,...n){const i=e.call(this,t.value,t.cur,...n),r=t.value.slice(t.cur,i);return t.cur=i,r}extractOneOrMore(t,e){const n=this.consumeOneOrMore(t.value,t.cur,e),i=t.value.slice(t.cur,n);return t.cur=n,i}consumeSpaceForRecord(t){if(t.value[t.cur]!==s)throw new Error("Invalid space at ".concat(t.cur,"."));t.cur+=1}}class w extends b{constructor(...t){super(...t),_(this,"attributes",void 0),_(this,"digested",!1)}extractOneOrMore(t,e,n){const i=this.consumeOneOrMore(t.attValue,t._cur,e),r=t.attValue.slice(t._cur,i),[s,o]=n||[];if("number"==typeof s&&r.length<s)throw new Error("error in length, should be more or equal than ".concat(s," characters."));if("number"==typeof o&&r.length>o)throw new Error("error in length, should be less or equal than ".concat(o," characters."));return t._cur=i,r}consumeAttributeSpace(t){if(t.attValue[t._cur]!==s)throw new Error("Invalid space at ".concat(t._cur,"."));t._cur+=1}extract(t,e,...n){if(!t.attValue)throw new Error("Nothing to extract from attValue.");const i=e.call(this,t.attValue,t._cur,...n),r=t.attValue.slice(t._cur,i);return t._cur=i,r}atEnd(t){if(!t.attValue)throw new Error;return t._cur>=t.attValue.length}peekChar(t){if(!t.attValue)throw new Error;return t.attValue[t._cur]}peek(t,e){if(!t.attValue)throw new Error;for(let n=0;n<e.length;n++)if(e[n]!==t.attValue[t._cur+n])return!1;return!0}parseIceUfrag(t){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(t,f,[4,256])}parseIcePwd(t){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(t,f,[22,256])}parseIceOptions(t){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const e=[];for(;!this.atEnd(t);){e.push(this.extractOneOrMore(t,f));try{this.consumeAttributeSpace(t)}catch(e){if(this.atEnd(t))break;throw e}}this.attributes.iceOptions=e}parseFingerprint(t){const e=this.extract(t,this.consumeToken);this.consumeAttributeSpace(t);const n=this.extract(t,this.consumeTill);this.attributes.fingerprints.push({hashFunction:e,fingerprint:n})}parseExtmap(t){const e=this.extractOneOrMore(t,a);let n;"/"===this.peekChar(t)&&(this.extract(t,this.consume,"/"),n=this.extract(t,this.consumeToken)),this.consumeAttributeSpace(t);const i=this.extract(t,this.consumeTill,s),r=y(y({entry:parseInt(e,10)},n&&{direction:n}),{},{extensionName:i});this.peekChar(t)===s&&(this.consumeAttributeSpace(t),r.extensionAttributes=this.extract(t,this.consumeTill)),this.attributes.extmaps.push(r)}parseSetup(t){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const e=this.extract(t,this.consumeTill);if("active"!==e&&"passive"!==e&&"actpass"!==e&&"holdconn"!==e)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=e}}class S extends w{constructor(...t){super(...t),_(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(t){if(this.digested)throw new Error("already digested");try{switch(t.attField){case"group":this.parseGroup(t);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(t);break;case"ice-pwd":this.parseIcePwd(t);break;case"ice-options":this.parseIceOptions(t);break;case"fingerprint":this.parseFingerprint(t);break;case"setup":this.parseSetup(t);break;case"tls-id":this.parseTlsId(t);break;case"identity":this.parseIdentity(t);break;case"extmap":this.parseExtmap(t);break;case"msid-semantic":this.parseMsidSemantic(t);break;default:t.ignored=!0,this.attributes.unrecognized.push(t)}}catch(e){throw console.error("parsing session attribute ".concat(t.attField,' error, "a=').concat(t.attField,":").concat(t.attValue,'"')),e}if(!t.ignored&&t.attValue&&!this.atEnd(t))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(t){const e=this.extract(t,this.consumeToken),n=[];for(;!this.atEnd(t)&&this.peekChar(t)===s;)this.consumeAttributeSpace(t),n.push(this.extract(t,this.consumeToken));this.attributes.groups.push({semantic:e,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(t){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(t,m)}parseIdentity(t){const e=this.extractOneOrMore(t,g),n=[];for(;!this.atEnd(t)&&this.peekChar(t)===s;){this.consumeAttributeSpace(t);const e=this.extract(t,this.consumeToken);this.extract(t,this.consume,"=");const i=this.extractOneOrMore(t,(t=>t!==s&&p(t)));n.push({name:e,value:i})}this.attributes.identities.push({assertionValue:e,extensions:n})}parseMsidSemantic(t){this.peekChar(t)===s&&this.consumeAttributeSpace(t);const e={semantic:this.extract(t,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(t)}catch(t){break}if("*"===this.peekChar(t)){this.extract(t,this.consume,"*"),e.applyForAll=!0;break}{const n=this.extract(t,this.consumeTill,s);e.identifierList.push(n)}}this.attributes.msidSemantic=e}}class T extends w{constructor(t){super(),_(this,"attributes",void 0),-1!==t.protos.indexOf("RTP")||t.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(t){if(this.digested)throw new Error("already digested");try{switch(t.attField){case"extmap":this.parseExtmap(t);break;case"setup":this.parseSetup(t);break;case"ice-ufrag":this.parseIceUfrag(t);break;case"ice-pwd":this.parseIcePwd(t);break;case"ice-options":this.parseIceOptions(t);break;case"candidate":this.parseCandidate(t);break;case"remote-candidate":this.parseRemoteCandidate(t);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(t);break;case"rtpmap":this.parseRtpmap(t);break;case"ptime":this.parsePtime(t);break;case"maxptime":this.parseMaxPtime(t);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(t);break;case"ssrc":this.parseSSRC(t);break;case"fmtp":this.parseFmtp(t);break;case"rtcp-fb":this.parseRtcpFb(t);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(t);break;case"mid":this.parseMid(t);break;case"msid":this.parseMsid(t);break;case"imageattr":this.parseImageAttr(t);break;case"rid":this.parseRid(t);break;case"simulcast":this.parseSimulcast(t);break;case"sctp-port":this.parseSctpPort(t);break;case"max-message-size":this.parseMaxMessageSize(t);break;case"ssrc-group":this.parseSSRCGroup(t);break;default:t.ignored=!0,this.attributes.unrecognized.push(t)}}catch(e){throw console.error("parsing media attribute ".concat(t.attField,' error, "a=').concat(t.attField,":").concat(t.attValue,'"')),e}if(!t.ignored&&t.attValue&&!this.atEnd(t))throw new Error("attribute parsing error")}parseCandidate(t){const e=this.extractOneOrMore(t,f,[1,32]);this.consumeAttributeSpace(t);const n=this.extractOneOrMore(t,a,[1,5]);this.consumeAttributeSpace(t);const i=this.extract(t,this.consumeToken);this.consumeAttributeSpace(t);const r=this.extractOneOrMore(t,a,[1,10]);this.consumeAttributeSpace(t);const o=this.extract(t,this.consumeAddress);this.consumeAttributeSpace(t);const l=this.extract(t,this.consumePort);this.consumeAttributeSpace(t),this.extract(t,this.consume,"typ"),this.consumeAttributeSpace(t);const u={foundation:e,componentId:n,transport:i,priority:r,connectionAddress:o,port:l,type:this.extract(t,this.consumeToken),extension:{}};for(this.peek(t," raddr")&&(this.extract(t,this.consume," raddr"),this.consumeAttributeSpace(t),u.relAddr=this.extract(t,this.consumeAddress)),this.peek(t," rport")&&(this.extract(t,this.consume," rport"),this.consumeAttributeSpace(t),u.relPort=this.extract(t,this.consumePort));this.peekChar(t)===s;){this.consumeAttributeSpace(t);const e=this.extract(t,this.consumeToken);this.consumeAttributeSpace(t),u.extension[e]=this.extractOneOrMore(t,c)}this.attributes.candidates.push(u)}parseRemoteCandidate(t){const e=[];for(;;){const n=this.extractOneOrMore(t,a,[1,5]);this.consumeAttributeSpace(t);const i=this.extract(t,this.consumeAddress);this.consumeAttributeSpace(t);const r=this.extract(t,this.consumePort);e.push({componentId:n,connectionAddress:i,port:r});try{this.consumeAttributeSpace(t)}catch(t){break}}this.attributes.remoteCandidatesList.push(e)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(t){const e=this.extract(t,this.consumeToken);this.consumeAttributeSpace(t);const n=this.extract(t,this.consumeTill,"/");this.extract(t,this.consume,"/");const i={encodingName:n,clockRate:this.extractOneOrMore(t,a)};this.atEnd(t)||"/"!==this.peekChar(t)||(this.extract(t,this.consume,"/"),i.encodingParameters=parseInt(this.extract(t,this.consumeTill),10));const r=this.attributes.payloads.find((t=>t.payloadType===parseInt(e,10)));r?r.rtpMap=i:this.attributes.payloads.push({payloadType:parseInt(e,10),rtpMap:i,rtcpFeedbacks:[]})}parsePtime(t){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(t,this.consumeTill)}parseMaxPtime(t){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(t,this.consumeTill)}parseDirection(t){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=t.attField}parseSSRC(t){const e=this.extractOneOrMore(t,a);this.consumeAttributeSpace(t);const n=this.extract(t,this.consumeTill,":");let i;":"===this.peekChar(t)&&(this.extract(t,this.consume,":"),i=this.extract(t,this.consumeTill));const r=this.attributes.ssrcs.find((t=>t.ssrcId===parseInt(e,10)));r?r.attributes[n]=i:this.attributes.ssrcs.push({ssrcId:parseInt(e,10),attributes:{[n]:i}})}parseFmtp(t){const e=this.extract(t,this.consumeTill,s);this.consumeAttributeSpace(t);const n=this.extract(t,this.consumeTill),i={};n.split(";").forEach((t=>{let[e,n]=t.split("=");e=e.trim();const r="string"==typeof n?n.trim():null;"string"==typeof e&&e.length>0&&(i[e]=r)}));const r=this.attributes.payloads.find((t=>t.payloadType===parseInt(e,10)));r?r.fmtp={parameters:i}:this.attributes.payloads.push({payloadType:parseInt(e,10),rtcpFeedbacks:[],fmtp:{parameters:i}})}parseFmtParameters(t){const e={},n=this.extract(t,this.consumeTill,"=");t._cur++;const i=this.extract(t,this.consumeTill,";");for(e[n]=i;";"===t.attValue[t._cur];){const n=this.extract(t,this.consumeTill,"=");t._cur++;const i=this.extract(t,this.consumeTill,";");e[n]=i}return e}parseRtcpFb(t){let e="";e="*"===this.peekChar(t)?this.extract(t,this.consume,"*"):this.extract(t,this.consumeTill,s),this.consumeAttributeSpace(t);const n=this.extract(t,this.consumeTill,s);let i;if("trr-int"===n)i={type:n,interval:this.extract(t,this.consumeTill)};else{const e={type:n};this.peekChar(t)===s&&(this.consumeAttributeSpace(t),e.parameter=this.extract(t,this.consumeToken),this.peekChar(t)===s&&(e.additional=this.extract(t,this.consumeTill))),i=e}if("*"===e)this.attributes.rtcpFeedbackWildcards.push(i);else{const t=this.attributes.payloads.find((t=>t.payloadType===parseInt(e,10)));t?t.rtcpFeedbacks.push(i):this.attributes.payloads.push({payloadType:parseInt(e,10),rtcpFeedbacks:[i]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(t){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const e={port:this.extract(t,this.consumePort)};this.peekChar(t)===s&&(this.consumeAttributeSpace(t),e.netType=this.extractOneOrMore(t,u),this.consumeAttributeSpace(t),e.addressType=this.extractOneOrMore(t,u),this.consumeAttributeSpace(t),e.address=this.extract(t,this.consumeAddress)),this.attributes.rtcp=e}parseMsid(t){const e={id:this.extractOneOrMore(t,u,[1,64])};this.peekChar(t)===s&&(this.consumeAttributeSpace(t),e.appdata=this.extractOneOrMore(t,u,[1,64])),this.attributes.msids.push(e)}parseImageAttr(t){this.attributes.imageattr.push(t.attValue)}parseRid(t){const e=this.extractOneOrMore(t,(t=>h(t)||a(t)||"_"===t||"-"===t));this.consumeAttributeSpace(t);const n={id:e,direction:this.extract(t,this.consumeToken),params:[]};if(this.peekChar(t)===s){if(this.consumeAttributeSpace(t),this.peek(t,"pt=")){this.extract(t,this.consume,"pt=");const e=[];for(;;){const n=this.extract(t,this.consumeToken);e.push(n);try{this.extract(t,this.consume,",")}catch(t){break}}n.payloads=e,this.peekChar(t)===s&&this.extract(t,this.consume,s)}for(;;){const e=this.extract(t,this.consumeToken);switch(e){case"depend":{const i={type:e,rids:this.extract(t,this.consume,"=").split(",")};n.params.push(i);break}default:{const i={type:e};"="===this.peekChar(t)&&(this.extract(t,this.consume,"="),i.val=this.extract(t,this.consumeTill,";")),n.params.push(i)}}try{this.extract(t,this.consume,";")}catch(t){break}}}this.attributes.rids.push(n)}parseSimulcast(t){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=t.attValue,this.extract(t,this.consumeTill)}parseSctpPort(t){this.attributes.sctpPort=this.extractOneOrMore(t,a,[1,5])}parseMaxMessageSize(t){this.attributes.maxMessageSize=this.extractOneOrMore(t,a,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(t){this.attributes.mid=this.extract(t,this.consumeToken)}parseSSRCGroup(t){const e=this.extract(t,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(t);const e=this.extract(t,this.consumeInteger);n.push(parseInt(e,10))}catch(t){break}this.attributes.ssrcGroups.push({semantic:e,ssrcIds:n})}}function C(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class R{constructor(){C(this,"eol",r)}print(t,e){let n="";return e&&(this.eol=e),n+=this.printVersion(t.version),n+=this.printOrigin(t.origin),n+=this.printSessionName(t.sessionName),n+=this.printInformation(t.information),n+=this.printUri(t.uri),n+=this.printEmail(t.emails),n+=this.printPhone(t.phones),n+=this.printConnection(t.connection),n+=this.printBandwidth(t.bandwidths),n+=this.printTimeFields(t.timeFields),n+=this.printKey(t.key),n+=this.printSessionAttributes(t.attributes),n+=this.printMediaDescription(t.mediaDescriptions),n}printVersion(t){return"v=".concat(t).concat(this.eol)}printOrigin(t){return"o=".concat(t.username," ").concat(t.sessId," ").concat(t.sessVersion," ").concat(t.nettype," ").concat(t.addrtype," ").concat(t.unicastAddress).concat(this.eol)}printSessionName(t){return t?"s=".concat(t).concat(this.eol):""}printInformation(t){return t?"i=".concat(t).concat(this.eol):""}printUri(t){return t?"u=".concat(t).concat(this.eol):""}printEmail(t){let e="";for(const n of t)e+="e=".concat(n).concat(this.eol);return e}printPhone(t){let e="";for(const n of t)e+="e=".concat(n).concat(this.eol);return e}printConnection(t){return t?"c=".concat(t.nettype," ").concat(t.addrtype," ").concat(t.address).concat(this.eol):""}printBandwidth(t){let e="";for(const n of t)e+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return e}printTimeFields(t){let e="";for(const n of t){e+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const t of n.repeats)e+="r=".concat(t.repeatInterval," ").concat(t.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(e+="z=",e+="z=".concat(n.zoneAdjustments.map((t=>"".concat(t.time," ").concat(t.back?"-":""," ").concat(t.typedTime))).join(" ")).concat(this.eol),e+=this.eol)}return e}printKey(t){return t?"k=".concat(t).concat(this.eol):""}printAttributes(t){let e="";for(const n of t)e+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return e}printMediaDescription(t){let e="";for(const n of t)e+=this.printMedia(n.media),e+=this.printInformation(n.information),e+=this.printConnections(n.connections),e+=this.printBandwidth(n.bandwidths),e+=this.printKey(n.key),e+=this.printMediaAttributes(n);return e}printConnections(t){let e="";for(const n of t)e+=this.printConnection(n);return e}printMedia(t){return"m=".concat(t.mediaType," ").concat(t.port," ").concat(t.protos.join("/")," ").concat(t.fmts.join(" ")).concat(this.eol)}printSessionAttributes(t){return new x(this.eol).print(t)}printMediaAttributes(t){return new O(this.eol).print(t)}}class I{constructor(t){C(this,"eol",void 0),this.eol=t}printIceUfrag(t){return void 0===t?"":"a=ice-ufrag:".concat(t).concat(this.eol)}printIcePwd(t){return void 0===t?"":"a=ice-pwd:".concat(t).concat(this.eol)}printIceOptions(t){return void 0===t?"":"a=ice-options:".concat(t.join(s)).concat(this.eol)}printFingerprints(t){return t.length>0?t.map((t=>"a=fingerprint:".concat(t.hashFunction).concat(s).concat(t.fingerprint))).join(this.eol)+this.eol:""}printExtmap(t){return t.map((t=>"a=extmap:".concat(t.entry).concat(t.direction?"/".concat(t.direction):"").concat(s).concat(t.extensionName).concat(t.extensionAttributes?"".concat(s).concat(t.extensionAttributes):"").concat(this.eol))).join("")}printSetup(t){return void 0===t?"":"a=setup:".concat(t).concat(this.eol)}printUnrecognized(t){return t.map((t=>"a=".concat(t.attField).concat(t.attValue?":".concat(t.attValue):"").concat(this.eol))).join("")}}class x extends I{print(t){let e="";return e+=this.printGroups(t.groups),e+=this.printMsidSemantic(t.msidSemantic),e+=this.printIceLite(t.iceLite),e+=this.printIceUfrag(t.iceUfrag),e+=this.printIcePwd(t.icePwd),e+=this.printIceOptions(t.iceOptions),e+=this.printFingerprints(t.fingerprints),e+=this.printSetup(t.setup),e+=this.printTlsId(t.tlsId),e+=this.printIdentity(t.identities),e+=this.printExtmap(t.extmaps),e+=this.printUnrecognized(t.unrecognized),e}printGroups(t){let e="";return t.length>0&&(e+=t.map((t=>"a=group:".concat(t.semantic).concat(t.identificationTag.map((t=>"".concat(s).concat(t))).join("")).concat(this.eol))).join("")),e}printIceLite(t){return void 0===t?"":"a=ice-lite"+this.eol}printTlsId(t){return t?"a=tls-id:".concat(t).concat(this.eol):""}printIdentity(t){return 0===t.length?"":t.map((t=>"a=identity:".concat(t.assertionValue).concat(t.extensions.map((t=>"".concat(s).concat(t.name).concat(t.value?"=".concat(t.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(t){if(!t)return"";let e="a=msid-semantic:".concat(t.semantic);return t.applyForAll?e+="".concat(s,"*"):t.identifierList.length>0&&(e+=t.identifierList.map((t=>"".concat(s).concat(t)))),e+this.eol}}class O extends I{print(t){const e=t.attributes;let n="";return n+=this.printRTCP(e.rtcp),n+=this.printIceUfrag(e.iceUfrag),n+=this.printIcePwd(e.icePwd),n+=this.printIceOptions(e.iceOptions),n+=this.printCandidates(e.candidates),n+=this.printRemoteCandidatesList(e.remoteCandidatesList),n+=this.printEndOfCandidates(e.endOfCandidates),n+=this.printFingerprints(e.fingerprints),n+=this.printSetup(e.setup),n+=this.printMid(e.mid),n+=this.printExtmap(e.extmaps),n+=this.printRTPRelated(e),n+=this.printPtime(e.ptime),n+=this.printMaxPtime(e.maxPtime),n+=this.printDirection(e.direction),n+=this.printSSRCGroups(e.ssrcGroups),n+=this.printSSRC(e.ssrcs),n+=this.printRTCPMux(e.rtcpMux),n+=this.printRTCPMuxOnly(e.rtcpMuxOnly),n+=this.printRTCPRsize(e.rtcpRsize),n+=this.printMSId(e.msids),n+=this.printImageattr(e.imageattr),n+=this.printRid(e.rids),n+=this.printSimulcast(e.simulcast),n+=this.printSCTPPort(e.sctpPort),n+=this.printMaxMessageSize(e.maxMessageSize),n+=this.printUnrecognized(e.unrecognized),n}printCandidates(t){return t.map((t=>"a=candidate:".concat(t.foundation).concat(s).concat(t.componentId).concat(s).concat(t.transport).concat(s).concat(t.priority).concat(s).concat(t.connectionAddress).concat(s).concat(t.port).concat(s,"typ").concat(s).concat(t.type).concat(t.relAddr?"".concat(s,"raddr").concat(s).concat(t.relAddr):"").concat(t.relPort?"".concat(s,"rport").concat(s).concat(t.relPort):"").concat(Object.keys(t.extension).map((e=>"".concat(s).concat(e).concat(s).concat(t.extension[e]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(t){return t.map((t=>"a=remote-candidates:".concat(t.join(s)).concat(this.eol))).join("")}printEndOfCandidates(t){return void 0===t?"":"a=end-of-candidates"+this.eol}printRTPRelated(t){if(!t.payloads)return"";const e=t.payloads;let n="";n+=t.rtcpFeedbackWildcards.map((t=>this.printRTCPFeedback("*",t))).join("");for(const t of e)n+=this.printRtpMap(t.payloadType,t.rtpMap),n+=this.printFmtp(t.payloadType,t.fmtp),n+=t.rtcpFeedbacks.map((e=>this.printRTCPFeedback(t.payloadType,e))).join("");return n}printFmtp(t,e){if(!e)return"";const n=Object.keys(e.parameters);return 1===n.length&&null===e.parameters[n[0]]?"a=fmtp:".concat(t).concat(s).concat(n[0]).concat(this.eol):"a=fmtp:".concat(t).concat(s).concat(Object.keys(e.parameters).map((t=>"".concat(t,"=").concat(e.parameters[t]))).join(";")).concat(this.eol)}printRtpMap(t,e){return e?"a=rtpmap:".concat(t).concat(s).concat(e.encodingName,"/").concat(e.clockRate).concat(e.encodingParameters?"/".concat(e.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(t,e){let n="a=rtcp-fb:".concat(t).concat(s),i=e;return"trr-int"===i.type?n+="ttr-int".concat(s).concat(i.interval):(n+="".concat(i.type),i.parameter&&(n+="".concat(s).concat(i.parameter),i.additional&&(n+="".concat(s).concat(i.additional)))),n+this.eol}printPtime(t){return void 0===t?"":"a=ptime:".concat(t).concat(this.eol)}printMaxPtime(t){return void 0===t?"":"a=maxptime:".concat(t).concat(this.eol)}printDirection(t){return void 0===t?"":"a=".concat(t).concat(this.eol)}printSSRC(t){return t.map((t=>Object.keys(t.attributes).map((e=>"a=ssrc:".concat(t.ssrcId.toString(10)).concat(s).concat(e).concat(t.attributes[e]?":".concat(t.attributes[e]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(t){return void 0===t?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(t){return void 0===t?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(t){return void 0===t?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(t){if(void 0===t)return"";let e="a=rtcp:".concat(t.port);return t.netType&&(e+="".concat(s).concat(t.netType)),t.addressType&&(e+="".concat(s).concat(t.addressType)),t.address&&(e+="".concat(s).concat(t.address)),e+this.eol}printMSId(t){return t.map((t=>"a=msid:".concat(t.id).concat(t.appdata?"".concat(s).concat(t.appdata):"").concat(this.eol))).join("")}printImageattr(t){return t.map((t=>"a=imageattr:".concat(t).concat(this.eol))).join("")}printRid(t){return t.map((t=>{let e="a=rid:".concat(t.id).concat(s).concat(t.direction);return t.payloads&&(e+="".concat(s,"pt=").concat(t.payloads.join(","))),t.params.length>0&&(e+="".concat(s).concat(t.params.map((t=>"depend"===t.type?"depend=".concat(t.rids.join(",")):"".concat(t.type,"=").concat(t.val))).join(";"))),e+this.eol})).join("")}printSimulcast(t){return void 0===t?"":"a=simulcast:".concat(t).concat(this.eol)}printSCTPPort(t){return void 0===t?"":"a=sctp-port:".concat(t).concat(this.eol)}printMaxMessageSize(t){return void 0===t?"":"a=max-message-size:".concat(t).concat(this.eol)}printMid(t){return void 0===t?"":"a=mid:".concat(t).concat(this.eol)}printSSRCGroups(t){return t.map((t=>"a=ssrc-group:".concat(t.semantic).concat(t.ssrcIds.map((t=>"".concat(s).concat(t.toString(10)))).join("")).concat(this.eol))).join("")}}function L(t){return(new E).parse(t)}function M(t,e){return(new R).print(t,e)}}},e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={exports:{}};return t[i](r,r.exports,n),r.exports}return n.d=(t,e)=>{for(var i in e)n.o(e,i)&&!n.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n(8)})()}(QM);var zM=QM.exports;function WM(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function KM(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?WM(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):WM(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function qM(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;const{filterRTX:r,filterVideoFec:s,filterAudioFec:o,filterAudioCodec:a,filterVideoCodec:c}=e,{useXR:l}=n;let u=[],d=[],h=[],A=[],p=!1,f=!1;if(zM.parse(t).mediaDescriptions.forEach((t=>{i&&i!==t.attributes.direction||("video"!==t.media.mediaType||p||(d=t.attributes.payloads,A=t.attributes.extmaps,p=!0),"audio"!==t.media.mediaType||f||(u=t.attributes.payloads,h=t.attributes.extmaps,f=!0))})),!A||0===d.length)throw new Error("Cannot get video capabilities from SDP.");if(!h||0===u.length)throw new Error("Cannot get audio capabilities from SDP.");d.forEach((t=>{var e;null!==(e=t.rtpMap)&&void 0!==e&&e.clockRate&&(t.rtpMap.clockRate=parseInt(t.rtpMap.clockRate)),l&&t.rtcpFeedbacks.push({type:"rrtr"})})),u.forEach((t=>{var e;null!==(e=t.rtpMap)&&void 0!==e&&e.clockRate&&(t.rtpMap.clockRate=parseInt(t.rtpMap.clockRate)),l&&t.rtcpFeedbacks.push({type:"rrtr"})})),r&&(u=u.filter((t=>{var e;return"rtx"!==(null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName.toLowerCase())})),d=d.filter((t=>{var e;return"rtx"!==(null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName.toLowerCase())}))),s&&(d=d.filter((t=>{var e;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName)||"")}))),o&&(u=u.filter((t=>{var e;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName)||"")}))),a&&(null==a?void 0:a.length)>0&&(u=u.filter((t=>{var e;return kr(a).call(a,(null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName.toLowerCase())||"")}))),c&&(null==c?void 0:c.length)>0&&(d=d.filter((t=>{var e;return kr(c).call(c,(null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName.toLowerCase())||"")})));const m=NE("UNSUPPORTED_VIDEO_CODEC");return m&&m.length>0&&(d=d.filter((t=>!(t.rtpMap&&kr(m).call(m,t.rtpMap.encodingName.toLowerCase()))))),{audioCodecs:u,videoCodecs:d,audioExtensions:h,videoExtensions:A}}function YM(t){const e=zM.parse(t);let n,i;for(const t of e.mediaDescriptions){if(!n){const e=t.attributes.iceUfrag,i=t.attributes.icePwd;if(!e||!i)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:e,icePwd:i}}if(!i){const e=t.attributes.fingerprints;e.length>0&&(i={fingerprints:e})}}if(!i&&e.attributes.fingerprints.length>0&&(i={fingerprints:e.attributes.fingerprints}),!i||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:i}}function $M(t,e){const n=[],i=t.attributes.ssrcGroups.filter((t=>"FID"===t.semantic)),r=t.attributes.ssrcGroups.find((t=>"SIM"===t.semantic)),s=t.attributes.ssrcs;if(r)r.ssrcIds.forEach((t=>{var r;const s=null===(r=i.find((e=>e.ssrcIds[0]===t)))||void 0===r?void 0:r.ssrcIds[1];n.push({ssrcId:t,rtx:e?s:void 0})}));else if(i.length>0){const t=i[0].ssrcIds[0],r=i[0].ssrcIds[1];n.push({ssrcId:t,rtx:e?r:void 0})}else{if(0===s.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:s[0].ssrcId})}return n}function XM(t,e){const{cname:n}=t;let i;e&&e.ip&&"number"==typeof e.port?(i=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],zE.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(i.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),zE.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))):i=t.iceParameters.candidates.map((t=>({foundation:t.foundation,componentId:"1",transport:t.protocol,priority:t.priority.toString(),connectionAddress:t.ip,port:t.port.toString(),type:t.type,extension:{}})));const r={fingerprints:t.dtlsParameters.fingerprints.map((t=>({hashFunction:t.algorithm,fingerprint:t.fingerprint})))},s={iceUfrag:t.iceParameters.iceUfrag,icePwd:t.iceParameters.icePwd};let o;switch(t.dtlsParameters.role){case"server":o="passive";break;case"client":o="active";break;case"auto":o="actpass"}return{dtlsParameters:r,iceParameters:s,candidates:i,rtpCapabilities:ak(t.rtpCapabilities),setup:o,cname:n}}function JM(t,e,n){const i=[],r=[];return t.forEach((t=>{let{ssrcId:s,rtx:o}=t;const a=By(8,"track-"),c={ssrcId:s,attributes:KM({label:a,mslabel:n=n||By(10,""),msid:"".concat(n," ").concat(a)},e&&{cname:e})};if(i.push(c),void 0!==o){const t={ssrcId:o,attributes:KM({label:a,mslabel:n,msid:"".concat(n," ").concat(a)},e&&{cname:e})};i.push(t),r.push({semantic:"FID",ssrcIds:[s,o]})}})),t.length>1&&r.push({semantic:"SIM",ssrcIds:t.map((t=>{let{ssrcId:e}=t;return e}))}),{ssrcs:i,ssrcGroups:r}}function ZM(t,e){e instanceof JC&&t.attributes.payloads.forEach((t=>{var n;const i=null===(n=t.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!i||-1===["opus","pcmu","pcma","g722"].indexOf(i))return;t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.minptime="10",t.fmtp.parameters.useinbandfec="1";const r=e._encoderConfig;r&&"pcmu"!==i&&"pcma"!==i&&"g722"!==i&&(r.bitrate&&!bv()&&(t.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*r.bitrate))),r.sampleRate&&(t.fmtp.parameters.maxplaybackrate="".concat(r.sampleRate),t.fmtp.parameters["sprop-maxcapturerate"]="".concat(r.sampleRate)),r.stereo&&(t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"))}))}function tk(t){const e=t.attributes.unrecognized.findIndex((t=>"x-google-flag"===t.attField&&"conference"===t.attValue));-1!==e&&t.attributes.unrecognized.splice(e,1)}function ek(t,e){var n;if(!(e instanceof _R&&e._encoderConfig&&-1===e._hints.indexOf(NT.SCREEN_TRACK)))return;const i=e._encoderConfig;pC().supportMinBitrate&&i.bitrateMin&&t.attributes.payloads.forEach((t=>{var e,n;kr(e=["h264","h265","vp8","vp9","av1"]).call(e,(null===(n=t.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters["x-google-min-bitrate"]="".concat(i.bitrateMin))})),pC().supportMinBitrate&&!kr(n=e._hints).call(n,NT.LOW_STREAM)&&i.bitrateMax&&t.attributes.payloads.forEach((t=>{var e,n;kr(e=["h264","h265","vp8","vp9","av1"]).call(e,(null===(n=t.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase())||"")&&(t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters["x-google-start-bitrate"]="".concat(NE("X_GOOGLE_START_BITRATE")||Math.floor(i.bitrateMax)))}))}function nk(t){if("video"!==t.media.mediaType)return;const e=Av();if(e.name!==cv.SAFARI&&e.os!==av.IOS)return;const n=t.attributes.extmaps.findIndex((t=>/video-orientation/g.test(t.extensionName)));-1!==n&&t.attributes.extmaps.splice(n,1)}function ik(t,e,n){if(!e)return;let i,r;if("video"===t.media.mediaType?(i=n.videoExtensions,r=n.videoCodecs):(i=n.audioExtensions,r=n.audioCodecs),!0===e.twcc){const e=i.find((t=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===t.extensionName));if(e){t.attributes.extmaps.find((t=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===t.extensionName))||t.attributes.extmaps.push({entry:e.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"});const n=function(t,e){return e.filter((e=>!!t.find((t=>t.payloadType===e.payloadType&&!!t.rtcpFeedbacks.find((t=>"transport-cc"===t.type))))))}(r,t.attributes.payloads);n.forEach((t=>{t.rtcpFeedbacks.find((t=>"transport-cc"===t.type))||t.rtcpFeedbacks.push({type:"transport-cc"})}))}}else if(!1===e.twcc){const e=t.attributes.extmaps.findIndex((t=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===t.extensionName));-1!==e&&t.attributes.extmaps.splice(e,1),t.attributes.payloads.forEach((t=>{const e=t.rtcpFeedbacks.findIndex((t=>"transport-cc"===t.type));-1!==e&&t.rtcpFeedbacks.splice(e,1)}))}if(!0===e.remb){const e=i.find((t=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===t.extensionName));if(e){t.attributes.extmaps.find((t=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===t.extensionName))||t.attributes.extmaps.push({entry:e.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"});const n=function(t,e){return e.filter((e=>!!t.find((t=>t.payloadType===e.payloadType&&!!t.rtcpFeedbacks.find((t=>"goog-remb"===t.type))))))}(r,t.attributes.payloads);n.forEach((t=>{t.rtcpFeedbacks.find((t=>"goog-remb"===t.type))||t.rtcpFeedbacks.push({type:"goog-remb"})}))}}else if(!1===e.remb){const e=t.attributes.extmaps.findIndex((t=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===t.extensionName));-1!==e&&t.attributes.extmaps.splice(e,1),t.attributes.payloads.forEach((t=>{const e=t.rtcpFeedbacks.findIndex((t=>"goog-remb"===t.type));-1!==e&&t.rtcpFeedbacks.splice(e,1)}))}}function rk(t,e,n){if(bv())return;if("video"!==t.media.mediaType)return;if(!(e instanceof _R))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!NE("SIMULCAST"))return;if(void 0===e._scalabilityMode||e._scalabilityMode.numSpatialLayers<=1)return;const i="vp8"===n?2:e._scalabilityMode.numSpatialLayers,r=t.attributes.ssrcs[0],s=t.attributes.ssrcGroups.find((t=>"FID"===t.semantic&&t.ssrcIds[0]===r.ssrcId)),o={semantic:"SIM",ssrcIds:[r.ssrcId]};for(let e=1;e<i;e++)t.attributes.ssrcs.push({ssrcId:r.ssrcId+e,attributes:Ry(r.attributes)}),o.ssrcIds.push(r.ssrcId+e),s&&(t.attributes.ssrcs.push({ssrcId:s.ssrcIds[1]+e,attributes:Ry(r.attributes)}),t.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[r.ssrcId+e,s.ssrcIds[1]+e]}));t.attributes.ssrcGroups.unshift(o)}async function sk(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{filterRTX:n,filterVideoFec:i,filterAudioFec:r,filterAudioCodec:s,filterVideoCodec:o}=t,{useXR:a}=e,c=new RTCPeerConnection;c.addTransceiver("video",{direction:"sendonly"}),c.addTransceiver("audio",{direction:"sendonly"}),c.addTransceiver("video",{direction:"recvonly"}),c.addTransceiver("audio",{direction:"recvonly"});const l=(await c.createOffer()).sdp,u=qM(l,{filterRTX:n,filterVideoFec:i,filterAudioFec:r,filterAudioCodec:s,filterVideoCodec:o},{useXR:a},"sendonly"),d=qM(l,{filterRTX:n,filterVideoFec:i,filterAudioFec:r,filterAudioCodec:s,filterVideoCodec:o},{useXR:a},"recvonly"),h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},p={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(ok(u,d,"videoExtensions",h,A,p),ok(u,d,"videoCodecs",h,A,p),ok(u,d,"audioExtensions",h,A,p),ok(u,d,"audioCodecs",h,A,p),NE("RAISE_H264_BASELINE_PRIORITY")){const t=p.videoCodecs.findIndex((t=>{var e,n;return"h264"===(null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName.toLocaleLowerCase())&&"42001f"===(null===(n=t.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])}));if(-1!==t){const e=p.videoCodecs.findIndex((t=>{var e;return"h264"===(null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName.toLocaleLowerCase())}));if(e<t){zE.debug("raising H264 baseline profile priority");const n=p.videoCodecs[t];p.videoCodecs.splice(t,1),p.videoCodecs.splice(e,0,n)}-1!==e&&(A.videoCodecs=A.videoCodecs.filter((t=>{var e,n;return!("h264"===(null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=t.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))}))),-1!==e&&NE("FILTER_SEND_H264_BASELINE")&&(h.videoCodecs=h.videoCodecs.filter((t=>{var e,n;return!("h264"===(null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=t.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))})))}}try{c.close()}catch(t){}return{send:h,recv:A,sendrecv:p}}function ok(t,e,n,i,r,s){if("videoExtensions"===n||"audioExtensions"===n){const o=[];return t[n].forEach((t=>{e[n].some(((e,n)=>{if(t.entry===e.entry&&t.extensionName===e.extensionName)return o.push(n),!0}))?s[n].push(t):i[n].push(t)})),void e[n].forEach(((t,e)=>{-1===o.indexOf(e)&&r[n].push(t)}))}if("videoCodecs"===n||"audioCodecs"===n){const o=[];return t[n].forEach((t=>{e[n].some(((e,n)=>{if(t.payloadType===e.payloadType&&JSON.stringify(t)===JSON.stringify(e))return o.push(n),!0}))?s[n].push(t):i[n].push(t)})),void e[n].forEach(((t,e)=>{-1===o.indexOf(e)&&r[n].push(t)}))}}function ak(t){const{send:e,recv:n,sendrecv:i}=t;if(!i){if(!e||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:e,recv:n}}let r,s;return e?(r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},r.audioCodecs=[...e.audioCodecs,...i.audioCodecs],r.videoCodecs=[...e.videoCodecs,...i.videoCodecs],r.audioExtensions=[...e.audioExtensions,...i.audioExtensions],r.videoExtensions=[...e.videoExtensions,...i.videoExtensions]):r=i,n?(s={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},s.audioCodecs=[...n.audioCodecs,...i.audioCodecs],s.videoCodecs=[...n.videoCodecs,...i.videoCodecs],s.audioExtensions=[...n.audioExtensions,...i.audioExtensions],s.videoExtensions=[...n.videoExtensions,...i.videoExtensions]):s=i,{send:r,recv:s}}function ck(t){"audio"===t.media.mediaType&&t.attributes.payloads.filter((t=>{var e;return"opus"===(null===(e=t.rtpMap)||void 0===e?void 0:e.encodingName.toLowerCase())})).forEach((t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"}))}function lk(t){t.mediaDescriptions.forEach((t=>{"video"!==t.media.mediaType&&"audio"!==t.media.mediaType||t.attributes.payloads.forEach((t=>{-1===t.rtcpFeedbacks.findIndex((t=>"rrtr"===t.type))&&t.rtcpFeedbacks.push({type:"rrtr"})}))}))}function uk(t,e,n,i){let r=[];if(t===dS.VIDEO){if(NE("H264_PROFILE_LEVEL_ID")&&"h264"===i&&(r=e.videoCodecs.filter((t=>{var e;return kr(e=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").call(e,i)&&t&&t.fmtp&&t.fmtp.parameters["profile-level-id"]===NE("H264_PROFILE_LEVEL_ID")}))),!Array.isArray(r)||0===r.length){const t=n.videoCodecs.filter((t=>{var e;return kr(e=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").call(e,i)}));0!==t.length&&(r=e.videoCodecs.filter((e=>t.some((t=>t.payloadType===e.payloadType)))))}if(NE("USE_PUB_RTX")){const t=r.map((t=>t.payloadType.toString())),n=e.videoCodecs.filter((e=>e.rtpMap&&"rtx"===e.rtpMap.encodingName&&kr(t).call(t,e.fmtp&&e.fmtp.parameters.apt||"")));r=[...r,...n]}0===r.length&&(zE.warning("codec ".concat(i," not included in rtpCapabilities, fallback to default payloads: ").concat(e.videoCodecs[0].rtpMap&&e.videoCodecs[0].rtpMap.encodingName)),r=e.videoCodecs)}else r=e.audioCodecs.filter((t=>{var e;return kr(e=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").call(e,i)})),0===r.length&&(zE.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),r=e.audioCodecs.filter((t=>{var e;return kr(e=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").call(e,"opus")})));return r}function dk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function hk(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?dk(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):dk(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Ak(t){if(Array.isArray(t))return t.map((t=>t));if(!pk(t))return t;const e={};for(const n in t){const i=t[n];pk(i)||Array.isArray(i)?e[n]=Ak(i):e[n]=i}return e}function pk(t){return!("object"!=typeof t||Array.isArray(t)||!t)}class fk{constructor(t){ih(this,"input",[]),ih(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const mk={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},gk={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:mk,remoteCandidate:mk}},vk={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},yk={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},_k={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},bk={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function Ek(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function wk(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ek(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ek(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class Sk{constructor(t,e){ih(this,"onFirstVideoReceived",void 0),ih(this,"onFirstVideoDecoded",void 0),ih(this,"onFirstAudioReceived",void 0),ih(this,"onFirstVideoDecodedTimeout",void 0),ih(this,"onFirstAudioDecoded",void 0),ih(this,"onSelectedLocalCandidateChanged",void 0),ih(this,"onSelectedRemoteCandidateChanged",void 0),ih(this,"videoIsReady",!1),ih(this,"videoIsReady2",{}),ih(this,"pc",void 0),ih(this,"options",void 0),ih(this,"intervalTimer",void 0),ih(this,"stats",Ak(gk)),ih(this,"isFirstVideoReceived",{}),ih(this,"isFirstVideoDecoded",{}),ih(this,"isFirstAudioReceived",{}),ih(this,"isFirstAudioDecoded",{}),ih(this,"isFirstVideoDecodedTimeout",{}),ih(this,"lossRateWindowStats",[]),this.pc=t,this.options=e,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new ev((t=>{t({local:wk({},mk),remote:wk({},mk)})}))}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,e){this.videoIsReady2[t]=e}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const e=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let i=0,r=0,s=0,o=0;for(const a of n)t[a].forEach(((t,n)=>{if(!this.lossRateWindowStats[e-1][a][n]||!this.lossRateWindowStats[0][a][n])return;const c=this.lossRateWindowStats[e-1][a][n].packets-this.lossRateWindowStats[0][a][n].packets,l=this.lossRateWindowStats[e-1][a][n].packetsLost-this.lossRateWindowStats[0][a][n].packetsLost;"videoSend"===a||"audioSend"===a?(i+=c,s+=l):(r+=c,o+=l),Number.isNaN(c)||Number.isNaN(c)?t.packetLostRate=0:t.packetLostRate=c<=0||l<=0?0:l/(c+l)}));t.sendPacketLossRate=i<=0||s<=0?0:s/(i+s),t.recvPacketLossRate=r<=0||o<=0?0:o/(r+o)}}function Tk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Ck(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Tk(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Tk(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class Rk extends Sk{constructor(){super(...arguments),ih(this,"_stats",gk),ih(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),e=this.statsResponsesToObjects(t);this._stats=Ak(gk);const n=e.filter((t=>"ssrc"===t.type));this.processSSRCStats(n);const i=e.find((t=>"VideoBwe"===t.type));i&&this.processBandwidthStats(i),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach((t=>{var e;const n=kr(e=t.id).call(e,"send");switch("".concat(t.mediaType,"_").concat(n?"send":"recv")){case"video_send":{const e=Ak(yk);e.codec=t.googCodecName,e.adaptionChangeReason="none",t.googCpuLimitedResolution&&(e.adaptionChangeReason="cpu"),t.googBandwidthLimitedResolution&&(e.adaptionChangeReason="bandwidth"),e.avgEncodeMs=Number(t.googAvgEncodeMs),e.inputFrame={width:Number(t.googFrameWidthInput)||Number(t.googFrameWidthSent),height:Number(t.googFrameHeightInput)||Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},e.sentFrame={width:Number(t.googFrameWidthSent),height:Number(t.googFrameHeightSent),frameRate:Number(t.googFrameRateInput)},e.firsCount=Number(t.googFirReceived),e.nacksCount=Number(t.googNacksReceived),e.plisCount=Number(t.googPlisReceived),e.frameCount=Number(t.framesEncoded),e.bytes=Number(t.bytesSent),e.packets=Number(t.packetsSent),e.packetsLost=Number(t.packetsLost),e.ssrc=Number(t.ssrc),e.rttMs=Number(t.googRtt||0),this._stats.videoSend.push(e),this._stats.rtt=e.rttMs;break}case"video_recv":{const e=Ak(vk),n=this.lastDecodeVideoReceiverStats.get(Number(t.ssrc));if(e.codec=t.googCodecName,e.targetDelayMs=Number(t.googTargetDelayMs),e.renderDelayMs=Number(t.googRenderDelayMs),e.currentDelayMs=Number(t.googCurrentDelayMs),e.minPlayoutDelayMs=Number(t.googMinPlayoutDelayMs),e.decodeMs=Number(t.googDecodeMs),e.maxDecodeMs=Number(t.googMaxDecodeMs),e.receivedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateReceived)},e.decodedFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateDecoded)},e.decodeFrameRate=Number(t.googFrameRateDecoded),e.outputFrame={width:Number(t.googFrameWidthReceived),height:Number(t.googFrameHeightReceived),frameRate:Number(t.googFrameRateOutput)},e.jitterBufferMs=Number(t.googJitterBufferMs),e.firsCount=Number(t.googFirsSent),e.nacksCount=Number(t.googNacksSent),e.plisCount=Number(t.googPlisSent),e.framesDecodeCount=Number(t.framesDecoded),e.bytes=Number(t.bytesReceived),e.packets=Number(t.packetsReceived),e.packetsLost=Number(t.packetsLost),e.ssrc=Number(t.ssrc),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,e.decodedFrame.width,e.decodedFrame.height),this.isFirstVideoDecoded[e.ssrc]=!0),n){const i=n.stats,r=Date.now()-n.lts;e.framesDecodeFreezeTime=i.framesDecodeFreezeTime,e.framesDecodeInterval=i.framesDecodeInterval,e.framesDecodeCount>i.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=r,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc,10))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<n.stats.framesDecodeCount&&(e.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:Ck({},e),lts:Date.now()}),this._stats.videoRecv.push(e);break}case"audio_recv":{const e=Ak(bk);e.codec=t.googCodecName,e.outputLevel=Math.abs(Number(t.audioOutputLevel))/32767,e.decodingCNG=Number(t.googDecodingCNG),e.decodingCTN=Number(t.googDecodingCTN),e.decodingCTSG=Number(t.googDecodingCTSG),e.decodingNormal=Number(t.googDecodingNormal),e.decodingPLC=Number(t.googDecodingPLC),e.decodingPLCCNG=Number(t.googDecodingPLCCNG),e.expandRate=Number(t.googExpandRate),e.accelerateRate=Number(t.googAccelerateRate),e.preemptiveExpandRate=Number(t.googPreemptiveExpandRate),e.secondaryDecodedRate=Number(t.googSecondaryDecodedRate),e.speechExpandRate=Number(t.googSpeechExpandRate),e.preferredJitterBufferMs=Number(t.googPreferredJitterBufferMs),e.jitterBufferMs=Number(t.googJitterBufferMs),e.jitterMs=Number(t.googJitterReceived),e.bytes=Number(t.bytesReceived),e.packets=Number(t.packetsReceived),e.packetsLost=Number(t.packetsLost),e.ssrc=Number(t.ssrc),e.receivedFrames=Number(t.googDecodingCTN)||Number(t.packetsReceived),e.droppedFrames=Number(t.googDecodingPLC)+Number(t.googDecodingPLCCNG)||Number(t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.decodingNormal>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),this._stats.audioRecv.push(e);break}case"audio_send":{const e=Ak(_k);e.codec=t.googCodecName,e.inputLevel=Math.abs(Number(t.audioInputLevel))/32767,e.aecReturnLoss=Number(t.googEchoCancellationReturnLoss||0),e.aecReturnLossEnhancement=Number(t.googEchoCancellationReturnLossEnhancement||0),e.residualEchoLikelihood=Number(t.googResidualEchoLikelihood||0),e.residualEchoLikelihoodRecentMax=Number(t.googResidualEchoLikelihoodRecentMax||0),e.bytes=Number(t.bytesSent),e.packets=Number(t.packetsSent),e.packetsLost=Number(t.packetsLost),e.ssrc=Number(t.ssrc),e.rttMs=Number(t.googRtt||0),this._stats.rtt=e.rttMs,this._stats.audioSend.push(e);break}}}))}_getStats(){return new ev(((t,e)=>{this.pc.getStats(t,e)}))}statsResponsesToObjects(t){const e=[];return t.result().forEach((t=>{const n={id:t.id,timestamp:t.timestamp.valueOf().toString(),type:t.type};t.names().forEach((e=>{n[e]=t.stat(e)})),e.push(n)})),e}}function Ik(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function xk(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ik(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ik(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class Ok extends Sk{constructor(){super(...arguments),ih(this,"_stats",gk),ih(this,"report",void 0),ih(this,"lastDecodeVideoReceiverStats",new Map),ih(this,"lastVideoFramesRecv",new Map),ih(this,"lastVideoFramesSent",new Map),ih(this,"lastVideoFramesDecode",new Map),ih(this,"lastVideoJBDelay",new Map),ih(this,"lastAudioJBDelay",new Map),ih(this,"mediaBytesSent",new Map),ih(this,"mediaBytesRetransmit",new Map),ih(this,"mediaBytesTargetEncode",new Map),ih(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=Ak(gk),this.report.forEach((t=>{switch(t.type){case dw.OUTBOUND:case dw.INBOUND:{const e=t.mediaType||t.kind,n=!e&&"frameWidth"in t,i=!e&&!("frameWidth"in t);t.type===dw.OUTBOUND?"audio"===e||i?this.processAudioOutboundStats(t):("video"===e||n)&&this.processVideoOutboundStats(t):t.type===dw.INBOUND&&("audio"===e||i?this.processAudioInboundStats(t):("video"===e||n)&&this.processVideoInboundStats(t));break}case dw.TRANSPORT:{const e=this.report.get(t.selectedCandidatePairId);e&&this.processCandidatePairStats(e);break}case dw.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}})),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),e={local:xk({},mk),remote:xk({},mk)};return t.forEach((n=>{let i;if(n.type===dw.TRANSPORT&&(i=t.get(n.selectedCandidatePairId)),n.type===dw.CANDIDATE_PAIR&&n.selected&&(i=n),i){const n=(t,e)=>{t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol)};if(i.localCandidateId){const r=t.get(i.localCandidateId);r&&n(e.local,r)}if(i.remoteCandidateId){const r=t.get(i.remoteCandidateId);r&&n(e.remote,r)}}})),e}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach((e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)})),this._stats.audioSend.forEach((e=>{t.currentRoundTripTime&&(e.rttMs=1e3*t.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const e=this.report.get(t.localCandidateId);e&&this.processCandidateStats(e)}if(t.remoteCandidateId){const e=this.report.get(t.remoteCandidateId);e&&this.processCandidateStats(e)}}processCandidateStats(t){let e;t.type===dw.LOCAL_CANDIDATE&&(e=this._stats.selectedCandidatePair.localCandidate),t.type===dw.REMOTE_CANDIDATE&&(e=this._stats.selectedCandidatePair.remoteCandidate),e&&(e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol),t.type===dw.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==e.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(xk({},e),xk({},this.stats.selectedCandidatePair.localCandidate)),t.type===dw.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==e.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(xk({},e),xk({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let e=this._stats.audioRecv.find((e=>e.ssrc===t.ssrc));e||(e=Ak(bk),this._stats.audioRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),e.receivedFrames||(e.receivedFrames=t.packetsReceived),e.droppedFrames||(e.droppedFrames=t.packetsLost),e.receivedFrames>0&&!this.isFirstAudioReceived[e.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(e.ssrc),this.isFirstAudioReceived[e.ssrc]=!0),e.outputLevel&&e.outputLevel>0&&!this.isFirstAudioDecoded[e.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(e.ssrc),this.isFirstAudioDecoded[e.ssrc]=!0),"number"==typeof t.concealedSamples&&(e.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let e=this._stats.videoRecv.find((e=>e.ssrc===t.ssrc));e||(e=Ak(vk),this._stats.videoRecv.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsReceived,e.packetsLost=t.packetsLost,e.bytes=t.bytesReceived,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.framesDecodeCount=t.framesDecoded,e.totalInterFrameDelay=t.totalInterFrameDelay,e.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay;const n=this.lastDecodeVideoReceiverStats.get(e.ssrc),i=this.lastVideoFramesDecode.get(e.ssrc),r=Date.now();if(e.framesDecodeCount>0&&!this.isFirstVideoDecoded[e.ssrc]){const t=e.decodedFrame?e.decodedFrame.width:0,n=e.decodedFrame?e.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(e.ssrc,t,n),this.isFirstVideoDecoded[e.ssrc]=!0}if(n){const i=n.stats,s=r-n.lts;e.framesDecodeFreezeTime=i.framesDecodeFreezeTime,e.framesDecodeInterval=i.framesDecodeInterval,!this.isFirstVideoDecoded[e.ssrc]&&s>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[e.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(e.ssrc),this.isFirstVideoDecodedTimeout[e.ssrc]=!0),e.framesDecodeCount>i.framesDecodeCount&&this.isFirstVideoDecoded[e.ssrc]?(n.lts=Date.now(),e.framesDecodeInterval=s,e.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?e.framesDecodeFreezeTime+=e.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):e.framesDecodeCount<i.framesDecodeCount&&(e.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(n.stats.framesDecodeCount>t.framesDecoded?e.qpSumPerFrame=t.qpSum/t.framesDecoded:e.qpSumPerFrame=(t.qpSum-n.qpSum)/(t.framesDecoded-n.stats.framesDecodeCount))}i&&r-i.lts>=800?(e.decodeFrameRate=Math.round((e.framesDecodeCount-i.count)/((r-i.lts)/1e3)),this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:r,rate:e.decodeFrameRate})):i?e.decodeFrameRate=i.rate:this.lastVideoFramesDecode.set(e.ssrc,{count:e.framesDecodeCount,lts:r,rate:0}),t.totalDecodeTime&&(e.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(e.framesRateFirefox=t.framerateMean),e.packets>0&&!this.isFirstVideoReceived[e.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(e.ssrc),this.isFirstVideoReceived[e.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(e.ssrc,{stats:xk({},e),lts:n?n.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let e=this._stats.videoSend.find((e=>e.ssrc===t.ssrc));e||(e=Ak(yk),this._stats.videoSend.push(e));const n=this.mediaBytesSent.get(t.ssrc);if(n)n.add(t.bytesSent);else{const e=new fk(10);e.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,e)}if(void 0!==t.retransmittedBytesSent){const e=this.mediaBytesRetransmit.get(t.ssrc);if(e)e.add(t.retransmittedBytesSent);else{const e=new fk(10);e.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,e)}}if(t.totalEncodedBytesTarget){const e=this.mediaBytesTargetEncode.get(t.ssrc);if(e)e.add(t.totalEncodedBytesTarget);else{const e=new fk(10);e.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,e)}}if(e.ssrc=t.ssrc,e.bytes=t.bytesSent,e.packets=t.packetsSent,e.firsCount=t.firCount,e.nacksCount=t.nackCount,e.plisCount=t.pliCount,e.frameCount=t.framesEncoded,e.adaptionChangeReason=t.qualityLimitationReason,e.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const n=this.lastEncoderMs.get(t.ssrc);if(!n||n.lastFrameCount>t.framesEncoded)e.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const i=t.framesEncoded-n.lastFrameCount,r=t.totalEncodeTime-n.lastEncoderTime;e.avgEncodeMs=1e3*r/i}}if(t.framesEncoded&&t.qpSum){const n=this.lastEncoderMs.get(t.ssrc);!n||n.lastFrameCount>t.framesEncoded?e.qpSumPerFrame=t.qpSum/t.framesEncoded:e.qpSumPerFrame=(t.qpSum-n.lastQpSum)/(t.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,e),this.processVideoTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,dw.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}processAudioOutboundStats(t){let e=this._stats.audioSend.find((e=>e.ssrc===t.ssrc));if(e||(e=Ak(_k),this._stats.audioSend.push(e)),e.ssrc=t.ssrc,e.packets=t.packetsSent,e.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,e),t.codecId&&(e.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,e),t.remoteId)this.processRemoteInboundStats(t.remoteId,e);else{const n=this.findRemoteStatsId(t.ssrc,dw.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,e)}}findRemoteStatsId(t,e){var n;const i=Array.from(Nw(n=this.report).call(n)).find((n=>n.type===e&&n.ssrc===t));return i?i.id:null}processVideoMediaSource(t,e){const n=this.report.get(t);n&&n.width&&n.height&&n.framesPerSecond&&(e.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(t,e){const n=this.report.get(t);n&&(e.inputLevel=n.audioLevel)}processVideoTrackSenderStats(t,e,n){var i,r,s,o;const a=e?this.report.get(e):void 0,c=null!==(i=null==a?void 0:a.framesSent)&&void 0!==i?i:t.framesSent;if("number"!=typeof c)return;let l=null!==(r=null==a?void 0:a.frameWidth)&&void 0!==r?r:t.frameWidth,u=null!==(s=null==a?void 0:a.frameHeight)&&void 0!==s?s:t.frameHeight,d=null!==(o=null==a?void 0:a.framesPerSecond)&&void 0!==o?o:t.framesPerSecond;if("number"==typeof l&&"number"==typeof u||(l=0,u=0),null==d){const t=Date.now(),e=this.lastVideoFramesSent.get(n.ssrc);e&&t-e.lts>=800?(d=Math.round((c-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:t,rate:d})):e?d=e.rate:this.lastVideoFramesSent.set(n.ssrc,{count:c,lts:t,rate:0})}n.sentFrame={width:l,height:u,frameRate:Math.max(0,d)}}processVideoTrackReceiverStats(t,e,n){var i,r,s,o,a;const c=e?this.report.get(e):void 0,l=null!==(i=null==c?void 0:c.framesReceived)&&void 0!==i?i:t.framesReceived,u=null!==(r=null==c?void 0:c.frameWidth)&&void 0!==r?r:t.frameWidth,d=null!==(s=null==c?void 0:c.frameHeight)&&void 0!==s?s:t.frameHeight,h=null!==(o=null==c?void 0:c.jitterBufferDelay)&&void 0!==o?o:t.jitterBufferDelay,A=null!==(a=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==a?a:t.jitterBufferEmittedCount;if("number"==typeof l){const t=this.lastVideoFramesRecv.get(n.ssrc),e=Date.now();n.framesReceivedCount=l;let i=0;t&&e-t.lts>=800?(i=Math.round((l-t.count)/((e-t.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:e,rate:i})):t?i=t.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:l,lts:e,rate:0}),n.receivedFrame={width:u||0,height:d||0,frameRate:i||0},n.decodedFrame={width:u||0,height:d||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:u||0,height:d||0,frameRate:n.decodeFrameRate||0}}if(h&&A){const t=this.lastVideoJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let e=t.jitterBufferMs;const i=A-t.jitterBufferEmittedCount;i>0&&(e=1e3*(h-t.jitterBufferDelay)/i),n.jitterBufferMs=e,n.currentDelayMs=Math.round(e),this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:A,jitterBufferMs:n.currentDelayMs})}}processAudioTrackSenderStats(t,e,n){var i,r,s,o;const a=e?this.report.get(e):void 0,c=null!==(i=null!==(r=null==a?void 0:a.echoReturnLoss)&&void 0!==r?r:t.echoReturnLoss)&&void 0!==i?i:0,l=null!==(s=null!==(o=null==a?void 0:a.echoReturnLossEnhancement)&&void 0!==o?o:t.echoReturnLossEnhancement)&&void 0!==s?s:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=l}processAudioTrackReceiverStats(t,e,n){var i,r,s,o,a,c,l;const u=e?this.report.get(e):void 0,d=null!==(i=null==u?void 0:u.removedSamplesForAcceleration)&&void 0!==i?i:t.removedSamplesForAcceleration,h=null!==(r=null==u?void 0:u.totalSamplesReceived)&&void 0!==r?r:t.totalSamplesReceived,A=null!==(s=null==u?void 0:u.jitterBufferDelay)&&void 0!==s?s:t.jitterBufferDelay,p=null!==(o=null==u?void 0:u.jitterBufferEmittedCount)&&void 0!==o?o:t.jitterBufferEmittedCount,f=null!==(a=null==u?void 0:u.audioLevel)&&void 0!==a?a:null==t?void 0:t.audioLevel,m=null!==(c=null==u?void 0:u.totalSamplesDuration)&&void 0!==c?c:null==t?void 0:t.totalSamplesDuration,g=null!==(l=null==u?void 0:u.concealedSamples)&&void 0!==l?l:t.concealedSamples;if(d&&h&&(n.accelerateRate=d/h),A&&p){const t=this.lastAudioJBDelay.get(n.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let e=t.jitterBufferMs;const i=p-t.jitterBufferEmittedCount;i>0&&(e=1e3*(A-t.jitterBufferDelay)/i),n.jitterBufferMs=Math.round(e),this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:p,jitterBufferMs:n.jitterBufferMs})}n.outputLevel=f;let v=1920;m&&h&&(v=h/m/50,n.receivedFrames=Math.round(h/v)),g&&(n.droppedFrames=Math.round(g/v))}processRemoteInboundStats(t,e){const n=this.report.get(t);n&&(e.packetsLost=n.packetsLost,n.roundTripTime&&(e.rttMs=1e3*n.roundTripTime),n.jitter&&(e.jitterMs=1e3*n.jitter),n.timestamp&&(e.timestamp=n.timestamp))}getCodecFromCodecStats(t){const e=this.report.get(t);if(!e)return"";const n=e.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let t=0,e=null,n=null;this.mediaBytesSent.forEach((e=>{t+=e.diffMean()})),this.mediaBytesRetransmit.forEach((t=>{e=null===e?t.diffMean():e+t.diffMean()})),this.mediaBytesTargetEncode.forEach((t=>{n=null===n?t.diffMean():n+t.diffMean()}));const i=null!==e?t-e:t;this._stats.bitrate={actualEncoded:8*i/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},null!==e&&(this._stats.bitrate.retransmit=8*e/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}}class Lk extends Sk{updateStats(){return ev.resolve()}}function Mk(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const s=function(){const t=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return t&&t[0]?Number(t[0].split("/")[1]):null}();return s?s<76?new Rk(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new Ok(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):function(t){return!!window.RTCStatsReport&&t.getStats()instanceof ev}(t)?new Ok(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r}):new Lk(t,{updateInterval:e,lossRateInterval:n,freezeRateLimit:i,firstVideoDecodedTimeout:r})}function kk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Nk(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?kk(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):kk(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class Pk extends MS{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,e){super(t,e),ih(this,"store",void 0),ih(this,"peerConnection",void 0),ih(this,"remoteSDP",void 0),ih(this,"initialOffer",void 0),ih(this,"statsFilter",void 0),ih(this,"useRTX",!1),ih(this,"localCapabilities",void 0),ih(this,"localCandidateCount",0),ih(this,"allCandidatesReceived",!1),ih(this,"establishPromise",void 0),ih(this,"mutex",new Wy("P2PConnection-mutex")),this.store=e,this.peerConnection=new RTCPeerConnection(Pk.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=Mk(this.peerConnection,NE("STATS_UPDATE_INTERVAL"),void 0,bv()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const e=YM(t.sdp),n=qM(t.sdp,{filterRTX:!this.useRTX,filterVideoFec:NE("FILTER_VIDEO_FEC"),filterAudioFec:NE("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=n,this.initialOffer=t,Nk(Nk({},e),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:t.sdp})}catch(t){throw new Uv(Bv.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,e,n,i,r,s){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(t){ih(this,"sessionDesc",void 0),ih(this,"localCapabilities",void 0),ih(this,"rtpCapabilities",void 0),ih(this,"candidates",void 0),ih(this,"iceParameters",void 0),ih(this,"dtlsParameters",void 0),ih(this,"setup",void 0),ih(this,"currentMidIndex",void 0),ih(this,"cname",void 0),t=Ry(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,remoteSetup:s,localCapabilities:o,sdkCodec:a,cname:c}=t,l=zM.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=r,this.candidates=i,this.iceParameters=e,this.dtlsParameters=n,this.setup=s,this.localCapabilities=o,this.cname=c;for(let t=0;t<l.mediaDescriptions.length;t++){const o=l.mediaDescriptions[t];if(o.attributes.iceUfrag=e.iceUfrag,o.attributes.icePwd=e.icePwd,o.attributes.fingerprints=n.fingerprints,o.attributes.candidates=i,o.attributes.setup=s,"video"===o.media.mediaType){o.media.fmts=r.videoCodecs.map((t=>t.payloadType.toString(10)));let t=r.videoCodecs.filter((t=>{var e,n;return null===(e=t.rtpMap)||void 0===e?void 0:kr(n=e.encodingName.toLowerCase()).call(n,a)}));0===t.length&&(t=r.videoCodecs),o.attributes.payloads=t,o.attributes.extmaps=r.videoExtensions}"audio"===o.media.mediaType&&(o.media.fmts=r.audioCodecs.map((t=>t.payloadType.toString(10))),o.attributes.payloads=r.audioCodecs,o.attributes.extmaps=r.audioExtensions),l.mediaDescriptions[t]=this.mungMediaDesc(o)}this.sessionDesc=l,this.currentMidIndex=l.mediaDescriptions.length-1}toString(){return zM.print(this.sessionDesc)}send(t,e,n){const{ssrcs:i,ssrcGroups:r}=JM(e,this.cname),s=this.sessionDesc.mediaDescriptions.find((e=>t===dS.VIDEO?"video"===e.media.mediaType:"audio"===e.media.mediaType)),o=i[0].attributes.label,a=i[0].attributes.mslabel;return s.attributes.ssrcs=s.attributes.ssrcs.concat(i),s.attributes.ssrcGroups=s.attributes.ssrcGroups.concat(r),{id:o,mslabel:a}}batchSend(t){return t.map((t=>{let{kind:e,ssrcMsg:n}=t;return this.send(e,n,void 0)}))}stopSending(t){this.sessionDesc.mediaDescriptions.forEach((e=>{const n=[],i=[],r=[];e.attributes.ssrcs.forEach((e=>{kr(t).call(t,e.attributes.label||"")?r.push(e):n.push(e)})),e.attributes.ssrcGroups.forEach((t=>{var e;kr(e=r.map((t=>t.ssrcId))).call(e,t.ssrcIds[0])||i.push(t)})),e.attributes.ssrcs=n,e.attributes.ssrcGroups=i}))}mute(t){const e=this.sessionDesc.mediaDescriptions.find((e=>e.attributes.mid===t));if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));e.attributes.direction="inactive"}unmute(t){const e=this.sessionDesc.mediaDescriptions.find((e=>e.attributes.mid===t));if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));e.attributes.direction="sendonly"}receive(t,e,n){t.forEach(((t,e)=>{const n=t._mediaStreamTrack,i=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===n.kind)),r=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],t);this.sessionDesc.mediaDescriptions[i]=r}))}stopReceiving(t){}updateCandidates(t){t===hS.TCP?this.candidates.forEach((t=>{-1===this.candidates.findIndex((e=>"tcp"===e.transport&&e.connectionAddress===t.connectionAddress&&e.port===t.port))&&this.candidates.push(hk(hk({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))})):this.candidates=this.candidates.filter((t=>"tcp"!==t.transport));for(const t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(t){t=Ry(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd}))}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}mungRecvMediaDsec(t,e){const n=Ry(t);return ZM(n,e),ek(n,e),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===t));if(-1!==n){const t=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=t}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,e,n){const i=this.sessionDesc.mediaDescriptions.find((e=>t===dS.VIDEO?"video"===e.attributes.mid:"audio"===e.attributes.mid));if(i){const t=i.attributes.ssrcs.find((t=>t.attributes.label===e));var r;t&&(t.attributes.label=n,null===(r=t.attributes.msid)||void 0===r||r.replace(e,n))}}mungMediaDesc(t){const e=Ry(t);return tk(e),function(t){const e=t.attributes.extmaps.find((t=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===t.extensionName));e&&t.attributes.extmaps.splice(t.attributes.extmaps.indexOf(e),1),t.attributes.payloads.forEach((t=>{const e=t.rtcpFeedbacks.findIndex((t=>"transport-cc"===t.type));-1!==e&&t.rtcpFeedbacks.splice(e,1)}))}(e),e}getSSRC(t){for(const e of this.sessionDesc.mediaDescriptions)for(const n of e.attributes.ssrcs)if(n.attributes.label===t)return[n]}}({remoteIceParameters:t,remoteDtlsParameters:e,candidates:n,remoteRTPCapabilities:i.send,remoteSetup:r,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:s});const o=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(t.toString()))}}async updateRemoteRTPCapabilities(t,e){throw new Uv(Bv.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(t,e){var n=this;return HM((function*(){const i=yield VM(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const r=t.map((t=>n.peerConnection.addTrack(t._mediaStreamTrack))),s=yield VM(n.peerConnection.createOffer()),o=zM.parse(s.sdp),a=t.map((t=>{const e=t._mediaStreamTrack,i=o.mediaDescriptions.find((t=>t.attributes.mid===e.kind));if(!i)throw new Error("Cannot extract ssrc from mediaDescription.");return function(t,e,n){const i=t.attributes.ssrcs.filter((t=>t.attributes.label===e)),r=t.attributes.ssrcGroups;if(0===i.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(r&&i.length>1){const t=r.find((t=>-1!==t.ssrcIds.indexOf(i[0].ssrcId)));return t?[{ssrcId:t.ssrcIds[0],rtx:n?t.ssrcIds[1]:void 0}]:[{ssrcId:i[0].ssrcId}]}return[{ssrcId:i[0].ssrcId}]}(i,e.id,n.useRTX)}));let c;try{c=yield a}catch(t){throw r.forEach((t=>{_v()&&t.replaceTrack(null),n.peerConnection.removeTrack(t)})),t}const l=n.mungSendOfferSDP(s.sdp,t);n.remoteSDP.receive(t,e,c);const u=n.remoteSDP.toString();return yield VM(n.peerConnection.setLocalDescription({type:"offer",sdp:l})),yield VM(n.applySendEncodings(r,t)),yield VM(n.peerConnection.setRemoteDescription({type:"answer",sdp:u})),t.map(((t,e)=>{const n=t._mediaStreamTrack.id;return{localSSRC:a[e],id:n}}))}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(t.toString()))}finally{i()}}))()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const e=this.peerConnection.getSenders().filter((e=>{var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")}));if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");e.map((t=>{_v()&&t.replaceTrack(null),this.peerConnection.removeTrack(t)}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(t);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(t.toString()))}}async receive(t,e,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:n,mslabel:r}=this.remoteSDP.send(t,e,i),s=new ev(((e,i)=>{const s=setTimeout((()=>{i(new Error("Cannot receive track, id: ".concat(n)))}),1e4),o=i=>{const a=Av();if(("Safari"===a.name&&11===Number(a.version)||Ev())&&i.track.id!==n&&i.streams[0].id===r){var c;const r=i.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(t,n,i.track.id),this.peerConnection.removeEventListener("track",o),clearTimeout(s),void e(r)}if(i.track.id===n)return this.peerConnection.removeEventListener("track",o),clearTimeout(s),void e(i.track)};this.peerConnection.addEventListener("track",o)})),o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),{track:await s,id:n}}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getSenders().filter((e=>{var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")}));if(e.length!==t.length)throw new Error("sender' length doesn't match mids' length.");e.map((t=>{if(_v()&&t.track)t.track.enabled=!1;else{const e=t.getParameters();e.encodings.forEach((t=>t.active=!1)),t.setParameters(e)}}))}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getSenders().filter((e=>{var n;return-1!==t.indexOf((null===(n=e.track)||void 0===n?void 0:n.id)||"")}));if(e.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");e.map((async t=>{if(_v()&&t.track)t.track.enabled=!0;else{const e=t.getParameters();e.encodings.forEach((t=>t.active=!0)),await t.setParameters(e)}}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(t){var e=this;return HM((function*(){const n=yield VM(e.mutex.lock("From P2PConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(pC().supportPCSetConfiguration){const n=e.peerConnection.getConfiguration(),i=t===hS.RELAY?"relay":"all";n.iceTransportPolicy!==i&&(zE.debug("[".concat(e.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(i,"]")),n.iceTransportPolicy=i,e.peerConnection.setConfiguration(n))}else if(t===hS.RELAY)return;t!==hS.RELAY&&e.remoteSDP.updateCandidates(t);const i=yield VM(e.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=YM(i.sdp),{remoteIceParameters:s}=yield r.iceParameters;e.remoteSDP.restartICE(s);const o=e.remoteSDP.toString();yield VM(e.peerConnection.setLocalDescription(i)),yield VM(e.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(t){zE.warning("[".concat(e.store.clientId,"] restart ICE failed, abort operation"),t)}finally{n()}}))()}close(){var t;this.peerConnection.close(),null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const t=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(t.sdp,[e]);this.remoteSDP.updateRecvMedia(e._mediaStreamTrack.kind,e);const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,t.toString())}}async updateSendParameters(t,e){const n=this.peerConnection.getSenders().filter((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t}));1===n.length&&await this.applySendEncodings(n,[e])}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const n=this.peerConnection.getSenders().find((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e}));n&&await n.replaceTrack(t._mediaStreamTrack)}createDataChannels(t,e){throw new Uv(Bv.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(t){throw new Uv(Bv.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,zE.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,zE.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),NE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(py(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...Pk.turnServerConfigToIceServers(t.turnServer.servers)),NE("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...Pk.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((t=>{t.forceturn&&(e.iceTransportPolicy="relay")})))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach((t=>{t.security?t.tcpport&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turns:".concat(t.turnServerURL,":").concat(t.tcpport,"?transport=tcp")}):(t.udpport&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turn:".concat(t.turnServerURL,":").concat(t.udpport,"?transport=udp")}),t.tcpport&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turn:".concat(t.turnServerURL,":").concat(t.tcpport,"?transport=tcp")}))})),e}async updateRtpSenderEncodings(t,e){var n;if(e||(e=this.peerConnection.getSenders().find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t._mediaStreamTrack.id}))),!e)return zE.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(!pC().supportSetRtpSenderParameters)return zE.warn("Browser not support set rtp-sender parameters");const i={},r={};if(t instanceof _R)switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(NE("DSCP_TYPE")&&Nv()){var s;const t=NE("DSCP_TYPE");kr(s=["very-low","low","medium","high"]).call(s,t)&&(r.networkPriority=t)}const o=e.getParameters(),a=null===(n=o.encodings)||void 0===n?void 0:n[0];a&&Object.assign(a,r),Object.assign(o,i),zE.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(o.encodings))),await e.setParameters(o)}async applySendEncodings(t,e){try{if(!pC().supportSetRtpSenderParameters)return;if(t.length!==e.length)return;for(let n=0;n<t.length;n++){const i=t[n],r=e[n];i&&r&&await this.updateRtpSenderEncodings(r,i)}}catch(t){zE.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e){const n=zM.parse(t);return e.forEach(((t,e)=>{const i=t._mediaStreamTrack,r=n.mediaDescriptions.find((t=>t.attributes.mid===i.kind));r&&ZM(r,t)})),zM.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;null===(e=this.onFirstAudioReceived)||void 0===e||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;null===(e=this.onFirstVideoReceived)||void 0===e||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;null===(e=this.onFirstAudioDecoded)||void 0===e||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,n)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,t,e,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,t,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const e=this.remoteSDP.batchSend(t).map(((e,n)=>{let{id:i,mslabel:r}=e;const{kind:s}=t[n];return new ev(((t,e)=>{const n=setTimeout((()=>{e(new Error("Cannot receive track, id: ".concat(i)))}),1e4),o=e=>{const a=Av();if("Safari"===a.name&&11===Number(a.version)&&e.track.id!==i&&e.streams[0].id===r){var c;const r=e.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(s,i,e.track.id),this.peerConnection.removeEventListener("track",o),clearTimeout(n),void t({track:r,id:i})}if(e.track.id===i)return this.peerConnection.removeEventListener("track",o),clearTimeout(n),void t({track:e.track,id:i})};this.peerConnection.addEventListener("track",o)}))})),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const i=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(i),await ev.all(e)}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return null==e?void 0:e[0].ssrcId}setConfiguration(t){if(pC().supportPCSetConfiguration){const e=Pk.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}}function Dk(t,e,n){const i=t[e];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const t=this.mutex,n=await t.lock("Locking from P2PConnection.".concat(e));try{for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return await i.apply(this,s)}finally{n()}},n}function Bk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Uk(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Bk(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Bk(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[Object,Object,Array,Object,String,String]),Dw("design:returntype",ev)],Pk.prototype,"connect",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],Pk.prototype,"stopSending",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[String,Array,String,Object]),Dw("design:returntype",ev)],Pk.prototype,"receive",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],Pk.prototype,"stopReceiving",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],Pk.prototype,"muteRemote",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],Pk.prototype,"unmuteRemote",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],Pk.prototype,"muteLocal",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],Pk.prototype,"unmuteLocal",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],Pk.prototype,"close",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[String,nC]),Dw("design:returntype",ev)],Pk.prototype,"updateEncoderConfig",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[String,nC]),Dw("design:returntype",ev)],Pk.prototype,"updateSendParameters",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[nC,String]),Dw("design:returntype",ev)],Pk.prototype,"replaceTrack",null),Pw([Dk,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],Pk.prototype,"getRemoteSSRC",null);const Fk="9",Hk=4e4;function Vk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function jk(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Vk(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Vk(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}let Gk=class t extends MS{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,e;return null!==(t=null===(e=this.peerConnection.getReceivers()[0])||void 0===e||null===(e=e.transport)||void 0===e?void 0:e.state)&&void 0!==t?t:null}constructor(e,n){super(e,n),ih(this,"store",void 0),ih(this,"peerConnection",void 0),ih(this,"remoteSDP",void 0),ih(this,"initialOffer",void 0),ih(this,"transportEventReceiver",void 0),ih(this,"statsFilter",void 0),ih(this,"useXR",NE("USE_XR")),ih(this,"localCapabilities",void 0),ih(this,"remoteCodecs",void 0),ih(this,"localCandidateCount",0),ih(this,"allCandidatesReceived",!1),ih(this,"dataStreamChannelMap",new Map),ih(this,"establishPromise",void 0),ih(this,"mutex",new Wy("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(t.resolvePCConfiguration(e),{optional:[{googDscp:!0}]}),this.statsFilter=Mk(this.peerConnection,NE("STATS_UPDATE_INTERVAL"),void 0,bv()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(t,e){this.remoteCodecs=e;const n=[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var e;return kr(e=Object.keys(DE)).call(e,t)})))];if(rw.updateRemoteRTPCapabilities(this.store.sessionId,{mids:t,localCodecs:n,remoteCodecs:this.remoteCodecs}),this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(t,e,this.store.codec)){const t=await this.peerConnection.createOffer(),e=this.logSDPExchange(t.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(t);const n=this.remoteSDP.toString();null==e||e(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else zE.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else zE.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(n,", codecs: ").concat(e))}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const e=YM(t.sdp),n=await sk({filterRTX:!NE("USE_PUB_RTX")&&!NE("USE_SUB_RTX"),filterVideoFec:NE("FILTER_VIDEO_FEC"),filterAudioFec:NE("FILTER_AUDIO_FEC"),filterVideoCodec:NE("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=ak(n),this.initialOffer=t,jk(jk({},e),{},{rtpCapabilities:n,offerSDP:t.sdp})}catch(t){throw new Uv(Bv.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,e,n,i,r,s){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return Ry(this._localCapabilities)}get rtpCapabilities(){return Ry(this._rtpCapabilities)}get candidates(){return Ry(this._candidates)}get iceParameters(){return Ry(this._iceParameters)}get dtlsParameters(){return Ry(this._dtlsParameters)}constructor(t){ih(this,"sessionDesc",void 0),ih(this,"_localCapabilities",void 0),ih(this,"_rtpCapabilities",void 0),ih(this,"_candidates",void 0),ih(this,"_iceParameters",void 0),ih(this,"_dtlsParameters",void 0),ih(this,"setup",void 0),ih(this,"currentMidIndex",void 0),ih(this,"cname",void 0),ih(this,"firefoxSsrcMidMap",new Map),t=Ry(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,remoteSetup:s,localCapabilities:o,cname:a}=t,c=zM.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=o,this.setup=s,this.cname=a;const l=this.rtpCapabilities.send;for(const t of c.mediaDescriptions){if(t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd,t.attributes.fingerprints=n.fingerprints,t.attributes.candidates=i,t.attributes.setup=s,"video"===t.media.mediaType&&(t.media.fmts=l.videoCodecs.map((t=>t.payloadType.toString(10))),t.attributes.payloads=l.videoCodecs,t.attributes.extmaps=l.videoExtensions,NE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:n}=JM([{ssrcId:Hk,rtx:NE("USE_SUB_RTX")?40001:void 0}],this.cname);t.attributes.ssrcs=e,t.attributes.ssrcGroups=n}if("audio"===t.media.mediaType&&(t.media.fmts=l.audioCodecs.map((t=>t.payloadType.toString(10))),t.attributes.payloads=l.audioCodecs,t.attributes.extmaps=l.audioExtensions,ck(t),NE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:n}=JM([{ssrcId:2e4}],this.cname);t.attributes.ssrcs=e,t.attributes.ssrcGroups=n}}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}preloadRemoteMedia(){const t=NE("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const e=this.candidates,n=this.dtlsParameters,i=this.iceParameters,r=this.rtpCapabilities.send;for(let s=1;s<t;s++){const t=2*s+2e4,o=2*s+Hk,{ssrcs:a,ssrcGroups:c}=JM([{ssrcId:t}],this.cname),{ssrcs:l,ssrcGroups:u}=JM([{ssrcId:o,rtx:NE("USE_SUB_RTX")?o+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Fk,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.videoCodecs.map((t=>t.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:e,extmaps:r.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:r.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*s)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Fk,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.audioCodecs.map((t=>t.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:e,extmaps:r.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:c,rtcpFeedbackWildcards:[],payloads:r.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*s+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return zM.print(this.sessionDesc)}send(t,e,n,i){const{ssrcs:r,ssrcGroups:s}=JM(e,this.cname,NE("SYNC_GROUP")?n:void 0),o=this.findPreloadMediaDesc(r);if(o){if(bv()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,o.attributes.mid),i&&(i.twcc||i.remb)){const t=this.sessionDesc.mediaDescriptions.indexOf(o);return this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(o,i),{mid:o.attributes.mid,needExchangeSDP:!0}}return{mid:o.attributes.mid,needExchangeSDP:!1}}{const e=this.findAvailableMediaIndex(t,r);let n;return-1===e||1===e&&(_v()||Cv())||0===e&&NE("USE_SUB_RTX")||Rv()?(n=this.createOrRecycleSendMedia(t,r,s,"sendonly",i),this.updateBundleMids()):(n=Ry(this.sessionDesc.mediaDescriptions[e]),n.attributes.direction="sendonly",n.attributes.ssrcs=r,n.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(n,i)),bv()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:t,needExchangeSDP:e}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:t.attributes.mid,needExchangeSDP:e}}batchSend(t){const e=t.map((t=>{let{kind:e,ssrcMsg:n,mslabel:i}=t;return this.send(e,n,i)})),n=[];let i=!1;return e.forEach((t=>{let{mid:e,needExchangeSDP:r}=t;r&&(i=!0),n.push(e)})),{mids:n,needExchangeSDP:i}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter((e=>e.attributes.mid&&-1!==t.indexOf(e.attributes.mid)));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach((t=>{"0"===t.attributes.mid||bv()||Rv()?t.attributes.ssrcs=[]:(t.attributes.ssrcs=[],t.attributes.direction="inactive",t.media.port="0")})),this.updateBundleMids()}mute(t){const e=this.sessionDesc.mediaDescriptions.find((e=>e.attributes.mid===t));if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));e.attributes.direction="inactive"}unmute(t){const e=this.sessionDesc.mediaDescriptions.find((e=>e.attributes.mid===t));if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));e.attributes.direction="sendonly"}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter((e=>kr(t).call(t,e.attributes.mid||"")));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach((t=>{t.attributes.direction="inactive"}))}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter((e=>kr(t).call(t,e.attributes.mid||"")));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach((t=>{t.attributes.direction="recvonly"}))}receive(t,e,n,i){t.forEach(((t,r)=>{this.createOrRecycleRecvMedia(t,[],"recvonly",e,n,i[r])})),this.updateBundleMids()}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter((e=>-1!==t.indexOf(e.attributes.mid)));if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach((t=>{t.media.port="0",t.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(t){const e=this._candidates.filter((t=>"udp"===t.transport));if(t===hS.TCP){if(0===e.length)return;if(NE("TCP_CANDIDATE_ONLY")){const t=this._candidates.filter((t=>"tcp"===t.transport));e.forEach((e=>{-1===t.findIndex((t=>t.connectionAddress===e.connectionAddress))&&t.push(Uk(Uk({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),this._candidates=t}else{const t=[];e.forEach((e=>{t.push(Uk(Uk({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})),this._candidates=[...e,...t]}}else if(t===hS.RELAY){if(0!==e.length)return;{const t=this._candidates.filter((t=>"tcp"===t.transport));t.forEach((t=>{e.push(Uk(Uk({},t),{},{foundation:"udpcandidate",priority:Number(t.priority)+1+"",transport:"udp",port:Number(t.port)-90+""}))})),this._candidates=[...e,...t]}}else 0===e.length?(this._candidates.filter((t=>"tcp"===t.transport)).forEach((t=>{e.push(Uk(Uk({},t),{},{foundation:"udpcandidate",priority:Number(t.priority)+1+"",transport:"udp",port:Number(t.port)-90+""}))})),this._candidates=e):this._candidates=this._candidates.filter((t=>"tcp"!==t.transport));for(const t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(t){t=Ry(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd}))}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}findAvailableMediaIndex(t,e){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const i=n.media.mediaType===t&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(bv()){if(i){const t=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(t||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!t||t!==n.attributes.mid)}return!1}return i}))}createOrRecycleDataChannel(){for(const t of this.sessionDesc.mediaDescriptions)if("application"===t.media.mediaType)return{mediaDesc:t,needExchangeSDP:!1};this.currentMidIndex+=1;const t="".concat(this.currentMidIndex),e={media:{mediaType:"application",port:Fk,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(t),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(e),{mediaDesc:e,needExchangeSDP:!0}}createOrRecycleRecvMedia(t,e,n,i,r,s){const o=t._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,c=uk(o,a,this.localCapabilities.send,o===dS.VIDEO?i:r),l=o===dS.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let d={media:{mediaType:o,port:Fk,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((t=>t.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};d=this.mungRecvMediaDsec(d,t,s);const h=this.findFirstClosedMedia(o);if(h){const t=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[t]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(t,e,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var e;return kr(e=Object.keys(DE)).call(e,t)})))],r=new Set(e);if(i.every((t=>r.has(t))))return zE.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(e)),!1;const s=this._rtpCapabilities.recv.videoCodecs.filter((t=>e.some((e=>{var n;return kr(n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").call(n,e)}))));if(0===s.length)return zE.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(e)),!1;const o=[...new Set(s.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")))];let a;if(zE.debug("updateRemoteCodec, from ".concat(i," to ").concat(o)),0===t.length)a=this.sessionDesc.mediaDescriptions.filter((t=>"video"===t.media.mediaType&&"recvonly"===t.attributes.direction));else if(a=this.sessionDesc.mediaDescriptions.filter((e=>e.attributes.mid&&kr(t).call(t,e.attributes.mid)&&"recvonly"===e.attributes.direction)),a.length!==t.length)return zE.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(e)),!1;this._rtpCapabilities.recv.videoCodecs=s;const c=this.localCapabilities.send,l=this.rtpCapabilities.recv,u=uk(dS.VIDEO,l,c,n);return a.forEach((t=>{const e=u.map((t=>t.payloadType.toString(10)));zE.debug("updateRemoteCodec mid: ".concat(t.attributes.mid,", from ").concat(t.attributes.payloads," to ").concat(u)),t.attributes.payloads=u,t.media.fmts=e})),!0}createOrRecycleSendMedia(t,e,n,i,r){const s=this.rtpCapabilities.send,o=t===dS.VIDEO?s.videoCodecs:s.audioCodecs,a=t===dS.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:t,port:Fk,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map((t=>t.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:a,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,r);const u=this.findFirstClosedMedia(t);if(u){const t=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[t]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((t=>"0"!==t.media.port)).map((t=>t.attributes.mid))}mungRecvMediaDsec(t,e,n){const i=Ry(t);return tk(i),ZM(i,e),ek(i,e),nk(i),ik(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=Ry(t);return ik(n,e,this.localCapabilities.recv),ck(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===t));if(-1!==n){const t=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=t}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find((e=>bv()?"0"===e.media.port&&e.media.mediaType===t:"0"===e.media.port))}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find((e=>{var n;return(null===(n=e.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===t[0].ssrcId}))}getSSRC(t){var e;return null===(e=this.sessionDesc.mediaDescriptions.find((e=>e.attributes.mid===t)))||void 0===e?void 0:e.attributes.ssrcs}}({remoteIceParameters:t,remoteDtlsParameters:e,candidates:n,remoteRTPCapabilities:i,remoteSetup:r,localCapabilities:this.localCapabilities,cname:s}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const o=this.remoteSDP.toString(),a=zM.parse(this.initialOffer.sdp),c=a.mediaDescriptions.find((t=>"audio"===t.media.mediaType));c&&ck(c),this.useXR&&lk(a);const l=zM.print(a),u=this.logSDPExchange(l||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),null==u||u(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o});const d=this.peerConnection.getTransceivers()[0];if(null!=d&&d.receiver&&this.tryBindTransportEvents(d.receiver),NE("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const e=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(e)}}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(t.toString()))}}send(t,e,n){var i=this;return HM((function*(){const r=yield VM(i.mutex.lock("From P2PConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const s=[];t.forEach((t=>{const e=i.peerConnection.addTransceiver(t._mediaStreamTrack,{direction:"sendonly"});s.push(e),t._updateRtpTransceiver(e)})),bv()&&!0===NE("SIMULCAST")&&(yield VM(i.applySimulcastForFirefox(s,t)));const o=yield VM(i.peerConnection.createOffer()),a=i.remoteSDP.predictReceivingMids(t.length),c=i.mungSendOfferSDP(o.sdp,t,a),l=zM.parse(c),u=a.map((t=>{const e=l.mediaDescriptions.find((e=>e.attributes.mid===t));if(!e)throw new Error("Cannot extract ssrc from mediaDescription.");return $M(e,NE("USE_PUB_RTX"))}));let d;try{d=yield u}catch(r){d=[],i.remoteSDP.receive(t,e,n,d);const s=i.remoteSDP.toString();throw yield VM(i.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield VM(i.peerConnection.setRemoteDescription({type:"answer",sdp:s})),yield VM(i.stopSending(a,!0)),r}i.remoteSDP.receive(t,e,n,d);const h=i.remoteSDP.toString(),A=i.logSDPExchange(c,"offer","local","send");return yield VM(i.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield VM(i.applySimulcastEncodings(s,t)),yield VM(i.applySendEncodings(s,t)),null==A||A(h),yield VM(i.peerConnection.setRemoteDescription({type:"answer",sdp:h})),s.map(((t,e)=>{const n=a[e];return{localSSRC:u[e],id:n,transceiver:t}}))}catch(t){throw t instanceof Uv?t:new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(t.toString()))}finally{r()}}))()}async createDataChannels(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(t);n&&"open"===n.readyState?zE.debug("[P2PConnection] Channels are already available and can be reused directly."):(n=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:NE("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,n)),e.forEach((t=>{t._updateOriginDataChannel(n)}));const{needExchangeSDP:i}=this.remoteSDP.sendDataChannel();if(i){const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const e=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(e),zE.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else zE.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(t){throw t instanceof Uv?t:new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(t.toString()))}}async stopDataChannels(t){try{const e=this.dataStreamChannelMap.get(t);return null==e||e.close(),void this.dataStreamChannelMap.delete(t)}catch(t){throw t instanceof Uv?t:new Uv(Bv.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(t.toString()))}}async stopSending(t,e){const n=e?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const e=this.peerConnection.getTransceivers().filter((e=>-1!==t.indexOf(e.mid)));if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");e.map((t=>{var e;t.direction="inactive",null===(e=t.stop)||void 0===e||e.call(t)}));const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const s=this.remoteSDP.toString();null==r||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(t.toString()))}finally{n&&n()}}async receive(t,e,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:r,needExchangeSDP:s}=this.remoteSDP.send(t,e,n,i);if(s){const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer(),s=this.mungReceiveAnswerSDP(i.sdp,r,t);null==n||n(s||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:s}),zE.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else zE.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const o=this.peerConnection.getTransceivers().find((t=>t.mid===r));if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:r,transceiver:o}}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:e,needExchangeSDP:n}=this.remoteSDP.batchSend(t);if(n){const t=this.remoteSDP.toString(),e=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();null==e||e(n.sdp||""),await this.peerConnection.setLocalDescription(n),zE.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else zE.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return e.map((t=>{const e=this.peerConnection.getTransceivers().find((e=>e.mid===t));if(!e)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:e.receiver.track,id:t,transceiver:e}}))}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();null==n||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();null==n||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(t.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();null==n||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(t.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter((e=>e.mid&&-1!==t.indexOf(e.mid)));if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map((t=>{t.direction="inactive"}));const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(t);const r=this.remoteSDP.toString();null==i||i(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter((e=>e.mid&&-1!==t.indexOf(e.mid)));if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map((async(t,e)=>{t.direction="sendonly"}));const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(t);const r=this.remoteSDP.toString();null==i||i(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(t){var e=this;return HM((function*(){const n=yield VM(e.mutex.lock("From P2PConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(pC().supportPCSetConfiguration){const n=e.peerConnection.getConfiguration(),i=t===hS.RELAY?"relay":"all";n.iceTransportPolicy!==i&&(zE.debug("[".concat(e.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(i,"]")),n.iceTransportPolicy=i,e.peerConnection.setConfiguration(n))}else if(t===hS.RELAY)return;e.remoteSDP.updateCandidates(t);const i=yield VM(e.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=YM(i.sdp),{remoteIceParameters:s}=yield r.iceParameters;e.remoteSDP.restartICE(s);const o=e.remoteSDP.toString(),a=e.logSDPExchange(i.sdp||"","offer","local","restartICE");e.store.descriptionStart(),yield VM(e.peerConnection.setLocalDescription(i)),null==a||a(o),yield VM(e.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(t){zE.warning("[".concat(e.store.clientId,"] restart ICE failed, abort operation"),t)}finally{n()}}))()}close(){var t;this.peerConnection.close(),null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[e],[t]);this.remoteSDP.updateRecvMedia(t,e);const r=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==s||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,t.toString())}}async updateSendParameters(t,e){const n=this.peerConnection.getTransceivers().filter((e=>e.mid===t));1===n.length&&(this.isVP8Simulcast(e)?bv()||await this.applySimulcastEncodings(n,[e]):await this.applySendEncodings(n,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const n=this.peerConnection.getTransceivers().find((t=>t.mid===e));n&&await n.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const e=t[0].transport.iceTransport,{local:n,remote:i}=e.getSelectedCandidatePair();return{local:jk(jk({},mk),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:jk(jk({},mk),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,zE.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,zE.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),NE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(e){const n={iceServers:[]};return e.iceServers?n.iceServers=e.iceServers:e.turnServer&&"off"!==e.turnServer.mode&&(py(e.turnServer.servers)?n.iceServers=e.turnServer.servers:(n.iceServers&&n.iceServers.push(...t.turnServerConfigToIceServers(e.turnServer.servers)),NE("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&e.turnServer.serversFromGateway&&n.iceServers.push(...t.turnServerConfigToIceServers(e.turnServer.serversFromGateway)),NE("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).forEach((t=>{t.forceturn&&(n.iceTransportPolicy="relay")})))),NE("ENABLE_ENCODED_TRANSFORM")&&pC().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const e=[];return t.forEach((t=>{t.security?t.tcpport&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turns:".concat(pL(t.turnServerURL),":").concat(t.tcpport,"?transport=tcp")}):(t.udpport&&!NE("FORCE_TURN_TCP")&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turn:".concat(t.turnServerURL,":").concat(t.udpport,"?transport=udp")}),t.tcpport&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turn:".concat(t.turnServerURL,":").concat(t.tcpport,"?transport=tcp")}))})),e}tryBindTransportEvents(t){const e=t.transport;if(e){this.transportEventReceiver=t,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=t=>{var e;null===(e=this.onDTLSTransportError)||void 0===e||e.call(this,"error"in t?t.error:t)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:t,remote:e}=n.getSelectedCandidatePair();zE.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol}),", remote ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol,address:e.address,port:e.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,e){var n;if(e||(e=this.peerConnection.getSenders().find((e=>e.track===t._mediaStreamTrack))),!e)return zE.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return zE.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!pC().supportSetRtpSenderParameters)return zE.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},r={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var s;const{bitrateMax:e,frameRate:n,scaleResolutionDownBy:i}=t._encoderConfig;e&&(r.maxBitrate=1e3*e),(kr(s=t._hints).call(s,NT.LOW_STREAM)||t.isUseScaleResolutionDownBy)&&(n&&(r.maxFramerate=mL(n)),i&&i>=1&&(r.scaleResolutionDownBy=i))}if(NE("DSCP_TYPE")&&Nv()){var o;const t=NE("DSCP_TYPE");kr(o=["very-low","low","medium","high"]).call(o,t)&&(r.networkPriority=t)}const a=e.getParameters(),c=null===(n=a.encodings)||void 0===n?void 0:n[0];bv()&&!c&&(i.encodings=[r]),c&&Object.assign(c,r),Object.assign(a,i),zE.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await e.setParameters(a)}async applySendEncodings(t,e){try{if(!pC().supportSetRtpSenderParameters)return;if(t.length!==e.length)return;for(let n=0;n<t.length;n++){const i=t[n],r=e[n];r instanceof _R&&!this.isVP8Simulcast(r)&&await this.updateRtpSenderEncodings(r,i.sender)}}catch(t){zE.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e,n){const i=zM.parse(t);return e.forEach(((t,e)=>{const r=n[e],s=i.mediaDescriptions.find((t=>t.attributes.mid===r));s&&(ZM(s,t),rk(s,t,this.store.codec))})),zM.print(i)}mungReceiveAnswerSDP(t,e,n){const i=zM.parse(t),r=i.mediaDescriptions.find((t=>t.attributes.mid===e));return r&&(n===dS.AUDIO&&"audio"===r.media.mediaType&&ck(r),this.useXR&&lk(i)),zM.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;null===(e=this.onFirstAudioReceived)||void 0===e||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;null===(e=this.onFirstVideoReceived)||void 0===e||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;null===(e=this.onFirstAudioDecoded)||void 0===e||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,n)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,t,e,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;null===(e=this.onFirstVideoDecodedTimeout)||void 0===e||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let a=0;a<t.length;a++){var n,i,r,s,o;const c=t[a],l=e[a];if(l instanceof _R&&!kr(n=l._hints).call(n,NT.LOW_STREAM)&&null!==(i=l._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(r=l._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(s=l._scalabilityMode)&&void 0!==s&&s.numSpatialLayers&&(null===(o=l._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){const t={},e={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};t.encodings=[{rid:"m",active:!0,maxBitrate:e.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:e.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,t))}}}async applySimulcastEncodings(t,e){if(!bv()&&t.length===e.length)for(let n=0;n<t.length;n++){const i=e[n];if(i instanceof _R&&this.isVP8Simulcast(i)){const e=t[n],r={},s={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};r.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}];const o=e.sender.getParameters();await e.sender.setParameters(Object.assign(o,r))}}}isVP8Simulcast(t){var e,n,i,r,s;return!!(t instanceof _R&&NE("SIMULCAST")&&"vp8"===this.store.codec&&!kr(e=t._hints).call(e,NT.LOW_STREAM)&&null!==(n=t._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(i=t._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(r=t._scalabilityMode)&&void 0!==r&&r.numSpatialLayers&&(null===(s=t._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1)}logSDPExchange(t,e,n,i){if(NE("SDP_LOGGING"))return zE.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(e," SDP during P2PConnection.").concat(i,"\n"),t),"offer"===e?t=>{this.logSDPExchange(t,"answer","local"===n?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return null==e?void 0:e[0].ssrcId}setConfiguration(e){if(pC().supportPCSetConfiguration){const n=t.resolvePCConfiguration(e);this.peerConnection.setConfiguration(n)}}};function Qk(t,e,n){const i=t[e];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const t=this.mutex,n=await t.lock("From P2PConnection.".concat(e));try{for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return await i.apply(this,s)}finally{n()}},n}function zk(t,e){let n=document.createElement("video"),i=document.createElement("canvas");n.setAttribute("style","display:none"),i.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),i.width=mL(e.width),i.height=mL(e.height);const r=mL(e.framerate||15);document.body.append(n),document.body.append(i);let s=t._mediaStreamTrack;n.srcObject=new MediaStream([s]),n.play();const o=i.getContext("2d");if(!o)throw new Bw(Bv.UNEXPECTED_ERROR,"can not get canvas context");const a=pC(),c=i.captureStream(a.supportRequestFrame?0:r).getVideoTracks()[0];c.canvas||(c.canvas=i),i.startCapture=()=>{if(!n)return i.stopCapture&&i.stopCapture();if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const t=n.videoWidth,e=n.videoHeight/t,r=i.width*e;Math.abs(r-i.height)>=2&&(zE.debug("adjust low stream resolution","".concat(i.width,"x").concat(i.height," -> ").concat(i.width,"x").concat(r)),i.height=r)}o.drawImage(n,0,0,i.width,i.height),c.requestFrame&&c.requestFrame(),s!==t._mediaStreamTrack&&(s=t._mediaStreamTrack,n.srcObject=new MediaStream([s]))},i.stopCapture=hC((()=>i.startCapture&&i.startCapture()),r);const l=c.stop;return c.stop=()=>{l.call(c),n&&(n.remove(),n.srcObject=null,n=null),i&&(i.width=0,i.remove(),i.stopCapture&&i.stopCapture(),i.startCapture=void 0,i.stopCapture=void 0,i=null),zE.debug("clean low stream renderer")},c}function Wk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function Kk(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Wk(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Wk(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[Array,Array]),Dw("design:returntype",ev)],Gk.prototype,"updateRemoteRTPCapabilities",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[Object,Object,Array,Object,String,String]),Dw("design:returntype",ev)],Gk.prototype,"connect",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[Object,Array]),Dw("design:returntype",ev)],Gk.prototype,"createDataChannels",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[String,Array,String,Object]),Dw("design:returntype",ev)],Gk.prototype,"receive",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],Gk.prototype,"batchReceive",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],Gk.prototype,"stopReceiving",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],Gk.prototype,"muteRemote",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],Gk.prototype,"unmuteRemote",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],Gk.prototype,"muteLocal",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],Gk.prototype,"unmuteLocal",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],Gk.prototype,"close",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[String,nC]),Dw("design:returntype",ev)],Gk.prototype,"updateEncoderConfig",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[String,nC]),Dw("design:returntype",ev)],Gk.prototype,"updateSendParameters",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[nC,String]),Dw("design:returntype",ev)],Gk.prototype,"replaceTrack",null),Pw([Qk,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],Gk.prototype,"getRemoteSSRC",null);const qk="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n",Yk="9",$k=2e4,Xk=4e4;class Jk{get localCapabilities(){return Ry(this._localCapabilities)}get rtpCapabilities(){return Ry(this._rtpCapabilities)}get candidates(){return Ry(this._candidates)}get iceParameters(){return Ry(this._iceParameters)}get dtlsParameters(){return Ry(this._dtlsParameters)}constructor(t){ih(this,"sessionDesc",void 0),ih(this,"_localCapabilities",void 0),ih(this,"_rtpCapabilities",void 0),ih(this,"_candidates",void 0),ih(this,"_iceParameters",void 0),ih(this,"_dtlsParameters",void 0),ih(this,"setup",void 0),ih(this,"currentMidIndex",void 0),ih(this,"cname",void 0),ih(this,"firefoxSsrcMidMap",new Map),t=Ry(t);const{remoteIceParameters:e,remoteDtlsParameters:n,candidates:i,remoteRTPCapabilities:r,remoteSetup:s,localCapabilities:o,cname:a}=t,c=zM.parse(qk);this._rtpCapabilities=r,this._candidates=i,this._iceParameters=e,this._dtlsParameters=n,this._localCapabilities=o,this.setup=s,this.cname=a;const l=this.rtpCapabilities.send;for(const t of c.mediaDescriptions){if(t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd,t.attributes.fingerprints=n.fingerprints,t.attributes.candidates=i,t.attributes.setup=s,"application"===t.media.mediaType&&(t.attributes.sctpPort="5000"),"video"===t.media.mediaType&&(t.media.fmts=l.videoCodecs.map((t=>t.payloadType.toString(10))),t.attributes.payloads=l.videoCodecs,t.attributes.extmaps=l.videoExtensions,NE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:n}=JM([{ssrcId:Xk,rtx:NE("USE_SUB_RTX")?40001:void 0}],this.cname);t.attributes.ssrcs=e,t.attributes.ssrcGroups=n}if("audio"===t.media.mediaType&&(t.media.fmts=l.audioCodecs.map((t=>t.payloadType.toString(10))),t.attributes.payloads=l.audioCodecs,t.attributes.extmaps=l.audioExtensions,ck(t),NE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:n}=JM([{ssrcId:$k}],this.cname);t.attributes.ssrcs=e,t.attributes.ssrcGroups=n}}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const e=zM.parse(qk);this._rtpCapabilities=t;const n=this.rtpCapabilities.send;for(const t of e.mediaDescriptions){if(t.attributes.iceUfrag=this._iceParameters.iceUfrag,t.attributes.icePwd=this._iceParameters.icePwd,t.attributes.fingerprints=this._dtlsParameters.fingerprints,t.attributes.candidates=this._candidates,t.attributes.setup=this.setup,"application"===t.media.mediaType&&(t.attributes.sctpPort="5000"),"video"===t.media.mediaType&&(t.media.fmts=n.videoCodecs.map((t=>t.payloadType.toString(10))),t.attributes.payloads=n.videoCodecs,t.attributes.extmaps=n.videoExtensions,NE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:n}=JM([{ssrcId:Xk,rtx:NE("USE_SUB_RTX")?40001:void 0}],this.cname);t.attributes.ssrcs=e,t.attributes.ssrcGroups=n}if("audio"===t.media.mediaType&&(t.media.fmts=n.audioCodecs.map((t=>t.payloadType.toString(10))),t.attributes.payloads=n.audioCodecs,t.attributes.extmaps=n.audioExtensions,NE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:e,ssrcGroups:n}=JM([{ssrcId:$k}],this.cname);t.attributes.ssrcs=e,t.attributes.ssrcGroups=n}}this.sessionDesc=e,this.currentMidIndex=e.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const e=this.candidates,n=this.dtlsParameters,i=this.iceParameters,r=this.rtpCapabilities.send;for(let s=1;s<t;s++){const t=2*s+$k,o=2*s+Xk,{ssrcs:a,ssrcGroups:c}=JM([{ssrcId:t}],this.cname),{ssrcs:l,ssrcGroups:u}=JM([{ssrcId:o,rtx:NE("USE_SUB_RTX")?o+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Yk,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.videoCodecs.map((t=>t.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:e,extmaps:r.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:l,ssrcGroups:u,rtcpFeedbackWildcards:[],payloads:r.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*s-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Yk,protos:["UDP","TLS","RTP","SAVPF"],fmts:r.audioCodecs.map((t=>t.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:i.iceUfrag,icePwd:i.icePwd,unrecognized:[],candidates:e,extmaps:r.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:c,rtcpFeedbackWildcards:[],payloads:r.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*s)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return zM.print(this.sessionDesc)}send(t,e,n,i){const{ssrcs:r,ssrcGroups:s}=JM(e,this.cname,NE("SYNC_GROUP")?n:void 0),o=this.findPreloadMediaDesc(r);if(o){if(bv()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,o.attributes.mid),i&&(i.twcc||i.remb)){const t=this.sessionDesc.mediaDescriptions.indexOf(o);return this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(o,i),{mid:o.attributes.mid,needExchangeSDP:!0}}return{mid:o.attributes.mid,needExchangeSDP:!1}}{const e=this.findAvailableMediaIndex(t,r);let n;return-1===e||_v()||Ev()||Cv()||0===e&&NE("USE_SUB_RTX")?(n=this.createOrRecycleSendMedia(t,r,s,"sendonly",i),this.updateBundleMids()):(n=Ry(this.sessionDesc.mediaDescriptions[e]),n.attributes.direction="sendonly",n.attributes.ssrcs=r,n.attributes.ssrcGroups=s,this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(n,i)),bv()&&this.firefoxSsrcMidMap.set(r[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const e=t.map((t=>{let{kind:e,ssrcMsg:n,mslabel:i}=t;return this.send(e,n,i)})),n=[];let i=!1;return e.forEach((t=>{let{mid:e,needExchangeSDP:r}=t;r&&(i=!0),n.push(e)})),{mids:n,needExchangeSDP:i}}stopSending(t){const e=this.sessionDesc.mediaDescriptions.filter((e=>e.attributes.mid&&-1!==t.indexOf(e.attributes.mid)));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");e.forEach((t=>{"0"===t.attributes.mid||bv()||_v()||Ev()?t.attributes.ssrcs=[]:(t.attributes.ssrcs=[],t.attributes.direction="inactive",t.media.port="0")})),this.updateBundleMids()}mute(t){const e=this.sessionDesc.mediaDescriptions.find((e=>e.attributes.mid===t));if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));e.attributes.direction="inactive"}unmute(t){const e=this.sessionDesc.mediaDescriptions.find((e=>e.attributes.mid===t));if(!e)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));e.attributes.direction="sendonly"}muteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter((e=>kr(t).call(t,e.attributes.mid||"")));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach((t=>{t.attributes.direction="inactive"}))}unmuteRemote(t){const e=this.sessionDesc.mediaDescriptions.filter((e=>kr(t).call(t,e.attributes.mid||"")));if(e.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");e.forEach((t=>{t.attributes.direction="recvonly"}))}receive(t,e,n,i){t.forEach(((t,r)=>{this.createOrRecycleRecvMedia(t,[],"recvonly",e,n,i[r])})),this.updateBundleMids()}stopReceiving(t){const e=this.sessionDesc.mediaDescriptions.filter((e=>-1!==t.indexOf(e.attributes.mid)));if(e.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");e.forEach((t=>{t.media.port="0",t.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(t){t===hS.TCP?this._candidates.forEach((t=>{-1===this._candidates.findIndex((e=>"tcp"===e.transport&&e.connectionAddress===t.connectionAddress&&e.port===t.port))&&this._candidates.push(Kk(Kk({},t),{},{foundation:"tcpcandidate",priority:Number(t.priority)-1+"",transport:"tcp",port:Number(t.port)+90+""}))})):this._candidates=this._candidates.filter((t=>"tcp"!==t.transport));for(const t of this.sessionDesc.mediaDescriptions)t.attributes.candidates=this.candidates}restartICE(t){t=Ry(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach((e=>{e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd}))}predictReceivingMids(t){const e=[];for(let n=0;n<t;n++)e.push((this.currentMidIndex+n+1).toString(10));return e}findAvailableMediaIndex(t,e){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const i=n.media.mediaType===t&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(bv()){if(i){const t=this.firefoxSsrcMidMap.get(e[0].ssrcId);return!(t||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!t||t!==n.attributes.mid)}return!1}return i}))}createOrRecycleRecvMedia(t,e,n,i,r,s){const o=t._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,c=uk(o,a,this.localCapabilities.send,o===dS.VIDEO?i:r),l=o===dS.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const u="".concat(this.currentMidIndex);let d={media:{mediaType:o,port:Yk,protos:["UDP","TLS","RTP","SAVPF"],fmts:c.map((t=>t.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:l,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:c,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(u)}};d=this.mungRecvMediaDsec(d,t,s);const h=this.findFirstClosedMedia(o);if(h){const t=this.sessionDesc.mediaDescriptions.indexOf(h);this.sessionDesc.mediaDescriptions[t]=d}else this.sessionDesc.mediaDescriptions.push(d);return d}updateRemoteCodec(t,e,n){const i=[...new Set(this._rtpCapabilities.recv.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var e;return kr(e=Object.keys(DE)).call(e,t)})))],r=new Set(e);if(i.every((t=>r.has(t))))return zE.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(e)),!1;const s=this._rtpCapabilities.recv.videoCodecs.filter((t=>e.some((e=>{var n;return kr(n=t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"").call(n,e)}))));if(0===s.length)return zE.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(i," codecs: ").concat(e)),!1;const o=[...new Set(s.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")))];let a;if(zE.debug("updateRemoteCodec, from ".concat(i," to ").concat(o)),0===t.length)a=this.sessionDesc.mediaDescriptions.filter((t=>"video"===t.media.mediaType&&"recvonly"===t.attributes.direction));else if(a=this.sessionDesc.mediaDescriptions.filter((e=>e.attributes.mid&&kr(t).call(t,e.attributes.mid)&&"recvonly"===e.attributes.direction)),a.length!==t.length)return zE.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(t,", codecs: ").concat(e)),!1;this._rtpCapabilities.recv.videoCodecs=s;const c=this.localCapabilities.send,l=this.rtpCapabilities.recv,u=uk(dS.VIDEO,l,c,n);return a.forEach((t=>{const e=u.map((t=>t.payloadType.toString(10)));zE.debug("updateRemoteCodec mid: ".concat(t.attributes.mid,", from ").concat(t.attributes.payloads," to ").concat(u)),t.attributes.payloads=u,t.media.fmts=e})),!0}createOrRecycleSendMedia(t,e,n,i,r){const s=this.rtpCapabilities.send,o=t===dS.VIDEO?s.videoCodecs:s.audioCodecs,a=t===dS.VIDEO?s.videoExtensions:s.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let l={media:{mediaType:t,port:Yk,protos:["UDP","TLS","RTP","SAVPF"],fmts:o.map((t=>t.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:a,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:e,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:o,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};l=this.mungSendMediaDesc(l,r);const u=this.findFirstClosedMedia(t);if(u){const t=this.sessionDesc.mediaDescriptions.indexOf(u);this.sessionDesc.mediaDescriptions[t]=l}else this.sessionDesc.mediaDescriptions.push(l);return l}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((t=>"0"!==t.media.port)).map((t=>t.attributes.mid))}mungRecvMediaDsec(t,e,n){const i=Ry(t);return tk(i),ZM(i,e),ek(i,e),nk(i),ik(i,n,this.localCapabilities.send),i}mungSendMediaDesc(t,e){const n=Ry(t);return ik(n,e,this.localCapabilities.recv),ck(n),n}updateRecvMedia(t,e){const n=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===t));if(-1!==n){const t=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],e);this.sessionDesc.mediaDescriptions[n]=t}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find((e=>bv()?"0"===e.media.port&&e.media.mediaType===t:"0"===e.media.port))}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find((e=>{var n;return(null===(n=e.attributes)||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId)===t[0].ssrcId}))}getSSRC(t){var e;return null===(e=this.sessionDesc.mediaDescriptions.find((e=>e.attributes.mid===t)))||void 0===e?void 0:e.attributes.ssrcs}}function Zk(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function tN(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Zk(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Zk(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class eN extends MS{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,e,n){super(t,e),ih(this,"store",void 0),ih(this,"peerConnection",void 0),ih(this,"remoteSDP",void 0),ih(this,"initialOffer",void 0),ih(this,"transportEventReceiver",void 0),ih(this,"statsFilter",void 0),ih(this,"useXR",NE("USE_XR")),ih(this,"localCapabilities",void 0),ih(this,"localCandidateCount",0),ih(this,"allCandidatesReceived",!1),ih(this,"remoteCodecs",void 0),ih(this,"dataStreamChannelMap",new Map),ih(this,"establishPromise",void 0),ih(this,"mutex",new Wy("NVExtentionsConnection-mutex")),ih(this,"rtcMedia",void 0),this.store=e,this.peerConnection=n,this.statsFilter=Mk(this.peerConnection,NE("STATS_UPDATE_INTERVAL"),void 0,bv()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const e=YM(t.sdp),n=await sk({filterRTX:!NE("USE_PUB_RTX")&&!NE("USE_SUB_RTX"),filterVideoFec:NE("FILTER_VIDEO_FEC"),filterAudioFec:NE("FILTER_AUDIO_FEC"),filterVideoCodec:NE("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=n,this.initialOffer=t,tN(tN({},e),{},{rtpCapabilities:n,offerSDP:t.sdp})}catch(t){throw new Bw(Bv.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,e,n,i,r,s){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new Jk({remoteIceParameters:t,remoteDtlsParameters:e,candidates:n,remoteRTPCapabilities:i,remoteSetup:r,localCapabilities:ak(this.localCapabilities),cname:s});const o=this.remoteSDP.toString(),a=zM.parse(this.initialOffer.sdp),c=a.mediaDescriptions.find((t=>"audio"===t.media.mediaType));c&&ck(c),this.useXR&&lk(a);const l=zM.print(a),u=this.logSDPExchange(l||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:l}),null==u||u(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(t){throw new Bw(Bv.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(t.toString()))}}async updateRemoteRTPCapabilities(t,e){let n;this.remoteCodecs=e,this.localCapabilities&&(n=ak(this.localCapabilities));const i=[...new Set(n&&n.send.videoCodecs.map((t=>t.rtpMap&&t.rtpMap.encodingName.toLowerCase()||"")).filter((t=>{var e;return kr(e=Object.keys(DE)).call(e,t)})))];if(rw.updateRemoteRTPCapabilities(this.store.sessionId,{mids:t,localCodecs:i,remoteCodecs:this.remoteCodecs}),this.remoteSDP)if(this.remoteSDP.updateRemoteCodec(t,e,this.store.codec)){const t=await this.peerConnection.createOffer(),e=this.logSDPExchange(t.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(t);const n=this.remoteSDP.toString();null==e||e(n),await this.peerConnection.setRemoteDescription({type:"answer",sdp:n})}else zE.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.");else zE.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(i,", codecs: ").concat(e))}async updateRemoteConnect(t){var e,n,i,r;null===(e=this.remoteSDP)||void 0===e||e.updateRemoteRTPCapabilities(t),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&(null===(r=this.remoteSDP)||void 0===r||r.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),null===(n=this.remoteSDP)||void 0===n||n.preloadRemoteMedia(2);const s=null===(i=this.remoteSDP)||void 0===i?void 0:i.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),zE.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,e,n){var i=this;return HM((function*(){const r=yield VM(i.mutex.lock("From NVExtentionsConnection.send"));try{if(!i.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const s=[];t.forEach((t=>{const e=i.peerConnection.addTransceiver(t._mediaStreamTrack,{direction:"sendonly"});s.push(e)})),bv()&&!0===NE("SIMULCAST")&&(yield VM(i.applySimulcastForFirefox(s,t)));const o=yield VM(i.peerConnection.createOffer()),a=i.remoteSDP.predictReceivingMids(t.length),c=i.mungSendOfferSDP(o.sdp,t,a),l=zM.parse(c),u=a.map((t=>{const e=l.mediaDescriptions.find((e=>e.attributes.mid===t));if(!e)throw new Error("Cannot extract ssrc from mediaDescription.");return $M(e,NE("USE_PUB_RTX"))}));let d;try{d=yield u}catch(r){d=[],i.remoteSDP.receive(t,e,n,d);const s=i.remoteSDP.toString();throw yield VM(i.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield VM(i.peerConnection.setRemoteDescription({type:"answer",sdp:s})),yield VM(i.stopSending(a,!0)),r}i.remoteSDP.receive(t,e,n,d);const h=i.remoteSDP.toString(),A=i.logSDPExchange(c,"offer","local","send");return yield VM(i.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield VM(i.applySimulcastEncodings(s,t)),yield VM(i.applySendEncodings(s,t)),null==A||A(h),yield VM(i.peerConnection.setRemoteDescription({type:"answer",sdp:h})),s.map(((t,e)=>{const n=a[e];return{localSSRC:u[e],id:n,transceiver:t}}))}catch(t){throw t instanceof Bw?t:new Bw(Bv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(t.toString()))}finally{r()}}))()}async stopSending(t,e){const n=e?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const e=this.peerConnection.getTransceivers().filter((e=>-1!==t.indexOf(e.mid)));if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");e.map((t=>{var e;t.direction="inactive",null===(e=t.stop)||void 0===e||e.call(t)}));const i=await this.peerConnection.createOffer(),r=this.logSDPExchange(i.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(i),this.remoteSDP.stopReceiving(t);const s=this.remoteSDP.toString();null==r||r(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(t){throw new Bw(Bv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(t.toString()))}finally{n&&n()}}async createDataChannels(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let n=this.dataStreamChannelMap.get(t);return n&&"open"===n.readyState?zE.debug("[P2PConnection] Channels are already available and can be reused directly."):(n=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:NE("DATASTREAM_MAX_RETRANSMITS")}),n.binaryType="arraybuffer",this.dataStreamChannelMap.set(t,n)),void e.forEach((t=>{t._updateOriginDataChannel(n)}))}catch(t){throw t instanceof Bw?t:new Bw(Bv.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(t.toString()))}}async stopDataChannels(t){try{const e=this.dataStreamChannelMap.get(t);return null==e||e.close(),void this.dataStreamChannelMap.delete(t)}catch(t){throw t instanceof Bw?t:new Bw(Bv.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(t.toString()))}}async receive(t,e,n,i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:r,needExchangeSDP:s}=this.remoteSDP.send(t,e,n,i);if(s){const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer(),s=this.mungReceiveAnswerSDP(i.sdp,r,t);null==n||n(s||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:s}),zE.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else zE.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const o=this.peerConnection.getTransceivers().find((t=>t.mid===r));if(!o)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:o.receiver.track,id:r}}catch(t){throw new Bw(Bv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(t.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:e,needExchangeSDP:n}=this.remoteSDP.batchSend(t);if(n){const t=this.remoteSDP.toString(),e=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();null==e||e(n.sdp||""),await this.peerConnection.setLocalDescription(n),zE.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else zE.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return e.map((t=>{const e=this.peerConnection.getTransceivers().find((e=>e.mid===t));if(!e)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:e.receiver.track,id:t}}))}catch(t){throw new Bw(Bv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(t.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();null==n||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(t){throw new Bw(Bv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(t.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();null==n||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(t){throw new Bw(Bv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(t.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const e=this.remoteSDP.toString(),n=this.logSDPExchange(e,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();null==n||n(i.sdp||""),await this.peerConnection.setLocalDescription(i)}catch(t){throw new Bw(Bv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(t.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter((e=>e.mid&&-1!==t.indexOf(e.mid)));if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map((t=>{t.direction="inactive"}));const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(t);const r=this.remoteSDP.toString();null==i||i(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(t){throw new Bw(Bv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(t.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const e=this.peerConnection.getTransceivers().filter((e=>e.mid&&-1!==t.indexOf(e.mid)));if(e.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");e.map((async(t,e)=>{t.direction="sendonly"}));const n=await this.peerConnection.createOffer(),i=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(t);const r=this.remoteSDP.toString();null==i||i(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(t){throw new Bw(Bv.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(t.toString()))}}restartICE(t){var e=this;return HM((function*(){const n=yield VM(e.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!e.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(pC().supportPCSetConfiguration){const n=e.peerConnection.getConfiguration(),i=t===hS.RELAY?"relay":"all";n.iceTransportPolicy!==i&&(zE.debug("restartICE change iceTransportPolicy from [".concat(n.iceTransportPolicy,"] to [").concat(i,"]")),n.iceTransportPolicy=i,e.peerConnection.setConfiguration(n))}else if(t===hS.RELAY)return;t!==hS.RELAY&&e.remoteSDP.updateCandidates(t);const i=yield VM(e.peerConnection.createOffer({iceRestart:!0}));if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const r=YM(i.sdp),{remoteIceParameters:s}=yield r.iceParameters;e.remoteSDP.restartICE(s);const o=e.remoteSDP.toString(),a=e.logSDPExchange(i.sdp||"","offer","local","restartICE");yield VM(e.peerConnection.setLocalDescription(i)),null==a||a(o),yield VM(e.peerConnection.setRemoteDescription({type:"answer",sdp:o}))}catch(t){zE.warning("restart ICE failed, abort operation",t)}finally{n()}}))()}close(){var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),i=this.mungSendOfferSDP(n.sdp,[e],[t]);this.remoteSDP.updateRecvMedia(t,e);const r=this.remoteSDP.toString(),s=this.logSDPExchange(i,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:i}),null==s||s(r),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(t){throw new Bw(Bv.EXCHANGE_SDP_FAILED,t.toString())}}async updateSendParameters(t,e){const n=this.peerConnection.getTransceivers().filter((e=>e.mid===t));1===n.length&&(this.isVP8Simulcast(e)?bv()||await this.applySimulcastEncodings(n,[e]):await this.applySendEncodings(n,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const n=this.peerConnection.getTransceivers().find((t=>t.mid===e));n&&await n.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if(null===(t=this.peerConnection.currentLocalDescription)||void 0===t||!t.sdp||!this.localCapabilities)throw new Error;return tN(tN({},YM(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,zE.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,zE.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),NE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(py(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...eN.turnServerConfigToIceServers(t.turnServer.servers)),NE("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...eN.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),NE("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((t=>{t.forceturn&&(e.iceTransportPolicy="relay")})))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach((t=>{t.security?t.tcpport&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turns:".concat(pL(t.turnServerURL),":").concat(t.tcpport,"?transport=tcp")}):(t.udpport&&!NE("FORCE_TURN_TCP")&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turn:".concat(t.turnServerURL,":").concat(t.udpport,"?transport=udp")}),t.tcpport&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turn:".concat(t.turnServerURL,":").concat(t.tcpport,"?transport=tcp")}))})),e}async applySendEncodings(t,e){try{if(!pC().supportSetRtpSenderParameters)return;if(t.length!==e.length)return;for(let u=0;u<t.length;u++){const d=t[u],h=e[u];if(h&&h instanceof _R){var n,i,r;if(this.isVP8Simulcast(h))continue;const t={},e={};switch(h._optimizationMode){case"motion":t.degradationPreference="maintain-framerate";break;case"detail":t.degradationPreference="maintain-resolution";break;default:t.degradationPreference="balanced"}var s,o,a,c;if(null!==(n=h._encoderConfig)&&void 0!==n&&n.bitrateMax&&(e.maxBitrate=1e3*(null===(s=h._encoderConfig)||void 0===s?void 0:s.bitrateMax)),kr(i=h._hints).call(i,NT.LOW_STREAM)&&(null!==(o=h._encoderConfig)&&void 0!==o&&o.frameRate&&(e.maxFramerate=mL(h._encoderConfig.frameRate)),null!==(a=h._encoderConfig)&&void 0!==a&&a.scaleResolutionDownBy&&(null===(c=h._encoderConfig)||void 0===c?void 0:c.scaleResolutionDownBy)>1&&(e.scaleResolutionDownBy=h._encoderConfig.scaleResolutionDownBy)),NE("DSCP_TYPE")&&Nv()){var l;const t=NE("DSCP_TYPE");kr(l=["very-low","low","medium","high"]).call(l,t)&&(e.networkPriority=t)}const u=d.sender.getParameters(),A=null===(r=u.encodings)||void 0===r?void 0:r[0];bv()&&!A&&(t.encodings=[e]),A&&Object.assign(A,e),Object.assign(u,t),await d.sender.setParameters(u)}}}catch(t){zE.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,e,n){const i=zM.parse(t);return e.forEach(((t,e)=>{const r=n[e],s=i.mediaDescriptions.find((t=>t.attributes.mid===r));s&&(ZM(s,t),rk(s,t,this.store.codec))})),zM.print(i)}mungReceiveAnswerSDP(t,e,n){const i=zM.parse(t),r=i.mediaDescriptions.find((t=>t.attributes.mid===e));return r&&n===dS.AUDIO&&"audio"===r.media.mediaType&&ck(r),this.useXR&&lk(i),zM.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;null===(e=this.onFirstAudioReceived)||void 0===e||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;null===(e=this.onFirstVideoReceived)||void 0===e||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;null===(e=this.onFirstAudioDecoded)||void 0===e||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,n)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,t,e,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;null===(e=this.onFirstVideoDecodedTimeout)||void 0===e||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let a=0;a<t.length;a++){var n,i,r,s,o;const c=t[a],l=e[a];if(l instanceof _R&&!kr(n=l._hints).call(n,NT.LOW_STREAM)&&null!==(i=l._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(r=l._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(s=l._scalabilityMode)&&void 0!==s&&s.numSpatialLayers&&(null===(o=l._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){const t={},e={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};t.encodings=[{rid:"m",active:!0,maxBitrate:e.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:e.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,t))}}}async applySimulcastEncodings(t,e){if(!bv()&&t.length===e.length)for(let n=0;n<t.length;n++){const i=e[n];if(i instanceof _R&&this.isVP8Simulcast(i)){const e=t[n],r={},s={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};r.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}];const o=e.sender.getParameters();await e.sender.setParameters(Object.assign(o,r))}}}isVP8Simulcast(t){var e,n,i,r,s;return!!(t instanceof _R&&NE("SIMULCAST")&&"vp8"===this.store.codec&&!kr(e=t._hints).call(e,NT.LOW_STREAM)&&null!==(n=t._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(i=t._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(r=t._scalabilityMode)&&void 0!==r&&r.numSpatialLayers&&(null===(s=t._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1)}logSDPExchange(t,e,n,i){if(NE("SDP_LOGGING"))return zE.upload("exchanging ".concat(n," ").concat(e," SDP during NVExtentionsConnection.").concat(i,"\n"),t),"offer"===e?t=>{this.logSDPExchange(t,"answer","local"===n?"remote":"local",i)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const e=this.remoteSDP.getSSRC(t);return null==e?void 0:e[0].ssrcId}setConfiguration(t){if(pC().supportPCSetConfiguration){const e=eN.resolvePCConfiguration(t);this.peerConnection.setConfiguration(e)}}}function nN(t,e,n){const i=t[e];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const t=this.mutex,n=await t.lock("From NVExtentionsConnection.".concat(e));try{for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return await i.apply(this,s)}finally{n()}},n}function iN(t){var e,n,i,r=2;for("undefined"!=typeof Symbol&&(n=GM,i=Symbol.iterator);r--;){if(n&&null!=(e=t[n]))return e.call(t);if(i&&null!=(e=t[i]))return new rN(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function rN(t){function e(t){if(Object(t)!==t)return ev.reject(new TypeError(t+" is not an object."));var e=t.done;return ev.resolve(t.value).then((function(t){return{value:t,done:e}}))}return rN=function(t){this.s=t,this.n=t.next},rN.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?ev.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?ev.reject(t):e(n.apply(this.s,arguments))}},new rN(t)}Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[Object,Object,Array,Object,String,String]),Dw("design:returntype",ev)],eN.prototype,"connect",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[Array,Array]),Dw("design:returntype",ev)],eN.prototype,"updateRemoteRTPCapabilities",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",ev)],eN.prototype,"updateRemoteConnect",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[Object,Array]),Dw("design:returntype",ev)],eN.prototype,"createDataChannels",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[String,Array,String,Object]),Dw("design:returntype",ev)],eN.prototype,"receive",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],eN.prototype,"batchReceive",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],eN.prototype,"stopReceiving",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],eN.prototype,"muteRemote",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],eN.prototype,"unmuteRemote",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],eN.prototype,"muteLocal",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],eN.prototype,"unmuteLocal",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],eN.prototype,"close",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[String,nC]),Dw("design:returntype",ev)],eN.prototype,"updateEncoderConfig",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[String,nC]),Dw("design:returntype",ev)],eN.prototype,"updateSendParameters",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[nC,String]),Dw("design:returntype",ev)],eN.prototype,"replaceTrack",null),Pw([nN,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],eN.prototype,"getRemoteSSRC",null);class sN extends MS{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,e){super(t,e),ih(this,"store",void 0),ih(this,"peerConnection",void 0),ih(this,"cname",void 0),ih(this,"mutex",new Wy("DataChannelConnection-mutex")),ih(this,"dataChannel",void 0),ih(this,"_p2pConnection",void 0),ih(this,"establishPromise",void 0),ih(this,"_nvMedia",void 0),this.store=e,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(sN.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new eN(t,e,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const e=null===(t=this._nvMedia)||void 0===t?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(e)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,e,n,i,r,s){return this.cname=s,await this._p2pConnection.connect(t,e,n,i,r,s),await new ev(((t,e)=>{const i=setTimeout((()=>{this.closeSignal(),e(new Bw(Bv.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(n))))}),2e3);this.dataChannel.onopen=()=>{if("open"===this.dataChannel.readyState)return clearTimeout(i),void t()},this.dataChannel.onerror=t=>{this.closeSignal(),e(t)}})),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(t,e){return this._p2pConnection.updateRemoteRTPCapabilities(t,e)}send(t,e,n){var i=this;return HM((function*(){const r=yield VM(i.mutex.lock("From DataChannelConnection.send"));try{return yield*jM(iN(i._p2pConnection.send(t,e,n)))}finally{r()}}))()}async stopSending(t,e){return this._p2pConnection.stopSending(t,e)}async createDataChannels(t,e){return this._p2pConnection.createDataChannels(t,e)}async stopDataChannels(t){return this._p2pConnection.stopDataChannels(t)}async receive(t,e,n,i){return this._nvMedia?(zE.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,e,this.cname)):(zE.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,e,n,i))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var e=this;return HM((function*(){return yield*jM(iN(e._p2pConnection.restartICE(t)))}))()}close(){var t;null===(t=this._nvMedia)||void 0===t||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var e;null===(e=this._nvMedia)||void 0===e||e.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,e){return await this._p2pConnection.updateEncoderConfig(t,e)}async updateSendParameters(t,e){return await this._p2pConnection.updateSendParameters(t,e)}setStatsRemoteVideoIsReady(t,e){this._p2pConnection.setStatsRemoteVideoIsReady(t,e)}async replaceTrack(t,e){return await this._p2pConnection.replaceTrack(t,e)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,e,n,i){if(NE("SDP_LOGGING"))return zE.upload("exchanging ".concat(n," ").concat(e," SDP during DataChannelConnection.").concat(i,"\n"),t),"offer"===e?t=>{this.logSDPExchange(t,"answer","local"===n?"remote":"local",i)}:void 0}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(py(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...sN.turnServerConfigToIceServers(t.turnServer.servers)),NE("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...sN.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),NE("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((t=>{t.forceturn&&(e.iceTransportPolicy="relay")})))),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach((t=>{t.security?t.tcpport&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turns:".concat(pL(t.turnServerURL),":").concat(t.tcpport,"?transport=tcp")}):(t.udpport&&!NE("FORCE_TURN_TCP")&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turn:".concat(t.turnServerURL,":").concat(t.udpport,"?transport=udp")}),t.tcpport&&e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turn:".concat(t.turnServerURL,":").concat(t.tcpport,"?transport=tcp")}))})),e}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var e;return null===(e=this.onICEConnectionStateChange)||void 0===e?void 0:e.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var e;return null===(e=this.onConnectionStateChange)||void 0===e?void 0:e.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var e;return null===(e=this.onDTLSTransportStateChange)||void 0===e?void 0:e.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var e;return null===(e=this.onDTLSTransportError)||void 0===e?void 0:e.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var e;return null===(e=this.onICETransportStateChange)||void 0===e?void 0:e.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var e;return null===(e=this.onFirstAudioReceived)||void 0===e?void 0:e.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var e;return null===(e=this.onFirstVideoReceived)||void 0===e?void 0:e.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var e;return null===(e=this.onFirstAudioDecoded)||void 0===e?void 0:e.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,e,n)=>{var i;return null===(i=this.onFirstVideoDecoded)||void 0===i?void 0:i.call(this,t,e,n)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var e;return null===(e=this.onFirstVideoDecodedTimeout)||void 0===e?void 0:e.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,e)=>{var n;return null===(n=this.onSelectedLocalCandidateChanged)||void 0===n?void 0:n.call(this,t,e)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,e)=>{var n;return null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n?void 0:n.call(this,t,e)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}}function oN(t,e,n){const i=t[e];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const t=this.mutex,n=await t.lock("From DataChannelConnection.".concat(e));try{for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return await i.apply(this,s)}finally{n()}},n}function aN(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function cN(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?aN(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):aN(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[Object,Object,Array,Object,String,String]),Dw("design:returntype",ev)],sN.prototype,"connect",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[Array,Array]),Dw("design:returntype",ev)],sN.prototype,"updateRemoteRTPCapabilities",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[Object,Array]),Dw("design:returntype",ev)],sN.prototype,"createDataChannels",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[String,Array,String,Object]),Dw("design:returntype",ev)],sN.prototype,"receive",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],sN.prototype,"stopReceiving",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],sN.prototype,"muteRemote",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],sN.prototype,"unmuteRemote",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],sN.prototype,"muteLocal",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],sN.prototype,"unmuteLocal",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],sN.prototype,"close",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[String,nC]),Dw("design:returntype",ev)],sN.prototype,"updateEncoderConfig",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[String,nC]),Dw("design:returntype",ev)],sN.prototype,"updateSendParameters",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[nC,String]),Dw("design:returntype",ev)],sN.prototype,"replaceTrack",null),Pw([oN,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],sN.prototype,"getRemoteSSRC",null);class lN extends ny{constructor(){super(),ih(this,"uplinkStatsUploadInterval",void 0),ih(this,"uplinkRelatedStatsUploadInterval",void 0),ih(this,"uplinkDenoiserStatsUploadInterval",void 0),ih(this,"transportStatsUploadInterval",void 0),ih(this,"uplinkExtensionStatsUploadInterval",void 0),ih(this,"downlinkExtensionStatsUploadInterval",void 0),ih(this,"extensionUsageStatsUploadInterval",void 0),ih(this,"downlinkStatsUploadInterval",void 0),ih(this,"downlinkRelatedStatsUploadInterval",void 0),ih(this,"lastStats",void 0),ih(this,"uploadUnplinkStarted",!1),ih(this,"uploadDownlinkStarted",!1),ih(this,"uploadTransportStarted",!1),ih(this,"uploadExtensionUsageStarted",!1),ih(this,"requestStats",void 0),ih(this,"requestTransportStats",void 0),ih(this,"requestLocalMedia",void 0),ih(this,"requestRemoteMedia",void 0),ih(this,"requestAllTracks",void 0),ih(this,"requestVideoIsReady",void 0),ih(this,"requestUpload",void 0)}startUploadTransportStats(t){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval((()=>{var e;const n=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);if(n){const e=vL(n);if(t){var i;const t=null===(i=this.requestStats)||void 0===i?void 0:i.call(this,!0);if(t){const n=vL(t);e.connectionType+=n.connectionType<<3}e.connectionType+=110}else e.connectionType+=100;Cy((()=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,_w.TRANSPORT_STATS,e)}))}}),1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval((async()=>{var e,n,i;const r=Date.now(),s={connectionInterval:NE("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:r};let o=[];const a=(null===(e=this.requestAllTracks)||void 0===e?void 0:e.call(this))||[];for(const t of a)!t.muted&&t.enabled&&(o=o.concat(await t.getProcessorUsage()));const c=(null===(n=this.requestRemoteMedia)||void 0===n?void 0:n.call(this))||[];for(const[t,e]of c)e.has(dS.VIDEO)&&t.videoTrack&&(o=o.concat(await t.videoTrack.getProcessorUsage())),e.has(dS.AUDIO)&&t.audioTrack&&(o=o.concat(await t.audioTrack.getProcessorUsage()));if(0===o.length)return;s.details=function(t,e){const n={};for(const{id:o,value:a,level:c,direction:l}of t){var i;const t=null!==(i=e.get(o))&&void 0!==i?i:0,u=2===a?t+NE("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:t;var r,s;e.set(o,u),n[o]?(2===a&&(n[o].value=a),c>n[o].level&&(n[o].level=c),"remote"===l&&(n[o].remoteUidCount+=1),n[o].totalTs=null!==(r=e.get(o))&&void 0!==r?r:0):n[o]={value:a,level:c,remoteUidCount:"local"===l?0:1,totalTs:null!==(s=e.get(o))&&void 0!==s?s:0}}return Object.keys(n).map((t=>{const{level:e,value:i,totalTs:r}=n[t];return{id:t,level:e,value:i,totalTs:r}}))}(o,t);const l=Date.now(),u=l>r?l:r+1;null===(i=this.requestUpload)||void 0===i||i.call(this,_w.EXTENSION_USAGE_STATS,{usageStats:s,sendTs:u})}),NE("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval((()=>{var t;const e=null===(t=this.requestStats)||void 0===t?void 0:t.call(this);e&&(this.uploadUplinkStats(e),this.lastStats=e)}),3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval((()=>{var t;const e=null===(t=this.requestStats)||void 0===t?void 0:t.call(this);e&&this.uploadRelatedUplinkStats(e,this.lastStats),this.lastStats=e}),1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval((()=>{var t;const e=null===(t=this.requestAllTracks)||void 0===t?void 0:t.call(this);e&&this.uploadDenoiserStats(e)}),2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval((()=>{var t;const e=null===(t=this.requestAllTracks)||void 0===t?void 0:t.call(this);e&&this.uploadExtensionStats(e)}),2e3))}uploadUplinkStats(t){var e;((null===(e=this.requestLocalMedia)||void 0===e?void 0:e.call(this))||[]).forEach((e=>{let[n,{track:i,ssrcs:r}]=e;switch(n){case pS.LocalVideoLowTrack:case pS.LocalVideoTrack:{const e=function(t,e,n){var i;const r=e.videoSend.find((e=>e.ssrc===t));if(!r)return null;const s={id:By(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:r.ssrc.toString()};switch(s.A_vstd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",r.sentFrame&&(s.A_fhs=r.sentFrame.height.toString(),s.A_frs=r.sentFrame.frameRate.toString(),s.A_fws=r.sentFrame.width.toString()),r.adaptionChangeReason){case"none":s.A_ac="0";break;case"cpu":s.A_ac="1";break;case"bandwidth":s.A_ac="2";break;case"other":s.A_ac="3"}return s.A_lvps=ZT[n._player?n._player.videoElementStatus:"uninit"].toString(),s.A_nr=null===(i=r.nacksCount)||void 0===i?void 0:i.toString(),r.avgEncodeMs&&(s.A_aem=r.avgEncodeMs.toFixed(0).toString()),NE("P2P")&&(r.bytes&&(s.bytesSent=r.bytes.toString()),"number"==typeof r.packetsLost&&(s.packetsLost=r.packetsLost.toString()),r.packets&&(s.packetsSent=r.packets.toString())),s}(r[0].ssrcId,t,i),s=n===pS.LocalVideoTrack?function(t,e,n){var i,r,s,o,a,c,l,u;const d=e.videoSend.find((e=>e.ssrc===t));if(!d)return null;const h={id:By(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:d.ssrc.toString()},A=null!==(i=null!==(r=null===(s=d.inputFrame)||void 0===s?void 0:s.height)&&void 0!==r?r:null==n?void 0:n._videoHeight)&&void 0!==i?i:0,p=null!==(o=null!==(a=null===(c=d.inputFrame)||void 0===c?void 0:c.width)&&void 0!==a?a:null==n?void 0:n._videoWidth)&&void 0!==o?o:0,f=null!==(l=null===(u=d.inputFrame)||void 0===u?void 0:u.frameRate)&&void 0!==l?l:0;return A&&(h.A_fhi=A+""),p&&(h.A_fwi=p+""),f&&(h.A_fri=f+""),h}(r[0].ssrcId,t,i):null;e&&Cy((()=>{var t;return null===(t=this.requestUpload)||void 0===t?void 0:t.call(this,_w.PUBLISH_STATS,{stream_type:n===pS.LocalVideoLowTrack?"low":"high",stats:cN(cN({},e),s)})}));const o=function(t){const e={id:"bweforvideo",timestamp:new Date(t.timestamp).toISOString(),type:"VideoBwe"};return t.bitrate.retransmit&&(e.A_rb=t.bitrate.retransmit.toString()),t.bitrate.targetEncoded&&(e.A_teb=t.bitrate.targetEncoded.toString()),e.A_aeb=t.bitrate.actualEncoded.toString(),e.A_tb=t.bitrate.transmit.toString(),void 0!==t.sendBandwidth&&(e.A_asb=t.sendBandwidth.toString()),e}(t);o&&setTimeout((()=>{var t;return null===(t=this.requestUpload)||void 0===t?void 0:t.call(this,_w.PUBLISH_STATS,{stream_type:n===pS.LocalVideoLowTrack?"low":"high",stats:o})}),1e3);break}case pS.LocalAudioTrack:{const e=function(t,e,n){const i=e.audioSend.find((e=>e.ssrc===t));if(!i)return null;const r={id:By(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:i.ssrc.toString()};return r.A_astd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",i.inputLevel?r.A_ail=Math.round(100*i.inputLevel).toString():r.A_ail=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),r.A_apil=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),i.aecReturnLoss&&(r.A_ecrl=Math.round(i.aecReturnLoss).toString()),i.aecReturnLossEnhancement&&(r.A_ecrle=Math.round(i.aecReturnLossEnhancement).toString()),NE("P2P")&&(i.bytes&&(r.bytesSent=i.bytes.toString()),"number"==typeof i.packetsLost&&(r.packetsLost=i.packetsLost.toString()),i.packets&&(r.packetsSent=i.packets.toString())),r}(r[0].ssrcId,t,i);e&&Cy((()=>{var t;return null===(t=this.requestUpload)||void 0===t?void 0:t.call(this,_w.PUBLISH_STATS,{stream_type:"high",stats:e})}));break}}}))}uploadRelatedUplinkStats(t,e){var n;((null===(n=this.requestLocalMedia)||void 0===n?void 0:n.call(this))||[]).filter((t=>{let[e]=t;return e===pS.LocalVideoLowTrack||e===pS.LocalVideoTrack})).forEach((e=>{let[n,{ssrcs:i}]=e;const r=function(t,e){const n=e.videoSend.find((e=>e.ssrc===t));return n?{mediaType:"video",isVideoMute:!1,frameRateInput:n.inputFrame&&n.inputFrame.frameRate.toString(),frameRateSent:n.sentFrame&&n.sentFrame.frameRate.toString(),googRtt:n.rttMs.toString(),qpSumPerFrame:Math.floor(n.qpSumPerFrame).toString()}:null}(i[0].ssrcId,t);r&&Cy((()=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,_w.PUBLISH_RELATED_STATS,{stream_type:n===pS.LocalVideoLowTrack?"low":"high",stats:r})}))}))}uploadDenoiserStats(t){for(let r=0;r<t.length;r++){const s=t[r];if(s instanceof ZC){var e,n,i;const t=null===(e=(n=s._external).getDenoiserStats)||void 0===e?void 0:e.call(n);return void(t&&(null===(i=this.requestUpload)||void 0===i||i.call(this,_w.DENOISER_STATS,t)))}}}uploadExtensionStats(t){for(let e=0;e<t.length;e++)t[e].getProcessorStats().forEach((t=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,t.type,t.stats)}))}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let e=!1;this.downlinkStatsUploadInterval=window.setInterval((()=>{var n;const i=null===(n=this.requestStats)||void 0===n?void 0:n.call(this,!0);i&&(this.uploadDownlinkStats(i,e,t),t=i),e=!e}),3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval((()=>{var t;const e=null===(t=this.requestStats)||void 0===t?void 0:t.call(this,!0);e&&(this.uploadRelatedDownlinkStats(e,this.lastStats),this.lastStats=e)}),1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval((()=>{var t;const e=null===(t=this.requestRemoteMedia)||void 0===t?void 0:t.call(this);e&&this.uploadDownlinkExtensionStats(e)}),2e3)}uploadDownlinkStats(t,e,n){var i;((null===(i=this.requestRemoteMedia)||void 0===i?void 0:i.call(this))||[]).forEach((i=>{let[r,s]=i;if(s.has(dS.VIDEO)&&r.videoTrack){const i=r.videoTrack?function(t,e,n,i,r){const s=e.videoRecv.find((e=>e.ssrc===t));if(!s)return null;const o={id:By(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:s.ssrc.toString()};var a,c;if(o.bytesReceived=s.bytes.toString(),o.packetsLost=s.packetsLost.toString(),o.packetsReceived=s.packets.toString(),s.framesRateFirefox&&(o.A_frr=s.framesRateFirefox.toString()),s.receivedFrame?(o.A_frr=s.receivedFrame.frameRate.toString(),o.A_fhr=s.receivedFrame.height.toString(),o.A_fwr=s.receivedFrame.width.toString()):(o.A_fhr=null===(a=i._videoHeight)||void 0===a?void 0:a.toString(),o.A_fwr=null===(c=i._videoWidth)||void 0===c?void 0:c.toString()),o.A_frd=s.decodeFrameRate.toString(),s.outputFrame&&(o.A_fro=s.outputFrame.frameRate.toString()),void 0!==s.jitterBufferMs&&(o.A_jbm=Math.floor(s.jitterBufferMs).toString()),void 0!==s.currentDelayMs&&(o.A_cdm=Math.floor(s.currentDelayMs).toString()),o.A_fs=s.firsCount.toString(),o.A_ns=s.nacksCount.toString(),o.A_ps=s.plisCount.toString(),i&&(o.A_vrtd=i._originMediaStreamTrack.enabled&&i._mediaStreamTrack.enabled?"0":"1"),i._player&&i._player.freezeTimeCounterList.length>0&&(o.A_vrft=Math.round(i._player.freezeTimeCounterList.splice(0,1)[0]).toString()),r&&i._player&&"visible"===lR.visibility){const t=Math.min(6e3,i._player.renderFreezeAccTime);o.A_vrrft=Math.round(t).toString(),i._player.renderFreezeAccTime=Math.max(0,i._player.renderFreezeAccTime-t)}if(o.A_rvps=ZT[i._player?i._player.videoElementStatus:"uninit"].toString(),n){const e=n.videoRecv.find((e=>e.ssrc===t));if(e&&void 0!==s.totalInterFrameDelay&&void 0!==s.totalSquaredInterFrameDelay&&void 0!==e.totalInterFrameDelay&&void 0!==e.totalSquaredInterFrameDelay){const t=s.totalInterFrameDelay-e.totalInterFrameDelay,n=s.totalSquaredInterFrameDelay-e.totalSquaredInterFrameDelay,i=s.framesDecodeCount-e.framesDecodeCount,r=t/i*1e3,a=Math.round(1e3*Math.sqrt((n-Math.pow(t,2)/i)/i));!isNaN(a)&&r+a>Math.max(3*r,r+150)&&(o.A_ifdsd=a.toString())}}return o}(r._videoSSRC,t,n,r.videoTrack,e):void 0;i&&Cy((()=>{var t;return null===(t=this.requestUpload)||void 0===t?void 0:t.call(this,_w.SUBSCRIBE_STATS,{stream_id:r.uid,stats:i})}))}if(s.has(dS.AUDIO)&&r.audioTrack){const e=r.audioTrack?function(t,e,n,i){const r=e.audioRecv.find((e=>e.ssrc===t));if(!r)return null;const s={id:By(10,""),timestamp:new Date(e.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:r.ssrc.toString()};if(s.bytesReceived=r.bytes.toString(),s.packetsLost=r.packetsLost.toString(),s.packetsReceived=r.packets.toString(),r.outputLevel?s.A_aol=Math.round(100*r.outputLevel).toString():s.A_aol=Math.round(100*i._source.getAccurateVolumeLevel()).toString(),s.A_apol=Math.round(100*i._source.getAccurateVolumeLevel()).toString(),i&&(s.A_artd=i._originMediaStreamTrack.enabled&&i._mediaStreamTrack.enabled?"0":"1"),s.A_jr=r.jitterMs.toString(),s.A_jbm=Math.floor(r.jitterBufferMs).toString(),s.A_cdm=Math.floor(r.jitterBufferMs).toString(),s.A_raps=ZT[BC.getPlayerState(i.getTrackId())].toString(),n){const e=n.audioRecv.find((e=>e.ssrc===t));if(e){const t=r.concealedSamples-e.concealedSamples;t>0&&(s.A_cs=Math.round(t).toString())}}return s}(r._audioSSRC,t,n,r.audioTrack):void 0;e&&Cy((()=>{var t;return null===(t=this.requestUpload)||void 0===t?void 0:t.call(this,_w.SUBSCRIBE_STATS,{stream_id:r.uid,stats:e})}))}}))}uploadRelatedDownlinkStats(t,e){var n;((null===(n=this.requestRemoteMedia)||void 0===n?void 0:n.call(this))||[]).forEach((n=>{let[i,r]=n;if(r.has(dS.VIDEO)&&i.videoTrack){var s;const n=!0===(i._videoSSRC&&(null===(s=this.requestVideoIsReady)||void 0===s?void 0:s.call(this,i._videoSSRC))||!1),r=function(t,e,n,i,r,s){const o=n.videoRecv.find((e=>e.ssrc===t)),a=r?r.videoRecv.find((e=>e.ssrc===t)):void 0;if(!o)return null;const c=dL.isRemoteVideoFreeze(s,o,a)&&e,l={mediaType:"video",isVideoMute:!1,peerId:i,frameRateReceived:o.receivedFrame&&o.receivedFrame.frameRate.toString(),frameRateDecoded:o.decodedFrame&&o.decodedFrame.frameRate.toString(),isFreeze:c,bytesReceived:o.bytes.toString(),packetsReceived:o.packets.toString(),packetsLost:o.packetsLost.toString(),qpSumPerFrame:Math.floor(o.qpSumPerFrame).toString()};return o.framesRateFirefox&&(l.frameRateDecoded=o.framesRateFirefox.toString(),l.frameRateReceived=o.framesRateFirefox.toString()),l}(i._videoSSRC,n,t,i.uid,e,i.videoTrack);r&&Cy((()=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,_w.SUBSCRIBE_RELATED_STATS,{stream_id:i.uid,stats:r})}))}if(r.has(dS.AUDIO)&&i.audioTrack){const e=function(t,e,n,i){const r=e.audioRecv.find((e=>e.ssrc===t));if(!r)return null;const s=dL.isRemoteAudioFreeze(i);return{mediaType:"audio",isAudioMute:!1,peerId:n,googJitterReceived:r.jitterMs.toString(),isFreeze:s,bytesReceived:r.bytes.toString(),packetsReceived:r.packets.toString(),packetsLost:r.packetsLost.toString(),frameReceived:r.receivedFrames.toString(),frameDropped:r.droppedFrames.toString()}}(i._audioSSRC,t,i.uid,i.audioTrack);e&&Cy((()=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,_w.SUBSCRIBE_RELATED_STATS,{stream_id:i.uid,stats:e})}))}}))}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(t){t.forEach((t=>{let[e,n]=t;n.has(dS.VIDEO)&&e.videoTrack&&e.videoTrack.getProcessorStats().forEach((t=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,t.type,t.stats)})),n.has(dS.AUDIO)&&e.audioTrack&&e.audioTrack.getProcessorStats().forEach((t=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,t.type,t.stats)}))}))}}function uN(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function dN(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?uN(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):uN(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function hN(t){var e,n,i,r=2;for("undefined"!=typeof Symbol&&(n=GM,i=Symbol.iterator);r--;){if(n&&null!=(e=t[n]))return e.call(t);if(i&&null!=(e=t[i]))return new AN(e.call(t));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function AN(t){function e(t){if(Object(t)!==t)return ev.reject(new TypeError(t+" is not an object."));var e=t.done;return ev.resolve(t.value).then((function(t){return{value:t,done:e}}))}return AN=function(t){this.s=t,this.n=t.next},AN.prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(t){var n=this.s.return;return void 0===n?ev.resolve({value:t,done:!0}):e(n.apply(this.s,arguments))},throw:function(t){var n=this.s.return;return void 0===n?ev.reject(t):e(n.apply(this.s,arguments))}},new AN(t)}class pN extends ny{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(mS.StateChange,e,this._state)}constructor(t,e){super(),ih(this,"store",void 0),ih(this,"statsUploader",void 0),ih(this,"connection",void 0),ih(this,"localTrackMap",new Map),ih(this,"remoteUserMap",new Map),ih(this,"localDataChannels",[]),ih(this,"remoteDataChannelMap",new Map),ih(this,"pendingLocalTracks",[]),ih(this,"pendingRemoteTracks",[]),ih(this,"pendingLocalDataChannels",[]),ih(this,"pendingRemoteDataChannels",[]),ih(this,"statsCollector",void 0),ih(this,"isPlanB",!1),ih(this,"shouldForwardP2PCreation",void 0),ih(this,"iceFailedCount",0),ih(this,"dtlsFailedCount",0),ih(this,"mutex",new Wy("P2PChannel-mutex")),ih(this,"_state",fS.Disconnected),ih(this,"_pcStatsUploadType",NE("NEW_ICE_RESTART")?AS.FIRST_CONNECTION:AS.OLD_FIRST_CONNECTION),ih(this,"_isInRestartIce",!1),ih(this,"_isStartRestartIce",!1),ih(this,"_restartStates",["disconnected","failed"]),ih(this,"_restartTimer",void 0),ih(this,"_isFirstConnected",!0),ih(this,"handleMuteLocalTrack",(async(t,e,n)=>{const i=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==fS.Connected)return void n(new Uv(Bv.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const r=this.filterTobeMutedTracks(t);if(0===r.length)return void e();const s=r.find((t=>"videoLowTrack"===t[0]));s&&s[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(r.map((t=>{let[,{id:e}]=t;return e})));const o=this.createMuteMessage(r);await vy(this,mS.RequestMuteLocal,o),e()}catch(t){n(t)}finally{i()}})),ih(this,"handleUnmuteLocalTrack",(async(t,e,n)=>{const i=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==fS.Connected)return void n(new Uv(Bv.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const r=this.filterTobeUnmutedTracks(t);if(0===r.length)return void e();const s=r.find((t=>"videoLowTrack"===t[0]));if(s){const e=s[1];if(e.track._originMediaStreamTrack.stop(),!NE("DISABLE_DUAL_STREAM_USE_ENCODING")&&pC().supportDualStreamEncoding){const n=t._mediaStreamTrack.clone();e.track._mediaStreamTrack=n,e.track._originMediaStreamTrack=n}else{const n=zk(t,_y(this,mS.RequestLowStreamParameter));e.track._mediaStreamTrack=n,e.track._originMediaStreamTrack=n}await new ev(((t,n)=>{this.handleReplaceTrack(e.track,t,n,!0)}))}await this.connection.unmuteLocal(r.map((t=>{let[,{id:e}]=t;return e})));const o=this.createUnmuteMessage(r);await vy(this,mS.RequestUnmuteLocal,o),e()}catch(t){n(t)}finally{i()}})),ih(this,"handleUpdateVideoEncoder",(async(t,e,n)=>{const i=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const n=this.localTrackMap.get(pS.LocalVideoTrack);if(!this.connection||!n||n.track!==t||this.state!==fS.Connected)return void e();const{id:r,track:s}=n;await this.connection.updateSendParameters(r,s),await this.connection.updateEncoderConfig(r,s),this.emit(mS.UpdateVideoEncoder,s),e()}catch(t){n(t)}finally{i()}})),ih(this,"handleSetOptimizationMode",(async(t,e,n)=>{const i=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const n=this.localTrackMap.get(pS.LocalVideoTrack);if(!this.connection||!n||n.track!==t||this.state!==fS.Connected)return;const{id:r,track:s}=n;await this.connection.updateSendParameters(r,s),e()}catch(t){n(t)}finally{i()}})),ih(this,"handleReplaceTrack",(async(t,e,n,i)=>{let r;zE.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(t.getTrackId(),"]")),"boolean"==typeof i&&i||(r=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var s;const n=Array.from(this.localTrackMap.entries()).find((e=>{let[,{track:n}]=e;return t===n}));if(!this.connection||!n||this.state!==fS.Connected)return void e();if(await(null===(s=this.connection)||void 0===s?void 0:s.replaceTrack(t,n[1].id)),this.isPlanB){const e=n[1];e.id=t._mediaStreamTrack.id,this.localTrackMap.set(n[0],e)}if(n[0]===pS.LocalVideoTrack&&!NE("DISABLE_DUAL_STREAM_USE_ENCODING")&&pC().supportDualStreamEncoding){const e=this.localTrackMap.get(pS.LocalVideoLowTrack);if(e){const n=t._mediaStreamTrack.clone();e.track._originMediaStreamTrack.stop(),e.track._mediaStreamTrack=n,e.track._originMediaStreamTrack=n,await new ev(((t,n)=>{this.handleReplaceTrack(e.track,t,n,!0)}))}}e()}catch(t){n(t)}finally{var o;null===(o=r)||void 0===o||o()}})),ih(this,"handleGetRTCStats",(t=>{t(this.statsCollector.getRTCStats())})),ih(this,"handleGetLocalVideoStats",(t=>{t(this.statsCollector.getLocalVideoTrackStats())})),ih(this,"handleGetLocalAudioStats",(t=>{t(this.statsCollector.getLocalAudioTrackStats())})),ih(this,"handleGetRemoteVideoStats",(t=>this.statsCollector.getRemoteVideoTrackStats(t.uid)[t.uid])),ih(this,"handleGetRemoteAudioStats",(t=>this.statsCollector.getRemoteAudioTrackStats(t.uid)[t.uid])),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new lN,this.bindStatsUploaderEvents(),this.isPlanB=!pC().supportUnifiedPlan||NE("CHROME_FORCE_PLAN_B")&&Nv(),this.shouldForwardP2PCreation=NE("FORWARD_P2P_CREATION")&&pC().supportPCSetConfiguration&&function(){const t=pv();return t===av.ANDROID||t===av.IOS||t===av.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new sN({},this.store):this.isPlanB?new Pk({},this.store):new Gk({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(t,e){var n;this.state=fS.New;const i=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState);if(this.shouldForwardP2PCreation&&!i||(i&&this.connection&&(zE.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new sN(t,this.store):this.isPlanB?new Pk(t,this.store):new Gk(t,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new Uv(Bv.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=NE("NEW_ICE_RESTART")?AS.FIRST_CONNECTION:AS.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(t),this.connection.establishPromise}async connect(t,e,n,i,r,s){if(!this.connection)throw new Uv(Bv.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof sN?this.connection.updateRemoteConnect(i):(this.store.peerConnectionStart(),await this.connection.connect(t,e,n,i,r,s),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=fS.Connected)}updateRemoteRTPCapabilities(t){const e=Array.from(this.localTrackMap.entries()).filter((t=>{var e;let[n]=t;return kr(e=[pS.LocalVideoLowTrack,pS.LocalVideoTrack]).call(e,n)})).map((t=>{let[,{id:e}]=t;return e}));if(this.connection instanceof Gk){if(!kr(t).call(t,this.store.codec)){const e=["vp8","h264"].find((e=>kr(t).call(t,e)));e&&(this.store.codec=e,zE.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(e,".")))}this.connection.updateRemoteRTPCapabilities(e,t)}}async preConnect(t,e,n,i,r,s){if(!this.connection)throw new Uv(Bv.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const o=await this.connection.connect(t,e,n,i,r,s);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=fS.Connected,o}getEstablishParams(){if(this.connection instanceof sN)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(t){if(!this.connection){if(this.state===fS.Disconnected)throw new Uv(Bv.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const e=t.filter((t=>-1!==this.pendingLocalDataChannels.findIndex((e=>e.id===t.id))));return void(this.pendingLocalDataChannels=this.pendingLocalDataChannels.concat(e))}const e=this.filterTobePublishedDataChannels(t);0!==e.length&&(e.forEach((t=>{const e=Date.now();this.store.publish(t.id.toString(),"datachannel",e)})),await this.connection.createDataChannels(this.store.uid,e),e.forEach((t=>{this.localDataChannels.push(t);const e=Date.now();this.store.publish(t.id+"","datachannel",void 0,e)})))}publish(t,e,n){var i=this;return HM((function*(){const r=yield VM(i.mutex.lock("From P2PChannel.publish"));try{if(!i.connection||i.state!==fS.Connected){if(i.state===fS.Disconnected)throw new Uv(Bv.UNEXPECTED_ERROR,"PeerConnection already disconnected.");i.throwIfTrackTypeNotMatch(t);const e=t.filter((t=>-1===i.pendingLocalTracks.indexOf(t)));return void(i.pendingLocalTracks=i.pendingLocalTracks.concat(e))}i.store.pubId=i.store.pubId+1,cL.markPublishStart(i.store.clientId,i.store.pubId);const s=i.filterTobePublishedTracks(t,e,n);if(0===s.length)return void(yield VM(i.tryToUnmuteAudio(t)));yield*jM(hN(i.doPublish(i.connection,s)))}finally{r()}}))()}doPublish(t,e){var n=this;return HM((function*(){e.forEach((t=>{let{track:e,type:i}=t;const r=Date.now();n.store.publish(e.getTrackId(),i===pS.LocalAudioTrack?"audio":"video",r)})),n.bindLocalTrackEvents(e);const i=yield VM(t.send(e.map((t=>{let{track:e}=t;return e})),n.store.codec,n.store.audioCodec)),r=(yield VM(i.next())).value,s=n.createGatewayPublishMessage(e,r);let o;try{o=yield s}catch(t){throw i.throw(t),(null==t?void 0:t.code)===Bv.WS_ABORT&&e.forEach((t=>{let{track:e}=t;-1===n.pendingLocalTracks.indexOf(e)&&n.pendingLocalTracks.push(e)})),n.unbindLocalTrackEvents(e),t}const a=n.mapPubResToRemoteConfig(s,o),c=(yield VM(i.next(a))).value;e.forEach((t=>{let{type:e}=t;n.statsCollector.addLocalStats(e)})),n.assignLocalTracks(e,c),n.statsUploader.startUploadUplinkStats(),e.forEach((t=>{let{track:e,type:i}=t;const r=Date.now();n.store.publish(e.getTrackId(),i===pS.LocalAudioTrack?"audio":"video",void 0,r)}))}))()}async updateVideoStreamParameter(t,e){const n=this.localTrackMap.get(e);if(!n)return;if(!(n.track instanceof _R))return zE.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof Gk||this.connection instanceof Pk))return zE.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:i}=n,r=function(t,e){const n={};return t.height&&t.width&&(n.scaleResolutionDownBy=EL(t,e)),n.maxFramerate=t.framerate?mL(t.framerate):void 0,n.maxBitrate=t.bitrate?1e3*t.bitrate:void 0,n}(t,i);if(i._encoderConfig||(i._encoderConfig={}),e!==pS.LocalVideoLowTrack||!NE("DISABLE_DUAL_STREAM_USE_ENCODING")&&pC().supportDualStreamEncoding)null!=r.scaleResolutionDownBy&&(i._encoderConfig.scaleResolutionDownBy=r.scaleResolutionDownBy);else{const e=i._originMediaStreamTrack;if(!e.canvas)return zE.warn("[".concat(i.getTrackId(),"] no canvas on track"));!function(t,e){const n=t.canvas;e.width&&(n.width=mL(e.width)),e.height&&(n.height=mL(e.height)),e.framerate&&(n.stopCapture&&n.stopCapture(),n.stopCapture=hC((()=>{!n.startCapture&&n.stopCapture&&n.stopCapture(),n.startCapture&&n.startCapture()}),mL(e.framerate)))}(e,t)}null!=r.maxBitrate&&(i._encoderConfig.bitrateMax=r.maxBitrate/1e3),null!=r.maxFramerate&&(i._encoderConfig.frameRate&&"object"==typeof i._encoderConfig.frameRate?i._encoderConfig.frameRate.max=r.maxFramerate:i._encoderConfig.frameRate={max:r.maxFramerate}),zE.debug("[".concat(i.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(i._encoderConfig))),await this.connection.updateRtpSenderEncodings(i)}publishLowStream(t){var e=this;return HM((function*(){if(!e.connection||e.state!==fS.Connected)return;const n=yield VM(e.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const r=e.localTrackMap.get(pS.LocalVideoTrack);if(!r)throw new Uv(Bv.UNEXPECTED_ERROR,"Could not find high stream");if(e.localTrackMap.has(pS.LocalVideoLowTrack))throw new Uv(Bv.UNEXPECTED_ERROR,"[".concat(e.store.clientId,"] Can't publish low stream when stream already publish"));const s=[{track:e.getLowVideoTrack(r.track,t),type:pS.LocalVideoLowTrack}];if(yield*jM(hN(e.doPublish(e.connection,s))),r.track.muted||!r.track.enabled){var i;const t=null===(i=e.localTrackMap.get(pS.LocalVideoLowTrack))||void 0===i?void 0:i.id;void 0!==t&&(yield VM(e.connection.muteLocal([t])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(zE.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await gy(this,mS.RequestRePublish,this.pendingLocalTracks),this.emit(mS.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(zE.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await gy(this,mS.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(t){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:e,kind:n}=this.pendingRemoteTracks[t];(n!==dS.AUDIO||e._audio_added_&&e._audioSSRC)&&(n!==dS.VIDEO||e._video_added_&&e._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(t)await gy(this,mS.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:e}of this.pendingRemoteTracks)await this.subscribe(t,e,e===dS.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach((t=>{let{user:e}=t;this.emit(mS.MediaReconnectEnd,e.uid)})),this.pendingRemoteTracks=[]}async unpublish(t){if(!this.connection||this.state!==fS.Connected)return void t.forEach((t=>{const e=this.pendingLocalTracks.indexOf(t);-1!==e&&this.pendingLocalTracks.splice(e,1)}));const e=this.filterTobeUnpublishedTracks(t);if(0===e.length)return;const n=e.find((t=>"videoLowTrack"===t[0]));return n&&n[1].track.close(),this.doUnpublish(this.connection,e)}async unpublishDataChannel(t){if(!this.connection||this.state!==fS.Connected)return void t.forEach((t=>{const e=this.pendingLocalDataChannels.indexOf(t);-1!==e&&this.pendingLocalDataChannels.splice(e,1)}));const e=this.filterTobeUnpublishedDataChannels(t);return 0!==e.length?(e.forEach((t=>{const e=this.localDataChannels.indexOf(t);-1!==e&&this.localDataChannels.splice(e,1)})),0===this.localDataChannels.length&&await this.connection.stopDataChannels(this.store.uid),e.map((t=>t.id))):void 0}async unpublishLowStream(){if(!this.connection||this.state!==fS.Connected)return;const t=this.localTrackMap.get(pS.LocalVideoLowTrack);if(!t)return;t.track.close();const e=[[pS.LocalVideoLowTrack,t]];return this.doUnpublish(this.connection,e)}async doUnpublish(t,e){const n=this.createGatewayUnpublishMessage(e);return await t.stopSending(e.map((t=>{let[,{id:e}]=t;return e}))),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map((t=>{let[e,{track:n}]=t;return{type:e,track:n}}))),e.forEach((t=>{let[e]=t;this.statsCollector.removeLocalStats(e)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadUplinkStats(),n}async subscribeDataChannel(t,e){if(!this.connection||this.state!==fS.Connected)throw new Uv(Bv.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const n=e.filter((e=>{var n;return!(null!==(n=this.remoteDataChannelMap.get(t))&&void 0!==n&&n.get(e.id))}));if(0!==n.length)return await this.connection.createDataChannels(t.uid,n),n.forEach((e=>{var n;this.remoteDataChannelMap.has(t)?null===(n=this.remoteDataChannelMap.get(t))||void 0===n||n.set(e.id,e):this.remoteDataChannelMap.set(t,new Map([[e.id,e]]));const i=this.pendingRemoteDataChannels.findIndex((n=>{let{user:i,id:r}=n;return i.uid===t.uid&&r===e.id}));-1!==i&&this.pendingRemoteDataChannels.splice(i,1)})),n.map((t=>t.id))}async subscribe(t,e,n,i,r){var s;if(!this.connection||this.state!==fS.Connected)throw new Uv(Bv.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(s=this.remoteUserMap.get(t))&&void 0!==s&&s.has(e))return;let o,a,c;if(r){const n=r.find((t=>{let{stream_type:n}=t;return n===e}));if(!n)throw new Uv(Bv.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(e," for user: ").concat(t.uid," because subscribe answer from gateway does not contain stream_type: ").concat(e,"."));const i=await this.connection.receive(e,n.ssrcs,String(t._uintid),n.attributes);this.connection instanceof Gk&&(c=i.transceiver),o=i.track,a=i.id}else{const r=await this.connection.receive(e,[{ssrcId:n,rtx:i}],String(t._uintid),void 0);this.connection instanceof Gk&&(c=r.transceiver),o=r.track,a=r.id}e===dS.AUDIO?(t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(o):(t._audioTrack=new xR(o,t.uid,t._uintid,this.store),zE.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),c&&t._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(o):(t._videoTrack=new IR(o,t.uid,t._uintid,this.store),zE.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),c&&t._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(t,t._videoTrack));const l=this.remoteUserMap.get(t);l?l.set(e,a):this.remoteUserMap.set(t,new Map([[e,a]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats();const u=this.pendingRemoteTracks.findIndex((n=>{let{user:i,kind:r}=n;return i.uid===t.uid&&e===r}));-1!==u&&(this.pendingRemoteTracks.splice(u,1),this.emit(mS.MediaReconnectEnd,t.uid))}async massSubscribe(t){return this.massSubscribeNoLock(t)}async massSubscribeNoLock(t){if(!this.connection||this.state!==fS.Connected)throw new Uv(Bv.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");t=t.filter((t=>{var e;let{user:n,mediaType:i}=t;return!(null!==(e=this.remoteUserMap.get(n))&&void 0!==e&&e.has(i))}));const e=await this.connection.batchReceive(t.map((t=>{let{user:e,mediaType:n,ssrcId:i,rtxSsrcId:r}=t;return{kind:n,ssrcMsg:[{ssrcId:i,rtx:r}],mslabel:String(e._uintid)}})));t.forEach(((t,n)=>{let{user:i,mediaType:r}=t;const{track:s,id:o,transceiver:a}=e[n];r===dS.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(s):(i._audioTrack=new xR(s,i.uid,i._uintid,this.store),zE.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),a&&i._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(s):(i._videoTrack=new IR(s,i.uid,i._uintid,this.store),zE.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),a&&i._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(i,i._videoTrack));const c=this.remoteUserMap.get(i);c?c.set(r,o):this.remoteUserMap.set(i,new Map([[r,o]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadDownlinkStats();const l=this.pendingRemoteTracks.findIndex((t=>{let{user:e,kind:n}=t;return e.uid===i.uid&&r===n}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(mS.MediaReconnectEnd,i.uid))}))}async unsubscribe(t,e,n){const i=this.pendingRemoteTracks.filter((n=>{let{user:i,kind:r}=n;return void 0!==e?i.uid===t.uid&&e===r:i.uid===t.uid}));if(i.forEach((t=>{const e=this.pendingRemoteTracks.indexOf(t);this.pendingRemoteTracks.splice(e,1)})),this.connection&&this.state===fS.Connected||n||i.forEach((e=>{let{kind:n}=e;var i;if(n===dS.AUDIO)null===(i=t._audioTrack)||void 0===i||i._destroy(),t._audioTrack=void 0;else if(n===dS.VIDEO){var r;null===(r=t._videoTrack)||void 0===r||r._destroy(),t._videoTrack=void 0}})),!this.connection||this.state!==fS.Connected)return;const r=this.filterTobeUnSubscribedTracks(t,e);if(0===r.length)return;await this.connection.stopReceiving(r.map((t=>{let[,{id:e}]=t;return e})));const s=this.createUnsubscribeMessage(r);return this.withdrawRemoteTracks(r),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),r.forEach((t=>{let[e,{kind:i}]=t;var r,s;if(i===dS.VIDEO&&e._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(e._videoSSRC,!1)),i===dS.VIDEO)this.unbindRemoteTrackEvents(e._videoTrack),n||(null===(s=e._videoTrack)||void 0===s||s._destroy(),e._videoTrack=void 0);else if(i===dS.AUDIO){var o;this.unbindRemoteTrackEvents(e._audioTrack),n||(null===(o=e._audioTrack)||void 0===o||o._destroy(),e._audioTrack=void 0)}})),s}async unsubscribeDataChannel(t,e){if(e.forEach((t=>{const e=this.pendingRemoteDataChannels.findIndex((e=>e.id===t.id));-1!==e&&this.pendingRemoteDataChannels.splice(e,1)})),!this.connection)return;const n=this.filterTobeUnSubscribedDataChannels(t,e);if(0===n.length)return;e.forEach((t=>{t._close()}));const i=this.remoteDataChannelMap.get(t);return n.forEach((t=>{i&&i.delete(t.id)})),i&&0===i.size&&(this.remoteDataChannelMap.delete(t),await this.connection.stopDataChannels(t.uid)),n.map((t=>t.id))}async massUnsubscribe(t){return this.massUnsubscribeNoLock(t)}async massUnsubscribeNoLock(t){let e=[];for(const{user:n,mediaType:i}of t){const t=this.pendingRemoteTracks.filter((t=>{let{user:e,kind:r}=t;return void 0!==i?e.uid===n.uid&&i===r:e.uid===n.uid}));t.forEach((t=>{const e=this.pendingRemoteTracks.indexOf(t);this.pendingRemoteTracks.splice(e,1)})),e=e.concat(t)}if(!this.connection||this.state!==fS.Connected)return void e.forEach((t=>{let{user:e,kind:n}=t;var i;if(n===dS.AUDIO)null===(i=e._audioTrack)||void 0===i||i._destroy(),e._audioTrack=void 0;else if(n===dS.VIDEO){var r;null===(r=e._videoTrack)||void 0===r||r._destroy(),e._videoTrack=void 0}}));const n=c_(t).call(t,((t,e)=>{let{user:n,mediaType:i}=e;const r=this.filterTobeUnSubscribedTracks(n,i);return t.concat(r)}),[]);if(0===n.length)return;await this.connection.stopReceiving(n.map((t=>{let[,{id:e}]=t;return e})));const i=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),n.forEach((t=>{let[e,{kind:n}]=t;var i,r;if(n===dS.VIDEO&&e._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(e._videoSSRC,!1)),n===dS.VIDEO)this.unbindRemoteTrackEvents(e._videoTrack),null===(r=e._videoTrack)||void 0===r||r._destroy(),e._videoTrack=void 0;else if(n===dS.AUDIO){var s;this.unbindRemoteTrackEvents(e._audioTrack),null===(s=e._audioTrack)||void 0===s||s._destroy(),e._audioTrack=void 0}})),i}async muteRemote(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);if(!n)return void zE.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void zE.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===dS.VIDEO?t._videoSSRC:t._audioSSRC;void 0!==i&&this.connection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.connection)return;const n=this.remoteUserMap.get(t);n?n.get(e)||zE.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,".")):zE.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(t.uid,"."))}getAllTracks(t){const e=this.localTrackMap.get(pS.LocalAudioTrack);if((null==e?void 0:e.track)instanceof eR){const n=e.track;return Array.from(this.localTrackMap.entries()).filter((t=>{let[e]=t;return e!==pS.LocalAudioTrack})).filter((e=>{let[n]=e;return!(t&&n===pS.LocalVideoLowTrack)})).map((t=>{let[,{track:e}]=t;return e})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((e=>{let[n]=e;return!(t&&n===pS.LocalVideoLowTrack)})).map((t=>{let[,{track:e}]=t;return e}))}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(t,e,n,i,r){if(t){const n=this.localTrackMap.get(pS.LocalAudioTrack),s=i?this.localTrackMap.get(pS.LocalVideoLowTrack):this.localTrackMap.get(pS.LocalVideoTrack);rw.publish(this.store.sessionId,{eventElapse:cL.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==s?void 0:s.track.getTrackLabel(),screenshare:-1!==(null==s?void 0:s.track._hints.indexOf(NT.SCREEN_TRACK)),audio:!!n,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const o=n.find((t=>t instanceof JC)),a=i?null===(s=this.localTrackMap.get(pS.LocalVideoTrack))||void 0===s?void 0:s.track:n.find((t=>t instanceof _R));rw.publish(this.store.sessionId,{eventElapse:cL.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:null==o?void 0:o.getTrackLabel(),videoName:null==a?void 0:a.getTrackLabel(),screenshare:-1!==(null==a?void 0:a._hints.indexOf(NT.SCREEN_TRACK)),audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===dS.VIDEO?n._videoSSRC:n._audioSSRC;r&&rw.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===dS.VIDEO,audio:i===dS.AUDIO,peerid:n.uid,subscribeRequestid:i===dS.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:cL.measureFromSubscribeStart(this.store.clientId,r)})}reset(){zE.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Wy("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new sN({},this.store):this.isPlanB?new Pk({},this.store):new Gk({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(pS.LocalAudioTrack);if((null==t?void 0:t.track)instanceof eR){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach((t=>{e.removeAudioTrack(t)}))}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=fS.Disconnected}getStats(){var t;return null===(t=this.connection)||void 0===t?void 0:t.getStats()}getRemoteVideoIsReady(t){var e;return(null===(e=this.connection)||void 0===e?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(pS.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(pS.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof _R||e&&e.track instanceof JC?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(dh(e=this.remoteUserMap).call(e)).find((e=>e.uid===t));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map((t=>{let[e]=t;return{uid:e.uid,level:e.audioTrack?100*e.audioTrack._source.getAccurateVolumeLevel():0}}));const e=this.localTrackMap.get(pS.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Jh(t).call(t,((t,e)=>t.level-e.level)),t}async disconnectForReconnect(){this.connection&&(zE.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=fS.Reconnecting,NE("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&(null===(n=e._videoTrack._player.getVideoElement())||void 0===n||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())})),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new sN({},this.store):this.isPlanB?new Pk({},this.store):new Gk({},this.store),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((t=>{var e;let[n,{track:i}]=t;switch(n){case pS.LocalVideoTrack:kr(e=i._hints).call(e,NT.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case pS.LocalAudioTrack:i instanceof eR?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case pS.LocalVideoLowTrack:}})),this.emit(mS.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[e,n]=t;Array.from(dh(n).call(n)).forEach((t=>{this.setPendingRemoteMedia(e,t)})),this.emit(mS.MediaReconnectStart,e.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),0!==this.localDataChannels.length&&(this.localDataChannels.forEach((t=>{this.pendingLocalDataChannels.push(t)})),this.localDataChannels.length=0),0!==this.remoteDataChannelMap.size&&(Array.from(this.remoteDataChannelMap.entries()).forEach((t=>{let[e,n]=t;Array.from(dh(n).call(n)).forEach((t=>{this.setPendingRemoteDataChannel(e,t)}))})),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),zE.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(t,e){for(const n of this.pendingRemoteDataChannels){const{user:i,id:r}=n;if((t instanceof OM?t.uid:t)===i.uid&&r===e)return!0}return!1}setPendingRemoteDataChannel(t,e){this.hasPendingRemoteDataChannel(t,e)||this.pendingRemoteDataChannels.push({user:t,id:e})}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof OM?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}restartICE(t){var e=this;return HM((function*(){if(!e.connection||e.state!==fS.Connected||e.connection instanceof sN)return;const n=yield VM(e.mutex.lock("From P2PChannel.restartICE"));let i;try{i=yield VM(e.connection.restartICE(t));const r=yield VM(i.next());if(r.done)return;const s=r.value,o=yield s;switch(e.reportPCDisconnectedOrFailed(t),t){case hS.TCP:e._pcStatsUploadType=AS.TCP_RESTART;break;case hS.RELAY:e._pcStatsUploadType=AS.RELAY_RESTART;break;default:e._pcStatsUploadType=AS.OLD_RESTART}e._isInRestartIce=!0,i.next(o)}catch(t){var r;null===(r=i)||void 0===r||r.throw(t)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats(),e=this.localTrackMap.get(pS.LocalVideoTrack),n=this.localTrackMap.get(pS.LocalAudioTrack),i=t.videoSend.find((t=>t.ssrc===(null==e?void 0:e.ssrcs[0].ssrcId))),r=t.audioSend.find((t=>t.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)));if(!i||!r)return 1;const s=yy(this,mS.NeedSignalRTT),o=i?i.rttMs:void 0,a=r?r.rttMs:void 0,c=o&&a?(o+a)/2:o||a,l=(c&&s?(c+s)/2:c||s)||0,u=100*t.sendPacketLossRate*.7/50+.3*l/1500,d=u<.17?1:u<.36?2:u<.59?3:u<.1?4:5,h=null==e?void 0:e.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(NT.SCREEN_TRACK)){const e=h._encoderConfig.bitrateMax,n=t.bitrate.actualEncoded;if(e&&n){const t=(1e3*e-n)/(1e3*e);return aw[t<.15?0:t<.3?1:t<.45?2:t<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.connection)return 0;const t=this.connection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,o=t.audioRecv.find((t=>t.ssrc===r)),a=t.videoRecv.find((t=>t.ssrc===s));if(!o&&!a)return void(e+=1);const c=yy(this,mS.NeedSignalRTT),l=t.rtt,u=(l&&c?(l+c)/2:l||c)||0,d=o?o.jitterMs:void 0,h=t.recvPacketLossRate;let A=.7*h*100/50+.3*u/1500;d&&(A=.6*h*100/50+.2*u/1500+.2*d/400),e+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5})),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new ev(((e,n)=>{this.handleMuteLocalTrack(t,e,n)}))}filterTobePublishedTracks(t,e,n){const i=[],r=pC(),s=this.getAllTracks();t=Ty(t=t.filter((t=>-1===s.indexOf(t))));let o=!1,a=!1;for(const s of t){if(s instanceof _R&&(this.localTrackMap.has(pS.LocalVideoTrack)||o?new Uv(Bv.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:s,type:pS.LocalVideoTrack}),o=!0),e)){const t=this.getLowVideoTrack(s,n);i.push({track:t,type:pS.LocalVideoLowTrack})}if(s instanceof JC){const t=this.localTrackMap.get(pS.LocalAudioTrack);if(t){if(!(t.track instanceof eR))throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(s._bypassWebAudio)throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");t.track.addAudioTrack(s),this.bindLocalAudioTrackEvents(s,!0)}else if(a){const t=i.find((t=>{let{type:e}=t;return e===pS.LocalAudioTrack}));if(!(t.track instanceof eR))throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(s._bypassWebAudio)throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");t.track.addAudioTrack(s)}else{if(!r.webAudioMediaStreamDest||s instanceof eR||s._bypassWebAudio)i.push({track:s,type:pS.LocalAudioTrack});else{const t=new eR;t.addAudioTrack(s),i.push({track:t,type:pS.LocalAudioTrack})}a=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Ty(t=t.filter((t=>-1!==n.indexOf(t))));for(const n of t){if(n instanceof JC){const t=this.localTrackMap.get(pS.LocalAudioTrack);if(!t)continue;t.track instanceof eR?(t.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),0===t.track.trackList.length&&(e.push([pS.LocalAudioTrack,t]),t.track.close())):e.push([pS.LocalAudioTrack,t])}if(n instanceof _R){const t=this.localTrackMap.get(pS.LocalVideoTrack);if(!t)continue;e.push([pS.LocalVideoTrack,t]);const n=this.localTrackMap.get(pS.LocalVideoLowTrack);n&&e.push([pS.LocalVideoLowTrack,n])}}return e}filterTobePublishedDataChannels(t){return(t=Ty(t)).filter((t=>-1===this.localDataChannels.findIndex((e=>e.id===t.id))))}filterTobeUnpublishedDataChannels(t){return(t=(t=Ty(t)).filter((t=>-1!==this.localDataChannels.indexOf(t)))).filter((t=>t._originDataChannel))}bindLocalTrackEvents(t){t.forEach((t=>{let{track:e,type:n}=t;switch(n){case pS.LocalVideoTrack:e.addListener(kT.GET_STATS,this.handleGetLocalVideoStats),e.addListener(kT.GET_RTC_STATS,this.handleGetRTCStats),e.addListener(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(kT.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),e.addListener(kT.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),e.addListener(kT.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case pS.LocalAudioTrack:this.bindLocalAudioTrackEvents(e);case pS.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(t,e){t instanceof eR?t.trackList.forEach((t=>{t.addListener(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(kT.GET_STATS,this.handleGetLocalAudioStats),t.addListener(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.addListener(kT.GET_STATS,this.handleGetLocalAudioStats),t.addListener(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(kT.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map((t=>{let[e,{track:n}]=t;return{track:n,type:e}}))),t.forEach((t=>{let{track:e,type:n}=t;switch(n){case pS.LocalVideoTrack:e.off(kT.GET_STATS,this.handleGetLocalVideoStats),e.off(kT.GET_RTC_STATS,this.handleGetRTCStats),e.off(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(kT.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),e.off(kT.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),e.off(kT.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case pS.LocalAudioTrack:this.unbindLocalAudioTrackEvents(e);case pS.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(t){t instanceof eR?t.trackList.forEach((t=>{t.off(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(kT.GET_STATS,this.handleGetLocalAudioStats),t.off(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.off(kT.GET_STATS,this.handleGetLocalAudioStats),t.off(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(kT.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof IR&&e.addListener(kT.GET_STATS,(e=>{e(this.handleGetRemoteVideoStats(t))})),e instanceof xR&&e.addListener(kT.GET_STATS,(e=>{e(this.handleGetRemoteAudioStats(t))}))}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(kT.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((t=>{let[e,n]=t;n.has(dS.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(dS.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)}))}createGatewayPublishMessage(t,e){return t.map(((t,n)=>{var i;let r,s,{track:o,type:a}=t;switch(a){case pS.LocalAudioTrack:r=Zw.Audio,s={dtx:o instanceof ZC&&o._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case pS.LocalVideoTrack:r=kr(i=o._hints).call(i,NT.SCREEN_TRACK)?Zw.Screen:Zw.High,s=dN(dN({},gL(o)),{},{codec:this.store.codec});break;case pS.LocalVideoLowTrack:r=Zw.Low,s=dN(dN({},gL(o)),{},{codec:this.store.codec})}return{stream_type:r,attributes:s,ssrcs:e[n]}}))}createGatewayUnpublishMessage(t){return t.map((t=>{var e;let n,[i,{track:r,ssrcs:s,id:o}]=t;switch(i){case pS.LocalVideoTrack:n=kr(e=r._hints).call(e,NT.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case pS.LocalAudioTrack:n=Zw.Audio;break;case pS.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:s,mid:o}}))}assignLocalTracks(t,e){t.forEach(((t,n)=>{let{track:i,type:r}=t;this.localTrackMap.set(r,{track:i,id:e[n].id,ssrcs:e[n].localSSRC})}))}withdrawLocalTracks(t){t.forEach((t=>{let[e]=t;this.localTrackMap.delete(e)}))}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{if(zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(mS.PeerConnectionStateChange,e),"connected"!==e||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===e&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),NE("NEW_ICE_RESTART")){var n;if(kr(n=this._restartStates).call(n,e)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const e=e=>{"disconnected"!==t.iceConnectionState&&"checking"!==t.iceConnectionState&&"failed"!==t.iceConnectionState||(zE.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(e)),"CONNECTED"===yy(this,mS.QueryClientConnectionState)&&this.emit(mS.RequestRestartICE,e))},n=()=>{"disconnected"!==t.iceConnectionState&&"checking"!==t.iceConnectionState&&"failed"!==t.iceConnectionState||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),zE.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(mS.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())},i=NE("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout((()=>{if(NE("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&pC().supportPCSetConfiguration)e(hS.RELAY),this._restartTimer=window.setTimeout(n,i);else if(bv())e(hS.UDP),this._restartTimer=window.setTimeout(n,4e3);else{if(e(hS.TCP),pC().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout((()=>{e(hS.RELAY),this._restartTimer=window.setTimeout(n,i)}),i));this._restartTimer=window.setTimeout(n,i)}}),800))}}else{if("disconnected"===e&&"disconnected"===t.iceConnectionState)return setTimeout((()=>{"disconnected"===t.iceConnectionState&&NE("ICE_RESTART")&&"CONNECTED"===yy(this,mS.QueryClientConnectionState)&&this.emit(mS.RequestRestartICE)}),800),void setTimeout((()=>{"disconnected"===t.peerConnectionState&&(zE.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout((()=>this.emit(mS.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);"failed"===e&&(zE.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout((()=>this.emit(mS.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},t.onICEConnectionStateChange=t=>{"connected"!==t||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),rw.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:oy.TRACER}).onSuccess(),this.emit(mS.IceConnectionStateChange,t)},t.onICETransportStateChange=t=>{zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},t.onDTLSTransportStateChange=t=>{zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},t.onDTLSTransportError=t=>{zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},t.onFirstAudioDecoded=t=>{var e;const n=Array.from(dh(e=this.remoteUserMap).call(e)).find((e=>e._audioSSRC===t));var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(i=n.audioTrack)||void 0===i||i.emit(HT.FIRST_FRAME_DECODED),rw.firstRemoteFrame(this.store.sessionId,$E.FIRST_AUDIO_DECODE,XE.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:cL.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=t=>{var e;const n=Array.from(dh(e=this.remoteUserMap).call(e)).find((e=>e._audioSSRC===t));n&&rw.firstRemoteFrame(this.store.sessionId,$E.FIRST_AUDIO_RECEIVED,XE.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:cL.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(t,e,n)=>{this.reportVideoFirstFrameDecoded(t,e,n)},t.onFirstVideoReceived=t=>{var e;const n=Array.from(dh(e=this.remoteUserMap).call(e)).find((e=>e._videoSSRC===t));n&&rw.firstRemoteFrame(this.store.sessionId,$E.FIRST_VIDEO_RECEIVED,XE.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:cL.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(t,e)=>{const n="relay"===t.candidateType,i="relay"===e.candidateType;"unknown"!==e.candidateType&&n===i||this.emit(mS.ConnectionTypeChange,n),zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(wL(e))," -> ").concat(JSON.stringify(wL(t)),")"))},t.onSelectedRemoteCandidateChanged=(t,e)=>{zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(wL(e))," -> ").concat(JSON.stringify(wL(t)),")"))},t.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(t){const e=[];if(-1===this.getAllTracks().indexOf(t))return e;const n=this.localTrackMap.get(pS.LocalAudioTrack);if(t instanceof JC&&(null==n?void 0:n.track)instanceof eR)return n.track.isActive||e.push([pS.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find((e=>{let[,{track:n}]=e;return t===n}));if(i&&(e.push(i),i[0]===pS.LocalVideoTrack)){const t=this.localTrackMap.get(pS.LocalVideoLowTrack);t&&e.push([pS.LocalVideoLowTrack,t])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(pS.LocalAudioTrack);if(t instanceof JC&&(null==n?void 0:n.track)instanceof eR)return n.track.isActive&&e.push([pS.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find((e=>{let[,{track:n}]=e;return t===n}));if(i)if(i[0]===pS.LocalVideoTrack){e.push(i);const t=this.localTrackMap.get(pS.LocalVideoLowTrack);t&&e.push([pS.LocalVideoLowTrack,t])}else e.push(i);return e}createMuteMessage(t){return t.map((t=>{var e;let n,[i,{track:r,ssrcs:s,id:o}]=t;switch(i){case pS.LocalAudioTrack:n=Zw.Audio;break;case pS.LocalVideoTrack:n=kr(e=r._hints).call(e,NT.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case pS.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:s,mid:o}}))}createUnmuteMessage(t){return t.map((t=>{var e;let n,[i,{track:r,ssrcs:s,id:o}]=t;switch(i){case pS.LocalAudioTrack:n=Zw.Audio;break;case pS.LocalVideoTrack:n=kr(e=r._hints).call(e,NT.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case pS.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:s,mid:o}}))}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach((e=>{let[i,r]=e;n.push([t,{kind:i,id:r}])}));return n}filterTobeUnSubscribedDataChannels(t,e){const n=[];return e.forEach((e=>{var i;null!==(i=this.remoteDataChannelMap.get(t))&&void 0!==i&&i.has(e.id)&&n.push(e)})),n}createUnsubscribeMessage(t){const e=[];return t.forEach((t=>{let[n,{kind:i,id:r}]=t;switch(i){case dS.VIDEO:return void(n._videoSSRC&&e.push({stream_type:dS.VIDEO,ssrcId:n._videoSSRC}));case dS.AUDIO:return void(n._audioSSRC&&e.push({stream_type:dS.AUDIO,ssrcId:n._audioSSRC}))}})),e}createUnsubscribeAllMessage(t){const e=new Map;return t.forEach((t=>{let[n,{kind:i}]=t;if(e.has(n)){let t=e.get(n);i===dS.VIDEO?t|=nS.Video:t|=nS.Audio,e.set(n,t)}else i===dS.VIDEO?e.set(n,nS.Video):e.set(n,nS.Audio)})),{users:Array.from(e.entries()).map((t=>{let[e,n]=t;return{stream_id:e.uid,stream_type:n}}))}}withdrawRemoteTracks(t){t.forEach((t=>{let[e,{kind:n}]=t;const i=this.remoteUserMap.get(e);i&&(i.delete(n),0===Array.from(i.entries()).length&&this.remoteUserMap.delete(e))}))}async updateBitrateLimit(t){const e=this.localTrackMap.get(pS.LocalVideoTrack),n=this.localTrackMap.get(pS.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(t,e){return t.map(((t,n)=>{var i;let{stream_type:r}=t;return null===(i=e.find((t=>{let{stream_type:e}=t;return r===e})))||void 0===i?void 0:i.attributes}))}async tryToUnmuteAudio(t){for(let n=0;n<t.length;n++)if(t[n]instanceof JC){var e;const i=this.filterTobeUnmutedTracks(t[n]);if(0===i.length)continue;await(null===(e=this.connection)||void 0===e?void 0:e.unmuteLocal(i.map((t=>{let[,{id:e}]=t;return e}))));const r=this.createUnmuteMessage(i);return void await vy(this,mS.RequestUnmuteLocal,r)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!(null===(e=this.connection)||void 0===e||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(mS.RequestUploadStats,t,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Dy(Yy(this.dtlsFailedCount,qy)),this.emit(mS.RequestReconnect)}async reconnectP2P(){const t=Array.from(this.localTrackMap.entries()),e=this.createGatewayUnpublishMessage(t);Array.from(this.remoteUserMap.entries()),e.length>0&&await gy(this,mS.RequestUnpublishForReconnectPC,e),this.disconnectForReconnect(),this.emit(mS.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(pS.LocalVideoTrack)||this.pendingLocalTracks.some((t=>t instanceof _R))}throwIfTrackTypeNotMatch(t){if(t.filter((t=>t instanceof _R)).length>1)throw new Uv(Bv.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter((t=>t instanceof JC)).length>1&&(t.some((t=>t instanceof JC&&t._bypassWebAudio))||!pC().webAudioMediaStreamDest))throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof _R&&this.pendingLocalTracks.some((t=>t instanceof _R)))throw new Uv(Bv.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof JC&&this.pendingLocalTracks.some((t=>t instanceof JC))&&(!pC().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some((t=>t instanceof JC&&t._bypassWebAudio))))throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!NE("DISABLE_DUAL_STREAM_USE_ENCODING")&&pC().supportDualStreamEncoding,i=dN(dN({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():zk(t,i);const s=By(8,"track-low-"),o=new _R(r,dN(dN({},n&&{scaleResolutionDownBy:EL(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return o.on(UT.TRANSCEIVER_UPDATED,(e=>{t._updateRtpTransceiver(e,PT.LOW_STREAM)})),o._hints.push(NT.LOW_STREAM),t.addListener(kT.NEED_CLOSE,(()=>{o.close()})),o}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(t,e,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof Gk){var r,s,o,a;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:l,dtlsTransportState:u,peerConnectionState:d}=this.connection,{local:h,remote:A}=await this.connection.getSelectedCandidatePair();rw.pcStats(this.store.sessionId,{startTime:c,eventElapse:t-c||0,iceconnectionsate:l,dtlsstate:u,connectionstate:d,intSucc:e?1:2,error:i,selectedLocalCandidateProtocol:null!==(r=null==h?void 0:h.protocol)&&void 0!==r?r:"",selectedLocalCandidateType:null!==(s=h.candidateType)&&void 0!==s?s:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(o=A.protocol)&&void 0!==o?o:"",selectedRemoteCandidateType:null!==(a=A.candidateType)&&void 0!==a?a:"",selectedRemoteCandidateAddress:"".concat(A.address,":").concat(A.port),restartCnt:n})}}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(dh(r=this.remoteUserMap).call(r)).find((e=>e._videoSSRC===t));if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const r=this.store.keyMetrics,o=r.subscribe.find((t=>t.userId===s.uid&&"video"===t.type));rw.firstRemoteVideoDecode(this.store.sessionId,$E.FIRST_VIDEO_DECODE,XE.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:cL.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:r.requestAPEnd||0,apStart:r.requestAPStart||0,joinGwEnd:r.joinGatewayEnd||0,joinGwStart:r.joinGatewayStart||0,pcEnd:r.peerConnectionEnd||0,pcStart:r.peerConnectionStart||0,subscriberEnd:(null==o?void 0:o.subscribeEnd)||0,subscriberStart:(null==o?void 0:o.subscribeStart)||0,videoAddNotify:(null==o?void 0:o.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.connection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.connection.getRemoteSSRC(r);return void 0!==s&&s!==n}resetConnection(t){zE.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(t)),this.state===fS.Connected?(zE.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=t===iS.datachannel?new sN({},this.store):this.isPlanB?new Pk({},this.store):new Gk({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((t=>{let[e,{track:n}]=t;e===pS.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,PT.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}reportPCDisconnectedOrFailed(t){this.connection&&this.connection instanceof Gk&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===AS.TCP_RESTART&&t===hS.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,AS.DISCONNECTED_OR_FAILED)))}}function fN(t,e,n){const i=t[e];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const t=this.mutex,n=await t.lock("From P2PChannel.".concat(e));try{for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return await i.apply(this,s)}finally{n()}},n}function mN(t){let e=RN();return function(t,e){let n=t.appId;void 0!==n&&(VN(e,10),NN(e,n));let i=t.cid;void 0!==i&&(VN(e,16),VN(e,i));let r=t.cname;void 0!==r&&(VN(e,26),NN(e,r));let s=t.deviceId;void 0!==s&&(VN(e,34),NN(e,s));let o=t.elapse;void 0!==o&&(VN(e,40),jN(e,o));let a=t.fileSize;void 0!==a&&(VN(e,48),jN(e,TN(a)));let c=t.height;void 0!==c&&(VN(e,56),jN(e,TN(c)));let l=t.jpg;void 0!==l&&(VN(e,66),VN(e,l.length),function(t,e){let n=LN(t,e.length);t.bytes.set(e,n)}(e,l));let u=t.networkType;void 0!==u&&(VN(e,72),jN(e,TN(u)));let d=t.osType;void 0!==d&&(VN(e,80),jN(e,TN(d)));let h=t.requestId;void 0!==h&&(VN(e,90),NN(e,h));let A=t.sdkVersion;void 0!==A&&(VN(e,98),NN(e,A));let p=t.sequence;void 0!==p&&(VN(e,104),jN(e,TN(p)));let f=t.sid;void 0!==f&&(VN(e,114),NN(e,f));let m=t.timestamp;void 0!==m&&(VN(e,120),jN(e,m));let g=t.uid;void 0!==g&&(VN(e,128),VN(e,g));let v=t.vid;void 0!==v&&(VN(e,136),VN(e,v));let y=t.width;void 0!==y&&(VN(e,144),jN(e,TN(y)));let _=t.service;void 0!==_&&(VN(e,152),VN(e,_));let b=t.callbackData;void 0!==b&&(VN(e,162),NN(e,b));let E=t.jpgEncryption;void 0!==E&&(VN(e,168),VN(e,E));let w=t.requestType;void 0!==w&&(VN(e,176),VN(e,w));let S=t.scorePorn;void 0!==S&&(VN(e,185),FN(e,S));let T=t.scoreSexy;void 0!==T&&(VN(e,193),FN(e,T));let C=t.scoreNeutral;void 0!==C&&(VN(e,201),FN(e,C));let R=t.scene;void 0!==R&&(VN(e,208),VN(e,R));let I=t.ossFilePrefix;void 0!==I&&(VN(e,218),NN(e,I));let x=t.serviceVendor;if(void 0!==x)for(let t of x){VN(e,226);let n=RN();yN(t,n),VN(e,n.limit),PN(e,n),IN(n)}}(t,e),function(t){let e=t.bytes,n=t.limit;return e.length===n?e:e.subarray(0,n)}(e)}function gN(t){return function(t){let e={};t:for(;!ON(t);){let n=HN(t);switch(n>>>3){case 0:break t;case 1:e.code=HN(t);break;case 2:e.msg=kN(t,HN(t));break;case 3:{let n=_N(t);e.data=vN(t),t.limit=n;break}default:bN(t,7&n)}}return e}({bytes:e=t,offset:0,limit:e.length});var e}function vN(t){let e={};t:for(;!ON(t);){let n=HN(t);switch(n>>>3){case 0:break t;case 1:e.requestId=kN(t,HN(t));break;case 2:e.requestType=HN(t)>>>0;break;case 3:e.scorePorn=UN(t);break;case 4:e.scoreSexy=UN(t);break;case 5:e.scoreNeutral=UN(t);break;case 6:e.requestScene=HN(t)>>>0;break;case 7:e.scene=HN(t)>>>0;break;default:bN(t,7&n)}}return e}function yN(t,e){let n=t.service;void 0!==n&&(VN(e,8),VN(e,n));let i=t.vendor;void 0!==i&&(VN(e,16),VN(e,i));let r=t.token;void 0!==r&&(VN(e,26),NN(e,r));let s=t.callbackUrl;void 0!==s&&(VN(e,34),NN(e,s))}function _N(t){let e=HN(t),n=t.limit;return t.limit=t.offset+e,n}function bN(t,e){switch(e){case 0:for(;128&DN(t););break;case 2:xN(t,HN(t));break;case 5:xN(t,4);break;case 1:xN(t,8);break;default:throw new Error("Unimplemented type: "+e)}}Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[Object,Boolean]),Dw("design:returntype",ev)],pN.prototype,"startP2PConnection",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[Object,Object,Array,Object,String,String]),Dw("design:returntype",ev)],pN.prototype,"connect",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",void 0)],pN.prototype,"updateRemoteRTPCapabilities",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[Object,Object,Array,Object,String,String]),Dw("design:returntype",ev)],pN.prototype,"preConnect",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],pN.prototype,"publishDataChannel",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],pN.prototype,"unpublish",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],pN.prototype,"unpublishDataChannel",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],pN.prototype,"unpublishLowStream",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[OM,Array]),Dw("design:returntype",ev)],pN.prototype,"subscribeDataChannel",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[OM,String,Number,Number,Array]),Dw("design:returntype",ev)],pN.prototype,"subscribe",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],pN.prototype,"massSubscribe",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[OM,String,Boolean]),Dw("design:returntype",ev)],pN.prototype,"unsubscribe",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[OM,Array]),Dw("design:returntype",ev)],pN.prototype,"unsubscribeDataChannel",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],pN.prototype,"massUnsubscribe",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[OM,String]),Dw("design:returntype",ev)],pN.prototype,"muteRemote",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[OM,String]),Dw("design:returntype",ev)],pN.prototype,"unmuteRemote",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[OM,String]),Dw("design:returntype",ev)],pN.prototype,"hasRemoteMediaWithLock",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],pN.prototype,"disconnectForReconnect",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",ev)],pN.prototype,"updateBitrateLimit",null),Pw([fN,Dw("design:type",Function),Dw("design:paramtypes",[OM,String,Number]),Dw("design:returntype",ev)],pN.prototype,"remoteMediaSsrcChanged",null);let EN=new Float32Array(1);new Uint8Array(EN.buffer);let wN=new Float64Array(1),SN=new Uint8Array(wN.buffer);function TN(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let CN=[];function RN(){const t=CN.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}function IN(t){CN.push(t)}function xN(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function ON(t){return t.offset>=t.limit}function LN(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let e=new Uint8Array(2*s);e.set(n),t.bytes=e}return t.offset=s,s>r&&(t.limit=s),i}function MN(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function kN(t,e){let n=MN(t,e),i=String.fromCharCode,r=t.bytes,s="ï¿½",o="";for(let t=0;t<e;t++){let a,c,l,u,d=r[t+n];0==(128&d)?o+=i(d):192==(224&d)?t+1>=e?o+=s:(a=r[t+n+1],128!=(192&a)?o+=s:(u=(31&d)<<6|63&a,u<128?o+=s:(o+=i(u),t++))):224==(240&d)?t+2>=e?o+=s:(a=r[t+n+1],c=r[t+n+2],32896!=(49344&(a|c<<8))?o+=s:(u=(15&d)<<12|(63&a)<<6|63&c,u<2048||u>=55296&&u<=57343?o+=s:(o+=i(u),t+=2))):240==(248&d)?t+3>=e?o+=s:(a=r[t+n+1],c=r[t+n+2],l=r[t+n+3],8421504!=(12632256&(a|c<<8|l<<16))?o+=s:(u=(7&d)<<18|(63&a)<<12|(63&c)<<6|63&l,u<65536||u>1114111?o+=s:(u-=65536,o+=i(55296+(u>>10),56320+(1023&u)),t+=3))):o+=s}return o}function NN(t,e){let n=e.length,i=0;for(let t=0;t<n;t++){let r=e.charCodeAt(t);r>=55296&&r<=56319&&t+1<n&&(r=(r<<10)+e.charCodeAt(++t)-56613888),i+=r<128?1:r<2048?2:r<65536?3:4}VN(t,i);let r=LN(t,i),s=t.bytes;for(let t=0;t<n;t++){let i=e.charCodeAt(t);i>=55296&&i<=56319&&t+1<n&&(i=(i<<10)+e.charCodeAt(++t)-56613888),i<128?s[r++]=i:(i<2048?s[r++]=i>>6&31|192:(i<65536?s[r++]=i>>12&15|224:(s[r++]=i>>18&7|240,s[r++]=i>>12&63|128),s[r++]=i>>6&63|128),s[r++]=63&i|128)}}function PN(t,e){let n=LN(t,e.limit),i=t.bytes,r=e.bytes;for(let t=0,s=e.limit;t<s;t++)i[t+n]=r[t]}function DN(t){return t.bytes[MN(t,1)]}function BN(t,e){let n=LN(t,1);t.bytes[n]=e}function UN(t){let e=MN(t,8),n=t.bytes;return SN[0]=n[e++],SN[1]=n[e++],SN[2]=n[e++],SN[3]=n[e++],SN[4]=n[e++],SN[5]=n[e++],SN[6]=n[e++],SN[7]=n[e++],wN[0]}function FN(t,e){let n=LN(t,8),i=t.bytes;wN[0]=e,i[n++]=SN[0],i[n++]=SN[1],i[n++]=SN[2],i[n++]=SN[3],i[n++]=SN[4],i[n++]=SN[5],i[n++]=SN[6],i[n++]=SN[7]}function HN(t){let e,n=0,i=0;do{e=DN(t),n<32&&(i|=(127&e)<<n),n+=7}while(128&e);return i}function VN(t,e){for(e>>>=0;e>=128;)BN(t,127&e|128),e>>>=7;BN(t,e)}function jN(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=0===r?0===i?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,o=LN(t,s),a=t.bytes;switch(s){case 10:a[o+9]=r>>>7&1;case 9:a[o+8]=9!==s?128|r:127&r;case 8:a[o+7]=8!==s?i>>>21|128:i>>>21&127;case 7:a[o+6]=7!==s?i>>>14|128:i>>>14&127;case 6:a[o+5]=6!==s?i>>>7|128:i>>>7&127;case 5:a[o+4]=5!==s?128|i:127&i;case 4:a[o+3]=4!==s?n>>>21|128:n>>>21&127;case 3:a[o+2]=3!==s?n>>>14|128:n>>>14&127;case 2:a[o+1]=2!==s?n>>>7|128:n>>>7&127;case 1:a[o]=1!==s?128|n:127&n}}function GN(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}const QN=new Map([["moderation",1],["supervise",2]]);class zN extends ny{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const e=this._connectionState;this._connectionState=t,this.emit(_S.CONNECTION_STATE_CHANGE,e,t)}get inspectType(){return this._inspectType}set inspectType(t){var e;this._inspectMode=c_(e=t.map((t=>QN.get(t)||0))).call(e,((t,e)=>t+e)),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(t){super(),ih(this,"name","AgoraRTCVideoContentInspect"),ih(this,"_connectionState",vS.CONNECTING),ih(this,"_innerConnectionState",void 0),ih(this,"sequence",0),ih(this,"inspectStartTime",void 0),ih(this,"workerManagerConnection",void 0),ih(this,"workerConnection",void 0),ih(this,"workerMessageLengthLimit",void 0),ih(this,"inspectIntervalMinimum",void 0),ih(this,"qualityRatio",void 0),ih(this,"_connectInfo",void 0),ih(this,"_cancelTokenSource",fE.CancelToken.source()),ih(this,"_retryConfig",void 0),ih(this,"wmSequence",0),ih(this,"inspectInterval",void 0),ih(this,"inspectTimer",null),ih(this,"ossFilePrefix",void 0),ih(this,"extraInfo",void 0),ih(this,"_inspectType",void 0),ih(this,"_inspectMode",void 0),ih(this,"_quality",1),ih(this,"qualityTimer",null),ih(this,"_inspectId",void 0),ih(this,"_needWorkUrlOnly",!1),ih(this,"inspectImage",(()=>{if(this.connectionState!==vS.CONNECTED)throw new Bw(Bv.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===vS.CONNECTED?this.requestToInspectImage():zE.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=By(5,"inspect-"),this.workerMessageLengthLimit=NE("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=NE("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=NE("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new $S("worker-manager-"+this._inspectId,qy),this.on(_S.STATE_CHANGE,((t,e)=>{this._innerConnectionState=t,zE.debug("[".concat(this._inspectId,"] Inspect operation :").concat(yS[t]," ").concat(e||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new $S("worker-"+this._inspectId,qy),this.handleWorkerEvents()}async init(t,e){this.emit(_S.STATE_CHANGE,yS.CONNECT_AP),this._connectInfo=t;const n=this._cancelTokenSource.token;return this._retryConfig=e,new ev(((i,r)=>{this.on(_S.CONNECTION_STATE_CHANGE,((t,e)=>{e===vS.CONNECTED&&i()})),this.requestAP(t,n,e).then((t=>{this.connectWorkerManager(t)})).catch((t=>{r(t)}))}))}async requestAP(t,e,n){const i=NE("WEBCS_DOMAIN").map((t=>"https://".concat(t,"/api/v1"))),r=await function(t,e,n,i){let{appId:r,areaCode:s,cname:o,sid:a,token:c,uid:l}=e;oM++;const u="image_moderation_api",d={service_name:u,json_body:JSON.stringify({appId:r,areaCode:s,cname:o,command:"allocateEdge",requestId:oM,seq:oM,sid:a,token:c,ts:Date.now(),uid:l+""})};let h,A,p=t[0];return $y((async()=>{h=Date.now();const t=await UL(p,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(A=Date.now()-h,0!==t.code){const e=new Bw(Bv.UNEXPECTED_RESPONSE,"image inspect ap error, code"+t.code,{retry:!0,responseTime:A});throw zE.error(e.toString()),e}const e=JSON.parse(t.json_body);if(200!==e.code){const t=new Bw(Bv.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(e.code,", reason: ").concat(e.reason),{code:e.code,responseTime:A});throw zE.error(t.toString()),t}if(!e.servers||!Array.isArray(e.servers)||0===e.servers.length){const t=new Bw(Bv.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:e.code,responseTime:A});throw zE.error(t.toString()),t}const i=NE("VIDEO_INSPECT_WORKER_MANAGER_HOST"),r=NE("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:e.servers.map((t=>{let{address:e,wss:n}=t;if(e&&n)return"wss://".concat(e.replace(/\./g,"-"),".").concat(i,":").concat(r||n)})).filter((t=>!!t)),workerToken:e.workerToken,vid:e.vid,responseTime:A}}),((e,n)=>(rw.apworkerEvent(a,{success:!0,sc:200,serviceName:u,responseDetail:JSON.stringify(e.addressList),firstSuccess:0===n,responseTime:A,serverIp:t[n%t.length]}),!1)),((e,n)=>(rw.apworkerEvent(a,{success:!1,sc:e.data&&e.data.code||200,serviceName:u,responseTime:A,serverIp:t[n%t.length]}),!!(e.code!==Bv.OPERATION_ABORTED&&e.code!==Bv.UNEXPECTED_RESPONSE||e.data&&e.data.retry)&&(p=t[(n+1)%t.length],!0))),i)}(i,t,e,n);this.emit(_S.STATE_CHANGE,yS.AP_CONNECTED);const{addressList:s}=r;return this.wmSequence++,s}async connectWorkerManager(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=e,this.emit(_S.STATE_CHANGE,yS.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Sw.CONNECTED,(async()=>{this.emit(_S.STATE_CHANGE,yS.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.19.3",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(Sw.CLOSED,(()=>{this._innerConnectionState<yS.GET_WORKER_MANAGER_RESPONSE&&zE.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(Sw.FAILED,(()=>{this._innerConnectionState<yS.GET_WORKER_MANAGER_RESPONSE&&zE.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(Sw.RECONNECTING,(()=>{this._innerConnectionState<yS.GET_WORKER_MANAGER_RESPONSE&&zE.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(Sw.ON_MESSAGE,(async t=>{this.emit(_S.STATE_CHANGE,yS.GET_WORKER_MANAGER_RESPONSE);const e=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(t.data);if(200!==n.code)throw zE.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new Bw(Bv.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&e))throw zE.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new Bw(Bv.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const t=NE("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,i=e.replace(/:\d+\/?$/,":".concat(t));this.emit(_S.STATE_CHANGE,yS.CONNECT_WORKER,i),this._needWorkUrlOnly?this.emit(_S.REQUEST_NEW_WORKER_URL,i):await this.connectWorker(i)}})),this.workerManagerConnection.on(Sw.WILL_RECONNECT,((t,e,n)=>{n(t)})),this.workerManagerConnection.on(Sw.REQUEST_NEW_URLS,((t,e)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(e)}))}handleWorkerEvents(){this.workerConnection.on(Sw.CONNECTED,(async()=>{this.emit(_S.STATE_CHANGE,yS.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=vS.CONNECTED})),this.workerConnection.on(Sw.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const n=gN(new Uint8Array(t.data));if(NE("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&zE.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(_S.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var e;const t={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},i=c_(e=Object.keys(t)).call(e,((e,n)=>t[e]>t[n]?e:n),"porn"),r=Object.keys(t).find((t=>t===i));this.emit(_S.INSPECT_RESULT,r)}else this.emit(_S.INSPECT_RESULT,void 0,new Bw(Bv.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(_S.INSPECT_RESULT,void 0,new Bw(Bv.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else zE.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(_S.INSPECT_RESULT,void 0,new Bw(Bv.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(Sw.CLOSED,(()=>{this.connectionState=vS.CLOSED})),this.workerConnection.on(Sw.FAILED,(()=>{this.connectionState=vS.CLOSED})),this.workerConnection.on(Sw.RECONNECTING,(()=>{this.connectionState=this.connectionState===vS.CONNECTED?vS.RECONNECTING:vS.CONNECTING})),this.workerConnection.on(Sw.WILL_RECONNECT,((t,e,n)=>{"recover"===t&&n(t),n("tryNext")})),this.workerConnection.on(Sw.REQUEST_NEW_URLS,((t,e)=>{this.workerManagerConnection.close(),this.once(_S.REQUEST_NEW_WORKER_URL,(e=>{t([e])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((t=>{this.connectWorkerManager(t,!0)})).catch((t=>{e(t)}))}))}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=yy(this,_S.CLIENT_LOCAL_VIDEO_TRACK),e={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(_S.INSPECT_RESULT,void 0,new Bw(Bv.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(t,e);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(_S.INSPECT_RESULT,void 0,new Bw(Bv.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,e){let{appId:n,cname:i,cid:r,vid:s,sid:o,uid:a}=e;const c=Date.now(),l=await t.getCurrentFrameImage("image/jpeg",this.quality),u=await gR(l,n,i),d=this.sequence+"-"+r+"-"+a+"-"+c+"-"+By(12,""),h={appId:n,cid:r,cname:i,deviceId:"",elapse:zN.intToLong(Number(c-this.inspectStartTime)),fileSize:u.byteLength,jpgEncryption:2,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:d,sdkVersion:"4.19.3",sequence:this.sequence,sid:o,timestamp:zN.intToLong(c),uid:a,vid:s,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const A=mN(h);if(A.byteLength<this.workerMessageLengthLimit){if(NE("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const t=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?GN(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):GN(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},h);delete t.jpg,zE.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(t))}return A}{const e=this.quality*this.qualityRatio;return this.quality=e,await this.generateRequestData(t,{appId:n,cname:i,cid:r,vid:s,sid:o,uid:a})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=fE.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=vS.CLOSED,this.emit(_S.STATE_CHANGE,yS.CLOSED)}}function WN(t){let e=function(){const t=$N.pop();return t?(t.offset=t.limit=0,t):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(t,e){let n=t.appId;void 0!==n&&(aP(e,10),iP(e,n));let i=t.cid;void 0!==i&&(aP(e,16),aP(e,i));let r=t.cname;void 0!==r&&(aP(e,26),iP(e,r));let s=t.deviceId;void 0!==s&&(aP(e,34),iP(e,s));let o=t.elapse;void 0!==o&&(aP(e,40),lP(e,o));let a=t.fileSize;void 0!==a&&(aP(e,48),lP(e,YN(a)));let c=t.height;void 0!==c&&(aP(e,56),lP(e,YN(c)));let l=t.jpg;void 0!==l&&(aP(e,66),aP(e,l.length),eP(e,l));let u=t.networkType;void 0!==u&&(aP(e,72),lP(e,YN(u)));let d=t.osType;void 0!==d&&(aP(e,80),lP(e,YN(d)));let h=t.requestId;void 0!==h&&(aP(e,90),iP(e,h));let A=t.sdkVersion;void 0!==A&&(aP(e,98),iP(e,A));let p=t.sequence;void 0!==p&&(aP(e,104),lP(e,YN(p)));let f=t.sid;void 0!==f&&(aP(e,114),iP(e,f));let m=t.timestamp;void 0!==m&&(aP(e,120),lP(e,m));let g=t.uid;void 0!==g&&(aP(e,128),aP(e,g));let v=t.vid;void 0!==v&&(aP(e,136),aP(e,v));let y=t.width;void 0!==y&&(aP(e,144),lP(e,YN(y)));let _=t.service;void 0!==_&&(aP(e,152),aP(e,_));let b=t.callbackData;void 0!==b&&(aP(e,162),aP(e,b.length),eP(e,b));let E=t.ticket;void 0!==E&&(aP(e,170),iP(e,E))}(t,e),function(t){let e=t.bytes,n=t.limit;return e.length===n?e:e.subarray(0,n)}(e)}function KN(t){return function(t){let e={};t:for(;!JN(t);){let n=oP(t);switch(n>>>3){case 0:break t;case 1:e.code=oP(t);break;case 2:e.msg=nP(t,oP(t));break;case 3:e.requestId=nP(t,oP(t));break;case 4:e.timestamp=cP(t,!1);break;default:qN(t,7&n)}}return e}({bytes:e=t,offset:0,limit:e.length});var e}function qN(t,e){switch(e){case 0:for(;128&rP(t););break;case 2:XN(t,oP(t));break;case 5:XN(t,4);break;case 1:XN(t,8);break;default:throw new Error("Unimplemented type: "+e)}}function YN(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}let $N=[];function XN(t,e){if(t.offset+e>t.limit)throw new Error("Skip past limit");t.offset+=e}function JN(t){return t.offset>=t.limit}function ZN(t,e){let n=t.bytes,i=t.offset,r=t.limit,s=i+e;if(s>n.length){let e=new Uint8Array(2*s);e.set(n),t.bytes=e}return t.offset=s,s>r&&(t.limit=s),i}function tP(t,e){let n=t.offset;if(n+e>t.limit)throw new Error("Read past limit");return t.offset+=e,n}function eP(t,e){let n=ZN(t,e.length);t.bytes.set(e,n)}function nP(t,e){let n=tP(t,e),i=String.fromCharCode,r=t.bytes,s="ï¿½",o="";for(let t=0;t<e;t++){let a,c,l,u,d=r[t+n];0==(128&d)?o+=i(d):192==(224&d)?t+1>=e?o+=s:(a=r[t+n+1],128!=(192&a)?o+=s:(u=(31&d)<<6|63&a,u<128?o+=s:(o+=i(u),t++))):224==(240&d)?t+2>=e?o+=s:(a=r[t+n+1],c=r[t+n+2],32896!=(49344&(a|c<<8))?o+=s:(u=(15&d)<<12|(63&a)<<6|63&c,u<2048||u>=55296&&u<=57343?o+=s:(o+=i(u),t+=2))):240==(248&d)?t+3>=e?o+=s:(a=r[t+n+1],c=r[t+n+2],l=r[t+n+3],8421504!=(12632256&(a|c<<8|l<<16))?o+=s:(u=(7&d)<<18|(63&a)<<12|(63&c)<<6|63&l,u<65536||u>1114111?o+=s:(u-=65536,o+=i(55296+(u>>10),56320+(1023&u)),t+=3))):o+=s}return o}function iP(t,e){let n=e.length,i=0;for(let t=0;t<n;t++){let r=e.charCodeAt(t);r>=55296&&r<=56319&&t+1<n&&(r=(r<<10)+e.charCodeAt(++t)-56613888),i+=r<128?1:r<2048?2:r<65536?3:4}aP(t,i);let r=ZN(t,i),s=t.bytes;for(let t=0;t<n;t++){let i=e.charCodeAt(t);i>=55296&&i<=56319&&t+1<n&&(i=(i<<10)+e.charCodeAt(++t)-56613888),i<128?s[r++]=i:(i<2048?s[r++]=i>>6&31|192:(i<65536?s[r++]=i>>12&15|224:(s[r++]=i>>18&7|240,s[r++]=i>>12&63|128),s[r++]=i>>6&63|128),s[r++]=63&i|128)}}function rP(t){return t.bytes[tP(t,1)]}function sP(t,e){let n=ZN(t,1);t.bytes[n]=e}function oP(t){let e,n=0,i=0;do{e=rP(t),n<32&&(i|=(127&e)<<n),n+=7}while(128&e);return i}function aP(t,e){for(e>>>=0;e>=128;)sP(t,127&e|128),e>>>=7;sP(t,e)}function cP(t,e){let n,i=0,r=0,s=0;return n=rP(t),i=127&n,128&n&&(n=rP(t),i|=(127&n)<<7,128&n&&(n=rP(t),i|=(127&n)<<14,128&n&&(n=rP(t),i|=(127&n)<<21,128&n&&(n=rP(t),r=127&n,128&n&&(n=rP(t),r|=(127&n)<<7,128&n&&(n=rP(t),r|=(127&n)<<14,128&n&&(n=rP(t),r|=(127&n)<<21,128&n&&(n=rP(t),s=127&n,128&n&&(n=rP(t),s|=(127&n)<<7))))))))),{low:i|r<<28,high:r>>>4|s<<24,unsigned:e}}function lP(t,e){let n=e.low>>>0,i=(e.low>>>28|e.high<<4)>>>0,r=e.high>>>24,s=0===r?0===i?n<16384?n<128?1:2:n<1<<21?3:4:i<16384?i<128?5:6:i<1<<21?7:8:r<128?9:10,o=ZN(t,s),a=t.bytes;switch(s){case 10:a[o+9]=r>>>7&1;case 9:a[o+8]=9!==s?128|r:127&r;case 8:a[o+7]=8!==s?i>>>21|128:i>>>21&127;case 7:a[o+6]=7!==s?i>>>14|128:i>>>14&127;case 6:a[o+5]=6!==s?i>>>7|128:i>>>7&127;case 5:a[o+4]=5!==s?128|i:127&i;case 4:a[o+3]=4!==s?n>>>21|128:n>>>21&127;case 3:a[o+2]=3!==s?n>>>14|128:n>>>14&127;case 2:a[o+1]=2!==s?n>>>7|128:n>>>7&127;case 1:a[o]=1!==s?128|n:127&n}}const uP={},dP={},hP=4294967296,AP=hP*hP,pP=AP/2,fP=_P(0,!0),mP=_P(0),gP=bP(0,-2147483648,!1),vP=bP(-1,2147483647,!1),yP=bP(-1,-1,!0);function _P(t,e){let n,i,r;return e?(r=0<=(t>>>=0)&&t<256)&&(i=dP[t],i)?i:(n=bP(t,0,!0),r&&(dP[t]=n),n):(r=-128<=(t|=0)&&t<128)&&(i=uP[t],i)?i:(n=bP(t,t<0?-1:0,!1),r&&(uP[t]=n),n)}function bP(t,e,n){return{low:0|t,high:0|e,unsigned:!!n}}function EP(t,e){if(isNaN(t))return e?fP:mP;if(e){if(t<0)return fP;if(t>=AP)return yP}else{if(t<=-pP)return gP;if(t+1>=pP)return vP}return t<0?e?fP:mP:bP(t%hP|0,t/hP|0,e)}function wP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}class SP extends ny{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const e=this._connectionState;this._connectionState=t,this.emit(CS.CONNECTION_STATE_CHANGE,t,e)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(t){var e;super(),ih(this,"name","AgoraRTCImageModeration"),ih(this,"_connectionState",TS.CONNECTING),ih(this,"_sequence",0),ih(this,"_moderationStartTime",void 0),ih(this,"_workerConnection",void 0),ih(this,"_workerMessageLengthLimit",void 0),ih(this,"_qualityRatio",void 0),ih(this,"_connectInfo",void 0),ih(this,"_cancelTokenSource",fE.CancelToken.source()),ih(this,"_retryConfig",void 0),ih(this,"_moderationInterval",void 0),ih(this,"_moderationTimer",null),ih(this,"_moderationMode",1),ih(this,"_quality",1),ih(this,"_qualityTimer",null),ih(this,"_ticket",void 0),ih(this,"_moderationIntervalMinimum",void 0),ih(this,"_uploadFailedNum",0),ih(this,"_uploadNum",0),ih(this,"_uploadTimer",null),ih(this,"_moderationId",void 0),ih(this,"inspectImage",(()=>{if(this.connectionState!==TS.CONNECTED)throw new Bw(Bv.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===TS.CONNECTED?this.requestToInspectImage():zE.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=By(5,"image-moderation-"),this._workerMessageLengthLimit=NE("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=NE("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(e=t.interval)&&void 0!==e?e:1e3,this._qualityRatio=NE("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new $S("worker-"+this._moderationId,qy),this.on(CS.STATE_CHANGE,((t,e)=>{zE.debug("[".concat(this._moderationId,"] Moderation operation :").concat(RS[t]," ").concat(e||""))})),this.handleWorkerEvents()}async init(t,e){this.emit(CS.STATE_CHANGE,RS.CONNECT_AP),this._connectInfo=t;const n=this._cancelTokenSource.token;return this._retryConfig=e,new ev(((i,r)=>{this.on(CS.CONNECTION_STATE_CHANGE,((t,e)=>{t===TS.CONNECTED&&i()})),this.requestAP(t,n,e).then((t=>{this.connectWorker(t)})).catch((t=>{r(t)}))}))}updateConfig(t){var e;this._moderationInterval=null!==(e=t.interval)&&void 0!==e?e:1e3,zE.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===TS.CONNECTED&&this.inspectImage()}async requestAP(t,e,n){const i=NE("WEBCS_DOMAIN").map((t=>"https://".concat(t,"/api/v1"))),r=await function(t,e,n,i){let{appId:r,areaCode:s,cname:o,sid:a,token:c,uid:l}=e;oM++;const u="moderation_plugin",d={service_name:u,json_body:JSON.stringify({appId:r,areaCode:s,cname:o,command:"allocateEdge",requestId:oM,seq:oM,sid:a,appToken:c,ts:Date.now(),uid:l+""})};let h,A,p=t[0];return $y((async()=>{h=Date.now();const t=await UL(p,{data:d,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(A=Date.now()-h,0!==t.code){const e=new Bw(Bv.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+t.code,{retry:!0,responseTime:A});throw zE.error(e.toString()),e}const e=JSON.parse(t.json_body);if(200!==e.code){const t=new Bw(Bv.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(e.code,", reason: ").concat(e.reason),{code:e.code,responseTime:A});throw zE.error(t.toString()),t}if(!e.servers||!Array.isArray(e.servers)||0===e.servers.length){const t=new Bw(Bv.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:e.code,responseTime:A});throw zE.error(t.toString()),t}if(!e.servers.some((t=>!!t.wss))){const t=new Bw(Bv.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:e.code,responseTime:A});throw zE.error(t.toString()),t}const i=NE("IMAGE_MODERATION_WORKER_HOST");return{addressList:e.servers.map((t=>{let{address:e,wss:n}=t;if(e&&n)return"wss://".concat(e.replace(/\./g,"-"),".").concat(i,":").concat(n,"/moderation")})).filter((t=>!!t)),workerToken:e.workerToken,vid:e.vid,ticket:e.appTicket,responseTime:A}}),((e,n)=>(rw.apworkerEvent(a,{success:!0,sc:200,serviceName:u,responseDetail:JSON.stringify(e.addressList),firstSuccess:0===n,responseTime:A,serverIp:t[n%t.length]}),!1)),((e,n)=>(rw.apworkerEvent(a,{success:!1,sc:e.data&&e.data.code||200,serviceName:u,responseTime:A,serverIp:t[n%t.length]}),!!(e.code!==Bv.OPERATION_ABORTED&&e.code!==Bv.UNEXPECTED_RESPONSE||e.data&&e.data.retry)&&(p=t[(n+1)%t.length],!0))),i)}(i,t,e,n);this.emit(CS.STATE_CHANGE,RS.AP_CONNECTED);const{addressList:s,ticket:o}=r;return this._ticket=o,s}async connectWorker(t){this.emit(CS.STATE_CHANGE,RS.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Sw.CONNECTED,(async()=>{this.emit(CS.STATE_CHANGE,RS.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=TS.CONNECTED})),this._workerConnection.on(Sw.CLOSED,(()=>{this.connectionState=TS.CLOSED})),this._workerConnection.on(Sw.FAILED,(()=>{this.connectionState=TS.CLOSED})),this._workerConnection.on(Sw.RECONNECTING,(()=>{this.connectionState=this.connectionState===TS.CONNECTED?TS.RECONNECTING:TS.CONNECTING})),this._workerConnection.on(Sw.ON_MESSAGE,(async t=>{if(t.data instanceof ArrayBuffer){const e=KN(new Uint8Array(t.data));NE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&zE.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(e)),this._uploadNum++,void 0===e.code||0===e.code||(this._uploadFailedNum++,zE.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(e.code,", msg is ").concat(e.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{rw.reportApiInvoke(this._connectInfo.sid||null,{name:sy.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,e.code],tag:oy.TRACER}).onError(new Bw(Bv.IMAGE_MODERATION_UPLOAD_FAILED,e.msg)),this._uploadTimer=null}),NE("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else zE.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(Sw.WILL_RECONNECT,((t,e,n)=>{"recover"===t&&n(t),n("tryNext")})),this._workerConnection.on(Sw.REQUEST_NEW_URLS,((t,e)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(e)}))}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=yy(this,CS.CLIENT_LOCAL_VIDEO_TRACK),e={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(NE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&zE.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(t,e);this._workerConnection.sendMessage(n,!0,!0)}else NE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&zE.debug("Only the track being published can be inspected")}async generateRequestData(t,e){let{appId:n,cname:i,cid:r,vid:s,sid:o,uid:a}=e;const c=Date.now(),l=await t.getCurrentFrameImage("image/jpeg",this.quality),u=await gR(l,n,i),d=this._sequence+"-"+r+"-"+a+"-"+c+"-"+By(12,""),h={appId:n,cid:r,cname:i,deviceId:"",elapse:SP.intToLong(Number(c-this._moderationStartTime)),fileSize:l.buffer.byteLength,height:l.height,width:l.width,jpg:u,networkType:6,osType:7,requestId:d,sdkVersion:"4.19.3",sequence:this._sequence,sid:o,timestamp:EP(c),uid:a,vid:s,service:this._moderationMode,ticket:this._ticket},A=WN(h);if(A.byteLength<this._workerMessageLengthLimit){if(NE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const t=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?wP(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):wP(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},h);delete t.jpg,zE.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(t))}return A}{const e=this.quality*this._qualityRatio;return this.quality=e,await this.generateRequestData(t,{appId:n,cname:i,cid:r,vid:s,sid:o,uid:a})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=fE.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=TS.CLOSED,this.emit(CS.STATE_CHANGE,RS.CLOSED)}}function TP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function CP(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?TP(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):TP(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}class RP extends LS{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,e;return null!==(t=null===(e=this.peerConnection.getReceivers()[0])||void 0===e||null===(e=e.transport)||void 0===e?void 0:e.state)&&void 0!==t?t:null}constructor(t,e,n){super(t,e),ih(this,"direction",void 0),ih(this,"store",void 0),ih(this,"peerConnection",void 0),ih(this,"transportEventReceiver",void 0),ih(this,"statsFilter",void 0),ih(this,"localCandidateCount",0),ih(this,"allCandidatesReceived",!1),ih(this,"mutex",new Wy("P2PConnection-mutex")),ih(this,"dataChannel",void 0),ih(this,"onLocalCandidate",void 0),this.store=e,this.peerConnection=new RTCPeerConnection(RP.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.direction=null!=n?n:ww.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=Mk(this.peerConnection,NE("STATS_UPDATE_INTERVAL"),void 0,bv()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(t){try{if(t){await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const e=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(e),!e.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return e.sdp}{const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return await this.peerConnection.setLocalDescription(t),t.sdp}}catch(t){throw new Uv(Bv.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t){try{await this.peerConnection.setRemoteDescription({type:"answer",sdp:t})}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(t.toString()))}}async addRemoteCandidate(t){try{await this.peerConnection.addIceCandidate(t)}catch(t){throw new Uv(Bv.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(t.toString()))}}async send(t){try{const e=[];t.forEach((t=>{const n=this.peerConnection.addTransceiver(t._mediaStreamTrack,{direction:"sendonly"});e.push(n)})),bv()&&!0===NE("SIMULCAST")&&await this.applySimulcastForFirefox(e,t),await this.applySimulcastEncodings(e,t),await this.applySendEncodings(e,t);const n=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(n),!n.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const i=e.map((t=>{const e=this.getLocalSSRC(t.mid,n.sdp);if(!e)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:t.mid,localSSRC:[{ssrcId:e}]}}));return{sdp:n.sdp,trackMessage:i}}catch(t){throw t instanceof Uv?t:new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(t.toString()))}}async stopSending(t,e){const n=e?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{const e=this.peerConnection.getTransceivers().filter((e=>-1!==t.indexOf(e.mid)));if(e.length!==t.length)throw new Error("Transceivers' length (".concat(e.length,") doesn't match mids' length (").concat(t.length,") when trying to call P2PConnection.stopSending."));e.map((t=>{var e;t.direction="inactive",null===(e=t.stop)||void 0===e||e.call(t),this.peerConnection.removeTrack(t.sender)}));const i=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(i),!i.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return i.sdp}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(t.toString()))}finally{n&&n()}}async receive(t,e,n){try{await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");await this.peerConnection.setLocalDescription(i),zE.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."));const r=this.getRemoteMid(n,e);if(void 0===r)throw new Error("Cannot get transceiver mid when trying to receive track.");const s=this.peerConnection.getTransceivers().find((t=>t.mid===r));if(!s||null===s.mid)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,mid:s.mid,sdp:i.sdp}}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(t.toString()))}}async setDescription(t,e){try{if("remote"===t){await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const n=await this.peerConnection.createAnswer();if(!n.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return await this.peerConnection.setLocalDescription(n),zE.debug("[".concat(this.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(t)),n.sdp}await this.peerConnection.setRemoteDescription({type:"answer",sdp:e})}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(t.toString()))}}async stopReceiving(t,e){try{const n=this.peerConnection.getTransceivers().filter((e=>-1!==t.indexOf(e.mid)));if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map((t=>{var e;t.direction="inactive",null===(e=t.stop)||void 0===e||e.call(t)})),await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const i=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(i),!i.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return i.sdp}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}async restartICE(){try{const t=await this.peerConnection.createOffer({iceRestart:!0});if(!t.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return this.store.descriptionStart(),await this.peerConnection.setLocalDescription(t),t.sdp}catch(t){throw new Uv(Bv.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(t.toString()))}}close(){var t;this.peerConnection.close(),null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,e){}async updateSendParameters(t,e){const n=this.peerConnection.getTransceivers().filter((e=>e.mid===t));1===n.length&&(this.isVP8Simulcast(e)?bv()||await this.applySimulcastEncodings(n,[e]):await this.applySendEncodings(n,[e]))}setStatsRemoteVideoIsReady(t,e){this.statsFilter.setVideoIsReady2(t,e)}async replaceTrack(t,e){const n=this.peerConnection.getTransceivers().find((t=>t.mid===e));n&&await n.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const e=t[0].transport.iceTransport,{local:n,remote:i}=e.getSelectedCandidatePair();return{local:CP(CP({},mk),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:CP(CP({},mk),{},{candidateType:i.type,protocol:i.protocol,address:i.address,port:i.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;null===(t=this.onICEConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;null===(t=this.onConnectionStateChange)||void 0===t||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{var e;t.candidate&&(null===(e=this.onLocalCandidate)||void 0===e||e.call(this,t.candidate)),t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,zE.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,zE.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),NE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const e={iceServers:[]};return t.iceServers?e.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(py(t.turnServer.servers)?e.iceServers=t.turnServer.servers:(e.iceServers&&e.iceServers.push(...RP.turnServerConfigToIceServers(t.turnServer.servers)),NE("USE_TURN_SERVER_OF_GATEWAY")&&e.iceServers&&t.turnServer.serversFromGateway&&e.iceServers.push(...RP.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),NE("FORCE_TURN_TCP")?e.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((t=>{t.forceturn&&(e.iceTransportPolicy="relay")})))),NE("ENABLE_ENCODED_TRANSFORM")&&pC().supportWebRTCEncodedTransform&&(e.encodedInsertableStreams=!0),e}static turnServerConfigToIceServers(t){const e=[];return t.forEach((t=>{t.tcpport&&(e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turns:".concat(pL(t.turnServerURL),":").concat(t.tcpport,"?transport=tcp")}),e.push({username:t.username,credential:t.password,credentialType:"password",urls:"turn:".concat(t.turnServerURL,":").concat(t.tcpport,"?transport=udp")}),e.push({username:t.username,credential:t.password,credentialType:"password",urls:"stun:".concat(t.turnServerURL,":").concat(t.tcpport)}))})),e}tryBindTransportEvents(t){const e=t.transport;if(e){this.transportEventReceiver=t,e.onstatechange=()=>{var t;null!=e&&e.state&&(null===(t=this.onDTLSTransportStateChange)||void 0===t||t.call(this,e.state))},e.onerror=t=>{var e;null===(e=this.onDTLSTransportError)||void 0===e||e.call(this,"error"in t?t.error:t)};const n=e.iceTransport;n&&(n.onstatechange=()=>{const t=null==e?void 0:e.iceTransport.state;var n;t&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,t))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:t,remote:e}=n.getSelectedCandidatePair();zE.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol}),", remote ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol,address:e.address,port:e.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(t,e){var n;if(e||(e=this.peerConnection.getSenders().find((e=>e.track===t._mediaStreamTrack))),!e)return zE.warn("[".concat(t.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(t))return zE.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!pC().supportSetRtpSenderParameters)return zE.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const i={},r={};switch(t._optimizationMode){case"motion":i.degradationPreference="maintain-framerate";break;case"detail":i.degradationPreference="maintain-resolution";break;default:i.degradationPreference="balanced"}if(t._encoderConfig){var s;const{bitrateMax:e,frameRate:n,scaleResolutionDownBy:i}=t._encoderConfig;e&&(r.maxBitrate=1e3*e),kr(s=t._hints).call(s,NT.LOW_STREAM)&&(n&&(r.maxFramerate=mL(n)),i&&i>=1&&(r.scaleResolutionDownBy=i))}if(NE("DSCP_TYPE")&&Nv()){var o;const t=NE("DSCP_TYPE");kr(o=["very-low","low","medium","high"]).call(o,t)&&(r.networkPriority=t)}const a=e.getParameters(),c=null===(n=a.encodings)||void 0===n?void 0:n[0];bv()&&!c&&(i.encodings=[r]),c&&Object.assign(c,r),Object.assign(a,i),zE.debug("[".concat(t.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(a.encodings))),await e.setParameters(a)}async applySendEncodings(t,e){try{if(!pC().supportSetRtpSenderParameters)return;if(t.length!==e.length)return;for(let n=0;n<t.length;n++){const i=t[n],r=e[n];r instanceof _R&&!this.isVP8Simulcast(r)&&await this.updateRtpSenderEncodings(r,i.sender)}}catch(t){zE.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,e,n){const i=zM.parse(t);return e.forEach(((t,e)=>{const r=n[e],s=i.mediaDescriptions.find((t=>t.attributes.mid===r));s&&(ZM(s,t),rk(s,t,this.store.codec))})),zM.print(i)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var e;null===(e=this.onFirstAudioReceived)||void 0===e||e.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var e;null===(e=this.onFirstVideoReceived)||void 0===e||e.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var e;null===(e=this.onFirstAudioDecoded)||void 0===e||e.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,e,n)=>{var i;null===(i=this.onFirstVideoDecoded)||void 0===i||i.call(this,t,e,n)},this.statsFilter.onSelectedLocalCandidateChanged=(t,e)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,t,e)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,e)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,t,e)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var e;null===(e=this.onFirstVideoDecodedTimeout)||void 0===e||e.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,e){if(t.length===e.length)for(let a=0;a<t.length;a++){var n,i,r,s,o;const c=t[a],l=e[a];if(l instanceof _R&&!kr(n=l._hints).call(n,NT.LOW_STREAM)&&null!==(i=l._encoderConfig)&&void 0!==i&&i.bitrateMax&&(null===(r=l._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(s=l._scalabilityMode)&&void 0!==s&&s.numSpatialLayers&&(null===(o=l._scalabilityMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){const t={},e={high:1e3*(l._encoderConfig.bitrateMax-50),medium:5e4};t.encodings=[{rid:"m",active:!0,maxBitrate:e.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:e.high}];const n=c.sender.getParameters();await c.sender.setParameters(Object.assign(n,t))}}}async applySimulcastEncodings(t,e){if(!bv()&&t.length===e.length)for(let n=0;n<t.length;n++){const i=e[n];if(i instanceof _R&&this.isVP8Simulcast(i)){const e=t[n],r={},s={high:1e3*(i._encoderConfig.bitrateMax-50),medium:5e4};r.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:s.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:s.medium,scaleResolutionDownBy:4}];const o=e.sender.getParameters();await e.sender.setParameters(Object.assign(o,r))}}}isVP8Simulcast(t){var e,n,i,r,s;return!!(t instanceof _R&&NE("SIMULCAST")&&"vp8"===this.store.codec&&!kr(e=t._hints).call(e,NT.LOW_STREAM)&&null!==(n=t._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(i=t._encoderConfig)||void 0===i?void 0:i.bitrateMax)>200&&null!==(r=t._scalabilityMode)&&void 0!==r&&r.numSpatialLayers&&(null===(s=t._scalabilityMode)||void 0===s?void 0:s.numSpatialLayers)>1)}logSDPExchange(t,e,n,i){if(NE("SDP_LOGGING"))return zE.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(e," SDP during P2PConnection.").concat(i,"\n"),t),"offer"===e?t=>{this.logSDPExchange(t,"answer","local"===n?"remote":"local",i)}:void 0}getLocalSSRC(t,e){var n,i;if(e=null!==(n=e)&&void 0!==n?n:null===(i=this.currentLocalDescription)||void 0===i?void 0:i.sdp){var r;const n=null===(r=zM.parse(e).mediaDescriptions.find((e=>e.attributes.mid===t)))||void 0===r?void 0:r.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}getRemoteMid(t,e){var n,i,r;if(e=null!==(n=e)&&void 0!==n?n:null===(i=this.currentRemoteDescription)||void 0===i?void 0:i.sdp)return null===(r=zM.parse(e).mediaDescriptions.find((e=>e.attributes.ssrcs.some((e=>e.ssrcId===t)))))||void 0===r?void 0:r.attributes.mid}async getRemoteSSRC(t,e){var n,i;if(e=null!==(n=e)&&void 0!==n?n:null===(i=this.currentRemoteDescription)||void 0===i?void 0:i.sdp){var r;const n=null===(r=zM.parse(e).mediaDescriptions.find((e=>e.attributes.mid===t)))||void 0===r?void 0:r.attributes.ssrcs;return null==n?void 0:n[0].ssrcId}}}function IP(t,e,n){const i=t[e];if("function"!=typeof i)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const t=this.mutex,n=await t.lock("From P2PConnection.".concat(e));try{for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return await i.apply(this,s)}finally{n()}},n}var xP;function OP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function LP(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?OP(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):OP(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],RP.prototype,"establish",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],RP.prototype,"connect",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[RTCIceCandidate]),Dw("design:returntype",ev)],RP.prototype,"addRemoteCandidate",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],RP.prototype,"send",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[String,String,Number]),Dw("design:returntype",ev)],RP.prototype,"receive",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[String,String]),Dw("design:returntype",ev)],RP.prototype,"setDescription",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[Array,String]),Dw("design:returntype",ev)],RP.prototype,"stopReceiving",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],RP.prototype,"restartICE",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],RP.prototype,"close",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[String,nC]),Dw("design:returntype",ev)],RP.prototype,"updateEncoderConfig",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[String,nC]),Dw("design:returntype",ev)],RP.prototype,"updateSendParameters",null),Pw([IP,Dw("design:type",Function),Dw("design:paramtypes",[nC,String]),Dw("design:returntype",ev)],RP.prototype,"replaceTrack",null),function(t){t.SEND_ONLY="SEND_ONLY",t.RECEIVE_ONLY="RECEIVE_ONLY"}(xP||(xP={}));class MP extends ny{get state(){return this._state}set state(t){const e=this._state;this._state=t,this.emit(mS.StateChange,e,this._state)}constructor(t,e){super(),ih(this,"store",void 0),ih(this,"statsUploader",void 0),ih(this,"sendConnection",void 0),ih(this,"recvConnection",void 0),ih(this,"localTrackMap",new Map),ih(this,"remoteUserMap",new Map),ih(this,"localDataChannels",[]),ih(this,"pendingLocalTracks",[]),ih(this,"pendingRemoteTracks",[]),ih(this,"statsCollector",void 0),ih(this,"dtlsFailedCount",0),ih(this,"sendMutex",new Wy("P2PChannel2-send-mutex")),ih(this,"recvMutex",new Wy("P2PChannel2-recv-mutex")),ih(this,"_state",fS.Disconnected),ih(this,"_restartStates",["disconnected","failed"]),ih(this,"_restartTimer",void 0),ih(this,"handleMuteLocalTrack",(async(t,e,n)=>{const i=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==fS.Connected)return void n(new Uv(Bv.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const o=this.filterTobeMutedTracks(t);if(0===o.length)return void e();const a=o.find((t=>"videoLowTrack"===t[0]));a&&a[1].track._originMediaStreamTrack.stop();let c=!1;var r,s;c="video"===t.trackMediaType?!(null===(r=this.localTrackMap.get(pS.LocalAudioTrack))||void 0===r||!r.track._muted):void 0===(null===(s=this.localTrackMap.get(pS.LocalVideoTrack))||void 0===s?void 0:s.id);const l=o.filter((t=>{let[e,n]=t;return(e!==pS.LocalAudioTrack||c)&&void 0!==n.id})).map((t=>{let[,e]=t;return e}));let u;l.length>0&&(u=await this.sendConnection.stopSending(l.map((t=>t.id))),l.forEach((t=>{t.id=void 0,t.ssrcs=void 0})));const d=this.createMuteMessage(o),h="video"===t.trackMediaType?xS.MUTE_LOCAL_VIDEO:xS.MUTE_LOCAL_AUDIO,A=await gy(this,mS.RequestP2PMuteLocal,{action:h,sdp:u,message:d,isMuteAll:c});A&&await this.sendConnection.setDescription("local",A),(u||"audio"===t.trackMediaType)&&await vy(this,mS.RequestMuteLocal,d),e()}catch(t){n(t)}finally{i()}})),ih(this,"handleUnmuteLocalTrack",(async(t,e,n)=>{const i=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==fS.Connected)return void n(new Uv(Bv.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const r=this.filterTobeUnmutedTracks(t);if(0===r.length)return void e();const s=this.createUnmuteMessage(r),o="video"===t.trackMediaType?xS.UNMUTE_LOCAL_VIDEO:xS.UNMUTE_LOCAL_AUDIO;await vy(this,mS.RequestP2PMuteLocal,{action:o,message:s}),e()}catch(t){n(t)}finally{i()}})),ih(this,"handleUpdateVideoEncoder",(async(t,e,n)=>{const i=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const n=this.localTrackMap.get(pS.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==t||this.state!==fS.Connected)return void e();const{id:r,track:s}=n;r&&(await this.sendConnection.updateSendParameters(r,s),await this.sendConnection.updateEncoderConfig(r,s),this.emit(mS.UpdateVideoEncoder,s)),e()}catch(t){n(t)}finally{i()}})),ih(this,"handleSetOptimizationMode",(async(t,e,n)=>{const i=await this.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const n=this.localTrackMap.get(pS.LocalVideoTrack);if(!this.sendConnection||!n||n.track!==t||this.state!==fS.Connected)return;const{id:r,track:s}=n;r&&await this.sendConnection.updateSendParameters(r,s),e()}catch(t){n(t)}finally{i()}})),ih(this,"handleReplaceTrack",(async(t,e,n,i)=>{let r;zE.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(t.getTrackId(),"]")),"boolean"==typeof i&&i||(r=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var s;const n=Array.from(this.localTrackMap.entries()).find((e=>{let[,{track:n}]=e;return t===n}));if(!this.sendConnection||!n||void 0===n[1].id||this.state!==fS.Connected)return void e();if(await(null===(s=this.sendConnection)||void 0===s?void 0:s.replaceTrack(t,n[1].id)),n[0]===pS.LocalVideoTrack&&pC().supportDualStreamEncoding){const e=this.localTrackMap.get(pS.LocalVideoLowTrack);if(e){const n=t._mediaStreamTrack.clone();e.track._originMediaStreamTrack.stop(),e.track._mediaStreamTrack=n,e.track._originMediaStreamTrack=n,await new ev(((t,n)=>{this.handleReplaceTrack(e.track,t,n,!0)}))}}e()}catch(t){n(t)}finally{var o;null===(o=r)||void 0===o||o()}})),ih(this,"handleGetLocalVideoStats",(t=>{t(this.statsCollector.getLocalVideoTrackStats())})),ih(this,"handleGetLocalAudioStats",(t=>{t(this.statsCollector.getLocalAudioTrackStats())})),ih(this,"handleGetRemoteVideoStats",(t=>this.statsCollector.getRemoteVideoTrackStats(t.uid)[t.uid])),ih(this,"handleGetRemoteAudioStats",(t=>this.statsCollector.getRemoteAudioTrackStats(t.uid)[t.uid])),this.store=t,this.statsCollector=e,this.statsCollector.addP2PChannel(this),this.statsUploader=new lN,this.bindStatsUploaderEvents()}async startP2PConnection(t,e){throw new Uv(Bv.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(t,e,n,i,r,s){throw new Uv(Bv.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(t,e){if(this.state=fS.New,this.sendConnection&&(zE.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),this.recvConnection&&(zE.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),this.sendConnection=new RP(t,this.store),this.bindConnectionEvents(this.sendConnection),this.recvConnection=new RP(t,this.store,ww.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection),e){this.store.peerConnectionStart(),await this.recvConnection.establish(e);const t=await this.sendConnection.establish(e);return this.statsUploader.startUploadTransportStats(!0),this.statsUploader.startUploadExtensionUsageStats(),this.state=fS.Connected,t}return await this.recvConnection.establish(e),this.sendConnection.establish(e)}async p2pConnect(t){if(!this.sendConnection||!this.recvConnection)throw new Uv(Bv.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.recvConnection.connect(t),await this.sendConnection.connect(t),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=fS.Connected}async addRemoteCandidate(t){if(!this.sendConnection||!this.recvConnection)throw new Uv(Bv.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(t),await this.sendConnection.addRemoteCandidate(t)}async publish(t,e,n){if(!this.sendConnection||this.state!==fS.Connected){this.throwIfTrackTypeNotMatch(t);const e=t.filter((t=>-1===this.pendingLocalTracks.indexOf(t)));return void(this.pendingLocalTracks=this.pendingLocalTracks.concat(e))}this.store.pubId=this.store.pubId+1,cL.markPublishStart(this.store.clientId,this.store.pubId);const i=this.filterTobePublishedTracks(t,e,n);if(0===i.length)return void await this.tryToUnmuteAudio(t);i.forEach((t=>{let{track:e,type:n}=t;const i=Date.now();this.store.publish(e.getTrackId(),n===pS.LocalAudioTrack?"audio":"video",i)})),this.bindLocalTrackEvents(i);const r=this.createGatewayPublishMessage(i);return this.assignLocalTracks(i),i.forEach((t=>{let{track:e,type:n}=t;const i=Date.now();this.store.publish(e.getTrackId(),n===pS.LocalAudioTrack?"audio":"video",void 0,i)})),r}async dopublish(t){if(!this.sendConnection||this.state!==fS.Connected)return;const e=this.localTrackMap.get(t);if(e){const{sdp:n,trackMessage:i}=await this.sendConnection.send([e.track]),{mid:r,localSSRC:s}=i[0];e.id=r,e.ssrcs=s,this.statsCollector.addLocalStats(t),this.statsUploader.startUploadUplinkStats();const o=await gy(this,mS.RequestP2PPublish,{kind:t===pS.LocalAudioTrack?dS.AUDIO:dS.VIDEO,sdp:n,ssrcId:s[0].ssrcId});await this.sendConnection.setDescription("local",o);const a=this.createUnmuteMessage([[t,e]]);await vy(this,mS.RequestUnmuteLocal,a)}}async setDescription(t,e){let n,i;"local"===t?(n=await this.sendMutex.lock("From P2PChannel.restartICE"),i=this.sendConnection):(n=await this.recvMutex.lock("From P2PChannel.restartICE"),i=this.recvConnection);try{if(!i||this.state!==fS.Connected)return;return await i.setDescription(t,e)}finally{n()}}publishLowStream(t){return HM((function*(){throw new Uv(Bv.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")}))()}async republish(){this.pendingLocalTracks.length>0&&(zE.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await gy(this,mS.RequestRePublish,this.pendingLocalTracks),this.emit(mS.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublish(t){if(!this.sendConnection||this.state!==fS.Connected)return void(0===t.length?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter((e=>!kr(t).call(t,e))));const e=this.filterTobeUnpublishedTracks(t);if(0===e.length)return;this.unbindLocalTrackEvents(e.map((t=>{let[e,{track:n}]=t;return{type:e,track:n}})));const n=e.filter((t=>{let[,{id:e}]=t;return void 0!==e}));if(!this.sendConnection||this.state!==fS.Connected)return void t.forEach((t=>{const e=this.pendingLocalTracks.indexOf(t);-1!==e&&this.pendingLocalTracks.splice(e,1)}));const i=e.find((t=>"videoLowTrack"===t[0]));let r;i&&i[1].track.close();const s=this.createGatewayUnpublishMessage(e);n.length>0&&(r=await this.sendConnection.stopSending(n.map((t=>{let[,{id:e}]=t;return e})))),this.withdrawLocalTracks(e),this.unbindLocalTrackEvents(e.map((t=>{let[e,{track:n}]=t;return{type:e,track:n}}))),e.forEach((t=>{let[e]=t;this.statsCollector.removeLocalStats(e)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadUplinkStats();const o=this.createMuteMessage(e);return await ev.all(o.map((async t=>{await vy(this,mS.RequestMuteLocal,[t])}))),{sdp:r,unpubMsg:s}}async unpublishLowStream(){throw new Uv(Bv.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async doUnpublish(t){if(!this.sendConnection||this.state!==fS.Connected)return;const e=[];if(t!==dS.AUDIO){const t=this.localTrackMap.get(pS.LocalVideoTrack);void 0!==(null==t?void 0:t.id)&&e.push([pS.LocalVideoTrack,t]);const n=this.localTrackMap.get(pS.LocalVideoLowTrack);void 0!==(null==n?void 0:n.id)&&e.push([pS.LocalVideoLowTrack,n]),this.statsCollector.removeLocalStats(pS.LocalVideoTrack),this.statsCollector.removeLocalStats(pS.LocalVideoLowTrack)}if(t!==dS.VIDEO){const t=this.localTrackMap.get(pS.LocalAudioTrack);void 0!==(null==t?void 0:t.id)&&e.push([pS.LocalAudioTrack,t]),this.statsCollector.removeLocalStats(pS.LocalAudioTrack)}if(e.length>0){const n=await this.sendConnection.stopSending(e.map((t=>{let[,e]=t;return e.id})));e.forEach((t=>{let[,e]=t;e.id=void 0,e.ssrcs=void 0}));const i=await gy(this,mS.RequestP2PUnPublish,{sdp:n,kind:t});await this.sendConnection.setDescription("local",i);const r=this.createMuteMessage(e);await ev.all(r.map((async t=>{await vy(this,mS.RequestMuteLocal,[t])})))}}async subscribe(t,e,n,i){var r;if(!this.recvConnection||this.state!==fS.Connected)throw new Uv(Bv.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if(null!==(r=this.remoteUserMap.get(t))&&void 0!==r&&r.has(e))return;const{track:s,mid:o,sdp:a}=await this.recvConnection.receive(e,n,i);e===dS.AUDIO?(t._audioSSRC=i,t._audioTrack?t._audioTrack._updateOriginMediaStreamTrack(s):(t._audioTrack=new xR(s,t.uid,t._uintid,this.store),zE.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(t._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._audioTrack)):(t._videoSSRC=i,t._videoTrack?t._videoTrack._updateOriginMediaStreamTrack(s):(t._videoTrack=new IR(s,t.uid,t._uintid,this.store),zE.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(t._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(t,t._videoTrack));const c=this.remoteUserMap.get(t);c?c.set(e,o):this.remoteUserMap.set(t,new Map([[e,o]])),this.statsCollector.addRemoteStats(t.uid),this.statsUploader.startUploadDownlinkStats(),await vy(this,mS.RequestP2PUnmuteRemote,e);const l=this.pendingRemoteTracks.findIndex((n=>{let{user:i,kind:r}=n;return i.uid===t.uid&&e===r}));return-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(mS.MediaReconnectEnd,t.uid)),a}async unsubscribe(t,e,n,i){const r=this.pendingRemoteTracks.filter((e=>{let{user:i,kind:r}=e;return void 0!==n?i.uid===t.uid&&n===r:i.uid===t.uid}));if(r.forEach((t=>{const e=this.pendingRemoteTracks.indexOf(t);this.pendingRemoteTracks.splice(e,1)})),this.recvConnection&&this.state===fS.Connected||i||r.forEach((e=>{let{kind:n}=e;var i;if(n===dS.AUDIO)null===(i=t._audioTrack)||void 0===i||i._destroy(),t._audioTrack=void 0;else if(n===dS.VIDEO){var r;null===(r=t._videoTrack)||void 0===r||r._destroy(),t._videoTrack=void 0}})),!this.recvConnection||this.state!==fS.Connected)return;const s=this.filterTobeUnSubscribedTracks(t,n);if(0===s.length)return void(n!==dS.VIDEO&&vy(this,mS.RequestP2PMuteRemote,dS.AUDIO));const o=await this.recvConnection.stopReceiving(s.map((t=>{let[,{id:e}]=t;return e})),e);return this.withdrawRemoteTracks(s),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),s.forEach((t=>{let[e,{kind:n}]=t;var r,s;if(n===dS.VIDEO&&e._videoSSRC&&(null===(r=this.recvConnection)||void 0===r||r.setStatsRemoteVideoIsReady(e._videoSSRC,!1)),n===dS.VIDEO)this.unbindRemoteTrackEvents(e._videoTrack),i||(null===(s=e._videoTrack)||void 0===s||s._destroy(),e._videoTrack=void 0);else if(n===dS.AUDIO){var o;this.unbindRemoteTrackEvents(e._audioTrack),i||(null===(o=e._audioTrack)||void 0===o||o._destroy(),e._audioTrack=void 0)}})),s.filter((t=>{let[,{kind:e}]=t;return e!==dS.AUDIO})).forEach((t=>{let[,{kind:e}]=t;vy(this,mS.RequestP2PMuteRemote,e)})),n!==dS.VIDEO&&vy(this,mS.RequestP2PMuteRemote,dS.AUDIO),o}getAllDataChannels(){return this.localDataChannels}async massSubscribe(t){throw new Uv(Bv.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(t){throw new Uv(Bv.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(t){throw new Uv(Bv.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(t){throw new Uv(Bv.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);if(!n)return void zE.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid,"."));if(!n.get(e))return void zE.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(t.uid," media type ").concat(e,"."));const i=e===dS.VIDEO?t._videoSSRC:t._audioSSRC;void 0!==i&&this.recvConnection.setStatsRemoteVideoIsReady(i,!1)}async unmuteRemote(t,e){return this.unmuteRemoteNoLock(t,e)}async unmuteRemoteNoLock(t,e){if(!this.recvConnection)return;const n=this.remoteUserMap.get(t);n?n.get(e)||zE.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid," media type ").concat(e,".")):zE.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(t.uid,"."))}getAllTracks(t){const e=this.localTrackMap.get(pS.LocalAudioTrack);if((null==e?void 0:e.track)instanceof eR){const n=e.track;return Array.from(this.localTrackMap.entries()).filter((t=>{let[e]=t;return e!==pS.LocalAudioTrack})).filter((e=>{let[n]=e;return!(t&&n===pS.LocalVideoLowTrack)})).map((t=>{let[,{track:e}]=t;return e})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((e=>{let[n]=e;return!(t&&n===pS.LocalVideoLowTrack)})).map((t=>{let[,{track:e}]=t;return e}))}reportPublishEvent(t,e,n,i,r){if(t){const n=this.localTrackMap.get(pS.LocalAudioTrack),s=i?this.localTrackMap.get(pS.LocalVideoLowTrack):this.localTrackMap.get(pS.LocalVideoTrack);rw.publish(this.store.sessionId,{eventElapse:cL.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==s?void 0:s.track.getTrackLabel(),screenshare:-1!==(null==s?void 0:s.track._hints.indexOf(NT.SCREEN_TRACK)),audio:!!n,video:!!s,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}else{var s;n||(n=[]);const o=n.find((t=>t instanceof JC)),a=i?null===(s=this.localTrackMap.get(pS.LocalVideoTrack))||void 0===s?void 0:s.track:n.find((t=>t instanceof _R));rw.publish(this.store.sessionId,{eventElapse:cL.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:t,ec:e,audioName:null==o?void 0:o.getTrackLabel(),videoName:null==a?void 0:a.getTrackLabel(),screenshare:-1!==(null==a?void 0:a._hints.indexOf(NT.SCREEN_TRACK)),audio:!!o,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:r})}}reportSubscribeEvent(t,e,n,i){const r=i===dS.VIDEO?n._videoSSRC:n._audioSSRC;r&&rw.subscribe(this.store.sessionId,{succ:t,ec:e,video:i===dS.VIDEO,audio:i===dS.AUDIO,peerid:n.uid,subscribeRequestid:i===dS.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:cL.measureFromSubscribeStart(this.store.clientId,r)})}reset(){zE.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new Wy("P2PChannel2-send-mutex"),this.sendMutex=new Wy("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const t=this.localTrackMap.get(pS.LocalAudioTrack);if((null==t?void 0:t.track)instanceof eR){if(t.track.trackList.length>0){const e=t.track;t.track.trackList.forEach((t=>{e.removeAudioTrack(t)}))}t.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=fS.Disconnected}getStats(t){var e,n;return t?null===(n=this.recvConnection)||void 0===n?void 0:n.getStats():null===(e=this.sendConnection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(t){var e;return(null===(e=this.recvConnection)||void 0===e?void 0:e.getRemoteVideoIsReady(t))||!1}getLocalAudioVolume(){const t=this.localTrackMap.get(pS.LocalAudioTrack);if(t)return t.track.getVolumeLevel()}getLocalVideoSize(){const t=this.localTrackMap.get(pS.LocalVideoTrack);if(t)return{width:t.track._videoWidth||0,height:t.track._videoHeight||0}}getEncoderConfig(t){const e=this.localTrackMap.get(t);return e&&e.track instanceof _R||e&&e.track instanceof JC?e.track._encoderConfig:void 0}getLocalMedia(t){return this.localTrackMap.get(t)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}async hasRemoteMediaWithLock(t,e){if(!t)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(t);return!!n&&(!e||n.has(e))}getRemoteMedia(t){var e;const n=Array.from(dh(e=this.remoteUserMap).call(e)).find((e=>e.uid===t));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let t=Array.from(this.remoteUserMap.entries()).map((t=>{let[e]=t;return{uid:e.uid,level:e.audioTrack?100*e.audioTrack._source.getAccurateVolumeLevel():0}}));const e=this.localTrackMap.get(pS.LocalAudioTrack);return e&&t.push({level:100*e.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),t=Jh(t).call(t,((t,e)=>t.level-e.level)),t}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(zE.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=fS.Reconnecting,NE("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[e]=t;var n;e._videoTrack&&e._videoTrack._player&&(null===(n=e._videoTrack._player.getVideoElement())||void 0===n||n.pause(),e._videoTrack._player.isKeepLastFrame=!0,e._videoTrack._originMediaStreamTrack.stop())})),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((t=>{var e;let[n,{track:i}]=t;switch(n){case pS.LocalVideoTrack:kr(e=i._hints).call(e,NT.LOW_STREAM)?i.close():this.pendingLocalTracks.push(i);break;case pS.LocalAudioTrack:i instanceof eR?this.pendingLocalTracks=this.pendingLocalTracks.concat(i.trackList):this.pendingLocalTracks.push(i);case pS.LocalVideoLowTrack:}})),this.emit(mS.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((t=>{let[e,n]=t;Array.from(dh(n).call(n)).forEach((t=>{this.setPendingRemoteMedia(e,t)})),this.emit(mS.MediaReconnectStart,e.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),zE.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(t,e){for(const n of this.pendingRemoteTracks){const{user:i,kind:r}=n;if((t instanceof OM?t.uid:t)===i.uid&&e===r)return!0}return!1}setPendingRemoteMedia(t,e){this.hasPendingRemoteMedia(t,e)||this.pendingRemoteTracks.push({user:t,kind:e})}async restartICE(t){let e;e=t.direction===ww.SEND_ONLY?await this.sendMutex.lock("From P2PChannel.restartICE"):await this.recvMutex.lock("From P2PChannel.restartICE");try{const n=await t.restartICE(),i=await gy(this,mS.RequestP2PRestartICE,n);t.setDescription("local",i)}finally{e()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const t=this.sendConnection.getStats(),e=this.localTrackMap.get(pS.LocalVideoTrack),n=this.localTrackMap.get(pS.LocalAudioTrack),i=t.videoSend.find((t=>{var n;return t.ssrc===(null==e||null===(n=e.ssrcs)||void 0===n?void 0:n[0].ssrcId)})),r=t.audioSend.find((t=>{var e;return t.ssrc===(null==n||null===(e=n.ssrcs)||void 0===e?void 0:e[0].ssrcId)}));if(!i||!r)return 1;const s=yy(this,mS.NeedSignalRTT),o=i?i.rttMs:void 0,a=r?r.rttMs:void 0,c=o&&a?(o+a)/2:o||a,l=(c&&s?(c+s)/2:c||s)||0,u=100*t.sendPacketLossRate*.7/50+.3*l/1500,d=u<.17?1:u<.36?2:u<.59?3:u<.1?4:5,h=null==e?void 0:e.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(NT.SCREEN_TRACK)){const e=h._encoderConfig.bitrateMax,n=t.bitrate.actualEncoded;if(e&&n){const t=(1e3*e-n)/(1e3*e);return aw[t<.15?0:t<.3?1:t<.45?2:t<.6?3:4][d]}}return d}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const t=this.recvConnection.getStats();let e=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[i]=n;const r=i._audioSSRC,s=i._videoSSRC,o=t.audioRecv.find((t=>t.ssrc===r)),a=t.videoRecv.find((t=>t.ssrc===s));if(!o&&!a)return void(e+=1);const c=yy(this,mS.NeedSignalRTT),l=t.rtt,u=(l&&c?(l+c)/2:l||c)||0,d=o?o.jitterMs:void 0,h=t.recvPacketLossRate;let A=.7*h*100/50+.3*u/1500;d&&(A=.6*h*100/50+.2*u/1500+.2*d/400),e+=A<.1?1:A<.17?2:A<.36?3:A<.59?4:5})),this.remoteUserMap.size>0?Math.round(e/this.remoteUserMap.size):e}async muteLocalTrack(t){return new ev(((e,n)=>{this.handleMuteLocalTrack(t,e,n)}))}filterTobePublishedTracks(t,e,n){const i=[],r=pC(),s=this.getAllTracks();t=Ty(t=t.filter((t=>-1===s.indexOf(t))));let o=!1,a=!1;for(const s of t){if(s instanceof _R&&(this.localTrackMap.has(pS.LocalVideoTrack)||o?new Uv(Bv.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(i.push({track:s,type:pS.LocalVideoTrack}),o=!0),e)){const t=this.getLowVideoTrack(s,n);i.push({track:t,type:pS.LocalVideoLowTrack})}if(s instanceof JC){const t=this.localTrackMap.get(pS.LocalAudioTrack);if(t){if(!(t.track instanceof eR))throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(s._bypassWebAudio)throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");t.track.addAudioTrack(s),this.bindLocalAudioTrackEvents(s,!0)}else if(a){const t=i.find((t=>{let{type:e}=t;return e===pS.LocalAudioTrack}));if(!(t.track instanceof eR))throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(s._bypassWebAudio)throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");t.track.addAudioTrack(s)}else{if(!r.webAudioMediaStreamDest||s instanceof eR||s._bypassWebAudio)i.push({track:s,type:pS.LocalAudioTrack});else{const t=new eR;t.addAudioTrack(s),i.push({track:t,type:pS.LocalAudioTrack})}a=!0}}}return i}filterTobeUnpublishedTracks(t){const e=[],n=this.getAllTracks();t=Ty(t=t.filter((t=>-1!==n.indexOf(t))));for(const n of t){if(n instanceof JC){const t=this.localTrackMap.get(pS.LocalAudioTrack);if(!t)continue;t.track instanceof eR?(t.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),0===t.track.trackList.length&&(e.push([pS.LocalAudioTrack,t]),t.track.close())):e.push([pS.LocalAudioTrack,t])}if(n instanceof _R){const t=this.localTrackMap.get(pS.LocalVideoTrack);if(!t)continue;e.push([pS.LocalVideoTrack,t]);const n=this.localTrackMap.get(pS.LocalVideoLowTrack);n&&e.push([pS.LocalVideoLowTrack,n])}}return e}bindLocalTrackEvents(t){t.forEach((t=>{let{track:e,type:n}=t;switch(n){case pS.LocalVideoTrack:e.addListener(kT.GET_STATS,this.handleGetLocalVideoStats),e.addListener(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(kT.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),e.addListener(kT.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),e.addListener(kT.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case pS.LocalAudioTrack:this.bindLocalAudioTrackEvents(e);case pS.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(t,e){t instanceof eR?t.trackList.forEach((t=>{t.addListener(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(kT.GET_STATS,this.handleGetLocalAudioStats),t.addListener(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.addListener(kT.GET_STATS,this.handleGetLocalAudioStats),t.addListener(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),e||t.addListener(kT.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(t){t||(t=Array.from(this.localTrackMap.entries()).map((t=>{let[e,{track:n}]=t;return{track:n,type:e}}))),t.forEach((t=>{let{track:e,type:n}=t;switch(n){case pS.LocalVideoTrack:e.off(kT.GET_STATS,this.handleGetLocalVideoStats),e.off(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(kT.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),e.off(kT.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),e.off(kT.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case pS.LocalAudioTrack:this.unbindLocalAudioTrackEvents(e);case pS.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(t){t instanceof eR?t.trackList.forEach((t=>{t.off(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(kT.GET_STATS,this.handleGetLocalAudioStats),t.off(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(t.off(kT.GET_STATS,this.handleGetLocalAudioStats),t.off(kT.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(kT.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(kT.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(kT.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(kT.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(t,e){e instanceof IR&&e.addListener(kT.GET_STATS,(e=>{e(this.handleGetRemoteVideoStats(t))})),e instanceof xR&&e.addListener(kT.GET_STATS,(e=>{e(this.handleGetRemoteAudioStats(t))}))}unbindRemoteTrackEvents(t){t&&t.removeAllListeners(kT.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((t=>{let[e,n]=t;n.has(dS.AUDIO)&&this.unbindRemoteTrackEvents(e._audioTrack),n.has(dS.VIDEO)&&this.unbindRemoteTrackEvents(e._videoTrack)}))}createGatewayPublishMessage(t){return t.map((t=>{var e;let n,i,{track:r,type:s}=t;switch(s){case pS.LocalAudioTrack:n=Zw.Audio,i={dtx:r instanceof ZC&&r._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case pS.LocalVideoTrack:n=kr(e=r._hints).call(e,NT.SCREEN_TRACK)?Zw.Screen:Zw.High,i=LP(LP({},gL(r)),{},{codec:this.store.codec});break;case pS.LocalVideoLowTrack:n=Zw.Low,i=LP(LP({},gL(r)),{},{codec:this.store.codec})}return{kind:s===pS.LocalAudioTrack?dS.AUDIO:dS.VIDEO,stream_type:n,attributes:i,isMuted:r.muted||!r.enabled}}))}createGatewayUnpublishMessage(t){return t.map((t=>{var e;let n,[i,{track:r,ssrcs:s,id:o}]=t;switch(i){case pS.LocalVideoTrack:n=kr(e=r._hints).call(e,NT.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case pS.LocalAudioTrack:n=Zw.Audio;break;case pS.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:s,mid:o}}))}assignLocalTracks(t){t.forEach((t=>{let{track:e,type:n}=t;this.localTrackMap.set(n,{track:e})}))}withdrawLocalTracks(t){t.forEach((t=>{let[e]=t;this.localTrackMap.delete(e)}))}bindConnectionEvents(t){t.onConnectionStateChange=async e=>{var n;if(zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(e,")")),this.emit(mS.PeerConnectionStateChange,e),"connected"!==e||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),kr(n=this._restartStates).call(n,e)||t.direction===ww.SEND_ONLY){if(this._restartTimer)return;const e=()=>{"disconnected"!==t.iceConnectionState&&"checking"!==t.iceConnectionState&&"failed"!==t.iceConnectionState||(zE.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE")),"CONNECTED"===yy(this,mS.QueryClientConnectionState)&&this.restartICE(t))};this._restartTimer=window.setTimeout((()=>{e(),this._restartTimer=void 0}),800)}},t.onICEConnectionStateChange=t=>{"connected"!==t||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),rw.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:oy.TRACER}).onSuccess(),this.emit(mS.IceConnectionStateChange,t)},t.onICETransportStateChange=t=>{zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},t.onDTLSTransportStateChange=t=>{zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},t.onDTLSTransportError=t=>{zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},t.onFirstAudioDecoded=t=>{var e;const n=Array.from(dh(e=this.remoteUserMap).call(e)).find((e=>e._audioSSRC===t));var i;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(i=n.audioTrack)||void 0===i||i.emit(HT.FIRST_FRAME_DECODED),rw.firstRemoteFrame(this.store.sessionId,$E.FIRST_AUDIO_DECODE,XE.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:cL.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},t.onFirstAudioReceived=t=>{var e;const n=Array.from(dh(e=this.remoteUserMap).call(e)).find((e=>e._audioSSRC===t));n&&rw.firstRemoteFrame(this.store.sessionId,$E.FIRST_AUDIO_RECEIVED,XE.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:cL.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},t.onFirstVideoDecoded=(t,e,n)=>{this.reportVideoFirstFrameDecoded(t,e,n)},t.onFirstVideoReceived=t=>{var e;const n=Array.from(dh(e=this.remoteUserMap).call(e)).find((e=>e._videoSSRC===t));n&&rw.firstRemoteFrame(this.store.sessionId,$E.FIRST_VIDEO_RECEIVED,XE.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:cL.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},t.onSelectedLocalCandidateChanged=(t,e)=>{const n="relay"===t.candidateType,i="relay"===e.candidateType;"unknown"!==e.candidateType&&n===i||this.emit(mS.ConnectionTypeChange,n),zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(wL(e))," -> ").concat(JSON.stringify(wL(t)),")"))},t.onSelectedRemoteCandidateChanged=(t,e)=>{zE.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(wL(e))," -> ").concat(JSON.stringify(wL(t)),")"))},t.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)},t.onLocalCandidate=t=>{this.emit(mS.LocalCandidate,t)}}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0,t.onLocalCandidate=void 0}filterTobeMutedTracks(t){const e=[];if(-1===this.getAllTracks().indexOf(t))return e;const n=this.localTrackMap.get(pS.LocalAudioTrack);if(t instanceof JC&&(null==n?void 0:n.track)instanceof eR)return n.track.isActive||e.push([pS.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find((e=>{let[,{track:n}]=e;return t===n}));if(i&&(e.push(i),i[0]===pS.LocalVideoTrack)){const t=this.localTrackMap.get(pS.LocalVideoLowTrack);t&&e.push([pS.LocalVideoLowTrack,t])}return e}filterTobeUnmutedTracks(t){const e=[],n=this.localTrackMap.get(pS.LocalAudioTrack);if(t instanceof JC&&(null==n?void 0:n.track)instanceof eR)return n.track.isActive&&e.push([pS.LocalAudioTrack,n]),e;const i=Array.from(this.localTrackMap.entries()).find((e=>{let[,{track:n}]=e;return t===n}));if(i)if(i[0]===pS.LocalVideoTrack){e.push(i);const t=this.localTrackMap.get(pS.LocalVideoLowTrack);t&&e.push([pS.LocalVideoLowTrack,t])}else e.push(i);return e}createMuteMessage(t){return t.map((t=>{var e;let n,[i,{track:r,ssrcs:s,id:o}]=t;switch(i){case pS.LocalAudioTrack:n=Zw.Audio;break;case pS.LocalVideoTrack:n=kr(e=r._hints).call(e,NT.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case pS.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:s,mid:o}}))}createUnmuteMessage(t){return t.map((t=>{var e;let n,[i,{track:r,ssrcs:s,id:o}]=t;switch(i){case pS.LocalAudioTrack:n=Zw.Audio;break;case pS.LocalVideoTrack:n=kr(e=r._hints).call(e,NT.SCREEN_TRACK)?Zw.Screen:Zw.High;break;case pS.LocalVideoLowTrack:n=Zw.Low}return{stream_type:n,ssrcs:s,mid:o}}))}filterTobeUnSubscribedTracks(t,e){const n=[],i=this.remoteUserMap.get(t);if(!i)return n;if(e){const r=i.get(e);if(!r)return n;n.push([t,{kind:e,id:r}])}else Array.from(i.entries()).forEach((e=>{let[i,r]=e;n.push([t,{kind:i,id:r}])}));return n}createUnsubscribeMessage(t){const e=[];return t.forEach((t=>{let[n,{kind:i,id:r}]=t;switch(i){case dS.VIDEO:return void(n._videoSSRC&&e.push({stream_type:dS.VIDEO,ssrcId:n._videoSSRC}));case dS.AUDIO:return void(n._audioSSRC&&e.push({stream_type:dS.AUDIO,ssrcId:n._audioSSRC}))}})),e}withdrawRemoteTracks(t){t.forEach((t=>{let[e,{kind:n}]=t;const i=this.remoteUserMap.get(e);i&&(i.delete(n),0===Array.from(i.entries()).length&&this.remoteUserMap.delete(e))}))}async updateBitrateLimit(t){const e=this.localTrackMap.get(pS.LocalVideoTrack),n=this.localTrackMap.get(pS.LocalVideoLowTrack);e&&await e.track.setBitrateLimit(t.uplink),n&&t.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:t.low_stream_uplink.bitrate,min_bitrate:t.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const t=this.sendConnection.peerConnectionState,e=this.recvConnection.peerConnectionState;return"connected"!==t&&"connected"!==e}return!0}async tryToUnmuteAudio(t){for(let e=0;e<t.length;e++)if(t[e]instanceof JC){const n=this.filterTobeUnmutedTracks(t[e]);if(0===n.length)continue;const i=this.createUnmuteMessage(n);return void await vy(this,mS.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=t=>this.getStats(t),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter((t=>{let[,{ssrcs:e}]=t;return!!e})),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=t=>{var e;return!(null===(e=this.recvConnection)||void 0===e||!e.getRemoteVideoIsReady(t))},this.statsUploader.requestUpload=(t,e)=>this.emit(mS.RequestUploadStats,t,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Dy(Yy(this.dtlsFailedCount,qy)),this.emit(mS.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(pS.LocalVideoTrack)||this.pendingLocalTracks.some((t=>t instanceof _R))}throwIfTrackTypeNotMatch(t){if(t.filter((t=>t instanceof _R)).length>1)throw new Uv(Bv.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t.filter((t=>t instanceof JC)).length>1&&(t.some((t=>t instanceof JC&&t._bypassWebAudio))||!pC().webAudioMediaStreamDest))throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const e of t){if(e instanceof _R&&this.pendingLocalTracks.some((t=>t instanceof _R)))throw new Uv(Bv.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e instanceof JC&&this.pendingLocalTracks.some((t=>t instanceof JC))&&(!pC().webAudioMediaStreamDest||e._bypassWebAudio||this.pendingLocalTracks.some((t=>t instanceof JC&&t._bypassWebAudio))))throw new Uv(Bv.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(t,e){const n=!NE("DISABLE_DUAL_STREAM_USE_ENCODING")&&pC().supportDualStreamEncoding,i=LP(LP({},{width:160,height:120,framerate:15,bitrate:50}),e);let r;r=n?t._mediaStreamTrack.clone():zk(t,i);const s=By(8,"track-low-"),o=new _R(r,LP(LP({},n&&{scaleResolutionDownBy:EL(i,t)}),{},{frameRate:i.framerate,bitrateMax:i.bitrate,bitrateMin:i.bitrate}),void 0,void 0,s);return o.on(UT.TRANSCEIVER_UPDATED,(e=>{t._updateRtpTransceiver(e,PT.LOW_STREAM)})),o._hints.push(NT.LOW_STREAM),t.addListener(kT.NEED_CLOSE,(()=>{o.close()})),o}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(t,e,n,i){var r;const s=Array.from(dh(r=this.remoteUserMap).call(r)).find((e=>e._videoSSRC===t));if(s){i||this.store.subscribe(s.uid,"video",void 0,void 0,void 0,void 0,Date.now());const r=this.store.keyMetrics,o=r.subscribe.find((t=>t.userId===s.uid&&"video"===t.type));rw.firstRemoteVideoDecode(this.store.sessionId,$E.FIRST_VIDEO_DECODE,XE.FIRST_VIDEO_DECODE,{peer:s._uintid,videowidth:e,videoheight:n,subscribeElapse:cL.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId,apEnd:r.requestAPEnd||0,apStart:r.requestAPStart||0,joinGwEnd:r.joinGatewayEnd||0,joinGwStart:r.joinGatewayStart||0,pcEnd:r.peerConnectionEnd||0,pcStart:r.peerConnectionStart||0,subscriberEnd:(null==o?void 0:o.subscribeEnd)||0,subscriberStart:(null==o?void 0:o.subscribeStart)||0,videoAddNotify:(null==o?void 0:o.streamAdded)||0,state:i?1:0})}}async remoteMediaSsrcChanged(t,e,n){if(!this.recvConnection)return!1;const i=this.remoteUserMap.get(t);if(!i)return!1;const r=i.get(e);if(!r)return!1;const s=await this.recvConnection.getRemoteSSRC(r);return void 0!==s&&s!==n}resetConnection(t){zE.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(t)),this.state===fS.Connected?(zE.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(t){throw new Uv(Bv.NOT_SUPPORTED)}async unpublishDataChannel(t){throw new Uv(Bv.NOT_SUPPORTED)}async subscribeDataChannel(t,e){throw new Uv(Bv.NOT_SUPPORTED)}async unsubscribeDataChannel(t,e){throw new Uv(Bv.NOT_SUPPORTED)}hasPendingRemoteDataChannel(t,e){throw new Uv(Bv.NOT_SUPPORTED)}setPendingRemoteDataChannel(t,e){throw new Uv(Bv.NOT_SUPPORTED)}async preConnect(t,e,n,i,r,s){throw new Uv(Bv.NOT_SUPPORTED)}getEstablishParams(){throw new Uv(Bv.NOT_SUPPORTED)}async reSubscribe(t){throw new Uv(Bv.NOT_SUPPORTED)}async updateVideoStreamParameter(t,e){throw new Uv(Bv.NOT_SUPPORTED)}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((t=>{let[e,{track:n}]=t;e===pS.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,PT.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}}function kP(t){return function(e,n,i){const r=e[n];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return i.value=async function(){for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];switch(t){case xP.SEND_ONLY:{const t=await this.sendMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,i)}finally{t()}}case xP.RECEIVE_ONLY:{const t=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,i)}finally{t()}}default:{const t=await this.sendMutex.lock("From P2PChannel2.".concat(n)),e=await this.recvMutex.lock("From P2PChannel2.".concat(n));try{return await r.apply(this,i)}finally{t(),e()}}}},i}}function NP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function PP(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?NP(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):NP(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}Pw([kP(),Dw("design:type",Function),Dw("design:paramtypes",[Object,String]),Dw("design:returntype",ev)],MP.prototype,"startP2P",null),Pw([kP(),Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],MP.prototype,"p2pConnect",null),Pw([kP(xP.SEND_ONLY),Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],MP.prototype,"dopublish",null),Pw([kP(xP.SEND_ONLY),Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],MP.prototype,"unpublish",null),Pw([kP(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],MP.prototype,"unpublishLowStream",null),Pw([kP(xP.SEND_ONLY),Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],MP.prototype,"doUnpublish",null),Pw([kP(xP.RECEIVE_ONLY),Dw("design:type",Function),Dw("design:paramtypes",[OM,String,String,Number]),Dw("design:returntype",ev)],MP.prototype,"subscribe",null),Pw([kP(xP.RECEIVE_ONLY),Dw("design:type",Function),Dw("design:paramtypes",[OM,String,String,Boolean]),Dw("design:returntype",ev)],MP.prototype,"unsubscribe",null),Pw([kP(xP.RECEIVE_ONLY),Dw("design:type",Function),Dw("design:paramtypes",[OM,String]),Dw("design:returntype",ev)],MP.prototype,"muteRemote",null),Pw([kP(xP.RECEIVE_ONLY),Dw("design:type",Function),Dw("design:paramtypes",[OM,String]),Dw("design:returntype",ev)],MP.prototype,"unmuteRemote",null),Pw([kP(xP.RECEIVE_ONLY),Dw("design:type",Function),Dw("design:paramtypes",[OM,String]),Dw("design:returntype",ev)],MP.prototype,"hasRemoteMediaWithLock",null),Pw([kP(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],MP.prototype,"disconnectForReconnect",null),Pw([kP(xP.RECEIVE_ONLY),Dw("design:type",Function),Dw("design:paramtypes",[OM,String,Number]),Dw("design:returntype",ev)],MP.prototype,"remoteMediaSsrcChanged",null);const DP=Date.now(),BP=20,UP=new Map,FP=new Map;async function HP(t){const e=UP.get(t),n=Array.isArray(e)&&e[e.length-1],i=FP.get(t);if(!n)return void(i.isSyncing=!1);const r={uid:n.uid,payload:Ly(n.payload)};0===i.firstRecvTs&&(i.firstRecvTs=n.recvTs,i.firstSendTs=n.sendTs);const s=n.sendTs-i.firstSendTs,o=s-(Date.now()-i.firstRecvTs);o>0&&(i.firstRecvTs=Date.now()-s);let a=n.mediaDelay+o;a<=0?(e.pop(),VP(n.context,r),a=0):a=Math.min(a,BP),setTimeout((()=>e.length&&HP(t)),a)}function VP(t,e){t.safeEmit(ly.STREAM_MESSAGE,e.uid,e.payload),t.onStreamMessage&&t.onStreamMessage(e)}function jP(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;if(!t.syncWithAudio)return VP(n,{uid:t.uid,payload:Ly(t.payload)});const i="".concat(n.id,"-").concat(t.uid),r=UP.get(i)||[],s=r.findIndex((e=>t.sendTs>=e.sendTs)),o=PP(PP({},t),{},{context:n,mediaDelay:e,recvTs:Date.now()});-1===s?r.push(o):r.splice(s,0,o),UP.set(i,r);let a=!1;var c;FP.has(i)?a=!(null===(c=FP.get(i))||void 0===c||!c.isSyncing):FP.set(i,{isSyncing:a,firstRecvTs:0,firstSendTs:0}),a||HP(i)}const GP=Av().name;function QP(){return!function(t,e,n){const i=Av();if(i.os!==av.IOS||!i.osVersion)return!1;const r=i.osVersion.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}(16,0,!0)&&!function(t,e,n){const i=Av();if(i.name!==cv.SAFARI||!i.osVersion)return!1;const r=i.version.split(".");return n?e&&Number(r[0])===t&&Number(r[1])<e||Number(r[0])<t:e?Number(r[0])===t&&Number(r[1])<=e||Number(r[0])<t:Number(r[0])<=t}(16,0,!0)}function zP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function WP(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?zP(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):zP(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}Wy.setLogger(zE);class KP extends ny{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var t;return(null===(t=this._config)||void 0===t?void 0:t.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(t){let e;if(super(),ih(this,"store",void 0),ih(this,"_uid",void 0),ih(this,"_channelName",void 0),ih(this,"_uintUid",void 0),ih(this,"_users",[]),ih(this,"_config",void 0),ih(this,"_clientId",void 0),ih(this,"_appId",void 0),ih(this,"_sessionId",null),ih(this,"_key",void 0),ih(this,"_joinInfo",void 0),ih(this,"_gateway",void 0),ih(this,"_statsCollector",void 0),ih(this,"_configDistribute",void 0),ih(this,"_leaveMutex",new Wy("client-leave")),ih(this,"_publishMutex",new Wy("client-publish")),ih(this,"_renewTokenMutex",new Wy("client-renewtoken")),ih(this,"_subscribeMutex",new Wy("client-subscribe")),ih(this,"_encryptionMode","none"),ih(this,"_encryptionSecret",null),ih(this,"_encryptionSalt",null),ih(this,"_proxyServer",void 0),ih(this,"_turnServer",{servers:[],mode:"auto"}),ih(this,"_cloudProxyServerMode","disabled"),ih(this,"_isDualStreamEnabled",!1),ih(this,"_defaultStreamFallbackType",void 0),ih(this,"_lowStreamParameter",void 0),ih(this,"_streamFallbackTypeCacheMap",new Map),ih(this,"_remoteStreamTypeCacheMap",new Map),ih(this,"_axiosCancelSource",fE.CancelToken.source()),ih(this,"_audioVolumeIndicationInterval",void 0),ih(this,"_networkQualityInterval",void 0),ih(this,"_userOfflineTimeout",void 0),ih(this,"_streamRemovedTimeout",void 0),ih(this,"_injectStreamingClient",void 0),ih(this,"_liveTranscodeStreamingClient",void 0),ih(this,"_liveRawStreamingClient",void 0),ih(this,"_channelMediaRelayClient",void 0),ih(this,"_networkQualitySensitivity","normal"),ih(this,"_p2pChannel",void 0),ih(this,"_useLocalAccessPoint",!1),ih(this,"_setLocalAPVersion",void 0),ih(this,"_joinAndNotLeaveYet",!1),ih(this,"_numberOfJoinCount",0),ih(this,"_remoteDefaultVideoStreamType",void 0),ih(this,"_inspect",void 0),ih(this,"_moderation",void 0),ih(this,"_license",void 0),ih(this,"_pendingPublishedUsers",[]),ih(this,"ntpAlignErrorCount",0),ih(this,"remoteInboundOffset",0),ih(this,"_handleLocalTrackEnable",((t,e,n)=>{this.publish(t,!1).then(e).catch(n)})),ih(this,"_handleLocalTrackDisable",((t,e,n)=>{this.unpublish(t).then(e).catch(n)})),ih(this,"_handleUserOnline",(t=>{if(NE("BLOCK_LOCAL_CLIENT")&&lw(t.uid,this.channelName))return void zE.debug("[".concat(t.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof t.uid&&zE.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const e=this._users.find((e=>e.uid===t.uid));if(e)e._trust_in_room_=!0;else{const e=new OM(t.uid,t.uint_id||t.uid);this._users.push(e),zE.debug("[".concat(this._clientId,"] user online"),t.uid),this.safeEmit(ly.USER_JOINED,e)}})),ih(this,"_handleUserOffline",(t=>{if(NE("BLOCK_LOCAL_CLIENT")&&lw(t.uid,this.channelName))return;const e=this._users.find((e=>e.uid===t.uid));e&&(this._handleRemoveStream(t),this._handleRemoveDataChannels(t),Sy(this._users,e),this._remoteStreamTypeCacheMap.delete(e.uid),this._streamFallbackTypeCacheMap.delete(e.uid),zE.debug("[".concat(this._clientId,"] user offline"),t.uid,"reason:",t.reason),this.safeEmit(ly.USER_LEAVED,e,t.reason))})),ih(this,"_handleAddAudioOrVideoStream",((t,e,n,i,r,s,o)=>{if(NE("BLOCK_LOCAL_CLIENT")&&lw(e,this.channelName))return;const a=this._users.find((t=>t.uid===e));if(!a)return void zE.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));zE.debug("[".concat(this._clientId,"] stream added with uid ").concat(e,", type ").concat(t)),this.store.subscribe(a.uid,t,void 0,void 0,void 0,Date.now());const c="audio"===t?a.hasAudio:a.hasVideo;a._uintid||(a._uintid=r||e),"audio"===t?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,"audio"===t?(a._audio_added_=!0,void 0!==n&&(a._audioSSRC=n),void 0!==i&&(a._cname=i),s&&(a._audioOrtc=s)):(a._video_added_=!0,void 0!==n&&(a._videoSSRC=n),void 0!==i&&(a._cname=i),void 0!==o&&(a._rtxSsrcId=o),s&&(a._videoOrtc=s)),("audio"===t?a.hasAudio:a.hasVideo)&&!c&&(zE.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published ").concat(t)),this.safeEmit(ly.USER_PUBLISHED,a,t)),"video"===t?rw.onGatewayStream(this._sessionId,$E.ON_ADD_VIDEO_STREAM,XE.ON_ADD_VIDEO_STREAM,{peer:r||e,ssrc:a._videoSSRC}):rw.onGatewayStream(this._sessionId,$E.ON_ADD_AUDIO_STREAM,XE.ON_ADD_AUDIO_STREAM,{peer:r||e,ssrc:a._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged(a,t,n).then((e=>{if(e&&(zE.debug("[".concat(this._clientId,"] resubscribe ").concat(t," for user ").concat(a.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof pN))return this._p2pChannel.unsubscribe(a,t,!0).then((()=>this._subscribe(a,t,!0).catch((t=>{zE.error("[".concat(this._clientId,"] resubscribe error"),t.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(a,t)&&(zE.debug("[".concat(this._clientId,"] resubscribe ").concat(t," for user ").concat(a.uid," after reconnect.")),this._subscribe(a,t,!0).catch((t=>{zE.error("[".concat(this._clientId,"] resubscribe error"),t.toString())})))})),ih(this,"_handleRemoveStream",((t,e,n)=>{if(NE("BLOCK_LOCAL_CLIENT")&&lw(t.uid,this.channelName))return;const i=this._users.find((e=>e.uid===t.uid));if(!i)return void zE.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));zE.debug("[".concat(this._clientId,"] stream removed with uid ").concat(t.uid));let r=()=>{};if(i.hasAudio&&i.hasVideo?r=()=>{zE.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.safeEmit(ly.USER_UNPUBLISHED,i,"audio"),zE.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.safeEmit(ly.USER_UNPUBLISHED,i,"video")}:i.hasVideo?r=()=>{zE.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished video track")),this.safeEmit(ly.USER_UNPUBLISHED,i,"video")}:i.hasAudio&&(r=()=>{zE.info("[".concat(this._clientId,"] remote user ").concat(i.uid," unpublished audio track")),this.safeEmit(ly.USER_UNPUBLISHED,i,"audio")}),i._trust_audio_stream_added_state_=!0,i._trust_video_stream_added_state_=!0,i._audio_added_=!1,i._video_added_=!1,this._p2pChannel instanceof pN)this._p2pChannel.unsubscribe(i).then((t=>{if(t)return this._gateway.unsubscribe(t,i.uid)}));else if(e&&n)if(t.sdp){const{sdp:r}=t;this._p2pChannel.unsubscribe(i,r).then((t=>{t&&e(t)})).catch(n)}else e&&e();i._audioSSRC=void 0,i._videoSSRC=void 0,i._audioOrtc=void 0,i._videoOrtc=void 0,i._rtxSsrcId=void 0,rw.onGatewayStream(this._sessionId,$E.ON_REMOVE_STREAM,XE.ON_REMOVE_STREAM,{peer:t.uint_id||t.uid}),r()})),ih(this,"_handleSetStreamLocalEnable",((t,e,n)=>{if(NE("BLOCK_LOCAL_CLIENT")&&lw(e,this.channelName))return;const i=this._users.find((t=>t.uid===e));if(!i)return void zE.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));zE.debug("[".concat(this._clientId,"] local ").concat(t," ").concat(n?"enabled":"disabled"," with uid ").concat(e));const r="audio"===t?i.hasAudio:i.hasVideo;if("audio"===t){i._trust_audio_enabled_state_=!0;const t=i._audio_enabled_;if(i._audio_enabled_=n,i._audio_enabled_===t)return;{const t=i._audio_enabled_?"enable-local-audio":"disable-local-audio";zE.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(ly.USER_INFO_UPDATED,e,t)}}else{i._trust_video_enabled_state_=!0;const t=i._video_enabled_;if(i._video_enabled_=n,i._video_enabled_===t)return;{const t=i._video_enabled_?"enable-local-video":"disable-local-video";zE.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(ly.USER_INFO_UPDATED,e,t)}}const s="audio"===t?i.hasAudio:i.hasVideo;return r!==s?!r&&s?(zE.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(ly.USER_PUBLISHED,i,t)):("video"===t&&i._videoTrack&&i._videoTrack._destroy(),"audio"===t&&i._audioTrack,this._p2pChannel.muteRemote(i,t),zE.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),void this.safeEmit(ly.USER_UNPUBLISHED,i,t)):void 0})),ih(this,"_handleMuteStream",((t,e,n,i,r,s)=>{if(NE("BLOCK_LOCAL_CLIENT")&&lw(t,this.channelName))return;zE.debug("[".concat(this._clientId,"] receive mute message"),t,e,n);const o=this._users.find((e=>e.uid===t));if(!o)return void zE.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(t));const a="audio"===e?o.hasAudio:o.hasVideo;if("audio"===e){o._trust_audio_mute_state_=!0;const e=o._audio_muted_;if(o._audio_muted_=n,o._audio_muted_===e)return;{const e=o._audio_muted_?"mute-audio":"unmute-audio";zE.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(ly.USER_INFO_UPDATED,t,e)}}else{o._trust_video_mute_state_=!0;const e=o._video_muted_;if(o._video_muted_=n,o._video_muted_===e)return;{const e=o._video_muted_?"mute-video":"unmute-video";zE.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(ly.USER_INFO_UPDATED,t,e)}}const c="audio"===e?o.hasAudio:o.hasVideo;if(a!==c){if(!a&&c)return this.store.useP2P||("audio"===e?o._audioSSRC:o._videoSSRC)?(zE.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(ly.USER_PUBLISHED,o,e)):void zE.warning("[".concat(this._clientId,"] remote user ").concat(t," receive ").concat(e," unmute message  before add stream message, ").concat(e," SSRC doesn't exist yet."));"video"===e&&o._videoTrack&&o._videoTrack._destroy(),"audio"===e&&o._audioTrack,r&&s&&this._p2pChannel instanceof MP&&(i?this._p2pChannel.unsubscribe(o,i,e).then((t=>{r(t)})).catch(s):r()),this._p2pChannel.muteRemote(o,e),zE.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),this.safeEmit(ly.USER_UNPUBLISHED,o,e)}})),ih(this,"_handleP2PLost",(async t=>{zE.debug("[".concat(this._clientId,"] receive p2p lost"),t),parseInt(t.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():zE.warning("[".concat(this._clientId,"] P2PLost stream not found"),t)})),ih(this,"_handleTokenWillExpire",(()=>{zE.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(ly.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),ih(this,"_handleBeforeUnload",(t=>{"beforeunload"===t.type&&void 0!==t.returnValue&&""!==t.returnValue||(this.leave(),zE.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),ih(this,"_handleUpdateNetworkQuality",(()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(ly.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const t={downlinkNetworkQuality:0,uplinkNetworkQuality:0};t.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),t.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(ly.NETWORK_QUALITY,t)})),ih(this,"_handleP2PAddAudioOrVideoStream",((t,e)=>{const n=this._users.find((t=>t.uid===e));if(!n)return void zE.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));zE.debug("[".concat(this._clientId,"] stream added with uid ").concat(e,", type ").concat(t)),this.store.subscribe(n.uid,t,void 0,void 0,void 0,Date.now());const i="audio"===t?n.hasAudio:n.hasVideo;"audio"===t?n._trust_audio_stream_added_state_=!0:n._trust_video_stream_added_state_=!0,"audio"===t?n._audio_added_=!0:n._video_added_=!0,("audio"===t?n.hasAudio:n.hasVideo)&&!i&&(zE.info("[".concat(this._clientId,"] remote user ").concat(n.uid," published ").concat(t)),this.safeEmit(ly.USER_PUBLISHED,n,t)),this._p2pChannel.hasPendingRemoteMedia(n,t)&&(zE.debug("[".concat(this._clientId,"] resubscribe ").concat(t," for user ").concat(n.uid," after reconnect.")),this._subscribe(n,t,!0).catch((t=>{zE.error("[".concat(this._clientId,"] resubscribe error"),t.toString())})))})),this._config=t,this._clientId=By(5,"client-"),this.store=new IE(t.codec,t.audioCodec,t.mode,this._clientId),this.store.clientCreated(),t.proxyServer&&this.setProxyServer(t.proxyServer,!0),t.turnServer&&this.setTurnServer(t.turnServer,!0),zE.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(xE," build: ").concat(LE,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),t.clientRoleOptions)try{my(t.clientRoleOptions),e=Object.assign({},t.clientRoleOptions)}catch(t){zE.warning("[".concat(this._clientId,"] ").concat(t.toString()))}this._statsCollector=new dL(this.store),this._statsCollector.onStatsException=(t,e,n)=>{zE.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(t,", msg: ").concat(e,", uid: ").concat(n)),this.safeEmit(ly.EXCEPTION,{code:t,msg:e,uid:n})},this._statsCollector.onUploadPublishDuration=(t,e,n,i)=>{const r=this._users.find((e=>e.uid===t));r&&rw.peerPublishStatus(this._sessionId,{subscribeElapse:i,audioPublishDuration:e,videoPublishDuration:n,peer:r._uintid})},this.store.useDataChannel=pC().supportDataChannel&&NE("SIGNAL_CHANNEL"),this.store.useP2P=NE("P2P"),this._gateway=new PL(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:t.websocketRetryConfig||qy,httpRetryConfig:t.httpRetryConfig||qy,forceWaitGatewayResponse:void 0===t.forceWaitGatewayResponse||t.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:t.role,clientRoleOptions:e}),this._configDistribute=new yM,this.store.useP2P?(this._p2pChannel=new MP(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new pN(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(t,e,n,i,r){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];kE("JOIN_GATEWAY_USE_443PORT_ONLY",s),kE("JOIN_GATEWAY_USE_DUAL_DOMAIN",o);const a=this._gateway.signal.websocket;return a instanceof YS&&(a.use443PortOnly=s,a.tryDoubleDomain=o),async function(t,e,n){rv.get(t)||rv.set(t,[]),sv.get(t)||sv.set(t,e),ov.get(t)||ov.set(t,0);const i=rv.get(t),r=sv.get(t);if(!i||!r)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(ov.get(t)===r){const t=iv();i.push(t),await t.promise}ov.set(t,ov.get(t)+1);for(var s=arguments.length,o=new Array(s>3?s-3:0),a=3;a<s;a++)o[a-3]=arguments[a];const c=await n(...o);return ov.set(t,ov.get(t)-1),ov.get(t)===r-1&&i.length>0&&(i[0].resolve(),i.shift()),0===ov.get(t)&&(rv.set(t,[]),sv.set(t,0),ov.set(t,0)),c}("client.join",NE("JOIN_MAX_CONCURRENCY"),this.join.bind(this),t,e,n,i,r)}async join(t,e,n,i,r){const s=++this._numberOfJoinCount;this.store.joinStart(),i&&(this.store.uid=i);const o=wE(),a=SE()?window.isSecureContext:"Browser Not Support";if(!SE()&&!o||!window.isSecureContext){const t="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";zE.warning(t)}const c=Uy();"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),zE.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const l=rw.reportApiInvoke(c,{name:sy.JOIN,options:[t,e,n,i],states:{isHttps:o,isSecureContext:a},tag:oy.TRACER});rw.setAppId(t);try{if(!n&&null!==n)throw new Bw(Bv.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&Gv(n,"token",1,2047),Gv(t,"appid",1,2047),Uw(e),i&&Fw(i),r&&Gv(r,"optionalInfo",1,2047)}catch(t){throw l.onError(t),t}if(zE.info("[".concat(this._clientId,"] start join channel ").concat(e,", join number: ").concat(s)),this._leaveMutex.isLocked&&(zE.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),zE.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const t=new Bw(Bv.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw l.onError(t),t}this._sessionId||(this._sessionId=c,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const u=WP({clientId:this._clientId,appId:t,sid:this._sessionId,cname:e,uid:"string"!=typeof i?i:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||t,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:r,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(u.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof i&&(u.stringUid=i,this._uintUid?(u.uid=this._uintUid,this._uintUid=void 0):u.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(u.aesmode=this._encryptionMode,u.aespassword=await ty(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Bw(Bv.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(u.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:e,appId:t});const d=this._sessionId;setTimeout((()=>{"CONNECTING"===this.connectionState&&d===this._sessionId&&rw.joinChannelTimeout(this._sessionId,5)}),5e3);try{var h;let i;const r=u.cloudProxyServer;if(kr(h=["proxy3","proxy4","proxy5"]).call(h,r)){const t=NE("PROXY_SERVER_TYPE3");Array.isArray(t)?u.proxyServer=t[0]:u.proxyServer=t}if(rw.setProxyServer(u.proxyServer),zE.setProxyServer(u.proxyServer),this.store.requestAPStart(),u.stringUid&&!u.uid){const t=await dM(u.stringUid,u,this._axiosCancelSource.token,this._config.httpRetryConfig||qy,this.store);zE.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(u.stringUid," => ").concat(t)),u.uid=t,i=await uM(u,this._axiosCancelSource.token,this._config.httpRetryConfig||qy,!0,this.store)}else i=await uM(u,this._axiosCancelSource.token,this._config.httpRetryConfig||qy,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Bw(Bv.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(u,this._axiosCancelSource.token),this._configDistribute.on(lS.UPDATE_BITRATE_LIMIT,(t=>{this._p2pChannel.updateBitrateLimit(t)}))}),0),this._key=n||t;const s=i.gatewayInfo;this._joinInfo=WP(WP({},u),{},{cid:s.cid,uid:u.uid?u.uid:s.uid,vid:s.vid,apResponse:s.res,uni_lbs_ip:s.uni_lbs_ip,gatewayAddrs:s.gatewayAddrs});const o=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Bw(Bv.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));l.onSuccess(o),this._appId=t,this._channelName=u.cname,this._uid=o,this.store.uid=o,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(_v()?"beforeunload":"pagehide",this._handleBeforeUnload)}),0);const a=u.stringUid?"string uid: ".concat(u.stringUid,",uid: ").concat(u.uid):"uid: ".concat(this._uid);return zE.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(e,",").concat(a)),setTimeout((()=>{zE.startUpload()}),5e3),this.store.joinEnd(),A=this,kr(cw).call(cw,A)||cw.push(A),o}catch(t){const e=Array.isArray(t)?t[0]:t;throw e&&e.code===Bv.OPERATION_ABORTED?zE.warning("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),e):zE.error("[".concat(this._clientId,"] join number: ").concat(s,", Joining channel failed, rollback"),e),e.code!==Bv.OPERATION_ABORTED&&this._numberOfJoinCount===s&&(this._gateway.state="DISCONNECTED",this._reset()),l.onError(e),e}var A}_joinGateway(){if(!this._joinInfo||!this._key)throw new Bw(Bv.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!NE("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then((t=>t)).catch((t=>{if(t.code===Bv.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,cy.FALLBACK),t;if(t.code===Bv.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,cy.FALLBACK),t;throw t})).then((t=>{if(t instanceof Bw){if(t.code===Bv.INIT_WEBSOCKET_TIMEOUT){if(zE.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new Bw(Bv.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const t=NE("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){const e=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),n=e.slice(e.length-2).join(".");t.forEach((t=>{this._joinInfo&&kr(t).call(t,n)&&(this._joinInfo.proxyServer=t)})),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;const e=NE("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return e&&e[1]&&"443"!==e[1]&&zE.setProxyServer(this._joinInfo.proxyServer),"443"!==NE("STATS_COLLECTOR_PORT").toString()&&rw.setProxyServer(this._joinInfo.proxyServer),rw.reportApiInvoke(this._sessionId,{name:sy.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:oy.TRACER}).onSuccess(),this.safeEmit(ly.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),NE("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach((t=>{"forceturn"in t&&(t.forceturn=!0)})),this._gateway.join(this._joinInfo,this._key)}if(zE.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new Bw(Bv.INVALID_OPERATION);return rw.reportApiInvoke(this._sessionId,{name:sy.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:oy.TRACER}).onSuccess(),this._joinGateway()}return t})).then((t=>t))}async leave(){zE.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(_v()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const e=cw.indexOf(t);-1!==e&&cw.splice(e,1)}(this);const t=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return zE.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void t();await this._gateway.leave("CONNECTED"!==this.connectionState),zE.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),t()}async publish(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(t)){if(!(t instanceof nC))return this._publishDataChannel(t);t=[t]}if(0===t.length)throw new Bw(Bv.INVALID_PARAMS,"param list is empty");const n=t;if("audience"===this._gateway.role)throw new Bw(Bv.INVALID_OPERATION,"audience can not publish stream");for(const t of n){if(!(t instanceof nC))throw new Bw(Bv.INVALID_PARAMS,"parameter is not local track");if(!t._enabled&&e)throw new Bw(Bv.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(t.getTrackId()))}zE.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(n.map((t=>"".concat(t.getTrackId()," ")))));const i=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),e&&n.forEach((t=>{const e=this._configDistribute.getBitrateLimit();t instanceof _R&&e&&t.setBitrateLimit(e.uplink)}));try{await this._publishHighStream(n),zE.info("[".concat(this._clientId,"] Publish success, id ").concat(n.map((t=>"".concat(t.getTrackId()," ")))))}catch(t){throw zE.error("[".concat(this._clientId,"] publish error"),t.toString()),t}finally{i()}}async _publishDataChannel(t){Vv(t.id,"id",0,65535,!0),Fv(t.ordered,"ordered"),Gv(t.metadata,"metadata",0,512),zE.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(t.id));const e=await this._publishMutex.lock();try{if(-1!==this._p2pChannel.getAllDataChannels().findIndex((e=>e.id===t.id)))throw new Bw(Bv.INVALID_PARAMS,"Invalid id: ".concat(t.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||void 0===this._uid)throw new Bw(Bv.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&NE("FORCE_TURN")&&!NE("TURN_ENABLE_TCP")&&!NE("TURN_ENABLE_UDP"))throw new Bw(Bv.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const n=new sL(t);await this._p2pChannel.publishDataChannel([n]);try{const e={streamId:t.id,ordered:t.ordered,maxRetransmits:NE("DATASTREAM_MAX_RETRANSMITS"),metadata:t.metadata,channelId:n._originDataChannelId};await this._gateway.publishDataChannel(this._uid,e,!0)}catch(t){if(t.code!==Bv.DISCONNECT_P2P)throw t}return await n._waitTillOpen(),zE.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(n.id)),n}catch(t){throw zE.error("[".concat(this._clientId,"] publish datachannels error"),t.toString()),t}finally{e()}}async unpublish(t){if(!this._joinInfo||void 0===this._uid)throw new Bw(Bv.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let e=[];if(t)if(Array.isArray(t))e=t;else{if(!(t instanceof nC))return this._unpublishDataChannel([t]);e=[t]}else this.store.useP2P||await this._unpublishDataChannel(),e=this._p2pChannel.getAllTracks(!0);zE.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map((t=>"".concat(t.getTrackId()," ")))," "));const n=await this._publishMutex.lock();try{if(this._p2pChannel instanceof MP){const t=await this._p2pChannel.unpublish(e);if(t){const e=await this._gateway.sendExtensionMessage(IS.UNPUBLISH,t);e&&await this._p2pChannel.setDescription("local",e)}}else{const t=await this._p2pChannel.unpublish(e);t&&await this._gateway.unpublish(t,this._uid),zE.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map((t=>"".concat(t.getTrackId())))))}}catch(t){throw zE.error("[".concat(this._clientId,"] unpublish error"),t.toString()),t}finally{n&&n()}}async _unpublishDataChannel(t){void 0!==t&&0!==t.length||(t=this._p2pChannel.getAllDataChannels()),zE.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(t.map((t=>"".concat(t.id," ")))," "));const e=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublishDataChannel(t);n&&await this._gateway.unpublishDataChannel(n),zE.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(t.map((t=>"".concat(t.id)))))}catch(t){throw zE.error("[".concat(this._clientId,"] unpublish dataChannel error"),t.toString()),t}finally{e&&e()}}async subscribe(t,e,n){return"datachannel"===e?this._subscribeDataChannel(t,n):this._subscribe(t,e)}async _subscribeDataChannel(t,e){var n;if(Vv(e,"channelId",0,65535,!0),!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find((e=>e===t)))throw zE.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),new Bw(Bv.INVALID_REMOTE_USER,"user is not in the channel");if(!t.hasAudio&&!t.hasVideo&&0===t._dataChannels.length)throw zE.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),new Bw(Bv.INVALID_REMOTE_USER,"user is not published");const i=null===(n=t._dataChannels)||void 0===n?void 0:n.find((t=>t.id===e));if(!i)throw zE.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, remote datachannel is not published")),new Bw(Bv.REMOTE_USER_IS_NOT_PUBLISHED);const r=await this._subscribeMutex.lock();zE.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: datachannel"));try{const n=await this._p2pChannel.subscribeDataChannel(t,[i]);if(n&&kr(n).call(n,i.id))try{var s;if(!i._originDataChannelId)throw zE.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType datachannel, cannot get RTCDatachannel")),new Bw(Bv.REMOTE_USER_IS_NOT_PUBLISHED);const e={id:i.id,datachannelId:i._originDataChannelId,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:null!==(s=i.metadata)&&void 0!==s?s:""};await this._gateway.subscribeDataChannel(t.uid,e,!0)}catch(e){if((null==e?void 0:e.code)!==Bv.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(t,[i]),e;await this._p2pChannel.unsubscribeDataChannel(t,[i]),this._p2pChannel.setPendingRemoteDataChannel(t,i.id)}return await i._waitTillOpen(),zE.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: datachannel")),i}finally{r()}}async _p2pSubscribe(t,e,n){if(Hv(e,"mediaType",["audio","video"]),!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((e=>e===t))){const e=new Bw(Bv.INVALID_REMOTE_USER,"user is not in the channel");throw zE.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),e}if(!t.hasAudio&&!t.hasVideo){const e=new Bw(Bv.INVALID_REMOTE_USER,"user is not published");throw zE.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),e}if(!n&&("audio"===e&&!t.hasAudio||"video"===e&&!t.hasVideo)){const n=new Bw(Bv.REMOTE_USER_IS_NOT_PUBLISHED);throw zE.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),n}const i=await this._subscribeMutex.lock();zE.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));const r="audio"===e?pS.LocalAudioTrack:this._joinInfo.defaultVideoStream===DT.LOW_STREAM?pS.LocalVideoLowTrack:pS.LocalVideoTrack;try{await this._p2pChannel.hasRemoteMediaWithLock(t,e)?await this._p2pChannel.unmuteRemote(t,e):(this.store.subscribe(t.uid,e,Date.now()),this._p2pChannel instanceof MP&&await this._gateway.sendExtensionMessage(IS.SUBSCRIBE,{trackType:r})),zE.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((t=>{zE.warning("[".concat(this._clientId,"] auto set fallback failed"),t)}));const n="audio"===e?t._audioTrack:t._videoTrack;if(!n)throw new Bw(Bv.UNEXPECTED_ERROR,"can not find remote track in user object");return n}catch(e){throw zE.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),e),e}finally{i()}}async _subscribe(t,e,n){if(this._p2pChannel instanceof MP)return this._p2pSubscribe(t,e);if(Hv(e,"mediaType",["audio","video"]),!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((e=>e===t))){const e=new Bw(Bv.INVALID_REMOTE_USER,"user is not in the channel");throw zE.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", this user is not in the channel")),e}if(!t.hasAudio&&!t.hasVideo){const e=new Bw(Bv.INVALID_REMOTE_USER,"user is not published");throw zE.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid,", user is not published")),e}if(!(n||("audio"!==e||t.hasAudio&&void 0!==t._audioSSRC)&&("video"!==e||t.hasVideo&&void 0!==t._videoSSRC))){const n=new Bw(Bv.REMOTE_USER_IS_NOT_PUBLISHED);throw zE.error("[".concat(this._clientId,"] can not subscribe ").concat(t.uid," with mediaType ").concat(e,", remote track is not published")),n}let i="audio"===e?t._audioSSRC:t._videoSSRC,r="audio"===e?t._audioOrtc:t._videoOrtc,s="video"===e?t._rtxSsrcId:void 0,o={stream_type:"audio"===e?dS.AUDIO:dS.VIDEO,ssrcId:i};const a=await this._subscribeMutex.lock();zE.info("[".concat(this._clientId,"] subscribe user ").concat(t.uid,", mediaType: ").concat(e));try{if(await this._p2pChannel.hasRemoteMediaWithLock(t,e))await this._p2pChannel.unmuteRemote(t,e);else try{const a="audio"===e?t._audioSSRC:t._videoSSRC;void 0!==a&&a!==i&&(i=a,r="audio"===e?t._audioOrtc:t._videoOrtc,s="video"===e?t._rtxSsrcId:void 0,o={stream_type:"audio"===e?dS.AUDIO:dS.VIDEO,ssrcId:i}),cL.markSubscribeStart(this.store.clientId,i),this.store.subscribe(t.uid,e,Date.now()),await this._p2pChannel.subscribe(t,e,i,s,r);try{await this._gateway.subscribe(t.uid,o,!0)}catch(n){if((null==n?void 0:n.code)!==Bv.WS_ABORT)throw await this._p2pChannel.unsubscribe(t,e),n;await this._p2pChannel.unsubscribe(t,e,!0),this._p2pChannel.setPendingRemoteMedia(t,e)}this.store.subscribe(t.uid,e,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,t,e)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,t,e),n}zE.info("[".concat(this._clientId,"] subscribe success user ").concat(t.uid,", mediaType: ").concat(e)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(t.uid,this._defaultStreamFallbackType).catch((t=>{zE.warning("[".concat(this._clientId,"] auto set fallback failed"),t)}));const c="audio"===e?t._audioTrack:t._videoTrack;if(!c)throw new Bw(Bv.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(e){throw zE.error("[".concat(this._clientId,"] subscribe user ").concat(t.uid," error"),e),e}finally{a()}}async massSubscribe(t){if(Qv(t,"subscribeList"),!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const e=Date.now(),n=new Map,i=await this._subscribeMutex.lock();zE.info("[".concat(this._clientId,"]start massSubscribe user ").concat(t.map((t=>{let{user:e,mediaType:n}=t;return"user: ".concat(null==e?void 0:e.uid,", mediaType: ").concat(n)})).join("; ")));const r=(t=[...t]).map((t=>{let{user:e,mediaType:n}=t;return{user:e,mediaType:n}})),s=await this._p2pChannel.globalLock();try{var o;for(let e=t.length-1;e>=0;e--){const i=t[e],{user:s,mediaType:o}=i;if(Hv(o,"mediaType",["audio","video"]),!s){const t=new Bw(Bv.INVALID_PARAMS,"user property does not exist in subscribeList item");throw zE.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),t}if(!this._users.find((t=>t===s))){const n=new Bw(Bv.INVALID_REMOTE_USER,"user is not in the channel");zE.error("[".concat(this._clientId,"] can not massSubscribe ").concat(s.uid,", this user is not in the channel")),r[e].error=n,t.splice(e,1);continue}if("audio"===o&&(!s.hasAudio||void 0===s._audioSSRC)||"video"===o&&(!s.hasVideo||void 0===s._videoSSRC)){const n=new Bw(Bv.REMOTE_USER_IS_NOT_PUBLISHED);zE.error("[".concat(this._clientId,"] can not subscribe ").concat(s.uid," with mediaType ").concat(o,", remote user is not published")),r[e].error=n,t.splice(e,1);continue}const a=nS.Video|nS.LwoVideo,c=n.get(s);if(c){if("video"===o?c&a:c&nS.Audio){t.splice(e,1),zE.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(s.uid,", mediaType:").concat(o," twice"));continue}n.set(s,c|("video"===o?a:nS.Audio))}else n.set(s,"video"===o?a:nS.Audio)}for(let e=t.length-1;e>=0;e--){const i=t[e],{user:r,mediaType:s}=i,o=nS.Video|nS.LwoVideo;if(this._p2pChannel.hasRemoteMedia(r,s)){await this._p2pChannel.unmuteRemoteNoLock(r,s);const i=n.get(r);n.set(r,"video"===s?i^o:i^nS.Audio),t.splice(e,1)}}this.store.massSubscribe(t.map((t=>({userId:t.user.uid,type:t.mediaType}))),e);const a=c_(o=Array.from(n.entries())).call(o,((t,e)=>{let[n,i]=e;if(0===i)return t;const r={stream_id:n.uid,stream_type:i};return i&nS.Audio&&(r.audio_ssrc=n._audioSSRC),i&nS.Video&&(r.video_ssrc=n._videoSSRC),t.push(r),t}),[]);try{t.length>0&&await this._p2pChannel.massSubscribeNoLock(t.map((t=>{let{user:e,mediaType:n}=t;return{user:e,mediaType:n,ssrcId:n===dS.VIDEO?e._videoSSRC:e._audioSSRC,rtxSsrcId:n===dS.VIDEO?e._rtxSsrcId:void 0}})));const n=new Map;if(a.length>0){const t=await this._gateway.subscribeAll(a,!0);((null==t?void 0:t.users)||[]).forEach((t=>{let{stream_id:e,video_error_code:i,audio_error_code:r,error_code:s}=t;(i||r||s)&&n.set(e,{video_error_code:i,audio_error_code:r,error_code:s})}))}if(Array.from(n.entries()).length>0){const t=Array.from(n.entries()).map((t=>{let e,[n,i]=t;return i.error_code||i.video_error_code&&i.audio_error_code?e=void 0:i.video_error_code?e=dS.VIDEO:i.audio_error_code&&(e=dS.AUDIO),{user:this.remoteUsers.find((t=>t.uid===n)),mediaType:e}}));await this._p2pChannel.massUnsubscribeNoLock(t)}for(const t of r){const e=n.get(t.user.uid);if(e){const n=e.error_code||"audio"===t.mediaType&&e.audio_error_code||"video"===t.mediaType&&e.video_error_code;if(n){const e=DS(n);zE.error("user:".concat(t.user.uid," mediaType:").concat(t.mediaType," has massSubscribe error ").concat(e.desc)),t.error=new Bw(Bv.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(e.desc))}}t.error||("video"===t.mediaType?t.track=t.user.videoTrack:t.track=t.user.audioTrack)}return this.store.massSubscribe(r.filter((t=>!t.error)).map((t=>({userId:t.user.uid,type:t.mediaType}))),void 0,Date.now()),r.forEach((t=>{var n;rw.subscribe(this.store.sessionId,{succ:!!t.error,ec:(null===(n=t.error)||void 0===n?void 0:n.code)||null,video:t.mediaType===dS.VIDEO,audio:t.mediaType===dS.AUDIO,peerid:t.user.uid,subscribeRequestid:t.mediaType===dS.VIDEO?t.user._videoSSRC:t.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-e)},!0)})),zE.info("[".concat(this._clientId,"] massSubscribe success ").concat(t.map((t=>{let{user:e,mediaType:n}=t;return"user: ".concat(null==e?void 0:e.uid,", mediaType: ").concat(n)})).join("; "))),r}catch(e){throw await this._p2pChannel.massUnsubscribeNoLock(t),e}}finally{s(),i()}}async unsubscribe(t,e,n){if(e||this.store.useP2P){if("datachannel"===e)return this._unsubscribeDataChannel(t,n)}else await this._unsubscribeDataChannel(t,n);if(e&&Hv(e,"mediaType",["audio","video"]),!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((e=>e===t))){const e=new Bw(Bv.INVALID_REMOTE_USER,"user is not in the channel");throw zE.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),e}zE.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: ").concat(e));const i=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof MP)await this._gateway.sendExtensionMessage(IS.UNSUBSCRIBE,{mediaType:e});else{const n=await this._p2pChannel.unsubscribe(t,e);n&&await this._gateway.unsubscribe(n,t.uid),zE.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(t.uid,", mediaType: ").concat(e))}}catch(e){if(e.code===Bv.DISCONNECT_P2P)return void zE.warning("disconnecting p2p, abort unsubscribe request.");throw zE.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),e.toString()),e}finally{i()}}async _unsubscribeDataChannel(t,e){if(e&&Vv(e,"id",0,65535,!0),!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find((e=>e===t))){const e=new Bw(Bv.INVALID_REMOTE_USER,"user is not in the channel");throw zE.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid,", user is not in the channel")),e}let n;if("number"==typeof e){const i=t._dataChannels.find((t=>t.id===e));i&&(n=[i])}else n=t._dataChannels;if(void 0===n){const n=new Bw(Bv.REMOTE_USER_IS_NOT_PUBLISHED);throw zE.error("[".concat(this._clientId,"] can not unsubscribe ").concat(t.uid," with channelId ").concat(e,", remote datachannel is not published")),n}zE.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(n.map((t=>t.id))));try{const e=await this._p2pChannel.unsubscribeDataChannel(t,n);e&&await this._gateway.unsubscribeDataChannel(e,t.uid),zE.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(t.uid,", mediaType: datachannel, ids: ").concat(e))}catch(e){if(e.code===Bv.DISCONNECT_P2P)return void zE.warning("disconnecting p2p, abort unsubscribe request.");throw zE.error("[".concat(this._clientId,"] unsubscribe user ").concat(t.uid," error"),e.toString()),e}}async massUnsubscribe(t){if(Qv(t,"unsubscribeList"),!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");zE.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(t.map((t=>{let{user:e,mediaType:n}=t;return"user: ".concat(null==e?void 0:e.uid,", mediaType: ").concat(n,";")})).join())),t=[...t];const e=new Map;for(let n=t.length-1;n>=0;n--){const{user:i,mediaType:r}=t[n];if(!i){const t=new Bw(Bv.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw zE.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),t}if(Hv(r,"mediaType",["video","audio",void 0]),!this._users.find((t=>t===i))){zE.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),t.splice(n,1);continue}const s=nS.Video|nS.LwoVideo;if(e.has(i)){const o=e.get(i);let a;switch(r){case"video":a=o&s;break;case"audio":a=o&nS.Audio;break;default:a=o&(nS.Audio|s)}if(a){zE.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(i.uid,",mediaType:").concat(r," twice.")),t.splice(n,1);continue}r?"audio"===r?e.set(i,o|nS.Audio):"video"===r&&e.set(i,o|s):e.set(i,o|nS.Audio|s)}else r?"audio"===r?e.set(i,nS.Audio):"video"===r&&e.set(i,s):e.set(i,nS.Audio|s)}try{const e=await this._p2pChannel.massUnsubscribe(t);e&&await this._gateway.massUnsubscribe(e),zE.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(t.map((t=>{let{user:e,mediaType:n}=t;return"user: ".concat(null==e?void 0:e.uid,", mediaType: ").concat(n,";")})).join()))}catch(t){if(t.code===Bv.DISCONNECT_P2P)return void zE.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw zE.error("[".concat(this._clientId,"] massUnsubscribe error"),t.toString()),t}}async setLowStreamParameter(t){!function(t){if(!t)throw new Uv(Bv.INVALID_PARAMS);zv(t.width)||jv(t.width,"streamParameter.width"),zv(t.height)||jv(t.height,"streamParameter.height"),zv(t.framerate)||jv(t.framerate,"streamParameter.framerate"),zv(t.bitrate)||Vv(t.bitrate,"streamParameter.bitrate")}(t),(!t.width&&t.height||t.width&&!t.height)&&zE.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),zE.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(t));const e=this._configDistribute.getLowStreamConfigDistribute();if(e&&e.bitrate&&t.bitrate&&e.bitrate<t.bitrate&&(t.bitrate=e.bitrate),this._lowStreamParameter=t,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(t,pS.LocalVideoLowTrack)}async enableDualStream(){if(!pC().supportDualStream)throw rw.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Bw(Bv.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Bw(Bv.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(t){throw rw.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),t}this._isDualStreamEnabled=!0,rw.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),zE.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(pS.LocalVideoLowTrack))try{const t=await this._p2pChannel.unpublishLowStream();t&&await this._gateway.unpublish(t,this._joinInfo.stringUid||this._joinInfo.uid)}catch(t){throw rw.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),t}this._isDualStreamEnabled=!1,rw.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),zE.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(t,e){if(function(t){Hv(t,"role",["audience","host"])}(t),e&&my(e),"rtc"===this.mode)throw zE.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new Bw(Bv.INVALID_OPERATION,"rtc mode can not use setClientRole");if(e&&e.level&&"host"===t)throw new Bw(Bv.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===t&&this._p2pChannel.hasLocalMedia())throw new Bw(Bv.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(t,e),this._config.role=t,zE.info("[".concat(this._clientId,"] set client role to ").concat(t,", level: ").concat(e&&e.level))}getRemoteInboundOffset(){var t;const e=null===(t=this._p2pChannel.getStats())||void 0===t?void 0:t.audioSend[0];if(!e||!e.timestamp)return 0;const n=e.timestamp-Date.now();return Math.abs(n)>1e3+e.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?n:0}getNtpWallTimeInMs(){return"visible"===document.visibilityState&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(t,e){if(Gv(t,"proxyServer"),!e){if("DISCONNECTED"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new Bw(Bv.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=t,rw.setProxyServer(this._proxyServer),zE.setProxyServer(this._proxyServer),zE.info("[".concat(this._clientId,"] Set proxy server ").concat(e?"by initialize call":""," success."))}setTurnServer(t,e){if(Array.isArray(t)||(t=[t]),!e){if("DISCONNECTED"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new Bw(Bv.INVALID_OPERATION,"You have already set the proxy")}if(py(t))return this._turnServer={servers:t,mode:"original-manual"},void zE.info("[".concat(this._clientId,"] Set original turnserver ").concat(e?"by initialize call":""," success: ").concat(t.map((t=>t.urls)).join(","),"."));t.forEach((t=>fy(t))),this._turnServer={servers:t,mode:"manual"},zE.info("[".concat(this._clientId,"] Set turnserver ").concat(e?"by initialize call":""," success."))}setLicense(t){if("DISCONNECTED"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"you should set license before join channel");if(Gv(t,"license",32,32),!/^[A-Za-z\d]+$/.test(t))throw new Bw(Bv.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=t,zE.info("[".concat(this._clientId,"] set license success"),t)}startProxyServer(t){if("DISCONNECTED"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new Bw(Bv.INVALID_OPERATION,"You have already set the proxy");const e=[3,4,5];let n;switch(void 0===t&&(t=3),t){case 1:case 2:throw new Bw(Bv.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new Bw(Bv.INVALID_PARAMS,"proxy server mode must be ".concat(e.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,zE.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"Stop proxy server after leave channel");rw.setProxyServer(),zE.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",zE.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(t){if(!t.accessPoints)throw new Bw(Bv.INVALID_PARAMS,"accessPoints is required.");Qv(t.accessPoints.serverList,"accessPoints.serverList"),Gv(t.accessPoints.domain,"accessPoints.domain");const e=(t,e)=>{Vv(t,e,0,65535,!0)};let n=443;if(t.accessPoints.port&&(e(t.accessPoints.port,"accessPoints.port"),n=t.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new Bw(Bv.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");NE("CLOSE_AFB_FOR_LOCAL_AP")&&(kE("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),kE("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const i=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,r=t.accessPoints.domain,s=t.accessPoints.serverList.map((t=>i.test(t)?"".concat(t.replace(/\./g,"-"),".").concat(r):t)),o=s.map((t=>"".concat(t,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,kE("WEBCS_DOMAIN",o),kE("WEBCS_DOMAIN_BACKUP_LIST",o),kE("GATEWAY_DOMAINS",[r]),t.report&&t.report.hostname&&Array.isArray(t.report.hostname)&&t.report.hostname.length?(Qv(t.report.hostname,"report.hostname"),kE("EVENT_REPORT_DOMAIN",t.report.hostname[0]),kE("EVENT_REPORT_BACKUP_DOMAIN",t.report.hostname[1]||t.report.hostname[0])):(kE("EVENT_REPORT_DOMAIN",s[0]),kE("EVENT_REPORT_BACKUP_DOMAIN",s[1]||s[0]));let a=6443;t.report&&t.report.port&&(e(t.report.port,"report.port"),a=t.report.port),kE("STATS_COLLECTOR_PORT",a),t.report?kE("ENABLE_EVENT_REPORT",!0):kE("ENABLE_EVENT_REPORT",!1);let c="";t.log&&t.log.hostname&&Array.isArray(t.log.hostname)&&t.log.hostname.length?(Qv(t.log.hostname,"log.hostname"),c=t.log.hostname[0]):c=s[0];let l=6444;t.log&&t.log.port&&(e(t.log.port,"log.port"),l=t.log.port),kE("LOG_UPLOAD_SERVER","".concat(c,":").concat(l));let u=[];t.cds&&t.cds.hostname&&Array.isArray(t.cds.hostname)&&t.cds.hostname.length?(Qv(t.cds.hostname,"cds.hostname"),u=t.cds.hostname):u=s;let d=443;t.cds&&t.cds.port&&(e(t.cds.port,"cds.port"),d=t.cds.port),kE("CDS_AP",u.map((t=>"".concat(t,":").concat(d)))),t.cds?kE("ENABLE_CONFIG_DISTRIBUTE",!0):kE("ENABLE_CONFIG_DISTRIBUTE",!1),zE.info("set local access point v2 success")}setLocalAccessPoints(t,e){if(Qv(t,"serverList"),Gv(e,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new Bw(Bv.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;t=t.map((t=>n.test(t)?"".concat(t.replace(/\./g,"-"),".").concat(e):t)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,kE("WEBCS_DOMAIN",t),kE("WEBCS_DOMAIN_BACKUP_LIST",t),kE("GATEWAY_DOMAINS",[e]),kE("EVENT_REPORT_DOMAIN",t[0]),kE("EVENT_REPORT_BACKUP_DOMAIN",t[1]||t[0]),kE("LOG_UPLOAD_SERVER","".concat(t[0],":6444")),zE.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(t){if(Hv(t,"streamType",[0,1]),this._remoteDefaultVideoStreamType=t,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(t),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw zE.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else zE.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(t))}async setRemoteVideoStreamType(t,e){Hv(e,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(t,e),setTimeout((()=>{const e=this._users.find((e=>e.uid===t));e&&e.videoTrack&&e.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(t){throw zE.error("[".concat(this._clientId,"] set remote video stream type error"),t.toString()),t}zE.info("[".concat(this._clientId,"] set remote ").concat(t," video stream type to ").concat(e)),this._remoteStreamTypeCacheMap.set(t,e)}async setStreamFallbackOption(t,e){Hv(e,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(t,e)}catch(t){throw zE.error("[".concat(this._clientId,"] set stream fallback option"),t.toString()),t}zE.info("[".concat(this._clientId,"] set remote ").concat(t," stream fallback type to ").concat(e)),this._streamFallbackTypeCacheMap.set(t,e)}setEncryptionConfig(t,e,n){!function(t){Hv(t,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(t),Gv(e,"secret");const i=["aes-128-gcm2","aes-256-gcm2"];if(kr(i).call(i,t)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new Bw(Bv.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Bw(Bv.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(e)||zE.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=t,this._encryptionSecret=e,n&&(this._encryptionSalt=My(n))}async renewToken(t){if(Gv(t,"token",1,2047),!this._key||!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"renewToken should not be called before user join");const e=this._key;this._key=t,this._joinInfo&&(this._joinInfo.token=t);const n=await this._renewTokenMutex.lock();try{if(NE("USE_NEW_TOKEN")){zE.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const e=await mM(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qy);zE.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:t,ticket:e})}else zE.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:t});zE.debug("[".concat(this._clientId,"] renewToken success"))}catch(t){throw this._key=e,this._joinInfo.token=e,zE.error("[".concat(this._clientId,"] renewToken failed"),t.toString()),t}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?zE.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const t=this._p2pChannel.getAudioLevels();this.safeEmit(ly.VOLUME_INDICATOR,t)}),NE("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const t=this._statsCollector.getRTCStats(),e=this._gateway.getInChannelInfo();return t.Duration=Math.round(e.duration/1e3),t}async startLiveStreaming(t,e){if(!e){if("h264"!==this.codec)throw new Bw(Bv.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Bw(Bv.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(t)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(t))throw new Bw(Bv.LIVE_STREAMING_TASK_CONFLICT);const n=e?Tw.TRANSCODE:Tw.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(t,n)}setLiveTranscoding(t){return this._createLiveStreamingClient(Tw.TRANSCODE).setTranscodingConfig(t)}async stopLiveStreaming(t){const e=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((e=>e&&e.hasUrl(t)));if(!e.length)throw new Bw(Bv.INVALID_PARAMS,"can not find live streaming url to stop");await ev.all(e.map((e=>e&&e.stopLiveStreamingTask(t))))}async addInjectStreamUrl(t,e){if(!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(Tw.INJECT);n.setInjectStreamConfig(e,0),await n.startLiveStreamingTask(t,Tw.INJECT)}async removeInjectStreamUrl(){var t;const e=this._createLiveStreamingClient(Tw.INJECT),n=Array.from(Nw(t=e.streamingTasks).call(t)).find((t=>t.mode===Tw.INJECT));if(!this._joinInfo||!n)throw new Bw(Bv.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await e.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(t){RM(t);const e=this._createChannelMediaRelayClient();await e.startChannelMediaRelay(t)}async updateChannelMediaRelay(t){RM(t);const e=this._createChannelMediaRelayClient();await e.updateChannelMediaRelay(t)}async stopChannelMediaRelay(){const t=this._createChannelMediaRelayClient();await t.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"can not send data stream, not joined");if(("string"==typeof t||t instanceof Uint8Array)&&(t={payload:t}),"string"==typeof t.payload){const e=new TextEncoder;t.payload=e.encode(t.payload)}if(new Blob([t.payload]).size>1024)throw new Bw(Bv.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(yw.DATA_STREAM,{payload:My(t.payload),syncWithAudio:t.syncWithAudio,sendTs:Date.now()-DP},!e)}sendMetadata(t){if(!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([t]).size>1024)throw new Bw(Bv.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(yw.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:My(t)})}async sendCustomReportMessage(t){if(Array.isArray(t)||(t=[t]),t.forEach(qE),!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"can not send custom report, not joined");await rw.sendCustomReportMessage(this._joinInfo.sid,t)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(t,e){Hv(e.spatialLayer,"spatialLayer",[0,1,2,3]),Hv(e.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(t,e)}catch(t){throw zE.error("[".concat(this._clientId,"] pick SVC layer failed"),t.toString()),t}}setRTM2Flag(t){if(Hv(t,"flag",[0,1]),!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(t)}_reset(){if(zE.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=fE.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach((t=>{t._audioTrack&&t._audioTrack._destroy(),t._videoTrack&&t._videoTrack._destroy(),t._dataChannels&&(t._dataChannels.forEach((t=>t._close())),t._dataChannels.length=0)})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Wy("client-publish"),this._subscribeMutex=new Wy("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(t){}if(this._moderation)try{this.setImageModeration(!1)}catch(t){}}_startSession(t,e){const n=t||Uy();t?zE.debug("[".concat(this._clientId,"] new Session ").concat(n)):zE.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,e?rw.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:e.channel,appid:e.appId,mode:this.mode}):this._joinInfo?rw.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&rw.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(t){if(!this._joinInfo||void 0===this._uid)throw new Bw(Bv.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&NE("FORCE_TURN")&&!NE("TURN_ENABLE_TCP")&&!NE("TURN_ENABLE_UDP"))throw new Bw(Bv.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");zE.debug("[".concat(this._clientId,"] publish high stream"));try{if(this._p2pChannel instanceof MP){const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter);if(n)try{await this._gateway.sendExtensionMessage(IS.PUBLISH,n)}catch(e){throw this._p2pChannel.unpublish(t),e}}else{const n=await this._p2pChannel.publish(t,this._isDualStreamEnabled,this._lowStreamParameter),i=(await n.next()).value;if(i){var e;let r;try{r=await this._gateway.publish(this._uid,i,!0)}catch(t){if(t.code!==Bv.DISCONNECT_P2P)throw n.throw(t),t}await n.next((null===(e=r)||void 0===e?void 0:e.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const e of t)e instanceof _R&&e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig),!e.muted&&e.enabled||await this._p2pChannel.muteLocalTrack(e)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,t),(null==e?void 0:e.code)===Bv.WS_ABORT)return;throw e}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new Bw(Bv.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Bw(Bv.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));zE.debug("[".concat(this._clientId,"] publish low stream"));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&t.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=t.bitrate));try{const t=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await t.next()).value;if(n){var e;let i;try{i=await this._gateway.publish(this._uid,n,!0)}catch(e){if(e.code!==Bv.DISCONNECT_P2P)throw t.throw(e),e}t.next((null===(e=i)||void 0===e?void 0:e.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,void 0,!0),(null==t?void 0:t.code)===Bv.WS_ABORT)return;throw t}}_createLiveStreamingClient(t){if(!this._joinInfo||!this._appId)return new Bw(Bv.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const e=()=>new TM(this._joinInfo,this._config.websocketRetryConfig||qy,this._config.httpRetryConfig||qy),n=t=>{t.onLiveStreamError=(t,e)=>{rw.reportApiInvoke(this._sessionId,{name:sy.ON_LIVE_STREAM_ERROR,options:[t,e],tag:oy.TRACER}).onSuccess(),this.safeEmit(ly.LIVE_STREAMING_ERROR,t,e)},t.onLiveStreamWarning=(t,e)=>{rw.reportApiInvoke(this._sessionId,{name:sy.ON_LIVE_STREAM_WARNING,options:[t,e],tag:oy.TRACER}).onSuccess(),this.safeEmit(ly.LIVE_STREAMING_WARNING,t,e)},t.on(Ww.REQUEST_WORKER_MANAGER_LIST,((t,e,n)=>{if(!this._joinInfo)return n(new Bw(Bv.INVALID_OPERATION,"can not find join info to get worker manager"));pM(t,this._joinInfo,this._axiosCancelSource.token,qy).then(e).catch(n)}))};switch(t){case Tw.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=e(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Tw.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=e(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Tw.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=e(),this._injectStreamingClient.on(Ww.REQUEST_WORKER_MANAGER_LIST,((t,e,n)=>{if(!this._joinInfo)return n(new Bw(Bv.INVALID_OPERATION,"can not find join info to get worker manager"));pM(t,this._joinInfo,this._axiosCancelSource.token,qy).then(e).catch(n)})),this._injectStreamingClient.onInjectStatusChange=(t,e,n)=>{this.safeEmit(ly.INJECT_STREAM_STATUS,t,e,n)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Bw(Bv.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:t,sendResolutionHeight:e}=this.getLocalVideoStats(),n={width:t,height:e};this._channelMediaRelayClient=new xM(this._joinInfo,this._clientId,this._config.websocketRetryConfig||qy,this._config.httpRetryConfig||qy,n),this._channelMediaRelayClient.on("state",(t=>{t===Xw.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(ly.CHANNEL_MEDIA_RELAY_STATE,t)})),this._channelMediaRelayClient.on("event",(t=>{this.safeEmit(ly.CHANNEL_MEDIA_RELAY_EVENT,t)})),this._statsCollector.onStatsChanged=(t,e)=>{var n;"resolution"===t&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(e))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(t,e){const{added:n,deleted:i}=t,r=[];Array.isArray(n)&&n.length>0&&n.forEach((t=>{const{uid:n,stream_id:i,ordered:s,max_retrans_times:o,metadata:a}=t,c=this._users.find((t=>t._uintid===n));if(c){if(zE.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(n)),kr(r).call(r,c)||r.push(c),c._uintid||(c._uintid=n),-1===c._dataChannels.findIndex((e=>e.id===t.stream_id))){const t={id:i,ordered:!!s,maxRetransmits:o,metadata:a},n=new rL(t);c._dataChannels.push(n),zE.info("[".concat(this._clientId,"] remote user ").concat(c.uid," published datachannel")),e||this.safeEmit(ly.USER_PUBLISHED,c,"datachannel",t)}this._p2pChannel.hasPendingRemoteDataChannel(c,t.stream_id)&&(zE.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(c.uid," after reconnect.")),this._subscribeDataChannel(c,t.stream_id).catch((t=>{zE.error("[".concat(this._clientId,"] resubscribe datachannel error"),t.toString())})))}else zE.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"))})),e&&(this.safeEmit(ly.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(i)&&i.length>0&&i.forEach((t=>{const{uid:e,stream_id:n}=t,i=this._users.find((t=>t._uintid===e));if(!i)return void zE.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const r=i._dataChannels.find((e=>e.id===t.stream_id));r&&(zE.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(e)),this._p2pChannel.unsubscribeDataChannel(i,[r]).then((t=>{if(t)return i._dataChannels=i._dataChannels.filter((t=>t!==r)),this._gateway.unsubscribeDataChannel(t,i.uid)})),zE.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished datachannel ,id:").concat(r.id)),this.safeEmit(ly.USER_UNPUBLISHED,i,"datachannel",r._config))}))}_handleRemoveDataChannels(t){const e=this._users.find((e=>e.uid===t.uid));if(e){if(void 0!==e._dataChannels&&e._dataChannels.length>0){zE.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(t.uid));const n=()=>{zE.info("[".concat(this._clientId,"] remote user ").concat(e.uid," unpublished datachannel")),e._dataChannels.forEach((t=>{this.safeEmit(ly.USER_UNPUBLISHED,e,"datachannel",t._config)}))};this._p2pChannel.unsubscribeDataChannel(e,e._dataChannels).then((t=>{if(t)return this._gateway.unsubscribeDataChannel(t,e.uid)})),n()}}else zE.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(tS.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(tS.CONNECTION_STATE_CHANGE,((t,e,n)=>{var i;if(n===cy.FALLBACK)return;const r=()=>{this.safeEmit(ly.CONNECTION_STATE_CHANGE,t,e,n)};if(rw.reportApiInvoke(this._sessionId||(null===(i=this._gateway.joinInfo)||void 0===i?void 0:i.sid)||null,{name:sy.CONNECTION_STATE_CHANGE,options:[t,e,n],tag:oy.TRACER}).onSuccess(JSON.stringify({cur:t,prev:e,reason:n})),zE.info("[".concat(this._clientId,"] connection state change: ").concat(e," -> ").concat(t)),"DISCONNECTED"===t)return this._reset(),void r();if("RECONNECTING"===t)this._users.forEach((t=>{t._trust_in_room_=!1,t._trust_audio_enabled_state_=!1,t._trust_video_enabled_state_=!1,t._trust_audio_mute_state_=!1,t._trust_video_mute_state_=!1,t._trust_audio_stream_added_state_=!1,t._trust_video_stream_added_state_=!1,t._audioSSRC=void 0,t._videoSSRC=void 0,t._videoOrtc=void 0,t._audioOrtc=void 0,t._cname=void 0,t._rtxSsrcId=void 0})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===t){var s;this._streamFallbackTypeCacheMap.forEach(((t,e)=>{this._gateway.setStreamFallbackOption(e,t).catch((t=>{zE.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),t)}))})),this._remoteStreamTypeCacheMap.forEach(((t,e)=>{this._gateway.setRemoteVideoStreamType(e,t).catch((t=>{zE.warning("[".concat(this._clientId,"] auto set remote stream type failed"),t)}))})),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(s=this._joinInfo)||void 0===s?void 0:s.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{zE.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((t=>{zE.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(t))})),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter((t=>!t._trust_in_room_)).forEach((t=>{zE.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(t.uid)),this._handleUserOffline({uid:t.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach((t=>{t._trust_audio_mute_state_||(zE.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(t.uid)),this._handleMuteStream(t.uid,dS.AUDIO,!1)),t._trust_video_mute_state_||(zE.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(t.uid)),this._handleMuteStream(t.uid,dS.VIDEO,!1)),t._trust_audio_enabled_state_||(zE.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(t.uid)),this._handleSetStreamLocalEnable("audio",t.uid,!0)),t._trust_video_enabled_state_||(zE.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(t.uid)),this._handleSetStreamLocalEnable("video",t.uid,!0)),t._trust_video_stream_added_state_||(zE.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(t.uid)),this._handleResetAddStream(t,"video")),t._trust_audio_stream_added_state_||(zE.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(t.uid)),this._handleResetAddStream(t,"audio")),t._video_added_||t._audio_added_||(zE.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(t.uid)),this._handleRemoveStream({uid:t.uid,uint_id:t._uintid}))})))}),1e3))}r()})),this._gateway.on(tS.REQUEST_NEW_GATEWAY_LIST,((t,e)=>{if(!this._joinInfo)return e(new Bw(Bv.UNEXPECTED_ERROR,"can not recover, no join info"));lM(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||qy,this.store).then((e=>{this._joinInfo&&(this._joinInfo.apResponse=e.gatewayInfo.res,this._joinInfo.gatewayAddrs=e.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=e.gatewayInfo.uni_lbs_ip);const n=[];e.gatewayInfo.gatewayAddrs.forEach((t=>{let{address:e}=t;const[i,r]=e.split(":");this._joinInfo&&this._joinInfo.proxyServer?n.push({proxy:this._joinInfo.proxyServer,host:i,port:r}):n.push({host:i,port:r})})),t(n)})).catch(e)})),this._gateway.on(tS.NETWORK_QUALITY,(t=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(ly.NETWORK_QUALITY,t)})),this._gateway.on(tS.STREAM_TYPE_CHANGE,((t,e)=>{this.safeEmit(ly.STREAM_TYPE_CHANGED,t,e),rw.reportApiInvoke(this._sessionId,{name:sy.STREAM_TYPE_CHANGE,options:[t,e],tag:oy.TRACER}).onSuccess(JSON.stringify({uid:t,streamType:e}))})),this._gateway.on(tS.IS_P2P_DISCONNECTED,(t=>{this._p2pChannel.isP2PDisconnected()?t(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?t(!1):t(!0)})),this._gateway.on(tS.NEED_RENEW_SESSION,(()=>{this._startSession()})),this._gateway.on(tS.REQUEST_P2P_CONNECTION_PARAMS,(async(t,e,n)=>{try{e(await this._p2pChannel.startP2PConnection(t))}catch(t){n(t)}})),this._gateway.on(tS.JOIN_RESPONSE,((t,e)=>{if(this.store.useP2P)return;const{dtlsParameters:n,iceParameters:i,candidates:r,rtpCapabilities:s,setup:o,cname:a}=XM(t.ortc,e);this._p2pChannel.connect(i,n,r,s,o,a)})),this._gateway.on(tS.REQUEST_DC_CONNECTION_PARAMS,(t=>{t(this._p2pChannel.getEstablishParams())})),this._gateway.on(tS.RESET_SIGNAL,(t=>{this._p2pChannel.resetConnection(t),this._handleGatewaySignalEvents()})),this._gateway.on(tS.DATACHANNEL_FAILBACK,(()=>{this._joinGateway()})),this._gateway.on(tS.DATACHANNEL_PRECONNECT,(async(t,e,n,i)=>{var r,s,o,a,c,l;await this._p2pChannel.startP2PConnection({turnServer:null===(r=this._joinInfo)||void 0===r?void 0:r.turnServer},!0);const u=function(t,e){let n;return e&&e.ip&&"number"==typeof e.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],zE.debug("Using remote candidate from AP ".concat(e.ip,":").concat(e.port)),e.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),zE.debug("Using IPV6 remote candidate from AP ".concat(e.ip6,":").concat(e.port)))):n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],n}(t,e);return this._p2pChannel.preConnect({iceUfrag:"".concat(null===(s=this._joinInfo)||void 0===s?void 0:s.apResponse.cid,"_").concat(null===(o=this._joinInfo)||void 0===o?void 0:o.apResponse.cert),icePwd:"".concat(null===(a=this._joinInfo)||void 0===a?void 0:a.apResponse.cid,"_").concat(null===(c=this._joinInfo)||void 0===c?void 0:c.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(l=NE("FINGERPRINT"))&&void 0!==l?l:t.fingerprint}]},u,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(i)}))}_handleGatewaySignalEvents(){this._gateway.signal.on(bw.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(bw.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(bw.ON_ADD_AUDIO_STREAM,(t=>this._handleAddAudioOrVideoStream("audio",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc))),this._gateway.signal.on(bw.ON_ADD_VIDEO_STREAM,(t=>this._handleAddAudioOrVideoStream("video",t.uid,t.ssrcId,t.cname,t.uint_id,t.ortc,t.rtxSsrcId))),this._gateway.signal.on(bw.ON_REMOTE_DATASTREAM_UPDATE,(t=>{this._handleUpdateDataChannel(t)})),this._gateway.signal.on(bw.ON_REMOTE_FULL_DATASTREAM_INFO,(t=>{this._handleUpdateDataChannel({added:t.datastreams,deleted:[]},!0)})),this._gateway.signal.on(bw.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(bw.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(bw.MUTE_AUDIO,(t=>this._handleMuteStream(t.uid,dS.AUDIO,!0))),this._gateway.signal.on(bw.UNMUTE_AUDIO,(t=>this._handleMuteStream(t.uid,dS.AUDIO,!1))),this._gateway.signal.on(bw.MUTE_VIDEO,(t=>this._handleMuteStream(t.uid,dS.VIDEO,!0))),this._gateway.signal.on(bw.UNMUTE_VIDEO,(t=>this._handleMuteStream(t.uid,dS.VIDEO,!1))),this._gateway.signal.on(bw.RECEIVE_METADATA,(t=>{const e=Ly(t.metadata);this.safeEmit(ly.RECEIVE_METADATA,t.uid,e)})),this._gateway.signal.on(bw.ON_DATA_STREAM,(async t=>{if(!t)return;let e=0;if(t.ordered||t.syncWithAudio){const n=this._p2pChannel.getStats(),i=this.remoteUsers.find((e=>e.uid===t.uid)),r=null==n?void 0:n.audioRecv.find((t=>t.ssrc===(null==i?void 0:i._audioSSRC)));e=null==r?void 0:r.jitterBufferMs}null==e&&(e=0),jP(t,e,{id:this._clientId,onStreamMessage:"function"==typeof this.onStreamMessage?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})})),this._gateway.signal.on(bw.ON_CRYPT_ERROR,(()=>{Oy((()=>{zE.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(ly.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(bw.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(bw.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{zE.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,cy.TOKEN_EXPIRE),this.safeEmit(ly.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(bw.ON_STREAM_FALLBACK_UPDATE,(t=>{zE.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(t.stream_id,", attr: ").concat(t.stream_type)),this.safeEmit(ly.STREAM_FALLBACK,t.stream_id,1===t.stream_type?"fallback":"recover")})),this._gateway.signal.on(bw.ON_PUBLISH_STREAM,(t=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:t.proxy})),zE.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(t))))})),this._gateway.signal.on(bw.ENABLE_LOCAL_VIDEO,(t=>{this._handleSetStreamLocalEnable("video",t.uid,!0)})),this._gateway.signal.on(bw.DISABLE_LOCAL_VIDEO,(t=>{this._handleSetStreamLocalEnable("video",t.uid,!1)})),this._gateway.signal.on(vw.REQUEST_TIMEOUT,((t,e)=>{if(this._joinInfo)switch(t){case yw.PUBLISH:{if(!e)return;const t=e.ortc;if(t){var n,i;const r=t.some((t=>{let{stream_type:e}=t;return e===Zw.Audio})),s=t.some((t=>{let{stream_type:e}=t;return e!==Zw.Audio})),o=t.some((t=>{let{stream_type:e}=t;return e===Zw.Screen||e===Zw.ScreenLow}));"offer"===e.state&&rw.publish(this._joinInfo.sid,{eventElapse:cL.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Bv.TIMEOUT,audio:r,video:s,p2pid:e.p2p_id,publishRequestid:this.store.pubId,screenshare:o,audioName:r?null===(n=t.find((t=>{let{stream_type:e}=t;return e===Zw.Audio})))||void 0===n||null===(n=n.ssrcs[0])||void 0===n?void 0:n.ssrcId.toString():void 0,videoName:s?null===(i=t.find((t=>{let{stream_type:e}=t;return e!==Zw.Audio})))||void 0===i||null===(i=i.ssrcs[0])||void 0===i?void 0:i.ssrcId.toString():void 0})}break}case yw.SUBSCRIBE:e&&rw.subscribe(this._joinInfo.sid,{succ:!1,ec:Bv.TIMEOUT,audio:e.stream_type===dS.AUDIO,video:e.stream_type===dS.VIDEO,peerid:e.stream_id,subscribeRequestid:e.ssrcId,p2pid:this.store.p2pId,eventElapse:cL.measureFromSubscribeStart(this.store.clientId,e.ssrcId)})}})),this._gateway.signal.on(bw.ON_P2P_OK,(t=>{this.uid,this._uid})),this._gateway.signal.on(bw.ON_PUBLISHED_USER_LIST,(t=>{if(null==t||!t.users)return;NE("BLOCK_LOCAL_CLIENT")&&(t.users=t.users.filter((t=>!lw(t.string_id||t.stream_id,this.channelName))));const e=[],n=[];for(const i of t.users){let t=this._users.find((t=>t._uintid===i.stream_id));t?t._trust_in_room_=!0:(t=new OM(i.string_id||i.stream_id,i.stream_id),this._users.push(t),0===this.getListeners(ly.PUBLISHED_USER_LIST).length&&(zE.debug("[".concat(this._clientId,"] user online"),i.stream_id),this.safeEmit(ly.USER_JOINED,t)));const r=nS.Audio&i.stream_type,s=(nS.Video|nS.LwoVideo)&i.stream_type,o=0!=(65280&i.stream_type),a=r&&t.hasAudio,c=s&&t.hasVideo;s&&(t._trust_video_stream_added_state_=!0,t._video_added_=!0,t._videoSSRC=i.video_ssrc,t._rtxSsrcId=i.video_rtx),r&&(t._trust_audio_stream_added_state_=!0,t._audio_added_=!0,t._audioSSRC=i.audio_ssrc),r&&!a&&0===this.getListeners(ly.PUBLISHED_USER_LIST).length&&(zE.info("[".concat(this._clientId,"] remote user ").concat(t.uid," published audio")),this.safeEmit(ly.USER_PUBLISHED,t,"audio")),s&&!c&&0===this.getListeners(ly.PUBLISHED_USER_LIST).length&&(zE.info("[".concat(this._clientId,"] remote user ").concat(t.uid," published video")),this.safeEmit(ly.USER_PUBLISHED,t,"video")),(r&&!a||s&&!c||o)&&e.push(t),s&&this._p2pChannel.hasPendingRemoteMedia(t,"video")&&n.push({user:t,mediaType:"video"}),r&&this._p2pChannel.hasPendingRemoteMedia(t,"audio")&&n.push({user:t,mediaType:"audio"})}n.length>0&&(zE.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((t=>"user: ".concat(t.user.uid,", mediaType: ").concat(t.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((t=>{zE.error("[".concat(this._clientId,"] mass resubscribe error"),t.toString())}))),this.getListeners(ly.PUBLISHED_USER_LIST).length>0?NE("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=e:(zE.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(e.map((t=>t.uid)).join(", "))),this.safeEmit(ly.PUBLISHED_USER_LIST,e)):zE.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(e.map((t=>t.uid)).join(", ")))})),this._gateway.signal.on(bw.ON_RTP_CAPABILITY_CHANGE,(t=>{const{video_codec:e}=t;this._p2pChannel instanceof pN&&this._p2pChannel.updateRemoteRTPCapabilities(e.map((t=>t.toLowerCase())).filter((t=>{var e;return kr(e=Object.keys(DE)).call(e,t)})))}))}_handleP2PEvents(){this._gateway.signal.on(bw.ON_USER_OFFLINE,(()=>{this._p2pChannel.disconnectForReconnect()})),this._gateway.signal.on(IS.PUBLISH,(async(t,e)=>{t.forEach((t=>t.kind===dS.VIDEO?(this._handleP2PAddAudioOrVideoStream("video",e),t.isMuted?this._handleMuteStream(e,dS.VIDEO,!0):this._handleMuteStream(e,dS.VIDEO,!1)):(this._handleP2PAddAudioOrVideoStream("audio",e),t.isMuted?this._handleMuteStream(e,dS.AUDIO,!0):this._handleMuteStream(e,dS.AUDIO,!1))))})),this._gateway.signal.on(vw.P2P_START,(async(t,e)=>{var n;this._p2pChannel instanceof MP&&e(await this._p2pChannel.startP2P({turnServer:null===(n=this._joinInfo)||void 0===n?void 0:n.turnServer},t))})),this._gateway.signal.on(vw.P2P_CONNECTION,(async t=>{this._p2pChannel instanceof MP&&await this._p2pChannel.p2pConnect(t)})),this._gateway.signal.on(vw.P2P_REMOTE_CANDIDATE_UPDATE,(t=>{this._p2pChannel instanceof MP&&this._p2pChannel.addRemoteCandidate(JSON.parse(t))})),this._gateway.signal.on(IS.SUBSCRIBE,(async(t,e,n)=>{if(this._p2pChannel instanceof MP){const{trackType:i}=JSON.parse(t);try{await this._p2pChannel.dopublish(i),e()}catch(t){n(t)}}})),this._gateway.signal.on(IS.UNSUBSCRIBE,(async(t,e,n)=>{if(this._p2pChannel instanceof MP){const{mediaType:i}=JSON.parse(t);try{await this._p2pChannel.doUnpublish(i),e()}catch(t){n(t)}}})),this._gateway.signal.on(IS.EXCHANGE_SDP,(async(t,e,n)=>{if(this._p2pChannel instanceof MP){const{type:i,sdp:r}=JSON.parse(t);try{e(await this._p2pChannel.setDescription(i,r))}catch(t){n(t)}}})),this._gateway.signal.on(IS.UNPUBLISH,(async(t,e,n)=>{if(this._p2pChannel instanceof MP){const{unpubMsg:i,uid:r}=t;if(1===i.length){const s=i[0].stream_type===Zw.Audio?dS.AUDIO:dS.VIDEO;this._handleMuteStream(r,s,!0);const{sdp:o}=t;if(this._p2pChannel instanceof MP&&o){const t=this._users.find((t=>t.uid===r));if(!t)return zE.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(r)),void e();this._p2pChannel.unsubscribe(t,o,s).then((t=>{t&&e(t)})).catch(n)}else e()}else this._handleRemoveStream(t,e,n)}})),this._gateway.signal.on(IS.CONTROL,(async(t,e,n)=>{const{action:i,sdp:r,isMuteAll:s,uid:o}=t;switch(i){case xS.MUTE_LOCAL_VIDEO:this._handleMuteStream(o,dS.VIDEO,!0,r,e,n);break;case xS.MUTE_LOCAL_AUDIO:e(),this._handleMuteStream(o,dS.AUDIO,!0);break;case xS.UNMUTE_LOCAL_VIDEO:e(),this._handleP2PAddAudioOrVideoStream("video",o),this._handleMuteStream(o,dS.VIDEO,!1);break;case xS.UNMUTE_LOCAL_AUDIO:e(),this._handleP2PAddAudioOrVideoStream("audio",o),this._handleMuteStream(o,dS.AUDIO,!1)}s&&this._handleRemoveStream(t,e,n)})),this._gateway.signal.on(IS.DO_SUBSCRIBE,(async(t,e,n)=>{if(this._p2pChannel instanceof MP){const{kind:i,sdp:r,ssrcId:s,uid:o}=t,a=this._users.find((t=>t.uid===o));if(!a)return zE.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void e();try{e(await this._p2pChannel.subscribe(a,i,r,s))}catch(t){n(t)}}})),this._gateway.signal.on(IS.DO_UNSUBSCRIBE,(async(t,e,n)=>{if(this._p2pChannel instanceof MP){const{uid:i,kind:r,sdp:s}=t,o=this._users.find((t=>t.uid===i));if(!o)return zE.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void e();try{e(await this._p2pChannel.unsubscribe(o,s,r))}catch(t){n(t)}}})),this._gateway.signal.on(IS.RESTART_ICE,(async(t,e,n)=>{if(this._p2pChannel instanceof MP)try{e(await this._p2pChannel.setDescription("remote",t))}catch(t){n(t)}})),this._p2pChannel.on(mS.RequestP2PRestartICE,(async(t,e,n)=>{try{e(await this._gateway.sendExtensionMessage(IS.RESTART_ICE,t))}catch(t){n(t)}})),this._p2pChannel.on(mS.LocalCandidate,(t=>{this._gateway.sendExtensionMessage(IS.CANDIDATE,JSON.stringify(t))})),this._p2pChannel.on(mS.RequestP2PMuteLocal,(async(t,e,n)=>{try{e(await this._gateway.sendExtensionMessage(IS.CONTROL,t))}catch(t){n(t)}})),this._p2pChannel.on(mS.RequestP2PPublish,(async(t,e,n)=>{try{e(await this._gateway.sendExtensionMessage(IS.DO_SUBSCRIBE,t))}catch(t){n(t)}})),this._p2pChannel.on(mS.RequestP2PUnPublish,(async(t,e,n)=>{try{e(await this._gateway.sendExtensionMessage(IS.DO_UNSUBSCRIBE,t))}catch(t){n(t)}})),this._p2pChannel.on(mS.RequestP2PUnmuteRemote,(async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(t){t.code===Bv.DISCONNECT_P2P?e():n(t)}else e()})),this._p2pChannel.on(mS.RequestP2PMuteRemote,(async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteRemote(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(t){t.code===Bv.DISCONNECT_P2P?e():n(t)}else e()})),this._p2pChannel.on(mS.StateChange,((t,e)=>{e===fS.Connected&&this._p2pChannel.republish()}))}_handleP2PChannelEvents(){this._p2pChannel.on(mS.RequestMuteLocal,(async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(t){t.code===Bv.DISCONNECT_P2P?e():n(t)}else e()})),this._p2pChannel.on(mS.RequestUnmuteLocal,(async(t,e,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(t,this._joinInfo.stringUid||this._joinInfo.uid),e()}catch(t){t.code===Bv.DISCONNECT_P2P?e():n(t)}else e()})),this._p2pChannel.on(mS.RequestRePublish,((t,e,n)=>{this.publish(t,!1).then(e).catch(n)})),this._p2pChannel.on(mS.RequestRePublishDataChannel,((t,e,n)=>{ev.all(t.map((async t=>{await this._p2pChannel.publishDataChannel([t]);const e={streamId:t.id,ordered:t.ordered,maxRetransmits:t.maxRetransmits,metadata:t.metadata,channelId:t._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,e,!0)}catch(t){if(t.code!==Bv.DISCONNECT_P2P)throw t}}))).then(e).catch(n)})),this._p2pChannel.on(mS.RequestReSubscribe,(async(t,e,n)=>{try{for(const{user:e,kind:n}of t)n===dS.VIDEO?await this.subscribe(e,"video"):await this.subscribe(e,"audio");e()}catch(t){n(t)}})),this._p2pChannel.on(mS.RequestUploadStats,((t,e)=>{this._gateway.uploadStats(t,e)})),this._p2pChannel.on(mS.MediaReconnectStart,(t=>{this.safeEmit(ly.MEDIA_RECONNECT_START,t)})),this._p2pChannel.on(mS.MediaReconnectEnd,(t=>{this.safeEmit(ly.MEDIA_RECONNECT_END,t)})),this._p2pChannel.on(mS.NeedSignalRTT,(t=>{t(this._gateway.getSignalRTT())})),this._p2pChannel.on(mS.RequestRestartICE,(async t=>{if(this._p2pChannel instanceof MP)return;const e=await this._p2pChannel.restartICE(t),n=await e.next();if(n.done)return;const i=n.value;let r;try{r=await this._gateway.restartICE({iceParameters:i})}catch(t){return void e.throw(t)}const{iceParameters:s}=function(t){const e=t.iceParameters;return{iceParameters:{iceUfrag:e.iceUfrag,icePwd:e.icePwd}}}(r);await e.next({remoteIceParameters:s})})),this._p2pChannel.on(mS.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(mS.RequestReconnectPC,(async()=>{var t;const{iceParameters:e,dtlsParameters:n,rtpCapabilities:i}=await this._p2pChannel.startP2PConnection({turnServer:null===(t=this._joinInfo)||void 0===t?void 0:t.turnServer}),{gatewayEstablishParams:r,gatewayAddress:s}=await this._gateway.reconnectPC({iceParameters:e,dtlsParameters:n,rtpCapabilities:i}),{dtlsParameters:o,iceParameters:a,candidates:c,rtpCapabilities:l,setup:u,cname:d}=XM(r,s);await this._p2pChannel.connect(a,o,c,l,u,d),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(mS.RequestUnpublishForReconnectPC,(async(t,e,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(t,this._uid),e()):n()})),this._p2pChannel.on(mS.P2PLost,(()=>{this.safeEmit(ly.P2P_LOST,this.store.uid)})),this._p2pChannel.on(mS.UpdateVideoEncoder,(t=>{t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig)})),this._p2pChannel.on(mS.ConnectionTypeChange,(t=>{this.safeEmit(ly.IS_USING_CLOUD_PROXY,t)})),this._p2pChannel.on(mS.RequestLowStreamParameter,(t=>{t(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(mS.QueryClientConnectionState,(t=>{t(this.connectionState)}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(t){if("CONNECTED"!==this.connectionState||!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new Bw(Bv.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!t)throw new Bw(Bv.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!t.inspectType||!Array.isArray(t.inspectType))throw new Bw(Bv.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const e=[...new Set(t.inspectType)];e.forEach((t=>{var e;if(!kr(e=["supervise","moderation"]).call(e,t))throw new Bw(Bv.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(t," is not a valid inspect type."))})),t.inspectType=e}if(t&&t.extraInfo&&t.extraInfo.length>1024)throw new Bw(Bv.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const e=new zN(t);this._inspect=e,this.handleVideoInspectEvents(this._inspect),await e.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},qy)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new Bw(Bv.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}async setImageModeration(t,e){if(Fv(t,"enabled"),t){if(!e)throw new Bw(Bv.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(Vv(e.interval,"interval",1e3,1/0),"CONNECTED"!==this.connectionState||!this._joinInfo)throw new Bw(Bv.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(e);const t=new SP(e);this._moderation=t,this.handleImageModerationEvents(this._moderation),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},qy)}catch(t){throw Array.isArray(t)?t[0]:t}}else{if(!this._moderation)throw new Bw(Bv.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(t){throw Array.isArray(t)?t[0]:t}}}handleImageModerationEvents(t){t.on(CS.CONNECTION_STATE_CHANGE,((e,n)=>{if(this.safeEmit(ly.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,e,n),e===TS.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new Bw(Bv.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");t.inspectImage()}})),t.on(CS.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((t=>"video"===t.trackMediaType))[0])}))}handleVideoInspectEvents(t){t.on(_S.CONNECTION_STATE_CHANGE,((e,n)=>{if(this.safeEmit(ly.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,e,n),n===vS.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.safeEmit(ly.CONTENT_INSPECT_ERROR,new Bw(Bv.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));t.inspectImage()}})),t.on(_S.INSPECT_RESULT,((t,e)=>{var n;if((null==e?void 0:e.code)===Bv.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return zE.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.safeEmit(ly.CONTENT_INSPECT_RESULT,t,e)})),t.on(_S.CLIENT_LOCAL_VIDEO_TRACK,(t=>{t(this.localTracks.filter((t=>"video"===t.trackMediaType))[0])}))}getJoinChannelServiceRecords(){return zE.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(t){Fv(t,"enabled"),kE("ENABLE_PUBLISH_AUDIO_FILTER",t),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(t)}_handleResetAddStream(t,e){switch(e){case"audio":t._audio_added_=!1,t._trust_audio_stream_added_state_=!0;break;case"video":t._video_added_=!1,t._trust_video_stream_added_state_=!0}}}Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],KP.prototype,"leave",null),Pw([iw({argsMap:(t,e)=>{if(!Array.isArray(e)){if(!(e instanceof nC))return[e];e=[e]}return e.map((t=>t?Object(t).toString():"null"))}}),Dw("design:type",Function),Dw("design:paramtypes",[Object,Boolean]),Dw("design:returntype",ev)],KP.prototype,"publish",null),Pw([iw({argsMap:(t,e)=>(e||(e=[]),e instanceof sL?[e.getChannelId()]:(Array.isArray(e)||(e=[e]),e.map((t=>t.getTrackId()))))}),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",ev)],KP.prototype,"unpublish",null),Pw([iw({argsMap:(t,e,n,i)=>[e.uid,n,i]}),Dw("design:type",Function),Dw("design:paramtypes",[OM,String,Number]),Dw("design:returntype",ev)],KP.prototype,"subscribe",null),Pw([iw({argsMap:(t,e)=>e.map((t=>{let{user:e,mediaType:n}=t;return[null==e?void 0:e.uid,n]}))}),Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],KP.prototype,"massSubscribe",null),Pw([iw({argsMap:(t,e,n,i)=>[e.uid,n,i]}),Dw("design:type",Function),Dw("design:paramtypes",[OM,String,Number]),Dw("design:returntype",ev)],KP.prototype,"unsubscribe",null),Pw([iw({argsMap:(t,e)=>e.map((t=>{let{user:e,mediaType:n}=t;return{uid:null==e?void 0:e.uid,mediaType:n}}))}),Dw("design:type",Function),Dw("design:paramtypes",[Array]),Dw("design:returntype",ev)],KP.prototype,"massUnsubscribe",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",ev)],KP.prototype,"setLowStreamParameter",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],KP.prototype,"enableDualStream",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],KP.prototype,"disableDualStream",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[String,Object]),Dw("design:returntype",ev)],KP.prototype,"setClientRole",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[String,Boolean]),Dw("design:returntype",void 0)],KP.prototype,"setProxyServer",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Object,Boolean]),Dw("design:returntype",void 0)],KP.prototype,"setTurnServer",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",void 0)],KP.prototype,"setLicense",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Number]),Dw("design:returntype",void 0)],KP.prototype,"startProxyServer",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],KP.prototype,"stopProxyServer",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",void 0)],KP.prototype,"setLocalAccessPointsV2",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Array,String]),Dw("design:returntype",void 0)],KP.prototype,"setLocalAccessPoints",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Number]),Dw("design:returntype",ev)],KP.prototype,"setRemoteDefaultVideoStreamType",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Object,Number]),Dw("design:returntype",ev)],KP.prototype,"setRemoteVideoStreamType",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Object,Number]),Dw("design:returntype",ev)],KP.prototype,"setStreamFallbackOption",null),Pw([iw({argsMap:(t,e)=>[e]}),Dw("design:type",Function),Dw("design:paramtypes",[String,String,Uint8Array]),Dw("design:returntype",void 0)],KP.prototype,"setEncryptionConfig",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],KP.prototype,"renewToken",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",void 0)],KP.prototype,"enableAudioVolumeIndicator",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[String,Boolean]),Dw("design:returntype",ev)],KP.prototype,"startLiveStreaming",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",ev)],KP.prototype,"setLiveTranscoding",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[String]),Dw("design:returntype",ev)],KP.prototype,"stopLiveStreaming",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[String,Object]),Dw("design:returntype",ev)],KP.prototype,"addInjectStreamUrl",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],KP.prototype,"removeInjectStreamUrl",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[CM]),Dw("design:returntype",ev)],KP.prototype,"startChannelMediaRelay",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[CM]),Dw("design:returntype",ev)],KP.prototype,"updateChannelMediaRelay",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],KP.prototype,"stopChannelMediaRelay",null),Pw([iw({argsMap:(t,e)=>(Array.isArray(e)||(e=[e]),[JSON.stringify(e)])}),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",ev)],KP.prototype,"sendCustomReportMessage",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Object,Object]),Dw("design:returntype",ev)],KP.prototype,"pickSVCLayer",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Number]),Dw("design:returntype",ev)],KP.prototype,"setRTM2Flag",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Object]),Dw("design:returntype",ev)],KP.prototype,"enableContentInspect",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",ev)],KP.prototype,"disableContentInspect",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Boolean,Object]),Dw("design:returntype",ev)],KP.prototype,"setImageModeration",null),Pw([iw({reportResult:!0}),Dw("design:type",Function),Dw("design:paramtypes",[]),Dw("design:returntype",Array)],KP.prototype,"getJoinChannelServiceRecords",null),Pw([iw(),Dw("design:type",Function),Dw("design:paramtypes",[Boolean]),Dw("design:returntype",ev)],KP.prototype,"setPublishAudioFilterEnabled",null);class qP{constructor(t,e){ih(this,"id",0),ih(this,"element",void 0),ih(this,"peerPair",void 0),ih(this,"context",void 0),ih(this,"audioPlayerElement",void 0),ih(this,"audioTrack",void 0),qP.count+=1,this.id=qP.count,this.element=t,this.context=e}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const e=document.createElement("audio");e.srcObject=new MediaStream([t.track]),e.play(),this.audioPlayerElement=e}}async switchSdp(){if(!this.peerPair)return;const t=async(t,e)=>{const n="offer"===e?await t.createOffer():await t.createAnswer();return await t.setLocalDescription(n),"complete"===t.iceGatheringState?t.localDescription:new ev((e=>{t.onicegatheringstatechange=()=>{"complete"===t.iceGatheringState&&e(t.localDescription)}}))},e=async(t,e)=>await t.setRemoteDescription(e);try{const n=await t(this.peerPair[0],"offer");await e(this.peerPair[1],n);const i=await t(this.peerPair[1],"answer");await e(this.peerPair[0],i)}catch(t){throw new Bw(Bv.LOCAL_AEC_ERROR,t.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let e;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),e=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(e)}catch(t){throw new Bw(Bv.LOCAL_AEC_ERROR,t.toString()).print()}if(!e)throw new Bw(Bv.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=e.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,e=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(e),await this.switchSdp()}close(){zE.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((t=>{t.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}ih(qP,"count",0);const YP=window.AudioContext||window.webkitAudioContext;class $P{constructor(){ih(this,"units",[]),ih(this,"context",void 0)}processExternalMediaAEC(t){if(!this._doesEnvironmentNeedAEC())return zE.debug("the system does not need to process local aec"),-1;this.context||(this.context=new YP);let e=this.units.find((e=>e&&e.getElement()===t));return e||(e=new qP(t,this.context),this.units.push(e)),e.startEchoCancellation(),zE.debug("start processing local audio echo cancellation, id is",e.id),e.id}_doesEnvironmentNeedAEC(){return Av().name!==cv.SAFARI}}Pw([iw({report:rw}),Dw("design:type",Function),Dw("design:paramtypes",[HTMLAudioElement]),Dw("design:returntype",Number)],$P.prototype,"processExternalMediaAEC",null);const XP=new $P;function JP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function ZP(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?JP(Object(n),!0).forEach((function(e){ih(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):JP(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}const tD=window||document;function eD(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!tD)return;const n=nD._cspEventHandlerPointer;if(n&&e)return void console.error(n,e);const i=t=>{if(!(t&&t.blockedURI&&(nD.onSecurityPolicyViolation||nD.getListeners(wS.SECURITY_POLICY_VIOLATION).length>0)))return;const e=t.blockedURI;NE("CSP_DETECTED_HOSTNAME_LIST").some((t=>kr(e).call(e,t)))&&(nD.onSecurityPolicyViolation&&"function"==typeof nD.onSecurityPolicyViolation&&nD.onSecurityPolicyViolation(t),nD.getListeners(wS.SECURITY_POLICY_VIOLATION).length>0&&nD.safeEmit(wS.SECURITY_POLICY_VIOLATION,t))};n&&tD.removeEventListener("securitypolicyviolation",n),(e||t&&"function"==typeof t||nD.getListeners(wS.SECURITY_POLICY_VIOLATION).length>0)&&tD.addEventListener("securitypolicyviolation",i),nD._cspEventHandlerPointer=i}kE("PROCESS_ID","process-".concat(By(8,""),"-").concat(By(4,""),"-").concat(By(4,""),"-").concat(By(4,""),"-").concat(By(12,""))),function(){const t=Av();AC.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),AC.getStreamFromExtension=t.name===cv.CHROME&&Number(t.version)>34,AC.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let e=!1;try{t.addTransceiver("audio"),e=!0}catch(t){}return t.close(),e}(),AC.supportMinBitrate=t.name===cv.CHROME||t.name===cv.EDGE,AC.supportSetRtpSenderParameters=function(){const t=Av();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Nv()||!(!_v()&&!mv())||t.name===cv.FIREFOX&&Number(t.version)>=64)}(),t.name===cv.SAFARI&&(Number(t.version)>=14?AC.supportDualStream=!0:AC.supportDualStream=!1),AC.webAudioMediaStreamDest=function(){const t=Av();return!(t.name===cv.SAFARI&&Number(t.version)<12)}(),AC.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,AC.supportWebGL="undefined"!=typeof WebGLRenderingContext,AC.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Nv()||(AC.webAudioWithAEC=!0),AC.supportShareAudio=function(){const t=Av();return(t.os===av.WIN_10||t.os===av.WIN_81||t.os===av.WIN_7||t.os===av.LINUX||t.os===av.MAC_OS)&&t.name===cv.CHROME&&Number(t.version)>=74}(),AC.supportDataChannel=!!(wv(76)||function(t){const e=Av();return!(e.name!==cv.FIREFOX||!e.osVersion)&&Number(e.version)>=t}(68)||function(t){const e=Av();return!(e.name!==cv.SAFARI||!e.osVersion)&&Number(e.version)>=t}(14)),AC.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!bv()&&!!t&&t.prototype.setConfiguration instanceof Function}(),AC.supportWebRTCEncodedTransform=function(){const t=Av();return"Chrome"===t.name&&Number(t.version)>=86}(),AC.supportWebRTCInsertableStream=function(){const t=Av();return(t.name===cv.CHROME||t.name===cv.EDGE)&&Number(t.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),Cy((()=>{AC.supportDualStreamEncoding=function(){const t=Av();return!!NE("DISABLE_WEBAUDIO")||"Safari"===t.name&&Number(t.version)>=14||!!("Chrome"===t.name&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&NE("CHROME_DUAL_STREAM_USE_ENCODING"))}(),zE.info("browser compatibility",JSON.stringify(AC),JSON.stringify(t))}))}(),function(){let t;try{t=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void zE.error("Error loading sdk config",t.message)}if(t)try{const e=JSON.parse(window.atob(t)),n=Date.now();zE.debug("Loading global parameters from cache",e),Object.keys(e).forEach((t=>{if(Object.prototype.hasOwnProperty.call(ME,t)){const{value:i,expires:r}=e[t];if(r&&r<=n)return;PE[t]=i,ME[t]=i}}))}catch(e){zE.error("Error loading mutableParamsCache: ".concat(t),e.message)}}(),Array.isArray(PE.AREAS)&&PE.AREAS.length>0&&KL(PE.AREAS,!0);const nD=function(t){const e=new ny,n=t,i={getListeners:e.getListeners.bind(e),on:(t,n)=>(function(t,e){t===wS.SECURITY_POLICY_VIOLATION&&eD(e,!0)}(t,n),e.on.bind(e)(t,n)),addListener:e.addListener.bind(e),once:e.once.bind(e),off:e.off.bind(e),removeAllListeners:e.removeAllListeners.bind(e),emit:e.emit.bind(e),safeEmit:e.safeEmit.bind(e)};return ZP(ZP({},n),i)}({__TRACK_LIST__:LT,VERSION:xE,BUILD:LE,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(t,e,n)=>{zE.debug("setParameter key:".concat(t,", value:").concat(JSON.stringify(e))),kE(t,e,n)},getParameter:NE,getSupportedCodec:async function(){let t={audio:[],video:[]};try{let e=new RTCPeerConnection;e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"});const n=(await e.createOffer()).sdp;if(!n)return t;e.close(),e=null,t=function(t){const e={video:[],audio:[]};return t.match(/ VP8/i)&&e.video.push("VP8"),t.match(/ VP9/i)&&e.video.push("VP9"),t.match(/ AV1/i)&&e.video.push("AV1"),t.match(/ H264/i)&&e.video.push("H264"),t.match(/ H265/i)&&e.video.push("H265"),t.match(/ opus/i)&&e.audio.push("OPUS"),t.match(/ PCMU/i)&&e.audio.push("PCMU"),t.match(/ PCMA/i)&&e.audio.push("PCMA"),t.match(/ G722/i)&&e.audio.push("G722"),e}(n)}catch(t){throw new Bw(Bv.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return t},checkSystemRequirements:function(){const t=rw.reportApiInvoke(null,{name:sy.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:oy.TRACER});let e=!1;try{const t=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,i=window.WebSocket;e=!!(t&&n&&i)}catch(t){return zE.error("check system requirement failed: ",t),!1}let n=!1;const i=Av();i.name===cv.CHROME&&Number(i.version)>=58&&(!vv()||gv())&&(n=!0),i.name===cv.FIREFOX&&Number(i.version)>=56&&(n=!0),i.name===cv.OPERA&&Number(i.version)>=45&&(n=!0),i.name===cv.SAFARI&&Number(i.version)>=11&&(n=!0),(Mv()||Av().name===cv.QQ)&&(n=!0),zE.debug("checkSystemRequirements, api:",e,"browser",n);const r=e&&n;return t.onSuccess(r),r},getDevices:function(t){return xC.enumerateDevices(!0,!0,t)},getMicrophones:function(t){return xC.getRecordingDevices(t)},getCameras:function(t){return xC.getCamerasDevices(t)},getElectronScreenSources:_C,getPlaybackDevices:function(t){return xC.getSpeakers(t)},createClient:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const e=rw.reportApiInvoke(null,{name:sy.CREATE_CLIENT,options:[t],tag:oy.TRACER});try{!function(t){Hv(t.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),Hv(t.mode,"config.mode",["rtc","live"]),void 0!==t.audioCodec&&Hv(t.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==t.proxyServer&&Gv(t.proxyServer,"config.proxyServer",1,1e4),void 0!==t.turnServer&&fy(t.turnServer),void 0!==t.httpRetryConfig&&Ay(t.httpRetryConfig),void 0!==t.websocketRetryConfig&&Ay(t.websocketRetryConfig)}(t)}catch(t){throw e.onError(t),t}return QP()||("vp9"===t.codec&&(t.codec="vp8",zE.debug("browser not support vp9, force use vp8")),kE("UNSUPPORTED_VIDEO_CODEC",["vp9"])),void 0===t.audioCodec&&(t.audioCodec="opus"),e.onSuccess(),new KP(WP(WP({forceWaitGatewayResponse:!0},t),{},{role:"rtc"===t.mode?"host":t.role||"audience"}))},createCameraVideoTrack:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.CREATE_CAM_VIDEO_TRACK,options:[wR({},t)]}),n=nR(t),i=By(8,"track-cam-");let r=null;const s="720p_auto"===t.encoderConfig;zE.info("start create camera video track with config",JSON.stringify(t),"trackId",i);try{r=(await TC({video:n},i)).getVideoTracks()[0]||null}catch(t){throw e.onError(t),t}if(!r){const t=new Uv(Bv.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(t),t.throw(zE)}t.optimizationMode&&SR(i,r,t,CT(t.encoderConfig));const o=new bR(r,t,n,t.scalabiltyMode?IT(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,i);return s&&o.startMonitorStats(),e.onSuccess(o.getTrackId()),zE.info("create camera video success, trackId:",i),o},createCustomVideoTrack:function(t){const e=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.CREATE_CUSTOM_VIDEO_TRACK,options:[t]}),n=new _R(t.mediaStreamTrack,{width:t.width,height:t.height,frameRate:t.frameRate,bitrateMax:t.bitrateMax,bitrateMin:t.bitrateMin},t.scalabiltyMode?IT(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,By(8,"track-cus-"),[NT.CUSTOM_TRACK]);return e.onSuccess(n.getTrackId()),zE.info("create custom video track success with config",t,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.CREATE_SCREEN_VIDEO_TRACK,options:[wR({},t),e]}),i="720p_auto"===t.encoderConfig;t.encoderConfig?"string"==typeof t.encoderConfig||t.encoderConfig.width&&t.encoderConfig.height||(t.encoderConfig.width={max:1920},t.encoderConfig.height={max:1080}):t.encoderConfig="1080p_2";const r=function(t){const e={};t.screenSourceType&&(e.mediaSource=t.screenSourceType),t.extensionId&&yv()&&(e.extensionId=t.extensionId);const{displaySurface:n,selfBrowserSurface:i,surfaceSwitching:r,systemAudio:s}=t;(wv(107)||Sv(107)||Tv(93))&&(n&&(Hv(n,"displaySurface",["browser","window","monitor"]),e.displaySurface=n),i?(Hv(i,"selfBrowserSurface",["exclude","include"]),e.selfBrowserSurface=i):e.selfBrowserSurface="include",r&&(Hv(r,"surfaceSwitching",["exclude","include"]),e.surfaceSwitching=r)),(wv(105)||Sv(105)||Tv(91))&&s&&(Hv(s,"systemAudio",["exclude","include"]),e.systemAudio=s),t.electronScreenSourceId&&(e.sourceId=t.electronScreenSourceId);const o=t.encoderConfig?RT(t.encoderConfig):null;return e.mandatory={chromeMediaSource:"desktop",maxWidth:o?o.width:void 0,maxHeight:o?o.height:void 0},o&&(o.frameRate&&("number"==typeof o.frameRate?(e.mandatory.maxFrameRate=o.frameRate,e.mandatory.minFrameRate=o.frameRate):(e.mandatory.maxFrameRate=o.frameRate.max||o.frameRate.ideal||o.frameRate.exact||void 0,e.mandatory.minFrameRate=o.frameRate.min||o.frameRate.ideal||o.frameRate.exact||void 0),e.frameRate=o.frameRate),o.width&&(e.width=o.width),o.height&&(e.height=o.height)),e}(t),s=By(8,"track-scr-v-");let o=null,a=null;const c=pC();if(!c.supportShareAudio&&"enable"===e){const t=new Uv(Bv.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(t),t.throw(zE)}zE.info("start create screen video track with config",t,"withAudio",e,"trackId",s);try{const t=await TC({screen:r,screenAudio:"auto"===e?c.supportShareAudio:"enable"===e},s);o=t.getVideoTracks()[0]||null,a=t.getAudioTracks()[0]||null}catch(t){throw n.onError(t),t}if(!o){const t=new Uv(Bv.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(t),t.throw(zE)}if(!a&&"enable"===e){o&&o.stop();const t=new Uv(Bv.SHARE_AUDIO_NOT_ALLOWED);return n.onError(t),t.throw(zE)}t.optimizationMode||(t.optimizationMode="detail"),t.optimizationMode&&(SR(s,o,t,t.encoderConfig&&RT(t.encoderConfig)||void 0),t.encoderConfig&&"string"!=typeof t.encoderConfig&&(t.encoderConfig.bitrateMin=t.encoderConfig.bitrateMax));const l=new _R(o,t.encoderConfig?RT(t.encoderConfig):{},t.scalabiltyMode?IT(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s,[NT.SCREEN_TRACK]);if(i&&l.startMonitorStats(),!a)return n.onSuccess(l.getTrackId()),zE.info("create screen video track success","video:",l.getTrackId()),l;const u=new JC(a,void 0,By(8,"track-scr-a-"),!1,!0);return n.onSuccess([l.getTrackId(),u.getTrackId()]),zE.info("create screen video track success","video:",l.getTrackId(),"audio:",u.getTrackId()),[l,u]},createMicrophoneAndCameraTracks:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.CREATE_MIC_AND_CAM_TRACKS,options:[t,e]}),i="720p_auto"===e.encoderConfig,r=nR(e),s=iR(t),o=By(8,"track-mic-"),a=By(8,"track-cam-");let c=null,l=null;zE.info("start create camera video track(".concat(a,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(t),", video: ").concat(JSON.stringify(e)));try{const t=await TC({audio:s,video:r},"".concat(o,"-").concat(a));c=t.getAudioTracks()[0],l=t.getVideoTracks()[0]}catch(t){throw n.onError(t),t}if(!c||!l){const t=new Uv(Bv.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(t),t.throw(zE)}e.optimizationMode&&SR(a,l,e,CT(e.encoderConfig));const u=new ZC(c,t,s,o),d=new bR(l,e,r,e.scalabiltyMode?IT(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,a);return i&&d.startMonitorStats(),n.onSuccess([u.getTrackId(),d.getTrackId()]),zE.info("create camera video track(".concat(a,") and microphone audio track(").concat(o,") success")),[u,d]},createMicrophoneAudioTrack:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const e=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.CREATE_MIC_AUDIO_TRACK,options:[t]}),n=iR(t),i=By(8,"track-mic-");let r=null;zE.info("start create microphone audio track with config",JSON.stringify(t),"trackId",i);try{r=(await TC({audio:n},i)).getAudioTracks()[0]||null}catch(t){throw e.onError(t),t}if(!r){const t=new Uv(Bv.UNEXPECTED_ERROR,"can not find track in media stream");return e.onError(t),t.throw(zE)}const s=new ZC(r,t,n,i);return e.onSuccess(s.getTrackId()),zE.info("create microphone audio track success, trackId:",i),s},createCustomAudioTrack:function(t){const e=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.CREATE_CUSTOM_AUDIO_TRACK,options:[t]}),n=new JC(t.mediaStreamTrack,t.encoderConfig?OT(t.encoderConfig):{},By(8,"track-cus-"),!1,!0);return zE.info("create custom audio track success with config",t,"trackId",n.getTrackId()),e.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(t){var e;const{cacheOnlineFile:n,encoderConfig:i}=t;let{source:r}=t;const s={source:r instanceof AudioBuffer?"AudioBuffer":r instanceof File?null!==(e=File.name)&&void 0!==e?e:"File":r,cacheOnlineFile:n,encoderConfig:i},o=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.CREATE_BUFFER_AUDIO_TRACK,options:[s]});if(NE("DISABLE_WEBAUDIO"))throw new Uv(Bv.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const a=By(8,"track-buf-");zE.info("start create buffer source audio track with config",JSON.stringify(s),"trackId",a);const c=r;if(!(r instanceof AudioBuffer))try{r=await oR(r,n)}catch(t){return o.onError(t),t.throw(zE)}const l=new rR(r),u=new tR(c,l,i?OT(i):{},a);return zE.info("create buffer source audio track success, trackId:",a),o.onSuccess(u.getTrackId()),u},setAppType:function(t){if(zE.debug("setAppType: ".concat(t)),!(Number.isInteger(t)&&t>=0))throw zE.debug("Invalid appType"),new Bw(Bv.INVALID_PARAMS,"invalid app type",t);kE("APP_TYPE",Math.floor(t))},setLogLevel:function(t){zE.setLogLevel(t)},enableLogUpload:function(){NE("USE_NEW_LOG")?kE("UPLOAD_LOG",!0):zE.enableLogUpload()},disableLogUpload:function(){NE("USE_NEW_LOG")?kE("UPLOAD_LOG",!1):zE.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new CM},checkAudioTrackIsActive:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof JC||t instanceof xR)){const t=new Bw(Bv.INVALID_TRACK,"the parameter is not a audio track");return n.onError(t),t.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof JC?t.getTrackLabel():"remote_track",r=t.getVolumeLevel();let s=r,o=r;const a=Date.now();return new ev((r=>{const c=setInterval((()=>{const l=t.getVolumeLevel();s=l>s?l:s,o=l<o?l:o;const u=s-o>1e-4,d=Date.now()-a;if(u||d>e){clearInterval(c);const e=u,o={duration:d,deviceLabel:i,maxVolumeLevel:s,result:e};zE.info("[track-".concat(t.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(o))),n.onSuccess(o),r(e)}}),200)}))},checkVideoTrackIsActive:async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=rw.reportApiInvoke(null,{tag:oy.TRACER,name:sy.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[e]});if(!(t instanceof _R||t instanceof IR)){const t=new Bw(Bv.INVALID_TRACK,"the parameter is not a video track");return n.onError(t),t.throw()}e&&e<1e3&&(e=1e3);const i=t instanceof _R?t.getTrackLabel():"remote_track",r=t.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(_v()||mv())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([r]),s.play();const o=document.createElement("canvas");o.width=160,o.height=120;let a=0,c=0;try{const t=Date.now();a=await function(t,e,n,i){let r,s=0,o=null;return new ev(((a,c)=>{function l(){s>i&&r&&(r(),a(s));const e=n.getContext("2d");if(!e){const t=new Bw(Bv.UNEXPECTED_ERROR,"can not get canvas 2d context.");return zE.error(t.toString()),void c(t)}e.drawImage(t,0,0,160,120);const l=e.getImageData(0,0,n.width,n.height),u=Math.floor(l.data.length/3);if(o){for(let t=0;t<u;t+=3)if(l.data[t]!==o[t])return s+=1,void(o=l.data);o=l.data}else o=l.data}setTimeout((()=>{r&&(r(),a(s))}),e),r=hC((()=>{l()}),30)}))}(s,e,o,4),c=Date.now()-t}catch(t){throw n.onError(t),t}GP===cv.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const l=a>4,u={duration:c,changedPicNum:a,deviceLabel:i,result:l};return zE.info("[track-".concat(t.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(u))),n.onSuccess(u),l},setArea:KL,audioElementPlayCenter:BC,processExternalMediaAEC:function(t){XP.processExternalMediaAEC(t)},registerExtensions:function(t){t.forEach((t=>{const e=t;e.__registered__=!0,e.logger.hookLog=zE.extLog,e.reporter.hookApiInvoke=rw.extApiInvoke,e.parameters&&Object.keys(e.parameters).forEach((t=>{e.parameters[t]=NE(t)}))}))},ChannelMediaRelayError:Jw,ChannelMediaRelayEvent:$w,ChannelMediaRelayState:Xw,RemoteStreamFallbackType:BT,RemoteStreamType:DT,ConnectionDisconnectedReason:cy,AudienceLatencyLevelType:ay,AREAS:rS});return Object.defineProperties(nD,{onAudioAutoplayFailed:{get:()=>LC.onAudioAutoplayFailed,set:t=>{LC.onAudioAutoplayFailed=t}},onAutoplayFailed:{get:()=>LC.onAutoplayFailed,set:t=>{LC.onAutoplayFailed=t}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>nD._onSecurityPolicyViolation,set(t){nD._onSecurityPolicyViolation=t,eD(t)}},__CLIENT_LIST__:{get:()=>NE("SHOW_GLOBAL_CLIENT_LIST")?cw:[]}}),xC.on(XT.CAMERA_DEVICE_CHANGED,(t=>{zE.info("camera device changed",JSON.stringify(t)),nD.onCameraChanged&&nD.onCameraChanged(t),nD.safeEmit(wS.CAMERA_CHANGED,t)})),xC.on(XT.RECORDING_DEVICE_CHANGED,(t=>{zE.info("microphone device changed",JSON.stringify(t)),nD.onMicrophoneChanged&&nD.onMicrophoneChanged(t),nD.safeEmit(wS.MICROPHONE_CHANGED,t)})),xC.on(XT.PLAYOUT_DEVICE_CHANGED,(t=>{zE.debug("playout device changed",JSON.stringify(t)),nD.onPlaybackDeviceChanged&&nD.onPlaybackDeviceChanged(t),nD.safeEmit(wS.PLAYBACK_DEVICE_CHANGED,t)})),BC.onAutoplayFailed=()=>{zE.info("detect audio element autoplay failed"),LC.onAudioAutoplayFailed&&LC.onAudioAutoplayFailed()},oC.on("autoplay-failed",(()=>{zE.info("detect webaudio autoplay failed"),LC.onAudioAutoplayFailed&&LC.onAudioAutoplayFailed(),nD.safeEmit(wS.AUTOPLAY_FAILED)})),by.on(hy.NETWORK_STATE_CHANGE,((t,e)=>{zE.info("[network-indicator] network state changed, ".concat(e," => ").concat(t))})),window&&(window.__ARTC__=nD),nD}()}(Pn);var Dn=Nn(Pn.exports);const Bn="unknown",Un="ios",Fn="android",Hn="windowsPhone",Vn="vrHeadset";class jn{static get platform(){return this.platform_||(this.platform_=this.getDevicePlatform()),this.platform_}static get isIOS(){return-1!==["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].indexOf(navigator.platform)||-1!==navigator.userAgent.indexOf("Mac")&&"ontouchend"in document}static get isVRHeadset(){return-1!==navigator.userAgent.indexOf("VR")||-1!==navigator.userAgent.indexOf("Quest")||-1!==navigator.userAgent.indexOf("Oculus")}static getDevicePlatform(){const t=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(t)?Hn:/android/i.test(t)?Fn:this.isIOS?Un:this.isVRHeadset?Vn:Bn}}const Gn=1,Qn=2,zn=3,Wn=4,Kn=5;class qn{static setLevel(t){this.level_=t}static getLevel(){return D.flags.production?Gn:this.level_}static error(){this.getLevel()>=Gn&&console.error(...arguments)}static warn(){this.getLevel()>=Qn&&console.warn(...arguments)}static info(){this.getLevel()>=zn&&console.info(...arguments)}static log(){this.getLevel()>=Wn&&console.log(...arguments)}}qn.level_=Kn;class Yn{static delete(t){this.isSessionStorageSupported()&&window.sessionStorage.removeItem(t)}static exist(t){if(this.isSessionStorageSupported())return void 0!==window.sessionStorage[t]}static get(t){let e=null;if(this.isSessionStorageSupported()&&void 0!==window.sessionStorage[t])try{e=JSON.parse(window.sessionStorage[t])}catch(e){console.log("SessionStorageService.get.error parsing",t,e)}return e}static set(t,e){if(this.isSessionStorageSupported())try{const n=[],i=JSON.stringify(e,(function(t,e){if("object"==typeof e&&null!==e){if(-1!==n.indexOf(e))return;n.push(e)}return e}));window.sessionStorage.setItem(t,i)}catch(n){console.log("SessionStorageService.set.error serializing",t,e,n)}}static isSessionStorageSupported(){if(this.supported)return!0;let t=!1;try{t="sessionStorage"in window&&null!==window.sessionStorage,t?(window.sessionStorage.setItem("test","1"),window.sessionStorage.removeItem("test")):t=!1}catch(e){t=!1}return this.supported=t,t}}class $n{constructor(t,e,n){void 0===n&&(n=!1),this.user=t,this.mediaType=e,this.isLocal=n,this.clientInfo=null,this.texture=null,this.element=null,this.parentNode=null}get streamId(){return this.user?.uid.toString()}get hasScreen(){return this.user?.hasScreen}get hasVideo(){return this.user?.hasVideo}get hasAudio(){return this.user?.hasAudio}get videoTrack(){return this.user?.videoTrack}get audioTrack(){return this.user?.audioTrack}get video(){return!!this.videoTrack}get audio(){return!!this.audioTrack}get userMuteVideo(){return!!this.videoTrack&&this.videoTrack.muted}get userMuteAudio(){return!!this.audioTrack&&this.audioTrack.muted}getTracks(){const t=[];return this.user.hasVideo&&t.push(this.videoTrack),this.user.hasAudio&&t.push(this.audioTrack),t}async muteVideo(){this.videoTrack&&await this.videoTrack.setMuted(!0)}async unmuteVideo(){this.videoTrack&&await this.videoTrack.setMuted(!1)}async muteAudio(){this.audioTrack&&await this.audioTrack.setMuted(!0)}async unmuteAudio(){this.audioTrack&&await this.audioTrack.setMuted(!1)}getAudioLevel(){return this.audioTrack?this.audioTrack.getVolumeLevel():0}isPlaying(){return this.videoTrack?.isPlaying||this.audioTrack?.isPlaying}play(t,e){for(void 0===e&&(e=null),e=e||this.mediaType;t.childElementCount>0;)t.removeChild(t.firstElementChild);this.parentNode=t,"video"===e?(this.videoTrack.play(t,{fit:"cover",mirror:void 0}),this.element=t.firstElementChild,qn.log("Stream.play.videoTrack",t,this.element)):this.audioTrack&&!this.isLocal&&this.audioTrack.play()}stop(){this.videoTrack&&this.videoTrack.isPlaying&&this.videoTrack.stop(),this.audioTrack&&this.audioTrack.isPlaying&&this.audioTrack.stop()}close(){this.videoTrack&&this.videoTrack.close(),this.audioTrack&&this.audioTrack.close()}update(t){this.user=t.user,this.mediaType=t.mediaType}resume(t){qn.log("Stream.resume",t,this.element),this.element&&t.appendChild(this.element)}published(t,e){this.user=t,this.mediaType=e,this.parentNode&&this.play(this.parentNode,e)}unpublished(t,e){switch(this.user=t,e){case"video":t.videoTrack?.stop();break;case"audio":t.audioTrack?.stop()}}}const Xn="client",Jn="editor";class Zn{static set editorStreams(t){this.editorStreams$.next(t)}static get editorStreams(){return this.editorStreams$.getValue()}static set editorScreens(t){this.editorScreens$.next(t)}static get editorScreens(){return this.editorScreens$.getValue()}static set local(t){this.local$.next(t)}static get local(){return this.local$.getValue()}static set screen(t){this.screen$.next(t)}static get screen(){return this.screen$.getValue()}static set remotes(t){this.remotes$.next(t)}static get remotes(){return this.remotes$.getValue()}static set peers(t){this.peers$.next(t)}static get peers(){return this.peers$.getValue()}static orderedRemotes$(){return n.combineLatest([Zn.remotes$,n.interval(1e3)]).pipe(i.map((t=>{const e=[];return t[0].forEach((t=>{let n=null,i=null,r=null,s=0,o=0,a=0;t.clientInfo&&(s=t.clientInfo.audioLevel=t.getAudioLevel(),o=t.clientInfo.peekAudioLevel=Math.max(t.clientInfo.audioLevel,.2),a=t.clientInfo.order,n=t.clientInfo.role||null,i=t.clientInfo.uid||null,r=t.clientInfo.screenUid||null),e.push({role:n,uid:i,screenUid:r,audioLevel:s,peekAudioLevel:o,order:a,remote:t})})),e.sort(((t,e)=>{const n=t.role===ne.Publisher?2:t.role===ne.Attendee?1:0;return(e.role===ne.Publisher?2:e.role===ne.Attendee?1:0)-n||e.peekAudioLevel-t.peekAudioLevel||(t.order||0)-(e.order||0)})),e.forEach(((t,e)=>{t.remote.clientInfo&&(t.remote.clientInfo.order=e)})),e})),i.distinctUntilChanged(((t,e)=>t.map((t=>`${t.uid}-${t.screenUid}`)).join("|")===e.map((t=>`${t.uid}-${t.screenUid}`)).join("|"))),i.map((t=>t.map((t=>t.remote)))))}static getEditorStreams$(){return n.of(null).pipe(i.switchMap((()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&this.mode===Jn){const t=document.querySelector("body"),e=document.createElement("div"),n=document.createElement("video");e.setAttribute("id","stream-editor"),e.setAttribute("style","position:absolute; top: 5000px; line-height: 0;"),e.appendChild(n),t.appendChild(e),navigator.mediaDevices.getUserMedia({video:{width:800,height:450}}).then((t=>{"srcObject"in n?n.srcObject=t:n.src=window.URL.createObjectURL(t),n.oncanplay=()=>{const t={streamId:"editor",clientInfo:{role:ne.Publisher,uid:"editor"}},e={streamId:"editor",clientInfo:{role:ne.Attendee,uid:"editor"}},n={streamId:"editor",clientInfo:{role:ne.SmartDevice,uid:"editor"}};this.editorStreams$.next([t,e,e,e,e,n])},n.play()})).catch((t=>{console.log("EditorComponent.getUserMedia.error",t.name,t.message)}))}return this.editorStreams$})),i.shareReplay(1))}static getEditorScreens$(){return n.of(null).pipe(i.switchMap((()=>{if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia&&this.mode===Jn){const t=document.querySelector("body"),e=document.createElement("div"),n=document.createElement("video");e.setAttribute("id","stream-editor-screen"),e.setAttribute("style","position:absolute; top: 5000px; line-height: 0;"),e.appendChild(n),t.appendChild(e),navigator.mediaDevices.getDisplayMedia({screen:{width:800,height:450}}).then((t=>{"srcObject"in n?n.srcObject=t:n.src=window.URL.createObjectURL(t),n.oncanplay=()=>{const t={streamId:"editor-screen",clientInfo:{role:ne.Publisher,uid:"editor",screenUid:"editor-screen"}},e={streamId:"editor-screen",clientInfo:{role:ne.Attendee,uid:"editor",screenUid:"editor-screen"}};this.editorScreens$.next([t,e])},n.play()})).catch((t=>{console.log("EditorComponent.getUserMedia.error",t.name,t.message)}))}return this.editorScreens$})),i.shareReplay(1))}static get publisherStreamId(){const t=this.remotes.slice(),e=this.local;e&&t.unshift(e);const n=t.find((t=>t.clientInfo&&t.clientInfo.role===ne.Publisher&&t.clientInfo.uid===t.streamId));return n?n.streamId:null}static getPublisherStreamId$(){const t=this.publisherStreamId;return t?n.of(t):this.streams$.pipe(i.map((()=>this.publisherStreamId)),i.filter((t=>t)))}static get attendeeStreamId(){const t=this.remotes.slice(),e=this.local;e&&t.unshift(e);const n=t.find((t=>t.clientInfo&&t.clientInfo.role===ne.Attendee&&t.clientInfo.uid===t.streamId));return n?n.streamId:null}static getAttendeeStreamId$(){const t=this.attendeeStreamId;return t?n.of(t):this.streams$.pipe(i.map((()=>this.attendeeStreamId)),i.filter((t=>t)))}static getRemoteById(t){const e=Zn.remotes.find((e=>e.streamId===t));if(e)return e}static remoteAdd(t){const e=this.remotes.slice();e.find((e=>e.streamId===t.streamId))||(e.push(t),this.remotes=e)}static remoteRemove(t){const e=this.remotes.slice(),n=e.find((e=>e.streamId===t));return n&&(n.stop(),e.splice(e.indexOf(n),1),this.remotes=e),n}static remoteSetClientInfo(t,e){const n=this.remotes,i=n.find((e=>e.streamId===t));i&&(i.clientInfo=e),this.remotes=n}}Zn.mode=Xn,Zn.editorStreams$=new n.BehaviorSubject(null),Zn.editorScreens$=new n.BehaviorSubject(null),Zn.local$=new n.BehaviorSubject(null),Zn.screen$=new n.BehaviorSubject(null),Zn.remotes$=new n.BehaviorSubject([]),Zn.peers$=new n.BehaviorSubject([]),Zn.streams$=n.combineLatest([Zn.local$,Zn.screen$,Zn.remotes$,Zn.getEditorStreams$(),Zn.getEditorScreens$()]).pipe(i.map((t=>{const e=t[0],n=t[1],i=t[2],r=t[3],s=t[4];let o=i;return e&&(o=o.slice(),o.push(e)),n&&(o=o.slice(),o.push(n)),r&&o.push(...r),s&&o.push(...s),o})),i.shareReplay(1));class ti extends class{constructor(){this.events={}}on(t,e){const n=this.events[t]=this.events[t]||[];return n.push(e),()=>{this.events[t]=n.filter((t=>t!==e))}}off(t,e){const n=this.events[t];n&&(this.events[t]=n.filter((t=>t!==e)))}once(t,e){const n=i=>{e(i),this.off(t,n)};this.on(t,n)}emit(t,e){const n=this.events[t];n&&n.forEach((t=>{t(e)}));const i=this.events.broadcast;i&&i.forEach((n=>{n(t,e)}))}has(t){const e=this.events[t];return e&&e.length}}{constructor(t){if(ti.AGORA)throw"AgoraService is a singleton";super(),this.previousMuteAudio_=!1,this.channelState={},this.channelSnapshot={},this.onException=this.onException.bind(this),this.onUserJoined=this.onUserJoined.bind(this),this.onUserLeft=this.onUserLeft.bind(this),this.onUserPublished=this.onUserPublished.bind(this),this.onUserUnpublished=this.onUserUnpublished.bind(this),this.onUserInfoUpdated=this.onUserInfoUpdated.bind(this),this.onVolumeIndicator=this.onVolumeIndicator.bind(this),this.onConnectionStateChange=this.onConnectionStateChange.bind(this),this.onTokenPrivilegeWillExpire=this.onTokenPrivilegeWillExpire.bind(this),this.onTokenPrivilegeDidExpire=this.onTokenPrivilegeDidExpire.bind(this),this.onMessage=this.onMessage.bind(this);const e=ee.state;ee.patchState({devices:e.role!==ne.Attendee&&t?t:{videos:[],audios:[]},quality:_e(e),membersCount:0})}get isHostRole(){return ee.state.role===ne.Publisher||ee.state.role===ne.Attendee}get isAudienceRole(){return ee.state.role===ne.Viewer||ee.state.role===ne.SelfService}addStreamDevice(t){this.removeStreamDevice();const e={deviceId:"video-stream",label:"videostream",kind:"videostream",src:t},n={deviceId:"audio-stream",label:"videostream",kind:"videostream",src:t},i=ee.state.devices;i.videos.push(e),i.audios.push(n),ee.patchState({devices:i})}removeStreamDevice(){const t=ee.state.devices;t.videos=t.videos.filter((t=>"videostream"!==t.kind)),t.audios=t.audios.filter((t=>"videostream"!==t.kind)),ee.patchState({devices:t})}devices$(){const t=ee.state.devices,e=this.defaultVideos=this.defaultVideos||t.videos.slice(),i=this.defaultAudios=this.defaultAudios||t.videos.slice();t.videos=e.slice(),t.audios=i.slice();return n.from((async()=>{const e=await Dn.createCameraVideoTrack(),n=await Dn.createMicrophoneAudioTrack(),i=await ti.getDevices();e.close(),n.close();for(let e=0;e<i.length;e++){const n=i[e];"videoinput"===n.kind&&n.deviceId&&t.videos.push({label:n.label||"camera-"+t.videos.length,deviceId:n.deviceId,kind:n.kind}),"audioinput"===n.kind&&n.deviceId&&t.audios.push({label:n.label||"microphone-"+t.audios.length,deviceId:n.deviceId,kind:n.kind})}if(t.videos.length>0||t.audios.length>0)return t;throw t})())}async connect(t){if(!ee.state.connecting){const e=ee.state.devices;t&&(e.video=t.video,e.audio=t.audio),ee.patchState({status:Ie,connecting:!0,devices:e}),setTimeout((async()=>{await this.createClient();const t=this.getChannelNameLink();await this.join(t)}),250)}return ee.state$}connect$(t){return n.from(this.connect(t)).pipe(i.switchMap((()=>ee.state$)))}membersCount$(t){const e=this.messageClient;return n.interval(3e3).pipe(i.switchMap((()=>n.from(e.getChannelMemberCount([t])))),i.map((e=>e[t])),i.catchError((t=>(qn.error("AgoraService.membersCount$.error",t),n.of(0)))),i.distinctUntilChanged())}observeMemberCount(){this.unobserveMemberCount(),this.isHostRole&&(this.membersCountSubscription=this.membersCount$(ee.state.channelNameLink).subscribe((t=>{ee.patchState({membersCount:t})})))}unobserveMemberCount(){this.membersCountSubscription&&(this.membersCountSubscription.unsubscribe(),this.membersCountSubscription=null,ee.patchState({membersCount:0}))}async createClient(){if(this.client)return this.client;try{Dn.setLogLevel(2);const t=this.client=Dn.createClient({mode:"live",codec:"h264"});t.on("exception",this.onException),t.on("user-joined",this.onUserJoined),t.on("user-left",this.onUserLeft),t.on("user-published",this.onUserPublished),t.on("user-unpublished",this.onUserUnpublished),t.on("user-info-updated",this.onUserInfoUpdated),t.on("onTokenPrivilegeWillExpire",this.onTokenPrivilegeWillExpire),t.on("onTokenPrivilegeDidExpire",this.onTokenPrivilegeDidExpire);(this.messageClient=AgoraRTM.createInstance(D.appKey,{logFilter:AgoraRTM.LOG_FILTER_OFF})).setParameters({logFilter:AgoraRTM.LOG_FILTER_OFF}),qn.log("AgoraService.createClient","client initialized"),await t.setClientRole(this.isAudienceRole?"audience":"host"),D.flags.useProxy&&(t.startProxyServer(3),qn.log("AgoraService.createClient.startProxyServer"))}catch(t){qn.error("AgoraService.createClient.error",t),this.client=null}return this.client}getChannelNameLink(){let t=ee.state.link||"";const e=t.match(/(\d{9})-(\d{4})-(\d{13})/);e&&(t=`${e[1]}-${e[3]}`);return`${ee.state.channelName}-${t}`}async join(t){this.channel=null;const e=ti.resolveUserId(),n=await ti.rtmToken$(e).toPromise();try{await this.joinRtmChannel(n.token,t,e);const i=await ti.rtcToken$(t).toPromise();await this.joinRtcChannel(i.token,t,e)}catch(t){qn.error("AgoraService.join.joinRtmChannel.error",t)}}async joinRtcChannel(t,e,n){try{if(qn.log("AgoraService.joinRtcChannel",t,e,n),await this.client.join(D.appKey,e,t,n),ee.patchState({status:xe,channelNameLink:e,connected:!0,uid:n}),ti.storeUserId(n),!this.isAudienceRole){const t=await this.autoDetectDevice();await this.createMediaStream(n,t.video,t.audio)}this.observeMemberCount()}catch(t){if(qn.error("AgoraService.joinRtcChannel.error",t),"DYNAMIC_KEY_EXPIRED"===t){const t=await ti.rtcToken$(e).toPromise();await this.joinRtcChannel(t.token,e,n)}}}joinRtmChannel(t,e,n){let i;return qn.log("AgoraService.joinRtmChannel",t,e,n),new Promise(((r,s)=>{const o=this.messageClient;o.login({token:t,uid:n}).then((()=>(qn.log("AgoraService.joinRtmChannel.login.success"),i=o.createChannel(e),i.join()))).then((()=>{this.channel=i,i.on("ChannelMessage",this.onMessage),this.emit("channel",i),r(n),qn.log("AgoraService.joinRtmChannel.join.success"),i.getMembers().then((t=>{t=t.filter((t=>t!==n));const e={type:Me,members:t};this.broadcastMessage(e),qn.log("AgoraService.joinRtmChannel.members",e)})),qn.log("AgoraService.joinRtmChannel.success",e)})).catch((t=>{qn.error("AgoraService.joinRtmChannel.error",t),s(t)}))}))}detectDevices(t){ti.getDevices().then((e=>{const n=[],i=[];for(let t=0;t<e.length;t++){const r=e[t];"videoinput"==r.kind&&n.push({label:r.label||"camera-"+n.length,deviceId:r.deviceId,kind:r.kind}),"audioinput"==r.kind&&i.push({label:r.label||"microphone-"+n.length,deviceId:r.deviceId,kind:r.kind})}t({videos:n,audios:i})})).catch((t=>{qn.error("AgoraService.detectDevices",t)}))}getVideoOptions(t,e){return new Promise(((n,i)=>{if(e)if("videostream"===e.kind){const i=document.querySelector("#"+e.deviceId);i.crossOrigin="anonymous";var r=new Hls;r.attachMedia(i),r.on(Hls.Events.MEDIA_ATTACHED,(()=>{r.loadSource(e.src),r.on(Hls.Events.MANIFEST_PARSED,((e,r)=>{i.play().then((e=>{const r=i.captureStream();t.videoSource=r.getVideoTracks()[0],n(t)}),(t=>{qn.error("AgoraService.getVideoOptions.error",t)}))}))}))}else if("videoplayer"===e.kind||"videostream"===e.kind){const i=document.querySelector("#"+e.deviceId);i.crossOrigin="anonymous";const r=i.captureStream();t.videoSource=r.getVideoTracks()[0],n(t)}else t.cameraId=e.deviceId,n(t);else n(t)}))}getAudioOptions(t,e){return new Promise(((n,i)=>{if(e)if("videostream"===e.kind){const i=document.querySelector("#"+e.deviceId);i.crossOrigin="anonymous";var r=new Hls;r.attachMedia(i),r.on(Hls.Events.MEDIA_ATTACHED,(()=>{r.loadSource(e.src),r.on(Hls.Events.MANIFEST_PARSED,((e,s)=>{r.loadLevel=s.levels.length-1,i.play().then((e=>{const r=i.captureStream();t.audioSource=r.getAudioTracks()[0],n(t)}),(t=>{qn.error("AgoraService.getAudioOptions.error",t)}))}))}))}else if("videoplayer"===e.kind||"videostream"===e.kind){const i=document.querySelector("#"+e.deviceId);i.crossOrigin="anonymous";const r=i.captureStream();t.audioSource=r.getAudioTracks()[0],n(t)}else t.microphoneId=e.deviceId,n(t);else n(t)}))}async autoDetectDevice(){const t=ee.state;if(t.role===ne.SmartDevice){const t=await ti.getDevices(),e={videos:[],audios:[],video:null,audio:null};return t.forEach((t=>{"videoinput"===t.kind?e.videos.push(t):"audioinput"===t.kind&&e.audios.push(t)})),e.video=e.videos[0]||null,e.audio=e.audios[0]||null,ee.patchState({devices:e}),e}return t.devices}async createMediaStream(t,e,n){const i={streamID:t,video:Boolean(e),audio:Boolean(n),screen:!1};await this.getVideoOptions(i,e),await this.getAudioOptions(i,n);const r=Object.assign({},ee.state.quality);await this.createLocalStreamWithOptions(i,r)}async createLocalStreamWithOptions(t,e){try{let n,i;qn.log("AgoraService.createLocalStreamWithOptions",t,e),t.video&&(n=await Dn.createCameraVideoTrack({cameraId:t.cameraId,encoderConfig:e.profile})),t.audio&&(i=await Dn.createMicrophoneAudioTrack({microphoneId:t.microphoneId}));const r={uid:t.streamID,videoTrack:n,audioTrack:i,hasVideo:void 0!==n,hasAudio:void 0!==i},s=new $n(r,t.video?"video":"audio",!0);Zn.local=s,setTimeout((async()=>{await this.publishLocalStream()}),1),qn.log("AgoraService.createLocalStreamWithOptions.success",s)}catch(t){qn.error("AgoraService.createLocalStreamWithOptions.error",t)}}async publishLocalStream(){try{qn.log("AgoraService.publishLocalStream");const t=Zn.local,e=this.client;await e.publish(t.getTracks());const n=await this.setUserState();t.clientInfo=n,Zn.local=t}catch(t){throw qn.error("AgoraService.publishLocalStream.error",t),t}}async unpublishLocalStream(){try{qn.log("AgoraService.unpublishLocalStream");const t=this.client,e=Zn.local;e&&await t.unpublish(e.getTracks()),await this.clearLocalUserAttributes(),Zn.local=null}catch(t){throw qn.error("AgoraService.unpublishLocalStream.error",t),t}}async closeLocalStream(){try{const t=Zn.local;t&&await t.close(),await this.clearLocalUserAttributes(),Zn.local=null,qn.log("AgoraService.closeLocalStream",t)}catch(t){throw qn.error("AgoraService.closeLocalStream.error",t),t}}async leaveChannel(){try{ee.patchState({connecting:!1}),await this.closeLocalStream(),await this.closeScreenStream(),Zn.remotes=[],Zn.peers=[],await this.leaveMessageChannel(),await this.leaveClient(),await this.leaveScreenClient()}catch(t){throw qn.error("AgoraService.leaveChannel.error",t),t}}leaveClient(){return new Promise(((t,e)=>{const n=this.client;n?n.leave((()=>{this.client=null,D.flags.useProxy&&(n.stopProxyServer(),qn.log("AgoraService.leaveClient.stopProxyServer")),t()}),(t=>{qn.error("AgoraService.leaveClient.error",t),e(t)})):t()}))}leaveMessageChannel(){return new Promise(((t,e)=>{this.unobserveMemberCount();const n=this.channel;if(!n)return t();const i=this.messageClient;n.leave().then((()=>{this.channel=null,i.logout().then((()=>{this.messageClient=null,t()}),e)}),e)}))}async toggleCamera(){const t=Zn.local;t&&t.video&&(t.userMuteVideo?(await t.unmuteVideo(),ee.patchState({cameraMuted:!1}),this.broadcastEvent(new _n({streamId:t.streamId})),this.setUserState()):(await t.muteVideo(),ee.patchState({cameraMuted:!0}),this.broadcastEvent(new yn({streamId:t.streamId})),this.setUserState()))}async toggleAudio(){const t=Zn.local;t&&t.audio&&(t.userMuteAudio?(await t.unmuteAudio(),ee.patchState({audioMuted:!1}),this.broadcastEvent(new En({streamId:t.streamId})),this.setUserState()):(await t.muteAudio(),ee.patchState({audioMuted:!0}),this.broadcastEvent(new bn({streamId:t.streamId})),this.setUserState()))}setAudio(t){const e=Zn.local;e&&e.audio&&(t?(this.previousMuteAudio_=e.userMuteAudio,e.userMuteAudio||(e.muteAudio(),ee.patchState({audioMuted:!0}),this.broadcastEvent(new bn({streamId:e.streamId})),this.setUserState())):e.userMuteAudio&&!this.previousMuteAudio_&&(e.unmuteAudio(),ee.patchState({audioMuted:!1}),this.broadcastEvent(new En({streamId:e.streamId})),this.setUserState()))}toggleMode(){const t=ee.state.mode===un?dn:un;ee.patchState({mode:t}),Mn.send({type:Fe,mode:t}),this.setChannelState({mode:t})}toggleNavInfo(){const t=!ee.state.showNavInfo;ee.patchState({showNavInfo:t}),Mn.send({type:He,showNavInfo:t})}requestControl(t){return new Promise(((e,n)=>{this.sendRequestControl(t).then((t=>{ee.patchState({controlling:t,spying:!1}),e(t),this.setChannelState({controlling:t,spying:""})}))}))}requestSpy(t){return new Promise(((e,n)=>{this.sendRequestSpy(t).then((t=>{ee.patchState({spying:t,controlling:!1}),e(t),this.setChannelState({spying:t,controlling:""})}))}))}dismissControl(t){return void 0===t&&(t=!1),new Promise(((e,n)=>{const i=ee.state.controlling;i?this.sendRequestControlDismiss(i).then((()=>{ee.patchState({controlling:!1}),e(i),t||this.setChannelState({controlling:""})})):e(!1)}))}dismissSpy(t){return void 0===t&&(t=!1),new Promise(((e,n)=>{const i=ee.state.spying;i?this.sendRequestSpyDismiss(i).then((()=>{ee.patchState({spying:!1}),e(i),t||this.setChannelState({spying:""})})):e(!1)}))}toggleControl(t){this.dismissSpy(!0).then((()=>{this.dismissControl(!0).then((e=>{e!==t?this.requestControl(t).then((t=>{qn.log("AgoraService.toggleControl",t)})):this.setChannelState({controlling:""})}))}))}toggleSpy(t){this.dismissControl(!0).then((()=>{this.dismissSpy(!0).then((e=>{e!==t?this.requestSpy(t).then((t=>{qn.log("AgoraService.toggleSpy",t)})):this.setChannelState({spying:""})}))}))}sendRequestControl(t){return new Promise(((e,n)=>{this.sendMessage({type:qe,controllingId:t}).then((()=>{e(t)}))}))}sendRequestSpy(t){return new Promise(((e,n)=>{this.sendMessage({type:$e,spyingId:t}).then((()=>{e(t)}))}))}sendRequestControlDismiss(t){return new Promise(((e,n)=>{this.sendMessage({type:Ye,controllingId:t}).then((()=>{e(t)}))}))}sendRequestSpyDismiss(t){return new Promise(((e,n)=>{this.sendMessage({type:Xe,spyingId:t}).then((()=>{e(t)}))}))}toggleSilence(){const t=!ee.state.silencing;this.sendMessage({type:Ke,silencing:t}),ee.patchState({silencing:t})}newMessageId(){return`${ee.state.uid}-${Date.now().toString()}`}navToView(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1),ee.state.controlling!==ee.state.uid&&ee.state.spying!==ee.state.uid||this.sendMessage({type:Qe,viewId:t,keepOrientation:e,useLastOrientation:n})}getSessionStats(){this.client.getSessionStats((t=>{qn.log(`\nAgoraService.getSessionStats\n\tDuration: ${t.Duration}\n\tUserCount: ${t.UserCount}\n\tSendBytes: ${t.SendBytes}\n\tRecvBytes: ${t.RecvBytes}\n\tSendBitrate: ${t.SendBitrate}\n\tRecvBitrate: ${t.RecvBitrate}\n`)}))}getSystemStats(){this.client.getSystemStats((t=>{qn.log(`\nAgoraService.getSystemStats\n\t\t\tBatteryLevel: ${t.BatteryLevel}\n`)}))}sendMessage(t){return new Promise(((e,n)=>{if(ee.state.connected){switch(t.clientId=ee.state.uid,t.type){case De:case Be:case Ue:case Fe:case He:case Ve:case je:case Ge:case Qe:case ze:case We:case Je:case tn:case en:case on:case an:case cn:case ln:case Ze:if(ee.state.controlling!==ee.state.uid&&ee.state.spying!==ee.state.uid)return}const i=t=>{switch(e(t),t.type){case qe:this.broadcastMessage(t);break;case Ze:this.setChannelSnapshot(t)}},r=(t,e)=>{qn.log("AgoraService.sendMessage",t);try{const n=JSON.stringify(t);t.messageId&&this.once(`message-${t.messageId}`,(t=>{i(t)})),e.sendMessage({text:n}).then((()=>{t.messageId||i(t)})).catch((t=>{qn.error("AgoraService.sendMessage.error",t)}))}catch(t){qn.error("AgoraService.sendMessage.error",t)}},s=this.channel;if(s)r(t,s);else try{this.once("channel",(e=>{r(t,e)}))}catch(t){qn.error("AgoraService.sendMessage.error",t),n(t)}}else qn.error("AgoraService.sendMessage.error","not connected")}))}getChannelAttributes(){return qn.log("AgoraService.getChannelAttributes"),new Promise(((t,e)=>{const n=this.messageClient;if(n){n.getChannelAttributes(ee.state.channelNameLink).then((e=>{qn.log("AgoraService.getChannelAttributes",e),t(e)})).catch((e=>{qn.error("AgoraService.getChannelAttributes.error",e),t({})}))}else qn.error("AgoraService.getChannelAttributes.noop"),t({})}))}getChannelAttributesByKeys(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return qn.log("AgoraService.getChannelAttributesByKeys",e),new Promise(((t,n)=>{const i=this.messageClient;if(i){i.getChannelAttributes(ee.state.channelNameLink,e).then((e=>{qn.log("AgoraService.getChannelAttributesByKeys",e);const n={};Object.keys(e).forEach((t=>{n[t]=e[t].value})),t(n)})).catch((e=>{qn.error("AgoraService.getChannelAttributesByKeys.error",e),t({})}))}else qn.error("AgoraService.getChannelAttributesByKeys.noop",e),t({})}))}getChannelMessages(){return qn.log("AgoraService.getChannelMessages"),n.from(this.getChannelAttributes()).pipe(i.map((t=>Object.keys(t).filter((t=>0===t.indexOf("message-"))).map((e=>t[e])))),i.map((t=>{t.sort(((t,e)=>t.lastUpdateTs-e.lastUpdateTs));const e=t.map((t=>JSON.parse(t.value)));return qn.log("AgoraService.getChannelMessages",e),e})),i.catchError((t=>(qn.error("AgoraService.getChannelMessages.error",t),n.of([])))))}addOrUpdateChannelAttributes(t){return qn.log("AgoraService.addOrUpdateChannelAttributes",t),new Promise(((e,n)=>{const i=this.messageClient;if(i&&Object.keys(t).length>0){i.addOrUpdateChannelAttributes(ee.state.channelNameLink,t,{enableNotificationToChannelMembers:!1}).then((()=>{qn.log("AgoraService.addOrUpdateChannelAttributes",t)})).catch((t=>{qn.error("AgoraService.addOrUpdateChannelAttributes.error",t)})).finally((()=>{e()}))}else qn.error("AgoraService.addOrUpdateChannelAttributes.noop",t),e()}))}getInitialSession(){this.getChannelSession().then((t=>{ee.patchState(t.state),t.state.controlling&&t.snapshot&&this.broadcastMessage(t.snapshot),window.dispatchEvent(new Event("resize"))}))}getChannelSession(){return qn.log("AgoraService.getChannelSession"),new Promise(((t,e)=>{this.getChannelAttributesByKeys("channelState","channelSnapshot").then((e=>{const n={state:{},snapshot:{}};if(e.channelState){const t=JSON.parse(e.channelState);this.channelState=t,n.state=t}if(e.channelSnapshot){const t=JSON.parse(e.channelSnapshot);this.channelSnapshot=t,n.snapshot=t}qn.log("AgoraService.getChannelSession",n),t(n)})).catch((e=>{qn.error("AgoraService.getChannelSession.error",e),t({})}))}))}getChannelState(){return qn.log("AgoraService.getChannelState"),new Promise(((t,e)=>{this.getChannelAttributesByKeys("channelState").then((e=>{if(e.channelState){const n=JSON.parse(e.channelState);this.channelState=n,qn.log("AgoraService.getChannelState",n),t(n)}else t({})})).catch((e=>{qn.error("AgoraService.getChannelState.error",e),t({})}))}))}setChannelState(t){const e=ue(ue({},this.channelState||{}),t);return qn.log("AgoraService.setChannelState",t,e),this.addOrUpdateChannelAttributes({channelState:JSON.stringify(e)})}getChannelSnapshot(){return qn.log("AgoraService.getChannelSnapshot"),new Promise(((t,e)=>{this.getChannelAttributesByKeys("channelSnapshot").then((e=>{if(e.channelSnapshot){const n=JSON.parse(e.channelSnapshot);this.channelSnapshot=n,qn.log("AgoraService.getChannelSnapshot",n),t(n)}else t({})})).catch((e=>{qn.error("AgoraService.getChannelSnapshot.error",e),t({})}))}))}setChannelSnapshot(t){const e=ue(ue({},this.channelSnapshot||{}),t);return qn.log("AgoraService.setChannelSnapshot",t,e),this.addOrUpdateChannelAttributes({channelSnapshot:JSON.stringify(e)})}padStart(t,e,n){void 0===e&&(e=5),void 0===n&&(n="0");const i=String(t);return i.length>=e?i:new Array(e-i.length+1).join(n)+i}addOrUpdateChannelMessages(t){const e={};return t.forEach((t=>{const n=Math.floor(1e4*Math.random()),i=`message-${t.date}-${this.padStart(n)}`;e[i]=JSON.stringify(t)})),this.addOrUpdateChannelAttributes(e)}deleteChannelAttributesByKeys(t){return qn.log("AgoraService.deleteChannelAttributesByKeys",t),new Promise(((e,n)=>{const i=this.messageClient;if(i&&t.length>0){i.deleteChannelAttributesByKeys(ee.state.channelNameLink,t,{enableNotificationToChannelMembers:!1}).then((()=>{qn.log("AgoraService.deleteChannelAttributesByKeys",t),e()})).catch((t=>{qn.error("AgoraService.deleteChannelAttributesByKeys.error",t),n(t)}))}else qn.error("AgoraService.deleteChannelAttributesByKeys.noop",t),n("missing rtm client or keys")}))}setUserState(){const t={role:ee.state.role,name:ee.state.name,uid:ee.state.uid,screenUid:ee.state.screenUid,cameraMuted:ee.state.cameraMuted,audioMuted:ee.state.audioMuted};return qn.log("AgoraService.setUserState",t),this.addOrUpdateLocalUserAttributes({clientInfo:JSON.stringify(t)}).then((()=>t))}getUserState(t){return this.getUserAttributes(t).then((t=>{const e=JSON.parse(t.clientInfo||"");return qn.log("AgoraService.getUserState",e),e}))}addOrUpdateLocalUserAttributes(t){return qn.log("AgoraService.addOrUpdateLocalUserAttributes",t),new Promise(((e,n)=>{const i=this.messageClient;if(i&&Object.keys(t).length>0){i.addOrUpdateLocalUserAttributes(t).then((()=>{qn.log("AgoraService.addOrUpdateLocalUserAttributes",t),e()})).catch((t=>{qn.error("AgoraService.addOrUpdateLocalUserAttributes.error",t),n(t)}))}else qn.error("AgoraService.addOrUpdateLocalUserAttributes.noop",t),n("missing rtm client or attributes")}))}getUserAttributes(t){return qn.log("AgoraService.getUserAttributes",t),new Promise(((e,n)=>{const i=this.messageClient;if(i){i.getUserAttributes(t).then((t=>{qn.log("AgoraService.getUserAttributes",t),e(t)})).catch((t=>{qn.error("AgoraService.getUserAttributes.error",t),n(t)}))}else qn.error("AgoraService.getUserAttributes","missing rtm client"),n("missing rtm client")}))}clearLocalUserAttributes(){return qn.log("AgoraService.clearLocalUserAttributes"),new Promise(((t,e)=>{const n=this.messageClient;if(n){n.clearLocalUserAttributes().then((()=>{qn.log("AgoraService.clearLocalUserAttributes"),t()})).catch((e=>{qn.error("AgoraService.clearLocalUserAttributes.error",e),t()}))}else t()}))}checkBroadcastMessage(t){switch(t.type){case Ye:ee.patchState({controlling:!1}),t.controllingId===ee.state.uid&&this.closeScreenStream();break;case Xe:ee.patchState({spying:!1});break;case Ze:(ee.state.role===ne.Publisher||ee.state.controlling&&ee.state.controlling!==ee.state.uid)&&this.broadcastMessage(t);break;case Ke:ee.state.role===ne.Streamer&&this.broadcastMessage(t);break;case De:case Be:case Ue:case Fe:case He:case Ve:case je:case Ge:case Qe:case ze:case We:case Je:case tn:case en:case on:case an:case cn:case ln:(ee.state.controlling&&ee.state.controlling!==ee.state.uid||ee.state.spying&&ee.state.spying!==ee.state.uid)&&this.broadcastMessage(t);break;default:this.broadcastMessage(t)}}broadcastMessage(t){Mn.out(t)}broadcastEvent(t){Mn.out({type:Le,event:t})}peerAdd(t){qn.log("AgoraService.peerAdd",t);const e={uid:t},n=Zn.peers;n.push(e),Zn.peers=n,this.broadcastEvent(new mn({peer:e}))}peerRemove(t){qn.log("AgoraService.peerRemove",t);const e=Zn.peers,n=e.find((e=>e.uid===t));n&&(e.splice(e.indexOf(n),1),Zn.peers=e)}onMessage(t,e){if(e!==ee.state.uid){qn.log("AgoraService.onMessage",t.text,e);const n=JSON.parse(t.text);if(n.messageId&&this.has(`message-${n.messageId}`)&&this.emit(`message-${n.messageId}`,n),n.remoteId&&n.remoteId!==ee.state.uid&&n.remoteId!==ee.state.screenUid)return;if(n.type===an){const t=document.createElement("div");t.classList.add("player__vr"),n.container=t}this.checkBroadcastMessage(n)}else qn.log("AgoraService.onMessage",t.text)}onException(t){qn.error("AgoraService.onException",t)}async onUserJoined(t){qn.log("AgoraService.onUserJoined",t),this.peerAdd(t.uid)}async onUserLeft(t,e){qn.log("AgoraService.onUserLeft",t,e);const n=t.uid.toString();if(n!==ee.state.uid){const t=this.remoteRemove(n);t&&t.clientInfo&&(t.clientInfo.role===ne.Publisher?ee.state.role===ne.SelfService?ee.patchState({hosted:!0,controlling:!1,spying:!1,silencing:!1}):ee.patchState({hosted:!1,controlling:!1,spying:!1,silencing:!1}):(ee.state.controlling===n&&ee.patchState({controlling:!1}),ee.state.spying===n&&ee.patchState({spying:!1})))}this.peerRemove(n)}async onUserPublished(t,e){const n=t.uid.toString();if(qn.log("AgoraService.onUserPublished",n,t,e),n!==ee.state.uid&&n!==ee.state.screenUid){await this.client.subscribe(t,e);let n=Zn.getRemoteById(t.uid);n?n.published(t,e):(n=new $n(t,e),await this.remoteAdd(n))}else{const t={role:ee.state.role,name:ee.state.name,uid:ee.state.uid,screenUid:ee.state.screenUid},e=Zn.local;e.clientInfo=t,Zn.local=e}}async remoteAdd(t){qn.log("AgoraService.remoteAdd",t),Zn.remoteAdd(t),this.broadcastEvent(new gn({stream:t}));const e=t.streamId;setTimeout((async()=>{const t=e.split("_")[0],n=await this.getUserState(t);if(qn.log("AgoraService.remoteAdd.getUserState",n),Zn.remoteSetClientInfo(e,n),n.cameraMuted&&this.broadcastEvent(new yn({streamId:e})),n.audioMuted&&this.broadcastEvent(new bn({streamId:e})),n.role===ne.Publisher){const t={hosted:!0};ee.patchState(t),this.getInitialSession()}}),100)}async onUserUnpublished(t,e){const n=t.uid.toString();if(n!==ee.state.uid&&n!==ee.state.screenUid){let n=Zn.getRemoteById(t.uid);n&&n.unpublished(t,e)}}remoteRemove(t){const e=Zn.remoteRemove(t);return e&&e.clientInfo&&e.clientInfo.role===ne.Publisher&&e.clientInfo.screenUid!==t&&ee.patchState({hosted:!1}),e}onUserInfoUpdated(t){switch(qn.log("AgoraService.onUserInfoUpdated",t),t.msg){case"mute-audio":this.broadcastEvent(new bn({streamId:t.uid}));break;case"unmute-audio":this.broadcastEvent(new En({streamId:t.uid}));break;case"mute-video":this.broadcastEvent(new yn({streamId:t.uid}));break;case"unmute-video":this.broadcastEvent(new _n({streamId:t.uid}))}this.broadcastEvent(new vn({streamId:t.uid,message:t.msg}))}onVolumeIndicator(t){const e=t.attr.map((t=>({streamId:t.uid,level:t.level})));this.broadcastEvent(new wn({streams:e}))}onConnectionStateChange(t){qn.log("AgoraService.onConnectionStateChange",t)}onTokenPrivilegeWillExpire(t){qn.log("AgoraService.onTokenPrivilegeWillExpire");const e=this.client,n=this.getChannelNameLink();ti.rtcToken$(n).subscribe((async t=>{t.token&&(await e.renewToken(t.token),qn.log("AgoraService.onTokenPrivilegeWillExpire.renewed"))}))}onTokenPrivilegeDidExpire(t){qn.log("AgoraService.onTokenPrivilegeDidExpire");const e=this.client,n=this.getChannelNameLink();ti.rtcToken$(n).subscribe((async t=>{t.token&&(await e.renewToken(t.token),qn.log("AgoraService.onTokenPrivilegeDidExpire.renewed"))}))}toggleScreen(){if(this.isAudienceRole)return;Zn.screen?this.closeScreenStream():this.openScreenStream()}async openScreenStream(){let t=this.screenClient;t||(t=await this.createScreenClient()),t&&await this.createScreenStream(ee.state.screenUid)}async createScreenClient(){let t=null;try{t=Dn.createClient({mode:"live",codec:"h264"}),t.on("exception",this.onScreenException),t.on("user-published",this.onScreenPublished),t.on("user-unpublished",this.onScreenUnpublished),await t.setClientRole("host"),D.flags.useProxy&&(t.startProxyServer(3),qn.log("AgoraService.openScreenStream.startProxyServer"));const e=this.getChannelNameLink(),n=await ti.rtcToken$(e).toPromise();qn.log("AgoraService.toggleScreen.rtcToken$",n),await this.screenJoin(t,n.token,e)}catch(t){qn.error("AgoraService.openScreenStream.error",t)}return this.screenClient=t,t}async screenJoin(t,e,n){try{const i=ee.state.uid+"_"+ti.getUniqueUserId(),r=await t.join(D.appKey,n,e,i);qn.log("AgoraService.screenJoin",r),ee.patchState({screenUid:r})}catch(e){if(qn.error("AgoraService.screenJoin.error",e),"DYNAMIC_KEY_EXPIRED"===e){const e=await ti.rtcToken$(n).toPromise();await this.screenJoin(t,e.token,n)}}}async createScreenStream(t){try{const e=ye.find((t=>t.profile===D.profiles.screen));let n=await Dn.createScreenVideoTrack({displaySurface:"monitor",encoderConfig:e.profile},"disable");const i=new $n({uid:t,videoTrack:n,hasVideo:void 0!==n},"video",!0);Zn.screen=i,setTimeout((async()=>{await this.publishScreenStream()}),1),qn.log("AgoraService.createLocalStreamWithOptions.success",i)}catch(t){qn.error("AgoraService.createLocalStreamWithOptions.error",t)}}async publishScreenStream(){try{qn.log("AgoraService.publishScreenStream");const t=Zn.screen,e=this.screenClient;await e.publish(t.getTracks());const n=await this.setUserState();t.clientInfo=n,Zn.screen=t}catch(t){throw qn.error("AgoraService.publishScreenStream.error",t),t}}async unpublishScreenStream(){try{qn.log("AgoraService.unpublishScreenStream");const t=this.screenClient,e=Zn.screen;e&&t&&await t.unpublish(e.getTracks()),Zn.screen=null}catch(t){throw qn.error("AgoraService.unpublishScreenStream.error",t),t}}async closeScreenStream(){try{const t=Zn.screen;t&&await t.close(),await this.clearLocalUserAttributes(),Zn.screen=null,qn.log("AgoraService.closeScreenStream",t)}catch(t){throw qn.error("AgoraService.closeScreenStream.error",t),t}}leaveScreenClient(){return new Promise(((t,e)=>{const n=this.screenClient;n?n.leave((()=>{this.screenClient=null,D.flags.useProxy&&(n.stopProxyServer(),qn.log("AgoraService.leaveScreenClient.stopProxyServer")),t()}),(t=>{qn.error("AgoraService.leaveScreenClient.error",t),e(t)})):t()}))}onScreenException(t){qn.error("AgoraService.onScreenException",t)}onScreenPublished(t){qn.log("AgoraService.onScreenPublished",t)}onScreenUnpublished(t){qn.log("AgoraService.onScreenUnpublished",t)}static getSingleton(t){if(!C)return this.AGORA||(this.AGORA=new ti(t)),this.AGORA}static getUniqueUserId(){return(1e13*(100*(1+Math.floor(8*Math.random()))+10*(1+Math.floor(8*Math.random()))+1*(1+Math.floor(8*Math.random())))+Date.now()).toString()}static resolveUserId(){let t=Yn.get("bHereClientId");return"number"==typeof t?t.toString():"string"==typeof t?t:ti.getUniqueUserId()}static storeUserId(t){Yn.set("bHereClientId",t)}static fixLegacy(){["moz","webkit"].forEach((t=>{qn.log("AgoraService.fixLegacy",`${t}RTC`),Object.getOwnPropertyNames(window).filter((t=>0===t.indexOf("RTC"))).map((e=>{const n=`${t}${e}`;void 0!==window[e]&&void 0===window[n]&&(window[n]=window[e])}))}))}static rtcToken$(t){return D.flags.useToken?Sn.post$("/api/token/rtc",{channelName:t,uid:null}):n.of({token:null})}static rtmToken$(t){return D.flags.useToken?Sn.post$("/api/token/rtm",{uid:t}):n.of({token:null})}static checkRtcConnection(){return new Promise(((t,e)=>{try{const n=Dn.createClient({mode:"live",codec:"h264"});D.flags.useProxy&&n.startProxyServer(3),ti.checkRtcTryJoin(n).then((e=>{t(e)})).catch((t=>{e(t)})).finally((()=>{n.leave((()=>{D.flags.useProxy&&n.stopProxyServer()}),(()=>{}))}))}catch(t){e(t)}}))}static checkRtcTryJoin(t){return new Promise(((e,n)=>{const i="checkRtcConnection";ti.rtcToken$(i).subscribe((async r=>{try{const n=await t.join(D.appKey,i,r.token,null);e(n)}catch(e){if("DYNAMIC_KEY_EXPIRED"===e)return ti.checkRtcTryJoin(t);qn.error("AgoraService.checkRtcConnection.error",e),n(e)}}),(t=>n(t)))}))}static checkRtmConnection(t){return new Promise(((e,n)=>{try{let i,r=AgoraRTM.createInstance(D.appKey,{logFilter:AgoraRTM.LOG_FILTER_OFF});r.setParameters({logFilter:AgoraRTM.LOG_FILTER_OFF}),ti.rtmToken$(t).subscribe((s=>{r.login({token:s.token,uid:t.toString()}).then((()=>{i=r.createChannel("checkRtcConnection"),i.join().then((()=>{e(t),i.leave()})).catch((t=>{n(t)})).finally((()=>{i.leave().then((()=>{i=null,r.logout().then((()=>{r=null})).catch((()=>{}))})).catch((()=>{}))}))})).catch((t=>{qn.error("checkRtmConnection.error",t),n(t)})).finally((()=>{r&&r.logout().then((()=>{r=null})).catch((()=>{}))}))}),(t=>n(t)))}catch(t){n(t)}}))}static async getDevices(){let t=ti.devices_;if(t)return t;{t=ti.devices_=[];const e={audio:!0,video:!0};if(jn.platform===Un&&(e.video={facingMode:"user"}),jn.platform===Vn&&(e.video=!1),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const n=await navigator.mediaDevices.getUserMedia(e),i=await navigator.mediaDevices.enumerateDevices();return n.getTracks().forEach((t=>{t.stop()})),i.forEach((e=>{t.push(e)})),t}throw"Media device not available"}}}class ei{constructor(t,e,n){this.type=ke,this.clientId_=e,"string"==typeof t?(this.date=Date.now(),this.clientId=e,this.name=n,this.message=t):"object"==typeof t&&(this.date=t.date,this.clientId=t.clientId,this.name=t.name,this.message=t.message);const i=this.name.split(" ");this.shortName=i[0].substr(0,1).toUpperCase()+(i.length>1?i[1]:i[0]).substr(0,1).toUpperCase()}get me(){return this.clientId===this.clientId_}getPayload(){return{date:this.date,clientId:this.clientId,name:this.name,message:this.message}}getCopy(){return new ei({date:this.date,clientId:this.clientId,name:this.name,message:this.message},this.clientId_)}}class ni extends t.Component{constructor(){super(...arguments),this.typings_=!1}onInit(){this.rows=1,this.showEmoji=!1,this.demo=-1!==window.location.pathname.indexOf("layout");const t=this.form=new e.FormGroup({message:null});if(this.controls=t.controls,t.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.checkTypings(t),this.pushChanges()})),ee.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{})),Mn.out$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{switch(t.type){case ke:this.pushMessage(new ei(t,ee.state.uid,ee.state.name));break;case Ne:this.typingBegin(t);break;case Pe:this.typingEnd(t)}})),this.messages=[],this.groupedMessages=[],this.demo){const t=ni.getFakeList().map((t=>new ei(t,ee.state.uid,ee.state.name)));this.updateMessages(t.slice(0,5)),Mn.in$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{switch(t.clientId=t.clientId||ee.state.uid,t.type){case ke:break;case Ne:case Pe:Mn.out(t)}}))}else{const t=this.agora=ti.getSingleton();t&&t.getChannelMessages().pipe(i.first()).subscribe((t=>{t=t.map((t=>new ei(t,ee.state.uid,ee.state.name))),this.updateMessages(t)}))}}onView(){}onChanges(){}onDestroy(){ni.to&&(clearTimeout(ni.to),ni.to=null)}onSubmit(){const t=this.secureText(this.form.value.message),e=this.createMessage(t);this.sendMessage(e),this.form.get("message").value=null,this.demo}onKeyDown(e){if("Enter"===e.key){e.shiftKey?(this.rows=Math.min(4,this.rows+1),this.pushChanges()):(e.preventDefault(),this.onSubmit(),this.rows=1);const{node:n}=t.getContext(this);n.querySelector("textarea").setAttribute("rows",this.rows)}}onToggleEmoji(){this.showEmoji=!this.showEmoji,this.pushChanges()}onSelectEmoji(t){this.showEmoji=!1,this.form.get("message").value=(this.form.get("message").value||"")+t.char}secureText(t){return(new DOMParser).parseFromString(t,"text/html").body.textContent||""}createMessage(t){return new ei(t,ee.state.uid,ee.state.name)}sendMessage(t){this.pushMessage(t);const e=this.agora;e&&e.addOrUpdateChannelMessages([t.getPayload()]),Mn.send(t)}onClose(t){this.close.next()}scrollToBottom(){const{node:e}=t.getContext(this),n=e.querySelector(".group--scrollview");n.scrollTop=n.scrollHeight}pushMessage(t){const e=this.messages?this.messages.slice():[];this.removeTyping({type:Ne,clientId:t.clientId},this.messages),e.push(t),this.updateMessages(e)}typingBegin(t){const e=this.messages?this.messages.slice():[];e.push(t),this.updateMessages(e)}typingEnd(t){const e=this.messages?this.messages.slice():[];this.removeTyping({type:Ne,clientId:t.clientId},e),this.updateMessages(e)}removeTyping(t,e,n){void 0===n&&(n=!0);const i=e.reduce(((e,n,i)=>n.type===t.type&&n.clientId===t.clientId?i:e),-1);return-1!==i&&(e.splice(i,1),!0===n&&this.removeTyping(t,e,!0)),i}checkTypings(t){const e=t.message&&t.message.length>0||!1;this.typings_!==e&&(this.typings_=e,e?Mn.send({type:Ne}):Mn.send({type:Pe}))}updateMessages(t){this.messages=t,this.groupedMessages=[],this.pushChanges();const e=[];t.forEach((t=>{if(t.type===ke){const n=e.length?e[e.length-1]:null;n&&n.clientId===t.clientId?n.message+=`<p>${t.message}</p>`:e.push(t.getCopy())}else if(t.type===Ne){const n=e.reduce(((e,n,i)=>n.clientId===t.clientId?n:e),null);n&&(n.typing=!0)}})),this.groupedMessages=e,this.pushChanges(),setTimeout((()=>{this.scrollToBottom()}),1)}isValid(){return this.form.valid&&this.form.value.message&&this.form.value.message.length>0}randomMessage(){ni.to&&(clearTimeout(ni.to),ni.to=null),ni.to=setTimeout((()=>{const t=ni.createRandomMessage();this.sendMessage(t)}),1e3*(2+6*Math.random()))}}ni.meta={selector:"[agora-chat]",outputs:["close"],template:'\n\t\t<div class="group--scrollview" [class]="\'rows--\' + rows">\n\t\t\t<div class="group--virtual" *virtual="let item of groupedMessages" [mode]="4" [width]="350" [gutter]="0" [reverse]="true">\n\t\t\t\t\x3c!-- serve un nodo figlio --\x3e\n\t\t\t\t<div class="listing__item message" [class]="{ me: item.me, typing: item.typing }">\n\t\t\t\t\t<div class="message__avatar" [title]="item.name"><span [innerHTML]="item.shortName"></span></div>\n\t\t\t\t\t<div class="message__content">\n\t\t\t\t\t\t<div [innerHTML]="item.message | message"></div>\n\t\t\t\t\t\t<div class="typing-indicator">\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t\t<span></span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="group--message" [class]="\'rows--\' + rows">\n\t\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onSubmit($event)" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t<div class="group--form group--form--addon" [class]="{ required: controls.message.validators.length, \'addon\': controls.message.valid }">\n\t\t\t\t\t\x3c!-- <input type="text" class="control--text" [formControl]="controls.message" [placeholder]="\'bhere_write_a_message\' | label" /> --\x3e\n\t\t\t\t\t<button type="button" class="control--pre" (click)="onToggleEmoji()">\n\t\t\t\t\t\t<svg class="emoji" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#emoji"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<textarea class="control--text" [formControl]="controls.message" [placeholder]="\'bhere_write_a_message\' | label" rows="1" (keydown)="onKeyDown($event)"></textarea>\n\t\t\t\t\t<button type="submit" class="control--addon">\n\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#send"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t\t<div class="group--close">\n\t\t\t<button type="button" class="btn--close" [title]="\'title_close\' | label" (click)="onClose($event)">\n\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="group--emoji" [class]="\'rows--\' + rows" agora-chat-emoji (emoji)="onSelectEmoji($event)" (close)="onToggleEmoji()" *if="showEmoji">\n\t\t\t<div class="group--virtual" *virtual="let item of items" [mode]="1" [width]="40" [gutter]="10" [reverse]="true">\n\t\t\t\t\x3c!-- serve un nodo figlio --\x3e\n\t\t\t\t<div class="listing__item emoji">\n\t\t\t\t\t<button type="button" class="btn--emoji" (click)="onSelect(item)"><span [innerHTML]="item.char"></span></button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="group--close">\n\t\t\t\t<button type="button" class="btn--close" [title]="\'title_close\' | label" (click)="onClose($event)">\n\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t'},ni.getFakeList=()=>{let t=[{date:161459223e4,name:"Jhon Appleseed",message:"Function-based web-enabled benchmark",clientId:"7341614597544882"},{date:161459224e4,name:"Jhon Appleseed",message:"Customizable exuding superstructure",clientId:"7341614597544882"},{date:161459225e4,name:"Gilles Pitkins",message:"Synergistic interactive archive",clientId:"cfe9ff5b-f7da-449d-bf5a-3184b5eba6ea"},{date:161459226e4,name:"Jhon Appleseed",message:"Digitized client-server initiative",clientId:"7341614597544882"},{date:161459227e4,name:"Jhon Appleseed",message:"Quality-focused tertiary open system",clientId:"7341614597544882"},{date:161459228e4,name:"Jhon Appleseed",message:"Exclusive uniform middleware",clientId:"7341614597544882"},{date:161459229e4,name:"John Pruckner",message:"Decentralized disintermediate extranet",clientId:"ae51e846-d043-41e9-bb5c-3189181e5b43"},{date:16145923e5,name:"Lamont Georgievski",message:"Enhanced static approach",clientId:"1961cd9e-93aa-4bd0-b96a-89fcbd36b257"},{date:161459231e4,name:"Jhon Appleseed",message:"Ergonomic clear-thinking info-mediaries",clientId:"7341614597544882"},{date:161459232e4,name:"Jeri Pedroni",message:"Grass-roots dynamic encryption",clientId:"13d69bba-3656-449b-8fe3-d7a87062b044"},{date:161459233e4,name:"Frederik Dechelle",message:"Compatible disintermediate policy",clientId:"9151ebe0-efa8-40b4-a341-b8fd489e9c88"},{date:161459234e4,name:"Jhon Appleseed",message:"Inverse user-facing adapter",clientId:"7341614597544882"},{date:161459235e4,name:"Jhon Appleseed",message:"Future-proofed even-keeled application",clientId:"7341614597544882"},{date:161459236e4,name:"Cassie Jonathon",message:"Profit-focused content-based budgetary management",clientId:"5b3dc6f3-2a3d-493d-aac5-66ddfce2d709"},{date:161459237e4,name:"Jhon Appleseed",message:"Managed intermediate monitoring",clientId:"7341614597544882"},{date:161459238e4,name:"Jhon Appleseed",message:"Exclusive client-server encoding",clientId:"7341614597544882"},{date:161459239e4,name:"Jhon Appleseed",message:"Cross-group system-worthy matrices",clientId:"7341614597544882"},{date:16145924e5,name:"Jhon Appleseed",message:"Upgradable encompassing benchmark",clientId:"7341614597544882"},{date:161459241e4,name:"Emelen Beevors",message:"Function-based full-range knowledge base",clientId:"c93aea47-ebd8-4e5e-88fd-52053dd35cd1"},{date:161459242e4,name:"Jhon Appleseed",message:"Synergistic system-worthy capability",clientId:"7341614597544882"}];for(;t.length<100;)t=t.concat(t);return t},ni.createRandomMessage=t=>new ei({date:Date.now(),clientId:"9fe0e1b9-6a6b-418b-b916-4bbff3eeb123",name:"Herman frederick",message:"Lorem ipsum dolor"},ee.state.uid,ee.state.name),ni.randomMessage=(t,e)=>{ni.to&&(clearTimeout(ni.to),ni.to=null),ni.to=setTimeout((()=>{const n=function(){const t=e.filter((t=>"7341614597544882"!==t.id));let n=t[Math.floor(t.length*Math.random())];return n=new ei({date:Date.now(),clientId:"9fe0e1b9-6a6b-418b-b916-4bbff3eeb123",name:n.name,message:n.message},ee.state.uid,ee.state.name),n}();t.sendMessage(n),ni.randomMessage(t,e)}),1e3*(2+6*Math.random()))};class ii extends t.Component{}ii.meta={selector:"[agora-check]",inputs:["value"],template:'\n\t\t<svg *if="value == null" class="checkmark idle" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n\t\t\t<circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>\n\t\t</svg>\n\t\t<svg *if="value === true" class="checkmark success" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n\t\t\t<circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>\n\t\t\t<path class="checkmark__icon" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" stroke-linecap="round"/>\n\t\t</svg>\n\t\t<svg *if="value === false" class="checkmark error" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">\n\t\t\t<circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>\n\t\t\t<path class="checkmark__icon" stroke-linecap="round" fill="none" d="M16 16 36 36 M36 16 16 36"/>\n\t\t</svg>\n\t'};class ri{constructor(t){this.data=t}}class si extends ri{}class oi extends ri{}class ai{static get hasModal(){return this.hasModal_}static set hasModal(t){if(this.hasModal_!==t){this.hasModal_=t;const e=document.querySelector("body");t?e.classList.add("modal-open"):e.classList.remove("modal-open")}}static open$(t){return this.busy$.next(!0),(t.iframe?n.of(`<div class="iframe-modal" iframe-modal src="${t.iframe}"></div>`):this.getTemplate$(t)).pipe(i.map((e=>({node:this.getNode(e),data:t.data,modal:t}))),i.tap((t=>{this.modal$.next(t),this.hasModal=!0,this.busy$.next(!1)})),i.switchMap((t=>this.events$)),i.tap((t=>this.hasModal=!1)))}static getTemplate$(t){return t.src?n.from(fetch(t.src).then((t=>t.text()))):t.template?n.of(t.template):n.EMPTY}static getNode(t){const e=document.createElement("div");e.innerHTML=t;return e.firstElementChild}static reject(t){this.modal$.next(null),this.events$.next(new oi(t))}static resolve(t){this.modal$.next(null),this.events$.next(new si(t))}}ai.modal$=new n.Subject,ai.events$=new n.Subject,ai.busy$=new n.Subject;class ci{static delete(t){this.isLocalStorageSupported()&&window.localStorage.removeItem(t)}static exist(t){if(this.isLocalStorageSupported())return void 0!==window.localStorage[t]}static get(t){let e=null;if(this.isLocalStorageSupported()&&void 0!==window.localStorage[t])try{e=JSON.parse(window.localStorage[t])}catch(e){console.log("LocalStorageService.get.error parsing",t,e)}return e}static set(t,e){if(this.isLocalStorageSupported())try{const n=[],i=JSON.stringify(e,(function(t,e){if("object"==typeof e&&null!==e){if(-1!==n.indexOf(e))return;n.push(e)}return e}));window.localStorage.setItem(t,i)}catch(n){console.log("LocalStorageService.set.error serializing",t,e,n)}}static isLocalStorageSupported(){if(this.supported)return!0;let t=!1;try{t="localStorage"in window&&null!==window.localStorage,t?(window.localStorage.setItem("test","1"),window.localStorage.removeItem("test")):t=!1}catch(e){t=!1}return this.supported=t,t}}const li=100;class ui{static checklist$(){return ee.state$.pipe(i.first(),i.map((t=>{const e={shouldCheckAudio:!0,shouldCheckVideo:!0,key:"checklist_audio_video",uid:null,checklist:{browser:null,https:null,video:null,audio:null,rtc:null,rtm:null},errors:{}};return t.role===ne.Viewer&&(e.shouldCheckAudio=!1,e.shouldCheckVideo=!1),jn.platform===Vn&&(e.shouldCheckAudio=!0,e.shouldCheckVideo=!1),e.key=`checklist${e.shouldCheckAudio?"_audio":""}${e.shouldCheckVideo?"_video":""}`,e})),i.switchMap((t=>(!0===ci.get(t.key)&&Object.keys(t.checklist).forEach((e=>{t.checklist[e]=!0})),n.of(t)))))}static isChecked(t){return Object.keys(t.checklist).reduce(((e,n,i)=>{const r=e&&t.checklist[n];switch(n){case"audio":return r||!t.shouldCheckAudio;case"video":return r||!t.shouldCheckVideo;default:return r}}),!0)}static isChecked$(){return this.checklist$().pipe(i.map((t=>this.isChecked(t))))}static checkEvent$(){return this.checklist$().pipe(i.switchMap((t=>{if(!0===Object.keys(t.checklist).reduce(((e,n,i)=>e&&t.checklist[n]),!0))return n.of(t);{ci.set(t.key,!1);const e=new n.Subject,r=n.of(t).pipe(i.delay(1e3),i.switchMap((t=>(e.next(t),this.checkBrowserEvent$(t)))),i.switchMap((t=>(e.next(t),this.checkHttpsEvent$(t)))),i.switchMap((t=>(e.next(t),this.checkAudioEvent$(t)))),i.switchMap((t=>(e.next(t),this.checkVideoEvent$(t)))),i.switchMap((t=>(e.next(t),this.checkRtcEvent$(t)))),i.switchMap((t=>(e.next(t),this.checkRtmEvent$(t)))),i.tap((t=>{ci.set(t.key,!0)})));return n.merge(e,r)}})))}static check$(){return this.checklist$().pipe(i.switchMap((t=>!0===Object.keys(t.checklist).reduce(((e,n,i)=>e&&t.checklist[n]),!0)?n.of(t):(ci.set(t.key,!1),n.of(t).pipe(i.delay(1e3),i.switchMap((t=>this.checkBrowserEvent$(t))),i.switchMap((t=>this.checkHttpsEvent$(t))),i.switchMap((t=>this.checkAudioEvent$(t))),i.switchMap((t=>this.checkVideoEvent$(t))),i.switchMap((t=>this.checkRtcEvent$(t))),i.switchMap((t=>this.checkRtmEvent$(t))),i.tap((t=>{ci.set(t.key,!0)})))))))}static checkBrowser$(){const t=AgoraRTC.checkSystemRequirements();return n.of(t)}static checkBrowserEvent$(t){return this.checkBrowser$().pipe(i.switchMap((e=>(t.checklist.browser=e,e?n.of(t).pipe(i.delay(li)):(t.errors.browser=fe.transform("bhere_browser_error"),this.checkHttpsEvent$(t).pipe(i.switchMap((t=>n.throwError(t)))))))),i.catchError((e=>(console.log("checkBrowserEvent$.error",e),t.checklist.browser=!1,t.errors.browser=fe.transform("bhere_browser_error"),n.throwError(t)))))}static checkHttps$(){const t="https:"===window.location.protocol;return n.of(t)}static checkHttpsEvent$(t){return this.checkHttps$().pipe(i.switchMap((e=>(t.checklist.https=e,e?n.of(t).pipe(i.delay(li)):(t.errors.https=fe.transform("bhere_https_error"),n.throwError(t))))),i.catchError((e=>(console.log("checkHttpsEvent$.error",e),t.checklist.https=!1,t.errors.https=fe.transform("bhere_https_error"),n.throwError(t)))))}static checkAudio$(){return n.from(ti.getDevices()).pipe(i.map((t=>null!=t.find((t=>"audioinput"===t.kind&&t.deviceId)))))}static checkAudioEvent$(t){return t.shouldCheckAudio?this.checkAudio$().pipe(i.switchMap((e=>(t.checklist.audio=e,e?n.of(t).pipe(i.delay(li)):(t.errors.audio=fe.transform("bhere_audio_error"),n.throwError(t))))),i.catchError((e=>(console.log("checkAudioEvent$.error",e),t.checklist.audio=!1,t.errors.audio=fe.transform("bhere_audio_error"),n.throwError(t))))):n.of(t)}static checkVideo$(){return n.from(ti.getDevices()).pipe(i.map((t=>null!=t.find((t=>"videoinput"===t.kind&&t.deviceId)))))}static checkVideoEvent$(t){return t.shouldCheckVideo?this.checkVideo$().pipe(i.switchMap((e=>(t.checklist.video=e,e?n.of(t).pipe(i.delay(li)):(t.errors.video=fe.transform("bhere_video_error"),n.throwError(t))))),i.catchError((e=>(console.log("checkVideoEvent$.error",e),t.checklist.video=!1,t.errors.video=fe.transform("bhere_video_error"),n.throwError(t))))):n.of(t)}static checkRtc$(){return n.from(ti.checkRtcConnection())}static checkRtcEvent$(t){return this.checkRtc$().pipe(i.switchMap((e=>(t.uid=e,t.checklist.rtc=!1!==e,e?n.of(t).pipe(i.delay(li)):(t.errors.rtc=fe.transform("bhere_rtc_error"),n.throwError(t))))),i.catchError((e=>(console.log("checkRtcEvent$.error",e),t.checklist.rtc=!1,t.errors.rtc=fe.transform("bhere_rtc_error"),n.throwError(t)))))}static checkRtm$(t){return n.from(ti.checkRtmConnection(t))}static checkRtmEvent$(t){return this.checkRtm$(t.uid).pipe(i.switchMap((e=>(t.checklist.rtm=!1!==e,e?n.of(t):(t.errors.rtm=fe.transform("bhere_rtm_error"),n.throwError(t))))),i.catchError((e=>(console.log("checkRtmEvent$.error",e),t.checklist.rtm=!1,t.errors.rtm=fe.transform("bhere_rtm_error"),n.throwError(t)))))}}class di extends t.Component{onClose(){ai.resolve()}}di.meta={selector:"[agora-configure-firewall-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form" [innerHTML]="\'bhere_configure_firewall\' | label"></div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="button" class="btn--accept" (click)="onClose()">\n\t\t\t\t\t<span>Chiudi</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</div>\n\t'},di.chunk=()=>'<div class="configure-firewall-modal" agora-configure-firewall-modal></div>';class hi extends t.Component{onInit(){this.platform=jn.platform,this.checklist={},this.errors={},this.state={},this.busy=!0,this.shouldCheckAudio=!1,this.shouldCheckVideo=!1,ui.checkEvent$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.shouldCheckAudio=t.shouldCheckAudio,this.shouldCheckVideo=t.shouldCheckVideo,this.checklist=t.checklist,this.errors=t.errors||{};const e=ui.isChecked(t);e?(this.checklist.success=e,this.busy=!1,this.pushChanges(),this.state.role===ne.SmartDevice&&this.onNext()):this.pushChanges()}),(t=>{this.errors=t.errors||{},this.checklist.error=!0,this.busy=!1,this.pushChanges()}))}onNext(){this.checked.next(this.checklist)}openHttps(){window.location.href=window.location.href.replace("http://","https://").replace(":5000",":6443")}showFirewallConfiguration(){ai.open$({template:di.chunk()}).pipe(i.first()).subscribe()}}hi.meta={selector:"[agora-checklist]",outputs:["checked"],template:'\n\t<div class="group--info">\n\t\t<div class="group--info__content stagger--childs">\n\t\t\t<div class="title" *if="busy" [innerHTML]="\'bhere_checklist_busy\' | label"></div>\n\t\t\t<div class="title" *if="checklist.success" [innerHTML]="\'bhere_checklist_success\' | label"></div>\n\t\t\t<div class="title" *if="checklist.error" [innerHTML]="\'bhere_checklist_error\' | label"></div>\n\t\t\t<ul class="group--checklist stagger--childs">\n\t\t\t\t<li class="checklist__item check"><span>Browser</span> <span agora-check [value]="checklist.browser"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.browser"><a class="btn--link" href="https://browsehappy.com/" target="_blank" rel="noopener" [innerHTML]="errors.browser"></a></li>\n\t\t\t\t<li class="checklist__item check"><span>Https</span> <span agora-check [value]="checklist.https"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.https"><a class="btn--link" (click)="openHttps()" [innerHTML]="errors.https"></a></li>\n\t\t\t\t<li class="checklist__item check" *if="shouldCheckAudio"><span>Audio</span> <span agora-check [value]="checklist.audio"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.audio"><span [innerHTML]="errors.audio"></span></li>\n\t\t\t\t<li class="checklist__item check" *if="shouldCheckVideo"><span>Video</span> <span agora-check [value]="checklist.video"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.video"><span [innerHTML]="errors.video"></span></li>\n\t\t\t\t<li class="checklist__item check"><span>Realtime Communication</span> <span agora-check [value]="checklist.rtc"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.rtc"><a class="btn--link" (click)="showFirewallConfiguration()" [innerHTML]="errors.rtc"></a></li>\n\t\t\t\t<li class="checklist__item check"><span>Realtime Messaging</span> <span agora-check [value]="checklist.rtm"></span></li>\n\t\t\t\t<li class="checklist__item error" *if="errors.rtm"><a class="btn--link" (click)="showFirewallConfiguration()" [innerHTML]="errors.rtm"></a></li>\n\t\t\t</ul>\n\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !checklist.success, ready: checklist.success }" (click)="onNext()">\n\t\t\t\t<span [innerHTML]="\'bhere_proceed\' | label"></span>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t'};class Ai{static get context(){return!this.context_&&"AudioContext"in window&&(this.context_=new AudioContext),this.context_}static get analyser(){if(!this.analyser_)try{this.analyser_=this.context.createAnalyser()}catch(t){console.log("AudioStreamService.analyser",t)}return this.analyser_}static addSource(t){const e=t instanceof MediaStream?t.id:t;return this.sources_[e]||(t instanceof MediaStream?this.sources_[e]=this.context.createMediaStreamSource(t.clone()):this.sources_[e]=this.context.createMediaElementSource(t)),this.sources_[e]}static removeSource(t){const e=t instanceof MediaStream?t.id:t;return this.removeSourceKey(e)}static removeSourceKey(t){let e;return this.sources_[t]&&(e=this.sources_[t],this.analyser&&e.disconnect(this.analyser),e.disconnect(),delete this.sources_[t]),e}static frequency$(t,e){if(void 0===e&&(e=64),e%2==1)throw e;const r=new Uint8Array(e/2);if(this.context){const s=this.analyser;if(s){s.fftSize=e;this.addSource(t).connect(s)}const o=new n.BehaviorSubject(r);return Ai.frame$.pipe(i.withLatestFrom(o),i.map((t=>{let[e,n]=t;return s&&s.getByteFrequencyData(n),n})),i.tap((t=>o.next(t))),i.finalize((()=>{this.removeSource(t)})))}return n.of(r)}static volume$(t){const e={volume:0,clipped:!1};if(this.context){const r=this.addSource(t),s=Ai.audioMeterCreate();r.connect(s);const o=new n.BehaviorSubject(e);return Ai.frame$.pipe(i.withLatestFrom(o),i.map((t=>{let[e,n]=t;return n.clipped=s.checkClipping(),n.volume=s.volume,n})),i.tap((t=>o.next(t))),i.finalize((()=>{this.removeSource(t)})))}return n.of(e)}static audioMeterCreate(t,e,n){void 0===t&&(t=.98),void 0===e&&(e=.95),void 0===n&&(n=750);const i=this.context;if(i){const r=i.createScriptProcessor(512);return r.onaudioprocess=this.audioMeterProcess,r.checkClipping=this.audioMeterClip,r.dispose=this.audioMeterDispose,r.clipping=!1,r.lastClip=0,r.volume=0,r.clipLevel=t,r.averaging=e,r.clipLag=n,r.connect(i.destination),r}}static audioMeterProcess(t){const e=t.inputBuffer.getChannelData(0),n=e.length;let i,r=0;for(let t=0;t<n;t++)i=e[t],Math.abs(i)>=this.clipLevel&&(this.clipping=!0,this.lastClip=window.performance.now()),r+=i*i;const s=Math.sqrt(r/n);this.volume=Math.max(s,this.volume*this.averaging)}static audioMeterClip(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)}static audioMeterDispose(){this.disconnect(),this.onaudioprocess=null}static step$(t){return n.Observable.create((e=>{requestAnimationFrame((n=>{const i=t?(n-t.startTime)/1e3:0;e.next({startTime:n,deltaTime:i})}))})).pipe(i.map((t=>(t.deltaTime>1/30&&(t.deltaTime=1/30),t))))}static dispose(){Object.keys(this.sources_).forEach((t=>{this.removeSourceKey(t)}));const t=this.analyser;t&&t.disconnect(),this.sources_={}}}Ai.sources_={},Ai.frame$=n.of(void 0).pipe(i.expand((t=>Ai.step$(t))),i.filter((t=>void 0!==t)),i.map((t=>t.deltaTime)),i.share());class pi extends t.Component{get video(){return this.video_}set video(t){this.video_!==t&&(this.video_=t,this.change&&(this.change.next(),this.init(),this.initStream()))}get audio(){return this.audio_}set audio(t){this.audio_!==t&&(this.audio_=t,this.change&&(this.change.next(),this.init(),this.initStream()))}get hasPreview(){return this.platform!==Un&&this.platform!==Vn}onInit(){this.init()}init(){if(this.initialized_)return;this.initialized_=!0,this.platform=jn.platform;const{node:e}=t.getContext(this);this.onLoadedMetadata=this.onLoadedMetadata.bind(this);(this.preview=e.querySelector("video")).addEventListener("loadedmetadata",this.onLoadedMetadata);const n=e.querySelector(".audio");this.hasPreview&&(this.bars=new Array(32).fill(0).map((t=>{const e=document.createElement("div");return e.classList.add("bar"),n.appendChild(e),e})))}onDestroy(){this.preview.removeEventListener("loadedmetadata",this.onLoadedMetadata),this.hasPreview&&Ai.dispose()}initStream(){const e=this.preview;if(!this.preview)return;const{node:n}=t.getContext(this);if(this.video_||this.audio_){if(n.classList.add("ready"),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const t=_e(ee.state),n={video:!!this.video_&&{deviceId:this.video_,width:{ideal:t.resolution.width},height:{ideal:t.resolution.height},frameRate:{ideal:t.frameRate.min,max:t.frameRate.max}},audio:!!this.audio_&&{deviceId:this.audio_}};this.platform===Un&&(n.video.facingMode="user"),navigator.mediaDevices.getUserMedia(n).then((t=>{this.hasPreview?("srcObject"in e?e.srcObject=t:e.src=window.URL.createObjectURL(t),this.audio_&&this.analyzeData(t),this.loadingStream_=t):this.stream.next(t)})).catch((t=>{console.log("AgoraDevicePreviewComponent.initStream.error",t.name,t.message),this.stream.next(null)}))}}else n.classList.remove("ready"),this.hasPreview&&("srcObject"in e?e.srcObject=null:e.src=null,this.analyzeData(null)),this.stream.next(null)}onLoadedMetadata(e){const{node:n}=t.getContext(this);n.classList.add("loaded"),this.preview.play(),this.stream.next(this.loadingStream_)}analyzeData(t){this.frequencySubscription&&this.frequencySubscription.unsubscribe(),t&&(this.frequencySubscription=Ai.frequency$(t,64).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.bars.forEach(((e,n)=>{const i=Math.min(100,5+t[n])/100;e.style.left=3.125*n+"%",e.style.transform=`scale(1,${i})`,e.style.opacity=i}))})))}}pi.meta={selector:"[agora-device-preview]",outputs:["stream","change"],inputs:["video","audio"]};class fi extends t.Component{get hasPreview(){return this.platform!==Un&&this.platform!==Vn}onInit(){if(this.platform=jn.platform,this.isHttps="https:"===window.location.protocol,this.state={},this.devices={videos:[],audios:[]},this.stream=null,this.form=null,this.isHttps){const t=this.agora=ti.getSingleton();ee.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.state=t,this.pushChanges()})),t&&t.devices$().subscribe((t=>{this.devices=t,this.initForm(t),this.pushChanges()}),(t=>{console.log("AgoraDeviceComponent.devices$.error",t)}))}}openHttps(t){window.location.href=window.location.href.replace("http://","https://").replace(":5000",":6443")}initForm(t){const n=this.form=new e.FormGroup({video:new e.FormControl(null,t.videos.length?e.Validators.RequiredValidator():void 0),audio:new e.FormControl(null,t.audios.length?e.Validators.RequiredValidator():void 0)}),r=this.controls=n.controls,s=t.videos.map((t=>({id:t.deviceId,name:t.label})));s.length>0&&s.unshift({id:null,name:"bhere_select_video"}),r.video.options=s;const o=t.audios.map((t=>({id:t.deviceId,name:t.label})));o.length>0&&o.unshift({id:null,name:"bhere_select_audio"}),r.audio.options=o,n.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.pushChanges()}))}onStreamDidChange(t){this.stream=null,this.pushChanges()}onStream(t){this.stream=t,this.pushChanges()}isValid(){return this.form.valid&&(this.stream||!this.hasPreview)}onEnter(t){const e=this.form.value,n=this.devices;n.video=n.videos.find((t=>t.deviceId===e.video)),n.audio=n.audios.find((t=>t.deviceId===e.audio)),this.enter.next(n)}}fi.meta={selector:"[agora-device]",outputs:["enter"],template:'\n\t<div class="group--info" *if="!isHttps">\n\t\t<div class="group--info__content stagger--childs">\n\t\t\t<div class="title" [innerHTML]="\'bhere_invalid_protocol\' | label"></div>\n\t\t\t<div class="info" [innerHTML]="\'bhere_reload_in_https\' | label"></div>\n\t\t\t<button type="button" class="btn--connect" (click)="openHttps($event)">\n\t\t\t\t<span [innerHTML]="\'bhere_reload\' | label"></span>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t<div class="group--info" *if="form">\n\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onEnter($event)" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\x3c!-- PREVIEW --\x3e\n\t\t\t<div class="agora-device-preview" agora-device-preview [video]="controls.video.value" [audio]="controls.audio.value" (stream)="onStream($event)" (change)="onStreamDidChange($event)" *if="this.hasPreview">\n\t\t\t\t<video class="video" muted></video>\n\t\t\t\t<div class="audio"></div>\n\t\t\t</div>\n\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\x3c!-- VIDEO --\x3e\n\t\t\t\t<div control-custom-select [control]="controls.video" label="Video" *if="devices.videos.length"></div>\n\t\t\t\t\x3c!-- AUDIO --\x3e\n\t\t\t\t<div control-custom-select [control]="controls.audio" label="Audio" *if="devices.audios.length"></div>\n\t\t\t\t<div class="info" *if="!isValid()" [innerHTML]="\'bhere_select_video_audio\' | label"></div>\n\t\t\t\t<div class="info" *if="isValid()" [innerHTML]="\'bhere_video_audio_connected\' | label"></div>\n\t\t\t\t<button type="submit" class="btn--connect" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#call"></use></svg>\n\t\t\t\t\t<span *if="!state.connecting" [innerHTML]="\'bhere_enter\' | label"></span>\n\t\t\t\t\t<span *if="state.connecting" [innerHTML]="\'bhere_connecting\' | label"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n\t'};const mi={WaitingRoom:{id:1,name:"waiting-room"},Panorama:{id:2,name:"panorama"},PanoramaGrid:{id:3,name:"panorama-grid"},Room3d:{id:4,name:"room-3d"},Model:{id:5,name:"model"},Media:{id:6,name:"media"}},gi={Nav:{id:1,name:"nav"},Plane:{id:2,name:"plane"},CurvedPlane:{id:3,name:"curved-plane"},Model:{id:4,name:"model"},Texture:{id:5,name:"texture"}};class vi{constructor(t){t&&(Object.assign(this,t),this.updateIndices(t.items)),this.items=(this.items||[]).filter((t=>function(t){let e;if(t.type.name===gi.Nav.name)e=null==t.viewId||function(t){return!Oi(t.title)&&!Oi(t.abstract)}(t)||ee.state.navigable;else e=!0;return e}(t))).map((t=>Ii(t))),this.tiles&&(this.tiles=this.tiles.map((t=>xi(t)))),this.originalItems=this.items.slice(),this.lastOrientation={latitude:0,longitude:0},this.path=!0}get payload(){const t={};return Object.keys(this).forEach((e=>{if(-1!==vi.allowedProps.indexOf(e))switch(e){case"items":t[e]=this[e].map((t=>Ii(t).payload));break;case"tiles":t[e]=this[e].map((t=>xi(t).payload));break;default:t[e]=this[e]}})),t}get pathItems(){return this.items.filter((t=>t.path))}get shortType(){return this.type?this.type.split("-").map((t=>t.substring(0,1).toUpperCase())).join(""):"??"}updateIndices(t){if(t){let e=0,n=0,i=0,r=0,s=0;t.forEach(((t,o)=>{if(t.index=o,t.asset)switch(t.asset.file){case"publisherStream":t.asset.index=e++;break;case"nextAttendeeStream":t.asset.index=n++;break;case"smartDeviceStream":t.asset.index=i++;break;case"publisherScreen":t.asset.index=r++;break;case"attendeeScreen":t.asset.index=s++}}))}}}vi.allowedProps=["id","type","name","hidden","likes","asset","items","orientation","zoom","ar","tiles","invertAxes","flipAxes"];class yi extends vi{constructor(t){super(t)}}class _i extends vi{static mapTiles(t,e,n,i){void 0===t&&(t=[]),void 0===e&&(e=!1),void 0===n&&(n=!1),void 0===i&&(i="");const r=e?-1:1;return t.map(((t,e)=>{const s=new THREE.Vector2;return(t="string"==typeof t?{id:e+1,asset:{folder:i,file:t},navs:[]}:t).asset.file.replace(/_x([-|\d]+)_y([-|\d]+)/g,((t,e,i)=>{n?(s.y=parseInt(e),s.x=parseInt(i)*r):(s.x=parseInt(e),s.y=parseInt(i)*r)})),{id:t.id,type:Object.assign({},mi.PanoramaGrid),asset:t.asset,navs:t.navs||[],indices:s}}))}set index(t){this.index_!==t&&(this.index_=t,this.tiles.forEach(((e,n)=>e.selected=n===t)),this.updateCurrentItems(),this.index$.next(t))}get index(){return this.index_}constructor(t){t.tiles=_i.mapTiles(t.tiles,t.flipAxes,t.invertAxes,t.asset?t.asset.folder:""),super(t),this.index_=0,this.index$=new n.Subject,this.tiles.forEach(((t,e)=>t.selected=0===e)),this.tiles.length&&(this.items=this.originalItems.concat(this.tiles[0].navs),this.asset=this.tiles[0].asset)}updateCurrentItems(){this.items=this.originalItems.concat(this.tiles[this.index_].navs)}getTileIndex(t,e){return this.tiles.reduce(((n,i,r)=>i.indices.x===t&&i.indices.y===e?r:n),-1)}hasTile(t,e){return-1!==this.getTileIndex(t,e)}getTile(t,e){const n=this.getTileIndex(t,e);if(-1!==n)return this.index=n,this.tiles[n]}}class bi extends vi{constructor(t){super(t)}}class Ei extends vi{constructor(t){super(t)}}class wi extends vi{constructor(t){super(t)}}class Si{constructor(t){t&&Object.assign(this,t),this.path=!0;const e=this.links||(this.link?[this.link]:[]);this.links=e}get firstLink(){return this.links&&this.links.length?this.links[0]:null}get payload(){const t={};return Object.keys(this).forEach((e=>{-1!==Si.allowedProps.indexOf(e)&&(t[e]=this[e])})),!t.link||t.link.title&&t.link.href||delete t.link,t}get hasPanel(){return this.type.name===gi.Nav.name&&(this.title&&""!==this.title||this.abstract&&""!==this.abstract||this.asset||this.link)}}Si.allowedProps=["id","type","title","abstract","asset","link","links","viewId","hook","hookExtra","keepOrientation","important","transparent","position","rotation","scale","radius","height","arc"];class Ti extends Si{}class Ci{constructor(t){t&&Object.assign(this,t),this.navs=(this.navs||[]).map((t=>Ii(t))),this.originalItems=this.navs.slice()}get payload(){const t={};return Object.keys(this).forEach((e=>{if(-1!==Ci.allowedProps.indexOf(e))if("navs"===e)t[e]=this[e].map((t=>Ii(t).payload));else t[e]=this[e]})),t}}function Ri(t){switch(t.type.name){case mi.Panorama.name:t=new yi(t);break;case mi.PanoramaGrid.name:t=new _i(t);break;case mi.Room3d.name:t=new bi(t);break;case mi.Model.name:t=new Ei(t);break;case mi.Media.name:t=new wi(t);break;default:t=new vi(t)}return t}function Ii(t){if(t.type.name===gi.Nav.name)t=new Ti(t);else t=new Si(t);return t}function xi(t){return new Ci(t)}function Oi(t){return t&&t.length>0}Ci.allowedProps=["id","asset","navs"];class Li{constructor(t){t&&Object.assign(this,t),this.items=this.items||[],this.originalItems=this.items.slice()}get payload(){const t={};return Object.keys(this).forEach((e=>{-1!==vi.allowedProps.indexOf(e)&&(t[e]=this[e])})),t}}function Mi(t){return t=new Li(t)}Li.allowedProps=["id","name","items"];const ki={id:null,name:"Principale",items:[]};class Ni{static set paths(t){this.paths$.next(t)}static get paths(){return this.paths$.getValue()}static set path(t){this.path$.next(t)}static get path(){return this.path$.getValue()}static getCurrentPath$(t){return void 0===t&&(t=null),this.pathGet$().pipe(i.switchMap((e=>{this.paths=e;let n=ki;if(t){const i=e.find((e=>e.id===t));i&&(n=i)}return this.path=n,this.path$})))}static pathGet$(){return D.flags.usePaths?Sn.get$("/api/path").pipe(i.map((t=>(t.paths=t.paths.map((t=>Mi(t))),t.paths.unshift(ki),t.paths)))):n.of([])}static addPath(t){const e=this.paths.slice();e.push(t),this.paths=e,this.path=t}static editPath(t){const e=this.paths.slice(),n=e.reduce(((e,n,i)=>n.id===t.id?i:e),-1);if(n>0){let i=this.path;i.id===t.id&&(i=t),e.splice(n,1,t),this.paths=e,this.path=i}}static deletePath(t){const e=this.paths.slice(),n=e.indexOf(t);if(n>0){e.splice(n,1),this.paths=e;let i=this.path;i.id===t.id&&(i=e[0]),this.path=i}}static pathCreate$(t){return Sn.post$("/api/path",t).pipe(i.map((t=>Mi(t))))}static pathUpdate$(t){return Sn.put$(`/api/path/${t.id}`,t).pipe(i.map((t=>Mi(t))))}static pathDelete$(t){return Sn.delete$(`/api/path/${t.id}`)}}Ni.paths$=new n.BehaviorSubject([ki]),Ni.path$=new n.BehaviorSubject(ki);class Pi extends t.Component{get selfServiceTourRoute(){const t=this.form.get("path").value,e=[ve.transform(":lang.selfServiceTour")];return t&&e.push(oe.validateParams({pathId:t})),e}onInit(){this.state={},this.paths=[],this.pathId=null,this.form=null,ee.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.state=t,this.pushChanges()})),D.flags.usePaths?Ni.getCurrentPath$().pipe(i.first(),i.tap(),i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.paths=Ni.paths,this.pathId=t.id||"",this.onLoad()})):this.onLoad()}onLoad(){const t=this.form=new e.FormGroup({path:this.pathId,id:new e.FormControl(null,[e.Validators.PatternValidator(re),e.Validators.RequiredValidator()]),idAttendee:null,idStreamer:null,idViewer:null,idSmartDevice:null}),n=this.controls=t.controls,r=this.paths.map((t=>({id:t.id||"",name:t.name})));r.length>0&&r.unshift({id:null,name:"bhere_select_path"}),n.path.options=r,t.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.pathId!==t.path&&null!==t.id&&(this.pathId=t.path,this.onGenerateMeetingId()),this.pushChanges()}))}onGenerateMeetingId(t){let e=this.pathId?String(this.pathId):null;e=e&&e.length?e:null;const n=new se({pathId:e}).toRoles();this.form.patch(n)}onInputDidChange(t){"publisher"===this.state.role&&setTimeout((()=>{if(this.form.get("id").valid){const t=this.form.get("id").value,e=new se(t).toRoles();this.form.patch(e)}else this.form.get("idAttendee").reset(),this.form.get("idStreamer").reset(),this.form.get("idViewer").reset(),this.form.get("idSmartDevice").reset()}),1)}onCopyToClipBoard(t,e){void 0===e&&(e=!1);new oe({link:t}).copyToClipBoard(e)}onNext(t){let e=this.controls.id.value;oe.replaceWithLink(e),this.link.next(e)}isValid(){return this.form.valid}}Pi.meta={selector:"[agora-link]",outputs:["link"],template:'\n\t<div class="group--info" *if="form">\n\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onNext($event)" name="form" role="form" novalidate autocomplete="off">\n\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t<div class="stagger--childs" *if="state.role !== \'publisher\'">\n\t\t\t\t\t<div class="group--form group--form--addon" [class]="{ required: controls.id.validators.length, \'addon\': controls.id.valid }">\n\t\t\t\t\t\t<label [innerHTML]="\'bhere_insert_meeting_id\' | label"></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.id" [placeholder]="\'bhere_meeting_id\' | label" />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.id.value)" *if="controls.id.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="stagger--childs" *if="state.role === \'publisher\'">\n\t\t\t\t\t\x3c!-- PATH --\x3e\n\t\t\t\t\t<div control-custom-select [control]="controls.path" [label]="\'bhere_path\' | label" *if="(\'usePaths\' | flag) && paths.length"></div>\n\t\t\t\t\t\x3c!--IDS --\x3e\n\t\t\t\t\t<div class="group--form group--form--addon" [class]="{ required: controls.id.validators.length, \'addon\': controls.id.valid }">\n\t\t\t\t\t\t<label><svg class="lock" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#lock"></use></svg> <span [innerHTML]="\'bhere_insert_meeting_id\' | label"></span></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.id" [placeholder]="\'bhere_meeting_id\' | label" (change)="onInputDidChange($event)" />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.id.value)" *if="controls.id.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--form group--form--addon addon" *if="(\'attendee\' | flag) && controls.idAttendee.valid && controls.idAttendee.value !== null">\n\t\t\t\t\t\t<label><svg class="lock" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#lock"></use></svg> <span [innerHTML]="\'bhere_attendee_meeting_id\' | label"></span></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.idAttendee" [placeholder]="\'bhere_attendee_meeting_id\' | label" readonly />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.idAttendee.value)" *if="controls.idAttendee.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--form group--form--addon addon" *if="(\'streamer\' | flag) && controls.idStreamer.valid && controls.idStreamer.value !== null">\n\t\t\t\t\t\t<label [innerHTML]="\'bhere_streamer_meeting_id\' | label"></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.idStreamer" [placeholder]="\'bhere_streamer_meeting_id\' | label" readonly />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.idStreamer.value)" *if="controls.idStreamer.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--form group--form--addon addon" *if="(\'viewer\' | flag) && controls.idViewer.valid && controls.idViewer.value !== null">\n\t\t\t\t\t\t<label [innerHTML]="\'bhere_viewer_meeting_id\' | label"></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.idViewer" [placeholder]="\'bhere_viewer_meeting_id\' | label" readonly />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.idViewer.value)" *if="controls.idViewer.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--form group--form--addon addon" *if="(\'smartDevice\' | flag) && controls.idSmartDevice.valid && controls.idSmartDevice.value !== null">\n\t\t\t\t\t\t<label [innerHTML]="\'bhere_smart_device_meeting_id\' | label"></label>\n\t\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.idSmartDevice" [placeholder]="\'bhere_smart_device_meeting_id\' | label" readonly />\n\t\t\t\t\t\t<div class="control--addon" (click)="onCopyToClipBoard(controls.idSmartDevice.value, true)" *if="controls.idSmartDevice.valid">\n\t\t\t\t\t\t\t<svg class="copy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#copy"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="info" *if="controls.id.errors.required" [innerHTML]="\'bhere_insert_meeting_id\' | label"></div>\n\t\t\t\t<div class="info" *if="controls.id.errors.pattern" [innerHTML]="\'bhere_invalid_meeting_id\' | label"></div>\n\t\t\t\t<div class="info" *if="isValid()" [innerHTML]="\'bhere_take_part_meeting\' | label"></div>\n\t\t\t\t<button type="button" class="btn--generate" *if="state.role == \'publisher\'" (click)="onGenerateMeetingId($event)">\n\t\t\t\t\t<span [innerHTML]="\'bhere_generate_meeting_id\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t<span [innerHTML]="\'bhere_take_part\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<a [routerLink]="selfServiceTourRoute" class="btn--secondary" *if="state.role === \'publisher\'">\n\t\t\t\t\t<span [innerHTML]="\'bhere_self_service\' | label"></span>\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n\t'};class Di extends t.Component{onInit(){const t=this.form=new e.FormGroup({username:new e.FormControl(null,e.Validators.RequiredValidator()),password:new e.FormControl(null,e.Validators.RequiredValidator()),checkRequest:window.antiforgery||"",checkField:""});this.controls=t.controls,t.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.pushChanges()})),this.error=null}test(){this.form.patch({username:"publisher",password:"publisher",checkRequest:window.antiforgery||"",checkField:""})}reset(){this.form.reset()}onSubmit(){if(this.form.valid){const t=this.form.value;this.form.submitted=!0,this.error=null,this.pushChanges(),Tn.login$(t).pipe(i.first()).subscribe((t=>{ee.state.role===t.type?(this.onNext(t),this.form.reset()):(this.error={friendlyMessage:fe.transform("error_credentials")},this.pushChanges())}),(t=>{console.log("AccessComponent.error",t),this.error=t,this.pushChanges()}))}else this.form.touched=!0}isValid(){return this.form.valid}onNext(t){oe.replaceWithUser(t),this.login.next(t)}}Di.meta={selector:"[agora-login]",outputs:["login"],template:'\n\t<div class="group--info">\n\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t<div class="title" [innerHTML]="\'bhere_login\' | label"></div>\n\t\t\t\t<input name="checkField" [formControl]="controls.checkField" value="" type="text" style="display:none !important;" />\n\t\t\t\t<div control-text [control]="controls.username" [label]="\'bhere_username\' | label"></div>\n\t\t\t\t<div control-password [control]="controls.password" [label]="\'bhere_password\' | label"></div>\n\t\t\t\t<div class="group--error" *if="error">\n\t\t\t\t\t<span class="status-code" [innerHTML]="error.statusCode"></span>\n\t\t\t\t\t<span class="status-message" [innerHTML]="error.statusMessage"></span>\n\t\t\t\t\t<span class="friendly-message" [innerHTML]="error.friendlyMessage"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="info" *if="isValid()" [innerHTML]="\'bhere_cta\' | label"></div>\n\t\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t<span [innerHTML]="\'bhere_cta\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<test-component [form]="form" (test)="test($event)" (reset)="reset($event)"></test-component>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n\t'};class Bi extends t.Component{onInit(){const t=new oe;this.state={};const e=this.fields=[];if(D.flags.useExtendedUserInfo){const n=t.firstName,i=t.lastName,r=t.email;e.push({type:"text",name:"firstName",label:"access_first_name",required:!0,value:n,test:"Jhon"},{type:"text",name:"lastName",label:"access_last_name",required:!0,value:i,test:"Appleseed"},{type:"email",name:"email",label:"access_email",required:!0,value:r,test:"jhonappleseed@gmail.com"})}else{const n=t.name;e.push({type:"text",name:"name",label:"bhere_name_and_surname",pattern:/^\w{2,}\s\w{2,}/,required:!0,value:n,test:"Jhon Appleseed"})}e.push({type:"checkbox",name:"privacy",label:"access_privacy_disclaimer",required:!0,test:!0},{type:"hidden",name:"checkField",value:"",test:""},{type:"none",name:"checkRequest",value:D.antiforgery||"",test:D.antiforgery||""});const n=this.form=Ae(e);this.controls=n.controls,n.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.pushChanges()})),ee.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.state=t,this.pushChanges()}))}test(){pe(this.fields,this.form)}isValid(){return this.form.valid}onNext(t){let e,n;D.flags.useExtendedUserInfo?(n={firstName:this.controls.firstName.value,lastName:this.controls.lastName.value,email:this.controls.email.value},e=`${n.firstName} ${n.lastName}`):(n={name:this.controls.name.value},e=n.name),oe.replaceWithOptions(n),this.name.next(e)}}Bi.meta={selector:"[agora-name]",outputs:["name"],template:'\n\t<div class="group--info" *if="form">\n\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onNext($event)" name="form" role="form" novalidate autocomplete="off">\n\t\t\t<div class="group--info__content stagger--childs">\n\t\t\t\t\x3c!-- controls --\x3e\n\t\t\t\t<div controls [formGroup]="form" [fields]="fields"></div>\n\t\t\t\t\x3c!-- NAME --\x3e\n\t\t\t\t\x3c!--\n\t\t\t\t<div class="group--form group--form--addon" [class]="{ required: controls.name.validators.length }">\n\t\t\t\t\t<label [innerHTML]="\'bhere_fill_fullname\' | label"></label>\n\t\t\t\t\t<input type="text" class="control--text" [formControl]="controls.name" [placeholder]="\'bhere_name_and_surname\' | label" />\n\t\t\t\t</div>\n\t\t\t\t<div class="info" *if="!controls.name.valid" [innerHTML]="\'bhere_fill_name_and_surname\' | label"></div>\n\t\t\t\t--\x3e\n\t\t\t\t<div class="info" *if="!isValid()"><span [innerHTML]="\'bhere_fill_name_and_surname\' | label"></span></div>\n\t\t\t\t<div class="info" *if="isValid()"><span [innerHTML]="\'bhere_proceed_as\' | label"></span> <span [innerHTML]="controls.name.value"></span></div>\n\t\t\t\t<button type="submit" class="btn--next" [class]="{ disabled: !isValid() }">\n\t\t\t\t\t<span [innerHTML]="\'bhere_proceed\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<test-component [form]="form" (test)="test($event)" (reset)="reset($event)"></test-component>\n\t\t\t</div>\n\t\t</form>\n\t</div>\n\t'};class Ui extends t.Component{set videoMuted(e){if(this.videoMuted_!==e){this.videoMuted_=e;const{node:n}=t.getContext(this);e?n.classList.add("video--muted"):n.classList.remove("video--muted")}}set audioMuted(e){if(this.audioMuted_!==e){this.audioMuted_=e;const{node:n}=t.getContext(this);e?n.classList.add("audio--muted"):n.classList.remove("audio--muted")}}get streamId(){return this.streamId_}set streamId(t){this.streamId_=t}get stream(){return this.stream_}set stream(e){try{if(this.stream_!==e){console.log("AgoraStreamComponent set stream",e);const{node:n}=t.getContext(this),i=this.player=n.querySelector(".agora-stream__player");this.stream_=e,e&&(this.videoMuted=e.userMuteVideo,this.audioMuted=e.userMuteAudio);const r=e?e.streamId:null;if(this.streamId=r,r){const t=`stream-${r}`;i.setAttribute("id",t);const n=this;if(e.isPlaying())e.resume(i);else{this.shouldUseResumeGesture=!1;try{e.play(i)}catch(t){qn.error("Stream.videoTrack.play.error",t),t&&"aborted"!==t.status&&(n.shouldUseResumeGesture=!0,n.pushChanges())}}}else i.removeAttribute("id")}}catch(t){qn.error("AgoraStreamComponent.stream.set.error",t)}}set vrContainer(t){this.vrContainer_!==t&&(this.vrContainer_=t,t?(this.stream_.vrContainer=t,this.player.appendChild(t)):this.stream_.vrContainer&&this.stream_.vrContainer.parentNode&&(this.stream_.vrContainer.parentNode.removeChild(this.stream_.vrContainer),this.stream_.vrContainer=null))}get videoNode(){let e=this.videoNode_;if(!e){const n=t.getContext(this).node.querySelector(".agora-stream__player");e=document.createElement("video"),this.onLoadedMetadata=this.onLoadedMetadata.bind(this),e.addEventListener("loadedmetadata",this.onLoadedMetadata),n.appendChild(e),this.videoNode_=e}return e}onInit(){this.videoMuted=!1,this.audioMuted=!1,this.shouldUseResumeGesture=!1,this.state={},ee.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.state=t,this.pushChanges()})),Mn.out$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{switch(t.type){case Le:{const e=t.event;this.streamId&&e.streamId===this.streamId&&(e instanceof yn&&(this.videoMuted=!0),e instanceof _n&&(this.videoMuted=!1),e instanceof bn&&(this.audioMuted=!0),e instanceof En&&(this.audioMuted=!1));break}case an:this.streamId===t.clientId&&(this.vrContainer=t.container);break;case on:this.streamId===t.clientId&&(this.vrContainer=null)}}))}setMediaStream(t){const e=this.videoNode;"srcObject"in e?e.srcObject=t:e.src=t?window.URL.createObjectURL(t):null}onLoadedMetadata(t){this.videoNode.play().then((t=>{}),(t=>{console.log("AgoraStreamComponent.play.error",t)}))}onToggleControl(t){this.toggleControl.next(t)}onToggleSpy(t){this.toggleSpy.next(t)}}Ui.meta={selector:"[agora-stream]",outputs:["toggleControl","toggleSpy"],inputs:["stream"]};class Fi{constructor(t){t&&Object.assign(this,t),this.items=(this.items||[]).map((t=>Ii(t))),this.originalItems=this.items.slice()}get payload(){const t={};return Object.keys(this).forEach((e=>{if(-1!==vi.allowedProps.indexOf(e))if("items"===e)t[e]=this[e].map((t=>Ii(t).payload));else t[e]=this[e]})),t}}function Hi(t){return t=new Fi(t)}Fi.allowedProps=["id","name","asset","items"];class Vi{static set active(t){this.active$.next(t)}static get active(){return this.active$.getValue()}static navmapGet$(){return Sn.get$("/api/navmap").pipe(i.map((t=>(t.navmaps.map((t=>Hi(t))),t.navmaps))))}static navmapCreate$(t){return Sn.post$("/api/navmap",t).pipe(i.map((t=>Hi(t))))}static navmapUpdate$(t){return Sn.put$(`/api/navmap/${t.id}`,t).pipe(i.map((t=>Hi(t))))}static navmapDelete$(t){return Sn.delete$(`/api/navmap/${t.id}`)}static itemCreate$(t,e){return Sn.post$(`/api/navmap/${t.id}/item`,e).pipe(i.map((t=>Ii(t))))}static itemUpdate$(t,e){return e=Ii(e),Sn.put$(`/api/navmap/${t.id}/item/${e.id}`,e.payload).pipe(i.map((t=>Ii(t))))}static itemDelete$(t,e){return Sn.delete$(`/api/navmap/${t.id}/item/${e.id}`)}}Vi.active$=new n.BehaviorSubject(!1);class ji{static push(t){return function(t){(window.dataLayer||[]).push(t),console.log("GtmService.dataLayer",t)}(t)}}const Gi="info",Qi="alert",zi="dialog",Wi="centered",Ki="bottom-right";class qi{constructor(t){this.toast=t}}class Yi extends qi{}class $i extends qi{}class Xi{static open$(t){switch(t.id=(new Date).getTime(),t.type=t.type||Gi,t.position=t.position||Wi,t.type){case Qi:t.acceptMessage=t.acceptMessage||"Ok";break;case zi:t.acceptMessage=t.acceptMessage||"Accept",t.rejectMessage=t.rejectMessage||"Reject"}return this.toast$.next(t),t.type===Gi&&setTimeout((()=>{this.resolve(t)}),t.duration||4e3),this.events$}static resolve(t){this.toast$.next(null),this.events$.next(new Yi(t))}static reject(t){this.toast$.next(null),this.events$.next(new $i(t))}}Xi.toast$=new n.Subject,Xi.events$=new n.Subject;class Ji extends t.Component{get modal(){return this.modal_}set modal(e){const{module:n}=t.getContext(this);this.modal_&&this.modal_.node&&(n.remove(this.modal_.node,this),this.modalNode.removeChild(this.modal_.node)),e&&e.node&&(this.modal_=e,this.modalNode.appendChild(e.node),n.compile(e.node)),this.modal_=e,this.pushChanges()}get busy(){return this.busy_}set busy(t){this.busy_!==t&&(this.busy_=t,this.pushChanges())}onInit(){this.busy_=!1;const{node:e}=t.getContext(this);this.modalNode=e.querySelector(".modal-outlet__modal"),ai.modal$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.modal=t)),ai.busy$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.busy=t))}reject(t){ai.reject()}}Ji.meta={selector:"[modal-outlet]",template:'\n\t<div class="modal-outlet__container" [class]="{ active: modal, busy: busy }">\n\t\t<div class="modal-outlet__background" (click)="reject($event)"></div>\n\t\t<div class="modal-outlet__modal"></div>\n\t\t\x3c!-- spinner --\x3e\n\t\t<div class="spinner spinner--contrasted" *if="busy"></div>\n\t</div>\n\t'};class Zi extends t.Component{onInit(){super.onInit();const{parentInstance:e,node:n}=t.getContext(this);if(e instanceof Ji){const t=this.data=e.modal.data;if(t&&t.ar){const e=Zi.getUrl(t);new QRious({element:n.querySelector(".qrcode"),value:e,size:256})}}}onClose(){ai.reject()}static getUrl(t){const e=te.buildUrl(ve.transform(":lang.tryInAr"),{viewId:t.id}),n=window.location.origin+e;return console.log("TryInARModalComponent.getUrl",n),n}static openInAR(t){const e=this.getUrl(t);window.open(e,"_blank")}}Zi.meta={selector:"[try-in-ar-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title" [innerHTML]="\'bhere_ar\' | label"></div>\n\t\t\t\t<div class="picture">\n\t\t\t\t\t<canvas class="qrcode"></canvas>\n\t\t\t\t</div>\n\t\t\t\t<div class="group--cta">\n\t\t\t\t\t<button type="button" class="btn--accept" (click)="onClose()">\n\t\t\t\t\t\t<span [innerHTML]="\'close\' | label"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},Zi.chunk=()=>'<div class="try-in-ar-modal" try-in-ar-modal></div>';const tr=["jpeg","jpg","png","hdr"],er=["mp4","webm"],nr=["fbx","gltf","glb","usdz"],ir={Image:{id:1,name:"image"},Video:{id:2,name:"video"},Model:{id:3,name:"model"},PublisherStream:{id:4,name:"publisher-stream",file:"publisherStream"},AttendeeStream:{id:5,name:"next-attendee-stream",file:"nextAttendeeStream"},PublisherScreen:{id:6,name:"publisher-screen",file:"publisherScreen"},AttendeeScreen:{id:7,name:"attendee-screen",file:"attendeeScreen"},SmartDeviceStream:{id:8,name:"smart-device-stream",file:"smartDeviceStream"}},rr={ImageOrVideo:{id:1,name:"Image or Video",ids:[1,2]},Publisher:{id:3,name:"Publisher",ids:[4]},Attendee:{id:4,name:"Attendee",ids:[5]}};const sr=[ir.PublisherStream.name,ir.AttendeeStream.name,ir.PublisherScreen.name,ir.AttendeeScreen.name,ir.SmartDeviceStream.name];function or(t){return t&&-1!==sr.indexOf(t.type.name)}function ar(t){let e;return t&&t.asset&&(e=Object.keys(rr).find((e=>-1!==rr[e].ids.indexOf(t.asset.type.id)))),rr[e||"ImageOrVideo"]}function cr(t){const e=(n=t,Object.keys(rr).reduce(((t,e)=>{const i=rr[e];return i.id===n?i:t}),null));var n;const i=function(t){return Object.keys(ir).reduce(((e,n)=>{const i=ir[n];return i.id===t?i:e}),null)}(e.ids[0]),r=i.file;return new ur({type:i,folder:"",file:r})}function lr(t){const e=t.split(".").pop().toLowerCase();return-1!==tr.indexOf(e)?ir.Image:-1!==er.indexOf(e)?ir.Video:-1!==nr.indexOf(e)?ir.Model:void 0}class ur{constructor(t){t&&Object.assign(this,t)}get payload(){const t={};return Object.keys(this).forEach((e=>{-1!==ur.allowedProps.indexOf(e)&&(t[e]=this[e])})),t}static fromUrl(t){const e=t.split("/"),n=e.pop(),i=e.join("/")+"/",r=lr(n);return new ur({type:r,folder:i,file:n})}static get defaultMediaAsset(){return{id:-1,type:{id:ir.Image,name:"image"},folder:"/textures/grid/",file:"grid.jpg"}}}function dr(t){return t.type.name,t=new ur(t)}ur.allowedProps=["id","type","folder","file","linkedPlayId","chromaKeyColor","autoplay","loop"];const hr={id:"waiting-room",type:{id:1,name:"waiting-room"},name:"Waiting Room",likes:0,liked:!1,asset:{type:{id:1,name:"image"},folder:"/textures/waiting-room/",file:"waiting-room.jpg"},items:[],orientation:{latitude:0,longitude:0}};class Ar{static get dataViews(){return this.data?this.data.views:[]}static get validViews(){return this.data?this.data.views.filter((t=>t.type.name!==mi.WaitingRoom.name)):[]}static get pathViews(){return this.validViews.filter((t=>t.path))}static get validPathViews(){return(this.editor?this.data.views:this.validViews).filter((t=>t.path))}static set action(t){this.action$_.next(t)}static get action(){return this.action$_.getValue()}static set viewId(t){this.action$_.next({viewId:t,keepOrientation:!1,useLastOrientation:!1})}static get viewId(){const t=this.action$_.getValue();return t?t.viewId:null}static getDataView(t){return this.dataViews.find((e=>e.id===t))||null}static get currentView(){const t=this.viewId;return null!==t?this.getDataView(t):null}static getValidPathId(t){if(!t)return null;return null==this.validPathViews.find((e=>e.id===t))?null:t}static getFirstPathId(){const t=this.editor&&null===this.path.id?this.dataViews:this.pathViews;return t.length?t[0].id:null}static data$(){if(!this.data$_){const t=(D.flags.production?"/api/view":`${D.assets}api/data.json`)+"?lang="+ge.lang;this.data$_=Sn.get$(t).pipe(i.map((t=>(t.views=t.views.map((t=>Ri(t))),this.data=t,t))),i.shareReplay(1))}return this.data$_}static view$(){const t=new oe,e=this.getValidPathId(t.viewId),n=this.getValidPathId(t.embedViewId)||e||this.getFirstPathId();return this.action$_.next({viewId:n}),this.action$_.pipe(i.distinctUntilChanged(((t,e)=>t.viewId===e.viewId)),i.map((t=>{let e=this.dataViews.find((e=>e.id===t.viewId));return e&&(e.keepOrientation=t.keepOrientation||!1,e.useLastOrientation=t.useLastOrientation||!1),e||this.getWaitingRoom()})))}static setDataAndPath(t,e){this.data=t,t.views.forEach((t=>{t.path=!e||-1===e.items.indexOf(t.id),t.items.forEach((t=>{let n=!0;e&&(t.type.name===gi.Nav.name&&(n=-1===e.items.indexOf(t.viewId)),t.path=n)}))})),this.path=e}static hostedView$(t,e){this.setDataAndPath(t,e),this.editor=!1;const r=this.getWaitingRoom();return n.combineLatest([this.view$(),this.hosted$()]).pipe(i.map((t=>{const e=t[0];return t[1]?e:r})),i.distinctUntilChanged(((t,e)=>t.id===e.id)),i.tap((t=>{if(t.id!==r.id){oe.replaceWithOptions({viewId:t.id});const e=Ar.getPrefetchAssets(t);t.prefetchAssets=e}})))}static editorView$(t,e){this.setDataAndPath(t,e),this.editor=!0;const n=this.getWaitingRoom();return this.view$().pipe(i.map((t=>{const i={pathId:null};return t.id!==n.id&&(i.viewId=t.id),e&&null!==e.id&&(i.pathId=e.id),oe.replaceWithOptions(i),t})))}static hosted$(){return ee.state$.pipe(i.map((t=>t.hosted)),i.distinctUntilChanged())}static viewById$(t){return this.data$().pipe(i.map((e=>this.dataViews.find((e=>e.id===t)))))}static viewLike$(t){return t.liked?n.of(null):(t.liked=!0,D.flags.production?Sn.get$(`/api/view/${t.id}/like`):(t.likes=t.likes||0,t.likes++,n.of(t)))}static setViewLike$(t){return this.viewById$(t.viewId).pipe(i.tap((e=>{e&&(e.likes=t.likes)})))}static getWaitingRoom(){return this.dataViews.find((t=>t.type.name===mi.WaitingRoom.name))||hr}static getPrefetchAssets(t){const e=this.validPathViews;return t.items.filter((t=>t.type.name===gi.Nav.name&&null!=t.viewId)).map((t=>e.find((e=>e.id===t.viewId)))).filter((t=>t&&t.asset&&t.asset.type.name===ir.Image.name)).map((t=>D.getPath(t.asset.folder+t.asset.file)))}static addView(t){const e=this.data,n=e.views.slice();n.push(t),e.views=n,this.viewId=t.id}static deleteView(t){const e=this.data,n=e.views.slice(),i=n.reduce(((e,n,i)=>n.id===t.id?i:e),-1);if(i>0){n.splice(i,1),e.views=n;const t=this.dataViews;t.length>0&&(this.viewId=t[0].id)}}}Ar.action$_=new n.BehaviorSubject(null);let pr=null;class fr{static get items$(){if(!pr){const t=ci.get("wishlist")||[];pr=new n.BehaviorSubject(t)}return pr}static getItems(){return this.items$.getValue()}static indexOf(t){return this.getItems().reduce(((e,n,i)=>-1===e&&n.viewId===t.viewId&&n.itemId===t.itemId?i:e),-1)}static has(t){return-1!==this.indexOf(t)}static add$(t){const e=this.getItems();return this.has(t)||(e.push(t),ci.set("wishlist",e),this.items$.next(e)),this.items$}static remove$(t){const e=this.getItems(),n=this.indexOf(t);return-1!==n&&(e.splice(n,1),ci.set("wishlist",e),this.items$.next(e)),this.items$}static toggle$(t){const e=this.getItems(),n=this.indexOf(t);return-1!==n?(e.splice(n,1),ci.set("wishlist",e),this.items$.next(e)):(e.push(t),ci.set("wishlist",e),this.items$.next(e)),this.items$}}class mr{constructor(t){this.loader=t}}class gr extends mr{}class vr extends mr{}class yr extends mr{}class _r extends mr{}class br extends mr{}class Er{static getLoader(){return Er.loader||(Er.loader=new THREE.TextureLoader)}static getPath(t){return D.getPath(t.asset.folder+t.asset.file)}static loadTexture(t,e){const n=Er.getPath(t);return Er.getLoader().load(n,e)}static isVideo(t){return t.asset&&t.asset.file&&(-1!==t.asset.file.indexOf(".mp4")||-1!==t.asset.file.indexOf(".webm"))}static isStream(t){return or(t.asset)}static isMutedStream(t){let e=!1;switch(t.asset.type.name){case ir.PublisherStream.name:e=ee.state.role===ne.Publisher;break;case ir.AttendeeStream.name:e=ee.state.role===ne.Attendee;break;case ir.PublisherScreen.name:case ir.AttendeeScreen.name:e=!0;break;case ir.SmartDeviceStream.name:e=ee.state.role===ne.SmartDevice}return e}static isPublisherStream(t){return t.asset&&t.asset.type.name===ir.PublisherStream.name}static isAttendeeStream(t){return t.asset&&t.asset.type.name===ir.AttendeeStream.name}static isSmartDeviceStream(t){return t.asset&&t.asset.type.name===ir.SmartDeviceStream.name}static isPublisherScreen(t){return t.asset&&t.asset.type.name===ir.PublisherScreen.name}static isAttendeeScreen(t){return t.asset&&t.asset.type.name===ir.AttendeeScreen.name}get isVideo(){return Er.isVideo(this.item)}get isStream(){return Er.isStream(this.item)}get isMutedStream(){return Er.isMutedStream(this.item)}get isPublisherStream(){return Er.isPublisherStream(this.item)}get isAttendeeStream(){return Er.isAttendeeStream(this.item)}get isSmartDeviceStream(){return Er.isSmartDeviceStream(this.item)}get isPublisherScreen(){return Er.isPublisherScreen(this.item)}get isAttendeeScreen(){return Er.isAttendeeScreen(this.item)}get isPlayableVideo(){return this.isVideo}get isAutoplayVideo(){return this.isStream}get muted(){return this.muted_}set muted(t){this.muted_=t,this.video&&this.isVideo&&(this.video.muted=!0===t)}constructor(t){this.item=t,this.toggle=this.toggle.bind(this),this.muted_=!1,this.subscription=ee.state$.subscribe((t=>this.muted=t.volumeMuted))}load(t){const e=this.item;let n;if(this.isStream&&e.streamId){const i=e.streamId,r=document.querySelector(`#stream-${i} video`);if(!r)return;const s=()=>{this.disposed||(r.removeEventListener("canplay",s),n=this.texture=new THREE.VideoTexture(r),n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.needsUpdate=!0,"function"==typeof t&&t(n,this))},o=this.isMutedStream;r.crossOrigin="anonymous",r.volume=o?0:1,r.muted=o,r.readyState>=r.HAVE_FUTURE_DATA?s():r.addEventListener("canplay",s)}else if(this.isVideo){const i=e.asset&&e.asset.autoplay||!1,r=e.asset&&e.asset.loop||!1,s=this.video=document.createElement("video");s.crossOrigin="anonymous",s.preload="metadata",s.volume=.8,s.muted=i,s.playsInline=!0,s.loop=r;const o=()=>{this.disposed||(s.oncanplay=null,n=new THREE.VideoTexture(s),n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.needsUpdate=!0,"function"==typeof t&&t(n,this),i?this.play(e.silent):s.pause())},a=()=>{this.disposed||Er.events$.next(new _r(this))},c=()=>{this.disposed||r||Er.events$.next(new vr(this))};s.oncanplay=o,s.ontimeupdate=a,s.onended=c,s.src=Er.getPath(e),s.load()}else e.asset?Er.loadTexture(e,(e=>{this.disposed||(e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,"function"==typeof t&&t(e,this))})):t(null,this);return this}get progress(){return this.video?this.video.currentTime/this.video.duration:0}set progress(t){if(this.video){const e=this.video.duration*t;this.video.seekable.length>t&&this.video.currentTime!==e&&(this.video.currentTime=e,Er.events$.next(new br(this)))}}play(t){this.video&&(this.video.muted=this.muted_,this.video.play().then((()=>{t||Er.events$.next(new gr(this))}),(t=>{console.log("MediaLoader.play.error",this.item.asset.file,t)})))}pause(t){this.video&&this.isVideo&&(this.video.muted=!0,this.video.pause(),t||Er.events$.next(new vr(this)))}toggle(){if(this.video&&this.isVideo)return this.video.paused?(this.video.muted=this.muted_,this.play(),!0):(this.pause(),!1)}dispose(){this.subscription.unsubscribe(),this.pause(!0),this.isVideo&&this.video&&(this.video.ontimeupdate=null,this.video.onended=null,Er.events$.next(new yr(this))),this.disposed=!0,delete this.video}}Er.events$=new n.ReplaySubject(1);class wr{static get defaultGeometry(){return wr.defaultGeometry_||(wr.defaultGeometry_=new THREE.BoxBufferGeometry(1,1,1))}static get planeGeometry(){return wr.planeGeometry_||(wr.planeGeometry_=new THREE.PlaneBufferGeometry(1,1,2,2))}static get sphereGeometry(){return wr.sphereGeometry_||(wr.sphereGeometry_=new THREE.SphereBufferGeometry(3,12,12))}static get panoramaGeometry(){return wr.panoramaGeometry_||(wr.panoramaGeometry_=new THREE.SphereBufferGeometry(101,36,36))}}new THREE.Vector3;class Sr{static get origin(){const t=this.host;if(t){const e=this.origin_;e.set(0,0,0);(t.renderer.xr.isPresenting?t.renderer.xr.getCamera(t.camera):t.camera).localToWorld(e)}return this.origin_}static getDistanceToCamera(t,e,n,i,r){void 0===r&&(r=.88);const s=2*Math.atan(Math.PI*e/360),o=i.y*t.zoom/s,a=i.x*t.zoom/s/n;return r*Math.max(o,a)}}Sr.origin_=new THREE.Vector3;class Tr{}Tr.items=[],Tr.hittest=function(t,e,n){void 0===e&&(e=!1);let i=!1;this.down!==e&&(this.down=e,this.lock=!1,i=!0);const r=this.items.filter((t=>t.parent&&!t.freezed)),s=t.intersectObjects(r);let o,a;const c={};s.forEach(((t,e)=>{const n=t.object;o=n.uuid,0===e&&(this.lastIntersectedObject!==n||i?(this.lastIntersectedObject=n,a=n):n.intersection&&(Math.abs(n.intersection.point.x-t.point.x)>.01||Math.abs(n.intersection.point.y-t.point.y)>.01)&&(n.intersection=t,n.emit("move",n))),c[o]=t})),0===s.length&&(this.lastIntersectedObject=null);return r.forEach((t=>{t.intersection=c[t.uuid],t.over=t===this.lastIntersectedObject||t.intersection&&!t.depthTest&&(!this.lastIntersectedObject||this.lastIntersectedObject.depthTest),t.down=e&&t.over&&!this.lock,t.down&&(this.lock=!0)})),a}.bind(Tr),Tr.dispose=function(t){if(t){const e=this.items.indexOf(t);-1!==e&&this.items.splice(e,1)}}.bind(Tr);class Cr extends r.Mesh{get freezed(){return this.freezed_}set freezed(t){this.freezed_=t,this.children.filter((t=>t.__lookupGetter__("freezed"))).forEach((e=>e.freezed=t))}constructor(t,e){super(t=t||wr.defaultGeometry,e=e||new THREE.MeshBasicMaterial({color:16711935})),this.freezed=!1}freeze(){this.freezed=!0}unfreeze(){this.freezed=!1}}class Rr extends Cr{constructor(t,e){super(t=t||wr.defaultGeometry,e=e||new THREE.MeshBasicMaterial({color:16711935})),this.events={}}on(t,e){const n=this.events[t]=this.events[t]||[];return n.push(e),()=>{this.events[t]=n.filter((t=>t!==e))}}off(t,e){const n=this.events[t];n&&(this.events[t]=n.filter((t=>t!==e)))}emit(t,e){const n=this.events[t];n&&n.forEach((t=>{t(e)}));const i=this.events.broadcast;i&&i.forEach((n=>{n(t,e)}))}}class Ir extends Rr{constructor(t,e){super(t,e),this.depthTest=!0,this.over_=!1,this.down_=!1,Tr.items.push(this)}get isInteractiveMesh(){return!0}get over(){return this.over_}set over(t){this.over_!=t&&(this.over_=t,t?this.emit("over",this):this.emit("out",this))}get down(){return this.down_}set down(t){t=t&&this.over,this.down_!=t&&(this.down_=t,t?this.emit("down",this):this.emit("up",this))}}class xr extends r.DataTextureLoader{constructor(t){super(t),this.type=r.HalfFloatType}parse(t){const e=function(t,e){switch(t){case 1:console.error("THREE.RGBELoader Read Error: "+(e||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(e||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(e||""));break;default:console.error("THREE.RGBELoader: Error: "+(e||""))}return-1},n=function(t,e,n){e=e||1024;let i=t.pos,r=-1,s=0,o="",a=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));for(;0>(r=a.indexOf("\n"))&&s<e&&i<t.byteLength;)o+=a,s+=a.length,i+=128,a+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(i,i+128)));return-1<r&&(!1!==n&&(t.pos+=s+r+1),o+a.slice(0,r))},i=function(t,e,n,i){const r=t[e+3],s=Math.pow(2,r-128)/255;n[i+0]=t[e+0]*s,n[i+1]=t[e+1]*s,n[i+2]=t[e+2]*s,n[i+3]=1},s=function(t,e,n,i){const s=t[e+3],o=Math.pow(2,s-128)/255;n[i+0]=r.DataUtils.toHalfFloat(Math.min(t[e+0]*o,65504)),n[i+1]=r.DataUtils.toHalfFloat(Math.min(t[e+1]*o,65504)),n[i+2]=r.DataUtils.toHalfFloat(Math.min(t[e+2]*o,65504)),n[i+3]=r.DataUtils.toHalfFloat(1)},o=new Uint8Array(t);o.pos=0;const a=function(t){const i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let c,l;if(t.pos>=t.byteLength||!(c=n(t)))return e(1,"no header found");if(!(l=c.match(/^#\?(\S+)/)))return e(3,"bad initial token");for(a.valid|=1,a.programtype=l[1],a.string+=c+"\n";c=n(t),!1!==c;)if(a.string+=c+"\n","#"!==c.charAt(0)){if((l=c.match(i))&&(a.gamma=parseFloat(l[1])),(l=c.match(r))&&(a.exposure=parseFloat(l[1])),(l=c.match(s))&&(a.valid|=2,a.format=l[1]),(l=c.match(o))&&(a.valid|=4,a.height=parseInt(l[1],10),a.width=parseInt(l[2],10)),2&a.valid&&4&a.valid)break}else a.comments+=c+"\n";return 2&a.valid?4&a.valid?a:e(3,"missing image size specifier"):e(3,"missing format specifier")}(o);if(-1!==a){const t=a.width,n=a.height,c=function(t,n,i){const r=n;if(r<8||r>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);if(r!==(t[2]<<8|t[3]))return e(3,"wrong scanline width");const s=new Uint8Array(4*n*i);if(!s.length)return e(4,"unable to allocate buffer space");let o=0,a=0;const c=4*r,l=new Uint8Array(4),u=new Uint8Array(c);let d=i;for(;d>0&&a<t.byteLength;){if(a+4>t.byteLength)return e(1);if(l[0]=t[a++],l[1]=t[a++],l[2]=t[a++],l[3]=t[a++],2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=r)return e(3,"bad rgbe scanline format");let n,i=0;for(;i<c&&a<t.byteLength;){n=t[a++];const r=n>128;if(r&&(n-=128),0===n||i+n>c)return e(3,"bad scanline data");if(r){const e=t[a++];for(let t=0;t<n;t++)u[i++]=e}else u.set(t.subarray(a,a+n),i),i+=n,a+=n}const h=r;for(let t=0;t<h;t++){let e=0;s[o]=u[t+e],e+=r,s[o+1]=u[t+e],e+=r,s[o+2]=u[t+e],e+=r,s[o+3]=u[t+e],o+=4}d--}return s}(o.subarray(o.pos),t,n);if(-1!==c){let e,o,l,u;switch(this.type){case r.FloatType:u=c.length/4;const t=new Float32Array(4*u);for(let e=0;e<u;e++)i(c,4*e,t,4*e);e=t,l=r.FloatType;break;case r.HalfFloatType:u=c.length/4;const n=new Uint16Array(4*u);for(let t=0;t<u;t++)s(c,4*t,n,4*t);e=n,l=r.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:t,height:n,data:e,header:a.string,gamma:a.gamma,exposure:a.exposure,format:o,type:l}}}return null}setDataType(t){return this.type=t,this}load(t,e,n,i){return super.load(t,(function(t,n){switch(t.type){case r.FloatType:case r.HalfFloatType:t.encoding=r.LinearEncoding,t.minFilter=r.LinearFilter,t.magFilter=r.LinearFilter,t.generateMipmaps=!1,t.flipY=!0}e&&e(t,n)}),n,i)}}class Or{static keydown$(){return this.keydown$_||(this.keydown$_=n.fromEvent(window,"keydown").pipe(i.shareReplay(1))),this.keydown$_}static keyup$(){return this.keyup$_||(this.keyup$_=n.fromEvent(window,"keyup").pipe(i.shareReplay(1))),this.keyup$_}static keys$(){return this.keys$_||(this.keys$_=n.merge(this.keydown$(),this.keyup$()).pipe(i.map((t=>{const e=this.keys;return"keydown"===t.type?e[t.key]=!0:delete e[t.key],this.keys})),i.startWith(this.keys),i.shareReplay(1))),this.keys$_}static key$(){if(!this.key$_){const t=/\w/;this.key$_=this.keydown$().pipe(i.filter((e=>e.key&&e.key.match(t))),i.map((t=>t.key)),i.shareReplay(1))}return this.key$_}static typing$(){if(!this.typing$_){let t,e="";this.typing$_=this.key$().pipe(i.map((n=>(t&&clearTimeout(t),e+=n,t=setTimeout((()=>{e=""}),1500),e))),i.shareReplay(1))}return this.typing$_}}Or.keys={};let Lr=0;class Mr{static switchLoaders(){const t=Object.keys(this.items).map((t=>this.items[t])),e=t.length?n.combineLatest(t):n.of(t);this.progress$.next(e)}static getRef(){const t=++Lr;return this.items[t]=new n.BehaviorSubject({loaded:0,total:1}),this.switchLoaders(),t}static setProgress(t,e,n){void 0===n&&(n=1);const i=this.items[t];i&&i.next({loaded:e,total:n}),e>=n&&setTimeout((()=>{delete this.items[t],this.switchLoaders()}),300),this.switchLoaders()}}Mr.progress={value:0,loaded:0,total:0,count:0,title:""},Mr.items={},Mr.progress$=new n.ReplaySubject(1).pipe(i.switchAll(),i.map((()=>{const t=Object.keys(Mr.items).map((t=>Mr.items[t])),e=t.reduce(((t,e,n,i)=>{const r=e.getValue(),s=r.loaded||0,o=r.total||1,a=s/o;return t.value+=a,t.loaded+=s,t.total+=o,t}),{value:0,loaded:0,total:0});return e.count=t.length,t.length&&(e.value/=e.count),e.title=`${Math.round(100*e.value)}%`,Mr.progress=e,e})));let kr=0;const Nr="complete";class Pr{static worker(){return this.worker_||(this.worker_=new Worker(D.workers.prefetch)),this.worker_}static events$(t){if(!("Worker"in window))return n.of({type:Nr,data:t});const e=this.worker();e.postMessage({id:kr});const r=++kr;return e.postMessage({id:r,assets:t}),n.fromEvent(e,"message").pipe(i.map((t=>t.data)),i.filter((e=>e.assets===t)),i.tap((t=>{})),i.takeWhile((t=>t.type!==Nr),!0),i.finalize((()=>{e.postMessage({id:r})})))}static load$(t){return this.events$(t).pipe(i.filter((t=>t.type===Nr)),i.map((t=>t.data)))}static prefetch(t){D.flags.usePrefetch&&this.load$(t).pipe(i.first()).subscribe((t=>{}))}static cancel(){if(!("Worker"in window))return null;const t=this.worker();return t.postMessage({id:kr}),t}}class Dr{constructor(t){this.x=0,this.y=0,this.top=0,this.right=0,this.bottom=0,this.left=0,this.width=0,this.height=0,this.set(t)}static contains(t,e,n){return t.top<=n&&n<=t.bottom&&t.left<=e&&e<=t.right}static intersectRect(t,e){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}static fromNode(t){if(!t)return;const e=t.rect_||(t.rect_=new Dr);if(!t.getClientRects().length)return e;const n=t.getBoundingClientRect();return e.x=n.left,e.y=n.top,e.top=n.top,e.left=n.left,e.width=n.width,e.height=n.height,e.right=e.left+e.width,e.bottom=e.top+e.height,e.setCenter(),e}set(t){t&&(Object.assign(this,t),this.right=this.left+this.width,this.bottom=this.top+this.height),this.setCenter()}setSize(t,e){this.width=t,this.height=e,this.right=this.left+this.width,this.bottom=this.top+this.height,this.setCenter()}setCenter(){const t=this.center||(this.center={});t.top=this.top+this.height/2,t.left=this.left+this.width/2,t.x=t.left,t.y=t.top}contains(t,e){return Dr.contains(this,t,e)}intersect(t){return Dr.intersectRect(this,t)}intersection(t){const e=this.intersection_||(this.intersection_={left:0,top:0,width:0,height:0,x:0,y:0,pow:{x:-1,y:-1},offset:function(t){t=t||0;return(this.top-this.rect.height/2+t)/-this.height},scroll:function(t){t=t||0;return(this.top-this.rect.height/2+t)/-this.height}});e.left=this.left,e.top=this.top,e.width=this.width,e.height=this.height,e.x=this.left+this.width/2,e.y=this.top+this.height/2,e.rect=t;const n=e.offset(0);return e.pow.y=n,e}}const Br=[16763904,65484,52479,13434624,13369599,16777215];class Ur{static get headGeometry(){return this.headGeometry_||(this.headGeometry_=new THREE.SphereBufferGeometry(.2,36,24)),this.headGeometry_}constructor(t){const e=this.clientId=t.clientId,n=this.container=t.container,i=this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1,premultipliedAlpha:!0});i.setClearColor(0,1),i.setPixelRatio(window.devicePixelRatio),i.setSize(320,240),i.toneMapping=THREE.ACESFilmicToneMapping,i.toneMappingExposure=.8,i.outputEncoding=THREE.sRGBEncoding,n.appendChild(i.domElement);const r=this.camera=new THREE.PerspectiveCamera(70,320/240,.01,1e3);r.position.set(0,0,-.5),r.target=new THREE.Vector3,r.lookAt(r.target);const s=this.scene=new THREE.Scene,o=this.light=new THREE.PointLight(16777215,1,100);o.position.set(0,2,-2),s.add(o);const a=this.head=this.addHead();s.add(a),this.remote=Zn.getRemoteById(e)}addHead(){const t=Ur.headGeometry,e=this.canvas=document.createElement("canvas");e.width=1024,e.height=512,this.ctx=this.canvas.getContext("2d");const n=this.map=new THREE.CanvasTexture(e);n.offset.x=-.25;const i=Br[this.clientId%Br.length],r=new THREE.MeshStandardMaterial({map:n,color:i});return this.chalk(0),new THREE.Mesh(t,r)}render(){if(this.tick_?++this.tick_:this.tick_=1,this.remote){const t=12*this.remote.getAudioLevel();this.chalk(t)}const t=this.renderer,e=this.scene,n=this.camera;t.render(e,n)}update(t){const e=t.camera;this.head.quaternion.set(e[3],e[4],e[5],e[6])}dispose(){this.subscription&&this.subscription.unsubscribe()}chalk(t){t=(t+.5*Math.PI)%(2*Math.PI);const e=30*Math.sin(t),n=10*Math.cos(t),i=256,r=this.ctx;r.fillStyle="#888888",r.fillRect(0,0,1024,512),r.fillStyle="white",r.beginPath(),r.arc(472,206,7,0,2*Math.PI),r.arc(552,206,7,0,2*Math.PI),r.closePath(),r.fill(),r.beginPath(),r.moveTo(472-n,286),r.bezierCurveTo(472-n,316,552+n,316,552+n,286),r.bezierCurveTo(552+n,i+e,472-n,i+e,472-n,286),r.closePath(),r.fill(),this.map.needsUpdate=!0}}class Fr{static get defaultTexture(){return Fr.defaultTexture_||(Fr.defaultTexture_=(new THREE.TextureLoader).load("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyNpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDYuMC1jMDA2IDc5LjE2NDc1MywgMjAyMS8wMi8xNS0xMTo1MjoxMyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIDIyLjMgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjcyODFGQkE0QUMxODExRUJBQkRBQTEyMzUzMjUxRjg2IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjcyODFGQkE1QUMxODExRUJBQkRBQTEyMzUzMjUxRjg2Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NzI4MUZCQTJBQzE4MTFFQkFCREFBMTIzNTMyNTFGODYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NzI4MUZCQTNBQzE4MTFFQkFCREFBMTIzNTMyNTFGODYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz55AlN+AAAAZUlEQVR42uzQAQEAAAQDMPTvfD3YIqyT1GdTzwkQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAAAECBAgQIECAgAtWgAEAVbYDfaostxgAAAAASUVORK5CYII="))}static get gridTexture(){return Fr.gridTexture_||(Fr.gridTexture_=(new THREE.TextureLoader).load(D.getPath(D.textures.grid)))}}class Hr extends Ir{static getLoader(){return Hr.loader||(Hr.loader=new THREE.TextureLoader)}static getTextureOff(){return Hr.textureOff||(Hr.textureOff=Hr.getLoader().load(D.getPath("textures/ui/play-off.png")))}static getTextureOn(){return Hr.textureOn||(Hr.textureOn=Hr.getLoader().load(D.getPath("textures/ui/play-on.png")))}static getMaterial(){return new THREE.MeshBasicMaterial({map:Hr.getTextureOff(),color:16777215,opacity:1,transparent:!0})}get playing(){return this.playing_}set playing(t){if(this.playing_!==t){this.playing_=t;this.material.map=t?Hr.getTextureOn():Hr.getTextureOff(),this.onOut()}}constructor(t){const e=wr.planeGeometry,n=Hr.getMaterial();super(e,n),this.playing_=!1,this.material=n,this.host=t,this.colorOff=new THREE.Color(n.color.getHex()),this.colorOn=new THREE.Color("#888888"),this.addEventListener()}update(t){const e=this.scale,n=t.scale.x/t.scale.y;e.set(.3/n,.3,1)}disposeMaterial(){this.material&&(this.material.map&&!1!==this.material.map.disposable&&this.material.map.dispose(),this.material.dispose())}dispose(){this.removeEventListener(),this.disposeMaterial()}onOver(){const t=this.material.color,e=this.colorOn,n=this.material;gsap.to(t,{r:e.r,g:e.g,b:e.b,duration:.2,ease:Power2.easeInOut}),gsap.to(n,{opacity:1,duration:.2,ease:Power2.easeInOut})}onOut(){const t=this.material.color,e=this.colorOff,n=this.material;gsap.to(t,{r:e.r,g:e.g,b:e.b,duration:.2,ease:Power2.easeInOut}),gsap.to(n,{opacity:this.playing?0:1,duration:.2,ease:Power2.easeInOut})}addEventListener(){this.onOver=this.onOver.bind(this),this.onOut=this.onOut.bind(this),this.on("over",this.onOver),this.on("out",this.onOut)}removeEventListener(){this.off("over",this.onOver),this.off("out",this.onOut)}}class Vr extends Ir{static getLoader(){return Vr.loader||(Vr.loader=new THREE.TextureLoader)}static getTextureOff(){return Vr.textureOff||(Vr.textureOff=Vr.getLoader().load(D.getPath("textures/ui/zoom-off.png")))}static getTextureOn(){return Vr.textureOn||(Vr.textureOn=Vr.getLoader().load(D.getPath("textures/ui/zoom-on.png")))}static getMaterial(){return new THREE.MeshBasicMaterial({map:Vr.getTextureOff(),color:16777215,opacity:1,transparent:!0})}get zoomed(){return this.zoomed_}set zoomed(t){if(this.zoomed_!==t){this.zoomed_=t;this.material.map=t?Vr.getTextureOn():Vr.getTextureOff()}}constructor(t){const e=wr.planeGeometry,n=Vr.getMaterial();super(e,n),this.zoomed_=!1,this.material=n,this.host=t,this.colorOff=new THREE.Color(n.color.getHex()),this.colorOn=new THREE.Color("#888888"),this.object=new THREE.Object3D,this.addEventListener()}disposeMaterial(){this.material&&(this.material.map&&!1!==this.material.map.disposable&&this.material.map.dispose(),this.material.dispose())}dispose(){this.removeEventListener(),this.disposeMaterial()}onOver(){const t=this.material.color,e=this.colorOn;this.material,gsap.to(t,{r:e.r,g:e.g,b:e.b,duration:.2,ease:Power2.easeInOut})}onOut(){const t=this.material.color,e=this.colorOff;this.material,gsap.to(t,{r:e.r,g:e.g,b:e.b,duration:.2,ease:Power2.easeInOut})}onToggle(){this.emit("zoomed",!this.zoomed)}addEventListener(){this.onOver=this.onOver.bind(this),this.onOut=this.onOut.bind(this),this.onToggle=this.onToggle.bind(this),this.on("over",this.onOver),this.on("out",this.onOut),this.on("down",this.onToggle)}removeEventListener(){this.off("over",this.onOver),this.off("out",this.onOut),this.off("down",this.onToggle)}}const jr="\nvarying vec2 vUvShader;\n\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n\nvoid main() {\n\tvUvShader = uv;\n\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",Gr="\n#define USE_MAP\n#define threshold 0.55\n#define padding 0.05\nvarying vec2 vUvShader;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// uniform sampler2D map;\nuniform sampler2D playMap;\nuniform vec2 mapResolution;\nuniform vec2 playMapResolution;\nuniform float mapTween;\nuniform float playMapTween;\nuniform vec3 playMapColor;\nuniform vec3 chromaKeyColor;\nuniform bool isVideo;\n\nvoid main() {\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// main\n\tvec4 mapRgba = texture2D(map, vUvShader);\n\tvec4 chromaKey = vec4(chromaKeyColor, 1.0);\n    vec3 chromaKeyDiff = mapRgba.rgb - chromaKey.rgb;\n    float chromaKeyValue = smoothstep(threshold - padding, threshold + padding, dot(chromaKeyDiff, chromaKeyDiff));\n\t/*\n\tif (isVideo) {\n\t\tvec4 playMapRgba = texture2D(playMap, vUvShader);\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2) + (playMapRgba.rgb * mapTween * playMapRgba.a), opacity * chromaKeyValue);\n\t} else {\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2), opacity * chromaKeyValue);\n\t}\n\t*/\n\t// diffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2), opacity * chromaKeyValue);\n\tdiffuseColor = vec4(mapRgba.rgb, opacity * chromaKeyValue);\n\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t// modulation\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\n\tgl_FragColor = vec4(outgoingLight, diffuseColor.a);\n\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n";class Qr extends Ir{static getMaterial(t){return new THREE.ShaderMaterial({depthTest:!0,depthWrite:!0,transparent:!0,toneMapped:!1,vertexShader:jr,fragmentShader:t?Gr:"\n#define USE_MAP\n\nvarying vec2 vUvShader;\n\nuniform vec3 diffuse;\nuniform float opacity;\n\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\n\n// uniform sampler2D map;\nuniform sampler2D playMap;\nuniform vec2 mapResolution;\nuniform vec2 playMapResolution;\nuniform float mapTween;\nuniform float playMapTween;\nuniform vec3 playMapColor;\nuniform bool isVideo;\n\nvoid main() {\n\t#include <clipping_planes_fragment>\n\n\tvec4 diffuseColor = vec4(vec3(1.0), opacity);\n\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\n\t// main\n\tvec4 mapRgba = texture2D(map, vUvShader);\n\tif (isVideo) {\n\t\tvec4 playMapRgba = texture2D(playMap, vUvShader);\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2) + (playMapRgba.rgb * mapTween * playMapRgba.a), opacity);\n\t} else {\n\t\tdiffuseColor = vec4(mapRgba.rgb + (playMapColor * playMapTween * 0.2), opacity);\n\t}\n\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\n\tReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\n\n\t// accumulation (baked indirect lighting only)\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\n\t// modulation\n\t#include <aomap_fragment>\n\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",uniforms:{map:{type:"t",value:Fr.defaultTexture},mapResolution:{value:new THREE.Vector2},mapTween:{value:1},color:{value:new THREE.Color("#FFFFFF")},playMap:{type:"t",value:Fr.defaultTexture},playMapResolution:{value:new THREE.Vector2},playMapTween:{value:0},playMapColor:{value:new THREE.Color("#000000")},opacity:{value:0},isVideo:{value:!1}},extensions:{fragDepth:!0}})}static getChromaKeyMaterial(t){void 0===t&&(t=[0,1,0]);const e=new THREE.ShaderMaterial({depthTest:!0,depthWrite:!0,transparent:!0,toneMapped:!1,vertexShader:jr,fragmentShader:Gr,uniforms:{map:{type:"t",value:null},mapResolution:{value:new THREE.Vector2},mapTween:{value:1},color:{value:new THREE.Color("#FFFFFF")},chromaKeyColor:{value:new THREE.Color(t[0],t[1],t[2])},playMap:{type:"t",value:Fr.defaultTexture},playMapResolution:{value:new THREE.Vector2},playMapTween:{value:0},playMapColor:{value:new THREE.Color("#000000")},opacity:{value:0},isVideo:{value:!1}},extensions:{fragDepth:!0}});return e.map=!0,e}static isPublisherStream(t){return t.clientInfo&&t.clientInfo.role===ne.Publisher&&t.clientInfo.uid===t.streamId}static isAttendeeStream(t){return t.clientInfo&&t.clientInfo.role===ne.Attendee&&t.clientInfo.uid===t.streamId}static isSmartDeviceStream(t){return t.clientInfo&&t.clientInfo.role===ne.SmartDevice&&t.clientInfo.uid===t.streamId}static isPublisherScreen(t){return t.clientInfo&&t.clientInfo.role===ne.Publisher&&t.clientInfo.screenUid===t.streamId}static isAttendeeScreen(t){return t.clientInfo&&t.clientInfo.role===ne.Attendee&&t.clientInfo.screenUid===t.streamId}static getTypeMatcher(t){let e;switch(t.name){case ir.PublisherStream.name:e=this.isPublisherStream;break;case ir.AttendeeStream.name:e=this.isAttendeeStream;break;case ir.SmartDeviceStream.name:e=this.isSmartDeviceStream;break;case ir.PublisherScreen.name:e=this.isPublisherScreen;break;case ir.AttendeeScreen.name:e=this.isAttendeeScreen;break;default:e=t=>!1}return e}static getStreamId$(t){if(!t.asset)return n.of(null);const e=t.asset.type,r=t.asset.file;return or(t.asset)?Zn.streams$.pipe(i.map((n=>{let i,r=0;const s=this.getTypeMatcher(e);return n.forEach((e=>{s(e)&&(r===t.asset.index&&(i=e),r++)})),i?i.streamId:null}))):n.of(r)}static getMaterialByItem(t){let e;return e=t.asset&&t.asset.chromaKeyColor?Qr.getChromaKeyMaterial(t.asset.chromaKeyColor):(t.asset,new THREE.MeshBasicMaterial({color:16777215,toneMapped:!1})),e}static getUniformsByItem(t){let e=null;return t.asset&&(e={mapTween:1,playMapTween:0,opacity:0}),e}get editing(){return this.editing_}set editing(t){this.editing_!==t&&(this.editing_=t,this.zoomed="media"===this.view.type.name||!t&&this.zoomed)}constructor(t,e,n,i){super(n,Qr.getMaterialByItem(t)),this.zoomed_=!1,this.item=t,this.view=e,this.items=e.items,this.host=i,this.uniforms=Qr.getUniformsByItem(t),this.object=new THREE.Object3D,this.tempPosition=new THREE.Vector3,this.tempRotation=new THREE.Vector3,t.silent=this.isAutoplayLoop,this.mediaLoader=new Er(t),this.onOver=this.onOver.bind(this),this.onOut=this.onOut.bind(this),this.onToggle=this.onToggle.bind(this),this.onZoomed=this.onZoomed.bind(this),this.addPlayBtn(),this.addZoomBtn(),this.userData.render=(t,e)=>{this.render(this,t,e)}}load(t){if(this.playBtn&&this.remove(this.playBtn),this.zoomBtn&&this.remove(this.zoomBtn),!this.item.asset)return this.onAppear(),void("function"==typeof t&&t(this));const e=this.material;this.mediaLoader.load((n=>{const i=this.mediaLoader;i&&(n&&(e.map=n,e.uniforms&&(e.uniforms.map.value=n,e.uniforms.mapResolution.value=new THREE.Vector2(n.image.width||n.image.videoWidth,n.image.height||n.image.videoHeight),i.isPlayableVideo&&this.makePlayMap(n,(t=>{t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,e.uniforms.playMap.value=t,e.uniforms.playMapResolution.value=new THREE.Vector2(t.image.width,t.image.height),e.needsUpdate=!0})))),e.needsUpdate=!0,this.onAppear(),i.isPlayableVideo&&this.playBtn&&(e.uniforms&&(e.uniforms.isVideo.value=!0),this.on("over",this.onOver),this.on("out",this.onOut),this.on("down",this.onToggle),this.add(this.playBtn)),this.zoomBtn&&this.add(this.zoomBtn),"function"==typeof t&&t(this))}))}makePlayMap(t,e){const n=t.image.width||t.image.videoWidth,i=t.image.height||t.image.videoHeight,r=n/i,s=document.createElement("canvas");s.width=n,s.height=i;const o=s.getContext("2d");o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high";const a=new Image;a.onload=function(){const t=a.width/a.height;let c,l;r>t?(c=.32*i,l=c/t):(l=.32*n,c=l*t),o.drawImage(a,n/2-c/2,i/2-l/2,c,l);const u=new THREE.CanvasTexture(s);"function"==typeof e&&e(u)},a.crossOrigin="anonymous",a.src=D.getPath("textures/ui/play.png")}events$(){const t=this.item,e=this.items;return t.asset&&t.asset.linkedPlayId&&this.freeze(),Er.events$.pipe(i.filter((e=>e.loader.item&&e.loader.item.id===t.id)),i.map((n=>{if(n instanceof gr?(this.playing=!0,this.isAutoplayLoop||(this.playBtn&&(this.playBtn.playing=!0),this.emit("playing",!0)),this.onOut()):n instanceof vr?(this.playing=!1,this.playBtn&&(this.playBtn.playing=!1),this.emit("playing",!1),this.onOut()):n instanceof br&&this.emit("currentTime",n.loader.video.currentTime),t.asset&&t.asset.linkedPlayId){e.find((e=>e.asset&&-1!==n.src.indexOf(e.asset.file)&&n.id===t.asset.linkedPlayId))&&(n instanceof gr?this.play():n instanceof vr&&this.pause())}return n})))}onAppear(){const t=this.uniforms,e=this.material;e.uniforms&&gsap.to(t,{duration:.4,opacity:1,ease:Power2.easeInOut,onUpdate:()=>{e.uniforms.opacity.value=t.opacity}}),this.zoomed="media"===this.view.type.name||!this.editing&&this.zoomed}onDisappear(){const t=this.uniforms,e=this.material;e.uniforms&&gsap.to(t,{duration:.4,opacity:0,ease:Power2.easeInOut,onUpdate:()=>{e.uniforms.opacity.value=t.opacity}})}onOver(){const t=this.uniforms,e=this.material;e.uniforms&&gsap.to(t,{duration:.4,mapTween:this.playing?0:1,playMapTween:1,opacity:1,ease:Power2.easeInOut,overwrite:!0,onUpdate:()=>{e.uniforms.mapTween.value=t.mapTween,e.uniforms.playMapTween.value=t.playMapTween,e.uniforms.opacity.value=t.opacity}}),this.playBtn&&this.playBtn.onOver()}onOut(){const t=this.uniforms,e=this.material;e.uniforms&&gsap.to(t,{duration:.4,mapTween:this.playing?0:1,playMapTween:0,opacity:1,ease:Power2.easeInOut,overwrite:!0,onUpdate:()=>{e.uniforms.mapTween.value=t.mapTween,e.uniforms.playMapTween.value=t.playMapTween,e.uniforms.opacity.value=t.opacity}}),this.playBtn&&this.playBtn.onOut()}onToggle(){this.playing=this.mediaLoader.toggle(),this.playBtn&&(this.playBtn.playing=this.playing),this.emit("playing",this.playing),this.onOut()}play(){this.mediaLoader.play()}pause(){this.mediaLoader.pause()}setPlayingState(t){this.playing!==t&&(this.playing=t,t?this.mediaLoader.play():this.mediaLoader.pause(),this.onOut(),this.playBtn&&(this.playBtn.playing=t))}setZoomedState(t){this.zoomed=t}setCurrentTime(t){this.mediaLoader.video&&(this.mediaLoader.video.currentTime=t)}disposeMaterial(){this.material&&(this.material.map&&!1!==this.material.map.disposable&&this.material.map.dispose(),this.material.dispose())}disposeMediaLoader(){const t=this.mediaLoader;t&&(t.isPlayableVideo&&(this.off("over",this.onOver),this.off("out",this.onOut),this.off("down",this.onToggle)),t.dispose(),this.mediaLoader=null)}dispose(){this.removePlayBtn(),this.removeZoomBtn(),this.disposeMediaLoader()}get isAutoplayLoop(){return"media"!==this.view.type.name&&this.item.asset&&this.item.asset.autoplay&&this.item.asset.loop}addPlayBtn(){if(this.removePlayBtn(),!this.isAutoplayLoop){const t=this.playBtn=new Hr(this.host);t.on("over",this.onOver),t.on("out",this.onOut),t.on("down",this.onToggle),t.position.z=.01}}removePlayBtn(){this.playBtn&&(this.remove(this.playBtn),this.playBtn.off("over",this.onOver),this.playBtn.off("out",this.onOut),this.playBtn.off("down",this.onToggle),this.playBtn.dispose(),delete this.playBtn)}onZoomed(t){this.zoomed=t,this.emit("zoomed",t)}addZoomBtn(){if(this.removeZoomBtn(),!("media"===this.view.type.name||this.item.asset&&this.item.asset.chromaKeyColor)){(this.zoomBtn=new Vr(this.host)).on("zoomed",this.onZoomed)}}removeZoomBtn(){this.zoomBtn&&(this.remove(this.zoomBtn),this.zoomBtn.off("zoomed",this.onZoomed),this.zoomBtn.dispose(),this.zoomBtn=null,delete this.zoomBtn)}updateByItem(t){this.disposeMaterial(),this.disposeMediaLoader(),this.material=Qr.getMaterialByItem(t),this.uniforms=Qr.getUniformsByItem(t),this.addPlayBtn(),this.addZoomBtn(),t.silent=this.isAutoplayLoop,this.mediaLoader=new Er(t)}updateFromItem(t){t.position&&this.position.fromArray(t.position),t.rotation&&this.rotation.fromArray(t.rotation),t.scale&&this.scale.fromArray(t.scale),this.playBtn&&this.playBtn.update(this),this.updateZoom()}updateZoom(){if(this.originalPosition=this.position.clone(),this.originalScale=this.scale.clone(),this.originalQuaternion=this.quaternion.clone(),this.object.position.copy(this.originalPosition),this.object.scale.copy(this.originalScale),this.object.quaternion.copy(this.originalQuaternion),this.zoomBtn){const t=this.zoomBtn.scale,e=this.zoomBtn.position,n=this.scale.x/this.scale.y,i=.1;t.set(i/n,i,1),e.x=.5-i/n/2,e.y=i/2-.5,e.z=.01}}render(t,e){if(!this.editing){const t=this.object;this.zoomed&&!this.host.renderer.xr.isPresenting&&this.updateObjectMatrix(),this.position.copy(t.position),this.scale.copy(t.scale),this.quaternion.copy(t.quaternion)}}updateObjectMatrix(){const t=this.object,e=this.host;if(this.zoomed){const n=this.originalScale;let i,r=e.camera,s=r.fov,o=r.aspect;const a=this.tempPosition,c=this.tempRotation;i=.01;const l=e.renderer.xr;if(l.isPresenting){r=l.getCamera(r);const t=r.projectionMatrix.elements,e=t[0],n=t[5];o=n/e;s=57.29577951308232*(2*Math.atan(1/n)),i=1}t.scale.copy(n).multiplyScalar(i);const u=Sr.getDistanceToCamera(r,s,o,t.scale);r.getWorldDirection(c),c.multiplyScalar(u),a.set(0,0,0),r.localToWorld(a),a.add(c),t.position.copy(a),t.lookAt(Sr.origin),l.isPresenting&&(t.position.y-=t.scale.y/2)}}get zoomed(){return this.zoomed_}set zoomed(t){this.zoomed_!==t&&(this.zoomed_=t,t?(this.renderOrder=D.renderOrder.panel+5,this.material.depthTest=!0):(this.renderOrder=0,this.material.depthTest=!0,this.object.position.copy(this.originalPosition),this.object.scale.copy(this.originalScale),this.object.quaternion.copy(this.originalQuaternion)),this.material.needsUpdate=!0,this.updateObjectMatrix(),this.zoomBtn&&(this.zoomBtn.zoomed=t))}}class zr{constructor(){this.x=0,this.y=0}}class Wr{constructor(t){t&&Object.assign(this,t)}}class Kr extends Wr{constructor(t){super(t),this.distance=new zr,this.strength=new zr,this.speed=new zr}}class qr extends Wr{constructor(t){super(t),this.distance=new zr,this.strength=new zr,this.speed=new zr}}class Yr extends Wr{constructor(t){super(t)}}let $r;class Xr{static getPosition(t,e){return t instanceof MouseEvent?e?(e.x=t.clientX,e.y=t.clientY):e={x:t.clientX,y:t.clientY}:window.TouchEvent&&t instanceof TouchEvent&&t.touches.length>0&&(e?(e.x=t.touches[0].pageX,e.y=t.touches[0].pageY):e={x:t.touches[0].pageX,y:t.touches[0].pageY}),e}static down$(t,e){let r;return n.merge(n.fromEvent(t,"mousedown").pipe(i.filter((t=>0===t.button))),n.fromEvent(t,"touchstart")).pipe(i.map((n=>{if(r=r||new Kr,r.node=t,r.target=n.target,r.originalEvent=n,r.down=this.getPosition(n,r.down),r.down)return r.distance=new zr,r.strength=new zr,r.speed=new zr,e.next(r),r})),i.filter((t=>void 0!==t)))}static move$(t,e,r,s){let o;return n.fromEvent(document,s.originalEvent instanceof MouseEvent?"mousemove":"touchmove").pipe(i.startWith(s),i.map((n=>{o=o||new qr,o.node=t,o.target=n.target,o.originalEvent=n,o.position=this.getPosition(n,o.position);if(void 0!==s.down&&void 0!==o.position)return o.distance.x=o.position.x-s.down.x,o.distance.y=o.position.y-s.down.y,o.strength.x=o.distance.x/window.innerWidth*2,o.strength.y=o.distance.y/window.innerHeight*2,o.speed.x=s.speed.x+.1*(o.strength.x-s.strength.x),o.speed.y=s.speed.y+.1*(o.strength.y-s.strength.y),s.distance.x=o.distance.x,s.distance.y=o.distance.y,s.speed.x=o.speed.x,s.speed.y=o.speed.y,s.strength.x=o.strength.x,s.strength.y=o.strength.y,e.next(o),o})))}static dismissEvent(t,e,n,i){return $r=$r||new Yr,e.next($r),n.next(),i&&Math.abs(i.distance.x)>10&&(t.preventDefault(),t.stopImmediatePropagation()),$r}static up$(t,e,r,s){return n.fromEvent(document,s.originalEvent instanceof MouseEvent?"mouseup":"touchend").pipe(i.map((t=>this.dismissEvent(t,e,r,s))))}static observe$(t){t=t||document;const e=Xr.events$,r=Xr.dismiss$;return this.down$(t,e).pipe(i.switchMap((s=>(Xr.downEvent=s,n.merge(this.move$(t,e,r,s),this.up$(t,e,r,s)).pipe(i.takeUntil(r))))),i.switchMap((()=>e)))}}Xr.events$=new n.ReplaySubject(1),Xr.dismiss$=new n.Subject;const Jr="panorama",Zr="model";class ts{}class es extends ts{}const ns=new es,is=new class extends ts{},rs=new class extends ts{};class ss{get dolly(){return this.dolly_}set dolly(t){const e=THREE.Math.clamp(t,1,75);this.dolly_!==e&&(this.dolly_=e,this.markAsDirty())}getDollyValue(){return 1-(this.dolly_-1)/74-.5}get zoom(){return this.zoom_}set zoom(t){const e=THREE.Math.clamp(t,1,75);this.zoom_!==e&&(this.zoom_=e,this.markAsDirty())}getZoomValue(){return 2-(this.zoom_-1)/74}get mode(){return this.mode_}set mode(t){this.mode_!==t&&(this.mode_=t,ss.mode=t,this.markAsDirty())}get controlled(){return ee.state.controlling&&ee.state.controlling!==ee.state.uid}get controlling(){return ee.state.controlling&&ee.state.controlling===ee.state.uid}get silencing(){return ee.state.silencing}get silenced(){return ee.state.silencing&&ee.state.role===ne.Streamer}get spyed(){return ee.state.spying&&ee.state.spying===ee.state.uid}get spying(){return ee.state.spying&&ee.state.spying!==ee.state.uid}get isMediaView(){const t=Ar.currentView;return t&&t.type.name===mi.Media.name}get locked(){return this.controlled||this.spying||this.isMediaView}constructor(t){this.mode_=ss.mode=Jr,this.dolly_=70,this.zoom_=70,this.longitude=0,this.latitude=0,this.direction=1,this.radius=101,this.position=new THREE.Vector3,this.inertia=new THREE.Vector2,this.rotation=new THREE.Euler(0,0,0,"XYZ"),this.target=new THREE.Vector3,this.updatePosition=new THREE.Vector3,this.updateTarget=new THREE.Vector3,this.camera=t,this.setLongitudeLatitude(0,0),this.events$=new n.ReplaySubject(1)}setOrientation(t){t&&(this.setLongitudeLatitude(t.longitude,t.latitude),this.markAsDirty())}getOrientation(){return{latitude:this.latitude,longitude:this.longitude}}setLongitudeLatitude(t,e){e=Math.max(-80,Math.min(80,e)),this.longitude=(t<0?360+t:t)%360,this.latitude=e;const n=THREE.Math.degToRad(90-e),i=THREE.Math.degToRad(t);this.phi=n,this.theta=i}observe$(t){let e,r;return n.combineLatest([Or.keys$(),Xr.observe$(t)]).pipe(i.filter((t=>!this.locked)),i.map((t=>{const n=t[0],i=t[1];if(i instanceof Kr)e=this.latitude,r=this.longitude;else if(i instanceof qr)if(n.Shift)this.events$.next(is);else if(n.Control)this.events$.next(rs);else{const t=this.mode_===Zr?-1:1;this.setLongitudeLatitude(r-.1*i.distance.x*t,e+.1*i.distance.y)}return i})),i.filter((t=>t instanceof qr)),i.startWith({latitude:this.latitude,longitude:this.longitude}),i.tap((t=>this.markAsDirty())),i.switchMap((t=>this.events$)))}walk(t,e){let n;if(this.mode_===Zr)n=3;else n=this.radius;const i=new THREE.Vector2(t.x,t.y).normalize().multiplyScalar(n),r=Math.atan2(i.y,i.x);let s=THREE.MathUtils.radToDeg(r);s=(s<0?360+s:s)%360;const o=this.latitude,a=this.longitude;let c=s-a;c=Math.abs(c)>180?c-c/Math.abs(c)*360:c;let l=0-o;l=Math.abs(l)>90?l-l/Math.abs(l)*90:l;const u={tween:0};gsap.to(u,{duration:.7,tween:1,delay:0,ease:Power2.easeInOut,onUpdate:()=>{this.setLongitudeLatitude(a+c*u.tween,o+l*u.tween),this.position.set(t.x*u.tween,0,t.y*u.tween),this.markAsDirty()},onComplete:()=>{"function"==typeof e&&e(s,0)}})}walkComplete(t,e){this.setLongitudeLatitude(t,e),this.position.set(0,0,0),this.markAsDirty()}lookAt(t){if(t){let e=t.position.clone();let n;if(e=this.camera.parent.worldToLocal(e),this.mode_===Zr)n=3;else n=this.radius;const i=new THREE.Vector3(e.x,e.z,e.y).normalize().multiplyScalar(n),r=Math.atan2(i.y,i.x),s=Math.acos(i.z/n);let o=THREE.MathUtils.radToDeg(r);o=(o<0?360+o:o)%360;let a=90-THREE.MathUtils.radToDeg(s);a=Math.max(-80,Math.min(80,a)),this.setLongitudeLatitude(o,a),this.markAsDirty()}}setVRCamera(t){if(t){const e=this.radius,n=new THREE.Vector3(0,0,-e),i=new THREE.Quaternion(t[3],t[4],t[5],t[6]);n.applyQuaternion(i);const r=new THREE.Vector3(n.x,n.z,n.y).normalize().multiplyScalar(e),s=Math.atan2(r.y,r.x),o=Math.acos(r.z/e);let a=THREE.MathUtils.radToDeg(s);a=(a<0?360+a:a)%360;let c=90-THREE.MathUtils.radToDeg(o);c=Math.max(-80,Math.min(80,c)),this.setLongitudeLatitude(a,c),this.markAsDirty()}}render(){ee.state.hosted||(this.longitude+=.025,this.isDirty=!0),this.isDirty&&(this.isDirty=!1,this.update())}markAsDirty(){this.isDirty=!0}update(){let t,e=this.updatePosition,n=this.updateTarget;const i=this.getZoomValue();this.getDollyValue();const r=THREE.MathUtils.degToRad(90-this.latitude),s=THREE.MathUtils.degToRad(this.longitude),o=this.camera,a=o.parent;if(this.mode_===Zr)t=3,e.copy(this.position),n.x=this.position.x+t*Math.sin(r)*Math.cos(s),n.y=this.position.y+t*Math.cos(r),n.z=this.position.z+t*Math.sin(r)*Math.sin(s),n=a.worldToLocal(n),o.target.copy(e),o.position.copy(n);else t=this.radius,n.x=this.position.x+t*Math.sin(r)*Math.cos(s),n.y=this.position.y+t*Math.cos(r),n.z=this.position.z+t*Math.sin(r)*Math.sin(s),e.copy(this.position),n=a.worldToLocal(n),o.target.copy(n),o.position.copy(e);o.zoom=i,o.lookAt(o.target),o.updateProjectionMatrix();const c=Ar.currentView;c&&(c.lastOrientation.longitude=this.longitude,c.lastOrientation.latitude=this.latitude),this.events$.next(ns)}}ss.orbitMoveEvent=ns;let os=0;const as="progress",cs="complete";class ls{static worker(){return this.worker_||(this.worker_=new Worker(D.workers.image)),this.worker_}static events$(t,e){if(!("Worker"in window)||this.isBlob(t)||this.isCors(t))return n.of({type:cs,data:t});const r=++os,s=this.worker();return s.postMessage({src:t,id:r,size:e}),n.fromEvent(s,"message").pipe(i.map((t=>t.data)),i.filter((e=>e.src===t)),i.auditTime(100),i.map((t=>{if(t.type===cs&&t.data instanceof Blob){const e=URL.createObjectURL(t.data);t.data=e}return t})),i.takeWhile((t=>t.type!==cs),!0),i.finalize((()=>{s.postMessage({id:r})})))}static load$(t,e){return this.events$(t,e).pipe(i.filter((t=>t.type===cs)),i.map((t=>t.data)))}static isCors(t){return!1}static isBlob(t){return 0===t.indexOf("blob:")}}class us{static get video(){return this.video_}static set video(t){if(this.video_&&(this.video_.muted=!0,this.video_.pause(),this.video_.parentNode&&this.video_.parentNode.removeChild(this.video_),this.video_=null),t){const t=this.video_=document.createElement("video");t.loop=!0,t.playsInline=!0,t.crossOrigin="anonymous"}}static get muted(){return this.muted_}static set muted(t){this.muted_=t,this.video&&(this.video.muted=!0===t)}static set cubeRenderTarget(t){this.cubeRenderTarget_&&(this.cubeRenderTarget_.texture.dispose(),this.cubeRenderTarget_.dispose()),this.cubeRenderTarget_=t}static set texture(t){this.texture_&&this.texture_.dispose(),this.texture_=t}static load(t,e,n){if(Er.events$.next(new yr(this)),this.video=null,t)return t.type.name===ir.PublisherStream.name?this.loadPublisherStreamBackground(e,n):t.type.name===ir.AttendeeStream.name?this.loadAttendeeStreamBackground(e,n):-1!==t.file.indexOf(".mp4")||-1!==t.file.indexOf(".webm")?this.loadVideoBackground(D.getPath(t.folder),t.file,e,n):-1!==t.file.indexOf(".m3u8")?this.loadHlslVideoBackground(t.file,e,n):-1!==t.file.indexOf(".hdr")?this.loadRgbeBackground(D.getPath(t.folder),t.file,e,n):this.loadBackgroundImageService(D.getPath(t.folder),t.file,e,n)}static loadBackgroundImageService(t,e,r,s){const o=Mr.getRef(),a=new Image;ls.events$(t+e).pipe(i.tap((t=>{t.type===as&&Mr.setProgress(o,t.data.loaded,t.data.total)})),i.filter((t=>t.type===cs)),i.switchMap((t=>{const e=n.fromEvent(a,"load");return a.crossOrigin="anonymous",a.src=t.data,e})),i.takeWhile((t=>t.type!==cs),!0)).subscribe((t=>{const e=new THREE.Texture(a);e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.toneMapped=!1,e.needsUpdate=!0,"function"==typeof s&&(s(e),URL.revokeObjectURL(t.data)),Mr.setProgress(o,1)}))}static loadBackground(t,e,n,i){const r=Mr.getRef(),s=new THREE.TextureLoader;return s.setPath(t).load(e,(t=>{t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.needsUpdate=!0,"function"==typeof i&&i(t),Mr.setProgress(r,1)}),(t=>{Mr.setProgress(r,t.loaded,t.total)})),s}static loadRgbeBackground(t,e,n,i){const r=Mr.getRef(),s=new xr;return s.setDataType(THREE.UnsignedByteType).setPath(t).load(e,(t=>{"function"==typeof i&&i(t,!0),Mr.setProgress(r,1)}),(t=>{Mr.setProgress(r,t.loaded,t.total)})),s}static loadHlslVideoBackground(t,e,n){const i=Mr.getRef(),r=document.createElement("video");if(r.oncanplay=()=>{(()=>{r.oncanplay=null;const t=new THREE.VideoTexture(r);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.needsUpdate=!0,"function"==typeof n&&n(t),Mr.setProgress(i,1)})()},Hls.isSupported()){var s=new Hls;s.attachMedia(r),s.on(Hls.Events.MEDIA_ATTACHED,(()=>{s.loadSource(t),s.on(Hls.Events.MANIFEST_PARSED,((t,e)=>{r.play()}))}))}}static get progress(){const t=this.video;return t?t.currentTime/t.duration:0}static set progress(t){const e=this.video;if(e){const n=e.duration*t;e.seekable.length>t&&e.currentTime!==n&&(e.currentTime=n,Er.events$.next(new br(this)))}}static play(t){const e=this.video;e&&(e.muted=this.muted_,e.play().then((()=>{t||Er.events$.next(new gr(this))}),(t=>{console.log("PanoramaLoader.play.error",e.src,t)})))}static pause(t){const e=this.video;e&&(e.muted=!0,e.pause(),t||Er.events$.next(new vr(this)))}static loadVideoBackground(t,e,n,i){const r=Mr.getRef();this.video=!0;const s=this.video;s.oncanplay=()=>{s.oncanplay=null;const t=new THREE.VideoTexture(s);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.needsUpdate=!0,"function"==typeof i&&i(t),Mr.setProgress(r,1),this.play()},s.ontimeupdate=()=>{Er.events$.next(new _r(this))},s.onended=()=>{},s.crossOrigin="anonymous",s.src=t+e,s.load()}static loadPublisherStreamBackground(t,e){const n=t=>{const n=document.querySelector(`#stream-${t} video`);if(!n)return;const i=()=>{const t=this.texture=new THREE.VideoTexture(n);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.needsUpdate=!0,"function"==typeof e&&e(t)};n.crossOrigin="anonymous",n.readyState>=n.HAVE_FUTURE_DATA?i():n.oncanplay=()=>{i()}};Zn.getPublisherStreamId$().pipe(i.first()).subscribe((t=>n(t)))}static loadAttendeeStreamBackground(t,e){const n=t=>{const n=document.querySelector(`#stream-${t} video`);if(!n)return;const i=()=>{const t=this.texture=new THREE.VideoTexture(n);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.needsUpdate=!0,"function"==typeof e&&e(t)};n.crossOrigin="anonymous",n.readyState>=n.HAVE_FUTURE_DATA?i():n.oncanplay=()=>{i()}};Zn.getAttendeeStreamId$().pipe(i.first()).subscribe((t=>n(t)))}static loadStreamBackground(t,e,n){const r=t=>{const n=document.querySelector(`#stream-${t} video`);if(!n)return;const i=()=>{const t=this.texture=new THREE.VideoTexture(n);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.needsUpdate=!0,"function"==typeof e&&e(t)};n.crossOrigin="anonymous",n.readyState>=n.HAVE_FUTURE_DATA?i():n.oncanplay=()=>{i()}};us.getStreamId$(n).pipe(i.takeUntil(Er.events$.pipe(i.filter((t=>t instanceof yr))))).subscribe((t=>{r(t)}))}static getStreamId$(t){const e=t.type;return Zn.streams$.pipe(i.map((n=>{let i,r=0;const s=Qr.getTypeMatcher(e);return n.forEach((e=>{s(e)&&(r===t.index&&(i=e),r++)})),i?i.streamId:null})))}}class ds{constructor(t){this.muted_=!1,this.subscription=ee.state$.subscribe((t=>us.muted=t.volumeMuted)),this.tween=0,this.create(t)}create(t){this.renderer=t,this.onCubeMapDispose=this.onCubeMapDispose.bind(this);const e=new THREE.BoxGeometry(202,202,202),n=this.getBlackMaterial(),i=new Ir(e,n);i.userData={render:(t,e,n,r,s)=>{i.matrixWorld.copyPosition(s.matrixWorld);const o=this.cubeMap,a=this.texture;o&&a&&a.isVideoTexture&&this.updateCubeMapEquirectangularTexture(o,n,a)}},i.name="[panorama]",this.mesh=i}getBlackMaterial(){return new THREE.MeshBasicMaterial({name:"PanoramaStandardMaterial",color:0,side:THREE.BackSide,depthTest:!1,depthWrite:!1,fog:!1})}getShaderMaterial(t){const e=new THREE.ShaderMaterial({name:"PanoramaCubeMaterial",uniforms:this.cloneUniforms(THREE.ShaderLib.cube.uniforms),vertexShader:THREE.ShaderLib.cube.vertexShader,fragmentShader:THREE.ShaderLib.cube.fragmentShader,side:THREE.BackSide,depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1});t.mapping=THREE.EquirectangularReflectionMapping;const n=this.toCubeMap(t,this.renderer);return e.map=n,e.uniforms.envMap.value=n,e.uniforms.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,e.needsUpdate=!0,this.mesh.geometry.deleteAttribute("normal"),this.mesh.geometry.deleteAttribute("uv"),Object.defineProperty(e,"envMap",{get:function(){return this.uniforms.envMap.value},configurable:!0}),e}makeEnvMap(t){let e=this.mesh.material;if(e.uniforms){t.mapping=THREE.EquirectangularReflectionMapping;const n=this.toCubeMap(t,this.renderer);e.map=n,e.uniforms.envMap.value=n,e.uniforms.flipEnvMap.value=n.isCubeTexture&&n._needsFlipEnvMap?-1:1,e.needsUpdate=!0}else e.dispose(),e=this.getShaderMaterial(t),this.mesh.material=e}toCubeMap(t,e){this.cubeMap&&this.cubeMap.dispose();const n=t.image,i=n.height||n.videoHeight,r=new THREE.WebGLCubeRenderTarget(i/2,{generateMipmaps:!0,type:THREE.HalfFloatType,encoding:THREE.LinearEncoding,minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,mapping:THREE.CubeUVReflectionMapping,format:THREE.RGBAFormat});return r.addEventListener("dispose",this.onCubeMapDispose),this.setCubeMapEquirectangularTexture(r,t),this.updateCubeMapEquirectangularTexture(r,e,t),this.cubeMap=r,this.texture=t,this.mapTextureMapping(r.texture,t.mapping)}setCubeMapEquirectangularTexture(t,e){t.texture.type=e.type,t.texture.format=THREE.RGBAFormat,t.texture.encoding=THREE.sRGBEncoding,t.texture.generateMipmaps=e.generateMipmaps,t.texture.minFilter=e.minFilter,t.texture.magFilter=e.magFilter,t.texture.needsUpdate=!0;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\t\t\t\t\tvarying vec3 vWorldDirection;\n\t\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\t\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\t\t\t\t\t}\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\t\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t\t#include <project_vertex>\n\t\t\t\t\t}\n\t\t\t\t",fragmentShader:"\n\t\t\t\t\tuniform sampler2D tEquirect;\n\t\t\t\t\tvarying vec3 vWorldDirection;\n\t\t\t\t\t#include <common>\n\t\t\t\t\tvoid main() {\n\t\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\t\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\t\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t\t\t\t\t}\n\t\t\t\t"},i=new THREE.BoxGeometry(5,5,5),r=new THREE.ShaderMaterial({name:"CubemapFromEquirect",uniforms:this.cloneUniforms(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:THREE.BackSide,blending:THREE.NoBlending});r.uniforms.tEquirect.value=e;const s=new THREE.Mesh(i,r),o=new THREE.CubeCamera(1,10,t);return t.camera=o,t.mesh=s,t}updateCubeMapEquirectangularTexture(t,e,n){const i=n.minFilter;n.minFilter===THREE.LinearMipmapLinearFilter&&(n.minFilter=THREE.LinearFilter),t.camera.update(e,t.mesh),n.minFilter=i}cloneUniforms(t){const e={};for(const n in t){e[n]={};for(const i in t[n]){const r=t[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[n][i]=r.clone():Array.isArray(r)?e[n][i]=r.slice():e[n][i]=r}}return e}mapTextureMapping(t,e){return e===THREE.EquirectangularReflectionMapping?t.mapping=THREE.CubeReflectionMapping:e===THREE.EquirectangularRefractionMapping&&(t.mapping=THREE.CubeRefractionMapping),t}onCubeMapDispose(){const t=this.cubeMap;t&&(t.removeEventListener("dispose",this.onCubeMapDispose),t.texture.dispose(),t.mesh.geometry.dispose(),t.mesh.material.dispose(),void 0!==t&&(this.cubeMap=null))}change(t,e,n,i){const r=t instanceof _i?t.tiles[t.index_]:t,s=this.mesh.material;this.load(r,e,(e=>{"function"==typeof i&&i(t),s.uniforms&&s.uniforms.uTween&&(s.uniforms.uTween.value=1,s.needsUpdate=!0),"function"==typeof n&&n(e)}))}crossfade(t,e,n){const i=this.mesh.material;this.load(t,e,(t=>{i.uniforms&&i.uniforms.uTween&&(i.uniforms.uTween.value=1,i.needsUpdate=!0),"function"==typeof n&&n(t)}))}getLocalizedAsset(t){if(t&&t.locale){const e=t.locale[ge.lang];e&&(t=e)}return t}load(t,e,n){const i=t.type.name===mi.Media.name?ur.defaultMediaAsset:t.asset;if(!i)return;if(i.type.name===ir.Model.name)return void("function"==typeof n&&n(null));const r=this.getLocalizedAsset(i);this.currentAsset=r.folder+r.file,us.load(r,e,((t,e)=>{if(r.folder+r.file!==this.currentAsset)return void t.dispose();const i=this.makeEnvMap(t);"function"==typeof n&&n(i)}))}dispose(){this.subscription.unsubscribe(),this.cubeMap&&this.cubeMap.dispose()}}const hs=4/3,As=[16777215,16763904,65484,52479,13434624,13369599];class ps{static get geometry(){return new THREE.PlaneBufferGeometry(.12,.09,2,2)}setRemote(t,e,n){this.remote=t;let i,r,s,o,a,c,l;n<4?(i=1,r=0,s=e,o=.12*i,a=o/hs,c=0,l=a/2-n*a/2,this.plane.position.set(c,l+a*e,.005)):(i=.5,r=e%2,s=Math.floor(e/2),o=.12*i,a=o/hs,c=-o/2,l=a/2-Math.ceil(n/2)*a/2,this.plane.position.set(c+r*o,l+s*a,.005)),this.plane.scale.set(i,i,i),"number"==typeof t?this.plane.material.color.set(As[e%As.length]):t.texture?(this.plane.material.map=t.texture,this.plane.material.needsUpdate=!0):this.addStreamTexture(t.streamId,(e=>{t.texture=e,this.plane.material.map=e,this.plane.material.needsUpdate=!0}))}addStreamTexture(t,e){const n=`#stream-${t}`,i=document.querySelector(`${n} video`);if(!i)return;const r=()=>{const t=new THREE.VideoTexture(i);t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.needsUpdate=!0,"function"==typeof e&&e(t)};i.crossOrigin="anonymous",i.readyState>=i.HAVE_FUTURE_DATA?r():i.oncanplay=()=>{r()}}constructor(){const t=ps.geometry,e=new THREE.MeshBasicMaterial({color:16777215});this.plane=new THREE.Mesh(t,e)}}class fs{set remotes(t){t.forEach(((e,n)=>{let i=this.streams[n];i||(i=new ps),i.setRemote(e,n,t.length),this.phone.add(i.plane),this.streams[n]=i}));for(let e=t.length;e<this.streams.length;e++)this.phone.remove(this.streams[e].plane);this.streams.length=t.length}constructor(){const t=this.mesh=new THREE.Group,e=this.phone=this.create();t.add(e),this.streams=[],Zn.remotes$.subscribe((t=>{this.remotes=t}))}create(){const t=new THREE.BoxBufferGeometry(.12,.27,.005,2,2,1),e=new THREE.MeshStandardMaterial({color:0,transparent:!0,opacity:.6}),n=new THREE.Mesh(t,e);return n.rotation.set(-Math.PI/4,0,0),n}}class ms{constructor(t){void 0===t&&(t="#ffffff"),this.position=new THREE.Vector3;const e=wr.planeGeometry,n=(new THREE.TextureLoader).load(D.getPath("textures/ui/nav-point.png")),i=new THREE.MeshBasicMaterial({color:new THREE.Color(t),depthTest:!1,depthWrite:!1,map:n,transparent:!0,opacity:.9}),r=this.mesh=new THREE.Mesh(e,i);r.renderOrder=D.renderOrder.pointer,r.position.set(-1e5,-1e5,-1e5)}update(t){if(Tr.lastIntersectedObject){const e=this.position;e.copy(Tr.lastIntersectedObject.intersection.point),e.multiplyScalar(.99);const n=this.mesh;n.position.set(e.x,e.y,e.z),e.sub(t.position);const i=e.length()/80;n.scale.set(i,i,i),n.lookAt(Sr.origin)}}setPosition(t,e,n,i){const r=this.position;r.set(t,e,n).multiplyScalar(80);const s=this.mesh;s.position.copy(r),r.sub(i.position);const o=r.length()/80;s.scale.set(o,o,o),s.lookAt(Sr.origin)}}class gs{constructor(){this.gravity=new THREE.Vector3(0,-9.8,0),this.controllerPosition=new THREE.Vector3,this.controllerDirection=new THREE.Vector3,this.currentPosition=new THREE.Vector3,this.targetPosition=new THREE.Vector3;const t=new THREE.BufferGeometry,e=this.vertices=new Float32Array(33);e.fill(0);const n=new Float32Array(33);n.fill(.5),t.setAttribute("position",new THREE.BufferAttribute(e,3)),t.setAttribute("color",new THREE.BufferAttribute(n,3));const i=new THREE.LineBasicMaterial({vertexColors:!0,blending:THREE.AdditiveBlending});this.line=new THREE.Line(t,i);const r=(new THREE.TextureLoader).load(D.getPath("textures/ui/nav-point.png"));(this.target=new THREE.Mesh(new THREE.PlaneBufferGeometry(.3,.3,1,1),new THREE.MeshBasicMaterial({map:r,blending:THREE.AdditiveBlending,color:5592405,transparent:!0}))).rotation.x=-Math.PI/2}addToController(t,e){this.currentController=t,t.add(this.line),e.add(this.target)}removeFromController(t,e,n,i,r){const s=this.currentController;if(s===t){const t=this.gravity,o=this.currentPosition,a=this.controllerPosition,c=this.controllerDirection;n.xr.getCamera(i).getWorldPosition(o),o.y=0,s.getWorldPosition(a),s.getWorldDirection(c),c.multiplyScalar(6);const l=(-c.y+Math.sqrt(c.y**2-2*a.y*t.y))/t.y,u=this.getPositionT(this.targetPosition,l,a,c,t);u.addScaledVector(o,-1),r.position.add(u),this.currentController=null,s.remove(this.line),e.remove(this.target)}}update(){const t=this.currentController;if(t){const e=this.gravity,n=this.controllerPosition,i=this.controllerDirection,r=this.targetPosition;t.getWorldPosition(n),t.getWorldDirection(i),i.multiplyScalar(6);const s=(-i.y+Math.sqrt(i.y**2-2*n.y*e.y))/e.y,o=r.set(0,0,0);for(let r=1;r<=10;r++)this.getPositionT(o,r*s/10,n,i,e),t.worldToLocal(o),o.toArray(this.vertices,3*r);this.line.geometry.attributes.position.needsUpdate=!0,this.getPositionT(this.target.position,.98*s,n,i,e)}}getPositionT(t,e,n,i,r){return t.copy(n),t.addScaledVector(i,e),t.addScaledVector(r,.5*e**2),t}}const vs="waiting",ys="enabled",_s="ended",bs="started",Es="disabled",ws="needs-https",Ss="unavailable";class Ts{static getService(){return this.service_||(this.service_=new Ts),this.service_}get status(){return this.status$.getValue()}get state(){return this.state$.getValue()}constructor(){if(Ts.service_)throw"VRService is a singleton class!";const t=this.state_={camera:{position:new THREE.Vector3,quaternion:new THREE.Quaternion,scale:new THREE.Vector3,array:new Array(10).fill(0)}};this.onSessionStarted=this.onSessionStarted.bind(this),this.onSessionEnded=this.onSessionEnded.bind(this),this.status$=new n.BehaviorSubject(vs),this.session$=new n.Subject,this.state$=new n.BehaviorSubject(t),this.currentSession=null,"xr"in navigator?navigator.xr.isSessionSupported("immersive-vr").then((t=>{t?this.status$.next(ys):this.status$.next(Es)})):!1===window.isSecureContext?this.status$.next(ws):this.status$.next(Ss)}onSessionStarted(t){t.addEventListener("end",this.onSessionEnded),this.currentSession=t,this.session$.next(t),this.status$.next(bs)}onSessionEnded(){this.currentSession.removeEventListener("end",this.onSessionEnded),this.currentSession=null,this.session$.next(null),this.status$.next(_s)}toggleVR(t){if(null===this.currentSession){const t={optionalFeatures:["local-floor","bounded-floor"]};navigator.xr.requestSession("immersive-vr",t).then(this.onSessionStarted)}else this.currentSession.end()}isDisabled(){switch(this.status$.getValue()){case vs:case Es:case ws:case Ss:return!0;default:return!1}}getLabel(){let t;switch(this.status$.getValue()){case vs:t="Waiting VR";break;case ys:case _s:t="Enter VR";break;case bs:t="Exit VR";break;case Es:t="VR Disabled";break;case ws:t="VR Needs Https";break;case Ss:t="VR Unavailable"}return t}updateState(t){if(this.status===bs){t.renderer,t.scene;const e=t.camera,n=this.state_;e.matrixWorld.decompose(n.camera.position,n.camera.quaternion,n.camera.scale),n.camera.array[0]=n.camera.position.x,n.camera.array[1]=n.camera.position.y,n.camera.array[2]=n.camera.position.z,n.camera.array[3]=n.camera.quaternion.x,n.camera.array[4]=n.camera.quaternion.y,n.camera.array[5]=n.camera.quaternion.z,n.camera.array[6]=n.camera.quaternion.w,n.camera.array[7]=n.camera.scale.x,n.camera.array[8]=n.camera.scale.y,n.camera.array[9]=n.camera.scale.z,this.state$.next(n)}}}class Cs extends class{constructor(){this.events={}}on(t,e){const n=this.events[t]=this.events[t]||[];return n.push(e),()=>{this.events[t]=n.filter((t=>t!==e))}}off(t,e){const n=this.events[t];n&&(this.events[t]=n.filter((t=>t!==e)))}emit(t,e){const n=this.events[t];n&&n.forEach((t=>{t(e)}));const i=this.events.broadcast;i&&i.forEach((n=>{n(t,e)}))}}{constructor(t){super(),this.gamepad=t,this.buttons={},this.axes={}}update(){this.updateButtons(),this.updateAxes()}updateButtons(){this.gamepad.buttons.forEach(((t,e)=>{const n=t.pressed,i=this.buttons[e]||(this.buttons[e]=new Rs(e,this));i.pressed!==n&&(i.pressed=n,n?this.emit("press",i):void 0!==status&&this.emit("release",i))}))}updateAxes(){const t=this.gamepad.axes;for(let e=0;e<t.length;e+=2){const n=Math.floor(e/2),i=this.axes[n]||(this.axes[n]=new Is(n,this)),r=t[e],s=t[e+1];if(i.x!==r||i.y!==s){if(i.x=r,i.y=s,Math.abs(r)>Math.abs(s)){const t=r<-.85,e=r>.85;i.left!==t&&(i.left=t,this.emit(t?"left":"none",i)),i.right!==e&&(i.right=e,this.emit(e?"right":"none",i))}else{const t=s<-.85,e=s>.85;i.up!==t&&(i.up=t,this.emit(t?"up":"none",i)),i.down!==e&&(i.down=e,this.emit(e?"down":"none",i))}this.emit("axis",i)}}}feedback(t,e){void 0===t&&(t=.1),void 0===e&&(e=50);const n=this.gamepad.hapticActuators;return n&&n.length?n[0].pulse(t,e):Promise.reject()}}class Rs{constructor(t,e){this.index=t,this.gamepad=e,this.pressed=!1}}class Is extends THREE.Vector2{constructor(t,e){super(),this.index=t,this.gamepad=e,this.left=this.right=this.up=this.down=!1}}class xs extends r.Loader{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new Ns(t)})),this.register((function(t){return new Hs(t)})),this.register((function(t){return new Vs(t)})),this.register((function(t){return new Ps(t)})),this.register((function(t){return new Ds(t)})),this.register((function(t){return new Bs(t)})),this.register((function(t){return new Us(t)})),this.register((function(t){return new Fs(t)})),this.register((function(t){return new Ms(t)})),this.register((function(t){return new js(t)}))}load(t,e,n,i){const s=this;let o;o=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.LoaderUtils.extractUrlBase(t),this.manager.itemStart(t);const a=function(e){i?i(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},c=new r.FileLoader(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(t,(function(n){try{s.parse(n,o,(function(n){e(n),s.manager.itemEnd(t)}),a)}catch(t){a(t)}}),n,a)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,n,i){let s;const o={},a={};if("string"==typeof t)s=t;else{if(r.LoaderUtils.decodeText(new Uint8Array(t,0,4))===Gs){try{o[Ls.KHR_BINARY_GLTF]=new Ws(t)}catch(t){return void(i&&i(t))}s=o[Ls.KHR_BINARY_GLTF].content}else s=r.LoaderUtils.decodeText(new Uint8Array(t))}const c=JSON.parse(s);if(void 0===c.asset||c.asset.version[0]<2)return void(i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const l=new To(c,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](l);a[e.name]=e,o[e.name]=!0}if(c.extensionsUsed)for(let t=0;t<c.extensionsUsed.length;++t){const e=c.extensionsUsed[t],n=c.extensionsRequired||[];switch(e){case Ls.KHR_MATERIALS_UNLIT:o[e]=new ks;break;case Ls.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:o[e]=new $s;break;case Ls.KHR_DRACO_MESH_COMPRESSION:o[e]=new Ks(c,this.dracoLoader);break;case Ls.KHR_TEXTURE_TRANSFORM:o[e]=new qs;break;case Ls.KHR_MESH_QUANTIZATION:o[e]=new Xs;break;default:n.indexOf(e)>=0&&void 0===a[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}l.setExtensions(o),l.setPlugins(a),l.parse(n,i)}parseAsync(t,e){const n=this;return new Promise((function(i,r){n.parse(t,e,i,r)}))}}function Os(){let t={};return{get:function(e){return t[e]},add:function(e,n){t[e]=n},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Ls={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Ms{constructor(t){this.parser=t,this.name=Ls.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&t._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(t){const e=this.parser,n="light:"+t;let i=e.cache.get(n);if(i)return i;const s=e.json,o=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let a;const c=new r.Color(16777215);void 0!==o.color&&c.fromArray(o.color);const l=void 0!==o.range?o.range:0;switch(o.type){case"directional":a=new r.DirectionalLight(c),a.target.position.set(0,0,-1),a.add(a.target);break;case"point":a=new r.PointLight(c),a.distance=l;break;case"spot":a=new r.SpotLight(c),a.distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,a.angle=o.spot.outerConeAngle,a.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return a.position.set(0,0,0),a.decay=2,void 0!==o.intensity&&(a.intensity=o.intensity),a.name=e.createUniqueName(o.name||"light_"+t),i=Promise.resolve(a),e.cache.add(n,i),i}createNodeAttachment(t){const e=this,n=this.parser,i=n.json.nodes[t],r=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===r?null:this._loadLight(r).then((function(t){return n._getNodeRef(e.cache,r,t)}))}}class ks{constructor(){this.name=Ls.KHR_MATERIALS_UNLIT}getMaterialType(){return r.MeshBasicMaterial}extendParams(t,e,n){const i=[];t.color=new r.Color(1,1,1),t.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;t.color.fromArray(e),t.opacity=e[3]}void 0!==s.baseColorTexture&&i.push(n.assignTexture(t,"map",s.baseColorTexture))}return Promise.all(i)}}class Ns{constructor(t){this.parser=t,this.name=Ls.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(e.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&s.push(n.assignTexture(e,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(e.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&s.push(n.assignTexture(e,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(s.push(n.assignTexture(e,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){const t=o.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new r.Vector2(t,t)}return Promise.all(s)}}class Ps{constructor(t){this.parser=t,this.name=Ls.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];e.sheenColor=new r.Color(0,0,0),e.sheenRoughness=0,e.sheen=1;const o=i.extensions[this.name];return void 0!==o.sheenColorFactor&&e.sheenColor.fromArray(o.sheenColorFactor),void 0!==o.sheenRoughnessFactor&&(e.sheenRoughness=o.sheenRoughnessFactor),void 0!==o.sheenColorTexture&&s.push(n.assignTexture(e,"sheenColorMap",o.sheenColorTexture)),void 0!==o.sheenRoughnessTexture&&s.push(n.assignTexture(e,"sheenRoughnessMap",o.sheenRoughnessTexture)),Promise.all(s)}}class Ds{constructor(t){this.parser=t,this.name=Ls.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const r=[],s=i.extensions[this.name];return void 0!==s.transmissionFactor&&(e.transmission=s.transmissionFactor),void 0!==s.transmissionTexture&&r.push(n.assignTexture(e,"transmissionMap",s.transmissionTexture)),Promise.all(r)}}class Bs{constructor(t){this.parser=t,this.name=Ls.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];e.thickness=void 0!==o.thicknessFactor?o.thicknessFactor:0,void 0!==o.thicknessTexture&&s.push(n.assignTexture(e,"thicknessMap",o.thicknessTexture)),e.attenuationDistance=o.attenuationDistance||0;const a=o.attenuationColor||[1,1,1];return e.attenuationColor=new r.Color(a[0],a[1],a[2]),Promise.all(s)}}class Us{constructor(t){this.parser=t,this.name=Ls.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return e.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class Fs{constructor(t){this.parser=t,this.name=Ls.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?r.MeshPhysicalMaterial:null}extendMaterialParams(t,e){const n=this.parser,i=n.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],o=i.extensions[this.name];e.specularIntensity=void 0!==o.specularFactor?o.specularFactor:1,void 0!==o.specularTexture&&s.push(n.assignTexture(e,"specularIntensityMap",o.specularTexture));const a=o.specularColorFactor||[1,1,1];return e.specularColor=new r.Color(a[0],a[1],a[2]),void 0!==o.specularColorTexture&&s.push(n.assignTexture(e,"specularColorMap",o.specularColorTexture).then((function(t){t.encoding=r.sRGBEncoding}))),Promise.all(s)}}class Hs{constructor(t){this.parser=t,this.name=Ls.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,n=e.json,i=n.textures[t];if(!i.extensions||!i.extensions[this.name])return null;const r=i.extensions[this.name],s=e.options.ktx2Loader;if(!s){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,r.source,s)}}class Vs{constructor(t){this.parser=t,this.name=Ls.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,n=this.parser,i=n.json,r=i.textures[t];if(!r.extensions||!r.extensions[e])return null;const s=r.extensions[e],o=i.images[s.source];let a=n.textureLoader;if(o.uri){const t=n.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(r){if(r)return n.loadTextureImage(t,o,a);if(i.extensionsRequired&&i.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class js{constructor(t){this.name=Ls.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,n=e.bufferViews[t];if(n.extensions&&n.extensions[this.name]){const t=n.extensions[this.name],i=this.parser.getDependency("buffer",t.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,r.ready]).then((function(e){const n=t.byteOffset||0,i=t.byteLength||0,s=t.count,o=t.byteStride,a=new ArrayBuffer(s*o),c=new Uint8Array(e[0],n,i);return r.decodeGltfBuffer(new Uint8Array(a),s,o,c,t.mode,t.filter),a}))}return null}}const Gs="glTF",Qs=1313821514,zs=5130562;class Ws{constructor(t){this.name=Ls.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12);if(this.header={magic:r.LoaderUtils.decodeText(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Gs)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,i=new DataView(t,12);let s=0;for(;s<n;){const e=i.getUint32(s,!0);s+=4;const n=i.getUint32(s,!0);if(s+=4,n===Qs){const n=new Uint8Array(t,12+s,e);this.content=r.LoaderUtils.decodeText(n)}else if(n===zs){const n=12+s;this.body=t.slice(n,n+e)}s+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Ks{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ls.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const n=this.json,i=this.dracoLoader,r=t.extensions[this.name].bufferView,s=t.extensions[this.name].attributes,o={},a={},c={};for(const t in s){const e=Ao[t]||t.toLowerCase();o[e]=s[t]}for(const e in t.attributes){const i=Ao[e]||e.toLowerCase();if(void 0!==s[e]){const r=n.accessors[t.attributes[e]],s=co[r.componentType];c[i]=s,a[i]=!0===r.normalized}}return e.getDependency("bufferView",r).then((function(t){return new Promise((function(e){i.decodeDracoFile(t,(function(t){for(const e in t.attributes){const n=t.attributes[e],i=a[e];void 0!==i&&(n.normalized=i)}e(t)}),o,c)}))}))}}class qs{constructor(){this.name=Ls.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),void 0===e.offset&&void 0===e.rotation&&void 0===e.scale||(t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class Ys extends r.MeshStandardMaterial{constructor(t){super(),this.isGLTFSpecularGlossinessMaterial=!0;const e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),a={specular:{value:(new r.Color).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(t){for(const e in a)t.uniforms[e]=a[e];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",e).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(t){a.specular.value=t}},specularMap:{get:function(){return a.specularMap.value},set:function(t){a.specularMap.value=t,t?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(t){a.glossiness.value=t}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(t){a.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}copy(t){return super.copy(t),this.specularMap=t.specularMap,this.specular.copy(t.specular),this.glossinessMap=t.glossinessMap,this.glossiness=t.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class $s{constructor(){this.name=Ls.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return Ys}extendParams(t,e,n){const i=e.extensions[this.name];t.color=new r.Color(1,1,1),t.opacity=1;const s=[];if(Array.isArray(i.diffuseFactor)){const e=i.diffuseFactor;t.color.fromArray(e),t.opacity=e[3]}if(void 0!==i.diffuseTexture&&s.push(n.assignTexture(t,"map",i.diffuseTexture)),t.emissive=new r.Color(0,0,0),t.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,t.specular=new r.Color(1,1,1),Array.isArray(i.specularFactor)&&t.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){const e=i.specularGlossinessTexture;s.push(n.assignTexture(t,"glossinessMap",e)),s.push(n.assignTexture(t,"specularMap",e))}return Promise.all(s)}createMaterial(t){const e=new Ys(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=r.TangentSpaceNormalMap,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}class Xs{constructor(){this.name=Ls.KHR_MESH_QUANTIZATION}}class Js extends r.Interpolant{constructor(t,e,n,i){super(t,e,n,i)}copySampleValue_(t){const e=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=t*i*3+i;for(let t=0;t!==i;t++)e[t]=n[r+t];return e}}Js.prototype.beforeStart_=Js.prototype.copySampleValue_,Js.prototype.afterEnd_=Js.prototype.copySampleValue_,Js.prototype.interpolate_=function(t,e,n,i){const r=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=2*o,c=3*o,l=i-e,u=(n-e)/l,d=u*u,h=d*u,A=t*c,p=A-c,f=-2*h+3*d,m=h-d,g=1-f,v=m-d+u;for(let t=0;t!==o;t++){const e=s[p+t+o],n=s[p+t+a]*l,i=s[A+t+o],c=s[A+t]*l;r[t]=g*e+v*n+f*i+m*c}return r};const Zs=new r.Quaternion;class to extends Js{interpolate_(t,e,n,i){const r=super.interpolate_(t,e,n,i);return Zs.fromArray(r).normalize().toArray(r),r}}const eo=0,no=1,io=2,ro=3,so=4,oo=5,ao=6,co={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},lo={9728:r.NearestFilter,9729:r.LinearFilter,9984:r.NearestMipmapNearestFilter,9985:r.LinearMipmapNearestFilter,9986:r.NearestMipmapLinearFilter,9987:r.LinearMipmapLinearFilter},uo={33071:r.ClampToEdgeWrapping,33648:r.MirroredRepeatWrapping,10497:r.RepeatWrapping},ho={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ao={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},po={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},fo={CUBICSPLINE:void 0,LINEAR:r.InterpolateLinear,STEP:r.InterpolateDiscrete},mo="OPAQUE",go="MASK",vo="BLEND";function yo(t,e,n){for(const i in n.extensions)void 0===t[i]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function _o(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function bo(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let n=0,i=e.weights.length;n<i;n++)t.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(t.morphTargetInfluences.length===n.length){t.morphTargetDictionary={};for(let e=0,i=n.length;e<i;e++)t.morphTargetDictionary[n[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Eo(t){const e=t.extensions&&t.extensions[Ls.KHR_DRACO_MESH_COMPRESSION];let n;return n=e?"draco:"+e.bufferView+":"+e.indices+":"+wo(e.attributes):t.indices+":"+wo(t.attributes)+":"+t.mode,n}function wo(t){let e="";const n=Object.keys(t).sort();for(let i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function So(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class To{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Os,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={},"undefined"!=typeof createImageBitmap&&!1===/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)?this.textureLoader=new r.ImageBitmapLoader(this.options.manager):this.textureLoader=new r.TextureLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new r.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const n=this,i=this.json,r=this.extensions;this.cache.removeAll(),this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])})).then((function(e){const s={scene:e[0][i.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:i.asset,parser:n,userData:{}};yo(r,s,i),_o(s,i),Promise.all(n._invokeAll((function(t){return t.afterRoot&&t.afterRoot(s)}))).then((function(){t(s)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[];for(let n=0,i=e.length;n<i;n++){const i=e[n].joints;for(let e=0,n=i.length;e<n;e++)t[i[e]].isBone=!0}for(let e=0,i=t.length;e<i;e++){const i=t[e];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(n[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,n){if(t.refs[e]<=1)return n;const i=n.clone(),r=(t,e)=>{const n=this.associations.get(t);null!=n&&this.associations.set(e,n);for(const[n,i]of t.children.entries())r(i,e.children[n])};return r(n,i),i.name+="_instance_"+t.uses[e]++,i}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let n=0;n<e.length;n++){const i=t(e[n]);if(i)return i}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const n=[];for(let i=0;i<e.length;i++){const r=t(e[i]);r&&n.push(r)}return n}getDependency(t,e){const n=t+":"+e;let i=this.cache.get(n);if(!i){switch(t){case"scene":i=this.loadScene(e);break;case"node":i=this.loadNode(e);break;case"mesh":i=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":i=this.loadAccessor(e);break;case"bufferView":i=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":i=this.loadBuffer(e);break;case"material":i=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":i=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":i=this.loadSkin(e);break;case"animation":i=this.loadAnimation(e);break;case"camera":i=this.loadCamera(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(n,i)}return i}getDependencies(t){let e=this.cache.get(t);if(!e){const n=this,i=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(i.map((function(e,i){return n.getDependency(t,i)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],n=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[Ls.KHR_BINARY_GLTF].body);const i=this.options;return new Promise((function(t,s){n.load(r.LoaderUtils.resolveURL(e.uri,i.path),t,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const n=e.byteLength||0,i=e.byteOffset||0;return t.slice(i,i+n)}))}loadAccessor(t){const e=this,n=this.json,i=this.json.accessors[t];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);const s=[];return void 0!==i.bufferView?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),void 0!==i.sparse&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then((function(t){const s=t[0],o=ho[i.type],a=co[i.componentType],c=a.BYTES_PER_ELEMENT,l=c*o,u=i.byteOffset||0,d=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,h=!0===i.normalized;let A,p;if(d&&d!==l){const t=Math.floor(u/d),n="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+t+":"+i.count;let l=e.cache.get(n);l||(A=new a(s,t*d,i.count*d/c),l=new r.InterleavedBuffer(A,d/c),e.cache.add(n,l)),p=new r.InterleavedBufferAttribute(l,o,u%d/c,h)}else A=null===s?new a(i.count*o):new a(s,u,i.count*o),p=new r.BufferAttribute(A,o,h);if(void 0!==i.sparse){const e=ho.SCALAR,n=co[i.sparse.indices.componentType],c=i.sparse.indices.byteOffset||0,l=i.sparse.values.byteOffset||0,u=new n(t[1],c,i.sparse.count*e),d=new a(t[2],l,i.sparse.count*o);null!==s&&(p=new r.BufferAttribute(p.array.slice(),p.itemSize,p.normalized));for(let t=0,e=u.length;t<e;t++){const e=u[t];if(p.setX(e,d[t*o]),o>=2&&p.setY(e,d[t*o+1]),o>=3&&p.setZ(e,d[t*o+2]),o>=4&&p.setW(e,d[t*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return p}))}loadTexture(t){const e=this.json,n=this.options,i=e.textures[t].source,r=e.images[i];let s=this.textureLoader;if(r.uri){const t=n.manager.getHandler(r.uri);null!==t&&(s=t)}return this.loadTextureImage(t,i,s)}loadTextureImage(t,e,n){const i=this,s=this.json,o=s.textures[t],a=s.images[e],c=(a.uri||a.bufferView)+":"+o.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(e,n).then((function(e){e.flipY=!1,o.name&&(e.name=o.name);const n=(s.samplers||{})[o.sampler]||{};return e.magFilter=lo[n.magFilter]||r.LinearFilter,e.minFilter=lo[n.minFilter]||r.LinearMipmapLinearFilter,e.wrapS=uo[n.wrapS]||r.RepeatWrapping,e.wrapT=uo[n.wrapT]||r.RepeatWrapping,i.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[c]=l,l}loadImageSource(t,e){const n=this,i=this.json,s=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((function(t){return t.clone()})).catch((function(t){throw t}));const o=i.images[t],a=self.URL||self.webkitURL;let c=o.uri||"",l=!1;if(void 0!==o.bufferView)c=n.getDependency("bufferView",o.bufferView).then((function(t){l=!0;const e=new Blob([t],{type:o.mimeType});return c=a.createObjectURL(e),c}));else if(void 0===o.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(c).then((function(t){return new Promise((function(n,i){let o=n;!0===e.isImageBitmapLoader&&(o=function(t){const e=new r.Texture(t);e.needsUpdate=!0,n(e)}),e.load(r.LoaderUtils.resolveURL(t,s.path),o,void 0,i)}))})).then((function(t){var e;return!0===l&&a.revokeObjectURL(c),t.userData.mimeType=o.mimeType||((e=o.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),t}));return this.sourceCache[t]=u,u}assignTexture(t,e,n){const i=this;return this.getDependency("texture",n.index).then((function(r){if(void 0===n.texCoord||0==n.texCoord||"aoMap"===e&&1==n.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+e+" not yet supported."),i.extensions[Ls.KHR_TEXTURE_TRANSFORM]){const t=void 0!==n.extensions?n.extensions[Ls.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=i.associations.get(r);r=i.extensions[Ls.KHR_TEXTURE_TRANSFORM].extendTexture(r,t),i.associations.set(r,e)}}return t[e]=r,r}))}assignFinalMaterial(t){const e=t.geometry;let n=t.material;const i=void 0===e.attributes.tangent,s=void 0!==e.attributes.color,o=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new r.PointsMaterial,r.Material.prototype.copy.call(e,n),e.color.copy(n.color),e.map=n.map,e.sizeAttenuation=!1,this.cache.add(t,e)),n=e}else if(t.isLine){const t="LineBasicMaterial:"+n.uuid;let e=this.cache.get(t);e||(e=new r.LineBasicMaterial,r.Material.prototype.copy.call(e,n),e.color.copy(n.color),this.cache.add(t,e)),n=e}if(i||s||o){let t="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(t+="specular-glossiness:"),i&&(t+="derivative-tangents:"),s&&(t+="vertex-colors:"),o&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=n.clone(),s&&(e.vertexColors=!0),o&&(e.flatShading=!0),i&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(n))),n=e}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),t.material=n}getMaterialType(){return r.MeshStandardMaterial}loadMaterial(t){const e=this,n=this.json,i=this.extensions,s=n.materials[t];let o;const a={},c=s.extensions||{},l=[];if(c[Ls.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const t=i[Ls.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];o=t.getMaterialType(),l.push(t.extendParams(a,s,e))}else if(c[Ls.KHR_MATERIALS_UNLIT]){const t=i[Ls.KHR_MATERIALS_UNLIT];o=t.getMaterialType(),l.push(t.extendParams(a,s,e))}else{const n=s.pbrMetallicRoughness||{};if(a.color=new r.Color(1,1,1),a.opacity=1,Array.isArray(n.baseColorFactor)){const t=n.baseColorFactor;a.color.fromArray(t),a.opacity=t[3]}void 0!==n.baseColorTexture&&l.push(e.assignTexture(a,"map",n.baseColorTexture)),a.metalness=void 0!==n.metallicFactor?n.metallicFactor:1,a.roughness=void 0!==n.roughnessFactor?n.roughnessFactor:1,void 0!==n.metallicRoughnessTexture&&(l.push(e.assignTexture(a,"metalnessMap",n.metallicRoughnessTexture)),l.push(e.assignTexture(a,"roughnessMap",n.metallicRoughnessTexture))),o=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),l.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,a)}))))}!0===s.doubleSided&&(a.side=r.DoubleSide);const u=s.alphaMode||mo;if(u===vo?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,u===go&&(a.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&o!==r.MeshBasicMaterial&&(l.push(e.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new r.Vector2(1,1),void 0!==s.normalTexture.scale)){const t=s.normalTexture.scale;a.normalScale.set(t,t)}return void 0!==s.occlusionTexture&&o!==r.MeshBasicMaterial&&(l.push(e.assignTexture(a,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(a.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&o!==r.MeshBasicMaterial&&(a.emissive=(new r.Color).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&o!==r.MeshBasicMaterial&&l.push(e.assignTexture(a,"emissiveMap",s.emissiveTexture)),Promise.all(l).then((function(){let n;return n=o===Ys?i[Ls.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):new o(a),s.name&&(n.name=s.name),n.map&&(n.map.encoding=r.sRGBEncoding),n.emissiveMap&&(n.emissiveMap.encoding=r.sRGBEncoding),n.sheenColorMap&&(n.sheenColorMap.encoding=r.sRGBEncoding),n.specularColorMap&&(n.specularColorMap.encoding=r.sRGBEncoding),n.specularMap&&(n.specularMap.encoding=r.sRGBEncoding),_o(n,s),e.associations.set(n,{materials:t}),s.extensions&&yo(i,n,s),n}))}createUniqueName(t){const e=r.PropertyBinding.sanitizeNodeName(t||"");let n=e;for(let t=1;this.nodeNamesUsed[n];++t)n=e+"_"+t;return this.nodeNamesUsed[n]=!0,n}loadGeometries(t){const e=this,n=this.extensions,i=this.primitiveCache;function s(t){return n[Ls.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return Ro(n,t,e)}))}const o=[];for(let n=0,a=t.length;n<a;n++){const a=t[n],c=Eo(a),l=i[c];if(l)o.push(l.promise);else{let t;t=a.extensions&&a.extensions[Ls.KHR_DRACO_MESH_COMPRESSION]?s(a):Ro(new r.BufferGeometry,a,e),i[c]={primitive:a,promise:t},o.push(t)}}return Promise.all(o)}loadMesh(t){const e=this,n=this.json,i=this.extensions,s=n.meshes[t],o=s.primitives,a=[];for(let t=0,e=o.length;t<e;t++){const e=void 0===o[t].material?(void 0===(c=this.cache).DefaultMaterial&&(c.DefaultMaterial=new r.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.FrontSide})),c.DefaultMaterial):this.getDependency("material",o[t].material);a.push(e)}var c;return a.push(e.loadGeometries(o)),Promise.all(a).then((function(n){const a=n.slice(0,n.length-1),c=n[n.length-1],l=[];for(let n=0,u=c.length;n<u;n++){const u=c[n],d=o[n];let h;const A=a[n];if(d.mode===so||d.mode===oo||d.mode===ao||void 0===d.mode)h=!0===s.isSkinnedMesh?new r.SkinnedMesh(u,A):new r.Mesh(u,A),!0!==h.isSkinnedMesh||h.geometry.attributes.skinWeight.normalized||h.normalizeSkinWeights(),d.mode===oo?h.geometry=Io(h.geometry,r.TriangleStripDrawMode):d.mode===ao&&(h.geometry=Io(h.geometry,r.TriangleFanDrawMode));else if(d.mode===no)h=new r.LineSegments(u,A);else if(d.mode===ro)h=new r.Line(u,A);else if(d.mode===io)h=new r.LineLoop(u,A);else{if(d.mode!==eo)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);h=new r.Points(u,A)}Object.keys(h.geometry.morphAttributes).length>0&&bo(h,s),h.name=e.createUniqueName(s.name||"mesh_"+t),_o(h,s),d.extensions&&yo(i,h,d),e.assignFinalMaterial(h),l.push(h)}for(let n=0,i=l.length;n<i;n++)e.associations.set(l[n],{meshes:t,primitives:n});if(1===l.length)return l[0];const u=new r.Group;e.associations.set(u,{meshes:t});for(let t=0,e=l.length;t<e;t++)u.add(l[t]);return u}))}loadCamera(t){let e;const n=this.json.cameras[t],i=n[n.type];if(i)return"perspective"===n.type?e=new r.PerspectiveCamera(r.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(e=new r.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(e.name=this.createUniqueName(n.name)),_o(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))}loadAnimation(t){const e=this.json.animations[t],n=[],i=[],s=[],o=[],a=[];for(let t=0,r=e.channels.length;t<r;t++){const r=e.channels[t],c=e.samplers[r.sampler],l=r.target,u=void 0!==l.node?l.node:l.id,d=void 0!==e.parameters?e.parameters[c.input]:c.input,h=void 0!==e.parameters?e.parameters[c.output]:c.output;n.push(this.getDependency("node",u)),i.push(this.getDependency("accessor",d)),s.push(this.getDependency("accessor",h)),o.push(c),a.push(l)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(s),Promise.all(o),Promise.all(a)]).then((function(n){const i=n[0],s=n[1],o=n[2],a=n[3],c=n[4],l=[];for(let t=0,e=i.length;t<e;t++){const e=i[t],n=s[t],u=o[t],d=a[t],h=c[t];if(void 0===e)continue;let A;switch(e.updateMatrix(),e.matrixAutoUpdate=!0,po[h.path]){case po.weights:A=r.NumberKeyframeTrack;break;case po.rotation:A=r.QuaternionKeyframeTrack;break;default:A=r.VectorKeyframeTrack}const p=e.name?e.name:e.uuid,f=void 0!==d.interpolation?fo[d.interpolation]:r.InterpolateLinear,m=[];po[h.path]===po.weights?e.traverse((function(t){t.morphTargetInfluences&&m.push(t.name?t.name:t.uuid)})):m.push(p);let g=u.array;if(u.normalized){const t=So(g.constructor),e=new Float32Array(g.length);for(let n=0,i=g.length;n<i;n++)e[n]=g[n]*t;g=e}for(let t=0,e=m.length;t<e;t++){const e=new A(m[t]+"."+po[h.path],n.array,g,f);"CUBICSPLINE"===d.interpolation&&(e.createInterpolant=function(t){return new(this instanceof r.QuaternionKeyframeTrack?to:Js)(this.times,this.values,this.getValueSize()/3,t)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),l.push(e)}}const u=e.name?e.name:"animation_"+t;return new r.AnimationClip(u,void 0,l)}))}createNodeMesh(t){const e=this.json,n=this,i=e.nodes[t];return void 0===i.mesh?null:n.getDependency("mesh",i.mesh).then((function(t){const e=n._getNodeRef(n.meshCache,i.mesh,t);return void 0!==i.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,n=i.weights.length;e<n;e++)t.morphTargetInfluences[e]=i.weights[e]})),e}))}loadNode(t){const e=this.json,n=this.extensions,i=this,s=e.nodes[t],o=s.name?i.createUniqueName(s.name):"";return function(){const e=[],n=i._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return n&&e.push(n),void 0!==s.camera&&e.push(i.getDependency("camera",s.camera).then((function(t){return i._getNodeRef(i.cameraCache,s.camera,t)}))),i._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){e.push(t)})),Promise.all(e)}().then((function(e){let a;if(a=!0===s.isBone?new r.Bone:e.length>1?new r.Group:1===e.length?e[0]:new r.Object3D,a!==e[0])for(let t=0,n=e.length;t<n;t++)a.add(e[t]);if(s.name&&(a.userData.name=s.name,a.name=o),_o(a,s),s.extensions&&yo(n,a,s),void 0!==s.matrix){const t=new r.Matrix4;t.fromArray(s.matrix),a.applyMatrix4(t)}else void 0!==s.translation&&a.position.fromArray(s.translation),void 0!==s.rotation&&a.quaternion.fromArray(s.rotation),void 0!==s.scale&&a.scale.fromArray(s.scale);return i.associations.has(a)||i.associations.set(a,{}),i.associations.get(a).nodes=t,a}))}loadScene(t){const e=this.json,n=this.extensions,i=this.json.scenes[t],s=this,o=new r.Group;i.name&&(o.name=s.createUniqueName(i.name)),_o(o,i),i.extensions&&yo(n,o,i);const a=i.nodes||[],c=[];for(let t=0,n=a.length;t<n;t++)c.push(Co(a[t],o,e,s));return Promise.all(c).then((function(){return s.associations=(t=>{const e=new Map;for(const[t,n]of s.associations)(t instanceof r.Material||t instanceof r.Texture)&&e.set(t,n);return t.traverse((t=>{const n=s.associations.get(t);null!=n&&e.set(t,n)})),e})(o),o}))}}function Co(t,e,n,i){const s=n.nodes[t];return i.getDependency("node",t).then((function(t){if(void 0===s.skin)return t;let e;return i.getDependency("skin",s.skin).then((function(t){e=t;const n=[];for(let t=0,r=e.joints.length;t<r;t++)n.push(i.getDependency("node",e.joints[t]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(!t.isMesh)return;const i=[],s=[];for(let t=0,o=n.length;t<o;t++){const o=n[t];if(o){i.push(o);const n=new r.Matrix4;void 0!==e.inverseBindMatrices&&n.fromArray(e.inverseBindMatrices.array,16*t),s.push(n)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[t])}t.bind(new r.Skeleton(i,s),t.matrixWorld)})),t}))})).then((function(t){e.add(t);const r=[];if(s.children){const e=s.children;for(let s=0,o=e.length;s<o;s++){const o=e[s];r.push(Co(o,t,n,i))}}return Promise.all(r)}))}function Ro(t,e,n){const i=e.attributes,s=[];function o(e,i){return n.getDependency("accessor",e).then((function(e){t.setAttribute(i,e)}))}for(const e in i){const n=Ao[e]||e.toLowerCase();n in t.attributes||s.push(o(i[e],n))}if(void 0!==e.indices&&!t.index){const i=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));s.push(i)}return _o(t,e),function(t,e,n){const i=e.attributes,s=new r.Box3;if(void 0===i.POSITION)return;{const t=n.json.accessors[i.POSITION],e=t.min,o=t.max;if(void 0===e||void 0===o)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new r.Vector3(e[0],e[1],e[2]),new r.Vector3(o[0],o[1],o[2])),t.normalized){const e=So(co[t.componentType]);s.min.multiplyScalar(e),s.max.multiplyScalar(e)}}const o=e.targets;if(void 0!==o){const t=new r.Vector3,e=new r.Vector3;for(let i=0,r=o.length;i<r;i++){const r=o[i];if(void 0!==r.POSITION){const i=n.json.accessors[r.POSITION],s=i.min,o=i.max;if(void 0!==s&&void 0!==o){if(e.setX(Math.max(Math.abs(s[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(s[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(s[2]),Math.abs(o[2]))),i.normalized){const t=So(co[i.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(t)}t.boundingBox=s;const a=new r.Sphere;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=a}(t,e,n),Promise.all(s).then((function(){return void 0!==e.targets?function(t,e,n){let i=!1,r=!1,s=!1;for(let t=0,n=e.length;t<n;t++){const n=e[t];if(void 0!==n.POSITION&&(i=!0),void 0!==n.NORMAL&&(r=!0),void 0!==n.COLOR_0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(t);const o=[],a=[],c=[];for(let l=0,u=e.length;l<u;l++){const u=e[l];if(i){const e=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):t.attributes.position;o.push(e)}if(r){const e=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):t.attributes.normal;a.push(e)}if(s){const e=void 0!==u.COLOR_0?n.getDependency("accessor",u.COLOR_0):t.attributes.color;c.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(c)]).then((function(e){const n=e[0],o=e[1],a=e[2];return i&&(t.morphAttributes.position=n),r&&(t.morphAttributes.normal=o),s&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}function Io(t,e){let n=t.getIndex();if(null===n){const e=[],i=t.getAttribute("position");if(void 0===i)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<i.count;t++)e.push(t);t.setIndex(e),n=t.getIndex()}const i=n.count-2,s=[];if(e===r.TriangleFanDrawMode)for(let t=1;t<=i;t++)s.push(n.getX(0)),s.push(n.getX(t)),s.push(n.getX(t+1));else for(let t=0;t<i;t++)t%2==0?(s.push(n.getX(t)),s.push(n.getX(t+1)),s.push(n.getX(t+2))):(s.push(n.getX(t+2)),s.push(n.getX(t+1)),s.push(n.getX(t)));s.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=t.clone();return o.setIndex(s),o}const xo={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})},Oo={xAxis:0,yAxis:0,button:0,state:xo.ComponentState.DEFAULT};async function Lo(t){const e=await fetch(t);if(e.ok)return e.json();throw new Error(e.statusText)}async function Mo(t,e,n,i){if(void 0===n&&(n=null),void 0===i&&(i=!0),!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const r=await async function(t){if(!t)throw new Error("No basePath supplied");return await Lo(`${t}/profilesList.json`)}(e);let s;if(t.profiles.some((t=>{const n=r[t];return n&&(s={profileId:t,profilePath:`${e}/${n.path}`,deprecated:!!n.deprecated}),!!s})),!s){if(!n)throw new Error("No matching profile name found");const t=r[n];if(!t)throw new Error(`No matching profile name found and default profile "${n}" missing.`);s={profileId:n,profilePath:`${e}/${t.path}`,deprecated:!!t.deprecated}}const o=await Lo(s.profilePath);let a;if(i){let e;if(e="any"===t.handedness?o.layouts[Object.keys(o.layouts)[0]]:o.layouts[t.handedness],!e)throw new Error(`No matching handedness, ${t.handedness}, in profile ${s.profileId}`);e.assetPath&&(a=s.profilePath.replace("profile.json",e.assetPath))}return{profile:o,assetPath:a}}class ko{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===xo.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(Oo)}updateFromComponent(t){let{xAxis:e,yAxis:n,button:i,state:r}=t;const{normalizedXAxis:s,normalizedYAxis:o}=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0);let n=t,i=e;if(Math.sqrt(t*t+e*e)>1){const r=Math.atan2(e,t);n=Math.cos(r),i=Math.sin(r)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*i+.5}}(e,n);switch(this.componentProperty){case xo.ComponentProperty.X_AXIS:this.value=this.states.includes(r)?s:.5;break;case xo.ComponentProperty.Y_AXIS:this.value=this.states.includes(r)?o:.5;break;case xo.ComponentProperty.BUTTON:this.value=this.states.includes(r)?i:0;break;case xo.ComponentProperty.STATE:this.valueNodeProperty===xo.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(r):this.value=this.states.includes(r)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class No{constructor(t,e){if(!(t&&e&&e.visualResponses&&e.gamepadIndices&&0!==Object.keys(e.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach((t=>{const n=new ko(e.visualResponses[t]);this.visualResponses[t]=n})),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:xo.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return ue({id:this.id},this.values)}updateFromGamepad(t){if(this.values.state=xo.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&t.buttons.length>this.gamepadIndices.button){const e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||1===this.values.button?this.values.state=xo.ComponentState.PRESSED:(e.touched||this.values.button>xo.ButtonTouchThreshold)&&(this.values.state=xo.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===xo.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>xo.AxisTouchThreshold&&(this.values.state=xo.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===xo.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>xo.AxisTouchThreshold&&(this.values.state=xo.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((t=>{t.updateFromComponent(this.values)}))}}class Po{constructor(t,e,n){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=n,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((t=>{const e=this.layoutDescription.components[t];this.components[t]=new No(t,e)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const t=[];return Object.values(this.components).forEach((e=>{t.push(e.data)})),t}updateFromGamepad(){Object.values(this.components).forEach((t=>{t.updateFromGamepad(this.xrInputSource.gamepad)}))}}class Do extends THREE.Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t||(this.envMap=t,this.traverse((t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}))),this}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((t=>{Object.values(t.visualResponses).forEach((t=>{const{valueNode:e,minNode:n,maxNode:i,value:r,valueNodeProperty:s}=t;e&&(s===xo.VisualResponseProperty.VISIBILITY?e.visible=r:s===xo.VisualResponseProperty.TRANSFORM&&(e.quaternion.slerpQuaternions(n.quaternion,i.quaternion,r),e.position.lerpVectors(n.position,i.position,r)))}))})))}}function Bo(t,e){!function(t,e){Object.values(t.components).forEach((t=>{const{type:n,touchPointNodeName:i,visualResponses:r}=t;if(n===xo.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){const e=new THREE.SphereGeometry(.001),n=new THREE.MeshBasicMaterial({color:255}),i=new THREE.Mesh(e,n);t.touchPointNode.add(i)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(r).forEach((t=>{const{valueNodeName:n,minNodeName:i,maxNodeName:r,valueNodeProperty:s}=t;if(s===xo.VisualResponseProperty.TRANSFORM){if(t.minNode=e.getObjectByName(i),t.maxNode=e.getObjectByName(r),!t.minNode)return void console.warn(`Could not find ${i} in the model`);if(!t.maxNode)return void console.warn(`Could not find ${r} in the model`)}t.valueNode=e.getObjectByName(n),t.valueNode||console.warn(`Could not find ${n} in the model`)}))}))}(t.motionController,e),t.envMap&&e.traverse((e=>{e.isMesh&&(e.material.envMap=t.envMap,e.material.needsUpdate=!0)})),t.add(e)}class Uo{constructor(t){void 0===t&&(t=null),this.gltfLoader=t,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new xs)}createControllerModel(t){const e=new Do;let n=null;return t.addEventListener("connected",(t=>{const i=t.data;"tracked-pointer"===i.targetRayMode&&i.gamepad&&Mo(i,this.path,"generic-trigger").then((t=>{let{profile:r,assetPath:s}=t;e.motionController=new Po(i,r,s);const o=this._assetCache[e.motionController.assetUrl];if(o)n=o.scene.clone(),Bo(e,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,(t=>{this._assetCache[e.motionController.assetUrl]=t,n=t.scene.clone(),Bo(e,n)}),null,(()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)}))}})).catch((t=>{console.warn(t)}))})),t.addEventListener("disconnected",(()=>{e.motionController=null,e.remove(n),n=null})),e}}const Fo=new THREE.Vector3,Ho=new THREE.Vector3(0,-1,0),Vo={type:De,orientation:{latitude:0,longitude:0},zoom:1,cameraGroup:{position:[0,0,0],rotation:[0,0,0]},pointer:[0,0,0]};class jo extends t.Component{get error(){return this.error_}set error(t){this.error_!==t&&(this.error_=t,this.pushChanges())}get view(){return this.view_}set view(t){this.view_!==t&&(this.view_=t,this.setView())}get debugging(){return C}get controlled(){return ee.state.controlling&&ee.state.controlling!==ee.state.uid}get controlling(){return ee.state.controlling&&ee.state.controlling===ee.state.uid}get silencing(){return ee.state.silencing}get silenced(){return ee.state.silencing&&ee.state.role===ne.Streamer}get spyed(){return ee.state.spying&&ee.state.spying===ee.state.uid}get spying(){return ee.state.spying&&ee.state.spying!==ee.state.uid}get locked(){return this.controlled||this.spying}get lockedOrXR(){return this.locked||this.renderer.xr.isPresenting}get showMenu(){return ee.state.hosted&&ee.state.navigable&&("embed"!==ee.state.mode||D.flags.menuEmbed)}get showPointer(){return null!=this.pointer.mesh.parent}set showPointer(t){this.showPointer!==t&&(t?this.scene.add(this.pointer.mesh):this.scene.remove(this.pointer.mesh))}set menu(t){this.menu_!==t&&(this.menu_=t,this.scene.traverse((e=>{(e instanceof Qr||e instanceof Hr)&&(e.freezed=null!=t)})))}get menu(){return this.menu_}onInit(){Sr.host=this,this.defaultTexture=Fr.gridTexture,this.index=0,this.error_=null,this.loading=null,this.waiting=null,this.avatars={},this.createScene(),this.addListeners(),this.animate(),Or.keys$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.keys=t})),ge.lang$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.setView()}))}onDestroy(){this.removeListeners();this.renderer.setAnimationLoop((()=>{}))}createScene(){const{node:e}=t.getContext(this);this.size={left:0,top:0,width:0,height:0,aspect:0},this.mouse=new THREE.Vector2,this.controllerMatrix_=new THREE.Matrix4,this.controllerWorldPosition_=new THREE.Vector3,this.controllerWorldDirection_=new THREE.Vector3;const n=this.container=e;this.info=e.querySelector(".world__info"),this.worldRect=Dr.fromNode(n),this.cameraRect=new Dr;const r=this.cameraGroup=new THREE.Group,s=this.camera=new THREE.PerspectiveCamera(70,n.offsetWidth/n.offsetHeight,.01,1e3);s.target=new THREE.Vector3,r.add(s),this.orbitService=new ss(s);const o=this.renderer=new THREE.WebGLRenderer({antialias:D.flags.antialias||!1,alpha:D.flags.alpha||!1,premultipliedAlpha:D.flags.premultipliedAlpha||!1,logarithmicDepthBuffer:!0,powerPreference:"high-performance"});o.setClearColor(0,1),o.setPixelRatio(window.devicePixelRatio),o.setSize(n.offsetWidth,n.offsetHeight),o.xr.enabled=!0,o.outputEncoding=THREE.LinearEncoding,o.toneMapping=THREE.ACESFilmicToneMapping,o.toneMappingExposure=D.toneMappingExposure||1,n.childElementCount>0?n.insertBefore(o.domElement,n.children[0]):n.appendChild(o.domElement);(this.raycaster=new THREE.Raycaster).setFromCamera(this.mouse,s);const a=this.scene=new THREE.Scene;a.add(r),D.flags.useTextureEnvironment&&this.addEnvironment();const c=this.objects=new THREE.Group;c.name="[objects]",a.add(c);const l=this.panorama=new ds(o);this.panoramaIntersectObjects=[l.mesh],this.intersectObjects=this.panoramaIntersectObjects,c.add(l.mesh),this.indicator=new ms,this.pointer=new ms("#ff4332");const u=new THREE.PointLight(16777215,.8);u.position.set(-50,0,0),c.add(u);const d=new THREE.PointLight(16777215,.3);d.position.set(50,0,0),c.add(d);const h=new THREE.PointLight(16777215,.5);h.position.set(0,50,0),c.add(h);const A=new THREE.PointLight(16777215,.1);A.position.set(0,-50,0),c.add(A);const p=this.ambient=new THREE.AmbientLight(16777215,.25);c.add(p),this.addControllers(),this.resize(),Mr.progress$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{const e=0===t.count,n=this.view_;n.items&&n.items.forEach((t=>{t.visible=e}))}))}toggleLights(t){this.ambient&&(this.ambient.visible=t),this.direct&&(this.direct.visible=t)}addEnvironment(){const t=D.textures.envMap.split("/"),e=t.pop(),n=t.join("/")+"/",i=-1!==e.indexOf(".hdr");let r;i?(r=new xr,r.setDataType(THREE.HalfFloatType)):r=new THREE.TextureLoader,r.setPath(D.getPath(n)).load(e,(t=>{i&&t?(t.mapping=THREE.EquirectangularReflectionMapping,this.scene.background=t,this.scene.environment=t):this.setBackground(t)}))}addOffCanvasScene(t){const e=new Ur(t);this.avatars[t.clientId]=e}removeOffCanvasScene(t){this.avatars[t.clientId],delete this.avatars[t.clientId]}updateOffCanvasScene(t){const e=this.avatars[t.clientId];e&&e.update(t)}setBackground(t){let e=t||this.defaultTexture;e.mapping=THREE.EquirectangularReflectionMapping,e.encoding=THREE.sRGBEncoding,this.scene.environment=e}setView(){if(!this.renderer)return;if(!this.panorama)return;const e=this.view_;if(e){null!=ee.state.zoomedId&&ee.patchState({zoomedId:null}),this.views&&this.views.forEach((t=>delete t.onUpdateAsset));const n=this.requestInfoResult;n&&e instanceof _i&&void 0!==n.gridIndex&&(e.index_=n.gridIndex),e.ready=!1,this.cameraGroup.position.set(0,0,0),this.cameraGroup.rotation.set(0,0,0),e.type.name===mi.Room3d.name?(this.renderer.setClearColor(0,1),this.objects.remove(this.panorama.mesh),this.toggleLights(!1)):(this.renderer.setClearColor(0,1),this.objects.add(this.panorama.mesh),this.toggleLights(!0)),this.pushChanges(),Pr.cancel(),this.panorama.change(e,this.renderer,(n=>{D.flags.useTextureEnvironment||this.setBackground(n),e.ready=!0,e.onUpdateAsset=()=>{this.onViewAssetDidChange()};t.getContext(this)&&this.pushChanges()}),(t=>{this.setViewOrientation(t),Pr.prefetch(t.prefetchAssets)}))}}onViewAssetDidChange(){this.panorama&&this.panorama.crossfade(this.view,this.renderer,(t=>{D.flags.useTextureEnvironment||this.setBackground(t)}))}setViewOrientation(t){const e=this.requestInfoResult;if(this.requestInfoResult=null,this.orbitService&&(this.orbitService.mode=t.type.name,!this.renderer.xr.isPresenting)){let n;e?(n=e.orientation,this.orbitService.setOrientation(n),this.orbitService.zoom=e.zoom,this.camera.updateProjectionMatrix()):t.keepOrientation||(n=t.useLastOrientation?t.lastOrientation:t.orientation,this.orbitService.setOrientation(n),this.orbitService.zoom=t.zoom,this.camera.updateProjectionMatrix())}}addControllers(){const t=this.controllerGroup=new THREE.Group;this.teleport=new gs,this.controllers=[],this.controllerModelFactory=new Uo,this.addController(0),this.addController(1),this.cameraGroup.add(t)}addController(t){const e=ee.state.live,n=this.renderer,i=this.controllerGroup,r=n.xr.getController(t),s=this.controllerModelFactory,o=this.teleport,a=this.scene,c=this.camera,l=this.cameraGroup;r.name=`[controller${t+1}]`,i.add(r);const u=t=>{this.controller=t},d=t=>{switch(t.index){case 0:case 1:break;case 4:Mn.send({type:Ue})}},h=t=>{this.onModelUp()},A=t=>{this.cameraGroup.rotation.y+=Math.PI/180*45},p=t=>{this.cameraGroup.rotation.y-=Math.PI/180*45},f=t=>{this.onModelDistance(t.y)};r.userData.update=()=>{},r.addEventListener("selectstart",(t=>{r.userData.isSelecting=!0,u(r)})),r.addEventListener("selectend",(t=>{r.userData.isSelecting=!1})),r.addEventListener("connected",(o=>{if(r.add(this.buildController(o.data)),e&&"left"===o.data.handedness){const t=this.phone=new fs;r.add(t.mesh)}if(!e||"right"===o.data.handedness){const e=n.xr.getControllerGrip(t);e.name=`[controller-grip${t+1}]`;const o=s.createControllerModel(e);r.userData.model=o,e.add(o),i.add(e)}const a=new Cs(o.data.gamepad);a.on("press",d),a.on("release",h),a.on("left",A),a.on("right",p),a.on("axis",f),r.userData.gamepad=a,r.userData.update=()=>{a.update()}})),r.addEventListener("disconnected",(e=>{for(;r.children.length;)r.remove(r.children[0]);const s=n.xr.getControllerGrip(t);for(;s.children.length;)s.remove(s.children[0]);i.remove(s),r.userData.update=()=>{};const u=r.userData.gamepad;u&&(u.off("press",d),u.off("release",h),u.off("left",A),u.off("right",p),u.off("axis",f),delete r.userData.gamepad),o.removeFromController(r,a,n,c,l)})),r.addEventListener("squeezestart",(t=>{this.view&&this.view.type.name===mi.Room3d.name&&(o.addToController(r,a),this.indicator.mesh.visible=!1,r.children[0].visible=!1)})),r.addEventListener("squeezeend",(t=>{o.removeFromController(r,a,n,c,l),this.indicator.mesh.visible=!0,r.children[0].visible=!0}));this.controllers.push(r)}buildController(t){let e,n;switch(t.targetRayMode){case"tracked-pointer":return e=new THREE.BufferGeometry,e.setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,0,-1],3)),e.setAttribute("color",new THREE.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new THREE.LineBasicMaterial({vertexColors:!0,blending:THREE.AdditiveBlending}),new THREE.Line(e,n);case"gaze":return e=new THREE.RingBufferGeometry(.02,.04,32).translate(0,0,-1),n=new THREE.MeshBasicMaterial({opacity:.5,transparent:!0}),new THREE.Mesh(e,n)}}updateRaycasterXR(t,e){if(t)return this.controllerMatrix_.identity().extractRotation(t.matrixWorld),e.ray.origin.setFromMatrixPosition(t.matrixWorld),e.ray.direction.set(0,0,-1).applyMatrix4(this.controllerMatrix_),e}repos(t,e){const n=this.worldRect;t.scale.set(.8,.8,.8);const i=(e.x+e.width/2-n.width/2)/n.width*2*this.camera.aspect,r=(e.y+e.height/2-n.height/2)/n.height*2*this.camera.aspect;t.position.set(i,-r,0)}render(t){try{const t=this.renderer,e=this.scene,n=this.camera,i=this.avatars,r=t.xr.isPresenting;if(!r&&ee.state.mode===dn)return;r?(gsap.ticker.tick(),this.controllers.forEach((t=>t.userData.update())),this.teleport.update()):this.navWithKeys(),this.orbitService.render();const s=performance.now(),o=this.tick_?++this.tick_:this.tick_=1;e.traverse((i=>{const r=i.userData.render;"function"==typeof r&&r(s,o,t,e,n)})),Object.keys(i).forEach((t=>{i[t].render()})),this.vrService.updateState(this),this.raycasterXRHitTest(),t.render(e,n)}catch(t){this.error=t}}navWithKeys(){if(this.view&&this.view.type.name===mi.Room3d.name&&this.view.mesh&&!this.locked&&!ai.hasModal){this.intersectObjects=this.view.intersectObjects;const t=this.velocity||(this.velocity=new THREE.Vector3),e=this.direction||(this.direction=new THREE.Vector3),n=this.camera,i=.1;if(this.keys.w||this.keys.ArrowUp)n.getWorldDirection(e),e.multiplyScalar(i),t.copy(e);else if(this.keys.s||this.keys.ArrowDown)n.getWorldDirection(e),e.multiplyScalar(-i),t.copy(e);else if(this.keys.d||this.keys.ArrowRight){n.getWorldDirection(e),e.multiplyScalar(i);const r=this.axisY||(this.direction=new THREE.Vector3(0,1,0)),s=-Math.PI/2;e.applyAxisAngle(r,s),t.copy(e)}else if(this.keys.a||this.keys.ArrowLeft){n.getWorldDirection(e),e.multiplyScalar(-i);const r=this.axisY||(this.direction=new THREE.Vector3(0,1,0)),s=-Math.PI/2;e.applyAxisAngle(r,s),t.copy(e)}if(t.manhattanLength()>1e-5){e.copy(this.cameraGroup.position),e.add(t),e.y=0;const n=this.raycaster;n.set(e,Ho);n.intersectObjects(this.view.navIntersectObjects).length&&(this.cameraGroup.position.add(t),this.cameraGroup.position.y=0,this.orbitService.markAsDirty()),t.lerp(Fo,.1)}else t.set(0,0,0)}else this.intersectObjects=this.panoramaIntersectObjects}animate(){this.renderer.setAnimationLoop(this.render)}resize(){try{const t=this.container,e=this.renderer,n=this.camera,i=this.size,r=t.getBoundingClientRect();i.left=Math.floor(r.left),i.top=Math.floor(r.top),i.width=Math.ceil(r.width),i.height=Math.ceil(r.height),i.aspect=i.width/i.height;if(this.worldRect.setSize(i.width,i.height),!e.xr.isPresenting&&(e.setSize(i.width,i.height),n)){n.aspect=i.width/i.height;const t=n.fov*Math.PI/180,e=Math.abs(n.position.z*Math.tan(t/2)*2),r=this.cameraRect;r.width=e*n.aspect,r.height=e,n.updateProjectionMatrix()}}catch(t){this.error=t}}updateRaycasterMouse(t){const e=this.size.width/2,n=this.size.height/2;this.mouse.x=(t.clientX-this.size.left-e)/e,this.mouse.y=-(t.clientY-this.size.top-n)/n;const i=this.raycaster;return i.setFromCamera(this.mouse,this.camera),i}raycasterXRHitTest(){if(this.renderer.xr.isPresenting&&!this.locked){const t=this.updateRaycasterXR(this.controller,this.raycaster);t&&(Tr.hittest(t,this.controller.userData.isSelecting),this.indicator.update(this.renderer.xr.getCamera(this.camera)))}}raycasterDesktopHitTest(t){const e=this.updateRaycasterMouse(t);if(!this.lockedOrXR)if(this.dragItem){if("function"==typeof this.dragItem.onDragMove){const t=e.intersectObjects(this.intersectObjects);if(t.length){const e=t[0],n=this.intersectionPoint||(this.intersectionPoint=new THREE.Vector3),i=this.intersectionNormal||(this.intersectionNormal=new THREE.Vector3),r=n.copy(e.point),s=i.copy(e.face.normal);this.dragItem.onDragMove(r,s,this.intersectObjects===this.panoramaIntersectObjects)}}}else this.resizeItem||(Tr.hittest(e),this.controlEvent$.next(Vo))}onMouseDown(t){try{if(this.locked)return;if(0!==t.button)return;const e=this.updateRaycasterMouse(t),n=Tr.hittest(e,!0);if(this.editor||C){if(!this.keys.Shift&&!this.keys.Control){this.select.next({item:null});const t=e.intersectObjects(this.intersectObjects);if(t.length){const e=t[0],n=this.intersectionPoint||(this.intersectionPoint=new THREE.Vector3),i=this.intersectionNormal||(this.intersectionNormal=new THREE.Vector3),r=n.copy(e.point),s=i.copy(e.face.normal);this.viewHit.next({position:r,normal:s,spherical:this.intersectObjects===this.panoramaIntersectObjects})}}}else if(this.isTouchDevice()&&n&&"[panorama]"===n.name){const t=this.view.items.find((t=>t.showPanel));t&&(t.showPanel=!1,this.pushChanges())}}catch(t){this.error=t}}onMouseMove(t){try{this.raycasterDesktopHitTest(t)}catch(t){this.error=t}}onMouseUp(t){try{if(this.lockedOrXR)return;this.dragItem&&"function"==typeof this.dragItem.onDragEnd&&(this.dragItem.onDragEnd(),this.dragEnd.next(this.dragItem)),this.dragItem=null,this.resizeItem&&"function"==typeof this.resizeItem.onResizeEnd&&(this.resizeItem.onResizeEnd(),this.resizeEnd.next(this.resizeItem)),this.resizeItem=null;const e=this.updateRaycasterMouse(t);Tr.hittest(e,!1);this.checkSelectedItem()}catch(t){this.error=t}}onMouseWheel(t){try{if(this.lockedOrXR)return;const e=t.deltaY*(void 0!==t.wheelDeltaY?1:37),n=this.orbitService;gsap.to(n,{duration:.5,zoom:n.zoom+.1*e,ease:Power4.easeOut,overwrite:!0})}catch(t){this.error=t}}onOrientationDidChange(){this.controlEvent$.next(Vo)}checkSelectedItem(){if(this.view){const t=this.view.items.find((t=>t.selected));t&&t.mesh&&"model"!==this.view.type.name&&this.orbitService.lookAt(t.mesh)}}onVRStarted(){this.objects.position.y=1.3,this.scene.add(this.indicator.mesh),Mn.send({type:an})}onVREnded(){this.objects.position.y=0,this.cameraGroup.rotation.y=0,this.cameraGroup.position.y=0,this.scene.remove(this.indicator.mesh),this.orbitService.markAsDirty(),Mn.send({type:on})}onVRStateDidChange(t){Mn.send({type:cn,camera:t.camera.array})}onMenuNav(t){this.menu=void 0,this.navTo.next({viewId:t.id})}onMenuToggle(t){this.locked||(this.menu=t,this.view.items.forEach((t=>t.showPanel=!1)),this.pushChanges())}onNavOver(t){this.menu||(this.view.items.forEach((t=>t.showPanel=!1)),t.item.to&&clearTimeout(t.item.to),t.item.showPanel=t.shouldShowPanel(),this.pushChanges(),Mn.send({type:tn,itemId:t.item.showPanel?t.item.id:null}))}onNavOut(t){this.isTouchDevice()||(t.item.to=setTimeout((()=>{t.item.showPanel=!1,this.pushChanges()}),6e3),this.pushChanges())}onNavDown(t){this.isTouchDevice()||(t.item.showPanel=!1),this.locked||(this.editor&&this.keys.Shift?(this.dragItem=t,this.select.next(t)):this.editor&&this.keys.Control?(this.resizeItem=t,this.select.next(t)):this.navTo.next(t.item))}onNavLink(t){this.locked||this.editor||(D.flags.useIframe?(Mn.send({type:Ve,itemId:t.item.id,linkIndex:t.linkIndex}),this.navLink.next(t)):window.open(t.link.href,"_blank"))}isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0}onModelDown(t){if(this.editor)return this.onObjectDown(t);const e=this.controller;if(e&&this.renderer.xr.isPresenting){const n=this.tempTarget=t.mesh;this.tempParent=n.parent;const i=new THREE.Vector3;n.localToWorld(i),e.worldToLocal(i),e.add(n),n.position.copy(i)}}onModelDistance(t){const e=this.controller,n=this.tempTarget;if(e&&n&&this.renderer.xr.isPresenting){let e=new THREE.Vector3;e=e.copy(n.position);const i=Math.max(1,Math.min(8,e.distanceTo(Fo)+.02*t));e.normalize(),e=e.multiplyScalar(i),n.position.copy(e)}}onModelUp(){const t=this.tempTarget,e=this.tempParent;if(t&&e){const n=new THREE.Vector3;t.localToWorld(n),e.worldToLocal(n),e.add(t),t.position.copy(n),this.tempTarget=null,this.tempParent=null}}onObjectDown(t){this.lockedOrXR||(this.editor&&this.keys.Shift?(this.dragItem=t,this.select.next(t)):this.editor&&this.keys.Control&&(this.resizeItem=t,this.select.next(t)))}onPanelDown(t){this.locked||(D.flags.useIframe?(Mn.send({type:Ve,itemId:t.item.id,linkIndex:t.linkIndex}),this.navLink.next(t)):window.open(t.link.href,"_blank"))}onPlayMedia(t){this.editor||Mn.send({type:ze,itemId:t.itemId,playing:t.playing})}onZoomMedia(t){t.zoomed&&this.view.items.forEach((e=>{e.mesh instanceof Qr&&e.id!==t.itemId&&e.mesh.setZoomedState(!1)})),this.view.items.forEach((t=>t.showPanel=!1)),ee.patchState({zoomedId:t.zoomed?t.itemId:null}),Mn.send({type:ln,itemId:t.itemId,zoomed:t.zoomed})}onCurrentTimeMedia(t){this.editor||Mn.send({type:Be,itemId:t.itemId,currentTime:t.currentTime})}onPlayModel(t){this.editor||Mn.send({type:We,itemId:t.itemId,actionIndex:t.actionIndex})}onGridMove(t){this.view.items=[],this.pushChanges(),this.orbitService.walk(t.position,((e,n)=>{const i=this.view.getTile(t.indices.x,t.indices.y);i&&this.panorama.crossfade(i,this.renderer,(t=>{D.flags.useTextureEnvironment||this.setBackground(t),this.orbitService.walkComplete(e,n),this.view.updateCurrentItems(),this.pushChanges()}))}))}onGridNav(t){this.locked||(Mn.send({type:Ge,viewId:this.view.id,gridIndex:t}),this.pushChanges())}setSnapshot(t){Ar.viewId!==t.viewId?(Ar.viewId=t.viewId,this.requestInfoResult=t):(this.renderer.xr.isPresenting||(this.orbitService.setOrientation(t.orientation),this.orbitService.zoom=t.zoom,this.cameraGroup.position.set(t.cameraGroup.position[0],t.cameraGroup.position[1],t.cameraGroup.position[2]),this.cameraGroup.rotation.set(t.cameraGroup.rotation[0],t.cameraGroup.rotation[1],t.cameraGroup.rotation[2])),this.view instanceof _i&&t.gridIndex&&(this.view.index=t.gridIndex),this.view&&this.view.ready||(this.requestInfoResult=t))}getSnapshot(){const t=ue(ue({},Vo),{},{viewId:this.view.id,type:Ze});return this.view instanceof _i&&(t.gridIndex=this.view.index),t}sendSetSnapshot(){const t=this.getSnapshot();Mn.send(t)}control$(){return this.controlEvent$.pipe(i.filter((()=>this.controlling||this.spyed||this.editor)),i.auditTime(Math.floor(1e3/15)),i.map((t=>{t.orientation.latitude=this.orbitService.latitude,t.orientation.longitude=this.orbitService.longitude,t.zoom=this.orbitService.zoom,t.cameraGroup={position:this.cameraGroup.position.toArray(),rotation:this.cameraGroup.rotation.toArray()};const e=this.raycaster.intersectObjects(this.intersectObjects),n=e.length?e[0].point.normalize():null;return n&&(t.pointer[0]=n.x,t.pointer[1]=n.y,t.pointer[2]=n.z),Mn.send(t),t})),i.auditTime(4e3),i.tap((t=>{const e=this.getSnapshot();Mn.send(e)})))}addListeners(){this.controlEvent$=new n.ReplaySubject(1),this.control$().pipe(i.takeUntil(this.unsubscribe$)).subscribe();const t=this.vrService=Ts.getService();t.session$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.renderer.xr.setSession(t),t?this.onVRStarted():this.onVREnded()})),t.state$.pipe(i.takeUntil(this.unsubscribe$),i.auditTime(Math.floor(1e3/15))).subscribe((t=>{this.onVRStateDidChange(t)}));this.orbitService.observe$(this.container).pipe(i.shareReplay(1)).pipe(i.filter((t=>t instanceof es)),i.auditTime(Math.floor(1e3/15))).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.onOrientationDidChange()})),Mn.out$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{switch(qn.log("WorldComponent.addListeners","MessageService.out$",t),t.type){case qe:qn.log("WorldComponent.MessageType.RequestControl",t.controllingId),ee.patchState({controlling:t.controllingId,spying:!1}),t.controllingId===ee.state.uid&&this.sendSetSnapshot();break;case $e:qn.log("WorldComponent.MessageType.RequestSpy",t.spyingId),ee.patchState({spying:t.spyingId,controlling:!1}),t.spyingId===ee.state.uid&&this.sendSetSnapshot();break;case Ze:this.setSnapshot(t);break;case tn:this.menu&&this.menu.removeMenu(),this.view.items.forEach((e=>e.showPanel=e.id===t.itemId)),this.pushChanges();break;case Ve:{const e=this.view.items.find((e=>e.id===t.itemId));if(e){const n=e.links[t.linkIndex];this.navLink.next({item:e,link:n,linkIndex:t.linkIndex})}break}case je:this.view.items.find((e=>e.id===t.itemId))&&ai.resolve();break;case ze:{const e=this.view.items.find((e=>e.id===t.itemId));e&&e.mesh instanceof Qr&&e.mesh.setPlayingState(t.playing);break}case ln:this.view.items.forEach((e=>{e.mesh instanceof Qr&&(e.id===t.itemId?e.mesh.setZoomedState(t.zoomed):e.mesh.setZoomedState(!1))})),ee.patchState({zoomedId:t.zoomed?t.itemId:null});break;case Be:{const e=this.view.items.find((e=>e.id===t.itemId));e&&e.mesh instanceof Qr&&e.mesh.setCurrentTime(t.currentTime);break}case We:{const e=this.view.items.find((e=>e.id===t.itemId));e&&e.onMessage(t);break}case Ge:this.view.id===t.viewId&&(this.view.index=t.gridIndex);break;case an:this.addOffCanvasScene(t);break;case on:this.removeOffCanvasScene(t);break;case cn:this.updateOffCanvasScene(t),ee.state.spying!==t.clientId&&ee.state.controlling!==t.clientId||this.orbitService.setVRCamera(t.camera);break;case De:this.renderer.xr.isPresenting||(this.orbitService.setOrientation(t.orientation),this.orbitService.zoom=t.zoom,this.cameraGroup.position.set(t.cameraGroup.position[0],t.cameraGroup.position[1],t.cameraGroup.position[2]),this.cameraGroup.rotation.set(t.cameraGroup.rotation[0],t.cameraGroup.rotation[1],t.cameraGroup.rotation[2])),this.pointer.setPosition(t.pointer[0],t.pointer[1],t.pointer[2],this.camera)}})),Mn.in$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{if(t.type===Je)this.checkSelectedItem()})),ee.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.state=t,this.showPointer=this.locked})),this.resize=this.resize.bind(this),this.render=this.render.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),window.addEventListener("resize",this.resize,!1),this.container.addEventListener("wheel",this.onMouseWheel,!1),this.container.addEventListener("mousedown",this.onMouseDown,!1),this.container.addEventListener("mouseup",this.onMouseUp,!1),document.addEventListener("mousemove",this.onMouseMove,!1)}removeListeners(){window.removeEventListener("resize",this.resize,!1),window.removeEventListener("resize",this.resize,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("wheel",this.onMouseWheel,!1),this.container.removeEventListener("mousedown",this.onMouseDown,!1),this.container.removeEventListener("mouseup",this.onMouseUp,!1)}}jo.meta={selector:"[world]",inputs:["view","views","editor"],outputs:["navTo","navLink","viewHit","dragEnd","resizeEnd","select"],template:'\n\t<div class="world__view" *if="view">\n\t\t<div class="grid" model-grid *if="view.type.name === \'panorama-grid\'" [view]="view" (move)="onGridMove($event)" (nav)="onGridNav($event)"></div>\n\t\t<div *if="view.ready">\n\t\t\t<div model-room [view]="view" *if="view.type.name === \'room-3d\'"></div>\n\t\t\t<div class="world__item" *for="let item of view.pathItems; let index = index;">\n\t\t\t\t<div model-nav [item]="item" [view]="view" (over)="onNavOver($event)" (out)="onNavOut($event)" (down)="onNavDown($event)" (link)="onNavLink($event)" *if="item.type.name == \'nav\'"></div>\n\t\t\t\t<div model-plane [item]="item" [view]="view" (play)="onPlayMedia($event)" (zoom)="onZoomMedia($event)" (down)="onObjectDown($event)" (currentTime)="onCurrentTimeMedia($event)" *if="item.type.name == \'plane\'"></div>\n\t\t\t\t<div model-curved-plane [item]="item" [view]="view" (play)="onPlayMedia($event)" (zoom)="onZoomMedia($event)" (down)="onObjectDown($event)" (currentTime)="onCurrentTimeMedia($event)" *if="item.type.name == \'curved-plane\'"></div>\n\t\t\t\t<div class="model-viewer__item" model-model [item]="item" [view]="view" (down)="onModelDown($event)" (play)="onPlayModel($event)" *if="item.type.name == \'model\'"></div>\n\t\t\t\t<div class="panel" [class]="{ \'panel--lg\': item.asset != null }" model-panel [item]="item" (down)="onPanelDown($event)" *if="item.showPanel"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="progress-indicator" model-progress [view]="view">\n\t\t<div class="inner"></div>\n\t</div>\n\t<div model-menu [views]="views" (nav)="onMenuNav($event)" (toggle)="onMenuToggle($event)" *if="showMenu"></div>\n\t<div model-debug *if="debugging"></div>\n\t<div class="world__info" *if="error" [innerHTML]="error"></div>\n\t'};class Go extends t.Component{set renderOrder(t){this.group.renderOrder=t}onInit(){if(!this.host)throw"ModelComponent host is undefined";this.scale=new THREE.Vector3(1,1,1),this.position=new THREE.Vector3;const t=this.group=new THREE.Group;t.name=this.getName(),t.userData.render=(t,e)=>{this.render(this,t,e)},this.getContainer().add(t),this.onCreate(((t,e)=>this.onMount(t,e)),((t,e)=>this.onDismount(t,e)))}onDestroy(){const t=this.group;this.getContainer().remove(t),delete t.userData.render,this.disposeObject(t),this.group=null}getContainer(){return this.host.objects}getName(t){return`${this.constructor.meta.selector}-${this.rxcompId}${t?`-${t}`:""}`}onCreate(t,e){const n=new THREE.MeshStandardMaterial({color:new THREE.Color("#ffcc00"),roughness:.4,metalness:.01,flatShading:!0,transparent:!0,opacity:.9}),i=new THREE.Mesh(wr.defaultGeometry,n);return"function"==typeof t&&t(i),i}onMount(t,e){this.mesh&&this.onDismount(this.mesh),t.name=this.getName("mesh"),this.mesh=t,e&&(e.mesh=t,Object.defineProperty(e,"visible",{get:()=>t.visible,set:t=>{this.setVisible(t)},configurable:!0}),e.onUpdate=()=>{this.onUpdate(e,t)},e.onUpdateAsset=()=>{this.onUpdateAsset(e,t)},e.onMessage=t=>{this.onMessage(t)}),this.group&&this.group.add(t)}onDismount(t,e){this.group.remove(t),"function"==typeof t.dispose&&t.dispose(),this.disposeObject(t),this.mesh=null,e&&(delete e.mesh,delete e.onUpdate,delete e.onUpdateAsset,delete e.onMessage)}disposeObject(t){t.traverse((t=>{(t.isInteractiveMesh||t.isInteractiveSprite)&&Tr.dispose(t),t.isMesh?(t.material.map&&!1!==t.material.map.disposable&&t.material.map.dispose(),t.material.dispose(),t.geometry.dispose()):t.isSprite&&(t.material.map&&!1!==t.material.map.disposable&&t.material.map.dispose(),t.material.dispose())}))}calculateScaleAndPosition(){const{node:e}=t.getContext(this);this.host.repos(this,e.getBoundingClientRect())}render(t,e){}setVisible(t){this.mesh&&(this.mesh.visible=t)}getScroll(t){return this.intersection.scroll(t)}getTween(t){let e=Math.min(0,this.intersection.offset(t))+1;return e=Math.max(0,e),e-=1,e}onUpdate(t,e){}onUpdateAsset(t,e){}onMessage(t){}}Go.meta={selector:"[model]",hosts:{host:jo},inputs:["item"]};class Qo extends Go{get editing(){return this.editing_}set editing(t){this.editing_!==t&&(this.editing_=t,this.setHelper(t))}onInit(){super.onInit(),this.RADIUS=100}onDestroy(){this.editing=!1,super.onDestroy()}setHelper(t){t?(this.helper||(this.helper=new THREE.BoxHelper(this.mesh,65280)),this.host.scene.add(this.helper)):this.helper&&this.host.scene.remove(this.helper)}updateHelper(){this.helper&&this.helper.setFromObject(this.mesh)}}Qo.meta={selector:"[model-editable]",hosts:{host:jo},inputs:["item"]};const zo="none",Wo="move",Ko="info",qo="point",Yo="title",$o="transparent",Xo="wishlist";class Jo extends Qo{constructor(){super(...arguments),this.hidden_=!1,this.isMobile_=void 0}static getLoader(){return Jo.loader||(Jo.loader=new THREE.TextureLoader)}static getTexturePoint(){return Jo.texturePoint||(Jo.texturePoint=Jo.getLoader().load(D.getPath("textures/ui/nav-point.png")))}static getTexturePointImportant(){return Jo.texturePointImportant||(Jo.texturePointImportant=Jo.getLoader().load(D.getPath("textures/ui/nav-point-important.png")))}static getTextureMove(){return Jo.textureMove||(Jo.textureMove=Jo.getLoader().load(D.getPath("textures/ui/nav-more.png")))}static getTextureMoveImportant(){return Jo.textureMoveImportant||(Jo.textureMoveImportant=Jo.getLoader().load(D.getPath("textures/ui/nav-more-important.png")))}static getTextureInfo(){return Jo.textureInfo||(Jo.textureInfo=Jo.getLoader().load(D.getPath("textures/ui/nav-info.png")))}static getTextureInfoImportant(){return Jo.textureInfoImportant||(Jo.textureInfoImportant=Jo.getLoader().load(D.getPath("textures/ui/nav-info-important.png")))}static getTextureWishlist(){return Jo.textureWishlist||(Jo.textureWishlist=Jo.getLoader().load(D.getPath("textures/ui/nav-wishlist-off.png")))}static getTextureWishlistAdded(){return Jo.textureWishlistAdded||(Jo.textureWishlistAdded=Jo.getLoader().load(D.getPath("textures/ui/nav-wishlist-on.png")))}static getTexture(t,e){let n;switch(t){case Wo:n=e.important?this.getTextureMoveImportant():this.getTextureMove();break;case Ko:n=e.important?this.getTextureInfoImportant():this.getTextureInfo();break;case qo:case Yo:n=e.important?this.getTexturePointImportant():this.getTexturePoint();break;case Xo:n=e.added?this.getTextureWishlistAdded():this.getTextureWishlist()}return n.disposable=!1,n.encoding=THREE.sRGBEncoding,n}static getTitleTexture(t,e){let n;if(e===Yo){const e=t.title,i=document.createElement("canvas");i.width=512,i.height=32;const r=i.getContext("2d");r.imageSmoothingEnabled=!0,r.imageSmoothingQuality="high",r.font=`24px ${D.fontFamily}`;let s=r.measureText(e).width+8;s=Math.pow(2,Math.ceil(Math.log(s)/Math.log(2)));const o=s/2,a=16;i.width=s,r.font=`24px ${D.fontFamily}`,r.textAlign="center",r.textBaseline="middle",r.strokeStyle="rgba(0, 0, 0, 0.5)",r.lineWidth=6,r.lineJoin="round",r.miterLimit=2,r.strokeText(e,o,a),r.fillStyle="white",r.fillText(e,o,a),n=new THREE.CanvasTexture(i)}return n}static getNavMode(t,e){let n=zo;return t.hook&&"ToggleWishlist"===t.hook?n=Xo:t.transparent?n=$o:t.viewId!==e.id?(n=Wo,this.isValidText(t.title)&&(n=Yo),(this.isValidText(t.abstract)||t.asset&&t.asset.id||t.link&&t.link.href)&&(n=qo)):(this.isValidText(t.title)||this.isValidText(t.abstract)||t.asset&&t.asset.id||t.link&&t.link.href)&&(n=Ko),n}static hasNavInfo(t){return null!=t.items.find((e=>this.getNavMode(e,t)===Ko))}static isValidText(t){return t&&t.length>0}get hidden(){return this.hidden_}set hidden(t){this.hidden_!==t&&(this.hidden_=t,this.updateVisibility(!t))}get isHidden(){return null!=ee.state.zoomedId||D.flags.hideNavInfo&&!this.host.editor&&!ee.state.showNavInfo&&!(this.host.renderer.xr.isPresenting||ee.state.role===ne.SelfService||ee.state.role===ne.Embed)&&this.mode===Ko}get isAnimated(){let t=!1;const e=this.mode,n=this.item.important;switch(e){case Ko:t=n?D.flags.navInfoImportantAnimated:D.flags.navInfoAnimated;break;case Wo:t=n?D.flags.navMoveImportantAnimated:D.flags.navMoveAnimated;break;case qo:t=n?D.flags.navPointImportantAnimated:D.flags.navPointAnimated;break;case Yo:t=n?D.flags.navTitleImportantAnimated:D.flags.navTitleAnimated;break;case $o:t=n?D.flags.navTransparentImportantAnimated:D.flags.navTransparentAnimated}return t}get iconMinScale(){return.03*(D.navs.iconMinScale||1)*(this.isMobile?1.6:1)}get iconMaxScale(){return.03*(D.navs.iconMaxScale||1.5)*(this.isMobile?1.6:1)}get isMobile(){return this.isMobile_}set isMobile(t){this.isMobile_!==t&&(this.isMobile_=t,this.setScale())}render(t,e){this.isMobile=this.host.worldRect.width<768}setScale(t){void 0===t&&(t=0);const e=this.icon;if(e){const n=this.iconMinScale+t*(this.iconMaxScale-this.iconMinScale);e.scale.set(n,n,n)}}shouldShowPanel(){return!this.editing&&this.mode!==Wo&&this.mode!==Yo&&this.mode!==Xo&&(this.mode!==$o||Jo.isValidText(this.item.title))}updateVisibility(t){this.mesh&&(this.mesh.visible=t),this.sphere&&(this.sphere.freezed=!t),!t&&this.item&&(this.item.showPanel=!1)}setVisible(t){this.mesh&&(this.mesh.visible=t&&!this.hidden_)}onInit(){super.onInit()}onChanges(){const t=this.view,e=this.item;(this.mode=Jo.getNavMode(e,this.view))===Xo&&(e.added=fr.has({viewId:t.id,itemId:e.id}),this.onCreateSprites(this.mesh,1)),this.editing=e.selected,this.hidden=this.isHidden}onCreate(t,e){const n=this.view,i=this.item,r=this.mode=Jo.getNavMode(i,this.view);if(r===zo)return;r===Xo&&(i.added=fr.has({viewId:n.id,itemId:i.id}));const s=this.isAnimated,o=new THREE.Group;if(r===$o){const t=this.host.editor?.1:0,e=.2,n=.3;o.position.fromArray(i.position),o.rotation.fromArray(i.rotation),o.scale.fromArray(i.scale);const r=wr.planeGeometry,a=this.plane=new Ir(r,new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,opacity:t,color:new THREE.Color(D.colors.menuOverBackground),toneMapped:!1}));if(a.name=`[nav] ${i.id}`,a.depthTest=!1,o.add(a),s){const t={pow:0};gsap.to(t,{pow:1,duration:.6,delay:.5+.1*i.index,ease:Power2.easeOut,repeat:-1,yoyo:!0,onUpdate:()=>{a.material.opacity=t.pow*n}})}a.on("over",(()=>{s||(a.material.opacity=e),this.over.next(this)})),a.on("out",(()=>{s||(a.material.opacity=t),this.out.next(this)})),a.on("down",(()=>{s||(a.material.opacity=n),this.down.next(this);const t=this.item.firstLink;!this.host.editor&&!this.shouldShowPanel()&&t&&t.href&&(this.shouldNavToLink=t.href),console.log("ModelNavComponent.down")})),a.on("up",(()=>{if(s||(a.material.opacity=t),null!=this.shouldNavToLink){this.shouldNavToLink=null;const t=this.item,e=t.firstLink;this.link.next({item:t,link:e})}}))}else{const t=new THREE.Vector3(i.position[0],i.position[1],i.position[2]),e=new THREE.Vector3(i.position[0],i.position[1],i.position[2]).normalize();t.distanceToSquared(e)<1e-4&&t.multiplyScalar(Jo.RADIUS),o.position.copy(t),this.onCreateSprites(o);const n=wr.sphereGeometry,r=this.sphere=new Ir(n,new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,opacity:0,color:65535,toneMapped:!1}));r.name=`[nav] ${i.id}`,r.depthTest=!1,o.add(r);const a={pow:0};gsap.to(a,{pow:1,duration:.7,delay:.5+.1*i.index,ease:Power2.easeInOut,overwrite:!0,onUpdate:()=>{this.materials.forEach((t=>{t.opacity=a.pow}))},onComplete:()=>{if(s){const t=this.icon;a.pow=0,gsap.to(a,{pow:1,duration:.6,delay:.5+.1*i.index,ease:Power2.easeOut,repeat:-1,yoyo:!0,onUpdate:()=>{this.setScale(a.pow),t.material.opacity=a.pow}})}}}),r.on("over",(()=>{if(this.over.next(this),!s){const t=this.icon,e={scale:t.scale.x};gsap.to(e,{duration:.35,scale:this.iconMaxScale,delay:0,ease:Power2.easeOut,overwrite:!0,onUpdate:()=>{t.scale.set(e.scale,e.scale,e.scale)}})}})),r.on("out",(()=>{if(this.out.next(this),!s){const t=this.icon,e={scale:t.scale.x};gsap.to(e,{duration:.35,scale:this.iconMinScale,delay:0,ease:Power2.easeOut,overwrite:!0,onUpdate:()=>{t.scale.set(e.scale,e.scale,e.scale)}})}})),r.on("down",(()=>{this.down.next(this)}))}"function"==typeof t&&t(o,i)}onCreateSprites(t,e){void 0===e&&(e=0),this.onRemoveSprite(this.icon),this.onRemoveSprite(this.title);const n=this.item,i=this.mode=Jo.getNavMode(n,this.view);if(i!==zo)if(i===$o)this.materials=[];else{const r=Jo.getTexture(i,n),s=new THREE.SpriteMaterial({map:r,depthTest:!1,depthWrite:!1,transparent:!0,sizeAttenuation:!1,opacity:e,toneMapped:!1}),o=[s],a=this.icon=new THREE.Sprite(s);let c;a.renderOrder=D.renderOrder.nav,this.setScale(),t.add(a);const l=Jo.getTitleTexture(n,i);if(l){c=new THREE.SpriteMaterial({depthTest:!1,depthWrite:!1,transparent:!0,map:l,sizeAttenuation:!1,opacity:e,toneMapped:!1});const n=l.image,i=this.title=new THREE.Sprite(c),r=this.iconMinScale;i.scale.set(r*n.width/n.height,r,r),i.position.set(0,-3.5,0),t.add(i),o.push(c)}this.materials=o}}onRemoveSprite(t){t&&(t.parent&&t.parent.remove(t),t.material.map&&!1!==t.material.map.disposable&&t.material.map.dispose(),t.material.dispose())}onDestroy(){Tr.dispose(this.sphere),super.onDestroy()}onUpdate(t,e){this.item=t,this.onCreateSprites(e,1),this.mode===$o?(t.position&&e.position.fromArray(t.position),t.rotation&&e.rotation.fromArray(t.rotation),t.scale&&e.scale.fromArray(t.scale)):(e.position.fromArray(t.position),e.rotation.set(0,0,0),e.scale.set(1,1,1)),this.updateHelper()}onDragMove(t,e,n){const i=this.item,r=this.mesh;this.editing=!0,i.showPanel=!1,this.mode===$o?n?(t.normalize().multiplyScalar(Jo.RADIUS),r.position.set(t.x,t.y,t.z),r.lookAt(Sr.origin)):(r.position.set(0,0,0),r.lookAt(e),r.position.set(t.x,t.y,t.z),r.position.add(e.multiplyScalar(.01))):n?(t.normalize().multiplyScalar(Jo.RADIUS),r.position.set(t.x,t.y,t.z)):(r.position.set(t.x,t.y,t.z),r.position.add(e.multiplyScalar(.01))),this.updateHelper()}onDragEnd(){const t=this.item,e=this.mesh;this.mode===$o?(t.position=e.position.toArray(),t.rotation=e.rotation.toArray(),t.scale=e.scale.toArray()):t.position=e.position.toArray(),this.editing=!1}}Jo.RADIUS=100,Jo.meta={selector:"[model-nav]",hosts:{host:jo},outputs:["over","out","down","link"],inputs:["item","view"]};class Zo extends t.Component{get meetingUrl(){return this.meetingUrl_||(this.meetingUrl_=new oe),this.meetingUrl_}get isVirtualTourUser(){return-1!==[ne.Publisher,ne.Attendee,ne.Streamer,ne.Viewer].indexOf(ee.state.role)}get isEmbed(){return this.route&&"embed"===this.route.params.mode}get isSelfServiceTour(){return this.route&&"selfServiceTour"===this.route.params.mode}get isNavigable(){return null==this.meetingUrl.embedViewId}get isBackButtonVisible(){return this.view&&(this.view.type.name===mi.Media.name||this.view.type.name===mi.Model.name)}get isSelfServiceProposition(){return ee.state.role===ne.SelfService&&D.flags.selfServiceProposition}get isSelfServiceSupport(){return ee.state.role===ne.Publisher&&D.flags.selfServiceProposition&&this.meetingUrl.support}get showNavInfoToggler(){return D.flags.hideNavInfo&&this.state.mode!==dn&&this.view&&Jo.hasNavInfo(this.view)}get uiClass(){const t={};return t[this.state.role]=!0,t.chat=this.state.chat,t.remotes=this.state.mode===dn,t.remoteScreen=null!=this.remoteScreen&&!this.hasScreenViewItem,t.locked=this.locked,t}get remoteClass(){return`group--remote--${Math.min(9,this.remotes.length)}`}get controlled(){return ee.state.controlling&&ee.state.controlling!==ee.state.uid}get controlling(){return ee.state.controlling&&ee.state.controlling===ee.state.uid}get silencing(){return ee.state.silencing}get silenced(){return ee.state.silencing&&ee.state.role===ne.Streamer}get spyed(){return ee.state.spying&&ee.state.spying===ee.state.uid}get spying(){return ee.state.spying&&ee.state.spying!==ee.state.uid}get locked(){return this.controlled||this.spying}get remoteScreen(){return this.remoteScreen_}set remoteScreen(t){this.remoteScreen_!==t&&(this.remoteScreen_=t,setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),1))}get pathViews(){return Ar.pathViews}onInit(){const{node:e}=t.getContext(this);e.classList.remove("hidden"),this.platform=jn.platform,this.route=this.host?this.host.route:null,this.state={},this.hosted=null,this.view=null,this.previousView=null,this.form=null,this.local=null,this.screen=null,this.remoteScreen_=null,this.navmaps=[],this.navmap=null,this.hasScreenViewItem=!1,this.remotes=[];(this.vrService=Ts.getService()).status$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.pushChanges())),this.resolveUser()}getName(t){return ee.state.name||oe.getName(t)}getLinkRole(){let t=null;if(this.isSelfServiceTour)return t=ne.SelfService,t;const e=((new oe).link||"").match(/\d{9}-(\d{4})-\d{13}/);if(e){const n=parseInt(e[1]);t=Object.keys(ne).reduce(((t,e,i)=>i===n?ne[e]:t),null)}return t}resolveUser(){this.isEmbed?Tn.temporaryUser$(ne.Embed).pipe(i.first()).subscribe((t=>{this.initWithUser(t)})):this.isSelfServiceTour?Tn.overrideUser$(ne.SelfService).pipe(i.first()).subscribe((t=>{this.initWithUser(t)})):Tn.me$().pipe(i.first()).subscribe((t=>{this.initWithUser(t)}))}userGuard(t){const e=this.getLinkRole();!t||e&&t.type!==e?this.initWithUser({type:e}):this.initWithUser(t)}userGuardRedirect(t){const e=this.getLinkRole();!t||e&&e!==t.type?e===ne.Publisher||e===ne.Attendee?te.setRouterLink(ve.transform(":lang.access")):this.initWithUser({type:e}):this.initWithUser(t)}setNextStatus(){let t=be;const e=ee.state;return e.role===ne.SmartDevice&&(e.name=e.name||"Smart Device"),t=e.checklist?e.link?e.user.id||e.role!==ne.Publisher&&e.role!==ne.Attendee?e.name?e.role!==ne.Viewer&&e.role!==ne.SmartDevice?Ce:Re:Te:Se:we:Ee,ee.patchState({status:t}),t}getPathId(){const t=new oe;let e=t.pathId;if(e)return parseInt(e);const n=t.link;if(n){e=new se(n).pathId}return e}initWithUser(t){const e=(new oe).link,n=this.getPathId(),r=this.getLinkRole()||(t?t.type:null);if(r===ne.SelfService){if(!t||t.type!==ne.SelfService&&t.type!==ne.Publisher)return void te.setRouterLink(ve.transform(":lang.access"));t=Object.assign({},t,{type:ne.SelfService})}else r!==(t=t||{type:r}).type&&(t={type:r});const s=Tn.getMode(r),o=this.getMeetingName(t),a=r===ne.Publisher,c=r!==ne.SelfService&&r!==ne.Embed&&!C,l=this.isNavigable,u={user:t,role:r,mode:s,name:o,checklist:null,pathId:n,link:e,channelName:D.channelName,uid:null,status:be,connecting:!1,connected:!1,controlling:!1,spying:!1,silencing:!1,hosted:a,live:c,navigable:l,cameraMuted:!1,audioMuted:!1,showNavInfo:!0};ee.state=u,ee.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.state=t,this.hosted=t.hosted,this.pushChanges(),this.locked?document.body.classList.add("locked"):document.body.classList.remove("locked")})),this.initAgora()}getMeetingName(t){const e=new oe;let n=null;return n=D.flags.useExtendedUserInfo?e.firstName&&e.lastName?`${e.firstName} ${e.lastName}`:null:e.name?e.name:null,!n&&t.firstName&&t.lastName&&(n=`${t.firstName} ${t.lastName}`),n}viewObserver$(){return Ar.data$().pipe(i.switchMap((t=>Ni.getCurrentPath$(ee.state.pathId).pipe(i.switchMap((e=>Ar.hostedView$(t,e)))))),i.map((t=>{this.agora&&this.agora.navToView(t.id,t.keepOrientation,t.useLastOrientation),this.previousView=this.view,this.view=t,this.setNavmap(t),this.hasScreenViewItem=null!=t.items.find((t=>Er.isPublisherScreen(t)||Er.isAttendeeScreen(t))),this.pushChanges();const e=this.state;return ji.push({action:"b-here-view",viewId:t.id,userType:e.role}),t})))}load(t){this.loadNavmaps(),this.viewObserver$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((e=>{"function"==typeof t&&(t(),t=null)}))}loadNavmaps(){D.flags.navmaps&&Vi.navmapGet$().pipe(i.first()).subscribe((t=>{this.navmaps=t}))}setNavmap(t){const e=(this.navmaps||[]).find((e=>null!=(e.items||[]).find((e=>e.viewId===t.id))))||null;this.navmap=e}toggleNavmap(){ee.patchState({showNavmap:!ee.state.showNavmap})}onNavmapItem(t){ee.patchState({showNavmap:!1}),this.onNavTo(t)}loadAndConnect(t){this.load((()=>{this.connect(t)}))}initAgora(){this.state.role===ne.SelfService||this.state.role===ne.Embed||C?(this.load((()=>{ee.patchState({status:xe,hosted:!0})})),this.checkSelfServiceProposition(),this.checkSelfServiceAudio()):ui.isChecked$().pipe(i.first()).subscribe((t=>{ee.patchState({checklist:t}),this.agora=ti.getSingleton(),this.getLinkRole(),this.setNextStatus()})),Zn.local$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.local=t,this.pushChanges()})),Zn.screen$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.screen===this.remoteScreen&&(this.remoteScreen=null),this.screen=t,this.remoteScreen=t||this.remoteScreen,this.pushChanges()})),Zn.orderedRemotes$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.remotes=[],this.remoteScreen=this.screen,t.forEach((t=>{t.clientInfo&&t.clientInfo.screenUid===t.streamId?this.remoteScreen=t:this.remotes.push(t)})),this.pushChanges()})),Mn.out$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{switch(t.type){case Me:if(this.isSelfServiceSupport){t.members.length>0?(Xi.open$({message:fe.transform("bhere_support_request_sent"),type:Qi,position:Ki}),Mn.send({type:nn})):Xi.open$({message:fe.transform("bhere_support_request_leaved"),type:Qi,position:Ki})}break;case nn:this.isSelfServiceProposition&&this.openSupportRequestDialog(t.clientInfo);break;case rn:Xi.open$({message:fe.transform("bhere_support_request_accepted"),type:Qi,position:Ki});break;case sn:Xi.open$({message:fe.transform("bhere_support_request_rejected"),type:Qi,position:Ki});break;case Ke:ee.patchState({silencing:t.silencing}),this.setAudio(t.silencing);break;case Qe:this.onRemoteNavTo(t);break;case Fe:ee.patchState({mode:t.mode}),window.dispatchEvent(new Event("resize"));break;case He:this.hidePanels(),ee.patchState({showNavInfo:t.showNavInfo});break;case Oe:Ar.setViewLike$(t).pipe(i.first()).subscribe((t=>this.showLove(t)));break;case ke:ee.state.chat||ee.patchState({chatDirty:!0})}})),Mn.in$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.agora&&this.agora.sendMessage(t)})),this.fullscreen$().pipe(i.takeUntil(this.unsubscribe$)).subscribe(),this.agora&&ee.state.status===Re&&this.loadAndConnect()}onChecked(t){ee.patchState({checklist:!0}),this.setNextStatus()}onLink(t){const e=new se(t).pathId,n=this.getLinkRole(),i=Tn.getMode(n),r=ee.state.user;n!==ne.Publisher&&n!==ne.Attendee||r.id&&r.type===n?ee.state.name?n===ne.Viewer||n===ne.SmartDevice?(ee.patchState({link:t,pathId:e,role:n,mode:i}),this.loadAndConnect()):ee.patchState({link:t,pathId:e,role:n,mode:i,status:Ce}):ee.patchState({link:t,pathId:e,role:n,mode:i,status:Te}):ee.patchState({link:t,pathId:e,role:n,mode:i,status:Se})}onLogin(t){const e=this.getName(t);e?ee.patchState({user:t,name:e,status:Ce}):ee.patchState({user:t,status:Te})}onName(t){ee.state.role===ne.Viewer||ee.state.role===ne.SmartDevice?(ee.patchState({name:t}),this.loadAndConnect()):ee.patchState({name:t,status:Ce})}onEnter(t){this.loadAndConnect(t)}connect(t){this.agora.connect$(t).pipe(i.takeUntil(this.unsubscribe$)).subscribe();const e=this.state;if(e.role===ne.SelfService)ji.push({action:"b-here-tour",userType:e.role});else if(e.role===ne.Embed)ji.push({action:"b-here-embed",userType:e.role});else{const t=new oe,n=e.link.replace(/-\d+-/,"-"),r={meetingId:e.link,sharedMeetingId:n,userType:e.role};D.flags.useExtendedUserInfo?(r.firstName=t.firstName,r.lastName=t.lastName,r.email=t.email):r.fullName=e.name,Tn.log$(r).pipe(i.first()).subscribe(),ji.push({action:"b-here-meeting",meetingId:e.link,sharedMeetingId:n,userType:e.role})}}disconnect(){this.agora?this.agora.leaveChannel().then((()=>{window.location.reload()}),console.log):this.patchState({connecting:!1,connected:!1})}onNavTo(t){const e=t.viewId,n=this.pathViews.find((t=>t.id===e));n&&(Ar.action={viewId:e,keepOrientation:t.keepOrientation,useLastOrientation:t.useLastOrientation},this.onHandleHook(n,t))}onNavLink(t){ai.open$({iframe:t.link.href}).pipe(i.first()).subscribe((e=>{Mn.send({type:je,itemId:t.item.id})}))}onRemoteNavTo(t){const e=t.viewId,n=t.gridIndex;if(e&&Ar.viewId!==e){const i=this.pathViews.find((t=>t.id===e));i&&(Ar.action={viewId:e,keepOrientation:t.keepOrientation,useLastOrientation:t.useLastOrientation},null!=n&&i instanceof _i&&(i.index=n))}}onHandleHook(t,e){switch(e.hook){case"ToggleWishlist":{const n={viewId:t.id,itemId:e.id};fr.toggle$(n).pipe(i.switchMap((t=>(n.added=fr.has(n),In.send$(e.hook,n,e.extra)))),i.first()).subscribe((t=>{qn.log("AgoraComponent.onHandleHook",t),e.added=n.added,this.pushChanges()}));break}}}patchState(t){this.state=Object.assign({},this.state,t),this.pushChanges()}toggleCamera(){this.agora?this.agora.toggleCamera():this.patchState({cameraMuted:!this.state.cameraMuted})}toggleAudio(){this.agora?this.agora.toggleAudio():this.patchState({audioMuted:!this.state.audioMuted})}setAudio(t){this.agora?this.agora.setAudio(t):this.patchState({audioMuted:t})}toggleScreen(){this.agora?this.agora.toggleScreen():this.patchState({screen:!this.state.screen}),window.dispatchEvent(new Event("resize"))}toggleVolume(){const t=!this.state.volumeMuted;ee.patchState({volumeMuted:t});const e=this.selfServiceAudio;e&&(e.volume=t?0:.5)}toggleMode(){if(this.agora&&ee.state.role===ne.Publisher)this.agora.toggleMode();else{const t=this.state.mode===un?dn:un;ee.patchState({mode:t})}window.dispatchEvent(new Event("resize"))}toggleFullScreen(){const{node:e}=t.getContext(this);!this.state.fullScreen?e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}fullscreen$(){return n.fromEvent(document,"fullscreenchange").pipe(i.tap((t=>{const e=null!=document.fullscreenElement;ee.patchState({fullScreen:e})})))}toggleChat(){ee.patchState({chat:!ee.state.chat,chatDirty:!1}),window.dispatchEvent(new Event("resize"))}onChatClose(){ee.patchState({chat:!1}),window.dispatchEvent(new Event("resize"))}toggleNavInfo(){this.hidePanels(),this.agora?this.agora.toggleNavInfo():this.patchState({showNavInfo:!this.state.showNavInfo})}onBack(){this.previousView&&this.view&&this.previousView.id!==this.view.id&&(Ar.action={viewId:this.previousView.id,useLastOrientation:!0})}hidePanels(){this.view.items.forEach((t=>t.showPanel=!1))}onToggleControl(t){if(this.agora)this.agora.toggleControl(t);else{const e=this.state.controlling===t?null:t;this.patchState({controlling:e,spying:!1})}}onToggleSilence(){this.agora?this.agora.toggleSilence():this.patchState({silencing:!this.state.silencing})}onToggleSpy(t){if(this.agora)this.agora.toggleSpy(t);else{const e=this.state.spying===t?null:t;this.patchState({spying:e,controlling:!1})}}addLike(){Ar.viewLike$(this.view).pipe(i.first()).subscribe((t=>{t&&(this.view.liked=!0,this.showLove(t),Mn.send({type:Oe,viewId:this.view.id,likes:this.view.likes}))}))}showLove(t){if(t&&this.view.id===t.id){const e=this.view.showLove;this.view.likes=t.likes,this.view.showLove=!0,this.pushChanges(),e||setTimeout((()=>{this.view.showLove=!1,this.pushChanges()}),3100)}}tryInAr(){this.platform===Un||this.platform===Fn?Zi.openInAR(this.view):ai.open$({template:Zi.chunk(),data:this.view}).pipe(i.first()).subscribe((t=>{}))}checkSelfServiceProposition(){this.isSelfServiceProposition&&ui.check$().pipe(i.first()).subscribe((t=>{const e=new se({pathId:ee.state.pathId}).toRoles(),n=new oe({link:e.id,support:!0}),r=window.location.origin+n.toGuidedTourUrl();qn.log("AgoraComponent.checkSelfServiceProposition",r),Tn.selfServiceSupportRequest$(ee.state.user,e.id,r).pipe(i.first()).subscribe((t=>{const n=this.getName(ee.state.user);ee.patchState({checklist:!0,link:e.idSelfService,name:n}),this.agora=ti.getSingleton(),this.connect()}))}),(t=>{qn.error("AgoraComponent.checkSelfServiceProposition.error",t)}))}checkSelfServiceAudio(){if(ee.state.role===ne.SelfService&&D.selfServiceAudio){const e=document.createElement("audio");e.setAttribute("playsinline","true"),e.setAttribute("autoplay","true"),e.setAttribute("loop","true"),e.volume=.5,e.src=D.getPath(D.selfServiceAudio);const{node:n}=t.getContext(this);n.parentNode.appendChild(e),this.selfServiceAudio=e,Er.events$.pipe(i.tap((t=>{t instanceof gr?e.pause():(t instanceof vr||t instanceof yr)&&e.play()})),i.takeUntil(this.unsubscribe$)).subscribe()}}openSupportRequestDialog(t){Xi.open$({message:fe.transform("bhere_support_request_dialog"),acceptMessage:fe.transform("bhere_support_request_dialog_accept"),rejectMessage:fe.transform("bhere_support_request_dialog_reject"),type:zi,position:Ki}).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{if(t instanceof Yi){Mn.send({type:rn});const t=ee.state.name,e=new se(ee.state.link);e.role=ne.Streamer;const n={link:e.toString()};if(D.flags.useExtendedUserInfo){const t=ee.state.user;n.firstName=t.firstName,n.lastName=t.lastName,n.email=t.email}else n.name=t;const i=new oe(n).toGuidedTourUrl();setTimeout((()=>{window.location.href=i}),1e3)}else Mn.send({type:sn})}))}}Zo.meta={selector:"[agora-component]",hosts:{host:ae},template:`\n\t<div class="page page--agora">\n\t\t${m}\n\t\t\x3c!-- Status Checklist --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'checklist'" [agora-checklist] (checked)="onChecked($event)"></div>\n\t\t\x3c!-- Status Link --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'link'" [agora-link] (link)="onLink($event)"></div>\n\t\t\x3c!-- Status Login --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'login'" [agora-login] (login)="onLogin($event)"></div>\n\t\t\x3c!-- Status Name --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'name' || (state.status == 'disconnected' && state.role === 'viewer')" [agora-name] (name)="onName($event)"></div>\n\t\t\x3c!-- Status Device --\x3e\n\t\t<div class="ui ui--info" *if="state.status == 'device' || (state.status == 'disconnected' && state.role !== 'viewer')" [agora-device] (enter)="onEnter($event)"></div>\n\t\t${b}\n\t\t\n\x3c!-- Smart Device --\x3e\n<div class="ui remotes" [class]="uiClass" *if="state.status == 'connected' && state.role == 'smart-device'">\n\t<div class="ui__body"></div>\n\t\x3c!-- remote sidebar --\x3e\n\t<div class="group--remote" [class]="'group--remote--' + remotes.length" *if="state.live">\n\t\t<div class="agora-stream" (toggleSpy)="onToggleSpy($event)" agora-stream [stream]="remote" type="remote" *for="let remote of remotes">\n\t\t\t<div class="agora-stream__player"></div>\n\t\t\t<div class="agora-stream__info">\n\t\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t<div class="id" [innerHTML]="stream.clientInfo.name || streamId" *if="stream.clientInfo"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t\x3c!-- remote screen --\x3e\n\t<div class="group--remote-screen" *if="remoteScreen && !hasScreenViewItem">\n\t\t<div class="agora-stream" agora-stream [stream]="remoteScreen" type="remote">\n\t\t\t<div class="agora-stream__player"></div>\n\t\t\t<div class="agora-stream__info">\n\t\t\t\t<div class="id" [innerHTML]="stream.clientInfo.name || streamId" *if="stream.clientInfo"></div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n\t<div class="group--header">\n\t\t\n\x3c!-- local streams --\x3e\n<div class="group--local" [class]="{ publisher: state.role == 'publisher', viewer: state.role == 'viewer' }" *if="state.live">\n\t<div class="agora-stream" agora-stream [stream]="local" type="local" *if="local">\n\t\t<div class="agora-stream__player"></div>\n\t\t<div class="agora-stream__info">\n\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t</div>\n\t</div>\n</div>\n\n\t</div>\n\t<div class="group--footer">\n\t\t\n\x3c!-- controls --\x3e\n<div class="group--controls" *if="state.live">\n\t<div class="group--actions">\n\t\t<button type="button" class="btn--call" [title]="'title_disconnect' | label" (click)="disconnect()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#call"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--cam" [title]="'title_mute_camera' | label" [class]="{ muted: state.cameraMuted, disabled: !local }" (click)="toggleCamera()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam"></use></svg>\n\t\t</button>\n\t\t<button type="button" class="btn--mic" [title]="'title_mute_mic' | label" [class]="{ muted: state.audioMuted, disabled: !local || silenced }" (click)="toggleAudio()">\n\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic"></use></svg>\n\t\t</button>\n\t</div>\n</div>\n\n\t</div>\n\t\n\x3c!-- members --\x3e\n<div class="group--members">\n\t<div class="members" *if="state.role === 'publisher'">\n\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t</div>\n\t<div class="credits">\n\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t</a>\n\t</div>\n</div>\n\n</div>\n\n\t\t${E}\n\t\t${w}\n\t\t<header>\n\t\t\t${g}\n\t\t\t${_}\n\t\t</header>\n\t\t<footer *if="state.status != 'connected'">\n\t\t\t<span class="group--colophon">\n\t\t\t\t${v}\n\t\t\t\t${y}\n\t\t\t</span>\n\t\t\t<a [routerLink]="':lang.editor' | route" class="btn--absolute" *if="('editor' | flag) && !('deployed' | flag) && state.role == 'publisher' && (state.status == 'checklist' || state.status == 'link')">\n\t\t\t\t<span [innerHTML]="'bhere_editor' | label"></span> <svg class="edit" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#edit"></use></svg>\n\t\t\t</a>\n\t\t</footer>\n\t</div>\n\t`};class ta{static assetCreate$(t){return Sn.post$("/api/asset",t).pipe(i.map((t=>dr(t))))}static assetUpdate$(t){return Sn.put$(`/api/asset/${t.id}`,t).pipe(i.map((t=>dr(t))))}static assetDelete$(t){return t&&t.id?Sn.delete$(`/api/asset/${t.id}`).pipe(i.map((()=>null))):n.of(null)}static localizedAssetCreate$(t,e){return Sn.post$(`/api/${t}/asset`,e).pipe(i.map((t=>dr(t))))}static localizedAssetUpdate$(t,e){return Sn.put$(`/api/${t}/asset/${e.id}`,e).pipe(i.map((t=>dr(t))))}static upload$(t){const e=new FormData;t.forEach((t=>e.append("file",t,t.name)));const r=new XMLHttpRequest,s=n.merge(n.fromEvent(r.upload,"loadstart"),n.fromEvent(r.upload,"progress"),n.fromEvent(r.upload,"load"),n.fromEvent(r,"readystatechange")).pipe(i.map((t=>"readystatechange"===t.type&&4===r.readyState?JSON.parse(r.responseText):null)),i.filter((t=>null!==t)));return r.open("POST","/api/upload/",!0),r.send(e),s}static createOrUpdateAsset$(t,e){const n=t[0],i=ur.fromUrl(n.url);return e.value&&e.value.id?(i.id=e.value.id,ta.assetUpdate$(i)):ta.assetCreate$(i)}static createOrUpdateLocalizedAsset$(t,e,n){const i=t[0],r=ur.fromUrl(i.url);return e.value&&e.value.id?(r.id=e.value.id,ta.localizedAssetUpdate$(n,r)):ta.localizedAssetCreate$(n,r)}static assetDidChange(t,e){let n=null,i=null,r=null,s=null;return t&&(n=t.id,i=t.file),e&&(r=e.id,s=e.file),n!==r||i!==s}}class ea{static data$(){return this.data$_||(this.data$_=Sn.get$("/api/view").pipe(i.map((t=>(t.views=t.views.map((t=>Ri(t))),t))),i.shareReplay(1))),this.data$_}static viewIdOptions$(){return this.data$().pipe(i.map((t=>{const e=t.views.filter((t=>t.type.name!==mi.WaitingRoom.name)).map((t=>({id:t.id,name:t.name})));return e.unshift({id:null,name:"select"}),e})))}static viewCreate$(t){return Sn.post$("/api/view",t).pipe(i.map((t=>Ri(t))))}static viewUpdate$(t){return Sn.put$(`/api/view/${t.id}`,t.payload).pipe(i.map((t=>Ri(t))))}static viewDelete$(t){return Sn.delete$(`/api/view/${t.id}`)}static getTile(t){let e;return t.type.name===mi.PanoramaGrid.name&&(e=t.tiles[t.index]),e}static inferItemCreate$(t,e){const n=this.getTile(t);return n?this.tileItemCreate$(t,n,e):this.itemCreate$(t,e)}static inferItemUpdate$(t,e){const n=this.getTile(t);return n?this.tileItemUpdate$(t,n,e):this.itemUpdate$(t,e)}static inferItemDelete$(t,e){const n=this.getTile(t);return n?this.tileItemDelete$(t,n,e):this.itemDelete$(t,e)}static inferItemUpdateResult$(t,e){const n=this.getTile(t);let i;i=n?n.navs.find((t=>t.id===e.id)):t.items.find((t=>t.id===e.id)),i&&Object.assign(i,e)}static inferItemDeleteResult$(t,e){const n=this.getTile(t);let i;if(i=n?n.navs:t.items,i){const r=i.indexOf(e);-1!==r&&i.splice(r,1),n&&t.updateCurrentItems()}}static itemCreate$(t,e){return Sn.post$(`/api/view/${t.id}/item`,e).pipe(i.map((t=>Ii(t))))}static itemUpdate$(t,e){return Sn.put$(`/api/view/${t.id}/item/${e.id}`,e.payload).pipe(i.map((t=>Ii(t))))}static itemDelete$(t,e){return Sn.delete$(`/api/view/${t.id}/item/${e.id}`)}static tileItemCreate$(t,e,n){return Sn.post$(`/api/view/${t.id}/tile/${e.id}/item`,n).pipe(i.map((t=>Ii(t))))}static tileItemUpdate$(t,e,n){return Sn.put$(`/api/view/${t.id}/tile/${e.id}/item/${n.id}`,n.payload).pipe(i.map((t=>Ii(t))))}static tileItemDelete$(t,e,n){return Sn.delete$(`/api/view/${t.id}/tile/${e.id}/item/${n.id}`)}}class na extends t.Component{get data(){let e=null;const{parentInstance:n}=t.getContext(this);return n instanceof Ji&&(e=n.modal.data),e}get view(){let t=null;const e=this.data;return e&&(t=e.view),t}get object(){const t=new THREE.Object3D,e=this.data;if(e){const n=e.hit.position.clone(),i=e.hit.normal.clone();e.hit.spherical?(n.normalize().multiplyScalar(20),t.position.copy(n),t.lookAt(Sr.origin)):(t.lookAt(i),t.position.set(n.x,n.y,n.z),t.position.add(i.multiplyScalar(.01)))}return t}onInit(){const t=this.object,n=this.form=new e.FormGroup({type:gi.CurvedPlane,position:new e.FormControl(t.position.toArray(),e.RequiredValidator()),rotation:new e.FormControl(t.rotation.toArray(),e.RequiredValidator()),scale:new e.FormControl([1,1,1],e.RequiredValidator()),radius:new e.FormControl(35,e.RequiredValidator()),height:new e.FormControl(20,e.RequiredValidator()),arc:new e.FormControl(90,e.RequiredValidator()),asset:null});this.controls=n.controls,n.changes$.subscribe((t=>{this.pushChanges()}))}onSubmit(){if(this.form.valid){const t=Object.assign({},this.form.value);ea.inferItemCreate$(this.view,t).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>console.log("CurvedPlaneModalComponent.onSubmit.error",t)))}else this.form.touched=!0}onClose(){ai.reject()}}na.meta={selector:"[curved-plane-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Curved Plane.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t\x3c!-- <div control-text [control]="controls.title" label="Title"></div> --\x3e\n\t\t\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" [disabled]="true"></div>\n\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-number [control]="controls.radius" label="Radius" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-number [control]="controls.height" label="Height" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-number [control]="controls.arc" label="Arc" [precision]="0" [disabled]="true"></div>\n\t\t\t\t\t\t--\x3e\n\t\t\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},na.chunk=()=>'<div class="curved-plane-modal" curved-plane-modal></div>';class ia extends t.Component{get data(){let e=null;const{parentInstance:n}=t.getContext(this);return n instanceof Ji&&(e=n.modal.data),e}get view(){let t=null;const e=this.data;return e&&(t=e.view),t}get object(){const t=new THREE.Object3D,e=this.data;if(e){const n=e.hit.position.clone(),i=e.hit.normal.clone();e.hit.spherical?(n.normalize().multiplyScalar(4),t.position.copy(n),t.lookAt(Sr.origin)):(t.lookAt(i),t.position.set(n.x,n.y,n.z),t.position.add(i.multiplyScalar(.01)))}return t}onInit(){const t=this.object,n=this.form=new e.FormGroup({type:gi.Model,position:new e.FormControl(t.position.toArray(),e.RequiredValidator()),rotation:new e.FormControl([0,0,0],e.RequiredValidator()),scale:new e.FormControl([1,1,1],e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((t=>{this.pushChanges()}))}onSubmit(){if(this.form.valid){const t=Object.assign({},this.form.value);ea.inferItemCreate$(this.view,t).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>console.log("ItemModelModalComponent.onSubmit.error",t)))}else this.form.touched=!0}onClose(){ai.reject()}}ia.meta={selector:"[item-model-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Model Item.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-model [control]="controls.asset" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},ia.chunk=()=>'<div class="item-model-modal" item-model-modal></div>';class ra extends t.Component{onInit(){this.error=null;const t=this.form=new e.FormGroup({type:mi.Media,name:new e.FormControl(null,e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator())});this.controls=t.controls,t.changes$.subscribe((t=>{this.pushChanges()}))}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=this.form.value,e={type:t.type,name:t.name,asset:t.asset,orientation:{latitude:0,longitude:0},zoom:75};return ea.viewCreate$(e).pipe(i.switchMap((e=>{const n={type:gi.Plane,position:[20,0,0],rotation:[0,-Math.PI/2,0],scale:[12,6.75,1],asset:t.asset};return ea.itemCreate$(e,n).pipe(i.map((t=>(e.items=[t],e))))})),i.first()).subscribe((t=>{ai.resolve(t)}),(t=>{console.log("MediaModalComponent.onSubmit.error",t),this.error=t,this.form.reset()}))}this.form.touched=!0}onClose(){ai.reject()}}ra.meta={selector:"[media-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Media.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},ra.chunk=()=>'<div class="media-modal" media-modal></div>';class sa extends t.Component{onInit(){this.error=null;const t=this.form=new e.FormGroup({type:mi.Model,name:new e.FormControl(null,e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator()),model:new e.FormControl(null,e.RequiredValidator())});this.controls=t.controls,t.changes$.subscribe((t=>{this.pushChanges()}))}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=this.form.value,e={type:t.type,name:t.name,asset:t.asset,orientation:{latitude:0,longitude:0},zoom:75};return ea.viewCreate$(e).pipe(i.switchMap((e=>{const n={type:gi.Model,asset:t.model};return ea.itemCreate$(e,n).pipe(i.map((t=>(e.items=[t],e))))})),i.first()).subscribe((t=>{ai.resolve(t)}),(t=>{console.log("ModelModalComponent.onSubmit.error",t),this.error=t,this.form.reset()}))}this.form.touched=!0}onClose(){ai.reject()}}sa.meta={selector:"[model-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Model View.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg"></div>\n\t\t\t\t\t\t<div control-model [control]="controls.model" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},sa.chunk=()=>'<div class="model-modal" model-modal></div>';class oa extends t.Component{get data(){let e=null;const{parentInstance:n}=t.getContext(this);return n instanceof Ji&&(e=n.modal.data),e}get view(){let t=null;const e=this.data;return e&&(t=e.view),t}get position(){let t=null;const e=this.data;return e&&(t=e.hit.position),t}get object(){const t=new THREE.Object3D,e=this.data;if(e){const n=e.hit.position.clone(),i=e.hit.normal.clone();e.hit.spherical?(n.normalize().multiplyScalar(Jo.RADIUS),t.position.copy(n),t.lookAt(Sr.origin)):(t.lookAt(i),t.position.set(n.x,n.y,n.z),t.position.add(i.multiplyScalar(.01)))}return t}onInit(){const t=this.object;this.error=null,this.useHooks=In.enabled;const n=this.form=new e.FormGroup({type:gi.Nav,title:null,abstract:null,viewId:null,hook:null,hookExtra:null,keepOrientation:!1,important:!1,transparent:!1,position:new e.FormControl(t.position.toArray(),e.RequiredValidator()),rotation:new e.FormControl(t.rotation.toArray(),e.RequiredValidator()),scale:new e.FormControl([20,5,1],e.RequiredValidator()),asset:null,link:new e.FormGroup({title:new e.FormControl(null),href:new e.FormControl(null),target:"_blank"})});if(this.controls=n.controls,In.enabled){const t=D.webhook.methods.nav.map((t=>({id:t,name:t})));t.unshift({id:null,name:"select"}),this.controls.hook.options=t}n.changes$.subscribe((t=>{this.pushChanges()})),ea.viewIdOptions$().pipe(i.first()).subscribe((t=>{this.controls.viewId.options=t,this.pushChanges()}))}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=Object.assign({},this.form.value);t.viewId=t.viewId?parseInt(t.viewId):this.view.id,!t.link||t.link.title&&t.link.href||(t.link=null),ea.inferItemCreate$(this.view,t).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>{console.log("NavModalComponent.onSubmit.error",t),this.error=t,this.form.submitted=!1}))}else this.form.touched=!0}onViewIdDidChange(t){if(null!=t&&D.flags.navAutoUpdateTitle){const e=this.controls.viewId.options,n=e.find((e=>e.id===t));if(null!=n){const t=n.name,i=this.form.value.title;i&&!e.find((t=>t.name===i))||this.form.patch({title:t})}}}onClose(){ai.reject()}}oa.meta={selector:"[nav-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Nav.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.title" label="Title"></div>\n\t\t\t\t\t\t<div control-textarea [control]="controls.abstract" label="Abstract"></div>\n\t\t\t\t\t\t<div control-custom-select [control]="controls.viewId" label="NavToView" (change)="onViewIdDidChange($event)"></div>\n\t\t\t\t\t\t<div control-checkbox [control]="controls.keepOrientation" label="Keep Orientation"></div>\n\t\t\t\t\t\t<div control-checkbox [control]="controls.important" label="Important"></div>\n\t\t\t\t\t\t<div control-checkbox [control]="controls.transparent" label="Transparent"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="3" [disabled]="true"></div>\n\t\t\t\t\t\t<div *if="controls.transparent.value == true">\n\t\t\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" [disabled]="true"></div>\n\t\t\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/png, image/jpeg"></div>\n\t\t\t\t\t\t<div control-text [control]="controls.link.controls.title" label="Link Title"></div>\n\t\t\t\t\t\t<div control-text [control]="controls.link.controls.href" label="Link Url"></div>\n\t\t\t\t\t\t<div control-custom-select [control]="controls.hook" label="Hook" *if="useHooks"></div>\n\t\t\t\t\t\t<div control-text [control]="controls.hookExtra" label="Hook Extra" *if="useHooks"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},oa.chunk=()=>'<div class="nav-modal" nav-modal></div>';class aa extends t.Component{onInit(){this.error=null;const t=this.form=new e.FormGroup({type:mi.PanoramaGrid,name:new e.FormControl(null,e.RequiredValidator()),assets:new e.FormControl(null,e.RequiredValidator())});this.controls=t.controls,t.changes$.subscribe((t=>{this.pushChanges()}))}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=this.form.value.assets,e=_i.mapTiles(t.map((t=>({asset:t,navs:[]}))),!1,!0);e.sort(((t,e)=>1e4*t.indices.x+t.indices.y-(1e4*e.indices.x+e.indices.y)));const n=e[0].asset,r={type:this.form.value.type,name:this.form.value.name,asset:n,tiles:e,invertAxes:!0,flipAxes:!1,orientation:{latitude:0,longitude:0},zoom:75};ea.viewCreate$(r).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>{console.log("PanoramaGridModalComponent.onSubmit.error",t),this.error=t,this.form.reset()}))}else this.form.touched=!0}onClose(){ai.reject()}}aa.meta={selector:"[panorama-grid-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Panorama Grid.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t<div control-assets [control]="controls.assets" label="Image" accept="image/jpeg"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},aa.chunk=()=>'<div class="panorama-grid-modal" panorama-grid-modal></div>';class ca extends t.Component{onInit(){this.error=null;const t=this.form=new e.FormGroup({type:mi.Panorama,name:new e.FormControl(null,e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator())});this.controls=t.controls,t.changes$.subscribe((t=>{this.pushChanges()}))}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=this.form.value,e={type:t.type,name:t.name,asset:t.asset,orientation:{latitude:0,longitude:0},zoom:75};return ea.viewCreate$(e).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>{console.log("PanoramaModalComponent.onSubmit.error",t),this.error=t,this.form.reset()}))}this.form.touched=!0}onClose(){ai.reject()}}ca.meta={selector:"[panorama-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Panorama.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t\t\x3c!--\n\t\t\t\t\t<div class="group--form group--form--fixed">\n\t\t\t\t\t\t<code [innerHTML]="form.value | json"></code>\n\t\t\t\t\t\t<button type="button" class="btn--test" (click)="test()"><span>test</span></button>\n\t\t\t\t\t</div>\n\t\t\t\t\t--\x3e\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},ca.chunk=()=>'<div class="panorama-modal" panorama-modal></div>';class la extends t.Component{onInit(){const{parentInstance:n}=t.getContext(this);n instanceof Ji&&(this.data=n.modal.data),this.error=null;const i=this.form=new e.FormGroup({name:new e.FormControl(null,e.RequiredValidator())});this.controls=i.controls,i.changes$.subscribe((t=>{this.pushChanges()}))}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t={name:this.form.value.name,items:this.data?this.data.item.items:[]};return Ni.pathCreate$(t).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>{console.log("PathAddModalComponent.onSubmit.error",t),this.error=t,this.form.reset()}))}this.form.touched=!0}onClose(){ai.reject()}}la.meta={selector:"[path-add-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Add Path.</div>\n\t\t\t\t<div class="description">Aggiungi un percorso</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},la.chunk=()=>'<div class="panorama-modal" path-add-modal></div>';class ua extends t.Component{onInit(){this.item=null,this.views=null;const{parentInstance:n}=t.getContext(this);if(n instanceof Ji){const t=n.modal.data;t&&(this.item=t.item?t.item:null,this.views=this.parseViews(t.views,this.item))}this.error=null;const i=this.form=new e.FormGroup({name:new e.FormControl(this.item?this.item.name:null,e.RequiredValidator())});this.controls=i.controls,i.changes$.subscribe((t=>{this.pushChanges()}))}parseViews(t,e){return t&&e?t.map((t=>({id:t.id,name:t.name,type:t.type,active:-1===e.items.indexOf(t.id)}))):[]}onToggleView(t){t.active=!t.active,this.pushChanges()}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=this.form.value,e={id:this.item.id,name:t.name,items:this.views.filter((t=>!t.active)).map((t=>t.id))};return Ni.pathUpdate$(e).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>{console.log("PathEditModalComponent.onSubmit.error",t),this.error=t,this.form.reset()}))}this.form.touched=!0}onSelectAll(){this.views.forEach((t=>t.active=!0)),this.pushChanges()}onSelectNone(){this.views.forEach((t=>t.active=!1)),this.pushChanges()}onClose(){ai.reject()}}ua.meta={selector:"[path-edit-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Edit Path <span *if="item">&ldquo;<span [innerHTML]="item.title || item.name"></span>&rdquo;</span>.</div>\n\t\t\t\t<div class="description">Modifica il percorso</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ul class="nav--flag" *if="views">\n\t\t\t\t\t\t<li class="nav__item" *for="let view of views">\n\t\t\t\t\t\t\t<button type="button" class="btn--flag" [class]="{ active: view.active }" [title]="view.name" (click)="onToggleView(view)">\n\t\t\t\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t\t\t\t<svg-icon [name]="view.type.name"></svg-icon>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<span class="name" [innerHTML]="view.name"></span>\n\t\t\t\t\t\t\t\t<span class="flag">\n\t\t\t\t\t\t\t\t\t<svg class="check" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#check"></use></svg>\n\t\t\t\t\t\t\t\t\t<svg class="close" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<div class="group--options">\n\t\t\t\t\t\t\t<button type="button" class="btn--link" (click)="onSelectAll()">\n\t\t\t\t\t\t\t\t<span>Select all</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<button type="button" class="btn--link" (click)="onSelectNone()">\n\t\t\t\t\t\t\t\t<span>Select none</span>\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Save</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},ua.chunk=()=>'<div class="path-edit-modal" path-edit-modal></div>';class da extends t.Component{get data(){let e=null;const{parentInstance:n}=t.getContext(this);return n instanceof Ji&&(e=n.modal.data),e}get view(){let t=null;const e=this.data;return e&&(t=e.view),t}get object(){const t=new THREE.Object3D,e=this.data;if(e){const n=e.hit.position.clone(),i=e.hit.normal.clone();e.hit.spherical?(n.normalize().multiplyScalar(20),t.position.copy(n),t.lookAt(Sr.origin)):(t.lookAt(i),t.position.set(n.x,n.y,n.z),t.position.add(i.multiplyScalar(.01)))}return t}onInit(){const t=this.object,n=this.form=new e.FormGroup({type:gi.Plane,position:new e.FormControl(t.position.toArray(),e.RequiredValidator()),rotation:new e.FormControl(t.rotation.toArray(),e.RequiredValidator()),scale:new e.FormControl([12,6.75,1],e.RequiredValidator()),asset:null});this.controls=n.controls,n.changes$.subscribe((t=>{this.pushChanges()}))}onSubmit(){if(this.form.valid){const t=Object.assign({},this.form.value);ea.inferItemCreate$(this.view,t).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>console.log("PlaneModalComponent.onSubmit.error",t)))}else this.form.touched=!0}onClose(){ai.reject()}}da.meta={selector:"[plane-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Plane.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t\x3c!-- <div control-text [control]="controls.title" label="Title"></div> --\x3e\n\t\t\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div>\n\t\t\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},da.chunk=()=>'<div class="plane-modal" plane-modal></div>';class ha extends t.Component{get data(){let e=null;const{parentInstance:n}=t.getContext(this);return n instanceof Ji&&(e=n.modal.data),e}get item(){let t=null;const e=this.data;return e&&(t=e.item),t}onRemove(){ai.resolve()}onCancel(){ai.reject()}onClose(){ai.reject()}}ha.meta={selector:"[remove-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Remove <span *if="item">&ldquo;<span [innerHTML]="item.title || item.name"></span>&rdquo;</span>.</div>\n\t\t\t\t<div class="abstract">are you sure?</div>\n\t\t\t\t<div class="group--cta">\n\t\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t\t<span>Remove</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--accept" (click)="onCancel($event)">\n\t\t\t\t\t\t<span>Cancel</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},ha.chunk=()=>'<div class="remove-modal" remove-modal></div>';class Aa extends t.Component{onInit(){this.error=null;const t=this.form=new e.FormGroup({type:mi.Room3d,name:new e.FormControl(null,e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator())});this.controls=t.controls,t.changes$.subscribe((t=>{this.pushChanges()}))}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=this.form.value,e={type:t.type,name:t.name,asset:t.asset,orientation:{latitude:0,longitude:0},zoom:75};return ea.viewCreate$(e).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>{console.log("Room3DModalComponent.onSubmit.error",t),this.error=t,this.form.reset()}))}this.form.touched=!0}onClose(){ai.reject()}}Aa.meta={selector:"[room-3d-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Room 3D View.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg"></div>\n\t\t\t\t\t\t<div control-model [control]="controls.model" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t\t\t--\x3e\n\t\t\t\t\t\t<div control-model [control]="controls.asset" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},Aa.chunk=()=>'<div class="room-3d-modal" room-3d-modal></div>';const pa={menu:[{id:"menu",title:"editor_menu",active:!0},{id:"navmaps",title:"editor_navmaps",active:!0}],current:null,active:!1};class fa extends t.Component{get dataViews(){return Ar.dataViews}get pathViews(){return Ar.pathViews}onInit(){const{node:e}=t.getContext(this);e.classList.remove("hidden"),this.settings=this.getSettings(),this.aside=!1,this.state={},this.view=null,this.paths=null,this.path=null,this.form=null,this.local=null,this.remotes=[],this.viewHit=new n.Subject;(this.vrService=Ts.getService()).status$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.pushChanges())),this.resolveUser()}resolveUser(){Tn.me$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{t&&t.type===ne.Publisher?(this.user=t,this.initState()):te.setRouterLink(ve.transform(":lang.access"))}))}initState(){const t=this.user,e={user:t,role:t.type,name:t.firstName&&t.lastName?`${t.firstName} ${t.lastName}`:null,mode:un,link:null,channelName:D.channelName,uid:null,status:xe,connecting:!1,connected:!0,controlling:!1,spying:!1,silencing:!1,hosted:!0,live:!1,navigable:!0,cameraMuted:!1,audioMuted:!1,showNavInfo:!0};ee.state=e,ee.state$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.state=t,this.hosted=t.hosted,this.pushChanges()})),this.viewObserver$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{})),Zn.mode=Jn}viewObserver$(){return ea.data$().pipe(i.switchMap((t=>{const e=(new oe).pathId;return Ni.getCurrentPath$(e).pipe(i.switchMap((e=>(this.paths=Ni.paths,this.path=e,Ar.editorView$(t,e)))))})),i.tap((t=>{this.view=null,this.pushChanges()})),i.delay(1),i.tap((t=>{this.view=t,this.pushChanges()})))}onAddPath(){ai.open$({template:la.chunk()}).pipe(i.first()).subscribe((t=>{t instanceof si&&Ni.addPath(t.data)}))}onEditPath(t){ai.open$({template:ua.chunk(),data:{item:t,views:Ar.validViews}}).pipe(i.first()).subscribe((t=>{t instanceof si&&Ni.editPath(t.data)}))}onDuplicatePath(t){ai.open$({template:la.chunk(),data:{item:t}}).pipe(i.first()).subscribe((t=>{t instanceof si&&Ni.addPath(t.data)}))}onDeletePath(t){ai.open$({template:ha.chunk(),data:{item:t}}).pipe(i.first()).subscribe((e=>{e instanceof si&&Ni.pathDelete$(t).pipe(i.first()).subscribe((e=>{Ni.deletePath(t)}))}))}onSelectPath(t){Ni.path=t}isPathSelected(t){return Ni.path.id===t.id}onNavTo(t){const e=t.viewId;Ar.pathViews.find((t=>t.id===e))&&(Ar.action={viewId:e,keepOrientation:t.keepOrientation,useLastOrientation:t.useLastOrientation})}onNavLink(t){ai.open$({iframe:t.link.href}).pipe(i.first()).subscribe((e=>{Mn.send({type:je,itemId:t.item.id})}))}patchState(t){this.state=Object.assign({},this.state,t),this.pushChanges()}tryInAr(){ai.open$({template:Zi.chunk(),data:this.view}).pipe(i.first()).subscribe((t=>{}))}onToggleAside(){this.aside=!this.aside,this.pushChanges(),window.dispatchEvent(new Event("resize"))}getSettings(){const t=Object.assign({},pa);return t.menu=t.menu.filter((t=>D.flags[t.id])),t.current=t.menu.length?t.menu[0].id:null,t}onToggleSettings(){const t=this.settings;t.active=!t.active,this.pushChanges()}onSelectSetting(t){this.settings.current=t.id,this.pushChanges()}onViewHit(t){this.viewHit.next(t)}onViewHitted(t){this.viewHitSubscription&&(this.viewHitSubscription.unsubscribe(),this.viewHitSubscription=null),"function"==typeof t&&(this.viewHitSubscription=this.viewHit.pipe(i.first()).subscribe((e=>t(e))))}onDragEnd(t){ea.inferItemUpdate$(this.view,t.item).pipe(i.first()).subscribe((t=>{this.pushChanges()}),(e=>console.log("EditorComponent.onDragEnd.inferItemUpdate$.error",e,this.view,t.item,t.item.payload)))}onResizeEnd(t){}onWorldSelect(t){if(this.view){let e;this.view.items.forEach((t=>t.showPanel=!1)),this.view.items.forEach((n=>{n.selected=n===t.item,e=n.selected?n:e})),this.view.selected=!e,this.pushChanges(),e&&(this.aside=!0,this.pushChanges(),window.dispatchEvent(new Event("resize")))}}onOpenModal(t,e){let n=null;switch(t.type){case"view":switch(t.value){case mi.Panorama.name:n=ca.chunk();break;case mi.PanoramaGrid.name:n=aa.chunk();break;case mi.Model.name:n=sa.chunk();break;case mi.Room3d.name:n=Aa.chunk();break;case mi.Media.name:n=ra.chunk()}break;case"viewItem":switch(t.value){case gi.Nav.name:n=oa.chunk();break;case gi.Plane.name:n=da.chunk();break;case gi.CurvedPlane.name:n=na.chunk();break;case gi.Model.name:n=ia.chunk()}}n&&ai.open$({template:n,data:e}).pipe(i.first()).subscribe((e=>{if(e instanceof si)switch(t.type){case"view":switch(t.value){case mi.Panorama.name:case mi.PanoramaGrid.name:case mi.Model.name:case mi.Room3d.name:case mi.Media.name:Ar.addView(e.data)}break;case"viewItem":switch(t.value){case gi.Nav.name:case gi.Plane.name:case gi.CurvedPlane.name:case gi.Model.name:{const t=e.data,n=ea.getTile(this.view);if(n){const e=n.navs||[];e.push(t),n.navs=e,this.view.updateCurrentItems()}else{t.path=!0;const e=this.view.items||[];e.push(t),this.view.items=e}this.pushChanges();break}}}this.pushChanges()}))}onAsideSelect(t){if(t.value)switch(t.value){case gi.Nav.name:case gi.Plane.name:case gi.CurvedPlane.name:this.onViewHitted((e=>{this.onOpenModal(t,{view:this.view,hit:e})})),Xi.open$({message:"Click a point on the view"});break;case gi.Model.name:if("viewItem"===t.type){if(this.view.type.name===mi.Model.name)return;this.onViewHitted((e=>{this.onOpenModal(t,{view:this.view,hit:e})})),Xi.open$({message:"Click a point on the view"})}else this.onOpenModal(t,{view:this.view});break;default:this.onOpenModal(t,{view:this.view})}else if(t.view&&(t.item||null===t.item))t.view.selected=!1,t.view.items.forEach((e=>e.selected=e===t.item)),Mn.send({type:Je}),this.pushChanges();else if(t.view&&(t.tile||null===t.tile))t.view.selected=!1,t.view.tiles.forEach((e=>e.selected=e===t.tile)),Mn.send({type:Je}),this.pushChanges();else if(t.view||null===t.view){this.view.selected=this.view===t.view,this.view.items.forEach((t=>t.selected=!1));const e=ea.getTile(this.view);e&&this.view.tiles.forEach((t=>t.selected=t===e)),Mn.send({type:Je}),this.pushChanges()}}onAsideUpdate(t){if(t.item&&t.view)this.pushChanges();else if(t.tile&&t.view);else if(t.view)if(Ar.viewId!==t.view.id)Ar.viewId=t.view.id;else{const e=ta.assetDidChange(this.view.asset,t.view.asset);Object.assign(this.view,t.view),e&&"function"==typeof this.view.onUpdateAsset&&this.view.onUpdateAsset(),this.pushChanges()}}onAsideDelete(t){t.item&&t.view?ea.inferItemDelete$(t.view,t.item).pipe(i.first()).subscribe((e=>{ea.inferItemDeleteResult$(t.view,t.item),this.pushChanges()}),(t=>console.log("EditorComponent.onAsideDelete.inferItemDelete$.error",t))):t.view&&ea.viewDelete$(t.view).pipe(i.first()).subscribe((e=>{Ar.deleteView(t.view)}),(t=>console.log("EditorComponent.onAsideDelete.viewDelete$.error",t)))}}fa.meta={selector:"[editor-component]",hosts:{host:ae},template:'\n\t<div class="page page--editor">\n\t\t<div class="ui" [class]="{ open: aside }" *if="dataViews.length">\n\t\t\t<div class="ui__navbar">\n\t\t\t\t<div class="btn--settings" [class]="{ active: settings.active }" (click)="onToggleSettings($event)" *if="settings.menu.length > 0">\n\t\t\t\t\t<svg class="settings" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#settings-full"></use></svg>\n\t\t\t\t</div>\n\t\t\t\t<div class="headline" *if="view">\n\t\t\t\t\t<div class="headline__id" [innerHTML]="view.id"></div>\n\t\t\t\t\t<div class="headline__icon">\n\t\t\t\t\t\t<svg-icon [name]="view.type.name"></svg-icon>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="headline__name" [innerHTML]="view.name"></div>\n\t\t\t\t</div>\n\t\t\t\t<div class="group--path" *if="(\'usePaths\' | flag) && path">\n\t\t\t\t\t<div class="group--path__select">\n\t\t\t\t\t\t<div class="group--form--select" [dropdown]="\'path\'">\n\t\t\t\t\t\t\t<label>Percorso</label>\n\t\t\t\t\t\t\t<span class="control--custom-select" [innerHTML]="path.name"></span>\n\t\t\t\t\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="dropdown dropdown-item" [dropdown-item]="\'path\'">\n\t\t\t\t\t\t\t<div class="category">Percorso</div>\n\t\t\t\t\t\t\t<ul class="nav--dropdown">\n\t\t\t\t\t\t\t\t<li [class]="{ active: isPathSelected(item) }" *for="let item of paths">\n\t\t\t\t\t\t\t\t\t<span [innerHTML]="item.name" (click)="onSelectPath(item)"></span>\n\t\t\t\t\t\t\t\t\t<div class="check">\n\t\t\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#check"></use></svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="btn--flags" (click)="onEditPath(item)" title="Edit" *if="item.id">\n\t\t\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#flags"></use></svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="btn--duplicate" (click)="onDuplicatePath(item)" title="Duplicate" *if="item.id">\n\t\t\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#duplicate"></use></svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="btn--trash" (click)="onDeletePath(item)" title="Delete" *if="item.id">\n\t\t\t\t\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#trash"></use></svg>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t</ul>\n\t\t\t\t\t\t\t<div class="btn--mode" (click)="onAddPath()">Aggiungi un percorso</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="btn--edit" [class]="{ active: aside }" (click)="onToggleAside($event)">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#edit"></use></svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui__body">\n\t\t\t\t<div class="world" world [view]="view" [views]="pathViews" [editor]="true" (navTo)="onNavTo($event)" (viewHit)="onViewHit($event)" (dragEnd)="onDragEnd($event)" (select)="onWorldSelect($event)"></div>\n\t\t\t</div>\n\t\t\t\x3c!-- footer --\x3e\n\t\t\t<div class="group--footer">\n\t\t\t\t<div class="group--ar-vr">\n\t\t\t\t\t<button type="button" class="btn--ar" [href]="view?.ar" (click)="tryInAr()" *if="view?.ar">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#ar"></use></svg> <span>Try in AR</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--vr" [class]="{ disabled: vrService.isDisabled() }" (click)="vrService.toggleVR()">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#vr"></use></svg> <span [innerHTML]="vrService.getLabel()"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui__settings" *if="settings.active">\n\t\t\t\t\x3c!-- settings navs --\x3e\n\t\t\t\t<div class="group--nav">\n\t\t\t\t\t<ul class="nav--menu">\n\t\t\t\t\t\t<li class="nav__item" *for="let item of settings.menu" [class]="{ active: settings.current === item.id }" (click)="onSelectSetting(item)"><span class="title" [innerHTML]="item.title | label"></span></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- menu --\x3e\n\t\t\t\t<div class="group--content" menu-builder [views]="dataViews" *if="settings.current === \'menu\'"></div>\n\t\t\t\t\x3c!-- navmaps --\x3e\n\t\t\t\t<div class="group--content" navmap-builder [views]="dataViews" *if="settings.current === \'navmaps\'"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div class="aside" [class]="{ active: aside }" aside [view]="view" (select)="onAsideSelect($event)" (update)="onAsideUpdate($event)" (delete)="onAsideDelete($event)" *if="view && aside"></div>\n\t</div>\n\t'};class ma{static currentLanguagePage$(t){return ge.lang$.pipe(i.switchMap((e=>this.page$(e,t))))}static page$(t,e){const n=D.flags.production?`/api/${t}/pages/${e}/`:`./api/${t}/pages/${e}.json`;return Sn.get$(n)}}class ga extends t.Component{onInit(){this.route=this.host?this.host.route:null,this.state={status:"generic"},this.page=null,ma.currentLanguagePage$(this.route.params.mode).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.page=t,this.pushChanges()}))}}ga.meta={selector:"[generic-component]",hosts:{host:ae},template:`\n\t\t<div class="page page--generic">\n\t\t\t\x3c!-- generic --\x3e\n\t\t\t<div class="ui ui--generic" *if="page">\n\t\t\t\t<div class="group--generic">\n\t\t\t\t\t<div class="group--generic__content stagger--childs">\n\t\t\t\t\t\t<h1 class="title" [innerHTML]="page.title"></h1>\n\t\t\t\t\t\t<div class="description" [innerHTML]="page.description"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<header>\n\t\t\t\t${g}\n\t\t\t\t${_}\n\t\t\t</header>\n\t\t\t<footer>\n\t\t\t\t<span class="group--colophon" *if="state.status != 'connected'">\n\t\t\t\t\t${v}\n\t\t\t\t\t${y}\n\t\t\t\t</span>\n\t\t\t</footer>\n\t\t</div>\n\t`};class va extends t.Component{get meetingUrl(){return this.meetingUrl_||(this.meetingUrl_=new oe),this.meetingUrl_}get isVirtualTourUser(){return-1!==[ne.Publisher,ne.Attendee,ne.Streamer,ne.Viewer].indexOf(this.state.role)}get isEmbed(){return this.route&&"embed"===this.route.params.mode}get isSelfServiceTour(){return this.route&&"selfServiceTour"===this.route.params.mode}get isNavigable(){return null==this.meetingUrl.embedViewId}get isBackButtonVisible(){return this.view&&(this.view.type.name===mi.Media.name||this.view.type.name===mi.Model.name)}get showNavInfoToggler(){return D.flags.hideNavInfo&&this.state.mode!==dn}get uiClass(){const t={};return t[this.state.role]=!0,t.chat=this.state.chat,t.remotes=this.state.mode===dn,t.remoteScreen=null!=this.remoteScreen&&!this.hasScreenViewItem,t.media=!t.remotes&&this.media,t.locked=this.locked,t}get remoteClass(){return`group--remote--${Math.min(9,this.remotes.length)}`}get controlled(){return this.state.controlling&&this.state.controlling!==this.state.uid}get controlling(){return this.state.controlling&&this.state.controlling===this.state.uid}get silencing(){return ee.state.silencing}get silenced(){return ee.state.silencing&&ee.state.role===ne.Streamer}get spyed(){return this.state.spying&&this.state.spying===this.state.uid}get spying(){return this.state.spying&&this.state.spying!==this.state.uid}get locked(){return this.controlled||this.spying}get remoteScreen(){return this.remoteScreen_}set remoteScreen(t){this.remoteScreen_!==t&&(this.remoteScreen_=t,window.dispatchEvent(new Event("resize")))}onInit(){const t=this.meetingUrl.embedViewId;this.state={status:me.get("status")||xe,role:me.get("role")||ne.Publisher,membersCount:3,controlling:!1,spying:!1,silencing:!1,hosted:!0,chat:!1,chatDirty:!0,name:"Jhon Appleseed",uid:"7341614597544882",showNavInfo:!0},this.state.live=this.state.role!==ne.SelfService&&this.state.role!==ne.Embed&&!C,this.state.navigable=null==t,this.state.mode=Tn.getMode(this.state.role),this.view={likes:41,type:{id:2,name:"panorama"}},this.local={},this.screen=null,this.remoteScreen_=null,this.media=null,this.hasScreenViewItem=!1,this.media=!0,this.remotes=new Array(8).fill(0).map(((t,e)=>({id:e+1}))),this.languageService=ge,this.showLanguages=!1,ee.patchState(this.state),this.fullscreen$().pipe(i.takeUntil(this.unsubscribe$)).subscribe(),this.vrService=Ts.getService(),console.log("LayoutComponent",this),setTimeout((()=>{const t=zi;switch(t){case Gi:Xi.open$({message:fe.transform("bhere_support_request_sent")}).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{t instanceof Yi&&console.log("ToastResolveEvent",t)}));break;case Qi:Xi.open$({message:fe.transform("bhere_support_request_sent"),type:t,position:Ki}).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{t instanceof Yi?console.log("ToastResolveEvent",t):t instanceof $i&&console.log("ToastRejectEvent",t)}));break;case zi:Xi.open$({message:fe.transform("bhere_support_request_dialog"),acceptMessage:fe.transform("bhere_support_request_dialog_accept"),rejectMessage:fe.transform("bhere_support_request_dialog_reject"),type:t,position:Ki}).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{t instanceof Yi?console.log("ToastResolveEvent",t):t instanceof $i&&console.log("ToastRejectEvent",t)}))}}),3e3)}setLanguage(t){this.languageService.setLanguage$(t).pipe(i.first()).subscribe((t=>{this.showLanguages=!1,this.pushChanges()}))}toggleLanguages(){this.showLanguages=!this.showLanguages,this.pushChanges()}patchState(t){this.state=Object.assign({},this.state,t),this.screen=this.state.screen||null,this.remoteScreen=this.screen,this.pushChanges()}toggleCamera(){this.patchState({cameraMuted:!this.state.cameraMuted})}toggleAudio(){this.patchState({audioMuted:!this.state.audioMuted})}toggleScreen(){this.patchState({screen:!this.state.screen}),window.dispatchEvent(new Event("resize"))}toggleVolume(){this.patchState({volumeMuted:!this.state.volumeMuted})}toggleMode(){const t=this.state.mode===un?dn:un;this.patchState({mode:t})}toggleFullScreen(){const{node:e}=t.getContext(this);!this.state.fullScreen?e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen():document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}fullscreen$(){return n.fromEvent(document,"fullscreenchange").pipe(i.tap((t=>{const e=null!=document.fullscreenElement;this.patchState({fullScreen:e})})))}toggleChat(){this.patchState({chat:!this.state.chat,chatDirty:!1}),window.dispatchEvent(new Event("resize"))}toggleNavInfo(){this.patchState({showNavInfo:!this.state.showNavInfo})}onBack(){console.log("LayoutComponent.onBack")}onChatClose(){this.patchState({chat:!1}),window.dispatchEvent(new Event("resize"))}onToggleControl(t){const e=this.state.controlling===t?null:t;this.patchState({controlling:e,spying:!1})}onToggleSilence(){this.patchState({silencing:!this.state.silencing})}onToggleSpy(t){const e=this.state.spying===t?null:t;this.patchState({spying:e,controlling:!1})}addLike(){this.view.liked=!0,this.showLove(this.view)}showLove(t){if(t&&this.view.id===t.id){const e=this.view.showLove;this.view.likes=t.likes,this.view.showLove=!0,this.pushChanges(),e||setTimeout((()=>{this.view.showLove=!1,this.pushChanges()}),3100)}}disconnect(){}}va.meta={selector:"[layout-component]",hosts:{host:ae},template:`\n\t<div class="page page--agora">\n\t\t${m}\n\t\t\x3c!-- Status Checklist --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'checklist'" [agora-checklist] (checked)="onChecked($event)"></div>\n\t\t\x3c!-- Status Link --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'link'" [agora-link] (link)="onLink($event)"></div>\n\t\t\x3c!-- Status Login --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'login'" [agora-login] (login)="onLogin($event)"></div>\n\t\t\x3c!-- Status Name --\x3e\n\t\t<div class="ui ui--info ui--info-centered" *if="state.status == 'name' || (state.status == 'disconnected' && state.role === 'viewer')" [agora-name] (name)="onName($event)"></div>\n\t\t\x3c!-- Status Device --\x3e\n\t\t<div class="ui ui--info" *if="state.status == 'device' || (state.status == 'disconnected' && state.role !== 'viewer')" [agora-device] (enter)="onEnter($event)"></div>\n\t\t\x3c!-- Virtual Tour --\x3e\n\t\t<div class="ui virtual-tour" [class]="uiClass" *if="state.status == 'connected' && isVirtualTourUser">\n\t\t\t\x3c!-- world --\x3e\n\t\t\t<div class="ui__body">\n\t\t\t\t<div class="world"></div>\n\t\t\t</div>\n\t\t\t\x3c!-- remote sidebar --\x3e\n\t\t\t<div class="group--remote" [class]="remoteClass" *if="state.live">\n\t\t\t\t<div class="agora-stream" *for="let remote of remotes">\n\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t<div class="agora-stream__info" [class]="{ spyed: state.spying == remote.streamId, controlling: state.controlling == remote.streamId }">\n\t\t\t\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t\t\t<div class="id">name</div>\n\t\t\t\t\t\t<button type="button" class="btn--control" [title]="'title_control' | label" (click)="onToggleControl(remote.streamId)" *if="state.role === 'publisher'">\n\t\t\t\t\t\t\t<svg class="control" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#control"></use></svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t\t<button type="button" class="btn--spy" [title]="'title_spy' | label" (click)="onToggleSpy(remote.streamId)" *if="state.role === 'publisher'">\n\t\t\t\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#spy"></use></svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="group--members" *if="state.mode == 'virtual-tour'">\n\t\t\t\t\t<div class="members" *if="state.role === 'publisher'">\n\t\t\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t\t\t\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="credits">\n\t\t\t\t\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t\t\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- remote screen --\x3e\n\t\t\t<div class="group--remote-screen" *if="remoteScreen">\n\t\t\t\t<div class="agora-stream">\n\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t<div class="agora-stream__info">\n\t\t\t\t\t\t<div class="id">name</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="group--header">\n\t\t\t\t\x3c!-- service --\x3e\n\t\t\t\t<div class="group--service">\n\t\t\t\t\t<button type="button" class="btn--back" [title]="'title_back' | label" (click)="onBack($event)" *if="isBackButtonVisible">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#arrow-prev"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--view-mode" [title]="'title_view_mode' | label" (click)="toggleMode($event)" *if="state.mode != 'embed'">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == 'virtual-tour'"><use xlink:href="#live-meeting"></use></svg>\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.mode == 'live-meeting'"><use xlink:href="#virtual-tour"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--volume" [title]="'title_volume' | label" [class]="{ muted: state.volumeMuted }" (click)="toggleVolume($event)">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.volumeMuted"><use xlink:href="#volume-on"></use></svg>\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.volumeMuted"><use xlink:href="#volume-off"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--fullscreen" [title]="'title_fullscreen' | label" [class]="{ muted: state.fullScreen }" (click)="toggleFullScreen($event)">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.fullScreen"><use xlink:href="#fullscreen-on"></use></svg>\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.fullScreen"><use xlink:href="#fullscreen-off"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--navmap" [title]="'title_navmap' | label" [class]="{ active: state.showNavmap }" (click)="toggleNavmap($event)" *if="navmap && state.mode != 'live-meeting'">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navmap"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t\x3c!-- local streams --\x3e\n\t\t\t\t<div class="group--local" [class]="{ publisher: state.role == 'publisher', viewer: state.role == 'viewer' }" *if="state.live">\n\t\t\t\t\t<button type="button" class="btn--silence" [title]="'title_silence' | label" [class]="{ active: state.silencing }" (click)="onToggleSilence()" *if="state.role === 'publisher'">\n\t\t\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--control" [title]="'title_control' | label" [class]="{ active: state.controlling == state.uid }" (click)="onToggleControl(state.uid)" *if="state.role == 'publisher'">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#control"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<div class="agora-stream" *if="!local"></div>\n\t\t\t\t\t<div class="agora-stream" *if="local">\n\t\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t\t<div class="agora-stream__info">\n\t\t\t\t\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="agora-stream agora-stream--screen" *if="screen">\n\t\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="group--footer">\n\t\t\t\t${l}\n\t\t\t\t${u}\n\t\t\t\t${d}\n\t\t\t\t${h}\n\t\t\t</div>\n\t\t\t\x3c!-- members --\x3e\n\t\t\t<div class="group--members" *if="state.mode == 'live-meeting'">\n\t\t\t\t<div class="members" *if="state.role === 'publisher'">\n\t\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t\t\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="credits">\n\t\t\t\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t${A}\n\t\t\t${p}\n\t\t\t${f}\n\t\t</div>\n\t\t\x3c!-- Smart Device --\x3e\n\t\t<div class="ui remotes" [class]="uiClass" *if="state.status == 'connected' && state.role == 'smart-device'">\n\t\t\t\x3c!-- world --\x3e\n\t\t\t<div class="ui__body">\n\t\t\t</div>\n\t\t\t\x3c!-- remote sidebar --\x3e\n\t\t\t<div class="group--remote" [class]="remoteClass" *if="state.live">\n\t\t\t\t<div class="agora-stream" *for="let remote of remotes">\n\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t<div class="agora-stream__info">\n\t\t\t\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t\t\t<div class="id">name</div>\n\t\t\t\t\t\t<button type="button" class="btn--spy" [title]="'title_spy' | label" *if="state.role === 'publisher'" (click)="onToggleSpy(remote.streamId)">\n\t\t\t\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#spy"></use></svg>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- remote screen --\x3e\n\t\t\t<div class="group--remote-screen" *if="remoteScreen">\n\t\t\t\t<div class="agora-stream">\n\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t<div class="agora-stream__info">\n\t\t\t\t\t\t<div class="id">name</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- local streams --\x3e\n\t\t\t<div class="group--local" [class]="{ publisher: state.role == 'publisher', viewer: state.role == 'viewer' }" *if="state.live">\n\t\t\t\t<div class="agora-stream" *if="local">\n\t\t\t\t\t<div class="agora-stream__player"></div>\n\t\t\t\t\t<div class="agora-stream__info">\n\t\t\t\t\t\t<svg class="cam-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam-muted"></use></svg>\n\t\t\t\t\t\t<svg class="mic-muted" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic-muted"></use></svg>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- controls --\x3e\n\t\t\t<div class="group--controls" *if="state.live">\n\t\t\t\t<div class="group--actions">\n\t\t\t\t\t<button type="button" class="btn--call" [title]="'title_disconnect' | label" (click)="disconnect()">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#call"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--cam" [title]="'title_mute_camera' | label" [class]="{ muted: state.cameraMuted, disabled: !local }" (click)="toggleCamera()">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#cam"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--mic" [title]="'title_mute_mic' | label" [class]="{ muted: state.audioMuted, disabled: !local || silenced }" (click)="toggleAudio()">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#mic"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--screen" [title]="'title_share_screen' | label" [class]="{ active: screen }" (click)="toggleScreen()" *if="('screenShare' | flag) && (state.role == 'publisher' || state.role == 'attendee' || controlling)">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#screen"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--chat" [title]="'title_chat' | label" [class]="{ active: state.chatDirty }" (click)="toggleChat()" *if="('chat' | flag)">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#chat"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--navinfo" [title]="'title_navinfo' | label" [class]="{ active: state.showNavInfo }" (click)="toggleNavInfo()" *if="showNavInfoToggler">\n\t\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#navinfo"></use></svg>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t\x3c!-- members --\x3e\n\t\t\t<div class="group--members">\n\t\t\t\t<div class="members" *if="state.role === 'publisher'">\n\t\t\t\t\t<svg class="spy" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#users"></use></svg>\n\t\t\t\t\t<span class="members__count" [innerHTML]="state.membersCount"></span>\n\t\t\t\t</div>\n\t\t\t\t<div class="credits">\n\t\t\t\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener">\n\t\t\t\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- Self Service Tour --\x3e\n\t\t<div class="ui" [class]="uiClass" *if="state.status == 'connected' && state.mode == 'self-service-tour'">\n\t\t\t\x3c!-- world --\x3e\n\t\t\t<div class="ui__body">\n\t\t\t\t<div class="world"></div>\n\t\t\t</div>\n\t\t\t\x3c!-- service --\x3e\n\t\t\t<div class="group--service">\n\t\t\t\t<button type="button" class="btn--volume" [title]="'title_volume' | label" [class]="{ muted: state.volumeMuted }" (click)="toggleVolume($event)">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.volumeMuted"><use xlink:href="#volume-on"></use></svg>\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.volumeMuted"><use xlink:href="#volume-off"></use></svg>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--fullscreen" [title]="'title_fullscreen' | label" [class]="{ muted: state.fullScreen }" (click)="toggleFullScreen($event)">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.fullScreen"><use xlink:href="#fullscreen-on"></use></svg>\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.fullScreen"><use xlink:href="#fullscreen-off"></use></svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t${d}\n\t\t\t${h}\n\t\t</div>\n\t\t\x3c!-- Embed --\x3e\n\t\t<div class="ui" [class]="uiClass" *if="state.status == 'connected' && state.mode == 'embed'">\n\t\t\t\x3c!-- world --\x3e\n\t\t\t<div class="ui__body">\n\t\t\t\t<div class="world"></div>\n\t\t\t</div>\n\t\t\t\x3c!-- service --\x3e\n\t\t\t<div class="group--service">\n\t\t\t\t<button type="button" class="btn--volume" [title]="'title_volume' | label" [class]="{ muted: state.volumeMuted }" (click)="toggleVolume($event)">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.volumeMuted"><use xlink:href="#volume-on"></use></svg>\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.volumeMuted"><use xlink:href="#volume-off"></use></svg>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--fullscreen" [title]="'title_fullscreen' | label" [class]="{ muted: state.fullScreen }" (click)="toggleFullScreen($event)">\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="!state.fullScreen"><use xlink:href="#fullscreen-on"></use></svg>\n\t\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24" *if="state.fullScreen"><use xlink:href="#fullscreen-off"></use></svg>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t${d}\n\t\t\t${h}\n\t\t</div>\n\t\t<a class="btn--logo" [routerLink]="':lang.access' | route" *if="state.status != 'connected'">\n\t\t\t<img [src]="'logo' | env" *if="'logo' | env" />\n\t\t\t<svg viewBox="0 0 270 98" *if="!('logo' | env)"><use xlink:href="#b-here"></use></svg>\n\t\t</a>\n\t\t<a class="btn--credits" href="https://www.websolute.com/" target="_blank" rel="noopener" *if="state.status != 'connected'">\n\t\t\t<svg viewBox="0 0 270 98"><use xlink:href="#b-here"></use></svg>\n\t\t</a>\n\t\t<div class="group--language" language *if="state.status != 'connected'"></div>\n\t</div>\n\t`};class ya extends t.Component{get viewId(){const t=this.route?this.route.params.viewId:void 0;return t?parseInt(t):null}onInit(){this.platform=jn.platform,this.route=this.host?this.host.route:null,this.missingAr=!1,this.missingUsdz=!1,this.missingGltf=!1;const e=this.viewId;e&&Ar.viewById$(e).pipe(i.first()).subscribe((e=>{if(!e.ar)return this.missingAr=!0,void this.pushChanges();if(this.platform===Un){const t=this.getUsdzSrc(e);t?window.location.href=t:(this.missingUsdz=!0,this.pushChanges())}else if(null!==this.getGltfSrc(e)){const n=this.getModelViewerNode(e),{node:i}=t.getContext(this);i.appendChild(n),this.addARScripts()}else this.missingGltf=!0,this.pushChanges()}))}addARScripts(){let t=document.createElement("script");t.setAttribute("type","module"),t.setAttribute("src","https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"),document.head.appendChild(t),t=document.createElement("script"),t.setAttribute("nomodule",""),t.setAttribute("src","https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"),document.head.appendChild(t)}getUsdzSrc(t){return t.ar&&t.ar.usdz?D.getPath(t.ar.usdz.folder+t.ar.usdz.file):null}getGltfSrc(t){return t.ar&&t.ar.gltf?D.getPath(t.ar.gltf.folder+t.ar.gltf.file):null}getViewId(){const t=new oe;let e=null;return t.viewId&&(e=parseInt(t.viewId)),e}getModelViewerNode(t){const e=D.getPath(D.textures.envMap),n=D.getPath(t.asset.folder+t.asset.file),i=this.getUsdzSrc(t),r=this.getGltfSrc(t),s=`\n\t\t\t<model-viewer alt="${t.name}" environment-image="${e}" skybox-image="${n}" ios-src="${i}" src="${r}" ar ar-modes="webxr scene-viewer quick-look" ar-scale="auto" camera-controls></model-viewer>\n\t\t`,o=document.createElement("div");o.innerHTML=s;return o.firstElementChild}}ya.meta={selector:"[try-in-ar]",hosts:{host:ae},template:'\n\t\t<div class="page page--try-in-ar">\n\t\t\t\x3c!--\n\t\t\t<div *if="platform != \'ios\'">\n\t\t\t\t<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"><\/script>\n\t\t\t\t<script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"><\/script>\n\t\t\t</div>\n\t\t\t--\x3e\n\t\t\t<div class="ui" *if="!viewId">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content">\n\t\t\t\t\t\t<div class="info">Not found.</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui" *if="missingAr">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content">\n\t\t\t\t\t\t<div class="info">Missing AR in view.</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui" *if="missingUsdz">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content">\n\t\t\t\t\t\t<div class="info">Missing .usdz in ar.</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="ui" *if="missingGltf">\n\t\t\t\t<div class="group--info">\n\t\t\t\t\t<div class="group--info__content">\n\t\t\t\t\t\t<div class="info">Missing .gltf in ar.</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},console.log("environment.defaultLanguage",D.defaultLanguage);class _a extends t.Component{onInit(){const e=[{name:"index",path:"/",forwardTo:D.defaultLanguage||"it"},{name:"it",path:"/it",defaultParams:{lang:"it",mode:"access"},factory:xn},{name:"it.access",path:"/accesso",defaultParams:{lang:"it",mode:"access"},factory:xn},{name:"it.accessCode",path:"/codice-di-accesso?:p&:link&:name&:role&:viewId&:pathId&:support",defaultParams:{lang:"it",mode:"accessCode"},factory:ce},{name:"it.guidedTour",path:"/tour-guidato?:p&:link&:name&:role&:viewId&:pathId&:support",defaultParams:{lang:"it",mode:"guidedTour"},factory:Zo},{name:"it.selfServiceTour",path:"/tour-self-service?:p&:viewId&:pathId",defaultParams:{lang:"it",mode:"selfServiceTour"},factory:Zo},{name:"it.embed",path:"/embed",defaultParams:{lang:"it",mode:"embed"},factory:Zo},{name:"it.tryInAr",path:"/prova-in-ar?:p&:viewId",defaultParams:{lang:"it",mode:"tryInAr"},factory:ya},{name:"it.editor",path:"/editor?:p&:viewId",defaultParams:{lang:"it",mode:"editor"},factory:fa},{name:"it.layout",path:"/layout",defaultParams:{lang:"it",mode:"layout"},factory:va},{name:"it.privacy",path:"/informativa-sulla-privacy",defaultParams:{lang:"it",mode:"privacy_policy"},factory:ga},{name:"it.terms",path:"/termini-di-utilizzo",defaultParams:{lang:"it",mode:"terms"},factory:ga},{name:"en",path:"/en",defaultParams:{lang:"en",mode:"access"},factory:xn},{name:"en.access",path:"/access",defaultParams:{lang:"en",mode:"access"},factory:xn},{name:"en.accessCode",path:"/accesso-code?:p&:link&:name&:role&:viewId&:pathId&:support",defaultParams:{lang:"en",mode:"accessCode"},factory:ce},{name:"en.guidedTour",path:"/guided-tour?:p&:link&:name&:role&:viewId&:pathId&:support",defaultParams:{lang:"en",mode:"guidedTour"},factory:Zo},{name:"en.selfServiceTour",path:"/self-service-tour?:p&:viewId&:pathId",defaultParams:{lang:"en",mode:"selfServiceTour"},factory:Zo},{name:"en.embed",path:"/embed",defaultParams:{lang:"en",mode:"embed"},factory:Zo},{name:"en.tryInAr",path:"/try-in-ar?:p&:viewId",defaultParams:{lang:"en",mode:"tryInAr"},factory:ya},{name:"en.editor",path:"/editor?:p&:viewId",defaultParams:{lang:"en",mode:"editor"},factory:fa},{name:"en.layout",path:"/layout",defaultParams:{lang:"en",mode:"layout"},factory:va},{name:"en.privacy",path:"/privacy-policy",defaultParams:{lang:"en",mode:"privacy_policy"},factory:ga},{name:"en.terms",path:"/terms-of-service",defaultParams:{lang:"en",mode:"terms"},factory:ga}];te.useBrowser(e),D.flags.editorAssetScreen&&(rr.PublisherScreen={id:5,name:"PublisherScreen",ids:[6]},rr.AttendeeScreen={id:6,name:"AttendeeScreen",ids:[7]}),rr.SmartDevice={id:7,name:"Smart Device",ids:[8]},te.event$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{const n=t.route;n&&"embed"===n.params.mode&&(D.flags.like=!1),ge.setRoute(n,e)})),ge.lang$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.pushChanges()}));const{node:n}=t.getContext(this);n.classList.remove("hidden")}}_a.meta={selector:"[b-here-component]",template:'\n\t\t\x3c!-- svg --\x3e\n\t\t\n\t\t<svg width="0" height="0" class="hidden" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true">\n\t\t\t<symbol id="arrow-down" viewBox="0 0 24 24">\n\t\t\t\t<path d="M0 7.33l2.829-2.83 9.175 9.339 9.167-9.339 2.829 2.83-11.996 12.17z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="arrow-next" viewBox="0 0 24 24">\n\t\t\t\t<path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="arrow-prev" viewBox="0 0 24 24">\n\t\t\t\t<path d="M16.67 0l2.83 2.829-9.339 9.175 9.339 9.167-2.83 2.829-12.17-11.996z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="call" viewBox="0 0 24 24">\n\t\t\t\t<path d="M20 22.621l-3.521-6.795c-.008.004-1.974.97-2.064 1.011-2.24 1.086-6.799-7.82-4.609-8.994l2.083-1.026-3.493-6.817-2.106 1.039c-7.202 3.755 4.233 25.982 11.6 22.615.121-.055 2.102-1.029 2.11-1.033z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="heart" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12 4.435c-1.989-5.399-12-4.597-12 3.568 0 4.068 3.06 9.481 12 14.997 8.94-5.516 12-10.929 12-14.997 0-8.118-10-8.999-12-3.568z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="heart-outline" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12 9.229c.234-1.12 1.547-6.229 5.382-6.229 2.22 0 4.618 1.551 4.618 5.003 0 3.907-3.627 8.47-10 12.629-6.373-4.159-10-8.722-10-12.629 0-3.484 2.369-5.005 4.577-5.005 3.923 0 5.145 5.126 5.423 6.231zm-12-1.226c0 4.068 3.06 9.481 12 14.997 8.94-5.516 12-10.929 12-14.997 0-7.962-9.648-9.028-12-3.737-2.338-5.262-12-4.27-12 3.737z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="cam" viewBox="0 0 24 24">\n\t\t\t\t<path d="M16 18c0 1.104-.896 2-2 2h-12c-1.105 0-2-.896-2-2v-12c0-1.104.895-2 2-2h12c1.104 0 2 .896 2 2v12zm8-14l-6 6.223v3.554l6 6.223v-16z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="cam-muted" viewBox="0 0 24 24">\n\t\t\t\t<path d="M0.7,19.5L15.5,4.7C15.1,4.3,14.6,4,14,4H2C0.9,4,0,4.9,0,6v12C0,18.6,0.3,19.1,0.7,19.5z"></path>\n\t\t\t\t<path d="M18 13.8L24 20 24 4 18 10.2z"></path>\n\t\t\t\t<path d="M7.8,20H14c1.1,0,2-0.9,2-2v-6.2L7.8,20z"></path>\n\t\t\t\t<path d="M-3.4 11.2H27.400000000000002V12.7H-3.4z" transform="rotate(-45.001 12 12)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="mic" viewBox="0 0 24 24">\n\t\t\t\t<path d="M16 11c0 2.209-1.791 4-4 4s-4-1.791-4-4v-7c0-2.209 1.791-4 4-4s4 1.791 4 4v7zm4-2v2c0 4.418-3.582 8-8 8s-8-3.582-8-8v-2h2v2c0 3.309 2.691 6 6 6s6-2.691 6-6v-2h2zm-7 13v-2h-2v2h-4v2h10v-2h-4z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="mic-muted" viewBox="0 0 24 24">\n\t\t\t\t<path d="M16,11.4L12.4,15C14.3,14.8,15.8,13.3,16,11.4z"></path>\n\t\t\t\t<path d="M16,4.6V4c0-2.2-1.8-4-4-4S8,1.8,8,4v7c0,0.5,0.1,0.9,0.3,1.4L16,4.6z"></path>\n\t\t\t\t<path d="M13 20L11 20 11 22 7 22 7 24 17 24 17 22 13 22z"></path>\n\t\t\t\t<path d="M18,11c0,3.3-2.7,6-6,6c-0.5,0-1-0.1-1.4-0.2L9,18.4c0.9,0.4,2,0.6,3,0.6c4.4,0,8-3.6,8-8V9h-2V11z"></path>\n\t\t\t\t<path d="M6.7,13.9C6.3,13,6,12,6,11V9H4v2c0,1.6,0.5,3.1,1.3,4.3L6.7,13.9z"></path>\n\t\t\t\t<path d="M-3.4 11.2H27.400000000000002V12.7H-3.4z" transform="rotate(-45.001 12 12)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="gamepad" viewBox="0 0 24 24">\n\t\t\t\t<path d="M17.622 3c-1.913 0-2.558 1.382-5.623 1.382-3.009 0-3.746-1.382-5.623-1.382-5.209 0-6.376 10.375-6.376 14.348 0 2.145.817 3.652 2.469 3.652 3.458 0 2.926-5 6.915-5h5.23c3.989 0 3.457 5 6.915 5 1.652 0 2.471-1.506 2.471-3.651 0-3.973-1.169-14.349-6.378-14.349zm-10.622 10c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3zm10-6c.552 0 1 .447 1 1 0 .553-.448 1-1 1s-1-.447-1-1c0-.553.448-1 1-1zm-2 4c-.552 0-1-.447-1-1 0-.553.448-1 1-1s1 .447 1 1c0 .553-.448 1-1 1zm2 2c-.552 0-1-.447-1-1 0-.553.448-1 1-1s1 .447 1 1c0 .553-.448 1-1 1zm2-2c-.552 0-1-.447-1-1 0-.553.448-1 1-1s1 .447 1 1c0 .553-.448 1-1 1zm-10.25-1c0 .965-.785 1.75-1.75 1.75s-1.75-.785-1.75-1.75.785-1.75 1.75-1.75 1.75.785 1.75 1.75z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="ar" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12 0l-11 6v12.131l11 5.869 11-5.869v-12.066l-11-6.065zm7.91 6.646l-7.905 4.218-7.872-4.294 7.862-4.289 7.915 4.365zm-16.91 1.584l8 4.363v8.607l-8-4.268v-8.702zm10 12.97v-8.6l8-4.269v8.6l-8 4.269zm6.678-5.315c.007.332-.256.605-.588.612-.332.007-.604-.256-.611-.588-.006-.331.256-.605.588-.612.331-.007.605.256.611.588zm-2.71-1.677c-.332.006-.595.28-.588.611.006.332.279.595.611.588s.594-.28.588-.612c-.007-.331-.279-.594-.611-.587zm-2.132-1.095c-.332.007-.595.281-.588.612.006.332.279.594.611.588.332-.007.594-.28.588-.612-.007-.331-.279-.594-.611-.588zm-9.902 2.183c.332.007.594.281.588.612-.007.332-.279.595-.611.588-.332-.006-.595-.28-.588-.612.005-.331.279-.594.611-.588zm1.487-.5c-.006.332.256.605.588.612s.605-.257.611-.588c.007-.332-.256-.605-.588-.611-.332-.008-.604.255-.611.587zm2.132-1.094c-.006.332.256.605.588.612.332.006.605-.256.611-.588.007-.332-.256-.605-.588-.612-.332-.007-.604.256-.611.588zm3.447-5.749c-.331 0-.6.269-.6.6s.269.6.6.6.6-.269.6-.6-.269-.6-.6-.6zm0-2.225c-.331 0-.6.269-.6.6s.269.6.6.6.6-.269.6-.6-.269-.6-.6-.6zm0-2.031c-.331 0-.6.269-.6.6s.269.6.6.6.6-.269.6-.6-.269-.6-.6-.6z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="close" viewBox="0 0 24 24">\n\t\t\t\t<path d="M23 20.168l-8.185-8.187 8.185-8.174-2.832-2.807-8.182 8.179-8.176-8.179-2.81 2.81 8.186 8.196-8.186 8.184 2.81 2.81 8.203-8.192 8.18 8.192z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="vr" viewBox="0 0 24 24">\n\t\t\t\t<path d="M22.3,4.3H1.7C0.8,4.3,0,5.1,0,6v12c0,0.9,0.8,1.7,1.7,1.7h5.6c0.7,0,1.4-0.5,1.6-1.2l1.4-4.2c0.5-1.6,2.7-1.6,3.3,0 l1.4,4.2c0.2,0.7,0.9,1.2,1.6,1.2h5.6c0.9,0,1.7-0.8,1.7-1.7V6C24,5.1,23.2,4.3,22.3,4.3z M6,14.6c-1.4,0-2.6-1.2-2.6-2.6 S4.6,9.4,6,9.4s2.6,1.2,2.6,2.6S7.4,14.6,6,14.6z M18,14.6c-1.4,0-2.6-1.2-2.6-2.6s1.2-2.6,2.6-2.6s2.6,1.2,2.6,2.6 S19.4,14.6,18,14.6z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="vr-02" viewBox="0 0 24 24">\n\t\t\t\t<path d="M22.5,8.6c-0.3,0-0.6,0.1-0.8,0.3c-0.3-1.9-1.9-3.4-3.9-3.4H6.2c-2,0-3.6,1.5-3.9,3.4C2,8.7,1.7,8.6,1.4,8.6 C0.6,8.6,0,9.3,0,10.1v3.9c0,0.8,0.6,1.4,1.4,1.4c0.3,0,0.6-0.1,0.8-0.3c0.3,1.9,1.9,3.4,3.9,3.4h11.6c2,0,3.6-1.5,3.9-3.4 c0.2,0.2,0.5,0.3,0.8,0.3c0.8,0,1.4-0.6,1.4-1.4v-3.9C24,9.3,23.3,8.6,22.5,8.6z M20.7,14.6c0,1.6-1.3,2.8-2.8,2.8H6.2 c-1.6,0-2.8-1.3-2.8-2.8V9.4c0-1.6,1.3-2.8,2.8-2.8h11.6c1.6,0,2.8,1.3,2.8,2.8V14.6z"></path><circle cx="5.7" cy="8.7" r=".8"></circle><circle cx="18.3" cy="8.6" r=".8"></circle><circle cx="5.7" cy="15.4" r=".8"></circle><circle cx="18.3" cy="15.3" r=".8"></circle>\n\t\t\t</symbol>\n\t\t\t<symbol id="the-spy" viewBox="0 0 24 24">\n\t\t\t\t<path d="M17,14c-1.8,0-3.3,1.3-3.7,3h-2.5c-0.5-2.1-2.5-3.4-4.6-2.9c-2.1,0.5-3.4,2.5-2.9,4.6s2.5,3.4,4.6,2.9 c1.4-0.3,2.6-1.5,2.9-2.9h2.5c0.5,2.1,2.5,3.4,4.6,2.9s3.4-2.5,2.9-4.6C20.4,15.3,18.8,14,17,14z"></path>\n\t\t\t\t<path d="M23.2,11.5h-2.6V6c0-0.7-0.5-1.4-1.2-1.6l-5.5-1.8c-1.2-0.4-2.6-0.4-3.8,0L4.6,4.4C3.9,4.6,3.4,5.3,3.4,6v5.4H0.8 c-0.5,0-0.8,0.4-0.8,0.8s0.4,0.8,0.8,0.8h22.3c0.5,0,0.8-0.4,0.8-0.8S23.6,11.5,23.2,11.5z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="spy-eye" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12,19.6c-4.6,0-8.9-3.5-11.7-6.8c-0.4-0.5-0.4-1.2,0-1.6C3.1,7.9,7.4,4.4,12,4.4s8.9,3.5,11.7,6.8 c0.4,0.5,0.4,1.2,0,1.6C20.9,16.1,16.6,19.6,12,19.6z M12,7.5c2.5,0,4.4,1.9,4.4,4.4s-1.9,4.4-4.4,4.4s-4.4-1.9-4.4-4.4 S9.5,7.5,12,7.5z" clip-rule="evenodd"></path>\n\t\t\t\t<path d="M12,9.3c1.4,0,2.6,1.2,2.6,2.6s-1.2,2.6-2.6,2.6s-2.6-1.2-2.6-2.6S10.6,9.3,12,9.3z" fill-rule="evenodd" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="copy" viewBox="0 0 24 24">\n\t\t\t\t<path d="M7 16h10v1h-10v-1zm0-1h10v-1h-10v1zm15-13v22h-20v-22h3c1.229 0 2.18-1.084 3-2h8c.82.916 1.771 2 3 2h3zm-11 1c0 .552.448 1 1 1s1-.448 1-1-.448-1-1-1-1 .448-1 1zm9 1h-4l-2 2h-3.898l-2.102-2h-4v18h16v-18zm-13 9h10v-1h-10v1zm0-2h10v-1h-10v1z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="menu" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12 18c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm0-9c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3zm0-9c1.657 0 3 1.343 3 3s-1.343 3-3 3-3-1.343-3-3 1.343-3 3-3z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="menu-light" viewBox="0 0 24 24">\n\t\t\t\t<path d="M14 19h-14v-1h14v1zm9.247-8.609l-3.247 4.049-3.263-4.062-.737.622 4 5 4-5-.753-.609zm-9.247 2.609h-14v-1h14v1zm0-6h-14v-1h14v1z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="settings" viewBox="0 0 24 24">\n\t\t\t\t<path d="M24 14.187v-4.374c-2.148-.766-2.726-.802-3.027-1.529-.303-.729.083-1.169 1.059-3.223l-3.093-3.093c-2.026.963-2.488 1.364-3.224 1.059-.727-.302-.768-.889-1.527-3.027h-4.375c-.764 2.144-.8 2.725-1.529 3.027-.752.313-1.203-.1-3.223-1.059l-3.093 3.093c.977 2.055 1.362 2.493 1.059 3.224-.302.727-.881.764-3.027 1.528v4.375c2.139.76 2.725.8 3.027 1.528.304.734-.081 1.167-1.059 3.223l3.093 3.093c1.999-.95 2.47-1.373 3.223-1.059.728.302.764.88 1.529 3.027h4.374c.758-2.131.799-2.723 1.537-3.031.745-.308 1.186.099 3.215 1.062l3.093-3.093c-.975-2.05-1.362-2.492-1.059-3.223.3-.726.88-.763 3.027-1.528zm-4.875.764c-.577 1.394-.068 2.458.488 3.578l-1.084 1.084c-1.093-.543-2.161-1.076-3.573-.49-1.396.581-1.79 1.693-2.188 2.877h-1.534c-.398-1.185-.791-2.297-2.183-2.875-1.419-.588-2.507-.045-3.579.488l-1.083-1.084c.557-1.118 1.066-2.18.487-3.58-.579-1.391-1.691-1.784-2.876-2.182v-1.533c1.185-.398 2.297-.791 2.875-2.184.578-1.394.068-2.459-.488-3.579l1.084-1.084c1.082.538 2.162 1.077 3.58.488 1.392-.577 1.785-1.69 2.183-2.875h1.534c.398 1.185.792 2.297 2.184 2.875 1.419.588 2.506.045 3.579-.488l1.084 1.084c-.556 1.121-1.065 2.187-.488 3.58.577 1.391 1.689 1.784 2.875 2.183v1.534c-1.188.398-2.302.791-2.877 2.183zm-7.125-5.951c1.654 0 3 1.346 3 3s-1.346 3-3 3-3-1.346-3-3 1.346-3 3-3zm0-2c-2.762 0-5 2.238-5 5s2.238 5 5 5 5-2.238 5-5-2.238-5-5-5z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="settings-full" viewBox="0 0 24 24">\n\t\t\t\t<path d="M24 13.616v-3.232l-2.869-1.02c-.198-.687-.472-1.342-.811-1.955l1.308-2.751-2.285-2.285-2.751 1.307c-.613-.339-1.269-.613-1.955-.811l-1.021-2.869h-3.232l-1.021 2.869c-.686.198-1.342.471-1.955.811l-2.751-1.308-2.285 2.285 1.308 2.752c-.339.613-.614 1.268-.811 1.955l-2.869 1.02v3.232l2.869 1.02c.197.687.472 1.342.811 1.955l-1.308 2.751 2.285 2.286 2.751-1.308c.613.339 1.269.613 1.955.811l1.021 2.869h3.232l1.021-2.869c.687-.198 1.342-.472 1.955-.811l2.751 1.308 2.285-2.286-1.308-2.751c.339-.613.613-1.268.811-1.955l2.869-1.02zm-12 2.384c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="emoji" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12,2c5.5,0,10,4.5,10,10s-4.5,10-10,10S2,17.5,2,12S6.5,2,12,2z M12,0C5.4,0,0,5.4,0,12s5.4,12,12,12s12-5.4,12-12 S18.6,0,12,0z M18,14H6c0.3,1.5,2.8,4,6,4C15.1,18,17.7,15.5,18,14z M8.5,8C7.7,8,7,8.7,7,9.5S7.7,11,8.5,11S10,10.3,10,9.5 S9.3,8,8.5,8z M15.5,8C14.7,8,14,8.7,14,9.5s0.7,1.5,1.5,1.5c0.8,0,1.5-0.7,1.5-1.5S16.3,8,15.5,8z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="pencil" viewBox="0 0 24 24">\n\t\t\t\t<path d="M19.769 9.923l-12.642 12.639-7.127 1.438 1.438-7.128 12.641-12.64 5.69 5.691zm1.414-1.414l2.817-2.82-5.691-5.689-2.816 2.817 5.69 5.692z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="erase" viewBox="0 0 24 24">\n\t\t\t\t<path d="M5.662 23l-5.369-5.365c-.195-.195-.293-.45-.293-.707 0-.256.098-.512.293-.707l14.929-14.928c.195-.194.451-.293.707-.293.255 0 .512.099.707.293l7.071 7.073c.196.195.293.451.293.708 0 .256-.097.511-.293.707l-11.216 11.219h5.514v2h-12.343zm3.657-2l-5.486-5.486-1.419 1.414 4.076 4.072h2.829zm.456-11.429l-4.528 4.528 5.658 5.659 4.527-4.53-5.657-5.657z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="move" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12 10c1.104 0 2 .896 2 2s-.896 2-2 2-2-.896-2-2 .896-2 2-2zm-3.857 3c-.084-.321-.143-.652-.143-1s.059-.679.143-1h-2.143v-4l-6 5 6 5v-4h2.143zm7.714-2c.084.321.143.652.143 1s-.059.679-.143 1h2.143v4l6-5-6-5v4h-2.143zm-2.857 4.857c-.321.084-.652.143-1 .143s-.679-.059-1-.143v2.143h-4l5 6 5-6h-4v-2.143zm-2-7.714c.321-.084.652-.143 1-.143s.679.059 1 .143v-2.143h4l-5-6-5 6h4v2.143z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="caret-down" viewBox="0 0 8 5">\n\t\t\t\t<path d="M0 0h8L4 5 0 0z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="caret-right" viewBox="0 0 8 12">\n\t\t\t\t<path d="M0 12V0l8 6-8 6z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="websolute" viewBox="0 0 20 20">\n\t\t\t\t<path d="M20 10c0 5.5-4.5 10-10 10S0 15.5 0 10 4.5 0 10 0s10 4.5 10 10m-10 2.3c.5.5 1.3.8 2.1.8s1.5-.3 2.1-.8c.5-.5.8-1.2.8-2V7.5h-1.7v2.8c0 .3-.1.6-.4.8-.1.1-.3.2-.4.3-.2.1-.3.1-.5.1s-.3 0-.5-.1c-.1-.1-.3-.2-.4-.3-.2-.2-.4-.5-.4-.8V7.6H9.2v2.8c0 .3-.1.6-.4.9-.2.2-.5.4-.8.4-.3 0-.7-.1-.9-.3-.2-.2-.4-.5-.3-.8V7.5H5v2.8c0 .7.3 1.5.8 2 .6.5 1.3.8 2.1.8.8.1 1.6-.2 2.1-.8z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="search" viewBox="0 0 21 23">\n\t\t\t\t<path d="M20.6 20.3l-4.9-5.2c1.2-1.7 1.8-3.7 1.8-5.7 0-5.2-3.9-9.4-8.7-9.4S0 4.2 0 9.4s3.7 7.8 6.3 8.4c1.8.4 3.9.6 7.1-.7l5.1 5.4c.5.6 1.4.6 2 .1l.1-.1c.5-.6.5-1.6 0-2.2zM15 9.4c-.2 3.5-3.2 6.1-6.7 5.8S2.2 12 2.5 8.5c.2-3.3 3-5.8 6.3-5.8 3.5.1 6.3 3.1 6.2 6.7z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="result-indicator" viewBox="0 0 24 24">\n\t\t\t\t<path d="M11 21.883l-6.235-7.527-.765.644 7.521 9 7.479-9-.764-.645-6.236 7.529v-21.884h-1v21.883z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="bullet" viewBox="0 0 18 18">\n\t\t\t\t<path d="M9 2c3.9 0 7 3.1 7 7s-3.1 7-7 7-7-3.1-7-7 3.1-7 7-7m0-2C4 0 0 4 0 9s4 9 9 9 9-4 9-9-4-9-9-9z" opacity=".15" fill="#17265a"></path>\n\t\t\t\t<circle cx="9" cy="9" r="4" fill="#17265a"></circle>\n\t\t\t</symbol>\n\t\t\t<symbol id="play" viewBox="0 0 16 20">\n\t\t\t\t<path d="M0,0v19.8l15.4-11L0,0z" fill-rule="evenodd" clip-rule="evenodd" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="play-progress" viewBox="0 0 196 196">\n\t\t\t\t<path d="M195.5,98c0,53.8-43.7,97.5-97.5,97.5S0.5,151.8,0.5,98S44.2,0.5,98,0.5S195.5,44.2,195.5,98z" stroke-width="2px" stroke-linecap="square" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="pause" viewBox="0 0 16 20">\n\t\t\t\t<path d="M0 0.9H4V18.9H0z"></path>\n\t\t\t\t<path d="M11.4 0.9H15.4V18.9H11.4z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="wishlist-add" viewBox="0 0 25 20">\n\t\t\t\t<path d="M12.5,20.8c-0.3,0-0.5-0.1-0.8-0.3c-0.3-0.2-0.6-0.4-0.9-0.6c-0.7-0.5-1.4-0.9-2.1-1.5 c-1.1-0.8-2.1-1.6-3.1-2.4C4.2,15,3,13.8,1.9,12.4c-0.9-1.1-1.4-2.3-1.7-3.7C0.1,8.5,0.1,8.2,0,7.9l0-0.2l0.1-1.4 c0-0.1,0.1-0.3,0.1-0.4c0.1-0.3,0.1-0.7,0.3-1c0.6-1.7,1.8-3.2,3.4-4c1.5-0.8,3.3-1.1,5-0.8c1.4,0.2,2.6,0.8,3.7,1.7 c2.9-2.4,7.2-2.4,10,0.1c1.1,0.9,1.9,2.2,2.2,3.5c0.1,0.3,0.1,0.6,0.2,0.8L25,6.7l-0.1,1.4c-0.2,1.2-0.6,2.4-1.2,3.4 c-0.5,0.8-1.1,1.6-1.8,2.3c-0.8,0.9-1.7,1.7-2.6,2.5c-0.7,0.6-1.6,1.3-2.6,2c-0.8,0.5-1.5,1.1-2.3,1.6c-0.4,0.3-0.8,0.5-1.2,0.8 C13.1,20.8,12.8,20.8,12.5,20.8z M2.1,7.6c0,0.2,0.1,0.4,0.1,0.6c0.2,1.1,0.7,2,1.4,2.9c1,1.2,2.1,2.3,3.3,3.3c1,0.8,2,1.6,3,2.4 c0.7,0.5,1.4,0.9,2.1,1.4l0.5,0.3c0.2-0.2,0.5-0.3,0.7-0.5c0.8-0.5,1.5-1,2.3-1.6c0.9-0.7,1.8-1.4,2.5-1.9c0.9-0.7,1.7-1.5,2.4-2.3 c0.6-0.6,1.1-1.2,1.5-1.9c0.5-0.8,0.8-1.7,0.9-2.6c0-0.1,0-0.1,0-0.2l0-0.9c0-0.2-0.1-0.4-0.1-0.6c-0.3-1-0.8-1.9-1.6-2.5 c-2.1-1.8-5.2-1.8-7.3,0c-0.1,0.1-0.3,0.2-0.4,0.4l-0.9,1.2l-1-1.3c-0.8-0.8-1.9-1.4-3-1.6C7.2,2,5.9,2.2,4.9,2.8 c-1.1,0.6-2,1.6-2.4,2.8C2.4,5.9,2.3,6.1,2.3,6.4c0,0.1-0.1,0.3-0.1,0.4l0,0L2.1,7.6L2.1,7.6z" clip-rule="evenodd" fill-rule="evenodd" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="wishlist-added" viewBox="0 0 25 20">\n\t\t\t\t<path d="M12.5,20.8c-0.3,0-0.5-0.1-0.8-0.3c-0.3-0.2-0.6-0.4-0.9-0.6c-0.7-0.5-1.4-0.9-2.1-1.5 c-1.1-0.8-2.1-1.6-3.1-2.4c-1.4-1-2.6-2.2-3.7-3.6C1,11.3,0.5,10.1,0.2,8.7C0.1,8.5,0.1,8.2,0,7.9V7.7l0.1-1.4 c0-0.1,0.1-0.3,0.1-0.4c0.1-0.3,0.1-0.7,0.3-1c0.6-1.7,1.8-3.2,3.4-4c1.5-0.8,3.3-1.1,5-0.8c1.4,0.2,2.6,0.8,3.7,1.7 c2.9-2.4,7.2-2.4,10,0.1c1.1,0.9,1.9,2.2,2.2,3.5C24.9,5.7,24.9,6,25,6.2v0.5l-0.1,1.4c-0.2,1.2-0.6,2.4-1.2,3.4 c-0.5,0.8-1.1,1.6-1.8,2.3c-0.8,0.9-1.7,1.7-2.6,2.5c-0.7,0.6-1.6,1.3-2.6,2c-0.8,0.5-1.5,1.1-2.3,1.6c-0.4,0.3-0.8,0.5-1.2,0.8 C13.1,20.8,12.8,20.8,12.5,20.8z" clip-rule="evenodd" fill-rule="evenodd" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="wishlist" viewBox="0 0 16 14">\n\t\t\t\t<path d="M8,14c-0.2,0-0.3-0.1-0.5-0.2l-0.6-0.4c-0.5-0.3-0.9-0.6-1.4-1c-0.7-0.5-1.4-1.1-2-1.6 c-0.9-0.7-1.6-1.6-2.3-2.5C0.7,7.6,0.3,6.8,0.1,5.9c0-0.2-0.1-0.4-0.1-0.5l0-0.1l0-1c0-0.1,0-0.2,0.1-0.3c0.1-0.2,0.1-0.4,0.2-0.7 c0.4-1.1,1.2-2.1,2.2-2.7c1.8-1,4-0.8,5.5,0.6c1.8-1.6,4.6-1.6,6.4,0.1c0.7,0.6,1.2,1.5,1.4,2.4C15.9,3.8,15.9,4,16,4.2l0,0.3l0,0.9 c-0.1,0.8-0.4,1.6-0.8,2.3c-0.3,0.5-0.7,1-1.1,1.5c-0.5,0.6-1.1,1.1-1.7,1.7c-0.4,0.4-1,0.9-1.7,1.3c-0.5,0.4-1,0.7-1.5,1.1 c-0.2,0.2-0.5,0.3-0.7,0.5C8.4,13.9,8.2,14,8,14z M1.4,5.1c0,0.1,0.1,0.3,0.1,0.4c0.1,0.7,0.4,1.4,0.9,1.9C2.9,8.3,3.6,9,4.4,9.7 c0.6,0.5,1.3,1.1,1.9,1.6c0.4,0.3,0.9,0.6,1.3,0.9c0.1,0.1,0.2,0.2,0.3,0.2c0.2-0.1,0.3-0.2,0.5-0.3c0.5-0.3,1-0.7,1.5-1 c0.6-0.4,1.2-0.9,1.6-1.3c0.5-0.5,1.1-1,1.5-1.5c0.4-0.4,0.7-0.8,1-1.3c0.3-0.5,0.5-1.1,0.6-1.7c0,0,0-0.1,0-0.1l0-0.6 c0-0.1,0-0.3-0.1-0.4c-0.2-0.7-0.5-1.2-1-1.7c-1.3-1.2-3.4-1.2-4.7,0C8.7,2.4,8.6,2.5,8.5,2.6L8,3.4L7.3,2.5 C6.3,1.4,4.5,1.1,3.1,1.9C2.4,2.3,1.8,3,1.6,3.8C1.5,3.9,1.5,4.1,1.4,4.3L1.4,4.6l0,0L1.4,5.1L1.4,5.1z" clip-rule="evenodd" fill-rule="evenodd" ></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="expand" viewBox="0 0 29 30">\n\t\t\t\t<path d="M26 16.3V5.9L2.2 29.7.1 27.6 24 3.3H13v-3h16v16h-3z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="download" viewBox="0 0 9 13">\n\t\t\t\t<path d="M8.5 7.9c-.3-.4-.8-.4-1.2-.1l-.1.1-2 2V1.2c0-.2-.1-.4-.2-.6-.2-.3-.7-.3-1 0-.2.2-.3.4-.3.6v8.6l-2-2c-.2-.1-.4-.2-.7-.2-.2 0-.4.1-.6.3-.1.2-.1.4-.1.6 0 .2.1.4.2.5l3.4 3.4c.2.2.4.2.6.2.2 0 .4-.1.6-.2L8.4 9c.2-.1.2-.3.3-.6 0-.1-.1-.4-.2-.5z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="upload" viewBox="0 0 24 24">\n\t\t\t\t<path d="M10 9H4l8-9 8 9h-6v11h-4V9zm11 11v2H3v-2H1v4h22v-4h-2z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="user" viewBox="0 0 24 24">\n\t\t\t\t<path d="M20.822 18.096c-3.439-.794-6.64-1.49-5.09-4.418C20.452 4.766 16.983 0 12 0 6.918 0 3.536 4.949 8.268 13.678c1.597 2.945-1.725 3.641-5.09 4.418C.105 18.806-.01 20.332 0 23l.004 1h23.99l.004-.969c.012-2.688-.092-4.222-3.176-4.935z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="back" viewBox="0 0 24 24">\n\t\t\t\t<path d="M2.117 12l7.527 6.235L9 19l-9-7.521L9 4l.645.764L2.116 11H24v1H2.117z" fill-rule="evenodd" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="add" viewBox="0 0 24 24">\n\t\t\t\t<path d="M24 10h-10v-10h-4v10h-10v4h10v10h4v-10h10z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="remove" viewBox="0 0 24 24">\n\t\t\t\t<path d="M0 10h24v4h-24z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="link" viewBox="0 0 24 24">\n\t\t\t\t<path d="M6.188 8.719c.439-.439.926-.801 1.444-1.087 2.887-1.591 6.589-.745 8.445 2.069l-2.246 2.245c-.644-1.469-2.243-2.305-3.834-1.949-.599.134-1.168.433-1.633.898l-4.304 4.306c-1.307 1.307-1.307 3.433 0 4.74 1.307 1.307 3.433 1.307 4.74 0l1.327-1.327c1.207.479 2.501.67 3.779.575l-2.929 2.929c-2.511 2.511-6.582 2.511-9.093 0s-2.511-6.582 0-9.093l4.304-4.306zm6.836-6.836l-2.929 2.929c1.277-.096 2.572.096 3.779.574l1.326-1.326c1.307-1.307 3.433-1.307 4.74 0 1.307 1.307 1.307 3.433 0 4.74l-4.305 4.305c-1.311 1.311-3.44 1.3-4.74 0-.303-.303-.564-.68-.727-1.051l-2.246 2.245c.236.358.481.667.796.982.812.812 1.846 1.417 3.036 1.704 1.542.371 3.194.166 4.613-.617.518-.286 1.005-.648 1.444-1.087l4.304-4.305c2.512-2.511 2.512-6.582.001-9.093-2.511-2.51-6.581-2.51-9.092 0z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="up" viewBox="0 0 24 24">\n\t\t\t\t<path d="M7 11h-6l11-11 11 11h-6v13h-10z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="down" viewBox="0 0 24 24">\n\t\t\t\t<path d="M17,13h6L12,24L1,13h6V0h10V13z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="waiting-room" viewBox="0 0 24 24">\n\t\t\t\t<path d="M2,6c0-2.2,1.8-4,4-4h12c2.2,0,4,1.8,4,4v12c0,2.2-1.8,4-4,4H6c-2.2,0-4-1.8-4-4V6z" opacity=".2"></path>\n\t\t\t\t<path d="M17.8,10.7c0.7,0,1.3,0.6,1.3,1.3s-0.6,1.3-1.3,1.3H6.2c-0.7,0-1.3-0.6-1.3-1.3s0.6-1.3,1.3-1.3H17.8z M19.7,12 c0-1.1-0.9-1.9-1.9-1.9H6.2c-1.1,0-1.9,0.9-1.9,1.9s0.9,1.9,1.9,1.9h11.6C18.9,13.9,19.7,13.1,19.7,12z M13.9,11.4H6.2 c-0.4,0-0.6,0.3-0.6,0.6s0.3,0.6,0.6,0.6h7.7c0.4,0,0.6-0.3,0.6-0.6S14.3,11.4,13.9,11.4z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="panorama" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 9 15 C 9 14.448 9.448 14 10 14 L 14 14 C 14.552 14 15 14.448 15 15 L 15 16 C 15 16.552 14.552 17 14 17 L 10 17 C 9.448 17 9 16.552 9 16 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path>\n\t\t\t\t<path d="M 7 8 C 7 7.448 7.448 7 8 7 L 16 7 C 16.552 7 17 7.448 17 8 L 17 12 C 17 12.552 16.552 13 16 13 L 8 13 C 7.448 13 7 12.552 7 12 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="panorama-grid" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 7.333 8.333 C 7.333 7.781 7.781 7.333 8.333 7.333 L 10.333 7.333 C 10.886 7.333 11.333 7.781 11.333 8.333 L 11.333 10.333 C 11.333 10.886 10.886 11.333 10.333 11.333 L 8.333 11.333 C 7.781 11.333 7.333 10.886 7.333 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path>\n\t\t\t\t<path d="M 12.333 8.333 C 12.333 7.781 12.781 7.333 13.333 7.333 L 15.333 7.333 C 15.886 7.333 16.333 7.781 16.333 8.333 L 16.333 10.333 C 16.333 10.886 15.886 11.333 15.333 11.333 L 13.333 11.333 C 12.781 11.333 12.333 10.886 12.333 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path>\n\t\t\t\t<path d="M 7.333 13.667 C 7.333 13.114 7.781 12.667 8.333 12.667 L 10.333 12.667 C 10.886 12.667 11.333 13.114 11.333 13.667 L 11.333 15.667 C 11.333 16.219 10.886 16.667 10.333 16.667 L 8.333 16.667 C 7.781 16.667 7.333 16.219 7.333 15.667 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t\t<path d="M 12.333 13.667 C 12.333 13.114 12.781 12.667 13.333 12.667 L 15.333 12.667 C 15.886 12.667 16.333 13.114 16.333 13.667 L 16.333 15.667 C 16.333 16.219 15.886 16.667 15.333 16.667 L 13.333 16.667 C 12.781 16.667 12.333 16.219 12.333 15.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="room-3d" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 6.6 9.056 C 6.6 8.533 6.905 8.059 7.381 7.842 L 8.995 7.108 C 9.436 6.907 9.938 7.23 9.938 7.715 L 9.938 16.272 C 9.938 16.757 9.436 17.08 8.995 16.879 L 7.381 16.145 C 6.905 15.928 6.6 15.454 6.6 14.931 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 10.754 7.453 C 10.754 6.795 11.378 6.316 12.014 6.487 L 16.32 7.647 C 17.193 7.882 17.8 8.674 17.8 9.578 L 17.8 14.105 C 17.8 15.009 17.193 15.801 16.32 16.036 L 12.014 17.196 C 11.378 17.367 10.754 16.889 10.754 16.231 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="model" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path>\n\t\t\t\t<path d="M 11.298 7.283 C 11.602 6.729 12.398 6.729 12.702 7.283 L 14.009 9.673 C 14.082 9.807 14.193 9.918 14.327 9.991 L 16.717 11.298 C 17.271 11.602 17.271 12.398 16.717 12.702 L 14.327 14.009 C 14.193 14.082 14.082 14.193 14.009 14.327 L 12.702 16.717 C 12.398 17.271 11.602 17.271 11.298 16.717 L 9.991 14.327 C 9.918 14.193 9.807 14.082 9.673 14.009 L 7.283 12.702 C 6.729 12.398 6.729 11.602 7.283 11.298 L 9.673 9.991 C 9.807 9.918 9.918 9.807 9.991 9.673 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="media" viewBox="0 0 24 24">\n\t\t\t\t<path d="M2,6c0-2.2,1.8-4,4-4h12c2.2,0,4,1.8,4,4v12c0,2.2-1.8,4-4,4H6c-2.2,0-4-1.8-4-4V6z" fill="var(--svg-icon-tint)" opacity="0.3"></path>\n\t\t\t\t<path d="M12,19c-2.2,0-4.3-1-5.6-2.7L7,15.9c1.2,1.5,3,2.4,5,2.4c1.9,0,3.8-0.9,5-2.4l0.6,0.4C16.3,18,14.2,19,12,19z M5.5,14.7C5.2,13.8,5,12.8,5,12c0-3.5,2.7-6.5,6.2-7v0.6C8,6.1,5.7,8.8,5.7,12c0,0.8,0.1,1.5,0.4,2.4L5.5,14.7z M18,14.4 c0.3-0.8,0.4-1.6,0.4-2.4c0-3.2-2.3-5.9-5.5-6.4c0-0.2,0-0.5,0-0.6c3.5,0.4,6.2,3.4,6.2,7c0,0.8-0.2,1.8-0.5,2.7L18,14.4z" fill="var(--svg-icon-tint)" opacity="0.3"></path>\n\t\t\t\t<path d="M10.2,15V8.9l5.5,3.1L10.2,15z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="nav" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 6.5 8.667 C 6.5 8.114 6.948 7.667 7.5 7.667 L 16.5 7.667 C 17.052 7.667 17.5 8.114 17.5 8.667 L 17.5 14.495 C 17.5 15.046 17.053 15.494 16.502 15.495 L 14.189 15.499 C 13.959 15.5 13.736 15.58 13.558 15.725 L 12.211 16.827 C 12.088 16.928 11.912 16.928 11.789 16.827 L 10.442 15.725 C 10.264 15.58 10.041 15.5 9.811 15.499 L 7.498 15.495 C 6.947 15.494 6.5 15.046 6.5 14.495 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="plane" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 2 1 L 1 0 L 0 1" transform="translate(4.667 11.5) rotate(-90 1 0.5)" fill="transparent" opacity="0.4" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path>\n\t\t\t\t<path d="M 2 1 L 1 0 L 0 1" transform="translate(17.333 11.5) rotate(90 1 0.5)" fill="transparent" opacity="0.4" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path>\n\t\t\t\t<path d="M 8 9 C 8 8.448 8.448 8 9 8 L 15 8 C 15.552 8 16 8.448 16 9 L 16 15 C 16 15.552 15.552 16 15 16 L 9 16 C 8.448 16 8 15.552 8 15 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="curved-plane" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 2 1 L 1 0 L 0 1" transform="translate(4.667 11.5) rotate(-90 1 0.5)" fill="transparent" opacity="0.4" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path>\n\t\t\t\t<path d="M 2 1 L 1 0 L 0 1" transform="translate(17.333 11.5) rotate(90 1 0.5)" fill="transparent" opacity="0.4" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path>\n\t\t\t\t<path d="M 8 9 C 8 8.448 8.448 8 9 8 L 15 8 C 15.552 8 16 8.448 16 9 L 16 15 C 16 15.552 15.552 16 15 16 L 9 16 C 8.448 16 8 15.552 8 15 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="texture" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 7.333 8.95 C 7.333 8.274 7.839 7.705 8.511 7.626 L 14.805 6.886 C 15.796 6.769 16.667 7.543 16.667 8.541 L 16.667 15.49 C 16.667 16.477 15.814 17.247 14.833 17.148 L 8.533 16.513 C 7.852 16.444 7.333 15.871 7.333 15.187 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="gltf" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path>\n\t\t\t\t<path d="M 11.298 7.283 C 11.602 6.729 12.398 6.729 12.702 7.283 L 14.009 9.673 C 14.082 9.807 14.193 9.918 14.327 9.991 L 16.717 11.298 C 17.271 11.602 17.271 12.398 16.717 12.702 L 14.327 14.009 C 14.193 14.082 14.082 14.193 14.009 14.327 L 12.702 16.717 C 12.398 17.271 11.602 17.271 11.298 16.717 L 9.991 14.327 C 9.918 14.193 9.807 14.082 9.673 14.009 L 7.283 12.702 C 6.729 12.398 6.729 11.602 7.283 11.298 L 9.673 9.991 C 9.807 9.918 9.918 9.807 9.991 9.673 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="tile" viewBox="0 0 24 24">\n\t\t\t\t<path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path>\n\t\t\t\t<path d="M 15.667 13 C 17.139 13 18.333 14.194 18.333 15.667 C 18.333 17.139 17.139 18.333 15.667 18.333 C 14.194 18.333 13 17.139 13 15.667 C 13 14.194 14.194 13 15.667 13 Z" fill="var(--svg-icon-tint)"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="image" viewBox="0 0 24 24">\n\t\t\t\t<path d="M5 8.5c0-.828.672-1.5 1.5-1.5s1.5.672 1.5 1.5c0 .829-.672 1.5-1.5 1.5s-1.5-.671-1.5-1.5zm9 .5l-2.519 4-2.481-1.96-4 5.96h14l-5-8zm8-4v14h-20v-14h20zm2-2h-24v18h24v-18z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="video" viewBox="0 0 24 24">\n\t\t\t\t<path d="M2.184 7.874l-2.184-.918 2.967-2.956.933 2.164-1.716 1.71zm21.816 2.126l-3 2v4l3 2v-8zm-7-2h-7.018l.79.787c.356.355.629.769.831 1.213h4.897c.276 0 .5.224.5.5v7c0 .276-.224.5-.5.5h-11c-.276 0-.5-.224-.5-.5v-2.909l-.018-.014-1.982-1.975v5.398c0 1.104.896 2 2 2h12c1.104 0 2-.896 2-2v-8c0-1.104-.896-2-2-2zm-14.65 1.13l2.967-2.956 4.044 4.029c.819.816.819 2.14 0 2.956-.819.816-2.147.815-2.967 0l-4.044-4.029z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="stream" viewBox="0 0 24 24">\n\t\t\t\t<path d="M6.613 18.581m9.387-9.581c0 2.209-1.791 4-4 4s-4-1.791-4-4 1.791-4 4-4 4 1.791 4 4zm-2 0c0-1.103-.896-2-2-2s-2 .897-2 2 .896 2 2 2 2-.897 2-2zm-9 0c0 3.86 3.141 7 7 7s7-3.14 7-7-3.141-7-7-7-7 3.14-7 7zm16 0c0 4.97-4.029 9-9 9s-9-4.03-9-9 4.029-9 9-9 9 4.03 9 9zm-.404 12.501c1.007 1.142-.014 2.679-1.448 2.481-1.795-.245-3.236-1.702-7.147-1.702-3.91 0-5.352 1.458-7.146 1.702-1.436.198-2.456-1.34-1.449-2.481l2.898-3.289c.559.388 1.156.725 1.79.994l-2.025 2.298c1.295-.524 3.065-1.225 5.933-1.225s4.638.7 5.933 1.224l-2.025-2.298c.634-.27 1.231-.606 1.79-.994l2.896 3.29z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="spinner" viewBox="0 0 24 24">\n\t\t\t\t<path d="M8.175 7.377l-3.042-5.27 1.732-1 3.045 5.273c-.635.238-1.222.573-1.735.997zm-.799.8l-5.27-3.042-1 1.732 5.274 3.045c.237-.635.572-1.223.996-1.735zm-1.376 3.823c0-.341.035-.673.09-.999h-6.09v1.999h6.09c-.055-.326-.09-.659-.09-1zm11.351-2.705l5.208-3.007-.333-.577-5.206 3.007c.121.185.23.379.331.577zm-5.351-3.295c.341 0 .673.035.999.09v-6.09h-1.999v6.09c.326-.055.659-.09 1-.09zm3.14.894l3.004-5.204-.288-.166-3 5.197.284.173zm1.685 8.662l5.234 3.022.666-1.154-5.229-3.019c-.181.41-.408.794-.671 1.151zm-10.444-1.467l-5.274 3.046 1 1.732 5.27-3.042c-.424-.513-.759-1.1-.996-1.736zm11.594-2.589l.025.5-.025.5h6.025v-1h-6.025zm-3.727 6.061l3.03 5.249 1.442-.833-3.031-5.25c-.437.34-.92.623-1.441.834zm-2.248.439c-.341 0-.674-.035-1-.09v6.09h1.999v-6.09c-.326.055-.658.09-.999.09zm-3.824-1.376l-3.042 5.27 1.732 1 3.045-5.274c-.635-.237-1.222-.572-1.735-.996z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="update" viewBox="0 0 24 24">\n\t\t\t\t<path d="M23 12c0 1.042-.154 2.045-.425 3h-2.101c.335-.94.526-1.947.526-3 0-4.962-4.037-9-9-9-1.706 0-3.296.484-4.655 1.314l1.858 2.686h-6.994l2.152-7 1.849 2.673c1.684-1.049 3.659-1.673 5.79-1.673 6.074 0 11 4.925 11 11zm-6.354 7.692c-1.357.826-2.944 1.308-4.646 1.308-4.962 0-9-4.038-9-9 0-1.053.191-2.06.525-3h-2.1c-.271.955-.425 1.958-.425 3 0 6.075 4.925 11 11 11 2.127 0 4.099-.621 5.78-1.667l1.853 2.667 2.152-6.989h-6.994l1.855 2.681z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="edit" viewBox="0 0 24 24">\n\t\t\t\t<path d="M0 1h24v2h-24v-2zm11 7h13v-2h-13v2zm0 5h13v-2h-13v2zm0 5h13v-2h-13v2zm-11 5h24v-2h-24v2zm8-17l-8 6 8 6v-12z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="lock" viewBox="0 0 24 24">\n\t\t\t\t<path d="M18 10v-4c0-3.313-2.687-6-6-6s-6 2.687-6 6v4h-3v14h18v-14h-3zm-10 0v-4c0-2.206 1.794-4 4-4s4 1.794 4 4v4h-8z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="volume-off" viewBox="0 0 24 24">\n\t\t\t\t<path d="M5 17h-5v-10h5v10zm2-10v10l9 5v-20l-9 5zm15.324 4.993l1.646-1.659-1.324-1.324-1.651 1.67-1.665-1.648-1.316 1.318 1.67 1.657-1.65 1.669 1.318 1.317 1.658-1.672 1.666 1.653 1.324-1.325-1.676-1.656z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="volume-on" viewBox="0 0 24 24">\n\t\t\t\t<path d="M5 17h-5v-10h5v10zm2-10v10l9 5v-20l-9 5zm11.008 2.093c.742.743 1.2 1.77 1.198 2.903-.002 1.133-.462 2.158-1.205 2.9l1.219 1.223c1.057-1.053 1.712-2.511 1.715-4.121.002-1.611-.648-3.068-1.702-4.125l-1.225 1.22zm2.142-2.135c1.288 1.292 2.082 3.073 2.079 5.041s-.804 3.75-2.096 5.039l1.25 1.254c1.612-1.608 2.613-3.834 2.616-6.291.005-2.457-.986-4.681-2.595-6.293l-1.254 1.25z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="fullscreen-off" viewBox="0 0 24 24">\n\t\t\t\t<path d="M15 2h2v5h7v2h-9v-7zm9 13v2h-7v5h-2v-7h9zm-15 7h-2v-5h-7v-2h9v7zm-9-13v-2h7v-5h2v7h-9z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="fullscreen-on" viewBox="0 0 24 24">\n\t\t\t\t<path d="M24 9h-2v-7h-7v-2h9v9zm-9 15v-2h7v-7h2v9h-9zm-15-9h2v7h7v2h-9v-9zm9-15v2h-7v7h-2v-9h9z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="navmap" viewBox="0 0 24 24">\n\t\t\t\t<path d="M24 22.586l-2.823-2.823c.526-.792.836-1.74.836-2.763 0-2.762-2.238-5-5-5s-5 2.238-5 5 2.238 5 5 5c1.016 0 1.957-.307 2.746-.827l2.827 2.827 1.414-1.414zm-9.987-5.586c0-1.654 1.346-3 3-3s3 1.346 3 3-1.346 3-3 3-3-1.346-3-3zm-4 0l.002-.034-3.015 2.175v-13.068l4-2.886v10.247c.508-.854 1.189-1.591 2-2.161v-8.086l4 2.886v3.927h.013c.336 0 .664.032.987.078v-4.007l4-2.479v8.504c1.188 1.208 1.936 2.844 2 4.653v-16.749l-6.455 4-5.545-4-5.545 4-6.455-4v18l6.455 4 3.91-2.82c-.226-.687-.352-1.419-.352-2.18zm-4.013 2.365l-4-2.479v-13.294l4 2.479v13.294z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="screen" viewBox="0 0 24 24">\n\t\t\t\t<path d="M0 0v19h24v-19h-24zm22 14h-20v-12h20v12zm-6.599 7l2.599 3h-12l2.599-3h6.802z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="chat" viewBox="0 0 24 24">\n\t\t\t\t<path d="M22 3v13h-11.643l-4.357 3.105v-3.105h-4v-13h20zm2-2h-24v16.981h4v5.019l7-5.019h13v-16.981z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="send" viewBox="0 0 24 24">\n\t\t\t\t<path d="M22 12l-20 12 5-12-5-12z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="users" viewBox="0 0 24 24">\n\t\t\t\t<path d="M10.644 17.08c2.866-.662 4.539-1.241 3.246-3.682-3.932-7.427-1.042-11.398 3.111-11.398 4.235 0 7.054 4.124 3.11 11.398-1.332 2.455.437 3.034 3.242 3.682 2.483.574 2.647 1.787 2.647 3.889v1.031h-18c0-2.745-.22-4.258 2.644-4.92zm-12.644 4.92h7.809c-.035-8.177 3.436-5.313 3.436-11.127 0-2.511-1.639-3.873-3.748-3.873-3.115 0-5.282 2.979-2.333 8.549.969 1.83-1.031 2.265-3.181 2.761-1.862.43-1.983 1.34-1.983 2.917v.773z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="virtual-tour" viewBox="0 0 24 24">\n\t\t\t\t<path d="M17 17h-10v-10h10v10zm7 3l-5-3v-10l5-3v16zm-24-16l5 3v10l-5 3v-16z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="live-meeting" viewBox="0 0 24 24">\n\t\t\t\t<path d="M18 18h6v6h-6v-6zm-9 6h6v-6h-6v6zm-9 0h6v-6h-6v6zm0-8h24v-16h-24v16z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="control" viewBox="0 0 24 24">\n\t\t\t\t<circle cx="7" cy="10" r="1"></circle>\n\t\t\t\t<path d="M17,3H7c-3.9,0-7,3.1-7,7v6c0,2.8,2.2,5,5,5c2.4,0,4.4-1.7,4.9-4h4.2c0.5,2.7,3.2,4.5,5.9,3.9c2.3-0.5,4-2.5,4-4.9v-6 C24,6.1,20.9,3,17,3z M17,7c0.6,0,1,0.4,1,1s-0.4,1-1,1s-1-0.4-1-1S16.4,7,17,7z M7,13c-1.7,0-3-1.3-3-3s1.3-3,3-3s3,1.3,3,3 S8.7,13,7,13z M15,11c-0.6,0-1-0.4-1-1s0.4-1,1-1s1,0.4,1,1S15.6,11,15,11z M17,13c-0.6,0-1-0.4-1-1c0-0.6,0.4-1,1-1s1,0.4,1,1 C18,12.5,17.6,13,17,13z M19,11c-0.6,0-1-0.4-1-1s0.4-1,1-1s1,0.4,1,1S19.6,11,19,11z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="spy" viewBox="0 0 24 24">\n\t\t\t\t<path fill-rule="evenodd" d="M0.2,11.4c5.2-8.6,18.3-8.5,23.6,0c0.2,0.3,0.2,0.8,0,1.2c-5.3,8.4-18.4,8.6-23.6,0 C-0.1,12.2-0.1,11.7,0.2,11.4z M12,7.8c2.3,0,4.2,1.9,4.2,4.3s-1.9,4.2-4.2,4.2S7.8,14.3,7.8,12S9.7,7.8,12,7.8z" clip-rule="evenodd"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="joystick" viewBox="0 0 24 24">\n\t\t\t\t<path d="M10.7,10.5V16H9.3C8.6,16,8,16.6,8,17.3h8c0-0.7-0.6-1.3-1.3-1.3h-1.3v-5.5c2.8-0.7,4.5-3.6,3.8-6.5 c-0.7-2.8-3.6-4.5-6.5-3.8S6.1,3.9,6.9,6.7C7.3,8.6,8.8,10,10.7,10.5z"></path>\n\t\t\t\t<path d="M1.4,18.6h21.2c0.7,0,1.3,0.6,1.3,1.3v2.7c0,0.7-0.6,1.3-1.3,1.3H1.4c-0.7,0-1.3-0.6-1.3-1.3V20 C0.1,19.2,0.7,18.6,1.4,18.6z"></path>\n\t\t\t</symbol>\n\t\t\t<symbol id="navinfo" viewBox="0 0 24 24">\n\t\t\t\t<path d="M12,2c5.5,0,10,4.5,10,10s-4.5,10-10,10S2,17.5,2,12S6.5,2,12,2z M12,0C5.4,0,0,5.4,0,12s5.4,12,12,12s12-5.4,12-12 S18.6,0,12,0z"/>\n\t\t\t\t<path d="M13,18h-2v-8h2V18z M12,5.8c0.7,0,1.2,0.6,1.2,1.2S12.7,8.2,12,8.2S10.8,7.7,10.8,7S11.3,5.8,12,5.8z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="check" viewBox="0 0 24 24">\n\t\t\t\t<path d="M9,21l-9-8.6l2.8-2.9l6.2,5.9L21.2,3L24,5.8L9,21z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="duplicate" viewBox="0 0 24 24">\n\t\t\t\t<path d="M18,6V0H0v18h6v6h18V6H18z M6,16H2V2h14v4H6V16z M22,22H8V8h14V22z M19,14h-3v-3h-2v3h-3v2h3v3h2v-3h3V14z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="trash" viewBox="0 0 24 24">\n\t\t\t\t<path fill-rule="evenodd" d="M19,24H5c-1.1,0-2-0.9-2-2V5H2V3h6V1.5C8,0.7,8.7,0,9.5,0h5C15.3,0,16,0.7,16,1.5V3h6v2h-1v17 C21,23.1,20.1,24,19,24z M19,5H5v16.5C5,21.8,5.2,22,5.5,22h13c0.3,0,0.5-0.2,0.5-0.5V5z M10,9c0-0.6-0.4-1-1-1S8,8.4,8,9v9 c0,0.6,0.4,1,1,1s1-0.4,1-1V9z M16,9c0-0.6-0.4-1-1-1s-1,0.4-1,1v9c0,0.6,0.4,1,1,1s1-0.4,1-1V9z M14,2h-4v1h4V2z" clip-rule="evenodd"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="flags" viewBox="0 0 24 24">\n\t\t\t\t<path d="M19,18c0,1.1-0.9,2-2,2s-2-0.9-2-2s0.9-2,2-2S19,16.9,19,18z M5,15c-1.7,0-3,1.3-3,3s1.3,3,3,3h14c1.7,0,3-1.3,3-3 s-1.3-3-3-3H5z M24,18c0,2.8-2.2,5-5,5H5c-2.8,0-5-2.2-5-5s2.2-5,5-5h14C21.8,13,24,15.2,24,18z M7,4C5.9,4,5,4.9,5,6s0.9,2,2,2 s2-0.9,2-2S8.1,4,7,4z M5,3C3.3,3,2,4.3,2,6s1.3,3,3,3h14c1.7,0,3-1.3,3-3s-1.3-3-3-3H5z M24,6c0,2.8-2.2,5-5,5H5c-2.8,0-5-2.2-5-5 s2.2-5,5-5h14C21.8,1,24,3.2,24,6z"/>\n\t\t\t</symbol>\n\t\t\t<symbol id="b-here" viewBox="0 0 270 98">\n\t\t\t\t<path d="M61.5,87.9c0-2.7,0.9-5,2.8-6.9c1.9-1.9,4.2-2.8,7-2.8c1.4,0,2.7,0.2,3.9,0.8c1.2,0.5,2.2,1.2,3.2,2 c0.9,0.9,1.6,1.9,2.1,3.1s0.8,2.5,0.8,3.8s-0.2,2.6-0.8,3.8c-0.5,1.2-1.2,2.2-2.1,3.1s-1.9,1.6-3.2,2.1c-1.2,0.5-2.5,0.8-3.9,0.8 s-2.7-0.2-3.9-0.8c-1.2-0.5-2.2-1.2-3.1-2.1s-1.6-1.9-2.1-3.1S61.5,89.2,61.5,87.9z"></path>\n\t\t\t\t<path d="M16,70.2H0.7v-70H16V29c0.6-1.1,1.4-2.1,2.4-3.1s2.2-1.9,3.5-2.6s2.8-1.3,4.2-1.8c1.5-0.4,3-0.6,4.6-0.6 c3.5,0,6.7,0.6,9.6,1.9s5.4,3.1,7.4,5.3c2.1,2.2,3.7,4.9,4.8,8s1.7,6.4,1.7,10.1c0,3.6-0.6,6.9-1.7,10c-1.1,3.1-2.7,5.8-4.8,8 c-2.1,2.2-4.5,4-7.4,5.3s-6.1,2-9.6,2c-1.6,0-3.1-0.2-4.6-0.7c-1.5-0.4-2.9-1-4.2-1.7c-1.3-0.7-2.5-1.5-3.5-2.5s-1.8-2-2.4-3.1 C16,63.5,16,70.2,16,70.2z M27.6,58.5c1.7,0,3.2-0.3,4.6-1c1.4-0.7,2.6-1.5,3.6-2.7c1-1.1,1.8-2.4,2.4-3.9c0.6-1.5,0.8-3.1,0.8-4.8 s-0.3-3.2-0.8-4.7c-0.6-1.5-1.4-2.8-2.4-3.9c-1-1.1-2.2-2-3.6-2.7c-1.4-0.7-2.9-1-4.6-1s-3.3,0.3-4.8,1c-1.4,0.7-2.7,1.6-3.7,2.7 c-1,1.1-1.8,2.4-2.3,3.9c-0.6,1.5-0.8,3-0.8,4.7s0.3,3.2,0.8,4.8s1.3,2.8,2.3,3.9c1,1.1,2.2,2,3.7,2.7 C24.3,58.2,25.9,58.5,27.6,58.5z"></path>\n\t\t\t\t<path d="M64.1,0.2h14.8V29c1.3-2.5,3.3-4.5,6-6s5.9-2.2,9.6-2.2c3.1,0,5.8,0.5,7.9,1.4c2.1,1,3.9,2.3,5.2,4.1 c1.5,1.9,2.6,4,3.1,6.5s0.8,5.4,0.8,8.9v28.5H96.7V45.5c0-3.5-0.6-6.3-1.8-8.5c-1.2-2.2-3.5-3.2-6.7-3.2c-3.1,0-5.5,1.1-7,3.3 s-2.3,5.2-2.3,8.9v24.2H64.1V0.2z"></path>\n\t\t\t\t<path d="M135.9,49.8c0.1,1.5,0.3,2.9,0.7,4.2s1,2.4,1.8,3.4s1.9,1.7,3.2,2.3s3,0.8,5,0.8c2.7,0,4.7-0.5,6-1.6 c1.4-1.1,2.3-2.4,2.9-3.9h15c-0.3,2.3-1.1,4.4-2.4,6.4c-1.2,2-2.9,3.8-4.9,5.2c-2,1.5-4.4,2.7-7.2,3.5c-2.8,0.9-5.9,1.3-9.3,1.3 c-4.2,0-7.9-0.6-11.2-1.8c-3.2-1.2-6-3-8.2-5.2c-2.2-2.3-3.9-5-5-8c-1.1-3.1-1.7-6.5-1.7-10.2c0-3.5,0.5-6.8,1.6-9.9s2.7-5.8,4.9-8 c2.2-2.3,4.8-4.1,8-5.5c3.2-1.3,6.8-2,11-2c3.8,0,7.2,0.6,10.2,1.8c3,1.2,5.6,2.8,7.8,4.8s3.8,4.3,5,7s1.8,5.5,1.8,8.4 c0,1,0,2.1,0,3.2c0,1.1-0.2,2.4-0.5,3.9h-34.5V49.8z M146.2,31c-3,0-5.5,0.9-7.4,2.6c-1.9,1.7-2.9,4.2-2.9,7.5h20.2 c0-3.1-0.9-5.6-2.8-7.4C151.5,31.9,149.1,31,146.2,31z"></path>\n\t\t\t\t<path d="M216.1,36c-1.1-0.3-2-0.5-2.7-0.6c-0.7-0.1-1.6-0.1-2.7-0.1c-4.2,0-7.6,1.2-10.1,3.7s-3.8,6.6-3.8,12.5v18.8h-15.3V22h15.3 v7.8c1.1-2.3,3-4.3,5.7-6c2.6-1.7,5.6-2.6,9-2.6c1.8,0,3.3,0.3,4.6,0.8V36z"></path>\n\t\t\t\t<path d="M234.3,49.8c0.1,1.5,0.3,2.9,0.7,4.2s1,2.4,1.8,3.4s1.9,1.7,3.2,2.3s3,0.8,5,0.8c2.7,0,4.7-0.5,6-1.6 c1.4-1.1,2.3-2.4,2.9-3.9h15c-0.3,2.3-1.1,4.4-2.4,6.4c-1.2,2-2.9,3.8-4.9,5.2c-2,1.5-4.4,2.7-7.2,3.5c-2.8,0.9-5.9,1.3-9.3,1.3 c-4.2,0-7.9-0.6-11.2-1.8c-3.2-1.2-6-3-8.2-5.2c-2.2-2.3-3.9-5-5-8c-1.1-3.1-1.7-6.5-1.7-10.2c0-3.5,0.5-6.8,1.6-9.9s2.7-5.8,4.9-8 c2.2-2.3,4.8-4.1,8-5.5c3.2-1.3,6.8-2,11-2c3.8,0,7.2,0.6,10.2,1.8c3,1.2,5.6,2.8,7.8,4.8c2.2,2,3.8,4.3,5,7s1.8,5.5,1.8,8.4 c0,1,0,2.1,0,3.2c0,1.1-0.2,2.4-0.5,3.9h-34.5V49.8z M244.6,31c-3,0-5.5,0.9-7.4,2.6c-1.9,1.7-2.9,4.2-2.9,7.5h20.2 c0-3.1-0.9-5.6-2.8-7.4C249.9,31.9,247.5,31,244.6,31z"></path>\n\t\t\t</symbol>\n\t\t</svg>\n\t\n\t\t\x3c!-- header --\x3e\n\t\t<router-outlet></router-outlet>\n\t\t\x3c!-- footer --\x3e\n\t\t<div class="toast-outlet" toast-outlet></div>\n\t\t<div class="modal-outlet" modal-outlet></div>\n\t'};const ba=["bmp","gif","ico","jpeg","jpg","png","svg","tif","tiff","webp","hdr"],Ea=["mp4","avi","mpeg","ogv","ts","webm","3gp","3g2"],wa=["fbx","gltf","glb","obj","usdz"],Sa=["publisherStream","nextAttendeeStream","publisherScreen","attendeeScreen"];class Ta extends t.Pipe{static transform(t,e){if(void 0===e&&(e=null),null!=e&&(t=t.type.name===e?t:null),t){if("string"==typeof t)return D.getPath(t);switch(t.type.name){case ir.Image.name:case ir.Video.name:case ir.Model.name:t=t.folder+t.file,t=D.getPath(t);break;case ir.PublisherStream.name:case ir.AttendeeStream.name:case ir.PublisherScreen.name:case ir.AttendeeScreen.name:case ir.SmartDeviceStream.name:t=D.getPath(t.file);break;default:n=t.file,new RegExp(`/.(${ba.join("|")})$/i`).test(n)||function(t){return new RegExp(`/.(${Ea.join("|")})$/i`).test(t)}(t.file)?(t=t.folder+t.file,t=D.getPath(t)):!function(t){return new RegExp(`/.(${wa.join("|")})$/i`).test(t)}(t.file)?function(t){return-1!==Sa.indexOf(t)}(t.file)&&(t=t.file):(t=t.folder+t.file,t=D.getPath(t))}}else t=null;var n;return t}}Ta.meta={name:"asset"};class Ca extends t.Component{onInit(){super.onInit();const{parentInstance:e}=t.getContext(this);e instanceof Ji&&(this.data=e.modal.data)}onAccept(t){ai.resolve()}onReject(t){ai.reject()}onClose(){ai.reject()}}Ca.meta={selector:"[control-request-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">L\'utente ha richiesto il controllo della navigazione. Accetti?</div>\n\t\t\t\t<div class="group--cta">\n\t\t\t\t\t<button type="button" class="btn--cancel" (click)="onReject()">\n\t\t\t\t\t\t<span>Rifiuta</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--accept" (click)="onAccept()">\n\t\t\t\t\t\t<span>Accetta</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},Ca.chunk=()=>'<div class="control-request-modal" control-request-modal></div>';class Ra extends t.Directive{onInit(){const{module:e,node:r,parentInstance:s,selector:o}=t.getContext(this),a="drop",c=n.fromEvent(r,a).pipe(i.shareReplay(1)),l=r.getAttribute("(drop)");if(l){const t=e.makeFunction(l,["$event"]);c.pipe(i.takeUntil(this.unsubscribe$)).subscribe((n=>{e.resolve(t,s,n)})),n.fromEvent(r,"dragover").pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>t.preventDefault()))}else s.drop$=c}}Ra.meta={selector:"[(drop)]"};let Ia=1e6;class xa extends t.Directive{get id(){return this.dropdown||this.id_||(this.id_=xa.nextId())}onInit(){const{node:e}=t.getContext(this),n=e.getAttribute("dropdown-trigger");this.trigger=n?e.querySelector(n):e,this.opened=null,this.onClick=this.onClick.bind(this),this.onDocumentClick=this.onDocumentClick.bind(this),this.openDropdown=this.openDropdown.bind(this),this.closeDropdown=this.closeDropdown.bind(this),this.addListeners(),xa.dropdown$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.id===t?e.classList.add("dropped"):e.classList.remove("dropped")}))}onClick(e){const{node:n}=t.getContext(this);if(null===this.opened)this.openDropdown();else{n.querySelector("[dropdown-item]")||this.closeDropdown()}}onDocumentClick(e){const{node:n}=t.getContext(this);n===e.target||n.contains(e.target)||this.closeDropdown()}openDropdown(){null===this.opened&&(this.opened=!0,this.addDocumentListeners(),xa.dropdown$.next(this.id),this.dropped.next(this.id))}closeDropdown(){null!==this.opened&&(this.removeDocumentListeners(),this.opened=null,xa.dropdown$.getValue()===this.id&&(xa.dropdown$.next(null),this.dropped.next(null)))}addListeners(){this.trigger.addEventListener("click",this.onClick)}addDocumentListeners(){document.addEventListener("click",this.onDocumentClick)}removeListeners(){this.trigger.removeEventListener("click",this.onClick)}removeDocumentListeners(){document.removeEventListener("click",this.onDocumentClick)}onDestroy(){this.removeListeners(),this.removeDocumentListeners()}static nextId(){return Ia++}}xa.meta={selector:"[dropdown]",inputs:["dropdown","dropdown-trigger"],outputs:["dropped"]},xa.dropdown$=new n.BehaviorSubject(null);class Oa extends t.Directive{get id(){return this["dropdown-item"]}onInit(){const{node:e}=t.getContext(this);e.classList.add("dropdown-item"),xa.dropdown$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.id===t?e.classList.add("dropped"):e.classList.remove("dropped")}))}}Oa.meta={selector:"[dropdown-item], [[dropdown-item]]",inputs:["dropdown-item"]};class La extends t.Component{onInit(){this.toast=null,this.lastToast=null,Xi.toast$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{t&&(this.lastToast=t),this.toast=t,this.pushChanges()}))}getClass(){const t={};return this.toast&&(t.active=!0),this.lastToast&&(t[this.lastToast.type]=!0,t[this.lastToast.position]=!0),t}onClose(){Xi.reject(this.toast)}onAccept(){Xi.resolve(this.toast)}onReject(){Xi.reject(this.toast)}}La.meta={selector:"[toast-outlet]",template:'\n\t<div class="toast-outlet__container" [class]="getClass()">\n\t\t<div class="toast-outlet__toast" *if="lastToast">\n\t\t\t<span class="toast-outlet__message" [innerHTML]="lastToast.message"></span>\n\t\t\t<div class="group--cta" *if="lastToast.type != \'info\'">\n\t\t\t\t<button type="button" class="btn--accept" (click)="onAccept()">\n\t\t\t\t\t<span [innerHTML]="lastToast.acceptMessage"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--cancel" (click)="onReject()" *if="lastToast.type == \'dialog\'">\n\t\t\t\t\t<span [innerHTML]="lastToast.rejectMessage"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t\t<button type="button" class="btn--close" (click)="onClose()" *if="lastToast.type != \'info\'">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t</div>\n\t'};class Ma extends t.Component{onInit(){this.mode=1,this.viewTypes=Object.keys(mi).map((t=>{const e=mi[t];return{type:e,name:fe.getKeys("editor",e.name),disabled:-1!==D.editor.disabledViewTypes.indexOf(e.name)}})),this.viewItemTypes=Object.keys(gi).map((t=>{const e=gi[t];return{type:e,name:fe.getKeys("editor",e.name),disabled:-1!==D.editor.disabledViewItemTypes.indexOf(e.name)}})),this.setSupportedViewTypes(),this.setSupportedViewItemTypes()}onChanges(){this.setSupportedViewTypes(),this.setSupportedViewItemTypes()}setSupportedViewTypes(){this.supportedViewTypes=this.viewTypes.filter((t=>this.supportedViewType(t.type.name))).sort(((t,e)=>t.disabled===e.disabled?0:t.disabled?1:-1))}setSupportedViewItemTypes(){this.view?this.supportedViewItemTypes=this.viewItemTypes.filter((t=>this.supportedViewItemType(this.view.type.name,t.type.name))).sort(((t,e)=>t.disabled===e.disabled?0:t.disabled?1:-1)):this.supportedViewItemTypes=[]}setMode(t){this.mode!==t&&(this.mode=t,this.pushChanges())}supportedViewType(t){return-1!==[mi.Panorama.name,mi.PanoramaGrid.name,mi.Room3d.name,mi.Model.name,mi.Media.name].indexOf(t)}supportedViewItemType(t,e){let n;switch(t){case mi.WaitingRoom.name:n=!1;break;case mi.Panorama.name:case mi.PanoramaGrid.name:n=-1!==[gi.Nav.name,gi.Model.name,gi.Plane.name,gi.CurvedPlane.name].indexOf(e);break;case mi.Room3d.name:n=-1!==[gi.Nav.name,gi.Model.name,gi.Plane.name,gi.Texture.name].indexOf(e);break;case mi.Model.name:n=-1!==[gi.Nav.name,gi.Model.name,gi.Plane.name,gi.CurvedPlane.name].indexOf(e);break;case mi.Media.name:n=-1!==[].indexOf(e)}return n}onSelect(t){this.select.next(t)}onUpdate(t){this.update.next(t)}onDelete(t){this.delete.next(t)}}Ma.meta={selector:"[aside]",outputs:["select","update","delete"],inputs:["view"],template:'\n\t<div class="headline">\n\t\t<ul class="nav--tab">\n\t\t\t<li [class]="{ active: mode === 1 }" (click)="setMode(1)" [innerHTML]="\'editor_properties\' | label"></li>\n\t\t\t<li [class]="{ active: mode === 2 }" (click)="setMode(2)" [innerHTML]="\'editor_views\' | label"></li>\n\t\t\t<li [class]="{ active: mode === 3 }" (click)="setMode(3)" [innerHTML]="\'editor_view_items\' | label"></li>\n\t\t</ul>\n\t\t\x3c!--\n\t\t<div class="btn--mode" [class]="{ active: mode === 1 }" (click)="setMode(1)" [innerHTML]="\'editor_properties\' | label"></div>\n\t\t<div class="btn--mode" [class]="{ active: mode === 2 }" (click)="setMode(2)" [innerHTML]="\'editor_views\' | label"></div>\n\t\t<div class="btn--mode" [class]="{ active: mode === 3 }" (click)="setMode(3)" [innerHTML]="\'editor_view_items\' | label"></div>\n\t\t--\x3e\n\t</div>\n\t<div class="scrollable">\n\t\t<ul class="nav--editor" *if="mode === 1">\n\t\t\t<li>\n\t\t\t\t<div class="title" [innerHTML]="\'editor_properties\' | label"></div>\n\t\t\t\t<update-view [view]="view" (select)="onSelect($event)" (update)="onUpdate($event)" (delete)="onDelete($event)"></update-view>\n\t\t\t</li>\n\t\t\t<li *if="view.type.name != \'panorama-grid\'">\n\t\t\t\t<div class="title" [innerHTML]="\'editor_items\' | label"></div>\n\t\t\t\t<update-view-item [view]="view" [item]="item" (select)="onSelect($event)" (update)="onUpdate($event)" (delete)="onDelete($event)" *for="let item of view.pathItems"></update-view-item>\n\t\t\t\t<div class="abstract" *if="view.pathItems.length == 0" [innerHTML]="\'editor_no_items\' | label"></div>\n\t\t\t\t<div class="btn--mode" (click)="setMode(3)" [innerHTML]="\'editor_add_item\' | label"></div>\n\t\t\t</li>\n\t\t\t<li *if="view.type.name == \'panorama-grid\'">\n\t\t\t\t<div class="title" [innerHTML]="\'editor_tiles\' | label"></div>\n\t\t\t\t<div *for="let tile of view.tiles">\n\t\t\t\t\t<div *if="tile.selected">\n\t\t\t\t\t\t<update-view-tile [view]="view" [tile]="tile" (update)="onUpdate($event)" (delete)="onDelete($event)"></update-view-tile>\n\t\t\t\t\t\t<ul class="nav--editor">\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<update-view-item [view]="view" [item]="item" (select)="onSelect($event)" (update)="onUpdate($event)" (delete)="onDelete($event)" *for="let item of tile.navs"></update-view-item>\n\t\t\t\t\t\t\t\t<div class="abstract" *if="tile.navs.length == 0" [innerHTML]="\'editor_no_navs\' | label"></div>\n\t\t\t\t\t\t\t\t<div class="btn--mode" (click)="onSelect({ type:\'viewItem\', value: \'nav\', tile: tile })" [innerHTML]="\'editor_add_nav\' | label"></div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t\x3c!--\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<div class="btn" (click)="onSelect({ type:\'viewItem\', value: \'nav\', tile: tile })">\n\t\t\t\t\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t\t\t\t\t<svg-icon name="nav"></svg-icon>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<div class="title" [innerHTML]="\'editor_add_nav\' | label"></div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</li>\n\t\t\t\t\t\t\t--\x3e\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="abstract" *if="view.tiles.length == 0" [innerHTML]="\'editor_no_tiles\' | label"></div>\n\t\t\t\t\x3c!-- <div class="btn--mode" (click)="setMode(3)">Add Tile</div> --\x3e\n\t\t\t</li>\n\t\t\t\x3c!--\n\t\t\t<li *if="false">\n\t\t\t\t<div class="title">Icons</div>\n\t\t\t\t<ul class="nav--editor">\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'animated-tabs\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><path d="M 2 8.4 L 12 8.4 L 12 2 L 6 2 C 3.791 2 2 3.791 2 6 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 12 8.4 L 22 8.4 L 22 6 C 22 3.791 20.209 2 18 2 L 12 2 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Animated Tabs</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'card-list\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><path d="M 6.8 13.6 C 6.8 13.158 7.158 12.8 7.6 12.8 L 16.8 12.8 C 17.242 12.8 17.6 13.158 17.6 13.6 L 17.6 16.8 C 17.6 17.242 17.242 17.6 16.8 17.6 L 7.6 17.6 C 7.158 17.6 6.8 17.242 6.8 16.8 Z" fill="var(--svg-icon-tint)"></path><path d="M 6.8 7.2 C 6.8 6.758 7.158 6.4 7.6 6.4 L 16.8 6.4 C 17.242 6.4 17.6 6.758 17.6 7.2 L 17.6 10.4 C 17.6 10.842 17.242 11.2 16.8 11.2 L 7.6 11.2 C 7.158 11.2 6.8 10.842 6.8 10.4 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Card List</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'container-transitions\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 15.667 13 C 17.139 13 18.333 14.194 18.333 15.667 C 18.333 17.139 17.139 18.333 15.667 18.333 C 14.194 18.333 13 17.139 13 15.667 C 13 14.194 14.194 13 15.667 13 Z" fill="var(--svg-icon-tint)"></path></svg></svg></div>\n\t\t\t\t\t\t\t<div class="title">Container Transitions</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'dynamic-grid\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><g transform="translate(6.6 6.6)"><path d="M 6.048 0.8 C 6.048 0.358 6.406 0 6.848 0 L 10 0 C 10.442 0 10.8 0.358 10.8 0.8 L 10.8 3.952 C 10.8 4.394 10.442 4.752 10 4.752 L 6.848 4.752 C 6.406 4.752 6.048 4.394 6.048 3.952 Z" fill="var(--svg-icon-tint)" opacity="0.5"></path><path d="M 6.048 6.848 C 6.048 6.406 6.406 6.048 6.848 6.048 L 10 6.048 C 10.442 6.048 10.8 6.406 10.8 6.848 L 10.8 10 C 10.8 10.442 10.442 10.8 10 10.8 L 6.848 10.8 C 6.406 10.8 6.048 10.442 6.048 10 Z" fill="var(--svg-icon-tint)"></path><path d="M 0 0.8 C 0 0.358 0.358 0 0.8 0 L 3.952 0 C 4.394 0 4.752 0.358 4.752 0.8 L 4.752 3.952 C 4.752 4.394 4.394 4.752 3.952 4.752 L 0.8 4.752 C 0.358 4.752 0 4.394 0 3.952 Z" fill="var(--svg-icon-tint)"></path><path d="M 0 6.848 C 0 6.406 0.358 6.048 0.8 6.048 L 3.952 6.048 C 4.394 6.048 4.752 6.406 4.752 6.848 L 4.752 10 C 4.752 10.442 4.394 10.8 3.952 10.8 L 0.8 10.8 C 0.358 10.8 0 10.442 0 10 Z" fill="var(--svg-icon-tint)" opacity="0.5"></path></g></svg></div>\n\t\t\t\t\t\t\t<div class="title">Dynamic Grid</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'expand-on-tap\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 0 0 L 7.833 0" transform="translate(8.583 11.583) rotate(270 3.917 0.5)" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 14.667 9.333 L 12 6.667 L 9.333 9.333" stroke="var(--svg-icon-tint)" fill="transparent" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 14.667 14.667 L 12 17.333 L 9.333 14.667" stroke="var(--svg-icon-tint)" fill="transparent" stroke-width="1.67" stroke-linecap="round" stroke-linejoin="round"></path> </svg></div>\n\t\t\t\t\t\t\t<div class="title">Expand on Tap</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'image-gallery-2\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 8.333 C 7.333 7.781 7.781 7.333 8.333 7.333 L 10.333 7.333 C 10.886 7.333 11.333 7.781 11.333 8.333 L 11.333 10.333 C 11.333 10.886 10.886 11.333 10.333 11.333 L 8.333 11.333 C 7.781 11.333 7.333 10.886 7.333 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 12.333 8.333 C 12.333 7.781 12.781 7.333 13.333 7.333 L 15.333 7.333 C 15.886 7.333 16.333 7.781 16.333 8.333 L 16.333 10.333 C 16.333 10.886 15.886 11.333 15.333 11.333 L 13.333 11.333 C 12.781 11.333 12.333 10.886 12.333 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 7.333 13.667 C 7.333 13.114 7.781 12.667 8.333 12.667 L 15.333 12.667 C 15.886 12.667 16.333 13.114 16.333 13.667 L 16.333 15.667 C 16.333 16.219 15.886 16.667 15.333 16.667 L 8.333 16.667 C 7.781 16.667 7.333 16.219 7.333 15.667 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Image Gallery 2</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'stories-ui\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><path d="M 6.8 4.8 C 7.905 4.8 8.8 5.695 8.8 6.8 C 8.8 7.905 7.905 8.8 6.8 8.8 C 5.695 8.8 4.8 7.905 4.8 6.8 C 4.8 5.695 5.695 4.8 6.8 4.8 Z" fill="var(--svg-icon-tint)"></path><path d="M 12 4.8 C 13.105 4.8 14 5.695 14 6.8 C 14 7.905 13.105 8.8 12 8.8 C 10.895 8.8 10 7.905 10 6.8 C 10 5.695 10.895 4.8 12 4.8 Z" fill="var(--svg-icon-tint)"></path><path d="M 17.2 4.8 C 18.305 4.8 19.2 5.695 19.2 6.8 C 19.2 7.905 18.305 8.8 17.2 8.8 C 16.095 8.8 15.2 7.905 15.2 6.8 C 15.2 5.695 16.095 4.8 17.2 4.8 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Stories UI</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'todo-list\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 8 12.333 L 10.5 14.833 L 16 9.333" stroke="var(--svg-icon-tint)" fill="transparent" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">To-Do List</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'toggle-menu\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 17.333 15.333 C 18.438 15.333 19.333 16.229 19.333 17.333 C 19.333 18.438 18.438 19.333 17.333 19.333 C 16.229 19.333 15.333 18.438 15.333 17.333 C 15.333 16.229 16.229 15.333 17.333 15.333 Z" fill="var(--svg-icon-tint)"></path><path d="M 17.333 10 C 18.438 10 19.333 10.895 19.333 12 C 19.333 13.105 18.438 14 17.333 14 C 16.229 14 15.333 13.105 15.333 12 C 15.333 10.895 16.229 10 17.333 10 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 17.333 4.667 C 18.438 4.667 19.333 5.562 19.333 6.667 C 19.333 7.771 18.438 8.667 17.333 8.667 C 16.229 8.667 15.333 7.771 15.333 6.667 C 15.333 5.562 16.229 4.667 17.333 4.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Toggle Menu</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'bottom-sheet\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 10.333 C 22 10.886 21.552 11.333 21 11.333 L 3 11.333 C 2.448 11.333 2 10.886 2 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 2 13.333 C 2 12.781 2.448 12.333 3 12.333 L 21 12.333 C 21.552 12.333 22 12.781 22 13.333 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Bottom Sheet</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'draggable-sheet\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 2 14 C 2 12.895 2.895 12 4 12 L 20 12 C 21.105 12 22 12.895 22 14 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z M 10.667 15.333 L 13.333 15.333 C 13.702 15.333 14 15.035 14 14.667 C 14 14.298 13.702 14 13.333 14 L 10.667 14 C 10.298 14 10 14.298 10 14.667 C 10 15.035 10.298 15.333 10.667 15.333 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Draggable Sheet</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'modal-box\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 9.333 C 7.333 8.229 8.229 7.333 9.333 7.333 L 14.667 7.333 C 15.771 7.333 16.667 8.229 16.667 9.333 L 16.667 14.667 C 16.667 15.771 15.771 16.667 14.667 16.667 L 9.333 16.667 C 8.229 16.667 7.333 15.771 7.333 14.667 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Modal Box</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'side-menu\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 11 2 C 11.552 2 12 2.448 12 3 L 12 21 C 12 21.552 11.552 22 11 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Side Menu</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'input-form\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 8.333 C 7.333 7.781 7.781 7.333 8.333 7.333 L 11.667 7.333 C 11.667 7.333 11.667 7.333 11.667 7.333 L 15.667 7.333 C 16.219 7.333 16.667 7.781 16.667 8.333 L 16.667 9 C 16.667 9.552 16.219 10 15.667 10 L 13.333 10 L 13.333 15.667 C 13.333 16.219 12.886 16.667 12.333 16.667 L 11.667 16.667 C 11.114 16.667 10.667 16.219 10.667 15.667 L 10.667 10 L 8.333 10 C 7.781 10 7.333 9.552 7.333 9 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Input Form</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'loading-indicator\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><path d="M 16.4 10.4 C 17.284 10.4 18 11.116 18 12 C 18 12.884 17.284 13.6 16.4 13.6 C 15.516 13.6 14.8 12.884 14.8 12 C 14.8 11.116 15.516 10.4 16.4 10.4 Z" fill="var(--svg-icon-tint)"></path><path d="M 12 10.4 C 12.884 10.4 13.6 11.116 13.6 12 C 13.6 12.884 12.884 13.6 12 13.6 C 11.116 13.6 10.4 12.884 10.4 12 C 10.4 11.116 11.116 10.4 12 10.4 Z" fill="var(--svg-icon-tint)"></path><path d="M 7.6 10.4 C 8.484 10.4 9.2 11.116 9.2 12 C 9.2 12.884 8.484 13.6 7.6 13.6 C 6.716 13.6 6 12.884 6 12 C 6 11.116 6.716 10.4 7.6 10.4 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Loading Indicator</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'radio-button-form\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 9.833 8.167 L 14.167 8.167 C 16.284 8.167 18 9.883 18 12 C 18 14.117 16.284 15.833 14.167 15.833 L 9.833 15.833 C 7.716 15.833 6 14.117 6 12 C 6 9.883 7.716 8.167 9.833 8.167 Z M 11.333 12 C 11.333 13.473 12.527 14.667 14 14.667 C 15.473 14.667 16.667 13.473 16.667 12 C 16.667 10.527 15.473 9.333 14 9.333 C 12.527 9.333 11.333 10.527 11.333 12 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Radio Button Form</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'checkbox-form\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 8.651 6.931 C 7.911 6.738 7.238 7.411 7.431 8.151 L 9.363 15.558 C 9.592 16.435 10.775 16.58 11.208 15.784 L 13 12.5 L 16.284 10.708 C 17.08 10.275 16.935 9.092 16.058 8.863 Z" fill="var(--svg-icon-tint)"></path><path d="M 16 15.5 L 11 10.5" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Checkbox Form</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'splash-screen\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.757 13.414 C 6.976 12.633 6.976 11.367 7.757 10.586 L 10.586 7.757 C 11.367 6.976 12.633 6.976 13.414 7.757 L 16.243 10.586 C 17.024 11.367 17.024 12.633 16.243 13.414 L 13.414 16.243 C 12.633 17.024 11.367 17.024 10.586 16.243 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Splash Screen</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'timeout-transition\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 1 5.8 C 1 3.149 3.149 1 5.8 1 L 18.2 1 C 20.851 1 23 3.149 23 5.8 L 23 18.2 C 23 20.851 20.851 23 18.2 23 L 5.8 23 C 3.149 23 1 20.851 1 18.2 Z" fill="var(--svg-icon-tint)" opacity="0.3"></path><path d="M 12 6.72 C 14.916 6.72 17.28 9.084 17.28 12 C 17.28 14.916 14.916 17.28 12 17.28 C 9.084 17.28 6.72 14.916 6.72 12 C 6.72 9.084 9.084 6.72 12 6.72 Z M 11.34 12 C 11.34 12.365 11.635 12.66 12 12.66 L 14.2 12.66 C 14.565 12.66 14.86 12.365 14.86 12 C 14.86 11.635 14.565 11.34 14.2 11.34 L 12.66 11.34 L 12.66 9.8 C 12.66 9.435 12.365 9.14 12 9.14 C 11.635 9.14 11.34 9.435 11.34 9.8 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Timeout Transition</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'accordion-menu\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 16 10.667 L 12 14.667 L 8 10.667" fill="transparent" stroke-width="2" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Accordion Menu</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'drop-on-scroll\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 0 0 L 8 0" transform="translate(8.5 11.5) rotate(270 4 0.5)" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 15.333 11.333 L 12 8 L 8.667 11.333" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Drop on Scroll</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'nested-scroll\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 1.82 6 C 1.82 3.791 3.61 2 5.82 2 L 17.82 2 C 20.029 2 21.82 3.791 21.82 6 L 21.82 7 C 21.82 7.552 21.372 8 20.82 8 L 2.82 8 C 2.267 8 1.82 7.552 1.82 7 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 1.82 17 C 1.82 16.448 2.267 16 2.82 16 L 20.82 16 C 21.372 16 21.82 16.448 21.82 17 L 21.82 18 C 21.82 20.209 20.029 22 17.82 22 L 5.82 22 C 3.61 22 1.82 20.209 1.82 18 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 8.82 10 C 8.82 9.448 9.267 9 9.82 9 L 20.82 9 C 21.372 9 21.82 9.448 21.82 10 L 21.82 14 C 21.82 14.552 21.372 15 20.82 15 L 9.82 15 C 9.267 15 8.82 14.552 8.82 14 Z" fill="var(--svg-icon-tint)"></path><path d="M 1.82 10 C 1.82 9.448 2.267 9 2.82 9 L 6.82 9 C 7.372 9 7.82 9.448 7.82 10 L 7.82 14 C 7.82 14.552 7.372 15 6.82 15 L 2.82 15 C 2.267 15 1.82 14.552 1.82 14 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Nested Scroll</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'star-rating\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 11.399 6.884 C 11.645 6.386 12.355 6.386 12.601 6.884 L 13.705 9.122 C 13.803 9.32 13.992 9.457 14.21 9.489 L 16.68 9.848 C 17.229 9.928 17.449 10.603 17.051 10.99 L 15.264 12.733 C 15.106 12.887 15.034 13.108 15.071 13.326 L 15.493 15.786 C 15.587 16.333 15.013 16.75 14.521 16.492 L 12.312 15.331 C 12.117 15.228 11.883 15.228 11.688 15.331 L 9.479 16.492 C 8.987 16.75 8.413 16.333 8.507 15.786 L 8.929 13.326 C 8.966 13.108 8.894 12.887 8.736 12.733 L 6.949 10.99 C 6.551 10.603 6.771 9.928 7.32 9.848 L 9.79 9.489 C 10.008 9.457 10.197 9.32 10.295 9.122 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Star Rating</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'swipe-menu\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 17.33 C 2 16.595 2.595 16 3.33 16 L 21 16 C 21.552 16 22 16.448 22 17 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 2 10 C 2 9.448 2.448 9 3 9 L 14 9 C 14.552 9 15 9.448 15 10 L 15 14 C 15 14.552 14.552 15 14 15 L 3 15 C 2.448 15 2 14.552 2 14 Z M 19 9 C 20.657 9 22 10.343 22 12 C 22 13.657 20.657 15 19 15 C 17.343 15 16 13.657 16 12 C 16 10.343 17.343 9 19 9 Z" fill="var(--svg-icon-tint)"></path><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 7 C 22 7.552 21.552 8 21 8 L 3 8 C 2.448 8 2 7.552 2 7 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Swipe Menu</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'switch-sheet\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 15.667 13.333 C 17.139 13.333 18.333 14.527 18.333 16 C 18.333 17.473 17.139 18.667 15.667 18.667 C 14.194 18.667 13 17.473 13 16 C 13 14.527 14.194 13.333 15.667 13.333 Z" fill="var(--svg-icon-tint)"></path><path d="M 8.333 13.333 C 9.806 13.333 11 14.527 11 16 C 11 17.473 9.806 18.667 8.333 18.667 C 6.861 18.667 5.667 17.473 5.667 16 C 5.667 14.527 6.861 13.333 8.333 13.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Switch Sheet</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'tab-menu\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 10 15.333 L 14 15.333 L 14 18.667 L 10 18.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 5.333 16.333 C 5.333 15.781 5.781 15.333 6.333 15.333 L 9.333 15.333 L 9.333 18.667 L 6.333 18.667 C 5.781 18.667 5.333 18.219 5.333 17.667 Z" fill="var(--svg-icon-tint)"></path><path d="M 18.667 16.333 C 18.667 15.781 18.219 15.333 17.667 15.333 L 14.667 15.333 L 14.667 18.667 L 17.667 18.667 C 18.219 18.667 18.667 18.219 18.667 17.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Tab Menu</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'wheel-picker\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 3.667 6 C 3.667 3.791 5.458 2 7.667 2 L 16.333 2 C 18.542 2 20.333 3.791 20.333 6 L 20.333 7 C 20.333 7.552 19.886 8 19.333 8 L 4.667 8 C 4.114 8 3.667 7.552 3.667 7 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 2 11 C 2 9.895 2.895 9 4 9 L 20 9 C 21.105 9 22 9.895 22 11 L 22 13 C 22 14.105 21.105 15 20 15 L 4 15 C 2.895 15 2 14.105 2 13 Z" fill="var(--svg-icon-tint)"></path><path d="M 3.667 17 C 3.667 16.448 4.114 16 4.667 16 L 19.333 16 C 19.886 16 20.333 16.448 20.333 17 L 20.333 18 C 20.333 20.209 18.542 22 16.333 22 L 7.667 22 C 5.458 22 3.667 20.209 3.667 18 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Wheel Picker</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'cover-flow\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 11.333 17.962 C 11.333 18.385 11.068 18.762 10.67 18.904 L 4.673 21.045 C 3.37 21.511 2 20.545 2 19.162 L 2 4.838 C 2 3.455 3.37 2.489 4.673 2.955 L 10.67 5.096 C 11.068 5.238 11.333 5.615 11.333 6.038 Z" fill="var(--svg-icon-tint)"></path><path d="M 22 4.838 C 22 3.455 20.63 2.489 19.327 2.955 L 13.33 5.096 C 12.932 5.238 12.667 5.615 12.667 6.038 L 12.667 17.962 C 12.667 18.385 12.932 18.762 13.33 18.904 L 19.327 21.045 C 20.63 21.511 22 20.545 22 19.162 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Cover Flow</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'cube-effect\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6.743 C 2 5.898 2.531 5.144 3.327 4.859 L 9.997 2.477 C 10.648 2.245 11.333 2.727 11.333 3.419 L 11.333 20.581 C 11.333 21.273 10.648 21.755 9.997 21.523 L 3.327 19.141 C 2.531 18.856 2 18.102 2 17.257 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 12.667 3.419 C 12.667 2.727 13.352 2.245 14.003 2.477 L 20.673 4.859 C 21.469 5.144 22 5.898 22 6.743 L 22 17.257 C 22 18.102 21.469 18.856 20.673 19.141 L 14.003 21.523 C 13.352 21.755 12.667 21.273 12.667 20.581 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Cube Effect</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'flip-effect\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 11.333 4.667 C 11.333 4.114 10.886 3.667 10.333 3.667 L 4 3.667 C 2.895 3.667 2 4.562 2 5.667 L 2 18.333 C 2 19.438 2.895 20.333 4 20.333 L 10.333 20.333 C 10.886 20.333 11.333 19.886 11.333 19.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 20 4.167 C 20 3.891 20.224 3.667 20.5 3.667 L 20.5 3.667 C 21.328 3.667 22 4.338 22 5.167 L 22 18.833 C 22 19.662 21.328 20.333 20.5 20.333 L 20.5 20.333 C 20.224 20.333 20 20.109 20 19.833 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 18.667 4.631 C 18.667 3.309 17.406 2.35 16.131 2.704 L 13.399 3.463 C 12.966 3.583 12.667 3.978 12.667 4.427 L 12.667 19.573 C 12.667 20.022 12.966 20.417 13.399 20.537 L 16.131 21.296 C 17.406 21.65 18.667 20.691 18.667 19.369 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Flip Effect</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'parallax-scroll\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 12 6.667 C 12 5.562 12.895 4.667 14 4.667 L 17.333 4.667 C 18.438 4.667 19.333 5.562 19.333 6.667 L 19.333 10 C 19.333 11.105 18.438 12 17.333 12 L 14 12 C 12.895 12 12 11.105 12 10 Z" fill="var(--svg-icon-tint)"></path><path d="M 4.667 14 C 4.667 12.895 5.562 12 6.667 12 L 10 12 C 11.105 12 12 12.895 12 14 L 12 17.333 C 12 18.438 11.105 19.333 10 19.333 L 6.667 19.333 C 5.562 19.333 4.667 18.438 4.667 17.333 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Parallax Scroll</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'pile-effect\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 6.5 4 C 6.224 4 6 3.776 6 3.5 L 6 3.5 C 6 2.672 6.672 2 7.5 2 L 16.5 2 C 17.328 2 18 2.672 18 3.5 L 18 3.5 C 18 3.776 17.776 4 17.5 4 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 4.5 7 C 4.224 7 4 6.776 4 6.5 L 4 6.5 C 4 5.672 4.672 5 5.5 5 L 18.5 5 C 19.328 5 20 5.672 20 6.5 L 20 6.5 C 20 6.776 19.776 7 19.5 7 Z" fill="var(--svg-icon-tint)" opacity="0.7"></path><path d="M 0 2.67 C 0 1.195 1.195 0 2.67 0 L 11.33 0 C 12.805 0 14 1.195 14 2.67 L 14 17.33 C 14 18.805 12.805 20 11.33 20 L 2.67 20 C 1.195 20 0 18.805 0 17.33 Z" transform="translate(5 5) rotate(-90 7 10)" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Pile Effect</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'shuffle\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 15.174 10.452 L 16.708 9.06 L 15.174 7.667" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 15.174 16.333 L 16.708 14.94 L 15.174 13.548" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 16.145 9.06 C 16.145 9.06 13.982 8.542 12.617 9.679 C 11.252 10.815 11.829 12.213 10.776 13.548 C 9.724 14.882 7.708 14.94 7.708 14.94" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 16.145 14.823 C 16.145 14.823 13.982 15.34 12.617 14.204 C 11.252 13.068 11.829 11.669 10.776 10.335 C 9.724 9.001 7.708 8.942 7.708 8.942" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Shuffle</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'svg-animation\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 8 12.333 L 10.5 14.833 L 16 9.333" stroke="var(--svg-icon-tint)" fill="transparent" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">SVG Animation</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'google-sheets\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7 8.667 C 7 8.206 7.373 7.833 7.833 7.833 L 7.833 7.833 C 8.294 7.833 8.667 8.206 8.667 8.667 L 8.667 8.667 C 8.667 9.127 8.294 9.5 7.833 9.5 L 7.833 9.5 C 7.373 9.5 7 9.127 7 8.667 Z" fill="var(--svg-icon-tint)"></path><path d="M 7 12 C 7 11.54 7.373 11.167 7.833 11.167 L 7.833 11.167 C 8.294 11.167 8.667 11.54 8.667 12 L 8.667 12 C 8.667 12.46 8.294 12.833 7.833 12.833 L 7.833 12.833 C 7.373 12.833 7 12.46 7 12 Z" fill="var(--svg-icon-tint)"></path><path d="M 7 15.333 C 7 14.873 7.373 14.5 7.833 14.5 L 7.833 14.5 C 8.294 14.5 8.667 14.873 8.667 15.333 L 8.667 15.333 C 8.667 15.794 8.294 16.167 7.833 16.167 L 7.833 16.167 C 7.373 16.167 7 15.794 7 15.333 Z" fill="var(--svg-icon-tint)"></path><path d="M 9.778 8.667 C 9.778 8.206 10.151 7.833 10.611 7.833 L 16.167 7.833 C 16.627 7.833 17 8.206 17 8.667 L 17 8.667 C 17 9.127 16.627 9.5 16.167 9.5 L 10.611 9.5 C 10.151 9.5 9.778 9.127 9.778 8.667 Z" fill="var(--svg-icon-tint)"></path><path d="M 9.778 12 C 9.778 11.54 10.151 11.167 10.611 11.167 L 16.167 11.167 C 16.627 11.167 17 11.54 17 12 L 17 12 C 17 12.46 16.627 12.833 16.167 12.833 L 10.611 12.833 C 10.151 12.833 9.778 12.46 9.778 12 Z" fill="var(--svg-icon-tint)"></path><path d="M 9.778 15.333 C 9.778 14.873 10.151 14.5 10.611 14.5 L 16.167 14.5 C 16.627 14.5 17 14.873 17 15.333 L 17 15.333 C 17 15.794 16.627 16.167 16.167 16.167 L 10.611 16.167 C 10.151 16.167 9.778 15.794 9.778 15.333 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Google Sheets</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'map\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 1.82 6 C 1.82 3.791 3.61 2 5.82 2 L 17.82 2 C 20.029 2 21.82 3.791 21.82 6 L 21.82 18 C 21.82 20.209 20.029 22 17.82 22 L 5.82 22 C 3.61 22 1.82 20.209 1.82 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 11.82 6.504 C 14.029 6.504 15.82 8.282 15.82 10.476 C 15.82 10.698 15.801 10.915 15.766 11.127 C 15.359 14.488 13.033 16.581 12.155 17.261 C 12.051 17.341 11.976 17.437 11.82 17.437 C 11.663 17.437 11.586 17.34 11.481 17.258 C 10.6 16.576 8.28 14.483 7.873 11.127 C 7.838 10.915 7.82 10.698 7.82 10.476 C 7.82 8.282 9.61 6.504 11.82 6.504 Z M 9.486 10.644 C 9.486 11.933 10.531 12.977 11.82 12.977 C 13.108 12.977 14.153 11.933 14.153 10.644 C 14.153 9.355 13.108 8.311 11.82 8.311 C 10.531 8.311 9.486 9.355 9.486 10.644 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Map</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'signature-pad\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 8.82 13.068 C 8.56 12.807 8.56 12.385 8.82 12.125 L 13.733 7.212 C 13.993 6.952 14.415 6.952 14.676 7.212 L 16.788 9.324 C 17.048 9.585 17.048 10.007 16.788 10.267 L 11.875 15.18 C 11.615 15.44 11.193 15.44 10.932 15.18 Z" fill="var(--svg-icon-tint)"></path><path d="M 3.096 0.303 C 3.318 0.17 3.6 0.33 3.6 0.589 L 3.6 3.732 C 3.6 3.991 3.318 4.151 3.096 4.018 L 0.953 2.732 C 0.521 2.473 0.521 1.848 0.953 1.589 Z" transform="translate(6.24 13.8) rotate(-45 1.8 2.16)" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Signature Pad</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'sound-effects\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 14.225 10.793 C 14.471 11.102 14.623 11.529 14.623 12 C 14.623 12.471 14.471 12.898 14.225 13.207" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 16.224 9.185 C 16.96 9.911 17.417 10.905 17.417 12 C 17.417 13.095 16.96 14.09 16.224 14.816" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 6.083 10.656 C 6.083 10.288 6.382 9.989 6.75 9.989 L 7.674 9.989 L 11.021 7.835 C 11.464 7.549 12.048 7.868 12.048 8.396 L 12.048 15.604 C 12.048 16.132 11.464 16.451 11.021 16.165 L 7.674 14.011 L 6.75 14.011 C 6.382 14.011 6.083 13.712 6.083 13.344 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Sound Effects</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'card-swipe\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 3.423 7.423 C 3.423 5.214 5.214 3.423 7.423 3.423 L 16.756 3.423 C 18.965 3.423 20.756 5.214 20.756 7.423 L 20.756 16.756 C 20.756 18.965 18.965 20.756 16.756 20.756 L 7.423 20.756 C 5.214 20.756 3.423 18.965 3.423 16.756 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 9.172 3.377 C 10.734 1.815 13.266 1.815 14.828 3.377 L 20.721 9.269 C 22.283 10.831 22.283 13.364 20.721 14.926 L 14.828 20.819 C 13.266 22.381 10.734 22.381 9.172 20.819 L 3.279 14.926 C 1.717 13.364 1.717 10.831 3.279 9.269 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Card Swipe</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'custom-effect\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6.2 C 2 5.673 2.31 5.195 2.792 4.981 L 7.063 3.083 C 7.503 2.887 8 3.21 8 3.693 L 8 20.307 C 8 20.79 7.503 21.113 7.063 20.917 L 2.792 19.019 C 2.31 18.805 2 18.327 2 17.8 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 9.333 3.297 C 9.333 2.642 9.954 2.163 10.588 2.33 L 20.509 4.941 C 21.388 5.172 22 5.967 22 6.875 L 22 17.125 C 22 18.033 21.388 18.828 20.509 19.059 L 10.588 21.67 C 9.954 21.837 9.333 21.358 9.333 20.703 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Custom Effect</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'drag-handle\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.333 2.667 L 2.667 0 L 0 2.667" transform="translate(5.667 10.667) rotate(-90 2.667 1.333)" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 5.333 0 L 2.667 2.667 L 0 0" transform="translate(13 10.667) rotate(-90 2.667 1.333)" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)" stroke-linecap="round" stroke-linejoin="round"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Drag Handle</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'dynamic-header\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 8 L 2 8 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Dynamic Header</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'image-panning\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 12 14 C 12 12.895 12.895 12 14 12 L 20 12 C 21.105 12 22 12.895 22 14 L 22 18 C 22 20.209 20.209 22 18 22 L 14 22 C 12.895 22 12 21.105 12 20 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Image Panning</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'input-data\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 8.333 C 7.333 7.781 7.781 7.333 8.333 7.333 L 15.667 7.333 C 16.219 7.333 16.667 7.781 16.667 8.333 L 16.667 10.333 C 16.667 10.886 16.219 11.333 15.667 11.333 L 8.333 11.333 C 7.781 11.333 7.333 10.886 7.333 10.333 Z" fill="var(--svg-icon-tint)"></path><path d="M 7.333 13.667 C 7.333 13.114 7.781 12.667 8.333 12.667 L 15.667 12.667 C 16.219 12.667 16.667 13.114 16.667 13.667 L 16.667 15.667 C 16.667 16.219 16.219 16.667 15.667 16.667 L 8.333 16.667 C 7.781 16.667 7.333 16.219 7.333 15.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Input Data</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'input-validation\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 8.333 C 7.333 7.781 7.781 7.333 8.333 7.333 L 15.667 7.333 C 16.219 7.333 16.667 7.781 16.667 8.333 L 16.667 10.333 C 16.667 10.886 16.219 11.333 15.667 11.333 L 8.333 11.333 C 7.781 11.333 7.333 10.886 7.333 10.333 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 7.333 13.667 C 7.333 13.114 7.781 12.667 8.333 12.667 L 15.667 12.667 C 16.219 12.667 16.667 13.114 16.667 13.667 L 16.667 15.667 C 16.667 16.219 16.219 16.667 15.667 16.667 L 8.333 16.667 C 7.781 16.667 7.333 16.219 7.333 15.667 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Input Validation</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'like-animation\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.28 0 C 7.017 0 7.747 2.366 6.357 3.755 C 4.968 5.144 3.543 5.905 3.543 5.905 C 3.543 5.905 2.118 5.144 0.728 3.755 C -0.661 2.365 0.069 -0 1.806 0 C 3.543 0 3.543 1.701 3.543 1.701 C 3.543 1.701 3.543 0 5.28 0 Z" transform="translate(11.213 11.787) rotate(15 3.543 2.953)" fill="var(--svg-icon-tint)"></path><path d="M 5.28 0 C 7.017 -0 7.747 2.365 6.357 3.755 C 4.968 5.144 3.543 5.905 3.543 5.905 C 3.543 5.905 2.118 5.144 0.728 3.755 C -0.661 2.366 0.069 0 1.806 0 C 3.543 0 3.543 1.701 3.543 1.701 C 3.543 1.701 3.543 0 5.28 0 Z" transform="translate(5.701 6.669) rotate(-15 3.543 2.953)" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Like Animation</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'like-counter\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 14.778 7.333 C 17.556 7.333 18.724 11.072 16.502 13.268 C 14.279 15.464 12 16.667 12 16.667 C 12 16.667 9.721 15.464 7.498 13.268 C 5.276 11.072 6.444 7.333 9.222 7.333 C 12 7.333 12 10.022 12 10.022 C 12 10.022 12 7.333 14.778 7.333 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Like Counter</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'lock-screen\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 11 C 7.333 10.448 7.781 10 8.333 10 L 15.667 10 C 16.219 10 16.667 10.448 16.667 11 L 16.667 15.667 C 16.667 16.219 16.219 16.667 15.667 16.667 L 8.333 16.667 C 7.781 16.667 7.333 16.219 7.333 15.667 Z" fill="var(--svg-icon-tint)"></path><path d="M 12 7.333 C 13.289 7.333 14.333 8.378 14.333 9.667 C 14.333 10.955 13.289 12 12 12 C 10.711 12 9.667 10.955 9.667 9.667 C 9.667 8.378 10.711 7.333 12 7.333 Z" fill="transparent" stroke-width="1.67" stroke="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Lock Screen</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'long-press-menu\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 16.667 10.667 C 17.771 10.667 18.667 11.562 18.667 12.667 C 18.667 13.771 17.771 14.667 16.667 14.667 C 15.562 14.667 14.667 13.771 14.667 12.667 C 14.667 11.562 15.562 10.667 16.667 10.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 12 8 C 13.105 8 14 8.895 14 10 C 14 11.105 13.105 12 12 12 C 10.895 12 10 11.105 10 10 C 10 8.895 10.895 8 12 8 Z" fill="var(--svg-icon-tint)"></path><path d="M 7.333 10.667 C 8.438 10.667 9.333 11.562 9.333 12.667 C 9.333 13.771 8.438 14.667 7.333 14.667 C 6.229 14.667 5.333 13.771 5.333 12.667 C 5.333 11.562 6.229 10.667 7.333 10.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Long Press Menu</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'perspective-3d\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 6.913 22 C 5.987 22 5.182 21.364 4.967 20.463 L 2.586 10.463 C 2.287 9.206 3.24 8 4.532 8 L 19.468 8 C 20.76 8 21.713 9.206 21.414 10.463 L 19.033 20.463 C 18.818 21.364 18.013 22 17.087 22 Z" fill="var(--svg-icon-tint)"></path><path d="M 3.833 7 C 3.557 7 3.333 6.776 3.333 6.5 L 3.333 6.5 C 3.333 5.672 4.005 5 4.833 5 L 19.167 5 C 19.995 5 20.667 5.672 20.667 6.5 L 20.667 6.5 C 20.667 6.776 20.443 7 20.167 7 Z" fill="var(--svg-icon-tint)" opacity="0.7"></path><path d="M 5.167 4 C 4.891 4 4.667 3.776 4.667 3.5 L 4.667 3.5 C 4.667 2.672 5.338 2 6.167 2 L 17.833 2 C 18.662 2 19.333 2.672 19.333 3.5 L 19.333 3.5 C 19.333 3.776 19.109 4 18.833 4 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Perspective 3D</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'progress-bar\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 1.82 6 C 1.82 3.791 3.61 2 5.82 2 L 17.82 2 C 20.029 2 21.82 3.791 21.82 6 L 21.82 18 C 21.82 20.209 20.029 22 17.82 22 L 5.82 22 C 3.61 22 1.82 20.209 1.82 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.153 17 C 5.153 16.08 5.899 15.333 6.82 15.333 L 16.82 15.333 C 17.74 15.333 18.486 16.08 18.486 17 L 18.486 17 C 18.486 17.92 17.74 18.667 16.82 18.667 L 6.82 18.667 C 5.899 18.667 5.153 17.92 5.153 17 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 5.153 17 C 5.153 16.08 5.899 15.333 6.82 15.333 L 11.486 15.333 C 12.407 15.333 13.153 16.08 13.153 17 L 13.153 17 C 13.153 17.92 12.407 18.667 11.486 18.667 L 6.82 18.667 C 5.899 18.667 5.153 17.92 5.153 17 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Progress Bar</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'scroll-progress\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 7.333 10.333 C 7.333 9.781 7.781 9.333 8.333 9.333 L 15.667 9.333 C 16.219 9.333 16.667 9.781 16.667 10.333 L 16.667 11.667 C 16.667 12.219 16.219 12.667 15.667 12.667 L 8.333 12.667 C 7.781 12.667 7.333 12.219 7.333 11.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 7.333 14.667 C 7.333 14.114 7.781 13.667 8.333 13.667 L 15.667 13.667 C 16.219 13.667 16.667 14.114 16.667 14.667 L 16.667 16 C 16.667 16.552 16.219 17 15.667 17 L 8.333 17 C 7.781 17 7.333 16.552 7.333 16 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 7.333 7.667 C 7.333 7.298 7.632 7 8 7 L 16 7 C 16.368 7 16.667 7.298 16.667 7.667 L 16.667 7.667 C 16.667 8.035 16.368 8.333 16 8.333 L 8 8.333 C 7.632 8.333 7.333 8.035 7.333 7.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 7.333 7.667 C 7.333 7.298 7.632 7 8 7 L 12.667 7 C 13.035 7 13.333 7.298 13.333 7.667 L 13.333 7.667 C 13.333 8.035 13.035 8.333 12.667 8.333 L 8 8.333 C 7.632 8.333 7.333 8.035 7.333 7.667 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Scroll Progress</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'show-password\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 10.6 12 C 10.6 11.227 11.227 10.6 12 10.6 L 12 10.6 C 12.773 10.6 13.4 11.227 13.4 12 L 13.4 12 C 13.4 12.773 12.773 13.4 12 13.4 L 12 13.4 C 11.227 13.4 10.6 12.773 10.6 12 Z" fill="var(--svg-icon-tint)"></path><path d="M 12.166 7.833 C 14.892 7.833 17.161 9.42 17.811 12 C 17.161 14.58 14.892 16.167 12.166 16.167 C 9.44 16.167 7.127 14.58 6.478 12 C 7.127 9.42 9.44 7.833 12.166 7.833 Z M 9.333 12 C 9.333 13.473 10.527 14.667 12 14.667 C 13.473 14.667 14.667 13.473 14.667 12 C 14.667 10.527 13.473 9.333 12 9.333 C 10.527 9.333 9.333 10.527 9.333 12 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Show Password</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'slider\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.667 12 L 18.333 12" stroke="var(--svg-icon-tint)" fill="transparent" opacity="0.4" stroke-width="2.67" stroke-linecap="round" stroke-linejoin="round"></path><path d="M 12 8.333 C 14.025 8.333 15.667 9.975 15.667 12 C 15.667 14.025 14.025 15.667 12 15.667 C 9.975 15.667 8.333 14.025 8.333 12 C 8.333 9.975 9.975 8.333 12 8.333 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Slider</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'stories-drag\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.333 6.667 C 5.333 5.93 5.93 5.333 6.667 5.333 L 10 5.333 C 10.736 5.333 11.333 5.93 11.333 6.667 L 11.333 6.667 C 11.333 7.403 10.736 8 10 8 L 6.667 8 C 5.93 8 5.333 7.403 5.333 6.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path><path d="M 12.667 6.667 C 12.667 5.93 13.264 5.333 14 5.333 L 17.333 5.333 C 18.07 5.333 18.667 5.93 18.667 6.667 L 18.667 6.667 C 18.667 7.403 18.07 8 17.333 8 L 14 8 C 13.264 8 12.667 7.403 12.667 6.667 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Stories: Drag</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'stories-tap\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18 C 22 20.209 20.209 22 18 22 L 6 22 C 3.791 22 2 20.209 2 18 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 5.333 6.667 C 5.333 5.93 5.93 5.333 6.667 5.333 L 10 5.333 C 10.736 5.333 11.333 5.93 11.333 6.667 L 11.333 6.667 C 11.333 7.403 10.736 8 10 8 L 6.667 8 C 5.93 8 5.333 7.403 5.333 6.667 Z" fill="var(--svg-icon-tint)"></path><path d="M 12.667 6.667 C 12.667 5.93 13.264 5.333 14 5.333 L 17.333 5.333 C 18.07 5.333 18.667 5.93 18.667 6.667 L 18.667 6.667 C 18.667 7.403 18.07 8 17.333 8 L 14 8 C 13.264 8 12.667 7.403 12.667 6.667 Z" fill="var(--svg-icon-tint)" opacity="0.4"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Stories: Tap</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<div class="btn" (click)="onSelect(\'toast-prompt\')">\n\t\t\t\t\t\t\t<div class="icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M 2 6 C 2 3.791 3.791 2 6 2 L 18 2 C 20.209 2 22 3.791 22 6 L 22 18.333 C 22 20.542 20.209 22.333 18 22.333 L 6 22.333 C 3.791 22.333 2 20.542 2 18.333 Z" fill="var(--svg-icon-tint)" opacity="0.2"></path><path d="M 12 6.333 C 15.13 6.333 17.667 8.87 17.667 12 C 17.667 15.13 15.13 17.667 12 17.667 C 8.87 17.667 6.333 15.13 6.333 12 C 6.333 8.87 8.87 6.333 12 6.333 Z" fill="transparent" stroke-width="1.33" stroke="var(--svg-icon-tint)"></path><path d="M 12 13 C 12.552 13 13 13.448 13 14 C 13 14.552 12.552 15 12 15 C 11.448 15 11 14.552 11 14 C 11 13.448 11.448 13 12 13 Z" fill="var(--svg-icon-tint)"></path><path d="M 11.06 9.998 C 11.027 9.457 11.458 9 12 9 L 12 9 C 12.542 9 12.973 9.457 12.94 9.998 L 12.848 11.535 C 12.821 11.983 12.449 12.333 12 12.333 L 12 12.333 C 11.551 12.333 11.179 11.983 11.152 11.535 Z" fill="var(--svg-icon-tint)"></path></svg></div>\n\t\t\t\t\t\t\t<div class="title">Toast Prompt</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</li>\n\t\t\t--\x3e\n\t\t</ul>\n\t\t<ul class="nav--editor" *if="mode === 2">\n\t\t\t<li>\n\t\t\t\t<div class="title" [innerHTML]="\'editor_views\' | label"></div>\n\t\t\t\t<ul class="nav--editor">\n\t\t\t\t\t<li *for="let item of supportedViewTypes">\n\t\t\t\t\t\t<div class="btn" [class]="{ disabled: item.disabled }" (click)="onSelect({ type:\'view\', value: item.type.name })">\n\t\t\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t\t\t<svg-icon [name]="item.type.name"></svg-icon>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="title" [innerHTML]="item.name"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t</li>\n\t\t</ul>\n\t\t<ul class="nav--editor" *if="mode === 3">\n\t\t\t<li>\n\t\t\t\t<div class="title" [innerHTML]="\'editor_view_items\' | label"></div>\n\t\t\t\t<ul class="nav--editor">\n\t\t\t\t\t<li *for="let item of supportedViewItemTypes">\n\t\t\t\t\t\t<div class="btn" [class]="{ disabled: item.disabled }" (click)="onSelect({ type:\'viewItem\', value: item.type.name })" [title]="item.id">\n\t\t\t\t\t\t\t<div class="icon">\n\t\t\t\t\t\t\t\t<svg-icon [name]="item.type.name"></svg-icon>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div class="title" [innerHTML]="item.name"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</li>\n\t\t\t\t</ul>\n\t\t\t\t<div class="abstract" *if="supportedViewItemTypes.length == 0" [innerHTML]="\'editor_type_no_items\' | label"></div>\n\t\t\t</li>\n\t\t</ul>\n\t</div>\n\t'};let ka=0;class Na{static set active(t){this.active$.next(t)}static get active(){return this.active$.getValue()}static menu$(){return this.getMenu$().pipe(i.switchMap((t=>(this.menu$_.next(t),this.menu$_))))}static getMenu$(){return Sn.get$("/api/menu").pipe(i.map((t=>(t.menu.sort(((t,e)=>t.order-e.order)),t.menu))))}static updateMenu$(t){return Sn.put$("/api/menu",t)}static createMenuItem$(t,e){void 0===t&&(t=null),void 0===e&&(e=0);const n={parentId:t,viewId:null,order:10*e,name:"Folder "+ ++ka};return Sn.post$("/api/menu",n)}static updateMenuItem$(t){return Sn.put$(`/api/menu/${t.id}`,t)}static deleteMenuItem$(t){return Sn.delete$(`/api/menu/${t.id}`)}static getModelMenu$(t,e){return void 0===e&&(e=!1),this.menu$().pipe(i.map((n=>{if(n&&n.length)return n=n.filter((e=>null==e.viewId||0==e.viewId||null!=t.find((t=>t.id===e.viewId)))),this.mapMenuItems(n);{const n={};t.forEach((t=>{if(t.type.name!==mi.WaitingRoom.name&&(!t.hidden||e)){let e=n[t.type.name];e||(e=n[t.type.name]=[]),e.push(t)}}));return Object.keys(n).map((n=>{let i="Button";switch(n){case mi.WaitingRoom.name:i="Waiting Room";break;case mi.Panorama.name:i="Experience";break;case mi.PanoramaGrid.name:i="Virtual Tour";break;case mi.Room3d.name:i="Stanze 3D";break;case mi.Model.name:i="Modelli 3D";break;case mi.Media.name:i="Media"}return{name:i,type:{name:"menu-group"},items:t.filter((t=>t.type.name===n&&(!t.hidden||e)))}}))}})))}static mapMenuItem(t,e){return t.viewId?{id:t.viewId,name:t.name,type:{name:"panorama"}}:{name:t.name,type:{name:"menu-group"},items:this.mapMenuItems(e,t.id)}}static mapMenuItems(t,e){return void 0===e&&(e=null),t.filter((t=>(t.parentId||null)===e)).map((e=>this.mapMenuItem(e,t))).filter((t=>null!=t.id||t.items.length>0))}}Na.active$=new n.BehaviorSubject(!1),Na.menu$_=new n.BehaviorSubject([]);class Pa{static drop$(e){if(t.isPlatformBrowser&&e){const t=document.querySelector("body");return n.merge(n.fromEvent(t,"drop"),n.fromEvent(t,"dragover")).pipe(i.map((t=>{t.preventDefault(),t.target===e&&(e.files=t.dataTransfer.files)})))}return n.EMPTY}static change$(e){return t.isPlatformBrowser&&e?n.fromEvent(e,"change").pipe(i.filter((t=>e.files&&e.files.length)),i.map((t=>Array.from(e.files)))):n.EMPTY}static asset$(t,e){return void 0===e&&(e=[]),this.change$(t).pipe(i.switchMap((t=>{e.length=t.length,e.fill(null);const r=t.map(((t,n)=>this.read$(t,n,e).pipe(i.map((()=>t)),i.switchMap((t=>ta.upload$([t]))),i.switchMap((t=>{const e=t[0],n=ur.fromUrl(e.url);return ta.assetCreate$(n)})))));return n.combineLatest(r)})))}static read$(t,e,r){void 0===r&&(r=[]);const s=new FileReader,o=n.fromEvent(s,"load").pipe(i.switchMap((t=>{const e=t.target.result;return this.resize$(e)})),i.tap((t=>{r[e]=t})));return s.readAsDataURL(t),o}static resize$(t){return n.from(this.resize_(t))}static resize_(t){return new Promise(((e,n)=>{const i=document.createElement("img");i.onload=function(){const t=document.createElement("canvas"),n=t.getContext("2d");let r=i.width,s=i.height;r>s?r>320&&(s*=320/r,r=320):s>240&&(r*=240/s,s=240),t.width=r,t.height=s,n.drawImage(i,0,0,r,s);const o=t.toDataURL("image/jpeg",.9);e(o)},i.onerror=function(){n(t)},i.src=t}))}}class Da extends t.Component{onChanges(){const{node:e}=t.getContext(this),n=this.control.flags;Object.keys(n).forEach((t=>{n[t]?e.classList.add(t):e.classList.remove(t)}))}}Da.meta={selector:"[control]",inputs:["control"]};class Ba extends Da{onInit(){this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||"image/png, image/jpeg";const{node:e}=t.getContext(this),r=e.querySelector("input");r.setAttribute("accept",this.accept),Pa.drop$(r).pipe(i.takeUntil(this.unsubscribe$)).subscribe(),Pa.change$(r).pipe(i.switchMap((t=>{const e=t.map(((t,e)=>ta.upload$([t]).pipe(i.switchMap((t=>ta.createOrUpdateAsset$(t,this.control))))));return n.combineLatest(e)})),i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.control.value=t[0]}))}}Ba.meta={selector:"[control-asset]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--picture">\n\t\t\t\t<div class="group--picture__info">\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t</div>\n\t\t\t\t<img [lazy]="control.value | asset" [size]="{ width: 320, height: 240 }" *if="control.value && control.value.type.name === \'image\'" />\n\t\t\t\t<video [src]="control.value | asset" *if="control.value && control.value.type.name === \'video\'"></video>\n\t\t\t\t<input type="file">\n\t\t\t</div>\n\t\t\t<div class="file-name" *if="control.value" [innerHTML]="control.value.file"></div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class Ua extends Ba{static itemToFormGroup(t){return new e.FormGroup({id:t.id,parentId:t.parentId,viewId:t.viewId,name:t.name,items:new e.FormArray})}onInit(){this.dropdownId=xa.nextId(),this.controls=this.control.controls,ea.viewIdOptions$().pipe(i.first()).subscribe((t=>{this.controls.viewId.options=t}))}onAddItem(){Na.createMenuItem$(this.controls.id.value,this.controls.items.length).pipe(i.first()).subscribe((t=>{this.controls.items.push(Ua.itemToFormGroup(t))}))}onRemoveItem(){this.remove.next(this.control)}onRemoveControl(t){Na.deleteMenuItem$(t.value).pipe(i.first()).subscribe((()=>{this.controls.items.remove(t)}))}onLinkItem(){this.link.next(this.control)}onLinkControl(t){this.link.next(t)}onItemUp(){this.up.next(this.control)}onItemDown(){this.down.next(this.control)}onUpControl(t){const e=this.controls.items,n=e.controls.length;let i=e.controls.indexOf(t);e.controls.splice(i,1),i>0?i--:i=n-1,e.insert(t,i)}onDownControl(t){const e=this.controls.items,n=e.controls.length;let i=e.controls.indexOf(t);e.controls.splice(i,1),i<n-1?i++:i=0,e.insert(t,i)}setView(t){const e=Object.assign({},this.control.value);e.viewId=t.id,t.id&&(e.name=t.name),Na.updateMenuItem$(e).pipe(i.first()).subscribe((()=>{this.controls.viewId.value=t.id,t.id&&(this.controls.name.value=t.name,this.controls.items.controls=[],this.controls.items.switchSubjects_())}))}onTextDidChange(t){Na.updateMenuItem$(this.control.value).pipe(i.first()).subscribe()}hasOption(t){return this.controls.viewId.value===t.id}onDropped(t){}}Ua.meta={selector:"[control-menu]",outputs:["remove","link","up","down"],inputs:["control"],template:'\n\t\t<div class="group--form">\n\t\t\t<button type="button" class="control-menu__link" [class]="{ active: control.controls.viewId.value }" (click)="onLinkItem($event)" [dropdown]="dropdownId" (dropped)="onDropped($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#link"></use></svg>\n\t\t\t\t<div class="dropdown" [dropdown-item]="dropdownId">\n\t\t\t\t\t<div class="category">View</div>\n\t\t\t\t\t<ul class="nav--dropdown">\n\t\t\t\t\t\t<li (click)="setView(item)" [class]="{ empty: item.id == null }" *for="let item of control.controls.viewId.options">\n\t\t\t\t\t\t\t<span [class]="{ active: hasOption(item) }" [innerHTML]="item.name"></span>\n\t\t\t\t\t\t</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</button>\n\t\t\t<input type="text" class="control--text" [formControl]="control.controls.name" placeholder="Name" (change)="onTextDidChange($event)" />\n\t\t\t\x3c!--\n\t\t\t<button type="button" class="control-menu__add" (click)="onAddItem($event)">\n\t\t\t\t<span [innerHTML]="control.controls.viewId.value"></span>\n\t\t\t</button>\n\t\t\t--\x3e\n\t\t\t\x3c!--\n\t\t\t<select class="control--select" [formControl]="control.controls.viewId">\n\t\t\t\t<option [value]="item.id" *for="let item of control.controls.viewId.options" [innerHTML]="item.name"></option>\n\t\t\t</select>\n\t\t\t--\x3e\n\t\t\t<button type="button" class="control-menu__up" (click)="onItemUp($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#up"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="control-menu__down" (click)="onItemDown($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#down"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="control-menu__add" (click)="onAddItem($event)" *if="!control.controls.viewId.value">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#add"></use></svg>\n\t\t\t</button>\n\t\t\t<button type="button" class="control-menu__remove" (click)="onRemoveItem($event)">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#remove"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="group--items">\n\t\t\t<div control-menu *for="let sub of control.controls.items.controls" [control]="sub" (remove)="onRemoveControl($event)" (link)="onLinkControl($event)" (up)="onUpControl($event)" (down)="onDownControl($event)"></div>\n\t\t</div>\n\t'};class Fa extends t.Component{onInit(){this.changes=0,this.form=null,Na.getMenu$().pipe(i.first()).subscribe((t=>this.initForm(t)))}initForm(t){void 0===t&&(t=[]);const n=this.menuToControls(t),r=this.form=new e.FormGroup({items:n});this.controls=r.controls,r.changes$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.changes++,this.pushChanges()}))}onLinkControl(t){}onUpControl(t){const e=this.controls.items,n=e.controls.length;let i=e.controls.indexOf(t);e.controls.splice(i,1),i>0?i--:i=n-1,e.insert(t,i)}onDownControl(t){const e=this.controls.items,n=e.controls.length;let i=e.controls.indexOf(t);e.controls.splice(i,1),i<n-1?i++:i=0,e.insert(t,i)}onAddItem(){Na.createMenuItem$(null,this.controls.items.length).pipe(i.first()).subscribe((t=>{this.controls.items.push(Ua.itemToFormGroup(t))}))}onRemoveControl(t){Na.deleteMenuItem$(t.value).pipe(i.first()).subscribe((()=>{this.controls.items.remove(t)}))}isValid(){return this.form.valid}onSubmit(t){if(this.form.valid){const t=this.form.value,e=this.controlsToMenu(t);Na.updateMenu$(e)}else this.form.touched=!0}menuToControls(t,n){void 0===n&&(n=null);return new e.FormArray(t.filter((t=>(t.parentId||null)===n)).map((n=>{const i=this.menuToControls(t,n.id);return new e.FormGroup({id:n.id,parentId:n.parentId,viewId:n.viewId,name:n.name,items:i})})))}controlsToMenu(t){const e=[],n=t=>{t&&t.forEach(((t,i)=>{const r=Object.assign({},t);r.order=10*i,delete r.items,e.push(r),n(t.items)}))};return n(t.items),e}}Fa.meta={selector:"[menu-builder]",inputs:["views"],template:'\n\t<div class="group--head">\n\t\t<div class="title" [innerHTML]="\'editor_menu\' | label"></div>\n\t</div>\n\t<div class="group--main">\n\t\t<div class="nav--tree" *if="form">\n\t\t\t<form class="form" [formGroup]="form" (submit)="isValid() && onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t<div class="abstract" *if="controls.items.controls.length == 0" [innerHTML]="\'editor_add_item\' | label"></div>\n\t\t\t\t<div *for="let control of controls.items.controls">\n\t\t\t\t\t<div control-menu [control]="control" (remove)="onRemoveControl($event)" (link)="onLinkControl($event)" (up)="onUpControl($event)" (down)="onDownControl($event)"></div>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t</div>\n\t<div class="group--foot">\n\t\t<button type="button" class="btn--mode" (click)="onAddItem($event)" [innerHTML]="\'editor_add\' | label"></button>\n\t\t<button type="button" class="btn--mode" (click)="isValid() && onSubmit()" *if="changes > 1" [innerHTML]="\'editor_save\' | label"></button>\n\t</div>\n\t'};class Ha extends t.Component{get data(){let e=null;const{parentInstance:n}=t.getContext(this);return n instanceof Ji&&(e=n.modal.data),e}get navmap(){let t=null;const e=this.data;return e&&(t=e.navmap),t}get position(){let t=[0,0,0];const e=this.data;return e&&(t=[e.hit.x,e.hit.y,0]),t}onInit(){const t=this.position;this.error=null;const n=this.form=new e.FormGroup({type:gi.Nav,title:null,abstract:null,viewId:new e.FormControl(null,e.RequiredValidator()),keepOrientation:!1,important:!1,transparent:!1,position:new e.FormControl(t,e.RequiredValidator()),asset:null});this.controls=n.controls,n.changes$.subscribe((t=>{this.pushChanges()})),ea.viewIdOptions$().pipe(i.first()).subscribe((t=>{this.controls.viewId.options=t,this.pushChanges()}))}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=Object.assign({},this.form.value);t.viewId=parseInt(t.viewId),Vi.itemCreate$(this.navmap,t).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>{console.log("NavmapItemModalComponent.onSubmit.error",t),this.error=t,this.form.submitted=!1}))}else this.form.touched=!0}onClose(){ai.reject()}}Ha.meta={selector:"[navmap-item-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Map Nav.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.title" label="Title"></div>\n\t\t\t\t\t\t<div control-textarea [control]="controls.abstract" label="Abstract"></div>\n\t\t\t\t\t\t<div control-custom-select [control]="controls.viewId" label="NavToView"></div>\n\t\t\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="3" [disabled]="true"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},Ha.chunk=()=>'<div class="nav-modal" navmap-item-modal></div>';class Va extends t.Component{onInit(){this.error=null;const t=this.form=new e.FormGroup({name:new e.FormControl(null,e.RequiredValidator()),asset:new e.FormControl(null,e.RequiredValidator())});this.controls=t.controls,t.changes$.subscribe((t=>{this.pushChanges()}))}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=this.form.value,e={name:t.name,asset:t.asset};return Vi.navmapCreate$(e).pipe(i.first()).subscribe((t=>{ai.resolve(t)}),(t=>{console.log("NavmapModalComponent.onSubmit.error",t),this.error=t,this.form.reset()}))}this.form.touched=!0}onClose(){ai.reject()}}Va.meta={selector:"[navmap-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Create Map.</div>\n\t\t\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t\t<div class="form-controls">\n\t\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/png"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="description">Formato immagine .png con trasparenza (2048x1024 o 1024x512)</div>\n\t\t\t\t\t<div class="group--cta">\n\t\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t\t<span>Create</span>\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</div>\n\t\t\t\t</form>\n\t\t\t</div>\n\t\t</div>\n\t'},Va.chunk=()=>'<div class="panorama-modal" navmap-modal></div>';class ja extends t.Component{onInit(){this.navmap=null,this.navmaps=[],Vi.navmapGet$().pipe(i.first()).subscribe((t=>{this.navmaps=t,this.pushChanges()}))}onBack(t){this.navmap=null,this.pushChanges()}onAdd(){ai.open$({template:Va.chunk()}).pipe(i.first()).subscribe((t=>{t instanceof si&&(this.navmaps.push(t.data),this.navmap=t.data,this.pushChanges())}))}onSet(t){this.navmap=this.navmaps.find((e=>e.id===t.id)),this.pushChanges()}onAddItem(t,e){ai.open$({template:Ha.chunk(),data:{navmap:t,hit:e}}).pipe(i.first()).subscribe((e=>{if(e instanceof si){const n=t.items||[];n.push(e.data),Object.assign(t,{items:n}),this.pushChanges()}}))}onDelete(t){const e=this.navmaps.indexOf(t);-1!==e&&this.navmaps.splice(e,1),this.navmap=null,this.pushChanges()}}ja.meta={selector:"[navmap-builder]",inputs:["views"],template:'\n\t<div class="group--head">\n\t\t<div class="title" [innerHTML]="\'editor_navmaps\' | label"></div>\n\t</div>\n\t<div class="group--main">\n\t\t\x3c!-- listing navmaps --\x3e\n\t\t<div class="listing--navmaps" *if="!navmap">\n\t\t\t<div class="abstract" *if="navmaps.length == 0" [innerHTML]="\'editor_add_item\' | label"></div>\n\t\t\t<div class="listing__item" *for="let item of navmaps">\n\t\t\t\t<div class="card--navmap" (click)="onSet(item)">\n\t\t\t\t\t<div class="card__picture">\n\t\t\t\t\t\t<img [src]="item.asset | asset" *if="item.asset" />\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="card__content">\n\t\t\t\t\t\t<div class="card__name" [innerHTML]="item.name"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t\x3c!-- navmap edit --\x3e\n\t\t<div class="navmap" navmap-edit [navmap]="navmap" (delete)="onDelete($event)" *if="navmap">\n\t\t\t<form class="form" [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off">\n\t\t\t\t<div class="title"><span [innerHTML]="navmap.name"></span> <span [innerHTML]="navmap.id"></span></div>\n\t\t\t\t<div class="form-controls">\n\t\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t\t\t\x3c!--\n\t\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/png"></div>\n\t\t\t\t\t--\x3e\n\t\t\t\t</div>\n\t\t\t\t<div class="group--cta">\n\t\t\t\t\t<button type="submit" class="btn--accept">\n\t\t\t\t\t\t<span [innerHTML]="\'editor_save\' | label"></span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t\t<span [innerHTML]="\'editor_remove\' | label"></span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class="navmap-control" [class]="mode">\n\t\t\t\t\t<div class="navmap-control__image">\n\t\t\t\t\t\t<img draggable="false" [src]="navmap.asset | asset" *if="navmap.asset" />\n\t\t\t\t\t\t<div class="navmap__item" [style]="{ left: item.position[0] * 100 + \'%\', top: item.position[1] * 100 + \'%\' }" (mousedown)="onMoveItem($event, item)" (click)="onRemoveItem(item)" *for="let item of navmap.items">\n\t\t\t\t\t\t\t<img draggable="false" [src]="\'textures/ui/nav-point.png\' | asset" />\n\t\t\t\t\t\t\t<div class="title" [innerHTML]="item.title" *if="item.title"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<ul class="navmap-control__toolbar">\n\t\t\t\t\t\t<li class="nav__item"><span [class]="{ active: mode === \'insert\' }" (click)="onToggleMode(\'insert\')"><svg class="pencil" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#pencil"></use></svg></span></li>\n\t\t\t\t\t\t<li class="nav__item"><span [class]="{ active: mode === \'move\' }" (click)="onToggleMode(\'move\')"><svg class="move" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#move"></use></svg></span></li>\n\t\t\t\t\t\t<li class="nav__item"><span [class]="{ active: mode === \'remove\' }" (click)="onToggleMode(\'remove\')"><svg class="erase" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#erase"></use></svg></span></li>\n\t\t\t\t\t</ul>\n\t\t\t\t</div>\n\t\t\t</form>\n\t\t</div>\n\t</div>\n\t<div class="group--foot">\n\t\t<button type="button" class="btn--mode" (click)="onAdd($event)" [innerHTML]="\'editor_add\' | label" *if="!navmap"></button>\n\t\t<button type="button" class="btn--mode" (click)="onBack($event)" [innerHTML]="\'editor_back\' | label" *if="navmap"></button>\n\t</div>\n\t'};const Ga="idle",Qa="insert",za="remove",Wa="move";class Ka{constructor(t,e){const n=t.getBoundingClientRect();this.x=(e.clientX-n.x)/n.width,this.y=(e.clientY-n.y)/n.height}}class qa extends Ka{}class Ya extends Ka{}class $a extends Ka{}class Xa extends t.Component{onInit(){this.mode=Ga,this.error=null;const t=this.navmap,n=this.form=new e.FormGroup({name:new e.FormControl(t.name,e.RequiredValidator()),asset:new e.FormControl(t.asset,e.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((t=>{this.pushChanges()})),this.insert$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((e=>{const n=e;ai.open$({template:Ha.chunk(),data:{navmap:t,hit:n}}).pipe(i.first()).subscribe((e=>{if(e instanceof si){const n=t.items||[];n.push(e.data),Object.assign(t,{items:n}),this.pushChanges()}}))}))}insert$(){const{node:e}=t.getContext(this),r=e.querySelector(".navmap-control__image");return n.fromEvent(r,"pointerdown").pipe(i.filter((t=>this.mode===Qa)),i.map((t=>new qa(r,t))))}onToggleMode(t){this.mode=this.mode===t?Ga:t,this.pushChanges()}onMoveItem(e,r){const s=this.navmap;switch(this.mode){case Wa:{const{node:o}=t.getContext(this),a=o.querySelector(".navmap-control__image"),c=r.position.slice(),l=new qa(a,e),u=n.fromEvent(a,"mousemove").pipe(i.map((t=>new Ya(a,t))),i.tap((t=>{const e=t.x-l.x,n=t.y-l.y;r.position=[Math.max(0,Math.min(1,c[0]+e)),Math.max(0,Math.min(1,c[1]+n)),0],this.pushChanges()}))),d=n.fromEvent(a,"mouseup").pipe(i.map((t=>new $a(a,t))),i.tap((t=>{const e=t.x-l.x,n=t.y-l.y;r.position=[Math.max(0,Math.min(1,c[0]+e)),Math.max(0,Math.min(1,c[1]+n)),0],Vi.itemUpdate$(s,r).pipe(i.first()).subscribe((t=>{Object.assign(r,t),this.pushChanges()}))})));u.pipe(i.takeUntil(d)).subscribe();break}}}onRemoveItem(t){const e=this.navmap;if(this.mode===za)Vi.itemDelete$(e,t).pipe(i.first()).subscribe((n=>{const i=e.items||[],r=i.indexOf(t);-1!==r&&i.splice(r,1),Object.assign(e,{items:i}),this.pushChanges()}))}onSubmit(){if(this.form.valid){this.form.submitted=!0;const t=this.form.value,e=Object.assign({items:[]},this.navmap,{name:t.name});Vi.navmapUpdate$(e).pipe(i.first()).subscribe((t=>{Object.assign(this.navmap,t),this.pushChanges()}),(t=>{this.error=t,this.form.reset()}))}else this.form.touched=!0}onRemove(){const t=this.navmap;ai.open$({template:ha.chunk(),data:{item:t}}).pipe(i.first()).subscribe((e=>{e instanceof si&&Vi.navmapDelete$(t).pipe(i.first()).subscribe((e=>{this.delete.next(t)}))}))}}Xa.meta={selector:"[navmap-edit]",outputs:["delete"],inputs:["navmap"]};class Ja extends t.Component{onInit(){this.busy=!1,this.active=!1,this.useHooks=In.enabled;const t=this.form=new e.FormGroup;this.controls=t.controls;const n=this.item;this.originalItem=Object.assign({},n),n.hasChromaKeyColor=!(!n.asset||!n.asset.chromaKeyColor),n.autoplay=n.asset&&n.asset.type.name===ir.Video.name?n.asset.autoplay:void 0,n.loop=n.asset&&n.asset.type.name===ir.Video.name?n.asset.loop:void 0,n.assetType=ar(n).id,this.doUpdateForm(),t.changes$.subscribe((t=>{this.doUpdateItem(t),this.pushChanges()}))}getFlagsDidChange(t,e){return["hasChromaKeyColor","autoplay","loop"].reduce(((n,i)=>{const r=e[i]||!1,s=t[i]||!1;return n||r!==s}),!1)}getAssetDidChange(t,e){return ta.assetDidChange(t.asset,e.asset)}doUpdateItem(t){const e=this.item,r=this.getAssetDidChange(e,t),s=this.getFlagsDidChange(e,t);if(Object.assign(e,t),e.asset&&(e.asset.chromaKeyColor=e.hasChromaKeyColor?[0,1,0]:null,e.asset.autoplay=e.autoplay,e.asset.loop=e.loop),r||s){(e.asset?ta.assetUpdate$(e.asset):n.of(null)).pipe(i.switchMap((()=>ea.inferItemUpdate$(this.view,e))),i.first()).subscribe(),this.view.updateIndices(this.view.items),"function"==typeof e.onUpdateAsset&&e.onUpdateAsset()}"function"==typeof e.onUpdate&&e.onUpdate()}doUpdateForm(){const t=this.item,n=this.form;if(this.type&&this.type.name===t.type.name)Object.keys(this.controls).forEach((n=>{switch(n){case"link":break;case"links":{const i=t.links.map((t=>({title:t.title||null,href:t.href||null,target:"_blank"}))),r=this.controls[n];for(;r.controls.length>i.length;)r.remove(r.controls[r.controls.length-1]);for(;r.controls.length<i.length;)r.push(new e.FormGroup({title:new e.FormControl(null),href:new e.FormControl(null),target:"_blank"}));r.patch(i);break}case"hasChromaKeyColor":this.controls[n].value=!(!t.asset||!t.asset.chromaKeyColor);break;case"autoplay":this.controls[n].value=!(!t.asset||!t.asset.autoplay);break;case"loop":this.controls[n].value=!(!t.asset||!t.asset.loop);break;case"assetType":this.controls[n].value=ar(t).id;break;default:this.controls[n].value=null!=t[n]?t[n]:null}}));else{let r;switch(this.type=t.type,Object.keys(this.controls).forEach((t=>{n.removeKey(t)})),t.type.name){case gi.Nav.name:r=this.useHooks?["id","type","title?","abstract?","viewId?","hook?","hookExtra?","keepOrientation?","important?","transparent?","position","rotation","scale","asset?","link?","links?"]:["id","type","title?","abstract?","viewId?","keepOrientation?","important?","transparent?","position","rotation","scale","asset?","link?","links?"];break;case gi.Plane.name:r=["id","type","position","rotation","scale","assetType?","asset?","hasChromaKeyColor?","autoplay?","loop?"];break;case gi.CurvedPlane.name:r=["id","type","position","rotation","scale","radius","height","arc","assetType?","asset?","hasChromaKeyColor?","autoplay?","loop?"];break;case gi.Texture.name:r=["id","type","assetType?","asset?","hasChromaKeyColor?","autoplay?","loop?"];break;case gi.Model.name:r=this.view.type.name===mi.Model?["id","type","asset?"]:["id","type","position","rotation","asset?"];break;default:r=["id","type"]}r.forEach((r=>{const s=-1!==r.indexOf("?");r=r.replace("?","");const o=null!=t[r]?t[r]:null;let a;switch(r){case"viewId":a=new e.FormControl(o,s?void 0:e.RequiredValidator()),ea.viewIdOptions$().pipe(i.first()).subscribe((t=>{a.options=t,a.value=a.value||null,this.pushChanges()}));break;case"hook":if(a=new e.FormControl(o,s?void 0:e.RequiredValidator()),In.enabled){const t=D.webhook.methods.nav.map((t=>({id:t,name:t})));t.unshift({id:null,name:"select"}),a.options=t}a.value=a.value||null,this.pushChanges();break;case"assetType":a=new e.FormControl(o,s?void 0:e.RequiredValidator()),a.options=Object.keys(rr).map((t=>rr[t]));break;case"link":break;case"links":{const n=t.links;a=new e.FormArray(n.map((t=>new e.FormGroup({title:new e.FormControl(t.title),href:new e.FormControl(t.href),target:"_blank"}))));break}default:a=new e.FormControl(o,s?void 0:e.RequiredValidator())}n.add(a,r)})),this.controls=n.controls}}onAssetTypeDidChange(t){const e=this.item,r=ar(e).id;if(t!==r){e.assetType=t;let r=n.of(null);t!==rr.ImageOrVideo.id&&(r=r.pipe(i.switchMap((()=>{const e=cr(t);return ta.assetCreate$(e)})))),r.pipe(i.first()).subscribe((t=>{this.controls.asset.value=t}))}}onChanges(t){this.doUpdateForm()}onSubmit(){if(!this.busy&&this.form.valid){this.busy=!0,this.pushChanges();const t=this.form.value,e=Object.assign({},t);this.item.type.name===gi.Nav.name&&(e.viewId=e.viewId||this.view.id);const n=this.view,r=new Si(e);ea.inferItemUpdate$(n,r).pipe(i.first()).subscribe((t=>{ea.inferItemUpdateResult$(n,r),this.update.next({view:n,item:r}),this.setTimeout((()=>{this.busy=!1,this.pushChanges()}))}),(t=>console.log("UpdateViewItemComponent.onSubmit.inferItemUpdate$.error",t)))}else this.form.touched=!0}onRemove(t){ai.open$({template:ha.chunk(),data:{item:this.item}}).pipe(i.first()).subscribe((t=>{t instanceof si&&this.delete.next({view:this.view,item:this.item})}))}onSelect(t){this.select.next({view:this.view,item:this.item.selected?null:this.item})}getTitle(t){return fe.getKeys("editor",t.type.name)}onAddLink(t){this.controls.links.push(new e.FormGroup({title:new e.FormControl(null),href:new e.FormControl(null),target:"_blank"}))}onRemoveLink(t){this.controls.links.remove(t)}clearTimeout(){this.to&&clearTimeout(this.to)}setTimeout(t,e){void 0===e&&(e=300),this.clearTimeout(),"function"==typeof t&&(this.to=setTimeout(t,e))}onDestroy(){this.clearTimeout()}}Ja.meta={selector:"update-view-item",outputs:["select","update","delete"],inputs:["view","item"],template:'\n\t\t<div class="group--headline" [class]="{ active: item.selected }" (click)="onSelect($event)">\n\t\t\t\x3c!-- <div class="id" [innerHTML]="item.id"></div> --\x3e\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon [name]="item.type.name"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title" [innerHTML]="getTitle(item)"></div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="item.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text [control]="controls.id" label="Id" [disabled]="true"></div>\n\t\t\t\t\x3c!-- <div control-text [control]="controls.type" label="Type" [disabled]="true"></div> --\x3e\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'nav\'">\n\t\t\t\t<div control-text [control]="controls.title" label="Title"></div>\n\t\t\t\t<div control-textarea [control]="controls.abstract" label="Abstract"></div>\n\t\t\t\t<div control-custom-select [control]="controls.viewId" label="NavToView"></div>\n\t\t\t\t<div control-checkbox [control]="controls.keepOrientation" label="Keep Orientation"></div>\n\t\t\t\t<div control-checkbox [control]="controls.important" label="Important"></div>\n\t\t\t\t<div control-checkbox [control]="controls.transparent" label="Transparent"></div>\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="3"></div>\n\t\t\t\t<div *if="controls.transparent.value == true">\n\t\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2"></div>\n\t\t\t\t</div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image" accept="image/jpeg, image/png"></div>\n\n\t\t\t\t<div class="group--link" *for="let link of controls.links.controls">\n\t\t\t\t\t<div class="group--controls">\n\t\t\t\t\t\t<div control-text [control]="link.controls.title" label="Link Title"></div>\n\t\t\t\t\t\t<div control-text [control]="link.controls.href" label="Link Url"></div>\n\t\t\t\t\t</div>\n\t\t\t\t\t<button type="button" class="btn--remove" (click)="onRemoveLink(link)"><svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#remove"></use></svg></button>\n\t\t\t\t</div>\n\n\t\t\t\t<div class="group--cta">\n\t\t\t\t\t<button type="button" class="btn--update" (click)="onAddLink($event)">\n\t\t\t\t\t\t<span>Add Link</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\n\t\t\t\t<div *if="useHooks">\n\t\t\t\t\t<div control-custom-select [control]="controls.hook" label="Hook"></div>\n\t\t\t\t\t<div control-text [control]="controls.hookExtra" label="Hook Extra"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'plane\' && view.type.name != \'media\'">\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2"></div>\n\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2"></div>\n\t\t\t\t<div control-custom-select [control]="controls.assetType" label="Asset" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Localized Image or Video" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox [control]="controls.hasChromaKeyColor" label="Use Green Screen" *if="item.asset"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'plane\' && view.type.name == \'media\'">\n\t\t\t\t<div control-vector [control]="controls.scale" label="Scale" [precision]="2"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Localized Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'curved-plane\'">\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2"></div>\n\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t\x3c!-- <div control-vector [control]="controls.scale" label="Scale" [precision]="2" [disabled]="true"></div> --\x3e\n\t\t\t\t<div control-number [control]="controls.radius" label="Radius" [precision]="2"></div>\n\t\t\t\t<div control-number [control]="controls.height" label="Height" [precision]="2"></div>\n\t\t\t\t<div control-number [control]="controls.arc" label="Arc" [precision]="0"></div>\n\t\t\t\t<div control-custom-select [control]="controls.assetType" label="Asset" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox [control]="controls.hasChromaKeyColor" label="Use Green Screen" *if="item.asset"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'texture\'">\n\t\t\t\t<div control-custom-select [control]="controls.assetType" label="Asset" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox [control]="controls.hasChromaKeyColor" label="Use Green Screen" *if="item.asset"></div>\n\t\t\t\t<div control-checkbox [control]="controls.autoplay" label="Autoplay" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t\t<div control-checkbox [control]="controls.loop" label="Loop" *if="item.asset && item.asset.type.name === \'video\'"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'model\'">\n\t\t\t\t<div control-vector [control]="controls.position" label="Position" [precision]="2" *if="view.type.name !== \'model\'"></div>\n\t\t\t\t<div control-vector [control]="controls.rotation" label="Rotation" [precision]="3" [increment]="Math.PI / 360" *if="view.type.name !== \'model\'"></div>\n\t\t\t\t<div control-model [control]="controls.asset" label="Model (.glb)" accept=".glb"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update" [class]="{ busy: busy }">\n\t\t\t\t\t<span [innerHTML]="\'update\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t<span [innerHTML]="\'remove\' | label"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t'};class Za extends t.Component{onInit(){this.busy=!1,this.active=!1;const t=this.form=new e.FormGroup({id:new e.FormControl(this.tile.id,e.RequiredValidator()),asset:new e.FormControl(this.tile.asset,e.RequiredValidator()),navs:new e.FormControl(this.tile.navs,e.RequiredValidator())});this.controls=t.controls,t.changes$.subscribe((t=>{const e=this.tile;Object.assign(e,t),"function"==typeof e.onUpdate&&e.onUpdate(),this.pushChanges()}))}onSubmit(){if(!this.busy&&this.form.valid){this.busy=!0,this.pushChanges();const t=Object.assign({},this.form.value),e=this.view,n=t;this.update.next({view:e,tile:n}),this.setTimeout((()=>{this.busy=!1,this.pushChanges()}))}else this.form.touched=!0}onRemove(t){ai.open$({template:ha.chunk(),data:{tile:this.tile}}).pipe(i.first()).subscribe((t=>{t instanceof si&&this.delete.next({view:this.view,tile:this.tile})}))}onSelect(t){this.select.next({view:this.view,tile:this.tile.selected?null:this.tile})}clearTimeout(){this.to&&clearTimeout(this.to)}setTimeout(t,e){void 0===e&&(e=300),this.clearTimeout(),"function"==typeof t&&(this.to=setTimeout(t,e))}onDestroy(){this.clearTimeout()}}Za.meta={selector:"update-view-tile",outputs:["select","update","delete"],inputs:["view","tile"],template:'\n\t\t<div class="group--headline" [class]="{ active: tile.selected }" (click)="onSelect($event)">\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon name="tile"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title">Tile {{tile.id}}</div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="tile.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text [control]="controls.id" label="Id" [disabled]="true"></div>\n\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg, image/png"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update" [class]="{ busy: busy }">\n\t\t\t\t\t<span [innerHTML]="\'update\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t\x3c!--\n\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t<span [innerHTML]="\'remove\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t--\x3e\n\t\t\t</div>\n\t\t</form>\n\t'};class tc extends t.Component{onInit(){this.busy=!1;const t=this.form=new e.FormGroup;this.controls=t.controls,this.doUpdateForm(),t.changes$.subscribe((t=>{this.doUpdateView(t),this.pushChanges()})),this.orbit$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{switch(this.view.type.name){case mi.WaitingRoom.name:case mi.Panorama.name:case mi.PanoramaGrid.name:case mi.Room3d.name:case mi.Model.name:case mi.Media.name:this.form.patch({latitude:t.orientation.latitude,longitude:t.orientation.longitude,zoom:t.zoom})}}))}orbit$(){let t,e,n=null;return Mn.in$.pipe(i.filter((t=>t.type===De)),i.auditTime(Math.floor(1e3/15)),i.distinctUntilChanged(((i,r)=>{const s=t!==r.orientation.latitude||e!==r.orientation.longitude||n!==r.zoom;return t=r.orientation.latitude,e=r.orientation.longitude,n=r.zoom,!s})))}getAssetDidChange(t){const e=this.view;if(e.type.name===mi.PanoramaGrid.name)return!1;const n=ta.assetDidChange(e.asset,t.asset),i=ta.assetDidChange(e.ar?e.ar.usdz:null,t.usdz),r=ta.assetDidChange(e.ar?e.ar.gltf:null,t.gltf);return!!(n||i||r)}doUpdateView(t){this.getAssetDidChange(t)&&this.onSubmit()}doUpdateForm(){const t=this.view;if(!this.type||this.type.name!==t.type.name){this.type=t.type;const n=this.form;let i;switch(Object.keys(this.controls).forEach((t=>{n.removeKey(t)})),t.type.name){case mi.WaitingRoom.name:i=["id","type","name","latitude","longitude","zoom","asset"];break;case mi.Panorama.name:i=["id","type","name","hidden?","latitude","longitude","zoom","asset"];break;case mi.PanoramaGrid.name:i=["id","type","name","hidden?","latitude","longitude","zoom"];break;case mi.Room3d.name:case mi.Model.name:i=["id","type","name","hidden?","latitude","longitude","zoom","asset"];break;case mi.Media.name:i=["id","type","name","hidden?","asset"];break;default:i=["id","type","name"]}t.type.name!==mi.WaitingRoom.name&&D.flags.ar&&(i.push("usdz?"),i.push("gltf?")),i.forEach((i=>{const r=-1!==i.indexOf("?");switch(i=i.replace("?","")){case"latitude":case"longitude":{const r=t.orientation||{latitude:0,longitude:0};n.add(new e.FormControl(r[i],e.RequiredValidator()),i);break}case"usdz":case"gltf":n.add(new e.FormControl(t.ar&&t.ar[i]||null,r?void 0:e.RequiredValidator()),i);break;default:n.add(new e.FormControl(null!=t[i]?t[i]:null,r?void 0:e.RequiredValidator()),i)}})),this.controls=n.controls}}onChanges(t){this.doUpdateForm()}onSubmit(){if(!this.busy&&this.form.valid){this.busy=!0,this.pushChanges();const t=Object.assign({},this.form.value);null!=t.latitude&&(t.orientation={latitude:t.latitude,longitude:t.longitude},delete t.latitude,delete t.longitude);const e=t.usdz||null,n=t.gltf||null;delete t.usdz,delete t.gltf,t.ar=e||n?{usdz:e,gltf:n}:null;const r=new vi(Object.assign({},this.view,t));ea.viewUpdate$(r).pipe(i.first()).subscribe((t=>{this.update.next({view:r}),this.setTimeout((()=>{this.busy=!1,this.pushChanges()}))}),(t=>console.log("UpdateViewComponent.onSubmit.viewUpdate$.error",t)))}else this.form.touched=!0}onRemove(t){ai.open$({template:ha.chunk(),data:{item:this.item}}).pipe(i.first()).subscribe((t=>{t instanceof si&&this.delete.next({view:this.view})}))}onSelect(t){this.select.next({view:this.view.selected?null:this.view})}getTitle(t){return fe.getKeys("editor",t.type.name)}clearTimeout(){this.to&&clearTimeout(this.to)}setTimeout(t,e){void 0===e&&(e=300),this.clearTimeout(),"function"==typeof t&&(this.to=setTimeout(t,e))}onDestroy(){this.clearTimeout()}}tc.meta={selector:"update-view",outputs:["select","update","delete"],inputs:["view"],template:'\n\t\t<div class="group--headline" [class]="{ active: view.selected }" (click)="onSelect($event)">\n\t\t\t\x3c!-- <div class="id" [innerHTML]="view.id"></div> --\x3e\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon [name]="view.type.name"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title" [innerHTML]="getTitle(view)"></div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="view.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text [control]="controls.id" label="Id" [disabled]="true"></div>\n\t\t\t\t\x3c!-- <div control-text [control]="controls.type" label="Type" [disabled]="true"></div> --\x3e\n\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'waiting-room\'">\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image" accept="image/jpeg"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'panorama\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image or Video" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'panorama-grid\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'room-3d\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-model [control]="controls.asset" label="Model (.glb)" accept=".glb"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'model\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-localized-asset [control]="controls.asset" label="Image" accept="image/jpeg"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name != \'waiting-room\' && (\'ar\' | flag)">\n\t\t\t\t<div control-model [control]="controls.usdz" label="AR IOS (.usdz)" accept=".usdz"></div>\n\t\t\t\t<div control-model [control]="controls.gltf" label="AR Android (.glb)" accept=".glb"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update" [class]="{ busy: busy }">\n\t\t\t\t\t<span [innerHTML]="\'update\' | label"></span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--remove" *if="view.type.name != \'waiting-room\'" (click)="onRemove($event)">\n\t\t\t\t\t<span [innerHTML]="\'remove\' | label"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t'};const ec=[Ma,na,fa,ia,ja,Xa,Va,Ha,ra,Fa,sa,oa,ca,aa,la,ua,da,ha,Aa,La,Ja,Za,tc],nc=[];class ic extends t.Module{}ic.meta={imports:[],declarations:[...ec,...nc],exports:[...ec,...nc]};class rc extends t.Component{onClose(){ai.reject()}}rc.meta={selector:"[iframe-modal]",inputs:["src"],template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="modal__content">\n\t\t\t<iframe [src]="src"></iframe>\n\t\t</div>\n\t'},rc.chunk=t=>`<div class="iframe-modal" iframe-modal src="${t}"></div>`;class sc extends t.Pipe{static transform(t){let e=D;const n=t.split(".");let i=n.shift();for(;n.length>0&&e[i];)e=e[i],i=n.shift();return e[i]||null}}sc.meta={name:"env"};class oc extends t.Pipe{static transform(t){return D.flags[t]||!1}}oc.meta={name:"flag"};class ac{constructor(t){this.file=t,this.name=t.name,this.type=lr(t.name),this.progress=0,this.size=t.size,this.uploading=!1,this.paused=!1,this.success=!1,this.complete=!1,this.error=null,this.preview=null}}class cc{constructor(t){t&&Object.assign(this,t)}}class lc extends cc{}class uc extends cc{}class dc extends cc{}class hc{constructor(){this.concurrent$=new n.BehaviorSubject(0),this.items$=new n.BehaviorSubject([]),this.events$=new n.ReplaySubject(1)}upload$(){const t=this.items$.getValue().filter((t=>!t.uploading));return n.combineLatest(t.map((t=>this.uploadItem$(t))))}uploadItem$(t){t.uploading=!0,this.events$.next(new lc({item:t}));const e=[t.file];return n.of(e).pipe(i.delayWhen((()=>this.concurrent$.pipe(i.filter((t=>t<4))))),i.tap((()=>this.concurrent$.next(this.concurrent$.getValue()+1))),i.first(),i.switchMap((t=>ta.upload$(t))),i.switchMap((e=>{const n=e[0];t.uploading=!1,t.complete=!0;const r=ur.fromUrl(n.url);return this.events$.next(new uc({item:t,asset:r})),ta.assetCreate$(r).pipe(i.tap((e=>{this.remove(t),this.events$.next(new dc({item:t,asset:e})),this.concurrent$.next(this.concurrent$.getValue()-1)})))})))}addItems(t){if(t&&t.length){const e=this.items$.getValue(),n=Array.from(t).map((t=>new ac(t)));e.push(...n),this.items$.next(e)}}remove(t){const e=this.items$.getValue(),n=e.indexOf(t);-1!==n&&e.splice(n,1),this.items$.next(e)}removeAll(){this.items$.next([])}drop$(e,r){if(t.isPlatformBrowser&&e){r=r||e;const t=document.querySelector("body");return n.merge(n.fromEvent(t,"drop"),n.fromEvent(t,"dragover")).pipe(i.map((t=>(t.preventDefault(),t.target===r&&this.addItems(t.dataTransfer.files),this.items$))))}return n.EMPTY}change$(e){return t.isPlatformBrowser&&e?n.fromEvent(e,"change").pipe(i.switchMap((t=>(e.files.length&&(this.addItems(e.files),e.value=""),this.items$)))):n.EMPTY}files$(t){return n.combineLatest(Array.from(t).map(((t,e)=>this.file$(t,e))))}file$(t,e){return this.read$(t,e).pipe(i.switchMap((()=>this.uploadFile$(t))))}read$(t,e){const r=new FileReader,s=n.fromEvent(r,"load").pipe(i.tap((t=>{const n=t.target.result;this.resize(n,(t=>{this.previews[e]=t,this.pushChanges()}))})));return r.readAsDataURL(t),s}uploadFile$(t){return ta.upload$([t]).pipe(i.switchMap((t=>{const e=t[0],n=ur.fromUrl(e.url);return ta.assetCreate$(n)})))}resize(t,e){if("function"==typeof e){const n=document.createElement("img");n.onload=function(){const t=document.createElement("canvas"),i=t.getContext("2d");let r=n.width,s=n.height;r>s?r>320&&(s*=320/r,r=320):s>240&&(r*=240/s,s=240),t.width=r,t.height=s,i.drawImage(n,0,0,r,s);const o=t.toDataURL("image/jpeg",.9);e(o)},n.src=t}}supported(){return(e=document.createElement("input")).type="file","files"in e&&!!((t=new XMLHttpRequest)&&"upload"in t&&"onprogress"in t.upload)&&!!window.FormData;var t,e}}class Ac extends Da{get items(){return this.items_}set items(t){this.items_=t,this.uploadCount=t.reduce(((t,e)=>t+(e.uploading||e.completed?0:1)),0)}onInit(){this.label=this.label||"label",this.accept=this.accept||"image/png, image/jpeg",this.multiple=!1!==this.multiple,this.items=[],this.assets=this.control.value||[],this.hasFiles=!1;const{node:e}=t.getContext(this),n=e.querySelector("input");n.setAttribute("accept",this.accept);const r=e.querySelector(".upload-drop"),s=this.service=new hc;s.drop$(n,r).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.items=t,this.pushChanges()})),s.change$(n).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.items=t,this.pushChanges()})),s.events$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{t instanceof dc&&(this.assets.push(t.asset),this.control.value=this.assets),this.items=this.items_,this.pushChanges()}))}onUpload(){this.service.upload$().pipe(i.first()).subscribe()}onCancel(){this.service.removeAll()}onItemPause(t){}onItemResume(t){}onItemCancel(t){}onItemRemove(t){this.service.remove(t)}}Ac.meta={selector:"[control-assets]",inputs:["control","label","multiple"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="listing--assets">\n\t\t\t\t<div class="listing__item" *for="let item of assets">\n\t\t\t\t\t<div class="upload-item">\n\t\t\t\t\t\t<div class="picture">\n\t\t\t\t\t\t\t<img [lazy]="item | asset" [size]="{ width: 320, height: 240 }" *if="item.type.name === \'image\'" />\n\t\t\t\t\t\t\t<video [src]="item | asset" *if="item.type.name === \'video\'"></video>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="name" [innerHTML]="item.file"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="listing__item" *for="let item of items">\n\t\t\t\t\t<div upload-item [item]="item" (pause)="onItemPause($event)" (resume)="onItemResume($event)" (cancel)="onItemCancel($event)" (remove)="onItemRemove($event)"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<div class="btn--browse">\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t\t<input type="file" accept="image/jpeg" multiple />\n\t\t\t\t</div>\n\t\t\t\t<div class="btn--upload" (click)="onUpload()" *if="uploadCount > 0" [innerHTML]="\'upload\' | label"></div>\n\t\t\t\t<div class="btn--cancel" (click)="onCancel()" *if="uploadCount > 0" [innerHTML]="\'cancel\' | label"></div>\n\t\t\t</div>\n\t\t\t<div class="upload-drop">\n    \t\t\t<span [innerHTML]="\'drag_and_drop_images\' | label"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class pc extends t.Component{get data(){let e=null;const{parentInstance:n}=t.getContext(this);return n instanceof Ji&&(e=n.modal.data),e}onInit(){console.log(this.data),this.page=null,ma.currentLanguagePage$(this.data.mode).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.page=t,this.pushChanges()}))}onClose(){ai.reject()}}pc.meta={selector:"[generic-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container" *if="page">\n\t\t\t<h1 class="title" [innerHTML]="page.title"></h1>\n\t\t\t<div class="description" [innerHTML]="page.description"></div>\n\t\t</div>\n\t\t<div class="modal__footer">\n\t\t\t<button type="button" class="btn--accept" (click)="onClose()">\n\t\t\t\t<span [innerHTML]="\'title_close\' | label"></span>\n\t\t\t</button>\n\t\t</div>\n\t'},pc.chunk=()=>'<div class="generic-modal" generic-modal></div>';class fc extends Da{onInit(){this.label=this.label||"label",this.linksSubject=new n.ReplaySubject,this.links$().pipe(i.takeUntil(this.unsubscribe$)).subscribe()}onChanges(){const{node:e}=t.getContext(this),i=Array.prototype.slice.call(e.querySelectorAll("a"));this.linksSubject.next(i.length?n.fromEvent(i,"click"):n.EMPTY)}links$(){return this.linksSubject.pipe(i.switchAll(),i.tap((t=>{if(D.flags.gdprRoutes){const e=pc.chunk();ai.open$({template:e,data:{mode:"privacy_policy"}}).pipe(i.first()).subscribe(),t.preventDefault()}})))}}fc.meta={selector:"[control-checkbox]",inputs:["control","label"],template:'\n\t\t<div class="group--form--checkbox" [class]="{ required: control.validators.length }">\n\t\t\t<label>\n\t\t\t\t<input type="checkbox" class="control--checkbox" [formControl]="control" [value]="true" />\n\t\t\t\t<span [innerHTML]="label | html"></span>\n\t\t\t</label>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class mc extends Da{onInit(){this.label=this.label||"label",this.dropped=!1,this.dropdownId=xa.nextId(),Or.typing$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.scrollToWord(t)}))}scrollToWord(e){const n=this.control.options||[];let i=-1;for(let t=0;t<n.length;t++){if(0===n[t].name.toLowerCase().indexOf(e.toLowerCase())){i=t;break}}if(-1!==i){const{node:e}=t.getContext(this),n=e.querySelector(".dropdown"),r=e.querySelector(".nav--dropdown").children[i];r&&n.scrollTo(0,r.offsetTop)}}setOption(t){let e;if(this.isMultiple){e=this.control.value||[];const n=e.indexOf(t.id);-1!==n?e.splice(n,1):e.push(t.id),e=e.length?e.slice():null}else e=t.id;this.control.value=e,this.change.next(e)}hasOption(t){if(this.isMultiple){return-1!==(this.control.value||[]).indexOf(t.id)}return this.control.value===t.id}getLabel(){let t=this.control.value;const e=this.control.options||[];if(this.isMultiple)return t=t||[],t.length?t.map((t=>{const n=e.find((e=>e.id===t||e.name===t));return n?n.name:""})).join(", "):"select";{const n=e.find((e=>e.id===t||e.name===t));return n?n.name:"select"}}onDropped(t){this.dropped&&null===t&&(this.control.touched=!0),this.dropped=t===this.dropdownId}get isMultiple(){return this.multiple&&!1!==this.multiple&&"false"!==this.multiple}}mc.meta={selector:"[control-custom-select]",outputs:["change"],inputs:["control","label","multiple"],template:'\n\t\t<div class="group--form--select" [class]="{ required: control.validators.length, multiple: isMultiple }" [dropdown]="dropdownId" (dropped)="onDropped($event)">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<span class="control--custom-select" [innerHTML]="getLabel() | label"></span>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t\t<div class="dropdown" [dropdown-item]="dropdownId">\n\t\t\t<div class="category" [innerHTML]="label"></div>\n\t\t\t<ul class="nav--dropdown" [class]="{ multiple: isMultiple }">\n\t\t\t\t<li (click)="setOption(item)" [class]="{ empty: item.id == null }" *for="let item of control.options">\n\t\t\t\t\t<span [class]="{ active: hasOption(item) }" [innerHTML]="item.name | label"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t'};class gc extends Da{onInit(){this.label=this.label||"label",this.disabled=this.disabled||!1;const{node:e}=t.getContext(this),r=this.input=e.querySelector("input");n.merge(n.fromEvent(r,"input")).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.onInputDidChange(t))),n.fromEvent(r,"blur").pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.onInputDidBlur(t)))}onInputDidChange(t){}onInputDidBlur(t){this.control.touched=!0,this.value=this.input.value}}gc.meta={selector:"[control-link]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<input type="text" class="control--text" [formControl]="control" [placeholder]="label" [disabled]="disabled" />\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class vc extends Da{get localizedValue(){let t=this.control.value;if(t&&t.locale){const e=t.locale[this.currentLanguage];e&&(t=e)}return t}onInit(){this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||"image/png, image/jpeg",this.languages=D.languages,this.currentLanguage=ge.lang;const{node:e}=t.getContext(this),r=e.querySelector("input");r.setAttribute("accept",this.accept),Pa.drop$(r).pipe(i.takeUntil(this.unsubscribe$)).subscribe(),Pa.change$(r).pipe(i.switchMap((t=>{const e=t.map(((t,e)=>ta.upload$([t]).pipe(i.switchMap((t=>(this.languages.length>1?ta.createOrUpdateLocalizedAsset$:ta.createOrUpdateAsset$)(t,this.control,this.currentLanguage))))));return n.combineLatest(e)})),i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.control.value=t[0]}))}setLanguage(t){ge.setLanguage$(t).pipe(i.first()).subscribe((e=>{this.currentLanguage=t,this.pushChanges()}))}}vc.meta={selector:"[control-localized-asset]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--picture">\n\t\t\t\t<div class="group--picture__info">\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t</div>\n\t\t\t\t<img [lazy]="localizedValue | asset" [size]="{ width: 320, height: 240 }" *if="localizedValue && localizedValue.type.name === \'image\'" />\n\t\t\t\t<video [src]="localizedValue | asset" *if="localizedValue && localizedValue.type.name === \'video\'"></video>\n\t\t\t\t<input type="file">\n\t\t\t</div>\n\t\t\t<div class="file-name" *if="localizedValue" [innerHTML]="localizedValue.file"></div>\n\t\t\t<ul class="nav--languages" *if="languages.length > 1">\n\t\t\t\t<li class="nav__item" [class]="{ active: lang == currentLanguage }" (click)="setLanguage(lang)" [innerHTML]="lang" *for="let lang of languages"></li>\n\t\t\t</ul>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class yc extends Ba{onInit(){this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||".glb";const{node:e}=t.getContext(this),r=this.input=e.querySelector("input");r.setAttribute("accept",this.accept),Pa.change$(r).pipe(i.switchMap((t=>{const e=t.map(((t,e)=>ta.upload$([t]).pipe(i.switchMap((t=>ta.createOrUpdateAsset$(t,this.control))))));return n.combineLatest(e)})),i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.control.value=t[0]}))}onRemove(t){ta.assetDelete$(this.control.value).pipe(i.first()).subscribe((()=>{this.control.value=null,this.input.value=null,this.control.touched=!0}))}read$(t,e){return n.of(t)}}yc.meta={selector:"[control-model]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--model">\n\t\t\t\t<div class="file-name" *if="!control.value" [innerHTML]="\'select_file\' | label"></div>\n\t\t\t\t<div class="file-name" *if="control.value" [innerHTML]="control.value.file"></div>\n\t\t\t\t<div class="btn--upload"><input type="file"><span [innerHTML]="\'browse\' | label"></span></div>\n\t\t\t\t<div class="btn--remove" *if="control.value" (click)="onRemove($event)"><span [innerHTML]="\'remove\' | label"></span></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class _c extends Da{onInit(){this.label=this.label||"label",this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1}updateValue(t){this.control.value=t}}_c.meta={selector:"[control-number]",inputs:["control","label","precision","increment","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="control--content control--number">\n\t\t\t\t<input-value label="" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value" (update)="updateValue($event)"></input-value>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class bc extends Da{onInit(){this.label=this.label||"label"}}bc.meta={selector:"[control-password]",inputs:["control","label"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<input type="password" class="control--text" [formControl]="control" [placeholder]="label" />\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class Ec extends Da{onInit(){this.label=this.label||"label"}}Ec.meta={selector:"[control-select]",inputs:["control","label"],template:'\n\t\t<div class="group--form--select" [class]="{ required: control.validators.length }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<select class="control--select" [formControl]="control" required>\n\t\t\t\t<option [value]="null" [innerHTML]="\'select\' | label"></option>\n\t\t\t\t<option [value]="item.id" *for="let item of control.options" [innerHTML]="item.name"></option>\n\t\t\t</select>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class wc extends Da{onInit(){this.label=this.label||"label",this.disabled=this.disabled||!1}}wc.meta={selector:"[control-text]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t<input type="text" class="control--text" [formControl]="control" [placeholder]="label" [disabled]="disabled" />\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class Sc extends Da{onInit(){this.label=this.label||"label",this.disabled=this.disabled||!1}}Sc.meta={selector:"[control-textarea]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form--textarea" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<textarea class="control--text" [formControl]="control" [placeholder]="label" [innerHTML]="label" rows="4" [disabled]="disabled"></textarea>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class Tc extends Da{onInit(){this.label=this.label||"label",this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1}updateValue(t,e){const n=this.control.value;n[t]=e,this.control.value=n.slice()}}Tc.meta={selector:"[control-vector]",inputs:["control","label","precision","increment","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="control--content control--vector">\n\t\t\t\t<input-value label="x" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[0]" (update)="updateValue(0, $event)"></input-value>\n\t\t\t\t<input-value label="y" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[1]" (update)="updateValue(1, $event)"></input-value>\n\t\t\t\t<input-value label="z" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[2]" (update)="updateValue(2, $event)"></input-value>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};class Cc extends t.Directive{onChanges(){const{node:e}=t.getContext(this);!0===this.disabled?(e.disabled=this.disabled,e.setAttribute("disabled",this.disabled)):(delete e.disabled,e.removeAttribute("disabled"))}}Cc.meta={selector:"input[disabled],textarea[disabled]",inputs:["disabled"]};class Rc extends Da{getLabel(t,e){return fe.transform(`error_${t}`)}}Rc.meta={selector:"errors-component",inputs:["control"],template:'\n\t<div class="inner" [style]="{ display: control.invalid && control.touched ? \'block\' : \'none\' }">\n\t\t<div class="error" *for="let [key, value] of control.errors">\n\t\t\t<span [innerHTML]="getLabel(key, value)"></span>\n\t\t\t\x3c!-- <span class="key" [innerHTML]="key"></span> <span class="value" [innerHTML]="value | json"></span> --\x3e\n\t\t</div>\n\t</div>\n\t'};class Ic extends t.Component{onInit(){this.label=this.label||"label",this.value=this.value||0,this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1,this.increment$(".btn--more",1).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.value+=t,this.update.next(this.value),this.pushChanges()})),this.increment$(".btn--less",-1).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.value+=t,this.update.next(this.value),this.pushChanges()}));const{node:e}=t.getContext(this),r=this.input=e.querySelector("input");n.merge(n.fromEvent(r,"input")).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.onInputDidChange(t))),n.merge(n.fromEvent(r,"blur"),n.fromEvent(r,"keydown").pipe(i.filter((t=>"Enter"===t.key||13===t.keyCode)))).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.onInputDidBlur(t)))}onInputDidChange(t){t.target.value=t.target.value.replace(/[^\d|\.|-]/g,"")}onInputDidBlur(t){const e=parseFloat(this.input.value);this.value!==e&&(isNaN(e)?this.input.value=this.getValue():(this.value=e,this.update.next(this.value)))}increment$(e,r){const{node:s}=t.getContext(this),o=s.querySelector(e);let a,c;return n.race(n.fromEvent(o,"mousedown"),n.fromEvent(o,"touchstart")).pipe(i.tap((()=>{c=this.increment,a=16})),i.switchMap((t=>n.interval(30).pipe(i.filter((t=>t%a==0)),i.map((()=>{const t=c*r;return a=Math.max(1,Math.floor(.85*a)),t})),i.takeUntil(n.race(n.fromEvent(o,"mouseup"),n.fromEvent(o,"touchend")))))))}getValue(){return this.value.toFixed(this.precision)}setValue(t){this.value+=this.increment*t,this.update.next(this.value),this.pushChanges()}}Ic.meta={selector:"input-value",outputs:["update"],inputs:["value","label","precision","increment","disabled"],template:'\n\t\t<div class="group--control" [class]="{ disabled: disabled }">\n\t\t\t<input type="text" class="control--text" [placeholder]="label" [value]="getValue()" [disabled]="disabled" />\n\t\t\t<div class="control--trigger">\n\t\t\t\t<div class="btn--more" (click)="setValue(1)">+</div>\n\t\t\t\t<div class="btn--less" (click)="setValue(-1)">-</div>\n\t\t\t</div>\n\t\t</div>\n\t'};class xc extends t.Component{onInit(){this.env=M}onTest(t){this.test.next(t)}onReset(t){this.reset.next(t)}}xc.meta={selector:"test-component",inputs:["form"],outputs:["test","reset"],template:'\n\t<div class="group--form--results" *if="env.DEVELOPMENT">\n\t\t<code [innerHTML]="form.value | json"></code>\n\t\t<button type="button" class="btn--mode" (click)="onReset($event)"><span>reset</span></button>\n\t\t<button type="button" class="btn--mode" (click)="onTest($event)"><span>test</span></button>\n\t</div>\n\t'};class Oc extends t.Directive{onChanges(e){const{node:n}=t.getContext(this);n.value=this.value,n.setAttribute("value",this.value)}}Oc.meta={selector:"[value]",inputs:["value"]};class Lc extends t.Pipe{static transform(t){if(t){t=t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e))}));const e=['"',"&","'","<",">"," ","Â¡","Â¢","Â£","Â¤","Â¥","Â¦","Â§","Â¨","Â©","Âª","Â«","Â¬","Â­","Â®","Â¯","Â°","Â±","Â²","Â³","Â´","Âµ","Â¶","Â·","Â¸","Â¹","Âº","Â»","Â¼","Â½","Â¾","Â¿","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã","Ã ","Ã¡","Ã£","Ã¤","Ã¥","Ã¦","Ã§","Ã¨","Ã©","Ãª","Ã«","Ã¬","Ã­","Ã®","Ã¯","Ã°","Ã±","Ã²","Ã³","Ã´","Ãµ","Ã¶","Ã·","Ã¸","Ã¹","Ãº","Ã»","Ã¼","Ã½","Ã¾","Ã¿","&","â¢","Â°","â","â°","â","Â±","â ","â","Â¬","Âµ","â¥","â¥","â¬","Â£","Â¥","Â¢","Â©","Â®","â¢","Î±","Î²","Î³","Î´","Îµ","Î¶","Î·","Î¸","Î¹","Îº","Î»","Î¼","Î½","Î¾","Î¿","Ï","Ï","Ï","Ï","Ï","Ï","Ï","Ï","Ï","Î","Î","Î","Î","Î","Î","Î","Î","Î","Î","Î","Î","Î","Î","Î","Î ","Î¡","Î£","Î¤","Î¥","Î¦","Î§","Î¨","Î©"],n=new RegExp(`(&${["quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","amp","bull","deg","infin","permil","sdot","plusmn","dagger","mdash","not","micro","perp","par","euro","pound","yen","cent","copy","reg","trade","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"].join(";)|(&")};)`,"g");return t=t.replace(n,(function(){for(let t=1;t<arguments.length;t++)if(arguments[t])return e[t-1]})),t}}}Lc.meta={name:"html"};class Mc extends t.Directive{onChanges(){const{node:e}=t.getContext(this);e.setAttribute("id",this.id)}}Mc.meta={selector:"[id]",inputs:["id"]};class kc extends t.Component{onInit(){this.showLanguages=!1,this.languageService=ge}setLanguage(t){this.languageService.setLanguage$(t).pipe(i.first()).subscribe((t=>{this.showLanguages=!1,this.pushChanges(),this.set.next()}))}toggleLanguages(){this.showLanguages=!this.showLanguages,this.pushChanges()}}kc.meta={selector:"[language]",outputs:["set"],template:'\n\t\t<button type="button" class="btn--language" (click)="toggleLanguages()" *if="languageService.hasLanguages"><span [innerHTML]="languageService.activeLanguage.title"></span> <svg viewBox="0 0 8 5"><use xlink:href="#caret-down"></use></svg></button>\n\t\t<ul class="nav--language" *if="showLanguages">\n\t\t\t<li (click)="setLanguage(language)" *for="let language of languageService.languages"><span [innerHTML]="language.title"></span></li>\n\t\t</ul>\n\t'};class Nc{static get cache(){return this.cache_||(this.cache_={}),this.cache_}static get(t){return this.cache[t]}static set(t,e){this.cache[t]=e;const n=Object.keys(this.cache);n.length>100&&this.remove(n[0])}static remove(t){delete this.cache[t]}}class Pc extends t.Directive{onInit(){const{node:e}=t.getContext(this);e.classList.add("lazy"),this.input$=(new n.Subject).pipe(i.distinctUntilChanged(),i.switchMap((t=>{const i=Nc.get(t);return i?n.of(i):(e.classList.remove("lazyed"),this.lazy$(t))})),i.takeUntil(this.unsubscribe$)),this.input$.subscribe((t=>{Nc.set(this.lazy,t),e.setAttribute("src",t),e.classList.add("lazyed")}))}onChanges(){this.input$.next(this.lazy)}lazy$(e){const{node:r}=t.getContext(this);return class{static observer(){return this.observer_||(this.readySubject_=new n.BehaviorSubject(!1),this.observerSubject_=new n.Subject,this.observer_=new IntersectionObserver((t=>{this.observerSubject_.next(t)}))),this.observer_}static intersection$(t){if("IntersectionObserver"in window){const e=this.observer();return e.observe(t),this.observerSubject_.pipe(i.map((e=>e.find((e=>e.target===t)))),i.filter((t=>void 0!==t&&t.isIntersecting)),i.first(),i.finalize((()=>e.unobserve(t))))}return n.of({target:t})}}.intersection$(r).pipe(i.switchMap((()=>ls.load$(e,this.size))),i.first())}}Pc.meta={selector:"[lazy],[[lazy]]",inputs:["lazy","size"]};class Dc extends t.Pipe{static transform(t){let e=Dc.urlify(t);return e=Dc.breakLines(e),e}static urlify(t){return t.replace(/(?:(?:https?|ftp):\/\/|\b(?:[a-z\d]+\.))(?:(?:[^\s()<>]+|\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))?\))+(?:\((?:[^\s()<>]+|(?:\(?:[^\s()<>]+\)))?\)|[^\s`!()\[\]{};:'".,<>?Â«Â»ââââ]))?/gim,(t=>`<a href="${t}" target="_blank">${t}</a>`))}static breakLines(t){return t.replace(/\n/gm,(t=>"<br>"))}}Dc.meta={name:"message"};class Bc extends t.Component{onInit(){const{parentInstance:e}=t.getContext(this);e instanceof Ji&&(this.data=e.modal.data)}onClose(){ai.reject()}}Bc.meta={selector:"[modal]"};class Uc extends t.Directive{constructor(){super(...arguments),this.path=void 0,this.segments=void 0,this.routerLink_=void 0}get routerLink(){return this.routerLink_}set routerLink(t){this.routerLink_=Array.isArray(t)?t:[t]}onInit(){this.routerLink$().pipe(i.takeUntil(this.unsubscribe$)).subscribe()}onChanges(){const{node:e}=t.getContext(this),n=this.routerLink;if(n.length){const t=te.buildUrl(...n);e.setAttribute("href",t)}else e.setAttribute("href","")}routerLink$(){const{node:e}=t.getContext(this);return n.fromEvent(e,"click").pipe(i.map((t=>(te.setRouterLink(...this.routerLink),t.preventDefault(),!1))))}getSegments(t){const e=[];return t.forEach((t=>{if("string"==typeof t){const e=/([^:]+)|\:([^\/]+)/g,n=t.matchAll(e);for(let t of n){const e=t[1],n=t[2];if(e);else if(n){({})[n]=null}}}else e.push(new RouteSegment("",{}))})),e}}Uc.meta={selector:"[routerLink]",inputs:["routerLink"]};class Fc extends t.Component{onInit(){super.onInit();const{parentInstance:e}=t.getContext(this);e instanceof Ji&&(this.data=e.modal.data)}onAccept(t){ai.resolve()}onReject(t){ai.reject()}onClose(){ai.reject()}}Fc.meta={selector:"[support-request-modal]",template:'\n\t\t<div class="modal__header">\n\t\t\t<button type="button" class="btn--close" (click)="onClose()">\n\t\t\t\t<svg width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#close"></use></svg>\n\t\t\t</button>\n\t\t</div>\n\t\t<div class="container">\n\t\t\t<div class="form">\n\t\t\t\t<div class="title">Un operatore Ã¨ disponibile per un tour guidato.<br>Desideri Accettare?</div>\n\t\t\t\t<div class="group--cta">\n\t\t\t\t\t<button type="button" class="btn--accept" (click)="onAccept()">\n\t\t\t\t\t\t<span>Accetta</span>\n\t\t\t\t\t</button>\n\t\t\t\t\t<button type="button" class="btn--cancel" (click)="onReject()">\n\t\t\t\t\t\t<span>Rifiuta</span>\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t'},Fc.chunk=()=>'<div class="support-request-modal" support-request-modal></div>';class Hc extends t.Structure{onInit(){this.update()}onChanges(){this.update()}update(){if(this.name_!==this.name){this.name_=this.name;const{node:e}=t.getContext(this);if(e.parentNode){const t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg"),i=this.width||24,r=this.height||24;n.setAttribute("class",`icon--${this.name}`),n.setAttributeNS(null,"viewBox",`0 0 ${i} ${r}`),n.innerHTML=`<use xlink:href="#${this.name}"></use>`,n.rxcompId=e.rxcompId,n.classList.add(...e.classList),e.parentNode.replaceChild(n,e)}}}}Hc.meta={selector:"svg-icon",inputs:["name","width","height"]};class Vc extends t.Directive{set title(e){if(this.title_!==e){this.title_=e;const{node:n}=t.getContext(this);e?n.setAttribute("title",e):n.removeAttribute("title")}}get title(){return this.title_}}Vc.meta={selector:"[[title]]",inputs:["title"]};class jc extends t.Component{onInit(){null===this.item.preview&&this.read$(this.item.file).pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.item.preview=t,this.pushChanges()}))}read$(t){const e=new FileReader,r=n.fromEvent(e,"load").pipe(i.switchMap((t=>{const e=t.target.result;return this.item.type.name===ir.Image.name?this.resize$(e):n.of(e)})));return e.readAsDataURL(t),r}resize$(t){return new Promise(((e,n)=>{const i=document.createElement("img");i.onload=function(){const t=document.createElement("canvas"),n=t.getContext("2d");let r=i.width,s=i.height;r>s?r>320&&(s*=320/r,r=320):s>240&&(r*=240/s,s=240),t.width=r,t.height=s,n.drawImage(i,0,0,r,s);const o=t.toDataURL("image/jpeg",.9);e(o)},i.onerror=function(t){n(t)},i.src=t}))}onPause(){this.pause.next(this.item)}onResume(){this.resume.next(this.item)}onCancel(){this.cancel.next(this.item)}onRemove(){this.remove.next(this.item)}}jc.meta={selector:"[upload-item]",outputs:["pause","resume","cancel","remove"],inputs:["item"],template:'\n\t<div class="upload-item" [class]="{ \'error\': item.error, \'success\': item.success }">\n\t\t<div class="picture">\n\t\t\t<img [lazy]="item.preview" [size]="{ width: 320, height: 240 }" *if="item.preview && item.type.name === \'image\'" />\n\t\t\t<video [src]="item.preview" *if="item.preview && item.type.name === \'video\'"></video>\n\t\t\t<svg class="spinner" width="24" height="24" viewBox="0 0 24 24" [class]="{ uploading: item.uploading }" *if="item.uploading"><use xlink:href="#spinner"></use></svg>\n\t\t</div>\n\t\t<div class="name">{{item.name}}</div>\n\t\t\x3c!--\n\t\t<div class="group--info">\n\t\t\t<div>progress: {{item.progress}}</div>\n\t\t\t<div>size: {{item.size}} bytes</div>\n\t\t\t<div>current speed: {{item.currentSpeed}} bytes/s</div>\n\t\t\t<div>average speed: {{item.averageSpeed}} bytes/s</div>\n\t\t\t<div>time ramining: {{item.timeRemaining}}s</div>\n\t\t\t<div>paused: {{item.paused}}</div>\n\t\t\t<div>success: {{item.success}}</div>\n\t\t\t<div>complete: {{item.complete}}</div>\n\t\t\t<div>error: {{item.error}}</div>\n\t\t</div>\n\t\t--\x3e\n\t\t\x3c!--\n\t\t<div class="group--cta" *if="!item.complete && item.uploading">\n\t\t\t<div class="btn--pause" (click)="onPause()">pause</div>\n\t\t\t<div class="btn--resume" (click)="onResume()">resume</div>\n\t\t\t<div class="btn--cancel" (click)="onCancel()">cancel</div>\n\t\t</div>\n\t\t--\x3e\n\t\t<div class="group--cta">\n\t\t\t<div class="btn--remove" (click)="onRemove()" *if="!item.complete">remove</div>\n\t\t</div>\n\t</div>\n\t'};class Gc extends t.Directive{set hls(t){this.hls_!==t&&(this.hls_=t,this.play(t))}get hls(){return this.hls_}play(e){const{node:n}=t.getContext(this);if(Hls.isSupported()){var i=new Hls;i.attachMedia(n),i.on(Hls.Events.MEDIA_ATTACHED,(()=>{i.loadSource(e),i.on(Hls.Events.MANIFEST_PARSED,((t,e)=>{n.play()}))}))}}}Gc.meta={selector:"[[hls]]",inputs:["hls"]};class Qc extends t.Context{constructor(t,e,n,i,r,s,o){super(o),this[t]=e,this[n]=i,this.index=r,this.count=s}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}const zc=1,Wc=2,Kc=3;class qc extends t.Structure{onInit(){const{module:e,node:r}=t.getContext(this),s=r.firstElementChild,o=r.getAttribute("*virtual");r.removeAttribute("*virtual"),r.removeChild(s);const a=this.tokens=this.getExpressionTokens(o);this.virtualFunction=e.makeFunction(a.iterable),this.container=r,this.template=s,this.mode=this.mode||1,this.width=this.width||250,this.gutter=void 0!==this.gutter?this.gutter:20,this.reverse=!0===this.reverse,this.options={width:this.width,gutter:this.gutter,reverse:this.reverse,containerWidth:0,containerHeight:0,top:0,cols:[0]},this.cachedRects={},this.cachedInstances=[],this.cacheNodes=[],this.items$=new n.BehaviorSubject([]),this.update$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{}))}onChanges(e){const n=t.getContext(this),i=n.module.resolve(this.virtualFunction,n.parentInstance,this)||[];this.mode=this.mode||1,this.width=this.width||250,this.gutter=void 0!==this.gutter?this.gutter:20,this.options.width=this.width,this.updateView(!0),this.items$.next(i)}update$(){return this.updateView(!0),n.merge(this.scroll$(),this.resize$(),this.items$.pipe(i.distinctUntilChanged())).pipe(i.map((t=>this.updateForward())))}updateForward(){const t=this.options,e=this.items$.getValue(),n=e.length;this.container.position="relative";let i=0;const r=this.getWidth(),s=this.getGutter(r),o=[];for(let a=0,c=e.length;a<c;a++){const c=e[a];let l,u,d,h,A,p=this.cachedRects[a];if(p?(l=p.col,u=p.height,h=p.left):(l=this.getCol(),u=this.getHeight(r,c)),d=t.cols[l],this.intersect(d+t.top,d+u+t.top,0,t.containerHeight)){p||(h=this.getLeft(l,r,s));const e=this.cachedNode(a,a,c,n);e.style.position="absolute",e.style.top=d+"px",e.style.left=h+"px",e.style.width=r+"px",u!==e.offsetHeight&&(u=e.offsetHeight),A=d+u+t.gutter,i=Math.max(i,A),t.cols[l]=A,p?(p.height=u,p.bottom=A):this.cachedRects[a]={col:l,width:r,height:u,left:h,top:d,bottom:A},o.push(c)}else this.removeNode(a),A=d+u+t.gutter,t.cols[l]=A,i=Math.max(i,A)}let a=e.length;for(;a<this.cacheNodes.length;)this.removeNode(a),a++;this.cacheNodes.length=e.length;const c=this.container.parentNode;if(this.reverse&&i<c.offsetHeight-1){const t=c.offsetHeight-1-i;e.forEach(((e,i)=>{if(-1!==o.indexOf(e)){const r=this.cachedRects[i];this.cachedNode(i,i,e,n).style.top=r.top+t+"px"}})),this.container.style.height=c.offsetHeight-1+"px"}else this.container.style.height=`${i}px`;return o}getCols(){const t=this.options,e=Math.floor((t.containerWidth+t.gutter)/(t.width+t.gutter))||1;return new Array(e).fill(0)}getCol(){const t=this.options;let e;switch(this.mode){case Wc:case Kc:case zc:e=t.cols.reduce(((t,e,n,i)=>e<i[t]?n:t),0);break;default:e=0}return e}getWidth(){const t=this.options;let e;switch(this.mode){case Wc:case Kc:e=t.width;break;case zc:e=(t.containerWidth-(t.cols.length-1)*t.gutter)/t.cols.length;break;default:e=t.containerWidth}return e}getHeight(t,e){const n=this.options;let i;switch(this.mode){case Wc:case Kc:case zc:i=n.width;break;default:i=80}return i}getGutter(t){const e=this.options;let n;switch(this.mode){case Wc:case Kc:n=e.gutter;break;case zc:n=(e.containerWidth-e.cols.length*t)/(e.cols.length-1);break;default:n=0}return n}getLeft(t,e,n){const i=this.options;let r;switch(this.mode){case Wc:case zc:r=t*(e+n);break;case Kc:r=(i.containerWidth-i.cols.length*(e+n)+n)/2+t*(e+n);break;default:r=0}return r}cachedNode(t,e,n,i){return this.cacheNodes[t]?this.updateNode(t,e,n):this.createNode(t,e,n,i)}createNode(e,n,i,r){const s=this.template.cloneNode(!0);delete s.rxcompId,this.container.appendChild(s),this.cacheNodes[e]=s;const o=t.getContext(this),a=o.module,c=this.tokens,l=[c.key,n,c.value,i,n,r,o.parentInstance],u=a.makeInstance(s,Qc,o.selector,o.parentInstance,l),d=t.getContext(u);return a.compile(s,d.instance),this.cachedInstances[e]=u,s}updateNode(t,e,n){const i=this.cachedInstances[t],r=this.tokens;return i[r.key]!==e&&(i[r.key]=e,i[r.value]=n,i.pushChanges()),this.cacheNodes[t]}removeNode(e){this.cachedInstances[e]=void 0;const n=this.cacheNodes[e];if(n){const e=t.getContext(this).module;n.parentNode.removeChild(n),e.remove(n)}return this.cacheNodes[e]=void 0,n}intersect(t,e,n,i){return n<e&&i>t}resize$(){return n.fromEvent(window,"resize").pipe(i.startWith((t=>null)),i.auditTime(100),i.tap((()=>this.updateView(!0))))}scroll$(){const{node:e}=t.getContext(this);return e.parentNode&&"auto"===getComputedStyle(e.parentNode).overflowY?n.fromEvent(e.parentNode,"scroll").pipe(i.tap((()=>{this.updateView()}))):n.fromEvent(window,"scroll").pipe(i.tap((()=>this.updateView())))}updateView(t){const e=this.container.getBoundingClientRect(),n=this.options;n.top=e.top,n.containerWidth=e.width,n.containerHeight=this.container.parentNode.offsetHeight,n.cols=this.getCols(),t&&(this.cachedRects={})}getExpressionTokens(t){if(null===t)throw new Error("invalid virtual");if(-1===t.trim().indexOf("let ")||-1===t.trim().indexOf(" of "))throw new Error("invalid virtual");const e=t.split(";").map((t=>t.trim())).filter((t=>""!==t)),n=e[0].split(" of ").map((t=>t.trim()));let i=n[0].replace(/\s*let\s*/,"");const r=n[1];let s="index";const o=i.match(/\[(.+)\s*,\s*(.+)\]/);if(o&&(s=o[1],i=o[2]),e.length>1){const t=e[1].split(/\s*let\s*|\s*=\s*index/).map((t=>t.trim()));3===t.length&&(s=t[1])}return{key:s,value:i,iterable:r}}}qc.meta={selector:"[*virtual]",inputs:["mode","width","gutter","reverse"]};class Yc extends t.Component{onInit(){this.playing=!1,this.progress=0,this.media$().pipe(i.takeUntil(this.unsubscribe$)).subscribe(),this.drag$().pipe(i.takeUntil(this.unsubscribe$)).subscribe()}media$(){const{node:e}=t.getContext(this),n=document.querySelector(".page");return Er.events$.pipe(i.tap((t=>{t instanceof gr?(this.media=t.loader,this.playing=!0,e.classList.add("active"),n.classList.add("media-player-active"),this.pushChanges()):this.media===t.loader&&(t instanceof vr?(this.playing=!1,this.pushChanges()):t instanceof _r?this.dragging||(this.progress=this.media.progress,this.pushChanges()):t instanceof yr&&(this.media=null,e.classList.remove("active"),n.classList.remove("media-player-active"),this.pushChanges()))})))}drag$(){const{node:e}=t.getContext(this),n=e.querySelector(".track");let r;return Xr.observe$(n).pipe(i.filter((t=>this.media)),i.tap((t=>{if(t instanceof Kr){const e=n.getBoundingClientRect();r=Math.max(0,Math.min(1,(t.down.x-e.left)/e.width)),this.dragging=!0}else if(t instanceof qr){const e=n.getBoundingClientRect(),i=Math.max(0,Math.min(1,r+t.distance.x/e.width));this.progress=i,this.pushChanges()}else t instanceof Yr&&(this.media.progress=this.progress,this.dragging=!1)})))}onPlay(){this.media.play()}onPause(){this.media.pause()}onTrack(t){const e=t.currentTarget.getBoundingClientRect(),n=(t.screenX-e.left)/e.width;this.media.progress=n}}Yc.meta={selector:"[media-player]"};const $c=100.99;class Xc extends Go{get title(){return this.title_}set title(t){if(this.title_!==t){const e=null!=this.title_;this.title_=t,e?this.updateBanner():this.createBanner()}}onChanges(){this.title=this.item.title}createBanner(){this.getCanvasTexture().then((t=>{const e=t.texture;e.wrapS=e.wrapY=THREE.RepeatWrapping,e.repeat.x=24,e.encoding=THREE.sRGBEncoding;const n=24*t.width/t.height,i=Math.PI/180*360,r=$c*i/n,s=new THREE.CylinderBufferGeometry($c,$c,r,80,2,!0,0,i);s.scale(-1,1,1);const o=new THREE.MeshBasicMaterial({map:e,transparent:!0,opacity:0,toneMapped:!1}),a=this.mesh;(this.banners=new Array(1).fill(0).map((t=>new THREE.Mesh(s,o)))).forEach(((t,e)=>{t.rotation.y=Math.PI/2*e}));const c={value:0};gsap.to(c,{duration:.5,value:1,delay:0,ease:Power2.easeInOut,onUpdate:()=>{o.opacity=c.value,o.needsUpdate=!0}}),a.userData={render:()=>{a.rotation.y+=Math.PI/180*.02,o.needsUpdate=!0}}}))}updateBanner(){this.getCanvasTexture().then((t=>{}))}onCreate(t,e){const n=new THREE.Group;"function"==typeof t&&t(n)}getCanvasTexture(){return new Promise(((t,e)=>{let n=512,i=128;const r=Math.floor(102.4),s=Math.floor(9.6);let o;o=this.canvas?this.canvas:this.canvas=document.createElement("canvas"),o.width=n,o.height=i;const a=this.item.title,c=o.getContext("2d");c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.font=`${r}px ${D.fontFamily}`;let l;n=c.measureText(a).width+8,n=Math.max(512,Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)))),o.width=n,c.clearRect(0,0,n,i),c.fillStyle="#0000005A",c.fillRect(0,0,n,i),c.font=`${r}px ${D.fontFamily}`,c.textAlign="center",c.textBaseline="middle",c.strokeStyle="rgba(0, 0, 0, 0.5)",c.lineWidth=s,c.lineJoin="round",c.miterLimit=2,c.strokeText(a,n/2,64),c.fillStyle="white",c.fillText(a,n/2,64,n),this.texture?(l=this.texture,l.needsUpdate=!0):l=this.texture=new THREE.CanvasTexture(o),t({texture:l,width:n,height:i})}))}}Xc.meta={selector:"[model-banner]",hosts:{host:jo},inputs:["item"]};class Jc extends Qo{onInit(){super.onInit()}onChanges(){const t=this.item.selected;this.editing=t,this.mesh&&(this.mesh.editing=t)}onCreate(t,e){const n=this.item,r=this.view;r.items;const s=this.getCurvedPanelGeometry(n);let o,a;this.onMeshDown=this.onMeshDown.bind(this),this.onMeshPlaying=this.onMeshPlaying.bind(this),this.onMeshZoomed=this.onMeshZoomed.bind(this),this.onMeshCurrentTime=this.onMeshCurrentTime.bind(this),Qr.getStreamId$(n).pipe(i.takeUntil(this.unsubscribe$)).subscribe((c=>{this.streamId!==c&&(this.streamId=c,a&&(a.unsubscribe(),a=null),c||!n.asset?(n.streamId=c,o=this.disposableMesh=new Qr(n,r,s,this.host),o.updateFromItem(n),o.name="curved-plane",o.load((()=>{this.disposableMesh=null,"function"==typeof t&&t(o,n),a=o.events$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((()=>{}))})),this.addMeshListeners(o)):this.mesh&&e(this.mesh,n))}))}addMeshListeners(t){t.on("down",this.onMeshDown),t.on("playing",this.onMeshPlaying),t.on("zoomed",this.onMeshZoomed),t.on("currentTime",this.onMeshCurrentTime)}removeMeshListeners(t){t.off("down",this.onMeshDown),t.off("playing",this.onMeshPlaying),t.off("zoomed",this.onMeshZoomed),t.off("currentTime",this.onMeshCurrentTime)}onMeshDown(){this.down.next(this)}onMeshPlaying(t){this.play.next({itemId:this.item.id,playing:t})}onMeshZoomed(t){this.zoom.next({itemId:this.item.id,zoomed:t})}onMeshCurrentTime(t){this.currentTime.next({itemId:this.item.id,currentTime:t})}onDestroy(){super.onDestroy(),this.disposableMesh&&(this.removeMeshListeners(this.disposableMesh),this.disposableMesh.dispose()),this.mesh&&(this.removeMeshListeners(this.mesh),this.mesh.dispose())}onUpdate(t,e){if(t.radius!==this.radius_||t.height!==this.height_||t.arc!==this.arc_){e.geometry.dispose();const n=this.getCurvedPanelGeometry(t);e.geometry=n}e.updateFromItem(t),this.updateHelper()}onUpdateAsset(t,e){e.updateByItem(t),Qr.getStreamId$(t).pipe(i.filter((t=>null!==t)),i.take(1)).subscribe((n=>{t.streamId=n,e.load((()=>{}))}))}onDragMove(t,e,n){const i=this.item,r=this.mesh;i.showPanel=!1,this.editing=!0,r.position.set(t.x,t.y,t.z),n?(t.normalize().multiplyScalar(20),r.lookAt(Sr.origin)):(r.position.set(0,0,0),r.lookAt(e),r.position.set(t.x,t.y,t.z),r.position.add(e.multiplyScalar(.01))),this.updateHelper()}onDragEnd(){const t=this.item,e=this.mesh;t.position=e.position.toArray(),t.rotation=e.rotation.toArray(),t.scale=e.scale.toArray(),e.updateFromItem(t),this.editing=!1}getCurvedPanelGeometry(t){this.radius_=t.radius,this.height_=t.height,this.arc_=t.arc;const e=Math.PI/180*t.arc,n=new THREE.CylinderBufferGeometry(t.radius,t.radius,t.height,36,2,!0,0,e);return n.rotateY(-Math.PI-e/2),n.scale(-1,1,1),n}}Jc.textures={},Jc.meta={selector:"[model-curved-plane]",hosts:{host:jo},outputs:["down","play","zoom","currentTime"],inputs:["item","view"]};class Zc{static getService(){return this.service_||(this.service_=new Zc),this.service_}get message(){return this.message$.getValue()}constructor(){if(Zc.service_)throw"DebugService is a singleton class!";this.message$=new n.BehaviorSubject(null)}setMessage(t){this.message!==t&&this.message$.next(t)}}class tl extends Go{static getLoader(){return tl.loader||(tl.loader=new THREE.FontLoader)}static getFontLoader(t){return tl.fontLoader||(tl.fontLoader=tl.getLoader().load(D.getPath("fonts/helvetiker/helvetiker_regular.typeface.json"),t))}get message(){return this.message_}set message(t){t=t&&""!==t?t:null,this.message_!==t&&(this.message_=t,this.setText(t))}onInit(){super.onInit();(this.vrService=Ts.getService()).session$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{t?this.text&&this.textGroup.add(this.text):this.text&&this.text.parent.remove(this.text)}));(this.debugService=Zc.getService()).message$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.message=t))}createText(){const t=document.createElement("canvas");t.width=tl.W,t.height=tl.H;const e=new THREE.CanvasTexture(t);e.encoding=THREE.sRGBEncoding,e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.needsUpdate=!0;const n=new THREE.PlaneBufferGeometry(4,1,2,2),i=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,map:e,color:16777215,transparent:!0,opacity:1,toneMapped:!1}),r=new THREE.Mesh(n,i);return r.renderOrder=D.renderOrder.debug,r.position.y=0,r}loadFont(){this.fontLoader=tl.getFontLoader((t=>{this.font=t,this.message_&&this.setText(this.message_)}))}onCreate(t,e){const n=this.textGroup=new THREE.Group;this.material=new THREE.MeshBasicMaterial({depthTest:!1,color:16777215,transparent:!0,opacity:1,side:THREE.DoubleSide}),this.text=this.createText(),"function"==typeof t&&t(n)}render(t,e){const n=this.group;let i=this.host.camera;const r=this.position;this.host.renderer.xr.isPresenting&&(i=this.host.renderer.xr.getCamera(i)),i.getWorldDirection(r),r.multiplyScalar(3),n.position.copy(r),n.lookAt(Sr.origin)}setText(t){const e=this.text;if(e)if(this.host.renderer.xr.isPresenting&&null!=t){const n=e.material.map.image.getContext("2d");n.clearRect(0,0,tl.W,tl.H),n.font=`30px ${D.fontFamily}`,n.textBaseline="middle",n.textAlign="center",n.fillStyle="#FFFFFF",n.strokeStyle="#000000",n.lineWidth=5,n.fillText(t,tl.W/2,tl.H/2,tl.W-20),e.material.map.needsUpdate=!0,this.textGroup.add(e)}else e.parent&&e.parent.remove(e)}}tl.W=1024,tl.H=256,tl.meta={selector:"[model-debug]",hosts:{host:jo}};class el extends Go{static getLoader(){return el.loader||(el.loader=new THREE.TextureLoader)}static getTexture(){return el.texture||(el.texture=el.getLoader().load(D.getPath("textures/ui/floor-nav.png")))}static getOverTexture(){return el.textureOver||(el.textureOver=el.getLoader().load(D.getPath("textures/ui/floor-nav-over.png")))}set coords(t){if(!t&&this.coords_!==t||!this.coords_||t.x!==this.coords_.x||t.y!==this.coords_.y){const e=this.tileMap;if(this.coords_){const t=e[`${this.coords_.x}_${this.coords_.y}`],n=t.uniforms;gsap.to(n,{tween:0,duration:.4,delay:0,ease:Power2.easeInOut,onUpdate:()=>{t.material.uniforms.tween.value=n.tween,t.material.needsUpdate=!0}})}if(t){const n=this.currentTile=e[`${t.x}_${t.y}`],i=n.uniforms;gsap.to(i,{tween:1,duration:.4,delay:0,ease:Power2.easeInOut,onUpdate:()=>{n.material.uniforms.tween.value=i.tween,n.material.needsUpdate=!0}})}this.coords_=t}}set coords__(t){if(!t&&this.coords_!==t||!this.coords_||t.x!==this.coords_.x||t.y!==this.coords_.y){const e=this.tileMap;if(this.coords_){const t=e[`${this.coords_.x}_${this.coords_.y}`],n={tween:1};gsap.to(n,{duration:.4,tween:0,delay:0,ease:Power2.easeInOut,onUpdate:()=>{t.material.opacity=n.tween}})}if(t){const n=this.currentTile=e[`${t.x}_${t.y}`],i={tween:0};gsap.to(i,{duration:.4,tween:1,delay:0,ease:Power2.easeInOut,onUpdate:()=>{n.material.opacity=i.tween}})}this.coords_=t}}getCoords(t){const e=el.RADIUS/10,n=Math.ceil((t.x+e/2)/e)-1,i=Math.ceil((t.z+e/2)/e)-1,r=Math.floor(el.COLS/2),s=Math.floor(el.ROWS/2),o=Math.min(r,Math.abs(n))*(n?Math.abs(n)/n:1),a=Math.min(s,Math.abs(i))*(i?Math.abs(i)/i:1);if(this.view.hasTile(this.indices.x+o,this.indices.y+a))return new THREE.Vector2(o,a)}onInit(){super.onInit(),this.indices=new THREE.Vector2,this.view.index$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.moveToIndex(t)}))}addTiles(t){const e=el.RADIUS/10,n=.9*e,i=new THREE.PlaneBufferGeometry(n,n,2,2);i.rotateX(-Math.PI/2);const r=el.getTexture();r.disposable=!1,r.encoding=THREE.sRGBEncoding;const s=el.getOverTexture();s.disposable=!1,s.encoding=THREE.sRGBEncoding;const o=this.tileMap={};this.tiles=new Array(el.COLS*el.ROWS).fill(0).map(((n,a)=>{const c=new THREE.ShaderMaterial({depthTest:!1,depthWrite:!1,transparent:!0,toneMapped:!1,vertexShader:"\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\nvarying vec2 vUv;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform float opacity;\nuniform float tween;\n\nvoid main() {\n\tvec4 colorA = texture2D(textureA, vUv);\n\tvec4 colorB = texture2D(textureB, vUv);\n\tvec4 color = mix(colorA, colorB, tween);\n\tcolor.a = clamp(color.a * opacity, 0.0, 1.0);\n\tcolor.rgb /= color.a;\n\tgl_FragColor = color;\n}\n",uniforms:{textureA:{type:"t",value:r},textureB:{type:"t",value:s},tween:{value:0},opacity:{value:0}},extensions:{fragDepth:!0}}),l=new THREE.Mesh(i,c),u=Math.floor(el.COLS/2),d=Math.floor(el.ROWS/2),h=Math.floor(a/el.COLS),A=-u+a%el.COLS,p=-d+h;return l.position.set(A*e,.15*-el.RADIUS,p*e),l.name=this.getName(`tile_${A}_${p}`),l.uniforms={tween:0,opacity:0,ci:A,ri:p},o[`${A}_${p}`]=l,t.add(l),l})),this.showTiles()}showTiles(){this.tiles.forEach(((t,e)=>{const n=this.indices?this.indices.x:0,i=this.indices?this.indices.y:0,r=this.view.hasTile(n+t.uniforms.ci,i+t.uniforms.ri),s=t.uniforms;gsap.to(s,{opacity:r?1:0,duration:.4,ease:Power2.easeInOut,onUpdate:()=>{t.material.uniforms.opacity.value=s.opacity,t.material.needsUpdate=!0}})}))}addHitArea(t){this.onGroundOver=this.onGroundOver.bind(this),this.onGroundMove=this.onGroundMove.bind(this),this.onGroundDown=this.onGroundDown.bind(this),this.onGroundOut=this.onGroundOut.bind(this),el.RADIUS;const e=new THREE.PlaneBufferGeometry(el.RADIUS,el.RADIUS,8,8);e.rotateX(-Math.PI/2);const n=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,toneMapped:!1,opacity:0}),i=this.ground=new Ir(e,n);i.name=this.getName("ground"),i.position.set(0,.15*-el.RADIUS,0),i.on("over",this.onGroundOver),i.on("move",this.onGroundMove),i.on("out",this.onGroundOut),i.on("down",this.onGroundDown),t.add(i)}onGroundOver(){const t=this.ground,e=this.getCoords(t.intersection.point);this.coords=e}onGroundMove(){const t=this.ground,e=this.getCoords(t.intersection.point);this.coords=e}onGroundDown(){const t=this.ground,e=this.getCoords(t.intersection.point);if(this.coords=e,e){const t=this.view.getTileIndex(this.indices.x+e.x,this.indices.y+e.y);this.view.index=t,this.nav.next(t)}}onGroundOut(){this.coords=null}moveToIndex(t){this.coords=null;const e=this.view.tiles[t],n=new THREE.Vector2(e.indices.x-this.indices.x,e.indices.y-this.indices.y);this.indices.x=e.indices.x,this.indices.y=e.indices.y,this.showTiles();const i=el.RADIUS/10;this.move.next({indices:this.indices,coords:n,position:n.clone().multiplyScalar(i)})}onCreate(t,e){const n=new THREE.Group;this.addTiles(n),this.addHitArea(n),"function"==typeof t&&t(n)}onDestroy(){super.onDestroy();const t=this.ground;t.off("over",this.onGroundOver),t.off("move",this.onGroundMove),t.off("down",this.onGroundDown),t.off("out",this.onGroundOut)}}el.RADIUS=101,el.COLS=11,el.ROWS=11,el.meta={selector:"[model-grid]",hosts:{host:jo},outputs:["move","nav"],inputs:["view"]};class nl extends Ir{static getGrid(t){const e=Math.ceil(t/nl.ROWS);return[Math.ceil(t/e),e]}static getX(t,e){const n=Math.ceil(e/nl.ROWS),i=t%n,r=1/nl.W*(nl.W+nl.G);return r/2-n*r/2+i*r}static getY(t,e){const n=Math.ceil(e/nl.ROWS),i=Math.ceil(e/n),r=Math.floor(t/n),s=1/nl.W*(nl.H+nl.G);return i*s/2-s/2+r*-s}static get geometry(){if(this.geometry_)return this.geometry_;const t=new THREE.PlaneBufferGeometry(1,1/nl.W*nl.H,2,2);return this.geometry_=t,t}static get material(){return new THREE.ShaderMaterial({depthTest:!1,transparent:!0,toneMapped:!1,vertexShader:rl.VERTEX_SHADER,fragmentShader:rl.FRAGMENT_SHADER,uniforms:{textureA:{type:"t",value:null},textureB:{type:"t",value:null},resolutionA:{value:new THREE.Vector2},resolutionB:{value:new THREE.Vector2},tween:{value:0},opacity:{value:0}},extensions:{fragDepth:!0}})}constructor(t,e,n){const i=nl.geometry,r=nl.material;super(i,r),this.renderOrder=D.renderOrder.menu,this.name=t.name,this.item=t,this.index=e,this.total=n,this.tween=0,this.opacity=0;const s=this.textureA=this.getTextureA(t.name);r.uniforms.textureA.value=s,r.uniforms.resolutionA.value=new THREE.Vector2(s.width,s.height);const o=this.textureB=this.getTextureB(t.name);r.uniforms.textureB.value=o,r.uniforms.resolutionA.value=new THREE.Vector2(o.width,o.height),r.uniforms.tween.value=this.tween,r.uniforms.opacity.value=this.opacity,r.needsUpdate=!0,this.position.set(nl.getX(e,n),nl.getY(e,n),0),this.onOver=this.onOver.bind(this),this.onOut=this.onOut.bind(this)}getTextureA(t){const e=nl.W,n=nl.H,i=document.createElement("canvas");i.width=e,i.height=n;const r=i.getContext("2d");r.fillStyle=D.colors.menuBackground,r.fillRect(0,0,e,n),r.fillStyle=D.colors.menuForeground,this.writeText(r,t,e,n);const s=new THREE.CanvasTexture(i);return s.minFilter=THREE.LinearFilter,s.magFilter=THREE.LinearFilter,s.mapping=THREE.UVMapping,s.needsUpdate=!0,s}getTextureB(t){const e=nl.W,n=nl.H,i=document.createElement("canvas");i.width=e,i.height=n;const r=i.getContext("2d");r.fillStyle=D.colors.menuOverBackground,r.fillRect(0,0,e,n),r.fillStyle=D.colors.menuOverForeground,this.writeText(r,t,e,n);const s=new THREE.CanvasTexture(i);return s.magFilter=THREE.LinearFilter,s.needsUpdate=!0,s}writeText(t,e,n,i){this.setFont(t);const r=nl.FONT_SIZE*nl.LINE_HEIGHT,s=this.getLines(t,e,n),o=s.length;this.setFont(t,o-1),s.forEach(((e,s)=>{t.fillText(e,10,.5*(i-o*r)+(.5+s)*r,n-20)}))}setFont(t,e){void 0===e&&(e=0),t.textBaseline="middle",t.font=`${nl.FONT_SIZE-2*e}px ${D.fontFamily}`}getLines(t,e,n){const i=e.split(" "),r=[];let s=i[0];for(let e=1;e<i.length;e++){const o=i[e];t.measureText(s+" "+o).width<n?s+=" "+o:(r.push(s),s=o)}return r.push(s),r}onOver(){gsap.to(this,{duration:.4,tween:1,ease:Power2.easeOut,onUpdate:()=>{this.position.z=.1*this.tween,this.material.uniforms.tween.value=this.tween,this.material.needsUpdate=!0}})}onOut(){gsap.to(this,{duration:.4,tween:0,ease:Power2.easeOut,onUpdate:()=>{this.position.z=.1*this.tween,this.material.uniforms.tween.value=this.tween,this.material.needsUpdate=!0}})}dispose(){Tr.dispose(this),this.textureA.dispose(),this.textureB.dispose(),this.material.dispose(),this.geometry.dispose()}}nl.FONT_SIZE=19,nl.LINE_HEIGHT=.9,nl.W=256,nl.H=64,nl.G=2,nl.ROWS=6;class il extends nl{constructor(t,e,n){super(t,e,n)}getTextureA(t){const e=nl.W,n=nl.H,i=document.createElement("canvas");i.width=e,i.height=n;const r=i.getContext("2d");r.fillStyle=D.colors.menuBackBackground,r.fillRect(0,0,e,n),r.fillStyle=D.colors.menuBackForeground,r.font=`${nl.FONT_SIZE}px ${D.fontFamily}`,r.fillText(t,10,50,e-20);const s=new THREE.CanvasTexture(i);return s.minFilter=THREE.LinearFilter,s.magFilter=THREE.LinearFilter,s.mapping=THREE.UVMapping,s.needsUpdate=!0,s}getTextureB(t){const e=nl.W,n=nl.H,i=document.createElement("canvas");i.width=e,i.height=n;const r=i.getContext("2d");r.fillStyle=D.colors.menuBackOverBackground,r.fillRect(0,0,e,n),r.fillStyle=D.colors.menuBackOverForeground,r.font=`${nl.FONT_SIZE}px ${D.fontFamily}`,r.fillText(t,10,50,e-20);const s=new THREE.CanvasTexture(i);return s.magFilter=THREE.LinearFilter,s.needsUpdate=!0,s}}class rl extends Go{get controlled(){return ee.state.controlling&&ee.state.controlling!==ee.state.uid}get controlling(){return ee.state.controlling&&ee.state.controlling===ee.state.uid}get silencing(){return ee.state.silencing}get silenced(){return ee.state.silencing&&ee.state.role===ne.Streamer}get spyed(){return ee.state.spying&&ee.state.spying===ee.state.uid}get spying(){return ee.state.spying&&ee.state.spying!==ee.state.uid}get locked(){return this.controlled||this.spying}get loading(){return this.loading_}set loading(e){if(this.loading_!==e){this.loading_=e;const{node:n}=t.getContext(this);n.querySelector(".btn--menu").classList.toggle("loading",e)}}onInit(){super.onInit(),this.onDown=this.onDown.bind(this),this.onToggle=this.onToggle.bind(this);const{node:e}=t.getContext(this);this.progressIndicator=e.querySelector(".progress circle"),Mr.progress$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{this.loading=t.count>0;let e=144.51;t.count&&(e=144.51*(1-t.value)),gsap.set(this.progressIndicator,{strokeDashoffset:e})})),Mn.in$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{if(t.type===Ue)this.onToggle()}))}onDestroy(){this.buttons&&this.buttons.forEach((t=>Tr.dispose(t))),super.onDestroy()}getContainer(){return this.host.cameraGroup}onCreate(t,e){const n=this.menuGroup=new THREE.Group;"function"==typeof t&&t(n)}render(t,e){const n=this.group;this.host.cameraGroup;let i=this.host.camera;const r=this.position;if(this.host.renderer.xr.isPresenting)i=this.host.renderer.xr.getCamera(i),i.getWorldDirection(r),r.y+=.5,r.multiplyScalar(3),this.host.cameraGroup.worldToLocal(r),r.y+=this.host.cameraGroup.position.y,n.position.copy(r),n.scale.set(1,1,1),n.lookAt(Sr.origin);else{i.getWorldDirection(r),ss.mode===Zr?r.multiplyScalar(.01):r.multiplyScalar(3),n.position.copy(r);const t=1/i.zoom;n.scale.set(t,t,t),n.lookAt(Sr.origin)}}items$(t){return void 0===t&&(t=null),t?n.of(t.items):this.rootItems?n.of(this.rootItems):Na.getModelMenu$(this.views,this.host.editor).pipe(i.first(),i.tap((t=>{this.host.editor||(this.rootItems=t)})))}addMenu(t){void 0===t&&(t=null),this.removeMenu(),t&&"menu-group"!==t.type.name?this.nav.next(t):(Na.active=!0,this.items$(t).pipe(i.first()).subscribe((e=>{if(e){e=e.slice();const n={type:{name:"back"},name:t?"Back":"Close",backItem:t};e.push(n);const i=this.buttons=e.map(((e,n,i)=>(e.backItem=t,"back"===e.type.name?new il(e,n,i.length):new nl(e,n,i.length))));i.forEach((t=>{t.depthTest=!1,t.on("over",t.onOver),t.on("out",t.onOut),t.on("down",this.onDown),this.menuGroup.add(t)})),gsap.to(i,{duration:.3,opacity:.8,ease:Power2.easeOut,stagger:{grid:nl.getGrid(i.length),from:0,amount:.02*i.length},onUpdate:()=>{i.forEach((t=>{t.material.uniforms.opacity.value=t.opacity*(t.item.hidden?.5:1)}))}})}})))}removeMenu(){Na.active=!1,this.removeButtons(),this.removeToggler()}removeButtons(){const t=this.buttons;t&&t.forEach((t=>{this.menuGroup.remove(t),t.off("over",t.onOver),t.off("out",t.onOut),t.off("down",this.onDown),t.dispose()})),this.buttons=null}addToggler(){this.removeMenu();const t=this.toggler=new nl({type:{name:"menu"},name:"Menu"},0,1);t.opacity=.8,t.material.uniforms.opacity.value=t.opacity,t.material.needsUpdate=!0,t.on("over",t.onOver),t.on("out",t.onOut),t.on("down",this.onToggle),this.menuGroup.add(t)}removeToggler(){const t=this.toggler;t&&(this.menuGroup.remove(t),t.off("over",t.onOver),t.off("out",t.onOut),t.off("down",this.onToggle),t.dispose()),this.toggler=null}onDown(t){t.item&&"back"===t.item.type.name?(this.removeMenu(),t.item.backItem?this.addMenu(t.item.backItem.backItem):this.toggle.next()):this.addMenu(t.item)}onToggle(t){t&&(t.preventDefault(),t.stopImmediatePropagation()),this.locked||(Na.active?(this.removeMenu(),this.toggle.next()):(this.addMenu(),this.toggle.next(this)))}}rl.VERTEX_SHADER="\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",rl.FRAGMENT_SHADER="\nvarying vec2 vUv;\nuniform float opacity;\nuniform float tween;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform vec2 resolutionA;\nuniform vec2 resolutionB;\n\nvoid main() {\n\tvec4 colorA = texture2D(textureA, vUv);\n\tvec4 colorB = texture2D(textureB, vUv);\n\tvec4 color = vec4(mix(colorA.rgb, colorB.rgb, tween), opacity);\n\tgl_FragColor = color;\n}\n",rl.meta={selector:"[model-menu]",hosts:{host:jo},outputs:["nav","toggle"],inputs:["views"],template:'\n\t<div class="btn--menu" (mousedown)="onToggle($event)">\n\t\t<svg class="menu-light" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#menu-light"></use></svg>\n\t\t<div class="btn--menu__spinner"></div>\n\t\t<svg class="bullets" width="24" height="24" viewBox="0 0 24 24"><use xlink:href="#menu"></use></svg>\n\t\t<svg class="progress" width="50" height="50" viewBox="0 0 50 50">\n\t\t\t<circle id="circle" r="23" cx="25" cy="25" fill="transparent"></circle>\n\t\t</svg>\n\t</div>\n\t'};const sl=new WeakMap;class ol extends r.Loader{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,n,i){const s=new r.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(t=>{const n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(t,n).then(e).catch(i)}),n,i)}decodeDracoFile(t,e,n,i){const r={attributeIDs:n||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!n};this.decodeGeometry(t,r).then(e)}decodeGeometry(t,e){for(const t in e.attributeTypes){const n=e.attributeTypes[t];void 0!==n.BYTES_PER_ELEMENT&&(e.attributeTypes[t]=n.name)}const n=JSON.stringify(e);if(sl.has(t)){const e=sl.get(t);if(e.key===n)return e.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let i;const r=this.workerNextTaskID++,s=t.byteLength,o=this._getWorker(r,s).then((n=>(i=n,new Promise(((n,s)=>{i._callbacks[r]={resolve:n,reject:s},i.postMessage({type:"decode",id:r,taskConfig:e,buffer:t},[t])}))))).then((t=>this._createGeometry(t.geometry)));return o.catch((()=>!0)).then((()=>{i&&r&&this._releaseTask(i,r)})),sl.set(t,{key:n,promise:o}),o}_createGeometry(t){const e=new r.BufferGeometry;t.index&&e.setIndex(new r.BufferAttribute(t.index.array,1));for(let n=0;n<t.attributes.length;n++){const i=t.attributes[n],s=i.name,o=i.array,a=i.itemSize;e.setAttribute(s,new r.BufferAttribute(o,a))}return e}_loadLibrary(t,e){const n=new r.FileLoader(this.manager);return n.setPath(this.decoderPath),n.setResponseType(e),n.setWithCredentials(this.withCredentials),new Promise(((e,i)=>{n.load(t,e,void 0,i)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then((e=>{const n=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const i=al.toString(),r=["/* draco decoder */",n,"","/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([r]))})),this.decoderPending}_getWorker(t,e){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(e){const n=e.data;switch(n.type){case"decode":t._callbacks[n.id].resolve(n);break;case"error":t._callbacks[n.id].reject(n);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+n.type+'"')}},this.workerPool.push(t)}else this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));const n=this.workerPool[this.workerPool.length-1];return n._taskCosts[t]=e,n._taskLoad+=e,n}))}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map((t=>t._taskLoad)))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,this}}function al(){let t,e;function n(t,e,n,i,r,s){const o=s.num_components(),a=n.num_points()*o,c=a*r.BYTES_PER_ELEMENT,l=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,r),u=t._malloc(c);e.GetAttributeDataArrayForAllPoints(n,s,l,c,u);const d=new r(t.HEAPF32.buffer,u,a).slice();return t._free(u),{name:i,array:d,itemSize:o}}onmessage=function(i){const r=i.data;switch(r.type){case"init":t=r.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":const i=r.buffer,s=r.taskConfig;e.then((t=>{const e=t.draco,o=new e.Decoder,a=new e.DecoderBuffer;a.Init(new Int8Array(i),i.byteLength);try{const t=function(t,e,i,r){const s=r.attributeIDs,o=r.attributeTypes;let a,c;const l=e.GetEncodedGeometryType(i);if(l===t.TRIANGULAR_MESH)a=new t.Mesh,c=e.DecodeBufferToMesh(i,a);else{if(l!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new t.PointCloud,c=e.DecodeBufferToPointCloud(i,a)}if(!c.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+c.error_msg());const u={index:null,attributes:[]};for(const i in s){const c=self[o[i]];let l,d;if(r.useUniqueIDs)d=s[i],l=e.GetAttributeByUniqueId(a,d);else{if(d=e.GetAttributeId(a,t[s[i]]),-1===d)continue;l=e.GetAttribute(a,d)}u.attributes.push(n(t,e,a,i,c,l))}l===t.TRIANGULAR_MESH&&(u.index=function(t,e,n){const i=3*n.num_faces(),r=4*i,s=t._malloc(r);e.GetTrianglesUInt32Array(n,r,s);const o=new Uint32Array(t.HEAPF32.buffer,s,i).slice();return t._free(s),{array:o,itemSize:1}}(t,e,a));return t.destroy(a),u}(e,o,a,s),i=t.attributes.map((t=>t.array.buffer));t.index&&i.push(t.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:t},i)}catch(t){console.error(t),self.postMessage({type:"error",id:r.id,error:t.message})}finally{e.destroy(a),e.destroy(o)}}))}}}class cl extends Qo{get freezed(){return this.freezed_}set freezed(t){if(this.freezed_!==t){this.freezed_=t;const e=this.mesh;e&&e.traverse((e=>{e.isInteractiveMesh&&(e.freezed=t)}))}}onInit(){super.onInit(),this.isPresenting=!1,Na.active$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.freezed=t))}onChanges(){this.editing=this.item.selected}onCreate(t,e){this.loadGlb(D.getPath(this.item.asset.folder),this.item.asset.file,((n,i)=>{this.onGlbLoaded(n,i,t,e)}))}loadGlb(t,e,n){this.host.renderer;const i=Mr.getRef(),r=(new xs).setPath(t),s=`${D.dist}js/draco/`,o=new ol;o.setDecoderPath(s),r.setDRACOLoader(o),r.load(e,(t=>{"function"==typeof n&&n(t.scene,t.animations),Mr.setProgress(i,1)}),(t=>{Mr.setProgress(i,t.loaded,t.total)}))}onGlbLoaded(t,e,n,i){this.parseAnimations(t,e);const r=(new THREE.Box3).setFromObject(t),s=r.max.clone().sub(r.min),o=1.7/Math.max(s.x,s.y,s.z);let a;t.scale.set(o,o,o);const c=this.view,l=this.item;if(c.type.name===mi.Model.name){a=new THREE.Group,a.add(t),r.setFromObject(a);const e=r.getCenter(new THREE.Vector3);a.position.set(t.position.x-e.x,t.position.y-e.y,t.position.z-e.z+(this.host.renderer.xr.isPresenting?-2:0));const n=a.position.y,i={tween:1},s=()=>{a.position.y=n+3*i.tween,a.rotation.y=0+Math.PI*i.tween};s(),this.makeInteractive(t),gsap.to(i,{duration:1.5,tween:0,delay:.1,ease:Power2.easeInOut,onUpdate:s,onComplete:()=>{this.updateHelper()}})}else{r.setFromObject(t);const e=r.getCenter(new THREE.Vector3);t.position.set(-e.x,-e.y,-e.z),a=new THREE.Group,a.add(t),l.position&&a.position.fromArray(l.position),l.rotation&&a.rotation.fromArray(l.rotation),l.scale&&a.scale.fromArray(l.scale),this.makeInteractive(t),this.updateHelper()}"function"==typeof n&&(n(a,this.item),this.freezed=Na.active)}parseAnimations(t,e){this.actionIndex=-1;const n=this.actions=[];if(e&&e.length){this.clock=new THREE.Clock;const i=this.mixer=new THREE.AnimationMixer(t);i.timeScale=1,e.forEach((t=>{const e=i.clipAction(t);e.enabled=!0,e.setEffectiveTimeScale(1),e.setEffectiveWeight(1),e.setLoop(THREE.LoopRepeat),n.push(e)}))}}onClipToggle(){let t;const e=this.actions;1===e.length?(t=-1===this.actionIndex?0:-1,this.setSingleAction(t)):e.length>1&&(t=this.actionIndex+1,t===e.length&&(t=-1),this.setMultiAction(t)),this.play.next({itemId:this.item.id,actionIndex:t})}setSingleAction(t){if(this.actionIndex!==t){this.actionIndex=t;const e=this.actions[0];0===t?e.paused||0===e.timeScale?e.paused=!1:e.play():-1===t&&e.halt(.3)}}setMultiAction(t){if(this.actionIndex!==t){const e=this.actions,n=this.actionIndex>-1?e[this.actionIndex]:null;if(this.actionIndex=t,n&&n.halt(.3),t>-1){const n=e[t];n.paused&&(n.paused=!1),0===n.timeScale&&(n.timeScale=1),n.play()}}}onMessage(t){switch(t.type){case We:{const e=this.actions;1===e.length?this.setSingleAction(t.actionIndex):e.length>1&&this.setMultiAction(t.actionIndex);break}}}render(t,e){const n=this.view;this.item;const i=this.mesh,r=this.host.renderer.xr.isPresenting;this.group,i&&(n.type.name===mi.Model.name?(this.isPresenting!==r&&(this.isPresenting=r,r?(i.position.x=0,i.position.y=0,i.position.z=-2,i.rotation.y=0):(i.position.x=0,i.position.y=0,i.position.z=0,i.rotation.y=0)),r&&(i.rotation.y-=Math.PI/180/60*5)):r&&(i.rotation.y-=Math.PI/180/60*5));const s=this.mixer,o=this.clock;if(s){const t=o.getDelta();s.update(t)}}onUpdate(t,e){this.view.type.name!==mi.Model.name&&(t.position&&e.position.fromArray(t.position),t.rotation&&e.rotation.fromArray(t.rotation),t.scale&&e.scale.fromArray(t.scale)),this.updateHelper()}onUpdateAsset(t,e){this.loadGlb(D.getPath(t.asset.folder),t.asset.file,((t,e)=>{this.onGlbLoaded(t,e,((t,e)=>this.onMount(t,e)),((t,e)=>this.onDismount(t,e)))}))}onDragMove(t,e,n){n&&t.normalize().multiplyScalar(4),this.editing=!0;this.view.type.name!==mi.Model.name&&this.mesh.position.set(t.x,t.y,t.z),this.updateHelper()}onDragEnd(){this.view.type.name!==mi.Model.name&&(this.item.position=this.mesh.position.toArray(),this.item.rotation=this.mesh.rotation.toArray(),this.item.scale=this.mesh.scale.toArray()),this.editing=!1}static getInteractiveDescriptors(){let t=cl.interactiveDescriptors;if(!t){const e=Object.getOwnPropertyDescriptors(Cr.prototype),n=Object.getOwnPropertyDescriptors(Rr.prototype),i=Object.getOwnPropertyDescriptors(Ir.prototype);t=Object.assign({},e,n,i),cl.interactiveDescriptors=t}return t}makeInteractive(t){const e=cl.getInteractiveDescriptors();t.traverse((t=>{t.isMesh&&(Object.keys(e).forEach((n=>{"constructor"!==n&&Object.defineProperty(t,n,e[n])})),t.freezed=!1,t.events={},t.depthTest=!0,t.over_=!1,t.down_=!1,Tr.items.push(t),t.on("down",(()=>{this.onClipToggle(),this.down.next(this)})))}))}}cl.meta={selector:"[model-model]",hosts:{host:jo},outputs:["down","play"],inputs:["item","view"]};class ll extends THREE.Sprite{get freezed(){return this.freezed_}set freezed(t){this.freezed_=t,this.children.filter((t=>t.__lookupGetter__("freezed"))).forEach((e=>e.freezed=t))}constructor(t){super(t=t||new THREE.SpriteMaterial({color:16711935})),this.freezed=!1}freeze(){this.freezed=!0}unfreeze(){this.freezed=!1}}class ul extends ll{constructor(t){super(t=t||new THREE.SpriteMaterial({color:16711935})),this.events={}}on(t,e){const n=this.events[t]=this.events[t]||[];return n.push(e),()=>{this.events[t]=n.filter((t=>t!==e))}}off(t,e){const n=this.events[t];n&&(this.events[t]=n.filter((t=>t!==e)))}emit(t,e){const n=this.events[t];n&&n.forEach((t=>{t(e)}));const i=this.events.broadcast;i&&i.forEach((n=>{n(t,e)}))}}class dl extends ul{constructor(t){super(t),this.depthTest=!0,this.over_=!1,this.down_=!1,Tr.items.push(this)}get isInteractiveSprite(){return!0}get over(){return this.over_}set over(t){this.over_!=t&&(this.over_=t,t?this.emit("over",this):this.emit("out",this))}get down(){return this.down_}set down(t){t=t&&this.over,this.down_!=t&&(this.down_=t,t?this.emit("down",this):this.emit("up",this))}}class hl extends Go{constructor(){super(...arguments),this.isMobile_=void 0}get isMobile(){return this.isMobile_}set isMobile(t){this.isMobile_!==t&&(this.isMobile_=t,this.setScale())}render(t,e){this.isMobile=this.host.worldRect.width<768}setScale(t){void 0===t&&(t=0);const e=this.textureWidth,n=this.textureHeight,i=this.item,r=this.panel;if(r){const s=.2*(i.asset?1.5:1)*(this.isMobile?1.6:1),o=e/n,a=hl.PANEL_RADIUS*s,c=hl.PANEL_RADIUS*s/o,l=.25*a,u=i.mesh.position.normalize().multiplyScalar(hl.PANEL_RADIUS);r.position.set(u.x,u.y+(c+2*l)-l*(1-t),u.z),r.scale.set(.02*a,.02*c,1)}}onInit(){super.onInit(),this.textureWidth=0,this.textureHeight=0}onView(){if(this.viewed)return;this.viewed=!0;const{node:e}=t.getContext(this);this.getCanvasTexture(e).then((t=>{if(this.textureWidth=t.width,this.textureHeight=t.height,this.mesh&&this.item){const n=new THREE.SpriteMaterial({depthTest:!1,transparent:!0,opacity:0,map:t.map,sizeAttenuation:!1,toneMapped:!1}),i=this.item,r=this.panel=new dl(n);r.renderOrder=D.renderOrder.panel,this.setScale(1),r.on("down",(t=>{const n={x:parseInt(t.intersection.uv.x*e.offsetWidth),y:parseInt((1-t.intersection.uv.y)*e.offsetHeight)},r=Array.prototype.slice.call(e.querySelectorAll(".panel__link")),s=r.find((t=>n.x>=t.offsetLeft&&n.y>=t.offsetTop&&n.x<=t.offsetLeft+t.offsetWidth&&n.y<=t.offsetTop+t.offsetHeight));if(s){const t=r.indexOf(s),o=i.links[t];this.down.next({item:i,link:o,linkIndex:t});const a=e.getBoundingClientRect(),c={button:0,buttons:0,clientX:n.x+a.left,clientY:n.y+a.top,movementX:0,movementY:0,relatedTarget:s,screenX:n.x,screenY:n.y},l=new MouseEvent("mouseup",c);s.dispatchEvent(l),setTimeout((()=>{Xr.dismissEvent(l,Xr.events$,Xr.dismiss$,Xr.downEvent)}),1)}})),this.mesh.add(r);const s={value:0};gsap.to(s,{duration:.5,value:1,delay:0,ease:Power2.easeInOut,onUpdate:()=>{this.setScale(1-s.value),r.lookAt(Sr.origin),r.material.opacity=s.value,r.material.needsUpdate=!0}})}}),(t=>{console.log("ModelPanelComponent.getCanvasTexture.error",t)}))}onCreate(t,e){const n=new THREE.Group;"function"==typeof t&&t(n)}onDestroy(){super.onDestroy()}imagesLoaded(){const{node:e}=t.getContext(this);if(e){const t=Array.prototype.slice.call(e.querySelectorAll("img")).map((t=>new Promise((function(e,n){const i=t.src&&-1===t.src.indexOf(location.origin);if(t.complete)return setTimeout((()=>{e(i)}),10);function r(){o(),setTimeout((()=>{e(i)}),10)}function s(){o(),e(!1)}function o(){t.removeEventListener("load",r),t.removeEventListener("error",s)}t.addEventListener("load",r),t.addEventListener("error",s)}))));return t.length?Promise.all(t):Promise.resolve()}}getCanvasTexture(e){return new Promise(((n,i)=>{setTimeout((()=>{this.item.panelTexture?n(this.item.panelTexture):this.imagesLoaded().then((r=>{const s=t.getContext(this);if(s&&s.node){e=s.node;const t=r&&null!=r.find((t=>!0===t));a.default(e,{backgroundColor:"#ffffff00",scale:1,useCORS:t}).then((t=>{const e=new THREE.CanvasTexture(t);this.item.panelTexture={map:e,width:t.width,height:t.height},n(this.item.panelTexture)}),(t=>{i(t)}))}}))}),1)}))}}hl.PANEL_RADIUS=99,hl.meta={selector:"[model-panel]",hosts:{host:jo},outputs:["over","out","down"],inputs:["item"],template:'\n\t\t<div class="panel__title"><span [innerHTML]="item.title"></span></div>\n\t\t<div class="panel__abstract"><span [innerHTML]="item.abstract"></span></div>\n\t\t<img class="panel__picture" [src]="item.asset | asset" *if="item.asset">\n\t\t<a class="panel__link" [href]="link.href" target="_blank" rel="noopener" *for="let link of item.links">\n\t\t\t<span [innerHTML]="link.title"></span>\n\t\t</a>\n\t'};class Al extends Go{onInit(){super.onInit()}onCreate(t,e){const n=new THREE.Group;"function"==typeof t&&t(n)}}Al.meta={selector:"[model-picture]",hosts:{host:jo},inputs:["item"]};class pl extends Qo{onInit(){super.onInit()}onChanges(){const t=this.item.selected;this.editing=t,this.mesh&&(this.mesh.editing=t)}onCreate(t,e){const n=this.item,r=this.view;r.items;const s=wr.planeGeometry;let o,a;this.onMeshDown=this.onMeshDown.bind(this),this.onMeshPlaying=this.onMeshPlaying.bind(this),this.onMeshZoomed=this.onMeshZoomed.bind(this),this.onMeshCurrentTime=this.onMeshCurrentTime.bind(this),Qr.getStreamId$(n).pipe(i.takeUntil(this.unsubscribe$)).subscribe((c=>{this.streamId!==c&&(this.streamId=c,a&&(a.unsubscribe(),a=null),c||!n.asset?(n.streamId=c,o=this.disposableMesh=new Qr(n,r,s,this.host),o.updateFromItem(n),o.name="plane",o.load((()=>{this.disposableMesh=null,"function"==typeof t&&t(o,n),a=o.events$().pipe(i.takeUntil(this.unsubscribe$)).subscribe((()=>{}))})),this.addMeshListeners(o)):this.mesh&&e(this.mesh,n))}))}addMeshListeners(t){t.on("down",this.onMeshDown),t.on("playing",this.onMeshPlaying),t.on("zoomed",this.onMeshZoomed),t.on("currentTime",this.onMeshCurrentTime)}removeMeshListeners(t){t.off("down",this.onMeshDown),t.off("playing",this.onMeshPlaying),t.off("zoomed",this.onMeshZoomed),t.off("currentTime",this.onMeshCurrentTime)}onMeshDown(){this.down.next(this)}onMeshPlaying(t){this.play.next({itemId:this.item.id,playing:t})}onMeshZoomed(t){this.zoom.next({itemId:this.item.id,zoomed:t})}onMeshCurrentTime(t){this.currentTime.next({itemId:this.item.id,currentTime:t})}onDestroy(){super.onDestroy(),this.disposableMesh&&(this.removeMeshListeners(this.disposableMesh),this.disposableMesh.dispose()),this.mesh&&(this.removeMeshListeners(this.mesh),this.mesh.dispose())}onUpdate(t,e){e.updateFromItem(t),this.updateHelper()}onUpdateAsset(t,e){e.updateByItem(t),Qr.getStreamId$(t).pipe(i.filter((t=>null!==t)),i.take(1)).subscribe((n=>{t.streamId=n,e.load((()=>{}))}))}onDragMove(t,e,n){const i=this.item,r=this.mesh;i.showPanel=!1,this.editing=!0,n?(t.normalize().multiplyScalar(20),r.position.set(t.x,t.y,t.z),r.lookAt(Sr.origin)):(r.position.set(0,0,0),r.lookAt(e),r.position.set(t.x,t.y,t.z),r.position.add(e.multiplyScalar(.01))),this.updateHelper()}onDragEnd(){const t=this.item,e=this.mesh;t.position=e.position.toArray(),t.rotation=e.rotation.toArray(),t.scale=e.scale.toArray(),e.updateFromItem(t),this.editing=!1}}pl.textures={},pl.meta={selector:"[model-plane]",hosts:{host:jo},outputs:["down","play","zoom","currentTime"],inputs:["item","view"]};const fl=100.99;class ml extends Go{get title(){return this.title_}set title(t){this.title_!==t&&(this.title_=t,t===fe.transform("waiting_host")||""!==t&&this.visible_?(this.updateProgress(),this.show()):this.hide())}get visible(){return this.visible_}set visible(t){this.visible_!==t&&(this.visible_=t,t&&""!==this.title_?(this.updateProgress(),this.show()):this.hide())}onInit(){this.title_="",this.visible_=this.host.renderer.xr.isPresenting,super.onInit();(this.vrService=Ts.getService()).session$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.visible=null!=t))}onCreate(e,n){const{node:r}=t.getContext(this),s=r.querySelector(".inner");this.getCanvasTexture().then((t=>{const n=this.createMesh(t);"function"==typeof e&&e(n),Mr.progress$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>{t.count>0?r.classList.add("active"):r.classList.remove("active"),s.style.width=100*t.value+"%",t.count?this.title=0===t.value?fe.transform("loading"):t.title:this.title=this.getTitle()}))}))}getTitle(){return this.view&&this.view.type.name===mi.WaitingRoom.name?fe.transform("waiting_host"):""}show(){this.mesh.add(this.banner),this.material.opacity=1,this.material.needsUpdate=!0}hide(){this.mesh.remove(this.banner),this.material.opacity=0,this.material.needsUpdate=!0}createMesh(t){const e=new THREE.Group,n=Math.PI/180*360,i=fl*n,r=i/360*2.4,s=i/(t.width*r/t.height),o=new THREE.CylinderBufferGeometry(fl,fl,r,80,2,!0,0,n);o.scale(-1,1,1);const a=t.texture;a.wrapS=a.wrapY=THREE.RepeatWrapping,a.repeat.x=s,a.encoding=THREE.sRGBEncoding;const c=this.material=new THREE.MeshBasicMaterial({map:a,transparent:!0,opacity:0,toneMapped:!1});return this.banner=new THREE.Mesh(o,c),e.userData={render:()=>{e.rotation.y+=Math.PI/180*.02}},e}updateProgress(){this.getCanvasTexture().then((t=>{const e=Math.PI/180*360,n=fl*e,i=n/360*2.4,r=n/(t.width*i/t.height);this.texture.repeat.x=r}))}getCanvasTexture(){return new Promise(((t,e)=>{let n=512,i=64;const r=Math.floor(48),s=Math.floor(3.2);let o;o=this.canvas?this.canvas:this.canvas=document.createElement("canvas"),o.width=n,o.height=i;const a=this.title_,c=o.getContext("2d");c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.font=`300 ${r}px ${D.fontFamily}`;let l;n=c.measureText(a).width+8,n=Math.max(512,Math.pow(2,Math.ceil(Math.log(n)/Math.log(2)))),o.width=n,c.clearRect(0,0,n,i),c.fillStyle="#0000005A",c.fillRect(0,0,n,i),c.font=`300 ${r}px ${D.fontFamily}`,c.textAlign="center",c.textBaseline="middle",c.strokeStyle="rgba(0, 0, 0, 0.35)",c.lineWidth=s,c.lineJoin="round",c.miterLimit=2,c.strokeText(a,n/2,32),c.fillStyle="white",c.fillText(a,n/2,32,n),this.texture?(l=this.texture,l.needsUpdate=!0):l=this.texture=new THREE.CanvasTexture(o),t({texture:l,width:n,height:i})}))}}ml.meta={selector:"[model-progress]",hosts:{host:jo},inputs:["view"]};class gl extends Go{static get transparentMaterial(){return this.transparentMaterial_||(this.transparentMaterial_=new THREE.MeshBasicMaterial({color:16711680,transparent:!0,opacity:0})),this.transparentMaterial_}get freezed(){return this.freezed_}set freezed(t){if(this.freezed_!==t){this.freezed_=t;const e=this.mesh;e&&e.traverse((e=>{e.isInteractiveMesh&&(e.freezed=t)}))}}onInit(){super.onInit(),this.isPresenting=!1,Na.active$.pipe(i.takeUntil(this.unsubscribe$)).subscribe((t=>this.freezed=t))}onChanges(){this.editing=this.view.selected}onCreate(t,e){this.loadGlb(D.getPath(this.view.asset.folder),this.view.asset.file,((n,i)=>{this.onGlbLoaded(n,i,t,e)}))}loadGlb(t,e,n){this.host.renderer;const i=Mr.getRef(),r=(new xs).setPath(t),s=`${D.dist}js/draco/`,o=new ol;o.setDecoderPath(s),r.setDRACOLoader(o),r.load(e,(t=>{"function"==typeof n&&n(t.scene,t.animations),Mr.setProgress(i,1)}),(t=>{Mr.setProgress(i,t.loaded,t.total)}))}onGlbLoaded(t,e,n,i){const r=this.view;t.position.set(0,-1.76,0);const s=[];let o;t.traverse((t=>{t.isMesh&&s.push(t),"nav"===t.name&&(r.navIntersectObjects=[t],this.makeTransparent(t))})),r.intersectObjects=s,o=new THREE.Group,o.add(t),"function"==typeof n&&n(o,this.view)}makeTransparent(t){t.isMesh&&(t.material=gl.transparentMaterial),t.traverse((t=>{t.isMesh&&(t.material=gl.transparentMaterial)}))}onUpdateAsset(t,e){this.loadGlb(D.getPath(t.asset.folder),t.asset.file,((t,e)=>{this.onGlbLoaded(t,e,((t,e)=>this.onMount(t,e)),((t,e)=>this.onDismount(t,e)))}))}}gl.meta={selector:"[model-room]",hosts:{host:jo},inputs:["view"]};class vl extends Go{onInit(){super.onInit()}onCreate(t,e){const n=new THREE.Group;"function"==typeof t&&t(n)}}vl.meta={selector:"[model-text]",hosts:{host:jo},inputs:["item"]};class yl extends t.Module{}yl.meta={imports:[t.CoreModule,e.FormModule,ic],declarations:[ce,xn,ni,Ln,ii,hi,Zo,di,fi,pi,Pi,Di,Bi,Ui,Ta,Ba,Ac,fc,mc,gc,vc,Ua,yc,_c,bc,Ca,he,Ec,Sc,wc,Tc,Cc,Ra,xa,Oa,sc,Rc,oc,ga,pc,Gc,Lc,rc,Mc,Ic,fe,kc,va,Pc,Yc,Dc,Bc,Ji,Xc,Go,Jc,tl,el,rl,cl,Jo,hl,Al,pl,ml,gl,vl,ve,Fc,Hc,xc,Vc,ya,Zi,jc,Oc,qc,jo,ae,Uc],bootstrap:_a};return class{constructor(t,e){"object"==typeof window&&(e&&D.merge(e),this.bootstrap(t)),this.environment=D}bootstrap(e){"string"==typeof e&&(e=document.querySelector(e)),e||((e=document.createElement("div")).setAttribute("b-here",""),document.body.appendChild(e)),e.innerHTML='<div class="b-here hidden" b-here-component></div>',this.target=e,t.Browser.bootstrap(yl)}}}(rxcomp,rxcomp.form,rxjs,rxjs.operators,THREE,html2canvas);
//# sourceMappingURL=bhere.min.js.map