/**
 * @license b-here v1.0.0
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("rxcomp"),require("rxcomp-form"),require("rxjs/operators"),require("rxjs"),require("html2canvas"),require("three")):"function"==typeof define&&define.amd?define(["rxcomp","rxcomp-form","rxjs/operators","rxjs","html2canvas","three"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).rxcomp,e.rxcomp.form,e.rxjs.operators,e.rxjs,e.html2canvas,e.THREE)}(this,(function(e,t,n,i,o,r){"use strict";function s(e,t,n,i,o,r,s){try{var a=e[r](s),u=a.value}catch(e){return void n(e)}a.done?t(u):Promise.resolve(u).then(i,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(i,o){var r=e.apply(t,n);function a(e){s(r,i,o,a,u,"next",e)}function u(e){s(r,i,o,a,u,"throw",e)}a(void 0)}))}}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function l(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function h(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o;var f="undefined"!=typeof module&&module.exports,m=null!=(f?{get:function(){}}:new URLSearchParams(window.location.search)).get("debug"),v=f?null:document.querySelector("base").getAttribute("href"),g=!f&&(window&&-1!==window.location.host.indexOf("herokuapp")),b=!f&&(g||window&&("41789"===window.location.port||"5000"===window.location.port||"6443"===window.location.port||"actarian.github.io"===window.location.host)),y=!f&&(window&&-1!==["localhost","127.0.0.1","0.0.0.0"].indexOf(window.location.host.split(":")[0])),w={STATIC:b,DEVELOPMENT:y,PRODUCTION:!y},E=function(){var e=t.prototype;function t(e){e&&Object.assign(this,e)}return e.getAbsoluteUrl=function(e,t){var n=""+window.location.origin+e;return Object.keys(t).forEach((function(e){n=n.replace("$"+e,t[e])})),n},e.getPath=function(e){return this.isLocal(e)?this.href+e:e},e.isLocal=function(e){return-1===e.indexOf("://")},l(t,[{key:"STATIC",get:function(){return w.STATIC},set:function(e){w.STATIC=!0===e||"true"===e,console.log("Environment.STATIC.set",w.STATIC)}},{key:"href",get:function(){return g?this.githubDocs:v}}]),t}(),x=window.STATIC?{appKey:"1a066259928f4b40a243647b58aca42e",channelName:"BHere",flags:{ar:!1},assets:"./",worker:"./js/workers/image.service.worker.js",githubDocs:"https://raw.githubusercontent.com/actarian/b-here/b-here-ipf/docs/",url:{index:"/",access:"/",editor:"/editor",bHere:"/b-here",selfServiceTour:"/self-service-tour",guidedTour:"/guided-tour"},template:{tryInAr:"/try-in-ar.html?viewId=$viewId",modal:{controlRequest:"/control-request-modal.html",tryInAr:"/try-in-ar-modal.html",view:{panorama:"/panorama-modal.html","panorama-grid":"/panorama-grid-modal.html","room-3d":"/room-3d-modal.html",model:"/model-modal.html"},viewItem:{nav:"/nav-modal.html",plane:"/plane-modal.html","curved-plane":"/curved-plane-modal.html",texture:"/texture-modal.html",gltf:"/gltf-modal.html"},remove:"/remove-modal.html"}}}:{appKey:"1a066259928f4b40a243647b58aca42e",channelName:"BHere",flags:{ar:!1},assets:"/Modules/B-Here/Client/docs/",worker:"/Modules/B-Here/Client/docs/js/workers/image.service.worker.js",githubDocs:"https://raw.githubusercontent.com/actarian/b-here/b-here-ipf/docs/",url:{index:"/",access:"/",editor:"/it/it/editor",bHere:"/it/it/b-here",selfServiceTour:"/it/it/self-service-tour",guidedTour:"/it/it/guided-tour"},template:{tryInAr:"/template/modules/b-here/try-in-ar.cshtml?viewId=$viewId",modal:{controlRequest:"/template/modules/b-here/control-request-modal.cshtml",tryInAr:"/template/modules/b-here/try-in-ar-modal.cshtml",view:{panorama:"/template/modules/b-here/panorama-modal.cshtml","panorama-grid":"/template/modules/b-here/panorama-grid-modal.cshtml","room-3d":"/template/modules/b-here/room-3d-modal.cshtml",model:"/template/modules/b-here/model-modal.cshtml"},viewItem:{nav:"/template/modules/b-here/nav-modal.cshtml",plane:"/template/modules/b-here/plane-modal.cshtml","curved-plane":"/template/modules/b-here/curved-plane-modal.cshtml",texture:"/template/modules/b-here/texture-modal.cshtml",gltf:"/template/modules/b-here/gltf-modal.cshtml"},remove:"/template/modules/b-here/remove-modal.cshtml"}}},T=new E(Object.assign({port:5e3,useToken:!1,fontFamily:"GT Walsheim",renderOrder:{panorama:0,model:10,plane:20,tile:30,banner:40,nav:50,panel:60,menu:70,debug:80,pointer:90}},{appKey:"8b0cae93d47a44e48e97e7fd0404be4e",channelName:"BHere"},x));T.STATIC=window.STATIC,console.log("environment",T);var R=function(){function e(){}return e.http$=function(e,t,o,r){var s=this,a=null;return i.from(fetch(t,{method:e,headers:{Accept:"application/json","Content-Type":"application/json"},body:-1!==["POST","PUT","PATCH"].indexOf(e)?JSON.stringify(o):void 0}).then((function(e){a=e;try{var t,n=e.headers.get("content-type");return t=n&&-1!==n.indexOf("application/json")?e.json():e.text(),e.ok?t:t.then((function(e){return Promise.reject(e)}))}catch(t){return e.ok?(console.warn("HttpService.http$","Cannot parse response"),Promise.resolve()):Promise.reject(t)}}))).pipe(n.catchError((function(e){return i.throwError(s.getError(e,a))})))},e.get$=function(e,t,n){var i=this.query(t);return this.http$("GET",""+e+i,void 0,n)},e.delete$=function(e){return this.http$("DELETE",e)},e.post$=function(e,t){return this.http$("POST",e,t)},e.put$=function(e,t){return this.http$("PUT",e,t)},e.patch$=function(e,t){return this.http$("PATCH",e,t)},e.query=function(e){return""},e.getError=function(e,t){var n="object"==typeof e?e:{};return n.status||(n.status=t?t.status:0),n.statusCode||(n.statusCode=t?t.status:0),n.statusMessage||(n.statusMessage=t?t.statusText:e),n},e}(),S={Publisher:"publisher",Attendee:"attendee",Streamer:"streamer",Viewer:"viewer",SelfService:"self-service"},C=function(e){e&&Object.assign(this,e)},I=function(){function e(){}return e.setUser=function(e){this.user$.next(e)},e.me$=function(){var e=this;return R.get$("/api/user/me").pipe(n.map((function(t){return e.mapUser(t)})),n.catchError((function(e){if(404===e.status||404===e.statusCode)return i.of(null);throw e})),n.switchMap((function(t){return e.setUser(t),e.user$})))},e.login$=function(e){var t=this;return R.post$("/api/user/login",e).pipe(n.map((function(e){return t.mapUser(e)})),n.tap((function(e){return t.setUser(e)})))},e.logout$=function(){var e=this;return R.get$("/api/user/logout").pipe(n.map((function(t){return e.mapUser(t)})),n.tap((function(t){return e.setUser(null)})))},e.guidedTour$=function(e){var t=this;return R.post$("/api/user/guided-tour",e).pipe(n.map((function(e){return t.mapUser(e)})),n.tap((function(e){return t.setUser(e)})))},e.selfServiceTour$=function(e){var t=this;return R.post$("/api/user/self-service-tour",e).pipe(n.map((function(e){return t.mapUser(e)})),n.tap((function(e){return t.setUser(e)})))},e.resolve$=function(e,t){return"login"===t?this.login$(e):"guided-tour"===t?this.guidedTour$(e):"self-service-tour"===t?this.selfServiceTour$(e):void 0},e.log$=function(e){return R.post$("/api/user/log",e)},e.mapUser=function(e){return new C(e)},e}();I.user$=new i.BehaviorSubject(null);var k=function(e){function i(){return e.apply(this,arguments)||this}h(i,e);var o=i.prototype;return o.onInit=function(){this.state={status:"access"}},o.onSelfServiceTourRequest=function(){this.initRequestForm(),this.state.status="self-service-tour",this.pushChanges()},o.onGuidedTourRequest=function(){this.initRequestForm(),this.state.status="guided-tour",this.pushChanges()},o.onGuidedTourAccess=function(){I.logout$().pipe(n.first()).subscribe((function(){window.location.href=T.url.guidedTour}))},o.onLogin=function(){this.initLoginForm(),this.state.status="login",this.pushChanges()},o.initRequestForm=function(){var e=this;this.formSubscription&&this.formSubscription.unsubscribe();var i=this.form=new t.FormGroup({firstName:new t.FormControl(null,t.Validators.RequiredValidator()),lastName:new t.FormControl(null,t.Validators.RequiredValidator()),email:new t.FormControl(null,[t.Validators.RequiredValidator(),t.Validators.EmailValidator()]),role:new t.FormControl(null,t.Validators.RequiredValidator()),privacy:new t.FormControl(null,t.Validators.RequiredTrueValidator()),checkRequest:window.antiforgery||"",checkField:""}),o=this.data=window.data||{roles:[{id:1,name:"Show room"},{id:2,name:"Architetto"},{id:3,name:"Interior designer"},{id:4,name:"Privato"},{id:5,name:"Altro"}]},r=this.controls=i.controls,s=o.roles.slice();s.unshift({id:null,name:"Seleziona"}),r.role.options=s,this.formSubscription=i.changes$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.pushChanges()})),this.error=null},o.initLoginForm=function(){var e=this;this.formSubscription&&this.formSubscription.unsubscribe();var i=this.form=new t.FormGroup({username:new t.FormControl(null,t.Validators.RequiredValidator()),password:new t.FormControl(null,t.Validators.RequiredValidator()),checkRequest:window.antiforgery||"",checkField:""});this.controls=i.controls;this.formSubscription=i.changes$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.pushChanges()})),this.error=null},o.test=function(){"login"===this.state.status?this.form.patch({username:"publisher",password:"publisher",checkRequest:window.antiforgery||"",checkField:""}):this.form.patch({firstName:"Jhon",lastName:"Appleseed",email:"jhonappleseed@gmail.com",role:this.controls.role.options.find((function(e){return null!==e.id})).id,privacy:!0,checkRequest:window.antiforgery||"",checkField:""})},o.reset=function(){this.form.reset()},o.onBack=function(){this.state.status="access",this.pushChanges()},o.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value,i=this.state.status;I.resolve$(t,i).pipe(n.first()).subscribe((function(t){switch(console.log("AccessComponent.onSubmit",t),i){case"guided-tour":e.state.status="guided-tour-success",e.pushChanges();break;case"self-service-tour":window.location.href=T.url.selfServiceTour;break;case"login":window.location.href=T.url.guidedTour}e.form.reset()}),(function(t){console.log("AccessComponent.error",t),e.error=t,e.pushChanges()}))}else this.form.touched=!0},o.isValid=function(){var e=this.form.valid;return e},i}(e.Component);k.meta={selector:"[access-component]"};var M=function(){function e(){}return e.addSource=function(e){var t=e instanceof MediaStream?e.id:e;return this.sources_[t]||(e instanceof MediaStream?this.sources_[t]=this.context.createMediaStreamSource(e.clone()):this.sources_[t]=this.context.createMediaElementSource(e)),this.sources_[t]},e.removeSource=function(e){var t=e instanceof MediaStream?e.id:e;return this.removeSourceKey(t)},e.removeSourceKey=function(e){var t;return this.sources_[e]&&(t=this.sources_[e],this.analyser&&t.disconnect(this.analyser),t.disconnect(),delete this.sources_[e]),t},e.frequency$=function(t,o){var r=this;if(void 0===o&&(o=64),o%2==1)throw o;var s=new Uint8Array(o/2);if(this.context){var a=this.analyser;a.fftSize=o,this.addSource(t).connect(a);var u=new i.BehaviorSubject(s);return e.frame$.pipe(n.withLatestFrom(u),n.map((function(e){e[0];var t=e[1];return a.getByteFrequencyData(t),t})),n.tap((function(e){return u.next(e)})),n.finalize((function(){r.removeSource(t)})))}return i.of(s)},e.volume$=function(t){var o=this,r={volume:0,clipped:!1};if(this.context){var s=this.addSource(t),a=e.audioMeterCreate();s.connect(a);var u=new i.BehaviorSubject(r);return e.frame$.pipe(n.withLatestFrom(u),n.map((function(e){e[0];var t=e[1];return t.clipped=a.checkClipping(),t.volume=a.volume,t})),n.tap((function(e){return u.next(e)})),n.finalize((function(){o.removeSource(t)})))}return i.of(r)},e.audioMeterCreate=function(e,t,n){void 0===e&&(e=.98),void 0===t&&(t=.95),void 0===n&&(n=750);var i=this.context;if(i){var o=i.createScriptProcessor(512);return o.onaudioprocess=this.audioMeterProcess,o.checkClipping=this.audioMeterClip,o.dispose=this.audioMeterDispose,o.clipping=!1,o.lastClip=0,o.volume=0,o.clipLevel=e,o.averaging=t,o.clipLag=n,o.connect(i.destination),o}},e.audioMeterProcess=function(e){for(var t,n=e.inputBuffer.getChannelData(0),i=n.length,o=0,r=0;r<i;r++)t=n[r],Math.abs(t)>=this.clipLevel&&(this.clipping=!0,this.lastClip=window.performance.now()),o+=t*t;var s=Math.sqrt(o/i);this.volume=Math.max(s,this.volume*this.averaging)},e.audioMeterClip=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},e.audioMeterDispose=function(){this.disconnect(),this.onaudioprocess=null},e.step$=function(e){return i.Observable.create((function(t){requestAnimationFrame((function(n){var i=e?(n-e.startTime)/1e3:0;t.next({startTime:n,deltaTime:i})}))})).pipe(n.map((function(e){return e.deltaTime>1/30&&(e.deltaTime=1/30),e})))},e.dispose=function(){var e=this,t=this.analyser;Object.keys(this.sources_).forEach((function(t){e.removeSourceKey(t)})),t.disconnect(),this.sources_={}},l(e,null,[{key:"context",get:function(){return!this.context_&&"AudioContext"in window&&(this.context_=new AudioContext),this.context_}},{key:"analyser",get:function(){return this.analyser_||(this.analyser_=this.context.createAnalyser()),this.analyser_}}]),e}();M.sources_={},M.frame$=i.of(void 0).pipe(n.expand((function(e){return M.step$(e)})),n.filter((function(e){return void 0!==e})),n.map((function(e){return e.deltaTime})),n.share());var $=function(t){function i(){return t.apply(this,arguments)||this}h(i,t);var o=i.prototype;return o.onInit=function(){this.isIOS=i.isIOS();var t=e.getContext(this).node,n=this.preview=t.querySelector("video");this.onLoadedMetadata=this.onLoadedMetadata.bind(this),n.addEventListener("loadedmetadata",this.onLoadedMetadata);var o=t.querySelector(".audio");if(!this.isIOS)this.bars=new Array(32).fill(0).map((function(e){var t=document.createElement("div");return t.classList.add("bar"),o.appendChild(t),t}))},o.onDestroy=function(){this.preview.removeEventListener("loadedmetadata",this.onLoadedMetadata),this.isIOS||M.dispose()},o.initStream=function(){var e=this,t=this.preview;this.preview&&(this.video_||this.audio_?navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&navigator.mediaDevices.getUserMedia({video:!!this.video_&&{deviceId:this.video_},audio:!!this.audio_&&{deviceId:this.audio_}}).then((function(n){e.isIOS?e.stream.next(n):("srcObject"in t?t.srcObject=n:t.src=window.URL.createObjectURL(n),e.analyzeData(n),e.loadingStream_=n)})).catch((function(t){console.log("AgoraDevicePreviewComponent.initStream.error",t.name,t.message),e.stream.next(null)})):(this.isIOS||("srcObject"in t?t.srcObject=null:t.src=null,this.analyzeData(null)),this.stream.next(null)))},o.onLoadedMetadata=function(e){this.preview.play(),this.stream.next(this.loadingStream_)},o.analyzeData=function(e){var t=this;this.frequencySubscription&&this.frequencySubscription.unsubscribe(),e&&(this.frequencySubscription=M.frequency$(e,64).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.bars.forEach((function(t,n){var i=Math.min(100,5+e[n])/100;t.style.left=3.125*n+"%",t.style.transform="scale(1,"+i+")",t.style.opacity=i}))})))},i.isIOS=function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},l(i,[{key:"video",get:function(){return this.video_},set:function(e){this.video_!==e&&(this.video_=e,this.change&&(this.change.next(),this.initStream()))}},{key:"audio",get:function(){return this.audio_},set:function(e){this.audio_!==e&&(this.audio_=e,this.change&&(this.change.next(),this.initStream()))}}]),i}(e.Component);$.meta={selector:"[agora-device-preview]",outputs:["stream","change"],inputs:["video","audio"]};var A=function(){function e(){}return e.patchState=function(e){e=Object.assign({},this.state,e),this.state=e},l(e,null,[{key:"state",set:function(e){this.state$.next(e)},get:function(){return this.state$.getValue()}}]),e}();c(A,"state$",new i.BehaviorSubject({}));var H=function(){function e(){this.events={}}var t=e.prototype;return t.on=function(e,t){var n=this,i=this.events[e]=this.events[e]||[];return i.push(t),function(){n.events[e]=i.filter((function(e){return e!==t}))}},t.off=function(e,t){var n=this.events[e];n&&(this.events[e]=n.filter((function(e){return e!==t})))},t.once=function(e,t){var n=this,i=function i(o){t(o),n.off(e,i)};this.on(e,i)},t.emit=function(e,t){var n=this.events[e];n&&n.forEach((function(e){e(t)}));var i=this.events.broadcast;i&&i.forEach((function(n){n(e,t)}))},t.has=function(e){var t=this.events[e];return t&&t.length},e}(),P=function(){function e(){}return e.message=function(e){this.message$.next(e)},e.in=function(e){this.in$.next(e)},e.sendBack=function(e){e=Object.assign({},e,{remoteId:e.clientId}),this.in$.next(e)},e.out=function(e){this.out$.next(e)},e}();c(P,"message$",new i.ReplaySubject(1)),c(P,"in$",new i.ReplaySubject(1)),c(P,"send",P.in),c(P,"out$",new i.ReplaySubject(1));var O=function(){function e(){}return e.getPublisherStreamId$=function(){var e=this,t=this.publisherStreamId;return t?i.of(t):this.streams$.pipe(n.map((function(){return e.publisherStreamId})),n.filter((function(e){return e})))},e.getRemoteById=function(t){var n=e.remotes.find((function(e){return e.getId()===t}));if(n)return n},l(e,null,[{key:"editor",set:function(e){this.editor$.next(e)},get:function(){return this.editor$.getValue()}},{key:"local",set:function(e){this.local$.next(e)},get:function(){return this.local$.getValue()}},{key:"remotes",set:function(e){this.remotes$.next(e)},get:function(){return this.remotes$.getValue()}},{key:"peers",set:function(e){this.peers$.next(e)},get:function(){return this.peers$.getValue()}},{key:"publisherStreamId",get:function(){var e=this.remotes.slice(),t=this.local;t&&e.unshift(t);var n=e.find((function(e){return e.clientInfo&&e.clientInfo.role===S.Publisher}));return n?n.getId():null}}]),e}();c(O,"editor$",new i.BehaviorSubject(null)),c(O,"local$",new i.BehaviorSubject(null)),c(O,"remotes$",new i.BehaviorSubject([])),c(O,"peers$",new i.BehaviorSubject([])),c(O,"streams$",i.combineLatest([O.local$,O.remotes$,O.editor$]).pipe(n.map((function(e){var t,n=e[0],i=e[1],o=e[2],r=i;(n&&(r=r.slice()).push(n),o)&&(t=r).push.apply(t,o);return r})),n.shareReplay(1)));var U=[{id:1,name:"4K 2160p 3840x2160",resolution:{width:3840,height:2160},frameRate:{min:15,max:30},bitrate:{min:8910,max:13500}},{id:2,name:"HD 1440p 2560×1440",resolution:{width:2560,height:1440},frameRate:{min:15,max:30},bitrate:{min:4850,max:7350}},{id:3,name:"HD 1080p 1920x1080",resolution:{width:1920,height:1080},frameRate:{min:15,max:30},bitrate:{min:2080,max:4780}},{id:4,name:"LOW 720p 960x720",resolution:{width:960,height:720},frameRate:{min:15,max:30},bitrate:{min:910,max:1380}},{id:5,name:"LOWEST 240p 320x240",resolution:{width:320,height:240},frameRate:{min:15,max:15},bitrate:{min:140,max:200}}],_="link",L="name",D="device",V="should-connect",F="connecting",j="connected",G="agoraEvent",z="requestControl",q="requestControlAccepted",N="requestControlRejected",B="requestControlDismiss",W="requestControlDismissed",K="requestPeerInfo",X="requestPeerInfoResult",Y="requestInfo",J="requestInfoResult",Z="requestInfoDismiss",Q="requestInfoDismissed",ee="requestInfoRejected",te="slideChange",ne="cameraRotate",ie="cameraOrientation",oe="navToView",re="navToGrid",se="vrStarted",ae="vrEnded",ue="vrState",le=function(e){Object.assign(this,e)},ce=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(le),de=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(le),he=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(le),pe=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(le),fe=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(le),me=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(le),ve=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(le),ge=function(e){function t(n){var i;if(t.AGORA)throw"AgoraService is a singleton";(i=e.call(this)||this).onStreamPublished=i.onStreamPublished.bind(p(i)),i.onStreamUnpublished=i.onStreamUnpublished.bind(p(i)),i.onStreamAdded=i.onStreamAdded.bind(p(i)),i.onStreamRemoved=i.onStreamRemoved.bind(p(i)),i.onStreamSubscribed=i.onStreamSubscribed.bind(p(i)),i.onMuteVideo=i.onMuteVideo.bind(p(i)),i.onUnmuteVideo=i.onUnmuteVideo.bind(p(i)),i.onMuteAudio=i.onMuteAudio.bind(p(i)),i.onUnmuteAudio=i.onUnmuteAudio.bind(p(i)),i.onVolumeIndicator=i.onVolumeIndicator.bind(p(i)),i.onPeerConnect=i.onPeerConnect.bind(p(i)),i.onPeerLeaved=i.onPeerLeaved.bind(p(i)),i.onConnectionStateChange=i.onConnectionStateChange.bind(p(i)),i.onTokenPrivilegeWillExpire=i.onTokenPrivilegeWillExpire.bind(p(i)),i.onTokenPrivilegeDidExpire=i.onTokenPrivilegeDidExpire.bind(p(i)),i.onMessage=i.onMessage.bind(p(i));var o=A.state;return A.patchState({devices:o.role!==S.Attendee&&n?n:{videos:[],audios:[]},quality:o.role===S.Publisher?U[0]:U[U.length-1],membersCount:0}),i}h(t,e),t.getSingleton=function(e){if(!m)return this.AGORA||(this.AGORA=new t(e)),this.AGORA};var o=t.prototype;return o.addStreamDevice=function(e){this.removeStreamDevice();var t={deviceId:"video-stream",label:"videostream",kind:"videostream",src:e},n={deviceId:"audio-stream",label:"videostream",kind:"videostream",src:e},i=A.state.devices;i.videos.push(t),i.audios.push(n),A.patchState({devices:i})},o.removeStreamDevice=function(){var e=A.state.devices;e.videos=e.videos.filter((function(e){return"videostream"!==e.kind})),e.audios=e.audios.filter((function(e){return"videostream"!==e.kind})),A.patchState({devices:e})},o.devices$=function(){var e=A.state.devices,t=this.defaultVideos=this.defaultVideos||e.videos.slice(),n=this.defaultAudios=this.defaultAudios||e.videos.slice();return e.videos=t.slice(),e.audios=n.slice(),i.from(new Promise((function(t,n){var i=function(){AgoraRTC.getDevices((function(i){o.close();for(var r=0;r<i.length;r++){var s=i[r];"videoinput"===s.kind&&s.deviceId&&e.videos.push({label:s.label||"camera-"+e.videos.length,deviceId:s.deviceId,kind:s.kind}),"audioinput"===s.kind&&s.deviceId&&e.audios.push({label:s.label||"microphone-"+e.audios.length,deviceId:s.deviceId,kind:s.kind})}e.videos.length>0||e.audios.length>0?t(e):n(e)}))},o=AgoraRTC.createStream({audio:!0,video:!0});o.init((function(){i()}),(function(){i()}))})))},o.connect$=function(e){var t=this,n=A.state.devices;return e&&(n.video=e.video,n.audio=e.audio),A.state.connecting||(A.patchState({status:F,connecting:!0,devices:n}),setTimeout((function(){t.createClient((function(){t.getRtcToken().subscribe((function(e){t.join(e.token)}))}))}),250)),A.state$},o.membersCount$=function(e){var t=this.messageClient;return i.interval(2e3).pipe(n.switchMap((function(){return i.from(t.getChannelMemberCount([e]))})),n.map((function(t){return t[e]})))},o.observeMemberCount=function(){this.unobserveMemberCount(),this.membersCountSubscription=this.membersCount$(A.state.channelNameLink).subscribe((function(e){A.patchState({membersCount:e})}))},o.unobserveMemberCount=function(){this.membersCountSubscription&&(this.membersCountSubscription.unsubscribe(),this.membersCountSubscription=null,A.patchState({membersCount:0}))},o.getRtcToken=function(){return T.useToken?R.post$("/api/token/rtc",{uid:null}):i.of({token:null})},o.getRtmToken=function(e){return T.useToken?R.post$("/api/token/rtm",{uid:e}):i.of({token:null})},o.createClient=function(e){var t=this;this.client&&e(),AgoraRTC.Logger.setLogLevel(AgoraRTC.Logger.NONE);var n=this.client=AgoraRTC.createClient({mode:"live",codec:"h264"}),i=function(){n.init(T.appKey,(function(){e()}),(function(e){t.client=null}))};A.state.role===S.Viewer?n.setClientRole("audience",(function(e){e||i()})):i(),n.on("stream-published",this.onStreamPublished),n.on("stream-unpublished",this.onStreamUnpublished),n.on("stream-added",this.onStreamAdded),n.on("stream-subscribed",this.onStreamSubscribed),n.on("mute-video",this.onMuteVideo),n.on("unmute-video",this.onUnmuteVideo),n.on("mute-audio",this.onMuteAudio),n.on("unmute-audio",this.onUnmuteAudio),n.on("error",this.onError),n.on("peer-online",this.onPeerConnect),n.on("peer-leave",this.onPeerLeaved),n.on("stream-removed",this.onStreamRemoved),n.on("onTokenPrivilegeWillExpire",this.onTokenPrivilegeWillExpire),n.on("onTokenPrivilegeDidExpire",this.onTokenPrivilegeDidExpire),(this.messageClient=AgoraRTM.createInstance(T.appKey,{logFilter:AgoraRTM.LOG_FILTER_OFF})).setParameters({logFilter:AgoraRTM.LOG_FILTER_OFF})},o.getChannelNameLink=function(){var e=A.state.link||"",t=e.match(/(\d{9})-(\d{4})-(\d{13})/);return t&&(e=t[1]+"-"+t[3]),A.state.channelName+"-"+e},o.join=function(e){var t=this;this.channel=null;var n=this.client;var i=this.getChannelNameLink();n.join(null,i,null,(function(e){A.patchState({status:j,channelNameLink:i,connected:!0,uid:e}),t.getRtmToken(e).subscribe((function(n){t.joinMessageChannel(n.token,e).then((function(n){A.state.role!==S.Viewer&&(t.autoDetectDevice(),t.createMediaStream(e,A.state.devices.video,A.state.devices.audio)),t.observeMemberCount()}),(function(e){}))}))}),(function(e){console.log("AgoraService.join.error",e)}))},o.joinMessageChannel=function(e,t){var n,i=this;return new Promise((function(e,o){var r=i.messageClient;r.login({uid:t.toString()}).then((function(){return(n=r.createChannel(A.state.channelNameLink)).join()})).then((function(){n.on("ChannelMessage",i.onMessage),i.channel=n,i.emit("channel",n),e(t)})).catch(o)}))},o.detectDevices=function(e){AgoraRTC.getDevices((function(t){for(var n=[],i=[],o=0;o<t.length;o++){var r=t[o];"videoinput"==r.kind&&n.push({label:r.label||"camera-"+n.length,deviceId:r.deviceId,kind:r.kind}),"audioinput"==r.kind&&i.push({label:r.label||"microphone-"+n.length,deviceId:r.deviceId,kind:r.kind})}e({videos:n,audios:i})}))},o.getVideoOptions=function(e,t){return new Promise((function(n,i){if(t)if("videostream"===t.kind){var o=document.querySelector("#"+t.deviceId);o.crossOrigin="anonymous";var r=new Hls;r.attachMedia(o),r.on(Hls.Events.MEDIA_ATTACHED,(function(){r.loadSource(t.src),r.on(Hls.Events.MANIFEST_PARSED,(function(t,i){o.play().then((function(t){var i=o.captureStream();e.videoSource=i.getVideoTracks()[0],n(e)}),(function(e){console.log("AgoraService.getVideoOptions.error",e)}))}))}))}else if("videoplayer"===t.kind||"videostream"===t.kind){var s=document.querySelector("#"+t.deviceId);s.crossOrigin="anonymous";var a=s.captureStream();e.videoSource=a.getVideoTracks()[0],n(e)}else e.cameraId=t.deviceId,n(e);else n(e)}))},o.getAudioOptions=function(e,t){return new Promise((function(n,i){if(t)if("videostream"===t.kind){var o=document.querySelector("#"+t.deviceId);o.crossOrigin="anonymous";var r=new Hls;r.attachMedia(o),r.on(Hls.Events.MEDIA_ATTACHED,(function(){r.loadSource(t.src),r.on(Hls.Events.MANIFEST_PARSED,(function(t,i){r.loadLevel=i.levels.length-1,o.play().then((function(t){var i=o.captureStream();e.audioSource=i.getAudioTracks()[0],n(e)}),(function(e){console.log("AgoraService.getAudioOptions.error",e)}))}))}))}else if("videoplayer"===t.kind||"videostream"===t.kind){var s=document.querySelector("#"+t.deviceId);s.crossOrigin="anonymous";var a=s.captureStream();e.audioSource=a.getAudioTracks()[0],n(e)}else e.microphoneId=t.deviceId,n(e);else n(e)}))},o.autoDetectDevice=function(){},o.createMediaStream=function(e,t,n){var i=this,o={streamID:e,video:Boolean(t),audio:Boolean(n),screen:!1};Promise.all([this.getVideoOptions(o,t),this.getAudioOptions(o,n)]).then((function(e){var t=Object.assign({},A.state.quality);i.createLocalStreamWithOptions(o,t)}))},o.createLocalStreamWithOptions=function(e,t){var n=this,i=AgoraRTC.createStream(e);t&&i.setVideoEncoderConfiguration(t),i.init((function(){O.local=i,setTimeout((function(){n.publishLocalStream()}),1)}),(function(e){console.log("AgoraService.initLocalStream.init.error",e)}))},o.initLocalStream=function(){var e=this;O.local.init((function(){e.publishLocalStream()}),(function(e){console.log("AgoraService.initLocalStream.init.error",e)}))},o.createLocalStream=function(e,t,n){if(t||n){var i={streamID:e,microphoneId:t,cameraId:n,audio:!!t,video:!!n,screen:!1};this.createLocalStreamWithOptions(i)}},o.createMediaVideoStream=function(e,t){var n=e.captureStream(60),i=AgoraRTC.createStream({audio:!0,video:!0,videoSource:n.getVideoTracks()[0],audioSource:n.getAudioTracks()[0]});i.init((function(){t(i.getVideoTrack(),i.getAudioTrack())}))},o.publishLocalStream=function(){var e=this.client,t=O.local;e.publish(t,(function(e){console.log("AgoraService.publishLocalStream.error",t.getId(),e)})),t.clientInfo={role:A.state.role,name:A.state.name,uid:A.state.uid},O.local=t},o.unpublishLocalStream=function(){var e=this.client,t=O.local;t&&e.unpublish(t,(function(e){console.log("AgoraService.unpublishLocalStream.error",t.getId(),e)})),O.local=null},o.leaveChannel=function(){var e=this;return A.patchState({connecting:!1}),this.unpublishLocalStream(),O.remotes=[],O.peers=[],new Promise((function(t,n){e.leaveMessageChannel().then((function(){e.client.leave((function(){e.client=null,t()}),(function(e){console.log("AgoraService.leaveChannel.error",e),n(e)}))}),n)}))},o.leaveMessageChannel=function(){var e=this;return new Promise((function(t,n){e.unobserveMemberCount();var i=e.channel,o=e.messageClient;i.leave().then((function(){e.channel=null,o.logout().then((function(){e.messageClient=null,t()}),n)}),n)}))},o.toggleCamera=function(){var e=O.local;e&&e.video&&(e.userMuteVideo?(e.unmuteVideo(),A.patchState({cameraMuted:!1}),this.broadcastEvent(new pe({streamId:e.getId()}))):(e.muteVideo(),A.patchState({cameraMuted:!0}),this.broadcastEvent(new he({streamId:e.getId()}))))},o.toggleAudio=function(){var e=O.local;e&&e.audio&&(e.userMuteAudio?(e.unmuteAudio(),A.patchState({audioMuted:!1}),this.broadcastEvent(new me({streamId:e.getId()}))):(e.muteAudio(),A.patchState({audioMuted:!0}),this.broadcastEvent(new fe({streamId:e.getId()}))))},o.toggleControl=function(){var e=this;A.state.control?this.sendRemoteControlDismiss().then((function(e){A.patchState({control:!e})})):A.state.spying?this.sendRemoteInfoDismiss(A.state.spying).then((function(t){A.patchState({spying:!1}),e.sendRemoteControlRequest().then((function(e){A.patchState({control:e})}))})):this.sendRemoteControlRequest().then((function(e){A.patchState({control:e})}))},o.toggleSpy=function(e){var t=this;A.state.control?this.sendRemoteControlDismiss().then((function(n){A.patchState({control:!1}),t.sendRemoteRequestInfo(e).then((function(t){A.patchState({spying:e})}))})):A.state.spying?this.sendRemoteInfoDismiss(A.state.spying).then((function(n){A.state.spying!==e?t.sendRemoteRequestInfo(e).then((function(t){A.patchState({spying:e})})):A.patchState({spying:!1})})):this.sendRemoteRequestInfo(e).then((function(t){A.patchState({spying:e})}))},o.newMessageId=function(){return A.state.uid+"-"+Date.now().toString()},o.sendRemoteControlDismiss=function(){var e=this;return new Promise((function(t,n){e.sendMessage({type:B,messageId:e.newMessageId()}).then((function(e){e.type===W?t(!0):e.type===N&&t(!1)}))}))},o.sendRemoteControlRequest=function(){var e=this;return new Promise((function(t,n){e.sendMessage({type:z,messageId:e.newMessageId()}).then((function(e){e.type===q?t(!0):e.type===N&&t(!1)}))}))},o.sendRemoteRequestPeerInfo=function(e){var t=this;return new Promise((function(n,i){t.sendMessage({type:K,messageId:t.newMessageId(),remoteId:e}).then((function(e){e.type===X&&(e.clientInfo.role===S.Publisher&&A.patchState({hosted:!0}),n(e))}))}))},o.sendRemoteRequestInfo=function(e){var t=this;return new Promise((function(n,i){t.sendMessage({type:Y,messageId:t.newMessageId(),remoteId:e}).then((function(t){t.type===J&&(A.patchState({spying:e}),n(t))}))}))},o.sendRemoteInfoDismiss=function(e){var t=this;return new Promise((function(n,i){t.sendMessage({type:Z,messageId:t.newMessageId(),remoteId:e}).then((function(e){e.type===Q?n(!0):e.type===ee&&n(!1)}))}))},o.navToView=function(e){(A.state.control||A.state.spyed)&&this.sendMessage({type:oe,viewId:e})},o.getSessionStats=function(){this.client.getSessionStats((function(e){console.log("Current Session Duration: "+e.Duration),console.log("Current Session UserCount: "+e.UserCount),console.log("Current Session SendBytes: "+e.SendBytes),console.log("Current Session RecvBytes: "+e.RecvBytes),console.log("Current Session SendBitrate: "+e.SendBitrate),console.log("Current Session RecvBitrate: "+e.RecvBitrate)}))},o.getSystemStats=function(){this.client.getSystemStats((function(e){console.log("Current battery level: "+e.BatteryLevel)}))},o.sendMessage=function(e){var t=this;return new Promise((function(n,i){if(A.state.connected){switch(e.clientId=A.state.uid,e.type){case ie:case re:if(!A.state.control&&!A.state.spyed)return;break;case ne:case te:if(!A.state.control)return}var o=function(e,i){try{var o=JSON.stringify(e);e.messageId&&t.once("message-"+e.messageId,(function(e){n(e)})),i.sendMessage({text:o}).then((function(){e.messageId||n(e)})).catch((function(e){console.log("AgoraService.sendMessage.error",e)}))}catch(e){console.log("AgoraService.sendMessage.error",e)}},r=t.channel;if(r)o(e,r);else try{t.once("channel",(function(t){o(e,t)}))}catch(e){i(e)}}}))},o.checkBroadcastMessage=function(e){switch(e.type){case B:A.patchState({locked:!1}),this.sendMessage({type:W,messageId:e.messageId});break;case Z:A.patchState({spyed:!1}),this.sendMessage({type:Q,messageId:e.messageId,remoteId:e.remoteId});break;case J:A.state.role===S.Publisher&&this.broadcastMessage(e);case ie:case ne:case oe:case re:case te:(A.state.locked||A.state.spying&&A.state.spying===e.clientId)&&this.broadcastMessage(e);break;default:this.broadcastMessage(e)}},o.broadcastMessage=function(e){P.out(e)},o.broadcastEvent=function(e){P.out({type:G,event:e})},o.onMessage=function(e,t){if(t!==A.state.uid){var n=JSON.parse(e.text);if(n.messageId&&this.has("message-"+n.messageId)&&this.emit("message-"+n.messageId,n),n.remoteId&&n.remoteId!==A.state.uid)return;if(n.type===se){var i=document.createElement("div");i.classList.add("player__vr"),n.container=i}this.checkBroadcastMessage(n)}},o.onError=function(e){console.log("AgoraService.onError",e)},o.onStreamPublished=function(e){var t=O.local;t.clientInfo={role:A.state.role,name:A.state.name,uid:A.state.uid},O.local=t},o.onStreamUnpublished=function(e){O.local=null},o.onStreamAdded=function(e){var t=this.client,n=e.stream;n&&(n.getId()!==A.state.uid&&t.subscribe(n,(function(e){console.log("AgoraService.onStreamAdded.subscribe.error",e)})))},o.onStreamRemoved=function(e){var t=e.stream.getId();t!==A.state.uid&&this.remoteRemove(t)},o.onStreamSubscribed=function(e){this.remoteAdd(e.stream)},o.onPeerConnect=function(e){this.peerAdd(e)},o.onPeerLeaved=function(e){var t=e.uid;t!==A.state.uid&&this.remoteRemove(t),this.peerRemove(t),A.patchState({locked:!1,control:!1,spyed:!1})},o.peerAdd=function(e){var t={uid:e.uid},n=O.peers;n.push(t),O.peers=n,this.broadcastEvent(new ce({peer:t}))},o.peerRemove=function(e){var t=O.peers,n=t.find((function(t){return t.uid===e}));n&&(t.splice(t.indexOf(n),1),O.peers=t)},o.remoteAdd=function(e){var t=O.remotes;t.push(e),O.remotes=t,this.broadcastEvent(new de({stream:e}));var n=e.getId();this.sendRemoteRequestPeerInfo(n).then((function(e){var t=O.remotes,i=t.find((function(e){return e.getId()===n}));i&&(i.clientInfo=e.clientInfo),O.remotes=t}))},o.remoteRemove=function(e){var t=O.remotes,n=t.find((function(t){return t.getId()===e}));n&&(n.isPlaying()&&n.stop(),t.splice(t.indexOf(n),1),O.remotes=t,n.clientInfo&&n.clientInfo.role===S.Publisher&&A.patchState({hosted:!1}))},o.onMuteVideo=function(e){this.broadcastEvent(new he({streamId:e.uid}))},o.onUnmuteVideo=function(e){this.broadcastEvent(new pe({streamId:e.uid}))},o.onMuteAudio=function(e){this.broadcastEvent(new fe({streamId:e.uid}))},o.onUnmuteAudio=function(e){this.broadcastEvent(new me({streamId:e.uid}))},o.onVolumeIndicator=function(e){var t=e.attr.map((function(e){return{streamId:e.uid,level:e.level}}));this.broadcastEvent(new ve({streams:t}))},o.onConnectionStateChange=function(e){console.log("AgoraService.onConnectionStateChange",e)},o.onTokenPrivilegeWillExpire=function(e){console.log("AgoraService.onTokenPrivilegeWillExpire")},o.onTokenPrivilegeDidExpire=function(e){console.log("AgoraService.onTokenPrivilegeDidExpire")},t}(H),be=function(e){function i(){return e.apply(this,arguments)||this}h(i,e);var o=i.prototype;return o.onInit=function(){var e=this;if(this.isIOS=i.isIOS(),this.isHttps="https:"===window.location.protocol,this.state={},this.devices={videos:[],audios:[]},this.stream=null,this.form=null,this.isHttps){var t=this.agora=ge.getSingleton();A.state$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.pushChanges()})),t&&t.devices$().subscribe((function(t){e.devices=t,e.initForm(t),e.pushChanges()}))}},o.openHttps=function(e){window.location.href=window.location.href.replace("http://","https://").replace(":5000",":6443")},o.initForm=function(e){var i=this,o=this.form=new t.FormGroup({video:new t.FormControl(null,e.videos.length?t.Validators.RequiredValidator():void 0),audio:new t.FormControl(null,e.audios.length?t.Validators.RequiredValidator():void 0)}),r=this.controls=o.controls,s=e.videos.map((function(e){return{id:e.deviceId,name:e.label}}));s.length>0&&s.unshift({id:null,name:"Seleziona una sorgente video"}),r.video.options=s;var a=e.audios.map((function(e){return{id:e.deviceId,name:e.label}}));a.length>0&&a.unshift({id:null,name:"Seleziona una sorgente audio"}),r.audio.options=a,o.changes$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){i.pushChanges()}))},o.onStreamDidChange=function(e){this.stream=null,this.pushChanges()},o.onStream=function(e){this.stream=e,this.pushChanges()},o.isValid=function(){var e=this.form.valid&&(this.stream||this.isIOS);return e},o.onEnter=function(e){var t=this.form.value,n=this.devices;n.video=n.videos.find((function(e){return e.deviceId===t.video})),n.audio=n.audios.find((function(e){return e.deviceId===t.audio})),this.enter.next(n)},i.isIOS=function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},i}(e.Component);be.meta={selector:"[agora-device]",outputs:["enter"]};var ye=function(){function e(){}return e.has=function(e){return new URLSearchParams(window.location.search).has(e)},e.get=function(e){return new URLSearchParams(window.location.search).get(e)},e.set=function(e,t){var n=new URLSearchParams(window.location.search);"string"==typeof e?n.set(e,t):n.set(e,""),this.replace(n)},e.replace=function(e){if(window.history&&window.history.pushState){var t=document.title,n=window.location.href.split("?")[0]+"?"+e.toString();window.history.pushState(e.toString(),t,n)}},e.deserialize=function(e){var t=this.get("params");return this.decode(e,t)},e.serialize=function(e,t){var n=this.deserialize(),i=this.encode(e,t,n);this.set("params",i)},e.decode=function(e,t){var n=null;if(t){var i=window.atob(t);n=JSON.parse(i)}return e&&n&&(n=n[e]),n||null},e.encode=function(e,t,n){n=n||{};"string"==typeof e?n[e]=t:n=e;var i=JSON.stringify(n);return window.btoa(i)},e}(),we=function(e){function i(){return e.apply(this,arguments)||this}h(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.editorLink=T.url.editor,this.state={};var i=this.form=new t.FormGroup({link:new t.FormControl(null,[t.Validators.PatternValidator(/^\d{9}-\d{4}-\d{13}$/),t.Validators.RequiredValidator()]),linkStreamer:null,linkViewer:null});this.controls=i.controls;i.changes$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.pushChanges()})),A.state$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.pushChanges()}))},o.onGenerateMeetingId=function(e){var t=(new Date).valueOf().toString();this.form.patch({link:this.getRoleMeetingId(t,S.Publisher),linkStreamer:this.getRoleMeetingId(t,S.Streamer),linkViewer:this.getRoleMeetingId(t,S.Viewer)})},o.replaceRoleMeetingId=function(e,t){var n=e.split("-");return n[1]=this.padded(this.getRoleIndex(t),4),n.join("-")},o.getRoleMeetingId=function(e,t){return this.padded(this.state.user.id,9)+"-"+this.padded(this.getRoleIndex(t),4)+"-"+e},o.getRoleIndex=function(e){return Object.keys(S).reduce((function(t,n,i){return S[n]===e?i:t}),-1)},o.onCopyToClipBoard=function(e){var t=document.createElement("input");t.style.position="absolute",t.style.top="1000vh",document.querySelector("body").appendChild(t),t.value=this.getUrl(e,!0),t.focus(),t.select(),t.setSelectionRange(0,99999),document.execCommand("copy"),t.parentNode.removeChild(t),alert("link copiato!\n "+t.value)},o.isValid=function(){var e=this.form.valid;return e},o.onNext=function(e){var t=this.controls.link.value;this.replaceUrl(t),this.link.next(t)},o.getUrl=function(e,t){void 0===t&&(t=!1);var n=ye.get("role")||null,i=ye.get("name")||null;return""+window.location.origin+window.location.pathname+"?link="+e+(i?"&name="+i:"")+(n&&!t?"&role="+n:"")},o.replaceUrl=function(e){if("history"in window){var t=this.getUrl(e);window.history.replaceState({pageTitle:window.pageTitle},"",t)}},o.padded=function(e,t){var n="000000000"+e;return n.substr(n.length-t)},l(i,[{key:"heroku",get:function(){return g}}]),i}(e.Component);we.meta={selector:"[agora-link]",outputs:["link"]};var Ee=function(e){function i(){return e.apply(this,arguments)||this}h(i,e);var o=i.prototype;return o.onInit=function(){var e=this,i=ye.get("name")||null;this.state={};var o=this.form=new t.FormGroup({name:new t.FormControl(i,[t.Validators.PatternValidator(/^\w{2,}\s\w{2,}/),t.Validators.RequiredValidator()])});this.controls=o.controls;o.changes$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.pushChanges()})),A.state$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.pushChanges()}))},o.isValid=function(){var e=this.form.valid;return e},o.onNext=function(e){this.replaceUrl(),this.name.next(this.controls.name.value)},o.replaceUrl=function(){if("history"in window){var e=ye.get("role")||null,t=ye.get("link")||null,n=""+window.location.origin+window.location.pathname+"?link="+t+"&name="+this.controls.name.value+(e?"&role="+e:"");window.history.replaceState({pageTitle:window.pageTitle},"",n)}},i}(e.Component);Ee.meta={selector:"[agora-name]",outputs:["name"]};var xe=function(t){function i(){return t.apply(this,arguments)||this}h(i,t);var o=i.prototype;return o.onInit=function(){var e=this;this.videoMuted=!1,this.audioMuted=!1,this.shouldUseResumeGesture=!1,this.state={},A.state$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.pushChanges()})),P.out$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(t.type){case G:var n=t.event;e.streamId&&n.streamId===e.streamId&&(n instanceof he&&(e.videoMuted=!0),n instanceof pe&&(e.videoMuted=!1),n instanceof fe&&(e.audioMuted=!0),n instanceof me&&(e.audioMuted=!1));break;case se:e.streamId===t.clientId&&(e.vrContainer=t.container);break;case ae:e.streamId===t.clientId&&(e.vrContainer=null)}}))},o.setMediaStream=function(e){var t=this.videoNode;"srcObject"in t?t.srcObject=e:t.src=e?window.URL.createObjectURL(e):null},o.onLoadedMetadata=function(e){this.videoNode.play().then((function(e){}),(function(e){console.log("AgoraStreamComponent.play.error",e)}))},o.onToggleSpy=function(e){this.toggleSpy.next(e)},l(i,[{key:"videoMuted",set:function(t){if(this.videoMuted_!==t){this.videoMuted_=t;var n=e.getContext(this).node;t?n.classList.add("video--muted"):n.classList.remove("video--muted")}}},{key:"audioMuted",set:function(t){if(this.audioMuted_!==t){this.audioMuted_=t;var n=e.getContext(this).node;t?n.classList.add("audio--muted"):n.classList.remove("audio--muted")}}},{key:"streamId",get:function(){return this.streamId_},set:function(e){this.streamId_=e}},{key:"stream",get:function(){return this.stream_},set:function(t){if(this.stream_!==t){for(var n=e.getContext(this).node,i=this.player=n.querySelector(".agora-stream__player");i.childElementCount>0;)i.removeChild(i.firstElementChild);this.stream_&&this.stream_.isPlaying()&&this.stream_.player.div.parentNode===i&&this.stream_.stop(),this.stream_=t,t&&(this.videoMuted=t.userMuteVideo,this.audioMuted=t.userMuteAudio);var o=t?t.getId():null;if(this.streamId=o,o){var r="stream-"+o;i.setAttribute("id",r);var s=this;t.isPlaying()?i.appendChild(t.player.div):(this.shouldUseResumeGesture=!1,t.play(r,{fit:"cover"},(function(e){e&&"aborted"!==e.status&&(s.shouldUseResumeGesture=!0,s.pushChanges())})))}else i.removeAttribute("id")}}},{key:"vrContainer",set:function(e){this.vrContainer_!==e&&(this.vrContainer_=e,e?(this.stream_.vrContainer=e,this.player.appendChild(e)):this.stream_.vrContainer&&this.stream_.vrContainer.parentNode&&(this.stream_.vrContainer.parentNode.removeChild(this.stream_.vrContainer),this.stream_.vrContainer=null))}},{key:"videoNode",get:function(){var t=this.videoNode_;if(!t){var n=e.getContext(this).node.querySelector(".agora-stream__player");t=document.createElement("video"),this.onLoadedMetadata=this.onLoadedMetadata.bind(this),t.addEventListener("loadedmetadata",this.onLoadedMetadata),n.appendChild(t),this.videoNode_=t}return t}}]),i}(e.Component);xe.meta={selector:"[agora-stream]",outputs:["toggleSpy"],inputs:["stream"]};var Te="unknown",Re="ios",Se="android",Ce="windowsPhone",Ie=function(){function e(){}return e.getDevicePlatform=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return/windows phone/i.test(e)?Ce:/android/i.test(e)?Se:this.isIOS()?Re:Te},e.isIOS=function(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},l(e,null,[{key:"platform",get:function(){return this.platform_||(this.platform_=this.getDevicePlatform()),this.platform_}}]),e}();var ke=function(){function e(){}return e.push=function(e){return function(e){(window.dataLayer||[]).push(e),console.log("GtmService.dataLayer",e)}(e)},e}(),Me=function(e){this.data=e},$e=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(Me),Ae=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(Me),He=function(){function e(){}return e.open$=function(e){var t=this;return this.getTemplate$(e.src).pipe(n.map((function(n){return{node:t.getNode(n),data:e.data,modal:e}})),n.tap((function(e){return t.modal$.next(e)})),n.switchMap((function(e){return t.events$})))},e.load$=function(e){},e.getTemplate$=function(e){return i.from(fetch(e).then((function(e){return e.text()})))},e.getNode=function(e){var t=document.createElement("div");return t.innerHTML=e,t.firstElementChild},e.reject=function(e){this.modal$.next(null),this.events$.next(new Ae(e))},e.resolve=function(e){this.modal$.next(null),this.events$.next(new $e(e))},e}();He.modal$=new i.Subject,He.events$=new i.Subject;var Pe=function(t){function i(){return t.apply(this,arguments)||this}h(i,t);var o=i.prototype;return o.onInit=function(){var t=this,i=e.getContext(this).node;this.modalNode=i.querySelector(".modal-outlet__modal"),He.modal$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.modal=e}))},o.reject=function(e){He.reject()},l(i,[{key:"modal",get:function(){return this.modal_},set:function(t){var n=e.getContext(this).module;if(this.modal_&&this.modal_.node&&(n.remove(this.modal_.node,this),this.modalNode.removeChild(this.modal_.node)),t&&t.node){this.modal_=t,this.modalNode.appendChild(t.node);n.compile(t.node)}this.modal_=t,this.pushChanges()}}]),i}(e.Component);Pe.meta={selector:"[modal-outlet]",template:'\n\t<div class="modal-outlet__container" [class]="{ active: modal }">\n\t\t<div class="modal-outlet__background" (click)="reject($event)"></div>\n\t\t<div class="modal-outlet__modal"></div>\n\t</div>\n\t'};var Oe=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var i=n.prototype;return i.onInit=function(){t.prototype.onInit.call(this);var i=e.getContext(this),o=i.parentInstance,r=i.node;if(o instanceof Pe){var s=this.data=o.modal.data;if(s&&s.ar){var a=n.getUrl(s);new QRious({element:r.querySelector(".qrcode"),value:a,size:256})}}},i.close=function(){He.reject()},n.getUrl=function(e){var t=T.getAbsoluteUrl(T.template.tryInAr,{viewId:e.id});return console.log("TryInARModalComponent.getUrl",t),t},n.openInAR=function(e){var t=this.getUrl(e);window.open(t,"_blank")},n}(e.Component);Oe.meta={selector:"[try-in-ar-modal]"};var Ue={WaitingRoom:{id:1,name:"waiting-room"},Panorama:{id:2,name:"panorama"},PanoramaGrid:{id:3,name:"panorama-grid"},Room3d:{id:4,name:"room-3d"},Model:{id:5,name:"model"}},_e={Nav:{id:1,name:"nav"},Plane:{id:2,name:"plane"},CurvedPlane:{id:3,name:"curved-plane"},Gltf:{id:4,name:"gltf"},Texture:{id:5,name:"texture"}},Le=function(){function e(e){if(e&&(Object.assign(this,e),e.items)){var t=0;e.items.forEach((function(e,n){e.index=n,e.asset&&"nextAttendeeStream"===e.asset.file&&(e.asset.index=t++)}))}this.items=(this.items||[]).map((function(e){return Ne(e)})),this.tiles&&(this.tiles=this.tiles.map((function(e){return Be(e)}))),this.originalItems=this.items.slice()}return l(e,[{key:"payload",get:function(){var t=this,n={};return Object.keys(this).forEach((function(i){if(-1!==e.allowedProps.indexOf(i))switch(i){case"items":n[i]=t[i].map((function(e){return Ne(e).payload}));break;case"tiles":n[i]=t[i].map((function(e){return Be(e).payload}));break;default:n[i]=t[i]}})),n}},{key:"shortType",get:function(){return this.type?this.type.split("-").map((function(e){return e.substring(0,1).toUpperCase()})).join(""):"??"}}]),e}();c(Le,"allowedProps",["id","type","name","hidden","likes","asset","items","orientation","zoom","ar","tiles","invertAxes","flipAxes"]);var De=function(e){function t(t){return e.call(this,t)||this}return h(t,e),t}(Le),Ve=function(e){function t(n){var o;return n.tiles=t.mapTiles(n.tiles,n.flipAxes,n.invertAxes,n.asset?n.asset.folder:""),(o=e.call(this,n)||this).index_=0,o.index$=new i.Subject,o.tiles.forEach((function(e,t){return e.selected=0===t})),o.tiles.length&&(o.items=o.originalItems.concat(o.tiles[0].navs),o.asset=o.tiles[0].asset),o}h(t,e),t.mapTiles=function(e,t,n,i){void 0===e&&(e=[]),void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===i&&(i="");var o=t?-1:1;return e.map((function(e,t){var r=new THREE.Vector2;return(e="string"==typeof e?{id:t+1,asset:{folder:i,file:e},navs:[]}:e).asset.file.replace(/_x([-|\d]+)_y([-|\d]+)/g,(function(e,t,i){n?(r.y=parseInt(t),r.x=parseInt(i)*o):(r.x=parseInt(t),r.y=parseInt(i)*o)})),{id:e.id,asset:e.asset,navs:e.navs||[],indices:r}}))},l(t,[{key:"index",set:function(e){this.index_!==e&&(this.index_=e,this.tiles.forEach((function(t,n){return t.selected=n===e})),this.updateCurrentItems(),this.index$.next(e))},get:function(){return this.index_}}]);var n=t.prototype;return n.updateCurrentItems=function(){this.items=this.originalItems.concat(this.tiles[this.index_].navs)},n.getTileIndex=function(e,t){return this.tiles.reduce((function(n,i,o){return i.indices.x===e&&i.indices.y===t?o:n}),-1)},n.hasTile=function(e,t){return-1!==this.getTileIndex(e,t)},n.getTile=function(e,t){var n=this.getTileIndex(e,t);if(-1!==n)return this.index=n,this.tiles[n]},t}(Le),Fe=function(e){function t(t){return e.call(this,t)||this}return h(t,e),t}(Le),je=function(){function e(e){e&&Object.assign(this,e)}return l(e,[{key:"payload",get:function(){var t=this,n={};return Object.keys(this).forEach((function(i){-1!==e.allowedProps.indexOf(i)&&(n[i]=t[i])})),!n.link||n.link.title&&n.link.href||delete n.link,n}},{key:"hasPanel",get:function(){return this.type.name===_e.Nav.name&&(this.title&&""!==this.title||this.abstract&&""!==this.abstract||this.asset||this.link)}}]),e}();c(je,"allowedProps",["id","type","title","abstract","asset","link","viewId","keepOrientation","position","rotation","scale","radius","height","arc"]);var Ge=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(je),ze=function(){function e(e){e&&Object.assign(this,e),this.navs=(this.navs||[]).map((function(e){return Ne(e)})),this.originalItems=this.navs.slice()}return l(e,[{key:"payload",get:function(){var t=this,n={};return Object.keys(this).forEach((function(i){if(-1!==e.allowedProps.indexOf(i))switch(i){case"navs":n[i]=t[i].map((function(e){return Ne(e).payload}));break;default:n[i]=t[i]}})),n}}]),e}();function qe(e){switch(e.type.name){case Ue.Panorama.name:e=new De(e);break;case Ue.PanoramaGrid.name:e=new Ve(e);break;case Ue.Model.name:e=new Fe(e);break;default:e=new Le(e)}return e}function Ne(e){switch(e.type.name){case _e.Nav.name:e=new Ge(e);break;default:e=new je(e)}return e}function Be(e){return new ze(e)}c(ze,"allowedProps",["id","asset","navs"]);var We=function(){function e(){}return e.data$=function(){var e=T.STATIC?"./api/data.json":"/api/view";return R.get$(e).pipe(n.map((function(e){return e.views=e.views.map((function(e){return qe(e)})),e})))},e.view$=function(e){return this.data$().pipe(n.map((function(t){return t.views.find((function(t){return t.id===e}))})))},e.viewLike$=function(e){return e.liked?i.of(null):(e.liked=!0,T.STATIC?(e.likes=e.likes||0,e.likes++,i.of(e)):R.get$("/api/view/"+e.id+"/like"))},e}(),Ke="waiting",Xe="enabled",Ye="ended",Je="started",Ze="disabled",Qe="needs-https",et="unavailable",tt=function(){function e(){var t=this;if(e.service_)throw"VRService is a singleton class!";var n=this.state_={camera:{position:new THREE.Vector3,quaternion:new THREE.Quaternion,scale:new THREE.Vector3,array:new Array(10).fill(0)}};this.onSessionStarted=this.onSessionStarted.bind(this),this.onSessionEnded=this.onSessionEnded.bind(this),this.status$=new i.BehaviorSubject(Ke),this.session$=new i.Subject,this.state$=new i.BehaviorSubject(n),this.currentSession=null,"xr"in navigator?navigator.xr.isSessionSupported("immersive-vr").then((function(e){e?t.status$.next(Xe):t.status$.next(Ze)})):!1===window.isSecureContext?this.status$.next(Qe):this.status$.next(et)}e.getService=function(){return this.service_||(this.service_=new e),this.service_},l(e,[{key:"status",get:function(){return this.status$.getValue()}},{key:"state",get:function(){return this.state$.getValue()}}]);var t=e.prototype;return t.onSessionStarted=function(e){e.addEventListener("end",this.onSessionEnded),this.currentSession=e,this.session$.next(e),this.status$.next(Je)},t.onSessionEnded=function(){this.currentSession.removeEventListener("end",this.onSessionEnded),this.currentSession=null,this.session$.next(null),this.status$.next(Ye)},t.toggleVR=function(e){if(null===this.currentSession){navigator.xr.requestSession("immersive-vr",{optionalFeatures:["local-floor","bounded-floor"]}).then(this.onSessionStarted)}else this.currentSession.end()},t.isDisabled=function(){switch(this.status$.getValue()){case Ke:case Ze:case Qe:case et:return!0;default:return!1}},t.getLabel=function(){var e;switch(this.status$.getValue()){case Ke:e="Waiting VR";break;case Xe:case Ye:e="Enter VR";break;case Je:e="Exit VR";break;case Ze:e="VR Disabled";break;case Qe:e="VR Needs Https";break;case et:e="VR Unavailable"}return e},t.updateState=function(e){if(this.status===Je){e.renderer,e.scene;var t=e.camera,n=this.state_;t.matrixWorld.decompose(n.camera.position,n.camera.quaternion,n.camera.scale),n.camera.array[0]=n.camera.position.x,n.camera.array[1]=n.camera.position.y,n.camera.array[2]=n.camera.position.z,n.camera.array[3]=n.camera.quaternion.x,n.camera.array[4]=n.camera.quaternion.y,n.camera.array[5]=n.camera.quaternion.z,n.camera.array[6]=n.camera.quaternion.w,n.camera.array[7]=n.camera.scale.x,n.camera.array[8]=n.camera.scale.y,n.camera.array[9]=n.camera.scale.z,this.state$.next(n)}},e}(),nt=function(i){function o(){return i.apply(this,arguments)||this}h(o,i);var r=o.prototype;return r.onInit=function(){var t=this;e.getContext(this).node.classList.remove("hidden"),this.platform=Ie.platform,this.state={},this.data=null,this.views=null,this.view=null,this.form=null,this.local=null,this.remotes=[],(this.vrService=tt.getService()).status$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.pushChanges()})),this.resolveUser()},r.getLinkRole=function(){var e=null,t=(ye.get("link")||"").match(/\d{9}-(\d{4})-\d{13}/);if(t){var n=parseInt(t[1]);e=Object.keys(S).reduce((function(e,t,i){return i===n?S[t]:e}),null)}return e},r.resolveUser=function(){var e=this;I.me$().pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){var n=e.getLinkRole();!t||n&&n!==t.type?n===S.Publisher||n===S.Attendee?window.location.href=T.url.access:e.initWithUser({type:n}):e.initWithUser(t)}))},r.initWithUser=function(e){var t=this;console.log("AgoraComponent.initWithUser",e);var i=e.firstName&&e.lastName?e.firstName+" "+e.lastName:null,o=ye.get("role")||e.type,r=ye.get("name")||i,s=ye.get("link")||null,a=o===S.Publisher,u=!m&&o!==S.SelfService,l={user:e,role:o,name:r,link:s,channelName:T.channelName,uid:null,status:"idle",connecting:!1,connected:!1,locked:!1,control:!1,spyed:!1,hosted:a,live:u,cameraMuted:!1,audioMuted:!1};A.state=l,A.state$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.state=e,t.hosted=e.hosted,t.pushChanges()})),this.loadData()},r.loadData=function(){var e=this;We.data$().pipe(n.first()).subscribe((function(t){e.data=t,e.initAgora(),e.initForm()}))},r.initAgora=function(){var e,t=this,i=null;m||this.state.role===S.SelfService?A.patchState({status:j,hosted:!0}):(i=this.agora=ge.getSingleton(),e=this.state.link?this.state.name?this.state.role!==S.Viewer?D:V:L:_,A.patchState({status:e}));O.local$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.local=e,t.pushChanges()})),O.remotes$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.remotes=e,t.pushChanges()})),P.out$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){switch(e.type){case K:e.type=X,e.clientInfo={role:A.state.role,name:A.state.name,uid:A.state.uid},P.sendBack(e);break;case z:e.type=q,P.sendBack(e),A.patchState({locked:!0});break;case Y:A.patchState({spyed:!0});break;case J:console.log("AgoraComponent.RequestInfoResult",t.controls.view.value,e.viewId),t.controls.view.value!==e.viewId&&(t.controls.view.value=e.viewId);break;case oe:if(e.viewId&&t.controls.view.value!==e.viewId&&(t.controls.view.value=e.viewId,void 0!==e.gridIndex)){var n=t.data.views.find((function(t){return t.id===e.viewId}));n instanceof Ve&&(n.index=e.gridIndex)}}})),P.in$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){i&&i.sendMessage(e)})),i&&A.state.status===V&&this.connect()},r.initForm=function(){var e=this,i=this.data,o=this.views=i.views.filter((function(e){return"waiting-room"!==e.type.name})),r=ye.has("viewId")?parseInt(ye.get("viewId")):o[0].id,s=this.form=new t.FormGroup({view:new t.FormControl(r,t.Validators.RequiredValidator())});(this.controls=s.controls).view.options=o,s.changes$.pipe(n.takeUntil(this.unsubscribe$),n.map((function(t){var n=i.views.find((function(e){return e.id===t.view}));return e.view=null,e.pushChanges(),n})),n.delay(1),n.map((function(t){var n=e.getWaitingRoom();e.state.hosted?e.agora&&e.agora.navToView(t.id):t=n,e.view=t,e.pushChanges(),t.id!==n.id&&ye.set("viewId",t.id)}))).subscribe(console.log)},r.getWaitingRoom=function(){return this.data&&this.data.views.find((function(e){return"waiting-room"===e.type.name}))||{id:"waiting-room",type:{id:1,name:"waiting-room"},name:"Waiting Room",likes:40,liked:!1,asset:{type:{id:1,name:"image"},folder:"waiting-room/",file:"waiting-room-02.jpg"},items:[],orientation:{latitude:0,longitude:0}}},r.onLink=function(e){A.state.name?A.state.role===S.Viewer?this.connect():A.patchState({link:e,status:D}):A.patchState({link:e,status:L})},r.onName=function(e){A.state.role===S.Viewer?this.connect():A.patchState({name:e,status:D})},r.onEnter=function(e){this.connect(e)},r.connect=function(e){if(this.agora.connect$(e).pipe(n.takeUntil(this.unsubscribe$)).subscribe(),this.state.role!==S.SelfService){var t=this.state.link.replace(/-\d+-/,"-"),i={meetingId:this.state.link,sharedMeetingId:t,fullName:this.state.name,userType:this.state.role};I.log$(i).pipe(n.first()).subscribe(),ke.push({action:"b-here-meeting",meetingId:this.state.link,sharedMeetingId:t,userType:this.state.role})}},r.disconnect=function(){this.agora?this.agora.leaveChannel().then((function(){window.location.href=window.location.href}),console.log):this.patchState({connecting:!1,connected:!1})},r.onSlideChange=function(e){P.send({type:te,index:e})},r.onNavTo=function(e){this.controls.view.value!==e&&(this.controls.view.value=e)},r.onRemoteControlRequest=function(e){var t=this;He.open$({src:T.template.modal.controlRequest,data:null}).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(n){m?n instanceof $e?t.patchState({control:!0,spying:!1}):t.patchState({control:!1,spying:!1}):(n instanceof $e?(e.type=q,t.state.locked=!0):(e.type=N,t.state.locked=!1),P.sendBack(e),t.pushChanges())}))},r.patchState=function(e){this.state=Object.assign({},this.state,e),this.pushChanges()},r.toggleCamera=function(){this.agora?this.agora.toggleCamera():this.patchState({cameraMuted:!this.state.cameraMuted})},r.toggleAudio=function(){this.agora?this.agora.toggleAudio():this.patchState({audioMuted:!this.state.audioMuted})},r.onToggleControl=function(){this.agora?this.agora.toggleControl():this.state.control?this.patchState({control:!1}):this.onRemoteControlRequest({})},r.onToggleSpy=function(e){this.agora?this.agora.toggleSpy(e):this.patchState({spying:!this.state.spying,control:!1})},r.addToWishlist=function(){var e=this;We.viewLike$(this.view).pipe(n.first()).subscribe((function(t){t&&(Object.assign(e.view,t),e.pushChanges())}))},r.tryInAr=function(){this.platform===Re||this.platform===Se?Oe.openInAR(this.view):He.open$({src:T.template.modal.tryInAr,data:this.view}).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){}))},l(o,[{key:"hosted",get:function(){return this.hosted_},set:function(e){var t=this;if(this.hosted_!==e&&(this.hosted_=e,this.data&&this.controls))if(e){var n=this.data.views.find((function(e){return e.id===t.controls.view.value}));this.view=n}else this.view=this.getWaitingRoom()}}]),o}(e.Component);nt.meta={selector:"[agora-component]"};var it=function(t){function n(){return t.apply(this,arguments)||this}return h(n,t),n.prototype.onInit=function(){e.getContext(this).node.classList.remove("hidden")},n}(e.Component);it.meta={selector:"[app-component]"};var ot=["jpeg","jpg","png"],rt=["mp4","webm"],st=["fbx","gltf","glb","usdz"],at={Image:{id:1,name:"image"},Video:{id:2,name:"video"},Model:{id:3,name:"model"},PublisherStream:{id:4,name:"publisher-stream"},NextAttendeeStream:{id:5,name:"next-attendee-stream"}},ut={ImageOrVideo:{id:1,name:"Image or Video",ids:[1,2]},Publisher:{id:3,name:"Publisher",ids:[4]},Attendee:{id:4,name:"Attendee",ids:[5]}};function lt(e){var t;return e&&e.asset&&(t=Object.keys(ut).find((function(t){return-1!==ut[t].ids.indexOf(e.asset.type.id)}))),ut[t||"ImageOrVideo"]}function ct(e){var t=e.split(".").pop().toLowerCase();return-1!==ot.indexOf(t)?at.Image:-1!==rt.indexOf(t)?at.Video:-1!==st.indexOf(t)?at.Model:void 0}var dt=function(){function e(e){e&&Object.assign(this,e)}return e.fromUrl=function(t){var n=t.split("/"),i=n.pop(),o=n.join("/")+"/";return new e({type:ct(i),folder:o,file:i})},l(e,[{key:"payload",get:function(){var t=this,n={};return Object.keys(this).forEach((function(i){-1!==e.allowedProps.indexOf(i)&&(n[i]=t[i])})),n}}]),e}();function ht(e){return e.type,e=new dt(e)}c(dt,"allowedProps",["id","type","folder","file","linkedPlayId","chromaKeyColor"]);var pt=["bmp","gif","ico","jpeg","jpg","png","svg","tif","tiff","webp"],ft=["mp4","avi","mpeg","ogv","ts","webm","3gp","3g2"],mt=["fbx","gltf","glb","obj","usdz"],vt=["publisherStream","nextAttendeeStream"];var gt=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.transform=function(e,t){if(void 0===t&&(t=null),null!=t&&(e=e.type.name===t?e:null),e){switch(e.type.name){case at.Image.name:case at.Video.name:case at.Model.name:e=e.folder+e.file,e=T.getPath(e);break;case at.PublisherStream.name:case at.NextAttendeeStream.name:e=T.getPath(e.file);break;default:n=e.file,new RegExp("/.("+pt.join("|")+")$/i").test(n)||function(e){return new RegExp("/.("+ft.join("|")+")$/i").test(e)}(e.file)?(e=e.folder+e.file,e=T.getPath(e)):!function(e){return new RegExp("/.("+mt.join("|")+")$/i").test(e)}(e.file)?function(e){return-1!==vt.indexOf(e)}(e.file)&&(e=e.file):(e=e.folder+e.file,e=T.getPath(e))}e=e}else e=null;var n;return e},t}(e.Pipe);gt.meta={name:"asset"};var bt=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var i=n.prototype;return i.onInit=function(){t.prototype.onInit.call(this);var n=e.getContext(this).parentInstance;n instanceof Pe&&(this.data=n.modal.data)},i.onAccept=function(e){He.resolve()},i.onReject=function(e){He.reject()},i.close=function(){He.reject()},n}(e.Component);bt.meta={selector:"[control-request-modal]"};var yt=function(t){function o(){return t.apply(this,arguments)||this}return h(o,t),o.prototype.onInit=function(){var t=e.getContext(this),o=t.module,r=t.node,s=t.parentInstance,a=(t.selector,"drop"),u=i.fromEvent(r,a).pipe(n.shareReplay(1)),l=r.getAttribute("(drop)");if(l){var c=o.makeFunction(l,["$event"]);u.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){o.resolve(c,s,e)})),i.fromEvent(r,"dragover").pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){return e.preventDefault()}))}else s.drop$=u},o}(e.Directive);yt.meta={selector:"[(drop)]"};var wt=1e6,Et=function(t){function i(){return t.apply(this,arguments)||this}h(i,t);var o=i.prototype;return o.onInit=function(){var t=this,o=e.getContext(this).node,r=o.getAttribute("dropdown-trigger");this.trigger=r?o.querySelector(r):o,this.opened=null,this.onClick=this.onClick.bind(this),this.onDocumentClick=this.onDocumentClick.bind(this),this.openDropdown=this.openDropdown.bind(this),this.closeDropdown=this.closeDropdown.bind(this),this.addListeners(),i.dropdown$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.id===e?o.classList.add("dropped"):o.classList.remove("dropped")}))},o.onClick=function(t){var n=e.getContext(this).node;null===this.opened?this.openDropdown():n.querySelector("[dropdown-item]")||this.closeDropdown()},o.onDocumentClick=function(t){var n=e.getContext(this).node;n===t.target||n.contains(t.target)||this.closeDropdown()},o.openDropdown=function(){null===this.opened&&(this.opened=!0,this.addDocumentListeners(),i.dropdown$.next(this.id),this.dropped.next(this.id))},o.closeDropdown=function(){null!==this.opened&&(this.removeDocumentListeners(),this.opened=null,i.dropdown$.getValue()===this.id&&(i.dropdown$.next(null),this.dropped.next(null)))},o.addListeners=function(){this.trigger.addEventListener("click",this.onClick)},o.addDocumentListeners=function(){document.addEventListener("click",this.onDocumentClick)},o.removeListeners=function(){this.trigger.removeEventListener("click",this.onClick)},o.removeDocumentListeners=function(){document.removeEventListener("click",this.onDocumentClick)},o.onDestroy=function(){this.removeListeners(),this.removeDocumentListeners()},i.nextId=function(){return wt++},l(i,[{key:"id",get:function(){return this.dropdown||this.id_||(this.id_=i.nextId())}}]),i}(e.Directive);Et.meta={selector:"[dropdown]",inputs:["dropdown","dropdown-trigger"],outputs:["dropped"]},Et.dropdown$=new i.BehaviorSubject(null);var xt=function(t){function i(){return t.apply(this,arguments)||this}return h(i,t),i.prototype.onInit=function(){var t=this,i=e.getContext(this).node;i.classList.add("dropdown-item"),Et.dropdown$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.id===e?i.classList.add("dropped"):i.classList.remove("dropped")}))},l(i,[{key:"id",get:function(){return this["dropdown-item"]}}]),i}(e.Directive);xt.meta={selector:"[dropdown-item], [[dropdown-item]]",inputs:["dropdown-item"]};var Tt=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}((function(e){this.toast=e})),Rt=function(){function e(){}return e.open$=function(e){var t=this;return e.id=(new Date).getTime(),this.toast$.next(e),setTimeout((function(){t.resolve(e)}),e.duration||3e3),this.events$},e.resolve=function(e){this.toast$.next(null),this.events$.next(new Tt(e))},e}();Rt.toast$=new i.Subject,Rt.events$=new i.Subject;var St,Ct=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.prototype.onInit=function(){var e=this;this.toast=null,this.lastMessage="",Rt.toast$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){t&&(e.lastMessage=t.message),e.toast=t,e.pushChanges()}))},t}(e.Component);Ct.meta={selector:"[toast-outlet]",template:'\n\t<div class="toast-outlet__container" [class]="{ active: toast }">\n\t\t<div class="toast-outlet__toast" [innerHTML]="lastMessage"></div>\n\t</div>\n\t'};var It=((St={image:"Image",video:"Video",model:"Model","publisher-stream":"Publisher Stream","next-attendee-stream":"Next Attendee Stream","waiting-room":"Waiting Room",panorama:"Panorama","panorama-grid":"Panorama Grid","room-3d":"Room 3D"}).model="Model",St.nav="Nav Tooltip",St.gltf="Gltf Model",St.plane="Plane",St["curved-plane"]="Curved Plane",St.texture="Texture",St),kt=[Ue.WaitingRoom.name,Ue.Room3d.name,Ue.Model.name],Mt=[_e.Gltf.name,_e.Texture.name],$t=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var n=t.prototype;return n.onInit=function(){this.mode=1,this.viewTypes=Object.keys(Ue).map((function(e){var t=Ue[e];return{type:t,name:It[t.name],disabled:-1!==kt.indexOf(t.name)}})),this.viewItemTypes=Object.keys(_e).map((function(e){var t=_e[e];return{type:t,name:It[t.name],disabled:-1!==Mt.indexOf(t.name)}})),this.setSupportedViewTypes(),this.setSupportedViewItemTypes()},n.onChanges=function(){this.setSupportedViewTypes(),this.setSupportedViewItemTypes()},n.setSupportedViewTypes=function(){var e=this;this.supportedViewTypes=this.viewTypes.filter((function(t){return e.supportedViewType(t.type.name)}))},n.setSupportedViewItemTypes=function(){var e=this;this.view?this.supportedViewItemTypes=this.viewItemTypes.filter((function(t){return e.supportedViewItemType(e.view.type.name,t.type.name)})):this.supportedViewItemTypes=[]},n.setMode=function(e){this.mode!==e&&(this.mode=e,this.pushChanges())},n.supportedViewType=function(e){return-1!==[Ue.Panorama.name,Ue.PanoramaGrid.name,Ue.Room3d.name,Ue.Model.name].indexOf(e)},n.supportedViewItemType=function(e,t){var n;switch(e){case Ue.WaitingRoom.name:n=!1;break;case Ue.Panorama.name:case Ue.PanoramaGrid.name:n=-1!==[_e.Nav.name,_e.Gltf.name,_e.Plane.name,_e.CurvedPlane.name].indexOf(t);break;case Ue.Room3d.name:n=-1!==[_e.Nav.name,_e.Gltf.name,_e.Texture.name].indexOf(t);break;case Ue.Model.name:n=-1!==[_e.Nav.name,_e.Gltf.name,_e.Plane.name,_e.CurvedPlane.name].indexOf(t)}return n},n.onSelect=function(e){this.select.next(e)},n.onUpdate=function(e){this.update.next(e)},n.onDelete=function(e){this.delete.next(e)},t}(e.Component);$t.meta={selector:"[aside]",outputs:["select","update","delete"],inputs:["view"]};var At=function(){function e(){}return e.data$=function(){return R.get$("/api/view").pipe(n.map((function(e){return e.views=e.views.map((function(e){return qe(e)})),e})))},e.viewIdOptions$=function(){return this.data$().pipe(n.map((function(e){var t=e.views.map((function(e){return{id:e.id,name:e.name}}));return t.unshift({id:null,name:"Select"}),t})))},e.viewCreate$=function(e){return R.post$("/api/view",e).pipe(n.map((function(e){return qe(e)})))},e.viewUpdate$=function(e){return R.put$("/api/view/"+e.id,e.payload).pipe(n.map((function(e){return qe(e)})))},e.viewDelete$=function(e){return R.delete$("/api/view/"+e.id)},e.getTile=function(e){var t;return e.type.name===Ue.PanoramaGrid.name&&(t=e.tiles[e.index]),t},e.inferItemCreate$=function(e,t){var n=this.getTile(e);return n?this.tileItemCreate$(e,n,t):this.itemCreate$(e,t)},e.inferItemUpdate$=function(e,t){var n=this.getTile(e);return n?this.tileItemUpdate$(e,n,t):this.itemUpdate$(e,t)},e.inferItemDelete$=function(e,t){var n=this.getTile(e);return n?this.tileItemDelete$(e,n,t):this.itemDelete$(e,t)},e.inferItemUpdateResult$=function(e,t){var n,i=this.getTile(e);(n=i?i.navs.find((function(e){return e.id===t.id})):e.items.find((function(e){return e.id===t.id})))&&Object.assign(n,t)},e.inferItemDeleteResult$=function(e,t){var n,i=this.getTile(e);if(n=i?i.navs:e.items){var o=n.indexOf(t);-1!==o&&n.splice(o,1),i&&e.updateCurrentItems()}},e.itemCreate$=function(e,t){return R.post$("/api/view/"+e.id+"/item",t).pipe(n.map((function(e){return Ne(e)})))},e.itemUpdate$=function(e,t){return R.put$("/api/view/"+e.id+"/item/"+t.id,t.payload).pipe(n.map((function(e){return Ne(e)})))},e.itemDelete$=function(e,t){return R.delete$("/api/view/"+e.id+"/item/"+t.id)},e.tileItemCreate$=function(e,t,i){return R.post$("/api/view/"+e.id+"/tile/"+t.id+"/item",i).pipe(n.map((function(e){return Ne(e)})))},e.tileItemUpdate$=function(e,t,i){return R.put$("/api/view/"+e.id+"/tile/"+t.id+"/item/"+i.id,i.payload).pipe(n.map((function(e){return Ne(e)})))},e.tileItemDelete$=function(e,t,n){return R.delete$("/api/view/"+e.id+"/tile/"+t.id+"/item/"+n.id)},e}(),Ht=function(o){function r(){return o.apply(this,arguments)||this}h(r,o);var s=r.prototype;return s.onInit=function(){var t=this;e.getContext(this).node.classList.remove("hidden"),this.aside=!1,this.state={},this.data=null,this.views=null,this.view=null,this.form=null,this.local=null,this.remotes=[],this.viewHit=new i.Subject,(this.vrService=tt.getService()).status$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.pushChanges()})),this.resolveUser()},s.resolveUser=function(){var e=this;I.me$().pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){t&&t.type===S.Publisher?(e.user=t,e.initState()):window.location.href=T.url.access}))},s.initState=function(){var e=this,t=this.user,i={user:t,role:t.type,name:t.firstName&&t.lastName?t.firstName+" "+t.lastName:null,link:null,channelName:T.channelName,uid:null,status:j,connecting:!1,connected:!0,locked:!1,control:!1,spyed:!1,hosted:!0,live:!1,cameraMuted:!1,audioMuted:!1};A.state=i,A.state$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t,e.hosted=t.hosted,e.pushChanges()})),this.loadData(),this.getUserMedia()},s.getUserMedia=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var e=document.querySelector("body"),t=document.createElement("div"),n=document.createElement("video");t.setAttribute("id","stream-editor"),t.setAttribute("style","position:absolute; top: 5000px; line-height: 0;"),t.appendChild(n),e.appendChild(t),navigator.mediaDevices.getUserMedia({video:{width:800,height:450}}).then((function(e){"srcObject"in n?n.srcObject=e:n.src=window.URL.createObjectURL(e),n.play();var t={getId:function(){return"editor"},clientInfo:{role:S.Publisher}},i={getId:function(){return"editor"},clientInfo:{role:S.Attendee}};O.editor=[t,i,i,i,i]})).catch((function(e){console.log("EditorComponent.getUserMedia.error",e.name,e.message)}))}},s.loadData=function(){var e=this;At.data$().pipe(n.first()).subscribe((function(t){e.data=t,e.initForm()}))},s.initForm=function(){var e=this,i=this.data,o=this.views=i.views.slice(),r=ye.has("viewId")?parseInt(ye.get("viewId")):o[0].id,s=this.form=new t.FormGroup({view:new t.FormControl(r,t.Validators.RequiredValidator())});(this.controls=s.controls).view.options=o,s.changes$.pipe(n.takeUntil(this.unsubscribe$),n.map((function(t){var n=i.views.find((function(e){return e.id===t.view}));return e.view=null,e.pushChanges(),n})),n.delay(1),n.map((function(t){var n=e.getWaitingRoom();e.view=t,e.pushChanges(),t.id!==n.id&&ye.set("viewId",t.id)}))).subscribe(console.log)},s.getWaitingRoom=function(){return this.data&&this.data.views.find((function(e){return"waiting-room"===e.type.name}))||{id:"waiting-room",type:{id:1,name:"waiting-room"},name:"Waiting Room",likes:40,liked:!1,asset:{type:{id:1,name:"image"},folder:"waiting-room/",file:"waiting-room-02.jpg"},items:[],orientation:{latitude:0,longitude:0}}},s.onNavTo=function(e){this.data.views.find((function(t){return t.id===e}))&&this.controls.view.value!==e&&(this.controls.view.value=e)},s.onRemoteControlRequest=function(e){var t=this;He.open$({src:T.template.modal.controlRequest,data:null}).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){e instanceof $e?t.patchState({control:!0,spying:!1}):t.patchState({control:!1,spying:!1})}))},s.patchState=function(e){this.state=Object.assign({},this.state,e),this.pushChanges()},s.tryInAr=function(){He.open$({src:T.template.modal.tryInAr,data:this.view}).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){}))},s.replaceUrl=function(){if("history"in window){var e=new URLSearchParams(window.location.search),t=e.get("debug")||null,n=e.get("editor")||null,i=e.get("role")||null,o=e.get("link")||null,r=e.get("name")||null,s=""+window.location.origin+window.location.pathname+"?link="+o+(r?"&name="+r:"")+(i?"&role="+i:"")+(t?"&debug":"")+(n?"&editor":"");window.history.replaceState({pageTitle:window.pageTitle},"",s)}},s.onToggleAside=function(){this.aside=!this.aside,this.pushChanges(),window.dispatchEvent(new Event("resize"))},s.onViewHit=function(e){console.log("onViewHit"),this.viewHit.next(e)},s.onViewHitted=function(e){this.viewHitSubscription&&(this.viewHitSubscription.unsubscribe(),this.viewHitSubscription=null),"function"==typeof e&&(this.viewHitSubscription=this.viewHit.pipe(n.first()).subscribe((function(t){return e(t)})))},s.onDragEnd=function(e){var t=this;At.inferItemUpdate$(this.view,e.item).pipe(n.first()).subscribe((function(e){t.pushChanges()}),(function(e){return console.log("EditorComponent.onDragEnd.inferItemUpdate$.error",e)}))},s.onResizeEnd=function(e){console.log("EditorComponent.onResizeEnd")},s.onWorldSelect=function(e){this.view.items.forEach((function(e){return e.showPanel=!1})),this.view.items.forEach((function(t){return t.selected=t===e.item})),this.view.selected=void 0===this.view.items.find((function(e){return e.selected})),this.pushChanges()},s.onOpenModal=function(e,t){var i=this;He.open$({src:T.template.modal[e.type][e.value],data:t}).pipe(n.first()).subscribe((function(t){if(t instanceof $e)switch(console.log("EditorComponent.onOpenModal.resolve",t),e.value){case _e.Nav.name:case _e.Plane.name:case _e.CurvedPlane.name:var n=At.getTile(i.view);if(n){var o=n.navs||[];o.push(t.data),Object.assign(n,{navs:o}),i.view.updateCurrentItems()}else{var r=i.view.items||[];r.push(t.data),Object.assign(i.view,{items:r})}i.pushChanges();break;case Ue.Panorama.name:case Ue.PanoramaGrid.name:i.data.views.push(t.data),i.controls.view.value=t.data.id,i.pushChanges()}i.pushChanges()}))},s.onAsideSelect=function(e){var t=this;if(console.log("onAsideSelect",e),e.value)switch(e.value){case _e.Nav.name:case _e.Plane.name:case _e.CurvedPlane.name:this.onViewHitted((function(n){t.onOpenModal(e,{view:t.view,position:n})})),Rt.open$({message:"Click a point on the view"});break;default:this.onOpenModal(e,{view:this.view})}else if(e.view&&(e.item||null===e.item))e.view.selected=!1,e.view.items.forEach((function(t){return t.selected=t===e.item})),this.pushChanges();else if(e.view&&(e.tile||null===e.tile))e.view.selected=!1,e.view.tiles.forEach((function(t){return t.selected=t===e.tile})),this.pushChanges();else if(e.view||null===e.view){this.view.selected=this.view===e.view,this.view.items.forEach((function(e){return e.selected=!1}));var n=At.getTile(this.view);n&&this.view.tiles.forEach((function(e){return e.selected=e===n})),this.pushChanges()}},s.onAsideUpdate=function(e){var t=this;e.item&&e.view?At.inferItemUpdate$(e.view,e.item).pipe(n.first()).subscribe((function(n){At.inferItemUpdateResult$(e.view,e.item),t.pushChanges()}),(function(e){return console.log("EditorComponent.onAsideUpdate.inferItemUpdate$.error",e)})):e.tile&&e.view||e.view&&At.viewUpdate$(e.view).pipe(n.first()).subscribe((function(n){var i=t.view.asset.id!==e.view.asset.id;Object.assign(t.view,e.view),i?t.controls.view.value=e.view.id:t.pushChanges()}),(function(e){return console.log("EditorComponent.onAsideUpdate.viewUpdate$.error",e)}))},s.onAsideDelete=function(e){var t=this;console.log("onAsideDelete",e),e.item&&e.view?At.inferItemDelete$(e.view,e.item).pipe(n.first()).subscribe((function(n){At.inferItemDeleteResult$(e.view,e.item),t.pushChanges()}),(function(e){return console.log("EditorComponent.onAsideDelete.inferItemDelete$.error",e)})):e.view&&At.viewDelete$(e.view).pipe(n.first()).subscribe((function(n){var i=t.data.views.indexOf(e.view);-1!==i&&t.data.views.splice(i,1),t.views=t.data.views.slice(),t.controls.view.value=t.views[0].id}),(function(e){return console.log("EditorComponent.onAsideDelete.viewDelete$.error",e)}))},l(r,[{key:"hosted",get:function(){return this.hosted_},set:function(e){var t=this;if(this.hosted_!==e&&(this.hosted_=e,this.data&&this.controls))if(e){var n=this.data.views.find((function(e){return e.id===t.controls.view.value}));this.view=n}else this.view=this.getWaitingRoom()}}]),r}(e.Component);Ht.meta={selector:"[editor-component]"};var Pt=function(i){function o(){return i.apply(this,arguments)||this}h(o,i);var r=o.prototype;return r.onInit=function(){var e=this,n=new THREE.Object3D;n.position.copy(this.position),n.lookAt(o.ORIGIN);var i=this.form=new t.FormGroup({type:_e.CurvedPlane,position:new t.FormControl(this.position.multiplyScalar(20).toArray(),t.RequiredValidator()),rotation:new t.FormControl(n.rotation.toArray(),t.RequiredValidator()),scale:new t.FormControl([1,1,1],t.RequiredValidator()),radius:new t.FormControl(35,t.RequiredValidator()),height:new t.FormControl(20,t.RequiredValidator()),arc:new t.FormControl(90,t.RequiredValidator()),asset:null});this.controls=i.controls,i.changes$.subscribe((function(t){e.pushChanges()}))},r.onSubmit=function(){if(this.form.valid){var e=Object.assign({},this.form.value);console.log("CurvedPlaneModalComponent.onSubmit",this.view,e),At.inferItemCreate$(this.view,e).pipe(n.first()).subscribe((function(e){console.log("CurvedPlaneModalComponent.onSubmit.success",e),He.resolve(e)}),(function(e){return console.log("CurvedPlaneModalComponent.onSubmit.error",e)}))}else this.form.touched=!0},r.close=function(){He.reject()},l(o,[{key:"data",get:function(){var t=null,n=e.getContext(this).parentInstance;return n instanceof Pe&&(t=n.modal.data),t}},{key:"view",get:function(){var e=null,t=this.data;return t&&(e=t.view),e}},{key:"position",get:function(){var e=null,t=this.data;return t&&(e=t.position),e}}]),o}(e.Component);Pt.ORIGIN=new THREE.Vector3,Pt.meta={selector:"[curved-plane-modal]"};var Ot=function(i){function o(){return i.apply(this,arguments)||this}h(o,i);var r=o.prototype;return r.onInit=function(){var e=this;this.error=null;var i=this.form=new t.FormGroup({type:_e.Nav,title:null,abstract:null,viewId:new t.FormControl(null,t.RequiredValidator()),position:this.position.toArray(),asset:null,link:new t.FormGroup({title:new t.FormControl(null),href:new t.FormControl(null),target:"_blank"})});this.controls=i.controls,i.changes$.subscribe((function(t){e.pushChanges()})),At.viewIdOptions$().pipe(n.first()).subscribe((function(t){e.controls.viewId.options=t,e.pushChanges()}))},r.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=Object.assign({},this.form.value);t.viewId=parseInt(t.viewId),!t.link||t.link.title&&t.link.href||(t.link=null),At.inferItemCreate$(this.view,t).pipe(n.first()).subscribe((function(e){console.log("NavModalComponent.onSubmit.success",e),He.resolve(e)}),(function(t){console.log("NavModalComponent.onSubmit.error",t),e.error=t,e.form.submitted=!1}))}else this.form.touched=!0},r.close=function(){He.reject()},l(o,[{key:"data",get:function(){var t=null,n=e.getContext(this).parentInstance;return n instanceof Pe&&(t=n.modal.data),t}},{key:"view",get:function(){var e=null,t=this.data;return t&&(e=t.view),e}},{key:"position",get:function(){var e=null,t=this.data;return t&&(e=t.position),e}}]),o}(e.Component);Ot.meta={selector:"[nav-modal]"};var Ut=function(e){function i(){return e.apply(this,arguments)||this}h(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.error=null;var n=this.form=new t.FormGroup({type:Ue.PanoramaGrid,name:new t.FormControl(null,t.RequiredValidator()),assets:new t.FormControl(null,t.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(t){e.pushChanges()}))},o.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0,console.log("PanoramaGridModalComponent.onSubmit",this.form.value);var t=this.form.value.assets,i=Ve.mapTiles(t.map((function(e){return{asset:e,navs:[]}})),!1,!0);i.sort((function(e,t){return 1e4*e.indices.x+e.indices.y-(1e4*t.indices.x+t.indices.y)})),console.log("PanoramaGridModalComponent.onSubmit",i);var o=i[0].asset,r={type:this.form.value.type,name:this.form.value.name,asset:o,tiles:i,invertAxes:!0,flipAxes:!1,orientation:{latitude:0,longitude:0},zoom:75};At.viewCreate$(r).pipe(n.first()).subscribe((function(e){console.log("PanoramaGridModalComponent.onSubmit.success",e),He.resolve(e)}),(function(t){console.log("PanoramaGridModalComponent.onSubmit.error",t),e.error=t,e.form.reset()}))}else this.form.touched=!0},o.close=function(){He.reject()},i}(e.Component);Ut.meta={selector:"[panorama-grid-modal]"};var _t=function(e){function i(){return e.apply(this,arguments)||this}h(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.error=null;var n=this.form=new t.FormGroup({type:Ue.Panorama,name:new t.FormControl(null,t.RequiredValidator()),asset:new t.FormControl(null,t.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(t){e.pushChanges()}))},o.onSubmit=function(){var e=this;if(this.form.valid){this.form.submitted=!0;var t=this.form.value,i={type:t.type,name:t.name,asset:t.asset,orientation:{latitude:0,longitude:0},zoom:75};return console.log("PanoramaModalComponent.onSubmit.view",i),At.viewCreate$(i).pipe(n.first()).subscribe((function(e){console.log("PanoramaModalComponent.onSubmit.success",e),He.resolve(e)}),(function(t){console.log("PanoramaModalComponent.onSubmit.error",t),e.error=t,e.form.reset()}))}this.form.touched=!0},o.close=function(){He.reject()},i}(e.Component);_t.meta={selector:"[panorama-modal]"};var Lt=function(i){function o(){return i.apply(this,arguments)||this}h(o,i);var r=o.prototype;return r.onInit=function(){var e=this,n=new THREE.Object3D;n.position.copy(this.position),n.lookAt(o.ORIGIN);var i=this.form=new t.FormGroup({type:_e.Plane,position:new t.FormControl(this.position.multiplyScalar(20).toArray(),t.RequiredValidator()),rotation:new t.FormControl(n.rotation.toArray(),t.RequiredValidator()),scale:new t.FormControl([3.2,1.8,1],t.RequiredValidator()),asset:null});this.controls=i.controls,i.changes$.subscribe((function(t){e.pushChanges()}))},r.onSubmit=function(){if(this.form.valid){var e=Object.assign({},this.form.value);console.log("PlaneModalComponent.onSubmit",this.view,e),At.inferItemCreate$(this.view,e).pipe(n.first()).subscribe((function(e){console.log("PlaneModalComponent.onSubmit.success",e),He.resolve(e)}),(function(e){return console.log("PlaneModalComponent.onSubmit.error",e)}))}else this.form.touched=!0},r.close=function(){He.reject()},l(o,[{key:"data",get:function(){var t=null,n=e.getContext(this).parentInstance;return n instanceof Pe&&(t=n.modal.data),t}},{key:"view",get:function(){var e=null,t=this.data;return t&&(e=t.view),e}},{key:"position",get:function(){var e=null,t=this.data;return t&&(e=t.position),e}}]),o}(e.Component);Lt.ORIGIN=new THREE.Vector3,Lt.meta={selector:"[plane-modal]"};var Dt=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var i=n.prototype;return i.onRemove=function(){He.resolve()},i.onCancel=function(){He.reject()},i.close=function(){He.reject()},l(n,[{key:"data",get:function(){var t=null,n=e.getContext(this).parentInstance;return n instanceof Pe&&(t=n.modal.data),t}},{key:"item",get:function(){var e=null,t=this.data;return t&&(e=t.item),e}}]),n}(e.Component);Dt.meta={selector:"[remove-modal]"};var Vt=function(){function e(){}return e.assetCreate$=function(e){return R.post$("/api/asset",e).pipe(n.map((function(e){return ht(e)})))},e.assetUpdate$=function(e){return R.put$("/api/asset/"+e.id,e).pipe(n.map((function(e){return ht(e)})))},e.assetDelete$=function(e){return e&&e.id?R.delete$("/api/asset/"+e.id).pipe(n.map((function(){return null}))):i.of(null)},e.upload$=function(e){var t=new FormData;e.forEach((function(e){return t.append("file",e,e.name)}));var o=new XMLHttpRequest,r=i.merge(i.fromEvent(o.upload,"loadstart"),i.fromEvent(o.upload,"progress"),i.fromEvent(o.upload,"load"),i.fromEvent(o,"readystatechange")).pipe(n.map((function(e){switch(e.type){case"readystatechange":return 4===o.readyState?JSON.parse(o.responseText):null;default:return null}})),n.filter((function(e){return null!==e})));return o.open("POST","/api/upload/",!0),o.send(t),r},e}(),Ft=function(e){function o(){return e.apply(this,arguments)||this}h(o,e);var r=o.prototype;return r.onInit=function(){var e=this;this.active=!1;var n=this.form=new t.FormGroup;this.controls=n.controls;var i=this.item;this.originalItem=Object.assign({},i),i.hasChromaKeyColor=!(!i.asset||!i.asset.chromaKeyColor),i.assetType=lt(i).id,this.doUpdateForm(),n.changes$.subscribe((function(t){e.doUpdateItem(t),e.pushChanges()}))},r.getAssetDidChange=function(e){var t=this.item;return(t.asset?t.asset.id:null)!==(e.asset?e.asset.id:null)||t.hasChromaKeyColor!==e.hasChromaKeyColor},r.doUpdateItem=function(e){var t=this,o=this.item,r=this.getAssetDidChange(e);(Object.assign(o,e),o.asset&&(o.asset.chromaKeyColor=o.hasChromaKeyColor?[0,1,0]:null),r)&&((o.asset?Vt.assetUpdate$(o.asset):i.of(null)).pipe(n.switchMap((function(){return At.inferItemUpdate$(t.view,o)})),n.first()).subscribe(),"function"==typeof o.onUpdateAsset&&o.onUpdateAsset());"function"==typeof o.onUpdate&&o.onUpdate()},r.doUpdateForm=function(){var e=this,i=this.item,o=this.form;if(this.type&&this.type.name===i.type.name)Object.keys(this.controls).forEach((function(t){switch(t){case"link":var n=i.link?i.link.title:null,o=i.link?i.link.href:null;e.controls[t].value={title:n,href:o,target:"_blank"};break;case"hasChromaKeyColor":e.controls[t].value=!(!i.asset||!i.asset.chromaKeyColor);break;case"assetType":e.controls[t].value=lt(i).id;break;default:e.controls[t].value=null!=i[t]?i[t]:null}}));else{var r;switch(this.type=i.type,Object.keys(this.controls).forEach((function(e){o.removeKey(e)})),i.type.name){case _e.Nav.name:r=["id","type","title?","abstract?","viewId","keepOrientation?","position","asset?","link?"];break;case _e.Plane.name:r=["id","type","position","rotation","scale","assetType?","asset?","hasChromaKeyColor?"];break;case _e.CurvedPlane.name:r=["id","type","position","rotation","scale","radius","height","arc","assetType?","asset?","hasChromaKeyColor?"];break;case _e.Texture.name:r=["id","type","assetType?","asset?","hasChromaKeyColor?"];break;case _e.Model.name:r=["id","type","asset?"];break;default:r=["id","type"]}r.forEach((function(r){var s=-1!==r.indexOf("?");r=r.replace("?","");var a,u=null!=i[r]?i[r]:null;switch(r){case"viewId":a=new t.FormControl(u,s?void 0:t.RequiredValidator()),At.viewIdOptions$().pipe(n.first()).subscribe((function(t){a.options=t,a.value=a.value||null,e.pushChanges()}));break;case"assetType":(a=new t.FormControl(u,s?void 0:t.RequiredValidator())).options=Object.keys(ut).map((function(e){return ut[e]}));break;case"link":var l=i.link?i.link.title:null,c=i.link?i.link.href:null;a=new t.FormGroup({title:new t.FormControl(l),href:new t.FormControl(c),target:"_blank"});break;default:a=new t.FormControl(u,s?void 0:t.RequiredValidator())}o.add(a,r)})),this.controls=o.controls}},r.onAssetTypeDidChange=function(e){var t=this,o=this.item,r=lt(o).id;if(e!==r){o.assetType=e;var s=i.of(null);e!==ut.ImageOrVideo.id&&(s=s.pipe(n.switchMap((function(){var t,n,i,o=(n=(t=e)===ut.Publisher.id?at.PublisherStream:at.NextAttendeeStream,i=t===ut.Publisher.id?"publisherStream":"nextAttendeeStream",new dt({type:n,folder:"",file:i}));return Vt.assetCreate$(o)})))),s.pipe(n.first()).subscribe((function(e){t.controls.asset.value=e}))}},r.onChanges=function(e){this.doUpdateForm()},r.onSubmit=function(){if(this.form.valid){var e=this.form.value,t=Object.assign({},e);this.update.next({view:this.view,item:new je(t)})}else this.form.touched=!0},r.onRemove=function(e){var t=this;He.open$({src:T.template.modal.remove,data:{item:this.item}}).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){e instanceof $e&&t.delete.next({view:t.view,item:t.item})}))},r.onSelect=function(e){this.select.next({view:this.view,item:this.item.selected?null:this.item})},r.getTitle=function(e){return It[e.type.name]},o}(e.Component);Ft.meta={selector:"update-view-item",outputs:["select","update","delete"],inputs:["view","item"],template:'\n\t\t<div class="group--headline" [class]="{ active: item.selected }" (click)="onSelect($event)">\n\t\t\t\x3c!-- <div class="id" [innerHTML]="item.id"></div> --\x3e\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon [name]="item.type.name"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title" [innerHTML]="getTitle(item)"></div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="item.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text label="Id" [control]="controls.id" [disabled]="true"></div>\n\t\t\t\t\x3c!-- <div control-text label="Type" [control]="controls.type" [disabled]="true"></div> --\x3e\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'nav\'">\n\t\t\t\t<div control-text label="Title" [control]="controls.title"></div>\n\t\t\t\t<div control-text label="Abstract" [control]="controls.abstract"></div>\n\t\t\t\t<div control-custom-select label="NavToView" [control]="controls.viewId"></div>\n\t\t\t\t\x3c!-- <div control-checkbox label="Keep Orientation" [control]="controls.keepOrientation"></div> --\x3e\n\t\t\t\t<div control-vector label="Position" [control]="controls.position" [precision]="3"></div>\n\t\t\t\t<div control-asset label="Image" [control]="controls.asset" accept="image/jpeg, image/png"></div>\n\t\t\t\t<div control-text label="Link Title" [control]="controls.link.controls.title"></div>\n\t\t\t\t<div control-text label="Link Url" [control]="controls.link.controls.href"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'plane\'">\n\t\t\t\t<div control-vector label="Position" [control]="controls.position" [precision]="1"></div>\n\t\t\t\t<div control-vector label="Rotation" [control]="controls.rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t<div control-vector label="Scale" [control]="controls.scale" [precision]="2"></div>\n\t\t\t\t<div control-custom-select label="Asset" [control]="controls.assetType" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-asset label="Image or Video" [control]="controls.asset" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox label="Use Green Screen" [control]="controls.hasChromaKeyColor" *if="item.asset"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'curved-plane\'">\n\t\t\t\t<div control-vector label="Position" [control]="controls.position" [precision]="1"></div>\n\t\t\t\t<div control-vector label="Rotation" [control]="controls.rotation" [precision]="3" [increment]="Math.PI / 360"></div>\n\t\t\t\t\x3c!-- <div control-vector label="Scale" [control]="controls.scale" [precision]="2" [disabled]="true"></div> --\x3e\n\t\t\t\t<div control-number label="Radius" [control]="controls.radius" [precision]="2"></div>\n\t\t\t\t<div control-number label="Height" [control]="controls.height" [precision]="2"></div>\n\t\t\t\t<div control-number label="Arc" [control]="controls.arc" [precision]="0"></div>\n\t\t\t\t<div control-custom-select label="Asset" [control]="controls.assetType" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-asset label="Image or Video" [control]="controls.asset" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox label="Use Green Screen" [control]="controls.hasChromaKeyColor" *if="item.asset"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="item.type.name == \'texture\'">\n\t\t\t\t<div control-custom-select label="Asset" [control]="controls.assetType" (change)="onAssetTypeDidChange($event)"></div>\n\t\t\t\t<div control-asset label="Image or Video" [control]="controls.asset" accept="image/jpeg, video/mp4" *if="controls.assetType.value == 1"></div>\n\t\t\t\t<div control-checkbox label="Use Green Screen" [control]="controls.hasChromaKeyColor" *if="item.asset"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update">\n\t\t\t\t\t<span *if="!form.submitted">Update</span>\n\t\t\t\t\t<span *if="form.submitted">Update!</span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t<span>Remove</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t'};var jt=function(e){function i(){return e.apply(this,arguments)||this}h(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.active=!1;var n=this.form=new t.FormGroup({id:new t.FormControl(this.tile.id,t.RequiredValidator()),asset:new t.FormControl(this.tile.asset,t.RequiredValidator()),navs:new t.FormControl(this.tile.navs,t.RequiredValidator())});this.controls=n.controls,n.changes$.subscribe((function(t){var n=e.tile;Object.assign(n,t),"function"==typeof n.onUpdate&&n.onUpdate(),e.pushChanges()})),console.log("UpdateViewTileComponent.onInit",this.view,this.tile)},o.onSubmit=function(){if(this.form.valid){var e=Object.assign({},this.form.value);this.update.next({view:this.view,tile:e})}else this.form.touched=!0},o.onRemove=function(e){var t=this;He.open$({src:T.template.modal.remove,data:{tile:this.tile}}).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){e instanceof $e&&t.delete.next({view:t.view,tile:t.tile})}))},o.onSelect=function(e){this.select.next({view:this.view,tile:this.tile.selected?null:this.tile})},i}(e.Component);jt.meta={selector:"update-view-tile",outputs:["select","update","delete"],inputs:["view","tile"],template:'\n\t\t<div class="group--headline" [class]="{ active: tile.selected }" (click)="onSelect($event)">\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon name="tile"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title">Tile {{tile.id}}</div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="tile.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text label="Id" [control]="controls.id" [disabled]="true"></div>\n\t\t\t\t<div control-asset label="Image" [control]="controls.asset" accept="image/jpeg, image/png"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update">\n\t\t\t\t\t<span *if="!form.submitted">Update</span>\n\t\t\t\t\t<span *if="form.submitted">Update!</span>\n\t\t\t\t</button>\n\t\t\t\t\x3c!--\n\t\t\t\t<button type="button" class="btn--remove" (click)="onRemove($event)">\n\t\t\t\t\t<span>Remove</span>\n\t\t\t\t</button>\n\t\t\t\t--\x3e\n\t\t\t</div>\n\t\t</form>\n\t'};var Gt=function(e){function i(){return e.apply(this,arguments)||this}h(i,e);var o=i.prototype;return o.onInit=function(){var e=this;this.flags=T.flags;var i=this.form=new t.FormGroup;this.controls=i.controls,i.changes$.subscribe((function(t){e.pushChanges()})),this.doUpdateForm(),P.in$.pipe(n.auditTime(500),n.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(t.type){case ie:switch(e.view.type.name){case Ue.Panorama.name:case Ue.PanoramaGrid.name:e.form.patch({latitude:t.orientation.latitude,longitude:t.orientation.longitude,zoom:t.zoom})}}}))},o.doUpdateForm=function(){var e=this.view;if(!this.type||this.type.name!==e.type.name){this.type=e.type;var n,i=this.form;switch(Object.keys(this.controls).forEach((function(e){i.removeKey(e)})),e.type.name){case Ue.Panorama.name:n=["id","type","name","hidden","latitude","longitude","zoom","asset"];break;case Ue.PanoramaGrid.name:n=["id","type","name","hidden","latitude","longitude","zoom"];break;default:n=["id","type","name"]}e.type.name!==Ue.WaitingRoom.name&&T.flags.ar&&(n.push("usdz?"),n.push("gltf?")),n.forEach((function(n){var o=-1!==n.indexOf("?");switch(n=n.replace("?","")){case"latitude":case"longitude":var r=e.orientation||{latitude:0,longitude:0};i.add(new t.FormControl(r[n],t.RequiredValidator()),n);break;case"usdz":case"gltf":i.add(new t.FormControl(e.ar&&e.ar[n]||null,o?void 0:t.RequiredValidator()),n);break;default:i.add(new t.FormControl(null!=e[n]?e[n]:null,o?void 0:t.RequiredValidator()),n)}})),this.controls=i.controls}},o.onChanges=function(e){this.doUpdateForm()},o.onSubmit=function(){if(this.form.valid){var e=Object.assign({},this.view,this.form.value);null!=e.latitude&&(e.orientation={latitude:e.latitude,longitude:e.longitude},delete e.latitude,delete e.longitude),null==e.usdz&&null==e.gltf||(e.ar={usdz:e.usdz||null,gltf:e.gltf||null},delete e.usdz,delete e.gltf),this.update.next({view:new Le(e)})}else this.form.touched=!0},o.onRemove=function(e){var t=this;He.open$({src:T.template.modal.remove,data:{item:this.item}}).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){e instanceof $e&&t.delete.next({view:t.view})}))},o.onSelect=function(e){this.select.next({view:this.view.selected?null:this.view})},o.getTitle=function(e){return It[e.type.name]},i}(e.Component);Gt.meta={selector:"update-view",outputs:["select","update","delete"],inputs:["view"],template:'\n\t\t<div class="group--headline" [class]="{ active: view.selected }" (click)="onSelect($event)">\n\t\t\t\x3c!-- <div class="id" [innerHTML]="view.id"></div> --\x3e\n\t\t\t<div class="icon">\n\t\t\t\t<svg-icon [name]="view.type.name"></svg-icon>\n\t\t\t</div>\n\t\t\t<div class="title" [innerHTML]="getTitle(view)"></div>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<form [formGroup]="form" (submit)="onSubmit()" name="form" role="form" novalidate autocomplete="off" *if="view.selected">\n\t\t\t<div class="form-controls">\n\t\t\t\t<div control-text [control]="controls.id" label="Id" [disabled]="true"></div>\n\t\t\t\t\x3c!-- <div control-text [control]="controls.type" label="Type" [disabled]="true"></div> --\x3e\n\t\t\t\t<div control-text [control]="controls.name" label="Name"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'waiting-room\'">\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'panorama\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-asset [control]="controls.asset" label="Image" accept="image/jpeg, video/mp4"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name == \'panorama-grid\'">\n\t\t\t\t<div control-checkbox [control]="controls.hidden" label="Hide from menu"></div>\n\t\t\t\t<div control-text [control]="controls.latitude" label="Latitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.longitude" label="Longitude" [disabled]="true"></div>\n\t\t\t\t<div control-text [control]="controls.zoom" label="Zoom" [disabled]="true"></div>\n\t\t\t</div>\n\t\t\t<div class="form-controls" *if="view.type.name != \'waiting-room\' && flags.ar">\n\t\t\t\t<div control-model [control]="controls.usdz" label="AR IOS (.usdz)" accept=".usdz"></div>\n\t\t\t\t<div control-model [control]="controls.gltf" label="AR Android (.glb)" accept=".glb"></div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<button type="submit" class="btn--update">\n\t\t\t\t\t<span *if="!form.submitted">Update</span>\n\t\t\t\t\t<span *if="form.submitted">Update!</span>\n\t\t\t\t</button>\n\t\t\t\t<button type="button" class="btn--remove" *if="view.type.name != \'waiting-room\'" (click)="onRemove($event)">\n\t\t\t\t\t<span>Remove</span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t</form>\n\t'};var zt=[$t,Pt,Ht,Ot,_t,Ut,Lt,Dt,Ct,Ft,jt,Gt],qt=[],Nt=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(e.Module);Nt.meta={imports:[],declarations:[].concat(zt,qt),exports:[].concat(zt,qt)};var Bt=function(t){function n(){return t.apply(this,arguments)||this}return h(n,t),n.prototype.onChanges=function(){var t=e.getContext(this).node,n=this.control.flags;Object.keys(n).forEach((function(e){n[e]?t.classList.add(e):t.classList.remove(e)}))},n}(e.Component);Bt.meta={selector:"[control]",inputs:["control"]};var Wt=function(t){function o(){return t.apply(this,arguments)||this}h(o,t);var r=o.prototype;return r.onInit=function(){var t=this;this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||"image/png, image/jpeg",this.previews=[];var i=e.getContext(this).node.querySelector("input");i.setAttribute("accept",this.accept),this.drop$(i).pipe(n.takeUntil(this.unsubscribe$)).subscribe(),this.change$(i).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){console.log("ControlAssetComponent.change$",e),t.control.value=e[0]}))},r.change$=function(t){var o=this;return e.isPlatformBrowser&&t?i.fromEvent(t,"change").pipe(n.filter((function(e){return t.files&&t.files.length})),n.switchMap((function(e){console.log("ControlAssetComponent.change$",t.files);var r=Array.from(t.files);o.previews=r.map((function(){return null}));var s=r.map((function(e,t){return o.read$(e,t).pipe(n.switchMap((function(){return Vt.upload$([e])})),n.tap((function(e){return console.log("upload",e)})),n.switchMap((function(e){var t=e[0],n=dt.fromUrl(t.url);return Vt.assetCreate$(n)})))}));return i.combineLatest(s)}))):i.EMPTY},r.read$=function(e,t){var o=this,r=new FileReader,s=i.fromEvent(r,"load").pipe(n.tap((function(e){var n=e.target.result;o.resize_(n,(function(e){o.previews[t]=e,o.pushChanges()}))})));return r.readAsDataURL(e),s},r.drop$=function(t){if(e.isPlatformBrowser&&t){var o=document.querySelector("body");return i.merge(i.fromEvent(o,"drop"),i.fromEvent(o,"dragover")).pipe(n.map((function(e){console.log("ControlAssetComponent.drop$",e),e.preventDefault(),e.target===t&&(t.files=e.dataTransfer.files)})))}return i.EMPTY},r.resize_=function(e,t){if("function"==typeof t){var n=document.createElement("img");n.onload=function(){var e=document.createElement("canvas"),i=e.getContext("2d"),o=n.width,r=n.height;o>r?o>320&&(r*=320/o,o=320):r>240&&(o*=240/r,r=240),e.width=o,e.height=r,i.drawImage(n,0,0,o,r);var s=e.toDataURL("image/jpeg",.9);t(s)},n.src=e}},l(o,[{key:"image",get:function(){var e=null;return this.control.value?e=""+this.control.value.folder+this.control.value.file:this.previews&&this.previews.length&&(e=this.previews[0]),e}}]),o}(Bt);Wt.meta={selector:"[control-asset]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--picture">\n\t\t\t\t<div class="group--picture__info">\n\t\t\t\t\t\x3c!-- <svg class="icon--image"><use xlink:href="#image"></use></svg> --\x3e\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t</div>\n\t\t\t\t<img [lazy]="control.value | asset" [size]="{ width: 320, height: 240 }" *if="control.value && control.value.type.name === \'image\'" />\n\t\t\t\t<video [src]="control.value | asset" *if="control.value && control.value.type.name === \'video\'"></video>\n\t\t\t\t<input type="file">\n\t\t\t</div>\n\t\t\t<div class="file-name" *if="control.value" [innerHTML]="control.value.file"></div>\n\t\t\t\x3c!--\n\t\t\t<input type="text" class="control--text" [formControl]="control" [placeholder]="label" [disabled]="disabled" />\n\t\t\t--\x3e\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var Kt=function(e){this.file=e,this.name=e.name,this.type=ct(e.name),this.progress=0,this.size=e.size,this.uploading=!1,this.paused=!1,this.success=!1,this.complete=!1,this.error=null,this.preview=null},Xt=function(e){e&&Object.assign(this,e)},Yt=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(Xt),Jt=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(Xt),Zt=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(Xt),Qt=function(){function t(){this.concurrent$=new i.BehaviorSubject(0),this.items$=new i.BehaviorSubject([]),this.events$=new i.ReplaySubject(1)}var o=t.prototype;return o.upload$=function(){var e=this,t=this.items$.getValue().filter((function(e){return!e.uploading}));return i.combineLatest(t.map((function(t){return e.uploadItem$(t)})))},o.uploadItem$=function(e){var t=this;e.uploading=!0,this.events$.next(new Yt({item:e}));var o=[e.file];return i.of(o).pipe(n.delayWhen((function(){return t.concurrent$.pipe(n.filter((function(e){return e<4})))})),n.tap((function(){return t.concurrent$.next(t.concurrent$.getValue()+1)})),n.first(),n.switchMap((function(e){return Vt.upload$(e)})),n.switchMap((function(i){var o=i[0];e.uploading=!1,e.complete=!0;var r=dt.fromUrl(o.url);return t.events$.next(new Jt({item:e,asset:r})),Vt.assetCreate$(r).pipe(n.tap((function(n){t.remove(e),t.events$.next(new Zt({item:e,asset:n})),t.concurrent$.next(t.concurrent$.getValue()-1)})))})))},o.addItems=function(e){if(e&&e.length){var t=this.items$.getValue(),n=Array.from(e).map((function(e){return new Kt(e)}));t.push.apply(t,n),this.items$.next(t)}},o.remove=function(e){var t=this.items$.getValue(),n=t.indexOf(e);-1!==n&&t.splice(n,1),this.items$.next(t)},o.removeAll=function(){this.items$.next([])},o.drop$=function(t,o){var r=this;if(e.isPlatformBrowser&&t){o=o||t;var s=document.querySelector("body");return i.merge(i.fromEvent(s,"drop"),i.fromEvent(s,"dragover")).pipe(n.map((function(e){return e.preventDefault(),e.target===o&&r.addItems(e.dataTransfer.files),r.items$})))}return i.EMPTY},o.change$=function(t){var o=this;return e.isPlatformBrowser&&t?i.fromEvent(t,"change").pipe(n.switchMap((function(e){return t.files.length&&(o.addItems(t.files),t.value=""),o.items$}))):i.EMPTY},o.files$=function(e){var t=this;return i.combineLatest(Array.from(e).map((function(e,n){return t.file$(e,n)})))},o.file$=function(e,t){var i=this;return this.read$(e,t).pipe(n.switchMap((function(){return i.uploadFile$(e)})))},o.read$=function(e,t){var o=this,r=new FileReader,s=i.fromEvent(r,"load").pipe(n.tap((function(e){var n=e.target.result;o.resize(n,(function(e){o.previews[t]=e,o.pushChanges()}))})));return r.readAsDataURL(e),s},o.uploadFile$=function(e){return Vt.upload$([e]).pipe(n.switchMap((function(e){var t=e[0],n=dt.fromUrl(t.url);return Vt.assetCreate$(n)})))},o.resize=function(e,t){if("function"==typeof t){var n=document.createElement("img");n.onload=function(){var e=document.createElement("canvas"),i=e.getContext("2d"),o=n.width,r=n.height;o>r?o>320&&(r*=320/o,o=320):r>240&&(o*=240/r,r=240),e.width=o,e.height=r,i.drawImage(n,0,0,o,r);var s=e.toDataURL("image/jpeg",.9);t(s)},n.src=e}},o.supported=function(){return(t=document.createElement("input")).type="file","files"in t&&!!((e=new XMLHttpRequest)&&"upload"in e&&"onprogress"in e.upload)&&!!window.FormData;var e,t},t}(),en=function(t){function i(){return t.apply(this,arguments)||this}h(i,t);var o=i.prototype;return o.onInit=function(){var t=this;this.label="label",this.required=!1,this.accept=this.accept||"image/png, image/jpeg",this.multiple=!1!==this.multiple,this.items=[],this.assets=this.control.value||[],this.hasFiles=!1;var i=e.getContext(this).node,o=i.querySelector("input");o.setAttribute("accept",this.accept);var r=i.querySelector(".upload-drop"),s=this.service=new Qt;s.drop$(o,r).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()})),s.change$(o).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()})),s.events$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){e instanceof Zt&&(t.assets.push(e.asset),t.control.value=t.assets),t.items=t.items,t.pushChanges()}))},o.onUpload=function(){this.service.upload$().pipe(n.first()).subscribe()},o.onCancel=function(){this.service.removeAll()},o.onItemPause=function(e){},o.onItemResume=function(e){},o.onItemCancel=function(e){},o.onItemRemove=function(e){this.service.remove(e)},l(i,[{key:"items",get:function(){return this.items_},set:function(e){this.items_=e,this.uploadCount=e.reduce((function(e,t){return e+(t.uploading||t.completed?0:1)}),0)}}]),i}(Bt);en.meta={selector:"[control-assets]",inputs:["control","label","multiple"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="listing--assets">\n\t\t\t\t<div class="listing__item" *for="let item of assets">\n\t\t\t\t\t<div class="upload-item">\n\t\t\t\t\t\t<div class="picture">\n\t\t\t\t\t\t\t<img [lazy]="item | asset" [size]="{ width: 320, height: 240 }" *if="item.type.name === \'image\'" />\n\t\t\t\t\t\t\t<video [src]="item | asset" *if="item.type.name === \'video\'"></video>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="name" [innerHTML]="item.file"></div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="listing__item" *for="let item of items">\n\t\t\t\t\t<div upload-item [item]="item" (pause)="onItemPause($event)" (resume)="onItemResume($event)" (cancel)="onItemCancel($event)" (remove)="onItemRemove($event)"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div class="group--cta">\n\t\t\t\t<div class="btn--browse">\n\t\t\t\t\t<span [innerHTML]="\'browse\' | label"></span>\n\t\t\t\t\t<input type="file" accept="image/jpeg" multiple />\n\t\t\t\t</div>\n\t\t\t\t<div class="btn--upload" (click)="onUpload()" *if="uploadCount > 0" [innerHTML]="\'upload\' | label"></div>\n\t\t\t\t<div class="btn--cancel" (click)="onCancel()" *if="uploadCount > 0" [innerHTML]="\'cancel\' | label"></div>\n\t\t\t</div>\n\t\t\t<div class="upload-drop">\n    \t\t\t<span [innerHTML]="\'drag_and_drop_images\' | label"></span>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var tn=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.prototype.onInit=function(){this.label="label"},t}(Bt);tn.meta={selector:"[control-checkbox]",inputs:["control","label"],template:'\n\t\t<div class="group--form--checkbox" [class]="{ required: control.validators.length }">\n\t\t\t<label>\n\t\t\t\t<input type="checkbox" class="control--checkbox" [formControl]="control" [value]="true" />\n\t\t\t\t<span [innerHTML]="label | html"></span>\n\t\t\t</label>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var nn=function(){function e(){}return e.keydown$=function(){return this.keydown$_||(this.keydown$_=i.fromEvent(window,"keydown").pipe(n.shareReplay(1))),this.keydown$_},e.keyup$=function(){return this.keyup$_||(this.keyup$_=i.fromEvent(window,"keyup").pipe(n.shareReplay(1))),this.keyup$_},e.keys$=function(){var e=this;return this.keys$_||(this.keys$_=i.merge(this.keydown$(),this.keyup$()).pipe(n.map((function(t){var n=e.keys;return"keydown"===t.type?n[t.key]=!0:delete n[t.key],e.keys})),n.startWith(this.keys),n.shareReplay(1))),this.keys$_},e.key$=function(){if(!this.key$_){var e=/\w/;this.key$_=this.keydown$().pipe(n.filter((function(t){return t.key&&t.key.match(e)})),n.map((function(e){return e.key})),n.shareReplay(1))}return this.key$_},e.typing$=function(){if(!this.typing$_){var e,t="";this.typing$_=this.key$().pipe(n.map((function(n){return e&&clearTimeout(e),t+=n,e=setTimeout((function(){t=""}),1500),t})),n.shareReplay(1))}return this.typing$_},e}();c(nn,"keys",{});var on=Object.assign({browse:"browse",cancel:"cancel",drag_and_drop_images:"Drag And Drop your images here",error_email:"Invalid email",error_match:"Fields do not match",error_required:"Field is required",remove:"remove",required:"required",select:"Select",select_file:"Select a file...",upload:"upload"},window.labels||{}),rn=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.transform=function(e){return on[e]||"#"+e+"#"},t}(e.Pipe);rn.meta={name:"label"};var sn=function(t){function i(){return t.apply(this,arguments)||this}h(i,t);var o=i.prototype;return o.onInit=function(){var e=this;this.label="label",this.dropped=!1,this.dropdownId=Et.nextId(),nn.typing$().pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.scrollToWord(t)}))},o.scrollToWord=function(t){for(var n=this.control.options||[],i=-1,o=0;o<n.length;o++){if(0===n[o].name.toLowerCase().indexOf(t.toLowerCase())){i=o;break}}if(-1!==i){var r=e.getContext(this).node,s=r.querySelector(".dropdown"),a=r.querySelector(".nav--dropdown").children[i];s.scrollTo(0,a.offsetTop)}},o.setOption=function(e){var t;if(this.isMultiple){var n=this.control.value||[],i=n.indexOf(e.id);-1!==i?n.splice(i,1):n.push(e.id),function(e){throw new Error('"'+e+'" is read-only')}("value"),n=n.length?n.slice():null}else t=e.id;this.control.value=t,this.change.next(t)},o.hasOption=function(e){return this.isMultiple?-1!==(this.control.value||[]).indexOf(e.id):this.control.value===e.id},o.onDropped=function(e){},o.getLabel=function(){var e=this.control.value,t=this.control.options||[];if(this.isMultiple)return(e=e||[]).length?e.map((function(e){var n=t.find((function(t){return t.id===e||t.name===e}));return n?n.name:""})).join(", "):rn.transform("select");var n=t.find((function(t){return t.id===e||t.name===e}));return n?n.name:rn.transform("select")},o.onDropped=function(e){this.dropped=e===this.dropdownId},l(i,[{key:"isMultiple",get:function(){return this.multiple&&!1!==this.multiple&&"false"!==this.multiple}}]),i}(Bt);sn.meta={selector:"[control-custom-select]",outputs:["change"],inputs:["control","label","multiple"],template:'\n\t\t<div class="group--form--select" [class]="{ required: control.validators.length, multiple: isMultiple }" [dropdown]="dropdownId" (dropped)="onDropped($event)">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<span class="control--custom-select" [innerHTML]="getLabel()"></span>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t\t<div class="dropdown" [dropdown-item]="dropdownId">\n\t\t\t<div class="category" [innerHTML]="label"></div>\n\t\t\t<ul class="nav--dropdown" [class]="{ multiple: isMultiple }">\n\t\t\t\t<li (click)="setOption(item)" [class]="{ empty: item.id == null }" *for="let item of control.options">\n\t\t\t\t\t<span [class]="{ active: hasOption(item) }" [innerHTML]="item.name"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>\n\t'};var an=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var n=t.prototype;return n.onInit=function(){var e=this;this.label=this.label||"label",this.disabled=this.disabled||!1;var t=getContext(this).node,n=this.input=t.querySelector("input");merge(fromEvent(n,"input")).pipe(takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onInputDidChange(t)})),fromEvent(n,"blur").pipe(takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onInputDidBlur(t)}))},n.onInputDidChange=function(e){console.log("ControlLinkComponent.onInputDidChange",e.target.value)},n.onInputDidBlur=function(e){console.log("ControlLinkComponent.onInputDidBlur",e.target.value),this.control.touched=!0,this.value=this.input.value},t}(Bt);an.meta={selector:"[control-link]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<input type="text" class="control--text" [formControl]="control" [placeholder]="label" [disabled]="disabled" />\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var un=function(t){function o(){return t.apply(this,arguments)||this}h(o,t);var r=o.prototype;return r.onInit=function(){var t=this;this.label=this.label||"label",this.disabled=this.disabled||!1,this.accept=this.accept||".glb";var i=e.getContext(this).node,o=this.input=i.querySelector("input");o.setAttribute("accept",this.accept),this.change$(o).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){console.log("ControlModelComponent.change$",e),t.control.value=e[0]}))},r.onRemove=function(e){this.control.value=null,this.input.value=null},r.read$=function(e,t){return i.of(e)},o}(Wt);un.meta={selector:"[control-model]",inputs:["control","label","disabled","accept"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="group--model">\n\t\t\t\t<div class="file-name" *if="!control.value" [innerHTML]="\'select_file\' | label"></div>\n\t\t\t\t<div class="file-name" *if="control.value" [innerHTML]="control.value.file"></div>\n\t\t\t\t<div class="btn--upload"><input type="file"><span [innerHTML]="\'browse\' | label"></span></div>\n\t\t\t\t<div class="btn--remove" *if="control.value" (click)="onRemove($event)"><span [innerHTML]="\'remove\' | label"></span></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var ln=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var n=t.prototype;return n.onInit=function(){this.label=this.label||"label",this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1,this.required=!1},n.updateValue=function(e){this.control.value=e},t}(Bt);ln.meta={selector:"[control-number]",inputs:["control","label","precision","increment","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="control--content control--number">\n\t\t\t\t<input-value label="" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value" (update)="updateValue($event)"></input-value>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var cn=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.prototype.onInit=function(){this.label="label",this.required=!1},t}(Bt);cn.meta={selector:"[control-password]",inputs:["control","label"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<input type="password" class="control--text" [formControl]="control" [placeholder]="label" />\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var dn=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.prototype.onInit=function(){this.label="label"},t}(Bt);dn.meta={selector:"[control-select]",inputs:["control","label"],template:'\n\t\t<div class="group--form--select" [class]="{ required: control.validators.length }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<select class="control--select" [formControl]="control" required>\n\t\t\t\t<option [value]="null" [innerHTML]="\'select\' | label"></option>\n\t\t\t\t<option [value]="item.id" *for="let item of control.options" [innerHTML]="item.name"></option>\n\t\t\t</select>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t<svg class="icon--caret-down"><use xlink:href="#caret-down"></use></svg>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var hn=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.prototype.onInit=function(){this.label=this.label||"label",this.disabled=this.disabled||!1},t}(Bt);hn.meta={selector:"[control-text]",inputs:["control","label","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length, disabled: disabled }">\n\t\t\t<label [innerHTML]="label"></label>\n\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t<input type="text" class="control--text" [formControl]="control" [placeholder]="label" [disabled]="disabled" />\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var pn=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var n=t.prototype;return n.onInit=function(){this.label=this.label||"label",this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1,this.required=!1},n.updateValue=function(e,t){var n=this.control.value;n[e]=t,this.control.value=n.slice()},t}(Bt);pn.meta={selector:"[control-vector]",inputs:["control","label","precision","increment","disabled"],template:'\n\t\t<div class="group--form" [class]="{ required: control.validators.length }">\n\t\t\t<div class="control--head">\n\t\t\t\t<label [innerHTML]="label"></label>\n\t\t\t\t<span class="required__badge" [innerHTML]="\'required\' | label"></span>\n\t\t\t</div>\n\t\t\t<div class="control--content control--vector">\n\t\t\t\t<input-value label="x" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[0]" (update)="updateValue(0, $event)"></input-value>\n\t\t\t\t<input-value label="y" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[1]" (update)="updateValue(1, $event)"></input-value>\n\t\t\t\t<input-value label="z" [precision]="precision" [increment]="increment" [disabled]="disabled" [value]="control.value[2]" (update)="updateValue(2, $event)"></input-value>\n\t\t\t</div>\n\t\t</div>\n\t\t<errors-component [control]="control"></errors-component>\n\t'};var fn=function(t){function n(){return t.apply(this,arguments)||this}return h(n,t),n.prototype.onChanges=function(){var t=e.getContext(this).node;!0===this.disabled?(t.disabled=this.disabled,t.setAttribute("disabled",this.disabled)):(delete t.disabled,t.removeAttribute("disabled"))},n}(e.Directive);fn.meta={selector:"input[disabled],textarea[disabled]",inputs:["disabled"]};var mn=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.prototype.getLabel=function(e,t){return rn.transform("error_"+e)},t}(Bt);mn.meta={selector:"errors-component",inputs:["control"],template:'\n\t<div class="inner" [style]="{ display: control.invalid && control.touched ? \'block\' : \'none\' }">\n\t\t<div class="error" *for="let [key, value] of control.errors">\n\t\t\t<span [innerHTML]="getLabel(key, value)"></span>\n\t\t\t\x3c!-- <span class="key" [innerHTML]="key"></span> <span class="value" [innerHTML]="value | json"></span> --\x3e\n\t\t</div>\n\t</div>\n\t'};var vn=function(t){function o(){return t.apply(this,arguments)||this}h(o,t);var r=o.prototype;return r.onInit=function(){var t=this;this.label=this.label||"label",this.value=this.value||0,this.precision=this.precision||3,this.increment=this.increment||1/Math.pow(10,this.precision),this.disabled=this.disabled||!1,this.increment$(".btn--more",1).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.value+=e,t.update.next(t.value),t.pushChanges()})),this.increment$(".btn--less",-1).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.value+=e,t.update.next(t.value),t.pushChanges()}));var o=e.getContext(this).node,r=this.input=o.querySelector("input");i.merge(i.fromEvent(r,"input")).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onInputDidChange(e)})),i.fromEvent(r,"blur").pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.onInputDidBlur(e)}))},r.onInputDidChange=function(e){e.target.value=e.target.value.replace(/[^\d|\.]/g,"")},r.onInputDidBlur=function(e){var t=parseFloat(this.input.value);this.value!==t&&(NaN!==t?(this.value=t,this.update.next(this.value)):this.input.value=this.getValue())},r.increment$=function(t,o){var r,s,a=this,u=e.getContext(this).node.querySelector(t);return i.race(i.fromEvent(u,"mousedown"),i.fromEvent(u,"touchstart")).pipe(n.tap((function(){s=a.increment,r=32})),n.switchMap((function(e){return i.interval(30).pipe(n.filter((function(e){return e%r==0})),n.map((function(){var e=s*o;return r=Math.max(1,Math.floor(.85*r)),e})),n.takeUntil(i.race(i.fromEvent(u,"mouseup"),i.fromEvent(u,"touchend"))))})))},r.getValue=function(){return this.value.toFixed(this.precision)},r.setValue=function(e){this.value+=this.increment*e,this.update.next(this.value),this.pushChanges()},o}(e.Component);vn.meta={selector:"input-value",outputs:["update"],inputs:["value","label","precision","increment","disabled"],template:'\n\t\t<div class="group--control" [class]="{ disabled: disabled }">\n\t\t\t<input type="text" class="control--text" [placeholder]="label" [value]="getValue()" [disabled]="disabled" />\n\t\t\t<div class="control--trigger">\n\t\t\t\t<div class="btn--more" (click)="setValue(1)">+</div>\n\t\t\t\t<div class="btn--less" (click)="setValue(-1)">-</div>\n\t\t\t</div>\n\t\t</div>\n\t'};var gn=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var n=t.prototype;return n.onInit=function(){this.env=w},n.onTest=function(e){this.test.next(e)},n.onReset=function(e){this.reset.next(e)},t}(e.Component);gn.meta={selector:"test-component",inputs:["form"],outputs:["test","reset"],template:'\n\t<div class="group--form--results" *if="env.DEVELOPMENT">\n\t\t<code [innerHTML]="form.value | json"></code>\n\t\t<button type="button" class="btn--mode" (click)="onTest($event)"><span>test</span></button>\n\t\t<button type="button" class="btn--mode" (click)="onReset($event)"><span>reset</span></button>\n\t</div>\n\t'};var bn=function(t){function n(){return t.apply(this,arguments)||this}return h(n,t),n.prototype.onChanges=function(t){var n=e.getContext(this).node;n.value=this.value,n.setAttribute("value",this.value)},n}(e.Directive);bn.meta={selector:"[value]",inputs:["value"]};var yn=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t.transform=function(e){if(e){e=e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t))}));var t=['"',"&","'","<",">"," ","¡","¢","£","¤","¥","¦","§","¨","©","ª","«","¬","­","®","¯","°","±","²","³","´","µ","¶","·","¸","¹","º","»","¼","½","¾","¿","À","Á","Â","Ã","Ä","Å","Æ","Ç","È","É","Ê","Ë","Ì","Í","Î","Ï","Ð","Ñ","Ò","Ó","Ô","Õ","Ö","×","Ø","Ù","Ú","Û","Ü","Ý","Þ","ß","à","á","ã","ä","å","æ","ç","è","é","ê","ë","ì","í","î","ï","ð","ñ","ò","ó","ô","õ","ö","÷","ø","ù","ú","û","ü","ý","þ","ÿ","&","•","°","∞","‰","⋅","±","†","—","¬","µ","⊥","∥","€","£","¥","¢","©","®","™","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],n=new RegExp("(&"+["quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","amp","bull","deg","infin","permil","sdot","plusmn","dagger","mdash","not","micro","perp","par","euro","pound","yen","cent","copy","reg","trade","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega"].join(";)|(&")+";)","g");return e=e.replace(n,(function(){for(var e=1;e<arguments.length;e++)if(arguments[e])return t[e-1]}))}},t}(e.Pipe);yn.meta={name:"html"};var wn=function(t){function n(){return t.apply(this,arguments)||this}return h(n,t),n.prototype.onChanges=function(){e.getContext(this).node.setAttribute("id",this.id)},n}(e.Directive);wn.meta={selector:"[id]",inputs:["id"]};var En=0,xn=function(){function e(){}return e.worker=function(){return this.worker_||(this.worker_=new Worker(T.worker)),this.worker_},e.load$=function(e,t){if(!("Worker"in window)||this.isBlob(e)||this.isCors(e))return i.of(e);var o=++En,r=this.worker();return r.postMessage({src:e,id:o,size:t}),i.fromEvent(r,"message").pipe(n.filter((function(t){return t.data.src===e})),n.map((function(e){return URL.createObjectURL(e.data.blob)})),n.first(),n.finalize((function(e){r.postMessage({id:o}),e&&URL.revokeObjectURL(e)})))},e.isCors=function(e){return-1!==e.indexOf("://")&&-1===e.indexOf(window.location.host)},e.isBlob=function(e){return 0===e.indexOf("blob:")},e}(),Tn=function(){function e(){}return e.observer=function(){var e=this;return this.observer_||(this.readySubject_=new i.BehaviorSubject(!1),this.observerSubject_=new i.Subject,this.observer_=new IntersectionObserver((function(t){e.observerSubject_.next(t)}))),this.observer_},e.intersection$=function(e){if("IntersectionObserver"in window){var t=this.observer();return t.observe(e),this.observerSubject_.pipe(n.map((function(t){return t.find((function(t){return t.target===e}))})),n.filter((function(e){return void 0!==e&&e.isIntersecting})),n.first(),n.finalize((function(){return t.unobserve(e)})))}return i.of({target:e})},e}(),Rn=function(){function e(){}return e.get=function(e){return this.cache[e]},e.set=function(e,t){this.cache[e]=t;var n=Object.keys(this.cache);n.length>100&&this.remove(n[0])},e.remove=function(e){delete this.cache[e]},l(e,null,[{key:"cache",get:function(){return this.cache_||(this.cache_={}),this.cache_}}]),e}(),Sn=function(t){function o(){return t.apply(this,arguments)||this}h(o,t);var r=o.prototype;return r.onInit=function(){var t=this,o=e.getContext(this).node;o.classList.add("lazy"),this.input$=(new i.Subject).pipe(n.distinctUntilChanged(),n.switchMap((function(e){var n=Rn.get(e);return n?i.of(n):(o.classList.remove("lazyed"),t.lazy$(e))})),n.takeUntil(this.unsubscribe$)),this.input$.subscribe((function(e){Rn.set(t.lazy,e),o.setAttribute("src",e),o.classList.add("lazyed")}))},r.onChanges=function(){this.input$.next(this.lazy)},r.lazy$=function(t){var i=this,o=e.getContext(this).node;return Tn.intersection$(o).pipe(n.first(),n.switchMap((function(){return xn.load$(t,i.size)})),n.takeUntil(this.unsubscribe$))},o}(e.Directive);Sn.meta={selector:"[lazy],[[lazy]]",inputs:["lazy","size"]};var Cn=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var i=n.prototype;return i.onInit=function(){var t=e.getContext(this).parentInstance;t instanceof Pe&&(this.data=t.modal.data)},i.close=function(){He.reject()},n}(e.Component);Cn.meta={selector:"[modal]"};var In,kn=function(){this.x=0,this.y=0},Mn=function(e){e&&Object.assign(this,e)},$n=function(e){function t(t){var n;return(n=e.call(this,t)||this).distance=new kn,n.strength=new kn,n.speed=new kn,n}return h(t,e),t}(Mn),An=function(e){function t(t){var n;return(n=e.call(this,t)||this).distance=new kn,n.strength=new kn,n.speed=new kn,n}return h(t,e),t}(Mn),Hn=function(e){function t(t){return e.call(this,t)||this}return h(t,e),t}(Mn),Pn=function(){function e(){}return e.getPosition=function(e,t){return e instanceof MouseEvent?t?(t.x=e.clientX,t.y=e.clientY):t={x:e.clientX,y:e.clientY}:window.TouchEvent&&e instanceof TouchEvent&&e.touches.length>0&&(t?(t.x=e.touches[0].pageX,t.y=e.touches[0].pageY):t={x:e.touches[0].pageX,y:e.touches[0].pageY}),t},e.down$=function(e,t){var o,r=this;return i.merge(i.fromEvent(e,"mousedown").pipe(n.filter((function(e){return 0===e.button}))),i.fromEvent(e,"touchstart")).pipe(n.map((function(n){if((o=o||new $n).node=e,o.target=n.target,o.originalEvent=n,o.down=r.getPosition(n,o.down),o.down)return o.distance=new kn,o.strength=new kn,o.speed=new kn,t.next(o),o})),n.filter((function(e){return void 0!==e})))},e.move$=function(e,t,o,r){var s,a=this;return i.fromEvent(document,r.originalEvent instanceof MouseEvent?"mousemove":"touchmove").pipe(n.startWith(r),n.map((function(n){if((s=s||new An).node=e,s.target=n.target,s.originalEvent=n,s.position=a.getPosition(n,s.position),void 0!==r.down&&void 0!==s.position)return s.distance.x=s.position.x-r.down.x,s.distance.y=s.position.y-r.down.y,s.strength.x=s.distance.x/window.innerWidth*2,s.strength.y=s.distance.y/window.innerHeight*2,s.speed.x=r.speed.x+.1*(s.strength.x-r.strength.x),s.speed.y=r.speed.y+.1*(s.strength.y-r.strength.y),r.distance.x=s.distance.x,r.distance.y=s.distance.y,r.speed.x=s.speed.x,r.speed.y=s.speed.y,r.strength.x=s.strength.x,r.strength.y=s.strength.y,t.next(s),s})))},e.dismissEvent=function(e,t,n,i){return In=In||new Hn,t.next(In),n.next(),i&&Math.abs(i.distance.x)>10&&(e.preventDefault(),e.stopImmediatePropagation()),In},e.up$=function(e,t,o,r){var s=this;return i.fromEvent(document,r.originalEvent instanceof MouseEvent?"mouseup":"touchend").pipe(n.map((function(e){return s.dismissEvent(e,t,o,r)})))},e.observe$=function(t){var o=this;t=t||document;var r=e.events$=new i.ReplaySubject(1),s=e.dismiss$=new i.Subject;return this.down$(t,r).pipe(n.switchMap((function(a){return e.downEvent=a,i.merge(o.move$(t,r,s,a),o.up$(t,r,s,a)).pipe(n.takeUntil(s))})),n.switchMap((function(){return r})))},e}(),On=function(t){function i(){return t.apply(this,arguments)||this}h(i,t);var o=i.prototype;return o.onInit=function(){var t=this,i=e.getContext(this).node;this.container=i,this.inner=i.querySelector(".slider-inner"),this.current=0,this.change.next(this.current),gsap.set(this.inner,{x:-100*this.current+"%"}),P.out$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){switch(e.type){case te:void 0!==e.index&&t.navTo(e.index);break;case q:setTimeout((function(){P.send({type:te,index:t.current})}),500)}}))},o.slider$=function(){var e,t=this,i=0,o=0;return Pn.observe$(this.inner).pipe(n.tap((function(n){if(n instanceof $n){var r=t.getTranslation(t.inner,t.container);e=r.x}else if(n instanceof An)t.container.classList.add("dragging"),o=n.distance.x,n.distance.y,i=e+n.distance.x,t.inner.style.transform="translate3d("+i+"px, 0px, 0px)";else if(n instanceof Hn){t.container.classList.remove("dragging"),t.inner.style.transform=null;var s=t.container.offsetWidth;-1*o>.25*s&&t.hasNext()?t.navTo(t.current+1):-1*o<-.25*s&&t.hasPrev()?t.navTo(t.current-1):(t.current=t.current,t.inner.style.transform="translate3d("+-100*t.current+"%, 0, 0)")}})))},o.tweenTo=function(e,t){var n=this,i=(this.container,this.inner);this.container.offsetWidth;gsap.to(i,{duration:.5,x:-100*e+"%",delay:0,ease:Power3.easeInOut,overwrite:"all",onUpdate:function(){n.tween.next()},onComplete:function(){"function"==typeof t&&t()}})},o.navTo=function(e){var t=this;this.current!==e&&this.tweenTo(e,(function(){t.current=e,t.pushChanges(),t.change.next(t.current),P.send({type:te,index:e})}))},o.hasPrev=function(){return this.current-1>=0},o.hasNext=function(){return this.current+1<this.items.length},o.getTranslation=function(e,t){var n=0,i=0,o=0,r=e.style.transform;if(r){var s=r.split("(")[1].split(")")[0].split(",");n=parseFloat(s[0]),i=parseFloat(s[1]),o=parseFloat(s[2]),n=-1!==s[0].indexOf("%")?n*=.01*t.offsetWidth:n,i=-1!==s[1].indexOf("%")?i*=.01*t.offsetHeight:i}return{x:n,y:i,z:o}},l(i,[{key:"items",set:function(e){this.items_!==e&&(this.items_=e,this.current=Math.min(this.current,e?e.length-1:0))},get:function(){return this.items_}}]),i}(e.Component);On.meta={selector:"[slider]",inputs:["items"],outputs:["change","tween"]};var Un=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var i=n.prototype;return i.onInit=function(){this.update()},i.onChanges=function(){this.update()},i.update=function(){if(this.name_!==this.name){this.name_=this.name;var t=e.getContext(this).node;if(t.parentNode){var n,i=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=this.width||24,r=this.height||24;i.setAttribute("class","icon--"+this.name),i.setAttributeNS(null,"viewBox","0 0 "+o+" "+r),i.innerHTML='<use xlink:href="#'+this.name+'"></use>',i.rxcompId=t.rxcompId,(n=i.classList).add.apply(n,t.classList),t.parentNode.replaceChild(i,t)}}},n}(e.Structure);Un.meta={selector:"svg-icon",inputs:["name","width","height"]};var _n=function(t){function i(){return t.apply(this,arguments)||this}h(i,t);var o=i.prototype;return o.onInit=function(){var t=this;this.platform=Ie.platform,this.missingAr=!1,this.missingUsdz=!1,this.missingGltf=!1;var i=this.viewId=this.getViewId();i&&We.view$(i).pipe(n.first()).subscribe((function(n){if(!n.ar)return t.missingAr=!0,void t.pushChanges();if(t.platform===Re){var i=t.getUsdzSrc(n);i?window.location.href=i:(t.missingUsdz=!0,t.pushChanges())}else if(null!==t.getGltfSrc(n)){var o=t.getModelViewerNode(n);e.getContext(t).node.appendChild(o)}else t.missingGltf=!0,t.pushChanges()}))},o.getUsdzSrc=function(e){return e.ar&&e.ar.usdz?T.getPath(e.ar.usdz.folder+e.ar.usdz.file):null},o.getGltfSrc=function(e){return e.ar&&e.ar.gltf?T.getPath(e.ar.gltf.folder+e.ar.gltf.file):null},o.getViewId=function(){var e=ye.get("viewId")||null;return e&&(e=parseInt(e)),e},o.getModelViewerNode=function(e){var t=T.getPath(e.asset.folder+e.asset.file),n=this.getUsdzSrc(e),i=this.getGltfSrc(e),o='\n\t\t\t<model-viewer alt="'+e.name+'" skybox-image="'+t+'" ios-src="'+n+'" src="'+i+'" ar ar-modes="webxr scene-viewer quick-look" ar-scale="auto" camera-controls></model-viewer>\n\t\t',r=document.createElement("div");return r.innerHTML=o,r.firstElementChild},i}(e.Component);_n.meta={selector:"[try-in-ar]"};var Ln=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var o=t.prototype;return o.onInit=function(){var e=this;null===this.item.preview&&this.read$(this.item.file).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.item.preview=t,e.pushChanges()}))},o.read$=function(e){var t=this,o=new FileReader,r=i.fromEvent(o,"load").pipe(n.switchMap((function(e){var n=e.target.result;return t.item.type.name===at.Image.name?t.resize$(n):i.of(n)})));return o.readAsDataURL(e),r},o.resize$=function(e){return new Promise((function(t,n){var i=document.createElement("img");i.onload=function(){var e=document.createElement("canvas"),n=e.getContext("2d"),o=i.width,r=i.height;o>r?o>320&&(r*=320/o,o=320):r>240&&(o*=240/r,r=240),e.width=o,e.height=r,n.drawImage(i,0,0,o,r);var s=e.toDataURL("image/jpeg",.9);t(s)},i.onerror=function(e){n(e)},i.src=e}))},o.onPause=function(){this.pause.next(this.item)},o.onResume=function(){this.resume.next(this.item)},o.onCancel=function(){this.cancel.next(this.item)},o.onRemove=function(){this.remove.next(this.item)},t}(e.Component);Ln.meta={selector:"[upload-item]",outputs:["pause","resume","cancel","remove"],inputs:["item"],template:'\n\t<div class="upload-item" [class]="{ \'error\': item.error, \'success\': item.success }">\n\t\t<div class="picture">\n\t\t\t<img [lazy]="item.preview" [size]="{ width: 320, height: 240 }" *if="item.preview && item.type.name === \'image\'" />\n\t\t\t<video [src]="item.preview" *if="item.preview && item.type.name === \'video\'"></video>\n\t\t\t<svg class="spinner" width="24" height="24" viewBox="0 0 24 24" [class]="{ uploading: item.uploading }" *if="item.uploading"><use xlink:href="#spinner"></use></svg>\n\t\t</div>\n\t\t<div class="name">{{item.name}}</div>\n\t\t\x3c!--\n\t\t<div class="group--info">\n\t\t\t<div>progress: {{item.progress}}</div>\n\t\t\t<div>size: {{item.size}} bytes</div>\n\t\t\t<div>current speed: {{item.currentSpeed}} bytes/s</div>\n\t\t\t<div>average speed: {{item.averageSpeed}} bytes/s</div>\n\t\t\t<div>time ramining: {{item.timeRemaining}}s</div>\n\t\t\t<div>paused: {{item.paused}}</div>\n\t\t\t<div>success: {{item.success}}</div>\n\t\t\t<div>complete: {{item.complete}}</div>\n\t\t\t<div>error: {{item.error}}</div>\n\t\t</div>\n\t\t--\x3e\n\t\t\x3c!--\n\t\t<div class="group--cta" *if="!item.complete && item.uploading">\n\t\t\t<div class="btn--pause" (click)="onPause()">pause</div>\n\t\t\t<div class="btn--resume" (click)="onResume()">resume</div>\n\t\t\t<div class="btn--cancel" (click)="onCancel()">cancel</div>\n\t\t</div>\n\t\t--\x3e\n\t\t<div class="group--cta">\n\t\t\t<div class="btn--remove" (click)="onRemove()" *if="!item.complete">remove</div>\n\t\t</div>\n\t</div>\n\t'};var Dn=function(t){function n(){return t.apply(this,arguments)||this}return h(n,t),n.prototype.play=function(t){var n=e.getContext(this).node;if(Hls.isSupported()){var i=new Hls;i.attachMedia(n),i.on(Hls.Events.MEDIA_ATTACHED,(function(){i.loadSource(t),i.on(Hls.Events.MANIFEST_PARSED,(function(e,t){n.play()}))}))}},l(n,[{key:"hls",set:function(e){this.hls_!==e&&(this.hls_=e,this.play(e))},get:function(){return this.hls_}}]),n}(e.Directive);Dn.meta={selector:"[[hls]]",inputs:["hls"]};var Vn=function(){function e(){if(e.service_)throw"DebugService is a singleton class!";this.message$=new i.BehaviorSubject(null)}return e.getService=function(){return this.service_||(this.service_=new e),this.service_},l(e,[{key:"message",get:function(){return this.message$.getValue()}}]),e.prototype.setMessage=function(e){this.message!==e&&this.message$.next(e)},e}(),Fn=function(){function e(){}return e.load=function(e,t,n){if(this.video=null,e.asset)return"publisherStream"===e.asset.file?this.loadPublisherStreamBackground(t,n):-1!==e.asset.file.indexOf(".hdr")?this.loadRgbeBackground(T.getPath(e.asset.folder),e.asset.file,t,n):-1!==e.asset.file.indexOf(".mp4")||-1!==e.asset.file.indexOf(".webm")?this.loadVideoBackground(T.getPath(e.asset.folder),e.asset.file,t,n):-1!==e.asset.file.indexOf(".m3u8")?this.loadHlslVideoBackground(e.asset.file,t,n):this.loadBackground(T.getPath(e.asset.folder),e.asset.file,t,n)},e.loadBackground=function(e,t,o,r){var s=new THREE.PMREMGenerator(o);s.compileEquirectangularShader();var a=new Image;xn.load$(e+t).pipe(n.switchMap((function(e){var t=i.fromEvent(a,"load");return a.crossOrigin="anonymous",a.src=e,t})),n.first()).subscribe((function(e){var t=new THREE.Texture(a),n=s.fromEquirectangular(t).texture;s.dispose(),"function"==typeof r&&r(n,t,!1)}))},e.loadPublisherStreamBackground=function(e,t){var i=this;O.getPublisherStreamId$().pipe(n.first()).subscribe((function(n){return function(n){var o="#stream-"+n,r=document.querySelector(o+" video");if(r){var s=function(){var n=i.texture=new THREE.VideoTexture(r);n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.format=THREE.RGBFormat,n.needsUpdate=!0;var o=i.cubeRenderTarget=new THREE.WebGLCubeRenderTarget(1024,{generateMipmaps:!0,minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,mapping:THREE.UVMapping,format:THREE.RGBFormat}).fromEquirectangularTexture(e,n);"function"==typeof t&&t(o.texture,n,!1)};r.crossOrigin="anonymous",r.readyState>=r.HAVE_FUTURE_DATA?s():r.oncanplay=function(){s()}}}(n)}))},e.loadVideoBackground=function(e,t,n,i){var o=this,r=Vn.getService();this.video=!0;var s=this.video;s.oncanplay=function(){!function(){s.oncanplay=null;var e=new THREE.VideoTexture(s);e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.format=THREE.RGBFormat,e.needsUpdate=!0;var t=o.cubeRenderTarget=new THREE.WebGLCubeRenderTarget(1024,{generateMipmaps:!0,minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,mapping:THREE.UVMapping,format:THREE.RGBFormat}).fromEquirectangularTexture(n,e);"function"==typeof i&&i(t.texture,e,!1)}()},s.src=e+t,s.load(),s.play().then((function(){r.setMessage("play "+s.src)}),(function(e){console.log("EnvMapLoader.loadVideoBackground.play.error",e),r.setMessage("play.error "+s.src)}))},e.loadHlslVideoBackground=function(e,t,n){var i=document.createElement("video");if(i.oncanplay=function(){!function(){i.oncanplay=null;var e=new THREE.VideoTexture(i);e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.format=THREE.RGBFormat,e.needsUpdate=!0;var o=new THREE.WebGLCubeRenderTarget(1024,{generateMipmaps:!0,minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,mapping:THREE.UVMapping,format:THREE.RGBFormat}).fromEquirectangularTexture(t,e);"function"==typeof n&&n(o.texture,e,!1)}()},Hls.isSupported()){var o=new Hls;o.attachMedia(i),o.on(Hls.Events.MEDIA_ATTACHED,(function(){o.loadSource(e),o.on(Hls.Events.MANIFEST_PARSED,(function(e,t){i.play()}))}))}},e.loadRgbeBackground=function(e,t,n,i){var o=new THREE.PMREMGenerator(n);o.compileEquirectangularShader();var r=new THREE.RGBELoader;return r.setDataType(THREE.UnsignedByteType).setPath(e).load(t,(function(e){var t=o.fromEquirectangular(e).texture;o.dispose(),"function"==typeof i&&i(t,e,!0)})),r},l(e,null,[{key:"video",get:function(){return this.video_},set:function(e){if(this.video_&&(this.video_.pause(),this.video_.parentNode&&this.video_.parentNode.removeChild(this.video_),this.video_=null),e){var t=this.video_=document.createElement("video");t.loop=!0,t.playsInline=!0,t.crossOrigin="anonymous"}}},{key:"cubeRenderTarget",set:function(e){this.cubeRenderTarget_&&(this.cubeRenderTarget_.texture.dispose(),this.cubeRenderTarget_.dispose()),this.cubeRenderTarget_=e}},{key:"texture",set:function(e){this.texture_&&this.texture_.dispose(),this.texture_=e}}]),e}(),jn=function(e){function t(t,n){var i;return t=t||new THREE.BoxGeometry(5,5,5),n=n||new THREE.MeshBasicMaterial({color:16711935}),(i=e.call(this,t,n)||this).events={},i}h(t,e);var n=t.prototype;return n.on=function(e,t){var n=this,i=this.events[e]=this.events[e]||[];return i.push(t),function(){n.events[e]=i.filter((function(e){return e!==t}))}},n.off=function(e,t){var n=this.events[e];n&&(this.events[e]=n.filter((function(e){return e!==t})))},n.emit=function(e,t){var n=this.events[e];n&&n.forEach((function(e){e(t)}));var i=this.events.broadcast;i&&i.forEach((function(n){n(e,t)}))},t}(function(e){function t(t,n){var i;return t=t||new THREE.BoxGeometry(5,5,5),n=n||new THREE.MeshBasicMaterial({color:16711935}),(i=e.call(this,t,n)||this).freezed=!1,i}h(t,e),l(t,[{key:"freezed",get:function(){return this.freezed_},set:function(e){this.freezed_=e,this.children.filter((function(e){return e.__lookupGetter__("freezed")})).forEach((function(t){return t.freezed=e}))}}]);var n=t.prototype;return n.freeze=function(){this.freezed=!0},n.unfreeze=function(){this.freezed=!1},t}(THREE.Mesh)),Gn=function(){};Gn.items=[],Gn.hittest=function(e,t,n){var i=this;void 0===t&&(t=!1);var o=Vn.getService();this.down!==t&&(this.down=t,this.lock=!1);var r,s,a=this.items.filter((function(e){return!e.freezed})),u=e.intersectObjects(a),l={};u.forEach((function(e,t){var n=e.object;r=n.uuid,0===t&&(i.lastIntersectedObject!==n?(i.lastIntersectedObject=n,s=n,o.setMessage(s.name||s.id)):n.intersection&&(Math.abs(n.intersection.point.x-e.point.x)>.01||Math.abs(n.intersection.point.y-e.point.y)>.01)&&(n.intersection=e,n.emit("move",n))),l[r]=e})),0===u.length&&(this.lastIntersectedObject=null);return a.forEach((function(e){e.intersection=l[e.uuid],e.over=e===i.lastIntersectedObject||e.intersection&&!e.depthTest&&(!i.lastIntersectedObject||i.lastIntersectedObject.depthTest),e.down=t&&e.over&&!i.lock,e.down&&(i.lock=!0)})),s}.bind(Gn),Gn.dispose=function(e){if(e){var t=this.items.indexOf(e);-1!==t&&this.items.splice(t,1)}}.bind(Gn);var zn=function(e){function t(t,n){var i;return(i=e.call(this,t,n)||this).depthTest=!0,i.over_=!1,i.down_=!1,Gn.items.push(p(i)),i}return h(t,e),l(t,[{key:"over",get:function(){return this.over_},set:function(e){this.over_!=e&&(this.over_=e,e?this.emit("over",this):this.emit("out",this))}},{key:"down",get:function(){return this.down_},set:function(e){e=e&&this.over,this.down_!=e&&(this.down_=e,e?this.emit("down",this):this.emit("up",this))}}]),t}(jn);function qn(e,t,n,i,o,s,a,u,l){r.Texture.call(this,e,t,n,i,o,s,a,u,l),this.format=void 0!==a?a:THREE.RGBFormat,this.minFilter=void 0!==s?s:THREE.LinearFilter,this.magFilter=void 0!==o?o:THREE.LinearFilter,this.mapping=THREE.UVMapping,this.generateMipmaps=!1}qn.prototype=Object.assign(Object.create(r.Texture.prototype),{constructor:qn,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});var Nn=function(){function e(){this.tween=0,this.create()}var t=e.prototype;return t.create=function(){var e=new THREE.SphereBufferGeometry(101,60,40);e.scale(-1,1,1),e.rotateY(Math.PI);var t=new THREE.ShaderMaterial({depthWrite:!1,vertexShader:"\n#extension GL_EXT_frag_depth : enable\n\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\t// gl_PointSize = 8.0;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",fragmentShader:"\n#extension GL_EXT_frag_depth : enable\n\nvarying vec2 vUv;\nuniform vec2 resolution;\nuniform float tween;\nuniform bool rgbe;\nuniform sampler2D texture;\n\nvec3 ACESFilmicToneMapping_( vec3 color ) {\n\tcolor *= 1.8;\n\treturn saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );\n}\n\nvec4 getColor(vec2 p) {\n\treturn texture2D(texture, p);\n}\n\nvec3 encodeColor(vec4 color) {\n\treturn ACESFilmicToneMapping_(RGBEToLinear(color).rgb);\n}\n\nfloat rand(vec2 co){\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\nvec4 Blur(vec2 st, vec4 color) {\n\tconst float directions = 16.0;\n\tconst float quality = 3.0;\n\tfloat size = 16.0;\n\tconst float PI2 = 6.28318530718;\n\tconst float qq = 1.0;\n\tconst float q = 1.0 / quality;\n\tvec2 radius = size / resolution.xy;\n\tfor (float d = 0.0; d < PI2; d += PI2 / directions) {\n\t\tfor (float i = q; i <= qq; i += q) {\n\t\t\tvec2 dUv = vec2(cos(d), sin(d)) * radius * i;\n\t\t\tcolor += getColor(st + dUv);\n        }\n\t}\n\treturn color /= quality * directions - 15.0 + rand(st) * 4.0;\n}\n\nvoid main() {\n\tvec4 color = texture2D(texture, vUv);\n\t// color = Blur(vUv, color);\n\tif (rgbe) {\n\t\tcolor = vec4(encodeColor(color) * tween + rand(vUv) * 0.01, 1.0);\n\t} else {\n\t\tcolor = vec4(color.rgb * tween + rand(vUv) * 0.01, 1.0);\n\t}\n\tgl_FragColor = color;\n}\n",uniforms:{texture:{type:"t",value:null},resolution:{value:new THREE.Vector2},tween:{value:0},rgbe:{value:!1}}});(this.mesh=new zn(e,t)).name="[panorama]"},t.swap=function(e,t,n,i){var o=this,r=e instanceof Ve?e.tiles[e.index_]:e,s=this.mesh.material;this.tween>0?gsap.to(this,{duration:.5,tween:0,ease:Power2.easeInOut,onUpdate:function(){s.uniforms.tween.value=o.tween,s.needsUpdate=!0},onComplete:function(){"function"==typeof i&&i(e),o.load(r,t,(function(e,t,i){gsap.to(o,{duration:.5,tween:1,ease:Power2.easeInOut,onUpdate:function(){s.uniforms.tween.value=o.tween,s.needsUpdate=!0}}),"function"==typeof n&&n(e,t,i)}))}}):("function"==typeof i&&i(e),this.load(r,t,(function(e,t,i){gsap.to(o,{duration:.5,tween:1,ease:Power2.easeInOut,onUpdate:function(){s.uniforms.tween.value=o.tween,s.needsUpdate=!0}}),"function"==typeof n&&n(e,t,i)})))},t.change=function(e,t,n,i){var o=this,r=e instanceof Ve?e.tiles[e.index_]:e,s=this.mesh.material;setTimeout((function(){o.load(r,t,(function(t,r,a){setTimeout((function(){"function"==typeof i&&i(e),gsap.to(o,{duration:.5,tween:1,ease:Power2.easeInOut,onUpdate:function(){s.uniforms.tween.value=o.tween,s.needsUpdate=!0},onComplete:function(){setTimeout((function(){"function"==typeof n&&n(t,r,a)}),100)}})}),100)}))}),300)},t.crossfade=function(e,t,n){var i=this.mesh.material;this.load(e,t,(function(e,t,o){i.uniforms.tween.value=1,i.needsUpdate=!0,"function"==typeof n&&n(e,t,o)}))},t.load=function(e,t,n){var i=this.mesh.material;Fn.load(e,t,(function(e,t,o,r,s){i.uniforms.texture.value&&(i.uniforms.texture.value.dispose(),i.uniforms.texture.value=null),t.minFilter=THREE.LinearFilter,t.magFilter=THREE.LinearFilter,t.mapping=THREE.UVMapping,t.needsUpdate=!0,i.uniforms.texture.value=t,i.uniforms.resolution.value=new THREE.Vector2(t.width,t.height),i.uniforms.tween.value=0,i.uniforms.rgbe.value=o,i.needsUpdate=!0,"function"==typeof n&&n(e,t,o)}))},t.loadVideo=function(e){var t=document.createElement("video");t.src=e,t.muted=!0,t.playsinline=t.playsInline=!0,t.play(),this.setVideo(t)},t.setVideo=function(e){var t=this;if(e){e.crossOrigin="anonymous",e.oncanplay=function(){!function(){var n=new qn(e);n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.format=THREE.RGBFormat,n.needsUpdate=!0;var i=t.mesh.material;i.map=n,i.uniforms.texture.value=n,i.uniforms.resolution.value=new THREE.Vector2(n.width,n.height),i.needsUpdate=!0}()}}},e}(),Bn=function(){function e(e){this.x=0,this.y=0,this.top=0,this.right=0,this.bottom=0,this.left=0,this.width=0,this.height=0,this.set(e)}e.contains=function(e,t,n){return e.top<=n&&n<=e.bottom&&e.left<=t&&t<=e.right},e.intersectRect=function(e,t){return!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top)},e.fromNode=function(t){if(t){var n=t.rect_||(t.rect_=new e);if(!t.getClientRects().length)return n;var i=t.getBoundingClientRect();return n.x=i.left,n.y=i.top,n.top=i.top,n.left=i.left,n.width=i.width,n.height=i.height,n.right=n.left+n.width,n.bottom=n.top+n.height,n.setCenter(),n}};var t=e.prototype;return t.set=function(e){e&&(Object.assign(this,e),this.right=this.left+this.width,this.bottom=this.top+this.height),this.setCenter()},t.setSize=function(e,t){this.width=e,this.height=t,this.right=this.left+this.width,this.bottom=this.top+this.height,this.setCenter()},t.setCenter=function(){var e=this.center||(this.center={});e.top=this.top+this.height/2,e.left=this.left+this.width/2,e.x=e.left,e.y=e.top},t.contains=function(t,n){return e.contains(this,t,n)},t.intersect=function(t){return e.intersectRect(this,t)},t.intersection=function(e){var t=this.intersection_||(this.intersection_={left:0,top:0,width:0,height:0,x:0,y:0,pow:{x:-1,y:-1},offset:function(e){return e=e||0,(this.top-this.rect.height/2+e)/-this.height},scroll:function(e){return e=e||0,(this.top-this.rect.height/2+e)/-this.height}});t.left=this.left,t.top=this.top,t.width=this.width,t.height=this.height,t.x=this.left+this.width/2,t.y=this.top+this.height/2,t.rect=e;var n=t.offset(0);return t.pow.y=n,t},e}(),Wn=[16763904,65484,52479,13434624,13369599,16777215],Kn=function(){function e(e){var t=this.clientId=e.clientId,n=this.container=e.container,i=this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1,premultipliedAlpha:!0});i.setClearColor(0,1),i.setPixelRatio(window.devicePixelRatio),i.setSize(320,240),i.toneMapping=THREE.ACESFilmicToneMapping,i.toneMappingExposure=.8,i.outputEncoding=THREE.sRGBEncoding,n.appendChild(i.domElement);var o=this.camera=new THREE.PerspectiveCamera(70,320/240,.01,1e3);o.position.set(0,0,-.5),o.target=new THREE.Vector3,o.lookAt(o.target);var r=this.scene=new THREE.Scene,s=this.light=new THREE.PointLight(16777215,1,100);s.position.set(0,2,-2),r.add(s);var a=this.head=this.addHead();r.add(a);this.remote=O.getRemoteById(t)}l(e,null,[{key:"headGeometry",get:function(){return this.headGeometry_||(this.headGeometry_=new THREE.SphereBufferGeometry(.2,48,48)),this.headGeometry_}}]);var t=e.prototype;return t.addHead=function(){var t=e.headGeometry,n=this.canvas=document.createElement("canvas");n.width=1024,n.height=512;this.ctx=this.canvas.getContext("2d");var i=this.map=new THREE.CanvasTexture(n);i.offset.x=-.25;var o=Wn[this.clientId%Wn.length],r=new THREE.MeshStandardMaterial({map:i,color:o});return this.chalk(0),new THREE.Mesh(t,r)},t.render=function(){this.tick_?++this.tick_:this.tick_=1;if(this.remote){var e=12*this.remote.getAudioLevel();this.chalk(e)}var t=this.renderer,n=this.scene,i=this.camera;t.render(n,i)},t.update=function(e){var t=e.camera;this.head.quaternion.set(t[3],t[4],t[5],t[6])},t.dispose=function(){this.subscription&&this.subscription.unsubscribe()},t.chalk=function(e){e=(e+.5*Math.PI)%(2*Math.PI);var t=30*Math.sin(e),n=10*Math.cos(e),i=256,o=this.ctx;o.fillStyle="#888888",o.fillRect(0,0,1024,512),o.fillStyle="white",o.beginPath(),o.arc(472,206,7,0,2*Math.PI),o.arc(552,206,7,0,2*Math.PI),o.closePath(),o.fill(),o.beginPath(),o.moveTo(472-n,286),o.bezierCurveTo(472-n,316,552+n,316,552+n,286),o.bezierCurveTo(552+n,i+t,472-n,i+t,472-n,286),o.closePath(),o.fill(),this.map.needsUpdate=!0},e}(),Xn=function(e){function t(t,n,i,o,r){var s;return void 0===t&&(t=70),void 0===n&&(n=1),void 0===i&&(i=.01),void 0===o&&(o=1e3),(s=e.call(this,t,n,i,o)||this).target=new THREE.Vector3,s.box=new THREE.Group,s.add(s.box),s}return h(t,e),t}(THREE.PerspectiveCamera),Yn="panorama",Jn="model",Zn=function(){},Qn=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(Zn),ei=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(Zn),ti=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(Zn),ni=new ti,ii=new Qn,oi=new ei,ri=function(){var e=t.prototype;function t(e){this.mode_=t.mode=Yn,this.dolly_=70,this.zoom_=70,this.longitude=0,this.latitude=0,this.direction=1,this.radius=101,this.position=new THREE.Vector3,this.inertia=new THREE.Vector2,this.rotation=new THREE.Euler(0,0,0,"XYZ"),this.target=new THREE.Vector3,this.updatePosition=new THREE.Vector3,this.updateTarget=new THREE.Vector3,this.camera=e,this.setLongitudeLatitude(0,0),this.events$=new i.ReplaySubject(1)}return e.getDollyValue=function(){return 1-(this.dolly_-15)/60-.5},e.getZoomValue=function(){return 2-(this.zoom_-15)/60},l(t,[{key:"dolly",get:function(){return this.dolly_},set:function(e){var t=THREE.Math.clamp(e,15,75);this.dolly_!==t&&(this.dolly_=t,this.update())}},{key:"zoom",get:function(){return this.zoom_},set:function(e){var t=THREE.Math.clamp(e,15,75);this.zoom_!==t&&(this.zoom_=t,this.update())}},{key:"mode",get:function(){return this.mode_},set:function(e){this.mode_!==e&&(this.mode_=e,t.mode=e,this.update())}}]),e.setOrientation=function(e){e&&(this.setLongitudeLatitude(e.longitude,e.latitude),this.update())},e.getOrientation=function(){return{latitude:this.latitude,longitude:this.longitude}},e.setLongitudeLatitude=function(e,t){t=Math.max(-80,Math.min(80,t)),this.longitude=(e<0?360+e:e)%360,this.latitude=t;var n=THREE.Math.degToRad(90-t),i=THREE.Math.degToRad(e);this.phi=n,this.theta=i},e.observe$=function(e){var t,o,r=this;return i.combineLatest([nn.keys$(),Pn.observe$(e)]).pipe(n.filter((function(e){return!A.state.locked&&!A.state.spying})),n.map((function(e){var n=e[0],i=e[1];if(i instanceof $n)t=r.latitude,o=r.longitude;else if(i instanceof An)if(n.Shift)r.events$.next(ii);else if(n.Control)r.events$.next(oi);else{var s=r.mode_===Jn?-1:1;r.setLongitudeLatitude(o-.1*i.distance.x*s,t+.1*i.distance.y)}return i})),n.filter((function(e){return e instanceof An})),n.startWith({latitude:this.latitude,longitude:this.longitude}),n.tap((function(e){return r.update()})),n.switchMap((function(e){return r.events$})))},e.update=function(){var e,t=this.updatePosition,n=this.updateTarget,i=this.getZoomValue(),o=(this.getDollyValue(),THREE.MathUtils.degToRad(90-this.latitude)),r=THREE.MathUtils.degToRad(this.longitude),s=this.camera;switch(this.mode_){case Jn:e=3,t.copy(this.position),n.x=this.position.x+e*Math.sin(o)*Math.cos(r),n.y=this.position.y+e*Math.cos(o),n.z=this.position.z+e*Math.sin(o)*Math.sin(r),s.target.copy(t),s.position.copy(n);break;default:e=this.radius,n.x=this.position.x+e*Math.sin(o)*Math.cos(r),n.y=this.position.y+e*Math.cos(o),n.z=this.position.z+e*Math.sin(o)*Math.sin(r),t.copy(this.position),s.position.copy(t),s.target.copy(n)}s.zoom=i,s.lookAt(s.target),s.updateProjectionMatrix(),this.events$.next(ni)},e.inverse=function(){var e,t;switch(this.mode_){case Jn:t=3,e=this.camera.position;break;default:t=this.radius,e=this.camera.target}t=Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z);Math.acos(e.y/t),Math.atan2(e.z,e.x)},e.render=function(){this.longitude+=.025,this.update()},e.walk=function(e,t){var n,i=this;switch(this.mode_){case Jn:n=3;break;default:n=this.radius}var o=new THREE.Vector2(e.x,e.y).normalize().multiplyScalar(n),r=Math.atan2(o.y,o.x),s=THREE.MathUtils.radToDeg(r);s=(s<0?360+s:s)%360;var a=this.latitude,u=this.longitude,l=s-u;l=Math.abs(l)>180?l-l/Math.abs(l)*360:l;var c=0-a;c=Math.abs(c)>90?c-c/Math.abs(c)*90:c;var d={tween:0};gsap.to(d,{duration:.7,tween:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){i.setLongitudeLatitude(u+l*d.tween,a+c*d.tween),i.position.set(e.x*d.tween,0,e.y*d.tween),i.update()},onComplete:function(){"function"==typeof t&&t(s,0)}})},e.walkComplete=function(e,t){this.setLongitudeLatitude(e,t),this.position.set(0,0,0),this.update()},e.lookAt=function(e){if(e){var t,n=e.position;switch(this.mode_){case Jn:t=3;break;default:t=this.radius}var i=new THREE.Vector2(n.x,n.z).normalize().multiplyScalar(t),o=Math.atan2(i.y,i.x),r=THREE.MathUtils.radToDeg(o);r=(r<0?360+r:r)%360;this.setLongitudeLatitude(r,0),this.update()}},t}(),si=4/3,ai=[16777215,16763904,65484,52479,13434624,13369599],ui=function(){var e=t.prototype;function t(){var e=t.geometry,n=new THREE.MeshStandardMaterial({color:16777215,side:THREE.DoubleSide});this.plane=new THREE.Mesh(e,n)}return e.setRemote=function(e,t,n){var i=this;this.remote=e;var o,r,s,a,u,l,c;n<4?(r=0,s=t,l=0,c=(u=(a=.12*(o=1))/si)/2-n*u/2,this.plane.position.set(l,c+u*t,.005)):(o=.5,r=t%2,s=Math.floor(t/2),l=-(a=.12*o)/2,c=(u=a/si)/2-Math.ceil(n/2)*u/2,this.plane.position.set(l+r*a,c+s*u,.005)),this.plane.scale.set(o,o,o),"number"==typeof e?this.plane.material.color.set(ai[t%ai.length]):e.texture?(this.plane.material.map=e.texture,this.plane.material.needsUpdate=!0):this.addStreamTexture(e.getId(),(function(t){e.texture=t,i.plane.material.map=t,i.plane.material.needsUpdate=!0}))},e.addStreamTexture=function(e,t){var n="#stream-"+e,i=document.querySelector(n+" video");if(i){var o=function(){var e=new THREE.VideoTexture(i);e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.format=THREE.RGBFormat,e.needsUpdate=!0,"function"==typeof t&&t(e)};i.crossOrigin="anonymous",i.readyState>=i.HAVE_FUTURE_DATA?o():i.oncanplay=function(){o()}}},l(t,null,[{key:"geometry",get:function(){return new THREE.PlaneBufferGeometry(.12,.09,2,2)}}]),t}(),li=function(){function e(){var e=this,t=this.mesh=new THREE.Group,n=this.phone=this.create();t.add(n);this.streams=[];O.remotes$.subscribe((function(t){e.remotes=t}))}return l(e,[{key:"remotes",set:function(e){var t=this;e.forEach((function(n,i){var o=t.streams[i];o||(o=new ui),o.setRemote(n,i,e.length),t.phone.add(o.plane),t.streams[i]=o}));for(var n=e.length;n<this.streams.length;n++)this.phone.remove(this.streams[n].plane);this.streams.length=e.length}}]),e.prototype.create=function(){var e=new THREE.BoxBufferGeometry(.12,.27,.005,2,2,1),t=new THREE.MeshStandardMaterial({color:2105376}),n=new THREE.Mesh(e,t);return n.rotation.set(-Math.PI/4,0,0),n},e}(),ci=new THREE.Vector3,di=function(){function e(){var e=new THREE.PlaneBufferGeometry(1.2,1.2,2,2),t=(new THREE.TextureLoader).load(T.getPath("textures/ui/wall-nav.png")),n=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,map:t,transparent:!0,opacity:.9}),i=this.mesh=new THREE.Mesh(e,n);i.renderOrder=T.renderOrder.pointer,i.position.set(-1e5,-1e5,-1e5)}return e.prototype.update=function(){if(Gn.lastIntersectedObject){var e=this.mesh,t=Gn.lastIntersectedObject.intersection.point.multiplyScalar(.99);e.position.set(t.x,t.y,t.z);var n=e.position.length()/80;e.scale.set(n,n,n),e.lookAt(ci)}},e}(),hi={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};function pi(e){return fi.apply(this,arguments)}function fi(){return(fi=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:if((n=e.sent).ok){e.next=7;break}throw new Error(n.statusText);case 7:return e.abrupt("return",n.json());case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mi(e){return vi.apply(this,arguments)}function vi(){return(vi=a(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("No basePath supplied");case 2:return"profilesList.json",e.next=5,pi(t+"/profilesList.json");case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gi(){return(gi=a(regeneratorRuntime.mark((function e(t,n,i,o){var r,s,a,u,l,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===i&&(i=null),void 0===o&&(o=!0),t){e.next=4;break}throw new Error("No xrInputSource supplied");case 4:if(n){e.next=6;break}throw new Error("No basePath supplied");case 6:return e.next=8,mi(n);case 8:if(r=e.sent,t.profiles.some((function(e){var t=r[e];return t&&(s={profileId:e,profilePath:n+"/"+t.path,deprecated:!!t.deprecated}),!!s})),s){e.next=17;break}if(i){e.next=13;break}throw new Error("No matching profile name found");case 13:if(a=r[i]){e.next=16;break}throw new Error('No matching profile name found and default profile "'+i+'" missing.');case 16:s={profileId:i,profilePath:n+"/"+a.path,deprecated:!!a.deprecated};case 17:return e.next=19,pi(s.profilePath);case 19:if(u=e.sent,!o){e.next=25;break}if(c="any"===t.handedness?u.layouts[Object.keys(u.layouts)[0]]:u.layouts[t.handedness]){e.next=24;break}throw new Error("No matching handedness, "+t.handedness+", in profile "+s.profileId);case 24:c.assetPath&&(l=s.profilePath.replace("profile.json",c.assetPath));case 25:return e.abrupt("return",{profile:u,assetPath:l});case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var bi={xAxis:0,yAxis:0,button:0,state:hi.ComponentState.DEFAULT};var yi=function(){function e(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===hi.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(bi)}return e.prototype.updateFromComponent=function(e){var t=e.xAxis,n=e.yAxis,i=e.button,o=e.state,r=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0);var n=e,i=t;if(Math.sqrt(e*e+t*t)>1){var o=Math.atan2(t,e);n=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*i+.5}}(t,n),s=r.normalizedXAxis,a=r.normalizedYAxis;switch(this.componentProperty){case hi.ComponentProperty.X_AXIS:this.value=this.states.includes(o)?s:.5;break;case hi.ComponentProperty.Y_AXIS:this.value=this.states.includes(o)?a:.5;break;case hi.ComponentProperty.BUTTON:this.value=this.states.includes(o)?i:0;break;case hi.ComponentProperty.STATE:this.valueNodeProperty===hi.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(o):this.value=this.states.includes(o)?1:0;break;default:throw new Error("Unexpected visualResponse componentProperty "+this.componentProperty)}},e}(),wi=function(){function e(e,t){var n=this;if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach((function(e){var i=new yi(t.visualResponses[e]);n.visualResponses[e]=i})),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:hi.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}return e.prototype.updateFromGamepad=function(e){var t=this;if(this.values.state=hi.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){var n=e.buttons[this.gamepadIndices.button];this.values.button=n.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,n.pressed||1===this.values.button?this.values.state=hi.ComponentState.PRESSED:(n.touched||this.values.button>hi.ButtonTouchThreshold)&&(this.values.state=hi.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===hi.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>hi.AxisTouchThreshold&&(this.values.state=hi.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===hi.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>hi.AxisTouchThreshold&&(this.values.state=hi.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((function(e){e.updateFromComponent(t.values)}))},l(e,[{key:"data",get:function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({id:this.id},this.values)}}]),e}(),Ei=function(){function e(e,t,n){var i=this;if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=n,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((function(e){var t=i.layoutDescription.components[e];i.components[e]=new wi(e,t)})),this.updateFromGamepad()}return e.prototype.updateFromGamepad=function(){var e=this;Object.values(this.components).forEach((function(t){t.updateFromGamepad(e.xrInputSource.gamepad)}))},l(e,[{key:"gripSpace",get:function(){return this.xrInputSource.gripSpace}},{key:"targetRaySpace",get:function(){return this.xrInputSource.targetRaySpace}},{key:"data",get:function(){var e=[];return Object.values(this.components).forEach((function(t){e.push(t.data)})),e}}]),e}();function xi(){THREE.Object3D.call(this),this.motionController=null,this.envMap=null}function Ti(e,t){!function(e,t){Object.values(e.components).forEach((function(e){var n=e.type,i=e.touchPointNodeName,o=e.visualResponses;if(n===hi.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(i),e.touchPointNode){var r=new THREE.SphereGeometry(.001),s=new THREE.MeshBasicMaterial({color:255}),a=new THREE.Mesh(r,s);e.touchPointNode.add(a)}else console.warn("Could not find touch dot, "+e.touchPointNodeName+", in touchpad component "+e.id);Object.values(o).forEach((function(e){var n=e.valueNodeName,i=e.minNodeName,o=e.maxNodeName;if(e.valueNodeProperty===hi.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(i),e.maxNode=t.getObjectByName(o),!e.minNode)return void console.warn("Could not find "+i+" in the model");if(!e.maxNode)return void console.warn("Could not find "+o+" in the model")}e.valueNode=t.getObjectByName(n),e.valueNode||console.warn("Could not find "+n+" in the model")}))}))}(e.motionController,t),e.envMap&&t.traverse((function(t){t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)})),e.add(t)}xi.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:xi,setEnvironmentMap:function(e){var t=this;return this.envMap==e||(this.envMap=e,this.traverse((function(e){e.isMesh&&(e.material.envMap=t.envMap,e.material.needsUpdate=!0)}))),this},updateMatrixWorld:function(e){THREE.Object3D.prototype.updateMatrixWorld.call(this,e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((function(e){Object.values(e.visualResponses).forEach((function(e){var t=e.valueNode,n=e.minNode,i=e.maxNode,o=e.value,r=e.valueNodeProperty;t&&(r===hi.VisualResponseProperty.VISIBILITY?t.visible=o:r===hi.VisualResponseProperty.TRANSFORM&&(THREE.Quaternion.slerp(n.quaternion,i.quaternion,t.quaternion,o),t.position.lerpVectors(n.position,i.position,o)))}))})))}});var Ri=function(){function e(e){void 0===e&&(e=null),this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new THREE.GLTFLoader)}return e.prototype={constructor:e,createControllerModel:function(e){var t=this,n=new xi,i=null;return e.addEventListener("connected",(function(e){var o=e.data;"tracked-pointer"===o.targetRayMode&&o.gamepad&&function(e,t,n,i){return gi.apply(this,arguments)}(o,t.path,"generic-trigger").then((function(e){var r=e.profile,s=e.assetPath;n.motionController=new Ei(o,r,s);var a=t._assetCache[n.motionController.assetUrl];if(a)i=a.scene.clone(),Ti(n,i);else{if(!t.gltfLoader)throw new Error("GLTFLoader not set.");t.gltfLoader.setPath(""),t.gltfLoader.load(n.motionController.assetUrl,(function(e){t._assetCache[n.motionController.assetUrl]=e,i=e.scene.clone(),Ti(n,i)}),null,(function(){throw new Error("Asset "+n.motionController.assetUrl+" missing or malformed.")}))}})).catch((function(e){console.warn(e)}))})),e.addEventListener("disconnected",(function(){n.motionController=null,n.remove(i),i=null})),n}},e}(),Si=new THREE.Vector3,Ci={title:"loading"},Ii={title:"waiting host"},ki=function(t){function i(){return t.apply(this,arguments)||this}h(i,t);var o=i.prototype;return o.onInit=function(){var e=this;this.index=0,this.error_=null,this.loading=null,this.waiting=null,this.avatars={},this.createScene(),this.setView(),this.addListeners(),this.animate(),nn.keys$().pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.keys=t}))},o.onChanges=function(){if(this.view){var e=this.view.items.find((function(e){return e.selected}));e&&e.mesh&&this.orbit.lookAt(e.mesh)}},o.onDestroy=function(){this.removeListeners(),this.renderer.setAnimationLoop((function(){}))},o.createScene=function(){var t=e.getContext(this).node;this.size={left:0,top:0,width:0,height:0,aspect:0},this.mouse=new THREE.Vector2,this.controllerMatrix_=new THREE.Matrix4,this.controllerWorldPosition_=new THREE.Vector3,this.controllerWorldDirection_=new THREE.Vector3;var n=this.container=t,i=(this.info=t.querySelector(".world__info"),this.worldRect=Bn.fromNode(n),this.cameraRect=new Bn,this.cameraGroup=new THREE.Group),o=this.camera=new Xn(70,n.offsetWidth/n.offsetHeight,.01,1e3);i.add(o),i.target=new THREE.Vector3;this.orbit=new ri(o);var r=this.renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!1,premultipliedAlpha:!0,logarithmicDepthBuffer:!0});r.setClearColor(0,1),r.setPixelRatio(window.devicePixelRatio),r.setSize(n.offsetWidth,n.offsetHeight),r.xr.enabled=!0,r.toneMapping=THREE.ACESFilmicToneMapping,r.toneMappingExposure=.8,r.outputEncoding=THREE.sRGBEncoding,n.childElementCount>0?n.insertBefore(r.domElement,n.children[0]):n.appendChild(r.domElement),(this.raycaster=new THREE.Raycaster).setFromCamera(this.mouse,o);var s=this.scene=new THREE.Scene;s.add(i);var a=this.panorama=new Nn;s.add(a.mesh);this.pointer=new di;var u=new THREE.PointLight(16777215);u.position.set(-50,0,-50),s.add(u);var l=new THREE.DirectionalLight(16770713,5);l.position.set(5,-5,5),l.target.position.set(0,0,0),s.add(l);var c=new THREE.AmbientLight(1052688);s.add(c);var d=this.objects=new THREE.Group;d.name="[objects]",s.add(d),this.addControllers(),this.resize()},o.addOffCanvasScene=function(e){var t=new Kn(e);this.avatars[e.clientId]=t},o.removeOffCanvasScene=function(e){this.avatars[e.clientId];delete this.avatars[e.clientId]},o.updateOffCanvasScene=function(e){var t=this.avatars[e.clientId];t&&t.update(e)},o.setViewOrientation=function(e){this.orbit&&(this.orbit.mode=e.type.name,this.renderer.xr.isPresenting||(this.infoResultMessage?(this.orbit.setOrientation(this.infoResultMessage.orientation),this.orbit.zoom=this.infoResultMessage.zoom,this.camera.updateProjectionMatrix()):(this.orbit.setOrientation(e.orientation),this.orbit.zoom=e.zoom,this.camera.updateProjectionMatrix())))},o.setView=function(){var e=this;if(this.panorama){var t=this.view_;t&&(this.infoResultMessage&&t instanceof Ve&&message.gridIndex&&(t.index_=message.gridIndex),t.ready=!1,this.loading=Ci,this.waiting=null,this.pushChanges(),this.panorama.change(t,this.renderer,(function(n,i,o){e.scene.environment=n,t.ready=!0,e.waiting=t&&"waiting-room"===t.type.name?Ii:null,e.pushChanges()}),(function(t){e.setViewOrientation(t),e.loading=null,e.pushChanges()})),this.infoResultMessage=null)}},o.addControllers=function(){var e=this,t=this.renderer,n=this.scene,i=this.controllerGroup=new THREE.Group,o=this.controller1=t.xr.getController(0);o.name="[controller1]",this.onSelect1Start=this.onSelect1Start.bind(this),this.onSelect1End=this.onSelect1End.bind(this),o.addEventListener("selectstart",this.onSelect1Start),o.addEventListener("selectend",this.onSelect1End),o.addEventListener("connected",(function(t){o.add(e.buildController(t.data))})),o.addEventListener("disconnected",(function(){for(;o.children.length;)o.remove(o.children[0])})),i.add(o);var r=this.controller2=t.xr.getController(1);r.name="[controller2]",this.onSelect2Start=this.onSelect2Start.bind(this),this.onSelect2End=this.onSelect2End.bind(this),r.addEventListener("selectstart",this.onSelect2Start),r.addEventListener("selectend",this.onSelect2End),r.addEventListener("connected",(function(t){r.add(e.buildController(t.data));var n=e.phone=new li;r.add(n.mesh)})),r.addEventListener("disconnected",(function(){for(;r.children.length;)r.remove(r.children[0])})),i.add(r),this.controllers=[this.controller1,this.controller2];var s=new Ri,a=this.controllerGrip1=t.xr.getControllerGrip(0);a.name="[controller-grip1]",a.add(s.createControllerModel(a)),i.add(a),n.add(i)},o.buildController=function(e){var t,n;switch(e.targetRayMode){case"tracked-pointer":return(t=new THREE.BufferGeometry).setAttribute("position",new THREE.Float32BufferAttribute([0,0,0,0,0,-1],3)),t.setAttribute("color",new THREE.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),n=new THREE.LineBasicMaterial({vertexColors:!0,blending:THREE.AdditiveBlending}),new THREE.Line(t,n);case"gaze":return t=new THREE.RingBufferGeometry(.02,.04,32).translate(0,0,-1),n=new THREE.MeshBasicMaterial({opacity:.5,transparent:!0}),new THREE.Mesh(t,n)}},o.onSelect1Start=function(){this.controller1.userData.isSelecting=!0,this.controller=this.controller1},o.onSelect1End=function(){this.controller1.userData.isSelecting=!1},o.onSelect2Start=function(){this.controller2.userData.isSelecting=!0,this.controller=this.controller2},o.onSelect2End=function(){this.controller2.userData.isSelecting=!1},o.onTween=function(){},o.onSlideChange=function(e){this.index=e,this.slideChange.next(e)},o.updateRaycasterXR=function(e,t){if(e)return this.controllerMatrix_.identity().extractRotation(e.matrixWorld),t.ray.origin.setFromMatrixPosition(e.matrixWorld),t.ray.direction.set(0,0,-1).applyMatrix4(this.controllerMatrix_),t},o.raycasterHitTest=function(){try{if(this.renderer.xr.isPresenting){var e=this.updateRaycasterXR(this.controller,this.raycaster);if(e){Gn.hittest(e,this.controller.userData.isSelecting);this.pointer.update()}}else if(!this.dragItem&&!this.resizeItem){var t=this.raycaster;if(t)Gn.hittest(t)}}catch(e){this.error=e}},o.repos=function(e,t){var n=this.worldRect;e.scale.set(.8,.8,.8);var i=(t.x+t.width/2-n.width/2)/n.width*2*this.camera.aspect,o=(t.y+t.height/2-n.height/2)/n.height*2*this.camera.aspect;e.position.set(i,-o,0)},o.render=function(e){var t=this;try{var n=this.renderer,i=(this.scene,this.camera,performance.now()),o=this.tick_?++this.tick_:this.tick_=1;this.raycasterHitTest(),this.scene.traverse((function(e){"function"==typeof e.userData.render&&e.userData.render(i,o)})),this.vrService.updateState(this),Object.keys(this.avatars).forEach((function(e){t.avatars[e].render()})),n.xr.isPresenting&&gsap.ticker.tick(),n.render(this.scene,this.camera),this.state&&!this.state.hosted&&this.orbit.render()}catch(e){this.error=e}},o.animate=function(){this.renderer.setAnimationLoop(this.render)},o.resize=function(){try{var e=this.container,t=this.renderer,n=this.camera,i=this.size,o=e.getBoundingClientRect();if(i.left=Math.floor(o.left),i.top=Math.floor(o.top),i.width=Math.ceil(o.width),i.height=Math.ceil(o.height),i.aspect=i.width/i.height,this.worldRect.setSize(i.width,i.height),!t.xr.isPresenting&&(t.setSize(i.width,i.height),n)){n.aspect=i.width/i.height;var r=n.fov*Math.PI/180,s=Math.abs(n.position.z*Math.tan(r/2)*2),a=this.cameraRect;a.width=s*n.aspect,a.height=s,n.updateProjectionMatrix()}}catch(e){this.error=e}},o.updateRaycasterMouse=function(e){var t=this.size.width/2,n=this.size.height/2;this.mouse.x=(e.clientX-this.size.left-t)/t,this.mouse.y=-(e.clientY-this.size.top-n)/n;var i=this.raycaster;return i.setFromCamera(this.mouse,this.camera),i},o.onMouseDown=function(e){try{if(0!==e.button)return;var t=this.updateRaycasterMouse(e);Gn.hittest(t,!0);if(this.editor||m)if(this.keys.Shift||this.keys.Control);else if(this.select.next({item:null}),this.panorama.mesh.intersection){var n=(new THREE.Vector3).copy(this.panorama.mesh.intersection.point).normalize();console.log(JSON.stringify({position:n.toArray()})),this.viewHit.next(n)}}catch(e){this.error=e}},o.onMouseMove=function(e){try{var t=this.updateRaycasterMouse(e);if(this.lockedOrXR)return;if(this.dragItem){if("function"==typeof this.dragItem.onDragMove){var n=t.intersectObjects([this.panorama.mesh]);if(n.length){var i=n[0],o=(new THREE.Vector3).copy(i.point).normalize();this.dragItem.onDragMove(o)}}}else this.resizeItem&&this.resizeItem.onResizeMove}catch(e){this.error=e}},o.onMouseUp=function(e){try{if(this.lockedOrXR)return;this.dragItem&&"function"==typeof this.dragItem.onDragEnd&&(this.dragItem.onDragEnd(),this.dragEnd.next(this.dragItem)),this.dragItem=null,this.resizeItem&&"function"==typeof this.resizeItem.onResizeEnd&&(this.resizeItem.onResizeEnd(),this.resizeEnd.next(this.resizeItem)),this.resizeItem=null}catch(e){this.error=e}},o.onMouseWheel=function(e){try{if(this.lockedOrXR)return;var t=this.orbit;gsap.to(t,{duration:.5,zoom:t.zoom+.1*e.deltaY,ease:Power4.easeOut,overwrite:!0})}catch(e){this.error=e}},o.onOrientationDidChange=function(){P.send({type:ie,orientation:this.orbit.getOrientation(),zoom:this.orbit.zoom})},o.onVRStarted=function(){this.scene.add(this.pointer.mesh),P.send({type:se})},o.onVREnded=function(){this.scene.remove(this.pointer.mesh),P.send({type:ae})},o.onVRStateDidChange=function(e){P.send({type:ue,camera:e.camera.array})},o.onMenuNav=function(e){this.menu=void 0,this.navTo.next(e.id)},o.onMenuToggle=function(e){this.locked||(this.menu=e,this.view.items.forEach((function(e){return e.showPanel=!1})),this.pushChanges())},o.onNavOver=function(e){this.menu||(this.view.items.forEach((function(e){return e.showPanel=!1})),e.item.showPanel=e.item.hasPanel,this.pushChanges())},o.onNavOut=function(e){this.pushChanges()},o.onNavDown=function(e){e.item.showPanel=!1,this.locked||(this.editor&&this.keys.Shift?(this.dragItem=e,this.select.next(e)):this.editor&&this.keys.Control?(this.resizeItem=e,this.select.next(e)):this.navTo.next(e.item.viewId))},o.onPlaneDown=function(e){this.lockedOrXR||(this.editor&&this.keys.Shift?(this.dragItem=e,this.select.next(e)):this.editor&&this.keys.Control&&(this.resizeItem=e,this.select.next(e)))},o.onPanelDown=function(e){var t=e.getAttribute("href");e.getAttribute("target");t&&window.open(t,"_blank")},o.onGridMove=function(e){var t=this;this.locked||(this.view.items=[],this.pushChanges(),this.orbit.walk(e.position,(function(n,i){var o=t.view.getTile(e.indices.x,e.indices.y);o&&t.panorama.crossfade(o,t.renderer,(function(e,o,r){t.scene.environment=e,t.orbit.walkComplete(n,i),t.view.updateCurrentItems(),t.pushChanges()}))})))},o.onGridNav=function(e){this.locked||(P.send({type:re,viewId:this.view.id,gridIndex:e}),this.pushChanges())},o.addListeners=function(){var e=this;this.resize=this.resize.bind(this),this.render=this.render.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),window.addEventListener("resize",this.resize,!1),this.container.addEventListener("wheel",this.onMouseWheel,!1),this.container.addEventListener("mousedown",this.onMouseDown,!1),this.container.addEventListener("mouseup",this.onMouseUp,!1),document.addEventListener("mousemove",this.onMouseMove,!1);var t=this.vrService=tt.getService();t.session$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.renderer.xr.setSession(t),t?e.onVRStarted():e.onVREnded()})),t.state$.pipe(n.takeUntil(this.unsubscribe$),n.auditTime(Math.floor(1e3/15))).subscribe((function(t){e.onVRStateDidChange(t)})),this.orbit.observe$(this.container).pipe(n.shareReplay(1)).pipe(n.filter((function(e){return e instanceof ti})),n.auditTime(Math.floor(1e3/15))).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.onOrientationDidChange()})),P.out$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){switch(t.type){case G:break;case Y:t.type=J,t.viewId=e.view.id,t.orientation=e.orbit.getOrientation(),t.zoom=e.orbit.zoom,e.view instanceof Ve&&(t.gridIndex=e.view.index),P.sendBack(t);break;case q:t={type:oe,viewId:e.view.id},e.view instanceof Ve&&(t.gridIndex=e.view.index),P.send(t);break;case J:t.viewId===e.view.id?(e.orbit.setOrientation(t.orientation),e.renderer.xr.isPresenting||(e.orbit.zoom=t.zoom,e.camera.updateProjectionMatrix()),e.view instanceof Ve&&t.gridIndex&&(e.view.index=t.gridIndex)):e.infoResultMessage=t;break;case ie:e.orbit.setOrientation(t.orientation),e.renderer.xr.isPresenting||(e.orbit.zoom=t.zoom);break;case ne:if(!e.renderer.xr.isPresenting){var n=e.camera;n.position.set(t.coords[0],t.coords[1],t.coords[2]),n.lookAt(Si)}break;case re:e.view.id===t.viewId&&(e.view.index=t.gridIndex);break;case se:e.addOffCanvasScene(t);break;case ae:e.removeOffCanvasScene(t);break;case ue:e.updateOffCanvasScene(t)}})),A.state$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(t){e.state=t}))},o.removeListeners=function(){window.removeEventListener("resize",this.resize,!1),window.removeEventListener("resize",this.resize,!1),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("wheel",this.onMouseWheel,!1),this.container.removeEventListener("mousedown",this.onMouseDown,!1),this.container.removeEventListener("mouseup",this.onMouseUp,!1)},l(i,[{key:"error",get:function(){return this.error_},set:function(e){this.error_!==e&&(this.error_=e,this.pushChanges())}},{key:"view",get:function(){return this.view_},set:function(e){this.view_!==e&&(this.view_=e,this.setView())}},{key:"debugging",get:function(){return m}},{key:"locked",get:function(){return this.state.locked||this.state.spying}},{key:"lockedOrXR",get:function(){return this.locked||this.renderer.xr.isPresenting}}]),i}(e.Component);ki.meta={selector:"[world]",inputs:["view","views","editor"],outputs:["slideChange","navTo","viewHit","dragEnd","resizeEnd","select"]};var Mi=function(e){function t(t){var n;return(n=e.call(this,t)||this).depthTest=!0,n.over_=!1,n.down_=!1,Gn.items.push(p(n)),n}return h(t,e),l(t,[{key:"over",get:function(){return this.over_},set:function(e){this.over_!=e&&(this.over_=e,e?this.emit("over",this):this.emit("out",this))}},{key:"down",get:function(){return this.down_},set:function(e){e=e&&this.over,this.down_!=e&&(this.down_=e,e?this.emit("down",this):this.emit("up",this))}}]),t}(function(e){function t(t){var n;return t=t||new THREE.SpriteMaterial({color:16711935}),(n=e.call(this,t)||this).events={},n}h(t,e);var n=t.prototype;return n.on=function(e,t){var n=this,i=this.events[e]=this.events[e]||[];return i.push(t),function(){n.events[e]=i.filter((function(e){return e!==t}))}},n.off=function(e,t){var n=this.events[e];n&&(this.events[e]=n.filter((function(e){return e!==t})))},n.emit=function(e,t){var n=this.events[e];n&&n.forEach((function(e){e(t)}));var i=this.events.broadcast;i&&i.forEach((function(n){n(e,t)}))},t}(function(e){function t(t){var n;return t=t||new THREE.SpriteMaterial({color:16711935}),(n=e.call(this,t)||this).freezed=!1,n}h(t,e),l(t,[{key:"freezed",get:function(){return this.freezed_},set:function(e){this.freezed_=e,this.children.filter((function(e){return e.__lookupGetter__("freezed")})).forEach((function(t){return t.freezed=e}))}}]);var n=t.prototype;return n.freeze=function(){this.freezed=!0},n.unfreeze=function(){this.freezed=!1},t}(THREE.Sprite))),$i=(THREE.Math.degToRad,new THREE.BoxGeometry(1,1,1)),Ai=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var i=n.prototype;return i.onInit=function(){var e=this;if(!this.host)throw"ModelComponent host is undefined";this.scale=new THREE.Vector3(1,1,1),this.position=new THREE.Vector3;var t=this.group=new THREE.Group;t.name=this.getName(),t.userData.render=function(t,n){e.render(e,t,n)},this.host.objects.add(t),this.onCreate((function(t,n){return e.onMount(t,n)}),(function(t,n){return e.onDismount(t,n)}))},i.onDestroy=function(){var e=this.group;this.host.objects.remove(e),delete e.userData.render,e.traverse((function(e){(e instanceof zn||e instanceof Mi)&&Gn.dispose(e),e.isMesh?(e.material.map&&!1!==e.material.map.disposable&&e.material.map.dispose(),e.material.dispose(),e.geometry.dispose()):e.isSprite&&(e.material.map&&!1!==e.material.map.disposable&&e.material.map.dispose(),e.material.dispose())})),this.group=null},i.getName=function(e){return this.constructor.meta.selector+"-"+this.rxcompId+(e?"-"+e:"")},i.onCreate=function(e,t){var n=new THREE.MeshStandardMaterial({color:new THREE.Color("#ffcc00"),roughness:.4,metalness:.01,flatShading:!0,transparent:!0,opacity:.9}),i=new THREE.Mesh($i,n);return"function"==typeof e&&e(i),i},i.onMount=function(e,t){var n=this;this.mesh&&this.onDismount(this.mesh),e.name=this.getName("mesh"),this.mesh=e,t&&(t.mesh=e,t.onUpdate=function(){n.onUpdate(t,e)},t.onUpdateAsset=function(){n.onUpdateAsset(t,e)}),this.group.add(e)},i.onDismount=function(e,t){this.group.remove(e),"function"==typeof e.dispose&&e.dispose(),this.mesh=null,t&&(delete t.mesh,delete t.onUpdate,delete t.onUpdateAsset)},i.calculateScaleAndPosition=function(){var t=e.getContext(this).node;this.host.repos(this,t.getBoundingClientRect())},i.render=function(e,t){this.calculateScaleAndPosition();var n=this.group,i=(this.scale,this.position);n.position.set(i.x,0,0)},i.getScroll=function(e){return this.intersection.scroll(e)},i.getTween=function(e){var t=Math.min(0,this.intersection.offset(e))+1;return t=Math.max(0,t),t-=1},i.onUpdate=function(e,t){},i.onUpdateAsset=function(e,t){},l(n,[{key:"renderOrder",set:function(e){this.group.renderOrder=e}}]),n}(e.Component);Ai.meta={selector:"[model]",hosts:{host:ki},inputs:["item"]};var Hi=100.99,Pi=(new THREE.Vector3,function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var i=n.prototype;return i.onInit=function(){t.prototype.onInit.call(this)},i.onView=function(){var e=this;this.banners||this.getCanvasTexture().then((function(t){var n=t.map;n.wrapS=n.wrapY=THREE.RepeatWrapping,n.repeat.x=3,n.encoding=THREE.sRGBEncoding;var i=3*t.width/t.height,o=Math.PI/180*45,r=Hi*o/i,s=new THREE.CylinderBufferGeometry(Hi,Hi,r,20,2,!0,0,o);s.scale(-1,1,1);var a=new THREE.MeshBasicMaterial({map:n,transparent:!0,opacity:0}),u=e.mesh;(e.banners=new Array(4).fill(0).map((function(e){return new THREE.Mesh(s,a)}))).forEach((function(e,t){e.rotation.y=Math.PI/2*t,u.add(e)}));var l={value:0};gsap.to(l,{duration:.5,value:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){a.opacity=l.value,a.needsUpdate=!0}}),u.userData={render:function(){u.rotation.y+=Math.PI/180*.2,n.offset.x=(n.offset.x-.01)%1,a.needsUpdate=!0}}}))},i.onCreate=function(e,t){var n=new THREE.Group;n.userData={render:function(){n.rotation.y+=Math.PI/180*.1}},"function"==typeof e&&e(n)},i.getCanvasTexture=function(){var t=this;return new Promise((function(n,i){if(t.item.bannerTexture)n(t.item.bannerTexture);else{var r=e.getContext(t).node;setTimeout((function(){o(r,{backgroundColor:"#000000ff",scale:2}).then((function(e){var i=new THREE.CanvasTexture(e);t.item.bannerTexture={map:i,width:e.width,height:e.height},n(t.item.bannerTexture)}),(function(e){i(e)}))}),1)}}))},n}(Ai));Pi.ORIGIN=new THREE.Vector3,Pi.meta={selector:"[model-banner]",hosts:{host:ki},inputs:["item"]};var Oi=function(e,t){this.src=e,this.id=t},Ui=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(Oi),_i=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(Oi),Li=function(){function e(e){this.item=e,this.toggle=this.toggle.bind(this)}e.getLoader=function(){return e.loader||(e.loader=new THREE.TextureLoader)},e.getPath=function(e){return T.getPath(e.asset.folder+e.asset.file)},e.loadTexture=function(t,n){var i=e.getPath(t);return e.getLoader().load(i,n)},e.isVideo=function(e){return e.asset&&e.asset.file&&(-1!==e.asset.file.indexOf(".mp4")||-1!==e.asset.file.indexOf(".webm"))},e.isPublisherStream=function(e){return e.asset&&"publisherStream"===e.asset.file},e.isNextAttendeeStream=function(e){return e.asset&&"nextAttendeeStream"===e.asset.file},l(e,[{key:"isVideo",get:function(){return e.isVideo(this.item)}},{key:"isPublisherStream",get:function(){return e.isPublisherStream(this.item)}},{key:"isNextAttendeeStream",get:function(){return e.isNextAttendeeStream(this.item)}},{key:"isPlayableVideo",get:function(){return this.isVideo&&!this.item.asset.autoplay}},{key:"isAutoplayVideo",get:function(){return this.isPublisherStream||this.isNextAttendeeStream||this.isVideo&&null!=this.item.asset.autoplay}}]);var t=e.prototype;return t.load=function(t){var n,i=this,o=this.item;if((this.isPublisherStream||this.isNextAttendeeStream)&&o.streamId){var r="#stream-"+o.streamId,s=document.querySelector(r+" video");if(!s)return;var a=function e(){s.removeEventListener("canplay",e),(n=i.texture=new THREE.VideoTexture(s)).minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.format=THREE.RGBFormat,n.needsUpdate=!0,"function"==typeof t&&t(n,i)};s.crossOrigin="anonymous",s.readyState>=s.HAVE_FUTURE_DATA?a():s.addEventListener("canplay",a)}else if(this.isVideo){var u=this.video=document.createElement("video");u.preload="metadata",u.volume=.5,u.muted=!0,u.playsinline=u.playsInline=!0,o.asset&&o.asset.autoplay&&(u.loop=!0),u.crossOrigin="anonymous";u.oncanplay=function(){u.oncanplay=null,(n=new THREE.VideoTexture(u)).minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.format=THREE.RGBFormat,n.needsUpdate=!0,o.asset&&o.asset.autoplay||u.pause(),"function"==typeof t&&t(n,i)},u.src=e.getPath(o),u.load(),this.play(!0)}else o.asset?e.loadTexture(o,(function(e){e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,"function"==typeof t&&t(e,i)})):t(null,this);return this},t.play=function(t){var n=this;this.video&&(this.video.play().then((function(){}),(function(e){console.log("MediaLoader.play.error",n.item.asset.file,e)})),t||e.events$.next(new Ui(this.video.src,this.item.id)))},t.pause=function(t){this.video&&(this.video.muted=!0,this.video.pause(),t||e.events$.next(new _i(this.video.src,this.item.id)))},t.toggle=function(){if(this.video)return this.video.paused?(this.video.muted=!1,this.play(),!0):(this.pause(),!1)},t.dispose=function(){this.isVideo&&(this.pause(),delete this.video)},e}();Li.events$=new i.ReplaySubject(1);var Di="\n#extension GL_EXT_frag_depth : enable\n\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",Vi="\n#extension GL_EXT_frag_depth : enable\n\n#define threshold 0.55\n#define padding 0.05\n\nvarying vec2 vUv;\nuniform bool video;\nuniform float opacity;\nuniform float overlay;\nuniform float tween;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform vec2 resolutionA;\nuniform vec2 resolutionB;\nuniform vec3 chromaKeyColor;\nuniform vec3 overlayColor;\n\nvoid main() {\n\tvec4 color;\n\tvec4 colorA = texture2D(textureA, vUv);\n\tvec4 chromaKey = vec4(chromaKeyColor, 1.0);\n    vec3 chromaKeyDiff = colorA.rgb - chromaKey.rgb;\n    float chromaKeyValue = smoothstep(threshold - padding, threshold + padding, dot(chromaKeyDiff, chromaKeyDiff));\n\tcolor = vec4(colorA.rgb + (overlayColor * overlay * 0.2), opacity * chromaKeyValue);\n\tgl_FragColor = color;\n}\n",Fi=function(e){function t(n,i,o){var r,s=t.getMaterialByItem(n);(r=e.call(this,o,s)||this).item=n,r.items=i,r.renderOrder=T.renderOrder.plane,r.uniforms=t.getUniformsByItem(n);r.mediaLoader=new Li(n);return r}h(t,e),t.getMaterial=function(e){return new THREE.ShaderMaterial({depthTest:!1,depthWrite:!1,transparent:!0,vertexShader:Di,fragmentShader:e?Vi:"\n#extension GL_EXT_frag_depth : enable\n\nvarying vec2 vUv;\nuniform bool video;\nuniform float opacity;\nuniform float overlay;\nuniform float tween;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform vec2 resolutionA;\nuniform vec2 resolutionB;\nuniform vec3 overlayColor;\n\nvoid main() {\n\tvec4 color;\n\tvec4 colorA = texture2D(textureA, vUv);\n\tif (video) {\n\t\tvec4 colorB = texture2D(textureB, vUv);\n\t\tcolor = vec4(colorA.rgb + (overlayColor * overlay * 0.2) + (colorB.rgb * tween * colorB.a), opacity);\n\t} else {\n\t\tcolor = vec4(colorA.rgb + (overlayColor * overlay * 0.2), opacity);\n\t}\n\tgl_FragColor = color;\n}\n",uniforms:{video:{value:!1},textureA:{type:"t",value:null},textureB:{type:"t",value:null},resolutionA:{value:new THREE.Vector2},resolutionB:{value:new THREE.Vector2},overlayColor:{value:new THREE.Color("#ffffff")},overlay:{value:0},tween:{value:1},opacity:{value:0}}})},t.getChromaKeyMaterial=function(e){return void 0===e&&(e=[0,1,0]),new THREE.ShaderMaterial({depthTest:!1,depthWrite:!1,transparent:!0,vertexShader:Di,fragmentShader:Vi,uniforms:{video:{value:!1},textureA:{type:"t",value:null},textureB:{type:"t",value:null},resolutionA:{value:new THREE.Vector2},resolutionB:{value:new THREE.Vector2},chromaKeyColor:{value:new THREE.Vector3(e[0],e[1],e[2])},overlayColor:{value:new THREE.Color("#ffffff")},overlay:{value:0},tween:{value:1},opacity:{value:0}},side:THREE.DoubleSide})},t.getStreamId$=function(e){if(!e.asset)return i.of(null);var t=e.asset.file;return"publisherStream"!==t&&"nextAttendeeStream"!==t?i.of(t):O.streams$.pipe(n.map((function(n){var i;if("publisherStream"===t)i=n.find((function(e){return e.clientInfo&&e.clientInfo.role===S.Publisher}));else if("nextAttendeeStream"===t){var o=0;n.forEach((function(t){t.clientInfo&&t.clientInfo.role===S.Attendee&&(o===e.asset.index&&(i=t),o++)}))}return i?i.getId():null})))},t.getMaterialByItem=function(e){return e.asset&&e.asset.chromaKeyColor?t.getChromaKeyMaterial(e.asset.chromaKeyColor):e.asset?t.getMaterial():new THREE.MeshBasicMaterial({color:8947848})},t.getUniformsByItem=function(e){var t=null;return e.asset&&(t={overlay:0,tween:1,opacity:0}),t};var o=t.prototype;return o.load=function(e){var t=this;if(!this.item.asset)return this.onAppear(),void("function"==typeof e&&e(this));var n=this.material,i=this.mediaLoader;i.load((function(o){o&&(n.uniforms.textureA.value=o,n.uniforms.resolutionA.value=new THREE.Vector2(o.image.width||o.image.videoWidth,o.image.height||o.image.videoHeight),n.needsUpdate=!0,i.isPlayableVideo&&t.createTextureB(o,(function(e){e.minFilter=THREE.LinearFilter,e.magFilter=THREE.LinearFilter,e.mapping=THREE.UVMapping,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,n.uniforms.textureB.value=e,n.uniforms.resolutionB.value=new THREE.Vector2(e.image.width,e.image.height),n.needsUpdate=!0}))),t.onAppear(),i.isPlayableVideo&&(n.uniforms.video.value=!0,t.onOver=t.onOver.bind(t),t.onOut=t.onOut.bind(t),t.onToggle=t.onToggle.bind(t),t.on("over",t.onOver),t.on("out",t.onOut),t.on("down",t.onToggle)),"function"==typeof e&&e(t)}))},o.createTextureB=function(e,t){var n=e.image.width||e.image.videoWidth,i=e.image.height||e.image.videoHeight,o=n/i,r=document.createElement("canvas");r.width=n,r.height=i;var s=r.getContext("2d");s.imageSmoothingEnabled=!0,s.imageSmoothingQuality="high";var a=new Image;a.onload=function(){var e,u,l=a.width/a.height;o>l?u=(e=.32*i)/l:e=(u=.32*n)*l,s.drawImage(a,n/2-e/2,i/2-u/2,e,u);var c=new THREE.CanvasTexture(r);"function"==typeof t&&t(c)},a.crossOrigin="anonymous",a.src=T.getPath("textures/ui/play.png")},o.events$=function(){var e=this,t=this.item,i=this.items;return t.asset&&t.asset.linkedPlayId&&this.freeze(),Li.events$.pipe(n.map((function(n){t.asset&&t.asset.linkedPlayId&&(i.find((function(e){return e.asset&&-1!==n.src.indexOf(e.asset.file)&&n.id===t.asset.linkedPlayId}))&&(n instanceof Ui?e.play():n instanceof _i&&e.pause()));return n})))},o.onAppear=function(){var e=this.uniforms,t=this.material;t.uniforms&&gsap.to(e,{duration:.4,opacity:1,ease:Power2.easeInOut,onUpdate:function(){t.uniforms.opacity.value=e.opacity,t.needsUpdate=!0}})},o.onDisappear=function(){var e=this.uniforms,t=this.material;t.uniforms&&gsap.to(e,{duration:.4,opacity:0,ease:Power2.easeInOut,onUpdate:function(){t.uniforms.opacity.value=e.opacity,t.needsUpdate=!0}})},o.onOver=function(){var e=this.uniforms,t=this.material;t.uniforms&&gsap.to(e,{duration:.4,overlay:1,tween:0,opacity:1,ease:Power2.easeInOut,overwrite:!0,onUpdate:function(){t.uniforms.overlay.value=e.overlay,t.uniforms.tween.value=e.tween,t.uniforms.opacity.value=e.opacity,t.needsUpdate=!0}})},o.onOut=function(){var e=this.uniforms,t=this.material;t.uniforms&&gsap.to(e,{duration:.4,overlay:0,tween:this.playing?0:1,opacity:1,ease:Power2.easeInOut,overwrite:!0,onUpdate:function(){t.uniforms.overlay.value=e.overlay,t.uniforms.tween.value=e.tween,t.uniforms.opacity.value=e.opacity,t.needsUpdate=!0}})},o.onToggle=function(){this.playing=this.mediaLoader.toggle(),this.onOut()},o.play=function(){this.mediaLoader.play(),this.playing=!0,this.onOut()},o.pause=function(){this.mediaLoader.pause(),this.playing=!1,this.onOut()},o.updateByItem=function(e){this.disposeMaterial(),this.disposeMediaLoader(),this.material=t.getMaterialByItem(e),this.uniforms=t.getUniformsByItem(e),this.mediaLoader=new Li(e)},o.disposeMaterial=function(){this.material&&(this.material.map&&!1!==this.material.map.disposable&&this.material.map.dispose(),this.material.dispose(),this.material=null)},o.disposeMediaLoader=function(){var e=this.mediaLoader;e&&(e.isPlayableVideo&&(this.off("over",this.onOver),this.off("out",this.onOut),this.off("down",this.onToggle)),e.dispose(),this.mediaLoader=null)},o.dispose=function(){this.disposeMediaLoader()},t}(zn),ji=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var n=t.prototype;return n.onInit=function(){e.prototype.onInit.call(this),this.RADIUS=100},n.onDestroy=function(){this.editing=!1,e.prototype.onDestroy.call(this)},n.setHelper=function(e){e?(this.helper||(this.helper=new THREE.BoxHelper(this.mesh,65280)),this.host.scene.add(this.helper)):this.helper&&this.host.scene.remove(this.helper)},n.updateHelper=function(){this.helper&&this.helper.update()},l(t,[{key:"editing",get:function(){return this.editing_},set:function(e){this.editing_!==e&&(this.editing_=e,this.setHelper(e))}}]),t}(Ai);ji.meta={selector:"[model-editable]",hosts:{host:ki},inputs:["item"]};var Gi=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var i=t.prototype;return i.onInit=function(){e.prototype.onInit.call(this)},i.onChanges=function(){this.editing=this.item.selected},i.onCreate=function(e,t){var i,o,r=this,s=this.item,a=this.items,u=this.getCurvedPanelGeometry(s);Fi.getStreamId$(s).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(l){r.streamId!==l&&(r.streamId=l,i&&t(i,s),o&&(o.unsubscribe(),o=null),console.log("ModelCurvedPanel",l,s.asset),!l&&s.asset||(s.streamId=l,(i=new Fi(s,a,u)).name="curved-plane",s.position&&i.position.fromArray(s.position),s.rotation&&i.rotation.fromArray(s.rotation),s.scale&&i.scale.fromArray(s.scale),i.load((function(){"function"==typeof e&&e(i,s),o=i.events$().pipe(n.takeUntil(r.unsubscribe$)).subscribe((function(){}))})),i.on("down",(function(){console.log("ModelCurvedPanel.down"),r.down.next(r)}))))}))},i.onDestroy=function(){e.prototype.onDestroy.call(this),this.mesh&&this.mesh.dispose()},i.onUpdate=function(e,t){e.position&&t.position.fromArray(e.position),e.rotation&&t.rotation.fromArray(e.rotation),e.scale&&t.scale.fromArray(e.scale),this.updateHelper()},i.onUpdateAsset=function(e,t){this.mesh.updateByItem(e),this.mesh.load((function(){console.log("ModelCurvedPlaneComponent.mesh.load.complete")}))},i.onDragMove=function(e){this.item.showPanel=!1,this.editing=!0,this.mesh.position.set(e.x,e.y,e.z).multiplyScalar(20),this.mesh.lookAt(t.ORIGIN),this.updateHelper()},i.onDragEnd=function(){this.item.position=this.mesh.position.toArray(),this.item.rotation=this.mesh.rotation.toArray(),this.item.scale=this.mesh.scale.toArray(),this.editing=!1},i.getCurvedPanelGeometry=function(e){this.radius_=e.radius,this.height_=e.height,this.arc_=e.arc;var t=Math.PI/180*e.arc,n=new THREE.CylinderBufferGeometry(e.radius,e.radius,e.height,36,2,!0,0,t);return n.rotateY(-Math.PI-t/2),n.scale(-1,1,1),n},t}(ji);Gi.ORIGIN=new THREE.Vector3,Gi.textures={},Gi.meta={selector:"[model-curved-plane]",hosts:{host:ki},outputs:["down"],inputs:["item","items"]};var zi=function(e){function t(){return e.apply(this,arguments)||this}h(t,e),t.getLoader=function(){return t.loader||(t.loader=new THREE.FontLoader)},t.getFontLoader=function(e){return t.fontLoader||(t.fontLoader=t.getLoader().load(T.getPath("fonts/helvetiker/helvetiker_regular.typeface.json"),e))};var i=t.prototype;return i.onInit=function(){var t=this;e.prototype.onInit.call(this),(this.vrService=tt.getService()).session$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){e?t.text&&t.textGroup.add(t.text):t.text&&t.text.parent.remove(t.text)})),(this.debugService=Vn.getService()).message$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){return t.message=e}))},i.createText=function(){var e=document.createElement("canvas");e.width=t.W,e.height=t.H;var n=new THREE.CanvasTexture(e);n.encoding=THREE.sRGBEncoding,n.minFilter=THREE.LinearFilter,n.magFilter=THREE.LinearFilter,n.mapping=THREE.UVMapping,n.needsUpdate=!0;var i=new THREE.PlaneBufferGeometry(4,1,2,2),o=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,map:n,color:16777215,transparent:!0,opacity:1}),r=new THREE.Mesh(i,o);return r.renderer=T.renderOrder.debug,r.position.y=2,r},i.loadFont=function(){var e=this;this.fontLoader=t.getFontLoader((function(t){e.font=t,e.message_&&e.setText(e.message_)}))},i.onCreate=function(e,t){var n=this.textGroup=new THREE.Group;this.material=new THREE.MeshBasicMaterial({depthTest:!1,color:16777215,transparent:!0,opacity:1,side:THREE.DoubleSide}),this.text=this.createText();"function"==typeof e&&e(n)},i.render=function(e,n){var i=this.group,o=this.host.camera,r=this.position;this.host.renderer.xr.isPresenting&&(o=this.host.renderer.xr.getCamera(o)),o.getWorldDirection(r),r.multiplyScalar(3),i.position.copy(r),i.lookAt(t.ORIGIN)},i.setText=function(e){var n=this.text;if(n)if(this.host.renderer.xr.isPresenting&&null!=e){var i=n.material.map.image.getContext("2d");i.clearRect(0,0,t.W,t.H),i.font="30px "+T.fontFamily,i.textBaseline="middle",i.textAlign="center",i.fillStyle="#FFFFFF",i.strokeStyle="#000000",i.lineWidth=5,i.fillText(e,t.W/2,t.H/2,t.W-20),n.material.map.needsUpdate=!0,this.textGroup.add(n)}else n.parent&&n.parent.remove(n)},l(t,[{key:"message",get:function(){return this.message_},set:function(e){e=e&&""!==e?e:null,this.message_!==e&&(this.message_=e,this.setText(e))}}]),t}(Ai);zi.ORIGIN=new THREE.Vector3,zi.W=1024,zi.H=256,zi.meta={selector:"[model-debug]",hosts:{host:ki}};var qi=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var i=t.prototype;return i.onInit=function(){e.prototype.onInit.call(this),this.progress=0;this.group;(this.vrService=tt.getService()).session$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){}))},i.createStand=function(){var e=new THREE.BoxBufferGeometry(3,3,3),t=new THREE.MeshBasicMaterial;this.stand=new THREE.Mesh(e,t)},i.onCreate=function(e,t){var n=this;this.loadGltfModel(T.getPath(this.item.asset.folder),this.item.asset.file,(function(t){var i=(new THREE.Box3).setFromObject(t),o=i.max.clone().sub(i.min),r=1.7/Math.max(o.x,o.y,o.z);t.scale.set(r,r,r);var s=new THREE.Group;s.add(t),i.setFromObject(s);var a=i.getCenter(new THREE.Vector3);s.position.set(t.position.x-a.x,t.position.y-a.y,t.position.z-a.z+(n.host.renderer.xr.isPresenting?-2:0));var u=s.position.y,l={tween:1},c=function(){s.position.y=u+3*l.tween,s.rotation.y=0+Math.PI*l.tween};c(),gsap.to(l,{duration:1.5,tween:0,delay:.1,ease:Power2.easeInOut,onUpdate:c}),"function"==typeof e&&e(s),n.progress=0,n.pushChanges()}))},i.loadGltfModel=function(e,t,n){var i=this;this.host.renderer;(new THREE.GLTFLoader).setPath(e).load(t,(function(e){"function"==typeof n&&n(e.scene),i.progress=0,i.pushChanges()}),(function(e){e.lengthComputable?i.progress=Math.round(e.loaded/e.total*100):(i.progress=i.progress||0,i.progress=Math.min(100,i.progress+1)),i.pushChanges()}))},i.onUpdate=function(e,t){e.position&&t.position.fromArray(e.position),e.rotation&&t.rotation.fromArray(e.rotation),e.scale&&t.scale.fromArray(e.scale)},t}(Ai);qi.meta={selector:"[model-gltf]",hosts:{host:ki},inputs:["item"]};var Ni=function(e){function t(){return e.apply(this,arguments)||this}h(t,e),t.getLoader=function(){return t.loader||(t.loader=new THREE.TextureLoader)},t.getTexture=function(){return t.texture||(t.texture=t.getLoader().load(T.getPath("textures/ui/floor-nav-circle-v2.png")))};var i=t.prototype;return i.getCoords=function(e){var n=t.RADIUS/10,i=Math.ceil((e.x+n/2)/n)-1,o=Math.ceil((e.z+n/2)/n)-1,r=Math.floor(t.COLS/2),s=Math.floor(t.ROWS/2),a=Math.min(r,Math.abs(i))*(i?Math.abs(i)/i:1),u=Math.min(s,Math.abs(o))*(o?Math.abs(o)/o:1);if(this.view.hasTile(this.indices.x+a,this.indices.y+u))return new THREE.Vector2(a,u)},i.onInit=function(){var t=this;e.prototype.onInit.call(this),this.indices=new THREE.Vector2,this.view.index$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){t.moveToIndex(e)}))},i.onView=function(){},i.addTiles=function(){var e=this,n=t.RADIUS/10,i=.9*n,o=new THREE.PlaneBufferGeometry(i,i,2,2);o.rotateX(-Math.PI/2);var r=t.getTexture();r.disposable=!1,r.encoding=THREE.sRGBEncoding;var s=this.mesh,a=this.tileMap={};this.tiles=new Array(t.COLS*t.ROWS).fill(0).map((function(i,u){var l=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,map:r,transparent:!0,opacity:0}),c=new THREE.Mesh(o,l),d=Math.floor(t.COLS/2),h=Math.floor(t.ROWS/2),p=Math.floor(u/t.COLS),f=-d+u%t.COLS,m=-h+p;c.position.set(f*n,.15*-t.RADIUS,m*n),c.name=e.getName("tile_"+f+"_"+m),a[f+"_"+m]=c,s.add(c)}))},i.addHitArea=function(){this.onGroundOver=this.onGroundOver.bind(this),this.onGroundMove=this.onGroundMove.bind(this),this.onGroundDown=this.onGroundDown.bind(this),this.onGroundOut=this.onGroundOut.bind(this);var e=new THREE.PlaneBufferGeometry(t.RADIUS,t.RADIUS,20,20);e.rotateX(-Math.PI/2);var n=new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,opacity:0}),i=this.mesh,o=this.ground=new zn(e,n);o.name=this.getName("ground"),o.position.set(0,.15*-t.RADIUS,0),o.on("over",this.onGroundOver),o.on("move",this.onGroundMove),o.on("out",this.onGroundOut),o.on("down",this.onGroundDown),i.add(o)},i.onGroundOver=function(){var e=this.ground,t=this.getCoords(e.intersection.point);this.coords=t},i.onGroundMove=function(){var e=this.ground,t=this.getCoords(e.intersection.point);this.coords=t},i.onGroundDown=function(){var e=this.ground,t=this.getCoords(e.intersection.point);if(this.coords=t,t){var n=this.view.getTileIndex(this.indices.x+t.x,this.indices.y+t.y);this.view.index=n,this.nav.next(n)}},i.onGroundOut=function(){this.coords=null},i.moveToIndex=function(e){this.coords=null;var n=this.view.tiles[e],i=new THREE.Vector2(n.indices.x-this.indices.x,n.indices.y-this.indices.y);this.indices.x=n.indices.x,this.indices.y=n.indices.y;var o=t.RADIUS/10;this.move.next({indices:this.indices,coords:i,position:i.clone().multiplyScalar(o)})},i.onCreate=function(e,t){var n=this.mesh=new THREE.Group;this.addTiles(),this.addHitArea(),"function"==typeof e&&e(n)},i.onDestroy=function(){e.prototype.onDestroy.call(this);var t=this.ground;t.off("over",this.onGroundOver),t.off("move",this.onGroundMove),t.off("down",this.onGroundDown),t.off("out",this.onGroundOut)},l(t,[{key:"coords",set:function(e){if(!e&&this.coords_!==e||!this.coords_||e.x!==this.coords_.x||e.y!==this.coords_.y){var t=this.tileMap;if(this.coords_){var n=t[this.coords_.x+"_"+this.coords_.y],i={tween:1};gsap.to(i,{duration:.4,tween:0,delay:0,ease:Power2.easeInOut,onUpdate:function(){n.material.opacity=i.tween}})}if(e){var o=this.currentTile=t[e.x+"_"+e.y],r={tween:0};gsap.to(r,{duration:.4,tween:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){o.material.opacity=r.tween}})}this.coords_=e}}}]),t}(Ai);Ni.ORIGIN=new THREE.Vector3,Ni.RADIUS=101,Ni.COLS=11,Ni.ROWS=11,Ni.meta={selector:"[model-grid]",hosts:{host:ki},outputs:["move","nav"],inputs:["view"]};var Bi=function(e){function t(n,i,o){var r,s=t.geometry,a=t.material;(r=e.call(this,s,a)||this).renderOrder=T.renderOrder.menu,r.name=n.name,r.item=n,r.index=i,r.total=o,r.tween=0,r.opacity=0;var u=r.textureA=r.getTextureA(n.name);a.uniforms.textureA.value=u,a.uniforms.resolutionA.value=new THREE.Vector2(u.width,u.height);var l=r.textureB=r.getTextureB(n.name);return a.uniforms.textureB.value=l,a.uniforms.resolutionA.value=new THREE.Vector2(l.width,l.height),a.uniforms.tween.value=r.tween,a.uniforms.opacity.value=r.opacity,a.needsUpdate=!0,r.position.set(t.getX(i,o),t.getY(i,o),0),r.onOver=r.onOver.bind(p(r)),r.onOut=r.onOut.bind(p(r)),r}h(t,e),t.getGrid=function(e){var n=Math.ceil(e/t.ROWS);return[Math.ceil(e/n),n]},t.getX=function(e,n){var i=Math.ceil(n/t.ROWS),o=e%i,r=1/t.W*(t.W+t.G);return r/2-i*r/2+o*r},t.getY=function(e,n){var i=Math.ceil(n/t.ROWS),o=Math.ceil(n/i),r=Math.floor(e/i),s=1/t.W*(t.H+t.G);return o*s/2-s/2+r*-s},l(t,null,[{key:"geometry",get:function(){if(this.geometry_)return this.geometry_;var e=new THREE.PlaneBufferGeometry(1,1/t.W*t.H,2,2);return this.geometry_=e,e}},{key:"material",get:function(){return new THREE.ShaderMaterial({depthTest:!1,transparent:!0,vertexShader:Ki.VERTEX_SHADER,fragmentShader:Ki.FRAGMENT_SHADER,uniforms:{textureA:{type:"t",value:null},textureB:{type:"t",value:null},resolutionA:{value:new THREE.Vector2},resolutionB:{value:new THREE.Vector2},tween:{value:0},opacity:{value:0}}})}}]);var n=t.prototype;return n.getTextureA=function(e){var n=t.W,i=t.H,o=document.createElement("canvas");o.width=n,o.height=i;var r=o.getContext("2d");r.fillStyle="#000000",r.fillRect(0,0,n,i),r.font="20px "+T.fontFamily,r.fillStyle="#ffffff",r.fillText(e,10,50,n-20);var s=new THREE.CanvasTexture(o);return s.minFilter=THREE.LinearFilter,s.magFilter=THREE.LinearFilter,s.mapping=THREE.UVMapping,s.encoding=THREE.sRGBEncoding,s.needsUpdate=!0,s},n.getTextureB=function(e){var n=t.W,i=t.H,o=document.createElement("canvas");o.width=n,o.height=i;var r=o.getContext("2d");r.fillStyle="0x0099ff",r.fillRect(0,0,n,i),r.font="20px "+T.fontFamily,r.fillStyle="#ffffff",r.fillText(e,10,50,n-20);var s=new THREE.CanvasTexture(o);return s.encoding=THREE.sRGBEncoding,s.magFilter=THREE.LinearFilter,s.needsUpdate=!0,s},n.onOver=function(){var e=this;gsap.to(this,{duration:.4,tween:1,ease:Power2.easeOut,onUpdate:function(){e.position.z=.1*e.tween,e.material.uniforms.tween.value=e.tween,e.material.needsUpdate=!0}})},n.onOut=function(){var e=this;gsap.to(this,{duration:.4,tween:0,ease:Power2.easeOut,onUpdate:function(){e.position.z=.1*e.tween,e.material.uniforms.tween.value=e.tween,e.material.needsUpdate=!0}})},n.dispose=function(){Gn.dispose(this),this.textureA.dispose(),this.textureB.dispose(),this.material.dispose(),this.geometry.dispose()},t}(zn);Bi.W=256,Bi.H=64,Bi.G=2,Bi.ROWS=6;var Wi=function(e){function t(t,n,i){return e.call(this,t,n,i)||this}h(t,e);var n=t.prototype;return n.getTextureA=function(e){var t=Bi.W,n=Bi.H,i=document.createElement("canvas");i.width=t,i.height=n;var o=i.getContext("2d");o.fillStyle="#0099ff",o.fillRect(0,0,t,n),o.font="20px "+T.fontFamily,o.fillStyle="#000000",o.fillText(e,10,50,t-20);var r=new THREE.CanvasTexture(i);return r.minFilter=THREE.LinearFilter,r.magFilter=THREE.LinearFilter,r.mapping=THREE.UVMapping,r.needsUpdate=!0,r},n.getTextureB=function(e){var t=Bi.W,n=Bi.H,i=document.createElement("canvas");i.width=t,i.height=n;var o=i.getContext("2d");o.fillStyle="#0099ff",o.fillRect(0,0,t,n),o.font="20px "+T.fontFamily,o.fillStyle="#ffffff",o.fillText(e,10,50,t-20);var r=new THREE.CanvasTexture(i);return r.encoding=THREE.sRGBEncoding,r.magFilter=THREE.LinearFilter,r.needsUpdate=!0,r},t}(Bi),Ki=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var i=t.prototype;return i.onInit=function(){var t=this;e.prototype.onInit.call(this),this.onDown=this.onDown.bind(this),this.onToggle=this.onToggle.bind(this),(this.vrService=tt.getService()).session$.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){e?t.addToggler():t.removeMenu()}))},i.onChanges=function(){this.buildMenu()},i.onDestroy=function(){this.buttons&&this.buttons.forEach((function(e){return Gn.dispose(e)})),e.prototype.onDestroy.call(this)},i.onCreate=function(e,n){var i=this.menuGroup=new THREE.Group;i.lookAt(t.ORIGIN),"function"==typeof e&&e(i)},i.render=function(e,n){var i=this.group,o=this.host.camera,r=this.position;switch(this.host.renderer.xr.isPresenting&&(o=this.host.renderer.xr.getCamera(o)),o.getWorldDirection(r),ri.mode){case Jn:r.multiplyScalar(.01);break;default:r.multiplyScalar(3)}i.position.copy(r);var s=1/o.zoom;i.scale.set(s,s,s),i.lookAt(t.ORIGIN)},i.buildMenu=function(){var e=this;if(this.items){var t={};this.items.forEach((function(n){if(n.type.name!==Ue.WaitingRoom.name&&(!n.hidden||e.editor)){var i=t[n.type.name];i||(i=t[n.type.name]=[]),i.push(n)}})),this.groups=Object.keys(t).map((function(t){var n="Button";switch(t){case Ue.WaitingRoom.name:n="Waiting Room";break;case Ue.Panorama.name:n="Experience";break;case Ue.PanoramaGrid.name:n="Virtual Tour";break;case Ue.Room3d.name:n="Stanze 3D";break;case Ue.Model.name:n="Modelli 3D"}return{name:n,type:{name:"menu-group"},items:e.items.filter((function(n){return n.type.name===t&&(!n.hidden||e.editor)}))}}))}},i.onToggle=function(){A.state.locked||A.state.spying||(this.buttons?(this.removeMenu(),this.toggle.next()):(this.addMenu(),this.toggle.next(this)))},i.onDown=function(e){e.item&&"back"===e.item.type.name?(this.removeMenu(),e.item.backItem?this.addMenu():(this.host.renderer.xr.isPresenting&&this.addToggler(),this.toggle.next())):this.addMenu(e.item)},i.addMenu=function(e){var t,n=this;if(void 0===e&&(e=null),this.removeMenu(),e){if("menu-group"!==e.type.name)return this.removeMenu(),this.host.renderer.xr.isPresenting&&this.addToggler(),void this.nav.next(e);t=e.items}else t=this.groups;if(t){var i={type:{name:"back"},name:e?"Back":"Close",backItem:e};(t=t.slice()).push(i);var o=this.buttons=t.map((function(e,t,n){return"back"===e.type.name?new Wi(e,t,n.length):new Bi(e,t,n.length)}));o.forEach((function(e){e.depthTest=!1,e.on("over",e.onOver),e.on("out",e.onOut),e.on("down",n.onDown),n.menuGroup.add(e)})),gsap.to(o,{duration:.3,opacity:.8,ease:Power2.easeOut,stagger:{grid:Bi.getGrid(o.length),from:0,amount:.02*o.length},onUpdate:function(){o.forEach((function(e){e.material.uniforms.opacity.value=e.opacity*(e.item.hidden?.5:1)}))}})}},i.removeMenu=function(){this.removeButtons(),this.removeToggler()},i.removeButtons=function(){var e=this,t=this.buttons;t&&t.forEach((function(t){e.menuGroup.remove(t),t.off("over",t.onOver),t.off("out",t.onOut),t.off("down",e.onDown),t.dispose()})),this.buttons=null},i.addToggler=function(){this.removeMenu();var e=this.toggler=new Bi({type:{name:"menu"},name:"Menu"},0,1);e.position.y=-.5,e.opacity=.8,e.material.uniforms.opacity.value=e.opacity,e.material.needsUpdate=!0,e.on("over",e.onOver),e.on("out",e.onOut),e.on("down",this.onToggle),this.menuGroup.add(e)},i.removeToggler=function(){var e=this.toggler;e&&(this.menuGroup.remove(e),e.off("over",e.onOver),e.off("out",e.onOut),e.off("down",this.onToggle),e.dispose()),this.toggler=null},t}(Ai);Ki.ORIGIN=new THREE.Vector3,Ki.VERTEX_SHADER="\n#extension GL_EXT_frag_depth : enable\n\nvarying vec2 vUv;\nvoid main() {\n\tvUv = uv;\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n",Ki.FRAGMENT_SHADER="\n#extension GL_EXT_frag_depth : enable\n\nvarying vec2 vUv;\nuniform float opacity;\nuniform float tween;\nuniform sampler2D textureA;\nuniform sampler2D textureB;\nuniform vec2 resolutionA;\nuniform vec2 resolutionB;\n\nvoid main() {\n\tvec4 colorA = texture2D(textureA, vUv);\n\tvec4 colorB = texture2D(textureB, vUv);\n\tvec4 color = vec4(mix(colorA.rgb, colorB.rgb, tween), opacity);\n\tgl_FragColor = color;\n}\n",Ki.meta={selector:"[model-menu]",hosts:{host:ki},outputs:["nav","toggle"],inputs:["items","editor"]};var Xi=function(e){function t(){return e.apply(this,arguments)||this}h(t,e),t.getLoader=function(){return t.loader||(t.loader=new THREE.TextureLoader)},t.getTexturePoint=function(){return t.texturePoint||(t.texturePoint=t.getLoader().load(T.getPath("textures/ui/nav-point.png")))},t.getTextureMove=function(){return t.textureMove||(t.textureMove=t.getLoader().load(T.getPath("textures/ui/nav-move.png")))},t.getTextureInfo=function(){return t.textureInfo||(t.textureInfo=t.getLoader().load(T.getPath("textures/ui/nav-info.png")))},t.getTexture=function(e,t){return e.hasPanel?t.id===e.viewId?this.getTextureInfo():this.getTexturePoint():this.getTextureMove()};var n=t.prototype;return n.onInit=function(){e.prototype.onInit.call(this)},n.onChanges=function(){this.editing=this.item.selected},n.onDestroy=function(){Gn.dispose(this.sphere),e.prototype.onDestroy.call(this)},n.onCreate=function(e,n){var i,o=this,r=new THREE.Group,s=(i=new THREE.Vector3).set.apply(i,this.item.position).normalize().multiplyScalar(t.RADIUS);r.position.set(s.x,s.y,s.z);var a=t.getTexture(this.item,this.view);a.disposable=!1,a.encoding=THREE.sRGBEncoding;var u=new THREE.SpriteMaterial({depthTest:!1,depthWrite:!1,transparent:!0,map:a,sizeAttenuation:!1,opacity:0}),l=new THREE.Sprite(u);l.scale.set(.03,.03,.03),r.add(l);var c=new THREE.SphereBufferGeometry(3,12,12),d=new zn(c,new THREE.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,opacity:0,color:65535}));d.name="[nav] "+this.item.id,d.lookAt(t.ORIGIN),d.depthTest=!1,d.renderOrder=0,r.add(d),d.on("over",(function(){o.editing||o.over.next(o);var e={scale:l.scale.x};gsap.to(e,{duration:.35,scale:.04,delay:0,ease:Power2.easeOut,overwrite:!0,onUpdate:function(){l.scale.set(e.scale,e.scale,e.scale)},onComplete:function(){}})})),d.on("out",(function(){o.out.next(o);var e={scale:l.scale.x};gsap.to(e,{duration:.35,scale:.03,delay:0,ease:Power2.easeOut,overwrite:!0,onUpdate:function(){l.scale.set(e.scale,e.scale,e.scale)},onComplete:function(){}})})),d.on("down",(function(){o.down.next(o)}));var h={opacity:0};gsap.to(h,{duration:.7,opacity:1,delay:.5+.1*this.item.index,ease:Power2.easeInOut,overwrite:!0,onUpdate:function(){u.opacity=h.opacity,u.needsUpdate=!0}}),"function"==typeof e&&e(r,this.item)},n.onUpdate=function(e,n){var i,o=(i=new THREE.Vector3).set.apply(i,e.position).normalize().multiplyScalar(t.RADIUS);n.position.set(o.x,o.y,o.z),this.updateHelper()},n.onDragMove=function(e){this.editing=!0,this.item.showPanel=!1,this.mesh.position.set(e.x,e.y,e.z).multiplyScalar(t.RADIUS),this.updateHelper()},n.onDragEnd=function(){this.item.position=(new THREE.Vector3).copy(this.mesh.position).normalize().toArray(),this.editing=!1},t}(ji);Xi.ORIGIN=new THREE.Vector3,Xi.RADIUS=100,Xi.meta={selector:"[model-nav]",hosts:{host:ki},outputs:["over","out","down"],inputs:["item","view"]};var Yi=function(t){function n(){return t.apply(this,arguments)||this}h(n,t);var i=n.prototype;return i.onInit=function(){t.prototype.onInit.call(this)},i.onView=function(){var t=this;if(!this.viewed){this.viewed=!0;var i=e.getContext(this).node;this.getCanvasTexture(i).then((function(e){if(t.mesh){var o=.2*(t.item.asset?1.5:1),r=e.width/e.height,s=n.PANEL_RADIUS*o,a=n.PANEL_RADIUS*o/r,u=.25*s,l=t.item.mesh.position.normalize().multiplyScalar(n.PANEL_RADIUS),c=new THREE.SpriteMaterial({depthTest:!1,transparent:!0,map:e.map,sizeAttenuation:!1}),d=t.panel=new Mi(c);d.renderOrder=T.renderOrder.panel,d.scale.set(.02*s,.02*a,1),d.position.set(l.x,l.y+(a+2*u),l.z),d.on("down",(function(e){var n={x:parseInt(e.intersection.uv.x*i.offsetWidth),y:parseInt((1-e.intersection.uv.y)*i.offsetHeight)},o=Array.prototype.slice.call(i.querySelectorAll(".panel__link")).find((function(e){return n.x>=e.offsetLeft&&n.y>=e.offsetTop&&n.x<=e.offsetLeft+e.offsetWidth&&n.y<=e.offsetTop+e.offsetHeight}));if(o){t.down.next(o);var r=i.getBoundingClientRect(),s=new MouseEvent("mouseup",{button:0,buttons:0,clientX:n.x+r.left,clientY:n.y+r.top,movementX:0,movementY:0,relatedTarget:o,screenX:n.x,screenY:n.y});o.dispatchEvent(s),setTimeout((function(){Pn.dismissEvent(s,Pn.events$,Pn.dismiss$,Pn.downEvent)}),1)}})),t.mesh.add(d);var h={value:0};gsap.to(h,{duration:.5,value:1,delay:0,ease:Power2.easeInOut,onUpdate:function(){d.position.set(l.x,l.y+(a+2*u)-u*h.value,l.z),d.lookAt(n.ORIGIN),d.material.opacity=h.value,d.material.needsUpdate=!0}})}}),(function(e){console.log("ModelPanelComponent.getCanvasTexture.error",e)}))}},i.onCreate=function(e,t){var n=new THREE.Group;"function"==typeof e&&e(n)},i.onDestroy=function(){t.prototype.onDestroy.call(this)},i.imagesLoaded=function(){var t=e.getContext(this).node;if(t){var n=Array.prototype.slice.call(t.querySelectorAll("img")).map((function(e){return new Promise((function(t,n){var i=e.src&&-1===e.src.indexOf(location.origin);if(e.complete)return setTimeout((function(){t(i)}),10);var o=function(){e.removeEventListener("load",r),e.removeEventListener("error",s)},r=function(){o(),setTimeout((function(){t(i)}),10)},s=function(){o(),t(!1)};e.addEventListener("load",r),e.addEventListener("error",s)}))}));return n.length?Promise.all(n):Promise.resolve()}},i.getCanvasTexture=function(t){var n=this;return new Promise((function(i,r){setTimeout((function(){n.item.panelTexture?i(n.item.panelTexture):n.imagesLoaded().then((function(s){var a=e.getContext(n);if(a&&a.node){t=a.node;var u=s&&null!=s.find((function(e){return!0===e}));o(t,{backgroundColor:"#ffffff00",scale:2,useCORS:u}).then((function(e){var t=new THREE.CanvasTexture(e);n.item.panelTexture={map:t,width:e.width,height:e.height},i(n.item.panelTexture)}),(function(e){r(e)}))}}))}),1)}))},n}(Ai);Yi.ORIGIN=new THREE.Vector3,Yi.PANEL_RADIUS=99,Yi.meta={selector:"[model-panel]",hosts:{host:ki},outputs:["over","out","down"],inputs:["item"]};var Ji=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var n=t.prototype;return n.onInit=function(){e.prototype.onInit.call(this)},n.onCreate=function(e,t){var n=new THREE.Group;"function"==typeof e&&e(n)},t}(Ai);Ji.meta={selector:"[model-picture]",hosts:{host:ki},inputs:["item"]};var Zi=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var i=t.prototype;return i.onInit=function(){e.prototype.onInit.call(this)},i.onChanges=function(){this.editing=this.item.selected},i.onCreate=function(e,t){var i,o,r=this,s=this.item,a=this.items,u=new THREE.PlaneBufferGeometry(1,1,2,2);Fi.getStreamId$(s).pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(l){r.streamId!==l&&(r.streamId=l,i&&t(i,s),o&&(o.unsubscribe(),o=null),!l&&s.asset||(s.streamId=l,i=new Fi(s,a,u),s.position&&i.position.fromArray(s.position),s.rotation&&i.rotation.fromArray(s.rotation),s.scale&&i.scale.fromArray(s.scale),i.load((function(){"function"==typeof e&&e(i,s),o=i.events$().pipe(n.takeUntil(r.unsubscribe$)).subscribe((function(){}))})),i.on("down",(function(){r.down.next(r)}))))}))},i.onDestroy=function(){e.prototype.onDestroy.call(this),this.mesh&&this.mesh.dispose()},i.onUpdate=function(e,t){e.position&&t.position.fromArray(e.position),e.rotation&&t.rotation.fromArray(e.rotation),e.scale&&t.scale.fromArray(e.scale),this.updateHelper()},i.onUpdateAsset=function(e,t){this.mesh.updateByItem(e),this.mesh.load((function(){console.log("ModelPlaneComponent.mesh.load.complete")}))},i.onDragMove=function(e){this.item.showPanel=!1,this.editing=!0,this.mesh.position.set(e.x,e.y,e.z).multiplyScalar(20),this.mesh.lookAt(t.ORIGIN),this.updateHelper()},i.onDragEnd=function(){this.item.position=this.mesh.position.toArray(),this.item.rotation=this.mesh.rotation.toArray(),this.item.scale=this.mesh.scale.toArray(),this.editing=!1},t}(ji);Zi.ORIGIN=new THREE.Vector3,Zi.textures={},Zi.meta={selector:"[model-plane]",hosts:{host:ki},outputs:["down"],inputs:["item","items"]};var Qi=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var n=t.prototype;return n.onInit=function(){e.prototype.onInit.call(this),this.progress=0},n.onCreate=function(e,t){var n=this;this.loadModel(T.getPath(this.item.modelFolder),this.item.modelFile,(function(t){"function"==typeof e&&e(t),n.progress=0,n.pushChanges()}))},n.getLoader=function(e,t){var n;return(n=-1!==t.indexOf(".fbx")?new THREE.FBXLoader:new THREE.GLTFLoader).setPath(e),n},n.loadModel=function(e,t,n){var i=this;this.getLoader(e,t).load(t,(function(e){var t,o=e.scene;t=o||e;var r=i.item.items;t.scale.set(.05,.05,.05),t.traverse((function(e){if(e.isMesh){var t=r.find((function(t){return t.id===e.name}));if(t)t.plane=e;else{e.material.dispose();var n=new THREE.MeshStandardMaterial({color:1118481,roughness:.6});e.material=n}}})),t.position.y=3*-1.66,r.forEach((function(e){var t=e.plane;if(t){t.material&&t.material.color.setHex(0);var n=t.parent,i=e.plane=new Fi(e,r,t.geometry);i.depthTest=!1,i.renderOrder=0,i.name=t.name,i.position.copy(t.position),i.rotation.copy(t.rotation),i.scale.copy(t.scale),i.load((function(){n.add(i),n.remove(t),t.material&&t.material.dispose()}))}}));new Array(3).fill(0).map((function(e,t){var n=new THREE.PointLight(16777215,.1,1e3,2),o=Math.PI/180*45+Math.PI/180*120*t;return n.position.set(5*Math.cos(o),1,5*Math.sin(o)),i.group.add(n),n}));"function"==typeof n&&n(t),i.progress=0,i.pushChanges()}),(function(e){e.lengthComputable?i.progress=Math.round(e.loaded/e.total*100):(i.progress=i.progress||0,i.progress=Math.min(100,i.progress+1)),i.pushChanges()}))},n.onDestroy=function(){e.prototype.onDestroy.call(this);var t=this.item;if(t){var n=t.items;n&&n.forEach((function(e){e.plane&&(e.plane.dispose(),delete e.plane)}))}},t}(Ai);Qi.textures={},Qi.meta={selector:"[model-room]",hosts:{host:ki},inputs:["item"]};var eo=function(e){function t(){return e.apply(this,arguments)||this}h(t,e);var n=t.prototype;return n.onInit=function(){e.prototype.onInit.call(this)},n.onCreate=function(e,t){var n=new THREE.Group;"function"==typeof e&&e(n)},t}(Ai);eo.meta={selector:"[model-text]",hosts:{host:ki},inputs:["item"]};var to=function(e){function t(){return e.apply(this,arguments)||this}return h(t,e),t}(e.Module);to.meta={imports:[e.CoreModule,t.FormModule,Nt],declarations:[k,nt,be,$,we,Ee,xe,gt,Wt,un,en,tn,sn,an,ln,cn,bt,dn,hn,pn,fn,yt,Et,xt,mn,yn,Dn,wn,vn,rn,Sn,Cn,Pe,Pi,Ai,Gi,zi,qi,Ni,Ki,Xi,Yi,Ji,Zi,Qi,eo,On,Un,gn,_n,Oe,Ln,bn,ki],bootstrap:it},e.Browser.bootstrap(to)}));
//# sourceMappingURL=main.min.js.map