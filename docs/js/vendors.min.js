!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AgoraRTC=t()}(this,(function(){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=function(e){try{return!!e()}catch(e){return!0}},n=!t((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),r=n,i=Function.prototype,o=i.bind,s=i.call,a=r&&o.bind(s,s),c=r?function(e){return e&&a(e)}:function(e){return e&&function(){return s.apply(e,arguments)}},u=c({}.isPrototypeOf),l=function(e){return e&&e.Math==Math&&e},A=l("object"==typeof globalThis&&globalThis)||l("object"==typeof window&&window)||l("object"==typeof self&&self)||l("object"==typeof e&&e)||function(){return this}()||Function("return this")(),h=n,d=Function.prototype,p=d.apply,f=d.call,g="object"==typeof Reflect&&Reflect.apply||(h?f.bind(p):function(){return f.apply(p,arguments)}),m=function(e){return"function"==typeof e},v={},y=!t((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),_=n,E=Function.prototype.call,b=_?E.bind(E):function(){return E.apply(E,arguments)},w={},S={}.propertyIsEnumerable,T=Object.getOwnPropertyDescriptor,C=T&&!S.call({1:2},1);w.f=C?function(e){var t=T(this,e);return!!t&&t.enumerable}:S;var R,I,O=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},x=c,N=x({}.toString),B=x("".slice),L=function(e){return B(N(e),8,-1)},D=c,M=t,P=L,k=A.Object,U=D("".split),F=M((function(){return!k("z").propertyIsEnumerable(0)}))?function(e){return"String"==P(e)?U(e,""):k(e)}:k,H=A.TypeError,V=function(e){if(null==e)throw H("Can't call method on "+e);return e},Q=F,j=V,G=function(e){return Q(j(e))},K=m,W=function(e){return"object"==typeof e?null!==e:K(e)},z={},q=z,Y=A,X=m,J=function(e){return X(e)?e:void 0},Z=function(e,t){return arguments.length<2?J(q[e])||J(Y[e]):q[e]&&q[e][t]||Y[e]&&Y[e][t]},$=Z("navigator","userAgent")||"",ee=A,te=$,ne=ee.process,re=ee.Deno,ie=ne&&ne.versions||re&&re.version,oe=ie&&ie.v8;oe&&(I=(R=oe.split("."))[0]>0&&R[0]<4?1:+(R[0]+R[1])),!I&&te&&(!(R=te.match(/Edge\/(\d+)/))||R[1]>=74)&&(R=te.match(/Chrome\/(\d+)/))&&(I=+R[1]);var se=I,ae=se,ce=t,ue=!!Object.getOwnPropertySymbols&&!ce((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&ae&&ae<41})),le=ue&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ae=Z,he=m,de=u,pe=le,fe=A.Object,ge=pe?function(e){return"symbol"==typeof e}:function(e){var t=Ae("Symbol");return he(t)&&de(t.prototype,fe(e))},me=A.String,ve=function(e){try{return me(e)}catch(e){return"Object"}},ye=m,_e=ve,Ee=A.TypeError,be=function(e){if(ye(e))return e;throw Ee(_e(e)+" is not a function")},we=be,Se=function(e,t){var n=e[t];return null==n?void 0:we(n)},Te=b,Ce=m,Re=W,Ie=A.TypeError,Oe={exports:{}},xe=A,Ne=Object.defineProperty,Be="__core-js_shared__",Le=A[Be]||function(e,t){try{Ne(xe,e,{value:t,configurable:!0,writable:!0})}catch(n){xe[e]=t}return t}(Be,{}),De=Le;(Oe.exports=function(e,t){return De[e]||(De[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var Me=V,Pe=A.Object,ke=function(e){return Pe(Me(e))},Ue=ke,Fe=c({}.hasOwnProperty),He=Object.hasOwn||function(e,t){return Fe(Ue(e),t)},Ve=c,Qe=0,je=Math.random(),Ge=Ve(1..toString),Ke=function(e){return"Symbol("+(void 0===e?"":e)+")_"+Ge(++Qe+je,36)},We=A,ze=Oe.exports,qe=He,Ye=Ke,Xe=ue,Je=le,Ze=ze("wks"),$e=We.Symbol,et=$e&&$e.for,tt=Je?$e:$e&&$e.withoutSetter||Ye,nt=function(e){if(!qe(Ze,e)||!Xe&&"string"!=typeof Ze[e]){var t="Symbol."+e;Xe&&qe($e,e)?Ze[e]=$e[e]:Ze[e]=Je&&et?et(t):tt(t)}return Ze[e]},rt=b,it=W,ot=ge,st=Se,at=nt,ct=A.TypeError,ut=at("toPrimitive"),lt=function(e,t){if(!it(e)||ot(e))return e;var n,r=st(e,ut);if(r){if(void 0===t&&(t="default"),n=rt(r,e,t),!it(n)||ot(n))return n;throw ct("Can't convert object to primitive value")}return void 0===t&&(t="number"),function(e,t){var n,r;if("string"===t&&Ce(n=e.toString)&&!Re(r=Te(n,e)))return r;if(Ce(n=e.valueOf)&&!Re(r=Te(n,e)))return r;if("string"!==t&&Ce(n=e.toString)&&!Re(r=Te(n,e)))return r;throw Ie("Can't convert object to primitive value")}(e,t)},At=ge,ht=function(e){var t=lt(e,"string");return At(t)?t:t+""},dt=W,pt=A.document,ft=dt(pt)&&dt(pt.createElement),gt=function(e){return ft?pt.createElement(e):{}},mt=gt,vt=!y&&!t((function(){return 7!=Object.defineProperty(mt("div"),"a",{get:function(){return 7}}).a})),yt=y,_t=b,Et=w,bt=O,wt=G,St=ht,Tt=He,Ct=vt,Rt=Object.getOwnPropertyDescriptor;v.f=yt?Rt:function(e,t){if(e=wt(e),t=St(t),Ct)try{return Rt(e,t)}catch(e){}if(Tt(e,t))return bt(!_t(Et.f,e,t),e[t])};var It=t,Ot=m,xt=/#|\.prototype\./,Nt=function(e,t){var n=Lt[Bt(e)];return n==Mt||n!=Dt&&(Ot(t)?It(t):!!t)},Bt=Nt.normalize=function(e){return String(e).replace(xt,".").toLowerCase()},Lt=Nt.data={},Dt=Nt.NATIVE="N",Mt=Nt.POLYFILL="P",Pt=Nt,kt=be,Ut=n,Ft=c(c.bind),Ht=function(e,t){return kt(e),void 0===t?e:Ut?Ft(e,t):function(){return e.apply(t,arguments)}},Vt={},Qt=y&&t((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),jt=A,Gt=W,Kt=jt.String,Wt=jt.TypeError,zt=function(e){if(Gt(e))return e;throw Wt(Kt(e)+" is not an object")},qt=y,Yt=vt,Xt=Qt,Jt=zt,Zt=ht,$t=A.TypeError,en=Object.defineProperty,tn=Object.getOwnPropertyDescriptor;Vt.f=qt?Xt?function(e,t,n){if(Jt(e),t=Zt(t),Jt(n),"function"==typeof e&&"prototype"===t&&"value"in n&&"writable"in n&&!n.writable){var r=tn(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return en(e,t,n)}:en:function(e,t,n){if(Jt(e),t=Zt(t),Jt(n),Yt)try{return en(e,t,n)}catch(e){}if("get"in n||"set"in n)throw $t("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var nn=Vt,rn=O,on=y?function(e,t,n){return nn.f(e,t,rn(1,n))}:function(e,t,n){return e[t]=n,e},sn=A,an=g,cn=c,un=m,ln=v.f,An=Pt,hn=z,dn=Ht,pn=on,fn=He,gn=function(e){var t=function(n,r,i){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,i)}return an(e,this,arguments)};return t.prototype=e.prototype,t},mn=function(e,t){var n,r,i,o,s,a,c,u,l=e.target,A=e.global,h=e.stat,d=e.proto,p=A?sn:h?sn[l]:(sn[l]||{}).prototype,f=A?hn:hn[l]||pn(hn,l,{})[l],g=f.prototype;for(i in t)n=!An(A?i:l+(h?".":"#")+i,e.forced)&&p&&fn(p,i),s=f[i],n&&(a=e.noTargetGet?(u=ln(p,i))&&u.value:p[i]),o=n&&a?a:t[i],n&&typeof s==typeof o||(c=e.bind&&n?dn(o,sn):e.wrap&&n?gn(o):d&&un(o)?cn(o):o,(e.sham||o&&o.sham||s&&s.sham)&&pn(c,"sham",!0),pn(f,i,c),d&&(fn(hn,r=l+"Prototype")||pn(hn,r,{}),pn(hn[r],i,o),e.real&&g&&!g[i]&&pn(g,i,o)))},vn=Math.ceil,yn=Math.floor,_n=function(e){var t=+e;return t!=t||0===t?0:(t>0?yn:vn)(t)},En=_n,bn=Math.min,wn=function(e){return function(e){return e>0?bn(En(e),9007199254740991):0}(e.length)},Sn=be,Tn=ke,Cn=F,Rn=wn,In=A.TypeError,On=function(e){return function(t,n,r,i){Sn(n);var o=Tn(t),s=Cn(o),a=Rn(o),c=e?a-1:0,u=e?-1:1;if(r<2)for(;;){if(c in s){i=s[c],c+=u;break}if(c+=u,e?c<0:a<=c)throw In("Reduce of empty array with no initial value")}for(;e?c>=0:a>c;c+=u)c in s&&(i=n(i,s[c],c,o));return i}},xn={left:On(!1),right:On(!0)},Nn=t,Bn=function(e,t){var n=[][e];return!!n&&Nn((function(){n.call(null,t||function(){throw 1},1)}))},Ln="process"==L(A.process),Dn=xn.left,Mn=se,Pn=Ln;mn({target:"Array",proto:!0,forced:!Bn("reduce")||!Pn&&Mn>79&&Mn<83},{reduce:function(e){var t=arguments.length;return Dn(this,e,t,t>1?arguments[1]:void 0)}});var kn=z,Un=function(e){return kn[e+"Prototype"]},Fn=Un("Array").reduce,Hn=u,Vn=Fn,Qn=Array.prototype,jn=function(e){var t=e.reduce;return e===Qn||Hn(Qn,e)&&t===Qn.reduce?Vn:t},Gn=jn;let Kn=!0,Wn=!0;function zn(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function qn(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Yn(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Kn=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Xn(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(Wn=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Jn(){if("object"==typeof window){if(Kn)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Zn(e,t){Wn&&console.warn(e+" is deprecated, please use "+t+" instead.")}function $n(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=zn(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=zn(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=zn(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function er(e){return"[object Object]"===Object.prototype.toString.call(e)}function tr(e){var t;return er(e)?Gn(t=Object.keys(e)).call(t,(function(t,n){const r=er(e[n]),i=r?tr(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function nr(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach((i=>{i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach((n=>{e(t,t.get(n),r)}))})))}(e,n,i)}))})),i}var rr=Oe.exports,ir=Ke,or=rr("keys"),sr=function(e){return or[e]||(or[e]=ir(e))},ar=!t((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),cr=A,ur=He,lr=m,Ar=ke,hr=ar,dr=sr("IE_PROTO"),pr=cr.Object,fr=pr.prototype,gr=hr?pr.getPrototypeOf:function(e){var t=Ar(e);if(ur(t,dr))return t[dr];var n=t.constructor;return lr(n)&&t instanceof n?n.prototype:t instanceof pr?fr:null},mr=A,vr=m,yr=mr.String,_r=mr.TypeError,Er=c,br=zt,wr=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Er(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch(e){}return function(n,r){return br(n),function(e){if("object"==typeof e||vr(e))return e;throw _r("Can't set "+yr(e)+" as a prototype")}(r),t?e(n,r):n.__proto__=r,n}}():void 0),Sr={},Tr=_n,Cr=Math.max,Rr=Math.min,Ir=function(e,t){var n=Tr(e);return n<0?Cr(n+t,0):Rr(n,t)},Or=G,xr=Ir,Nr=wn,Br=function(e){return function(t,n,r){var i,o=Or(t),s=Nr(o),a=xr(r,s);if(e&&n!=n){for(;s>a;)if((i=o[a++])!=i)return!0}else for(;s>a;a++)if((e||a in o)&&o[a]===n)return e||a||0;return!e&&-1}},Lr={includes:Br(!0),indexOf:Br(!1)},Dr={},Mr=He,Pr=G,kr=Lr.indexOf,Ur=Dr,Fr=c([].push),Hr=function(e,t){var n,r=Pr(e),i=0,o=[];for(n in r)!Mr(Ur,n)&&Mr(r,n)&&Fr(o,n);for(;t.length>i;)Mr(r,n=t[i++])&&(~kr(o,n)||Fr(o,n));return o},Vr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Qr=Hr,jr=Vr.concat("length","prototype");Sr.f=Object.getOwnPropertyNames||function(e){return Qr(e,jr)};var Gr={};Gr.f=Object.getOwnPropertySymbols;var Kr=Z,Wr=Sr,zr=Gr,qr=zt,Yr=c([].concat),Xr=Kr("Reflect","ownKeys")||function(e){var t=Wr.f(qr(e)),n=zr.f;return n?Yr(t,n(e)):t},Jr=He,Zr=Xr,$r=v,ei=Vt,ti={},ni=Hr,ri=Vr,ii=Object.keys||function(e){return ni(e,ri)},oi=y,si=Qt,ai=Vt,ci=zt,ui=G,li=ii;ti.f=oi&&!si?Object.defineProperties:function(e,t){ci(e);for(var n,r=ui(t),i=li(t),o=i.length,s=0;o>s;)ai.f(e,n=i[s++],r[n]);return e};var Ai,hi=Z("document","documentElement"),di=zt,pi=ti,fi=Vr,gi=Dr,mi=hi,vi=gt,yi=sr("IE_PROTO"),_i=function(){},Ei=function(e){return"<script>"+e+"<\/script>"},bi=function(e){e.write(Ei("")),e.close();var t=e.parentWindow.Object;return e=null,t},wi=function(){try{Ai=new ActiveXObject("htmlfile")}catch(e){}var e,t;wi="undefined"!=typeof document?document.domain&&Ai?bi(Ai):((t=vi("iframe")).style.display="none",mi.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Ei("document.F=Object")),e.close(),e.F):bi(Ai);for(var n=fi.length;n--;)delete wi.prototype[fi[n]];return wi()};gi[yi]=!0;var Si=Object.create||function(e,t){var n;return null!==e?(_i.prototype=di(e),n=new _i,_i.prototype=null,n[yi]=e):n=wi(),void 0===t?n:pi.f(n,t)},Ti=c("".replace),Ci=String(Error("zxcasd").stack),Ri=/\n\s*at [^:]*:[^\n]*/,Ii=Ri.test(Ci),Oi=W,xi=on,Ni={},Bi=Ni,Li=nt("iterator"),Di=Array.prototype,Mi={};Mi[nt("toStringTag")]="z";var Pi="[object z]"===String(Mi),ki=A,Ui=Pi,Fi=m,Hi=L,Vi=nt("toStringTag"),Qi=ki.Object,ji="Arguments"==Hi(function(){return arguments}()),Gi=Ui?Hi:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Qi(e),Vi))?n:ji?Hi(t):"Object"==(r=Hi(t))&&Fi(t.callee)?"Arguments":r},Ki=Gi,Wi=Se,zi=Ni,qi=nt("iterator"),Yi=function(e){if(null!=e)return Wi(e,qi)||Wi(e,"@@iterator")||zi[Ki(e)]},Xi=b,Ji=be,Zi=zt,$i=ve,eo=Yi,to=A.TypeError,no=b,ro=zt,io=Se,oo=Ht,so=b,ao=zt,co=ve,uo=wn,lo=u,Ao=Yi,ho=function(e,t,n){var r,i;ro(e);try{if(!(r=io(e,"return"))){if("throw"===t)throw n;return n}r=no(r,e)}catch(e){i=!0,r=e}if("throw"===t)throw n;if(i)throw r;return ro(r),n},po=A.TypeError,fo=function(e,t){this.stopped=e,this.result=t},go=fo.prototype,mo=function(e,t,n){var r,i,o,s,a,c,u,l=n&&n.that,A=!(!n||!n.AS_ENTRIES),h=!(!n||!n.IS_ITERATOR),d=!(!n||!n.INTERRUPTED),p=oo(t,l),f=function(e){return r&&ho(r,"normal",e),new fo(!0,e)},g=function(e){return A?(ao(e),d?p(e[0],e[1],f):p(e[0],e[1])):d?p(e,f):p(e)};if(h)r=e;else{if(!(i=Ao(e)))throw po(co(e)+" is not iterable");if(function(e){return void 0!==e&&(Bi.Array===e||Di[Li]===e)}(i)){for(o=0,s=uo(e);s>o;o++)if((a=g(e[o]))&&lo(go,a))return a;return new fo(!1)}r=function(e,t){var n=arguments.length<2?eo(e):t;if(Ji(n))return Zi(Xi(n,e));throw to($i(e)+" is not iterable")}(e,i)}for(c=r.next;!(u=so(c,r)).done;){try{a=g(u.value)}catch(e){ho(r,"throw",e)}if("object"==typeof a&&a&&lo(go,a))return a}return new fo(!1)},vo=Gi,yo=A.String,_o=function(e){if("Symbol"===vo(e))throw TypeError("Cannot convert a Symbol value to a string");return yo(e)},Eo=_o,bo=O,wo=!t((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",bo(1,7)),7!==e.stack)})),So=mn,To=A,Co=u,Ro=gr,Io=wr,Oo=Si,xo=on,No=O,Bo=function(e,t){if(Ii&&"string"==typeof e)for(;t--;)e=Ti(e,Ri,"");return e},Lo=function(e,t){Oi(t)&&"cause"in t&&xi(e,"cause",t.cause)},Do=mo,Mo=function(e,t){return void 0===e?arguments.length<2?"":t:Eo(e)},Po=wo,ko=nt("toStringTag"),Uo=To.Error,Fo=[].push,Ho=function(e,t){var n,r=arguments.length>2?arguments[2]:void 0,i=Co(Vo,this);Io?n=Io(new Uo,i?Ro(this):Vo):(n=i?this:Oo(Vo),xo(n,ko,"Error")),void 0!==t&&xo(n,"message",Mo(t)),Po&&xo(n,"stack",Bo(n.stack,1)),Lo(n,r);var o=[];return Do(e,Fo,{that:o}),xo(n,"errors",o),n};Io?Io(Ho,Uo):function(e,t,n){for(var r=Zr(t),i=ei.f,o=$r.f,s=0;s<r.length;s++){var a=r[s];Jr(e,a)||n&&Jr(n,a)||i(e,a,o(t,a))}}(Ho,Uo,{name:!0});var Vo=Ho.prototype=Oo(Uo.prototype,{constructor:No(1,Ho),message:No(1,""),name:No(1,"AggregateError")});So({global:!0},{AggregateError:Ho});var Qo=m,jo=Le,Go=c(Function.toString);Qo(jo.inspectSource)||(jo.inspectSource=function(e){return Go(e)});var Ko,Wo,zo,qo=jo.inspectSource,Yo=m,Xo=qo,Jo=A.WeakMap,Zo=Yo(Jo)&&/native code/.test(Xo(Jo)),$o=A,es=c,ts=W,ns=on,rs=He,is=Le,os=sr,ss=Dr,as="Object already initialized",cs=$o.TypeError,us=$o.WeakMap;if(Zo||is.state){var ls=is.state||(is.state=new us),As=es(ls.get),hs=es(ls.has),ds=es(ls.set);Ko=function(e,t){if(hs(ls,e))throw new cs(as);return t.facade=e,ds(ls,e,t),t},Wo=function(e){return As(ls,e)||{}},zo=function(e){return hs(ls,e)}}else{var ps=os("state");ss[ps]=!0,Ko=function(e,t){if(rs(e,ps))throw new cs(as);return t.facade=e,ns(e,ps,t),t},Wo=function(e){return rs(e,ps)?e[ps]:{}},zo=function(e){return rs(e,ps)}}var fs,gs,ms,vs={set:Ko,get:Wo,has:zo,enforce:function(e){return zo(e)?Wo(e):Ko(e,{})},getterFor:function(e){return function(t){var n;if(!ts(t)||(n=Wo(t)).type!==e)throw cs("Incompatible receiver, "+e+" required");return n}}},ys=y,_s=He,Es=Function.prototype,bs=ys&&Object.getOwnPropertyDescriptor,ws=_s(Es,"name"),Ss={EXISTS:ws,PROPER:ws&&"something"===function(){}.name,CONFIGURABLE:ws&&(!ys||ys&&bs(Es,"name").configurable)},Ts=on,Cs=function(e,t,n,r){r&&r.enumerable?e[t]=n:Ts(e,t,n)},Rs=t,Is=m,Os=Si,xs=gr,Ns=Cs,Bs=nt("iterator"),Ls=!1;[].keys&&("next"in(ms=[].keys())?(gs=xs(xs(ms)))!==Object.prototype&&(fs=gs):Ls=!0);var Ds=null==fs||Rs((function(){var e={};return fs[Bs].call(e)!==e}));Is((fs=Ds?{}:Os(fs))[Bs])||Ns(fs,Bs,(function(){return this}));var Ms={IteratorPrototype:fs,BUGGY_SAFARI_ITERATORS:Ls},Ps=Gi,ks=Pi?{}.toString:function(){return"[object "+Ps(this)+"]"},Us=Pi,Fs=Vt.f,Hs=on,Vs=He,Qs=ks,js=nt("toStringTag"),Gs=function(e,t,n,r){if(e){var i=n?e:e.prototype;Vs(i,js)||Fs(i,js,{configurable:!0,value:t}),r&&!Us&&Hs(i,"toString",Qs)}},Ks=Ms.IteratorPrototype,Ws=Si,zs=O,qs=Gs,Ys=Ni,Xs=function(){return this},Js=mn,Zs=b,$s=gr,ea=Gs,ta=Cs,na=Ni,ra=Ss.PROPER,ia=Ms.BUGGY_SAFARI_ITERATORS,oa=nt("iterator"),sa="keys",aa="values",ca="entries",ua=function(){return this},la=function(e,t,n,r,i,o,s){!function(e,t,n,r){var i=t+" Iterator";e.prototype=Ws(Ks,{next:zs(+!r,n)}),qs(e,i,!1,!0),Ys[i]=Xs}(n,t,r);var a,c,u,l=function(e){if(e===i&&f)return f;if(!ia&&e in d)return d[e];switch(e){case sa:case aa:case ca:return function(){return new n(this,e)}}return function(){return new n(this)}},A=t+" Iterator",h=!1,d=e.prototype,p=d[oa]||d["@@iterator"]||i&&d[i],f=!ia&&p||l(i),g="Array"==t&&d.entries||p;if(g&&(a=$s(g.call(new e)))!==Object.prototype&&a.next&&(ea(a,A,!0,!0),na[A]=ua),ra&&i==aa&&p&&p.name!==aa&&(h=!0,f=function(){return Zs(p,this)}),i)if(c={values:l(aa),keys:o?f:l(sa),entries:l(ca)},s)for(u in c)(ia||h||!(u in d))&&ta(d,u,c[u]);else Js({target:t,proto:!0,forced:ia||h},c);return s&&d[oa]!==f&&ta(d,oa,f,{name:i}),na[t]=f,c},Aa=G,ha=Ni,da=vs;Vt.f;var pa=la,fa="Array Iterator",ga=da.set,ma=da.getterFor(fa);pa(Array,"Array",(function(e,t){ga(this,{type:fa,target:Aa(e),index:0,kind:t})}),(function(){var e=ma(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values"),ha.Arguments=ha.Array;var va=A.Promise,ya=Cs,_a=Z,Ea=Vt,ba=y,wa=nt("species"),Sa=u,Ta=A.TypeError,Ca=nt("iterator"),Ra=!1;try{var Ia=0,Oa={next:function(){return{done:!!Ia++}},return:function(){Ra=!0}};Oa[Ca]=function(){return this},Array.from(Oa,(function(){throw 2}))}catch(e){}var xa=c,Na=t,Ba=m,La=Gi,Da=qo,Ma=function(){},Pa=[],ka=Z("Reflect","construct"),Ua=/^\s*(?:class|function)\b/,Fa=xa(Ua.exec),Ha=!Ua.exec(Ma),Va=function(e){if(!Ba(e))return!1;try{return ka(Ma,Pa,e),!0}catch(e){return!1}},Qa=function(e){if(!Ba(e))return!1;switch(La(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ha||!!Fa(Ua,Da(e))}catch(e){return!0}};Qa.sham=!0;var ja,Ga,Ka,Wa,za=!ka||Na((function(){var e;return Va(Va.call)||!Va(Object)||!Va((function(){e=!0}))||e}))?Qa:Va,qa=za,Ya=ve,Xa=A.TypeError,Ja=zt,Za=nt("species"),$a=function(e,t){var n,r=Ja(e).constructor;return void 0===r||null==(n=Ja(r)[Za])?t:function(e){if(qa(e))return e;throw Xa(Ya(e)+" is not a constructor")}(n)},ec=c([].slice),tc=/(?:ipad|iphone|ipod).*applewebkit/i.test($),nc=A,rc=g,ic=Ht,oc=m,sc=He,ac=t,cc=hi,uc=ec,lc=gt,Ac=tc,hc=Ln,dc=nc.setImmediate,pc=nc.clearImmediate,fc=nc.process,gc=nc.Dispatch,mc=nc.Function,vc=nc.MessageChannel,yc=nc.String,_c=0,Ec={};try{ja=nc.location}catch(e){}var bc=function(e){if(sc(Ec,e)){var t=Ec[e];delete Ec[e],t()}},wc=function(e){return function(){bc(e)}},Sc=function(e){bc(e.data)},Tc=function(e){nc.postMessage(yc(e),ja.protocol+"//"+ja.host)};dc&&pc||(dc=function(e){var t=uc(arguments,1);return Ec[++_c]=function(){rc(oc(e)?e:mc(e),void 0,t)},Ga(_c),_c},pc=function(e){delete Ec[e]},hc?Ga=function(e){fc.nextTick(wc(e))}:gc&&gc.now?Ga=function(e){gc.now(wc(e))}:vc&&!Ac?(Wa=(Ka=new vc).port2,Ka.port1.onmessage=Sc,Ga=ic(Wa.postMessage,Wa)):nc.addEventListener&&oc(nc.postMessage)&&!nc.importScripts&&ja&&"file:"!==ja.protocol&&!ac(Tc)?(Ga=Tc,nc.addEventListener("message",Sc,!1)):Ga="onreadystatechange"in lc("script")?function(e){cc.appendChild(lc("script")).onreadystatechange=function(){cc.removeChild(this),bc(e)}}:function(e){setTimeout(wc(e),0)});var Cc,Rc,Ic,Oc,xc,Nc,Bc,Lc,Dc={set:dc,clear:pc},Mc=A,Pc=/ipad|iphone|ipod/i.test($)&&void 0!==Mc.Pebble,kc=/web0s(?!.*chrome)/i.test($),Uc=A,Fc=Ht,Hc=v.f,Vc=Dc.set,Qc=tc,jc=Pc,Gc=kc,Kc=Ln,Wc=Uc.MutationObserver||Uc.WebKitMutationObserver,zc=Uc.document,qc=Uc.process,Yc=Uc.Promise,Xc=Hc(Uc,"queueMicrotask"),Jc=Xc&&Xc.value;Jc||(Cc=function(){var e,t;for(Kc&&(e=qc.domain)&&e.exit();Rc;){t=Rc.fn,Rc=Rc.next;try{t()}catch(e){throw Rc?Oc():Ic=void 0,e}}Ic=void 0,e&&e.enter()},Qc||Kc||Gc||!Wc||!zc?!jc&&Yc&&Yc.resolve?((Bc=Yc.resolve(void 0)).constructor=Yc,Lc=Fc(Bc.then,Bc),Oc=function(){Lc(Cc)}):Kc?Oc=function(){qc.nextTick(Cc)}:(Vc=Fc(Vc,Uc),Oc=function(){Vc(Cc)}):(xc=!0,Nc=zc.createTextNode(""),new Wc(Cc).observe(Nc,{characterData:!0}),Oc=function(){Nc.data=xc=!xc}));var Zc=Jc||function(e){var t={fn:e,next:void 0};Ic&&(Ic.next=t),Rc||(Rc=t,Oc()),Ic=t},$c={},eu=be,tu=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=eu(t),this.reject=eu(n)};$c.f=function(e){return new tu(e)};var nu=zt,ru=W,iu=$c,ou=function(e,t){if(nu(e),ru(t)&&t.constructor===e)return t;var n=iu.f(e);return(0,n.resolve)(t),n.promise},su=A,au=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},cu=function(){this.head=null,this.tail=null};cu.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var uu,lu,Au,hu="object"==typeof window,du=mn,pu=A,fu=Z,gu=b,mu=va,vu=Gs,yu=be,_u=m,Eu=W,bu=qo,wu=mo,Su=$a,Tu=Dc.set,Cu=Zc,Ru=ou,Iu=$c,Ou=au,xu=cu,Nu=vs,Bu=Pt,Lu=hu,Du=Ln,Mu=se,Pu=nt("species"),ku="Promise",Uu=Nu.getterFor(ku),Fu=Nu.set,Hu=Nu.getterFor(ku),Vu=mu&&mu.prototype,Qu=mu,ju=Vu,Gu=pu.TypeError,Ku=pu.document,Wu=pu.process,zu=Iu.f,qu=zu,Yu=!!(Ku&&Ku.createEvent&&pu.dispatchEvent),Xu=_u(pu.PromiseRejectionEvent),Ju="unhandledrejection",Zu=Bu(ku,(function(){var e=bu(Qu),t=e!==String(Qu);if(!t&&66===Mu)return!0;if(!ju.finally)return!0;if(Mu>=51&&/native code/.test(e))return!1;var n=new Qu((function(e){e(1)})),r=function(e){e((function(){}),(function(){}))};return(n.constructor={})[Pu]=r,!(n.then((function(){}))instanceof r)||!t&&Lu&&!Xu})),$u=Zu||!function(e,t){if(!t&&!Ra)return!1;var n=!1;try{var r={};r[Ca]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch(e){}return n}((function(e){Qu.all(e).catch((function(){}))})),el=function(e){var t;return!(!Eu(e)||!_u(t=e.then))&&t},tl=function(e,t){var n,r,i,o=t.value,s=1==t.state,a=s?e.ok:e.fail,c=e.resolve,u=e.reject,l=e.domain;try{a?(s||(2===t.rejection&&sl(t),t.rejection=1),!0===a?n=o:(l&&l.enter(),n=a(o),l&&(l.exit(),i=!0)),n===e.promise?u(Gu("Promise-chain cycle")):(r=el(n))?gu(r,n,c,u):c(n)):u(o)}catch(e){l&&!i&&l.exit(),u(e)}},nl=function(e,t){e.notified||(e.notified=!0,Cu((function(){for(var n,r=e.reactions;n=r.get();)tl(n,e);e.notified=!1,t&&!e.rejection&&il(e)})))},rl=function(e,t,n){var r,i;Yu?((r=Ku.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),pu.dispatchEvent(r)):r={promise:t,reason:n},!Xu&&(i=pu["on"+e])?i(r):e===Ju&&function(e,t){var n=su.console;n&&n.error&&(1==arguments.length?n.error(e):n.error(e,t))}("Unhandled promise rejection",n)},il=function(e){gu(Tu,pu,(function(){var t,n=e.facade,r=e.value;if(ol(e)&&(t=Ou((function(){Du?Wu.emit("unhandledRejection",r,n):rl(Ju,n,r)})),e.rejection=Du||ol(e)?2:1,t.error))throw t.value}))},ol=function(e){return 1!==e.rejection&&!e.parent},sl=function(e){gu(Tu,pu,(function(){var t=e.facade;Du?Wu.emit("rejectionHandled",t):rl("rejectionhandled",t,e.value)}))},al=function(e,t,n){return function(r){e(t,r,n)}},cl=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,nl(e,!0))},ul=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Gu("Promise can't be resolved itself");var r=el(t);r?Cu((function(){var n={done:!1};try{gu(r,t,al(ul,n,e),al(cl,n,e))}catch(t){cl(n,t,e)}})):(e.value=t,e.state=1,nl(e,!1))}catch(t){cl({done:!1},t,e)}}};Zu&&(ju=(Qu=function(e){(function(e,t){if(Sa(t,e))return e;throw Ta("Incorrect invocation")})(this,ju),yu(e),gu(uu,this);var t=Uu(this);try{e(al(ul,t),al(cl,t))}catch(e){cl(t,e)}}).prototype,(uu=function(e){Fu(this,{type:ku,done:!1,notified:!1,parent:!1,reactions:new xu,rejection:!1,state:0,value:void 0})}).prototype=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:ya(e,r,t[r],n);return e}(ju,{then:function(e,t){var n=Hu(this),r=zu(Su(this,Qu));return n.parent=!0,r.ok=!_u(e)||e,r.fail=_u(t)&&t,r.domain=Du?Wu.domain:void 0,0==n.state?n.reactions.add(r):Cu((function(){tl(r,n)})),r.promise},catch:function(e){return this.then(void 0,e)}}),lu=function(){var e=new uu,t=Uu(e);this.promise=e,this.resolve=al(ul,t),this.reject=al(cl,t)},Iu.f=zu=function(e){return e===Qu||e===Au?new lu(e):qu(e)}),du({global:!0,wrap:!0,forced:Zu},{Promise:Qu}),vu(Qu,ku,!1,!0),function(e){var t=_a(e),n=Ea.f;ba&&t&&!t[wa]&&n(t,wa,{configurable:!0,get:function(){return this}})}(ku),Au=fu(ku),du({target:ku,stat:!0,forced:Zu},{reject:function(e){var t=zu(this);return gu(t.reject,void 0,e),t.promise}}),du({target:ku,stat:!0,forced:!0},{resolve:function(e){return Ru(this===Au?Qu:this,e)}}),du({target:ku,stat:!0,forced:$u},{all:function(e){var t=this,n=zu(t),r=n.resolve,i=n.reject,o=Ou((function(){var n=yu(t.resolve),o=[],s=0,a=1;wu(e,(function(e){var c=s++,u=!1;a++,gu(n,t,e).then((function(e){u||(u=!0,o[c]=e,--a||r(o))}),i)})),--a||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=zu(t),r=n.reject,i=Ou((function(){var i=yu(t.resolve);wu(e,(function(e){gu(i,t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var ll=b,Al=be,hl=$c,dl=au,pl=mo;mn({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=hl.f(t),r=n.resolve,i=n.reject,o=dl((function(){var n=Al(t.resolve),i=[],o=0,s=1;pl(e,(function(e){var a=o++,c=!1;s++,ll(n,t,e).then((function(e){c||(c=!0,i[a]={status:"fulfilled",value:e},--s||r(i))}),(function(e){c||(c=!0,i[a]={status:"rejected",reason:e},--s||r(i))}))})),--s||r(i)}));return o.error&&i(o.value),n.promise}});var fl=be,gl=Z,ml=b,vl=$c,yl=au,_l=mo,El="No one promise resolved";mn({target:"Promise",stat:!0},{any:function(e){var t=this,n=gl("AggregateError"),r=vl.f(t),i=r.resolve,o=r.reject,s=yl((function(){var r=fl(t.resolve),s=[],a=0,c=1,u=!1;_l(e,(function(e){var l=a++,A=!1;c++,ml(r,t,e).then((function(e){A||u||(u=!0,i(e))}),(function(e){A||u||(A=!0,s[l]=e,--c||o(new n(s,El)))}))})),--c||o(new n(s,El))}));return s.error&&o(s.value),r.promise}});var bl=va,wl=Z,Sl=m,Tl=$a,Cl=ou;mn({target:"Promise",proto:!0,real:!0,forced:!!bl&&t((function(){bl.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=Tl(this,wl("Promise")),n=Sl(e);return this.then(n?function(n){return Cl(t,e()).then((function(){return n}))}:e,n?function(n){return Cl(t,e()).then((function(){throw n}))}:e)}});var Rl=c,Il=_n,Ol=_o,xl=V,Nl=Rl("".charAt),Bl=Rl("".charCodeAt),Ll=Rl("".slice),Dl=function(e){return function(t,n){var r,i,o=Ol(xl(t)),s=Il(n),a=o.length;return s<0||s>=a?e?"":void 0:(r=Bl(o,s))<55296||r>56319||s+1===a||(i=Bl(o,s+1))<56320||i>57343?e?Nl(o,s):r:e?Ll(o,s,s+2):i-56320+(r-55296<<10)+65536}},Ml=(Dl(!1),Dl(!0)),Pl=_o,kl=vs,Ul=la,Fl="String Iterator",Hl=kl.set,Vl=kl.getterFor(Fl);Ul(String,"String",(function(e){Hl(this,{type:Fl,string:Pl(e),index:0})}),(function(){var e,t=Vl(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Ml(n,r),t.index+=e.length,{value:e,done:!1})}));var Ql=z.Promise,jl=A,Gl=Gi,Kl=on,Wl=Ni,zl=nt("toStringTag");for(var ql in{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}){var Yl=jl[ql],Xl=Yl&&Yl.prototype;Xl&&Gl(Xl)!==zl&&Kl(Xl,zl,ql),Wl[ql]=Wl.Array}var Jl=Ql,Zl=Jl;const $l=Jn;function eA(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const s=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let s=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!s&&n.length&&t.includes("back")&&(s=n[n.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),$l("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return $l("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Zl.reject(o(e))))))}}}function tA(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function nA(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else qn(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function rA(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function iA(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new Zl(((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])})).then(n,r)}}function oA(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>nr(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),qn(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>nr(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Zl.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Zl.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function sA(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function aA(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return sA(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function s(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find((e=>e.track===t));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Zl.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=s(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function cA(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function uA(e,t){qn(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}var lA=Object.freeze({__proto__:null,shimMediaStream:tA,shimOnTrack:nA,shimGetSendersWithDtmf:rA,shimGetStats:iA,shimSenderReceiverGetStats:oA,shimAddTrackRemoveTrackWithNative:sA,shimAddTrackRemoveTrack:aA,shimPeerConnection:cA,fixNegotiationNeeded:uA,shimGetUserMedia:eA,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function AA(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){Zn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function hA(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function dA(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function pA(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Zl.resolve(new Map)}}function fA(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),qn(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function gA(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Zn("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function mA(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function vA(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function yA(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function _A(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Zl.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function EA(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Zl.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var bA=Object.freeze({__proto__:null,shimOnTrack:hA,shimPeerConnection:dA,shimSenderGetStats:pA,shimReceiverGetStats:fA,shimRemoveStream:gA,shimRTCDataChannel:mA,shimAddTransceiver:vA,shimGetParameters:yA,shimCreateOffer:_A,shimCreateAnswer:EA,shimGetUserMedia:AA,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Zl.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function wA(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function SA(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function TA(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Zl.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Zl.resolve()):i};let a=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Zl.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Zl.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),Zl.resolve()):r},t.addIceCandidate=a}function CA(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(RA(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function RA(e){return e&&void 0!==e.video?Object.assign({},e,{video:tr(e.video)}):e}function IA(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(Zn("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function OA(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function xA(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function NA(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var BA=Object.freeze({__proto__:null,shimLocalStreamsAPI:wA,shimRemoteStreamsAPI:SA,shimCallbacksAPI:TA,shimGetUserMedia:CA,shimConstraints:RA,shimRTCIceServerUrls:IA,shimTrackEventTransceiver:OA,shimCreateOfferLegacy:xA,shimAudioContext:NA}),LA=V,DA=_o,MA=c("".replace),PA="[\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff]",kA=RegExp("^"+PA+PA+"*"),UA=RegExp(PA+PA+"*$"),FA=function(e){return function(t){var n=DA(LA(t));return 1&e&&(n=MA(n,kA,"")),2&e&&(n=MA(n,UA,"")),n}},HA={start:FA(1),end:FA(2),trim:FA(3)},VA=Ss.PROPER,QA=t,jA="\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff",GA=HA.trim;mn({target:"String",proto:!0,forced:function(e){return QA((function(){return!!jA[e]()||"âÂá "!=="âÂá "[e]()||VA&&jA[e].name!==e}))}("trim")},{trim:function(){return GA(this)}});var KA=Un("String").trim,WA=u,zA=KA,qA=String.prototype,YA=function(e){var t=e.trim;return"string"==typeof e||e===qA||WA(qA,e)&&t===qA.trim?zA:t},XA={exports:{}};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return YA(e).call(e).split("\n").map((e=>YA(e).call(e)))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>{var n;return YA(n=t>0?"m="+e:e).call(n)+"\r\n"}))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++){var i,o;n=YA(i=r[e]).call(i).split("="),t[YA(o=n[0]).call(o)]=n[1]}return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");for(let i=3;i<r.length;i++){const o=r[i],s=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){const r=t.parseRtpMap(s),i=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(r.parameters=i.length?t.parseFmtp(i[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=s.length>0&&s[0].ssrc;let c;const u=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));u.length>0&&u[0].length>1&&u[0][0]===a&&(c=u[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=l}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substr(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substr(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:i};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}(XA);var JA=XA.exports,ZA=Object.freeze(function(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(n){if("default"!==n&&!(n in e)){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}}))})),Object.freeze(e)}({__proto__:null,default:JA},[XA.exports]));function $A(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=JA.parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,qn(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function eh(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||qn(e,"icecandidate",(e=>{if(e.candidate){const t=JA.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function th(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=JA.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=JA.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=JA.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=o(arguments[0],e);let s;s=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>s}),this._sctp=a}return s.apply(this,arguments)}}function nh(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},qn(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function rh(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function ih(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==YA(e).call(e))).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function oh(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Zl.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Zl.resolve())})}function sh(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then((e=>n.apply(this,[e])))})}var ah=Object.freeze({__proto__:null,shimRTCIceCandidate:$A,shimRTCIceCandidateRelayProtocol:eh,shimMaxMessageSize:th,shimSendThrowTypeError:nh,shimConnectionState:rh,removeExtmapAllowMixed:ih,shimAddIceCandidateNullOrEmpty:oh,shimParameterlessSetLocalDescription:sh});let ch,uh;!function(){let{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=Jn,r=$n(e),i={browserDetails:r,commonShim:ah,extractVersion:zn,disableLog:Yn,disableWarnings:Xn,sdp:ZA};switch(r.browser){case"chrome":if(!lA||!cA||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),i;if(null===r.version)return n("Chrome shim can not determine version, not shimming."),i;n("adapter.js shimming chrome."),i.browserShim=lA,oh(e,r),sh(e),eA(e,r),tA(e),cA(e,r),nA(e),aA(e,r),rA(e),iA(e),oA(e),uA(e,r),$A(e),eh(e),rh(e),th(e,r),nh(e),ih(e,r);break;case"firefox":if(!bA||!dA||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),i;n("adapter.js shimming firefox."),i.browserShim=bA,oh(e,r),sh(e),AA(e,r),dA(e,r),hA(e),gA(e),pA(e),fA(e),mA(e),vA(e),yA(e),_A(e),EA(e),$A(e),rh(e),th(e,r),nh(e);break;case"safari":if(!BA||!t.shimSafari)return n("Safari shim is not included in this adapter release."),i;n("adapter.js shimming safari."),i.browserShim=BA,oh(e,r),sh(e),IA(e),xA(e),TA(e),wA(e),SA(e),OA(e),CA(e),NA(e),$A(e),eh(e),th(e,r),nh(e),ih(e,r);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window}),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(ch||(ch={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(uh||(uh={}));var lh={exports:{}};!function(t,n){!function(e,r){var i="function",o="undefined",s="object",a="string",c="model",u="name",l="type",A="vendor",h="version",d="architecture",p="console",f="mobile",g="tablet",m="smarttv",v="wearable",y="embedded",_="Amazon",E="Apple",b="ASUS",w="BlackBerry",S="Google",T="Huawei",C="LG",R="Microsoft",I="Motorola",O="Samsung",x="Sharp",N="Sony",B="Xiaomi",L="Zebra",D="Facebook",M="Chromium OS",P="Mac OS",k=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},U=function(e,t){return typeof e===a&&-1!==F(t).indexOf(F(e))},F=function(e){return e.toLowerCase()},H=function(e,t){if(typeof e===a)return e=e.replace(/^\s\s*/,""),typeof t===o?e:e.substring(0,350)},V=function(e,t){for(var n,o,a,c,u,l,A=0;A<t.length&&!u;){var h=t[A],d=t[A+1];for(n=o=0;n<h.length&&!u&&h[n];)if(u=h[n++].exec(e))for(a=0;a<d.length;a++)l=u[++o],typeof(c=d[a])===s&&c.length>0?2===c.length?typeof c[1]==i?this[c[0]]=c[1].call(this,l):this[c[0]]=c[1]:3===c.length?typeof c[1]!==i||c[1].exec&&c[1].test?this[c[0]]=l?l.replace(c[1],c[2]):r:this[c[0]]=l?c[1].call(this,l,c[2]):r:4===c.length&&(this[c[0]]=l?c[3].call(this,l.replace(c[1],c[2])):r):this[c]=l||r;A+=2}},Q=function(e,t){for(var n in t)if(typeof t[n]===s&&t[n].length>0){for(var i=0;i<t[n].length;i++)if(U(t[n][i],e))return"?"===n?r:n}else if(U(t[n],e))return"?"===n?r:n;return e},j={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},G={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[h,[u,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[h,[u,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[u,h],[/opios[\/ ]+([\w\.]+)/i],[h,[u,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[h,[u,"Opera"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[u,h],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[h,[u,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[h,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[h,[u,"WeChat"]],[/konqueror\/([\w\.]+)/i],[h,[u,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[h,[u,"IE"]],[/yabrowser\/([\w\.]+)/i],[h,[u,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[u,/(.+)/,"$1 Secure Browser"],h],[/\bfocus\/([\w\.]+)/i],[h,[u,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[h,[u,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[h,[u,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[h,[u,"Dolphin"]],[/coast\/([\w\.]+)/i],[h,[u,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[h,[u,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[h,[u,"Firefox"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[u,/(.+)/,"$1 Browser"],h],[/(comodo_dragon)\/([\w\.]+)/i],[[u,/_/g," "],h],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[u,h],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[u],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[u,D],h],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[u,h],[/\bgsa\/([\w\.]+) .*safari\//i],[h,[u,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[h,[u,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[u,"Chrome WebView"],h],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[h,[u,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[u,h],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[h,[u,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[h,u],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[u,[h,Q,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[u,h],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[u,"Netscape"],h],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[h,[u,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[u,h],[/(cobalt)\/([\w\.]+)/i],[u,[h,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[d,"amd64"]],[/(ia32(?=;))/i],[[d,F]],[/((?:i[346]|x)86)[;\)]/i],[[d,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[d,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[d,"armhf"]],[/windows (ce|mobile); ppc;/i],[[d,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[d,/ower/,"",F]],[/(sun4\w)[;\)]/i],[[d,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[d,F]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[A,O],[l,g]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[c,[A,O],[l,f]],[/\((ip(?:hone|od)[\w ]*);/i],[c,[A,E],[l,f]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[A,E],[l,g]],[/(macintosh);/i],[c,[A,E]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[A,x],[l,f]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[A,T],[l,g]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[c,[A,T],[l,f]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[c,/_/g," "],[A,B],[l,f]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[A,B],[l,g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[A,"OPPO"],[l,f]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[A,"Vivo"],[l,f]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[c,[A,"Realme"],[l,f]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[A,I],[l,f]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[A,I],[l,g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[A,C],[l,g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[A,C],[l,f]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[A,"Lenovo"],[l,g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[A,"Nokia"],[l,f]],[/(pixel c)\b/i],[c,[A,S],[l,g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[A,S],[l,f]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[A,N],[l,f]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[A,N],[l,g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[A,"OnePlus"],[l,f]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[A,_],[l,g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[A,_],[l,f]],[/(playbook);[-\w\),; ]+(rim)/i],[c,A,[l,g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[A,w],[l,f]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[A,b],[l,g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[A,b],[l,f]],[/(nexus 9)/i],[c,[A,"HTC"],[l,g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[A,[c,/_/g," "],[l,f]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[A,"Acer"],[l,g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[A,"Meizu"],[l,f]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[A,c,[l,f]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[A,c,[l,g]],[/(surface duo)/i],[c,[A,R],[l,g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[A,"Fairphone"],[l,f]],[/(u304aa)/i],[c,[A,"AT&T"],[l,f]],[/\bsie-(\w*)/i],[c,[A,"Siemens"],[l,f]],[/\b(rct\w+) b/i],[c,[A,"RCA"],[l,g]],[/\b(venue[\d ]{2,7}) b/i],[c,[A,"Dell"],[l,g]],[/\b(q(?:mv|ta)\w+) b/i],[c,[A,"Verizon"],[l,g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[A,"Barnes & Noble"],[l,g]],[/\b(tm\d{3}\w+) b/i],[c,[A,"NuVision"],[l,g]],[/\b(k88) b/i],[c,[A,"ZTE"],[l,g]],[/\b(nx\d{3}j) b/i],[c,[A,"ZTE"],[l,f]],[/\b(gen\d{3}) b.+49h/i],[c,[A,"Swiss"],[l,f]],[/\b(zur\d{3}) b/i],[c,[A,"Swiss"],[l,g]],[/\b((zeki)?tb.*\b) b/i],[c,[A,"Zeki"],[l,g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[A,"Dragon Touch"],c,[l,g]],[/\b(ns-?\w{0,9}) b/i],[c,[A,"Insignia"],[l,g]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[A,"NextBook"],[l,g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[A,"Voice"],c,[l,f]],[/\b(lvtel\-)?(v1[12]) b/i],[[A,"LvTel"],c,[l,f]],[/\b(ph-1) /i],[c,[A,"Essential"],[l,f]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[A,"Envizen"],[l,g]],[/\b(trio[-\w\. ]+) b/i],[c,[A,"MachSpeed"],[l,g]],[/\btu_(1491) b/i],[c,[A,"Rotor"],[l,g]],[/(shield[\w ]+) b/i],[c,[A,"Nvidia"],[l,g]],[/(sprint) (\w+)/i],[A,c,[l,f]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[A,R],[l,f]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[A,L],[l,g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[A,L],[l,f]],[/smart-tv.+(samsung)/i],[A,[l,m]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[A,O],[l,m]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[A,C],[l,m]],[/(apple) ?tv/i],[A,[c,"Apple TV"],[l,m]],[/crkey/i],[[c,"Chromecast"],[A,S],[l,m]],[/droid.+aft(\w)( bui|\))/i],[c,[A,_],[l,m]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[c,[A,x],[l,m]],[/(bravia[\w ]+)( bui|\))/i],[c,[A,N],[l,m]],[/(mitv-\w{5}) bui/i],[c,[A,B],[l,m]],[/Hbbtv.*(technisat) (.*);/i],[A,c,[l,m]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[A,H],[c,H],[l,m]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[l,m]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[A,c,[l,p]],[/droid.+; (shield) bui/i],[c,[A,"Nvidia"],[l,p]],[/(playstation [345portablevi]+)/i],[c,[A,N],[l,p]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[A,R],[l,p]],[/((pebble))app/i],[A,c,[l,v]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[c,[A,E],[l,v]],[/droid.+; (glass) \d/i],[c,[A,S],[l,v]],[/droid.+; (wt63?0{2,3})\)/i],[c,[A,L],[l,v]],[/(quest( 2| pro)?)/i],[c,[A,D],[l,v]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[A,[l,y]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[c,[l,f]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[l,g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[l,g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[l,f]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[A,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[h,[u,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[h,[u,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[u,h],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[h,u]],os:[[/microsoft (windows) (vista|xp)/i],[u,h],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[u,[h,Q,j]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[u,"Windows"],[h,Q,j]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[h,/_/g,"."],[u,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,P],[h,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[h,u],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[u,h],[/\(bb(10);/i],[h,[u,w]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[h,[u,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[h,[u,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[h,[u,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[h,[u,"watchOS"]],[/crkey\/([\d\.]+)/i],[h,[u,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[u,M],h],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[u,h],[/(sunos) ?([\w\.\d]*)/i],[[u,"Solaris"],h],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[u,h]]},K=function(t,n){if(typeof t===s&&(n=t,t=r),!(this instanceof K))return new K(t,n).getResult();var c=typeof e!==o&&e.navigator?e.navigator:r,u=t||(c&&c.userAgent?c.userAgent:""),l=c&&c.userAgentData?c.userAgentData:r,A=n?function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n}(G,n):G;return this.getBrowser=function(){var e={};return e.name=r,e.version=r,V.call(e,u,A.browser),e.major=function(e){return typeof e===a?e.replace(/[^\d\.]/g,"").split(".")[0]:r}(e.version),c&&c.brave&&typeof c.brave.isBrave==i&&(e.name="Brave"),e},this.getCPU=function(){var e={};return e.architecture=r,V.call(e,u,A.cpu),e},this.getDevice=function(){var e={};return e.vendor=r,e.model=r,e.type=r,V.call(e,u,A.device),!e.type&&l&&l.mobile&&(e.type=f),"Macintosh"==e.model&&c&&typeof c.standalone!==o&&c.maxTouchPoints&&c.maxTouchPoints>2&&(e.model="iPad",e.type=g),e},this.getEngine=function(){var e={};return e.name=r,e.version=r,V.call(e,u,A.engine),e},this.getOS=function(){var e={};return e.name=r,e.version=r,V.call(e,u,A.os),!e.name&&l&&"Unknown"!=l.platform&&(e.name=l.platform.replace(/chrome os/i,M).replace(/macos/i,P)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return u},this.setUA=function(e){return u=typeof e===a&&e.length>350?H(e,350):e,this},this.setUA(u),this};K.VERSION="0.7.34",K.BROWSER=k([u,h,"major"]),K.CPU=k([d]),K.DEVICE=k([c,A,l,p,f,m,g,v,y]),K.ENGINE=K.OS=k([u,h]),t.exports&&(n=t.exports=K),n.UAParser=K;var W=typeof e!==o&&(e.jQuery||e.Zepto);if(W&&!W.ua){var z=new K;W.ua=z.getResult(),W.ua.get=function(){return z.getUA()},W.ua.set=function(e){z.setUA(e);var t=z.getResult();for(var n in t)W.ua[n]=t[n]}}}("object"==typeof window?window:e)}(lh,lh.exports);const Ah=new(0,lh.exports);let hh,dh,ph=Ah.getResult(),fh=null;function gh(e){if(!fh){e&&Ah.setUA(e),ph=Ah.getResult();const t=function(e){if("Blink"===e.engine.name&&"WeChat"!==e.browser.name)return uh.CHROME;switch(e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return uh.CHROME;case"Safari":case"Mobile Safari":return uh.SAFARI;case"Edge":return uh.EDGE;case"Firefox":return uh.FIREFOX;case"QQBrowser":return uh.QQ;case"Opera":return uh.OPERA;case"WeChat":return uh.WECHAT;default:return e.browser.name||""}}(ph),n=function(e){let t;return t="Blink"===e.engine.name?e.engine.version||"":e.browser.version||"",t.split(".")[0]}(ph),r=function(e){return"Windows"===e.os.name?e.os.version?e.os.name+" "+e.os.version:e.os.name:e.os.name||""}(ph),i=ph.os.version;if(!(t&&n&&r&&i))return{name:t,version:n,os:r,osVersion:i};fh={name:t,version:n,os:r,osVersion:i}}return fh}function mh(){return gh().os}function vh(){const e=gh();return"".concat(e.os," ").concat(e.osVersion)}function yh(){const e=gh();return!!("WebKit"===ph.engine.name&&e.os===ch.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==uh.SAFARI||wh()&&e.name!==uh.SAFARI)}function _h(){return gh().name===uh.CHROME}function Eh(){return gh().name===uh.SAFARI}function bh(){return gh().name===uh.FIREFOX}function wh(){return gh().os===ch.IOS}function Sh(e){const t=gh();return!(t.name!==uh.CHROME||!t.osVersion)&&Number(t.version)>=e}function Th(e){const t=gh();return!(t.name!==uh.EDGE||!t.osVersion)&&Number(t.version)>=e}function Ch(e){const t=gh();return!(t.name!==uh.OPERA||!t.osVersion)&&Number(t.version)>=e}function Rh(){const e=gh();return!(e.name!==uh.CHROME||!e.osVersion)&&Number(e.version)<=90}function Ih(){const e=gh();if(e.os!==ch.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||14===Number(t[0])&&Number(t[1])<=6}function Oh(){const e=gh();if(e.os!==ch.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])}function xh(){const e=gh();if(e.os!==ch.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 16===Number(t[0])}function Nh(){const e=gh();if(e.os!==ch.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=1}function Bh(){return Eh()&&navigator.maxTouchPoints>0}function Lh(){return gh().name===uh.WECHAT}function Dh(){return window.navigator.appVersion&&null!==window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function Mh(){const e=gh();return e.name!==uh.EDGE&&e.name!==uh.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function Ph(){return mh()===ch.ANDROID}function kh(){const e=gh();return Ph()&&(e.name===uh.CHROME||e.name===uh.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}!function(e){e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY"}(hh||(hh={})),function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(dh||(dh={}));var Uh={exports:{}},Fh=mn,Hh=y,Vh=Vt.f;Fh({target:"Object",stat:!0,forced:Object.defineProperty!==Vh,sham:!Hh},{defineProperty:Vh});var Qh=z.Object,jh=Uh.exports=function(e,t,n){return Qh.defineProperty(e,t,n)};Qh.defineProperty.sham&&(jh.sham=!0);var Gh=Uh.exports;function Kh(e,t,n){return t in e?Gh(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Wh,zh={exports:{}},qh=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},Yh=qh,Xh=Object.prototype.toString,Jh=(Wh=Object.create(null),function(e){var t=Xh.call(e);return Wh[t]||(Wh[t]=t.slice(8,-1).toLowerCase())});function Zh(e){return e=e.toLowerCase(),function(t){return Jh(t)===e}}function $h(e){return Array.isArray(e)}function ed(e){return void 0===e}var td=Zh("ArrayBuffer");function nd(e){return null!==e&&"object"==typeof e}function rd(e){if("object"!==Jh(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}var id=Zh("Date"),od=Zh("File"),sd=Zh("Blob"),ad=Zh("FileList");function cd(e){return"[object Function]"===Xh.call(e)}var ud=Zh("URLSearchParams");function ld(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),$h(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var Ad,hd=(Ad="undefined"!=typeof Uint8Array&&Object.getPrototypeOf(Uint8Array),function(e){return Ad&&e instanceof Ad}),dd={isArray:$h,isArrayBuffer:td,isBuffer:function(e){return null!==e&&!ed(e)&&null!==e.constructor&&!ed(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||Xh.call(e)===t||cd(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&td(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:nd,isPlainObject:rd,isUndefined:ed,isDate:id,isFile:od,isBlob:sd,isFunction:cd,isStream:function(e){return nd(e)&&cd(e.pipe)},isURLSearchParams:ud,isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:ld,merge:function e(){var t={};function n(n,r){rd(t[r])&&rd(n)?t[r]=e(t[r],n):rd(n)?t[r]=e({},n):$h(n)?t[r]=n.slice():t[r]=n}for(var r=0,i=arguments.length;r<i;r++)ld(arguments[r],n);return t},extend:function(e,t,n){return ld(t,(function(t,r){e[r]=n&&"function"==typeof t?Yh(t,n):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var r,i,o,s={};t=t||{};do{for(i=(r=Object.getOwnPropertyNames(e)).length;i-- >0;)s[o=r[i]]||(t[o]=e[o],s[o]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:Jh,kindOfTest:Zh,endsWith:function(e,t,n){e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return-1!==r&&r===n},toArray:function(e){if(!e)return null;var t=e.length;if(ed(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:hd,isFileList:ad},pd=dd;function fd(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var gd=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(pd.isURLSearchParams(t))r=t.toString();else{var i=[];pd.forEach(t,(function(e,t){null!=e&&(pd.isArray(e)?t+="[]":e=[e],pd.forEach(e,(function(e){pd.isDate(e)?e=e.toISOString():pd.isObject(e)&&(e=JSON.stringify(e)),i.push(fd(t)+"="+fd(e))})))})),r=i.join("&")}if(r){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e},md=dd;function vd(){this.handlers=[]}vd.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},vd.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},vd.prototype.forEach=function(e){md.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var yd=vd,_d=dd,Ed=dd;function bd(e,t,n,r,i){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),i&&(this.response=i)}Ed.inherits(bd,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var wd=bd.prototype,Sd={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach((function(e){Sd[e]={value:e}})),Object.defineProperties(bd,Sd),Object.defineProperty(wd,"isAxiosError",{value:!0}),bd.from=function(e,t,n,r,i,o){var s=Object.create(wd);return Ed.toFlatObject(e,s,(function(e){return e!==Error.prototype})),bd.call(s,e.message,t,n,r,i),s.name=e.name,o&&Object.assign(s,o),s};var Td=bd,Cd={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Rd=dd,Id=function(e,t){t=t||new FormData;var n=[];function r(e){return null===e?"":Rd.isDate(e)?e.toISOString():Rd.isArrayBuffer(e)||Rd.isTypedArray(e)?"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}return function e(i,o){if(Rd.isPlainObject(i)||Rd.isArray(i)){if(-1!==n.indexOf(i))throw Error("Circular reference detected in "+o);n.push(i),Rd.forEach(i,(function(n,i){if(!Rd.isUndefined(n)){var s,a=o?o+"."+i:i;if(n&&!o&&"object"==typeof n)if(Rd.endsWith(i,"{}"))n=JSON.stringify(n);else if(Rd.endsWith(i,"[]")&&(s=Rd.toArray(n)))return void s.forEach((function(e){!Rd.isUndefined(e)&&t.append(a,r(e))}));e(n,a)}})),n.pop()}else t.append(o,r(i))}(e),t},Od=Td,xd=dd,Nd=xd.isStandardBrowserEnv()?{write:function(e,t,n,r,i,o){var s=[];s.push(e+"="+encodeURIComponent(t)),xd.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),xd.isString(r)&&s.push("path="+r),xd.isString(i)&&s.push("domain="+i),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},Bd=function(e,t){return e&&!function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t},Ld=dd,Dd=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],Md=dd,Pd=Md.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(t){var n=Md.isString(t)?r(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0},kd=Td;function Ud(e){kd.call(this,null==e?"canceled":e,kd.ERR_CANCELED),this.name="CanceledError"}dd.inherits(Ud,kd,{__CANCEL__:!0});var Fd=Ud,Hd=dd,Vd=Nd,Qd=gd,jd=Bd,Gd=Pd,Kd=Cd,Wd=Td,zd=Fd,qd=dd,Yd=function(e,t){_d.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))},Xd=Td,Jd=Id,Zd={"Content-Type":"application/x-www-form-urlencoded"};function $d(e,t){!qd.isUndefined(e)&&qd.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var ep,tp={transitional:Cd,adapter:(("undefined"!=typeof XMLHttpRequest||"undefined"!=typeof process&&"[object process]"===Object.prototype.toString.call(process))&&(ep=function(e){return new Promise((function(t,n){var r,i=e.data,o=e.headers,s=e.responseType;function a(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}Hd.isFormData(i)&&Hd.isStandardBrowserEnv()&&delete o["Content-Type"];var c=new XMLHttpRequest;if(e.auth){var u=e.auth.username||"",l=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";o.Authorization="Basic "+btoa(u+":"+l)}var A=jd(e.baseURL,e.url);function h(){if(c){var r="getAllResponseHeaders"in c?function(e){var t,n,r,i={};return e?(Ld.forEach(e.split("\n"),(function(e){if(r=e.indexOf(":"),t=Ld.trim(e.substr(0,r)).toLowerCase(),n=Ld.trim(e.substr(r+1)),t){if(i[t]&&Dd.indexOf(t)>=0)return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}})),i):i}(c.getAllResponseHeaders()):null;(function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new Od("Request failed with status code "+n.status,[Od.ERR_BAD_REQUEST,Od.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)})((function(e){t(e),a()}),(function(e){n(e),a()}),{data:s&&"text"!==s&&"json"!==s?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:r,config:e,request:c}),c=null}}if(c.open(e.method.toUpperCase(),Qd(A,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=h:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(h)},c.onabort=function(){c&&(n(new Wd("Request aborted",Wd.ECONNABORTED,e,c)),c=null)},c.onerror=function(){n(new Wd("Network Error",Wd.ERR_NETWORK,e,c,c)),c=null},c.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",r=e.transitional||Kd;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new Wd(t,r.clarifyTimeoutError?Wd.ETIMEDOUT:Wd.ECONNABORTED,e,c)),c=null},Hd.isStandardBrowserEnv()){var d=(e.withCredentials||Gd(A))&&e.xsrfCookieName?Vd.read(e.xsrfCookieName):void 0;d&&(o[e.xsrfHeaderName]=d)}"setRequestHeader"in c&&Hd.forEach(o,(function(e,t){void 0===i&&"content-type"===t.toLowerCase()?delete o[t]:c.setRequestHeader(t,e)})),Hd.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),s&&"json"!==s&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(r=function(e){c&&(n(!e||e&&e.type?new zd:e),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r))),i||(i=null);var p=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(A);p&&-1===["http","https","file"].indexOf(p)?n(new Wd("Unsupported protocol "+p+":",Wd.ERR_BAD_REQUEST,e)):c.send(i)}))}),ep),transformRequest:[function(e,t){if(Yd(t,"Accept"),Yd(t,"Content-Type"),qd.isFormData(e)||qd.isArrayBuffer(e)||qd.isBuffer(e)||qd.isStream(e)||qd.isFile(e)||qd.isBlob(e))return e;if(qd.isArrayBufferView(e))return e.buffer;if(qd.isURLSearchParams(e))return $d(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,r=qd.isObject(e),i=t&&t["Content-Type"];if((n=qd.isFileList(e))||r&&"multipart/form-data"===i){var o=this.env&&this.env.FormData;return Jd(n?{"files[]":e}:e,o&&new o)}return r||"application/json"===i?($d(t,"application/json"),function(e,t,n){if(qd.isString(e))try{return(0,JSON.parse)(e),qd.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||tp.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,i=!n&&"json"===this.responseType;if(i||r&&qd.isString(e)&&e.length)try{return JSON.parse(e)}catch(e){if(i){if("SyntaxError"===e.name)throw Xd.from(e,Xd.ERR_BAD_RESPONSE,this,null,this.response);throw e}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};qd.forEach(["delete","get","head"],(function(e){tp.headers[e]={}})),qd.forEach(["post","put","patch"],(function(e){tp.headers[e]=qd.merge(Zd)}));var np=tp,rp=dd,ip=np,op=function(e){return!(!e||!e.__CANCEL__)},sp=dd,ap=function(e,t,n){var r=this||ip;return rp.forEach(n,(function(n){e=n.call(r,e,t)})),e},cp=op,up=np,lp=Fd;function Ap(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new lp}var hp=dd,dp=function(e,t){t=t||{};var n={};function r(e,t){return hp.isPlainObject(e)&&hp.isPlainObject(t)?hp.merge(e,t):hp.isPlainObject(t)?hp.merge({},t):hp.isArray(t)?t.slice():t}function i(n){return hp.isUndefined(t[n])?hp.isUndefined(e[n])?void 0:r(void 0,e[n]):r(e[n],t[n])}function o(e){if(!hp.isUndefined(t[e]))return r(void 0,t[e])}function s(n){return hp.isUndefined(t[n])?hp.isUndefined(e[n])?void 0:r(void 0,e[n]):r(void 0,t[n])}function a(n){return n in t?r(e[n],t[n]):n in e?r(void 0,e[n]):void 0}var c={url:o,method:o,data:o,baseURL:s,transformRequest:s,transformResponse:s,paramsSerializer:s,timeout:s,timeoutMessage:s,withCredentials:s,adapter:s,responseType:s,xsrfCookieName:s,xsrfHeaderName:s,onUploadProgress:s,onDownloadProgress:s,decompress:s,maxContentLength:s,maxBodyLength:s,beforeRedirect:s,transport:s,httpAgent:s,httpsAgent:s,cancelToken:s,socketPath:s,responseEncoding:s,validateStatus:a};return hp.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=c[e]||i,r=t(e);hp.isUndefined(r)&&t!==a||(n[e]=r)})),n},pp="0.27.2",fp=Td,gp={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){gp[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));var mp={};gp.transitional=function(e,t,n){function r(e,t){return"[Axios v0.27.2] Transitional option '"+e+"'"+t+(n?". "+n:"")}return function(n,i,o){if(!1===e)throw new fp(r(i," has been removed"+(t?" in "+t:"")),fp.ERR_DEPRECATED);return t&&!mp[i]&&(mp[i]=!0,console.warn(r(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,i,o)}};var vp=dd,yp=gd,_p=yd,Ep=function(e){return Ap(e),e.headers=e.headers||{},e.data=ap.call(e,e.data,e.headers,e.transformRequest),e.headers=sp.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),sp.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||up.adapter)(e).then((function(t){return Ap(e),t.data=ap.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return cp(t)||(Ap(e),t&&t.response&&(t.response.data=ap.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))},bp=dp,wp=Bd,Sp={assertOptions:function(e,t,n){if("object"!=typeof e)throw new fp("options must be an object",fp.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),i=r.length;i-- >0;){var o=r[i],s=t[o];if(s){var a=e[o],c=void 0===a||s(a,o,e);if(!0!==c)throw new fp("option "+o+" must be "+c,fp.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new fp("Unknown option "+o,fp.ERR_BAD_OPTION)}},validators:gp},Tp=Sp.validators;function Cp(e){this.defaults=e,this.interceptors={request:new _p,response:new _p}}Cp.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=bp(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;void 0!==n&&Sp.assertOptions(n,{silentJSONParsing:Tp.transitional(Tp.boolean),forcedJSONParsing:Tp.transitional(Tp.boolean),clarifyTimeoutError:Tp.transitional(Tp.boolean)},!1);var r=[],i=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(i=i&&e.synchronous,r.unshift(e.fulfilled,e.rejected))}));var o,s=[];if(this.interceptors.response.forEach((function(e){s.push(e.fulfilled,e.rejected)})),!i){var a=[Ep,void 0];for(Array.prototype.unshift.apply(a,r),a=a.concat(s),o=Promise.resolve(t);a.length;)o=o.then(a.shift(),a.shift());return o}for(var c=t;r.length;){var u=r.shift(),l=r.shift();try{c=u(c)}catch(e){l(e);break}}try{o=Ep(c)}catch(e){return Promise.reject(e)}for(;s.length;)o=o.then(s.shift(),s.shift());return o},Cp.prototype.getUri=function(e){e=bp(this.defaults,e);var t=wp(e.baseURL,e.url);return yp(t,e.params,e.paramsSerializer)},vp.forEach(["delete","get","head","options"],(function(e){Cp.prototype[e]=function(t,n){return this.request(bp(n||{},{method:e,url:t,data:(n||{}).data}))}})),vp.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,i){return this.request(bp(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Cp.prototype[e]=t(),Cp.prototype[e+"Form"]=t(!0)}));var Rp=Cp,Ip=Fd;function Op(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;this.promise.then((function(e){if(n._listeners){var t,r=n._listeners.length;for(t=0;t<r;t++)n._listeners[t](e);n._listeners=null}})),this.promise.then=function(e){var t,r=new Promise((function(e){n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e){n.reason||(n.reason=new Ip(e),t(n.reason))}))}Op.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},Op.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},Op.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},Op.source=function(){var e;return{token:new Op((function(t){e=t})),cancel:e}};var xp=Op,Np=dd,Bp=dd,Lp=qh,Dp=Rp,Mp=dp,Pp=function e(t){var n=new Dp(t),r=Lp(Dp.prototype.request,n);return Bp.extend(r,Dp.prototype,n),Bp.extend(r,n),r.create=function(n){return e(Mp(t,n))},r}(np);Pp.Axios=Dp,Pp.CanceledError=Fd,Pp.CancelToken=xp,Pp.isCancel=op,Pp.VERSION=pp,Pp.toFormData=Id,Pp.AxiosError=Td,Pp.Cancel=Pp.CanceledError,Pp.all=function(e){return Promise.all(e)},Pp.spread=function(e){return function(t){return e.apply(null,t)}},Pp.isAxiosError=function(e){return Np.isObject(e)&&!0===e.isAxiosError},zh.exports=Pp,zh.exports.default=Pp;var kp=zh.exports;class Up{constructor(e){Kh(this,"logger",void 0),Kh(this,"prefixLists",[]),this.logger=e}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.debug(...this.prefixLists,...t)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.info(...this.prefixLists,...t)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.warning(...this.prefixLists,...t)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.logger.error(...this.prefixLists,...t)}prefix(e){return this.prefixLists.push(e),this}popPrefix(){return this.prefixLists.pop(),this}}class Fp{constructor(){Kh(this,"_events",{}),Kh(this,"addListener",this.on)}getListeners(e){return this._events[e]?this._events[e].map((e=>e.listener)):[]}on(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!1})}once(e,t){this._events[e]||(this._events[e]=[]);const n=this._events[e];-1===this._indexOfListener(n,t)&&n.push({listener:t,once:!0})}off(e,t){if(!this._events[e])return;const n=this._events[e],r=this._indexOfListener(n,t);-1!==r&&n.splice(r,1),0===this._events[e].length&&delete this._events[e]}removeAllListeners(e){e?delete this._events[e]:this._events={}}emit(e){this._events[e]||(this._events[e]=[]);const t=this._events[e].map((e=>e));for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(let n=0;n<t.length;n+=1){const i=t[n];i.once&&this.off(e,i.listener),i.listener.apply(this,r||[])}}safeEmit(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];[...this._events[e]||[]].forEach((t=>{t.once&&this.off(e,t.listener);try{t.listener.apply(this,n)}catch(t){Jp.error("safeEmit event:".concat(e," error ").concat(null==t?void 0:t.toString()))}}))}_indexOfListener(e,t){let n=e.length;for(;n--;)if(e[n].listener===t)return n;return-1}}const Hp=new class extends Fp{reportLogUploadError(e){this.emit("REPORT_LOG_UPLOAD",e)}};let Vp;!function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"}(Vp||(Vp={}));class Qp extends Error{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0;super(t),Kh(this,"code",void 0),Kh(this,"message",void 0),Kh(this,"data",void 0),Kh(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(t),this.data=n}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),"\n").concat(this.stack):"".concat(this.stack)}print(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"error";return"error"===e&&Jp.error(this.toString()),"warning"===e&&Jp.warning(this.toString()),this}throw(){throw this.print(),this}}const jp={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Gp(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Kp(e,t,n,r){const i=Object.assign({},jp,r);let o=i.timeout;const s=async()=>{await function(e){return new Zl((t=>{window.setTimeout(t,e)}))}(o),o*=i.timeoutFactor,o=Math.min(i.maxRetryTimeout,o)};let a=!1;const c=new Zl((async(r,o)=>{t=t||(()=>!1),n=n||(()=>!0);for(let c=0;c<i.maxRetryCount;c+=1){if(a)return o(new Qp(Vp.OPERATION_ABORTED));try{const n=await e();if(!t(n,c))return r(n);if(c+1===i.maxRetryCount)return r(n);await s()}catch(e){if(!n(e,c))return o(e);if(c+1===i.maxRetryCount)return o(e);await s()}}}));return c.cancel=()=>a=!0,c}function Wp(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function zp(){const e=new Date,t=/((\d+:){2}\d+)/.exec((new Date).toUTCString());return t?(null==t?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const qp={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},Yp=Date.now(),Xp=e=>{for(const t in qp)if(Object.prototype.hasOwnProperty.call(qp,t)&&qp[t]===e)return t;return"DEFAULT"},Jp=new class{constructor(){Kh(this,"proxyServerURL",void 0),Kh(this,"logLevel",qp.DEBUG),Kh(this,"uploadState","collecting"),Kh(this,"uploadLogWaitingList",[]),Kh(this,"uploadLogUploadingList",[]),Kh(this,"uploadErrorCount",0),Kh(this,"currentLogID",0),Kh(this,"url",void 0),Kh(this,"extLog",((e,t)=>{this.appendLogToWaitingList(e,...t)}))}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[qp.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[qp.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[qp.WARNING].concat(t);this.log.apply(this,r)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[qp.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[qp.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){hf("UPLOAD_LOG",!0)}disableLogUpload(){hf("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new Up(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Yp<100)return void setTimeout((()=>{this.log(...t)}),Date.now()-Yp);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=Wp()+" Agora-SDK [".concat(Xp(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const i=Wp()+" %cAgora-SDK [".concat(Xp(r),"]:");let o=[];if(!df("USE_NEW_LOG"))switch(r){case qp.DEBUG:o=[i,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,o);break;case qp.INFO:o=[i,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,o);break;case qp.WARNING:o=[i,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,o);break;case qp.ERROR:o=[i,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,o)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-Yp<100)return void setTimeout((()=>{this.uploadLog(...t)}),Date.now()-Yp);const r=Math.max(0,Math.min(4,t[0]));t[0]=Wp()+" Agora-SDK [".concat(Xp(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!df("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=zp()+" Agora-SDK [".concat(Xp(e),"]:"):n[0]=zp()+" Agora-SDK [".concat(Xp(e),"]:");let i="";n.forEach((e=>{"object"==typeof e&&(e=JSON.stringify(e)),i+="".concat(e," ")})),this.uploadLogWaitingList.push({payload_str:i,log_level:e,log_item_id:this.currentLogID++}),"uploading"===this.uploadState&&0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",0===this.uploadLogUploadingList.length&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:$p,process_id:df("PROCESS_ID"),payload:JSON.stringify(e)};return Kp((async()=>{const e=await kp.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(df("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(df("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if("OK"!==e.data){const t=new Error("unexpected upload log response");throw t.response=e,t}}),(()=>(this.uploadLogUploadingList=[],!1)),(e=>(e.response?Hp.reportLogUploadError({status:e.response.status,data:e.response.data,headers:e.response.headers,message:e.message}):e.request?Hp.reportLogUploadError({status:e.request.status,message:e.message}):Hp.reportLogUploadError({status:-1,message:e.message}),!0)),{timeout:df("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:df("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){0===this.uploadLogUploadingList.length&&0===this.uploadLogWaitingList.length||(0===this.uploadLogUploadingList.length&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,df("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then((()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout((()=>this.uploadLogInterval()),df("UPLOAD_LOG_INTERVAL"))})).catch((e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout((()=>this.uploadLogInterval()),df("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout((()=>this.uploadLogInterval()),df("UPLOAD_LOG_RETRY_INTERVAL_V1"))})))}},Zp="v4.18.2-0-g8d83af1d-dirty(7/11/2023, 7:07:15 PM)",$p=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const e=t[1],n=t[2];return"".concat(e,".").concat(n)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const e=n[1],t=n[2];return"".concat(e,".").concat(100*(Number(t)+1))}return"4.0.0.999"}("4.18.2"),ef=function(){try{return!0===JSON.parse("true")}catch(e){return!0}}(),tf=["CHINA","GLOBAL"],nf=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),i=[];for(let e=0;e<6;e++)i.push("1");const o=i.join(""),s={};return s[e]=r,s[t]=o,Object.assign(s,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=nf;const rf={"90p":mf(160,90),"90p_1":mf(160,90),"120p":mf(160,120,15,30,65),"120p_1":mf(160,120,15,30,65),"120p_3":mf(120,120,15,30,50),"120p_4":mf(212,120),"180p":mf(320,180,15,30,140),"180p_1":mf(320,180,15,30,140),"180p_3":mf(180,180,15,30,100),"180p_4":mf(240,180,15,30,120),"240p":mf(320,240,15,40,200),"240p_1":mf(320,240,15,40,200),"240p_3":mf(240,240,15,40,140),"240p_4":mf(424,240,15,40,220),"360p":mf(640,360,15,80,400),"360p_1":mf(640,360,15,80,400),"360p_3":mf(360,360,15,80,260),"360p_4":mf(640,360,30,80,600),"360p_6":mf(360,360,30,80,400),"360p_7":mf(480,360,15,80,320),"360p_8":mf(480,360,30,80,490),"360p_9":mf(640,360,15,80,800),"360p_10":mf(640,360,24,80,800),"360p_11":mf(640,360,24,80,1e3),"480p":mf(640,480,15,100,500),"480p_1":mf(640,480,15,100,500),"480p_2":mf(640,480,30,100,1e3),"480p_3":mf(480,480,15,100,400),"480p_4":mf(640,480,30,100,750),"480p_6":mf(480,480,30,100,600),"480p_8":mf(848,480,15,100,610),"480p_9":mf(848,480,30,100,930),"480p_10":mf(640,480,10,100,400),"720p":mf(1280,720,15,120,1130),"720p_1":mf(1280,720,15,120,1130),"720p_2":mf(1280,720,30,120,2e3),"720p_3":mf(1280,720,30,120,1710),"720p_5":mf(960,720,15,120,910),"720p_6":mf(960,720,30,120,1380),"1080p":mf(1920,1080,15,120,2080),"1080p_1":mf(1920,1080,15,120,2080),"1080p_2":mf(1920,1080,30,120,3e3),"1080p_3":mf(1920,1080,30,120,3150),"1080p_5":mf(1920,1080,60,120,4780),"1440p":mf(2560,1440,30,120,4850),"1440p_1":mf(2560,1440,30,120,4850),"1440p_2":mf(2560,1440,60,120,7350),"4k":mf(3840,2160,30,120,8910),"4k_1":mf(3840,2160,30,120,8910),"4k_3":mf(3840,2160,60,120,13500)},of={"480p":vf(640,480,5),"480p_1":vf(640,480,5),"480p_2":vf(640,480,30),"480p_3":vf(640,480,15),"720p":vf(1280,720,5),"720p_1":vf(1280,720,5),"720p_2":vf(1280,720,30),"720p_3":vf(1280,720,15),"1080p":vf(1920,1080,5),"1080p_1":vf(1920,1080,5),"1080p_2":vf(1920,1080,30),"1080p_3":vf(1920,1080,15)},sf={"1SL1TL":yf(1,1),"3SL3TL":yf(3,3),"2SL3TL":yf(2,3)};function af(e){return e||(e="480p_1"),"string"==typeof e?Object.assign({},rf[e]):e}function cf(e){return"string"==typeof e?Object.assign({},of[e]):e}function uf(e){return"string"==typeof e?Object.assign({},sf[e]):e}const lf={speech_low_quality:gf(16e3,!1),speech_standard:gf(32e3,!1,18),music_standard:gf(48e3,!1),standard_stereo:gf(48e3,!0,56),high_quality:gf(48e3,!1,128),high_quality_stereo:gf(48e3,!0,192)};function Af(e){return"string"==typeof e?Object.assign({},lf[e]):e}function hf(e,t,n){Object.keys(pf).includes(e)&&(!n&&Object.keys(ff).includes(e)||(pf[e]=t))}function df(e){return pf[e]}const pf={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:tf,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},ff={};function gf(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function mf(e,t,n,r,i){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:i}}function vf(e,t,n,r,i){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:i}}function yf(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}ef||(pf.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],pf.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],pf.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],pf.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],pf.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],pf.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],pf.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",pf.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",pf.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",pf.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",pf.AREAS=["NORTH_AMERICA","OVERSEA"]);const _f=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Ef=[],bf=[];function wf(e,t){return!!t&&Ef.some((n=>n.uid===e&&n.channelName===t))}var Sf=ht,Tf=Vt,Cf=O,Rf=function(e,t,n){var r=Sf(t);r in e?Tf.f(e,r,Cf(0,n)):e[r]=n},If=Ir,Of=wn,xf=Rf,Nf=A.Array,Bf=Math.max,Lf=function(e,t,n){for(var r=Of(e),i=If(t,r),o=If(void 0===n?r:n,r),s=Nf(Bf(o-i,0)),a=0;i<o;i++,a++)xf(s,a,e[i]);return s.length=a,s},Df=Lf,Mf=Math.floor,Pf=function(e,t){var n=e.length,r=Mf(n/2);return n<8?kf(e,t):Uf(e,Pf(Df(e,0,r),t),Pf(Df(e,r),t),t)},kf=function(e,t){for(var n,r,i=e.length,o=1;o<i;){for(r=o,n=e[o];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==o++&&(e[r]=n)}return e},Uf=function(e,t,n,r){for(var i=t.length,o=n.length,s=0,a=0;s<i||a<o;)e[s+a]=s<i&&a<o?r(t[s],n[a])<=0?t[s++]:n[a++]:s<i?t[s++]:n[a++];return e},Ff=Pf,Hf=$.match(/firefox\/(\d+)/i),Vf=!!Hf&&+Hf[1],Qf=/MSIE|Trident/.test($),jf=$.match(/AppleWebKit\/(\d+)\./),Gf=!!jf&&+jf[1],Kf=mn,Wf=c,zf=be,qf=ke,Yf=wn,Xf=_o,Jf=t,Zf=Ff,$f=Bn,eg=Vf,tg=Qf,ng=se,rg=Gf,ig=[],og=Wf(ig.sort),sg=Wf(ig.push),ag=Jf((function(){ig.sort(void 0)})),cg=Jf((function(){ig.sort(null)})),ug=$f("sort"),lg=!Jf((function(){if(ng)return ng<70;if(!(eg&&eg>3)){if(tg)return!0;if(rg)return rg<603;var e,t,n,r,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)ig.push({k:t+r,v:n})}for(ig.sort((function(e,t){return t.v-e.v})),r=0;r<ig.length;r++)t=ig[r].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));Kf({target:"Array",proto:!0,forced:ag||!cg||!ug||!lg},{sort:function(e){void 0!==e&&zf(e);var t=qf(this);if(lg)return void 0===e?og(t):og(t,e);var n,r,i=[],o=Yf(t);for(r=0;r<o;r++)r in t&&sg(i,t[r]);for(Zf(i,function(e){return function(t,n){return void 0===n?-1:void 0===t?1:void 0!==e?+e(t,n)||0:Xf(t)>Xf(n)?1:-1}}(e)),n=i.length,r=0;r<n;)t[r]=i[r++];for(;r<o;)delete t[r++];return t}});var Ag=Un("Array").sort,hg=u,dg=Ag,pg=Array.prototype,fg=function(e){var t=e.sort;return e===pg||hg(pg,e)&&t===pg.sort?dg:t};function gg(e,t){if("boolean"!=typeof e)throw new Qp(Vp.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function mg(e,t,n){if(!n.includes(e))throw new Qp(Vp.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function vg(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e4,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(e<n||e>r||i&&!Cg(e))throw new Qp(Vp.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function yg(e,t){if("number"!=typeof e){if(!(e.min||e.max||e.ideal||e.exact))throw new Qp(Vp.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));void 0!==e.min&&vg(e.min,"".concat(t,".min"),0,1/0),void 0!==e.max&&vg(e.max,"".concat(t,".max"),1,1/0),void 0!==e.exact&&vg(e.exact,"".concat(t,".exact"),1,1/0),void 0!==e.ideal&&vg(e.ideal,"".concat(t,".ideal"),1,1/0)}else vg(e,t,1,1/0)}function _g(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:255,i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(null==e)throw new Qp(Vp.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!Tg(e,n,r,i))throw new Qp(Vp.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(i?" ASCII characters only.":""))}function Eg(e,t){if(!Array.isArray(e))throw new Qp(Vp.INVALID_PARAMS,"".concat(t," should be an array"))}function bg(e){if("string"!=typeof e||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw Jp.error("Invalid Channel Name ".concat(e)),new Qp(Vp.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function wg(e){if(!("number"==typeof(t=e)&&Math.floor(t)===t&&0<=t&&t<=4294967295||Tg(e,1,255)))throw Jp.error("Invalid UID ".concat(e," ").concat(typeof e)),new Qp(Vp.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;"string"==typeof e&&Jp.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function Sg(e){return null==e}function Tg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:255,r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return"string"==typeof e&&e.length<=n&&e.length>=t&&(!r||Rg(e))}function Cg(e){return"number"==typeof e&&e%1==0}function Rg(e){if("string"!=typeof e)return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}let Ig,Og,xg;!function(e){e.FREE="free",e.UPLOADING="uploading"}(Ig||(Ig={})),function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}(Og||(Og={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(xg||(xg={}));const Ng={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function Bg(e){return _g(e.reportId,"params.reportId",0,100,!1),_g(e.category,"params.category",0,100,!1),_g(e.event,"params.event",0,100,!1),_g(e.label,"params.label",0,100,!1),vg(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const Lg={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let Dg,Mg,Pg,kg,Ug,Fg,Hg,Vg,Qg,jg,Gg,Kg,Wg,zg,qg,Yg,Xg,Jg,Zg,$g,em,tm,nm,rm;function im(e){return vg(e.timeout,"config.timeout",0,1e5),vg(e.timeoutFactor,"config.timeoutFactor",0,100,!1),vg(e.maxRetryCount,"config.maxRetryConfig",0,1/0),vg(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function om(e){return mg(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),mg(e.mode,"config.mode",["rtc","live"]),void 0!==e.audioCodec&&mg(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),void 0!==e.proxyServer&&_g(e.proxyServer,"config.proxyServer",1,1e4),void 0!==e.turnServer&&am(e.turnServer),void 0!==e.httpRetryConfig&&im(e.httpRetryConfig),void 0!==e.websocketRetryConfig&&im(e.websocketRetryConfig),!0}function sm(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach((e=>{if(!e.urls)throw Error()}))}catch(e){return!1}return!0}function am(e){return _g(e.turnServerURL,"turnServerURL"),_g(e.username,"username"),_g(e.password,"password"),e.udpport&&vg(e.udpport,"udpport",1,99999,!0),e.forceturn&&gg(e.forceturn,"forceturn"),e.security&&gg(e.security,"security"),e.tcpport&&vg(e.tcpport,"tcpport",1,99999,!0),!0}function cm(e){return void 0!==e.level&&mg(e.level,"level",[1,2,3]),!0}!function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats"}(Dg||(Dg={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats"}(Mg||(Mg={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(Pg||(Pg={})),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(kg||(kg={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload"}(Ug||(Ug={})),function(e){e.TRACER="tracer"}(Fg||(Fg={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(Hg||(Hg={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(Vg||(Vg={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Qg||(Qg={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(jg||(jg={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Gg||(Gg={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Kg||(Kg={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(Wg||(Wg={})),function(e){e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(zg||(zg={})),function(e){e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(qg||(qg={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(Yg||(Yg={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(Xg||(Xg={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(Jg||(Jg={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback"}(Zg||(Zg={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter"}($g||($g={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.TRANSPORT_STATS="transport_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats"}(em||(em={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(tm||(tm={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(nm||(nm={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source"}(rm||(rm={}));const um={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},lm={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},Am={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},hm={uplinkNetworkQuality:0,downlinkNetworkQuality:0},dm={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let pm,fm,gm;!function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(pm||(pm={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(fm||(fm={})),function(e){e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(gm||(gm={}));const mm={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},vm={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function ym(e,t){_g(e.url,"".concat(t,".url"),1,1e3,!1),Sg(e.x)||vg(e.x,"".concat(t,".x"),0,1e4),Sg(e.y)||vg(e.y,"".concat(t,".y"),0,1e4),Sg(e.width)||vg(e.width,"".concat(t,".width"),0,1e4),Sg(e.height)||vg(e.height,"".concat(t,".height"),0,1e4),Sg(e.zOrder)||vg(e.zOrder,"".concat(t,".zOrder"),0,255),Sg(e.alpha)||vg(e.alpha,"".concat(t,".alpha"),0,1,!1)}const _m={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},Em={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let bm,wm,Sm,Tm,Cm,Rm,Im,Om,xm,Nm,Bm,Lm,Dm,Mm,Pm,km,Um,Fm,Hm,Vm,Qm;function jm(e){if(!e.channelName)throw new Qp(Vp.INVALID_PARAMS,"invalid channelName in info");if("number"!=typeof e.uid)throw new Qp(Vp.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&_g(e.token,"info.token",1,2047),wg(e.uid),bg(e.channelName),!0}function Gm(e){return mg(e,"mediaSource",["screen","window","application"]),!0}!function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"}(bm||(bm={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(wm||(wm={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Sm||(Sm={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(Tm||(Tm={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(Cm||(Cm={})),function(e){e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(Rm||(Rm={})),function(e){e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Im||(Im={})),function(e){e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(Om||(Om={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}(xm||(xm={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal"}(Nm||(Nm={})),function(e){e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data"}(Bm||(Bm={})),function(e){e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel"}(Lm||(Lm={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(Dm||(Dm={})),function(e){e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream"}(Mm||(Mm={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(Pm||(Pm={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(km||(km={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY"}(Um||(Um={})),function(e){e.TRANSCEIVER_UPDATED="transceiver-updated"}(Fm||(Fm={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed"}(Hm||(Hm={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Vm||(Vm={})),function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS"}(Qm||(Qm={}));const Km=[Qm.AFRICA,Qm.ASIA,Qm.CHINA,Qm.EUROPE,Qm.GLOBAL,Qm.INDIA,Qm.JAPAN,Qm.NORTH_AMERICA,Qm.OCEANIA,Qm.OVERSEA,Qm.SOUTH_AMERICA];let Wm;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL"}(Wm||(Wm={}));const zm={CHINA:{},ASIA:{CODE:Wm.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:Wm.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:Wm.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:Wm.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","\tuap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:Wm.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:Wm.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:Wm.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:Wm.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:Wm.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:Wm.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:Wm.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:Wm.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:Wm.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let qm,Ym,Xm,Jm,Zm,$m,ev,tv,nv,rv,iv,ov,sv,av,cv,uv,lv,Av,hv,dv,pv,fv;ef&&(zm.CHINA={CODE:Wm.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(qm||(qm={}));class gv extends Fp{constructor(e,t){super(),Kh(this,"onICEConnectionStateChange",void 0),Kh(this,"onConnectionStateChange",void 0),Kh(this,"onDTLSTransportStateChange",void 0),Kh(this,"onDTLSTransportError",void 0),Kh(this,"onICETransportStateChange",void 0),Kh(this,"onFirstAudioReceived",void 0),Kh(this,"onFirstVideoReceived",void 0),Kh(this,"onFirstAudioDecoded",void 0),Kh(this,"onFirstVideoDecoded",void 0),Kh(this,"onFirstVideoDecodedTimeout",void 0),Kh(this,"onSelectedLocalCandidateChanged",void 0),Kh(this,"onSelectedRemoteCandidateChanged",void 0),Kh(this,"establishPromise",void 0)}}!function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"}(Ym||(Ym={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(Xm||(Xm={})),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY"}(Jm||(Jm={})),function(e){e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Zm||(Zm={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}($m||($m={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(ev||(ev={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState"}(tv||(tv={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(nv||(nv={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(rv||(rv={})),function(e){e.ON_TRACK="on_track",e.ON_NODE="on_node"}(iv||(iv={})),function(e){e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints"}(ov||(ov={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(sv||(sv={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(av||(av={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(cv||(cv={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(uv||(uv={})),function(e){e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback"}(lv||(lv={})),function(e){e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Av||(Av={})),function(e){e[e.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",e[e.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",e[e.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",e[e.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",e[e.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",e[e.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",e[e.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",e[e.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",e[e.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",e[e.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",e[e.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",e[e.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",e[e.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",e[e.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",e[e.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",e[e.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",e[e.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",e[e.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",e[e.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",e[e.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(hv||(hv={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(dv||(dv={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(pv||(pv={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(fv||(fv={}));const mv={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1};function vv(){return mv}let yv;!function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"}(yv||(yv={}));var _v=L,Ev=Array.isArray||function(e){return"Array"==_v(e)},bv=A,wv=Ev,Sv=za,Tv=W,Cv=nt("species"),Rv=bv.Array,Iv=function(e,t){return new(function(e){var t;return wv(e)&&(t=e.constructor,(Sv(t)&&(t===Rv||wv(t.prototype))||Tv(t)&&null===(t=t[Cv]))&&(t=void 0)),void 0===t?Rv:t}(e))(0===t?0:t)},Ov=Ht,xv=F,Nv=ke,Bv=wn,Lv=Iv,Dv=c([].push),Mv=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,u,l,A){for(var h,d,p=Nv(c),f=xv(p),g=Ov(u,l),m=Bv(f),v=0,y=A||Lv,_=t?y(c,m):n||s?y(c,0):void 0;m>v;v++)if((a||v in f)&&(d=g(h=f[v],v,p),e))if(t)_[v]=d;else if(d)switch(e){case 3:return!0;case 5:return h;case 6:return v;case 2:Dv(_,h)}else switch(e){case 4:return!1;case 7:Dv(_,h)}return o?-1:r||i?i:_}},Pv={forEach:Mv(0),map:Mv(1),filter:Mv(2),some:Mv(3),every:Mv(4),find:Mv(5),findIndex:Mv(6),filterReject:Mv(7)},kv=Pv.forEach,Uv=Bn("forEach")?[].forEach:function(e){return kv(this,e,arguments.length>1?arguments[1]:void 0)};mn({target:"Array",proto:!0,forced:[].forEach!=Uv},{forEach:Uv});var Fv=Un("Array").forEach,Hv=Gi,Vv=He,Qv=u,jv=Fv,Gv=Array.prototype,Kv={DOMTokenList:!0,NodeList:!0},Wv=ke,zv=ii;mn({target:"Object",stat:!0,forced:t((function(){zv(1)}))},{keys:function(e){return zv(Wv(e))}});var qv=z.Object.keys,Yv=jn,Xv=mn,Jv=Ev,Zv=c([].reverse),$v=[1,2];Xv({target:"Array",proto:!0,forced:String($v)===String($v.reverse())},{reverse:function(){return Jv(this)&&(this.length=this.length),Zv(this)}});var ey=Un("Array").reverse,ty=u,ny=ey,ry=Array.prototype,iy=t,oy=se,sy=nt("species"),ay=function(e){return oy>=51||!iy((function(){var t=[];return(t.constructor={})[sy]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},cy=mn,uy=A,ly=Ev,Ay=za,hy=W,dy=Ir,py=wn,fy=G,gy=Rf,my=nt,vy=ec,yy=ay("slice"),_y=my("species"),Ey=uy.Array,by=Math.max;cy({target:"Array",proto:!0,forced:!yy},{slice:function(e,t){var n,r,i,o=fy(this),s=py(o),a=dy(e,s),c=dy(void 0===t?s:t,s);if(ly(o)&&(n=o.constructor,(Ay(n)&&(n===Ey||ly(n.prototype))||hy(n)&&null===(n=n[_y]))&&(n=void 0),n===Ey||void 0===n))return vy(o,a,c);for(r=new(void 0===n?Ey:n)(by(c-a,0)),i=0;a<c;a++,i++)a in o&&gy(r,i,o[a]);return r.length=i,r}});var wy=Un("Array").slice,Sy=u,Ty=wy,Cy=Array.prototype;function Ry(e,t,n,r,i){var o,s,a,c={};return function(e){var t=e.forEach;return e===Gv||Qv(Gv,e)&&t===Gv.forEach||Vv(Kv,Hv(e))?jv:t}(o=qv(r)).call(o,(function(e){c[e]=r[e]})),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=Yv(s=function(e){var t=e.reverse;return e===ry||ty(ry,e)&&t===ry.reverse?ny:t}(a=function(e){var t=e.slice;return e===Cy||Sy(Cy,e)&&t===Cy.slice?Ty:t}(n).call(n)).call(a)).call(s,(function(n,r){return r(e,t,n)||n}),c),i&&void 0!==c.initializer&&(c.value=c.initializer?c.initializer.call(i):void 0,c.initializer=void 0),void 0===c.initializer&&(Gh(e,t,c),c=null),c}var Iy=Un("Array").keys,Oy=Gi,xy=He,Ny=u,By=Iy,Ly=Array.prototype,Dy={DOMTokenList:!0,NodeList:!0},My=function(e){var t=e.keys;return e===Ly||Ny(Ly,e)&&t===Ly.keys||xy(Dy,Oy(e))?By:t};function Py(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ky(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Py(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Py(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let Uy=0,Fy=0;function Hy(e,t,n,r){return new Zl(((i,o)=>{t.timeout=t.timeout||df("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),Uy+=db(t.data)):n&&(t.data.size?Uy+=t.data.size:t.data instanceof FormData?Uy+=function(e){let t=0;return/DingTalk/i.test(navigator.userAgent)&&e.realFormData&&(e=e.realFormData),e.forEach((e=>{t+="string"==typeof e?db(e):e.size})),t+138}(t.data):Uy+=db(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,kp.request(t).then((e=>{"string"==typeof e.data?Fy+=db(e.data):e.data instanceof ArrayBuffer||e.data instanceof Uint8Array?Fy+=e.data.byteLength:Fy+=db(JSON.stringify(e.data)),r&&i({data:e.data,headers:e.headers}),i(e.data)})).catch((e=>{kp.isCancel(e)?o(new Qp(Vp.OPERATION_ABORTED,"cancel token canceled")):"ECONNABORTED"===e.code?o(new Qp(Vp.NETWORK_TIMEOUT,e.message)):e.response?o(new Qp(Vp.NETWORK_RESPONSE_ERROR,e.response.status)):o(new Qp(Vp.NETWORK_ERROR,e.message))}))}))}async function Vy(e,t){const n=new Blob([t.data],{type:"buffer"});return await Hy(e,ky(ky({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const Qy=new class extends Fp{set networkState(e){Jp.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+e),this.emit(rv.NETWORK_STATE_CHANGE,e,this._networkState),e===nv.ONLINE?this.emit(rv.ONLINE):e===nv.OFFLINE&&(this.onlineWaiter=new Zl((e=>{this.once(rv.ONLINE,(()=>{this.onlineWaiter=void 0,e(nv.ONLINE)}))})),this.emit(rv.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}constructor(){super(),Kh(this,"_moduleName","network-indicator"),Kh(this,"_networkState",nv.ONLINE),Kh(this,"onlineWaiter",void 0),window.addEventListener("online",(()=>{this.networkState=nv.ONLINE})),window.addEventListener("offline",(()=>{this.networkState=nv.OFFLINE}))}};let jy=!1;const Gy=new class extends Fp{constructor(){super(...arguments),Kh(this,"onAutoplayFailed",void 0),Kh(this,"onAudioAutoplayFailed",void 0)}};function Ky(){if(gh(),!jy){const e=t=>{t.preventDefault(),jy=!1,kh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};jy=!0,kh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Jp.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),Gy.onAutoplayFailed?Gy.onAutoplayFailed():Gy.onAudioAutoplayFailed?Jp.warning("AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.\n\n  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."):Jp.warning("We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.\n\n  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.\n\n  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web ."),Gy.emit("autoplay-failed")}}function Wy(e){return(new TextEncoder).encode(e)}const zy=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},qy=async e=>function(e,t){let n="";return new Uint8Array(e).forEach((e=>{n+=e.toString(16).padStart(2,"0")})),n}(await crypto.subtle.digest("SHA-256",Wy(e)));function Yy(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Yy(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Yy(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Jy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(t,n,r){const i=r.value;if("function"==typeof i){const o=e.className||t.__className__||("AgoraRTCClient"===t.constructor.name?"Client":t.constructor.name);r.value=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];let a=r;if(e.argsMap)try{a=e.argsMap(this,...r)}catch(e){Jp.warning(e),a=[]}try{JSON.stringify(a)}catch(e){Jp.warning("arguments for method ".concat(o,".").concat(String(n)," not serializable for apiInvoke.")),a=[]}const c=(e.report||Zy).reportApiInvoke(this._sessionId||null,{name:"".concat(o,".").concat(String(n)),options:a,tag:Fg.TRACER,reportResult:e.reportResult},e.throttleTime);try{const t=i.apply(this,r);return t instanceof Zl?t.then((t=>(c.onSuccess(e.reportResult&&t),t))).catch((e=>{throw c.onError(e),e})):(c.onSuccess(e.reportResult&&t),t)}catch(e){throw c.onError(e),e}}}return r}}const Zy=new class{constructor(){Kh(this,"baseInfoMap",new Map),Kh(this,"proxyServer",void 0),Kh(this,"clientList",Ef),Kh(this,"eventUploadTimer",void 0),Kh(this,"setSessionIdTimer",void 0),Kh(this,"url",void 0),Kh(this,"backupUrl",void 0),Kh(this,"_appId",void 0),Kh(this,"keyEventUploadPendingItems",[]),Kh(this,"normalEventUploadPendingItems",[]),Kh(this,"apiInvokeUploadPendingItems",[]),Kh(this,"apiInvokeCount",0),Kh(this,"ltsList",[]),Kh(this,"lastSendNormalEventTime",Date.now()),Kh(this,"customReportCounterTimer",void 0),Kh(this,"customReportCount",0),Kh(this,"extApiInvoke",(async e=>{for(const t of e){const e=Xy(Xy({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Fg.TRACER});this.sendApiInvoke(e)}})),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),df("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),df("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void Jp.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,Jp.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=void 0===t.reportResult||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const i=this.apiInvokeCount,o=()=>({tag:t.tag,invokeId:i,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null}),s=!!df("SHOW_REPORT_INVOKER_LOG");s&&Jp.info("".concat(t.name," start"),t.options);let a=!1;pb(t.timeout).then((()=>{a||(this.sendApiInvoke(Xy(Xy({},o()),{},{error:Vp.API_INVOKE_TIMEOUT,success:!1})),Jp.debug("".concat(t.name," timeout")))}));const c=new Qp(Vp.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:e=>{const r=()=>{if(a)throw c;return a=!0,this.sendApiInvoke(Xy(Xy({},o()),{},{success:!0},t.reportResult&&{result:e})),s&&Jp.info("".concat(t.name," onSuccess")),e};return n?Db(r,t.name+"Success",n,(()=>a=!0)):r()},onError:e=>{const r=()=>{if(a)throw e;a=!0,this.sendApiInvoke(Xy(Xy({},o()),{},{success:!1,error:e})),s&&Jp.info("".concat(t.name," onFailure"),e.toString())};return n?Db(r,t.name+"Error",n,(()=>a=!0)):r()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const i=Object.assign({},{willUploadConsoleLog:df("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ef?"global":"oversea",areas:df("AREAS")&&df("AREAS").join(",")},t.extend),o=Date.now(),s=Xy(Xy({},r),{},{eventType:Dg.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:Zp,lts:o,elapse:o-n,extend:JSON.stringify(i),mode:t.mode,process:df("PROCESS_ID"),appType:df("APP_TYPE"),success:!0,version:$p});this.send({type:Mg.SESSION,data:s},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy({},r),{},{eventType:Dg.JOIN_CHOOSE_SERVER,lts:i,eventElapse:i-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:i-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:Mg.JOIN_CHOOSE_SERVER,data:o},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy({},r),{},{eventType:Dg.REQ_USER_ACCOUNT,lts:i,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:i-n.startTime,eventElapse:i-t.lts,extend:JSON.stringify(t.extend)});this.send({type:Mg.REQ_USER_ACCOUNT,data:o},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const i=Date.now(),{firstSuccess:o,avoidJoinStartTime:s,isProxy:a,addr:c}=t,u=i-(o&&s?s:n.startTime),l=Xy(Xy({},r),{},{eventType:Dg.JOIN_GATEWAY,lts:i,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:u,eventElapse:i-t.lts,firstSuccess:o,signalChannel:t.signalChannel}),A=l.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=i),o)this.send({type:Mg.JOIN_GATEWAY,data:l},!0);else{let e;if(c)if(a){const t=c.match(/h=(\d{1,3}-){3}\d{1,3}/g),n=c.match(/p=[0-9]{1,6}/g);e={isSuccess:A,gatewayIp:t&&t.length?t[0].split("=")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split("=")[1]:"",isProxy:a?1:0}}else{const t=c.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),n=c.match(/:[0-9]{1,6}/g);e={isSuccess:A,gatewayIp:t&&t.length?t[0].split("//")[1].replace(/-/g,"."):"",port:n&&n.length?n[0].split(":")[1]:"",isProxy:a?1:0}}else e={isSuccess:A,gatewayIp:"",port:"",isProxy:a?1:0};delete l.success,delete l.eventType,delete l.firstSuccess,l.vid=Number(l.vid);const t=Object.assign({},l,e,{eventType:Dg.REJOIN_GATEWAY});this.send({type:Mg.RE_JOIN_GATEWAY,data:t},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),i=Xy(Xy({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:Mg.JOIN_CHANNEL_TIMEOUT,data:i},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy({},r),{},{eventType:Dg.PUBLISH,lts:i,eventElapse:t.eventElapse,elapse:i-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:Mg.PUBLISH,data:o},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const i=r.info,o=Date.now(),s=Xy(Xy({},i),{},{eventType:Dg.SUBSCRIBE,lts:o,eventElapse:t.eventElapse,elapse:o-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});"string"==typeof t.peerid?s.peerSuid=t.peerid:s.peer=t.peerid,this.send({type:Mg.SUBSCRIBE,data:s},!0)}wsCompressorInit(e){var t;const n=[...My(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",i=this.baseInfoMap.get(r);if(!i)return;const o=i.info,s=Date.now(),a=Xy(Xy({},o),{},{eventType:Dg.WS_COMPRESSOR_INIT,lts:s,eventElapse:e.eventElapse,elapse:s-i.startTime,status:e.status?1:2});this.send({type:Mg.WS_COMPRESSOR_INIT,data:a},!0)}firstRemoteVideoDecode(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=Xy(Xy(Xy({},o),r),{},{elapse:s-i.startTime,eventType:t,lts:s,firstDecodeFrame:Math.max(s-i.startTime,0),apEnd:Math.max(r.apEnd-i.startTime,0),apStart:Math.max(r.apStart-i.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-i.startTime,0),joinGwStart:Math.max(r.joinGwStart-i.startTime,0),pcEnd:Math.max(r.pcEnd-i.startTime,0),pcStart:Math.max(r.pcStart-i.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-i.startTime,0),subscriberStart:Math.max(r.subscriberStart-i.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-i.startTime,0)});this.send({type:n,data:a},!0)}firstRemoteFrame(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=Xy(Xy(Xy({},o),r),{},{elapse:s-i.startTime,eventType:t,lts:s});this.send({type:n,data:a},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy(Xy({},r),t),{},{vid:void 0===r.vid?0:Number(r.vid),elapse:i-n.startTime,eventType:Dg.PC_STATS,lts:i});this.send({type:Mg.PC_STATS,data:o},!0)}onGatewayStream(e,t,n,r){const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=Xy(Xy(Xy({},o),r),{},{eventType:t,lts:s});this.send({type:n,data:a},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy({},r),{},{eventType:Dg.STREAM_SWITCH,lts:i,isDual:t.isdual,elapse:i-n.startTime,success:t.succ});this.send({type:Mg.STREAM_SWITCH,data:o},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy({},r),{},{eventType:Dg.REQUEST_PROXY_APPCENTER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Mg.REQUEST_PROXY_APPCENTER,data:o},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy({},r),{},{eventType:Dg.REQUEST_PROXY_WORKER_MANAGER,lts:i,eventElapse:i-t.lts,elapse:i-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:Mg.REQUEST_PROXY_WORKER_MANAGER,data:o},!0)}setProxyServer(e){this.proxyServer=e,e?Jp.debug("reportProxyServerurl: ".concat(e)):Jp.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:i,elapse:i-n.startTime,joinChannelSuccessElapse:i-(n.lastJoinSuccessTime||i),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:Mg.PEER_PUBLISH_STATUS,data:o},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now();(function(e,t,n){const r=e[t];if(!r||"string"!=typeof r)return[e];e[t]="";const i=db(JSON.stringify(e));let o=0;const s=[];let a=0;for(let n=0;n<r.length;n++)a+=r.charCodeAt(n)<=127?1:3,a<=1300-i||(s[s.length]=hb(hb({},e),{},{[t]:r.substring(o,n)}),o=n,a=r.charCodeAt(n)<=127?1:3);return o!==r.length-1&&(s[s.length]=hb(hb({},e),{},{[t]:r.substring(o)})),s})(Xy(Xy(Xy({},r),t),{},{elapse:i-n.startTime,lts:i,productType:"WebRTC"}),"payload").forEach((e=>this.send({type:Mg.WORKER_EVENT,data:e},!0)))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy(Xy({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Mg.AP_WORKER_EVENT,data:o},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy(Xy({},r),t),{},{elapse:i-n.startTime,lts:i,extend:t.extend||void 0});this.send({type:Mg.JOIN_WEB_PROXY_AP,data:o},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,i=Date.now(),o=Xy(Xy(Xy({},r),t),{},{elapse:i-n.startTime,lts:i});this.send({type:Mg.WEBSOCKET_QUIT,data:o},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>df("CUSTOM_REPORT_LIMIT"))throw new Qp(Vp.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval((()=>{this.customReportCount=0}),5e3));const n=Date.now(),r=t.map((t=>({type:Mg.USER_ANALYTICS,data:Xy(Xy({sid:e},t),{},{lts:n})})));try{df("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(e){throw Jp.error("send custom report message failed",e.toString()),new Qp(Vp.CUSTOM_REPORT_SEND_FAILED,e.message)}}autoplayFailed(e,t,n,r){if(!e)return;const i=this.baseInfoMap.get(e);if(!i)return;const o=i.info,s=Date.now(),a=Xy(Xy({},o),{},{vid:void 0===o.vid?0:Number(o.vid),lts:s,elapse:s-i.startTime,cbRegistered:Gy.onAutoplayFailed||Gy.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});this.send({type:Mg.AUTOPLAY_FAILED,data:a},!0)}sendApiInvoke(e){const t=df("NOT_REPORT_EVENT");if(e.tag&&t.includes&&t.includes(e.tag))return!1;if(null===e.sid)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:i,cid:o}=n.info;let s;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof Qp){const{code:t,message:n}=e.error;s=t||n||e.error.toString()}else s=e.error.toString();const a={invokeId:e.invokeId,sid:e.sid,cname:r,cid:o,uid:i,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?s:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:Mg.API_INVOKE,data:a},!1),!0}appendSessionId(){this.clientList.forEach((e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const t=this.apiInvokeUploadPendingItems.shift();t&&(t.sid=e._sessionId,this.sendApiInvoke(Object.assign({},t)))}}}))}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>df("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const t=e.shift();n.length<20?n.push(t):r.push(t)}e.push(...r);for(const e of[...n]){var i;-1!==this.ltsList.indexOf(e.data.lts)?(e.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(e.data.lts)):(this.ltsList.push(e.data.lts),fg(i=this.ltsList).call(i,((e,t)=>e-t)))}return t||(this.lastSendNormalEventTime=Date.now()),df("ENABLE_EVENT_REPORT")?(n.length&&(df("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((e=>n=>{df("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(e):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(e),this.normalEventUploadPendingItems.length>df("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-df("NORMAL_EVENT_QUEUE_CAPACITY")),Jp.warning("report: drop normal events"))))})(n)),e):e}async postDataToStatsCollector2(e){Qy.networkState===nv.OFFLINE&&await Zl.race([Qy.onlineWaiter,pb(2*jp.maxRetryTimeout)]);const t=e=>{let t=new Uint8Array;return e.forEach((e=>{const n=Wy(JSON.stringify(e.data)),r=new ArrayBuffer(5),i=(e=>{let t=0;return Object.entries(Mg).forEach((n=>{let[r,i]=n;i===e.type&&(t=kg[r])})),t})(e),o=new DataView(r);o.setUint16(0,n.byteLength,!0),o.setUint8(2,255&i),o.setUint8(3,i>>>8&255),o.setUint8(4,i>>>16&255),t=zy(t,new Uint8Array(r)),t=zy(t,n)})),t},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(df("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(df("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let i=0;i<2;i+=1){1===i&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(df("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(df("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await Hy(r,{timeout:1e4,data:t(e),headers:Xy(Xy({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(e){if(1===i)throw e;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map((e=>JSON.stringify(e))),vid:(e=>{const t=e&&e.data.sid&&this.baseInfoMap.get(e.data.sid);return t&&t.info.vid&&+t.info.vid||0})(e[0])};Qy.networkState===nv.OFFLINE&&await Zl.race([Qy.onlineWaiter,pb(2*jp.maxRetryTimeout)]);const r=t?"/events/proto-raws":"/events/messages";let i=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(df("EVENT_REPORT_DOMAIN"),"&p=").concat(df("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(df("EVENT_REPORT_DOMAIN"),":").concat(df("STATS_COLLECTOR_PORT")).concat(r));for(let e=0;e<2;e+=1){1===e&&(i=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(df("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(df("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(df("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(df("STATS_COLLECTOR_PORT")).concat(r)));try{t?await Vy(i,{timeout:1e4,data:n}):await Hy(i,{timeout:1e4,data:n})}catch(t){if(1===e)throw t;continue}return}}createBaseInfo(e,t){const n=Object.assign({},Lg);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Fg.TRACER}).onSuccess()}};Hp.on("REPORT_LOG_UPLOAD",(e=>{e.networkState=Qy.networkState,Zy.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Fg.TRACER})}));class $y extends Fp{constructor(e,t){super(),Kh(this,"trackMediaType",void 0),Kh(this,"_ID",void 0),Kh(this,"_rtpTransceiver",void 0),Kh(this,"_lowRtpTransceiver",void 0),Kh(this,"_hints",[]),Kh(this,"_isClosed",!1),Kh(this,"_originMediaStreamTrack",void 0),Kh(this,"_mediaStreamTrack",void 0),Kh(this,"_external",{}),this._ID=t||gb(8,"track-"),this._originMediaStreamTrack=e,this._mediaStreamTrack=e,function(e){bf.includes(e)||bf.push(e)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(e){if(!e){const e=Zy.reportApiInvoke(null,{name:Ug.GET_MEDIA_STREAM_TRACK,options:[],tag:Fg.TRACER});this._mediaStreamTrack&&"string"==typeof this._mediaStreamTrack.label?e.onSuccess(this._mediaStreamTrack.label):e.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(e){return e===Pm.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(e){const t=bf.indexOf(e);-1!==t&&bf.splice(t,1)}(this),this.emit(Hm.CLOSED)}_updateRtpTransceiver(e,t){if(t===Pm.LOW_STREAM){if(this._lowRtpTransceiver===e)return;this._lowRtpTransceiver=e}else{if(this._rtpTransceiver===e)return;this._rtpTransceiver=e}this.emit(Fm.TRANSCEIVER_UPDATED,e,t)}}let e_,t_=1;class n_{constructor(e){Kh(this,"lockingPromise",Zl.resolve()),Kh(this,"locks",0),Kh(this,"name",""),Kh(this,"lockId",void 0),this.lockId=t_++,e&&(this.name=e),Jp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(e){let t;this.locks+=1,Jp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:""));const n=new Zl((n=>{t=()=>{this.locks-=1,Jp.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat("string"==typeof e?e:"")),n()}})),r=this.lockingPromise.then((()=>t));return this.lockingPromise=this.lockingPromise.then((()=>n)),r}}function r_(e,t){return function(n,r,i){const o=i.value;if("function"!=typeof o)throw new Error("Cannot use mutex on object property.");return i.value=async function(){const n=this[t];if(!n)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const i=await n.lock("From ".concat(e,".").concat(r));try{for(var s=arguments.length,a=new Array(s),c=0;c<s;c++)a[c]=arguments[c];return await o.apply(this,a)}finally{i()}},i}}class i_ extends $y{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}constructor(e,t){super(e,t),Kh(this,"_enabled",!0),Kh(this,"_muted",!1),Kh(this,"_isExternalTrack",!1),Kh(this,"_isClosed",!1),Kh(this,"_enabledMutex",void 0),Kh(this,"processor",void 0),Kh(this,"_processorContext",void 0),Kh(this,"_handleTrackEnded",(()=>{this.onTrackEnded()})),this._enabledMutex=new n_("".concat(this.getTrackId())),e.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var e,t;return null!==(e=null===(t=this._originMediaStreamTrack)||void 0===t?void 0:t.label)&&void 0!==e?e:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,Jp.debug("[".concat(this.getTrackId(),"] close")),this.emit(Dm.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._isExternalTrack=n,e!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await bb(this,Dm.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){Jp.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Hm.TRACK_ENDED)}stateCheck(e,t){if(Jp.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(e,": ").concat(t,"]")),gg(t,e),this._enabled&&this._muted&&"enabled"===e&&!1===t)throw new Qp(Vp.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&"muted"===e&&!0===t)throw new Qp(Vp.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function o_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}!function(e){e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"}(e_||(e_={}));const s_=window.AudioContext||window.webkitAudioContext;let a_=null;const c_=new class extends Fp{constructor(){super(...arguments),Kh(this,"prevState",void 0),Kh(this,"curState",void 0),Kh(this,"currentTime",void 0),Kh(this,"currentTimeStuckAt",void 0),Kh(this,"interruptDetectorTrack",void 0),Kh(this,"onLocalAudioTrackMute",(()=>{Jp.info("ios15-interruption-start"),this.emit(e_.IOS_15_16_INTERRUPTION_START)})),Kh(this,"onLocalAudioTrackUnmute",(async()=>{Jp.info("ios15-interruption-end"),"running"!==this.curState||this.duringInterruption?Jp.info("ios15-interruption-end-canceled"):(a_&&await a_.suspend(),this.emit(e_.IOS_15_16_INTERRUPTION_END))}))}get duringInterruption(){return"running"===this.prevState&&"interrupted"===this.curState}bindInterruptDetectorTrack(e){Jp.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){Jp.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function u_(){if(!a_){if(function(){if(!s_)return void Jp.error("your browser is not support web audio");Jp.info("create audio context");const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o_(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},df("WEBAUDIO_INIT_OPTIONS"));Jp.debug("audio context init option:",JSON.stringify(e)),a_=new s_(e),c_.curState=a_.state,a_.onstatechange=()=>{c_.prevState=c_.curState,c_.curState=a_?a_.state:void 0;const{prevState:e,curState:t}=c_,n="running"===t,r="interrupted"===t,i="running"===e,o="suspended"===e,s="interrupted"===e,a=gh().osVersion;(wh()||Bh())&&i&&r&&(Jp.info("ios".concat(a,"-interruption-start")),c_.emit(e_.IOS_INTERRUPTION_START)),(wh()||Bh())&&(o||s)&&n&&(Jp.info("ios".concat(a,"-interruption-end")),c_.emit(e_.IOS_INTERRUPTION_END)),e!==t&&(Jp.debug("AudioContext State Change","".concat(e,"=>").concat(t)),c_.emit(e_.STATE_CHANGE))},setInterval((()=>{var e;const t=null===(e=a_)||void 0===e?void 0:e.currentTime;c_.currentTime!==t?(c_.currentTimeStuckAt&&(Jp.debug("AudioContext current time resume at ".concat(t)),c_.currentTimeStuckAt=void 0),c_.currentTime=t):(t!==c_.currentTimeStuckAt&&(Zy.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:t},tag:Fg.TRACER}).onSuccess(),Jp.warning("AudioContext current time stuck at ".concat(t))),c_.currentTimeStuckAt=t)}),5e3),async function(e){const t=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let n,r=!1,i=!1,o=!1;function s(t){"running"===e.state?a(!1):wh()||Bh()?"suspended"===e.state&&(a(!0),t&&e.resume().then(c,c)):"closed"!==e.state&&(a(!0),t&&e.resume().then(c,c))}function a(e){if(r!==e){r=e;for(let n=0,r=t;n<r.length;n+=1){const t=r[n];e?window.addEventListener(t,u,{capture:!0,passive:!0}):window.removeEventListener(t,u,{capture:!0,passive:!0})}}}function c(){s(!1)}function u(){s(!0)}function l(e){if(!o)if(n.paused)if(e){let t;A(!1),o=!0;try{t=n.play(),t?t.then(h,h):(n.addEventListener("playing",h),n.addEventListener("abort",h),n.addEventListener("error",h))}catch(e){h()}}else A(!0);else A(!1)}function A(e){if(i!==e){i=e;for(let n=0,r=t;n<r.length;n++){const t=r[n];e?window.addEventListener(t,d,{capture:!0,passive:!0}):window.removeEventListener(t,d,{capture:!0,passive:!0})}}}function h(){n.removeEventListener("playing",h),n.removeEventListener("abort",h),n.removeEventListener("error",h),o=!1,l(!1)}function d(){l(!0)}if(wh()){const t=e.createMediaStreamDestination(),r=document.createElement("div");r.innerHTML="<audio x-webkit-airplay='deny'></audio>",n=r.children.item(0),n.controls=!1,n.disableRemotePlayback=!0,n.preload="auto",n.srcObject=t.stream,l(!0)}c_.on(e_.STATE_CHANGE,(function(){s(!0)})),s(!1)}(a_)}(),!a_)throw new Qp(Vp.NOT_SUPPORTED,"can not create audio context");return a_}return a_}function l_(){return!!a_}function A_(e){if(function(){if(null!==h_)return h_;const e=u_(),t=e.createBufferSource(),n=e.createGain(),r=e.createGain();t.connect(n),t.connect(r),t.disconnect(n);let i=!1;try{t.disconnect(n)}catch(e){i=!0}return t.disconnect(),h_=i,i}())return;const t=e.connect,n=e.disconnect;e.connect=(n,r,i)=>(e._inputNodes||(e._inputNodes=[]),e._inputNodes.includes(n)||(n instanceof AudioNode?(e._inputNodes.push(n),t.call(e,n,r,i)):t.call(e,n,r)),e),e.disconnect=(r,i,o)=>{n.call(e),r?Tb(e._inputNodes,r):e._inputNodes=[];for(const n of e._inputNodes)t.call(e,n)}}let h_=null;function d_(e,t){let n=!1;const r=1/t;if(df("DISABLE_WEBAUDIO")){const t=window.setInterval((()=>{n?window.clearInterval(t):e(performance.now()/1e3)}),1e3*r)}else{const t=u_();let i=t.createGain();i.gain.value=0,i.connect(t.destination);const o=()=>{if(n)return void(i=null);const s=t.createOscillator();s.onended=o,s.connect(i),s.start(0),s.stop(t.currentTime+r),e(t.currentTime)};o()}return()=>{n=!0}}class p_{constructor(){Kh(this,"context",void 0),Kh(this,"analyserNode",void 0),Kh(this,"sourceNode",void 0),this.context=u_(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(e){if(e!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch(e){}this.sourceNode=e,null==e||e.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode)return 0;if(!this.context||wh()||Bh()||"running"!==this.context.state&&this.context.resume(),!this.analyserNode)return 0;const e=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(e);else{const t=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(t);for(let n=0;n<e.length;++n)e[n]=t[n]/128-1}const t=Gn(e).call(e,((e,t)=>e+t*t),0)/e.length;return Math.max(10*Math.log10(t)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var e,t;null===(e=this.sourceNode)||void 0===e||e.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,null===(t=this.sourceNode)||void 0===t||t.connect(this.analyserNode)}catch(e){Jp.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class f_ extends Fp{get processSourceNode(){return this.sourceNode}set processedNode(e){var t;if(!this.isDestroyed&&this._processedNode!==e){try{var n;null===(n=this.sourceNode)||void 0===n||n.disconnect(this.outputNode)}catch(e){}null===(t=this._processedNode)||void 0===t||t.disconnect(),this._processedNode=e,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Kh(this,"outputNode",void 0),Kh(this,"outputTrack",void 0),Kh(this,"isPlayed",!1),Kh(this,"sourceNode",void 0),Kh(this,"context",void 0),Kh(this,"audioBufferNode",void 0),Kh(this,"destNode",void 0),Kh(this,"audioOutputLevel",0),Kh(this,"volumeLevelAnalyser",void 0),Kh(this,"_processedNode",void 0),Kh(this,"playNode",void 0),Kh(this,"isDestroyed",!1),Kh(this,"onNoAudioInput",void 0),Kh(this,"isNoAudioInput",!1),Kh(this,"_noAudioInputCount",0),this.context=u_(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),A_(this.outputNode),this.volumeLevelAnalyser=new p_}startGetAudioBuffer(e){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(e),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=e=>{this.emit(rm.ON_AUDIO_BUFFER,function(e){for(let t=0;t<e.outputBuffer.numberOfChannels;t+=1){const n=e.outputBuffer.getChannelData(t);for(let e=0;e<n.length;e+=1)n[e]=0}return e.inputBuffer}(e))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!vv().webAudioMediaStreamDest)throw new Qp(Vp.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(e){"running"!==this.context.state&&Rb((()=>{c_.emit("autoplay-failed")})),this.isPlayed=!0,this.playNode=e||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch(e){}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(e>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;wh()||Bh()?"suspended"===this.context.state&&this.context.resume():"running"!==this.context.state&&this.context.resume();const t=this.volumeLevelAnalyser.getAnalyserNode();let n;t.getFloatTimeDomainData?(n=new Float32Array(t.fftSize),t.getFloatTimeDomainData(n)):(n=new Uint8Array(t.fftSize),t.getByteTimeDomainData(n));let r=!1;for(let e=0;e<n.length;e++)0!==n[e]&&(r=!0);return r?(this.isNoAudioInput=!1,!0):(await pb(200),await this.checkHasAudioInput(e?e+1:1)&&r)}getAudioVolume(){return this.outputNode.gain.value}setVolume(e){this.outputNode.gain.setValueAtTime(e,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var e,t;null===(e=this.processedNode)||void 0===e||e.disconnect(),null===(t=this.sourceNode)||void 0===t||t.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var e;this.processedNode?null===(e=this.processedNode)||void 0===e||e.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class g_ extends f_{get isFreeze(){return!1}constructor(e,t,n){var r;if(super(),Kh(this,"sourceNode",void 0),Kh(this,"track",void 0),Kh(this,"clonedTrack",void 0),Kh(this,"audioElement",void 0),Kh(this,"isCurrentTrackCloned",!1),Kh(this,"isRemoteTrack",!1),Kh(this,"originVolumeLevelAnalyser",void 0),Kh(this,"rebuildWebAudio",(async()=>{if(Jp.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void Jp.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then((()=>Jp.info("resume success"))),Jp.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const e=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?e.stop():this.isCurrentTrackCloned=!0;const t=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(t),A_(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const n=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(n,this.context.currentTime),A_(this.outputNode),this.emit(rm.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=t,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()})),"audio"!==e.kind)throw new Qp(Vp.UNEXPECTED_ERROR);this.track=e;const i=new MediaStream([this.track]);if(this.isRemoteTrack=!!t,this.sourceNode=this.context.createMediaStreamSource(i),A_(this.sourceNode),n){const e=n.clone();e.enabled=!0,this.clonedTrack=e,Jp.debug("create an unmuted track ".concat(e.id," from the original track ").concat(n.id," to get the volume"));const t=this.context.createMediaStreamSource(new MediaStream([e]));A_(t),this.originVolumeLevelAnalyser=new p_,this.originVolumeLevelAnalyser.updateSource(t)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=i;const o=gh();t&&o.os===ch.IOS&&Number(null===(r=o.osVersion)||void 0===r?void 0:r.split(".")[0])<15&&(c_.on(e_.STATE_CHANGE,(()=>{"suspended"===this.context.state?document.body.addEventListener("click",this.rebuildWebAudio,!0):"running"===this.context.state&&this.rebuildWebAudio()})),this.checkHasAudioInput().then((e=>{e||document.body.addEventListener("click",this.rebuildWebAudio,!0)})))}updateTrack(e){this.sourceNode.disconnect(),this.track=e,this.isCurrentTrackCloned=!1;const t=new MediaStream([e]);this.sourceNode=this.context.createMediaStreamSource(t),A_(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(rm.UPDATE_SOURCE),this.audioElement.srcObject=t}destroy(){var e;this.audioElement.srcObject=null,this.audioElement.remove(),c_.off("state-change",this.rebuildWebAudio),null===(e=this.originVolumeLevelAnalyser)||void 0===e||e.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(e){return this.context.createMediaStreamSource(new MediaStream([e]))}updateOriginTrack(e){const t=e.clone();t.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=t),Jp.debug("create an unmuted track ".concat(t.id," from the original track ").concat(e.id," to get the volume"));const n=this.context.createMediaStreamSource(new MediaStream([t]));A_(n),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(n)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function m_(e,t){const n=(e,t)=>e?"number"!=typeof e?e.max||e.exact||e.ideal||e.min||t:e:t,r={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&"number"!=typeof t.frameRate?(r.video.mandatory.maxFrameRate=t.frameRate.max,r.video.mandatory.minFrameRate=t.frameRate.min):"number"==typeof t.frameRate&&(r.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function v_(e){let t=["window","screen"];"application"!==e&&"window"!==e||(t=["window"]),"screen"===e&&(t=["screen"]);const n=__();if(!n)throw new Qp(Vp.ELECTRON_IS_NULL);let r=null;try{var i;r=(null===(i=n.desktopCapturer)||void 0===i?void 0:i.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch(e){r=null}r&&r.then||(r=new Zl(((e,r)=>{n.desktopCapturer.getSources({types:t},((t,n)=>{t?r(t):e(n)}))})));try{return await r}catch(e){throw new Qp(Vp.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,e.toString())}}let y_=null;function __(){if(y_)return y_;try{return y_=window.require("electron"),y_}catch(e){return null}}function E_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const b_=new n_("safari");let w_=!1,S_=!1;async function T_(e,t){let n=0,r=null;for(;n<2;)try{r=await C_(e,t,n>0);break}catch(e){if(e instanceof Qp)throw Jp.error("[".concat(t,"] ").concat(e.toString())),e;const r=R_(e.name||e.code||e,e.message);if(r.code===Vp.MEDIA_OPTION_INVALID){Jp.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await pb(500);continue}throw Jp.error("[".concat(t,"] ").concat(r.toString())),r}if(!r)throw new Qp(Vp.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function C_(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Qp(Vp.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=vv(),i=new MediaStream;if(e.audioSource&&i.addTrack(e.audioSource),e.videoSource&&i.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return Jp.debug("Using Video Source/ Audio Source"),i;if(e.screen)if(__())e.screen.sourceId?I_(i,await m_(e.screen.sourceId,e.screen)):I_(i,await async function(e){const t=await v_(e.mediaSource),n=await function(e){return new Zl(((t,n)=>{const r=document.createElement("div");r.innerText="share screen",r.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const i=document.createElement("div");i.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const o=document.createElement("div");o.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",o.setAttribute("style","height: 12%;");const s=document.createElement("div");s.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const a=document.createElement("div");a.setAttribute("style","text-align: right; padding: 16px 0;");const c=document.createElement("button");c.innerHTML="cancel",c.setAttribute("style","width: 85px;"),c.onclick=()=>{document.body.removeChild(u);const e=new Error("NotAllowedError");e.name="NotAllowedError",n(e)},a.appendChild(c),i.appendChild(o),i.appendChild(s),i.appendChild(a);const u=document.createElement("div");u.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),u.appendChild(r),u.appendChild(i),document.body.appendChild(u),e.map((e=>{if(e.id){const n=document.createElement("div");n.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let r=e.thumbnail;const{width:i}=r.getSize();i>1920&&(r=r.resize({width:1920})),n.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+r.toDataURL()+' /></div><span style="\theight: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+e.name.replace(/[\u00A0-\u9999<>\&]/g,(function(e){return"&#"+e.charCodeAt(0)+";"}))+"</span>",n.onclick=()=>{document.body.removeChild(u),t(e.id)},s.appendChild(n)}}))}))}(t);return await m_(n,e)}(e.screen));else if(_h()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new Qp(Vp.NOT_SUPPORTED,"This browser does not support screen sharing");Jp.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const n=await(s=e.screen.extensionId,a=t,new Zl(((e,t)=>{try{chrome.runtime.sendMessage(s,{getStream:!0},(n=>{if(!n||!n.streamId)return Jp.error("[".concat(a,"] No response from Chrome Plugin. Plugin not installed properly"),n),void t(new Qp(Vp.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));e(n.streamId)}))}catch(e){Jp.error("[".concat(a,"] AgoraRTC screensharing plugin is not accessible(").concat(s,")"),e.toString()),t(new Qp(Vp.CHROME_PLUGIN_NOT_INSTALL))}})));e.screen.mandatory.chromeMediaSourceId=n,I_(i,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var o;e.screen.mediaSource&&Gm(e.screen.mediaSource);const n={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:null!==(o=e.screen.displaySurface)&&void 0!==o?o:"screen"===e.screen.mediaSource?"monitor":e.screen.mediaSource},{selfBrowserSurface:r,surfaceSwitching:s,systemAudio:a}=e.screen,c={selfBrowserSurface:r,surfaceSwitching:s,systemAudio:a};!r&&delete c.selfBrowserSurface,!s&&delete c.surfaceSwitching,!a&&delete c.systemAudio,Jp.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:n,audio:!!e.screenAudio,controls:c})),I_(i,await navigator.mediaDevices.getDisplayMedia(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E_(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({video:n,audio:!!e.screenAudio},c)))}else{if(!bh())throw Jp.error("[".concat(t,"] This browser does not support screenSharing")),new Qp(Vp.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&Gm(e.screen.mediaSource);const n={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};Jp.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(n))),I_(i,await navigator.mediaDevices.getUserMedia(n))}}var s,a;if(!e.video&&!e.audio)return i;let c={video:e.video,audio:e.audio},u=df("MEDIA_DEVICE_CONSTRAINTS");if(u)try{"string"==typeof u&&(u=JSON.parse(u)),c=function e(t,n){if(!Pb(t)||!Pb(n))return n;if(Array.isArray(t)&&!Array.isArray(n)||!Array.isArray(t)&&Array.isArray(n))return n;if(Array.isArray(n)&&Array.isArray(t)){const r=[...t];for(let i=0;i<n.length;i++)r[i]=e(t[i],n[i]);return r}{const r=hb({},t);for(const i in n)Object.prototype.hasOwnProperty.call(n,i)&&(Object.prototype.hasOwnProperty.call(t,i)?r[i]=e(t[i],n[i]):r[i]=n[i]);return r}}(c,u)}catch(e){}Jp.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(c)),gh();let l,A=null;(Eh()||wh()||yh())&&(A=await b_.lock());try{l=await navigator.mediaDevices.getUserMedia(c)}catch(e){throw A&&A(),e}return c.audio&&(w_=!0),c.video&&(S_=!0),I_(i,l),A&&A(),i}function R_(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Qp(Vp.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new Qp(Vp.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new Qp(Vp.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new Qp(Vp.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Qp(Vp.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new Qp(Vp.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return Jp.error("getUserMedia unexpected error",e),new Qp(Vp.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function I_(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],i=t.getVideoTracks()[0],o=t.getAudioTracks()[0];o&&(r&&e.removeTrack(r),e.addTrack(o)),i&&(n&&e.removeTrack(n),e.addTrack(i))}const O_=new class extends Fp{get state(){return this._state}set state(e){e!==this._state&&(this.emit(Vg.STATE_CHANGE,e),this._state=e)}constructor(){super(),Kh(this,"_state",Hg.IDLE),Kh(this,"isAccessMicrophonePermission",!1),Kh(this,"isAccessCameraPermission",!1),Kh(this,"lastAccessMicrophonePermission",!1),Kh(this,"lastAccessCameraPermission",!1),Kh(this,"checkdeviceMatched",!1),Kh(this,"deviceInfoMap",new Map),this.init().then((()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval((()=>{(df("ENUMERATE_DEVICES_INTERVAL")||(Ph()||mh()===ch.HARMONY_OS)&&Mh())&&this.updateDevicesInfo()}),df("ENUMERATE_DEVICES_INTERVAL_TIME"))})).catch((e=>Jp.error(e.toString())))}async enumerateDevices(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Qp(Vp.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),i=this.checkMediaDeviceInfoIsOk(r);let o=!this.isAccessMicrophonePermission&&e,s=!this.isAccessCameraPermission&&t;i.audio&&(o=!1),i.video&&(s=!1);let a=null,c=null,u=null;if(!n&&(o||s)){if(b_.isLocked&&(Jp.debug("[device manager] wait GUM lock"),(await b_.lock())(),Jp.debug("[device manager] GUM unlock")),w_&&(o=!1,this.isAccessMicrophonePermission=!0),S_&&(s=!1,this.isAccessCameraPermission=!0),Jp.debug("[device manager] check media device permissions",e,t,o,s),o&&s){try{u=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(e){const t=R_(e.name||e.code||e,e.message);if(t.code===Vp.PERMISSION_DENIED)throw t;Jp.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(o){try{a=await navigator.mediaDevices.getUserMedia({audio:e})}catch(e){const t=R_(e.name||e.code||e,e.message);if(t.code===Vp.PERMISSION_DENIED)throw t;Jp.warning("getUserMedia failed in getDevices",t)}this.isAccessMicrophonePermission=!0}else if(s){try{c=await navigator.mediaDevices.getUserMedia({video:t})}catch(e){const t=R_(e.name||e.code||e,e.message);if(t.code===Vp.PERMISSION_DENIED)throw t;Jp.warning("getUserMedia failed in getDevices",t)}this.isAccessCameraPermission=!0}Jp.debug("[device manager] mic permission",e,"cam permission",t)}try{const e=await navigator.mediaDevices.enumerateDevices();return a&&a.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),u&&u.getTracks().forEach((e=>e.stop())),a=null,c=null,u=null,e}catch(e){return a&&a.getTracks().forEach((e=>e.stop())),c&&c.getTracks().forEach((e=>e.stop())),u&&u.getTracks().forEach((e=>e.stop())),a=null,c=null,u=null,new Qp(Vp.ENUMERATE_DEVICES_FAILED,e.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audioinput"===e.kind))}async getCamerasDevices(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter((e=>"videoinput"===e.kind))}async getSpeakers(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter((e=>"audiooutput"===e.kind))}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach((n=>{n.device.label===e&&(t=n.device.deviceId)})),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find((t=>t.deviceId===e));if(!t)throw new Qp(Vp.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Hg.INITING;try{await this.updateDevicesInfo(),this.state=Hg.INITEND}catch(e){throw Jp.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Hg.IDLE,("boolean"==typeof isSecureContext?isSecureContext:"https:"===location.protocol||"file:"===location.protocol||"localhost"===location.hostname||"127.0.0.1"===location.hostname||"::1"===location.hostname)||new Qp(Vp.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),t=Date.now(),n=[];if(e[0]&&e[0].label&&!1===this.checkdeviceMatched){this.checkdeviceMatched=!0;const t=e.find((e=>"audioinput"===e.kind&&"default"===e.deviceId)),n=e.find((e=>"audiooutput"===e.kind&&"default"===e.deviceId));t&&n?n.groupId===t.groupId?Jp.debug("[device-check] default input ".concat(t.label," and output ").concat(n.label," is the same group")):Jp.warning("[device-check] default input ".concat(t.label," and output ").concat(n.label," is not the same group")):Jp.debug("[device-check] default input or output not found")}const r=this.checkMediaDeviceInfoIsOk(e);if(e.forEach((e=>{if(!e.deviceId)return;const r=this.deviceInfoMap.get("".concat(e.kind,"_").concat(e.deviceId));if("ACTIVE"!==(r?r.state:"INACTIVE")){const r={initAt:t,updateAt:t,device:e,state:"ACTIVE"};this.deviceInfoMap.set("".concat(e.kind,"_").concat(e.deviceId),r),n.push(r)}r&&(r.updateAt=t)})),this.deviceInfoMap.forEach(((e,r)=>{"ACTIVE"===e.state&&e.updateAt!==t&&(e.state="INACTIVE",n.push(e))})),this.state!==Hg.INITEND)return r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));n.forEach((e=>{switch(e.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Vg.RECORDING_DEVICE_CHANGED,e);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(Vg.CAMERA_DEVICE_CHANGED,e);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(Vg.PLAYOUT_DEVICE_CHANGED,e)}})),r.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),r.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const t=e.filter((e=>"audioinput"===e.kind)),n=e.filter((e=>"videoinput"===e.kind)),r={audio:!1,video:!1};for(const e of t)if(e.label&&e.deviceId){r.audio=!0;break}for(const e of n)if(e.label&&e.deviceId){r.video=!0;break}return r}},x_=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],N_=new class{constructor(){Kh(this,"onAutoplayFailed",void 0),Kh(this,"elementMap",new Map),Kh(this,"elementStateMap",new Map),Kh(this,"elementsNeedToResume",[]),Kh(this,"sinkIdMap",new Map),Kh(this,"autoResumeAfterInterruption",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=this.elementStateMap.get(t),i=n.srcObject.getAudioTracks()[0];Oh()?i&&"live"===i.readyState&&"running"===c_.curState&&(Jp.debug("auto resume after interruption for iOS 15"),n.pause(),n.play()):r&&"paused"===r&&i&&"live"===i.readyState&&"running"===c_.curState&&(Jp.debug("auto resume after interruption for iOS"),n.play())}))})),Kh(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{Array.from(this.elementMap.entries()).forEach((e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&"live"===r.readyState&&(Jp.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())}))})),this.autoResumeAudioElement(),c_.on(e_.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),c_.on(e_.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),c_.on(e_.STATE_CHANGE,(()=>{wh()&&"suspended"===c_.prevState&&"running"===c_.curState&&this.autoResumeAfterInterruption()}))}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(e){throw new Qp(Vp.PERMISSION_DENIED,"can not set sink id: "+e.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const i=document.createElement("audio");i.autoplay=!0,i.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,i),this.elementMap.set(t,i),this.elementStateMap.set(t,xg.INIT),this.setVolume(t,n);const o=this.sinkIdMap.get(t);if(o)try{i.setSinkId(o).catch((e=>{Jp.warning("[".concat(t,"] set sink id failed"),e.toString())}))}catch(e){Jp.warning("[".concat(t,"] set sink id failed"),e.toString())}const s=i.play();s&&s.then&&s.catch((e=>{r&&Zy.autoplayFailed(r,"audio",e.message,t),Jp.warning("audio element play warning",e.toString()),this.elementMap.has(t)&&"NotAllowedError"===e.name&&(Jp.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(i),Rb((()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),Ky()})))}))}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&"playing"===this.elementStateMap.get(e)}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){x_.forEach((n=>{t.addEventListener(n,(n=>{const r=this.elementStateMap.get(e),i="pause"===n.type?"paused":n.type;if(Jp.debug("[".concat(e,"] audio-element-status change ").concat(r," => ").concat(i)),"error"===n.type){const n=null==t?void 0:t.error;n&&Jp.error("[".concat(e,"] media error, code: ").concat(n.code,", message: ").concat(n.message))}this.elementStateMap.set(e,i)}))}))}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach((e=>{e.play().then((e=>{Jp.debug("Auto resume audio element success")})).catch((e=>{Jp.warning("Auto resume audio element failed!",e)}))})),this.elementsNeedToResume=[]};new Zl((e=>{document.body?e():window.addEventListener("load",(()=>e()))})).then((()=>{kh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))}))}};function B_(){return function(e,t,n){const r=n.value;return"function"==typeof r&&(n.value=function(){this._isClosed&&new Qp(Vp.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const i=r.apply(this,t);return i instanceof Zl?new Zl(((e,t)=>{i.then(e).catch(t)})):i}),n}}var L_=Un("Array").values,D_=Gi,M_=He,P_=u,k_=L_,U_=Array.prototype,F_={DOMTokenList:!0,NodeList:!0},H_=function(e){var t=e.values;return e===U_||P_(U_,e)&&t===U_.values||M_(F_,D_(e))?k_:t};function V_(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Q_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?V_(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):V_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class j_ extends Fp{constructor(e){super(),Kh(this,"name","VideoProcessorDestination"),Kh(this,"ID","0"),Kh(this,"_source",void 0),Kh(this,"videoContext",void 0),Kh(this,"inputTrack",void 0),this.videoContext=e}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Qp(Vp.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Qp(Vp.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(e){if(e.context!==this.videoContext)throw new Error("ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.\nProbably you are making pipeline like this:\nvideoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).");e.track&&e.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=e.track,this.emit(iv.ON_TRACK,e.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(iv.ON_TRACK,void 0)}}class G_ extends Fp{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t){super(),Kh(this,"constraintsMap",new Map),Kh(this,"statsRegistry",[]),Kh(this,"usageRegistry",[]),Kh(this,"trackId",void 0),Kh(this,"direction",void 0),Kh(this,"_chained",!1),this.trackId=e,this.direction=t}async getConstraints(){return await Eb(this,ov.REQUEST_CONSTRAINTS)}async requestApplyConstraints(e,t){var n;return Jp.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),bb(this,ov.REQUEST_UPDATE_CONSTRAINTS,Array.from(H_(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return Jp.info("processor ".concat(e.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(e),bb(this,ov.REQUEST_UPDATE_CONSTRAINTS,Array.from(H_(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){Jp.error(new Qp(Vp.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof Zl&&(n=await n),e.push(Q_(Q_({},n),{},{direction:this.direction}))}catch(e){Jp.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class K_ extends Fp{constructor(e){super(),Kh(this,"name","AudioProcessorDestination"),Kh(this,"ID","0"),Kh(this,"inputTrack",void 0),Kh(this,"inputNode",void 0),Kh(this,"audioProcessorContext",void 0),Kh(this,"_source",void 0),this.audioProcessorContext=e}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Qp(Vp.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Qp(Vp.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(iv.ON_TRACK,void 0),this.emit(iv.ON_NODE,void 0)}updateInput(e){if(e.context!==this.audioProcessorContext)throw new Error("ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.\n        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).");e.track&&this.inputTrack!==e.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=e.track,this.emit(iv.ON_TRACK,this.inputTrack)),e.node&&this.inputNode!==e.node&&(this.audioProcessorContext.chained=!0,this.inputNode=e.node,this.emit(iv.ON_NODE,this.inputNode))}}class W_ extends Fp{set chained(e){this._chained=e}get chained(){return this._chained}constructor(e,t,n){super(),Kh(this,"constraintsMap",new Map),Kh(this,"statsRegistry",[]),Kh(this,"audioContext",void 0),Kh(this,"trackId",void 0),Kh(this,"direction",void 0),Kh(this,"usageRegistry",[]),Kh(this,"_chained",!1),this.audioContext=e,this.trackId=t,this.direction=n}async getConstraints(){return Eb(this,ov.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(e,t){var n;return Jp.info("processor ".concat(t.name," requestApplyConstraints for ").concat(this.trackId)),e&&this.constraintsMap.set(t,e),bb(this,ov.REQUEST_UPDATE_CONSTRAINTS,Array.from(H_(n=this.constraintsMap).call(n)))}async requestRevertConstraints(e){var t;if(this.constraintsMap.has(e))return this.constraintsMap.delete(e),bb(this,ov.REQUEST_UPDATE_CONSTRAINTS,Array.from(H_(t=this.constraintsMap).call(t)))}registerStats(e,t,n){this.statsRegistry.find((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t))||this.statsRegistry.push({processorName:e.name,processorID:e.ID,type:t,cb:n})}unregisterStats(e,t){const n=this.statsRegistry.findIndex((n=>n.processorID===e.ID&&n.processorName===e.name&&n.type===t));-1!==n&&this.statsRegistry.splice(n,1)}gatherStats(){const e=[];for(const{processorID:t,processorName:n,type:r,cb:i}of this.statsRegistry)try{const o=i();e.push({processorID:t,processorName:n,type:r,stats:o})}catch(e){Jp.error(new Qp(Vp.UNEXPECTED_ERROR,e.message))}return e}registerUsage(e,t){this.usageRegistry.find((t=>t.processorID===e.ID&&t.processorName===e.name))||this.usageRegistry.push({processorID:e.ID,processorName:e.name,cb:t})}unregisterUsage(e){const t=this.usageRegistry.findIndex((t=>t.processorID===e.ID&&t.processorName===e.name));-1!==t&&this.usageRegistry.splice(t,1)}async gatherUsage(){const e=[];if(!this.chained)return[];for(const{cb:t}of this.usageRegistry)try{let n=t();n instanceof Zl&&(n=await n),e.push(Q_(Q_({},n),{},{direction:this.direction}))}catch(e){Jp.error("gather extension usage error",e)}return e}getDirection(){return this.direction}}class z_ extends Fp{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Kh(this,"context",void 0),Kh(this,"processSourceNode",void 0),Kh(this,"outputTrack",void 0),Kh(this,"processedNode",void 0),Kh(this,"clonedTrack",void 0),Kh(this,"outputNode",void 0),this.outputNode=new q_}setVolume(){}createOutputTrack(){throw new Qp(Vp.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class q_{disconnect(){}connect(){}}let Y_,X_=null;class J_{constructor(){Kh(this,"state","open"),Kh(this,"trigger",void 0),Kh(this,"tasks",[]),Jp.debug("[macro-task-queue] is created."),this.trigger=setTimeout((()=>{this.state="closed",Jp.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map((e=>e.key)),"]")),this.trigger=void 0,this.tasks.forEach((e=>{let{func:t}=e;return t()})),this.tasks.length=0,Jp.debug("[macro-task-queue] is closed.")}))}enqueue(e,t){"closed"!==this.state&&(this.tasks.push({key:e,func:t}),Jp.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof e?e:"")))}runTask(e){if("closed"===this.state)return;const t=this.tasks.findIndex((t=>t.key===e));if(-1!==t){const n=this.tasks.splice(t,1);Jp.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat("string"==typeof e?e:"")),n[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,Jp.debug("[macro-task-queue] is closed."))}}function Z_(e){return function(t,n,r){var i;const o=null!==(i=r.value)&&void 0!==i?i:r.get,s=function(){X_&&"open"===X_.state&&X_.runTask(e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return null==o?void 0:o.apply(this,...n)};return r.value?r.value=s:r.get=s,r}}var $_,eE,tE,nE,rE,iE,oE,sE,aE,cE,uE,lE,AE,hE,dE,pE,fE,gE,mE,vE,yE,_E,EE,bE,wE,SE,TE,CE,RE,IE,OE,xE,NE,BE,LE,DE,ME,PE,kE,UE,FE,HE;function VE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function QE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?VE(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VE(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e){e.UPDATE_TRACK_SOURCE="update-track-source"}(Y_||(Y_={}));let jE=($_=Z_("INIT_WEBAUDIO"),eE=Z_("INIT_WEBAUDIO"),tE=Z_("INIT_WEBAUDIO"),nE=Jy({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),rE=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),iE=B_(),oE=r_("LocalAudioTrack","_enabledMutex"),sE=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),aE=B_(),cE=r_("LocalAudioTrack","_enabledMutex"),uE=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),lE=B_(),AE=B_(),hE=B_(),dE=Jy({argsMap:e=>[e.getTrackId()]}),pE=B_(),fE=Jy({argsMap:e=>[e.getTrackId()]}),gE=B_(),mE=Jy({argsMap:e=>[e.getTrackId()]}),vE=Jy({argsMap:(e,t)=>[e.getTrackId(),t.name]}),yE=Jy({argsMap:e=>[e.getTrackId()]}),Ry((_E=class extends i_{get _source(){return this._trackSource}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get processorDestination(){return this._processorDestination}set processorDestination(e){this._processorDestination=e}get isPlaying(){return this._useAudioElement?N_.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r,i){super(e,n),Kh(this,"trackMediaType","audio"),Kh(this,"_encoderConfig",void 0),Kh(this,"_trackSource",void 0),Kh(this,"_enabled",!0),Kh(this,"_volume",100),Kh(this,"_useAudioElement",!1),Kh(this,"_bypassWebAudio",!1),Kh(this,"processor",void 0),Kh(this,"_processorContext",void 0),Kh(this,"_processorDestination",void 0),Kh(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r;const o=()=>{this.processorContext=new W_(this._source.context,this.getTrackId(),"local"),this.processorDestination=new K_(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(rm.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))},s=i&&Eh()&&!l_();df("DISABLE_WEBAUDIO")?(this._source=new z_,this._useAudioElement=!0,this._bypassWebAudio=!0):s?this._source=new z_:(this._source=new g_(e,!1,this._getOriginVolumeLevel?e:void 0),df("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),o(),!df("DISABLE_WEBAUDIO")&&s&&(X_||(X_=new J_),X_).enqueue("INIT_WEBAUDIO",(()=>{this._source=new g_(e,!1,this._getOriginVolumeLevel?e:void 0),df("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),o(),this.emit(Y_.UPDATE_TRACK_SOURCE)}))}setVolume(e){vg(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&N_.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void Jp.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const e=this._source.createOutputTrack();this._mediaStreamTrack!==e&&(this._mediaStreamTrack=e,bb(this,Dm.NEED_REPLACE_TRACK,this).then((()=>{Jp.debug("[".concat(this.getTrackId(),"] replace web audio track success"))})).catch((e=>{Jp.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),e)})))}catch(e){}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement)throw new Qp(Vp.NOT_SUPPORTED,"your browser does not support setting the audio output device");await N_.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Jp.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await bb(this,Dm.NEED_ENABLE_TRACK,this),Jp.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(e){throw n||(this._enabled=!1),Jp.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await bb(this,Dm.NEED_DISABLE_TRACK,this)}catch(e){throw n||(this._enabled=!0),Jp.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,Jp.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await bb(this,Dm.NEED_MUTE_TRACK,this):await bb(this,Dm.NEED_UNMUTE_TRACK,this))}getStats(){xb((()=>{Jp.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")}),"localAudioTrackGetStatsWarning");return wb(this,Dm.GET_STATS)||QE({},um)}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(rm.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(rm.ON_AUDIO_BUFFER),this._source.on(rm.ON_AUDIO_BUFFER,(t=>e(t)))}play(){Jp.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Jp.debug("[".concat(this.getTrackId(),"] start audio playback in element")),N_.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){Jp.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?N_.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Jp.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&N_.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e.addEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:e,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await bb(this,Dm.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return Zl.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new Qp(Vp.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new Qp(Vp.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(iv.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await bb(this,Dm.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await bb(this,Dm.NEED_REPLACE_TRACK,this))})),this.processorDestination.on(iv.ON_NODE,(e=>{this._source.processedNode=e}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(iv.ON_TRACK),this.processorDestination.removeAllListeners(iv.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ov.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ov.REQUEST_CONSTRAINTS)}}).prototype,"_source",[$_],Object.getOwnPropertyDescriptor(_E.prototype,"_source"),_E.prototype),Ry(_E.prototype,"processorContext",[eE],Object.getOwnPropertyDescriptor(_E.prototype,"processorContext"),_E.prototype),Ry(_E.prototype,"processorDestination",[tE],Object.getOwnPropertyDescriptor(_E.prototype,"processorDestination"),_E.prototype),Ry(_E.prototype,"setVolume",[nE],Object.getOwnPropertyDescriptor(_E.prototype,"setVolume"),_E.prototype),Ry(_E.prototype,"setPlaybackDevice",[rE,iE],Object.getOwnPropertyDescriptor(_E.prototype,"setPlaybackDevice"),_E.prototype),Ry(_E.prototype,"setEnabled",[oE,sE,aE],Object.getOwnPropertyDescriptor(_E.prototype,"setEnabled"),_E.prototype),Ry(_E.prototype,"setMuted",[cE,uE,lE],Object.getOwnPropertyDescriptor(_E.prototype,"setMuted"),_E.prototype),Ry(_E.prototype,"getStats",[AE],Object.getOwnPropertyDescriptor(_E.prototype,"getStats"),_E.prototype),Ry(_E.prototype,"setAudioFrameCallback",[hE],Object.getOwnPropertyDescriptor(_E.prototype,"setAudioFrameCallback"),_E.prototype),Ry(_E.prototype,"play",[dE,pE],Object.getOwnPropertyDescriptor(_E.prototype,"play"),_E.prototype),Ry(_E.prototype,"stop",[fE,gE],Object.getOwnPropertyDescriptor(_E.prototype,"stop"),_E.prototype),Ry(_E.prototype,"close",[mE],Object.getOwnPropertyDescriptor(_E.prototype,"close"),_E.prototype),Ry(_E.prototype,"pipe",[vE],Object.getOwnPropertyDescriptor(_E.prototype,"pipe"),_E.prototype),Ry(_E.prototype,"unpipe",[yE],Object.getOwnPropertyDescriptor(_E.prototype,"unpipe"),_E.prototype),_E),GE=(EE=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),bE=B_(),wE=r_("MicrophoneAudioTrack","_enabledMutex"),SE=Jy({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),TE=B_(),CE=Jy({argsMap:e=>[e.getTrackId()]}),Ry((RE=class extends jE{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?Af(t.encoderConfig):{},r,df("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),Kh(this,"_config",void 0),Kh(this,"_deviceName","default"),Kh(this,"_constraints",void 0),Kh(this,"_originalConstraints",void 0),Kh(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,"boolean"==typeof t.bypassWebAudio&&(this._bypassWebAudio=t.bypassWebAudio),(Oh()||xh())&&c_.bindInterruptDetectorTrack(this),this.on(Y_.UPDATE_TRACK_SOURCE,(()=>{this.bindProcessorContextEvents()})),l_()&&this.bindProcessorContextEvents()}async setDevice(e){if(Jp.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await O_.getDeviceById(e),n={};n.audio=QE({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await T_(n,this.getTrackId())}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await T_({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await O_.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}Jp.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return Jp.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Jp.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),null===(r=this._source.clonedTrack)||void 0===r||r.stop(),n||(this._enabled=!1);try{await bb(this,Dm.NEED_DISABLE_TRACK,this)}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setEnabled false failed"),e.toString()),e}return}const i=QE({},this._constraints),o=O_.searchDeviceIdByName(this._deviceName);o&&!i.deviceId&&(i.deviceId=o);try{n||(this._enabled=!0);const e=await T_({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!1),await bb(this,Dm.NEED_ENABLE_TRACK,this)}catch(e){throw n||(this._enabled=!1),Jp.error("[".concat(this.getTrackId(),"] setEnabled true failed"),e.toString()),e}Jp.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Oh()||xh())&&c_.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((wh()||Bh())&&this._enabled&&!this._isClosed&&c_.duringInterruption){const e=async()=>{c_.off(e_.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(Jp.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};c_.on(e_.IOS_INTERRUPTION_END,e)}else Jp.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Hm.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=O_.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const e=await T_({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(ov.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})),this.processorContext.on(ov.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}}).prototype,"setDevice",[EE,bE],Object.getOwnPropertyDescriptor(RE.prototype,"setDevice"),RE.prototype),Ry(RE.prototype,"setEnabled",[wE,SE,TE],Object.getOwnPropertyDescriptor(RE.prototype,"setEnabled"),RE.prototype),Ry(RE.prototype,"close",[CE],Object.getOwnPropertyDescriptor(RE.prototype,"close"),RE.prototype),RE),KE=(IE=Jy({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),OE=B_(),xE=Jy({argsMap:e=>[e.getTrackId()]}),NE=B_(),BE=Jy({argsMap:e=>[e.getTrackId()]}),LE=B_(),DE=Jy({argsMap:e=>[e.getTrackId()]}),ME=B_(),PE=Jy({argsMap:e=>[e.getTrackId()]}),kE=B_(),UE=Jy({argsMap:e=>[e.getTrackId()]}),FE=B_(),Ry((HE=class extends jE{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),Kh(this,"source",void 0),Kh(this,"_bufferSource",void 0),this.source=e,this._bufferSource=t,this._bufferSource.on(rm.AUDIO_SOURCE_STATE_CHANGE,(e=>{this.safeEmit(Hm.SOURCE_STATE_CHANGE,e)}));try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}setAudioBufferPlaybackSpeed(e){vg(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[IE,OE],Object.getOwnPropertyDescriptor(HE.prototype,"startProcessAudioBuffer"),HE.prototype),Ry(HE.prototype,"pauseProcessAudioBuffer",[xE,NE],Object.getOwnPropertyDescriptor(HE.prototype,"pauseProcessAudioBuffer"),HE.prototype),Ry(HE.prototype,"seekAudioBuffer",[BE,LE],Object.getOwnPropertyDescriptor(HE.prototype,"seekAudioBuffer"),HE.prototype),Ry(HE.prototype,"resumeProcessAudioBuffer",[DE,ME],Object.getOwnPropertyDescriptor(HE.prototype,"resumeProcessAudioBuffer"),HE.prototype),Ry(HE.prototype,"stopProcessAudioBuffer",[PE,kE],Object.getOwnPropertyDescriptor(HE.prototype,"stopProcessAudioBuffer"),HE.prototype),Ry(HE.prototype,"setAudioBufferPlaybackSpeed",[UE,FE],Object.getOwnPropertyDescriptor(HE.prototype,"setAudioBufferPlaybackSpeed"),HE.prototype),HE);class WE extends jE{get __className__(){return"MixingAudioTrack"}get isActive(){for(const e of this.trackList)if(e._enabled&&!e._isClosed&&!e.muted)return!0;return!1}constructor(){const e=u_().createMediaStreamDestination();super(e.stream.getAudioTracks()[0],void 0,gb(8,"track-mix-")),Kh(this,"trackList",void 0),Kh(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch(e){}this.destNode=e,this.trackList=[]}hasAudioTrack(e){return-1!==this.trackList.indexOf(e)}addAudioTrack(e){-1===this.trackList.indexOf(e)?(Jp.debug("add ".concat(e.getTrackId()," to mixing track")),e._source.outputNode.connect(this.destNode),this.trackList.push(e),this.updateEncoderConfig()):Jp.debug("track ".concat(e.getTrackId()," is already added"))}removeAudioTrack(e){if(-1!==this.trackList.indexOf(e)){Jp.debug("remove ".concat(e.getTrackId()," from mixing track"));try{e._source.outputNode.disconnect(this.destNode)}catch(e){}Tb(this.trackList,e),this.updateEncoderConfig()}}updateEncoderConfig(){const e={};this.trackList.forEach((t=>{t._encoderConfig&&((t._encoderConfig.bitrate||0)>(e.bitrate||0)&&(e.bitrate=t._encoderConfig.bitrate),(t._encoderConfig.sampleRate||0)>(e.sampleRate||0)&&(e.sampleRate=t._encoderConfig.sampleRate),(t._encoderConfig.sampleSize||0)>(e.sampleSize||0)&&(e.sampleSize=t._encoderConfig.sampleSize),t._encoderConfig.stereo&&(e.stereo=!0))})),this._encoderConfig=e}_updateRtpTransceiver(e){this._rtpTransceiver!==e&&(this._rtpTransceiver=e,this.trackList.forEach((t=>{t instanceof WE?t.emit(Fm.TRANSCEIVER_UPDATED,e):t._updateRtpTransceiver(e)})))}}class zE extends Fp{constructor(){super(...arguments),Kh(this,"resultStorage",new Map)}setLocalAudioStats(e,t,n){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",e,this.checkAudioInputLevel(n,t)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",e,this.checkSendAudioBitrate(n,t))}setLocalVideoStats(e,t,n){this.record("SEND_VIDEO_BITRATE_TOO_LOW",e,this.checkSendVideoBitrate(n,t)),this.record("FRAMERATE_INPUT_TOO_LOW",e,this.checkFramerateInput(n,t)),this.record("FRAMERATE_SENT_TOO_LOW",e,this.checkFramerateSent(n))}setRemoteAudioStats(e,t){const n=e.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",n,this.checkAudioOutputLevel(t))}setRemoteVideoStats(e,t){const n=e.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",n,this.checkVideoDecode(t))}record(e,t,n){if(df("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(e)||this.resultStorage.set(e,{result:[],isPrevNormal:!0});const r=this.resultStorage.get(e);if(r&&(r.result.push(n),r.result.length>=5)){const n=r.result.includes(!0);r.isPrevNormal&&!n&&this.emit("exception",qE[e],e,t),!r.isPrevNormal&&n&&this.emit("exception",qE[e]+2e3,e+"_RECOVER",t),r.isPrevNormal=n,r.result=[]}}checkAudioOutputLevel(e){return!(e.receiveBitrate>0&&0===e.receiveLevel)}checkAudioInputLevel(e,t){return t instanceof WE&&!t.isActive||!!t.muted||0!==e.sendVolumeLevel}checkFramerateInput(e,t){let n=null;t._encoderConfig&&t._encoderConfig.frameRate&&(n=ib(t._encoderConfig.frameRate));const r=e.captureFrameRate;return!n||!r||!(n>10&&r<5||n<10&&n>=5&&r<=1)}checkFramerateSent(e){return!(e.captureFrameRate&&e.sendFrameRate&&e.captureFrameRate>5&&e.sendFrameRate<=1)}checkSendVideoBitrate(e,t){return!!t.muted||0!==e.sendBitrate}checkSendAudioBitrate(e,t){return t instanceof WE&&!t.isActive||!!t.muted||0!==e.sendBitrate}checkVideoDecode(e){return 0===e.receiveBitrate||0!==e.decodeFrameRate}}const qE={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},YE=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const e=n[n.length-1];return Math.round(performance.now()-e.startTime)}return 0}};function XE(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JE(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?XE(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XE(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class ZE{constructor(e){Kh(this,"store",void 0),Kh(this,"onStatsException",void 0),Kh(this,"onUploadPublishDuration",void 0),Kh(this,"onStatsChanged",void 0),Kh(this,"localStats",new Map),Kh(this,"remoteStats",new Map),Kh(this,"updateStatsInterval",void 0),Kh(this,"trafficStats",void 0),Kh(this,"trafficStatsPeerList",[]),Kh(this,"uplinkStats",void 0),Kh(this,"exceptionMonitor",void 0),Kh(this,"p2pChannel",void 0),Kh(this,"scalabilityMode",hh.L1T1),Kh(this,"updateStats",(()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))})),this.store=e,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new zE,this.exceptionMonitor.on("exception",((e,t,n)=>{this.onStatsException&&this.onStatsException(e,t,n)}))}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get($m.LocalAudioTrack)||JE({},um)}getLocalVideoTrackStats(){return this.localStats.get($m.LocalVideoTrack)||JE({},lm)}getRemoteAudioTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppad+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.audioStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{audioStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRemoteNetworkQualityStats(e){const t={};if(e){var n;const r=null===(n=this.remoteStats.get(e))||void 0===n?void 0:n.networkStats;r&&(t[e]=r)}else Array.from(this.remoteStats.entries()).forEach((e=>{let[n,{networkStats:r}]=e;r&&(t[n]=r)}));return t}getRemoteVideoTrackStats(e){const t=(e,t)=>{if(!this.trafficStats)return t;const n=this.trafficStats.peer_delay.find((t=>t.peer_uid===e));return n&&(t.publishDuration=n.B_ppvd+(Date.now()-this.trafficStats.timestamp)),t},n={};if(e){var r;const i=null===(r=this.remoteStats.get(e))||void 0===r?void 0:r.videoStats;i&&(n[e]=t(e,i))}else Array.from(this.remoteStats.entries()).forEach((e=>{let[r,{videoStats:i}]=e;i&&(n[r]=t(r,i))}));return n}getRTCStats(){let e=0,t=0,n=0,r=0;const i=this.localStats.get($m.LocalAudioTrack);i&&(e+=i.sendBytes,t+=i.sendBitrate);const o=this.localStats.get($m.LocalVideoTrack);o&&(e+=o.sendBytes,t+=o.sendBitrate);const s=this.localStats.get($m.LocalVideoLowTrack);s&&(e+=s.sendBytes,t+=s.sendBitrate),this.remoteStats.forEach((e=>{let{audioStats:t,videoStats:i}=e;t&&(n+=t.receiveBytes,r+=t.receiveBitrate),i&&(n+=i.receiveBytes,r+=i.receiveBitrate)}));let a=1;return this.trafficStats&&(a+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:a,SendBitrate:t,SendBytes:e,RecvBytes:n,RecvBitrate:r,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(e){this.localStats.set(e,void 0)}removeLocalStats(e){e?this.localStats.delete(e):this.localStats.clear()}addRemoteStats(e){this.remoteStats.set(e,{})}removeRemoteStats(e){e?this.remoteStats.delete(e):this.remoteStats.clear()}addP2PChannel(e){this.p2pChannel=e}updateTrafficStats(e){e.peer_delay=e.peer_delay.filter((e=>void 0!==e.B_ppad||void 0!==e.B_ppvd)),e.peer_delay.filter((e=>-1===this.trafficStatsPeerList.indexOf(e.peer_uid))).forEach((e=>{var t;const n=null===(t=this.p2pChannel)||void 0===t?void 0:t.getRemoteMedia(e.peer_uid),r=null!=n&&n.videoSSRC?YE.measureFromSubscribeStart(this.store.clientId,n.videoSSRC):0,i=null!=n&&n.audioSSRC?YE.measureFromSubscribeStart(this.store.clientId,n.audioSSRC):0;void 0!==e.B_ppad&&void 0!==e.B_ppvd&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(e.peer_uid,e.B_ppad,e.B_ppvd,r>i?r:i),this.trafficStatsPeerList.push(e.peer_uid))})),this.trafficStats=e}updateUplinkStats(e){this.uplinkStats&&this.uplinkStats.B_fir!==e.B_fir&&Jp.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(e.B_fir)),this.uplinkStats=e}static isRemoteVideoFreeze(e,t,n){if(!e)return!1;const r=!!n&&t.framesDecodeFreezeTime>n.framesDecodeFreezeTime,i=!n||t.framesDecodeCount>n.framesDecodeCount;return r||!i}static isRemoteAudioFreeze(e){return!!e&&e._isFreeze()}isLocalVideoFreeze(e){return!(!e.inputFrame||!e.sentFrame)&&e.inputFrame.frameRate>5&&e.sentFrame.frameRate<3}updateLocalStats(e){Array.from(this.localStats.entries()).forEach((t=>{let[n,r]=t;switch(n){case $m.LocalVideoTrack:case $m.LocalVideoLowTrack:{const t=r,o=JE({},lm),s=e.getStats(),a=e.getLocalMedia(n);if(s){const n=s.videoSend.find((e=>e.ssrc===(null==a?void 0:a.ssrcs[0].ssrcId)));if(n){const r=e.getLocalVideoSize(),i=e.getEncoderConfig($m.LocalVideoTrack);"H264"!==n.codec&&"H265"!==n.codec&&"VP8"!==n.codec&&"VP9"!==n.codec&&"AV1X"!==n.codec&&"AV1"!==n.codec||(o.codecType=n.codec),o.sendBytes=n.bytes,o.sendBitrate=t?8*Math.max(0,o.sendBytes-t.sendBytes):0,n.inputFrame?(o.captureFrameRate=n.inputFrame.frameRate,o.captureResolutionHeight=n.inputFrame.height,o.captureResolutionWidth=n.inputFrame.width):r&&(o.captureResolutionWidth=r.width,o.captureResolutionHeight=r.height),n.sentFrame?(o.sendFrameRate=n.sentFrame.frameRate,o.sendResolutionHeight=n.sentFrame.height,o.sendResolutionWidth=n.sentFrame.width):r&&(o.sendResolutionWidth=r.width,o.sendResolutionHeight=r.height),n.avgEncodeMs&&(o.encodeDelay=n.avgEncodeMs),i&&i.bitrateMax&&(o.targetSendBitrate=1e3*i.bitrateMax),o.sendPackets=n.packets,o.sendPacketsLost=n.packetsLost,o.totalDuration=t?t.totalDuration+1:1,o.totalFreezeTime=t?t.totalFreezeTime:0,this.isLocalVideoFreeze(n)&&(o.totalFreezeTime+=1),n.scalabilityMode&&this.scalabilityMode!==n.scalabilityMode&&(Jp.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(n.scalabilityMode)),this.scalabilityMode=n.scalabilityMode)}this.trafficStats&&(o.sendPacketsLost=this.trafficStats.B_pvlr4/100)}var i;this.localStats.set(n,o),((null==t?void 0:t.sendResolutionWidth)!==o.sendResolutionWidth||(null==t?void 0:t.sendResolutionHeight)!==o.sendResolutionHeight)&&(null===(i=this.onStatsChanged)||void 0===i||i.call(this,"resolution",{width:o.sendResolutionWidth,height:o.sendResolutionHeight})),o&&a&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,a.track,o);break}case $m.LocalAudioTrack:{const t=r,i=JE({},um),o=e.getStats(),s=e.getLocalMedia(n);if(o){const n=o.audioSend.find((e=>e.ssrc===(null==s?void 0:s.ssrcs[0].ssrcId)));if(n){if("opus"!==n.codec&&"aac"!==n.codec&&"PCMU"!==n.codec&&"PCMA"!==n.codec&&"G722"!==n.codec||(i.codecType=n.codec),n.inputLevel)i.sendVolumeLevel=Math.round(32767*n.inputLevel);else{const t=e.getLocalAudioVolume();t&&(i.sendVolumeLevel=Math.round(32767*t))}i.sendBytes=n.bytes,i.sendPackets=n.packets,i.sendPacketsLost=n.packetsLost,i.sendBitrate=t?8*Math.max(0,i.sendBytes-t.sendBytes):0}}this.trafficStats&&(i.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set($m.LocalAudioTrack,i),i&&s&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,s.track,i);break}}}))}updateRemoteStats(e){Array.from(this.remoteStats.entries()).forEach((t=>{let[n,{videoStats:r,audioStats:i,videoPcStats:o}]=t;const s=i,a=r,c=o,u=JE({},Am),l=JE({},dm),A=JE({},hm),{audioTrack:h,videoTrack:d,audioSSRC:p,videoSSRC:f}=e.getRemoteMedia(n),g=e.getStats(),m=null==g?void 0:g.audioRecv.find((e=>e.ssrc===p)),v=null==g?void 0:g.videoRecv.find((e=>e.ssrc===f)),y=this.trafficStats&&this.trafficStats.peer_delay.find((e=>e.peer_uid===n));if(m&&("opus"!==m.codec&&"aac"!==m.codec&&"PCMU"!==m.codec&&"PCMA"!==m.codec&&"G722"!==m.codec||(u.codecType=m.codec),m.outputLevel?u.receiveLevel=Math.round(32767*m.outputLevel):h&&(u.receiveLevel=Math.round(32767*h.getVolumeLevel())),u.receiveBytes=m.bytes,u.receivePackets=m.packets,u.receivePacketsLost=m.packetsLost,u.packetLossRate=u.receivePacketsLost/(u.receivePackets+u.receivePacketsLost),u.receiveBitrate=s?8*Math.max(0,u.receiveBytes-s.receiveBytes):0,u.totalDuration=s?s.totalDuration+1:1,u.totalFreezeTime=s?s.totalFreezeTime:0,u.freezeRate=u.totalFreezeTime/u.totalDuration,u.receiveDelay=m.jitterBufferMs,u.totalDuration>10&&ZE.isRemoteAudioFreeze(h)&&(u.totalFreezeTime+=1)),v){"H264"!==v.codec&&"H265"!==v.codec&&"VP8"!==v.codec&&"VP9"!==v.codec&&"AV1X"!==v.codec&&"AV1"!==v.codec||(l.codecType=v.codec),l.receiveBytes=v.bytes,l.receiveBitrate=a?8*Math.max(0,l.receiveBytes-a.receiveBytes):0,l.decodeFrameRate=v.decodeFrameRate<0?0:v.decodeFrameRate,l.renderFrameRate=v.decodeFrameRate<0?0:v.decodeFrameRate,v.outputFrame&&(l.renderFrameRate=v.outputFrame.frameRate),v.receivedFrame?(l.receiveFrameRate=v.receivedFrame.frameRate,l.receiveResolutionHeight=v.receivedFrame.height,l.receiveResolutionWidth=v.receivedFrame.width):d&&(l.receiveResolutionHeight=d._videoHeight||0,l.receiveResolutionWidth=d._videoWidth||0),void 0!==v.framesRateFirefox&&(l.receiveFrameRate=Math.round(v.framesRateFirefox)),l.receivePackets=v.packets,l.receivePacketsLost=v.packetsLost,l.packetLossRate=l.receivePacketsLost/(l.receivePackets+l.receivePacketsLost),l.totalDuration=a?a.totalDuration+1:1,l.totalFreezeTime=a?a.totalFreezeTime:0,l.receiveDelay=v.jitterBufferMs||0;const t=!!f&&e.getRemoteVideoIsReady(f);d&&t&&ZE.isRemoteVideoFreeze(d,v,c)&&(l.totalFreezeTime+=1),l.freezeRate=l.totalFreezeTime/l.totalDuration}y&&(u.end2EndDelay=y.B_ad,l.end2EndDelay=y.B_vd,u.transportDelay=y.B_ed,l.transportDelay=y.B_ed,u.currentPacketLossRate=y.B_ealr4/100,l.currentPacketLossRate=y.B_evlr4/100,A.uplinkNetworkQuality=y.B_punq?y.B_punq:0,A.downlinkNetworkQuality=y.B_pdnq?y.B_pdnq:0),this.remoteStats.set(n,{audioStats:u,videoStats:l,videoPcStats:v,networkStats:A}),h&&this.exceptionMonitor.setRemoteAudioStats(h,u),d&&this.exceptionMonitor.setRemoteVideoStats(d,l)}))}}const $E=new class extends Fp{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Kh(this,"_lastHiddenTime",0),Kh(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),Jp.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)}))}};function eb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eb(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nb(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(df("TURN_DOMAIN")):(Jp.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function rb(e,t){var n,r;const i=df("GATEWAY_DOMAINS");let o=i[1]&&-1!==t.indexOf(i[1])?1:0;e.addresses=e.addresses||[];const s=e.addresses.map((e=>e.domain_prefix?{address:"".concat(e.domain_prefix,".").concat(i[o++%i.length],":").concat(e.port)}:e.ip.match(/^[\.\:\d]+$/)?{ip:e.ip,port:e.port,address:"".concat(e.ip.replace(/[^\d]/g,"-"),".").concat(i[o++%i.length],":").concat(e.port)}:(Jp.info("Cannot recognized as IP address ".concat(e.ip,". Used As Host instead")),{ip:e.ip,port:e.port,address:"".concat(e.ip,":").concat(e.port)})));if(null!==(n=e.detail)&&void 0!==n&&n[18]&&"string"==typeof(null===(r=e.detail)||void 0===r?void 0:r[18])){const t=e.detail[18],n=null==t?void 0:t.split(";");for(let e=0;e<n.length;e++){var a;const t=YA(a=n[e]).call(a);s[e]&&t&&(s[e].ip6=t)}}return{gatewayAddrs:s,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function ib(e){return"number"==typeof e?e:e.exact||e.ideal||e.max||e.min||0}function ob(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(ib(t.width),"x").concat(ib(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return"number"==typeof t.frameRate?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function sb(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function ab(e,t){let n,r,i;switch(t){case yv.CHOOSE_SERVER:n=4096,r="choose server";break;case yv.CLOUD_PROXY:n=1048576,r="proxy";break;case yv.CLOUD_PROXY_5:n=4194304,r="proxy5";break;case yv.CLOUD_PROXY_FALLBACK:n=4194310,r="proxy fallback";break;default:throw new Qp(Vp.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach((t=>{t.buffer&&t.buffer.flag===n&&(i={code:t.buffer.code,addresses:(t.buffer.edges_services||[]).map((e=>tb(tb({},e),{},{ticket:t.buffer.cert}))),server_ts:e.enter_ts,uid:t.buffer.uid,cid:t.buffer.cid,cname:t.buffer.cname,detail:tb(tb({},t.buffer.detail),e.detail),flag:t.buffer.flag,opid:e.opid,cert:t.buffer.cert})})),!i)throw new Qp(Vp.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function cb(e,t){return await Zl.all(e.addresses.map((async e=>({address:nb(e.ip),tcpport:e.port,udpport:e.port,username:t&&df("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():nf.username,password:t&&df("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await qy(t.toString()):nf.password}))))}function ub(e,t){const n=t._videoWidth||t.getMediaStreamTrack(!0).getSettings().width;return n||Jp.warning("cannot get original video track's width, default scale down 4 times for low stream"),n?n/ib(e.width):4}function lb(e){let{candidateType:t,relayProtocol:n,type:r,address:i,port:o,protocol:s}=e;return"local-candidate"===r?{candidateType:t,relayProtocol:n,protocol:s}:{candidateType:t,relayProtocol:n,address:i,port:o,protocol:s}}function Ab(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ab(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ab(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function db(e){return window.TextEncoder?(new TextEncoder).encode(e).length:e.length}function pb(e){return new Zl((t=>{window.setTimeout(t,e)}))}function fb(e){const t=new Qp(Vp.TIMEOUT,"timeout");return new Zl(((n,r)=>{window.setTimeout((()=>r(t)),e)}))}function gb(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+gb(e-n.length,"")}function mb(){return gb(32,"").toUpperCase()}const vb=()=>{};function yb(e){return new Zl(((t,n)=>{let r=!1;const i=document.createElement("video");i.setAttribute("autoplay",""),i.setAttribute("muted",""),i.muted=!0,i.autoplay=!0,i.setAttribute("playsinline",""),i.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(i);const o=wh()?"canplay":"playing";i.addEventListener(o,(()=>{const e=i.videoWidth,n=i.videoHeight;!e&&bh()||(r=!0,i.srcObject=null,i.remove(),t([e,n]))})),i.srcObject=new MediaStream([e]),i.play().catch(vb),setTimeout((()=>{r||(i.srcObject=null,i.remove(),t([i.videoWidth,i.videoHeight]))}),4e3)}))}function _b(e){return Zl.all(e.map((e=>e.then((e=>{throw e}),(e=>e))))).then((e=>{throw e}),(e=>e))}function Eb(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return 0===e.getListeners(t).length?Zl.reject(new Qp(Vp.UNEXPECTED_ERROR,"can not emit promise")):new Zl(((n,i)=>{e.emit(t,...r,n,i)}))}function bb(e,t){if(0===e.getListeners(t).length)return Zl.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Eb(e,t,...r)}function wb(e,t){if(0===e.getListeners(t).length)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return Sb(e,t,...r)}function Sb(e,t){let n=null,r=null;for(var i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];if(e.emit(t,...o,(e=>{n=e}),(e=>{r=e})),null!==r)throw r;if(null===n)throw new Qp(Vp.UNEXPECTED_ERROR,"handler is not sync");return n}function Tb(e,t){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}function Cb(e){const t=[];return e.forEach((e=>{-1===t.indexOf(e)&&t.push(e)})),t}function Rb(e){Zl.resolve().then(e)}function Ib(e){return JSON.parse(JSON.stringify(e))}const Ob={};function xb(e,t){Ob[t]||(Ob[t]=!0,e())}function Nb(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let e=0;e<t.length;e+=1)n[e]=t.charCodeAt(e);return n}function Bb(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}const Lb=new class{constructor(){Kh(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var i=arguments.length,o=new Array(i>4?i-4:0),s=4;s<i;s++)o[s-4]=arguments[s];if(this.fnMap.has(t)){const i=this.fnMap.get(t);if(i.threshold!==n){i.fn(...i.args),clearTimeout(i.timer);const s=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:s,args:o,skipFn:r})}else i.skipFn&&i.skipFn(...i.args),this.fnMap.set(t,hb(hb({},i),{},{fn:e,args:o,skipFn:r}))}else{const i=window.setTimeout((()=>{const e=this.fnMap.get(t);e&&e.fn(...e.args),this.fnMap.delete(t)}),n);this.fnMap.set(t,{fn:e,threshold:n,timer:i,args:o,skipFn:r})}}},Db=Lb.throttleByKey.bind(Lb),Mb=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:i,promisesCollector:o}=e,s=0;const a=t;let c,u=0;const l=async()=>{const e=(()=>{const e=s*a,t=e+a;return n.slice(e,t).map(r)})();o&&o.push(...e);try{c=await _b(e)}catch(e){if(u+=a,s++,!(u>=n.length))return void await l();i(e)}e.forEach((e=>e.cancel()))};return await l(),c};function Pb(e){return"object"==typeof e&&null!==e&&!(e instanceof RegExp)}const kb={[Qg.ACCESS_POINT]:{[Kg.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Kg.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Kg.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Kg.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Kg.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Kg.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Kg.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Qg.UNILBS]:{[Gg.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Gg.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Gg.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Gg.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Gg.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Gg.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Gg.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Gg.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Gg.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Gg.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Gg.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Gg.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Qg.STRING_UID_ALLOCATOR]:{[jg.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[jg.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[jg.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function Ub(e){const t=kb[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Qg.ACCESS_POINT){const t=e%1e4;if("1"===t.toString()[0])return{desc:e.toString(),retry:!1};if("2"===t.toString()[0])return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const Fb={[Wg.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[Wg.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[Wg.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[Wg.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[Wg.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[Wg.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[Wg.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[Wg.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[Wg.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[Wg.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[Wg.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[Wg.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Wg.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Wg.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[Wg.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[Wg.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[Wg.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[Wg.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[Wg.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[Wg.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[Wg.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[Wg.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[Wg.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[Wg.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[Wg.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[Wg.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[Wg.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[Wg.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[Wg.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[Wg.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[Wg.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[Wg.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[Wg.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[Wg.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[Wg.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[Wg.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[Wg.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[Wg.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[Wg.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[Wg.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[Wg.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[Wg.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Wg.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[Wg.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[Wg.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[Wg.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[Wg.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[Wg.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[Wg.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[Wg.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[Wg.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[Wg.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[Wg.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[Wg.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[Wg.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[Wg.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[Wg.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[Wg.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[Wg.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[Wg.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[Wg.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[Wg.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[Wg.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[Wg.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function Hb(e){return Fb[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function Vb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class Qb extends Fp{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){["tryNext","recover"].includes(e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(pm.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(pm.CONNECTED):"closed"===this._state?this.emit(pm.CLOSED):"failed"===this._state&&this.emit(pm.FAILED))}resetReconnectCount(e){Jp.debug("websocket reset reconnect count, reason: "+e),this.reconnectCount=0}constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;super(),Kh(this,"connectionID",0),Kh(this,"currentURLIndex",0),Kh(this,"urls",void 0),Kh(this,"_reconnectMode","tryNext"),Kh(this,"reconnectReason",void 0),Kh(this,"_initMutex",new n_("websocket")),Kh(this,"name",void 0),Kh(this,"_state","closed"),Kh(this,"reconnectInterrupter",void 0),Kh(this,"websocket",void 0),Kh(this,"retryConfig",void 0),Kh(this,"reconnectCount",0),Kh(this,"forceCloseTimeout",5e3),Kh(this,"onlineReconnectListener",void 0),Kh(this,"useCompress",void 0),Kh(this,"tryDoubleDomain",!1),Kh(this,"wsInflateLength",0),Kh(this,"wsDeflateLength",0),Kh(this,"closeEstablishingWs",(()=>{})),Kh(this,"store",void 0),Kh(this,"joinChannelServiceRecordIndex",void 0),this.store=i,this.name=e,this.retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vb(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this.useCompress=n,this.tryDoubleDomain=r;const{timeout:o,timeoutFactor:s}=t,a=Math.max(300,Math.floor(3*o/5)),c=Math.max(1.2,Math.floor(8*s)/10);nv.ONLINE&&(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=c),Qy.on(rv.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===nv.ONLINE?(this.retryConfig.timeout=a,this.retryConfig.timeoutFactor=c):(this.retryConfig.timeout=o,this.retryConfig.timeoutFactor=s))}))}getConnection(){return this.websocket||void 0}init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this.forceCloseTimeout=t;const n=(t,n)=>{this.urls=e;const r=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(r).then(t).catch(n),this.once(pm.CLOSED,(()=>n(new Qp(Vp.WS_DISCONNECT)))),this.once(pm.CONNECTED,(()=>t()))};return this._initMutex.lock().then((e=>new Zl(((e,t)=>{n(e,t)})).then((()=>{e()})).catch((()=>{e()}))))}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const e=this.websocket;t?setTimeout((()=>e.close()),500):e.close(),this.websocket=void 0}this.state=e?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(e,t){if(!this.websocket)return void Jp.warning("[".concat(this.name,"] can not reconnect, no websocket"));var n;void 0!==e&&(this.reconnectMode=e),Jp.debug("[".concat(this.name,"] reconnect is triggered initiative")),"number"==typeof this.joinChannelServiceRecordIndex&&(null===(n=this.store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(t)]},this.joinChannelServiceRecordIndex));const r=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),r&&r.bind(this.websocket)({code:9999,reason:t})}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Qp(Vp.WS_ABORT,"websocket is not ready");try{t||(e=JSON.stringify(e)),this.websocket.send(e)}catch(e){throw new Qp(Vp.WS_ERR,"send websocket message error"+e.toString())}}setWsInflateData(e){this.wsDeflateLength=this.wsDeflateLength+e.originLength,this.wsInflateLength=this.wsInflateLength+e.compressedLength}getWsInflateData(){const e=this.wsInflateLength,t=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:e,wsDeflateLength:t}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(e,t){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new Zl(((n,r)=>{var i;const o=e=>{var t;null===(t=this.store)||void 0===t||t.signalChannelOpen(),Jp.debug("[".concat(this.name,"] websocket opened:"),e),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n()},s=async e=>{if(Jp.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const t=wb(this,pm.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,i=await this.reconnectWithAction(t);if("closed"===this.state)return void Jp.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!i)return r(new Qp(Vp.WS_DISCONNECT,"websocket reconnect failed: ".concat(e.code))),void this.close(!0);n()}else r(new Qp(Vp.WS_DISCONNECT,"websocket close: ".concat(e.code))),this.close()},a=e=>{this.emit(pm.ON_MESSAGE,e)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),df("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(e=df("GATEWAY_WSS_ADDRESS")),Jp.debug("[".concat(this.name,"] start connect, url: ").concat(e));const c=null===(i=this.store)||void 0===i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(e,!!t,c).then((e=>{var t;this.websocket=e,o&&o(e.url),e.onclose=s,e.onmessage=a,null===(t=this.store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:"success"},c),this.joinChannelServiceRecordIndex=c})).catch((e=>{var t;if(null===(t=this.store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:e instanceof Qp&&e.code===Vp.WS_ABORT?"aborted":"error",errors:[e]},c),"closed"!==this.state){if(e instanceof Qp&&e.code===Vp.WS_ERR){const t=new Qp(Vp.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return Jp.error("[".concat(this.name,"]").concat(t)),void r(t)}s&&s(e)}else r(new Qp(Vp.WS_DISCONNECT,"websocket is closed: ".concat(e.toString())))}))}))}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount)return!1;if(!this.urls)return!1;if("closed"===this.state)return!1;this.onlineReconnectListener||Qy.networkState!==nv.OFFLINE||(this.onlineReconnectListener=Qy.onlineWaiter&&Qy.onlineWaiter.then((()=>{this.onlineReconnectListener=void 0})));let n=!0;if(this.reconnectInterrupter=()=>{n=!1},t){const t=Gp(this.reconnectCount,this.retryConfig);Jp.debug("[".concat(this.name,"] wait ").concat(t,"ms to reconnect websocket, mode: ").concat(e)),await Zl.race([pb(t),this.onlineReconnectListener||new Zl((()=>{}))])}if("closed"===this.state||!n)return!1;this.reconnectCount+=1;const r=async(e,t)=>{this.emit(pm.RECONNECT_CREATE_CONNECTION,t),await this.createWebSocketConnection(e)};try{if("retry"===e){const t=this.urls[this.currentURLIndex];this.emit(pm.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else if("tryNext"===e){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);Jp.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const t=this.urls[this.currentURLIndex];this.emit(pm.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else if("recover"===e){Jp.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(pm.RECONNECT_WAITTING_FINISH,e),this.urls=await Eb(this,pm.REQUEST_NEW_URLS),this.currentURLIndex=0;const t=this.urls[this.currentURLIndex];await r(t,e)}return!0}catch(n){var i;return Jp.error("[".concat(this.name,"] reconnect failed"),n.toString()),null!=n&&null!==(i=n.data)&&void 0!==i&&i.desc&&Array.isArray(n.data.desc)&&n.data.desc.length&&n.data.desc.includes("dynamic key expired")?(this.emit(pm.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(e,t)}}async chooseBestWebsocketConnection(e,t,n){return new Zl(((r,i)=>{let o=!1;const s=[];this.closeEstablishingWs=()=>{Jp.debug("[choose-best-ws] close establishing websockets"),s.forEach((e=>{e.onclose=null,e.onopen=null,e.onmessage=null,e.close()})),i(new Qp(Vp.WS_ABORT,"choose best websocket aborted"))};const a=df("GATEWAY_DOMAINS");let c;const u=e.indexOf("?h="),l=a.find((t=>-1!==u?e.includes(t,u):e.includes(t)));Jp.debug("[choose-best-ws] currentDomain: ",l,", domains: ",a);let A=!this.tryDoubleDomain||t||!l;if(!A&&l){var h;const t=Date.now();try{a.forEach((t=>{const n=-1===u?e.replace(l,t):e.substr(0,u)+e.substr(u).replace(l,t),r=new WebSocket(n);r.binaryType="arraybuffer",s.push(r),Jp.debug("[choose-best-ws] ws is connecting:",r.url)}))}catch(e){for(Jp.debug("[choose-best-ws] ws create failed, fallback to single url"),s.forEach((e=>e.close()));s.length;)s.pop();A=!0}null===(h=this.store)||void 0===h||h.recordJoinChannelService({urls:s.map((e=>e.url)),service:"gateway"},n),s.forEach((e=>{e.onopen=()=>{if(o)return;const n=Date.now()-t;Jp.debug("[choose-best-ws] ws open cost ".concat(n,"ms")),s.filter((t=>t!==e)).forEach((e=>{Jp.debug("[choose-best-ws]close backup websocket: ".concat(e.url)),e.close()})),o=!0,r(e)},e.onclose=e=>{c=e,o||s.find((e=>!(e.readyState===WebSocket.CLOSED||e.readyState===WebSocket.CLOSING)))||(Jp.debug("[choose-best-ws] all websocket is closed"),o=!0,i(c))},e.onmessage=t=>{Jp.debug("[choose-best-ws]".concat(e.url," onmessage: ").concat(t.data))}})),pb(this.forceCloseTimeout).then((()=>{s.forEach((e=>{e.readyState!==WebSocket.OPEN&&e.close()}))}))}if(A){var d;let t;Jp.debug("[choose-best-ws] use single url: ",e),null===(d=this.store)||void 0===d||d.recordJoinChannelService({urls:[e],service:"gateway"},n);try{t=new WebSocket(e),s.push(t),t.binaryType="arraybuffer"}catch(e){const t=new Qp(Vp.WS_ERR,"init websocket failed! Error: ".concat(e.toString()));return Jp.error("[".concat(this.name,"]").concat(t)),void i(t)}t.onopen=()=>{r(t)},t.onclose=e=>{i(e)},t.onmessage=e=>{Jp.debug("[choose-best-ws]".concat(t.url," onmessage: ").concat(e.data))},pb(this.forceCloseTimeout).then((()=>{t&&t.readyState!==WebSocket.OPEN&&t.close()}))}})).then((e=>(this.closeEstablishingWs=void 0,e))).catch((e=>{throw this.closeEstablishingWs=void 0,e}))}}class jb{constructor(e){Kh(this,"input",[]),Kh(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return 0===this.input.length?0:Gn(e=this.input).call(e,((e,t)=>e+t))/this.input.length}}class Gb extends Fp{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Jg.CONNECTED?this.emit(Zg.WS_CONNECTED):e===Jg.RECONNECTING?this.emit(Zg.WS_RECONNECTING,this._websocketReconnectReason):e===Jg.CLOSED&&this.emit(Zg.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),Kh(this,"_disconnectedReason",void 0),Kh(this,"_websocketReconnectReason",void 0),Kh(this,"_connectionState",Jg.CLOSED),Kh(this,"reconnectToken",void 0),Kh(this,"websocket",void 0),Kh(this,"openConnectionTime",void 0),Kh(this,"clientId",void 0),Kh(this,"lastMsgTime",Date.now()),Kh(this,"uploadCache",[]),Kh(this,"uploadCacheInterval",void 0),Kh(this,"rttRolling",new jb(5)),Kh(this,"pingpongTimer",void 0),Kh(this,"wsInflateDataTimer",void 0),Kh(this,"pingpongTimeoutCount",0),Kh(this,"joinResponse",void 0),Kh(this,"multiIpOption",void 0),Kh(this,"initError",void 0),Kh(this,"spec",void 0),Kh(this,"store",void 0),Kh(this,"onWebsocketMessage",(e=>{if(e.data instanceof ArrayBuffer)return void this.emit(Zg.ON_BINARY_DATA,e.data);const t=JSON.parse(e.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")){if(this.emit(t._type,t._message),t._type===tm.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===tm.ON_USER_BANNED)switch(t._message.error_code){case 14:this.close(qg.UID_BANNED);break;case 15:this.close(qg.IP_BANNED);break;case 16:this.close(qg.CHANNEL_BANNED)}if(t._type===tm.ON_USER_LICENSE_BANNED)switch(t._message.error_code){case Wg.ERR_LICENSE_MISSING:this.close(qg.LICENSE_MISSING);break;case Wg.ERR_LICENSE_EXPIRED:this.close(qg.LICENSE_EXPIRED);break;case Wg.ERR_LICENSE_MINUTES_EXCEEDED:this.close(qg.LICENSE_MINUTES_EXCEEDED);break;case Wg.ERR_LICENSE_PERIOD_INVALID:this.close(qg.LICENSE_PERIOD_INVALID);break;case Wg.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(qg.LICENSE_MULTIPLE_SDK_SERVICE);break;case Wg.ERR_LICENSE_ILLEGAL:this.close(qg.LICENSE_ILLEGAL);break;default:this.close()}}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Qb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Jg.CONNECTED&&this.reconnect("retry",Xg.OFFLINE)}))}async request(e,t,n,r){const i=gb(6,""),o={_id:i,_type:e,_message:t},s=this.websocket.connectionID,a=()=>new Zl(((t,n)=>{if(this.connectionState===Jg.CONNECTED)return t();const r=()=>{this.off(Zg.WS_CLOSED,i),t()},i=()=>{this.off(Zg.WS_CONNECTED,r),n(new Qp(Vp.WS_ABORT))};this.once(Zg.WS_CONNECTED,r),this.once(Zg.WS_CLOSED,i),e!==$g.PUBLISH&&e!==$g.SUBSCRIBE&&e!==$g.UNSUBSCRIBE&&e!==$g.UNPUBLISH&&e!==$g.CONTROL&&e!==$g.RESTART_ICE||this.once(Zg.DISCONNECT_P2P,(()=>{n(new Qp(Vp.DISCONNECT_P2P))})),e!==$g.PUBLISH&&e!==$g.RESTART_ICE||this.once(Zg.ABORT_P2P_EXECUTION,(()=>{n(new Qp(Vp.DISCONNECT_P2P))}))}));if(this.connectionState!==Jg.CONNECTING&&this.connectionState!==Jg.RECONNECTING||e===$g.JOIN||e===$g.REJOIN||await a(),this.websocket.sendMessage(o,!0),r)return;const c=new Zl(((n,r)=>{let o=!1;const a=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(Zg.WS_CLOSED,c),this.off(Zg.WS_RECONNECTING,c),this.emit(Zg.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),a);const c=()=>{r(new Qp(Vp.WS_ABORT,"type: ".concat(e))),this.off(Zg.WS_CLOSED,c),this.off(Zg.WS_RECONNECTING,c),this.off("res-@".concat(i),a)};this.once(Zg.WS_CLOSED,c),this.once(Zg.WS_RECONNECTING,c),pb(df("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==s||o||(Jp.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(e)),this.emit(Zg.REQUEST_TIMEOUT,e,t))}))}));let u=null;try{u=await c}catch(r){if(this.connectionState===Jg.CLOSED||e===$g.LEAVE)throw new Qp(Vp.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===$g.JOIN||e===$g.REJOIN?null:(await a(),await this.request(e,t))}if(u.isSuccess)return u.message;const l=Number(u.message.error_code||u.message.code),A=Hb(l),h=new Qp(Vp.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(u.message.error_str),{code:l,data:u.message});return"success"===A.action?u.message:(Jp.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(A.desc,", action: ").concat(A.action)),l===Wg.ERR_TOO_MANY_BROADCASTERS?e===$g.JOIN||e===$g.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===A.action?h.throw():"quit"===A.action?(this.initError=h,this.close(),h.throw()):(l===Wg.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,Jp.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Xg.MULTI_IP)):this.reconnect(A.action,Xg.SERVER_ERROR),e===$g.JOIN||e===$g.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Zl((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=df("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Jg.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),df("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Zl(((n,r)=>{this.once(Zg.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(Zg.WS_CLOSED,(()=>r(this.initError||new Qp(Vp.WS_ABORT)))),this.connectionState=Jg.CONNECTING,this.websocket.init(e).catch(r),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval((()=>{this.handleWsInflateData()}),2e4),setTimeout((()=>{t&&void 0===this.openConnectionTime&&(Jp.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),r(new Qp(Vp.INIT_WEBSOCKET_TIMEOUT)))}),df("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||qg.LEAVE,this.connectionState=Jg.CLOSED,Jp.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),e===qg.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Qb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Zg.ABORT_P2P_EXECUTION);const e=await Eb(this,Zg.REQUEST_JOIN_INFO),t=await this.request($g.JOIN,e);if(!t)return this.emit(Zg.REPORT_JOIN_GATEWAY,Vp.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(Zg.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Jg.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Qp(Vp.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Sb(this,Zg.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request($g.REJOIN,e);return!!t&&(this.connectionState=Jg.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(tm.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(tm.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(tm.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(tm.MUTE_AUDIO,{uid:e.uid}):this.emit(tm.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(tm.MUTE_VIDEO,{uid:e.uid}):this.emit(tm.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(tm.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(tm.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(tm.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(tm.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(tm.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){Jp.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Hb(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(qg.UID_BANNED),void this.close()):void this.reconnect(t.action,Xg.SERVER_ERROR);Jp.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=df("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(Jp.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>df("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Xg.TIMEOUT):this.request($g.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),df("REPORT_STATS")&&this.send($g.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleWsInflateData(){const{wsInflateLength:e,wsDeflateLength:t}=this.websocket.getWsInflateData();0!==e&&0!==t&&this.upload(em.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(pm.RECONNECT_WAITTING_FINISH,(e=>{this.emit(Zg.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(pm.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(Zg.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(pm.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(pm.CLOSED,(()=>{this.connectionState=Jg.CLOSED})),this.websocket.on(pm.FAILED,(()=>{this._disconnectedReason=qg.NETWORK_ERROR,this.connectionState=Jg.CLOSED})),this.websocket.on(pm.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Jg.CONNECTED?this.connectionState=Jg.RECONNECTING:this.connectionState=Jg.CONNECTING})),this.websocket.on(pm.WILL_RECONNECT,((e,t)=>{if(Sb(this,Zg.IS_P2P_DISCONNECTED)&&"retry"===e)return Jp.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Zg.NEED_RENEW_SESSION),this.emit(Zg.DISCONNECT_P2P),t("tryNext");"retry"!==e&&(Jp.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(Zg.NEED_RENEW_SESSION),this.emit(Zg.DISCONNECT_P2P)),t(e)})),this.websocket.on(pm.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{Jp.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",Xg.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(Zg.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof Qp&&e.code===Vp.UNEXPECTED_RESPONSE&&e.data.code===Wg.ERR_NO_AUTHORIZED)return Jp.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Xg.SERVER_ERROR);Jp.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Xg.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(pm.REQUEST_NEW_URLS,((e,t)=>{Eb(this,Zg.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(pm.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(tm.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}))}}function Kb(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class Wb extends Fp{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(e){["tryNext","recover"].includes(e)&&this.resetReconnectCount(e),this._reconnectMode=e}get state(){return this._state}set state(e){e!==this._state&&(this._state=e,"reconnecting"===this._state?this.emit(lv.RECONNECTING,this.reconnectReason):"connected"===this._state?this.emit(lv.CONNECTED):"closed"===this._state?this.emit(lv.CLOSED):"failed"===this._state&&this.emit(lv.FAILED))}constructor(e,t,n,r){super(),Kh(this,"connectionID",0),Kh(this,"currentURLIndex",0),Kh(this,"reconnectReason",void 0),Kh(this,"_reconnectMode","tryNext"),Kh(this,"_initMutex",void 0),Kh(this,"_name",void 0),Kh(this,"_state","closed"),Kh(this,"_reconnectInterrupter",void 0),Kh(this,"_url",void 0),Kh(this,"_retryConfig",void 0),Kh(this,"_reconnectCount",0),Kh(this,"_forceCloseTimeout",5e3),Kh(this,"_onlineReconnectListener",void 0),Kh(this,"_closeEstablishingTransmitter",(()=>{})),Kh(this,"_store",void 0),Kh(this,"_joinChannelServiceRecordIndex",void 0),Kh(this,"_transmitter",void 0),Kh(this,"_useCompress",void 0),Kh(this,"_inflateLength",0),Kh(this,"_deflateLength",0),this._store=r,this._name=e,this._retryConfig=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Kb(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Kb(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t),this._useCompress=n}resetReconnectCount(e){Jp.debug("".concat(this._name," reset reconnect count, reason: ").concat(e)),this._reconnectCount=0}close(e,t){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const e=this._transmitter;t?setTimeout((()=>e.close()),500):e.close(),this._transmitter=void 0}this.state=e?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(e,t){if(!this._transmitter)return void Jp.warning("[".concat(this._name,"] can not reconnect, no websocket"));var n;void 0!==e&&(this.reconnectMode=e),Jp.debug("[".concat(this._name,"] reconnect is triggered initiative")),"number"==typeof this._joinChannelServiceRecordIndex&&(null===(n=this._store)||void 0===n||n.recordJoinChannelService({status:"error",errors:[new Error(t)]},this._joinChannelServiceRecordIndex));const r=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),r&&r.bind(this._transmitter)({code:9999,reason:t})}getInflateData(){const e=this._inflateLength,t=this._deflateLength;return this.clearInflateData(),{inflateLength:e,deflateLength:t}}setInflateData(e){this._deflateLength=this._deflateLength+e.originLength,this._inflateLength=this._inflateLength+e.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function zb(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const r=e.getUint32(t,n),i=e.getUint32(t+4,n),o=Number(!!n),s=Number(!n);return BigInt(r*s+i*o)<<BigInt(32)|BigInt(r*o+i*s)}function qb(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);const i=Number(n>>BigInt(32)),o=Number(n&BigInt(4294967295));r?(e.setUint32(t+4,i,r),e.setUint32(t,o,r)):(e.setUint32(t,i,r),e.setUint32(t+4,o,r))}let Yb;!function(e){e[e.Default=0]="Default",e[e.Ack=1]="Ack"}(Yb||(Yb={}));class Xb{constructor(e,t,n){Kh(this,"version",1),Kh(this,"initialRTO",void 0),Kh(this,"maxBatchAckCount",void 0),Kh(this,"maxRTO",void 0),Kh(this,"initialRTT",void 0),Kh(this,"ID",void 0),Kh(this,"rtt",void 0),Kh(this,"packetNumber",1),Kh(this,"rtoRatioMap",new Map),Kh(this,"timeoutMap",new Map),Kh(this,"unorderedPacketQueue",[]),Kh(this,"batchAckPacketQueue",[]),Kh(this,"lastOrderedPacketNumber",0),Kh(this,"batchAckTimer",void 0),Kh(this,"sendImpl",void 0),Kh(this,"receiveImpl",void 0),this.sendImpl=e,this.receiveImpl=t,this.ID=gb(7,"transmitter-"),this.initialRTO=void 0!==(null==n?void 0:n.initialRTO)?n.initialRTO:df("TRANSMITTER_INITIAL_RTO"),this.initialRTT=void 0!==(null==n?void 0:n.initialRTT)?n.initialRTT:df("TRANSMITTER_INITIAL_RTT"),this.rtt=void 0!==(null==n?void 0:n.initialRTT)?n.initialRTT:df("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=void 0!==(null==n?void 0:n.maxBatchAckCount)?n.maxBatchAckCount:df("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=void 0!==(null==n?void 0:n.maxRTO)?n.maxRTO:df("TRANSMITTER_MAX_RTO")}packetize(e,t){return{type:Yb.Default,version:this.version,packetNumber:t,payload:e}}serialize(e){switch(e.type){case Yb.Default:{let t;t="string"==typeof e.payload?(new TextEncoder).encode(e.payload):e.payload;const n=new ArrayBuffer(t.length+15),r=new DataView(n);return r.setUint16(0,e.version),r.setUint8(2,e.type),r.setUint32(3,e.packetNumber),qb(r,7,BigInt(e.sendTs)),new Uint8Array(r.buffer).set(t,15),n}case Yb.Ack:{const t=new ArrayBuffer(16),n=new DataView(t);return n.setUint16(0,e.version),n.setUint8(2,e.type),n.setUint32(3,e.maxAckPacketNumber),n.setUint8(7,e.shift),qb(n,8,BigInt(e.ackSendTs)),t}}}deserialize(e){const t=new DataView(e),n=t.getUint16(0),r=t.getUint8(2);switch(r){case Yb.Default:{const i=t.getUint32(3),o=zb(t,7),s=e.slice(15),a=(new TextDecoder).decode(s);return{version:n,type:r,packetNumber:i,sendTs:Number(o),payload:a}}case Yb.Ack:{const e=t.getUint32(3),i=t.getUint8(7),o=zb(t,8);return{version:n,type:r,maxAckPacketNumber:e,shift:i,ackSendTs:Number(o)}}default:throw Jp.error("[".concat(this.ID,"] Unrecognized packet type ").concat(r)),new Error("Unrecognized packet type ".concat(r))}}sendMessage(e){const t=this.packetize(e,this.packetNumber);this.packetNumber=4294967295===this.packetNumber?1:this.packetNumber+1;const n=this.calculateRTO(t),r=window.setTimeout((()=>{this.resendMessage(t)}),n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}onData(e){const t=this.deserialize(e);t.type===Yb.Default?this.ack(t):t.type===Yb.Ack&&(this.updateRTT(t,Math.round(performance.now())),this.clearRTO(t))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach((e=>{let[t,n]=e;window.clearTimeout(n)})),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,void 0!==this.batchAckTimer&&window.clearTimeout(this.batchAckTimer)}resendMessage(e){const t=this.calculateRTO(e),n=window.setTimeout((()=>{this.resendMessage(e)}),t);this.timeoutMap.set(e.packetNumber,n),this.sendPacket(e)}calculateRTO(e){const t=this.rtoRatioMap.get(e.packetNumber);if(void 0===t)return this.rtoRatioMap.set(e.packetNumber,1),this.initialRTO;{const n=9*this.rtt/8*t;return this.rtoRatioMap.set(e.packetNumber,t+1),n>this.maxRTO?this.maxRTO:n}}updateRTT(e,t){const n=e.ackSendTs;this.rtt=this.rtt*(7/8)+(t-n-this.rtt)/8}ack(e){if(e.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(e):(this.batchAckPacketQueue.push(e),this.batchAckTimer=window.setTimeout((()=>{this.batchAck()}),this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(e.payload);;){const e=this.unorderedPacketQueue[0];if(!e){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(e.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(e.packetNumber<=this.lastOrderedPacketNumber){const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:Yb.Ack,version:this.version};this.sendPacket(t)}else if(e.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[e.packetNumber-this.lastOrderedPacketNumber-2]=e;const t={ackSendTs:e.sendTs,maxAckPacketNumber:e.packetNumber,shift:0,type:Yb.Ack,version:this.version};this.sendPacket(t)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const e={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Yb.Ack,version:this.version};this.sendPacket(e),this.batchAckPacketQueue=[]}sendPacket(e){e.type===Yb.Default&&(e.sendTs=Math.round(performance.now()));const t=this.serialize(e);this.sendImpl(t)}clearRTO(e){for(let t=e.maxAckPacketNumber-e.shift;t<=e.maxAckPacketNumber;t++){const e=this.timeoutMap.get(t);void 0!==e&&window.clearTimeout(e),this.timeoutMap.delete(t),this.rtoRatioMap.delete(t)}}}class Jb extends Wb{constructor(e,t){super(e,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3?arguments[3]:void 0),Kh(this,"_initMutex",void 0),Kh(this,"_reconnectInterrupter",void 0),Kh(this,"_url",void 0),Kh(this,"_transmitter",void 0),Kh(this,"_addresses",void 0),Kh(this,"_reliableTransmission",void 0),this._initMutex=new n_("datachannel");const{timeout:n,timeoutFactor:r}=t,i=Math.max(300,Math.floor(3*n/5)),o=Math.max(1.2,Math.floor(8*r)/10);nv.ONLINE&&(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o),Qy.on(rv.NETWORK_STATE_CHANGE,((e,t)=>{e!==t&&(this.resetReconnectCount("network state change: ".concat(t," -> ").concat(e)),e===nv.ONLINE?(this._retryConfig.timeout=i,this._retryConfig.timeoutFactor=o):(this._retryConfig.timeout=n,this._retryConfig.timeoutFactor=r))}))}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;this._forceCloseTimeout=t;const n=(t,n)=>{this._addresses=e,this.currentURLIndex=this._addresses.findIndex((e=>e.fingerprint||df("FINGERPRINT")));const r=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(r).then(t).catch(n),this.once(lv.CLOSED,(()=>n(new Qp(Vp.WS_DISCONNECT)))),this.once(lv.CONNECTED,(()=>t()))};return this._initMutex.lock().then((e=>new Zl(((e,t)=>{n(e,t)})).then((()=>{e()})).catch((()=>{e()}))))}sendMessage(e){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new Qp(Vp.WS_ABORT,"datachannel is not ready");try{t||(e=JSON.stringify(e)),this._reliableTransmission.sendMessage(e)}catch(e){throw new Qp(Vp.WS_ERR,"send datachannel signal message error"+e.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(e){const t=JSON.stringify(e);return{compressed:t,compressedLength:t.length,origin:e}}sendMessageWithUint8Array(e){return{compressed:e,compressedLength:e.byteLength,origin:e}}createTransmitterConnection(e){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(e.ip,":").concat(e.port),new Zl(((t,n)=>{var r;const i=()=>{Jp.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),t()},o=async e=>{var r;if(null===(r=this._closeEstablishingTransmitter)||void 0===r||r.call(this),Jp.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(e.code,", reason: ").concat(e.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){"connected"===this.state&&(this.reconnectReason=e.reason,this.state="reconnecting");const r=wb(this,lv.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,i=await this.reconnectWithAction(r);if("closed"===this.state)return void Jp.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!i)return n(new Qp(Vp.WS_DISCONNECT,"datachannel reconnect failed: ".concat(e.code))),void this.close(!0);t()}else n(new Qp(Vp.WS_DISCONNECT,"datachannel close: ".concat(e.code))),this.close()},s=e=>{var t;null===(t=this._reliableTransmission)||void 0===t||t.onData(e.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),Jp.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(e)));const a=null===(r=this._store)||void 0===r?void 0:r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),c=Date.now();Eb(this,lv.TO_CONNECT_DATACHANNEL,e).then((e=>{var t,n;if(!e)throw new Error("transmissonInfo not exist yet");const{transmitter:r,close:u}=e;this._transmitter=r,null===(t=this._store)||void 0===t||t.signalChannelOpen();const l=Date.now()-c;Jp.debug("[choose dc] dc open cost ".concat(l,"ms")),this._reliableTransmission=new Xb((e=>{var t;this._transmitter&&"open"===this._transmitter.readyState&&(null===(t=this._transmitter)||void 0===t||t.send(e))}),(e=>{"string"==typeof e&&this.emit(lv.ON_MESSAGE,e)})),this._closeEstablishingTransmitter=()=>{var e;null===(e=this._reliableTransmission)||void 0===e||e.close(),this._reliableTransmission=void 0,u()},i&&i(),r.onclose=o,r.onmessage=s,null===(n=this._store)||void 0===n||n.recordJoinChannelService({endTs:Date.now(),status:"success"},a),this._joinChannelServiceRecordIndex=a})).catch((e=>{var t;if(null===(t=this._store)||void 0===t||t.recordJoinChannelService({endTs:Date.now(),status:e instanceof Qp&&e.code===Vp.WS_ABORT?"aborted":"error",errors:[e]},a),"closed"!==this.state){if(e instanceof Qp&&e.code===Vp.WS_ERR){const t=new Qp(Vp.WS_ERR,"init datachannel failed! Error: ".concat(e.toString()));return Jp.error("[".concat(this._name,"]").concat(t)),void n(t)}o&&o(e)}else n(new Qp(Vp.WS_DISCONNECT,"datachannel is closed: ".concat(e.toString())))}))}))}async reconnectWithAction(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount)return!1;if(!this._addresses)return!1;if("closed"===this.state)return!1;this._onlineReconnectListener||Qy.networkState!==nv.OFFLINE||(this._onlineReconnectListener=Qy.onlineWaiter&&Qy.onlineWaiter.then((()=>{this._onlineReconnectListener=void 0})));let n=!0;if(this._reconnectInterrupter=()=>{n=!1},t){const t=Gp(this._reconnectCount,this._retryConfig);Jp.debug("[".concat(this._name,"] wait ").concat(t,"ms to reconnect datachannel, mode: ").concat(e)),await Zl.race([pb(t),this._onlineReconnectListener||new Zl((()=>{}))])}if("closed"===this.state||!n)return!1;this._reconnectCount+=1;const r=async(e,t)=>{this.emit(lv.RECONNECT_CREATE_CONNECTION,t),await this.createTransmitterConnection(e)};try{if("retry"===e){const t=this._addresses[this.currentURLIndex];this.emit(lv.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else if("tryNext"===e){this.currentURLIndex+=1;for(let e=this.currentURLIndex;e<this._addresses.length;e++){if(this._addresses[e].fingerprint||df("FINGERPRINT")){this.currentURLIndex=e;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return Jp.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);Jp.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const t=this._addresses[this.currentURLIndex];this.emit(lv.RECONNECT_WAITTING_FINISH,e),await r(t,e)}else"recover"===e&&(Jp.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(lv.RECONNECT_WAITTING_FINISH,e),this.emit(lv.FAILBACK));return!0}catch(n){var i;return Jp.error("[".concat(this._name,"] reconnect failed"),n.toString()),null!=n&&null!==(i=n.data)&&void 0!==i&&i.desc&&Array.isArray(n.data.desc)&&n.data.desc.length&&n.data.desc.includes("dynamic key expired")?(this.emit(lv.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(e,t)}}}class Zb extends Fp{get connectionState(){return this._connectionState}set connectionState(e){e!==this._connectionState&&(this._connectionState=e,e===Jg.CONNECTED?this.emit(Zg.WS_CONNECTED):e===Jg.RECONNECTING?this.emit(Zg.WS_RECONNECTING,this._websocketReconnectReason):e===Jg.CLOSED&&this.emit(Zg.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(e,t){super(),Kh(this,"_disconnectedReason",void 0),Kh(this,"_websocketReconnectReason",void 0),Kh(this,"_connectionState",Jg.CLOSED),Kh(this,"reconnectToken",void 0),Kh(this,"websocket",void 0),Kh(this,"openConnectionTime",void 0),Kh(this,"clientId",void 0),Kh(this,"lastMsgTime",Date.now()),Kh(this,"uploadCache",[]),Kh(this,"uploadCacheInterval",void 0),Kh(this,"rttRolling",new jb(5)),Kh(this,"pingpongTimer",void 0),Kh(this,"inflateDataTimer",void 0),Kh(this,"pingpongTimeoutCount",0),Kh(this,"joinResponse",void 0),Kh(this,"multiIpOption",void 0),Kh(this,"initError",void 0),Kh(this,"spec",void 0),Kh(this,"store",void 0),Kh(this,"onWebsocketMessage",(e=>{if(e instanceof ArrayBuffer)return void this.emit(Zg.ON_BINARY_DATA,e);const t=JSON.parse(e);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(t,"_id")){const e="res-@".concat(t._id);this.emit(e,t._result,t._message)}else if(Object.prototype.hasOwnProperty.call(t,"_type")&&(this.emit(t._type,t._message),t._type===tm.ON_NOTIFICATION&&this.handleNotification(t._message),t._type===tm.ON_USER_BANNED))switch(t._message.error_code){case 14:this.close(qg.UID_BANNED);break;case 15:this.close(qg.IP_BANNED);break;case 16:this.close(qg.CHANNEL_BANNED)}})),this.clientId=e.clientId,this.spec=e,this.store=t,this.websocket=new Jb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,t),this.handleWebsocketEvents(),window.addEventListener("offline",(()=>{this.connectionState===Jg.CONNECTED&&this.reconnect("retry",uv.OFFLINE)}))}async request(e,t,n,r){const i=gb(6,""),o={_id:i,_type:e,_message:t},s=this.websocket.connectionID,a=()=>new Zl(((t,n)=>{if(this.connectionState===Jg.CONNECTED)return t();const r=()=>{this.off(Zg.WS_CLOSED,i),t()},i=()=>{this.off(Zg.WS_CONNECTED,r),n(new Qp(Vp.WS_ABORT))};this.once(Zg.WS_CONNECTED,r),this.once(Zg.WS_CLOSED,i),e!==$g.PUBLISH&&e!==$g.SUBSCRIBE&&e!==$g.UNSUBSCRIBE&&e!==$g.UNPUBLISH&&e!==$g.CONTROL&&e!==$g.RESTART_ICE||this.once(Zg.DISCONNECT_P2P,(()=>{n(new Qp(Vp.DISCONNECT_P2P))})),e!==$g.PUBLISH&&e!==$g.RESTART_ICE||this.once(Zg.ABORT_P2P_EXECUTION,(()=>{n(new Qp(Vp.DISCONNECT_P2P))}))}));if(this.connectionState!==Jg.CONNECTING&&this.connectionState!==Jg.RECONNECTING||e===$g.JOIN||e===$g.REJOIN||await a(),e===$g.LEAVE&&(this.websocket.unbindDcCloseEventListener(),r=!0),this.websocket.sendMessage(o,!0,!1),r)return;const c=new Zl(((n,r)=>{let o=!1;const a=(r,i)=>{o=!0,n({isSuccess:"success"===r,message:i||{}}),this.off(Zg.WS_CLOSED,c),this.off(Zg.WS_RECONNECTING,c),this.emit(Zg.REQUEST_SUCCESS,e,t)};this.once("res-@".concat(i),a);const c=()=>{r(new Qp(Vp.WS_ABORT,"type: ".concat(e))),this.off(Zg.WS_CLOSED,c),this.off(Zg.WS_RECONNECTING,c),this.off("res-@".concat(i),a)};this.once(Zg.WS_CLOSED,c),this.once(Zg.WS_RECONNECTING,c),pb(df("SIGNAL_REQUEST_TIMEOUT")).then((()=>{this.websocket.connectionID!==s||o||(Jp.warning("dc request timeout, type: ".concat(e)),this.emit(Zg.REQUEST_TIMEOUT,e,t))}))}));let u=null;try{u=await c}catch(r){if(this.connectionState===Jg.CLOSED||e===$g.LEAVE)throw new Qp(Vp.WS_ABORT);return!this.spec.forceWaitGatewayResponse||n?r.throw():e===$g.JOIN||e===$g.REJOIN?null:(await a(),await this.request(e,t))}if(u.isSuccess)return u.message;const l=Number(u.message.error_code||u.message.code),A=Hb(l),h=new Qp(Vp.UNEXPECTED_RESPONSE,"".concat(A.desc,": ").concat(u.message.error_str),{code:l,data:u.message});return"success"===A.action?u.message:(Jp.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(e,", error_code: ").concat(l,", message: ").concat(A.desc,", action: ").concat(A.action)),l===Wg.ERR_TOO_MANY_BROADCASTERS?e===$g.JOIN||e===$g.REJOIN?(this.initError=h,this.close(),h.throw()):h.throw():"failed"===A.action?h.throw():"quit"===A.action?(this.initError=h,this.close(),h.throw()):(l===Wg.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=u.message.option,Jp.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",uv.MULTI_IP)):this.reconnect(A.action,uv.SERVER_ERROR),e===$g.JOIN||e===$g.REJOIN?null:await this.request(e,t)))}waitMessage(e,t){return new Zl((n=>{const r=i=>{(!t||t(i))&&(this.off(e,r),n(i))};this.on(e,r)}))}upload(e,t){const n={_type:e,_message:t};try{this.websocket.sendMessage(n)}catch(e){const t=df("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(n),this.uploadCache.length>t&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval((()=>{if(this.connectionState!==Jg.CONNECTED)return;const e=this.uploadCache.splice(0,1)[0];0===this.uploadCache.length&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(e._type,e._message)}),df("UPLOAD_CACHE_INTERVAL")||2e3))}}send(e,t){const n={_type:e,_message:t};this.websocket.sendMessage(n)}init(e,t){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new Zl(((n,r)=>{this.once(Zg.WS_CONNECTED,(()=>n(this.joinResponse))),this.once(Zg.WS_CLOSED,(()=>r(this.initError||new Qp(Vp.WS_ABORT)))),this.connectionState=Jg.CONNECTING,this.websocket.init(e).catch(r),this.websocket.once(lv.FAILBACK,(()=>{void 0===this.openConnectionTime&&r(new Qp(Vp.INIT_DATACHANNEL_TIMEOUT))})),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval((()=>{this.handleInflateData()}),2e4),setTimeout((()=>{t&&void 0===this.openConnectionTime&&(Jp.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),r(new Qp(Vp.INIT_DATACHANNEL_TIMEOUT)))}),df("DC_JOIN_WITH_FAILBACK"))}))}close(e){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=e||qg.LEAVE,this.connectionState=Jg.CLOSED,Jp.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),e===qg.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new Jb("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Zg.ABORT_P2P_EXECUTION);const e=await Eb(this,Zg.DATACHANNEL_CONNECTING),t=await this.request($g.JOIN,e);if(!t)return this.emit(Zg.REPORT_JOIN_GATEWAY,Vp.TIMEOUT,this.url||""),!1;this.joinResponse=t,this.emit(Zg.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=Jg.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Qp(Vp.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const e=Sb(this,Zg.REQUEST_REJOIN_INFO);e.token=this.reconnectToken;const t=await this.request($g.REJOIN,e);return!!t&&(this.connectionState=Jg.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),t.peers&&t.peers.forEach((e=>{this.emit(tm.ON_USER_ONLINE,{uid:e.uid}),e.audio&&this.emit(tm.ON_ADD_AUDIO_STREAM,{uid:e.uid,uint_id:e.uint_id,audio:!0,ssrcId:e.audio_ssrc}),e.video&&this.emit(tm.ON_ADD_VIDEO_STREAM,{uid:e.uid,uint_id:e.uint_id,video:!0,ssrcId:e.video_ssrc}),e.audio_mute?this.emit(tm.MUTE_AUDIO,{uid:e.uid}):this.emit(tm.UNMUTE_AUDIO,{uid:e.uid}),e.video_mute?this.emit(tm.MUTE_VIDEO,{uid:e.uid}):this.emit(tm.UNMUTE_VIDEO,{uid:e.uid}),e.audio_enable_local?this.emit(tm.ENABLE_LOCAL_AUDIO,{uid:e.uid}):this.emit(tm.DISABLE_LOCAL_AUDIO,{uid:e.uid}),e.video_enable_local?this.emit(tm.ENABLE_LOCAL_VIDEO,{uid:e.uid}):this.emit(tm.DISABLE_LOCAL_VIDEO,{uid:e.uid}),e.audio||e.video||this.emit(tm.ON_REMOVE_STREAM,{uid:e.uid,uint_id:e.uint_id})})),!0)}reconnect(e,t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(e,t)}handleNotification(e){Jp.debug("[".concat(this.clientId,"] receive notification: "),e);const t=Hb(e.code);if("success"!==t.action){if("failed"!==t.action)return"quit"===t.action?("ERR_REPEAT_JOIN_CHANNEL"===t.desc&&this.close(qg.UID_BANNED),void this.close()):void this.reconnect(t.action,uv.SERVER_ERROR);Jp.error("[".concat(this.clientId,"] ignore error: "),t.desc)}}handlePingPong(){if(!this.websocket||"connected"!==this.websocket.state)return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const e=df("PING_PONG_TIME_OUT"),t=Date.now();this.pingpongTimeoutCount>=e&&(Jp.warning("PINGPONG Timeout. Last Socket Message: ".concat(t-this.lastMsgTime,"ms")),t-this.lastMsgTime>df("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",uv.TIMEOUT):this.request($g.PING,void 0,!0).then((()=>{this.pingpongTimeoutCount=0;const e=Date.now()-t;this.rttRolling.add(e),df("REPORT_STATS")&&this.send($g.PING_BACK,{pingpongElapse:e})})).catch((e=>{}))}handleInflateData(){const{inflateLength:e,deflateLength:t}=this.websocket.getInflateData();0!==e&&0!==t&&this.upload(em.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:t,ws_inflate_length:e})}handleWebsocketEvents(){this.websocket.on(lv.RECONNECT_WAITTING_FINISH,(e=>{this.emit(Zg.WS_RECONNECT_WAITTING_FINISH,e)})),this.websocket.on(lv.RECONNECT_CREATE_CONNECTION,(e=>{this.emit(Zg.WS_RECONNECT_CREATE_CONNECTION,e)})),this.websocket.on(lv.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(lv.CLOSED,(()=>{this.connectionState=Jg.CLOSED})),this.websocket.on(lv.FAILED,(()=>{this._disconnectedReason=qg.NETWORK_ERROR,this.connectionState=Jg.CLOSED})),this.websocket.on(lv.RECONNECTING,(e=>{this._websocketReconnectReason=e,this.joinResponse=void 0,this.connectionState===Jg.CONNECTED?this.connectionState=Jg.RECONNECTING:this.connectionState=Jg.CONNECTING})),this.websocket.on(lv.WILL_RECONNECT,((e,t)=>{if(Sb(this,Zg.IS_P2P_DISCONNECTED)&&"retry"===e)return Jp.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Zg.NEED_RENEW_SESSION),this.emit(Zg.DISCONNECT_P2P),t("tryNext");"retry"!==e&&(Jp.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(e)),this.reconnectToken=void 0,this.emit(Zg.NEED_RENEW_SESSION),this.emit(Zg.DISCONNECT_P2P)),t(e)})),this.websocket.on(lv.CONNECTED,(()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch((e=>{Jp.warning("[".concat(this.clientId,"] rejoin failed ").concat(e)),this.reconnect("tryNext",uv.SERVER_ERROR)})):this.join().catch((e=>{if(this.emit(Zg.REPORT_JOIN_GATEWAY,e.message||e.code,this.url||""),e instanceof Qp&&e.code===Vp.UNEXPECTED_RESPONSE&&e.data.code===Wg.ERR_NO_AUTHORIZED)return Jp.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",uv.SERVER_ERROR);Jp.error("[".concat(this.clientId,"] join gateway request failed"),e.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",uv.SERVER_ERROR):(this.initError=e,this.close())}))})),this.websocket.on(lv.REQUEST_NEW_URLS,((e,t)=>{Eb(this,Zg.REQUEST_RECOVER,this.multiIpOption).then(e).catch(t)})),this.websocket.on(lv.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{this.emit(tm.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})),this.websocket.on(lv.TO_CONNECT_DATACHANNEL,(async(e,t,n)=>Eb(this,Zg.DATACHANNEL_PRECONNECT,e).then(t).catch(n))),this.websocket.on(lv.FAILBACK,(()=>{void 0!==this.openConnectionTime&&this.emit(Zg.DATACHANNEL_FAILBACK)}))}}function $b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ew(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$b(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const tw=new Map;class nw extends Fp{get state(){return this._state}set state(e){if(e===this._state)return;const t=this._state;this._state=e,"DISCONNECTED"===e&&this._disconnectedReason?this.emit(Nm.CONNECTION_STATE_CHANGE,e,t,this._disconnectedReason):this.emit(Nm.CONNECTION_STATE_CHANGE,e,t)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(e){Jp.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(e)),this._joinGatewayStartTime=e}constructor(e,t){super(),Kh(this,"store",void 0),Kh(this,"joinInfo",void 0),Kh(this,"key",void 0),Kh(this,"signal",void 0),Kh(this,"role",void 0),Kh(this,"inChannelInfo",{joinAt:null,duration:0}),Kh(this,"spec",void 0),Kh(this,"_state","DISCONNECTED"),Kh(this,"_statsCollector",void 0),Kh(this,"_disconnectedReason",void 0),Kh(this,"isSignalRecover",!1),Kh(this,"hasChangeBGPAddress",!1),Kh(this,"trafficStatsInterval",void 0),Kh(this,"networkQualityInterval",void 0),Kh(this,"_joinGatewayStartTime",0),Kh(this,"_signalTimeout",!1),Kh(this,"_clientRoleOptions",void 0),Kh(this,"_isProactiveJoin",!1),this.store=e,this.spec=t,this.signal=this.store.useDataChannel?new Zb(ew(ew({},t),{},{retryConfig:t.websocketRetryConfig}),e):new Gb(ew(ew({},t),{},{retryConfig:t.websocketRetryConfig}),e),this._statsCollector=t.statsCollector,this.role=t.role||"audience",this._clientRoleOptions=t.clientRoleOptions,this.handleSignalEvents()}async join(e,t,n){if(this.signal instanceof Zb){let t=!1;"disabled"!==e.cloudProxyServer?(Jp.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(e.cloudProxyServer,")")),t=!0):"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length>255||"".concat(e.apResponse.cid,"_").concat(e.apResponse.cert).length<22?(Jp.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),t=!0):e.apResponse.addresses.some((e=>e.fingerprint))||df("FINGERPRINT")||(Jp.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),t=!0),t&&this.resetSignal()}this.store.joinGatewayStart(),"disabled"!==e.cloudProxyServer&&(this.hasChangeBGPAddress=!0);const r=Date.now();let i=tw.get(e.cname);if(i||(i=new Map,tw.set(e.cname,i)),this._isProactiveJoin=!0,i.has(e.uid)){const t=new Qp(Vp.UID_CONFLICT);throw Zy.joinGateway(e.sid,{lts:r,succ:!1,ec:t.message,addr:null,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!e.proxyServer,signalChannel:this.signal instanceof Zb?"1":"0"}),this._isProactiveJoin=!1,t}i.set(e.uid,!0),this.joinInfo=e,this.key=t;let o=0;this.joinGatewayStartTime=r;const s=e.proxyServer;try{let t;if(Jp.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof Zb?"datachannel":"websocket"," join uid ").concat(o)),this.signal instanceof Zb)t=await this.signal.init(e.apResponse.addresses,n);else{const r=e.proxyServer,i=r?e.gatewayAddrs.map((e=>{const t=e.address.split(":");return"wss://".concat(r,"/ws/?h=").concat(t[0],"&p=").concat(t[1])})):e.gatewayAddrs.map((e=>"wss://".concat(e.address)));t=await this.signal.init(i,n)}o=t.uid,Jp.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof Zb?"datachannel":"websocket"," join uid ").concat(o," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(t){if(t&&t.code===Vp.INIT_WEBSOCKET_TIMEOUT)throw Jp.warning("[".concat(this.store.clientId,"] User join failed"),t.toString()),t;if(t&&t.code===Vp.INIT_DATACHANNEL_TIMEOUT)throw Jp.warning("[".concat(this.store.clientId,"] User join datachannel failed"),t.toString()),this.resetSignal(),t;throw Jp.error("[".concat(this.store.clientId,"] User join failed"),t.toString()),Zy.joinGateway(e.sid,{lts:r,succ:!1,ec:t.message,addr:this.signal.url,uid:e.uid,cid:e.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!s,signalChannel:this.signal instanceof Zb?"1":"0"}),this._isProactiveJoin=!1,i.delete(e.uid),this.signal.close(),t}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),Jp.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval((()=>{this.updateTrafficStats().catch((e=>{Jp.warning("[".concat(this.store.clientId,"] get traffic stats error"),e.toString())}))}),3e3),this.networkQualityInterval=window.setInterval((()=>{navigator&&void 0!==navigator.onLine&&!navigator.onLine?this.emit(Nm.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Nm.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):"CONNECTED"===this.state&&this._statsCollector.trafficStats?this.emit(Nm.NETWORK_QUALITY,{uplinkNetworkQuality:sb(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:sb(this._statsCollector.trafficStats.B_dnq)}):this.emit(Nm.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})}),2e3),this.store.joinGatewayEnd(),o}async leave(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if("DISCONNECTED"!==this.state){t!==qg.FALLBACK&&(this.state="DISCONNECTING");try{e||this.signal.connectionState!==Jg.CONNECTED||await function(e,t){return Zl.race([e,fb(3e3)])}(this.signal.request($g.LEAVE,void 0,!0))}catch(e){Jp.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),e)}this.signal.close(t),t!==qg.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Qp(Vp.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const r={state:"offer",p2p_id:this.store.p2pId,ortc:t,mode:this.spec.mode,extend:df("PUB_EXTEND"),twcc:!!df("PUBLISH_TWCC"),rtx:!!df("USE_PUB_RTX")};try{return(await this.signal.request($g.PUBLISH,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===Wg.ERR_PUBLISH_REQUEST_INVALID)return Jp.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),r.toString()),await this.tryUnpubBeforeRepub(e,t),this.publish(e,t,!1);throw r}}async unpublish(e,t){try{if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Qp(Vp.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request($g.UNPUBLISH,{stream_id:t,ortc:e},!0)}catch(e){Jp.warning("[".concat(this.store.clientId,"] unpublish warning: "),e)}}async subscribe(e,t,n){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Qp(Vp.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const r={stream_id:e,stream_type:t.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!df("SUBSCRIBE_TWCC"),rtx:!!df("USE_SUB_RTX"),extend:df("SUB_EXTEND"),ssrcId:t.ssrcId,svc:Array.isArray(df("SVC"))&&0!==df("SVC").length?df("SVC"):void 0};try{return(await this.signal.request($g.SUBSCRIBE,r,!0))._message}catch(r){if(n&&r.data&&r.data.code===Wg.ERR_SUBSCRIBE_REQUEST_INVALID)return Jp.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),r.toString()),await this.tryUnsubBeforeResub(e,t),await this.subscribe(e,t,!1);throw r}}async subscribeAll(e,t){if("CONNECTED"!==this.state&&"RECONNECTING"!==this.state)throw new Qp(Vp.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const n={p2p_id:this.store.p2pId,users:e,dtx:!1,rtx:!!df("USE_SUB_RTX")};try{return await this.signal.request($g.SUBSCRIBE_STREAMS,n,!0)}catch(n){if(t&&n.data&&n.data.code===Wg.ERR_SUBSCRIBE_REQUEST_INVALID)return Jp.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),n.toString()),await this.tryMassUnsubBeforeResub(e),await this.subscribeAll(e,!1);throw n}}async setVideoProfile(e){const t=function(e){if(!(e.bitrateMax&&e.bitrateMin&&e.frameRate&&e.height&&e.width))return;let t=e.frameRate,n=e.width,r=e.height,i=!0;return"number"!=typeof t&&(t=t.exact||t.ideal||t.max||t.min||0,t||(i=!1)),"number"!=typeof n&&(n=n.exact||n.ideal||n.max||n.min||0,n||(i=!1)),"number"!=typeof r&&(r=r.exact||r.ideal||r.max||r.min||0,t||(i=!1)),i?{stream_type:0,width:n,height:r,fps:t,start_bps:1e3*e.bitrateMax,min_bps:1e3*e.bitrateMin,target_bps:1e3*e.bitrateMax}:void 0}(e);if(t)return this.signal.request($g.SET_VIDEO_PROFILE,t);Jp.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(e,t){try{await this.signal.request($g.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:e,stream_id:t},!0)}catch(e){Jp.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),e)}}async massUnsubscribe(e){try{await this.signal.request($g.UNSUBSCRIBE_STREAMS,e,!0)}catch(e){Jp.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),e)}}async reconnectPC(e){const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=e;return{gatewayEstablishParams:await this.signal.request($g.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request($g.GATEWAY_INFO)}async renewToken(e){await this.signal.request($g.RENEW_TOKEN,e),this.key=e.token}async setClientRole(e,t){if(t&&(this._clientRoleOptions=Object.assign({},t)),"CONNECTED"!==this.state)return void(this.role=e);let n;n="audience"===e?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request($g.SET_CLIENT_ROLE,{role:e,level:n,client_ts:Date.now()}),this.role=e}async setRemoteVideoStreamType(e,t){await this.signal.request($g.SWITCH_VIDEO_STREAM,{stream_id:e,stream_type:t})}async setDefaultRemoteVideoStreamType(e){await this.signal.request($g.DEFAULT_VIDEO_STREAM,{stream_type:e})}async setStreamFallbackOption(e,t){await this.signal.request($g.SET_FALLBACK_OPTION,{stream_id:e,fallback_type:t})}async pickSVCLayer(e,t){await this.signal.request($g.PICK_SVC_LAYER,{stream_id:e,spatial_layer:t.spatialLayer,temporal_layer:t.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),ew({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request($g.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const e=tw.get(this.joinInfo.cname);e&&e.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const e=function(e){let t;return t=e.startsWith("dc")?e.match(/(dc\:\/\/)?([^:]+):(\d+)/):e.match(/(wss\:\/\/)?([^:]+):(\d+)/),t?{username:nf.username,password:nf.password,turnServerURL:t[2],tcpport:parseInt(t[3])+30,udpport:parseInt(t[3])+30,forceturn:!1}:null}(("disabled"===this.joinInfo.cloudProxyServer?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],e&&"off"!==this.joinInfo.turnServer.mode&&"disabled"===this.joinInfo.cloudProxyServer&&this.joinInfo.turnServer.serversFromGateway.push(ew(ew({},nf),{},{turnServerURL:e.turnServerURL,tcpport:e.tcpport,udpport:e.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if("CONNECTED"!==this.state)return;const e=await this.signal.request($g.TRAFFIC_STATS,void 0,!0);e.timestamp=Date.now(),e.peer_delay.forEach((e=>{const t=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find((t=>t.peer_uid===e.peer_uid));t&&t.B_st!==e.B_st&&Rb((()=>{this.emit(Nm.STREAM_TYPE_CHANGE,e.peer_uid,e.B_st)}))})),this._statsCollector.updateTrafficStats(e)}getJoinMessage(e){if(!this.joinInfo||!this.key)throw new Qp(Vp.UNEXPECTED_ERROR,"can not generate join message, no join info");const t=Object.assign({},this.joinInfo.apResponse);let n=df("REPORT_APP_SCENARIO");if("string"!=typeof n)try{n=JSON.stringify(n)}catch(e){n=void 0}n&&n.length>128&&(n=void 0);const r=ew({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:$p,browser:navigator.userAgent,process_id:df("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:t,extend:df("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:"proxy3"===this.joinInfo.cloudProxyServer?"1":"proxy5"===this.joinInfo.cloudProxyServer?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:n,attributes:{userAttributes:{enablePublishedUserList:df("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:df("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:"number"==typeof df("SUBSCRIBE_AUDIO_FILTER_TOPN")?df("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:"boolean"==typeof df("ENABLE_PUBLISH_AUDIO_FILTER")?df("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:"boolean"==typeof df("ENABLE_USER_LICENSE_CHECK")?df("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:!0===df("USE_PUB_RTX")||!0===df("USE_SUB_RTX")||void 0}},join_ts:this.joinGatewayStartTime},e);return this.joinInfo.stringUid&&(r.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(r.aes_mode=this.joinInfo.aesmode,df("ENCRYPT_AES")?(r.aes_secret=this.joinInfo.aespassword,r.aes_encrypt=!0):r.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(r.aes_salt=this.joinInfo.aessalt)),t.addresses[this.signal.websocket.currentURLIndex]&&(r.ap_response.ticket=t.addresses[this.signal.websocket.currentURLIndex].ticket,delete t.addresses),void 0!==this.joinInfo.defaultVideoStream&&(r.default_video_stream=this.joinInfo.defaultVideoStream),r}getRejoinMessage(){if(!this.joinInfo)throw new Qp(Vp.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Zg.WS_RECONNECT_WAITTING_FINISH,(e=>{["tryNext","recover"].includes(e)&&this.joinInfo&&Zy.adjustSessionStartTime(this.joinInfo.sid)})),this.signal.on(Zg.WS_RECONNECT_CREATE_CONNECTION,(e=>{this.joinGatewayStartTime=Date.now()})),this.signal.on(Zg.WS_RECONNECTING,(e=>{this.joinInfo&&Zy.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:e||Xg.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",Zy.sessionInit(this.joinInfo.sid,{lts:(new Date).getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())})),this.signal.on(Zg.WS_CLOSED,(e=>{let t;switch(e){case qg.LEAVE:t=Xg.LEAVE;break;case qg.UID_BANNED:case qg.IP_BANNED:case qg.CHANNEL_BANNED:case qg.SERVER_ERROR:t=Xg.SERVER_ERROR;break;case qg.FALLBACK:t=Xg.FALLBACK;break;case qg.LICENSE_MISSING:case qg.LICENSE_EXPIRED:case qg.LICENSE_MINUTES_EXCEEDED:case qg.LICENSE_PERIOD_INVALID:case qg.LICENSE_MULTIPLE_SDK_SERVICE:case qg.LICENSE_ILLEGAL:t=e;break;default:t=Xg.NETWORK_ERROR}Jp.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(t||"undefined -> "+Xg.NETWORK_ERROR)),this.joinInfo&&Zy.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:e===qg.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t}),this._disconnectedReason=e,e!==qg.FALLBACK&&(this.state="DISCONNECTED"),this.reset()})),this.signal.on(Zg.WS_CONNECTED,(()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&("audience"===this.role&&this._clientRoleOptions&&this._clientRoleOptions.level&&(Jp.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),Zy.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Zb?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&1===this.joinInfo.setLocalAPVersion)){const e=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!e)return void Jp.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(e));hf("EVENT_REPORT_DOMAIN",e[1]),hf("EVENT_REPORT_BACKUP_DOMAIN",e[1]),hf("LOG_UPLOAD_SERVER","".concat(e[1],":6444"))}})),this.signal.on(tm.ON_UPLINK_STATS,(e=>{this._statsCollector.updateUplinkStats(e)})),this.signal.on(Zg.REQUEST_RECOVER,((e,t,n)=>{if(!this.joinInfo)return n(new Qp(Vp.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));e&&(this.joinInfo.multiIP=e,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Eb(this,Nm.REQUEST_NEW_GATEWAY_LIST).then(t).catch(n)})),this.signal.on(Zg.REQUEST_JOIN_INFO,(async e=>{var t;this.updateTurnConfigFromSignal();const{iceParameters:n,dtlsParameters:r,rtpCapabilities:i}=await Eb(this,Nm.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:null===(t=this.joinInfo)||void 0===t?void 0:t.turnServer});e(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:i,version:"2"}}))})),this.signal.on(Zg.REQUEST_REJOIN_INFO,(e=>{e(this.getRejoinMessage())})),this.signal.on(Zg.REPORT_JOIN_GATEWAY,((e,t)=>{this.joinInfo&&(Zy.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:e,addr:t,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof Zb?"1":"0"}),this._isProactiveJoin=!1)})),this.signal.on(Zg.IS_P2P_DISCONNECTED,(e=>{e(Sb(this,Nm.IS_P2P_DISCONNECTED))})),this.signal.on(Zg.DISCONNECT_P2P,(()=>{this.emit(Nm.DISCONNECT_P2P)})),this.signal.on(Zg.NEED_RENEW_SESSION,(()=>{this.emit(Nm.NEED_RENEW_SESSION)})),this.signal.on(Zg.REQUEST_SUCCESS,(()=>{this._signalTimeout=!1})),this.signal.on(Zg.REQUEST_TIMEOUT,(()=>{this._signalTimeout=!0})),this.signal.on(Zg.JOIN_RESPONSE,(e=>{const t=this.getCurrentGatewayAddress();this.emit(Nm.JOIN_RESPONSE,e,t)})),this.signal.on(Zg.DATACHANNEL_PRECONNECT,(async(e,t,n)=>{this.updateTurnConfigFromSignal();const r=this.getCurrentGatewayAddress();return Eb(this,Nm.DATACHANNEL_PRECONNECT,e,r).then(t).catch(n)})),this.signal.on(Zg.DATACHANNEL_CONNECTING,(async e=>{const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await Eb(this,Nm.REQUEST_DC_CONNECTION_PARAMS);e(this.getJoinMessage({ortc:{iceParameters:t,dtlsParameters:n,rtpCapabilities:r,version:"2"}}))})),this.signal.on(Zg.DATACHANNEL_FAILBACK,(()=>{Jp.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Nm.DATACHANNEL_FAILBACK)}))}async tryUnsubBeforeResub(e,t){try{await this.signal.request($g.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:e,ortc:[t]},!0)}catch(e){throw Jp.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),e),e}}async tryUnpubBeforeRepub(e,t){try{await this.signal.request($g.UNPUBLISH,{stream_id:e,ortc:t},!0)}catch(e){throw Jp.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),e),e}}async tryMassUnsubBeforeResub(e){const t={users:e.map((e=>({stream_id:e.stream_id,stream_type:e.stream_type})))};try{await this.signal.request($g.UNSUBSCRIBE_STREAMS,t,!0)}catch(e){throw Jp.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),e),e}}async muteLocal(e,t){const n={action:e.find((e=>e.stream_type===xm.Audio))?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request($g.CONTROL,n,!0,!0)}catch(e){throw Jp.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),e),e}}async unmuteLocal(e,t){const n={action:e.find((e=>e.stream_type===xm.Audio))?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:e,stream_id:t};try{await this.signal.request($g.CONTROL,n,!0,!0)}catch(e){throw Jp.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),e),e}}uploadStats(e,t){this.signal.upload(e,t)}getSignalRTT(){return this.signal.rtt}async restartICE(e){const t={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:e};try{return await this.signal.request($g.RESTART_ICE,t,!0)}catch(e){throw Jp.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),e),e}}reconnect(){"CONNECTED"===this.state&&this.signal.reconnect(void 0,Xg.P2P_FAILED)}getCurrentGatewayAddress(){var e;if(!df("GATEWAY_WSS_ADDRESS"))return null!==(e=this.joinInfo)&&void 0!==e&&e.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(e){await this.signal.request($g.SET_PARAMETER,{enablePublishAudioFilter:e})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(qg.FALLBACK)),this.store.useDataChannel=!1,this.signal=new Gb(ew(ew({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Nm.RESET_SIGNAL,Lm.websocket)
/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */}}!function(){var t;function n(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}var r,i="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},o=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof e&&e];for(var n=0;n<t.length;++n){var r=t[n];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function s(e,t){if(t)e:{var n=o;e=e.split(".");for(var r=0;r<e.length-1;r++){var s=e[r];if(!(s in n))break e;n=n[s]}(t=t(r=n[e=e[e.length-1]]))!=r&&null!=t&&i(n,e,{configurable:!0,writable:!0,value:t})}}function a(e){return(e={next:e})[Symbol.iterator]=function(){return this},e}function c(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:n(e)}}if(s("Symbol",(function(e){function t(e,t){this.A=e,i(this,"description",{configurable:!0,writable:!0,value:t})}if(e)return e;t.prototype.toString=function(){return this.A};var n="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",r=0;return function e(i){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new t(n+(i||"")+"_"+r++,i)}})),s("Symbol.iterator",(function(e){if(e)return e;e=Symbol("Symbol.iterator");for(var t="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),r=0;r<t.length;r++){var s=o[t[r]];"function"==typeof s&&"function"!=typeof s.prototype[e]&&i(s.prototype,e,{configurable:!0,writable:!0,value:function(){return a(n(this))}})}return e})),"function"==typeof Object.setPrototypeOf)r=Object.setPrototypeOf;else{var u;e:{var l={};try{l.__proto__={a:!0},u=l.a;break e}catch(t){}u=!1}r=u?function(e,t){if(e.__proto__=t,e.__proto__!==t)throw new TypeError(e+" is not extensible");return e}:null}var A=r;function h(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function d(e){if(e.m)throw new TypeError("Generator is already running");e.m=!0}function p(e,t){return e.h=3,{value:t}}function f(e){this.g=new h,this.G=e}function g(e,t,n,r){try{var i=t.call(e.g.j,n);if(!(i instanceof Object))throw new TypeError("Iterator result "+i+" is not an object");if(!i.done)return e.g.m=!1,i;var o=i.value}catch(t){return e.g.j=null,e.g.s(t),m(e)}return e.g.j=null,r.call(e.g,o),m(e)}function m(e){for(;e.g.h;)try{var t=e.G(e.g);if(t)return e.g.m=!1,{value:t.value,done:!1}}catch(t){e.g.v=void 0,e.g.s(t)}if(e.g.m=!1,e.g.l){if(t=e.g.l,e.g.l=null,t.F)throw t.D;return{value:t.return,done:!0}}return{value:void 0,done:!0}}function v(e){this.next=function(t){return e.o(t)},this.throw=function(t){return e.s(t)},this.return=function(t){return function(e,t){d(e.g);var n=e.g.j;return n?g(e,"return"in n?n.return:function(e){return{value:e,done:!0}},t,e.g.return):(e.g.return(t),m(e))}(e,t)},this[Symbol.iterator]=function(){return this}}function y(e,t){return t=new v(new f(t)),A&&e.prototype&&A(t,e.prototype),t}if(h.prototype.o=function(e){this.v=e},h.prototype.s=function(e){this.l={D:e,F:!0},this.h=this.C||this.u},h.prototype.return=function(e){this.l={return:e},this.h=this.u},f.prototype.o=function(e){return d(this.g),this.g.j?g(this,this.g.j.next,e,this.g.o):(this.g.o(e),m(this))},f.prototype.s=function(e){return d(this.g),this.g.j?g(this,this.g.j.throw,e,this.g.o):(this.g.s(e),m(this))},s("Array.prototype.entries",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,r=!1,i={next:function(){if(!r&&n<e.length){var i=n++;return{value:t(i,e[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,(function(e,t){return[e,t]}))}})),"undefined"!=typeof Blob&&("undefined"==typeof FormData||!FormData.prototype.keys)){var _=function(e,t){for(var n=0;n<e.length;n++)t(e[n])},E=function(e){return e.replace(/\r?\n|\r/g,"\r\n")},b=function(e,t,n){return t instanceof Blob?(n=void 0!==n?String(n+""):"string"==typeof t.name?t.name:"blob",t.name===n&&"[object Blob]"!==Object.prototype.toString.call(t)||(t=new File([t],n)),[String(e),t]):[String(e),String(t)]},w=function(e,t){if(e.length<t)throw new TypeError(t+" argument required, but only "+e.length+" present.")},S="object"==typeof globalThis?globalThis:"object"==typeof window?window:"object"==typeof self?self:this,T=S.FormData,C=S.XMLHttpRequest&&S.XMLHttpRequest.prototype.send,R=S.Request&&S.fetch,I=S.navigator&&S.navigator.sendBeacon,O=S.Element&&S.Element.prototype,x=S.Symbol&&Symbol.toStringTag;x&&(Blob.prototype[x]||(Blob.prototype[x]="Blob"),"File"in S&&!File.prototype[x]&&(File.prototype[x]="File"));try{new File([],"")}catch(t){S.File=function(e,t,n){return e=new Blob(e,n||{}),Object.defineProperties(e,{name:{value:t},lastModified:{value:+(n&&void 0!==n.lastModified?new Date(n.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),x&&Object.defineProperty(e,x,{value:"File"}),e}}var N=function(e){return e.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},B=function(e){this.i=[];var t=this;e&&_(e.elements,(function(e){if(e.name&&!e.disabled&&"submit"!==e.type&&"button"!==e.type&&!e.matches("form fieldset[disabled] *"))if("file"===e.type){var n=e.files&&e.files.length?e.files:[new File([],"",{type:"application/octet-stream"})];_(n,(function(n){t.append(e.name,n)}))}else"select-multiple"===e.type||"select-one"===e.type?_(e.options,(function(n){!n.disabled&&n.selected&&t.append(e.name,n.value)})):"checkbox"===e.type||"radio"===e.type?e.checked&&t.append(e.name,e.value):(n="textarea"===e.type?E(e.value):e.value,t.append(e.name,n))}))};if((t=B.prototype).append=function(e,t,n){w(arguments,2),this.i.push(b(e,t,n))},t.delete=function(e){w(arguments,1);var t=[];e=String(e),_(this.i,(function(n){n[0]!==e&&t.push(n)})),this.i=t},t.entries=function e(){var t,n=this;return y(e,(function(e){if(1==e.h&&(t=0),3!=e.h)return t<n.i.length?e=p(e,n.i[t]):(e.h=0,e=void 0),e;t++,e.h=2}))},t.forEach=function(e,t){w(arguments,1);for(var n=c(this),r=n.next();!r.done;r=n.next()){var i=c(r.value);r=i.next().value,i=i.next().value,e.call(t,i,r,this)}},t.get=function(e){w(arguments,1);var t=this.i;e=String(e);for(var n=0;n<t.length;n++)if(t[n][0]===e)return t[n][1];return null},t.getAll=function(e){w(arguments,1);var t=[];return e=String(e),_(this.i,(function(n){n[0]===e&&t.push(n[1])})),t},t.has=function(e){w(arguments,1),e=String(e);for(var t=0;t<this.i.length;t++)if(this.i[t][0]===e)return!0;return!1},t.keys=function e(){var t,n,r,i=this;return y(e,(function(e){if(1==e.h&&(t=c(i),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,p(e,c(r).next().value));n=t.next(),e.h=2}))},t.set=function(e,t,n){w(arguments,2),e=String(e);var r=[],i=b(e,t,n),o=!0;_(this.i,(function(t){t[0]===e?o&&(o=!r.push(i)):r.push(t)})),o&&r.push(i),this.i=r},t.values=function e(){var t,n,r,i,o=this;return y(e,(function(e){if(1==e.h&&(t=c(o),n=t.next()),3!=e.h)return n.done?void(e.h=0):(r=n.value,(i=c(r)).next(),p(e,i.next().value));n=t.next(),e.h=2}))},B.prototype._asNative=function(){for(var e=new T,t=c(this),n=t.next();!n.done;n=t.next()){var r=c(n.value);n=r.next().value,r=r.next().value,e.append(n,r)}return e},B.prototype._blob=function(){var e="----formdata-polyfill-"+Math.random(),t=[],n="--"+e+'\r\nContent-Disposition: form-data; name="';return this.forEach((function(e,r){return"string"==typeof e?t.push(n+N(E(r))+'"\r\n\r\n'+E(e)+"\r\n"):t.push(n+N(E(r))+'"; filename="'+N(e.name)+'"\r\nContent-Type: '+(e.type||"application/octet-stream")+"\r\n\r\n",e,"\r\n")})),t.push("--"+e+"--"),new Blob(t,{type:"multipart/form-data; boundary="+e})},B.prototype[Symbol.iterator]=function(){return this.entries()},B.prototype.toString=function(){return"[object FormData]"},O&&!O.matches&&(O.matches=O.matchesSelector||O.mozMatchesSelector||O.msMatchesSelector||O.oMatchesSelector||O.webkitMatchesSelector||function(e){for(var t=(e=(this.document||this.ownerDocument).querySelectorAll(e)).length;0<=--t&&e.item(t)!==this;);return-1<t}),x&&(B.prototype[x]="FormData"),C){var L=S.XMLHttpRequest.prototype.setRequestHeader;S.XMLHttpRequest.prototype.setRequestHeader=function(e,t){L.call(this,e,t),"content-type"===e.toLowerCase()&&(this.B=!0)},S.XMLHttpRequest.prototype.send=function(e){e instanceof B?(e=e._blob(),this.B||this.setRequestHeader("Content-Type",e.type),C.call(this,e)):C.call(this,e)}}R&&(S.fetch=function(e,t){return t&&t.body&&t.body instanceof B&&(t.body=t.body._blob()),R.call(this,e,t)}),I&&(S.navigator.sendBeacon=function(e,t){return t instanceof B&&(t=t._asNative()),I.call(this,e,t)}),S.FormData=B}}();const rw=()=>{const e=df("AREAS");return 0===e.length&&e.push(Qm.GLOBAL),Gn(e).call(e,((e,t,n)=>{const r=iw(t);return r?0===n?r:"".concat(e,",").concat(r):e}),"")},iw=e=>e===Qm.OVERSEA?"".concat(Wm.ASIA,",").concat(Wm.EUROPE,",").concat(Wm.AFRICA,",").concat(Wm.NORTH_AMERICA,",").concat(Wm.SOUTH_AMERICA,",").concat(Wm.OCEANIA):Wm[e],ow=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map((e=>{const n=zm[e],r=Object.keys(n);r&&r.map((e=>{"CODE"!==e&&(t[e]=t[e].concat(n[e]))}))})),t},sw={GLOBAL:{ASIA:[Qm.CHINA,Qm.JAPAN,Qm.INDIA,Qm.KOREA,Qm.HKMC],EUROPE:[],NORTH_AMERICA:[Qm.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},aw=Object.keys(sw[Qm.GLOBAL]),cw=[Qm.CHINA,Qm.NORTH_AMERICA,Qm.EUROPE,Qm.ASIA,Qm.JAPAN,Qm.INDIA,Qm.OCEANIA,Qm.SOUTH_AMERICA,Qm.AFRICA,Qm.KOREA,Qm.HKMC,Qm.US],uw=function(e,t){let n=[];if(e.includes(Qm.GLOBAL)){const o=[Qm.GLOBAL,Qm.OVERSEA],s=Object.keys(zm);if(t===Qm.GLOBAL)throw new Qp(Vp.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===Qm.CHINA)n=[Qm.OVERSEA];else if(i=t,aw.includes(i)){const e=(r=t,sw[Qm.GLOBAL][r]||[]),i=[...o,t,...e];n=s.filter((e=>!i.includes(e)))}else if(function(e){let t=!1;return aw.forEach((n=>{sw[Qm.GLOBAL][n].includes(e)&&(t=!0)})),t}(t)){const e=function(e){let t;return aw.forEach((n=>{sw[Qm.GLOBAL][n].includes(e)&&(t=n)})),t}(t),r=[...o,e,t];n=s.filter((e=>!r.includes(e)))}else n=e;n=function(e){const t=[];return cw.forEach((n=>{e.includes(n)&&t.push(n)})),t.concat(e.filter((e=>!cw.includes(e))))}(n)}else n=e;var r,i;return n};function lw(e){if(!e&&df("AREAS").includes(Qm.EXTENSIONS))return Jp.debug("update area from ap : reset"),void Aw(tf,!0);if(!df("AREAS").includes(Qm.GLOBAL)||!e)return;let t=zm.EXTENSIONS;t&&(t={CODE:iw(Qm.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},Jp.debug("update area from ap success: ".concat(e,",config is "),t),hf("AREAS",[Qm.EXTENSIONS],!0),Object.keys(t).map((e=>{hf(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?t[e][0]:t[e])})))}function Aw(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=Zy.reportApiInvoke(null,{name:Ug.SET_AREA,options:e,tag:Fg.TRACER});try{let r=[];if("string"==typeof e&&(r=[e]),Array.isArray(e)&&(e.forEach((e=>{if(!Km.includes(e))throw new Qp(Vp.INVALID_PARAMS,"invalid area code")})),r=e),"[object Object]"===Object.prototype.toString.call(e)){const{areaCode:t,excludedArea:n}=e;if(!t)throw new Qp(Vp.INVALID_PARAMS,"area code is needed");let i=t;"string"==typeof t&&(i=[t]),r=n?uw(i,n):i}if(!t){if(ff.AREAS){const e=new Qp(Vp.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(e),void Jp.warning("setArea is prohibited because of config-distribute")}if(r.includes(Qm.GLOBAL)&&df("AREAS")===Qm.EXTENSIONS){const e=new Qp(Vp.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(e),void Jp.warning("setArea is prohibited because of ap extensions")}}hf("AREAS",r,t);const i=ow(r);Object.keys(i).map((e=>{hf(e,"LOG_UPLOAD_SERVER"===e||"EVENT_REPORT_DOMAIN"===e||"EVENT_REPORT_BACKUP_DOMAIN"===e||"PROXY_SERVER_TYPE3"===e?i[e][0]:i[e])})),Jp.debug("set area success:",r.join(","))}catch(e){throw n.onError(e),e}n.onSuccess()}function hw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?hw(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):hw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let pw=1;let fw=1;function gw(e,t,n,r){let{url:i,areaCode:o}=e;const s=Date.now();let a;const[c,u]=_w(t,o,[yv.CHOOSE_SERVER]);let l=Qy.networkState;return Kp((async()=>{l&&Qy.networkState===nv.OFFLINE&&Qy.onlineWaiter&&await Zl.race([Qy.onlineWaiter,pb(r&&r.maxRetryTimeout||jp.maxRetryTimeout)]),l=Qy.networkState;const{data:e,headers:o}=await Hy(i,{data:c,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);a="1"===o.http3?1:-1,Zy.reportResourceTiming(i,t.sid),vw(e,i,t,s,[yv.CHOOSE_SERVER],a);const u=ab(e,yv.CHOOSE_SERVER);return yw(u),rb(u,i)}),(e=>(e&&Zy.joinChooseServer(t.sid,{lts:s,succ:!0,csAddr:i,opid:u,serverList:e.gatewayAddrs.map((e=>e.address)),ec:null,cid:e.cid.toString(),uid:e.uid.toString(),csIp:e.csIp,unilbsServerIds:[yv.CHOOSE_SERVER].toString(),isHttp3:a}),!1)),(e=>e.code!==Vp.OPERATION_ABORTED&&(e.code===Vp.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(Zy.joinChooseServer(t.sid,{lts:s,succ:!1,csAddr:i,serverList:null,opid:u,ec:e.code,csIp:e.data&&e.data.csIp,unilbsServerIds:[yv.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:l}),isHttp3:a}),Jp.warning("[".concat(t.clientId,"] Choose server network error, retry"),e),!0))),r)}function mw(e,t,n,r){let i,{url:o,areaCode:s,serviceIds:a}=e;const c=Date.now(),[u,l]=_w(t,s,a);let A;return Kp((async()=>{A&&Qy.networkState===nv.OFFLINE&&Qy.onlineWaiter&&await Zl.race([Qy.onlineWaiter,pb(r&&r.maxRetryTimeout||jp.maxRetryTimeout)]),A=Qy.networkState;const{data:e,headers:s}=await Hy(o,{data:u,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);i="1"===s.http3?1:-1,Zy.reportResourceTiming(o,t.sid),vw(e,o,t,c,a,i);const l=ab(e,yv.CHOOSE_SERVER),h=ab(e,"proxy5"===t.cloudProxyServer?yv.CLOUD_PROXY_5:"proxy3"===t.cloudProxyServer||"proxy4"===t.cloudProxyServer?yv.CLOUD_PROXY:yv.CLOUD_PROXY_FALLBACK);return yw(l),{gatewayInfo:rb(l,o),proxyInfo:h,url:o}}),(e=>(e.gatewayInfo&&Zy.joinChooseServer(t.sid,{lts:c,succ:!0,csAddr:o,serverList:e.gatewayInfo.gatewayAddrs.map((e=>e.address)),ec:null,opid:l,cid:e.gatewayInfo.cid.toString(),uid:e.gatewayInfo.uid.toString(),csIp:e.gatewayInfo.csIp,unilbsServerIds:a.toString(),isHttp3:i}),e.proxyInfo&&Zy.joinWebProxyAP(t.sid,{lts:c,sucess:1,apServerAddr:o,turnServerAddrList:e.proxyInfo.addresses.map((e=>e.ip)).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:a.toString()}),!1)),(e=>e.code!==Vp.OPERATION_ABORTED&&(e.code===Vp.CAN_NOT_GET_GATEWAY_SERVER?e.data.retry:(Zy.joinWebProxyAP(t.sid,{lts:c,sucess:0,apServerAddr:o,turnServerAddrList:null,errorCode:e.code,eventType:t.cloudProxyServer,unilbsServerIds:a.toString(),extend:JSON.stringify({networkState:A})}),Jp.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),e),!0))),r)}const vw=(e,t,n,r,i,o)=>{const s=[],a=s=>{4096===s.flag?Zy.joinChooseServer(n.sid,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:s.error.message,csIp:s.error.data&&s.error.data.csIp,unilbsServerIds:i.toString(),isHttp3:o}):1048576!==s.flag&&4194304!==s.flag&&4194310!==s.flag||Zy.joinWebProxyAP(n.sid,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:s.error.code,eventType:n.cloudProxyServer,unilbsServerIds:i.toString()})};if(e.response_body.forEach((t=>{const n=t.buffer.code;if(23===t.uri&&0===n&&!t.buffer.edges_services)if(4194310===t.buffer.flag)Jp.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),t.buffer.edges_services=[];else{const n={error:new Qp(Vp.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:t.buffer.flag};s.push(n),a(n)}if(0!==n){const r=Ub(n),i={error:new Qp(Vp.CAN_NOT_GET_GATEWAY_SERVER,r.desc,{desc:r.desc,retry:r.retry,csIp:e.detail[502]}),flag:t.buffer.flag};4194310===t.buffer.flag?Jp.warning(i.error.toString()):s.push(i),a(i)}})),s.length)throw Jp.warning("[".concat(n.clientId,"] multi unilbs ").concat(t," failed, ").concat(s.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message,", retry: ").concat(e.error.data.retry))).join(" | "))),new Qp(Vp.CAN_NOT_GET_GATEWAY_SERVER,s.map((e=>"flag: ".concat(e.flag,", message: ").concat(e.error.message))).join(" | "),{retry:!!s.find((e=>e.error.data.retry)),csIp:e.detail[502],desc:[...new Set(s.map((e=>{var t,n;return null==e||null===(t=e.error)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.desc})).filter((e=>!!e)))]})},yw=e=>{var t,n,r,i;if(e.addresses&&0===e.addresses.length&&0===e.code)throw new Qp(Vp.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(df("AP_AREA")&&(null!==(r=e.detail)&&void 0!==r&&r[23]&&"string"==typeof(null===(i=e.detail)||void 0===i?void 0:i[23])?lw(e.detail[23].toLowerCase()):lw()),null!==(t=e.detail)&&void 0!==t&&t[19]&&"string"==typeof(null===(n=e.detail)||void 0===n?void 0:n[19])){const t=e.detail[19],n=null==t?void 0:t.split(";");for(let t=0;t<n.length;t++){var o;const r=YA(o=n[t]).call(o);e.addresses[t]&&n&&(e.addresses[t].fingerprint=r)}}if(df("GATEWAY_ADDRESS")&&df("GATEWAY_ADDRESS").length>0){Jp.debug("assign gateway address to",df("GATEWAY_ADDRESS"));const t=df("GATEWAY_ADDRESS").map((t=>{var n,r;const i=null!==(n=null===(r=e.addresses.find((e=>e.ip===t.ip&&e.port===t.port)))||void 0===r?void 0:r.fingerprint)&&void 0!==n?n:"";return{ip:t.ip,port:t.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:i}}));e.addresses=t}},_w=(e,t,n)=>{const r=Math.floor(Math.random()*10**12),i={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:{6:e.stringUid,11:t,12:df("USE_NEW_TOKEN")?"1":void 0,22:t},key:e.token,service_ids:n,uid:e.uid||0}}]};i.request_bodies.forEach((t=>{e.multiIP&&e.multiIP.gateway_ip&&(t.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))}));const o=new FormData;return o.append("request",JSON.stringify(i)),[o,r]};let Ew=0;async function bw(e,t,n,r){const i=async function(e,t,n,r){let i=null;const o=[],s=async()=>{const i=df("WEBCS_DOMAIN").slice(0,df("AJAX_REQUEST_CONCURRENT")).map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:rw()}))),s=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),a=await Mb({fragementLength:df("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(Jp.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),gw(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),a},a=async()=>{if(await pb(1e3),null!==i)return i;const s=df("WEBCS_DOMAIN_BACKUP_LIST").map((t=>({url:e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2"),areaCode:rw()}))),a=r.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:s.map((e=>e.url))}),c=await Mb({fragementLength:df("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:r=>(Jp.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),gw(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},a),e[0]},promisesCollector:o});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},a),c};try{return i=await _b([s(),a()]),o.length&&o.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),i}catch(e){throw e[0]}}(e,t,n,r);return{gatewayInfo:await i}}async function ww(e,t,n,r,i){const o=e.cloudProxyServer;if("disabled"===o){if(!r)return;if(e.useLocalAccessPoint)return await bw(e,t,n,i);if(df("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:r,proxyInfo:o}=await Tw(e,t,n,i);return e.turnServer&&"auto"!==e.turnServer.mode||(e.turnServer={mode:"manual",servers:o.map((e=>({turnServerURL:e.address,tcpport:e.tcpport||nf.tcpport,udpport:e.udpport||nf.udpport,username:e.username||nf.username,password:e.password||nf.password,forceturn:!1,security:!0})))}),{gatewayInfo:r}}return await bw(e,t,n,i)}const{proxyInfo:s,gatewayInfo:a}=await Tw(e,t,n,i),c={gatewayInfo:a};return e.turnServer={mode:"manual",servers:s.map((e=>({turnServerURL:e.address,tcpport:"proxy3"===o?void 0:e.tcpport?e.tcpport:nf.tcpport,udpport:"proxy4"===o?void 0:e.udpport?e.udpport:nf.udpport,username:e.username||nf.username,password:e.password||nf.password,forceturn:"proxy4"!==o,security:"proxy5"===o})))},Jp.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(o)),c}async function Sw(e,t,n,r,i){const o=df("ACCOUNT_REGISTER").slice(0,df("AJAX_REQUEST_CONCURRENT"));let s=[];s=t.proxyServer?o.map((e=>"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1"))):o.map((e=>"https://".concat(e,"/api/v1")));const a=null==i?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:s});try{const o=await async function(e,t,n,r,i){const o=Date.now(),s={sid:n.sid,opid:10,appid:n.appId,string_uid:t};let a=e[0];const c=await Kp((()=>Hy(a+"".concat(-1===a.indexOf("?")?"?":"&","action=stringuid"),{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}})),((n,r)=>{if(0===n.code){if(n.uid<=0||n.uid>=Math.pow(2,32))throw Jp.error("Invalid Uint Uid ".concat(t," => ").concat(n.uid),n),Zy.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:Vp.INVALID_UINT_UID_FROM_STRING_UID,extend:s}),new Qp(Vp.INVALID_UINT_UID_FROM_STRING_UID);return Zy.reqUserAccount(s.sid,{lts:o,success:!0,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:null,extend:s}),!1}const i=Ub(n.code);return i.retry&&(a=e[(r+1)%e.length]),Zy.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:n.uid,errorCode:i.desc,extend:s}),i.retry}),((t,n)=>t.code!==Vp.OPERATION_ABORTED&&(Zy.reqUserAccount(s.sid,{lts:o,success:!1,serverAddr:a,stringUid:s.string_uid,uid:null,errorCode:t.code,extend:s}),a=e[(n+1)%e.length],!0)),i);if(0!==c.code){const e=Ub(c.code);throw new Qp(Vp.UNEXPECTED_RESPONSE,e.desc)}return c}(s,e,t,n,r);return null==i||i.recordJoinChannelService({status:"success",endTs:Date.now()},a),o.uid}catch(e){throw null==i||i.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[e]},a),e}}async function Tw(e,t,n,r){const i=df("PROXY_SERVER_TYPE3"),o=(e,t,n)=>{let r=n||i;return Array.isArray(r)&&(r=t%2==0?i[1]:i[0]),"https://".concat(r,"/ap/?url=").concat(e)};let s=null;const a=[],c=async()=>{const i=df("WEBCS_DOMAIN").slice(0,df("AJAX_REQUEST_CONCURRENT")).map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:rw(),serviceIds:[yv.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?yv.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?yv.CLOUD_PROXY:yv.CLOUD_PROXY_FALLBACK]}})),s=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),c=await Mb({fragementLength:df("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(Jp.debug("[".concat(e.clientId,"] Connect to choose_server:"),r.url),mw(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},s),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},s),c},u=async()=>{if(await pb(1e3),null!==s)return s;const i=df("WEBCS_DOMAIN_BACKUP_LIST").map(((t,n)=>{let r;return r="disabled"===e.cloudProxyServer&&e.proxyServer?o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n,e.proxyServer):"disabled"===e.cloudProxyServer||"fallback"===e.cloudProxyServer?"https://".concat(t,"/api/v2/transpond/webrtc?v=2"):o("".concat(t,"/api/v2/transpond/webrtc?v=2"),n),{url:r,areaCode:rw(),serviceIds:[yv.CHOOSE_SERVER,"proxy5"===e.cloudProxyServer?yv.CLOUD_PROXY_5:"proxy3"===e.cloudProxyServer||"proxy4"===e.cloudProxyServer?yv.CLOUD_PROXY:yv.CLOUD_PROXY_FALLBACK]}})),c=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:i.map((e=>e.url))}),u=await Mb({fragementLength:df("FRAGEMENT_LENGTH"),referenceList:i,asyncMapHandler:r=>(Jp.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),r.url),mw(r,e,t,n)),allFailedhandler:e=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:e},c),e[0]},promisesCollector:a});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},c),u};let l,A,h;try{({gatewayInfo:l,proxyInfo:A,url:h}=await _b([c(),u()]))}catch(e){throw e[0]}if(a.length&&a.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),!l||!A)throw new Qp(Vp.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=h,"disabled"!==e.cloudProxyServer&&Array.isArray(i)&&h){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(h)[1];i.includes(t)&&(e.proxyServer=t,Jp.setProxyServer(t),Zy.setProxyServer(t))}return s={gatewayInfo:l,proxyInfo:await cb(A,l.uid)},s}async function Cw(e,t,n,r){const i=df("UAP_AP").slice(0,df("AJAX_REQUEST_CONCURRENT")).map((e=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(e+"/api/v1?action=uap"):"https://".concat(e,"/api/v1?action=uap")));return await function(e,t,n,r,i){pw+=1;const o={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:pw,requestId:pw,version:$p,cname:n.cname},s={service_name:t,json_body:JSON.stringify(o)};let a,c,u=e[0];return Kp((async()=>{a=Date.now();const e=await Hy(u,{data:s,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(c=Date.now()-a,0!==e.code){const t=new Qp(Vp.UNEXPECTED_RESPONSE,"live streaming ap error, code"+e.code,{retry:!0,responseTime:c});throw Jp.error(t.toString()),t}const n=JSON.parse(e.json_body);if(200!==n.code){const e=new Qp(Vp.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(n.code,", reason: ").concat(n.reason),{code:n.code,responseTime:c});throw Jp.error(e.toString()),e}if(!n.servers||0===n.servers.length){const e=new Qp(Vp.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:n.code,responseTime:c});throw Jp.error(e.toString()),e}const i=function(e,t){return{addressList:e.servers.map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(df("WORKER_DOMAIN"),":").concat(e.wss,"?serviceName=").concat(encodeURIComponent(t)))),workerToken:e.workerToken,vid:e.vid}}(n,t);return df("LIVE_STREAMING_ADDRESS")&&(i.addressList=df("LIVE_STREAMING_ADDRESS")instanceof Array?df("LIVE_STREAMING_ADDRESS"):[df("LIVE_STREAMING_ADDRESS")]),dw(dw({},i),{},{responseTime:c})}),((r,i)=>(Zy.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(r.addressList),firstSuccess:0===i,responseTime:c,serverIp:e[i%e.length]}),!1)),((r,i)=>(Zy.apworkerEvent(n.sid,{success:!1,sc:r.data&&r.data.code||200,serviceName:t,responseTime:c,serverIp:e[i%e.length]}),!!(r.code!==Vp.OPERATION_ABORTED&&r.code!==Vp.UNEXPECTED_RESPONSE||r.data&&r.data.retry)&&(u=e[(i+1)%e.length],!0))),i)}(i,e,t,n,r)}async function Rw(e,t,n){let r=null;const i=[],o=async o=>{const s=df(o?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v2/transpond/webrtc?v=2"):"https://".concat(t,"/api/v2/transpond/webrtc?v=2")));return o&&(await pb(1e3),null!==r)?r:await Mb({fragementLength:df("FRAGEMENT_LENGTH"),referenceList:s,asyncMapHandler:r=>(Jp.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(o?"backup":""," choose_server:"),r),function(e,t,n,r){const[i]=((e,t)=>{const n=Math.floor(Math.random()*10**12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map((e=>({ip:e.ip,port:e.port})))}}]},i=new FormData;return i.append("request",JSON.stringify(r)),[i,n]})(t,[yv.CHOOSE_SERVER]);let o=Qy.networkState;return Kp((async()=>{o&&Qy.networkState===nv.OFFLINE&&Qy.onlineWaiter&&await Zl.race([Qy.onlineWaiter,pb(r&&r.maxRetryTimeout||jp.maxRetryTimeout)]),o=Qy.networkState;return((e,t)=>{if(e.response_body&&e.response_body.length){const t=e.response_body[0];if(0!==t.buffer.code){const e=Ub(t.buffer.code);throw new Qp(Vp.UPDATE_TICKET_FAILED,"[".concat(t.buffer.code,"]: ").concat(e.desc),{retry:e.retry})}return t.buffer.ticket}throw Jp.debug("update ticket request received ap response without response body:",t),new Qp(Vp.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})})(await Hy(e,{data:i,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0),e)}),(()=>!1),(e=>e.code!==Vp.OPERATION_ABORTED&&(e.code===Vp.UPDATE_TICKET_FAILED?e.data.retry:(Jp.warning("[".concat(t.clientId,"] update ticket network error, retry"),e),!0))),r)}(r,e,t,n)),allFailedhandler:e=>{throw e[0]},promisesCollector:i})};try{return r=await _b([o(!1),o(!0)]),i.length&&i.forEach((e=>e.cancel&&"function"==typeof e.cancel&&e.cancel())),r}catch(e){throw e[0]}}function Iw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ow(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Iw(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Iw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class xw extends Fp{constructor(){super(),Kh(this,"configs",void 0),Kh(this,"joinInfo",void 0),Kh(this,"cancelToken",void 0),Kh(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Kh(this,"interval",void 0),Kh(this,"mutex",new n_("config-distribute")),Kh(this,"mutableParamsRead",!1)}startGetConfigDistribute(e,t){this.joinInfo=e,this.cancelToken=t,this.interval&&this.stopGetConfigDistribute(),df("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval((()=>{this.updateConfigDistribute()}),df("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,Zy.reportApiInvoke(null,{options:void 0,name:Ug.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Fg.TRACER}).onSuccess(JSON.stringify(ff))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void Jp.debug("[config-distribute] get config distribute interrupted have no joininfo");let e;const t=await this.mutex.lock();try{e=await async function(e,t,n){const r=df("CDS_AP").slice(0,df("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1"):"https://".concat(t,"/api/v1?action=config"))).map((r=>function(e,t,n,r){const i=gh(),o={flag:64,cipher_method:0,features:{device:i.name,system:i.os,system_general:navigator.userAgent,vendor:t.appId,version:$p,cname:t.cname,sid:t.sid,session_id:t.sid,detail:"",proxyServer:t.proxyServer}};return Kp((()=>Hy(e,{data:o,timeout:1e3,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}})),void 0,(e=>e.code!==Vp.OPERATION_ABORTED),r)}(r,e,t,n)));let i=null,o=null,s={};try{i=await _b(r)}catch(e){if(e.code===Vp.OPERATION_ABORTED)throw e;o=e}if(r.forEach((e=>e.cancel())),Zy.reportApiInvoke(e.sid,{name:Ug.REQUEST_CONFIG_DISTRIBUTE,options:{error:o,res:i}}).onSuccess(),i&&i.test_tags)try{s=function(e){if(!e.test_tags)return{};const t=e.test_tags,n=Object.keys(t),r={};return n.forEach((e=>{var n;const i=YA(n=e.slice(4)).call(n),o=JSON.parse(t[e])[1];r[i]=o})),r}(i)}catch(e){}return s}(this.joinInfo,this.cancelToken,this.retryConfig),Jp.debug("[config-distribute] get config distribute",JSON.stringify(e)),e.limit_bitrate&&this.handleBitrateLimit(e.limit_bitrate),this.cacheGlobalParameterConfig(e),this.configs=e}catch(e){const t=new Qp(Vp.NETWORK_RESPONSE_ERROR,e);Jp.warning("[config-distribute] ".concat(t.toString()))}finally{t()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(e){var t;(t=e)&&t.uplink&&t.id&&void 0!==t.uplink.max_bitrate&&void 0!==t.uplink.min_bitrate&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==e.id&&this.emit(qm.UPDATE_BITRATE_LIMIT,e):this.emit(qm.UPDATE_BITRATE_LIMIT,e))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&Ow({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(e){var t;const n=fg(t=Object.keys(e).filter((e=>/^webrtc_ng_global_parameter/.test(e)))).call(t);for(let t=0;t<n.length;t++)for(let r=n.length-1;r>t;r--){const t=n[r];if("number"==typeof e[t].__priority){const i=e[t].__priority,o=n[r-1];if("number"==typeof e[o].__priority){if(!(i>e[o].__priority))continue;{const e=t;n[r]=n[r-1],n[r-1]=e}}else{const e=t;n[r]=n[r-1],n[r-1]=e}}}const r={};n.forEach((t=>{const n=e[t],i=n.__expires;Object.keys(n).forEach((e=>{"__priority"===e||"__expires"===e||Object.prototype.hasOwnProperty.call(r,e)||(r[e]=Ow({value:n[e]},i&&{expires:i}))}))}));try{const e=JSON.stringify(r),t=window.btoa(e);window.localStorage.setItem("websdk_ng_global_parameter",t),Jp.debug("Caching global parameters ".concat(e))}catch(e){Jp.error("Error caching global parameters:",e.message)}}}function Nw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Bw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nw(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Lw extends Fp{constructor(e,t,n,r){super(),Kh(this,"spec",void 0),Kh(this,"token",void 0),Kh(this,"websocket",void 0),Kh(this,"pingpongTimer",void 0),Kh(this,"reconnectMode","retry"),Kh(this,"serviceMode",void 0),Kh(this,"reqId",0),Kh(this,"commandReqId",0),Kh(this,"handleWebSocketOpen",(()=>{this.reconnectMode="retry",this.startPingPong()})),Kh(this,"handleWebSocketMessage",(e=>{if(!e.data)return;const t=JSON.parse(e.data);t.requestId?this.emit("@".concat(t.requestId,"-").concat(t.sid),t):this.serviceMode===fm.INJECT?this.emit(bm.INJECT_STREAM_STATUS,t):(Zy.workerEvent(this.spec.sid,{actionType:"status",serverCode:t.code,workerType:this.serviceMode===fm.TRANSCODE?1:2}),this.emit(bm.PUBLISH_STREAM_STATUS,t))})),this.spec=t,this.token=e,this.serviceMode=r,this.websocket=new Qb("live-streaming",n),this.websocket.on(pm.CONNECTED,this.handleWebSocketOpen),this.websocket.on(pm.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(pm.REQUEST_NEW_URLS,((e,t)=>{Eb(this,bm.REQUEST_NEW_ADDRESS).then(e).catch(t)})),this.websocket.on(pm.RECONNECTING,(()=>{this.websocket.reconnectMode=this.reconnectMode}))}init(e){return this.websocket.init(e)}async request(e,t,n,r){this.reqId+=1,"request"===e&&(this.commandReqId+=1);const i=this.commandReqId,o=this.reqId;if(!o||!this.websocket)throw new Qp(Vp.UNEXPECTED_ERROR);const s=Bw({command:e,sdkVersion:"4.18.2"===$p?"0.0.1":$p,seq:o,requestId:o,allocate:n,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},t);if("closed"===this.websocket.state)throw new Qp(Vp.WS_DISCONNECT);const a=()=>new Zl(((e,t)=>{this.websocket.once(pm.CLOSED,(()=>t(new Qp(Vp.WS_ABORT)))),this.websocket.once(pm.CONNECTED,e)}));"connected"!==this.websocket.state&&await a(),s.clientRequest&&(s.clientRequest.workerToken=this.token);const c=new Zl(((e,t)=>{const n=()=>{t(new Qp(Vp.WS_ABORT))};this.websocket.once(pm.RECONNECTING,n),this.websocket.once(pm.CLOSED,n),this.once("@".concat(o,"-").concat(this.spec.sid),(t=>{e(t)}))}));r&&Zy.workerEvent(this.spec.sid,Bw(Bw({},r),{},{requestId:i,actionType:"request",payload:JSON.stringify(t.clientRequest),serverCode:0,code:0}));const u=Date.now();this.websocket.sendMessage(s);let l=null;try{l=await c}catch(r){if("closed"===this.websocket.state)throw r;return await a(),await this.request(e,t,n)}return r&&Zy.workerEvent(this.spec.sid,Bw(Bw({},r),{},{requestId:i,actionType:"response",payload:JSON.stringify(l.serverResponse),serverCode:l.code,success:200===l.code,responseTime:Date.now()-u})),200!==l.code&&this.handleResponseError(l),l}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const e="4.18.2"===$p?"0.0.1":$p;this.reqId+=1,"connected"===this.websocket.state?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:e,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(e){switch(e.code){case Sm.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void Jp.warning("live stream response already exists stream");case Sm.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Sm.LIVE_STREAM_RESPONSE_BAD_STREAM:case Sm.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Qp(Vp.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:e.code}).throw();case Sm.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new Qp(Vp.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sm.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Qp(Vp.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:e.code}).throw();case Sm.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const t=new Qp(Vp.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(bm.WARNING,t,e.serverResponse.url)}case Sm.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const t=new Qp(Vp.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(bm.WARNING,t,e.serverResponse.url)}case Sm.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Qp(Vp.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Sm.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Qp(Vp.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:e.code}).throw();case Sm.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const t=new Qp(Vp.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(bm.WARNING,t,e.serverResponse.url)}case Sm.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Qp(Vp.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code}).throw();case Sm.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Qp(Vp.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Sm.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sm.LIVE_STREAM_RESPONSE_WORKER_QUIT:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;throw new Qp(Vp.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sm.ERROR_FAIL_SEND_MESSAGE:if("UnpublishStream"===e.serverResponse.command||"UninjectStream"===e.serverResponse.command)return;if("UpdateTranscoding"===e.serverResponse.command||"ControlStream"===e.serverResponse.command)return new Qp(Vp.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:e.code}).throw();throw new Qp(Vp.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Sm.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sm.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sm.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sm.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Qp(Vp.LIVE_STREAMING_CDN_ERROR,"",{code:e.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval((()=>{"connected"===this.websocket.state&&this.request("ping",{}).catch(vb)}),6e3)}}function Dw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Mw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dw(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Pw extends Fp{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:jp,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:jp;super(),Kh(this,"onLiveStreamWarning",void 0),Kh(this,"onLiveStreamError",void 0),Kh(this,"onInjectStatusChange",void 0),Kh(this,"spec",void 0),Kh(this,"retryTimeout",1e4),Kh(this,"connection",void 0),Kh(this,"httpRetryConfig",void 0),Kh(this,"wsRetryConfig",void 0),Kh(this,"streamingTasks",new Map),Kh(this,"isStartingStreamingTask",!1),Kh(this,"taskMutex",new n_("live-streaming")),Kh(this,"cancelToken",kp.CancelToken.source()),Kh(this,"transcodingConfig",void 0),Kh(this,"injectConfig",Mw({},Em)),Kh(this,"injectLoopTimes",0),Kh(this,"uapResponse",void 0),Kh(this,"lastTaskId",1),Kh(this,"statusError",new Map),this.spec=e,this.httpRetryConfig=n,this.wsRetryConfig=t}async setTranscodingConfig(e){const t=Mw(Mw({},_m),e);66!==t.videoCodecProfile&&77!==t.videoCodecProfile&&100!==t.videoCodecProfile&&(Jp.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(t.videoCodecProfile," -> 100")),t.videoCodecProfile=100),t.transcodingUsers||(t.transcodingUsers=t.userConfigs),t.transcodingUsers&&(t.transcodingUsers=t.transcodingUsers.map((e=>Mw(Mw(Mw({},mm),e),{},{zOrder:e.zOrder?e.zOrder+1:1})))),function(e){Sg(e.width)||vg(e.width,"config.width",0,1e4),Sg(e.height)||vg(e.height,"config.height",0,1e4),Sg(e.videoBitrate)||vg(e.videoBitrate,"config.videoBitrate",1,1e6),Sg(e.videoFrameRate)||vg(e.videoFrameRate,"config.videoFrameRate"),Sg(e.lowLatency)||gg(e.lowLatency,"config.lowLatency"),Sg(e.audioSampleRate)||mg(e.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Sg(e.audioBitrate)||vg(e.audioBitrate,"config.audioBitrate",1,128),Sg(e.audioChannels)||mg(e.audioChannels,"config.audioChannels",[1,2,3,4,5]),Sg(e.videoGop)||vg(e.videoGop,"config.videoGop"),Sg(e.videoCodecProfile)||mg(e.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Sg(e.userCount)||vg(e.userCount,"config.userCount",0,17),Sg(e.backgroundColor)||vg(e.backgroundColor,"config.backgroundColor",0,16777215),Sg(e.userConfigExtraInfo)||_g(e.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),e.transcodingUsers&&!Sg(e.transcodingUsers)&&(Eg(e.transcodingUsers,"config.transcodingUsers"),e.transcodingUsers.forEach(((e,t)=>{wg(e.uid),Sg(e.x)||vg(e.x,"transcodingUser[".concat(t,"].x"),0,1e4),Sg(e.y)||vg(e.y,"transcodingUser[".concat(t,"].y"),0,1e4),Sg(e.width)||vg(e.width,"transcodingUser[".concat(t,"].width"),0,1e4),Sg(e.height)||vg(e.height,"transcodingUser[".concat(t,"].height"),0,1e4),Sg(e.zOrder)||vg(e.zOrder-1,"transcodingUser[".concat(t,"].zOrder"),0,100),Sg(e.alpha)||vg(e.alpha,"transcodingUser[".concat(t,"].alpha"),0,1,!1)}))),Sg(e.watermark)||ym(e.watermark,"watermark"),Sg(e.backgroundImage)||ym(e.backgroundImage,"backgroundImage"),e.images&&!Sg(e.images)&&(Eg(e.images,"config.images"),e.images.forEach(((e,t)=>{ym(e,"images[".concat(t,"]"))})))}(t);const n=[];t.images&&n.push(...t.images.map((e=>Mw(Mw(Mw({},vm),e),{},{zOrder:255})))),t.backgroundImage&&(n.push(Mw(Mw(Mw({},vm),t.backgroundImage),{},{zOrder:0})),delete t.backgroundImage),t.watermark&&(n.push(Mw(Mw(Mw({},vm),t.watermark),{},{zOrder:255})),delete t.watermark),t.images=n,t.transcodingUsers&&(t.userConfigs=t.transcodingUsers.map((e=>Mw({},e))),t.userCount=t.transcodingUsers.length,delete t.transcodingUsers);const r=(t.userConfigs||[]).map((e=>"number"==typeof e.uid?Zl.resolve(e.uid):Sw(e.uid,this.spec,this.cancelToken.token,this.httpRetryConfig)));if((await Zl.all(r)).forEach(((e,n)=>{t.userConfigs&&t.userConfigs[n]&&(t.userConfigs[n].uid=e)})),this.transcodingConfig=t,this.connection)try{var i;const e=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(H_(i=this.streamingTasks).call(i)).map((e=>e.taskId)).join("#")});Jp.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(e.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(e){if(!e.data||!e.data.retry)throw e;e.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach((t=>{Jp.warning("[".concat(this.spec.clientId,"] live streaming receive error"),e.toString(),"try to republish",t.url),this.startLiveStreamingTask(t.url,t.mode,e).then((()=>{Jp.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(t.url," success"))})).catch((e=>{Jp.error("[".concat(this.spec.clientId,"] live streaming republish failed"),t.url,e.toString()),this.onLiveStreamError&&this.onLiveStreamError(t.url,e)}))}))}}setInjectStreamConfig(e,t){this.injectConfig=Object.assign({},this.injectConfig,e),this.injectLoopTimes=t}async startLiveStreamingTask(e,t,n){var r;if(Array.from(H_(r=this.streamingTasks).call(r)).find((e=>e.mode===fm.INJECT))&&t===fm.INJECT)return new Qp(Vp.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&t===fm.TRANSCODE)throw new Qp(Vp.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let i={command:"PublishStream",ts:Date.now(),url:e,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};Jp.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(e,", mode: ").concat(t));const o=await this.taskMutex.lock();if(!this.connection&&n)return void o();if(this.streamingTasks.get(e)&&!n)return o(),new Qp(Vp.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(t))}catch(e){throw o(),e}switch(t){case fm.TRANSCODE:i.transcodingConfig=Mw({},this.transcodingConfig);break;case fm.RAW:break;case fm.INJECT:i={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:e,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(i.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const s=this.lastTaskId++;try{const r=new Zl(((t,r)=>{pb(this.retryTimeout).then((()=>{if(n)return r(n);const t=this.statusError.get(e);return t?(this.statusError.delete(e),r(t)):void 0}))})),a=await Zl.race([this.connection.request("request",{clientRequest:i},!0,{url:e,command:"PublishStream",workerType:t===fm.TRANSCODE?1:2,requestByUser:!n,tid:s.toString()}),r]);this.isStartingStreamingTask=!1,Jp.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(a.code)),this.streamingTasks.set(e,{clientRequest:i,mode:t,url:e,taskId:s}),o()}catch(r){if(o(),this.isStartingStreamingTask=!1,!r.data||!r.data.retry||n)throw r;return r.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(e,t,r)):await this.startLiveStreamingTask(e,t,r)}}stopLiveStreamingTask(e){return new Zl(((t,n)=>{const r=this.streamingTasks.get(e);if(!r||!this.connection)return new Qp(Vp.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const i=r.mode;r.abortTask=()=>{Jp.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(e),t()},this.connection.request("request",{clientRequest:{command:i===fm.INJECT?"UninjectStream":"UnpublishStream",url:r.url}},!1,{url:e,command:"UnPublishStream",workerType:i===fm.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then((n=>{Jp.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(n.code)),this.streamingTasks.delete(e),0===this.streamingTasks.size&&i!==fm.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),t(),i===fm.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(gm.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,e)})).catch(n)}))}async controlInjectStream(e,t,n,r){const i=this.streamingTasks.get(e);if(!i||!this.connection||i.mode!==fm.INJECT)throw new Qp(Vp.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:e,control:t,audioVolume:n,position:r}})).serverResponse}resetAllTask(){var e;const t=Array.from(H_(e=this.streamingTasks).call(e));this.terminate();for(const e of t)this.startLiveStreamingTask(e.url,e.mode).catch((t=>{this.onLiveStreamError&&this.onLiveStreamError(e.url,t)}))}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=kp.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(e){if(this.connection)throw new Qp(Vp.UNEXPECTED_ERROR,"live streaming connection has already connected");const t=await Eb(this,wm.REQUEST_WORKER_MANAGER_LIST,e);return this.uapResponse=t,this.connection=new Lw(t.workerToken,this.spec,this.wsRetryConfig,e),this.connection.on(bm.WARNING,((e,t)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e))),this.connection.on(bm.PUBLISH_STREAM_STATUS,(e=>this.handlePublishStreamServer(e))),this.connection.on(bm.INJECT_STREAM_STATUS,(e=>this.handleInjectStreamServerStatus(e))),this.connection.on(bm.REQUEST_NEW_ADDRESS,((t,n)=>{if(!this.connection)return n(new Qp(Vp.UNEXPECTED_ERROR,"can not get new live streaming address list"));Eb(this,wm.REQUEST_WORKER_MANAGER_LIST,e).then((e=>{this.uapResponse=e,t(e.addressList)})).catch(n)})),await this.connection.init(t.addressList),this.connection}handlePublishStreamServer(e){const t=e.serverStatus&&e.serverStatus.url||"empty_url",n=this.streamingTasks.get(t),r=e.reason;switch(e.code){case Sm.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Sm.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Sm.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Sm.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const r=new Qp(Vp.LIVE_STREAMING_CDN_ERROR,"",{code:e.code});if(n)return Jp.error(r.toString()),this.onLiveStreamError&&this.onLiveStreamError(t,r);if(!this.isStartingStreamingTask)return;this.statusError.set(t,r)}case Sm.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const e=new Qp(Vp.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,r);return this.onLiveStreamWarning&&this.onLiveStreamWarning(t,e)}case Sm.LIVE_STREAM_RESPONSE_WORKER_LOST:case Sm.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var i;if(!this.connection)return;this.connection.tryNextAddress();const t=Array.from(H_(i=this.streamingTasks).call(i));for(const n of t)n.abortTask?n.abortTask():(Jp.warning("[".concat(this.spec.clientId,"] publish stream status code"),e.code,"try to republish",n.url),this.startLiveStreamingTask(n.url,n.mode,new Qp(Vp.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:e.code})).then((()=>{Jp.debug("[".concat(this.spec.clientId,"] republish live stream success"),n.url)})).catch((e=>{Jp.error(e.toString()),this.onLiveStreamError&&this.onLiveStreamError(n.url,e)})));return}}}handleInjectStreamServerStatus(e){const t=Number(e.uid),n=e.serverStatus&&e.serverStatus.url;switch(e.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(gm.INJECT_STREAM_STATUS_START_SUCCESS,t,n));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(gm.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,t,n),void this.streamingTasks.delete(n);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(gm.INJECT_STREAM_STATUS_START_UNAUTHORIZED,t,n),void this.streamingTasks.delete(n);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(gm.INJECT_STREAM_STATUS_BROKEN,t,n),void this.streamingTasks.delete(n);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(gm.INJECT_STREAM_STATUS_START_TIMEOUT,t,n),void this.streamingTasks.delete(n);default:return void Jp.debug("inject stream server status",e)}}hasUrl(e){return this.streamingTasks.has(e)}}class kw{constructor(){Kh(this,"destChannelMediaInfos",new Map),Kh(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(e){jm(e),this.srcChannelMediaInfo=e}addDestChannelInfo(e){jm(e),this.destChannelMediaInfos.set(e.channelName,e)}removeDestChannelInfo(e){bg(e),this.destChannelMediaInfos.delete(e)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function Uw(e){if(!(e instanceof kw))return new Qp(Vp.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();return t?0===n.size?new Qp(Vp.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw():void 0:new Qp(Vp.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw()}class Fw extends Fp{constructor(e,t,n){super(),Kh(this,"ws",void 0),Kh(this,"requestId",1),Kh(this,"heartBeatTimer",void 0),Kh(this,"joinInfo",void 0),Kh(this,"clientId",void 0),Kh(this,"onOpen",(()=>{this.emit("open"),this.startHeartBeatCheck()})),Kh(this,"onClose",(e=>{this.emit("close"),this.dispose()})),Kh(this,"onMessage",(e=>{const t=JSON.parse(e.data);if(!t||"serverResponse"!==t.command||!t.requestId)return t&&"serverStatus"===t.command&&t.serverStatus&&t.serverStatus.command?(this.emit("status",t.serverStatus),void this.emit(t.serverStatus.command,t.serverStatus)):void 0;this.emit("req_".concat(t.requestId),t)})),this.joinInfo=e,this.clientId=t,this.ws=new Qb("cross-channel-".concat(this.clientId),n),this.ws.on(pm.RECONNECTING,(()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")})),this.ws.on(pm.CONNECTED,this.onOpen),this.ws.on(pm.ON_MESSAGE,this.onMessage),this.ws.on(pm.CLOSED,this.onClose)}isConnect(){return"connected"===this.ws.state}sendMessage(e){const t=this.requestId++;return e.requestId=t,e.seq=t,this.ws.sendMessage(e),t}waitStatus(e){return new Zl(((t,n)=>{const r=window.setTimeout((()=>{n(new Qp(Vp.TIMEOUT,"wait status timeout, status: ".concat(e)))}),5e3);this.once(e,(i=>{window.clearTimeout(r),i.state&&0!==i.state?n(new Qp(Vp.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(e))):t(void 0)})),this.once("dispose",(()=>{window.clearTimeout(r),n(new Qp(Vp.WS_ABORT))}))}))}async request(e){if("closed"===this.ws.state)throw new Qp(Vp.WS_DISCONNECT);"connected"!==this.ws.state&&await(()=>new Zl(((e,t)=>{this.ws.once(pm.CLOSED,(()=>t(new Qp(Vp.WS_ABORT)))),this.ws.once(pm.CONNECTED,e)})))();const t=this.sendMessage(e),n=new Zl(((e,n)=>{const r=()=>{n(new Qp(Vp.WS_ABORT))};this.ws.once(pm.RECONNECTING,r),this.ws.once(pm.CLOSED,r),this.once("req_".concat(t),e),pb(3e3).then((()=>{this.removeAllListeners("req_".concat(t)),this.ws.off(pm.RECONNECTING,r),this.ws.off(pm.CLOSED,r),n(new Qp(Vp.TIMEOUT,"cross channel ws request timeout"))}))})),r=await n;if(!r||200!==r.code)throw new Qp(Vp.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(r)));return r}async connect(e){this.ws.removeAllListeners(pm.REQUEST_NEW_URLS),this.ws.on(pm.REQUEST_NEW_URLS,(t=>{t(e)})),await this.ws.init(e)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(e){const t=this.requestId++;return e.requestId=t,this.ws.sendMessage(e),t}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval((()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})}),3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Hw extends Fp{set state(e){e!==this._state&&(e!==Im.RELAY_STATE_FAILURE&&(this.errorCode=Om.RELAY_OK),this.emit("state",e,this.errorCode),this._state=e)}get state(){return this._state}constructor(e,t,n,r,i){super(),Kh(this,"joinInfo",void 0),Kh(this,"sid",void 0),Kh(this,"clientId",void 0),Kh(this,"cancelToken",kp.CancelToken.source()),Kh(this,"workerToken",void 0),Kh(this,"requestId",0),Kh(this,"signal",void 0),Kh(this,"prevChannelMediaConfig",void 0),Kh(this,"httpRetryConfig",void 0),Kh(this,"_resolution",void 0),Kh(this,"_state",Im.RELAY_STATE_IDLE),Kh(this,"errorCode",Om.RELAY_OK),Kh(this,"onStatus",(e=>{Jp.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(e))),e&&e.command&&("onAudioPacketReceived"===e.command&&this.emit("event",Rm.PACKET_RECEIVED_AUDIO_FROM_SRC),"onVideoPacketReceived"===e.command&&this.emit("event",Rm.PACKET_RECEIVED_VIDEO_FROM_SRC),"onSrcTokenPrivilegeDidExpire"===e.command&&(this.errorCode=Om.SRC_TOKEN_EXPIRED,this.state=Im.RELAY_STATE_FAILURE),"onDestTokenPrivilegeDidExpire"===e.command&&(this.errorCode=Om.DEST_TOKEN_EXPIRED,this.state=Im.RELAY_STATE_FAILURE))})),Kh(this,"onReconnect",(async()=>{Jp.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",Rm.NETWORK_DISCONNECTED),this.state=Im.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch((e=>{this.state!==Im.RELAY_STATE_IDLE&&(Jp.error("auto restart channel media relay failed",e.toString()),this.errorCode=Om.SERVER_CONNECTION_LOST,this.state=Im.RELAY_STATE_FAILURE)}))})),this.joinInfo=e,this.clientId=t,this.sid=mb(),this.signal=new Fw(this.joinInfo,this.clientId,n),this.httpRetryConfig=r,this._resolution=i}async startChannelMediaRelay(e){if(this.state!==Im.RELAY_STATE_IDLE)throw new Qp(Vp.INVALID_OPERATION);this.state=Im.RELAY_STATE_CONNECTING,await this.connect(),Jp.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(e)}catch(e){if(e.data&&e.data.serverResponse&&"SetSourceChannel"===e.data.serverResponse.command)throw new Qp(Vp.CROSS_CHANNEL_FAILED_JOIN_SRC);if(e.data&&e.data.serverResponse&&"SetDestChannelStatus"===e.serverResponse.command)throw new Qp(Vp.CROSS_CHANNEL_FAILED_JOIN_DEST);if(e.data&&e.data.serverResponse&&"StartPacketTransfer"===e.serverResponse.command)throw new Qp(Vp.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST);throw e}this.prevChannelMediaConfig=e}async updateChannelMediaRelay(e){if(this.state!==Im.RELAY_STATE_RUNNING)throw new Qp(Vp.INVALID_OPERATION);await this.sendUpdateMessage(e),this.prevChannelMediaConfig=e}async setVideoProfile(e){if(this._resolution=e,this.state!==Im.RELAY_STATE_RUNNING)throw new Qp(Vp.INVALID_OPERATION);const t=this.genMessage(Cm.SetVideoProfile);await this.signal.request(t),Jp.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),Jp.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Im.RELAY_STATE_IDLE,this.dispose()}dispose(){Jp.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=kp.CancelToken.source(),this.state=Im.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const e=await async function(e,t,n){const r=df("UAP_AP").slice(0,df("AJAX_REQUEST_CONCURRENT")).map((t=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(t+"/api/v1?action=uap"):"https://".concat(t,"/api/v1?action=uap"))).map((r=>function(e,t,n,r){const i={command:"convergeAllocateEdge",sid:t.sid,appId:t.appId,token:t.token,ts:Date.now(),version:$p,cname:t.cname,uid:t.uid.toString(),requestId:fw,seq:fw};fw+=1;const o={service_name:"tele_channel",json_body:JSON.stringify(i)};return Kp((async()=>{const t=await Hy(e,{data:o,cancelToken:n,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(0!==t.code){const e=new Qp(Vp.UNEXPECTED_RESPONSE,"cross channel ap error, code"+t.code,{retry:!0});throw Jp.error(e.toString()),e}const r=JSON.parse(t.json_body);if(200!==r.code){const e=new Qp(Vp.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(r.code,", reason: ").concat(r.reason));throw Jp.error(e.toString()),e}if(!r.servers||0===r.servers.length){const e=new Qp(Vp.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw Jp.error(e.toString()),e}return{vid:r.vid,workerToken:r.workerToken,addressList:(df("CHANNEL_MEDIA_RELAY_SERVERS")||r.servers).map((e=>"wss://".concat(e.address.replace(/\./g,"-"),".").concat(df("WORKER_DOMAIN"),":").concat(e.wss)))}}),void 0,(e=>!!(e.code!==Vp.OPERATION_ABORTED&&e.code!==Vp.UNEXPECTED_RESPONSE||e.data&&e.data.retry)),r)}(r,e,t,n)));try{const e=await _b(r);return r.forEach((e=>e.cancel())),e}catch(e){throw e[0]}}(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=e.workerToken,await this.signal.connect(e.addressList),this.emit("event",Rm.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(e){const t=this.genMessage(Cm.StopPacketTransfer);await this.signal.request(t),await this.signal.waitStatus("Normal Quit"),Jp.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const n=this.genMessage(Cm.SetSdkProfile,e);await this.signal.request(n),Jp.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const r=this.genMessage(Cm.SetSourceChannel,e);await this.signal.request(r),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",Rm.PACKET_JOINED_SRC_CHANNEL),Jp.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const i=this.genMessage(Cm.SetSourceUserId,e);await this.signal.request(i),Jp.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const o=this.genMessage(Cm.SetDestChannel,e);await this.signal.request(o),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",Rm.PACKET_JOINED_DEST_CHANNEL),Jp.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const s=this.genMessage(Cm.StartPacketTransfer,e);await this.signal.request(s),this.emit("event",Rm.PACKET_SENT_TO_DEST_CHANNEL),this.state=Im.RELAY_STATE_RUNNING,Jp.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(e){const t=this.genMessage(Cm.UpdateDestChannel,e);await this.signal.request(t),this.emit("event",Rm.PACKET_UPDATE_DEST_CHANNEL),Jp.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const e=this.genMessage(Cm.StopPacketTransfer);await this.signal.request(e),Jp.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(e,t){const n=[],r=[],i=[];this.requestId+=1;const o={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:$p,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};"4.18.2"===o.sdkVersion&&(o.sdkVersion="0.0.1");let s=null,a=null;switch(e){case Cm.SetSdkProfile:return o.clientRequest={command:"SetSdkProfile",type:"multi_channel"},o;case Cm.SetSourceChannel:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new Qp(Vp.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceChannel",uid:"0",channelName:a.channelName,token:a.token||this.joinInfo.appId},o;case Cm.SetSourceUserId:if(a=t&&t.getSrcChannelMediaInfo(),!a)throw new Qp(Vp.UNEXPECTED_ERROR,"can not find source config");return o.clientRequest={command:"SetSourceUserId",uid:a.uid+""},o;case Cm.SetDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new Qp(Vp.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"SetDestChannel",channelName:n,uid:r,token:i},o;case Cm.StartPacketTransfer:return o.clientRequest={command:"StartPacketTransfer"},o;case Cm.Reconnect:return o.clientRequest={command:"Reconnect"},o;case Cm.StopPacketTransfer:return o.clientRequest={command:"StopPacketTransfer"},o;case Cm.UpdateDestChannel:if(s=t&&t.getDestChannelMediaInfo(),!s)throw new Qp(Vp.UNEXPECTED_ERROR,"can not find dest config");return s.forEach((e=>{n.push(e.channelName),r.push(e.uid+""),i.push(e.token||this.joinInfo.appId)})),o.clientRequest={command:"UpdateDestChannel",channelName:n,uid:r,token:i},o;case Cm.SetVideoProfile:o.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return o}}const Vw=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new Zl(((n,r)=>{t.toBlob((async e=>{if(t.remove(),e){const r=await Qw(e);n({buffer:r,width:t.width,height:t.height})}else r(new Qp(Vp.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,1)}))},Qw=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};function jw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Gw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jw(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jw(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Kw{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(e){e!==this._videoElementStatus&&(Jp.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(e)),this._videoElementStatus=e)}constructor(e){Kh(this,"trackId",void 0),Kh(this,"config",void 0),Kh(this,"onFirstVideoFrameDecoded",void 0),Kh(this,"freezeTimeCounterList",[]),Kh(this,"renderFreezeAccTime",0),Kh(this,"isKeepLastFrame",!1),Kh(this,"timeUpdatedCount",0),Kh(this,"freezeTime",0),Kh(this,"playbackTime",0),Kh(this,"lastTimeUpdatedTime",0),Kh(this,"autoplayFailed",!1),Kh(this,"videoTrack",void 0),Kh(this,"videoElement",void 0),Kh(this,"cacheVideoElement",void 0),Kh(this,"videoElementCheckInterval",void 0),Kh(this,"_videoElementStatus",xg.NONE),Kh(this,"isGettingVideoDimensions",!1),Kh(this,"startGetVideoDimensions",(()=>{const e=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return Jp.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(e,500)};!this.isGettingVideoDimensions&&e()})),Kh(this,"autoResumeAfterInterruption",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&"running"===c_.curState&&(Jp.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(vh())),Nh()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),Kh(this,"handleVideoEvents",(e=>{switch(e.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=xg.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch(e){}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=xg.CANPLAY;break;case"stalled":this.videoElementStatus=xg.STALLED;break;case"suspend":this.videoElementStatus=xg.SUSPEND;break;case"pause":this.videoElementStatus=xg.PAUSED,wh()||Bh()||Eh()&&this.autoplayFailed||!this.videoTrack||"live"!==this.videoTrack.readyState||(Jp.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=xg.WAITING;break;case"abort":this.videoElementStatus=xg.ABORT;break;case"ended":this.videoElementStatus=xg.ENDED;break;case"emptied":this.videoElementStatus=xg.EMPTIED;break;case"error":{this.videoElementStatus=xg.ERROR;const e=this.videoElement.error;e&&Jp.error("[".concat(this.trackId,"] media error, code: ").concat(e.code,", message: ").concat(e.message));break}case"timeupdate":{const e=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=e);const t=e-this.lastTimeUpdatedTime,n=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=e,$E.lastVisibleTime<$E.lastHiddenTime||n<$E.lastHiddenTime||n<$E.lastVisibleTime)return;for(t>df("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=t),this.playbackTime+=t;this.playbackTime>=6e3;){this.playbackTime-=6e3;const e=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(e),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}})),Kh(this,"autoResumeAfterInterruptionOnIOS15_16",(()=>{this.videoTrack&&"live"===this.videoTrack.readyState&&(Jp.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(vh())),Nh()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))})),this.trackId=e.trackId,this.config=e,e.element instanceof HTMLVideoElement?this.videoElement=e.element:this.videoElement=document.createElement("video"),c_.on(e_.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),c_.on(e_.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var e;return null!==(e=this.videoElement.parentElement)&&void 0!==e?e:void 0}updateConfig(e){this.config=e,this.trackId=e.trackId,e.element!==this.videoElement&&(this.destroy(),this.videoElement=e.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.initVideoElement())}play(e){const t=this.videoElement.play();t&&t.catch&&t.catch((t=>{e&&Zy.autoplayFailed(e,"video",t.message,this.trackId),"NotAllowedError"===t.name?(Jp.warning("detected video element autoplay failed",t),this.autoplayFailed=!0,this.handleAutoPlayFailed()):Jp.warning("[".concat(this.trackId,"] play warning: "),t)}));const n=gh();if(("Safari"===n.name&&15===Number(n.version)||Oh())&&t&&t.then&&t.catch){const e=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};t.then(e).catch(e)}}getCurrentFrame(){const e=document.createElement("canvas");e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight;const t=e.getContext("2d");if(!t)return Jp.error("create canvas context failed!"),new ImageData(2,2);t.drawImage(this.videoElement,0,0,e.width,e.height);const n=t.getImageData(0,0,e.width,e.height);return e.remove(),n}async getCurrentFrameToUint8Array(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const n=document.createElement("canvas");n.width=this.videoElement.videoWidth,n.height=this.videoElement.videoHeight;const r=n.getContext("2d");return r?(r.drawImage(this.videoElement,0,0,n.width,n.height),new Zl(((r,i)=>{n.toBlob((async e=>{if(n.remove(),e){const t=await Qw(e);r({buffer:t,width:n.width,height:n.height})}else i(new Qp(Vp.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))}),e,t<0?.1:t>1?1:t)}))):await Vw(e)}destroy(){c_.off(e_.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),c_.off(e_.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=xg.INIT,!this.videoElementCheckInterval&&(Ww.forEach((e=>{this.videoElement.addEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval=window.setInterval((()=>{(function(e){return e!==document.body&&document.body.contains(e)})(this.videoElement)||(this.videoElementStatus=xg.DESTROYED)}),1e3),df("ENABLE_VIDEO_FRAME_CALLBACK"))){var e,t;let n;const r=(e,t)=>{if(this.videoElementStatus===xg.PLAYING){if(n){const e=t.presentationTime-n.presentationTime;e>df("VIDEO_FREEZE_DURATION")&&$E.lastVisibleTime>=$E.lastHiddenTime&&n.timestamp>$E.lastVisibleTime&&n.timestamp>$E.lastHiddenTime&&(this.renderFreezeAccTime+=e)}n=Gw(Gw({},t),{},{timestamp:e})}var i,o;df("ENABLE_VIDEO_FRAME_CALLBACK")&&(null===(i=(o=this.videoElement).requestVideoFrameCallback)||void 0===i||i.call(o,r))};null===(e=(t=this.videoElement).requestVideoFrameCallback)||void 0===e||e.call(t,r)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),Ph()&&(this.videoElement.poster="noposter");const n=gh();"Safari"===n.name&&15===Number(n.version)||Oh()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,bh()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,bh()&&this.videoElement.load());const r=this.videoElement.play();void 0!==r&&r.catch((e=>{Jp.debug("[".concat(this.trackId,"] playback interrupted"),e.toString())}))}resetVideoElement(){Ww.forEach((e=>{this.videoElement&&this.videoElement.removeEventListener(e,this.handleVideoEvents)})),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=xg.NONE}handleAutoPlayFailed(){const e=t=>{t.preventDefault(),this.videoElement.play().then((()=>{Jp.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))})).catch((e=>{Jp.error(e)})),this.autoplayFailed=!1,kh()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};kh()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Ky()}}const Ww=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class zw extends Kw{constructor(e){super(e),Kh(this,"container",void 0),Kh(this,"slot",void 0),this.slot=e.element,this.updateConfig(e)}updateConfig(e){this.config=e,this.trackId=e.trackId;const t=e.element;t!==this.slot&&(this.destroy(),this.slot=t),this.createElements()}updateVideoTrack(e){this.videoTrack!==e&&(this.videoTrack=e,this.createElements())}play(e){var t;null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)&&super.play(e)}getCurrentFrame(){var e;return null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return null!==(t=this.container)&&void 0!==t&&t.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(e,n):await Vw(e)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch(e){}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",df("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var e;!this.container||null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var e;if(null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch(e){}this.videoElement=document.createElement("video")}}resetVideoElement(){var e;null!==(e=this.container)&&void 0!==e&&e.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function qw(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=af(e.encoderConfig);return t.width=n.width,t.height=n.height,!Dh()&&n.frameRate&&(t.frameRate=n.frameRate),gh().name===uh.EDGE&&"object"==typeof t.frameRate&&(t.frameRate.max=60),bh()&&(t.frameRate={ideal:30,max:30}),t}function Yw(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&_h()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:i,systemAudio:o}=e;(Sh(107)||Th(107)||Ch(93))&&(n&&(mg(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(mg(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",i&&(mg(i,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=i)),(Sh(105)||Th(105)||Ch(91))&&o&&(mg(o,"systemAudio",["exclude","include"]),t.systemAudio=o),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const s=e.encoderConfig?cf(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:s?s.width:void 0,maxHeight:s?s.height:void 0},s&&(s.frameRate&&("number"==typeof s.frameRate?(t.mandatory.maxFrameRate=s.frameRate,t.mandatory.minFrameRate=s.frameRate):(t.mandatory.maxFrameRate=s.frameRate.max||s.frameRate.ideal||s.frameRate.exact||void 0,t.mandatory.minFrameRate=s.frameRate.min||s.frameRate.ideal||s.frameRate.exact||void 0),t.frameRate=s.frameRate),s.width&&(t.width=s.width),s.height&&(t.height=s.height)),t}function Xw(e){const t={};if(Dh()||(void 0!==e.AGC&&(t.autoGainControl=e.AGC),void 0!==e.AEC&&(t.echoCancellation=e.AEC),void 0!==e.ANS&&(t.noiseSuppression=e.ANS,_h()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=Af(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),Ph()&&(t.sampleRate=void 0),t}var Jw,Zw;!function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"}(Jw||(Jw={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(Zw||(Zw={}));var $w,eS,tS,nS,rS,iS,oS,sS,aS,cS,uS,lS,AS,hS,dS,pS,fS,gS,mS,vS,yS,_S,ES,bS,wS,SS,TS,CS,RS,IS,OS,xS,NS,BS,LS=new class{constructor(){Kh(this,"_clientSize",null),Kh(this,"getClientWidth",(()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth)),Kh(this,"getClientHeight",(()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight)),Kh(this,"getStyle",(e=>window.getComputedStyle(e,null))),Kh(this,"checkCssVisibleProperty",(e=>{let t=!0;const n=this.getStyle(e),{display:r,visibility:i,opacity:o,filter:s}=n;return("none"===r||["hidden","collapse"].includes(i)||Number(o)<.1)&&(t=!1),!!t&&(s&&s.split(" ").filter((e=>{const t=e.split("(")[0];return["brightness","blur","opacity"].includes(t)})).map((e=>{const[t,n]=e.split(/\(|\)/);return[t,Number(n.match(/^[0-9\.]+/))]})).forEach((e=>{const[n,r]=e;switch(n){case"brightness":(r<.1||r>3)&&(t=!1);break;case"blur":r>3&&(t=!1);break;case"opacity":r<.1&&(t=!1)}})),t)})),Kh(this,"checkPropertyUpToAllParentNodes",((e,t)=>{let n=!0,r=!0;const i=e=>t(e);let o=e;for(;o&&r;)i(o)||(n=!1,r=!1),o=o.parentElement,o||(r=!1);return n})),Kh(this,"checkActualCssVisibleIncludeInherit",(e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty))),Kh(this,"getSizeAboutClient",(e=>{const{width:t,height:n,left:r,right:i,top:o,bottom:s}=e.getBoundingClientRect(),a=this.getClientWidth(),c=this.getClientHeight();return{width:t,height:n,left:r,right:i,top:o,bottom:s,clientWidth:a,clientHeight:c,clientMin:Math.min(a,c)}})),Kh(this,"checkActualSize",(()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)})),Kh(this,"elementFromPoint",((e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null)),Kh(this,"checkCoverForAPoint",((e,t,n)=>{const r=this.elementFromPoint(e,t);return null!==r&&r!==n})),Kh(this,"getPointPositionList",(()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,i=e/6,o=t/6,s=[],a=10**6;for(let e=0;e<5;e++)for(let t=0;t<5;t++){const c=(n*a+(0===e?.1:4===e?(i*e*a-1e5)/a:i*e)*a)/a,u=(r*a+(0===t?.1:4===t?(o*t*a-1e5)/a:o*t)*a)/a;s.push({x:c,y:u})}return[...s]})),Kh(this,"checkElementCover",(e=>this.getPointPositionList().map((t=>this.checkCoverForAPoint(t.x,t.y,e))).filter((e=>!!e)).length>6)),Kh(this,"checkSizeIsVisible",((e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10))),Kh(this,"checkSizeOfPartInClient",(()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:i,clientWidth:o,clientMin:s}=this._clientSize;let a,c,u,l;if(e<0)a=0;else{if(!(e<o))return!1;a=e}if(t<0)return!1;if(c=t<o?t:o,n<0)u=0;else{if(!(n<i))return!1;u=n}if(r<0)return!1;l=r<i?r:i;const A=c-a,h=l-u;return this.checkSizeIsVisible(A,h,s)})),Kh(this,"returnHiddenResult",(e=>(this._clientSize=null,{visible:!1,reason:e}))),Kh(this,"checkOneElementVisible",(e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(Jw.COVERED);{const e=this.checkActualSize(),t=this.checkSizeOfPartInClient();return e&&!t?this.returnHiddenResult(Jw.POSITION):e?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(Jw.SIZE)}}return this.returnHiddenResult(Jw.STYLE)}return this.returnHiddenResult(Zw.UNMOUNTED)}return this.returnHiddenResult(Zw.INVALID_HTML_ELEMENT)})),Kh(this,"checkElementIsMountedOnDom",(e=>this.checkPropertyUpToAllParentNodes(e,(e=>"HTML"!==e.nodeName.toUpperCase()?null!==e.parentElement:!!document.documentElement))))}};function DS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function MS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?DS(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):DS(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let PS=($w=Jy({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),eS=B_(),tS=Jy({argsMap:e=>[e.getTrackId()]}),nS=r_("LocalVideoTrack","_enabledMutex"),rS=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),iS=B_(),oS=r_("LocalVideoTrack","_enabledMutex"),sS=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),aS=B_(),cS=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),uS=B_(),lS=B_(),AS=Jy({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),hS=B_(),dS=B_(),pS=B_(),fS=B_(),gS=B_(),mS=B_(),vS=B_(),yS=Jy({argsMap:(e,t)=>[e.getTrackId(),t.name]}),_S=Jy({argsMap:e=>[e.getTrackId()]}),ES=Jy({argsMap:e=>[e.getTrackId()]}),bS=Jy({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),Ry((wS=class e extends i_{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==xg.PLAYING)}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get __className__(){return"LocalVideoTrack"}constructor(e,t,n,r,i,o){if(super(e,i),Kh(this,"trackMediaType","video"),Kh(this,"_player",void 0),Kh(this,"_videoVisibleTimer",null),Kh(this,"_previousVideoVisibleStatus",void 0),Kh(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),Kh(this,"_encoderConfig",void 0),Kh(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),Kh(this,"_optimizationMode",void 0),Kh(this,"_videoHeight",void 0),Kh(this,"_videoWidth",void 0),Kh(this,"_forceBitrateLimit",void 0),Kh(this,"_enabled",!0),Kh(this,"processorDestination",void 0),Kh(this,"_processorContext",void 0),Eh()){const{width:t,height:n}=e.getSettings();this._videoWidth=t,this._videoHeight=n}else this.updateMediaStreamTrackResolution();this._encoderConfig=t,this._scalabiltyMode=n,this._optimizationMode=r,this._hints=o||[],-1===this._hints.indexOf(Mm.SCREEN_TRACK)&&this.updateBitrateFromProfile(),t&&-1!==this._hints.indexOf(Mm.CUSTOM_TRACK)&&this.setEncoderConfiguration(t),this.processorContext=new G_(this.getTrackId(),"local"),this.processorDestination=new j_(this.processorContext),this.bindProcessorDestinationEvents()}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(Jp.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Jp.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=MS(MS(MS({},this._getDefaultPlayerConfig()),t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new Kw(n):this._player=new zw(n),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(Hm.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),df("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Jp.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Jp.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){this._originMediaStreamTrack.enabled=!1;try{await bb(this,Dm.NEED_DISABLE_TRACK,this)}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}return t||(this._enabled=!1),void Jp.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await bb(this,Dm.NEED_ENABLE_TRACK,this)}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setEnabled to true error"),e.toString()),e}Jp.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,Jp.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await bb(this,Dm.NEED_MUTE_TRACK,this):await bb(this,Dm.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(e,t){if(!this._enabled)throw new Qp(Vp.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(e=af(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin),e.width||e.height||e.frameRate){const t=qw({encoderConfig:e});(Eh()||wh()||Bh())&&(t.deviceId=void 0),Jp.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(t));try{await this._originMediaStreamTrack.applyConstraints(t),this.updateMediaStreamTrackResolution()}catch(e){const t=new Qp(Vp.UNEXPECTED_ERROR,e.toString());throw Jp.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}}this._encoderConfig=e,-1===this._hints.indexOf(Mm.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await bb(this,Dm.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw()}}getStats(){xb((()=>{Jp.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")}),"localVideoTrackGetStatsWarning");return wb(this,Dm.GET_STATS)||MS({},lm)}async setBeautyEffect(e){Jp.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(e,t):await Vw(e)}clone(t,n,r,i){const o=this._mediaStreamTrack.clone();return new e(o,t,n,r,i)}async setBitrateLimit(e){if(Jp.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(e))),e){this._forceBitrateLimit=e,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<e.max_bitrate?this._encoderConfig.bitrateMax:e.max_bitrate:this._encoderConfig.bitrateMax=e.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=e.min_bitrate);try{await bb(this,Dm.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw()}}}async setOptimizationMode(e){if("motion"!==e&&"detail"!==e&&"balanced"!==e)return void Jp.error(Vp.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const t=this._optimizationMode;try{this._optimizationMode=e,await bb(this,Dm.SET_OPTIMIZATION_MODE,this)}catch(e){throw this._optimizationMode=t,Jp.error("[".concat(this.getTrackId(),"] set optimization mode failed"),e.toString()),e}Jp.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(e,")"))}setScalabiltyMode(e){if(1===e.numSpatialLayers&&1!==e.numTemporalLayers)return Jp.error(Vp.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=e,Jp.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(e,")"))}updateMediaStreamTrackResolution(){yb(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(vb)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:e,height:t,frameRate:n}=this.getMediaStreamTrackSettings();if(!e||!t||!n)return;const[r,i]=function(e,t,n){const r=df("BITRATE_ADAPTER_TYPE");let i;const o=200*Math.pow(n/15,.6)*Math.pow(e*t/640/360,.75),s=o;if("STANDARD_BITRATE"===r)i=4*o;else{if("COMPATIABLE_BITRATE"!==r)return;i=2*o}return[Math.floor(i),Math.floor(s)]}(e,t,n)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=i,this._encoderConfig.bitrateMax=r,Jp.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(e,", h: ").concat(t,", fps: ").concat(n,"] => [brMax: ").concat(r,", brMin: ").concat(i,"]")))}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=LS.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new Qp(Vp.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}async renewMediaStreamTrack(e){}pipe(e){if(this.processor===e)return e;if(e._source)throw new Qp(Vp.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(e,t){if(!(e instanceof MediaStreamTrack))throw new Qp(Vp.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if("video"!==e.kind)throw new Qp(Vp.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(e,t,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(iv.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(),await bb(this,Dm.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await bb(this,Dm.NEED_REPLACE_TRACK,this))}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(iv.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(ov.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(ov.REQUEST_CONSTRAINTS)}}).prototype,"play",[$w,eS],Object.getOwnPropertyDescriptor(wS.prototype,"play"),wS.prototype),Ry(wS.prototype,"stop",[tS],Object.getOwnPropertyDescriptor(wS.prototype,"stop"),wS.prototype),Ry(wS.prototype,"setEnabled",[nS,rS,iS],Object.getOwnPropertyDescriptor(wS.prototype,"setEnabled"),wS.prototype),Ry(wS.prototype,"setMuted",[oS,sS,aS],Object.getOwnPropertyDescriptor(wS.prototype,"setMuted"),wS.prototype),Ry(wS.prototype,"setEncoderConfiguration",[cS,uS],Object.getOwnPropertyDescriptor(wS.prototype,"setEncoderConfiguration"),wS.prototype),Ry(wS.prototype,"getStats",[lS],Object.getOwnPropertyDescriptor(wS.prototype,"getStats"),wS.prototype),Ry(wS.prototype,"setBeautyEffect",[AS,hS],Object.getOwnPropertyDescriptor(wS.prototype,"setBeautyEffect"),wS.prototype),Ry(wS.prototype,"getCurrentFrameData",[dS],Object.getOwnPropertyDescriptor(wS.prototype,"getCurrentFrameData"),wS.prototype),Ry(wS.prototype,"getCurrentFrameImage",[pS],Object.getOwnPropertyDescriptor(wS.prototype,"getCurrentFrameImage"),wS.prototype),Ry(wS.prototype,"setBitrateLimit",[fS],Object.getOwnPropertyDescriptor(wS.prototype,"setBitrateLimit"),wS.prototype),Ry(wS.prototype,"setOptimizationMode",[gS],Object.getOwnPropertyDescriptor(wS.prototype,"setOptimizationMode"),wS.prototype),Ry(wS.prototype,"setScalabiltyMode",[mS],Object.getOwnPropertyDescriptor(wS.prototype,"setScalabiltyMode"),wS.prototype),Ry(wS.prototype,"updateMediaStreamTrackResolution",[vS],Object.getOwnPropertyDescriptor(wS.prototype,"updateMediaStreamTrackResolution"),wS.prototype),Ry(wS.prototype,"pipe",[yS],Object.getOwnPropertyDescriptor(wS.prototype,"pipe"),wS.prototype),Ry(wS.prototype,"unpipe",[_S],Object.getOwnPropertyDescriptor(wS.prototype,"unpipe"),wS.prototype),Ry(wS.prototype,"close",[ES],Object.getOwnPropertyDescriptor(wS.prototype,"close"),wS.prototype),Ry(wS.prototype,"replaceTrack",[bS],Object.getOwnPropertyDescriptor(wS.prototype,"replaceTrack"),wS.prototype),wS),kS=(SS=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),TS=B_(),CS=r_("CameraVideoTrack","_enabledMutex"),RS=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),IS=B_(),OS=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),xS=B_(),NS=Jy({argsMap:e=>[e.getTrackId()]}),Ry((BS=class extends PS{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,i,o){super(e,af(t.encoderConfig),r,i,o),Kh(this,"_config",void 0),Kh(this,"_originalConstraints",void 0),Kh(this,"_constraints",void 0),Kh(this,"_enabled",!0),Kh(this,"_deviceName","default"),Kh(this,"tryResumeVideoForIOS15_16WeChat",(async()=>{(Oh()||xh())&&!function(){const e=gh();if(e.os!==ch.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return 15===Number(t[0])&&Number(t[1])>=2}()&&Lh()&&this._enabled&&!this._isClosed&&(Jp.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())})),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=af(this._config.encoderConfig),c_.on(e_.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),c_.on(e_.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){if(Jp.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await O_.getDeviceById(e),n={};n.video=MS({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await T_(n,this.getTrackId())}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setDevice failed"),e.toString()),r=await T_({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),e}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}else try{const t=await O_.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setDevice error"),e.toString()),e}Jp.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Jp.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const e=await T_({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!1)}await bb(this,Dm.NEED_ENABLE_TRACK,this)}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setEnabled true error"),e.toString()),e}this.updateMediaStreamTrackResolution(),Jp.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await bb(this,Dm.NEED_DISABLE_TRACK,this)}catch(e){throw Jp.error("[".concat(this.getTrackId(),"] setEnabled to false error"),e.toString()),e}Jp.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new Qp(Vp.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=af(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);const n=Ib(this._config);n.encoderConfig=e;const r=qw(n);(Eh()||wh()||Bh())&&(r.deviceId=void 0),Jp.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(e){const t=new Qp(Vp.UNEXPECTED_ERROR,e.toString());throw Jp.error("[".concat(this.getTrackId(),"] applyConstraints error"),t.toString()),t}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,-1===this._hints.indexOf(Mm.SCREEN_TRACK)&&this.updateBitrateFromProfile();try{await bb(this,Dm.NEED_UPDATE_VIDEO_ENCODER,this)}catch(e){return e.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((wh()||Bh())&&this._enabled&&!this._isClosed&&c_.duringInterruption){const e=async()=>{c_.off(e_.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(Jp.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};c_.on(e_.IOS_INTERRUPTION_END,e)}else Jp.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Hm.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=O_.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const e=await T_({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(e.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),c_.off(e_.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),c_.off(e_.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}bindProcessorContextEvents(){this.processorContext.on(ov.REQUEST_UPDATE_CONSTRAINTS,(async(e,t,n)=>{try{const n=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(n),t()}catch(e){n(e)}})),this.processorContext.on(ov.REQUEST_CONSTRAINTS,(async e=>{e(this._originMediaStreamTrack.getSettings())}))}}).prototype,"setDevice",[SS,TS],Object.getOwnPropertyDescriptor(BS.prototype,"setDevice"),BS.prototype),Ry(BS.prototype,"setEnabled",[CS,RS,IS],Object.getOwnPropertyDescriptor(BS.prototype,"setEnabled"),BS.prototype),Ry(BS.prototype,"setEncoderConfiguration",[OS,xS],Object.getOwnPropertyDescriptor(BS.prototype,"setEncoderConfiguration"),BS.prototype),Ry(BS.prototype,"close",[NS],Object.getOwnPropertyDescriptor(BS.prototype,"close"),BS.prototype),BS);class US{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(e,t){Kh(this,"uid",void 0),Kh(this,"_uintid",void 0),Kh(this,"_trust_in_room_",!0),Kh(this,"_trust_audio_enabled_state_",!0),Kh(this,"_trust_video_enabled_state_",!0),Kh(this,"_trust_audio_mute_state_",!0),Kh(this,"_trust_video_mute_state_",!0),Kh(this,"_audio_muted_",!1),Kh(this,"_video_muted_",!1),Kh(this,"_audio_enabled_",!0),Kh(this,"_video_enabled_",!0),Kh(this,"_audio_added_",!1),Kh(this,"_video_added_",!1),Kh(this,"_trust_video_stream_added_state_",!0),Kh(this,"_trust_audio_stream_added_state_",!0),Kh(this,"_audioTrack",void 0),Kh(this,"_videoTrack",void 0),Kh(this,"_audioSSRC",void 0),Kh(this,"_videoSSRC",void 0),Kh(this,"_audioOrtc",void 0),Kh(this,"_videoOrtc",void 0),Kh(this,"_cname",void 0),Kh(this,"_rtxSsrcId",void 0),this.uid=e,this._uintid=t}}var FS=Jl,HS=$c,VS=au;mn({target:"Promise",stat:!0},{try:function(e){var t=HS.f(this),n=VS(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var QS=FS,jS=mn,GS=A,KS=t,WS=Ev,zS=W,qS=ke,YS=wn,XS=Rf,JS=Iv,ZS=ay,$S=se,eT=nt("isConcatSpreadable"),tT=9007199254740991,nT="Maximum allowed index exceeded",rT=GS.TypeError,iT=$S>=51||!KS((function(){var e=[];return e[eT]=!1,e.concat()[0]!==e})),oT=ZS("concat"),sT=function(e){if(!zS(e))return!1;var t=e[eT];return void 0!==t?!!t:WS(e)};jS({target:"Array",proto:!0,forced:!iT||!oT},{concat:function(e){var t,n,r,i,o,s=qS(this),a=JS(s,0),c=0;for(t=-1,r=arguments.length;t<r;t++)if(sT(o=-1===t?s:arguments[t])){if(c+(i=YS(o))>tT)throw rT(nT);for(n=0;n<i;n++,c++)n in o&&XS(a,c,o[n])}else{if(c>=tT)throw rT(nT);XS(a,c++,o)}return a.length=c,a}});var aT={},cT=L,uT=G,lT=Sr.f,AT=Lf,hT="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];aT.f=function(e){return hT&&"Window"==cT(e)?function(e){try{return lT(e)}catch(e){return AT(hT)}}(e):lT(uT(e))};var dT={},pT=nt;dT.f=pT;var fT=z,gT=He,mT=dT,vT=Vt.f,yT=function(e){var t=fT.Symbol||(fT.Symbol={});gT(t,e)||vT(t,e,{value:mT.f(e)})},_T=mn,ET=A,bT=Z,wT=g,ST=b,TT=c,CT=y,RT=ue,IT=t,OT=He,xT=Ev,NT=m,BT=W,LT=u,DT=ge,MT=zt,PT=ke,kT=G,UT=ht,FT=_o,HT=O,VT=Si,QT=ii,jT=Sr,GT=aT,KT=Gr,WT=v,zT=Vt,qT=ti,YT=w,XT=ec,JT=Cs,ZT=Oe.exports,$T=Dr,eC=Ke,tC=nt,nC=dT,rC=yT,iC=Gs,oC=vs,sC=Pv.forEach,aC=sr("hidden"),cC="Symbol",uC=tC("toPrimitive"),lC=oC.set,AC=oC.getterFor(cC),hC=Object.prototype,dC=ET.Symbol,pC=dC&&dC.prototype,fC=ET.TypeError,gC=ET.QObject,mC=bT("JSON","stringify"),vC=WT.f,yC=zT.f,_C=GT.f,EC=YT.f,bC=TT([].push),wC=ZT("symbols"),SC=ZT("op-symbols"),TC=ZT("string-to-symbol-registry"),CC=ZT("symbol-to-string-registry"),RC=ZT("wks"),IC=!gC||!gC.prototype||!gC.prototype.findChild,OC=CT&&IT((function(){return 7!=VT(yC({},"a",{get:function(){return yC(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=vC(hC,t);r&&delete hC[t],yC(e,t,n),r&&e!==hC&&yC(hC,t,r)}:yC,xC=function(e,t){var n=wC[e]=VT(pC);return lC(n,{type:cC,tag:e,description:t}),CT||(n.description=t),n},NC=function(e,t,n){e===hC&&NC(SC,t,n),MT(e);var r=UT(t);return MT(n),OT(wC,r)?(n.enumerable?(OT(e,aC)&&e[aC][r]&&(e[aC][r]=!1),n=VT(n,{enumerable:HT(0,!1)})):(OT(e,aC)||yC(e,aC,HT(1,{})),e[aC][r]=!0),OC(e,r,n)):yC(e,r,n)},BC=function(e,t){MT(e);var n=kT(t),r=QT(n).concat(PC(n));return sC(r,(function(t){CT&&!ST(LC,n,t)||NC(e,t,n[t])})),e},LC=function(e){var t=UT(e),n=ST(EC,this,t);return!(this===hC&&OT(wC,t)&&!OT(SC,t))&&(!(n||!OT(this,t)||!OT(wC,t)||OT(this,aC)&&this[aC][t])||n)},DC=function(e,t){var n=kT(e),r=UT(t);if(n!==hC||!OT(wC,r)||OT(SC,r)){var i=vC(n,r);return!i||!OT(wC,r)||OT(n,aC)&&n[aC][r]||(i.enumerable=!0),i}},MC=function(e){var t=_C(kT(e)),n=[];return sC(t,(function(e){OT(wC,e)||OT($T,e)||bC(n,e)})),n},PC=function(e){var t=e===hC,n=_C(t?SC:kT(e)),r=[];return sC(n,(function(e){!OT(wC,e)||t&&!OT(hC,e)||bC(r,wC[e])})),r};if(RT||(JT(pC=(dC=function(){if(LT(pC,this))throw fC("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?FT(arguments[0]):void 0,t=eC(e),n=function(e){this===hC&&ST(n,SC,e),OT(this,aC)&&OT(this[aC],t)&&(this[aC][t]=!1),OC(this,t,HT(1,e))};return CT&&IC&&OC(hC,t,{configurable:!0,set:n}),xC(t,e)}).prototype,"toString",(function(){return AC(this).tag})),JT(dC,"withoutSetter",(function(e){return xC(eC(e),e)})),YT.f=LC,zT.f=NC,qT.f=BC,WT.f=DC,jT.f=GT.f=MC,KT.f=PC,nC.f=function(e){return xC(tC(e),e)},CT&&yC(pC,"description",{configurable:!0,get:function(){return AC(this).description}})),_T({global:!0,wrap:!0,forced:!RT,sham:!RT},{Symbol:dC}),sC(QT(RC),(function(e){rC(e)})),_T({target:cC,stat:!0,forced:!RT},{for:function(e){var t=FT(e);if(OT(TC,t))return TC[t];var n=dC(t);return TC[t]=n,CC[n]=t,n},keyFor:function(e){if(!DT(e))throw fC(e+" is not a symbol");if(OT(CC,e))return CC[e]},useSetter:function(){IC=!0},useSimple:function(){IC=!1}}),_T({target:"Object",stat:!0,forced:!RT,sham:!CT},{create:function(e,t){return void 0===t?VT(e):BC(VT(e),t)},defineProperty:NC,defineProperties:BC,getOwnPropertyDescriptor:DC}),_T({target:"Object",stat:!0,forced:!RT},{getOwnPropertyNames:MC,getOwnPropertySymbols:PC}),_T({target:"Object",stat:!0,forced:IT((function(){KT.f(1)}))},{getOwnPropertySymbols:function(e){return KT.f(PT(e))}}),mC&&_T({target:"JSON",stat:!0,forced:!RT||IT((function(){var e=dC();return"[null]"!=mC([e])||"{}"!=mC({a:e})||"{}"!=mC(Object(e))}))},{stringify:function(e,t,n){var r=XT(arguments),i=t;if((BT(t)||void 0!==e)&&!DT(e))return xT(t)||(t=function(e,t){if(NT(i)&&(t=ST(i,this,e,t)),!DT(t))return t}),r[1]=t,wT(mC,null,r)}}),!pC[uC]){var kC=pC.valueOf;JT(pC,uC,(function(e){return ST(kC,this)}))}iC(dC,cC),$T[aC]=!0,yT("asyncIterator"),yT("hasInstance"),yT("isConcatSpreadable"),yT("iterator"),yT("match"),yT("matchAll"),yT("replace"),yT("search"),yT("species"),yT("split"),yT("toPrimitive"),yT("toStringTag"),yT("unscopables"),Gs(A.JSON,"JSON",!0);var UC=z.Symbol;yT("asyncDispose"),yT("dispose"),yT("matcher"),yT("metadata"),yT("observable"),yT("patternMatch"),yT("replaceAll");var FC=UC,HC=dT.f("asyncIterator"),VC=HC;function QC(e){this.wrapped=e}function jC(e){var t,n;function r(t,n){try{var o=e[t](n),s=o.value,a=s instanceof QC;QS.resolve(a?s.wrapped:s).then((function(e){a?r("return"===t?"return":"next",e):i(o.done?"return":"normal",e)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new QS((function(o,s){var a={key:e,arg:i,resolve:o,reject:s,next:null};n?n=n.next=a:(t=n=a,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function GC(e){return function(){return new jC(e.apply(this,arguments))}}function KC(e){return new QC(e)}jC.prototype["function"==typeof FC&&VC||"@@asyncIterator"]=function(){return this},jC.prototype.next=function(e){return this._invoke("next",e)},jC.prototype.throw=function(e){return this._invoke("throw",e)},jC.prototype.return=function(e){return this._invoke("return",e)};var WC=dT.f("iterator");function zC(e,t){var n={},r=!1;function i(n,i){return r=!0,i=new QS((function(t){t(e[n](i))})),{done:!1,value:t(i)}}return n[void 0!==FC&&WC||"@@iterator"]=function(){return this},n.next=function(e){return r?(r=!1,e):i("next",e)},"function"==typeof e.throw&&(n.throw=function(e){if(r)throw r=!1,e;return i("throw",e)}),"function"==typeof e.return&&(n.return=function(e){return r?(r=!1,e):i("return",e)}),n}var qC=HC,YC={exports:{}};function XC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function JC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?XC(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XC(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ZC(e,t,n,r,i,o,s){let a=[],c=[],u=[],l=[],A=!1,h=!1;if(YC.exports.parse(e).mediaDescriptions.forEach((e=>{s&&s!==e.attributes.direction||("video"!==e.media.mediaType||A||(c=e.attributes.payloads,l=e.attributes.extmaps,A=!0),"audio"!==e.media.mediaType||h||(a=e.attributes.payloads,u=e.attributes.extmaps,h=!0))})),!l||0===c.length)throw new Error("Cannot get video capabilities from SDP.");if(!u||0===a.length)throw new Error("Cannot get audio capabilities from SDP.");return c.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate))})),a.forEach((e=>{var t;null!==(t=e.rtpMap)&&void 0!==t&&t.clockRate&&(e.rtpMap.clockRate=parseInt(e.rtpMap.clockRate))})),t&&(a=a.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})),c=c.filter((e=>{var t;return"rtx"!==(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())}))),n&&(c=c.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),r&&(a=a.filter((e=>{var t;return!/(red)|(ulpfec)|(flexfec)/i.test((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName)||"")}))),i&&(null==i?void 0:i.length)>0&&(a=a.filter((e=>{var t;return i.includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),o&&(null==o?void 0:o.length)>0&&(c=c.filter((e=>{var t;return o.includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")}))),{audioCodecs:a,videoCodecs:c,audioExtensions:u,videoExtensions:l}}function $C(e){const t=YC.exports.parse(e);let n,r;for(const e of t.mediaDescriptions){if(!n){const t=e.attributes.iceUfrag,r=e.attributes.icePwd;if(!t||!r)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:t,icePwd:r}}if(!r){const t=e.attributes.fingerprints;t.length>0&&(r={fingerprints:t})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function eR(e,t){const n=[],r=e.attributes.ssrcGroups.filter((e=>"FID"===e.semantic)),i=e.attributes.ssrcGroups.find((e=>"SIM"===e.semantic)),o=e.attributes.ssrcs;if(i)i.ssrcIds.forEach((e=>{var i;const o=null===(i=r.find((t=>t.ssrcIds[0]===e)))||void 0===i?void 0:i.ssrcIds[1];n.push({ssrcId:e,rtx:t?o:void 0})}));else if(r.length>0){const e=r[0].ssrcIds[0],i=r[0].ssrcIds[1];n.push({ssrcId:e,rtx:t?i:void 0})}else{if(0===o.length)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:o[0].ssrcId})}return n}function tR(e,t){const{cname:n}=e;let r;t&&t.ip&&"number"==typeof t.port?(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],Jp.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),Jp.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):r=e.iceParameters.candidates.map((e=>({foundation:e.foundation,componentId:"1",transport:e.protocol,priority:e.priority.toString(),connectionAddress:e.ip,port:e.port.toString(),type:e.type,extension:{}})));const i={fingerprints:e.dtlsParameters.fingerprints.map((e=>({hashFunction:e.algorithm,fingerprint:e.fingerprint})))},o={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let s;switch(e.dtlsParameters.role){case"server":s="passive";break;case"client":s="active";break;case"auto":s="actpass"}return{dtlsParameters:i,iceParameters:o,candidates:r,rtpCapabilities:AR(e.rtpCapabilities),setup:s,cname:n}}function nR(e,t,n){const r=[],i=[];return e.forEach((e=>{let{ssrcId:o,rtx:s}=e;const a=gb(8,"track-"),c={ssrcId:o,attributes:JC({label:a,mslabel:n=n||gb(10,""),msid:"".concat(n," ").concat(a)},t&&{cname:t})};if(r.push(c),void 0!==s){const e={ssrcId:s,attributes:JC({label:a,mslabel:n,msid:"".concat(n," ").concat(a)},t&&{cname:t})};r.push(e),i.push({semantic:"FID",ssrcIds:[o,s]})}})),e.length>1&&i.push({semantic:"SIM",ssrcIds:e.map((e=>{let{ssrcId:t}=e;return t}))}),{ssrcs:r,ssrcGroups:i}}function rR(e,t){t instanceof jE&&e.attributes.payloads.forEach((e=>{var n;const r=null===(n=e.rtpMap)||void 0===n?void 0:n.encodingName.toLowerCase();if(!r||-1===["opus","pcmu","pcma","g722"].indexOf(r))return;e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.minptime="10",e.fmtp.parameters.useinbandfec="1";const i=t._encoderConfig;i&&"pcmu"!==r&&"pcma"!==r&&"g722"!==r&&(i.bitrate&&!bh()&&(e.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*i.bitrate))),i.sampleRate&&(e.fmtp.parameters.maxplaybackrate="".concat(i.sampleRate),e.fmtp.parameters["sprop-maxcapturerate"]="".concat(i.sampleRate)),i.stereo&&(e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"))}))}function iR(e){const t=e.attributes.unrecognized.findIndex((e=>"x-google-flag"===e.attField&&"conference"===e.attValue));-1!==t&&e.attributes.unrecognized.splice(t,1)}function oR(e,t){if(!(t instanceof PS&&t._encoderConfig&&-1===t._hints.indexOf(Mm.SCREEN_TRACK)))return;const n=t._encoderConfig;vv().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach((e=>{var t;["h264","h265","vp8","vp9","av1"].includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))})),vv().supportMinBitrate&&!t._hints.includes(Mm.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach((e=>{var t;["h264","h265","vp8","vp9","av1"].includes((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"")&&(e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters["x-google-start-bitrate"]="".concat(df("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))}))}function sR(e){if("video"!==e.media.mediaType)return;const t=gh();if(t.name!==uh.SAFARI&&t.os!==ch.IOS)return;const n=e.attributes.extmaps.findIndex((e=>/video-orientation/g.test(e.extensionName)));-1!==n&&e.attributes.extmaps.splice(n,1)}function aR(e,t,n){if(!t)return;let r,i;if("video"===e.media.mediaType?(r=n.videoExtensions,i=n.videoCodecs):(r=n.audioExtensions,i=n.audioCodecs),!0===t.twcc){const t=r.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));t&&(e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))))))}(i,e.attributes.payloads).forEach((e=>{e.rtcpFeedbacks.find((e=>"transport-cc"===e.type))||e.rtcpFeedbacks.push({type:"transport-cc"})})))}else if(!1===t.twcc){const t=e.attributes.extmaps.findIndex((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}if(!0===t.remb){const t=r.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));t&&(e.attributes.extmaps.find((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName))||e.attributes.extmaps.push({entry:t.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(e,t){return t.filter((t=>!!e.find((e=>e.payloadType===t.payloadType&&!!e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))))))}(i,e.attributes.payloads).forEach((e=>{e.rtcpFeedbacks.find((e=>"goog-remb"===e.type))||e.rtcpFeedbacks.push({type:"goog-remb"})})))}else if(!1===t.remb){const t=e.attributes.extmaps.findIndex((e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.extensionName));-1!==t&&e.attributes.extmaps.splice(t,1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"goog-remb"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}}function cR(e,t,n){if(bh())return;if("video"!==e.media.mediaType)return;if(!(t instanceof PS))return;if("vp9"!==n&&"vp8"!==n)return;if("vp8"===n&&!df("SIMULCAST"))return;if(void 0===t._scalabiltyMode||t._scalabiltyMode.numSpatialLayers<=1)return;const r="vp8"===n?2:t._scalabiltyMode.numSpatialLayers,i=e.attributes.ssrcs[0],o=e.attributes.ssrcGroups.find((e=>"FID"===e.semantic&&e.ssrcIds[0]===i.ssrcId)),s={semantic:"SIM",ssrcIds:[i.ssrcId]};for(let t=1;t<r;t++)e.attributes.ssrcs.push({ssrcId:i.ssrcId+t,attributes:Ib(i.attributes)}),s.ssrcIds.push(i.ssrcId+t),o&&(e.attributes.ssrcs.push({ssrcId:o.ssrcIds[1]+t,attributes:Ib(i.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[i.ssrcId+t,o.ssrcIds[1]+t]}));e.attributes.ssrcGroups.unshift(s)}async function uR(e,t,n,r,i){const o=new RTCPeerConnection;o.addTransceiver("video",{direction:"sendonly"}),o.addTransceiver("audio",{direction:"sendonly"}),o.addTransceiver("video",{direction:"recvonly"}),o.addTransceiver("audio",{direction:"recvonly"});const s=(await o.createOffer()).sdp,a=ZC(s,e,t,n,r,i,"sendonly"),c=ZC(s,e,t,n,r,i,"recvonly"),u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},A={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(lR(a,c,"videoExtensions",u,l,A),lR(a,c,"videoCodecs",u,l,A),lR(a,c,"audioExtensions",u,l,A),lR(a,c,"audioCodecs",u,l,A),df("RAISE_H264_BASELINE_PRIORITY")){const e=A.videoCodecs.findIndex((e=>{var t,n;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"===(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])}));if(-1!==e){const t=A.videoCodecs.findIndex((e=>{var t;return"h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())}));if(t<e){Jp.debug("raising H264 baseline profile priority");const n=A.videoCodecs[e];A.videoCodecs.splice(e,1),A.videoCodecs.splice(t,0,n)}-1!==t&&(l.videoCodecs=l.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))}))),-1!==t&&df("FILTER_SEND_H264_BASELINE")&&(u.videoCodecs=u.videoCodecs.filter((e=>{var t,n;return!("h264"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLocaleLowerCase())&&"42001f"!==(null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"]))})))}}try{o.close()}catch(e){}return{send:u,recv:l,sendrecv:A}}function lR(e,t,n,r,i,o){if("videoExtensions"===n||"audioExtensions"===n){const s=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.entry===t.entry&&e.extensionName===t.extensionName)return s.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===s.indexOf(t)&&i[n].push(e)}))}if("videoCodecs"===n||"audioCodecs"===n){const s=[];return e[n].forEach((e=>{t[n].some(((t,n)=>{if(e.payloadType===t.payloadType&&JSON.stringify(e)===JSON.stringify(t))return s.push(n),!0}))?o[n].push(e):r[n].push(e)})),void t[n].forEach(((e,t)=>{-1===s.indexOf(t)&&i[n].push(e)}))}}function AR(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let i,o;return t?(i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},i.audioCodecs=[...t.audioCodecs,...r.audioCodecs],i.videoCodecs=[...t.videoCodecs,...r.videoCodecs],i.audioExtensions=[...t.audioExtensions,...r.audioExtensions],i.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):i=r,n?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...n.audioCodecs,...r.audioCodecs],o.videoCodecs=[...n.videoCodecs,...r.videoCodecs],o.audioExtensions=[...n.audioExtensions,...r.audioExtensions],o.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):o=r,{send:i,recv:o}}function hR(e){"audio"===e.media.mediaType&&e.attributes.payloads.filter((e=>{var t;return"opus"===(null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())})).forEach((e=>{e.fmtp||(e.fmtp={parameters:{}}),e.fmtp.parameters.stereo="1",e.fmtp.parameters["sprop-stereo"]="1"}))}function dR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dR(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}!function(e,t){e.exports=(()=>{var e={8:(e,t,n)=>{n.r(t),n.d(t,{Parser:()=>b,Printer:()=>R,parse:()=>N,print:()=>B});const r="\n",i="".concat("\r").concat(r),o=" ";let s;function a(e){return e>="0"&&e<="9"}function c(e){return e>="!"&&e<="~"}function u(e){return c(e)||e>="Â"&&e<="Ã¿"}function l(e){return"!"===e||e>="#"&&e<="'"||e>="*"&&e<="+"||e>="-"&&e<="."||e>="0"&&e<="9"||e>="A"&&e<="Z"||e>="^"&&e<="~"}function A(e){return e>="1"&&e<="9"}function h(e){return e>="A"&&e<="Z"||e>="a"&&e<="z"}function d(e){return"d"===e||"h"===e||"m"===e||"s"===e}function p(e){return e>""&&e<"\t"||e>"\v"&&e<"\f"||e>""&&e<"Ã¿"}function f(e){return h(e)||a(e)||"+"===e||"/"===e}function g(e){return a(e)||h(e)||"+"===e||"/"===e||"-"===e||"_"===e}function m(e){return h(e)||a(e)||"+"===e||"/"===e}function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.VERSION="v",e.ORIGIN="o",e.SESSION_NAME="s",e.INFORMATION="i",e.URI="u",e.EMAIL="e",e.PHONE="p",e.CONNECTION="c",e.BANDWIDTH="b",e.TIME="t",e.REPEAT="r",e.ZONE_ADJUSTMENTS="z",e.KEY="k",e.ATTRIBUTE="a",e.MEDIA="m"}(s||(s={}));class E{consumeText(e,t){let n=t;for(;n<e.length;){const t=e[n];if("\0"===t||"\r"===t||t===r)break;n+=1}if(n-t==0)throw new Error("Invalid text, at ".concat(e));return n}consumeUnicastAddress(e,t,n){return this.consumeTill(e,t,o)}consumeOneOrMore(e,t,n){let r=t;for(;n(e[r]);)r++;if(r-t==0)throw new Error("Invalid rule at ".concat(t,"."));return r}consumeSpace(e,t){if(e[t]===o)return t+1;throw new Error("Invalid space at ".concat(t,"."))}consumeIP4Address(e,t){let n=t;for(let t=0;t<4;t++)if(n=this.consumeDecimalUChar(e,n),3!==t){if("."!==e[n])throw new Error("Invalid IP4 address.");n++}return n}consumeDecimalUChar(e,t){let n=t;for(let t=0;t<3&&a(e[n]);t++,n++);if(n-t==0)throw new Error("Invalid decimal uchar.");const r=parseInt(e.slice(t,n));if(r>=0&&r<=255)return n;throw new Error("Invalid decimal uchar")}consumeIP6Address(e,t){let n=this.consumeHexpart(e,t);return":"===e[n]?(n+=1,n=this.consumeIP4Address(e,n),n):n}consumeHexpart(e,t){let n=t;if(":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}if(n=this.consumeHexseq(e,n),":"===e[n]&&":"===e[n+1]){n+=2;try{n=this.consumeHexseq(e,n)}catch(e){}return n}return n}consumeHexseq(e,t){let n=t;for(;n=this.consumeHex4(e,n),":"===e[n]&&":"!==e[n+1];)n+=1;return n}consumeHex4(e,t){let n=0;for(;n<4;n++)if(!((r=e[t+n])>="0"&&r<="9"||r>="a"&&r<="f"||r>="A"&&r<="F")){if(0===n)throw new Error("Invalid hex 4");break}var r;return t+n}consumeFQDN(e,t){let n=t;for(;a(e[n])||h(e[n])||"-"===e[n]||"."===e[n];)n+=1;if(n-t<4)throw new Error("Invalid FQDN");return n}consumeExtnAddr(e,t){return this.consumeOneOrMore(e,t,u)}consumeMulticastAddress(e,t,n){switch(n){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(e,t);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(e,t);default:try{return this.consumeFQDN(e,t)}catch(n){return this.consumeExtnAddr(e,t)}}}consumeIP6MulticastAddress(e,t){const n=this.consumeHexpart(e,t);return"/"===e[n]?this.consumeInteger(e,n+1):n}consumeIP4MulticastAddress(e,t){let n=t+3;const r=e.slice(t,n),i=parseInt(r);if(i<224||i>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let t=0;t<3;t++){if("."!==e[n])throw new Error("Invalid IP4 multicast address.");n+=1,n=this.consumeDecimalUChar(e,n)}return"/"===e[n]&&(n+=1),n=this.consumeTTL(e,n),"/"===e[n]&&(n=this.consumeInteger(e,n)),n}consumeInteger(e,t){if(!A(e[t]))throw new Error("Invalid integer.");for(t+=1;a(e[t]);)t+=1;return t}consumeTTL(e,t){if("0"===e[t])return t+1;if(!A(e[t]))throw new Error("Invalid TTL.");t+=1;for(let n=0;n<2&&a(e[t]);n++)t+=1;return t}consumeToken(e,t){return this.consumeOneOrMore(e,t,l)}consumeTime(e,t){let n=t;if("0"===e[n])return n+1;for(A(e[n])&&(n+=1);a(e[n]);)n++;if(n-t<10)throw new Error("Invalid time");return n}consumeAddress(e,t){return this.consumeTill(e,t,o)}consumeTypedTime(e,t){let n=t;return n=this.consumeOneOrMore(e,n,a),d(e[n])?n+1:n}consumeRepeatInterval(e,t){if(!A(e[t]))throw new Error("Invalid repeat interval");for(t+=1;a(e[t]);)t+=1;return d(e[t])&&(t+=1),t}consumePort(e,t){return this.consumeOneOrMore(e,t,a)}consume(e,t,n){for(let r=0;r<n.length;r++){if(t+r>=e.length)throw new Error("consume exceeding value length");if(e[t+r]!==n[r])throw new Error("consume ".concat(n," failed at ").concat(r))}return t+n.length}consumeTill(e,t,n){let r=t;for(;r<e.length&&("string"!=typeof n||e[r]!==n)&&("function"!=typeof n||!n(e[r]));)r++;return r}}class b extends E{constructor(){super(),_(this,"records",[]),_(this,"currentLine",0)}parse(e){const t=this.probeEOL(e);this.records=e.split(t).filter((e=>!!e.trim())).map(this.parseLine),this.currentLine=0;const n=this.parseVersion(),r=this.parseOrigin(),i=this.parseSessionName(),o=this.parseInformation(),s=this.parseUri(),a=this.parseEmail(),c=this.parsePhone(),u=this.parseConnection(),l=this.parseBandWidth(),A=this.parseTimeFields(),h=this.parseKey(),d=this.parseSessionAttribute(),p=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:n,origin:r,sessionName:i,information:o,uri:s,emails:a,phones:c,connection:u,bandwidths:l,timeFields:A,key:h,attributes:d,mediaDescriptions:p}}getCurrentRecord(){const e=this.records[this.currentLine];if(!e)throw new Error("Record doesn't exit.");return e}probeEOL(e){for(let t=0;t<e.length;t++)if(e[t]===r)return"\r"===e[t-1]?i:r;throw new Error("Invalid newline character.")}parseLine(e,t){if(e.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const n=e[0];if("="!==e[1])throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:n,value:e.slice(2),line:t,cur:0}}parseSessionAttribute(){const e=new S;for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==s.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(t,(e=>l(e)&&":"!==e)),_cur:0};":"===t.value[t.cur]&&(t.cur+=1,n.attValue=this.extractOneOrMore(t,p)),e.parse(n),this.currentLine++}return e.digest()}parseMediaAttributes(e){const t=new T(e);for(;this.currentLine<this.records.length;){const e=this.getCurrentRecord();if(e.type!==s.ATTRIBUTE)break;const n={attField:this.extractOneOrMore(e,(e=>l(e)&&":"!==e)),_cur:0};":"===e.value[e.cur]&&(e.cur+=1,n.attValue=this.extractOneOrMore(e,p)),t.parse(n),this.currentLine++}return t.digest()}parseKey(){const e=this.getCurrentRecord();if(e.type===s.KEY){if("prompt"===e.value||"clear:"===e.value||"base64:"===e.value||"uri:"===e.value)return e.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const e=this.getCurrentRecord();if(e.type===s.ZONE_ADJUSTMENTS){const t=[];for(;;)try{const n=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);let r=!1;"-"===e.value[e.cur]&&(r=!0,e.cur+=1);const i=this.extract(e,this.consumeTypedTime);t.push({time:n,typedTime:i,back:r})}catch(e){break}if(0===t.length)throw new Error("Invalid zone adjustments");return this.currentLine++,t}return[]}parseRepeat(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.REPEAT)break;{const n=this.extract(t,this.consumeRepeatInterval),r=this.parseTypedTime(t);e.push({repeatInterval:n,typedTimes:r}),this.currentLine++}}return e}parseTypedTime(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeTypedTime))}catch(e){break}if(0===t.length)throw new Error("Invalid typed time.");return t}parseTime(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeTime);this.consumeSpaceForRecord(e);const n=this.extract(e,this.consumeTime);return this.currentLine++,{startTime:t,stopTime:n}}parseBandWidth(){const e=[];for(;this.currentLine<this.records.length;){const t=this.getCurrentRecord();if(t.type!==s.BANDWIDTH)break;{const n=this.extractOneOrMore(t,l);if(":"!==t.value[t.cur])throw new Error("Invalid bandwidth field.");t.cur++;const r=this.extractOneOrMore(t,a);e.push({bwtype:n,bandwidth:r}),this.currentLine++}}return e}parseVersion(){const e=this.getCurrentRecord();if(e.type!==s.VERSION)throw new Error("first sdp record must be version");const t=e.value.slice(0,this.consumeOneOrMore(e.value,0,a));if(t.length!==e.value.length)throw new Error('invalid proto version, "v='.concat(e.value,'"'));return this.currentLine++,t}parseOrigin(){const e=this.getCurrentRecord();if(e.type!==s.ORIGIN)throw new Error("second line of sdp must be origin");const t=this.extractOneOrMore(e,u);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);const r=this.extractOneOrMore(e,a);this.consumeSpaceForRecord(e);const i=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const o=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const c=this.extract(e,this.consumeUnicastAddress);return this.currentLine++,{username:t,sessId:n,sessVersion:r,nettype:i,addrtype:o,unicastAddress:c}}parseSessionName(){const e=this.getCurrentRecord();if(e.type===s.SESSION_NAME){const t=this.extract(e,this.consumeText);return this.currentLine++,t}}parseInformation(){const e=this.getCurrentRecord();if(e.type!==s.INFORMATION)return;const t=this.extract(e,this.consumeText);return this.currentLine++,t}parseUri(){const e=this.getCurrentRecord();if(e.type===s.URI)return this.currentLine++,e.value}parseEmail(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.EMAIL)break;e.push(t.value),this.currentLine++}return e}parsePhone(){const e=[];for(;;){const t=this.getCurrentRecord();if(t.type!==s.PHONE)break;e.push(t.value),this.currentLine++}return e}parseConnection(){const e=this.getCurrentRecord();if(e.type===s.CONNECTION){const t=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const n=this.extractOneOrMore(e,l);this.consumeSpaceForRecord(e);const r=this.extract(e,this.consumeAddress);return this.currentLine++,{nettype:t,addrtype:n,address:r}}}parseMedia(){const e=this.getCurrentRecord(),t=this.extract(e,this.consumeToken);this.consumeSpaceForRecord(e);let n=this.extract(e,this.consumePort);"/"===e.value[e.cur]&&(e.cur+=1,n+=this.extract(e,this.consumeInteger)),this.consumeSpaceForRecord(e);const r=[];for(r.push(this.extract(e,this.consumeToken));"/"===e.value[e.cur];)e.cur+=1,r.push(this.extract(e,this.consumeToken));if(0===r.length)throw new Error("Invalid proto");const i=this.parseFmt(e);return this.currentLine++,{mediaType:t,port:n,protos:r,fmts:i}}parseTimeFields(){const e=[];for(;this.getCurrentRecord().type===s.TIME;){const t=this.parseTime(),n=this.parseRepeat(),r=this.parseZone();e.push({time:t,repeats:n,zones:r})}return e}parseMediaDescription(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===s.MEDIA;){const t=this.parseMedia(),n=this.parseInformation(),r=this.parseConnections(),i=this.parseBandWidth(),o=this.parseKey(),s=this.parseMediaAttributes(t);e.push({media:t,information:n,connections:r,bandwidths:i,key:o,attributes:s})}return e}parseConnections(){const e=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===s.CONNECTION;)e.push(this.parseConnection());return e}parseFmt(e){const t=[];for(;;)try{this.consumeSpaceForRecord(e),t.push(this.extract(e,this.consumeToken))}catch(e){break}if(0===t.length)throw new Error("Invalid fmts");return t}extract(e,t,...n){const r=t.call(this,e.value,e.cur,...n),i=e.value.slice(e.cur,r);return e.cur=r,i}extractOneOrMore(e,t){const n=this.consumeOneOrMore(e.value,e.cur,t),r=e.value.slice(e.cur,n);return e.cur=n,r}consumeSpaceForRecord(e){if(e.value[e.cur]!==o)throw new Error("Invalid space at ".concat(e.cur,"."));e.cur+=1}}class w extends E{constructor(...e){super(...e),_(this,"attributes",void 0),_(this,"digested",!1)}extractOneOrMore(e,t,n){const r=this.consumeOneOrMore(e.attValue,e._cur,t),i=e.attValue.slice(e._cur,r),[o,s]=n||[];if("number"==typeof o&&i.length<o)throw new Error("error in length, should be more or equal than ".concat(o," characters."));if("number"==typeof s&&i.length>s)throw new Error("error in length, should be less or equal than ".concat(s," characters."));return e._cur=r,i}consumeAttributeSpace(e){if(e.attValue[e._cur]!==o)throw new Error("Invalid space at ".concat(e._cur,"."));e._cur+=1}extract(e,t,...n){if(!e.attValue)throw new Error("Nothing to extract from attValue.");const r=t.call(this,e.attValue,e._cur,...n),i=e.attValue.slice(e._cur,r);return e._cur=r,i}atEnd(e){if(!e.attValue)throw new Error;return e._cur>=e.attValue.length}peekChar(e){if(!e.attValue)throw new Error;return e.attValue[e._cur]}peek(e,t){if(!e.attValue)throw new Error;for(let n=0;n<t.length;n++)if(t[n]!==e.attValue[e._cur+n])return!1;return!0}parseIceUfrag(e){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(e,f,[4,256])}parseIcePwd(e){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(e,f,[22,256])}parseIceOptions(e){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const t=[];for(;!this.atEnd(e);){t.push(this.extractOneOrMore(e,f));try{this.consumeAttributeSpace(e)}catch(t){if(this.atEnd(e))break;throw t}}this.attributes.iceOptions=t}parseFingerprint(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill);this.attributes.fingerprints.push({hashFunction:t,fingerprint:n})}parseExtmap(e){const t=this.extractOneOrMore(e,a);let n;"/"===this.peekChar(e)&&(this.extract(e,this.consume,"/"),n=this.extract(e,this.consumeToken)),this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeTill,o),i=y(y({entry:parseInt(t,10)},n&&{direction:n}),{},{extensionName:r});this.peekChar(e)===o&&(this.consumeAttributeSpace(e),i.extensionAttributes=this.extract(e,this.consumeTill)),this.attributes.extmaps.push(i)}parseSetup(e){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const t=this.extract(e,this.consumeTill);if("active"!==t&&"passive"!==t&&"actpass"!==t&&"holdconn"!==t)throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=t}}class S extends w{constructor(...e){super(...e),_(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"group":this.parseGroup(e);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"fingerprint":this.parseFingerprint(e);break;case"setup":this.parseSetup(e);break;case"tls-id":this.parseTlsId(e);break;case"identity":this.parseIdentity(e);break;case"extmap":this.parseExtmap(e);break;case"msid-semantic":this.parseMsidSemantic(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing session attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;)this.consumeAttributeSpace(e),n.push(this.extract(e,this.consumeToken));this.attributes.groups.push({semantic:t,identificationTag:n})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(e){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(e,g)}parseIdentity(e){const t=this.extractOneOrMore(e,m),n=[];for(;!this.atEnd(e)&&this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.extract(e,this.consume,"=");const r=this.extractOneOrMore(e,(e=>e!==o&&p(e)));n.push({name:t,value:r})}this.attributes.identities.push({assertionValue:t,extensions:n})}parseMsidSemantic(e){this.peekChar(e)===o&&this.consumeAttributeSpace(e);const t={semantic:this.extract(e,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(e)}catch(e){break}if("*"===this.peekChar(e)){this.extract(e,this.consume,"*"),t.applyForAll=!0;break}{const n=this.extract(e,this.consumeTill,o);t.identifierList.push(n)}}this.attributes.msidSemantic=t}}class T extends w{constructor(e){super(),_(this,"attributes",void 0),-1!==e.protos.indexOf("RTP")||e.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(e){if(this.digested)throw new Error("already digested");try{switch(e.attField){case"extmap":this.parseExtmap(e);break;case"setup":this.parseSetup(e);break;case"ice-ufrag":this.parseIceUfrag(e);break;case"ice-pwd":this.parseIcePwd(e);break;case"ice-options":this.parseIceOptions(e);break;case"candidate":this.parseCandidate(e);break;case"remote-candidate":this.parseRemoteCandidate(e);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(e);break;case"rtpmap":this.parseRtpmap(e);break;case"ptime":this.parsePtime(e);break;case"maxptime":this.parseMaxPtime(e);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(e);break;case"ssrc":this.parseSSRC(e);break;case"fmtp":this.parseFmtp(e);break;case"rtcp-fb":this.parseRtcpFb(e);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(e);break;case"mid":this.parseMid(e);break;case"msid":this.parseMsid(e);break;case"imageattr":this.parseImageAttr(e);break;case"rid":this.parseRid(e);break;case"simulcast":this.parseSimulcast(e);break;case"sctp-port":this.parseSctpPort(e);break;case"max-message-size":this.parseMaxMessageSize(e);break;case"ssrc-group":this.parseSSRCGroup(e);break;default:e.ignored=!0,this.attributes.unrecognized.push(e)}}catch(t){throw console.error("parsing media attribute ".concat(e.attField,' error, "a=').concat(e.attField,":").concat(e.attValue,'"')),t}if(!e.ignored&&e.attValue&&!this.atEnd(e))throw new Error("attribute parsing error")}parseCandidate(e){const t=this.extractOneOrMore(e,f,[1,32]);this.consumeAttributeSpace(e);const n=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const i=this.extractOneOrMore(e,a,[1,10]);this.consumeAttributeSpace(e);const s=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const u=this.extract(e,this.consumePort);this.consumeAttributeSpace(e),this.extract(e,this.consume,"typ"),this.consumeAttributeSpace(e);const l={foundation:t,componentId:n,transport:r,priority:i,connectionAddress:s,port:u,type:this.extract(e,this.consumeToken),extension:{}};for(this.peek(e," raddr")&&(this.extract(e,this.consume," raddr"),this.consumeAttributeSpace(e),l.relAddr=this.extract(e,this.consumeAddress)),this.peek(e," rport")&&(this.extract(e,this.consume," rport"),this.consumeAttributeSpace(e),l.relPort=this.extract(e,this.consumePort));this.peekChar(e)===o;){this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e),l.extension[t]=this.extractOneOrMore(e,c)}this.attributes.candidates.push(l)}parseRemoteCandidate(e){const t=[];for(;;){const n=this.extractOneOrMore(e,a,[1,5]);this.consumeAttributeSpace(e);const r=this.extract(e,this.consumeAddress);this.consumeAttributeSpace(e);const i=this.extract(e,this.consumePort);t.push({componentId:n,connectionAddress:r,port:i});try{this.consumeAttributeSpace(e)}catch(e){break}}this.attributes.remoteCandidatesList.push(t)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(e){const t=this.extract(e,this.consumeToken);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,"/");this.extract(e,this.consume,"/");const r={encodingName:n,clockRate:this.extractOneOrMore(e,a)};this.atEnd(e)||"/"!==this.peekChar(e)||(this.extract(e,this.consume,"/"),r.encodingParameters=parseInt(this.extract(e,this.consumeTill),10));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.rtpMap=r:this.attributes.payloads.push({payloadType:parseInt(t,10),rtpMap:r,rtcpFeedbacks:[]})}parsePtime(e){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(e,this.consumeTill)}parseMaxPtime(e){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(e,this.consumeTill)}parseDirection(e){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=e.attField}parseSSRC(e){const t=this.extractOneOrMore(e,a);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,":");let r;":"===this.peekChar(e)&&(this.extract(e,this.consume,":"),r=this.extract(e,this.consumeTill));const i=this.attributes.ssrcs.find((e=>e.ssrcId===parseInt(t,10)));i?i.attributes[n]=r:this.attributes.ssrcs.push({ssrcId:parseInt(t,10),attributes:{[n]:r}})}parseFmtp(e){const t=this.extract(e,this.consumeTill,o);this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill),r={};n.split(";").forEach((e=>{let[t,n]=e.split("=");t=t.trim();const i="string"==typeof n?n.trim():null;"string"==typeof t&&t.length>0&&(r[t]=i)}));const i=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));i?i.fmtp={parameters:r}:this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[],fmtp:{parameters:r}})}parseFmtParameters(e){const t={},n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");for(t[n]=r;";"===e.attValue[e._cur];){const n=this.extract(e,this.consumeTill,"=");e._cur++;const r=this.extract(e,this.consumeTill,";");t[n]=r}return t}parseRtcpFb(e){let t="";t="*"===this.peekChar(e)?this.extract(e,this.consume,"*"):this.extract(e,this.consumeTill,o),this.consumeAttributeSpace(e);const n=this.extract(e,this.consumeTill,o);let r;if("trr-int"===n)r={type:n,interval:this.extract(e,this.consumeTill)};else{const t={type:n};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.parameter=this.extract(e,this.consumeToken),this.peekChar(e)===o&&(t.additional=this.extract(e,this.consumeTill))),r=t}if("*"===t)this.attributes.rtcpFeedbackWildcards.push(r);else{const e=this.attributes.payloads.find((e=>e.payloadType===parseInt(t,10)));e?e.rtcpFeedbacks.push(r):this.attributes.payloads.push({payloadType:parseInt(t,10),rtcpFeedbacks:[r]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(e){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const t={port:this.extract(e,this.consumePort)};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.netType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.addressType=this.extractOneOrMore(e,l),this.consumeAttributeSpace(e),t.address=this.extract(e,this.consumeAddress)),this.attributes.rtcp=t}parseMsid(e){const t={id:this.extractOneOrMore(e,l,[1,64])};this.peekChar(e)===o&&(this.consumeAttributeSpace(e),t.appdata=this.extractOneOrMore(e,l,[1,64])),this.attributes.msids.push(t)}parseImageAttr(e){this.attributes.imageattr.push(e.attValue)}parseRid(e){const t=this.extractOneOrMore(e,(e=>h(e)||a(e)||"_"===e||"-"===e));this.consumeAttributeSpace(e);const n={id:t,direction:this.extract(e,this.consumeToken),params:[]};if(this.peekChar(e)===o){if(this.consumeAttributeSpace(e),this.peek(e,"pt=")){this.extract(e,this.consume,"pt=");const t=[];for(;;){const n=this.extract(e,this.consumeToken);t.push(n);try{this.extract(e,this.consume,",")}catch(e){break}}n.payloads=t,this.peekChar(e)===o&&this.extract(e,this.consume,o)}for(;;){const t=this.extract(e,this.consumeToken);switch(t){case"depend":{const r={type:t,rids:this.extract(e,this.consume,"=").split(",")};n.params.push(r);break}default:{const r={type:t};"="===this.peekChar(e)&&(this.extract(e,this.consume,"="),r.val=this.extract(e,this.consumeTill,";")),n.params.push(r)}}try{this.extract(e,this.consume,";")}catch(e){break}}}this.attributes.rids.push(n)}parseSimulcast(e){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=e.attValue,this.extract(e,this.consumeTill)}parseSctpPort(e){this.attributes.sctpPort=this.extractOneOrMore(e,a,[1,5])}parseMaxMessageSize(e){this.attributes.maxMessageSize=this.extractOneOrMore(e,a,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(e){this.attributes.mid=this.extract(e,this.consumeToken)}parseSSRCGroup(e){const t=this.extract(e,this.consumeToken),n=[];for(;;)try{this.consumeAttributeSpace(e);const t=this.extract(e,this.consumeInteger);n.push(parseInt(t,10))}catch(e){break}this.attributes.ssrcGroups.push({semantic:t,ssrcIds:n})}}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class R{constructor(){C(this,"eol",i)}print(e,t){let n="";return t&&(this.eol=t),n+=this.printVersion(e.version),n+=this.printOrigin(e.origin),n+=this.printSessionName(e.sessionName),n+=this.printInformation(e.information),n+=this.printUri(e.uri),n+=this.printEmail(e.emails),n+=this.printPhone(e.phones),n+=this.printConnection(e.connection),n+=this.printBandwidth(e.bandwidths),n+=this.printTimeFields(e.timeFields),n+=this.printKey(e.key),n+=this.printSessionAttributes(e.attributes),n+=this.printMediaDescription(e.mediaDescriptions),n}printVersion(e){return"v=".concat(e).concat(this.eol)}printOrigin(e){return"o=".concat(e.username," ").concat(e.sessId," ").concat(e.sessVersion," ").concat(e.nettype," ").concat(e.addrtype," ").concat(e.unicastAddress).concat(this.eol)}printSessionName(e){return e?"s=".concat(e).concat(this.eol):""}printInformation(e){return e?"i=".concat(e).concat(this.eol):""}printUri(e){return e?"u=".concat(e).concat(this.eol):""}printEmail(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printPhone(e){let t="";for(const n of e)t+="e=".concat(n).concat(this.eol);return t}printConnection(e){return e?"c=".concat(e.nettype," ").concat(e.addrtype," ").concat(e.address).concat(this.eol):""}printBandwidth(e){let t="";for(const n of e)t+="b=".concat(n.bwtype,":").concat(n.bandwidth).concat(this.eol);return t}printTimeFields(e){let t="";for(const n of e){t+="t=".concat(n.time.startTime," ").concat(n.time.startTime).concat(this.eol);for(const e of n.repeats)t+="r=".concat(e.repeatInterval," ").concat(e.typedTimes.join(" ")).concat(this.eol);n.zoneAdjustments&&(t+="z=",t+="z=".concat(n.zoneAdjustments.map((e=>"".concat(e.time," ").concat(e.back?"-":""," ").concat(e.typedTime))).join(" ")).concat(this.eol),t+=this.eol)}return t}printKey(e){return e?"k=".concat(e).concat(this.eol):""}printAttributes(e){let t="";for(const n of e)t+="a=".concat(n.attField).concat(n.attValue?":".concat(n.attValue):"").concat(this.eol);return t}printMediaDescription(e){let t="";for(const n of e)t+=this.printMedia(n.media),t+=this.printInformation(n.information),t+=this.printConnections(n.connections),t+=this.printBandwidth(n.bandwidths),t+=this.printKey(n.key),t+=this.printMediaAttributes(n);return t}printConnections(e){let t="";for(const n of e)t+=this.printConnection(n);return t}printMedia(e){return"m=".concat(e.mediaType," ").concat(e.port," ").concat(e.protos.join("/")," ").concat(e.fmts.join(" ")).concat(this.eol)}printSessionAttributes(e){return new O(this.eol).print(e)}printMediaAttributes(e){return new x(this.eol).print(e)}}class I{constructor(e){C(this,"eol",void 0),this.eol=e}printIceUfrag(e){return void 0===e?"":"a=ice-ufrag:".concat(e).concat(this.eol)}printIcePwd(e){return void 0===e?"":"a=ice-pwd:".concat(e).concat(this.eol)}printIceOptions(e){return void 0===e?"":"a=ice-options:".concat(e.join(o)).concat(this.eol)}printFingerprints(e){return e.length>0?e.map((e=>"a=fingerprint:".concat(e.hashFunction).concat(o).concat(e.fingerprint))).join(this.eol)+this.eol:""}printExtmap(e){return e.map((e=>"a=extmap:".concat(e.entry).concat(e.direction?"/".concat(e.direction):"").concat(o).concat(e.extensionName).concat(e.extensionAttributes?"".concat(o).concat(e.extensionAttributes):"").concat(this.eol))).join("")}printSetup(e){return void 0===e?"":"a=setup:".concat(e).concat(this.eol)}printUnrecognized(e){return e.map((e=>"a=".concat(e.attField).concat(e.attValue?":".concat(e.attValue):"").concat(this.eol))).join("")}}class O extends I{print(e){let t="";return t+=this.printGroups(e.groups),t+=this.printMsidSemantic(e.msidSemantic),t+=this.printIceLite(e.iceLite),t+=this.printIceUfrag(e.iceUfrag),t+=this.printIcePwd(e.icePwd),t+=this.printIceOptions(e.iceOptions),t+=this.printFingerprints(e.fingerprints),t+=this.printSetup(e.setup),t+=this.printTlsId(e.tlsId),t+=this.printIdentity(e.identities),t+=this.printExtmap(e.extmaps),t+=this.printUnrecognized(e.unrecognized),t}printGroups(e){let t="";return e.length>0&&(t+=e.map((e=>"a=group:".concat(e.semantic).concat(e.identificationTag.map((e=>"".concat(o).concat(e))).join("")).concat(this.eol))).join("")),t}printIceLite(e){return void 0===e?"":"a=ice-lite"+this.eol}printTlsId(e){return e?"a=tls-id:".concat(e).concat(this.eol):""}printIdentity(e){return 0===e.length?"":e.map((e=>"a=identity:".concat(e.assertionValue).concat(e.extensions.map((e=>"".concat(o).concat(e.name).concat(e.value?"=".concat(e.value):"")))))).join(this.eol)+this.eol}printMsidSemantic(e){if(!e)return"";let t="a=msid-semantic:".concat(e.semantic);return e.applyForAll?t+="".concat(o,"*"):e.identifierList.length>0&&(t+=e.identifierList.map((e=>"".concat(o).concat(e)))),t+this.eol}}class x extends I{print(e){const t=e.attributes;let n="";return n+=this.printRTCP(t.rtcp),n+=this.printIceUfrag(t.iceUfrag),n+=this.printIcePwd(t.icePwd),n+=this.printIceOptions(t.iceOptions),n+=this.printCandidates(t.candidates),n+=this.printRemoteCandidatesList(t.remoteCandidatesList),n+=this.printEndOfCandidates(t.endOfCandidates),n+=this.printFingerprints(t.fingerprints),n+=this.printSetup(t.setup),n+=this.printMid(t.mid),n+=this.printExtmap(t.extmaps),n+=this.printRTPRelated(t),n+=this.printPtime(t.ptime),n+=this.printMaxPtime(t.maxPtime),n+=this.printDirection(t.direction),n+=this.printSSRCGroups(t.ssrcGroups),n+=this.printSSRC(t.ssrcs),n+=this.printRTCPMux(t.rtcpMux),n+=this.printRTCPMuxOnly(t.rtcpMuxOnly),n+=this.printRTCPRsize(t.rtcpRsize),n+=this.printMSId(t.msids),n+=this.printImageattr(t.imageattr),n+=this.printRid(t.rids),n+=this.printSimulcast(t.simulcast),n+=this.printSCTPPort(t.sctpPort),n+=this.printMaxMessageSize(t.maxMessageSize),n+=this.printUnrecognized(t.unrecognized),n}printCandidates(e){return e.map((e=>"a=candidate:".concat(e.foundation).concat(o).concat(e.componentId).concat(o).concat(e.transport).concat(o).concat(e.priority).concat(o).concat(e.connectionAddress).concat(o).concat(e.port).concat(o,"typ").concat(o).concat(e.type).concat(e.relAddr?"".concat(o,"raddr").concat(o).concat(e.relAddr):"").concat(e.relPort?"".concat(o,"rport").concat(o).concat(e.relPort):"").concat(Object.keys(e.extension).map((t=>"".concat(o).concat(t).concat(o).concat(e.extension[t]))).join("")).concat(this.eol))).join("")}printRemoteCandidatesList(e){return e.map((e=>"a=remote-candidates:".concat(e.join(o)).concat(this.eol))).join("")}printEndOfCandidates(e){return void 0===e?"":"a=end-of-candidates"+this.eol}printRTPRelated(e){if(!e.payloads)return"";const t=e.payloads;let n="";n+=e.rtcpFeedbackWildcards.map((e=>this.printRTCPFeedback("*",e))).join("");for(const e of t)n+=this.printRtpMap(e.payloadType,e.rtpMap),n+=this.printFmtp(e.payloadType,e.fmtp),n+=e.rtcpFeedbacks.map((t=>this.printRTCPFeedback(e.payloadType,t))).join("");return n}printFmtp(e,t){if(!t)return"";const n=Object.keys(t.parameters);return 1===n.length&&null===t.parameters[n[0]]?"a=fmtp:".concat(e).concat(o).concat(n[0]).concat(this.eol):"a=fmtp:".concat(e).concat(o).concat(Object.keys(t.parameters).map((e=>"".concat(e,"=").concat(t.parameters[e]))).join(";")).concat(this.eol)}printRtpMap(e,t){return t?"a=rtpmap:".concat(e).concat(o).concat(t.encodingName,"/").concat(t.clockRate).concat(t.encodingParameters?"/".concat(t.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(e,t){let n="a=rtcp-fb:".concat(e).concat(o),r=t;if("trr-int"===r.type)n+="ttr-int".concat(o).concat(r.interval);else r=r,n+="".concat(r.type),r.parameter&&(n+="".concat(o).concat(r.parameter),r.additional&&(n+="".concat(o).concat(r.additional)));return n+this.eol}printPtime(e){return void 0===e?"":"a=ptime:".concat(e).concat(this.eol)}printMaxPtime(e){return void 0===e?"":"a=maxptime:".concat(e).concat(this.eol)}printDirection(e){return void 0===e?"":"a=".concat(e).concat(this.eol)}printSSRC(e){return e.map((e=>Object.keys(e.attributes).map((t=>"a=ssrc:".concat(e.ssrcId.toString(10)).concat(o).concat(t).concat(e.attributes[t]?":".concat(e.attributes[t]):"").concat(this.eol))).join(""))).join("")}printRTCPMux(e){return void 0===e?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(e){return void 0===e?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(e){return void 0===e?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(e){if(void 0===e)return"";let t="a=rtcp:".concat(e.port);return e.netType&&(t+="".concat(o).concat(e.netType)),e.addressType&&(t+="".concat(o).concat(e.addressType)),e.address&&(t+="".concat(o).concat(e.address)),t+this.eol}printMSId(e){return e.map((e=>"a=msid:".concat(e.id).concat(e.appdata?"".concat(o).concat(e.appdata):"").concat(this.eol))).join("")}printImageattr(e){return e.map((e=>"a=imageattr:".concat(e).concat(this.eol))).join("")}printRid(e){return e.map((e=>{let t="a=rid:".concat(e.id).concat(o).concat(e.direction);return e.payloads&&(t+="".concat(o,"pt=").concat(e.payloads.join(","))),e.params.length>0&&(t+="".concat(o).concat(e.params.map((e=>"depend"===e.type?"depend=".concat(e.rids.join(",")):"".concat(e.type,"=").concat(e.val))).join(";"))),t+this.eol})).join("")}printSimulcast(e){return void 0===e?"":"a=simulcast:".concat(e).concat(this.eol)}printSCTPPort(e){return void 0===e?"":"a=sctp-port:".concat(e).concat(this.eol)}printMaxMessageSize(e){return void 0===e?"":"a=max-message-size:".concat(e).concat(this.eol)}printMid(e){return void 0===e?"":"a=mid:".concat(e).concat(this.eol)}printSSRCGroups(e){return e.map((e=>"a=ssrc-group:".concat(e.semantic).concat(e.ssrcIds.map((e=>"".concat(o).concat(e.toString(10)))).join("")).concat(this.eol))).join("")}}function N(e){return(new b).parse(e)}function B(e,t){return(new R).print(e,t)}}},t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(8)})()}(YC);class fR{constructor(e){Kh(this,"sessionDesc",void 0),Kh(this,"localCapabilities",void 0),Kh(this,"rtpCapabilities",void 0),Kh(this,"candidates",void 0),Kh(this,"iceParameters",void 0),Kh(this,"dtlsParameters",void 0),Kh(this,"setup",void 0),Kh(this,"currentMidIndex",void 0),Kh(this,"cname",void 0),e=Ib(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:s,sdkCodec:a,cname:c}=e,u=YC.exports.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE audio video\na=msid-semantic: WMS\na=ice-lite\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:audio\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendrecv\na=rtcp-mux\na=rtcp-rsize\na=mid:video\n");this.rtpCapabilities=i,this.candidates=r,this.iceParameters=t,this.dtlsParameters=n,this.setup=o,this.localCapabilities=s,this.cname=c;for(let e=0;e<u.mediaDescriptions.length;e++){const s=u.mediaDescriptions[e];s.attributes.iceUfrag=t.iceUfrag,s.attributes.icePwd=t.icePwd,s.attributes.fingerprints=n.fingerprints,s.attributes.candidates=r,s.attributes.setup=o,"video"===s.media.mediaType&&(s.media.fmts=i.videoCodecs.map((e=>e.payloadType.toString(10))),s.attributes.payloads=i.videoCodecs,s.attributes.extmaps=i.videoExtensions),"audio"===s.media.mediaType&&(s.media.fmts=i.audioCodecs.map((e=>e.payloadType.toString(10))),s.attributes.payloads=i.audioCodecs,s.attributes.extmaps=i.audioExtensions),u.mediaDescriptions[e]=this.mungMediaDesc(s)}this.sessionDesc=u,this.currentMidIndex=u.mediaDescriptions.length-1}toString(){return YC.exports.print(this.sessionDesc)}send(e,t,n){const{ssrcs:r,ssrcGroups:i}=nR(t,this.cname),o=this.sessionDesc.mediaDescriptions.find((t=>e===Xm.VIDEO?"video"===t.media.mediaType:"audio"===t.media.mediaType)),s=r[0].attributes.label,a=r[0].attributes.mslabel;return o.attributes.ssrcs=o.attributes.ssrcs.concat(r),o.attributes.ssrcGroups=o.attributes.ssrcGroups.concat(i),{id:s,mslabel:a}}batchSend(e){return e.map((e=>{let{kind:t,ssrcMsg:n}=e;return this.send(t,n,void 0)}))}stopSending(e){this.sessionDesc.mediaDescriptions.forEach((t=>{const n=[],r=[],i=[];t.attributes.ssrcs.forEach((t=>{e.includes(t.attributes.label||"")?i.push(t):n.push(t)})),t.attributes.ssrcGroups.forEach((e=>{i.map((e=>e.ssrcId)).includes(e.ssrcIds[0])||r.push(e)})),t.attributes.ssrcs=n,t.attributes.ssrcGroups=r}))}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}receive(e,t,n){e.forEach(((e,t)=>{const n=e._mediaStreamTrack,r=this.sessionDesc.mediaDescriptions.findIndex((e=>e.attributes.mid===n.kind)),i=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],e);this.sessionDesc.mediaDescriptions[r]=i}))}stopReceiving(e){}updateCandidates(e){e===Jm.TCP?this.candidates.forEach((e=>{-1===this.candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this.candidates.push(pR(pR({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this.candidates=this.candidates.filter((e=>"tcp"!==e.transport));for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(e){e=Ib(e),this.iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}mungRecvMediaDsec(e,t){const n=Ib(e);return rR(n,t),oR(n,t),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}updateTrackLabel(e,t,n){const r=this.sessionDesc.mediaDescriptions.find((t=>e===Xm.VIDEO?"video"===t.attributes.mid:"audio"===t.attributes.mid));if(r){const e=r.attributes.ssrcs.find((e=>e.attributes.label===t));var i;e&&(e.attributes.label=n,null===(i=e.attributes.msid)||void 0===i||i.replace(t,n))}}mungMediaDesc(e){const t=Ib(e);return iR(t),function(e){const t=e.attributes.extmaps.find((e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.extensionName));t&&e.attributes.extmaps.splice(e.attributes.extmaps.indexOf(t),1),e.attributes.payloads.forEach((e=>{const t=e.rtcpFeedbacks.findIndex((e=>"transport-cc"===e.type));-1!==t&&e.rtcpFeedbacks.splice(t,1)}))}(t),t}getSSRC(e){for(const t of this.sessionDesc.mediaDescriptions)for(const n of t.attributes.ssrcs)if(n.attributes.label===e)return[n]}}function gR(e){if(Array.isArray(e))return e.map((e=>e));if(!mR(e))return e;const t={};for(const n in e)mR(e[n])||Array.isArray(e[n])?t[n]=gR(e[n]):t[n]=e[n];return t}function mR(e){return!("object"!=typeof e||Array.isArray(e)||!e)}function vR(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}function yR(e){return!!window.RTCStatsReport&&e.getStats()instanceof Zl}class _R{constructor(e){Kh(this,"input",[]),Kh(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return 0===this.input.length?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const ER={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},bR={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:ER,remoteCandidate:ER}},wR={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},SR={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},TR={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},CR={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function RR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function IR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?RR(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class OR{constructor(e,t){Kh(this,"onFirstVideoReceived",void 0),Kh(this,"onFirstVideoDecoded",void 0),Kh(this,"onFirstAudioReceived",void 0),Kh(this,"onFirstVideoDecodedTimeout",void 0),Kh(this,"onFirstAudioDecoded",void 0),Kh(this,"onSelectedLocalCandidateChanged",void 0),Kh(this,"onSelectedRemoteCandidateChanged",void 0),Kh(this,"videoIsReady",!1),Kh(this,"videoIsReady2",{}),Kh(this,"pc",void 0),Kh(this,"options",void 0),Kh(this,"intervalTimer",void 0),Kh(this,"stats",gR(bR)),Kh(this,"isFirstVideoReceived",{}),Kh(this,"isFirstVideoDecoded",{}),Kh(this,"isFirstAudioReceived",{}),Kh(this,"isFirstAudioDecoded",{}),Kh(this,"isFirstVideoDecodedTimeout",{}),Kh(this,"lossRateWindowStats",[]),this.pc=e,this.options=t,this.intervalTimer=window.setInterval((async()=>{this.updateStats()}),this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new Zl((e=>{e({local:IR({},ER),remote:IR({},ER)})}))}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,t){this.videoIsReady2[e]=t}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const t=this.lossRateWindowStats.length,n=["videoSend","audioSend","videoRecv","audioRecv"];let r=0,i=0,o=0,s=0;for(const a of n)e[a].forEach(((e,n)=>{if(!this.lossRateWindowStats[t-1][a][n]||!this.lossRateWindowStats[0][a][n])return;const c=this.lossRateWindowStats[t-1][a][n].packets-this.lossRateWindowStats[0][a][n].packets,u=this.lossRateWindowStats[t-1][a][n].packetsLost-this.lossRateWindowStats[0][a][n].packetsLost;"videoSend"===a||"audioSend"===a?(r+=c,o+=u):(i+=c,s+=u),Number.isNaN(c)||Number.isNaN(c)?e.packetLostRate=0:e.packetLostRate=c<=0||u<=0?0:u/(c+u)}));e.sendPacketLossRate=r<=0||o<=0?0:o/(r+o),e.recvPacketLossRate=i<=0||s<=0?0:s/(i+s)}}function xR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function NR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xR(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class BR extends OR{constructor(){super(...arguments),Kh(this,"_stats",bR),Kh(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),t=this.statsResponsesToObjects(e);this._stats=gR(bR);const n=t.filter((e=>"ssrc"===e.type));this.processSSRCStats(n);const r=t.find((e=>"VideoBwe"===e.type));r&&this.processBandwidthStats(r),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach((e=>{const t=e.id.includes("send");switch("".concat(e.mediaType,"_").concat(t?"send":"recv")){case"video_send":{const t=gR(SR);t.codec=e.googCodecName,t.adaptionChangeReason="none",e.googCpuLimitedResolution&&(t.adaptionChangeReason="cpu"),e.googBandwidthLimitedResolution&&(t.adaptionChangeReason="bandwidth"),t.avgEncodeMs=Number(e.googAvgEncodeMs),t.inputFrame={width:Number(e.googFrameWidthInput)||Number(e.googFrameWidthSent),height:Number(e.googFrameHeightInput)||Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.sentFrame={width:Number(e.googFrameWidthSent),height:Number(e.googFrameHeightSent),frameRate:Number(e.googFrameRateInput)},t.firsCount=Number(e.googFirReceived),t.nacksCount=Number(e.googNacksReceived),t.plisCount=Number(e.googPlisReceived),t.frameCount=Number(e.framesEncoded),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.videoSend.push(t),this._stats.rtt=t.rttMs;break}case"video_recv":{const t=gR(wR),n=this.lastDecodeVideoReceiverStats.get(Number(e.ssrc));if(t.codec=e.googCodecName,t.targetDelayMs=Number(e.googTargetDelayMs),t.renderDelayMs=Number(e.googRenderDelayMs),t.currentDelayMs=Number(e.googCurrentDelayMs),t.minPlayoutDelayMs=Number(e.googMinPlayoutDelayMs),t.decodeMs=Number(e.googDecodeMs),t.maxDecodeMs=Number(e.googMaxDecodeMs),t.receivedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateReceived)},t.decodedFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateDecoded)},t.decodeFrameRate=Number(e.googFrameRateDecoded),t.outputFrame={width:Number(e.googFrameWidthReceived),height:Number(e.googFrameHeightReceived),frameRate:Number(e.googFrameRateOutput)},t.jitterBufferMs=Number(e.googJitterBufferMs),t.firsCount=Number(e.googFirsSent),t.nacksCount=Number(e.googNacksSent),t.plisCount=Number(e.googPlisSent),t.framesDecodeCount=Number(e.framesDecoded),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,t.decodedFrame.width,t.decodedFrame.height),this.isFirstVideoDecoded[t.ssrc]=!0),n){const r=n.stats,i=Date.now()-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=i,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc,10))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<n.stats.framesDecodeCount&&(t.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:NR({},t),lts:Date.now()}),this._stats.videoRecv.push(t);break}case"audio_recv":{const t=gR(CR);t.codec=e.googCodecName,t.outputLevel=Math.abs(Number(e.audioOutputLevel))/32767,t.decodingCNG=Number(e.googDecodingCNG),t.decodingCTN=Number(e.googDecodingCTN),t.decodingCTSG=Number(e.googDecodingCTSG),t.decodingNormal=Number(e.googDecodingNormal),t.decodingPLC=Number(e.googDecodingPLC),t.decodingPLCCNG=Number(e.googDecodingPLCCNG),t.expandRate=Number(e.googExpandRate),t.accelerateRate=Number(e.googAccelerateRate),t.preemptiveExpandRate=Number(e.googPreemptiveExpandRate),t.secondaryDecodedRate=Number(e.googSecondaryDecodedRate),t.speechExpandRate=Number(e.googSpeechExpandRate),t.preferredJitterBufferMs=Number(e.googPreferredJitterBufferMs),t.jitterBufferMs=Number(e.googJitterBufferMs),t.jitterMs=Number(e.googJitterReceived),t.bytes=Number(e.bytesReceived),t.packets=Number(e.packetsReceived),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.receivedFrames=Number(e.googDecodingCTN)||Number(e.packetsReceived),t.droppedFrames=Number(e.googDecodingPLC)+Number(e.googDecodingPLCCNG)||Number(e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.decodingNormal>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),this._stats.audioRecv.push(t);break}case"audio_send":{const t=gR(TR);t.codec=e.googCodecName,t.inputLevel=Math.abs(Number(e.audioInputLevel))/32767,t.aecReturnLoss=Number(e.googEchoCancellationReturnLoss||0),t.aecReturnLossEnhancement=Number(e.googEchoCancellationReturnLossEnhancement||0),t.residualEchoLikelihood=Number(e.googResidualEchoLikelihood||0),t.residualEchoLikelihoodRecentMax=Number(e.googResidualEchoLikelihoodRecentMax||0),t.bytes=Number(e.bytesSent),t.packets=Number(e.packetsSent),t.packetsLost=Number(e.packetsLost),t.ssrc=Number(e.ssrc),t.rttMs=Number(e.googRtt||0),this._stats.rtt=t.rttMs,this._stats.audioSend.push(t);break}}}))}_getStats(){return new Zl(((e,t)=>{this.pc.getStats(e,t)}))}statsResponsesToObjects(e){const t=[];return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp.valueOf().toString(),type:e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t.push(n)})),t}}function LR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function DR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?LR(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):LR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class MR extends OR{constructor(){super(...arguments),Kh(this,"_stats",bR),Kh(this,"report",void 0),Kh(this,"lastDecodeVideoReceiverStats",new Map),Kh(this,"lastVideoFramesRecv",new Map),Kh(this,"lastVideoFramesSent",new Map),Kh(this,"lastVideoFramesDecode",new Map),Kh(this,"lastVideoJBDelay",new Map),Kh(this,"lastAudioJBDelay",new Map),Kh(this,"mediaBytesSent",new Map),Kh(this,"mediaBytesRetransmit",new Map),Kh(this,"mediaBytesTargetEncode",new Map),Kh(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=gR(bR),this.report.forEach((e=>{switch(e.type){case dh.OUTBOUND:"audio"===e.mediaType?this.processAudioOutboundStats(e):"video"===e.mediaType&&this.processVideoOutboundStats(e);break;case dh.INBOUND:"audio"===e.mediaType?this.processAudioInboundStats(e):"video"===e.mediaType&&this.processVideoInboundStats(e);break;case dh.TRANSPORT:{const t=this.report.get(e.selectedCandidatePairId);t&&this.processCandidatePairStats(t);break}case dh.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}})),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),t={local:DR({},ER),remote:DR({},ER)};return e.forEach((n=>{let r;if(n.type===dh.TRANSPORT&&(r=e.get(n.selectedCandidatePairId)),n.type===dh.CANDIDATE_PAIR&&n.selected&&(r=n),r){const n=(e,t)=>{e.type=t.type,e.id=t.id,t.address&&(e.address=t.address),t.candidateType&&(e.candidateType=t.candidateType),t.port&&(e.port=t.port),t.priority&&(e.priority=t.priority),t.protocol&&(e.protocol=t.protocol),t.relayProtocol&&(e.relayProtocol=t.relayProtocol)};if(r.localCandidateId){const i=e.get(r.localCandidateId);i&&n(t.local,i)}if(r.remoteCandidateId){const i=e.get(r.remoteCandidateId);i&&n(t.remote,i)}}})),t}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.audioSend.forEach((t=>{e.currentRoundTripTime&&(t.rttMs=1e3*e.currentRoundTripTime)})),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const t=this.report.get(e.localCandidateId);t&&this.processCandidateStats(t)}if(e.remoteCandidateId){const t=this.report.get(e.remoteCandidateId);t&&this.processCandidateStats(t)}}processCandidateStats(e){let t;e.type===dh.LOCAL_CANDIDATE&&(t=this._stats.selectedCandidatePair.localCandidate),e.type===dh.REMOTE_CANDIDATE&&(t=this._stats.selectedCandidatePair.remoteCandidate),t&&(t.type=e.type,t.id=e.id,e.address&&(t.address=e.address),e.candidateType&&(t.candidateType=e.candidateType),e.port&&(t.port=e.port),e.priority&&(t.priority=e.priority),e.protocol&&(t.protocol=e.protocol),e.relayProtocol&&(t.relayProtocol=e.relayProtocol),e.type===dh.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==t.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(DR({},t),DR({},this.stats.selectedCandidatePair.localCandidate)),e.type===dh.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==t.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(DR({},t),DR({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let t=this._stats.audioRecv.find((t=>t.ssrc===e.ssrc));t||(t=gR(CR),this._stats.audioRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.jitterMs=1e3*e.jitter,this.processAudioTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),t.receivedFrames||(t.receivedFrames=e.packetsReceived),t.droppedFrames||(t.droppedFrames=e.packetsLost),t.receivedFrames>0&&!this.isFirstAudioReceived[t.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(t.ssrc),this.isFirstAudioReceived[t.ssrc]=!0),t.outputLevel&&t.outputLevel>0&&!this.isFirstAudioDecoded[t.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(t.ssrc),this.isFirstAudioDecoded[t.ssrc]=!0),"number"==typeof e.concealedSamples&&(t.concealedSamples=e.concealedSamples)}processVideoInboundStats(e){let t=this._stats.videoRecv.find((t=>t.ssrc===e.ssrc));t||(t=gR(wR),this._stats.videoRecv.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsReceived,t.packetsLost=e.packetsLost,t.bytes=e.bytesReceived,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.framesDecodeCount=e.framesDecoded,t.totalInterFrameDelay=e.totalInterFrameDelay,t.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay;const n=this.lastDecodeVideoReceiverStats.get(t.ssrc),r=this.lastVideoFramesDecode.get(t.ssrc),i=Date.now();if(t.framesDecodeCount>0&&!this.isFirstVideoDecoded[t.ssrc]){const e=t.decodedFrame?t.decodedFrame.width:0,n=t.decodedFrame?t.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(t.ssrc,e,n),this.isFirstVideoDecoded[t.ssrc]=!0}if(n){const r=n.stats,o=i-n.lts;t.framesDecodeFreezeTime=r.framesDecodeFreezeTime,t.framesDecodeInterval=r.framesDecodeInterval,!this.isFirstVideoDecoded[t.ssrc]&&o>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[t.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(t.ssrc),this.isFirstVideoDecodedTimeout[t.ssrc]=!0),t.framesDecodeCount>r.framesDecodeCount&&this.isFirstVideoDecoded[t.ssrc]?(n.lts=Date.now(),t.framesDecodeInterval=o,t.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?t.framesDecodeFreezeTime+=t.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):t.framesDecodeCount<r.framesDecodeCount&&(t.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(n.stats.framesDecodeCount>e.framesDecoded?t.qpSumPerFrame=e.qpSum/e.framesDecoded:t.qpSumPerFrame=(e.qpSum-n.qpSum)/(e.framesDecoded-n.stats.framesDecodeCount))}r&&i-r.lts>=800?(t.decodeFrameRate=Math.round((t.framesDecodeCount-r.count)/((i-r.lts)/1e3)),this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:t.decodeFrameRate})):r?t.decodeFrameRate=r.rate:this.lastVideoFramesDecode.set(t.ssrc,{count:t.framesDecodeCount,lts:i,rate:0}),e.totalDecodeTime&&(t.decodeMs=1e3*e.totalDecodeTime),this.processVideoTrackReceiverStats(e,e.trackId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(t.framesRateFirefox=e.framerateMean),t.packets>0&&!this.isFirstVideoReceived[t.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(t.ssrc),this.isFirstVideoReceived[t.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(t.ssrc,{stats:DR({},t),lts:n?n.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let t=this._stats.videoSend.find((t=>t.ssrc===e.ssrc));t||(t=gR(SR),this._stats.videoSend.push(t));const n=this.mediaBytesSent.get(e.ssrc);if(n)n.add(e.bytesSent);else{const t=new _R(10);t.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,t)}if(void 0!==e.retransmittedBytesSent){const t=this.mediaBytesRetransmit.get(e.ssrc);if(t)t.add(e.retransmittedBytesSent);else{const t=new _R(10);t.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,t)}}if(e.totalEncodedBytesTarget){const t=this.mediaBytesTargetEncode.get(e.ssrc);if(t)t.add(e.totalEncodedBytesTarget);else{const t=new _R(10);t.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,t)}}if(t.ssrc=e.ssrc,t.bytes=e.bytesSent,t.packets=e.packetsSent,t.firsCount=e.firCount,t.nacksCount=e.nackCount,t.plisCount=e.pliCount,t.frameCount=e.framesEncoded,t.adaptionChangeReason=e.qualityLimitationReason,t.scalabilityMode=e.scalabilityMode,e.totalEncodeTime&&e.framesEncoded){const n=this.lastEncoderMs.get(e.ssrc);if(!n||n.lastFrameCount>e.framesEncoded)t.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const r=e.framesEncoded-n.lastFrameCount,i=e.totalEncodeTime-n.lastEncoderTime;t.avgEncodeMs=1e3*i/r}}if(e.framesEncoded&&e.qpSum){const n=this.lastEncoderMs.get(e.ssrc);!n||n.lastFrameCount>e.framesEncoded?t.qpSumPerFrame=e.qpSum/e.framesEncoded:t.qpSumPerFrame=(e.qpSum-n.lastQpSum)/(e.framesEncoded-n.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,t),this.processVideoTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,dh.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}processAudioOutboundStats(e){let t=this._stats.audioSend.find((t=>t.ssrc===e.ssrc));if(t||(t=gR(TR),this._stats.audioSend.push(t)),t.ssrc=e.ssrc,t.packets=e.packetsSent,t.bytes=e.bytesSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,t),e.codecId&&(t.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,t),e.remoteId)this.processRemoteInboundStats(e.remoteId,t);else{const n=this.findRemoteStatsId(e.ssrc,dh.REMOTE_INBOUND);n&&this.processRemoteInboundStats(n,t)}}findRemoteStatsId(e,t){var n;const r=Array.from(H_(n=this.report).call(n)).find((n=>n.type===t&&n.ssrc===e));return r?r.id:null}processVideoMediaSource(e,t){const n=this.report.get(e);n&&n.width&&n.height&&n.framesPerSecond&&(t.inputFrame={width:n.width,height:n.height,frameRate:n.framesPerSecond})}processAudioMediaSource(e,t){const n=this.report.get(e);n&&(t.inputLevel=n.audioLevel)}processVideoTrackSenderStats(e,t,n){var r,i,o;const s=t?this.report.get(t):void 0,a=null!==(r=null==s?void 0:s.framesSent)&&void 0!==r?r:e.framesSent;let c=null!==(i=null==s?void 0:s.frameWidth)&&void 0!==i?i:e.frameWidth,u=null!==(o=null==s?void 0:s.frameHeight)&&void 0!==o?o:e.frameHeight;if("number"!=typeof a)return;"number"==typeof c&&"number"==typeof u||(c=0,u=0);let l=0;const A=Date.now(),h=this.lastVideoFramesSent.get(n.ssrc);h&&A-h.lts>=800?(l=Math.round((a-h.count)/((A-h.lts)/1e3)),this.lastVideoFramesSent.set(n.ssrc,{count:a,lts:A,rate:l})):h?l=h.rate:this.lastVideoFramesSent.set(n.ssrc,{count:a,lts:A,rate:0}),n.sentFrame={width:c,height:u,frameRate:Math.max(0,l)}}processVideoTrackReceiverStats(e,t,n){var r,i,o,s,a;const c=t?this.report.get(t):void 0,u=null!==(r=null==c?void 0:c.framesReceived)&&void 0!==r?r:e.framesReceived,l=null!==(i=null==c?void 0:c.frameWidth)&&void 0!==i?i:e.frameWidth,A=null!==(o=null==c?void 0:c.frameHeight)&&void 0!==o?o:e.frameHeight,h=null!==(s=null==c?void 0:c.jitterBufferDelay)&&void 0!==s?s:e.jitterBufferDelay,d=null!==(a=null==c?void 0:c.jitterBufferEmittedCount)&&void 0!==a?a:e.jitterBufferEmittedCount;if("number"==typeof u){const e=this.lastVideoFramesRecv.get(n.ssrc),t=Date.now();n.framesReceivedCount=u;let r=0;e&&t-e.lts>=800?(r=Math.round((u-e.count)/((t-e.lts)/1e3)),this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:t,rate:r})):e?r=e.rate:this.lastVideoFramesRecv.set(n.ssrc,{count:u,lts:t,rate:0}),n.receivedFrame={width:l||0,height:A||0,frameRate:r||0},n.decodedFrame={width:l||0,height:A||0,frameRate:n.decodeFrameRate||0},n.outputFrame={width:l||0,height:A||0,frameRate:n.decodeFrameRate||0}}if(h&&d){let e=this.lastVideoJBDelay.get(n.ssrc);this.lastVideoJBDelay.set(n.ssrc,{jitterBufferDelay:h,jitterBufferEmittedCount:d}),e||(e={jitterBufferDelay:0,jitterBufferEmittedCount:0});const t=1e3*(h-e.jitterBufferDelay)/(d-e.jitterBufferEmittedCount);n.jitterBufferMs=t,n.currentDelayMs=Math.round(t)}}processAudioTrackSenderStats(e,t,n){var r,i,o,s;const a=t?this.report.get(t):void 0,c=null!==(r=null!==(i=null==a?void 0:a.echoReturnLoss)&&void 0!==i?i:e.echoReturnLoss)&&void 0!==r?r:0,u=null!==(o=null!==(s=null==a?void 0:a.echoReturnLossEnhancement)&&void 0!==s?s:e.echoReturnLossEnhancement)&&void 0!==o?o:0;n.aecReturnLoss=c,n.aecReturnLossEnhancement=u}processAudioTrackReceiverStats(e,t,n){var r,i,o,s,a,c,u;const l=t?this.report.get(t):void 0,A=null!==(r=null==l?void 0:l.removedSamplesForAcceleration)&&void 0!==r?r:e.removedSamplesForAcceleration,h=null!==(i=null==l?void 0:l.totalSamplesReceived)&&void 0!==i?i:e.totalSamplesReceived,d=null!==(o=null==l?void 0:l.jitterBufferDelay)&&void 0!==o?o:e.jitterBufferDelay,p=null!==(s=null==l?void 0:l.jitterBufferEmittedCount)&&void 0!==s?s:e.jitterBufferEmittedCount,f=null!==(a=null==l?void 0:l.audioLevel)&&void 0!==a?a:null==e?void 0:e.audioLevel,g=null!==(c=null==l?void 0:l.totalSamplesDuration)&&void 0!==c?c:null==e?void 0:e.totalSamplesDuration,m=null!==(u=null==l?void 0:l.concealedSamples)&&void 0!==u?u:e.concealedSamples;if(A&&h&&(n.accelerateRate=A/h),d&&p){let e=this.lastAudioJBDelay.get(n.ssrc);this.lastAudioJBDelay.set(n.ssrc,{jitterBufferDelay:d,jitterBufferEmittedCount:p}),e||(e={jitterBufferDelay:0,jitterBufferEmittedCount:0});const t=1e3*(d-e.jitterBufferDelay)/(p-e.jitterBufferEmittedCount);n.jitterBufferMs=Math.round(t)}n.outputLevel=f;let v=1920;g&&h&&(v=h/g/50,n.receivedFrames=Math.round(h/v)),m&&(n.droppedFrames=Math.round(m/v))}processRemoteInboundStats(e,t){const n=this.report.get(e);n&&(t.packetsLost=n.packetsLost,n.roundTripTime&&(t.rttMs=1e3*n.roundTripTime))}getCodecFromCodecStats(e){const t=this.report.get(e);if(!t)return"";const n=t.mimeType.match(/\/(.*)$/);return n&&n[1]?n[1]:""}updateSendBitrate(){let e=0,t=null,n=null;this.mediaBytesSent.forEach((t=>{e+=t.diffMean()})),this.mediaBytesRetransmit.forEach((e=>{t=null===t?e.diffMean():t+e.diffMean()})),this.mediaBytesTargetEncode.forEach((e=>{n=null===n?e.diffMean():n+e.diffMean()}));const r=null!==t?e-t:e;this._stats.bitrate={actualEncoded:8*r/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},null!==t&&(this._stats.bitrate.retransmit=8*t/(this.options.updateInterval/1e3)),null!==n&&(this._stats.bitrate.targetEncoded=8*n/(this.options.updateInterval/1e3))}}class PR extends OR{updateStats(){return Zl.resolve()}}function kR(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:500,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4;const o=vR();return o?o<76?new BR(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new MR(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):yR(e)?new MR(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i}):new PR(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:i})}var UR;function FR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function HR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?FR(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let VR=(Ry((UR=class e extends gv{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,n){super(t,n),Kh(this,"store",void 0),Kh(this,"peerConnection",void 0),Kh(this,"remoteSDP",void 0),Kh(this,"initialOffer",void 0),Kh(this,"statsFilter",void 0),Kh(this,"useRTX",!1),Kh(this,"localCapabilities",void 0),Kh(this,"localCandidateCount",0),Kh(this,"allCandidatesReceived",!1),Kh(this,"establishPromise",void 0),Kh(this,"mutex",new n_("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=kR(this.peerConnection,df("STATS_UPDATE_INTERVAL"),void 0,bh()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const e=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=$C(e.sdp),n=ZC(e.sdp,!this.useRTX,df("FILTER_VIDEO_FEC"),df("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=n,this.initialOffer=e,HR(HR({},t),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:n},offerSDP:e.sdp})}catch(e){throw new Qp(Vp.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new fR({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r.send,remoteSetup:i,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:o});const s=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}send(e,t){var n=this;return GC((function*(){const r=yield KC(n.mutex.lock());try{if(!n.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const i=e.map((e=>n.peerConnection.addTrack(e._mediaStreamTrack))),o=yield KC(n.peerConnection.createOffer()),s=YC.exports.parse(o.sdp),a=e.map((e=>{const t=e._mediaStreamTrack,r=s.mediaDescriptions.find((e=>e.attributes.mid===t.kind));if(!r)throw new Error("Cannot extract ssrc from mediaDescription.");return function(e,t,n){const r=e.attributes.ssrcs.filter((e=>e.attributes.label===t)),i=e.attributes.ssrcGroups;if(0===r.length)throw new Error("Cannot extract ssrc from plan-b SDP.");if(i&&r.length>1){const e=i.find((e=>-1!==e.ssrcIds.indexOf(r[0].ssrcId)));return e?[{ssrcId:e.ssrcIds[0],rtx:n?e.ssrcIds[1]:void 0}]:[{ssrcId:r[0].ssrcId}]}return[{ssrcId:r[0].ssrcId}]}(r,t.id,n.useRTX)}));let c;try{c=yield a}catch(e){throw i.forEach((e=>{Eh()&&e.replaceTrack(null),n.peerConnection.removeTrack(e)})),e}const u=n.mungSendOfferSDP(o.sdp,e);n.remoteSDP.receive(e,t,c);const l=n.remoteSDP.toString();return yield KC(n.peerConnection.setLocalDescription({type:"offer",sdp:u})),yield KC(n.applySendEncodings(i,e)),yield KC(n.peerConnection.setRemoteDescription({type:"answer",sdp:l})),e.map(((e,t)=>{const n=e._mediaStreamTrack.id;return{localSSRC:a[t],id:n}}))}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{r()}}))()}async stopSending(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{Eh()&&e.replaceTrack(null),this.peerConnection.removeTrack(e)}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n),this.remoteSDP.stopReceiving(e);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{id:n,mslabel:i}=this.remoteSDP.send(e,t,r),o=new Zl(((t,r)=>{const o=setTimeout((()=>{r(new Error("Cannot receive track, id: ".concat(n)))}),1e4),s=r=>{const a=gh();if(("Safari"===a.name&&11===Number(a.version)||wh())&&r.track.id!==n&&r.streams[0].id===i){var c;const i=r.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(e,n,r.track.id),this.peerConnection.removeEventListener("track",s),clearTimeout(o),void t(i)}if(r.track.id===n)return this.peerConnection.removeEventListener("track",s),clearTimeout(o),void t(r.track)};this.peerConnection.addEventListener("track",s)})),s=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:s});const a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(a),{track:await o,id:n}}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const n=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(n)}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){}async unmuteRemote(e){}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("sender' length doesn't match mids' length.");t.map((e=>{if(Eh()&&e.track)e.track.enabled=!1;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!1)),e.setParameters(t)}}))}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getSenders().filter((t=>{var n;return-1!==e.indexOf((null===(n=t.track)||void 0===n?void 0:n.id)||"")}));if(t.length!==e.length)throw new Error("Senders' length doesn't match mids' length.");t.map((async e=>{if(Eh()&&e.track)e.track.enabled=!0;else{const t=e.getParameters();t.encodings.forEach((e=>e.active=!0)),await e.setParameters(t)}}));const n=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(n);const r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return GC((function*(){const n=yield KC(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(vv().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===Jm.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(Jp.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===Jm.RELAY)return;e!==Jm.RELAY&&t.remoteSDP.updateCandidates(e);const r=yield KC(t.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const i=$C(r.sdp),{remoteIceParameters:o}=yield i.iceParameters;t.remoteSDP.restartICE(o);const s=t.remoteSDP.toString();yield KC(t.peerConnection.setLocalDescription(r)),yield KC(t.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(e){Jp.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const e=await this.peerConnection.createOffer(),n=this.mungSendOfferSDP(e.sdp,[t]);this.remoteSDP.updateRecvMedia(t._mediaStreamTrack.kind,t);const r=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:n}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:r})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getSenders().filter((t=>{var n;return(null===(n=t.track)||void 0===n?void 0:n.id)===e}));1===n.length&&await this.applySendEncodings(n,[t])}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getSenders().find((e=>{var n;return(null===(n=e.track)||void 0===n?void 0:n.id)===t}));n&&await n.replaceTrack(e._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Jp.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Jp.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),df("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(sm(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),df("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async applySendEncodings(e,t){try{if(!vv().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let r=0;r<e.length;r++){var n;const i=e[r],o=t[r];if(!o)continue;const s={},a={};if(o instanceof PS)switch(o._optimizationMode){case"motion":s.degradationPreference="maintain-framerate";break;case"detail":s.degradationPreference="maintain-resolution";break;default:s.degradationPreference="balanced"}if(df("DSCP_TYPE")&&Mh()){const e=df("DSCP_TYPE");["very-low","low","medium","high"].includes(e)&&(a.networkPriority=e)}const c=i.getParameters(),u=null===(n=c.encodings)||void 0===n?void 0:n[0];u&&Object.assign(u,a),Object.assign(c,s),await i.setParameters(c)}}catch(e){Jp.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t){const n=YC.exports.parse(e);return t.forEach(((e,t)=>{const r=e._mediaStreamTrack,i=n.mediaDescriptions.find((e=>e.attributes.mid===r.kind));i&&rR(i,e)})),YC.exports.print(n)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const t=this.remoteSDP.batchSend(e).map(((t,n)=>{let{id:r,mslabel:i}=t;const{kind:o}=e[n];return new Zl(((e,t)=>{const n=setTimeout((()=>{t(new Error("Cannot receive track, id: ".concat(r)))}),1e4),s=t=>{const a=gh();if("Safari"===a.name&&11===Number(a.version)&&t.track.id!==r&&t.streams[0].id===i){var c;const i=t.streams[0].getTracks()[0];return null===(c=this.remoteSDP)||void 0===c||c.updateTrackLabel(o,r,t.track.id),this.peerConnection.removeEventListener("track",s),clearTimeout(n),void e({track:i,id:r})}if(t.track.id===r)return this.peerConnection.removeEventListener("track",s),clearTimeout(n),void e({track:t.track,id:r})};this.peerConnection.addEventListener("track",s)}))})),n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(r),await Zl.all(t)}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(vv().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"connect"),UR.prototype),Ry(UR.prototype,"stopSending",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"stopSending"),UR.prototype),Ry(UR.prototype,"receive",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"receive"),UR.prototype),Ry(UR.prototype,"stopReceiving",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"stopReceiving"),UR.prototype),Ry(UR.prototype,"muteRemote",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"muteRemote"),UR.prototype),Ry(UR.prototype,"unmuteRemote",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"unmuteRemote"),UR.prototype),Ry(UR.prototype,"muteLocal",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"muteLocal"),UR.prototype),Ry(UR.prototype,"unmuteLocal",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"unmuteLocal"),UR.prototype),Ry(UR.prototype,"close",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"close"),UR.prototype),Ry(UR.prototype,"updateEncoderConfig",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"updateEncoderConfig"),UR.prototype),Ry(UR.prototype,"updateSendParameters",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"updateSendParameters"),UR.prototype),Ry(UR.prototype,"replaceTrack",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"replaceTrack"),UR.prototype),Ry(UR.prototype,"getRemoteSSRC",[QR],Object.getOwnPropertyDescriptor(UR.prototype,"getRemoteSSRC"),UR.prototype),UR);function QR(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("Locking from P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function jR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function GR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jR(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const KR="9";class WR{get localCapabilities(){return Ib(this._localCapabilities)}get rtpCapabilities(){return Ib(this._rtpCapabilities)}get candidates(){return Ib(this._candidates)}get iceParameters(){return Ib(this._iceParameters)}get dtlsParameters(){return Ib(this._dtlsParameters)}constructor(e){Kh(this,"sessionDesc",void 0),Kh(this,"_localCapabilities",void 0),Kh(this,"_rtpCapabilities",void 0),Kh(this,"_candidates",void 0),Kh(this,"_iceParameters",void 0),Kh(this,"_dtlsParameters",void 0),Kh(this,"setup",void 0),Kh(this,"currentMidIndex",void 0),Kh(this,"cname",void 0),Kh(this,"firefoxSsrcMidMap",new Map),e=Ib(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:s,cname:a}=e,c=YC.exports.parse("v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0 1\na=msid-semantic: WMS\na=ice-lite\nm=video 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:0\nm=audio 9 UDP/TLS/RTP/SAVPF 0\nc=IN IP4 127.0.0.1\na=rtcp:9 IN IP4 0.0.0.0\na=sendonly\na=rtcp-mux\na=rtcp-rsize\na=mid:1\n");this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s,this.setup=o,this.cname=a;const u=this.rtpCapabilities.send;for(const e of c.mediaDescriptions){if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=o,"video"===e.media.mediaType&&(e.media.fmts=u.videoCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=u.videoCodecs,e.attributes.extmaps=u.videoExtensions,df("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=nR([{ssrcId:4e4,rtx:df("USE_SUB_RTX")?40001:void 0}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}if("audio"===e.media.mediaType&&(e.media.fmts=u.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=u.audioCodecs,e.attributes.extmaps=u.audioExtensions,hR(e),df("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=nR([{ssrcId:2e4}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}preloadRemoteMedia(){const e=df("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;for(let o=1;o<e;o++){const e=2*o+2e4,s=2*o+4e4,{ssrcs:a,ssrcGroups:c}=nR([{ssrcId:e}],this.cname),{ssrcs:u,ssrcGroups:l}=nR([{ssrcId:s,rtx:df("USE_SUB_RTX")?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:KR,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:KR,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:c,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return YC.exports.print(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=nR(t,this.cname,df("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(i);if(s){if(bh()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||1===t&&(Eh()||Rh())||0===t&&df("USE_SUB_RTX")||Ih()?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=Ib(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),bh()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||bh()||Ih()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>e.includes(t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>e.includes(t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(e){e===Jm.TCP?this._candidates.forEach((e=>{-1===this._candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this._candidates.push(GR(GR({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(e){e=Ib(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(bh()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleRecvMedia(e,t,n,r,i,o){const s=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,c=this.localCapabilities.send;let u=[];if(s===Xm.VIDEO){var l,A;if(df("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(u=a.videoCodecs.filter((e=>{var t,n;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)&&(null==e||null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])===df("H264_PROFILE_LEVEL_ID")}))),!u||0===(null===(l=u)||void 0===l?void 0:l.length)){const e=c.videoCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)}));0!==e.length&&(u=a.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(df("USE_PUB_RTX")){const e=u.map((e=>e.payloadType.toString())),t=a.videoCodecs.filter((t=>{var n,r;return"rtx"===(null===(n=t.rtpMap)||void 0===n?void 0:n.encodingName)&&e.includes((null===(r=t.fmtp)||void 0===r?void 0:r.parameters.apt)||"")}));u=[...u,...t]}0===u.length&&(Jp.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(A=a.videoCodecs[0].rtpMap)||void 0===A?void 0:A.encodingName)),u=a.videoCodecs)}else u=a.audioCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(i)})),0===u.length&&(Jp.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),u=a.audioCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes("opus")})));const h=s===Xm.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const d="".concat(this.currentMidIndex);let p={media:{mediaType:s,port:KR,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};p=this.mungRecvMediaDsec(p,e,o);const f=this.findFirstClosedMedia(s);if(f){const e=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[e]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,s=e===Xm.VIDEO?o.videoCodecs:o.audioCodecs,a=e===Xm.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let u={media:{mediaType:e,port:KR,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:a,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};u=this.mungSendMediaDesc(u,i);const l=this.findFirstClosedMedia(e);if(l){const e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=Ib(e);return iR(r),rR(r,t),oR(r,t),sR(r),aR(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Ib(e);return aR(n,t,this.localCapabilities.recv),hR(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>bh()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n,r;return(null===(n=t.attributes)||void 0===n||null===(r=n.ssrcs[0])||void 0===r?void 0:r.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}var zR;function qR(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function YR(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qR(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qR(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let XR=(Ry((zR=class e extends gv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var e,t,n;return null!==(e=null===(t=this.peerConnection.getReceivers()[0])||void 0===t||null===(n=t.transport)||void 0===n?void 0:n.state)&&void 0!==e?e:null}constructor(t,n){super(t,n),Kh(this,"store",void 0),Kh(this,"peerConnection",void 0),Kh(this,"remoteSDP",void 0),Kh(this,"initialOffer",void 0),Kh(this,"transportEventReceiver",void 0),Kh(this,"statsFilter",void 0),Kh(this,"localCapabilities",void 0),Kh(this,"localCandidateCount",0),Kh(this,"allCandidatesReceived",!1),Kh(this,"selectedCandidatePairTimer",void 0),Kh(this,"establishPromise",void 0),Kh(this,"mutex",new n_("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=kR(this.peerConnection,df("STATS_UPDATE_INTERVAL"),void 0,bh()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=$C(e.sdp),n=await uR(!df("USE_PUB_RTX")&&!df("USE_SUB_RTX"),df("FILTER_VIDEO_FEC"),df("FILTER_AUDIO_FEC"));return this.localCapabilities=AR(n),this.initialOffer=e,YR(YR({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(e){throw new Qp(Vp.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new WR({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r,remoteSetup:i,localCapabilities:this.localCapabilities,cname:o});const s=this.remoteSDP.toString(),a=YC.exports.parse(this.initialOffer.sdp),c=a.mediaDescriptions.find((e=>"audio"===e.media.mediaType));c&&hR(c);const u=YC.exports.print(a),l=this.logSDPExchange(u||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),null==l||l(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s});const A=this.peerConnection.getTransceivers()[0];if(null!=A&&A.receiver&&this.tryBindTransportEvents(A.receiver),df("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const e=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t)}}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(e.toString()))}}send(e,t,n){var r=this;return GC((function*(){const i=yield KC(r.mutex.lock("From P2PConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const o=[];e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t),e._updateRtpTransceiver(t)})),bh()&&!0===df("SIMULCAST")&&(yield KC(r.applySimulcastForFirefox(o,e)));const s=yield KC(r.peerConnection.createOffer()),a=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(s.sdp,e,a),u=YC.exports.parse(c),l=a.map((e=>{const t=u.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return eR(t,df("USE_PUB_RTX"))}));let A;try{A=yield l}catch(i){A=[],r.remoteSDP.receive(e,t,n,A);const o=r.remoteSDP.toString();throw yield KC(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield KC(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield KC(r.stopSending(a,!0)),i}r.remoteSDP.receive(e,t,n,A);const h=r.remoteSDP.toString(),d=r.logSDPExchange(c,"offer","local","send");return yield KC(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield KC(r.applySimulcastEncodings(o,e)),yield KC(r.applySendEncodings(o,e)),null==d||d(h),yield KC(r.peerConnection.setRemoteDescription({type:"answer",sdp:h})),o.map(((e,t)=>{const n=a[t];return{localSSRC:l[t],id:n,transceiver:e}}))}catch(e){throw e instanceof Qp?e:new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(e);const o=this.remoteSDP.toString();null==i||i(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),Jp.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," by exchanging SDP."))}else Jp.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(e," no need to exchange SDP."));const s=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i,transceiver:s}}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);if(n){const e=this.remoteSDP.toString(),t=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const n=await this.peerConnection.createAnswer();null==t||t(n.sdp||""),await this.peerConnection.setLocalDescription(n),Jp.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else Jp.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e,transceiver:t}}))}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return GC((function*(){const n=yield KC(t.mutex.lock("From P2PConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(vv().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===Jm.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(Jp.debug("[".concat(t.store.clientId,"] restartICE change iceTransportPolicy from [").concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===Jm.RELAY)return;e!==Jm.RELAY&&t.remoteSDP.updateCandidates(e);const r=yield KC(t.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const i=$C(r.sdp),{remoteIceParameters:o}=yield i.iceParameters;t.remoteSDP.restartICE(o);const s=t.remoteSDP.toString(),a=t.logSDPExchange(r.sdp||"","offer","local","restartICE");t.store.descriptionStart(),yield KC(t.peerConnection.setLocalDescription(r)),null==a||a(s),yield KC(t.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(e){Jp.warning("[".concat(t.store.clientId,"] restart ICE failed, abort operation"),e)}finally{n()}}))()}close(){var e;this.peerConnection.close(),null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?bh()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}async getSelectedCandidatePair(){const e=this.peerConnection.getReceivers();if(e.length>0&&e[0].transport&&e[0].transport.iceTransport&&e[0].transport.iceTransport.getSelectedCandidatePair&&e[0].transport.iceTransport.getSelectedCandidatePair()){const t=e[0].transport.iceTransport,{local:n,remote:r}=t.getSelectedCandidatePair();return{local:YR(YR({},ER),{},{candidateType:n.type,protocol:n.protocol,address:n.address,port:n.port}),remote:YR(YR({},ER),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Jp.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Jp.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),df("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(sm(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),df("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),df("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),df("ENABLE_ENCODED_TRANSFORM")&&vv().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nb(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!df("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}tryBindTransportEvents(e){const t=e.transport;if(t){this.transportEventReceiver=e,t.onstatechange=()=>{var e;null!=t&&t.state&&(null===(e=this.onDTLSTransportStateChange)||void 0===e||e.call(this,t.state))},t.onerror=e=>{var t;null===(t=this.onDTLSTransportError)||void 0===t||t.call(this,"error"in e?e.error:e)};const n=t.iceTransport;n&&(n.onstatechange=()=>{const e=null==t?void 0:t.iceTransport.state;var n;e&&(null===(n=this.onICETransportStateChange)||void 0===n||n.call(this,e))},n.getSelectedCandidatePair&&(n.onselectedcandidatepairchange=()=>{if(n.getSelectedCandidatePair()){const{local:e,remote:t}=n.getSelectedCandidatePair();Jp.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:e.type,protocol:e.protocol}),", remote ").concat(JSON.stringify({candidateType:t.type,protocol:t.protocol,address:t.address,port:t.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(e,t){try{if(!vv().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let c=0;c<e.length;c++){const u=e[c],l=t[c];if(l&&l instanceof PS){var n,r;if(this.isVP8Simulcast(l))continue;const e={},t={};switch(l._optimizationMode){case"motion":e.degradationPreference="maintain-framerate";break;case"detail":e.degradationPreference="maintain-resolution";break;default:e.degradationPreference="balanced"}var i,o,s,a;if(null!==(n=l._encoderConfig)&&void 0!==n&&n.bitrateMax&&(t.maxBitrate=1e3*(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)),l._hints.includes(Mm.LOW_STREAM)&&(null!==(o=l._encoderConfig)&&void 0!==o&&o.frameRate&&(t.maxFramerate=ib(l._encoderConfig.frameRate)),null!==(s=l._encoderConfig)&&void 0!==s&&s.scaleResolutionDownBy&&(null===(a=l._encoderConfig)||void 0===a?void 0:a.scaleResolutionDownBy)>1&&(t.scaleResolutionDownBy=l._encoderConfig.scaleResolutionDownBy)),df("DSCP_TYPE")&&Mh()){const e=df("DSCP_TYPE");["very-low","low","medium","high"].includes(e)&&(t.networkPriority=e)}const c=u.sender.getParameters(),A=null===(r=c.encodings)||void 0===r?void 0:r[0];bh()&&!A&&(e.encodings=[t]),A&&Object.assign(A,t),Object.assign(c,e),await u.sender.setParameters(c)}}}catch(e){Jp.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(e,t,n){const r=YC.exports.parse(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(rR(o,e),cR(o,e,this.store.codec))})),YC.exports.print(r)}mungReceiveAnswerSDP(e,t,n){const r=YC.exports.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===Xm.AUDIO&&"audio"===i.media.mediaType&&hR(i),YC.exports.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,o;const a=e[s],c=t[s];if(c instanceof PS&&!c._hints.includes(Mm.LOW_STREAM)&&null!==(n=c._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=c._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=c._scalabiltyMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=c._scalabiltyMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=a.sender.getParameters();await a.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!bh()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof PS&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const s=t.sender.getParameters();await t.sender.setParameters(Object.assign(s,i))}}}isVP8Simulcast(e){var t,n,r,i;return!!(e instanceof PS&&df("SIMULCAST")&&"vp8"===this.store.codec&&!e._hints.includes(Mm.LOW_STREAM)&&null!==(t=e._encoderConfig)&&void 0!==t&&t.bitrateMax&&(null===(n=e._encoderConfig)||void 0===n?void 0:n.bitrateMax)>200&&null!==(r=e._scalabiltyMode)&&void 0!==r&&r.numSpatialLayers&&(null===(i=e._scalabiltyMode)||void 0===i?void 0:i.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(df("SDP_LOGGING"))return Jp.upload("[".concat(this.store.clientId,"] exchanging ").concat(n," ").concat(t," SDP during P2PConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(vv().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"connect"),zR.prototype),Ry(zR.prototype,"receive",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"receive"),zR.prototype),Ry(zR.prototype,"batchReceive",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"batchReceive"),zR.prototype),Ry(zR.prototype,"stopReceiving",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"stopReceiving"),zR.prototype),Ry(zR.prototype,"muteRemote",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"muteRemote"),zR.prototype),Ry(zR.prototype,"unmuteRemote",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"unmuteRemote"),zR.prototype),Ry(zR.prototype,"muteLocal",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"muteLocal"),zR.prototype),Ry(zR.prototype,"unmuteLocal",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"unmuteLocal"),zR.prototype),Ry(zR.prototype,"close",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"close"),zR.prototype),Ry(zR.prototype,"updateEncoderConfig",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"updateEncoderConfig"),zR.prototype),Ry(zR.prototype,"updateSendParameters",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"updateSendParameters"),zR.prototype),Ry(zR.prototype,"replaceTrack",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"replaceTrack"),zR.prototype),Ry(zR.prototype,"getRemoteSSRC",[JR],Object.getOwnPropertyDescriptor(zR.prototype,"getRemoteSSRC"),zR.prototype),zR);function JR(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function ZR(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=ib(t.width),r.height=ib(t.height);const i=ib(t.framerate||15);document.body.append(n),document.body.append(r);let o=e._mediaStreamTrack;n.srcObject=new MediaStream([o]),n.play();const s=r.getContext("2d");if(!s)throw new Qp(Vp.UNEXPECTED_ERROR,"can not get canvas context");const a=vv(),c=r.captureStream(a.supportRequestFrame?0:i).getVideoTracks()[0],u=d_((()=>(()=>{if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const e=n.videoWidth,t=n.videoHeight/e,i=r.width*t;Math.abs(i-r.height)>=2&&(Jp.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(i)),r.height=i)}s.drawImage(n,0,0,r.width,r.height),c.requestFrame&&c.requestFrame(),o!==e._mediaStreamTrack&&(o=e._mediaStreamTrack,n.srcObject=new MediaStream([o]))})()),i),l=c.stop;return c.stop=()=>{l.call(c),u(),n&&(n.remove(),n=null),r&&(r.width=0,r.remove(),r=null),Jp.debug("clean low stream renderer")},c}var $R,eI,tI,nI,rI,iI,oI,sI,aI,cI,uI,lI;function AI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?AI(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):AI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class dI extends $y{getUserId(){return this._userId}constructor(e,t,n,r){super(e,"track-".concat(e.kind,"-").concat(t,"-").concat(r.clientId,"_").concat(gb(5,""))),Kh(this,"_userId",void 0),Kh(this,"_uintId",void 0),Kh(this,"_isDestroyed",!1),Kh(this,"store",void 0),Kh(this,"processor",void 0),Kh(this,"processorContext",void 0),this._userId=t,this._uintId=n,this.store=r}_updateOriginMediaStreamTrack(e){this._originMediaStreamTrack=e,this._mediaStreamTrack=e,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,Jp.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let pI=($R=Jy({argsMap:(e,t,n)=>[e.getTrackId(),"string"==typeof t?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),eI=Jy({argsMap:e=>[e.getTrackId()]}),tI=Jy({argsMap:(e,t)=>[e.getTrackId(),t.name]}),nI=Jy({argsMap:e=>[e.getTrackId()]}),Ry((rI=class extends dI{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==xg.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),Kh(this,"_videoVisibleTimer",null),Kh(this,"_previousVideoVisibleStatus",void 0),Kh(this,"_clearPreviousVideoVisibleStatus",(()=>this._previousVideoVisibleStatus=void 0)),Kh(this,"trackMediaType","video"),Kh(this,"_videoWidth",void 0),Kh(this,"_videoHeight",void 0),Kh(this,"_player",void 0),Kh(this,"processorDestination",void 0),Kh(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new G_(this.getTrackId(),"remote"),this.processorDestination=new j_(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return xb((()=>{Jp.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")}),"remoteVideoTrackGetStatsWarning"),wb(this,Dm.GET_STATS)||hI({},dm)}play(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e){const t=document.getElementById(e);t?e=t:(Jp.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Jp.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=hI(hI({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new Kw(n):this._player=new zw(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Vm.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval((()=>{try{const e=this.getVideoElementVisibleStatus();this.safeEmit(Vm.VIDEO_ELEMENT_VISIBLE_STATUS,e)}catch(e){}}),df("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Jp.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){yb(this._originMediaStreamTrack).then((e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t})).catch(vb)}_updatePlayerSource(){Jp.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=null==this||null===(e=this._player)||void 0===e?void 0:e.getContainerElement(),r={track:this,element:null==this||null===(t=this._player)||void 0===t?void 0:t.getVideoElement(),slot:null==n?void 0:n.parentElement},{element:i,slot:o}=r;if(this.isPlaying&&i instanceof HTMLVideoElement&&o instanceof HTMLElement){const e=LS.checkOneElementVisible(i),t=Object.assign({},e);if(t.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=t.visible;const e=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});t.visible?e.onSuccess("Video is visible"):e.onSuccess("Invisible because of ".concat(t.reason))}return t}return}catch(e){throw new Qp(Vp.GET_VIDEO_ELEMENT_VISIBLE_ERROR,e.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new Qp(Vp.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(iv.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(iv.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[$R],Object.getOwnPropertyDescriptor(rI.prototype,"play"),rI.prototype),Ry(rI.prototype,"stop",[eI],Object.getOwnPropertyDescriptor(rI.prototype,"stop"),rI.prototype),Ry(rI.prototype,"pipe",[tI],Object.getOwnPropertyDescriptor(rI.prototype,"pipe"),rI.prototype),Ry(rI.prototype,"unpipe",[nI],Object.getOwnPropertyDescriptor(rI.prototype,"unpipe"),rI.prototype),rI),fI=(iI=Jy({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),oI=Jy({argsMap:(e,t)=>[e.getTrackId(),t]}),sI=Jy({argsMap:e=>[e.getTrackId()]}),aI=Jy({argsMap:e=>[e.getTrackId()]}),cI=Jy({argsMap:(e,t)=>[e.getTrackId(),t.name]}),uI=Jy({argsMap:e=>[e.getTrackId()]}),Ry((lI=class extends dI{get isPlaying(){return this._useAudioElement?N_.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),Kh(this,"trackMediaType","audio"),Kh(this,"_source",void 0),Kh(this,"_useAudioElement",!0),Kh(this,"_volume",100),Kh(this,"processorContext",void 0),Kh(this,"processorDestination",void 0),Kh(this,"_played",!1),Kh(this,"_bypassWebAudio",!1),df("DISABLE_WEBAUDIO")?(this._source=new z_,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new g_(e,!0),df("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(rm.RECEIVE_TRACK_BUFFER,(()=>{this.safeEmit(Vm.FIRST_FRAME_DECODED)})),this.processorContext=new W_(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new K_(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(rm.UPDATE_SOURCE,(()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})}))}setAudioFrameCallback(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4096;if(!e)return this._source.removeAllListeners(rm.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(rm.ON_AUDIO_BUFFER),this._source.on(rm.ON_AUDIO_BUFFER,(t=>e(t)))}setVolume(e){this._volume=e,this._useAudioElement?N_.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement)throw new Qp(Vp.NOT_SUPPORTED,"your browser does not support setting the audio output device");await N_.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return xb((()=>{Jp.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")}),"remoteAudioTrackGetStatsWarning"),wb(this,Dm.GET_STATS)||hI({},Am)}play(){Jp.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(Jp.debug("[".concat(this.getTrackId(),"] use audio element to play")),N_.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){Jp.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?N_.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Jp.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&N_.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new Qp(Vp.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new Qp(Vp.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new Qp(Vp.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;null===(e=this._source.processSourceNode)||void 0===e||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(iv.ON_TRACK,(async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})),this.processorDestination.on(iv.ON_NODE,(e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)}))}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(iv.ON_TRACK),this.processorDestination.removeAllListeners(iv.ON_NODE)}}).prototype,"setVolume",[iI],Object.getOwnPropertyDescriptor(lI.prototype,"setVolume"),lI.prototype),Ry(lI.prototype,"setPlaybackDevice",[oI],Object.getOwnPropertyDescriptor(lI.prototype,"setPlaybackDevice"),lI.prototype),Ry(lI.prototype,"play",[sI],Object.getOwnPropertyDescriptor(lI.prototype,"play"),lI.prototype),Ry(lI.prototype,"stop",[aI],Object.getOwnPropertyDescriptor(lI.prototype,"stop"),lI.prototype),Ry(lI.prototype,"pipe",[cI],Object.getOwnPropertyDescriptor(lI.prototype,"pipe"),lI.prototype),Ry(lI.prototype,"unpipe",[uI],Object.getOwnPropertyDescriptor(lI.prototype,"unpipe"),lI.prototype),lI);function gI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gI(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class vI extends Fp{constructor(){super(),Kh(this,"uplinkStatsUploadInterval",void 0),Kh(this,"uplinkRelatedStatsUploadInterval",void 0),Kh(this,"uplinkDenoiserStatsUploadInterval",void 0),Kh(this,"transportStatsUploadInterval",void 0),Kh(this,"uplinkExtensionStatsUploadInterval",void 0),Kh(this,"downlinkExtensionStatsUploadInterval",void 0),Kh(this,"extensionUsageStatsUploadInterval",void 0),Kh(this,"downlinkStatsUploadInterval",void 0),Kh(this,"downlinkRelatedStatsUploadInterval",void 0),Kh(this,"lastStats",void 0),Kh(this,"uploadUnplinkStarted",!1),Kh(this,"uploadDownlinkStarted",!1),Kh(this,"uploadTransportStarted",!1),Kh(this,"uploadExtensionUsageStarted",!1),Kh(this,"requestStats",void 0),Kh(this,"requestLocalMedia",void 0),Kh(this,"requestRemoteMedia",void 0),Kh(this,"requestAllTracks",void 0),Kh(this,"requestVideoIsReady",void 0),Kh(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);t&&this.uploadTransportStats(t)}),1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const e=new Map;this.extensionUsageStatsUploadInterval=window.setInterval((async()=>{var t,n,r;const i=Date.now(),o={connectionInterval:df("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let s=[];const a=(null===(t=this.requestAllTracks)||void 0===t?void 0:t.call(this))||[];for(const e of a)!e.muted&&e.enabled&&(s=s.concat(await e.getProcessorUsage()));const c=(null===(n=this.requestRemoteMedia)||void 0===n?void 0:n.call(this))||[];for(const[e,t]of c)t.has(Xm.VIDEO)&&e.videoTrack&&(s=s.concat(await e.videoTrack.getProcessorUsage())),t.has(Xm.AUDIO)&&e.audioTrack&&(s=s.concat(await e.audioTrack.getProcessorUsage()));if(0===s.length)return;o.details=function(e,t){const n={};for(const{id:s,value:a,level:c,direction:u}of e){var r;const e=null!==(r=t.get(s))&&void 0!==r?r:0,l=2===a?e+df("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:e;var i,o;t.set(s,l),n[s]?(2===a&&(n[s].value=a),c>n[s].level&&(n[s].level=c),"remote"===u&&(n[s].remoteUidCount+=1),n[s].totalTs=null!==(i=t.get(s))&&void 0!==i?i:0):n[s]={value:a,level:c,remoteUidCount:"local"===u?0:1,totalTs:null!==(o=t.get(s))&&void 0!==o?o:0}}return Object.keys(n).map((e=>{const{level:t,value:r,totalTs:i}=n[e];return{id:e,level:t,value:r,totalTs:i}}))}(s,e);const u=Date.now(),l=u>i?u:i+1;null===(r=this.requestUpload)||void 0===r||r.call(this,em.EXTENSION_USAGE_STATS,{usageStats:o,sendTs:l})}),df("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);t&&(this.uploadUplinkStats(t),this.lastStats=t)}),3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);t&&this.uploadRelatedUplinkStats(t,this.lastStats),this.lastStats=t}),1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestAllTracks)||void 0===e?void 0:e.call(this);t&&this.uploadDenoiserStats(t)}),2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestAllTracks)||void 0===e?void 0:e.call(this);t&&this.uploadExtensionStats(t)}),2e3))}uploadTransportStats(e){Rb((()=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,em.TRANSPORT_STATS,function(e){const t={connectionType:100,googRtt:e.rtt};if("relay"===e.selectedCandidatePair.localCandidate.candidateType){const n=e.selectedCandidatePair.localCandidate.relayProtocol;"udp"===n&&(t.connectionType=101),"tcp"===n&&(t.connectionType=103),"tls"===n&&(t.connectionType=104)}return t}(e))}))}uploadUplinkStats(e){var t;((null===(t=this.requestLocalMedia)||void 0===t?void 0:t.call(this))||[]).forEach((t=>{let[n,{track:r,ssrcs:i}]=t;switch(n){case $m.LocalVideoLowTrack:case $m.LocalVideoTrack:{const t=function(e,t,n){var r;const i=t.videoSend.find((t=>t.ssrc===e));if(!i)return null;const o={id:gb(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:i.ssrc.toString()};switch(o.A_vstd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",i.sentFrame&&(o.A_fhs=i.sentFrame.height.toString(),o.A_frs=i.sentFrame.frameRate.toString(),o.A_fws=i.sentFrame.width.toString()),i.adaptionChangeReason){case"none":o.A_ac="0";break;case"cpu":o.A_ac="1";break;case"bandwidth":o.A_ac="2";break;case"other":o.A_ac="3"}return o.A_lvps=Ng[n._player?n._player.videoElementStatus:"uninit"].toString(),o.A_nr=null===(r=i.nacksCount)||void 0===r?void 0:r.toString(),i.avgEncodeMs&&(o.A_aem=i.avgEncodeMs.toFixed(0).toString()),o}(i[0].ssrcId,e,r),o=n===$m.LocalVideoTrack?function(e,t,n){var r,i,o,s,a,c,u,l;const A=t.videoSend.find((t=>t.ssrc===e));if(!A)return null;const h={id:gb(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:A.ssrc.toString()},d=null!==(r=null!==(i=null===(o=A.inputFrame)||void 0===o?void 0:o.height)&&void 0!==i?i:null==n?void 0:n._videoHeight)&&void 0!==r?r:0,p=null!==(s=null!==(a=null===(c=A.inputFrame)||void 0===c?void 0:c.width)&&void 0!==a?a:null==n?void 0:n._videoWidth)&&void 0!==s?s:0,f=null!==(u=null===(l=A.inputFrame)||void 0===l?void 0:l.frameRate)&&void 0!==u?u:0;return d&&(h.A_fhi=d+""),p&&(h.A_fwi=p+""),f&&(h.A_fri=f+""),h}(i[0].ssrcId,e,r):null;t&&Rb((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,em.PUBLISH_STATS,{stream_type:n===$m.LocalVideoLowTrack?"low":"high",stats:mI(mI({},t),o)})}));const s=function(e){const t={id:"bweforvideo",timestamp:new Date(e.timestamp).toISOString(),type:"VideoBwe"};return e.bitrate.retransmit&&(t.A_rb=e.bitrate.retransmit.toString()),e.bitrate.targetEncoded&&(t.A_teb=e.bitrate.targetEncoded.toString()),t.A_aeb=e.bitrate.actualEncoded.toString(),t.A_tb=e.bitrate.transmit.toString(),void 0!==e.sendBandwidth&&(t.A_asb=e.sendBandwidth.toString()),t}(e);s&&setTimeout((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,em.PUBLISH_STATS,{stream_type:n===$m.LocalVideoLowTrack?"low":"high",stats:s})}),1e3);break}case $m.LocalAudioTrack:{const t=function(e,t,n){const r=t.audioSend.find((t=>t.ssrc===e));if(!r)return null;const i={id:gb(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:r.ssrc.toString()};return i.A_astd=n._originMediaStreamTrack&&!n._originMediaStreamTrack.enabled||n._mediaStreamTrack&&!n._mediaStreamTrack.enabled?"1":"0",r.inputLevel?i.A_ail=Math.round(100*r.inputLevel).toString():i.A_ail=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),i.A_apil=Math.round(100*n._source.getAccurateVolumeLevel()).toString(),r.aecReturnLoss&&(i.A_ecrl=Math.round(r.aecReturnLoss).toString()),r.aecReturnLossEnhancement&&(i.A_ecrle=Math.round(r.aecReturnLossEnhancement).toString()),i}(i[0].ssrcId,e,r);t&&Rb((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,em.PUBLISH_STATS,{stream_type:"high",stats:t})}));break}}}))}uploadRelatedUplinkStats(e,t){var n;((null===(n=this.requestLocalMedia)||void 0===n?void 0:n.call(this))||[]).filter((e=>{let[t]=e;return t===$m.LocalVideoLowTrack||t===$m.LocalVideoTrack})).forEach((t=>{let[n,{ssrcs:r}]=t;const i=function(e,t){const n=t.videoSend.find((t=>t.ssrc===e));return n?{mediaType:"video",isVideoMute:!1,frameRateInput:n.inputFrame&&n.inputFrame.frameRate.toString(),frameRateSent:n.sentFrame&&n.sentFrame.frameRate.toString(),googRtt:n.rttMs.toString(),qpSumPerFrame:Math.floor(n.qpSumPerFrame).toString()}:null}(r[0].ssrcId,e);i&&Rb((()=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,em.PUBLISH_RELATED_STATS,{stream_type:n===$m.LocalVideoLowTrack?"low":"high",stats:i})}))}))}uploadDenoiserStats(e){for(let i=0;i<e.length;i++){const o=e[i];if(o instanceof GE){var t,n,r;const e=null===(t=(n=o._external).getDenoiserStats)||void 0===t?void 0:t.call(n);return void(e&&(null===(r=this.requestUpload)||void 0===r||r.call(this,em.DENOISER_STATS,e)))}}}uploadExtensionStats(e){for(let t=0;t<e.length;t++)e[t].getProcessorStats().forEach((e=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,e.type,e.stats)}))}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let e;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let t=!1;this.downlinkStatsUploadInterval=window.setInterval((()=>{var n;const r=null===(n=this.requestStats)||void 0===n?void 0:n.call(this);r&&(this.uploadDownlinkStats(r,t,e),e=r),t=!t}),3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestStats)||void 0===e?void 0:e.call(this);t&&(this.uploadRelatedDownlinkStats(t,this.lastStats),this.lastStats=t)}),1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval((()=>{var e;const t=null===(e=this.requestRemoteMedia)||void 0===e?void 0:e.call(this);t&&this.uploadDownlinkExtensionStats(t)}),2e3)}uploadDownlinkStats(e,t,n){var r;((null===(r=this.requestRemoteMedia)||void 0===r?void 0:r.call(this))||[]).forEach((r=>{let[i,o]=r;if(o.has(Xm.VIDEO)&&i.videoTrack){const r=i.videoTrack?function(e,t,n,r,i){const o=t.videoRecv.find((t=>t.ssrc===e));if(!o)return null;const s={id:gb(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:o.ssrc.toString()};var a,c;if(s.bytesReceived=o.bytes.toString(),s.packetsLost=o.packetsLost.toString(),s.packetsReceived=o.packets.toString(),o.framesRateFirefox&&(s.A_frr=o.framesRateFirefox.toString()),o.receivedFrame?(s.A_frr=o.receivedFrame.frameRate.toString(),s.A_fhr=o.receivedFrame.height.toString(),s.A_fwr=o.receivedFrame.width.toString()):(s.A_fhr=null===(a=r._videoHeight)||void 0===a?void 0:a.toString(),s.A_fwr=null===(c=r._videoWidth)||void 0===c?void 0:c.toString()),s.A_frd=o.decodeFrameRate.toString(),o.outputFrame&&(s.A_fro=o.outputFrame.frameRate.toString()),void 0!==o.jitterBufferMs&&(s.A_jbm=Math.floor(o.jitterBufferMs).toString()),void 0!==o.currentDelayMs&&(s.A_cdm=Math.floor(o.currentDelayMs).toString()),s.A_fs=o.firsCount.toString(),s.A_ns=o.nacksCount.toString(),s.A_ps=o.plisCount.toString(),r&&(s.A_vrtd=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?"0":"1"),r._player&&r._player.freezeTimeCounterList.length>0&&(s.A_vrft=Math.round(r._player.freezeTimeCounterList.splice(0,1)[0]).toString()),i&&r._player&&"visible"===$E.visibility){const e=Math.min(6e3,r._player.renderFreezeAccTime);s.A_vrrft=Math.round(e).toString(),r._player.renderFreezeAccTime=Math.max(0,r._player.renderFreezeAccTime-e)}if(s.A_rvps=Ng[r._player?r._player.videoElementStatus:"uninit"].toString(),n){const t=n.videoRecv.find((t=>t.ssrc===e));if(t&&void 0!==o.totalInterFrameDelay&&void 0!==o.totalSquaredInterFrameDelay&&void 0!==t.totalInterFrameDelay&&void 0!==t.totalSquaredInterFrameDelay){const e=o.totalInterFrameDelay-t.totalInterFrameDelay,n=o.totalSquaredInterFrameDelay-t.totalSquaredInterFrameDelay,r=o.framesDecodeCount-t.framesDecodeCount,i=e/r*1e3,a=Math.round(1e3*Math.sqrt((n-Math.pow(e,2)/r)/r));!isNaN(a)&&i+a>Math.max(3*i,i+150)&&(s.A_ifdsd=a.toString())}}return s}(i._videoSSRC,e,n,i.videoTrack,t):void 0;r&&Rb((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,em.SUBSCRIBE_STATS,{stream_id:i.uid,stats:r})}))}if(o.has(Xm.AUDIO)&&i.audioTrack){const t=i.audioTrack?function(e,t,n,r){const i=t.audioRecv.find((t=>t.ssrc===e));if(!i)return null;const o={id:gb(10,""),timestamp:new Date(t.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:i.ssrc.toString()};if(o.bytesReceived=i.bytes.toString(),o.packetsLost=i.packetsLost.toString(),o.packetsReceived=i.packets.toString(),i.outputLevel?o.A_aol=Math.round(100*i.outputLevel).toString():o.A_aol=Math.round(100*r._source.getAccurateVolumeLevel()).toString(),o.A_apol=Math.round(100*r._source.getAccurateVolumeLevel()).toString(),r&&(o.A_artd=r._originMediaStreamTrack.enabled&&r._mediaStreamTrack.enabled?"0":"1"),o.A_jr=i.jitterMs.toString(),o.A_jbm=Math.floor(i.jitterBufferMs).toString(),o.A_cdm=Math.floor(i.jitterBufferMs).toString(),o.A_raps=Ng[N_.getPlayerState(r.getTrackId())].toString(),n){const t=n.audioRecv.find((t=>t.ssrc===e));if(t){const e=i.concealedSamples-t.concealedSamples;e>0&&(o.A_cs=Math.round(e).toString())}}return o}(i._audioSSRC,e,n,i.audioTrack):void 0;t&&Rb((()=>{var e;return null===(e=this.requestUpload)||void 0===e?void 0:e.call(this,em.SUBSCRIBE_STATS,{stream_id:i.uid,stats:t})}))}}))}uploadRelatedDownlinkStats(e,t){var n;((null===(n=this.requestRemoteMedia)||void 0===n?void 0:n.call(this))||[]).forEach((n=>{let[r,i]=n;if(i.has(Xm.VIDEO)&&r.videoTrack){var o;const n=!0===(r._videoSSRC&&(null===(o=this.requestVideoIsReady)||void 0===o?void 0:o.call(this,r._videoSSRC))||!1),i=function(e,t,n,r,i,o){const s=n.videoRecv.find((t=>t.ssrc===e)),a=i?i.videoRecv.find((t=>t.ssrc===e)):void 0;if(!s)return null;const c=ZE.isRemoteVideoFreeze(o,s,a)&&t,u={mediaType:"video",isVideoMute:!1,peerId:r,frameRateReceived:s.receivedFrame&&s.receivedFrame.frameRate.toString(),frameRateDecoded:s.decodedFrame&&s.decodedFrame.frameRate.toString(),isFreeze:c,bytesReceived:s.bytes.toString(),packetsReceived:s.packets.toString(),packetsLost:s.packetsLost.toString(),qpSumPerFrame:Math.floor(s.qpSumPerFrame).toString()};return s.framesRateFirefox&&(u.frameRateDecoded=s.framesRateFirefox.toString(),u.frameRateReceived=s.framesRateFirefox.toString()),u}(r._videoSSRC,n,e,r.uid,t,r.videoTrack);i&&Rb((()=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,em.SUBSCRIBE_RELATED_STATS,{stream_id:r.uid,stats:i})}))}if(i.has(Xm.AUDIO)&&r.audioTrack){const t=function(e,t,n,r){const i=t.audioRecv.find((t=>t.ssrc===e));if(!i)return null;const o=ZE.isRemoteAudioFreeze(r);return{mediaType:"audio",isAudioMute:!1,peerId:n,googJitterReceived:i.jitterMs.toString(),isFreeze:o,bytesReceived:i.bytes.toString(),packetsReceived:i.packets.toString(),packetsLost:i.packetsLost.toString(),frameReceived:i.receivedFrames.toString(),frameDropped:i.droppedFrames.toString()}}(r._audioSSRC,e,r.uid,r.audioTrack);t&&Rb((()=>{var e;null===(e=this.requestUpload)||void 0===e||e.call(this,em.SUBSCRIBE_RELATED_STATS,{stream_id:r.uid,stats:t})}))}}))}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(e){e.forEach((e=>{let[t,n]=e;n.has(Xm.VIDEO)&&t.videoTrack&&t.videoTrack.getProcessorStats().forEach((e=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,e.type,e.stats)})),n.has(Xm.AUDIO)&&t.audioTrack&&t.audioTrack.getProcessorStats().forEach((e=>{var t;null===(t=this.requestUpload)||void 0===t||t.call(this,e.type,e.stats)}))}))}}function yI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _I(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yI(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const EI="v=0\no=- 0 0 IN IP4 127.0.0.1\ns=AgoraGateway\nt=0 0\na=group:BUNDLE 0\na=msid-semantic: WMS\na=ice-lite\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 127.0.0.1\na=mid:0\n",bI="9",wI=2e4,SI=4e4;class TI{get localCapabilities(){return Ib(this._localCapabilities)}get rtpCapabilities(){return Ib(this._rtpCapabilities)}get candidates(){return Ib(this._candidates)}get iceParameters(){return Ib(this._iceParameters)}get dtlsParameters(){return Ib(this._dtlsParameters)}constructor(e){Kh(this,"sessionDesc",void 0),Kh(this,"_localCapabilities",void 0),Kh(this,"_rtpCapabilities",void 0),Kh(this,"_candidates",void 0),Kh(this,"_iceParameters",void 0),Kh(this,"_dtlsParameters",void 0),Kh(this,"setup",void 0),Kh(this,"currentMidIndex",void 0),Kh(this,"cname",void 0),Kh(this,"firefoxSsrcMidMap",new Map),e=Ib(e);const{remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:i,remoteSetup:o,localCapabilities:s,cname:a}=e,c=YC.exports.parse(EI);this._rtpCapabilities=i,this._candidates=r,this._iceParameters=t,this._dtlsParameters=n,this._localCapabilities=s,this.setup=o,this.cname=a;const u=this.rtpCapabilities.send;for(const e of c.mediaDescriptions){if(e.attributes.iceUfrag=t.iceUfrag,e.attributes.icePwd=t.icePwd,e.attributes.fingerprints=n.fingerprints,e.attributes.candidates=r,e.attributes.setup=o,"application"===e.media.mediaType&&(e.attributes.sctpPort="5000"),"video"===e.media.mediaType&&(e.media.fmts=u.videoCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=u.videoCodecs,e.attributes.extmaps=u.videoExtensions,df("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=nR([{ssrcId:SI,rtx:df("USE_SUB_RTX")?40001:void 0}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}if("audio"===e.media.mediaType&&(e.media.fmts=u.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=u.audioCodecs,e.attributes.extmaps=u.audioExtensions,hR(e),df("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=nR([{ssrcId:wI}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}}this.sessionDesc=c,this.currentMidIndex=c.mediaDescriptions.length-1}updateRemoteRTPCapabilities(e){const t=YC.exports.parse(EI);this._rtpCapabilities=e;const n=this.rtpCapabilities.send;for(const e of t.mediaDescriptions){if(e.attributes.iceUfrag=this._iceParameters.iceUfrag,e.attributes.icePwd=this._iceParameters.icePwd,e.attributes.fingerprints=this._dtlsParameters.fingerprints,e.attributes.candidates=this._candidates,e.attributes.setup=this.setup,"application"===e.media.mediaType&&(e.attributes.sctpPort="5000"),"video"===e.media.mediaType&&(e.media.fmts=n.videoCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=n.videoCodecs,e.attributes.extmaps=n.videoExtensions,df("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=nR([{ssrcId:SI,rtx:df("USE_SUB_RTX")?40001:void 0}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}if("audio"===e.media.mediaType&&(e.media.fmts=n.audioCodecs.map((e=>e.payloadType.toString(10))),e.attributes.payloads=n.audioCodecs,e.attributes.extmaps=n.audioExtensions,df("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:t,ssrcGroups:n}=nR([{ssrcId:wI}],this.cname);e.attributes.ssrcs=t,e.attributes.ssrcGroups=n}}this.sessionDesc=t,this.currentMidIndex=t.mediaDescriptions.length-1}preloadRemoteMedia(e){this.rtpCapabilities;const t=this.candidates,n=this.dtlsParameters,r=this.iceParameters,i=this.rtpCapabilities.send;for(let o=1;o<e;o++){const e=2*o+wI,s=2*o+SI,{ssrcs:a,ssrcGroups:c}=nR([{ssrcId:e}],this.cname),{ssrcs:u,ssrcGroups:l}=nR([{ssrcId:s,rtx:df("USE_SUB_RTX")?s+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:bI,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.videoCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.videoExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:u,ssrcGroups:l,rtcpFeedbackWildcards:[],payloads:i.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:bI,protos:["UDP","TLS","RTP","SAVPF"],fmts:i.audioCodecs.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:r.iceUfrag,icePwd:r.icePwd,unrecognized:[],candidates:t,extmaps:i.audioExtensions,fingerprints:n.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:a,ssrcGroups:c,rtcpFeedbackWildcards:[],payloads:i.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*o)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return YC.exports.print(this.sessionDesc)}send(e,t,n,r){const{ssrcs:i,ssrcGroups:o}=nR(t,this.cname,df("SYNC_GROUP")?n:void 0),s=this.findPreloadMediaDesc(i);if(s){if(bh()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,s.attributes.mid),r&&(r.twcc||r.remb)){const e=this.sessionDesc.mediaDescriptions.indexOf(s);return this.sessionDesc.mediaDescriptions[e]=this.mungSendMediaDesc(s,r),{mid:s.attributes.mid,needExchangeSDP:!0}}return{mid:s.attributes.mid,needExchangeSDP:!1}}{const t=this.findAvailableMediaIndex(e,i);let n;return-1===t||Eh()||wh()||Rh()||0===t&&df("USE_SUB_RTX")?(n=this.createOrRecycleSendMedia(e,i,o,"sendonly",r),this.updateBundleMids()):(n=Ib(this.sessionDesc.mediaDescriptions[t]),n.attributes.direction="sendonly",n.attributes.ssrcs=i,n.attributes.ssrcGroups=o,this.sessionDesc.mediaDescriptions[t]=this.mungSendMediaDesc(n,r)),bh()&&this.firefoxSsrcMidMap.set(i[0].ssrcId,n.attributes.mid),{mid:n.attributes.mid,needExchangeSDP:!0}}}batchSend(e){const t=e.map((e=>{let{kind:t,ssrcMsg:n,mslabel:r}=e;return this.send(t,n,r)})),n=[];let r=!1;return t.forEach((e=>{let{mid:t,needExchangeSDP:i}=e;i&&(r=!0),n.push(t)})),{mids:n,needExchangeSDP:r}}stopSending(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>t.attributes.mid&&-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");t.forEach((e=>{"0"===e.attributes.mid||bh()||Eh()||wh()?e.attributes.ssrcs=[]:(e.attributes.ssrcs=[],e.attributes.direction="inactive",e.media.port="0")})),this.updateBundleMids()}mute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.mute."));t.attributes.direction="inactive"}unmute(e){const t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("mediaDescription not found with ".concat(e," in remote SDP when calling RemoteSDP.unmute."));t.attributes.direction="sendonly"}muteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>e.includes(t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="inactive"}))}unmuteRemote(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>e.includes(t.attributes.mid||"")));if(t.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");t.forEach((e=>{e.attributes.direction="recvonly"}))}receive(e,t,n,r){e.forEach(((e,i)=>{this.createOrRecycleRecvMedia(e,[],"recvonly",t,n,r[i])})),this.updateBundleMids()}stopReceiving(e){const t=this.sessionDesc.mediaDescriptions.filter((t=>-1!==e.indexOf(t.attributes.mid)));if(t.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");t.forEach((e=>{e.media.port="0",e.attributes.direction="inactive"})),this.updateBundleMids()}updateCandidates(e){e===Jm.TCP?this._candidates.forEach((e=>{-1===this._candidates.findIndex((t=>"tcp"===t.transport&&t.connectionAddress===e.connectionAddress&&t.port===e.port))&&this._candidates.push(_I(_I({},e),{},{foundation:"tcpcandidate",priority:Number(e.priority)-1+"",transport:"tcp",port:Number(e.port)+90+""}))})):this._candidates=this._candidates.filter((e=>"tcp"!==e.transport));for(const e of this.sessionDesc.mediaDescriptions)e.attributes.candidates=this.candidates}restartICE(e){e=Ib(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach((t=>{t.attributes.iceUfrag=e.iceUfrag,t.attributes.icePwd=e.icePwd}))}predictReceivingMids(e){const t=[];for(let n=0;n<e;n++)t.push((this.currentMidIndex+n+1).toString(10));return t}findAvailableMediaIndex(e,t){return this.sessionDesc.mediaDescriptions.findIndex((n=>{const r=n.media.mediaType===e&&"0"!==n.media.port&&("sendonly"===n.attributes.direction||"sendrecv"===n.attributes.direction)&&0===n.attributes.ssrcs.length;if(bh()){if(r){const e=this.firefoxSsrcMidMap.get(t[0].ssrcId);return!(e||"0"!==n.attributes.mid&&"1"!==n.attributes.mid)||!(!e||e!==n.attributes.mid)}return!1}return r}))}createOrRecycleRecvMedia(e,t,n,r,i,o){const s=e._mediaStreamTrack.kind,a=this.rtpCapabilities.recv,c=this.localCapabilities.send;let u=[];if(s===Xm.VIDEO){var l,A;if(df("H264_PROFILE_LEVEL_ID")&&"h264"===r&&(u=a.videoCodecs.filter((e=>{var t,n;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)&&(null==e||null===(n=e.fmtp)||void 0===n?void 0:n.parameters["profile-level-id"])===df("H264_PROFILE_LEVEL_ID")}))),!u||0===(null===(l=u)||void 0===l?void 0:l.length)){const e=c.videoCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(r)}));0!==e.length&&(u=a.videoCodecs.filter((t=>e.some((e=>e.payloadType===t.payloadType)))))}if(df("USE_PUB_RTX")){const e=u.map((e=>e.payloadType.toString())),t=a.videoCodecs.filter((t=>{var n,r;return"rtx"===(null===(n=t.rtpMap)||void 0===n?void 0:n.encodingName)&&e.includes((null===(r=t.fmtp)||void 0===r?void 0:r.parameters.apt)||"")}));u=[...u,...t]}0===u.length&&(Jp.warning("codec ".concat(r," not included in rtpCapabilities, fallback to default payloads: ").concat(null===(A=a.videoCodecs[0].rtpMap)||void 0===A?void 0:A.encodingName)),u=a.videoCodecs)}else u=a.audioCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes(i)})),0===u.length&&(Jp.warning("codec ".concat(i," not included in rtpCapabilities, fallback to opus")),u=a.audioCodecs.filter((e=>{var t;return((null===(t=e.rtpMap)||void 0===t?void 0:t.encodingName.toLowerCase())||"").includes("opus")})));const h=s===Xm.VIDEO?a.videoExtensions:a.audioExtensions;this.currentMidIndex+=1;const d="".concat(this.currentMidIndex);let p={media:{mediaType:s,port:bI,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:n,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(d)}};p=this.mungRecvMediaDsec(p,e,o);const f=this.findFirstClosedMedia(s);if(f){const e=this.sessionDesc.mediaDescriptions.indexOf(f);this.sessionDesc.mediaDescriptions[e]=p}else this.sessionDesc.mediaDescriptions.push(p);return p}createOrRecycleSendMedia(e,t,n,r,i){const o=this.rtpCapabilities.send,s=e===Xm.VIDEO?o.videoCodecs:o.audioCodecs,a=e===Xm.VIDEO?o.videoExtensions:o.audioExtensions;this.currentMidIndex+=1;const c="".concat(this.currentMidIndex);let u={media:{mediaType:e,port:bI,protos:["UDP","TLS","RTP","SAVPF"],fmts:s.map((e=>e.payloadType.toString(10)))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:a,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:t,ssrcGroups:n,rtcpFeedbackWildcards:[],payloads:s,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(c)}};u=this.mungSendMediaDesc(u,i);const l=this.findFirstClosedMedia(e);if(l){const e=this.sessionDesc.mediaDescriptions.indexOf(l);this.sessionDesc.mediaDescriptions[e]=u}else this.sessionDesc.mediaDescriptions.push(u);return u}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter((e=>"0"!==e.media.port)).map((e=>e.attributes.mid))}mungRecvMediaDsec(e,t,n){const r=Ib(e);return iR(r),rR(r,t),oR(r,t),sR(r),aR(r,n,this.localCapabilities.send),r}mungSendMediaDesc(e,t){const n=Ib(e);return aR(n,t,this.localCapabilities.recv),hR(n),n}updateRecvMedia(e,t){const n=this.sessionDesc.mediaDescriptions.findIndex((t=>t.attributes.mid===e));if(-1!==n){const e=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[n],t);this.sessionDesc.mediaDescriptions[n]=e}}bumpMid(e){this.currentMidIndex+=e}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find((t=>bh()?"0"===t.media.port&&t.media.mediaType===e:"0"===t.media.port))}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find((t=>{var n,r;return(null===(n=t.attributes)||void 0===n||null===(r=n.ssrcs[0])||void 0===r?void 0:r.ssrcId)===e[0].ssrcId}))}getSSRC(e){var t;return null===(t=this.sessionDesc.mediaDescriptions.find((t=>t.attributes.mid===e)))||void 0===t?void 0:t.attributes.ssrcs}}var CI;function RI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function II(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?RI(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):RI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let OI=(Ry((CI=class e extends gv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(e,t,n){super(e,t),Kh(this,"store",void 0),Kh(this,"peerConnection",void 0),Kh(this,"remoteSDP",void 0),Kh(this,"initialOffer",void 0),Kh(this,"transportEventReceiver",void 0),Kh(this,"statsFilter",void 0),Kh(this,"localCapabilities",void 0),Kh(this,"localCandidateCount",0),Kh(this,"allCandidatesReceived",!1),Kh(this,"establishPromise",void 0),Kh(this,"mutex",new n_("NVExtentionsConnection-mutex")),Kh(this,"rtcMedia",void 0),this.store=t,this.peerConnection=n,this.statsFilter=kR(this.peerConnection,df("STATS_UPDATE_INTERVAL"),void 0,bh()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(e){try{const e=await this.peerConnection.createOffer();if(!e.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const t=$C(e.sdp),n=await uR(!df("USE_PUB_RTX")&&!df("USE_SUB_RTX"),df("FILTER_VIDEO_FEC"),df("FILTER_AUDIO_FEC"));return this.localCapabilities=n,this.initialOffer=e,II(II({},t),{},{rtpCapabilities:n,offerSDP:e.sdp})}catch(e){throw new Qp(Vp.GET_LOCAL_CONNECTION_PARAMS_FAILED,e.toString())}}async connect(e,t,n,r,i,o){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new TI({remoteIceParameters:e,remoteDtlsParameters:t,candidates:n,remoteRTPCapabilities:r,remoteSetup:i,localCapabilities:AR(this.localCapabilities),cname:o});const s=this.remoteSDP.toString(),a=YC.exports.parse(this.initialOffer.sdp),c=a.mediaDescriptions.find((e=>"audio"===e.media.mediaType));c&&hR(c);const u=YC.exports.print(a),l=this.logSDPExchange(u||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:u}),null==l||l(s),await this.peerConnection.setRemoteDescription({type:"answer",sdp:s})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(e.toString()))}}async updateRemoteConnect(e){var t,n,r;null===(t=this.remoteSDP)||void 0===t||t.updateRemoteRTPCapabilities(e),null===(n=this.remoteSDP)||void 0===n||n.preloadRemoteMedia(2);const i=null===(r=this.remoteSDP)||void 0===r?void 0:r.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(o),Jp.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(e,t,n){var r=this;return GC((function*(){const i=yield KC(r.mutex.lock("From NVExtentionsConnection.send"));try{if(!r.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const o=[];e.forEach((e=>{const t=r.peerConnection.addTransceiver(e._mediaStreamTrack,{direction:"sendonly"});o.push(t)})),bh()&&!0===df("SIMULCAST")&&(yield KC(r.applySimulcastForFirefox(o,e)));const s=yield KC(r.peerConnection.createOffer()),a=r.remoteSDP.predictReceivingMids(e.length),c=r.mungSendOfferSDP(s.sdp,e,a),u=YC.exports.parse(c),l=a.map((e=>{const t=u.mediaDescriptions.find((t=>t.attributes.mid===e));if(!t)throw new Error("Cannot extract ssrc from mediaDescription.");return eR(t,df("USE_PUB_RTX"))}));let A;try{A=yield l}catch(i){A=[],r.remoteSDP.receive(e,t,n,A);const o=r.remoteSDP.toString();throw yield KC(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield KC(r.peerConnection.setRemoteDescription({type:"answer",sdp:o})),yield KC(r.stopSending(a,!0)),i}r.remoteSDP.receive(e,t,n,A);const h=r.remoteSDP.toString(),d=r.logSDPExchange(c,"offer","local","send");return yield KC(r.peerConnection.setLocalDescription({type:"offer",sdp:c})),yield KC(r.applySimulcastEncodings(o,e)),yield KC(r.applySendEncodings(o,e)),null==d||d(h),yield KC(r.peerConnection.setRemoteDescription({type:"answer",sdp:h})),o.map(((e,t)=>{const n=a[t];return{localSSRC:l[t],id:n,transceiver:e}}))}catch(e){throw e instanceof Qp?e:new Qp(Vp.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(e.toString()))}finally{i()}}))()}async stopSending(e,t){const n=t?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const t=this.peerConnection.getTransceivers().filter((t=>-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");t.map((e=>{var t;e.direction="inactive",null===(t=e.stop)||void 0===t||t.call(e)}));const r=await this.peerConnection.createOffer(),i=this.logSDPExchange(r.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(e);const o=this.remoteSDP.toString();null==i||i(o),await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(e.toString()))}finally{n&&n()}}async receive(e,t,n,r){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(e," before remoteSDP created."));const{mid:i,needExchangeSDP:o}=this.remoteSDP.send(e,t,n,r);if(o){const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer(),o=this.mungReceiveAnswerSDP(r.sdp,i,e);null==n||n(o||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:o}),Jp.debug("[NVExtentionsConnection] receive ".concat(e," by exchanging SDP."))}else Jp.debug("[NVExtentionsConnection] receive ".concat(e," no need to exchange SDP."));const s=this.peerConnection.getTransceivers().find((e=>e.mid===i));if(!s)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:s.receiver.track,id:i}}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async batchReceive(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:t,needExchangeSDP:n}=this.remoteSDP.batchSend(e);if(n){const e=this.remoteSDP.toString(),t=this.logSDPExchange(e,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:e});const n=await this.peerConnection.createAnswer();null==t||t(n.sdp||""),await this.peerConnection.setLocalDescription(n),Jp.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else Jp.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return t.map((e=>{const t=this.peerConnection.getTransceivers().find((t=>t.mid===e));if(!t)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:t.receiver.track,id:e}}))}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(e.toString()))}}async stopReceiving(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(e.toString()))}}async muteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.mute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(e.toString()))}}async unmuteRemote(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(e," before remote SDP created."));this.remoteSDP.unmute(e);const t=this.remoteSDP.toString(),n=this.logSDPExchange(t,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:t});const r=await this.peerConnection.createAnswer();null==n||n(r.sdp||""),await this.peerConnection.setLocalDescription(r)}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(e.toString()))}}async muteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((e=>{e.direction="inactive"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.muteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(e.toString()))}}async unmuteLocal(e){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const t=this.peerConnection.getTransceivers().filter((t=>t.mid&&-1!==e.indexOf(t.mid)));if(t.length!==e.length)throw new Error("Transceivers' length doesn't match mids' length.");t.map((async(e,t)=>{e.direction="sendonly"}));const n=await this.peerConnection.createOffer(),r=this.logSDPExchange(n.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(n),this.remoteSDP.unmuteRemote(e);const i=this.remoteSDP.toString();null==r||r(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(e.toString()))}}restartICE(e){var t=this;return GC((function*(){const n=yield KC(t.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(vv().supportPCSetConfiguration){const n=t.peerConnection.getConfiguration(),r=e===Jm.RELAY?"relay":"all";n.iceTransportPolicy!==r&&(Jp.debug("restartICE change iceTransportPolicy from [".concat(n.iceTransportPolicy,"] to [").concat(r,"]")),n.iceTransportPolicy=r,t.peerConnection.setConfiguration(n))}else if(e===Jm.RELAY)return;e!==Jm.RELAY&&t.remoteSDP.updateCandidates(e);const r=yield KC(t.peerConnection.createOffer({iceRestart:!0}));if(!r.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const i=$C(r.sdp),{remoteIceParameters:o}=yield i.iceParameters;t.remoteSDP.restartICE(o);const s=t.remoteSDP.toString(),a=t.logSDPExchange(r.sdp||"","offer","local","restartICE");yield KC(t.peerConnection.setLocalDescription(r)),null==a||a(s),yield KC(t.peerConnection.setRemoteDescription({type:"answer",sdp:s}))}catch(e){Jp.warning("restart ICE failed, abort operation",e)}finally{n()}}))()}close(){var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(e){return this.statsFilter.getVideoIsReady(e)}async updateEncoderConfig(e,t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const n=await this.peerConnection.createOffer(),r=this.mungSendOfferSDP(n.sdp,[t],[e]);this.remoteSDP.updateRecvMedia(e,t);const i=this.remoteSDP.toString(),o=this.logSDPExchange(r,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:r}),null==o||o(i),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(e){throw new Qp(Vp.EXCHANGE_SDP_FAILED,e.toString())}}async updateSendParameters(e,t){const n=this.peerConnection.getTransceivers().filter((t=>t.mid===e));1===n.length&&(this.isVP8Simulcast(t)?bh()||await this.applySimulcastEncodings(n,[t]):await this.applySendEncodings(n,[t]))}setStatsRemoteVideoIsReady(e,t){this.statsFilter.setVideoIsReady2(e,t)}async replaceTrack(e,t){const n=this.peerConnection.getTransceivers().find((e=>e.mid===t));n&&await n.sender.replaceTrack(e._mediaStreamTrack)}getP2PConnectionParams(){var e;if(null===(e=this.peerConnection.currentLocalDescription)||void 0===e||!e.sdp||!this.localCapabilities)throw new Error;return II(II({},$C(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var e;null===(e=this.onICEConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var e;null===(e=this.onConnectionStateChange)||void 0===e||e.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=e=>{e.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Jp.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout((()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Jp.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))}),df("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(sm(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),df("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),df("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nb(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!df("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}async applySendEncodings(e,t){try{if(!vv().supportSetRtpSenderParameters)return;if(e.length!==t.length)return;for(let c=0;c<e.length;c++){const u=e[c],l=t[c];if(l&&l instanceof PS){var n,r;if(this.isVP8Simulcast(l))continue;const e={},t={};switch(l._optimizationMode){case"motion":e.degradationPreference="maintain-framerate";break;case"detail":e.degradationPreference="maintain-resolution";break;default:e.degradationPreference="balanced"}var i,o,s,a;if(null!==(n=l._encoderConfig)&&void 0!==n&&n.bitrateMax&&(t.maxBitrate=1e3*(null===(i=l._encoderConfig)||void 0===i?void 0:i.bitrateMax)),l._hints.includes(Mm.LOW_STREAM)&&(null!==(o=l._encoderConfig)&&void 0!==o&&o.frameRate&&(t.maxFramerate=ib(l._encoderConfig.frameRate)),null!==(s=l._encoderConfig)&&void 0!==s&&s.scaleResolutionDownBy&&(null===(a=l._encoderConfig)||void 0===a?void 0:a.scaleResolutionDownBy)>1&&(t.scaleResolutionDownBy=l._encoderConfig.scaleResolutionDownBy)),df("DSCP_TYPE")&&Mh()){const e=df("DSCP_TYPE");["very-low","low","medium","high"].includes(e)&&(t.networkPriority=e)}const c=u.sender.getParameters(),A=null===(r=c.encodings)||void 0===r?void 0:r[0];bh()&&!A&&(e.encodings=[t]),A&&Object.assign(A,t),Object.assign(c,e),await u.sender.setParameters(c)}}}catch(e){Jp.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(e,t,n){const r=YC.exports.parse(e);return t.forEach(((e,t)=>{const i=n[t],o=r.mediaDescriptions.find((e=>e.attributes.mid===i));o&&(rR(o,e),cR(o,e,this.store.codec))})),YC.exports.print(r)}mungReceiveAnswerSDP(e,t,n){const r=YC.exports.parse(e),i=r.mediaDescriptions.find((e=>e.attributes.mid===t));return i&&n===Xm.AUDIO&&"audio"===i.media.mediaType&&hR(i),YC.exports.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=e=>{var t;null===(t=this.onFirstAudioReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoReceived=e=>{var t;null===(t=this.onFirstVideoReceived)||void 0===t||t.call(this,e)},this.statsFilter.onFirstAudioDecoded=e=>{var t;null===(t=this.onFirstAudioDecoded)||void 0===t||t.call(this,e)},this.statsFilter.onFirstVideoDecoded=(e,t,n)=>{var r;null===(r=this.onFirstVideoDecoded)||void 0===r||r.call(this,e,t,n)},this.statsFilter.onSelectedLocalCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedLocalCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onSelectedRemoteCandidateChanged=(e,t)=>{var n;null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n||n.call(this,e,t)},this.statsFilter.onFirstVideoDecodedTimeout=e=>{var t;null===(t=this.onFirstVideoDecodedTimeout)||void 0===t||t.call(this,e)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(e,t){if(e.length===t.length)for(let s=0;s<e.length;s++){var n,r,i,o;const a=e[s],c=t[s];if(c instanceof PS&&!c._hints.includes(Mm.LOW_STREAM)&&null!==(n=c._encoderConfig)&&void 0!==n&&n.bitrateMax&&(null===(r=c._encoderConfig)||void 0===r?void 0:r.bitrateMax)>200&&null!==(i=c._scalabiltyMode)&&void 0!==i&&i.numSpatialLayers&&(null===(o=c._scalabiltyMode)||void 0===o?void 0:o.numSpatialLayers)>1&&"vp8"===this.store.codec){const e={},t={high:1e3*(c._encoderConfig.bitrateMax-50),medium:5e4};e.encodings=[{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:t.high}];const n=a.sender.getParameters();await a.sender.setParameters(Object.assign(n,e))}}}async applySimulcastEncodings(e,t){if(!bh()&&e.length===t.length)for(let n=0;n<e.length;n++){const r=t[n];if(r instanceof PS&&this.isVP8Simulcast(r)){const t=e[n],i={},o={high:1e3*(r._encoderConfig.bitrateMax-50),medium:5e4};i.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:o.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:o.medium,scaleResolutionDownBy:4}];const s=t.sender.getParameters();await t.sender.setParameters(Object.assign(s,i))}}}isVP8Simulcast(e){var t,n,r,i;return!!(e instanceof PS&&df("SIMULCAST")&&"vp8"===this.store.codec&&!e._hints.includes(Mm.LOW_STREAM)&&null!==(t=e._encoderConfig)&&void 0!==t&&t.bitrateMax&&(null===(n=e._encoderConfig)||void 0===n?void 0:n.bitrateMax)>200&&null!==(r=e._scalabiltyMode)&&void 0!==r&&r.numSpatialLayers&&(null===(i=e._scalabiltyMode)||void 0===i?void 0:i.numSpatialLayers)>1)}logSDPExchange(e,t,n,r){if(df("SDP_LOGGING"))return Jp.upload("exchanging ".concat(n," ").concat(t," SDP during NVExtentionsConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}async getRemoteSSRC(e){if(!this.remoteSDP)return;const t=this.remoteSDP.getSSRC(e);return null==t?void 0:t[0].ssrcId}setConfiguration(t){if(vv().supportPCSetConfiguration){const n=e.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"connect"),CI.prototype),Ry(CI.prototype,"updateRemoteConnect",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"updateRemoteConnect"),CI.prototype),Ry(CI.prototype,"receive",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"receive"),CI.prototype),Ry(CI.prototype,"batchReceive",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"batchReceive"),CI.prototype),Ry(CI.prototype,"stopReceiving",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"stopReceiving"),CI.prototype),Ry(CI.prototype,"muteRemote",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"muteRemote"),CI.prototype),Ry(CI.prototype,"unmuteRemote",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"unmuteRemote"),CI.prototype),Ry(CI.prototype,"muteLocal",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"muteLocal"),CI.prototype),Ry(CI.prototype,"unmuteLocal",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"unmuteLocal"),CI.prototype),Ry(CI.prototype,"close",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"close"),CI.prototype),Ry(CI.prototype,"updateEncoderConfig",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"updateEncoderConfig"),CI.prototype),Ry(CI.prototype,"updateSendParameters",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"updateSendParameters"),CI.prototype),Ry(CI.prototype,"replaceTrack",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"replaceTrack"),CI.prototype),Ry(CI.prototype,"getRemoteSSRC",[xI],Object.getOwnPropertyDescriptor(CI.prototype,"getRemoteSSRC"),CI.prototype),CI);function xI(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From NVExtentionsConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}var NI;function BI(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=qC,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new LI(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function LI(e){function t(e){if(Object(e)!==e)return Zl.reject(new TypeError(e+" is not an object."));var t=e.done;return Zl.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(LI=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Zl.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Zl.reject(e):t(n.apply(this.s,arguments))}},new LI(e)}let DI=(Ry((NI=class e extends gv{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n){super(t,n),Kh(this,"store",void 0),Kh(this,"peerConnection",void 0),Kh(this,"cname",void 0),Kh(this,"mutex",new n_("DataChannelConnection-mutex")),Kh(this,"dataChannel",void 0),Kh(this,"_p2pConnection",void 0),Kh(this,"establishPromise",void 0),Kh(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(e.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new OI(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var e;const t=null===(e=this._nvMedia)||void 0===e?void 0:e.getLocalRtpCapabilities();return await this._p2pConnection.establish(t)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(e,t,n,r,i,o){return this.cname=o,await this._p2pConnection.connect(e,t,n,r,i,o),await new Zl(((e,t)=>{const r=setTimeout((()=>{this.closeSignal(),t(new Qp(Vp.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(n))))}),2e3);this.dataChannel.onopen=()=>{if("open"===this.dataChannel.readyState)return clearTimeout(r),void e()},this.dataChannel.onerror=e=>{this.closeSignal(),t(e)}})),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(e,t,n){var r=this;return GC((function*(){const i=yield KC(r.mutex.lock("From DataChannelConnection.send"));try{return yield*zC(BI(r._p2pConnection.send(e,t,n)),KC)}finally{i()}}))()}async stopSending(e,t){return this._p2pConnection.stopSending(e,t)}async receive(e,t,n,r){return this._nvMedia?(Jp.debug("[DataChannelConnection] receive ".concat(e," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(e,t,this.cname)):(Jp.debug("[DataChannelConnection] receive ".concat(e," by WebRTC.")),await this._p2pConnection.receive(e,t,n,r))}async batchReceive(e){return[...await this._p2pConnection.batchReceive(e)]}async stopReceiving(e){return await this._p2pConnection.stopReceiving(e)}async muteRemote(e){return await this._p2pConnection.muteRemote(e)}async unmuteRemote(e){return await this._p2pConnection.unmuteRemote(e)}async muteLocal(e){return await this._p2pConnection.muteLocal(e)}async unmuteLocal(e){return await this._p2pConnection.unmuteLocal(e)}restartICE(e){var t=this;return GC((function*(){return yield*zC(BI(t._p2pConnection.restartICE(e)),KC)}))()}close(){var e;null===(e=this._nvMedia)||void 0===e||e.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(e){return this._p2pConnection.getRemoteVideoIsReady(e)}updateRemoteConnect(e){var t;null===(t=this._nvMedia)||void 0===t||t.setRemoteRtpCapabilities(e),this._p2pConnection.updateRemoteConnect(e)}async updateEncoderConfig(e,t){return await this._p2pConnection.updateEncoderConfig(e,t)}async updateSendParameters(e,t){return await this._p2pConnection.updateSendParameters(e,t)}setStatsRemoteVideoIsReady(e,t){this._p2pConnection.setStatsRemoteVideoIsReady(e,t)}async replaceTrack(e,t){return await this._p2pConnection.replaceTrack(e,t)}async getRemoteSSRC(e){return this._p2pConnection.getRemoteSSRC(e)}logSDPExchange(e,t,n,r){if(df("SDP_LOGGING"))return Jp.upload("exchanging ".concat(n," ").concat(t," SDP during DataChannelConnection.").concat(r,"\n"),e),"offer"===t?e=>{this.logSDPExchange(e,"answer","local"===n?"remote":"local",r)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&"off"!==t.turnServer.mode&&(sm(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.servers)),df("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...e.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),df("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach((e=>{e.forceturn&&(n.iceTransportPolicy="relay")})))),n}static turnServerConfigToIceServers(e){const t=[];return e.forEach((e=>{e.security?e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turns:".concat(nb(e.turnServerURL),":").concat(e.tcpport,"?transport=tcp")}):(e.udpport&&!df("FORCE_TURN_TCP")&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.udpport,"?transport=udp")}),e.tcpport&&t.push({username:e.username,credential:e.password,credentialType:"password",urls:"turn:".concat(e.turnServerURL,":").concat(e.tcpport,"?transport=tcp")}))})),t}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=e=>{var t;return null===(t=this.onICEConnectionStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onConnectionStateChange=e=>{var t;return null===(t=this.onConnectionStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportStateChange=e=>{var t;return null===(t=this.onDTLSTransportStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onDTLSTransportError=e=>{var t;return null===(t=this.onDTLSTransportError)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onICETransportStateChange=e=>{var t;return null===(t=this.onICETransportStateChange)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioReceived=e=>{var t;return null===(t=this.onFirstAudioReceived)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoReceived=e=>{var t;return null===(t=this.onFirstVideoReceived)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstAudioDecoded=e=>{var t;return null===(t=this.onFirstAudioDecoded)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onFirstVideoDecoded=(e,t,n)=>{var r;return null===(r=this.onFirstVideoDecoded)||void 0===r?void 0:r.call(this,e,t,n)},this._p2pConnection.onFirstVideoDecodedTimeout=e=>{var t;return null===(t=this.onFirstVideoDecodedTimeout)||void 0===t?void 0:t.call(this,e)},this._p2pConnection.onSelectedLocalCandidateChanged=(e,t)=>{var n;return null===(n=this.onSelectedLocalCandidateChanged)||void 0===n?void 0:n.call(this,e,t)},this._p2pConnection.onSelectedRemoteCandidateChanged=(e,t)=>{var n;return null===(n=this.onSelectedRemoteCandidateChanged)||void 0===n?void 0:n.call(this,e,t)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}setConfiguration(e){this._p2pConnection.setConfiguration(e)}}).prototype,"connect",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"connect"),NI.prototype),Ry(NI.prototype,"receive",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"receive"),NI.prototype),Ry(NI.prototype,"stopReceiving",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"stopReceiving"),NI.prototype),Ry(NI.prototype,"muteRemote",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"muteRemote"),NI.prototype),Ry(NI.prototype,"unmuteRemote",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"unmuteRemote"),NI.prototype),Ry(NI.prototype,"muteLocal",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"muteLocal"),NI.prototype),Ry(NI.prototype,"unmuteLocal",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"unmuteLocal"),NI.prototype),Ry(NI.prototype,"close",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"close"),NI.prototype),Ry(NI.prototype,"updateEncoderConfig",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"updateEncoderConfig"),NI.prototype),Ry(NI.prototype,"updateSendParameters",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"updateSendParameters"),NI.prototype),Ry(NI.prototype,"replaceTrack",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"replaceTrack"),NI.prototype),Ry(NI.prototype,"getRemoteSSRC",[MI],Object.getOwnPropertyDescriptor(NI.prototype,"getRemoteSSRC"),NI.prototype),NI);function MI(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From DataChannelConnection.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}var PI;function kI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function UI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kI(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function FI(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=qC,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new HI(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function HI(e){function t(e){if(Object(e)!==e)return Zl.reject(new TypeError(e+" is not an object."));var t=e.done;return Zl.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(HI=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Zl.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Zl.reject(e):t(n.apply(this.s,arguments))}},new HI(e)}let VI=(Ry((PI=class extends Fp{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(tv.StateChange,t,this._state)}constructor(e,t){super(),Kh(this,"store",void 0),Kh(this,"statsUploader",void 0),Kh(this,"connection",void 0),Kh(this,"localTrackMap",new Map),Kh(this,"remoteUserMap",new Map),Kh(this,"pendingLocalTracks",[]),Kh(this,"pendingRemoteTracks",[]),Kh(this,"statsCollector",void 0),Kh(this,"isPlanB",!1),Kh(this,"shouldForwardP2PCreation",void 0),Kh(this,"iceFailedCount",0),Kh(this,"dtlsFailedCount",0),Kh(this,"mutex",new n_("P2PChannel-mutex")),Kh(this,"_state",ev.Disconnected),Kh(this,"_pcStatsUploadType",df("NEW_ICE_RESTART")?Zm.FIRST_CONNECTION:Zm.OLD_FIRST_CONNECTION),Kh(this,"_isInRestartIce",!1),Kh(this,"_isStartRestartIce",!1),Kh(this,"_restartStates",["disconnected","failed"]),Kh(this,"_restartTimer",void 0),Kh(this,"_isFirstConnected",!0),Kh(this,"handleMuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==ev.Connected)return void n(new Qp(Vp.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const i=this.filterTobeMutedTracks(e);if(0===i.length)return void t();const o=i.find((e=>"videoLowTrack"===e[0]));o&&o[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(i.map((e=>{let[,{id:t}]=e;return t})));const s=this.createMuteMessage(i);await bb(this,tv.RequestMuteLocal,s),t()}catch(e){n(e)}finally{r()}})),Kh(this,"handleUnmuteLocalTrack",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==ev.Connected)return void n(new Qp(Vp.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const i=this.filterTobeUnmutedTracks(e);if(0===i.length)return void t();const o=i.find((e=>"videoLowTrack"===e[0]));if(o){const t=o[1];if(t.track._originMediaStreamTrack.stop(),vv().supportDualStreamEncoding){const n=e._mediaStreamTrack.clone();t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}else{const n=ZR(e,Sb(this,tv.RequestLowStreamParameter));t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n}await new Zl(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}await this.connection.unmuteLocal(i.map((e=>{let[,{id:t}]=e;return t})));const s=this.createUnmuteMessage(i);await bb(this,tv.RequestUnmuteLocal,s),t()}catch(e){n(e)}finally{r()}})),Kh(this,"handleUpdateVideoEncoder",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const n=this.localTrackMap.get($m.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==ev.Connected)return void t();const{id:i,track:o}=n;await this.connection.updateSendParameters(i,o),await this.connection.updateEncoderConfig(i,o),this.emit(tv.UpdateVideoEncoder,o),t()}catch(e){n(e)}finally{r()}})),Kh(this,"handleSetOptimizationMode",(async(e,t,n)=>{const r=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const n=this.localTrackMap.get($m.LocalVideoTrack);if(!this.connection||!n||n.track!==e||this.state!==ev.Connected)return;const{id:i,track:o}=n;await this.connection.updateSendParameters(i,o),t()}catch(e){n(e)}finally{r()}})),Kh(this,"handleReplaceTrack",(async(e,t,n,r)=>{let i;Jp.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(e.getTrackId(),"]")),"boolean"==typeof r&&r||(i=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var o;const n=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(!this.connection||!n||this.state!==ev.Connected)return void t();if(await(null===(o=this.connection)||void 0===o?void 0:o.replaceTrack(e,n[1].id)),this.isPlanB){const t=n[1];t.id=e._mediaStreamTrack.id,this.localTrackMap.set(n[0],t)}if(n[0]===$m.LocalVideoTrack&&vv().supportDualStreamEncoding){const t=this.localTrackMap.get($m.LocalVideoLowTrack);if(t){const n=e._mediaStreamTrack.clone();t.track._originMediaStreamTrack.stop(),t.track._mediaStreamTrack=n,t.track._originMediaStreamTrack=n,await new Zl(((e,n)=>{this.handleReplaceTrack(t.track,e,n,!0)}))}}t()}catch(e){n(e)}finally{var s;null===(s=i)||void 0===s||s()}})),Kh(this,"handleGetLocalVideoStats",(e=>{e(this.statsCollector.getLocalVideoTrackStats())})),Kh(this,"handleGetLocalAudioStats",(e=>{e(this.statsCollector.getLocalAudioTrackStats())})),Kh(this,"handleGetRemoteVideoStats",(e=>this.statsCollector.getRemoteVideoTrackStats(e.uid)[e.uid])),Kh(this,"handleGetRemoteAudioStats",(e=>this.statsCollector.getRemoteAudioTrackStats(e.uid)[e.uid])),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new vI,this.bindStatsUploaderEvents(),this.isPlanB=!vv().supportUnifiedPlan||df("CHROME_FORCE_PLAN_B")&&Mh(),this.shouldForwardP2PCreation=df("FORWARD_P2P_CREATION")&&vv().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new DI({},this.store):this.isPlanB?new VR({},this.store):new XR({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=ev.New;const r=this.shouldForwardP2PCreation&&"closed"===(null===(n=this.connection)||void 0===n?void 0:n.peerConnectionState);if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(Jp.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new DI(e,this.store):this.isPlanB?new VR(e,this.store):new XR(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new Qp(Vp.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=df("NEW_ICE_RESTART")?Zm.FIRST_CONNECTION:Zm.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,r,i,o){if(!this.connection)throw new Qp(Vp.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof DI?this.connection.updateRemoteConnect(r):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,r,i,o),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ev.Connected)}async preConnect(e,t,n,r,i,o){if(!this.connection)throw new Qp(Vp.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const s=await this.connection.connect(e,t,n,r,i,o);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=ev.Connected,s}getEstablishParams(){if(this.connection instanceof DI)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(e,t,n){var r=this;return GC((function*(){const i=yield KC(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==ev.Connected){if(r.state===ev.Disconnected)throw new Qp(Vp.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const t=e.filter((e=>-1===r.pendingLocalTracks.indexOf(e)));return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(t))}r.store.pubId=r.store.pubId+1,YE.markPublishStart(r.store.clientId,r.store.pubId);const o=r.filterTobePublishedTracks(e,t,n);if(0===o.length)return void(yield KC(r.tryToUnmuteAudio(e)));yield*zC(FI(r.doPublish(r.connection,o)),KC)}finally{i()}}))()}doPublish(e,t){var n=this;return GC((function*(){t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===$m.LocalAudioTrack?"audio":"video",i)})),n.bindLocalTrackEvents(t);const r=yield KC(e.send(t.map((e=>{let{track:t}=e;return t})),n.store.codec,n.store.audioCodec)),i=(yield KC(r.next())).value,o=n.createGatewayPublishMessage(t,i);let s;try{s=yield o}catch(e){throw r.throw(e),(null==e?void 0:e.code)===Vp.WS_ABORT&&t.forEach((e=>{let{track:t}=e;-1===n.pendingLocalTracks.indexOf(t)&&n.pendingLocalTracks.push(t)})),n.unbindLocalTrackEvents(t),e}const a=n.mapPubResToRemoteConfig(o,s),c=(yield KC(r.next(a))).value;t.forEach((e=>{let{type:t}=e;n.statsCollector.addLocalStats(t)})),n.assignLocalTracks(t,c),n.statsUploader.startUploadUplinkStats(),t.forEach((e=>{let{track:t,type:r}=e;const i=Date.now();n.store.publish(t.getTrackId(),r===$m.LocalAudioTrack?"audio":"video",void 0,i)}))}))()}publishLowStream(e){var t=this;return GC((function*(){if(!t.connection||t.state!==ev.Connected)return;const n=yield KC(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const i=t.localTrackMap.get($m.LocalVideoTrack);if(!i)throw new Qp(Vp.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has($m.LocalVideoLowTrack))throw new Qp(Vp.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const o=[{track:t.getLowVideoTrack(i.track,e),type:$m.LocalVideoLowTrack}];if(yield*zC(FI(t.doPublish(t.connection,o)),KC),i.track.muted||!i.track.enabled){var r;const e=null===(r=t.localTrackMap.get($m.LocalVideoLowTrack))||void 0===r?void 0:r.id;void 0!==e&&(yield KC(t.connection.muteLocal([e])))}}finally{n()}}))()}async republish(){this.pendingLocalTracks.length>0&&(Jp.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Eb(this,tv.RequestRePublish,this.pendingLocalTracks),this.emit(tv.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(e){for(let e=this.pendingRemoteTracks.length-1;e>=0;e--){const{user:t,kind:n}=this.pendingRemoteTracks[e];(n!==Xm.AUDIO||t._audio_added_&&t._audioSSRC)&&(n!==Xm.VIDEO||t._video_added_&&t._videoSSRC)||this.pendingRemoteTracks.splice(e,1)}if(e)await Eb(this,tv.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:e,kind:t}of this.pendingRemoteTracks)await this.subscribe(e,t,t===Xm.VIDEO?e._videoSSRC:e._audioSSRC);this.pendingRemoteTracks.forEach((e=>{let{user:t}=e;this.emit(tv.MediaReconnectEnd,t.uid)})),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==ev.Connected)return void e.forEach((e=>{const t=this.pendingLocalTracks.indexOf(e);-1!==t&&this.pendingLocalTracks.splice(t,1)}));const t=this.filterTobeUnpublishedTracks(e);if(0===t.length)return;const n=t.find((e=>"videoLowTrack"===e[0]));return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishLowStream(){if(!this.connection||this.state!==ev.Connected)return;const e=this.localTrackMap.get($m.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[$m.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map((e=>{let[,{id:t}]=e;return t}))),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map((e=>{let[t,{track:n}]=e;return{type:t,track:n}}))),t.forEach((e=>{let[t]=e;this.statsCollector.removeLocalStats(t)})),0===this.localTrackMap.size&&this.statsUploader.stopUploadUplinkStats(),n}async subscribe(e,t,n,r,i){var o;if(!this.connection||this.state!==ev.Connected)throw new Qp(Vp.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if(null!==(o=this.remoteUserMap.get(e))&&void 0!==o&&o.has(t))return;let s,a,c;if(i){const n=i.find((e=>{let{stream_type:n}=e;return n===t}));if(!n)throw new Qp(Vp.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const r=await this.connection.receive(t,n.ssrcs,String(e._uintid),n.attributes);this.connection instanceof XR&&(c=r.transceiver),s=r.track,a=r.id}else{const i=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof XR&&(c=i.transceiver),s=i.track,a=i.id}t===Xm.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(s):(e._audioTrack=new fI(s,e.uid,e._uintid,this.store),Jp.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),c&&e._audioTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(s):(e._videoTrack=new pI(s,e.uid,e._uintid,this.store),Jp.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),c&&e._videoTrack._updateRtpTransceiver(c),this.bindRemoteTrackEvents(e,e._videoTrack));const u=this.remoteUserMap.get(e);u?u.set(t,a):this.remoteUserMap.set(e,new Map([[t,a]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadDownlinkStats();const l=this.pendingRemoteTracks.findIndex((n=>{let{user:r,kind:i}=n;return r.uid===e.uid&&t===i}));-1!==l&&(this.pendingRemoteTracks.splice(l,1),this.emit(tv.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==ev.Connected)throw new Qp(Vp.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter((e=>{var t;let{user:n,mediaType:r}=e;return!(null!==(t=this.remoteUserMap.get(n))&&void 0!==t&&t.has(r))}));const t=await this.connection.batchReceive(e.map((e=>{let{user:t,mediaType:n,ssrcId:r,rtxSsrcId:i}=e;return{kind:n,ssrcMsg:[{ssrcId:r,rtx:i}],mslabel:String(t._uintid)}})));e.forEach(((e,n)=>{let{user:r,mediaType:i}=e;const{track:o,id:s,transceiver:a}=t[n];i===Xm.AUDIO?(r._audioTrack?r._audioTrack._updateOriginMediaStreamTrack(o):(r._audioTrack=new fI(o,r.uid,r._uintid,this.store),Jp.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(r._audioTrack.getTrackId()))),a&&r._audioTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(r,r._audioTrack)):(r._videoTrack?r._videoTrack._updateOriginMediaStreamTrack(o):(r._videoTrack=new pI(o,r.uid,r._uintid,this.store),Jp.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(r._videoTrack.getTrackId()))),a&&r._videoTrack._updateRtpTransceiver(a),this.bindRemoteTrackEvents(r,r._videoTrack));const c=this.remoteUserMap.get(r);c?c.set(i,s):this.remoteUserMap.set(r,new Map([[i,s]])),this.statsCollector.addRemoteStats(r.uid),this.statsUploader.startUploadDownlinkStats();const u=this.pendingRemoteTracks.findIndex((e=>{let{user:t,kind:n}=e;return t.uid===r.uid&&i===n}));-1!==u&&(this.pendingRemoteTracks.splice(u,1),this.emit(tv.MediaReconnectEnd,r.uid))}))}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter((n=>{let{user:r,kind:i}=n;return void 0!==t?r.uid===e.uid&&t===i:r.uid===e.uid}));if(r.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),this.connection&&this.state===ev.Connected||n||r.forEach((t=>{let{kind:n}=t;var r;if(n===Xm.AUDIO)null===(r=e._audioTrack)||void 0===r||r._destroy(),e._audioTrack=void 0;else if(n===Xm.VIDEO){var i;null===(i=e._videoTrack)||void 0===i||i._destroy(),e._videoTrack=void 0}})),!this.connection||this.state!==ev.Connected)return;const i=this.filterTobeUnSubscribedTracks(e,t);if(0===i.length)return;await this.connection.stopReceiving(i.map((e=>{let[,{id:t}]=e;return t})));const o=this.createUnsubscribeMessage(i);return this.withdrawRemoteTracks(i),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),i.forEach((e=>{let[t,{kind:r}]=e;var i,o;if(r===Xm.VIDEO&&t._videoSSRC&&(null===(i=this.connection)||void 0===i||i.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),r===Xm.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),n||(null===(o=t._videoTrack)||void 0===o||o._destroy(),t._videoTrack=void 0);else if(r===Xm.AUDIO){var s;this.unbindRemoteTrackEvents(t._audioTrack),n||(null===(s=t._audioTrack)||void 0===s||s._destroy(),t._audioTrack=void 0)}})),o}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:n,mediaType:r}of e){const e=this.pendingRemoteTracks.filter((e=>{let{user:t,kind:i}=e;return void 0!==r?t.uid===n.uid&&r===i:t.uid===n.uid}));e.forEach((e=>{const t=this.pendingRemoteTracks.indexOf(e);this.pendingRemoteTracks.splice(t,1)})),t=t.concat(e)}if(!this.connection||this.state!==ev.Connected)return void t.forEach((e=>{let{user:t,kind:n}=e;var r;if(n===Xm.AUDIO)null===(r=t._audioTrack)||void 0===r||r._destroy(),t._audioTrack=void 0;else if(n===Xm.VIDEO){var i;null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0}}));const n=Gn(e).call(e,((e,t)=>{let{user:n,mediaType:r}=t;const i=this.filterTobeUnSubscribedTracks(n,r);return e.concat(i)}),[]);if(0===n.length)return;await this.connection.stopReceiving(n.map((e=>{let[,{id:t}]=e;return t})));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),0===this.remoteUserMap.size&&this.statsUploader.stopUploadDownlinkStats(),n.forEach((e=>{let[t,{kind:n}]=e;var r,i;if(n===Xm.VIDEO&&t._videoSSRC&&(null===(r=this.connection)||void 0===r||r.setStatsRemoteVideoIsReady(t._videoSSRC,!1)),n===Xm.VIDEO)this.unbindRemoteTrackEvents(t._videoTrack),null===(i=t._videoTrack)||void 0===i||i._destroy(),t._videoTrack=void 0;else if(n===Xm.AUDIO){var o;this.unbindRemoteTrackEvents(t._audioTrack),null===(o=t._audioTrack)||void 0===o||o._destroy(),t._audioTrack=void 0}})),r}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void Jp.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void Jp.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===Xm.VIDEO?e._videoSSRC:e._audioSSRC;void 0!==r&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);n?n.get(t)||Jp.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,".")):Jp.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."))}getAllTracks(e){const t=this.localTrackMap.get($m.LocalAudioTrack);if((null==t?void 0:t.track)instanceof WE){const n=t.track;return Array.from(this.localTrackMap.entries()).filter((e=>{let[t]=e;return t!==$m.LocalAudioTrack})).filter((t=>{let[n]=t;return!(e&&n===$m.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t})).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter((t=>{let[n]=t;return!(e&&n===$m.LocalVideoLowTrack)})).map((e=>{let[,{track:t}]=e;return t}))}reportPublishEvent(e,t,n,r,i){if(e){const n=this.localTrackMap.get($m.LocalAudioTrack),o=r?this.localTrackMap.get($m.LocalVideoLowTrack):this.localTrackMap.get($m.LocalVideoTrack);Zy.publish(this.store.sessionId,{eventElapse:YE.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==n?void 0:n.track.getTrackLabel(),videoName:null==o?void 0:o.track.getTrackLabel(),screenshare:-1!==(null==o?void 0:o.track._hints.indexOf(Mm.SCREEN_TRACK)),audio:!!n,video:!!o,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}else{var o;n||(n=[]);const s=n.find((e=>e instanceof jE)),a=r?null===(o=this.localTrackMap.get($m.LocalVideoTrack))||void 0===o?void 0:o.track:n.find((e=>e instanceof PS));Zy.publish(this.store.sessionId,{eventElapse:YE.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:null==s?void 0:s.getTrackLabel(),videoName:null==a?void 0:a.getTrackLabel(),screenshare:-1!==(null==a?void 0:a._hints.indexOf(Mm.SCREEN_TRACK)),audio:!!s,video:!!a,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:i})}}reportSubscribeEvent(e,t,n,r){const i=r===Xm.VIDEO?n._videoSSRC:n._audioSSRC;i&&Zy.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===Xm.VIDEO,audio:r===Xm.AUDIO,peerid:n.uid,subscribeRequestid:r===Xm.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:YE.measureFromSubscribeStart(this.store.clientId,i)})}reset(){Jp.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new n_("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new DI({},this.store):this.isPlanB?new VR({},this.store):new XR({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get($m.LocalAudioTrack);if((null==e?void 0:e.track)instanceof WE){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach((e=>{t.removeAudioTrack(e)}))}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=ev.Disconnected}getStats(){var e;return null===(e=this.connection)||void 0===e?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return(null===(t=this.connection)||void 0===t?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get($m.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get($m.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof PS||t&&t.track instanceof jE?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(My(t=this.remoteUserMap).call(t)).find((t=>t.uid===e));return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map((e=>{let[t]=e;return{uid:t.uid,level:t.audioTrack?100*t.audioTrack._source.getAccurateVolumeLevel():0}}));const t=this.localTrackMap.get($m.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=fg(e).call(e,((e,t)=>e.level-t.level)),e}async disconnectForReconnect(){this.connection&&(Jp.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=ev.Reconnecting,df("KEEP_LAST_FRAME")&&0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&(null===(n=t._videoTrack._player.getVideoElement())||void 0===n||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())})),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new DI({},this.store):this.isPlanB?new VR({},this.store):new XR({},this.store),this.bindConnectionEvents(this.connection)),0!==this.localTrackMap.size&&(Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;switch(t){case $m.LocalVideoTrack:n._hints.includes(Mm.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case $m.LocalAudioTrack:n instanceof WE?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);case $m.LocalVideoLowTrack:}})),this.emit(tv.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),0!==this.remoteUserMap.size&&Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;Array.from(My(n).call(n)).forEach((e=>{this.setPendingRemoteMedia(t,e)})),this.emit(tv.MediaReconnectStart,t.uid)})),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),Jp.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:i}=n;if((e instanceof US?e.uid:e)===r.uid&&t===i)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return GC((function*(){if(!t.connection||t.state!==ev.Connected||t.connection instanceof DI)return;const n=yield KC(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield KC(t.connection.restartICE(e));const i=yield KC(r.next());if(i.done)return;const o=i.value,s=yield o;switch(t.reportPCDisconnectedOrFailed(e),e){case Jm.TCP:t._pcStatsUploadType=Zm.TCP_RESTART;break;case Jm.RELAY:t._pcStatsUploadType=Zm.RELAY_RESTART;break;default:t._pcStatsUploadType=Zm.OLD_RESTART}t._isInRestartIce=!0,r.next(s)}catch(e){var i;null===(i=r)||void 0===i||i.throw(e)}finally{n()}}))()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get($m.LocalVideoTrack),n=this.localTrackMap.get($m.LocalAudioTrack),r=e.videoSend.find((e=>e.ssrc===(null==t?void 0:t.ssrcs[0].ssrcId))),i=e.audioSend.find((e=>e.ssrc===(null==n?void 0:n.ssrcs[0].ssrcId)));if(!r||!i)return 1;const o=wb(this,tv.NeedSignalRTT),s=r?r.rttMs:void 0,a=i?i.rttMs:void 0,c=s&&a?(s+a)/2:s||a,u=(c&&o?(c+o)/2:c||o)||0,l=100*e.sendPacketLossRate*.7/50+.3*u/1500,A=l<.17?1:l<.36?2:l<.59?3:l<.1?4:5,h=null==t?void 0:t.track;if(h&&h._encoderConfig&&-1===h._hints.indexOf(Mm.SCREEN_TRACK)){const t=h._encoderConfig.bitrateMax,n=e.bitrate.actualEncoded;if(t&&n){const e=(1e3*t-n)/(1e3*t);return _f[e<.15?0:e<.3?1:e<.45?2:e<.6?3:4][A]}}return A}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach((n=>{let[r]=n;const i=r._audioSSRC,o=r._videoSSRC,s=e.audioRecv.find((e=>e.ssrc===i)),a=e.videoRecv.find((e=>e.ssrc===o));if(!s&&!a)return void(t+=1);const c=wb(this,tv.NeedSignalRTT),u=e.rtt,l=(u&&c?(u+c)/2:u||c)||0,A=s?s.jitterMs:void 0,h=e.recvPacketLossRate;let d=.7*h*100/50+.3*l/1500;A&&(d=.6*h*100/50+.2*l/1500+.2*A/400),t+=d<.1?1:d<.17?2:d<.36?3:d<.59?4:5})),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new Zl(((t,n)=>{this.handleMuteLocalTrack(e,t,n)}))}filterTobePublishedTracks(e,t,n){const r=[],i=vv(),o=this.getAllTracks();e=Cb(e=e.filter((e=>-1===o.indexOf(e))));let s=!1,a=!1;for(const o of e){if(o instanceof PS&&(this.localTrackMap.has($m.LocalVideoTrack)||s?new Qp(Vp.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:o,type:$m.LocalVideoTrack}),s=!0),t)){const e=this.getLowVideoTrack(o,n);r.push({track:e,type:$m.LocalVideoLowTrack})}if(o instanceof jE){const e=this.localTrackMap.get($m.LocalAudioTrack);if(e){if(!(e.track instanceof WE))throw new Qp(Vp.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(o._bypassWebAudio)throw new Qp(Vp.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(o),this.bindLocalAudioTrackEvents(o,!0)}else if(a){const e=r.find((e=>{let{type:t}=e;return t===$m.LocalAudioTrack}));if(!(e.track instanceof WE))throw new Qp(Vp.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(o._bypassWebAudio)throw new Qp(Vp.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");e.track.addAudioTrack(o)}else{if(!i.webAudioMediaStreamDest||o instanceof WE||o._bypassWebAudio)r.push({track:o,type:$m.LocalAudioTrack});else{const e=new WE;e.addAudioTrack(o),r.push({track:e,type:$m.LocalAudioTrack})}a=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=Cb(e=e.filter((e=>-1!==n.indexOf(e))));for(const n of e){if(n instanceof jE){const e=this.localTrackMap.get($m.LocalAudioTrack);if(!e)continue;e.track instanceof WE?(e.track.removeAudioTrack(n),this.unbindLocalAudioTrackEvents(n),0===e.track.trackList.length&&(t.push([$m.LocalAudioTrack,e]),e.track.close())):t.push([$m.LocalAudioTrack,e])}if(n instanceof PS){const e=this.localTrackMap.get($m.LocalVideoTrack);if(!e)continue;t.push([$m.LocalVideoTrack,e]);const n=this.localTrackMap.get($m.LocalVideoLowTrack);n&&t.push([$m.LocalVideoLowTrack,n])}}return t}bindLocalTrackEvents(e){e.forEach((e=>{let{track:t,type:n}=e;switch(n){case $m.LocalVideoTrack:t.addListener(Dm.GET_STATS,this.handleGetLocalVideoStats),t.addListener(Dm.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.addListener(Dm.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.addListener(Dm.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.addListener(Dm.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.addListener(Dm.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.addListener(Dm.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.addListener(Dm.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $m.LocalAudioTrack:this.bindLocalAudioTrackEvents(t);case $m.LocalVideoLowTrack:}}))}bindLocalAudioTrackEvents(e,t){e instanceof WE?e.trackList.forEach((e=>{e.addListener(Dm.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Dm.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Dm.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Dm.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Dm.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.addListener(Dm.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Dm.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Dm.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Dm.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Dm.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Dm.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map((e=>{let[t,{track:n}]=e;return{track:n,type:t}}))),e.forEach((e=>{let{track:t,type:n}=e;switch(n){case $m.LocalVideoTrack:t.off(Dm.GET_STATS,this.handleGetLocalVideoStats),t.off(Dm.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Dm.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Dm.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),t.off(Dm.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),t.off(Dm.NEED_REPLACE_TRACK,this.handleReplaceTrack),t.off(Dm.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Dm.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case $m.LocalAudioTrack:this.unbindLocalAudioTrackEvents(t);case $m.LocalVideoLowTrack:}}))}unbindLocalAudioTrackEvents(e){e instanceof WE?e.trackList.forEach((e=>{e.off(Dm.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Dm.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Dm.GET_STATS,this.handleGetLocalAudioStats),e.off(Dm.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Dm.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)})):(e.off(Dm.GET_STATS,this.handleGetLocalAudioStats),e.off(Dm.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Dm.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Dm.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Dm.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Dm.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof pI&&t.addListener(Dm.GET_STATS,(t=>{t(this.handleGetRemoteVideoStats(e))})),t instanceof fI&&t.addListener(Dm.GET_STATS,(t=>{t(this.handleGetRemoteAudioStats(e))}))}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Dm.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach((e=>{let[t,n]=e;n.has(Xm.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(Xm.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)}))}createGatewayPublishMessage(e,t){return e.map(((e,n)=>{let r,i,{track:o,type:s}=e;switch(s){case $m.LocalAudioTrack:r=xm.Audio,i={dtx:o instanceof GE&&o._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case $m.LocalVideoTrack:r=o._hints.includes(Mm.SCREEN_TRACK)?xm.Screen:xm.High,i=UI(UI({},ob(o)),{},{codec:this.store.codec});break;case $m.LocalVideoLowTrack:r=xm.Low,i=UI(UI({},ob(o)),{},{codec:this.store.codec})}return{stream_type:r,attributes:i,ssrcs:t[n]}}))}createGatewayUnpublishMessage(e){return e.map((e=>{let t,[n,{track:r,ssrcs:i,id:o}]=e;switch(n){case $m.LocalVideoTrack:t=r._hints.includes(Mm.SCREEN_TRACK)?xm.Screen:xm.High;break;case $m.LocalAudioTrack:t=xm.Audio;break;case $m.LocalVideoLowTrack:t=xm.Low}return{stream_type:t,ssrcs:i,mid:o}}))}assignLocalTracks(e,t){e.forEach(((e,n)=>{let{track:r,type:i}=e;this.localTrackMap.set(i,{track:r,id:t[n].id,ssrcs:t[n].localSSRC})}))}withdrawLocalTracks(e){e.forEach((e=>{let[t]=e;this.localTrackMap.delete(t)}))}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(Jp.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(tv.PeerConnectionStateChange,t),"connected"!==t||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),"connected"===t&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),df("NEW_ICE_RESTART")){if(this._restartStates.includes(t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const t=t=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(Jp.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(t)),"CONNECTED"===wb(this,tv.QueryClientConnectionState)&&this.emit(tv.RequestRestartICE,t))},n=()=>{"disconnected"!==e.iceConnectionState&&"checking"!==e.iceConnectionState&&"failed"!==e.iceConnectionState||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),Jp.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout((()=>this.emit(tv.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())},r=df("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout((()=>{if(df("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&vv().supportPCSetConfiguration)t(Jm.RELAY),this._restartTimer=window.setTimeout(n,r);else if(bh())t(Jm.UDP),this._restartTimer=window.setTimeout(n,4e3);else{if(t(Jm.TCP),vv().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout((()=>{t(Jm.RELAY),this._restartTimer=window.setTimeout(n,r)}),r));this._restartTimer=window.setTimeout(n,r)}}),800))}}else{if("disconnected"===t&&"disconnected"===e.iceConnectionState)return setTimeout((()=>{"disconnected"===e.iceConnectionState&&df("ICE_RESTART")&&"CONNECTED"===wb(this,tv.QueryClientConnectionState)&&this.emit(tv.RequestRestartICE)}),800),void setTimeout((()=>{"disconnected"===e.peerConnectionState&&(Jp.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout((()=>this.emit(tv.P2PLost)),0),this.iceFailedCount+=1,this.requestReconnect())}),4e3);"failed"===t&&(Jp.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout((()=>this.emit(tv.P2PLost)),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=e=>{"connected"!==e||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Jp.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(e,")")),Zy.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:e,tag:Fg.TRACER}).onSuccess(),this.emit(tv.IceConnectionStateChange,e)},e.onICETransportStateChange=e=>{Jp.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(e,")"))},e.onDTLSTransportStateChange=e=>{Jp.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(e,")"))},e.onDTLSTransportError=e=>{Jp.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(e,")"))},e.onFirstAudioDecoded=e=>{var t;const n=Array.from(My(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));var r;n&&(this.store.subscribe(n.uid,"audio",void 0,void 0,void 0,Date.now()),null===(r=n.audioTrack)||void 0===r||r.emit(Vm.FIRST_FRAME_DECODED),Zy.firstRemoteFrame(this.store.sessionId,Dg.FIRST_AUDIO_DECODE,Mg.FIRST_AUDIO_DECODE,{peer:n._uintid,subscribeElapse:YE.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=e=>{var t;const n=Array.from(My(t=this.remoteUserMap).call(t)).find((t=>t._audioSSRC===e));n&&Zy.firstRemoteFrame(this.store.sessionId,Dg.FIRST_AUDIO_RECEIVED,Mg.FIRST_AUDIO_RECEIVED,{peer:n._uintid,subscribeElapse:YE.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(e,t,n)=>{this.reportVideoFirstFrameDecoded(e,t,n)},e.onFirstVideoReceived=e=>{var t;const n=Array.from(My(t=this.remoteUserMap).call(t)).find((t=>t._videoSSRC===e));n&&Zy.firstRemoteFrame(this.store.sessionId,Dg.FIRST_VIDEO_RECEIVED,Mg.FIRST_VIDEO_RECEIVED,{peer:n._uintid,subscribeElapse:YE.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(e,t)=>{const n="relay"===e.candidateType,r="relay"===t.candidateType;"unknown"!==t.candidateType&&n===r||this.emit(tv.ConnectionTypeChange,n),Jp.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(lb(t))," -> ").concat(JSON.stringify(lb(e)),")"))},e.onSelectedRemoteCandidateChanged=(e,t)=>{Jp.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(lb(t))," -> ").concat(JSON.stringify(lb(e)),")"))},e.onFirstVideoDecodedTimeout=e=>{this.reportVideoFirstFrameDecoded(e,void 0,void 0,!0)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(e){const t=[];if(-1===this.getAllTracks().indexOf(e))return t;const n=this.localTrackMap.get($m.LocalAudioTrack);if(e instanceof jE&&(null==n?void 0:n.track)instanceof WE)return n.track.isActive||t.push([$m.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r&&(t.push(r),r[0]===$m.LocalVideoTrack)){const e=this.localTrackMap.get($m.LocalVideoLowTrack);e&&t.push([$m.LocalVideoLowTrack,e])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get($m.LocalAudioTrack);if(e instanceof jE&&(null==n?void 0:n.track)instanceof WE)return n.track.isActive&&t.push([$m.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find((t=>{let[,{track:n}]=t;return e===n}));if(r)if(r[0]===$m.LocalVideoTrack){t.push(r);const e=this.localTrackMap.get($m.LocalVideoLowTrack);e&&t.push([$m.LocalVideoLowTrack,e])}else t.push(r);return t}createMuteMessage(e){return e.map((e=>{let t,[n,{track:r,ssrcs:i,id:o}]=e;switch(n){case $m.LocalAudioTrack:t=xm.Audio;break;case $m.LocalVideoTrack:t=r._hints.includes(Mm.SCREEN_TRACK)?xm.Screen:xm.High;break;case $m.LocalVideoLowTrack:t=xm.Low}return{stream_type:t,ssrcs:i,mid:o}}))}createUnmuteMessage(e){return e.map((e=>{let t,[n,{track:r,ssrcs:i,id:o}]=e;switch(n){case $m.LocalAudioTrack:t=xm.Audio;break;case $m.LocalVideoTrack:t=r._hints.includes(Mm.SCREEN_TRACK)?xm.Screen:xm.High;break;case $m.LocalVideoLowTrack:t=xm.Low}return{stream_type:t,ssrcs:i,mid:o}}))}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const i=r.get(t);if(!i)return n;n.push([e,{kind:t,id:i}])}else Array.from(r.entries()).forEach((t=>{let[r,i]=t;n.push([e,{kind:r,id:i}])}));return n}createUnsubscribeMessage(e){const t=[];return e.forEach((e=>{let[n,{kind:r,id:i}]=e;switch(r){case Xm.VIDEO:return void(n._videoSSRC&&t.push({stream_type:Xm.VIDEO,ssrcId:n._videoSSRC}));case Xm.AUDIO:return void(n._audioSSRC&&t.push({stream_type:Xm.AUDIO,ssrcId:n._audioSSRC}))}})),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach((e=>{let[n,{kind:r}]=e;if(t.has(n)){let e=t.get(n);r===Xm.VIDEO?e|=Bm.Video:e|=Bm.Audio,t.set(n,e)}else r===Xm.VIDEO?t.set(n,Bm.Video):t.set(n,Bm.Audio)})),{users:Array.from(t.entries()).map((e=>{let[t,n]=e;return{stream_id:t.uid,stream_type:n}}))}}withdrawRemoteTracks(e){e.forEach((e=>{let[t,{kind:n}]=e;const r=this.remoteUserMap.get(t);r&&(r.delete(n),0===Array.from(r.entries()).length&&this.remoteUserMap.delete(t))}))}async updateBitrateLimit(e){const t=this.localTrackMap.get($m.LocalVideoTrack),n=this.localTrackMap.get($m.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return!this.connection||"connected"!==this.connection.peerConnectionState}mapPubResToRemoteConfig(e,t){return e.map(((e,n)=>{var r;let{stream_type:i}=e;return null===(r=t.find((e=>{let{stream_type:t}=e;return i===t})))||void 0===r?void 0:r.attributes}))}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof jE){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(0===r.length)continue;await(null===(t=this.connection)||void 0===t?void 0:t.unmuteLocal(r.map((e=>{let[,{id:t}]=e;return t}))));const i=this.createUnmuteMessage(r);return void await bb(this,tv.RequestUnmuteLocal,i)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!(null===(t=this.connection)||void 0===t||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(tv.RequestUploadStats,e,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await pb(Gp(this.dtlsFailedCount,jp)),this.emit(tv.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Eb(this,tv.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(tv.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has($m.LocalVideoTrack)||this.pendingLocalTracks.some((e=>e instanceof PS))}throwIfTrackTypeNotMatch(e){if(e.filter((e=>e instanceof PS)).length>1)throw new Qp(Vp.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter((e=>e instanceof jE)).length>1&&(e.some((e=>e instanceof jE&&e._bypassWebAudio))||!vv().webAudioMediaStreamDest))throw new Qp(Vp.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof PS&&this.pendingLocalTracks.some((e=>e instanceof PS)))throw new Qp(Vp.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof jE&&this.pendingLocalTracks.some((e=>e instanceof jE))&&(!vv().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some((e=>e instanceof jE&&e._bypassWebAudio))))throw new Qp(Vp.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=vv().supportDualStreamEncoding,r=UI(UI({},{width:160,height:120,framerate:15,bitrate:50}),t);let i;i=n?e._mediaStreamTrack.clone():ZR(e,r);const o=gb(8,"track-low-"),s=new PS(i,UI(UI({},n&&{scaleResolutionDownBy:ub(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,o);return s.on(Fm.TRANSCEIVER_UPDATED,(t=>{e._updateRtpTransceiver(t,Pm.LOW_STREAM)})),s._hints.push(Mm.LOW_STREAM),e.addListener(Dm.NEED_CLOSE,(()=>{s.close()})),s}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this.connection&&this.connection instanceof XR){var i,o,s,a;const c=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:u,dtlsTransportState:l,peerConnectionState:A}=this.connection,{local:h,remote:d}=await this.connection.getSelectedCandidatePair();Zy.pcStats(this.store.sessionId,{startTime:c,eventElapse:e-c||0,iceconnectionsate:u,dtlsstate:l,connectionstate:A,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:null!==(i=null==h?void 0:h.protocol)&&void 0!==i?i:"",selectedLocalCandidateType:null!==(o=h.candidateType)&&void 0!==o?o:"",selectedLocalCandidateAddress:"".concat(h.address,":").concat(h.port),selectedRemoteCandidateProtocol:null!==(s=d.protocol)&&void 0!==s?s:"",selectedRemoteCandidateType:null!==(a=d.candidateType)&&void 0!==a?a:"",selectedRemoteCandidateAddress:"".concat(d.address,":").concat(d.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,r){var i;const o=Array.from(My(i=this.remoteUserMap).call(i)).find((t=>t._videoSSRC===e));if(o){r||this.store.subscribe(o.uid,"video",void 0,void 0,void 0,void 0,Date.now());const i=this.store.keyMetrics,s=i.subscribe.find((e=>e.userId===o.uid&&"video"===e.type));Zy.firstRemoteVideoDecode(this.store.sessionId,Dg.FIRST_VIDEO_DECODE,Mg.FIRST_VIDEO_DECODE,{peer:o._uintid,videowidth:t,videoheight:n,subscribeElapse:YE.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:i.requestAPEnd||0,apStart:i.requestAPStart||0,joinGwEnd:i.joinGatewayEnd||0,joinGwStart:i.joinGatewayStart||0,pcEnd:i.peerConnectionEnd||0,pcStart:i.peerConnectionStart||0,subscriberEnd:(null==s?void 0:s.subscribeEnd)||0,subscriberStart:(null==s?void 0:s.subscribeStart)||0,videoAddNotify:(null==s?void 0:s.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const i=r.get(t);if(!i)return!1;const o=await this.connection.getRemoteSSRC(i);return void 0!==o&&o!==n}resetConnection(e){Jp.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===ev.Connected?(Jp.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===Lm.datachannel?new DI({},this.store):this.isPlanB?new VR({},this.store):new XR({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){0!==this.localTrackMap.size&&Array.from(this.localTrackMap.entries()).forEach((e=>{let[t,{track:n}]=e;t===$m.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Pm.LOW_STREAM):n._updateRtpTransceiver(void 0)}))}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof XR&&("disconnected"!==this.connection.iceConnectionState&&"checking"!==this.connection.iceConnectionState&&"failed"!==this.connection.iceConnectionState||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Zm.TCP_RESTART&&e===Jm.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Zm.DISCONNECTED_OR_FAILED)))}}).prototype,"startP2PConnection",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"startP2PConnection"),PI.prototype),Ry(PI.prototype,"connect",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"connect"),PI.prototype),Ry(PI.prototype,"preConnect",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"preConnect"),PI.prototype),Ry(PI.prototype,"unpublish",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"unpublish"),PI.prototype),Ry(PI.prototype,"unpublishLowStream",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"unpublishLowStream"),PI.prototype),Ry(PI.prototype,"subscribe",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"subscribe"),PI.prototype),Ry(PI.prototype,"massSubscribe",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"massSubscribe"),PI.prototype),Ry(PI.prototype,"unsubscribe",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"unsubscribe"),PI.prototype),Ry(PI.prototype,"massUnsubscribe",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"massUnsubscribe"),PI.prototype),Ry(PI.prototype,"muteRemote",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"muteRemote"),PI.prototype),Ry(PI.prototype,"unmuteRemote",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"unmuteRemote"),PI.prototype),Ry(PI.prototype,"hasRemoteMediaWithLock",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"hasRemoteMediaWithLock"),PI.prototype),Ry(PI.prototype,"disconnectForReconnect",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"disconnectForReconnect"),PI.prototype),Ry(PI.prototype,"updateBitrateLimit",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"updateBitrateLimit"),PI.prototype),Ry(PI.prototype,"remoteMediaSsrcChanged",[QI],Object.getOwnPropertyDescriptor(PI.prototype,"remoteMediaSsrcChanged"),PI.prototype),PI);function QI(e,t,n){const r=e[t];if("function"!=typeof r)throw new Error("Cannot use mutex on object property.");return n.value=async function(){const e=this.mutex,n=await e.lock("From P2PChannel.".concat(t));try{for(var i=arguments.length,o=new Array(i),s=0;s<i;s++)o[s]=arguments[s];return await r.apply(this,o)}finally{n()}},n}function jI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function GI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jI(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jI(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var KI;!function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"}(KI||(KI={}));class WI{constructor(e,t,n,r){Kh(this,"state",void 0),this.state={codec:e,audioCodec:t,mode:n,clientId:r,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(e){this.state=function(e,t){switch(t.type){case KI.SET_SESSION_ID:return GI(GI({},e),{},{sessionId:t.sessionId});case KI.SET_P2P_ID:return GI(GI({},e),{},{p2pId:t.p2pId});case KI.SET_UID:return GI(GI({},e),{},{uid:t.uid});case KI.SET_PUB_ID:return GI(GI({},e),{},{pubId:t.pubId});case KI.KEY_METRIC_CLIENT_CREATED:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{clientCreated:t.metric})});case KI.KEY_METRIC_JOIN_START:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{joinStart:t.metric})});case KI.AVOID_JOIN_START:return GI(GI({},e),{},{avoidJoinStart:t.avoidJoinStart});case KI.KEY_METRIC_JOIN_END:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{joinEnd:t.metric})});case KI.KEY_METRIC_REQUEST_AP_START:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{requestAPStart:t.metric})});case KI.KEY_METRIC_REQUEST_AP_END:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{requestAPEnd:t.metric})});case KI.KEY_METRIC_JOIN_GATEWAY_START:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{joinGatewayStart:t.metric})});case KI.KEY_METRIC_JOIN_GATEWAY_END:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{joinGatewayEnd:t.metric})});case KI.KEY_METRIC_PEER_CONNECTION_START:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{peerConnectionStart:t.metric})});case KI.KEY_METRIC_PEER_CONNECTION_END:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{peerConnectionEnd:t.metric})});case KI.KEY_METRIC_DESCRIPTION_START:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{descriptionStart:t.metric})});case KI.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{signalChannelOpen:t.metric})});case KI.KEY_METRIC_ICE_CONNECTION_END:return GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{iceConnectionEnd:t.metric})});case KI.KEY_METRIC_PUBLISH:{const n=e.keyMetrics.publish,r=n.findIndex((e=>e.trackId===t.metric.trackId));return-1!==r?(n[r]=GI(GI({},n[r]),t.metric),GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{publish:[...n]})})):GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{publish:[...e.keyMetrics.publish,t.metric]})})}case KI.KEY_METRIC_SUBSCRIBE:{const n=e.keyMetrics.subscribe,r=n.findIndex((e=>e.userId===t.metric.userId&&e.type===t.metric.type));return-1!==r?(n[r]=GI(GI({},n[r]),t.metric),GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{subscribe:[...n]})})):GI(GI({},e),{},{keyMetrics:GI(GI({},e.keyMetrics),{},{subscribe:[...e.keyMetrics.subscribe,t.metric]})})}case KI.SET_CLOUD_PROXY_SERVER_MODE:return e.cloudProxyServerMode=t.mode,e;case KI.RECORD_JOIN_CHANNEL_SERVICE:return"number"!=typeof t.index?e.joinChannelServiceRecords=[...e.joinChannelServiceRecords,t.record]:(e.joinChannelServiceRecords[t.index]=GI(GI({},e.joinChannelServiceRecords[t.index]),t.record),e.joinChannelServiceRecords=[...e.joinChannelServiceRecords]),e;case KI.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return e.joinChannelServiceRecords=[],e;case KI.RESET_KEY_METRICS:return e.keyMetrics={publish:[],subscribe:[]},e;case KI.SET_USE_DATACHANNEL:return GI(GI({},e),{},{useDataChannel:t.val});default:return e}}(this.state,e)}set sessionId(e){this.dispatch({type:KI.SET_SESSION_ID,sessionId:e})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(e){this.dispatch({type:KI.SET_P2P_ID,p2pId:e})}get p2pId(){return this.state.p2pId}set dcId(e){this.dispatch({type:KI.SET_DC_ID,dcId:e})}get dcId(){return this.state.dcId}set uid(e){this.dispatch({type:KI.SET_UID,uid:e})}get uid(){return this.state.uid}set pubId(e){this.dispatch({type:KI.SET_PUB_ID,pubId:e})}get pubId(){return this.state.pubId}set cloudProxyServerMode(e){this.dispatch({type:KI.SET_CLOUD_PROXY_SERVER_MODE,mode:e})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(e){this.dispatch({type:KI.SET_USE_DATACHANNEL,val:e})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:KI.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:KI.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:KI.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:KI.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:KI.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:KI.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:KI.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:KI.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:KI.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:KI.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:KI.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:KI.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(e,t,n,r){this.dispatch({type:KI.KEY_METRIC_PUBLISH,metric:GI(GI({trackId:e,type:t},n&&{publishStart:n}),r&&{publishEnd:r})})}subscribe(e,t,n,r,i,o,s){this.dispatch({type:KI.KEY_METRIC_SUBSCRIBE,metric:GI(GI(GI(GI(GI({userId:e,type:t},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),i&&{firstFrame:i}),o&&{streamAdded:o}),s&&{firstDecoded:s})})}massSubscribe(e,t,n,r){e.forEach((e=>{this.dispatch({type:KI.KEY_METRIC_SUBSCRIBE,metric:GI(GI(GI({userId:e.userId,type:e.type},t&&{subscribeStart:t}),n&&{subscribeEnd:n}),r&&{firstFrame:r})})}))}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(e,t){"gateway"===e.service&&Array.isArray(e.urls)&&(e.urls=e.urls.map((e=>e.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2"))));try{return"number"!=typeof t?(this.dispatch({type:KI.RECORD_JOIN_CHANNEL_SERVICE,record:GI(GI({},e),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(t<0||t>=this.state.joinChannelServiceRecords.length||this.dispatch({type:KI.RECORD_JOIN_CHANNEL_SERVICE,record:e,index:t}),t)}catch(e){return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:KI.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:KI.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch(e){return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(e){this.dispatch({type:KI.AVOID_JOIN_START,avoidJoinStart:e})}}let zI;const qI=()=>void 0!==window.isSecureContext;function YI(e){let t={};e:for(;!aO(e);){let n=mO(e);switch(n>>>3){case 0:break e;case 1:t.requestId=lO(e,mO(e));break;case 2:t.requestType=mO(e)>>>0;break;case 3:t.scorePorn=fO(e);break;case 4:t.scoreSexy=fO(e);break;case 5:t.scoreNeutral=fO(e);break;case 6:t.requestScene=mO(e)>>>0;break;case 7:t.scene=mO(e)>>>0;break;default:ZI(e,7&n)}}return t}function XI(e,t){let n=e.service;void 0!==n&&(vO(t,8),vO(t,n));let r=e.vendor;void 0!==r&&(vO(t,16),vO(t,r));let i=e.token;void 0!==i&&(vO(t,26),AO(t,i));let o=e.callbackUrl;void 0!==o&&(vO(t,34),AO(t,o))}function JI(e){let t=mO(e),n=e.limit;return e.limit=e.offset+t,n}function ZI(e,t){switch(t){case 0:for(;128&dO(e););break;case 2:sO(e,mO(e));break;case 5:sO(e,4);break;case 1:sO(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let $I=new Float32Array(1);new Uint8Array($I.buffer);let eO=new Float64Array(1),tO=new Uint8Array(eO.buffer);function nO(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let rO=[];function iO(){const e=rO.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function oO(e){rO.push(e)}function sO(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function aO(e){return e.offset>=e.limit}function cO(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function uO(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function lO(e,t){let n=uO(e,t),r=String.fromCharCode,i=e.bytes,o="ï¿½",s="";for(let e=0;e<t;e++){let a,c,u,l,A=i[e+n];0==(128&A)?s+=r(A):192==(224&A)?e+1>=t?s+=o:(a=i[e+n+1],128!=(192&a)?s+=o:(l=(31&A)<<6|63&a,l<128?s+=o:(s+=r(l),e++))):224==(240&A)?e+2>=t?s+=o:(a=i[e+n+1],c=i[e+n+2],32896!=(49344&(a|c<<8))?s+=o:(l=(15&A)<<12|(63&a)<<6|63&c,l<2048||l>=55296&&l<=57343?s+=o:(s+=r(l),e+=2))):240==(248&A)?e+3>=t?s+=o:(a=i[e+n+1],c=i[e+n+2],u=i[e+n+3],8421504!=(12632256&(a|c<<8|u<<16))?s+=o:(l=(7&A)<<18|(63&a)<<12|(63&c)<<6|63&u,l<65536||l>1114111?s+=o:(l-=65536,s+=r(55296+(l>>10),56320+(1023&l)),e+=3))):s+=o}return s}function AO(e,t){let n=t.length,r=0;for(let e=0;e<n;e++){let i=t.charCodeAt(e);i>=55296&&i<=56319&&e+1<n&&(i=(i<<10)+t.charCodeAt(++e)-56613888),r+=i<128?1:i<2048?2:i<65536?3:4}vO(e,r);let i=cO(e,r),o=e.bytes;for(let e=0;e<n;e++){let r=t.charCodeAt(e);r>=55296&&r<=56319&&e+1<n&&(r=(r<<10)+t.charCodeAt(++e)-56613888),r<128?o[i++]=r:(r<2048?o[i++]=r>>6&31|192:(r<65536?o[i++]=r>>12&15|224:(o[i++]=r>>18&7|240,o[i++]=r>>12&63|128),o[i++]=r>>6&63|128),o[i++]=63&r|128)}}function hO(e,t){let n=cO(e,t.limit),r=e.bytes,i=t.bytes;for(let e=0,o=t.limit;e<o;e++)r[e+n]=i[e]}function dO(e){return e.bytes[uO(e,1)]}function pO(e,t){let n=cO(e,1);e.bytes[n]=t}function fO(e){let t=uO(e,8),n=e.bytes;return tO[0]=n[t++],tO[1]=n[t++],tO[2]=n[t++],tO[3]=n[t++],tO[4]=n[t++],tO[5]=n[t++],tO[6]=n[t++],tO[7]=n[t++],eO[0]}function gO(e,t){let n=cO(e,8),r=e.bytes;eO[0]=t,r[n++]=tO[0],r[n++]=tO[1],r[n++]=tO[2],r[n++]=tO[3],r[n++]=tO[4],r[n++]=tO[5],r[n++]=tO[6],r[n++]=tO[7]}function mO(e){let t,n=0,r=0;do{t=dO(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function vO(e,t){for(t>>>=0;t>=128;)pO(e,127&t|128),t>>>=7;pO(e,t)}function yO(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,s=cO(e,o),a=e.bytes;switch(o){case 10:a[s+9]=i>>>7&1;case 9:a[s+8]=9!==o?128|i:127&i;case 8:a[s+7]=8!==o?r>>>21|128:r>>>21&127;case 7:a[s+6]=7!==o?r>>>14|128:r>>>14&127;case 6:a[s+5]=6!==o?r>>>7|128:r>>>7&127;case 5:a[s+4]=5!==o?128|r:127&r;case 4:a[s+3]=4!==o?n>>>21|128:n>>>21&127;case 3:a[s+2]=3!==o?n>>>14|128:n>>>14&127;case 2:a[s+1]=2!==o?n>>>7|128:n>>>7&127;case 1:a[s]=1!==o?128|n:127&n}}const _O=async(e,t,n)=>await(async(e,t,n)=>{const r=function(e){const t=[];for(let n=0;n<e.length;n+=2)t.push(parseInt(e.slice(n,n+2),16));return Uint8Array.from(t)}(function(e){const t="0123456789abcdef";function n(e){let n,r="";for(n=0;n<=3;n++)r+=t.charAt(e>>8*n+4&15)+t.charAt(e>>8*n&15);return r}function r(e,t){const n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,o,s){return r(function(e,t){return e<<t|e>>>32-t}(r(r(t,e),r(i,s)),o),n)}function o(e,t,n,r,o,s,a){return i(t&n|~t&r,e,t,o,s,a)}function s(e,t,n,r,o,s,a){return i(t&r|n&~r,e,t,o,s,a)}function a(e,t,n,r,o,s,a){return i(t^n^r,e,t,o,s,a)}function c(e,t,n,r,o,s,a){return i(n^(t|~r),e,t,o,s,a)}const u=function(e){let t;const n=1+(e.length+8>>6),r=new Array(16*n);for(t=0;t<16*n;t++)r[t]=0;for(t=0;t<e.length;t++)r[t>>2]|=e.charCodeAt(t)<<t%4*8;return r[t>>2]|=128<<t%4*8,r[16*n-2]=8*e.length,r}(e);let l,A,h,d,p,f=1732584193,g=-271733879,m=-1732584194,v=271733878;for(l=0;l<u.length;l+=16)A=f,h=g,d=m,p=v,f=o(f,g,m,v,u[l+0],7,-680876936),v=o(v,f,g,m,u[l+1],12,-389564586),m=o(m,v,f,g,u[l+2],17,606105819),g=o(g,m,v,f,u[l+3],22,-1044525330),f=o(f,g,m,v,u[l+4],7,-176418897),v=o(v,f,g,m,u[l+5],12,1200080426),m=o(m,v,f,g,u[l+6],17,-1473231341),g=o(g,m,v,f,u[l+7],22,-45705983),f=o(f,g,m,v,u[l+8],7,1770035416),v=o(v,f,g,m,u[l+9],12,-1958414417),m=o(m,v,f,g,u[l+10],17,-42063),g=o(g,m,v,f,u[l+11],22,-1990404162),f=o(f,g,m,v,u[l+12],7,1804603682),v=o(v,f,g,m,u[l+13],12,-40341101),m=o(m,v,f,g,u[l+14],17,-1502002290),g=o(g,m,v,f,u[l+15],22,1236535329),f=s(f,g,m,v,u[l+1],5,-165796510),v=s(v,f,g,m,u[l+6],9,-1069501632),m=s(m,v,f,g,u[l+11],14,643717713),g=s(g,m,v,f,u[l+0],20,-373897302),f=s(f,g,m,v,u[l+5],5,-701558691),v=s(v,f,g,m,u[l+10],9,38016083),m=s(m,v,f,g,u[l+15],14,-660478335),g=s(g,m,v,f,u[l+4],20,-405537848),f=s(f,g,m,v,u[l+9],5,568446438),v=s(v,f,g,m,u[l+14],9,-1019803690),m=s(m,v,f,g,u[l+3],14,-187363961),g=s(g,m,v,f,u[l+8],20,1163531501),f=s(f,g,m,v,u[l+13],5,-1444681467),v=s(v,f,g,m,u[l+2],9,-51403784),m=s(m,v,f,g,u[l+7],14,1735328473),g=s(g,m,v,f,u[l+12],20,-1926607734),f=a(f,g,m,v,u[l+5],4,-378558),v=a(v,f,g,m,u[l+8],11,-2022574463),m=a(m,v,f,g,u[l+11],16,1839030562),g=a(g,m,v,f,u[l+14],23,-35309556),f=a(f,g,m,v,u[l+1],4,-1530992060),v=a(v,f,g,m,u[l+4],11,1272893353),m=a(m,v,f,g,u[l+7],16,-155497632),g=a(g,m,v,f,u[l+10],23,-1094730640),f=a(f,g,m,v,u[l+13],4,681279174),v=a(v,f,g,m,u[l+0],11,-358537222),m=a(m,v,f,g,u[l+3],16,-722521979),g=a(g,m,v,f,u[l+6],23,76029189),f=a(f,g,m,v,u[l+9],4,-640364487),v=a(v,f,g,m,u[l+12],11,-421815835),m=a(m,v,f,g,u[l+15],16,530742520),g=a(g,m,v,f,u[l+2],23,-995338651),f=c(f,g,m,v,u[l+0],6,-198630844),v=c(v,f,g,m,u[l+7],10,1126891415),m=c(m,v,f,g,u[l+14],15,-1416354905),g=c(g,m,v,f,u[l+5],21,-57434055),f=c(f,g,m,v,u[l+12],6,1700485571),v=c(v,f,g,m,u[l+3],10,-1894986606),m=c(m,v,f,g,u[l+10],15,-1051523),g=c(g,m,v,f,u[l+1],21,-2054922799),f=c(f,g,m,v,u[l+8],6,1873313359),v=c(v,f,g,m,u[l+15],10,-30611744),m=c(m,v,f,g,u[l+6],15,-1560198380),g=c(g,m,v,f,u[l+13],21,1309151649),f=c(f,g,m,v,u[l+4],6,-145523070),v=c(v,f,g,m,u[l+11],10,-1120210379),m=c(m,v,f,g,u[l+2],15,718787259),g=c(g,m,v,f,u[l+9],21,-343485551),f=r(f,A),g=r(g,h),m=r(m,d),v=r(v,p);return n(f)+n(g)+n(m)+n(v)}(""+t+n)).slice(0,16),i=r.slice(0,12),o=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:i},o,e))})(e.buffer,t,n);function EO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}const bO=new Map([["moderation",1],["supervise",2]]);class wO extends Fp{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(cv.CONNECTION_STATE_CHANGE,t,e)}get inspectType(){return this._inspectType}set inspectType(e){var t;this._inspectMode=Gn(t=e.map((e=>bO.get(e)||0))).call(t,((e,t)=>e+t)),this._inspectType=e}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this.qualityRatio}),6e4))}constructor(e){super(),Kh(this,"name","AgoraRTCVideoContentInspect"),Kh(this,"_connectionState",sv.CONNECTING),Kh(this,"_innerConnectionState",void 0),Kh(this,"sequence",0),Kh(this,"inspectStartTime",void 0),Kh(this,"workerManagerConnection",void 0),Kh(this,"workerConnection",void 0),Kh(this,"workerMessageLengthLimit",void 0),Kh(this,"inspectIntervalMinimum",void 0),Kh(this,"qualityRatio",void 0),Kh(this,"_connectInfo",void 0),Kh(this,"_cancelTokenSource",kp.CancelToken.source()),Kh(this,"_retryConfig",void 0),Kh(this,"wmSequence",0),Kh(this,"inspectInterval",void 0),Kh(this,"inspectTimer",null),Kh(this,"ossFilePrefix",void 0),Kh(this,"extraInfo",void 0),Kh(this,"_inspectType",void 0),Kh(this,"_inspectMode",void 0),Kh(this,"_quality",1),Kh(this,"qualityTimer",null),Kh(this,"_inspectId",void 0),Kh(this,"_needWorkUrlOnly",!1),Kh(this,"inspectImage",(()=>{if(this.connectionState!==sv.CONNECTED)throw new Qp(Vp.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval((()=>{this.connectionState===sv.CONNECTED?this.requestToInspectImage():Jp.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)}),this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()})),this._inspectId=gb(5,"inspect-"),this.workerMessageLengthLimit=df("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=df("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=df("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=e.interval,this.ossFilePrefix=e.ossFilePrefix,this.extraInfo=e.extraInfo,this.inspectType=e.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new Qb("worker-manager-"+this._inspectId,jp),this.on(cv.STATE_CHANGE,((e,t)=>{this._innerConnectionState=e,Jp.debug("[".concat(this._inspectId,"] Inspect operation :").concat(av[e]," ").concat(t||""))})),this.handleWorkerManagerEvents(),this.workerConnection=new Qb("worker-"+this._inspectId,jp),this.handleWorkerEvents()}async init(e,t){this.emit(cv.STATE_CHANGE,av.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new Zl(((r,i)=>{this.on(cv.CONNECTION_STATE_CHANGE,((e,t)=>{t===sv.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorkerManager(e)})).catch((e=>{i(e)}))}))}async requestAP(e,t,n){const r=df("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:s,sid:a,token:c,uid:u}=t;Ew++;const l="image_moderation_api",A={service_name:l,json_body:JSON.stringify({appId:i,areaCode:o,cname:s,command:"allocateEdge",requestId:Ew,seq:Ew,sid:a,token:c,ts:Date.now(),uid:u+""})};let h,d,p=e[0];return Kp((async()=>{h=Date.now();const e=await Hy(p,{data:A,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(d=Date.now()-h,0!==e.code){const t=new Qp(Vp.UNEXPECTED_RESPONSE,"image inspect ap error, code"+e.code,{retry:!0,responseTime:d});throw Jp.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new Qp(Vp.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:d});throw Jp.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new Qp(Vp.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:t.code,responseTime:d});throw Jp.error(e.toString()),e}const r=df("VIDEO_INSPECT_WORKER_MANAGER_HOST"),i=df("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(i||n)})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,responseTime:d}}),((t,n)=>(Zy.apworkerEvent(a,{success:!0,sc:200,serviceName:l,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:d,serverIp:e[n%e.length]}),!1)),((t,n)=>(Zy.apworkerEvent(a,{success:!1,sc:t.data&&t.data.code||200,serviceName:l,responseTime:d,serverIp:e[n%e.length]}),!!(t.code!==Vp.OPERATION_ABORTED&&t.code!==Vp.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(p=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(cv.STATE_CHANGE,av.AP_CONNECTED);const{addressList:o}=i;return this.wmSequence++,o}async connectWorkerManager(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._needWorkUrlOnly=t,this.emit(cv.STATE_CHANGE,av.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(e,1e4)}async connectWorker(e){await this.workerConnection.init([e])}handleWorkerManagerEvents(){this.workerManagerConnection.on(pm.CONNECTED,(async()=>{this.emit(cv.STATE_CHANGE,av.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.18.2",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)})),this.workerManagerConnection.on(pm.CLOSED,(()=>{this._innerConnectionState<av.GET_WORKER_MANAGER_RESPONSE&&Jp.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))})),this.workerManagerConnection.on(pm.FAILED,(()=>{this._innerConnectionState<av.GET_WORKER_MANAGER_RESPONSE&&Jp.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))})),this.workerManagerConnection.on(pm.RECONNECTING,(()=>{this._innerConnectionState<av.GET_WORKER_MANAGER_RESPONSE&&Jp.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))})),this.workerManagerConnection.on(pm.ON_MESSAGE,(async e=>{this.emit(cv.STATE_CHANGE,av.GET_WORKER_MANAGER_RESPONSE);const t=this.workerManagerConnection.url;this.workerManagerConnection.close();const n=JSON.parse(e.data);if(200!==n.code)throw Jp.error("[".concat(this._inspectId,"] Unexpected code ").concat(n.code," from worker manager")),new Qp(Vp.UNEXPECTED_RESPONSE,"response code of worker is unexpected",n);if(!(n.serverResponse&&n.serverResponse.portWss&&t))throw Jp.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(n))),new Qp(Vp.UNEXPECTED_RESPONSE,"response content of worker is unexpected",n);{const e=df("VIDEO_INSPECT_WORKER_PORT")||n.serverResponse.portWss,r=t.replace(/:\d+\/?$/,":".concat(e));this.emit(cv.STATE_CHANGE,av.CONNECT_WORKER,r),this._needWorkUrlOnly?this.emit(cv.REQUEST_NEW_WORKER_URL,r):await this.connectWorker(r)}})),this.workerManagerConnection.on(pm.WILL_RECONNECT,((e,t)=>{t(e)})),this.workerManagerConnection.on(pm.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}handleWorkerEvents(){this.workerConnection.on(pm.CONNECTED,(async()=>{this.emit(cv.STATE_CHANGE,av.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=sv.CONNECTED})),this.workerConnection.on(pm.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const n=function(e){return function(e){let t={};e:for(;!aO(e);){let n=mO(e);switch(n>>>3){case 0:break e;case 1:t.code=mO(e);break;case 2:t.msg=lO(e,mO(e));break;case 3:{let n=JI(e);t.data=YI(e),e.limit=n;break}default:ZI(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}(new Uint8Array(e.data));if(df("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&Jp.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(n)),200===n.code){if(Array.isArray(this.inspectType)&&1===this.inspectType.length&&"supervise"===this.inspectType[0])return void this.emit(cv.INSPECT_RESULT,void 0,void 0);if(n.data&&n.data.scorePorn&&n.data.scoreSexy&&n.data.scoreNeutral){var t;const e={porn:n.data.scorePorn,sexy:n.data.scoreSexy,neutral:n.data.scoreNeutral},r=Gn(t=Object.keys(e)).call(t,((t,n)=>e[t]>e[n]?t:n),"porn"),i=Object.keys(e).find((e=>e===r));this.emit(cv.INSPECT_RESULT,i)}else this.emit(cv.INSPECT_RESULT,void 0,new Qp(Vp.UNEXPECTED_RESPONSE,n.code+"","There is an unexpected data on message"))}else this.emit(cv.INSPECT_RESULT,void 0,new Qp(Vp.UNEXPECTED_RESPONSE,n.code+"",n.msg))}else Jp.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(cv.INSPECT_RESULT,void 0,new Qp(Vp.UNEXPECTED_RESPONSE,"invalid worker message type"))})),this.workerConnection.on(pm.CLOSED,(()=>{this.connectionState=sv.CLOSED})),this.workerConnection.on(pm.FAILED,(()=>{this.connectionState=sv.CLOSED})),this.workerConnection.on(pm.RECONNECTING,(()=>{this.connectionState=this.connectionState===sv.CONNECTED?sv.RECONNECTING:sv.CONNECTING})),this.workerConnection.on(pm.WILL_RECONNECT,((e,t)=>{"recover"===e&&t(e),t("tryNext")})),this.workerConnection.on(pm.REQUEST_NEW_URLS,((e,t)=>{this.workerManagerConnection.close(),this.once(cv.REQUEST_NEW_WORKER_URL,(t=>{e([t])})),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then((e=>{this.connectWorkerManager(e,!0)})).catch((e=>{t(e)}))}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){this.sequence++;const e=wb(this,cv.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void this.emit(cv.INSPECT_RESULT,void 0,new Qp(Vp.INVALID_OPERATION,"Only the track being played can be inspected"));const n=await this.generateRequestData(e,t);this.workerConnection.sendMessage(n,!0,!0)}else this.emit(cv.INSPECT_RESULT,void 0,new Qp(Vp.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a}=t;const c=Date.now(),u=await e.getCurrentFrameImage("image/jpeg",this.quality),l=await _O(u,n,r),A=this.sequence+"-"+i+"-"+a+"-"+c+"-"+gb(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:wO.intToLong(Number(c-this.inspectStartTime)),fileSize:l.byteLength,jpgEncryption:2,height:u.height,width:u.width,jpg:l,networkType:6,osType:7,requestId:A,sdkVersion:"4.18.2",sequence:this.sequence,sid:s,timestamp:wO.intToLong(c),uid:a,vid:o,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};void 0===this.extraInfo&&delete h.callbackData,void 0===this.ossFilePrefix&&delete h.ossFilePrefix;const d=function(e){let t=iO();return function(e,t){let n=e.appId;void 0!==n&&(vO(t,10),AO(t,n));let r=e.cid;void 0!==r&&(vO(t,16),vO(t,r));let i=e.cname;void 0!==i&&(vO(t,26),AO(t,i));let o=e.deviceId;void 0!==o&&(vO(t,34),AO(t,o));let s=e.elapse;void 0!==s&&(vO(t,40),yO(t,s));let a=e.fileSize;void 0!==a&&(vO(t,48),yO(t,nO(a)));let c=e.height;void 0!==c&&(vO(t,56),yO(t,nO(c)));let u=e.jpg;void 0!==u&&(vO(t,66),vO(t,u.length),function(e,t){let n=cO(e,t.length);e.bytes.set(t,n)}(t,u));let l=e.networkType;void 0!==l&&(vO(t,72),yO(t,nO(l)));let A=e.osType;void 0!==A&&(vO(t,80),yO(t,nO(A)));let h=e.requestId;void 0!==h&&(vO(t,90),AO(t,h));let d=e.sdkVersion;void 0!==d&&(vO(t,98),AO(t,d));let p=e.sequence;void 0!==p&&(vO(t,104),yO(t,nO(p)));let f=e.sid;void 0!==f&&(vO(t,114),AO(t,f));let g=e.timestamp;void 0!==g&&(vO(t,120),yO(t,g));let m=e.uid;void 0!==m&&(vO(t,128),vO(t,m));let v=e.vid;void 0!==v&&(vO(t,136),vO(t,v));let y=e.width;void 0!==y&&(vO(t,144),yO(t,nO(y)));let _=e.service;void 0!==_&&(vO(t,152),vO(t,_));let E=e.callbackData;void 0!==E&&(vO(t,162),AO(t,E));let b=e.jpgEncryption;void 0!==b&&(vO(t,168),vO(t,b));let w=e.requestType;void 0!==w&&(vO(t,176),vO(t,w));let S=e.scorePorn;void 0!==S&&(vO(t,185),gO(t,S));let T=e.scoreSexy;void 0!==T&&(vO(t,193),gO(t,T));let C=e.scoreNeutral;void 0!==C&&(vO(t,201),gO(t,C));let R=e.scene;void 0!==R&&(vO(t,208),vO(t,R));let I=e.ossFilePrefix;void 0!==I&&(vO(t,218),AO(t,I));let O=e.serviceVendor;if(void 0!==O)for(let e of O){vO(t,226);let n=iO();XI(e,n),vO(t,n.limit),hO(t,n),oO(n)}}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}(h);if(d.byteLength<this.workerMessageLengthLimit){if(df("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?EO(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):EO(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,Jp.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(e))}return d}{const t=this.quality*this.qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=kp.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=sv.CLOSED,this.emit(cv.STATE_CHANGE,av.CLOSED)}}function SO(e,t){switch(t){case 0:for(;128&DO(e););break;case 2:RO(e,PO(e));break;case 5:RO(e,4);break;case 1:RO(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function TO(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let CO=[];function RO(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function IO(e){return e.offset>=e.limit}function OO(e,t){let n=e.bytes,r=e.offset,i=e.limit,o=r+t;if(o>n.length){let t=new Uint8Array(2*o);t.set(n),e.bytes=t}return e.offset=o,o>i&&(e.limit=o),r}function xO(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function NO(e,t){let n=OO(e,t.length);e.bytes.set(t,n)}function BO(e,t){let n=xO(e,t),r=String.fromCharCode,i=e.bytes,o="ï¿½",s="";for(let e=0;e<t;e++){let a,c,u,l,A=i[e+n];0==(128&A)?s+=r(A):192==(224&A)?e+1>=t?s+=o:(a=i[e+n+1],128!=(192&a)?s+=o:(l=(31&A)<<6|63&a,l<128?s+=o:(s+=r(l),e++))):224==(240&A)?e+2>=t?s+=o:(a=i[e+n+1],c=i[e+n+2],32896!=(49344&(a|c<<8))?s+=o:(l=(15&A)<<12|(63&a)<<6|63&c,l<2048||l>=55296&&l<=57343?s+=o:(s+=r(l),e+=2))):240==(248&A)?e+3>=t?s+=o:(a=i[e+n+1],c=i[e+n+2],u=i[e+n+3],8421504!=(12632256&(a|c<<8|u<<16))?s+=o:(l=(7&A)<<18|(63&a)<<12|(63&c)<<6|63&u,l<65536||l>1114111?s+=o:(l-=65536,s+=r(55296+(l>>10),56320+(1023&l)),e+=3))):s+=o}return s}function LO(e,t){let n=t.length,r=0;for(let e=0;e<n;e++){let i=t.charCodeAt(e);i>=55296&&i<=56319&&e+1<n&&(i=(i<<10)+t.charCodeAt(++e)-56613888),r+=i<128?1:i<2048?2:i<65536?3:4}kO(e,r);let i=OO(e,r),o=e.bytes;for(let e=0;e<n;e++){let r=t.charCodeAt(e);r>=55296&&r<=56319&&e+1<n&&(r=(r<<10)+t.charCodeAt(++e)-56613888),r<128?o[i++]=r:(r<2048?o[i++]=r>>6&31|192:(r<65536?o[i++]=r>>12&15|224:(o[i++]=r>>18&7|240,o[i++]=r>>12&63|128),o[i++]=r>>6&63|128),o[i++]=63&r|128)}}function DO(e){return e.bytes[xO(e,1)]}function MO(e,t){let n=OO(e,1);e.bytes[n]=t}function PO(e){let t,n=0,r=0;do{t=DO(e),n<32&&(r|=(127&t)<<n),n+=7}while(128&t);return r}function kO(e,t){for(t>>>=0;t>=128;)MO(e,127&t|128),t>>>=7;MO(e,t)}function UO(e,t){let n,r=0,i=0,o=0;return n=DO(e),r=127&n,128&n&&(n=DO(e),r|=(127&n)<<7,128&n&&(n=DO(e),r|=(127&n)<<14,128&n&&(n=DO(e),r|=(127&n)<<21,128&n&&(n=DO(e),i=127&n,128&n&&(n=DO(e),i|=(127&n)<<7,128&n&&(n=DO(e),i|=(127&n)<<14,128&n&&(n=DO(e),i|=(127&n)<<21,128&n&&(n=DO(e),o=127&n,128&n&&(n=DO(e),o|=(127&n)<<7))))))))),{low:r|i<<28,high:i>>>4|o<<24,unsigned:t}}function FO(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,i=t.high>>>24,o=0===i?0===r?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:i<128?9:10,s=OO(e,o),a=e.bytes;switch(o){case 10:a[s+9]=i>>>7&1;case 9:a[s+8]=9!==o?128|i:127&i;case 8:a[s+7]=8!==o?r>>>21|128:r>>>21&127;case 7:a[s+6]=7!==o?r>>>14|128:r>>>14&127;case 6:a[s+5]=6!==o?r>>>7|128:r>>>7&127;case 5:a[s+4]=5!==o?128|r:127&r;case 4:a[s+3]=4!==o?n>>>21|128:n>>>21&127;case 3:a[s+2]=3!==o?n>>>14|128:n>>>14&127;case 2:a[s+1]=2!==o?n>>>7|128:n>>>7&127;case 1:a[s]=1!==o?128|n:127&n}}const HO={},VO={},QO=4294967296,jO=0x10000000000000000,GO=jO/2,KO=XO(0,!0),WO=XO(0),zO=JO(0,-2147483648,!1),qO=JO(-1,2147483647,!1),YO=JO(-1,-1,!0);function XO(e,t){let n,r,i;return t?(i=0<=(e>>>=0)&&e<256)&&(r=VO[e],r)?r:(n=JO(e,0,!0),i&&(VO[e]=n),n):(i=-128<=(e|=0)&&e<128)&&(r=HO[e],r)?r:(n=JO(e,e<0?-1:0,!1),i&&(HO[e]=n),n)}function JO(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function ZO(e,t){if(isNaN(e))return t?KO:WO;if(t){if(e<0)return KO;if(e>=jO)return YO}else{if(e<=-GO)return zO;if(e+1>=GO)return qO}return e<0?t?KO:WO:JO(e%QO|0,e/QO|0,t)}function $O(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}class ex extends Fp{get connectionState(){return this._connectionState}set connectionState(e){if(this._connectionState===e)return;const t=this._connectionState;this._connectionState=e,this.emit(pv.CONNECTION_STATE_CHANGE,e,t)}get quality(){return this._quality}set quality(e){this._quality=e>1?1:e<.1?.1:e,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout((()=>{this.quality=this._quality/this._qualityRatio}),6e4))}constructor(e){var t;super(),Kh(this,"name","AgoraRTCImageModeration"),Kh(this,"_connectionState",dv.CONNECTING),Kh(this,"_sequence",0),Kh(this,"_moderationStartTime",void 0),Kh(this,"_workerConnection",void 0),Kh(this,"_workerMessageLengthLimit",void 0),Kh(this,"_qualityRatio",void 0),Kh(this,"_connectInfo",void 0),Kh(this,"_cancelTokenSource",kp.CancelToken.source()),Kh(this,"_retryConfig",void 0),Kh(this,"_moderationInterval",void 0),Kh(this,"_moderationTimer",null),Kh(this,"_moderationMode",1),Kh(this,"_quality",1),Kh(this,"_qualityTimer",null),Kh(this,"_ticket",void 0),Kh(this,"_moderationIntervalMinimum",void 0),Kh(this,"_uploadFailedNum",0),Kh(this,"_uploadNum",0),Kh(this,"_uploadTimer",null),Kh(this,"_moderationId",void 0),Kh(this,"inspectImage",(()=>{if(this.connectionState!==dv.CONNECTED)throw new Qp(Vp.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval((()=>{this.connectionState===dv.CONNECTED?this.requestToInspectImage():Jp.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)}),this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()})),this._moderationId=gb(5,"image-moderation-"),this._workerMessageLengthLimit=df("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=df("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,this._qualityRatio=df("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new Qb("worker-"+this._moderationId,jp),this.on(pv.STATE_CHANGE,((e,t)=>{Jp.debug("[".concat(this._moderationId,"] Moderation operation :").concat(fv[e]," ").concat(t||""))})),this.handleWorkerEvents()}async init(e,t){this.emit(pv.STATE_CHANGE,fv.CONNECT_AP),this._connectInfo=e;const n=this._cancelTokenSource.token;return this._retryConfig=t,new Zl(((r,i)=>{this.on(pv.CONNECTION_STATE_CHANGE,((e,t)=>{e===dv.CONNECTED&&r()})),this.requestAP(e,n,t).then((e=>{this.connectWorker(e)})).catch((e=>{i(e)}))}))}updateConfig(e){var t;this._moderationInterval=null!==(t=e.interval)&&void 0!==t?t:1e3,Jp.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(e))),this.connectionState===dv.CONNECTED&&this.inspectImage()}async requestAP(e,t,n){const r=df("WEBCS_DOMAIN").map((e=>"https://".concat(e,"/api/v1"))),i=await function(e,t,n,r){let{appId:i,areaCode:o,cname:s,sid:a,token:c,uid:u}=t;Ew++;const l="moderation_plugin",A={service_name:l,json_body:JSON.stringify({appId:i,areaCode:o,cname:s,command:"allocateEdge",requestId:Ew,seq:Ew,sid:a,appToken:c,ts:Date.now(),uid:u+""})};let h,d,p=e[0];return Kp((async()=>{h=Date.now();const e=await Hy(p,{data:A,cancelToken:n,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(d=Date.now()-h,0!==e.code){const t=new Qp(Vp.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+e.code,{retry:!0,responseTime:d});throw Jp.error(t.toString()),t}const t=JSON.parse(e.json_body);if(200!==t.code){const e=new Qp(Vp.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(t.code,", reason: ").concat(t.reason),{code:t.code,responseTime:d});throw Jp.error(e.toString()),e}if(!t.servers||!Array.isArray(t.servers)||0===t.servers.length){const e=new Qp(Vp.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:t.code,responseTime:d});throw Jp.error(e.toString()),e}if(!t.servers.some((e=>!!e.wss))){const e=new Qp(Vp.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:t.code,responseTime:d});throw Jp.error(e.toString()),e}const r=df("IMAGE_MODERATION_WORKER_HOST");return{addressList:t.servers.map((e=>{let{address:t,wss:n}=e;if(t&&n)return"wss://".concat(t.replace(/\./g,"-"),".").concat(r,":").concat(n,"/moderation")})).filter((e=>!!e)),workerToken:t.workerToken,vid:t.vid,ticket:t.appTicket,responseTime:d}}),((t,n)=>(Zy.apworkerEvent(a,{success:!0,sc:200,serviceName:l,responseDetail:JSON.stringify(t.addressList),firstSuccess:0===n,responseTime:d,serverIp:e[n%e.length]}),!1)),((t,n)=>(Zy.apworkerEvent(a,{success:!1,sc:t.data&&t.data.code||200,serviceName:l,responseTime:d,serverIp:e[n%e.length]}),!!(t.code!==Vp.OPERATION_ABORTED&&t.code!==Vp.UNEXPECTED_RESPONSE||t.data&&t.data.retry)&&(p=e[(n+1)%e.length],!0))),r)}(r,e,t,n);this.emit(pv.STATE_CHANGE,fv.AP_CONNECTED);const{addressList:o,ticket:s}=i;return this._ticket=s,o}async connectWorker(e){this.emit(pv.STATE_CHANGE,fv.CONNECT_WORKER),await this._workerConnection.init(e,1e4)}handleWorkerEvents(){this._workerConnection.on(pm.CONNECTED,(async()=>{this.emit(pv.STATE_CHANGE,fv.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=dv.CONNECTED})),this._workerConnection.on(pm.CLOSED,(()=>{this.connectionState=dv.CLOSED})),this._workerConnection.on(pm.FAILED,(()=>{this.connectionState=dv.CLOSED})),this._workerConnection.on(pm.RECONNECTING,(()=>{this.connectionState=this.connectionState===dv.CONNECTED?dv.RECONNECTING:dv.CONNECTING})),this._workerConnection.on(pm.ON_MESSAGE,(async e=>{if(e.data instanceof ArrayBuffer){const t=function(e){return function(e){let t={};e:for(;!IO(e);){let n=PO(e);switch(n>>>3){case 0:break e;case 1:t.code=PO(e);break;case 2:t.msg=BO(e,PO(e));break;case 3:t.requestId=BO(e,PO(e));break;case 4:t.timestamp=UO(e,!1);break;default:SO(e,7&n)}}return t}({bytes:t=e,offset:0,limit:t.length});var t}(new Uint8Array(e.data));df("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Jp.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(t)),this._uploadNum++,void 0===t.code||0===t.code||(this._uploadFailedNum++,Jp.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(t.code,", msg is ").concat(t.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout((()=>{Zy.reportApiInvoke(this._connectInfo.sid||null,{name:Ug.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,t.code],tag:Fg.TRACER}).onError(new Qp(Vp.IMAGE_MODERATION_UPLOAD_FAILED,t.msg)),this._uploadTimer=null}),df("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else Jp.error("[".concat(this._moderationId,"] Unexpected message type from worker"))})),this._workerConnection.on(pm.WILL_RECONNECT,((e,t)=>{"recover"===e&&t(e),t("tryNext")})),this._workerConnection.on(pm.REQUEST_NEW_URLS,((e,t)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(e).catch(t)}))}static intToLong(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}async requestToInspectImage(){const e=wb(this,pv.CLIENT_LOCAL_VIDEO_TRACK),t={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(e){if(!e.isPlaying)return void(df("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Jp.debug("Only the track being played can be inspected"));this._sequence++;const n=await this.generateRequestData(e,t);this._workerConnection.sendMessage(n,!0,!0)}else df("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Jp.debug("Only the track being published can be inspected")}async generateRequestData(e,t){let{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a}=t;const c=Date.now(),u=await e.getCurrentFrameImage("image/jpeg",this.quality),l=await _O(u,n,r),A=this._sequence+"-"+i+"-"+a+"-"+c+"-"+gb(12,""),h={appId:n,cid:i,cname:r,deviceId:"",elapse:ex.intToLong(Number(c-this._moderationStartTime)),fileSize:u.buffer.byteLength,height:u.height,width:u.width,jpg:l,networkType:6,osType:7,requestId:A,sdkVersion:"4.18.2",sequence:this._sequence,sid:s,timestamp:ZO(c),uid:a,vid:o,service:this._moderationMode,ticket:this._ticket},d=function(e){let t=function(){const e=CO.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(e,t){let n=e.appId;void 0!==n&&(kO(t,10),LO(t,n));let r=e.cid;void 0!==r&&(kO(t,16),kO(t,r));let i=e.cname;void 0!==i&&(kO(t,26),LO(t,i));let o=e.deviceId;void 0!==o&&(kO(t,34),LO(t,o));let s=e.elapse;void 0!==s&&(kO(t,40),FO(t,s));let a=e.fileSize;void 0!==a&&(kO(t,48),FO(t,TO(a)));let c=e.height;void 0!==c&&(kO(t,56),FO(t,TO(c)));let u=e.jpg;void 0!==u&&(kO(t,66),kO(t,u.length),NO(t,u));let l=e.networkType;void 0!==l&&(kO(t,72),FO(t,TO(l)));let A=e.osType;void 0!==A&&(kO(t,80),FO(t,TO(A)));let h=e.requestId;void 0!==h&&(kO(t,90),LO(t,h));let d=e.sdkVersion;void 0!==d&&(kO(t,98),LO(t,d));let p=e.sequence;void 0!==p&&(kO(t,104),FO(t,TO(p)));let f=e.sid;void 0!==f&&(kO(t,114),LO(t,f));let g=e.timestamp;void 0!==g&&(kO(t,120),FO(t,g));let m=e.uid;void 0!==m&&(kO(t,128),kO(t,m));let v=e.vid;void 0!==v&&(kO(t,136),kO(t,v));let y=e.width;void 0!==y&&(kO(t,144),FO(t,TO(y)));let _=e.service;void 0!==_&&(kO(t,152),kO(t,_));let E=e.callbackData;void 0!==E&&(kO(t,162),kO(t,E.length),NO(t,E));let b=e.ticket;void 0!==b&&(kO(t,170),LO(t,b))}(e,t),function(e){let t=e.bytes,n=e.limit;return t.length===n?t:t.subarray(0,n)}(t)}(h);if(d.byteLength<this._workerMessageLengthLimit){if(df("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$O(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$O(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},h);delete e.jpg,Jp.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(e))}return d}{const t=this.quality*this._qualityRatio;return this.quality=t,await this.generateRequestData(e,{appId:n,cname:r,cid:i,vid:o,sid:s,uid:a})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=kp.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=dv.CLOSED,this.emit(pv.STATE_CHANGE,fv.CLOSED)}}var tx,nx,rx,ix,ox,sx,ax,cx,ux,lx,Ax,hx,dx,px,fx,gx,mx,vx,yx,_x,Ex,bx,wx,Sx,Tx,Cx,Rx,Ix,Ox,xx,Nx,Bx,Lx,Dx,Mx,Px,kx,Ux,Fx,Hx;function Vx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Qx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vx(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let jx=(tx=Jy(),nx=Jy({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),t.map((e=>e?Object(e).toString():"null")))}),rx=Jy({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||(t=[t]),t.map((e=>e.getTrackId())))}),ix=Jy({argsMap:(e,t,n)=>[t.uid,n]}),ox=Jy({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return[null==t?void 0:t.uid,n]}))}),sx=Jy({argsMap:(e,t,n)=>[t.uid,n]}),ax=Jy({argsMap:(e,t)=>t.map((e=>{let{user:t,mediaType:n}=e;return{uid:null==t?void 0:t.uid,mediaType:n}}))}),cx=Jy(),ux=Jy(),lx=Jy(),Ax=Jy(),hx=Jy(),dx=Jy(),px=Jy(),fx=Jy(),gx=Jy(),mx=Jy(),vx=Jy(),yx=Jy(),_x=Jy(),Ex=Jy(),bx=Jy({argsMap:(e,t)=>[t]}),wx=Jy(),Sx=Jy(),Tx=Jy(),Cx=Jy(),Rx=Jy(),Ix=Jy(),Ox=Jy(),xx=Jy(),Nx=Jy(),Bx=Jy(),Lx=Jy({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),Dx=Jy(),Mx=Jy(),Px=Jy(),kx=Jy(),Ux=Jy({reportResult:!0}),Fx=Jy(),Ry((Hx=class extends Fp{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get mode(){return this._config.mode}get role(){var e;return(null===(e=this._config)||void 0===e?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),Kh(this,"store",void 0),Kh(this,"_uid",void 0),Kh(this,"_channelName",void 0),Kh(this,"_uintUid",void 0),Kh(this,"_users",[]),Kh(this,"_config",void 0),Kh(this,"_clientId",void 0),Kh(this,"_appId",void 0),Kh(this,"_sessionId",null),Kh(this,"_key",void 0),Kh(this,"_joinInfo",void 0),Kh(this,"_gateway",void 0),Kh(this,"_statsCollector",void 0),Kh(this,"_configDistribute",void 0),Kh(this,"_leaveMutex",new n_("client-leave")),Kh(this,"_publishMutex",new n_("client-publish")),Kh(this,"_renewTokenMutex",new n_("client-renewtoken")),Kh(this,"_subscribeMutex",new n_("client-subscribe")),Kh(this,"_encryptionMode","none"),Kh(this,"_encryptionSecret",null),Kh(this,"_encryptionSalt",null),Kh(this,"_proxyServer",void 0),Kh(this,"_turnServer",{servers:[],mode:"auto"}),Kh(this,"_cloudProxyServerMode","disabled"),Kh(this,"_isDualStreamEnabled",!1),Kh(this,"_defaultStreamFallbackType",void 0),Kh(this,"_lowStreamParameter",void 0),Kh(this,"_streamFallbackTypeCacheMap",new Map),Kh(this,"_remoteStreamTypeCacheMap",new Map),Kh(this,"_axiosCancelSource",kp.CancelToken.source()),Kh(this,"_audioVolumeIndicationInterval",void 0),Kh(this,"_networkQualityInterval",void 0),Kh(this,"_userOfflineTimeout",void 0),Kh(this,"_streamRemovedTimeout",void 0),Kh(this,"_injectStreamingClient",void 0),Kh(this,"_liveTranscodeStreamingClient",void 0),Kh(this,"_liveRawStreamingClient",void 0),Kh(this,"_channelMediaRelayClient",void 0),Kh(this,"_networkQualitySensitivity","normal"),Kh(this,"_p2pChannel",void 0),Kh(this,"_useLocalAccessPoint",!1),Kh(this,"_setLocalAPVersion",void 0),Kh(this,"_joinAndNotLeaveYet",!1),Kh(this,"_numberOfJoinCount",0),Kh(this,"_remoteDefaultVideoStreamType",void 0),Kh(this,"_inspect",void 0),Kh(this,"_moderation",void 0),Kh(this,"_license",void 0),Kh(this,"_handleLocalTrackEnable",((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),Kh(this,"_handleLocalTrackDisable",((e,t,n)=>{this.unpublish(e).then(t).catch(n)})),Kh(this,"_handleUserOnline",(e=>{if(df("BLOCK_LOCAL_CLIENT")&&wf(e.uid,this.channelName))return void Jp.debug("[".concat(e.uid,"] will be ignored in local"));this.isStringUID&&"string"!=typeof e.uid&&Jp.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const t=this._users.find((t=>t.uid===e.uid));if(t)t._trust_in_room_=!0;else{const t=new US(e.uid,e.uint_id||e.uid);this._users.push(t),Jp.debug("[".concat(this._clientId,"] user online"),e.uid),this.safeEmit(Yg.USER_JOINED,t)}})),Kh(this,"_handleUserOffline",(e=>{if(df("BLOCK_LOCAL_CLIENT")&&wf(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));t&&(this._handleRemoveStream(e),Tb(this._users,t),this._remoteStreamTypeCacheMap.delete(t.uid),this._streamFallbackTypeCacheMap.delete(t.uid),Jp.debug("[".concat(this._clientId,"] user offline"),e.uid,"reason:",e.reason),this.safeEmit(Yg.USER_LEAVED,t,e.reason))})),Kh(this,"_handleAddAudioOrVideoStream",((e,t,n,r,i,o,s)=>{if(df("BLOCK_LOCAL_CLIENT")&&wf(t,this.channelName))return;const a=this._users.find((e=>e.uid===t));if(!a)return void Jp.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Jp.debug("[".concat(this._clientId,"] stream added with uid ").concat(t,", type ").concat(e)),this.store.subscribe(a.uid,e,void 0,void 0,void 0,Date.now());const c="audio"===e?a.hasAudio:a.hasVideo;a._uintid||(a._uintid=i||t),"audio"===e?a._trust_audio_stream_added_state_=!0:a._trust_video_stream_added_state_=!0,"audio"===e?(a._audio_added_=!0,void 0!==n&&(a._audioSSRC=n),void 0!==r&&(a._cname=r),o&&(a._audioOrtc=o)):(a._video_added_=!0,void 0!==n&&(a._videoSSRC=n),void 0!==r&&(a._cname=r),void 0!==s&&(a._rtxSsrcId=s),o&&(a._videoOrtc=o)),("audio"===e?a.hasAudio:a.hasVideo)&&!c&&(Jp.info("[".concat(this._clientId,"] remote user ").concat(a.uid," published ").concat(e)),this.safeEmit(Yg.USER_PUBLISHED,a,e)),"video"===e?Zy.onGatewayStream(this._sessionId,Dg.ON_ADD_VIDEO_STREAM,Mg.ON_ADD_VIDEO_STREAM,{peer:i||t}):Zy.onGatewayStream(this._sessionId,Dg.ON_ADD_AUDIO_STREAM,Mg.ON_ADD_AUDIO_STREAM,{peer:i||t}),this._p2pChannel.remoteMediaSsrcChanged(a,e,n).then((t=>{if(t)return Jp.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(a.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(a,e,!0).then((()=>this._subscribe(a,e,!0).catch((e=>{Jp.error("[".concat(this._clientId,"] resubscribe error"),e.toString())}))))})),this._p2pChannel.hasPendingRemoteMedia(a,e)&&(Jp.debug("[".concat(this._clientId,"] resubscribe ").concat(e," for user ").concat(a.uid," after reconnect.")),this._subscribe(a,e,!0).catch((e=>{Jp.error("[".concat(this._clientId,"] resubscribe error"),e.toString())})))})),Kh(this,"_handleRemoveStream",(e=>{if(df("BLOCK_LOCAL_CLIENT")&&wf(e.uid,this.channelName))return;const t=this._users.find((t=>t.uid===e.uid));if(!t)return void Jp.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));Jp.debug("[".concat(this._clientId,"] stream removed with uid ").concat(e.uid));let n=()=>{};t.hasAudio&&t.hasVideo?n=()=>{Jp.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(Yg.USER_UNPUBLISHED,t,"audio"),Jp.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(Yg.USER_UNPUBLISHED,t,"video")}:t.hasVideo?n=()=>{Jp.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished video track")),this.safeEmit(Yg.USER_UNPUBLISHED,t,"video")}:t.hasAudio&&(n=()=>{Jp.info("[".concat(this._clientId,"] remote user ").concat(t.uid," unpublished audio track")),this.safeEmit(Yg.USER_UNPUBLISHED,t,"audio")}),t._trust_audio_stream_added_state_=!0,t._trust_video_stream_added_state_=!0,t._audio_added_=!1,t._video_added_=!1,this._p2pChannel.unsubscribe(t).then((e=>{if(e)return this._gateway.unsubscribe(e,t.uid)})),t._audioSSRC=void 0,t._videoSSRC=void 0,t._audioOrtc=void 0,t._videoOrtc=void 0,t._rtxSsrcId=void 0,Zy.onGatewayStream(this._sessionId,Dg.ON_REMOVE_STREAM,Mg.ON_REMOVE_STREAM,{peer:e.uint_id||e.uid}),n()})),Kh(this,"_handleSetStreamLocalEnable",((e,t,n)=>{if(df("BLOCK_LOCAL_CLIENT")&&wf(t,this.channelName))return;const r=this._users.find((e=>e.uid===t));if(!r)return void Jp.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));Jp.debug("[".concat(this._clientId,"] local ").concat(e," ").concat(n?"enabled":"disabled"," with uid ").concat(t));const i="audio"===e?r.hasAudio:r.hasVideo;if("audio"===e){r._trust_audio_enabled_state_=!0;const e=r._audio_enabled_;if(r._audio_enabled_=n,r._audio_enabled_===e)return;{const e=r._audio_enabled_?"enable-local-audio":"disable-local-audio";Jp.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(Yg.USER_INFO_UPDATED,t,e)}}else{r._trust_video_enabled_state_=!0;const e=r._video_enabled_;if(r._video_enabled_=n,r._video_enabled_===e)return;{const e=r._video_enabled_?"enable-local-video":"disable-local-video";Jp.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(t,", msg: ").concat(e)),this.safeEmit(Yg.USER_INFO_UPDATED,t,e)}}const o="audio"===e?r.hasAudio:r.hasVideo;return i!==o?!i&&o?(Jp.info("[".concat(this._clientId,"] remote user ").concat(t," published ").concat(e)),void this.safeEmit(Yg.USER_PUBLISHED,r,e)):("video"===e&&r._videoTrack&&r._videoTrack._destroy(),"audio"===e&&r._audioTrack,this._p2pChannel.muteRemote(r,e),Jp.info("[".concat(this._clientId,"] remote user ").concat(t," unpublished ").concat(e)),void this.safeEmit(Yg.USER_UNPUBLISHED,r,e)):void 0})),Kh(this,"_handleMuteStream",((e,t,n)=>{if(df("BLOCK_LOCAL_CLIENT")&&wf(e,this.channelName))return;Jp.debug("[".concat(this._clientId,"] receive mute message"),e,t,n);const r=this._users.find((t=>t.uid===e));if(!r)return void Jp.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(e));const i="audio"===t?r.hasAudio:r.hasVideo;if("audio"===t){r._trust_audio_mute_state_=!0;const t=r._audio_muted_;if(r._audio_muted_=n,r._audio_muted_===t)return;{const t=r._audio_muted_?"mute-audio":"unmute-audio";Jp.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(Yg.USER_INFO_UPDATED,e,t)}}else{r._trust_video_mute_state_=!0;const t=r._video_muted_;if(r._video_muted_=n,r._video_muted_===t)return;{const t=r._video_muted_?"mute-video":"unmute-video";Jp.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(e,", msg: ").concat(t)),this.safeEmit(Yg.USER_INFO_UPDATED,e,t)}}const o="audio"===t?r.hasAudio:r.hasVideo;if(i!==o){if(!i&&o)return("audio"===t?r._audioSSRC:r._videoSSRC)?(Jp.info("[".concat(this._clientId,"] remote user ").concat(e," published ").concat(t)),void this.safeEmit(Yg.USER_PUBLISHED,r,t)):void Jp.warning("[".concat(this._clientId,"] remote user ").concat(e," receive ").concat(t," unmute message  before add stream message, ").concat(t," SSRC doesn't exist yet."));"video"===t&&r._videoTrack&&r._videoTrack._destroy(),"audio"===t&&r._audioTrack,this._p2pChannel.muteRemote(r,t),Jp.info("[".concat(this._clientId,"] remote user ").concat(e," unpublished ").concat(t)),this.safeEmit(Yg.USER_UNPUBLISHED,r,t)}})),Kh(this,"_handleP2PLost",(async e=>{Jp.debug("[".concat(this._clientId,"] receive p2p lost"),e),parseInt(e.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():Jp.warning("[".concat(this._clientId,"] P2PLost stream not found"),e)})),Kh(this,"_handleTokenWillExpire",(()=>{Jp.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Yg.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)})),Kh(this,"_handleBeforeUnload",(e=>{"beforeunload"===e.type&&void 0!==e.returnValue&&""!==e.returnValue||(this.leave(),Jp.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))})),Kh(this,"_handleUpdateNetworkQuality",(()=>{if("normal"===this._networkQualitySensitivity)return;if(navigator&&void 0!==navigator.onLine&&!navigator.onLine)return void this.safeEmit(Yg.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const e={downlinkNetworkQuality:0,uplinkNetworkQuality:0};e.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),e.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Yg.NETWORK_QUALITY,e)})),this._config=e,this._clientId=gb(5,"client-"),this.store=new WI(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),Jp.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat($p," build: ").concat(Zp,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{cm(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(e){Jp.warning("[".concat(this._clientId,"] ").concat(e.toString()))}this._statsCollector=new ZE(this.store),this._statsCollector.onStatsException=(e,t,n)=>{Jp.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(e,", msg: ").concat(t,", uid: ").concat(n)),this.safeEmit(Yg.EXCEPTION,{code:e,msg:t,uid:n})},this._statsCollector.onUploadPublishDuration=(e,t,n,r)=>{const i=this._users.find((t=>t.uid===e));i&&Zy.peerPublishStatus(this._sessionId,{subscribeElapse:r,audioPublishDuration:t,videoPublishDuration:n,peer:i._uintid})},this.store.useDataChannel=vv().supportDataChannel&&df("SIGNAL_CHANNEL"),this._gateway=new nw(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||jp,httpRetryConfig:e.httpRetryConfig||jp,forceWaitGatewayResponse:void 0===e.forceWaitGatewayResponse||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new xw,this._p2pChannel=new VI(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(e,t,n,r,i){const o=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const s="HTTPS"===(zI||zI||(zI=(window.location.protocol.split(":")[0]||"").toUpperCase(),zI)),a=qI()?window.isSecureContext:"Browser Not Support";if(!qI()&&!s||!window.isSecureContext){const e="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";Jp.warning(e)}const c=mb();"DISCONNECTED"===this.connectionState&&(this.store.avoidJoinStart=Math.round(Date.now()),Jp.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const u=Zy.reportApiInvoke(c,{name:Ug.JOIN,options:[e,t,n,r],states:{isHttps:s,isSecureContext:a},tag:Fg.TRACER});Zy.setAppId(e);try{if(!n&&null!==n)throw new Qp(Vp.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&_g(n,"token",1,2047),_g(e,"appid",1,2047),bg(t),r&&wg(r),i&&_g(i,"optionalInfo",1,2047)}catch(e){throw u.onError(e),e}if(Jp.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(o)),this._leaveMutex.isLocked&&(Jp.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),Jp.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,"DISCONNECTED"!==this.connectionState){const e=new Qp(Vp.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw u.onError(e),e}this._sessionId||(this._sessionId=c,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const l=Qx({clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:"string"!=typeof r?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:i,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},void 0!==this._remoteDefaultVideoStreamType&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(l.setLocalAPVersion=this._setLocalAPVersion),"string"==typeof r&&(l.stringUid=r,this._uintUid?(l.uid=this._uintUid,this._uintUid=void 0):l.uid=0),"none"!==this._encryptionMode&&this._encryptionSecret){if(l.aesmode=this._encryptionMode,l.aespassword=await(async e=>{const t=Nb("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu\nSTM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+\nHvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy\nxQiYDz3vqa6bP29adwIDAQAB"),n=await window.crypto.subtle.importKey("spki",t,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),r=Wy(e),i=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},n,r);return Bb(new Uint8Array(i))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Qp(Vp.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(l.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:t,appId:e});const A=this._sessionId;setTimeout((()=>{"CONNECTING"===this.connectionState&&A===this._sessionId&&Zy.joinChannelTimeout(this._sessionId,5)}),5e3);try{let r;const i=l.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(i)){const e=df("PROXY_SERVER_TYPE3");Array.isArray(e)?l.proxyServer=e[0]:l.proxyServer=e}if(Zy.setProxyServer(l.proxyServer),Jp.setProxyServer(l.proxyServer),this.store.requestAPStart(),l.stringUid&&!l.uid){const e=await Sw(l.stringUid,l,this._axiosCancelSource.token,this._config.httpRetryConfig||jp,this.store);Jp.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(l.stringUid," => ").concat(e)),l.uid=e,r=await ww(l,this._axiosCancelSource.token,this._config.httpRetryConfig||jp,!0,this.store)}else r=await ww(l,this._axiosCancelSource.token,this._config.httpRetryConfig||jp,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Qp(Vp.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout((()=>{this._configDistribute.startGetConfigDistribute(l,this._axiosCancelSource.token),this._configDistribute.on(qm.UPDATE_BITRATE_LIMIT,(e=>{this._p2pChannel.updateBitrateLimit(e)}))}),0),this._key=n||e;const o=r.gatewayInfo;this._joinInfo=Qx(Qx({},l),{},{cid:o.cid,uid:l.uid?l.uid:o.uid,vid:o.vid,apResponse:o.res,uni_lbs_ip:o.uni_lbs_ip,gatewayAddrs:o.gatewayAddrs});const s=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Qp(Vp.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));u.onSuccess(s),this._appId=e,this._channelName=l.cname,this._uid=s,this.store.uid=s,setTimeout((()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(Eh()?"beforeunload":"pagehide",this._handleBeforeUnload)}),0);const a=l.stringUid?"string uid: ".concat(l.stringUid,",uid: ").concat(l.uid):"uid: ".concat(this._uid);return Jp.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(a)),setTimeout((()=>{Jp.startUpload()}),5e3),this.store.joinEnd(),this,Ef.includes(this)||Ef.push(this),s}catch(e){const t=Array.isArray(e)?e[0]:e;throw t&&t.code===Vp.OPERATION_ABORTED?Jp.warning("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t):Jp.error("[".concat(this._clientId,"] join number: ").concat(o,", Joining channel failed, rollback"),t),t.code!==Vp.OPERATION_ABORTED&&this._numberOfJoinCount===o&&(this._gateway.state="DISCONNECTED",this._reset()),u.onError(t),t}}_joinGateway(){if(!this._joinInfo||!this._key)throw new Qp(Vp.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!("disabled"!==this._joinInfo.cloudProxyServer||this._joinInfo.proxyServer||!df("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then((e=>e)).catch((e=>{if(e.code===Vp.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,qg.FALLBACK),e;if(e.code===Vp.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,qg.FALLBACK),e;throw e})).then((e=>{if(e instanceof Qp){if(e.code===Vp.INIT_WEBSOCKET_TIMEOUT){if(Jp.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new Qp(Vp.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const e=df("PROXY_SERVER_TYPE3");if(Array.isArray(e))if(this._joinInfo.apUrl){const t=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),n=t.slice(t.length-2).join(".");e.forEach((e=>{this._joinInfo&&e.includes(n)&&(this._joinInfo.proxyServer=e)})),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=e[0])}else this._joinInfo.proxyServer=e[0];else this._joinInfo.proxyServer=e;const t=df("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return t&&t[1]&&"443"!==t[1]&&Jp.setProxyServer(this._joinInfo.proxyServer),"443"!==df("STATS_COLLECTOR_PORT").toString()&&Zy.setProxyServer(this._joinInfo.proxyServer),Zy.reportApiInvoke(this._sessionId,{name:Ug.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Fg.TRACER}).onSuccess(),this.safeEmit(Yg.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),df("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach((e=>{"forceturn"in e&&(e.forceturn=!0)})),this._gateway.join(this._joinInfo,this._key)}if(Jp.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new Qp(Vp.INVALID_OPERATION);return Zy.reportApiInvoke(this._sessionId,{name:Ug.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Fg.TRACER}).onSuccess(),this._joinGateway()}return e})).then((e=>e))}async leave(){Jp.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(Eh()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(e){const t=Ef.indexOf(e);-1!==t&&Ef.splice(t,1)}(this);const e=await this._leaveMutex.lock();if("DISCONNECTED"===this.connectionState)return Jp.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave("CONNECTED"!==this.connectionState),Jp.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(Array.isArray(e)||(e=[e]),0===e.length)throw new Qp(Vp.INVALID_PARAMS,"track list is empty");if("audience"===this._gateway.role)throw new Qp(Vp.INVALID_OPERATION,"audience can not publish stream");for(const n of e){if(!(n instanceof i_))throw new Qp(Vp.INVALID_PARAMS,"parameter is not local track");if(!n._enabled&&t)throw new Qp(Vp.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(n.getTrackId()))}Jp.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(e.map((e=>"".concat(e.getTrackId()," ")))));const n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&e.forEach((e=>{const t=this._configDistribute.getBitrateLimit();e instanceof PS&&t&&e.setBitrateLimit(t.uplink)}));try{await this._publishHighStream(e),Jp.info("[".concat(this._clientId,"] Publish success, id ").concat(e.map((e=>"".concat(e.getTrackId()," ")))))}catch(e){throw Jp.error("[".concat(this._clientId,"] publish error"),e.toString()),e}finally{n()}}async unpublish(e){if(!this._joinInfo||void 0===this._uid)throw new Qp(Vp.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");e?Array.isArray(e)||(e=[e]):e=this._p2pChannel.getAllTracks(!0),Jp.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map((e=>"".concat(e.getTrackId()," ")))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublish(e);n&&await this._gateway.unpublish(n,this._uid),Jp.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map((e=>"".concat(e.getTrackId())))))}catch(e){throw Jp.error("[".concat(this._clientId,"] unpublish error"),e.toString()),e}finally{t&&t()}}async subscribe(e,t){return this._subscribe(e,t)}async _subscribe(e,t,n){if(mg(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Qp(Vp.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find((t=>t===e))){const t=new Qp(Vp.INVALID_REMOTE_USER,"user is not in the channel");throw Jp.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),t}if(!e.hasAudio&&!e.hasVideo){const t=new Qp(Vp.INVALID_REMOTE_USER,"user is not published");throw Jp.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),t}if(!(n||("audio"!==t||e.hasAudio&&void 0!==e._audioSSRC)&&("video"!==t||e.hasVideo&&void 0!==e._videoSSRC))){const n=new Qp(Vp.REMOTE_USER_IS_NOT_PUBLISHED);throw Jp.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),n}const r="audio"===t?e._audioSSRC:e._videoSSRC,i="audio"===t?e._audioOrtc:e._videoOrtc,o="video"===t?e._rtxSsrcId:void 0,s={stream_type:"audio"===t?Xm.AUDIO:Xm.VIDEO,ssrcId:r},a=await this._subscribeMutex.lock();Jp.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{YE.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,o,i);try{await this._gateway.subscribe(e.uid,s,!0)}catch(n){if((null==n?void 0:n.code)!==Vp.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),n;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(n){throw this._p2pChannel.reportSubscribeEvent(!1,null==n?void 0:n.code,e,t),n}Jp.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch((e=>{Jp.warning("[".concat(this._clientId,"] auto set fallback failed"),e)}));const c="audio"===t?e._audioTrack:e._videoTrack;if(!c)throw new Qp(Vp.UNEXPECTED_ERROR,"can not find remote track in user object");return c}catch(t){throw Jp.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),t),t}finally{a()}}async massSubscribe(e){if(Eg(e,"subscribeList"),!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"Can't subscribe stream, not joined");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Qp(Vp.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();Jp.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; ")));const i=(e=[...e]).map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n}})),o=await this._p2pChannel.globalLock();try{var s;for(let t=e.length-1;t>=0;t--){const r=e[t],{user:o,mediaType:s}=r;if(mg(s,"mediaType",["audio","video"]),!o){const e=new Qp(Vp.INVALID_PARAMS,"user property does not exist in subscribeList item");throw Jp.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),e}if(!this._users.find((e=>e===o))){const n=new Qp(Vp.INVALID_REMOTE_USER,"user is not in the channel");Jp.error("[".concat(this._clientId,"] can not massSubscribe ").concat(o.uid,", this user is not in the channel")),i[t].error=n,e.splice(t,1);continue}if("audio"===s&&(!o.hasAudio||void 0===o._audioSSRC)||"video"===s&&(!o.hasVideo||void 0===o._videoSSRC)){const n=new Qp(Vp.REMOTE_USER_IS_NOT_PUBLISHED);Jp.error("[".concat(this._clientId,"] can not subscribe ").concat(o.uid," with mediaType ").concat(s,", remote user is not published")),i[t].error=n,e.splice(t,1);continue}const a=Bm.Video|Bm.LwoVideo,c=n.get(o);if(c){if("video"===s?c&a:c&Bm.Audio){e.splice(t,1),Jp.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(o.uid,", mediaType:").concat(s," twice"));continue}n.set(o,c|("video"===s?a:Bm.Audio))}else n.set(o,"video"===s?a:Bm.Audio)}for(let t=e.length-1;t>=0;t--){const r=e[t],{user:i,mediaType:o}=r,s=Bm.Video|Bm.LwoVideo;if(this._p2pChannel.hasRemoteMedia(i,o)){await this._p2pChannel.unmuteRemoteNoLock(i,o);const r=n.get(i);n.set(i,"video"===o?r^s:r^Bm.Audio),e.splice(t,1)}}this.store.massSubscribe(e.map((e=>({userId:e.user.uid,type:e.mediaType}))),t);const a=Gn(s=Array.from(n.entries())).call(s,((e,t)=>{let[n,r]=t;if(0===r)return e;const i={stream_id:n.uid,stream_type:r};return r&Bm.Audio&&(i.audio_ssrc=n._audioSSRC),r&Bm.Video&&(i.video_ssrc=n._videoSSRC),e.push(i),e}),[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map((e=>{let{user:t,mediaType:n}=e;return{user:t,mediaType:n,ssrcId:n===Xm.VIDEO?t._videoSSRC:t._audioSSRC,rtxSsrcId:n===Xm.VIDEO?t._rtxSsrcId:void 0}})));const n=new Map;if(a.length>0){const e=await this._gateway.subscribeAll(a,!0);((null==e?void 0:e.users)||[]).forEach((e=>{let{stream_id:t,video_error_code:r,audio_error_code:i,error_code:o}=e;(r||i||o)&&n.set(t,{video_error_code:r,audio_error_code:i,error_code:o})}))}if(Array.from(n.entries()).length>0){const e=Array.from(n.entries()).map((e=>{let t,[n,r]=e;return r.error_code||r.video_error_code&&r.audio_error_code?t=void 0:r.video_error_code?t=Xm.VIDEO:r.audio_error_code&&(t=Xm.AUDIO),{user:this.remoteUsers.find((e=>e.uid===n)),mediaType:t}}));await this._p2pChannel.massUnsubscribeNoLock(e)}for(const e of i){const t=n.get(e.user.uid);if(t){const n=t.error_code||"audio"===e.mediaType&&t.audio_error_code||"video"===e.mediaType&&t.video_error_code;if(n){const t=Hb(n);Jp.error("user:".concat(e.user.uid," mediaType:").concat(e.mediaType," has massSubscribe error ").concat(t.desc)),e.error=new Qp(Vp.SUBSCRIBE_FAILED,"code ".concat(n,": ").concat(t.desc))}}e.error||("video"===e.mediaType?e.track=e.user.videoTrack:e.track=e.user.audioTrack)}return this.store.massSubscribe(i.filter((e=>!e.error)).map((e=>({userId:e.user.uid,type:e.mediaType}))),void 0,Date.now()),i.forEach((e=>{var n;Zy.subscribe(this.store.sessionId,{succ:!!e.error,ec:(null===(n=e.error)||void 0===n?void 0:n.code)||null,video:e.mediaType===Xm.VIDEO,audio:e.mediaType===Xm.AUDIO,peerid:e.user.uid,subscribeRequestid:e.mediaType===Xm.VIDEO?e.user._videoSSRC:e.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)})),Jp.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n)})).join("; "))),i}catch(t){throw await this._p2pChannel.massUnsubscribeNoLock(e),t}}finally{o(),r()}}async unsubscribe(e,t){if(t&&mg(t,"mediaType",["audio","video"]),!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find((t=>t===e))){const t=new Qp(Vp.INVALID_REMOTE_USER,"user is not in the channel");throw Jp.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),t}Jp.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const n=await this._subscribeMutex.lock();try{const r=await this._p2pChannel.unsubscribe(e,t);r&&await this._gateway.unsubscribe(r,e.uid),Jp.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}catch(t){if(t.code===Vp.DISCONNECT_P2P)return void Jp.warning("disconnecting p2p, abort unsubscribe request.");throw Jp.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),t.toString()),t}finally{n()}}async massUnsubscribe(e){if(Eg(e,"unsubscribeList"),!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");Jp.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:i}=e[n];if(!r){const e=new Qp(Vp.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw Jp.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),e}if(mg(i,"mediaType",["video","audio",void 0]),!this._users.find((e=>e===r))){Jp.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const o=Bm.Video|Bm.LwoVideo;if(t.has(r)){const s=t.get(r);let a;switch(i){case"video":a=s&o;break;case"audio":a=s&Bm.Audio;break;default:a=s&(Bm.Audio|o)}if(a){Jp.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(i," twice.")),e.splice(n,1);continue}i?"audio"===i?t.set(r,s|Bm.Audio):"video"===i&&t.set(r,s|o):t.set(r,s|Bm.Audio|o)}else i?"audio"===i?t.set(r,Bm.Audio):"video"===i&&t.set(r,o):t.set(r,Bm.Audio|o)}try{const t=await this._p2pChannel.massUnsubscribe(e);t&&await this._gateway.massUnsubscribe(t),Jp.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map((e=>{let{user:t,mediaType:n}=e;return"user: ".concat(null==t?void 0:t.uid,", mediaType: ").concat(n,";")})).join()))}catch(e){if(e.code===Vp.DISCONNECT_P2P)return void Jp.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw Jp.error("[".concat(this._clientId,"] massUnsubscribe error"),e.toString()),e}}setLowStreamParameter(e){!function(e){if(!e)throw new Qp(Vp.INVALID_PARAMS);Sg(e.width)||yg(e.width,"streamParameter.width"),Sg(e.height)||yg(e.height,"streamParameter.height"),Sg(e.framerate)||yg(e.framerate,"streamParameter.framerate"),Sg(e.bitrate)||vg(e.bitrate,"streamParameter.bitrate")}(e),(!e.width&&e.height||e.width&&!e.height)&&Jp.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Jp.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e}async enableDualStream(){if(!vv().supportDualStream)throw Zy.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Qp(Vp.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Qp(Vp.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw Zy.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,Zy.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),Jp.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia($m.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw Zy.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,Zy.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),Jp.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(e){mg(e,"role",["audience","host"])}(e),t&&cm(t),"rtc"===this.mode)throw Jp.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new Qp(Vp.INVALID_OPERATION,"rtc mode can not use setClientRole");if(t&&t.level&&"host"===e)throw new Qp(Vp.INVALID_OPERATION,"host mode can not set audience latency level");if("audience"===e&&this._p2pChannel.hasLocalMedia())throw new Qp(Vp.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,Jp.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}setProxyServer(e,t){if(_g(e,"proxyServer"),!t){if("DISCONNECTED"!==this.connectionState)throw new Qp(Vp.INVALID_OPERATION,"Set proxy server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new Qp(Vp.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,Zy.setProxyServer(this._proxyServer),Jp.setProxyServer(this._proxyServer),Jp.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if("DISCONNECTED"!==this.connectionState)throw new Qp(Vp.INVALID_OPERATION,"Set turn server before join channel");if("disabled"!==this._cloudProxyServerMode||this._useLocalAccessPoint)throw new Qp(Vp.INVALID_OPERATION,"You have already set the proxy")}if(sm(e))return this._turnServer={servers:e,mode:"original-manual"},void Jp.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map((e=>e.urls)).join(","),"."));e.forEach((e=>am(e))),this._turnServer={servers:e,mode:"manual"},Jp.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if("DISCONNECTED"!==this.connectionState)throw new Qp(Vp.INVALID_OPERATION,"you should set license before join channel");if(_g(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new Qp(Vp.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,Jp.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if("DISCONNECTED"!==this.connectionState)throw new Qp(Vp.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||"manual"===this._turnServer.mode||this._useLocalAccessPoint)throw new Qp(Vp.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(void 0===e&&(e=3),e){case 1:case 2:throw new Qp(Vp.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new Qp(Vp.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,Jp.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if("DISCONNECTED"!==this.connectionState)throw new Qp(Vp.INVALID_OPERATION,"Stop proxy server after leave channel");Zy.setProxyServer(),Jp.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",Jp.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new Qp(Vp.INVALID_PARAMS,"accessPoints is required.");Eg(e.accessPoints.serverList,"accessPoints.serverList"),_g(e.accessPoints.domain,"accessPoints.domain");const t=(e,t)=>{vg(e,t,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new Qp(Vp.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");df("CLOSE_AFB_FOR_LOCAL_AP")&&(hf("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),hf("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,i=e.accessPoints.domain,o=e.accessPoints.serverList.map((e=>r.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(i):e)),s=o.map((e=>"".concat(e,":").concat(n)));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,hf("WEBCS_DOMAIN",s),hf("WEBCS_DOMAIN_BACKUP_LIST",s),hf("GATEWAY_DOMAINS",[i]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(Eg(e.report.hostname,"report.hostname"),hf("EVENT_REPORT_DOMAIN",e.report.hostname[0]),hf("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(hf("EVENT_REPORT_DOMAIN",o[0]),hf("EVENT_REPORT_BACKUP_DOMAIN",o[1]||o[0]));let a=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),a=e.report.port),hf("STATS_COLLECTOR_PORT",a),e.report?hf("ENABLE_EVENT_REPORT",!0):hf("ENABLE_EVENT_REPORT",!1);let c="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(Eg(e.log.hostname,"log.hostname"),c=e.log.hostname[0]):c=o[0];let u=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),u=e.log.port),hf("LOG_UPLOAD_SERVER","".concat(c,":").concat(u));let l=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(Eg(e.cds.hostname,"cds.hostname"),l=e.cds.hostname):l=o;let A=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),A=e.cds.port),hf("CDS_AP",l.map((e=>"".concat(e,":").concat(A)))),e.cds?hf("ENABLE_CONFIG_DISTRIBUTE",!0):hf("ENABLE_CONFIG_DISTRIBUTE",!1),Jp.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(Eg(e,"serverList"),_g(t,"domain"),this._proxyServer||"disabled"!==this._cloudProxyServerMode)throw new Qp(Vp.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map((e=>n.test(e)?"".concat(e.replace(/\./g,"-"),".").concat(t):e)),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,hf("WEBCS_DOMAIN",e),hf("WEBCS_DOMAIN_BACKUP_LIST",e),hf("GATEWAY_DOMAINS",[t]),hf("EVENT_REPORT_DOMAIN",e[0]),hf("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),hf("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),Jp.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(mg(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(e){throw Jp.error("[".concat(this._clientId,"] set default remote video stream type error"),e.toString()),e}else Jp.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){mg(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout((()=>{const t=this._users.find((t=>t.uid===e));t&&t.videoTrack&&t.videoTrack.updateMediaStreamTrackResolution()}),2e3)}catch(e){throw Jp.error("[".concat(this._clientId,"] set remote video stream type error"),e.toString()),e}Jp.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){mg(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(e){throw Jp.error("[".concat(this._clientId,"] set stream fallback option"),e.toString()),e}Jp.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n){if(function(e){mg(e,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),_g(t,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(e)){if(!n||!(n instanceof Uint8Array&&32===n.length))throw new Qp(Vp.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new Qp(Vp.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp("^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'\"|{}\\[\\]])(?=.{8,})").test(t)||Jp.warning("The secret is not strong:\n      The secret must contain at least 1 lowercase alphabetical character,\n      The secret must contain at least 1 uppercase alphabetical character,\n      The secret must contain at least 1 numeric character,\n      The secret must contain at least one special character,\n      The secret must be eight characters or longer.\n      "),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Bb(n))}async renewToken(e){if(_g(e,"token",1,2047),!this._key||!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(df("USE_NEW_TOKEN")){Jp.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const t=await Rw(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||jp);Jp.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:t})}else Jp.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});Jp.debug("[".concat(this._clientId,"] renewToken success"))}catch(e){throw this._key=t,this._joinInfo.token=t,Jp.error("[".concat(this._clientId,"] renewToken failed"),e.toString()),e}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?Jp.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval((()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Yg.VOLUME_INDICATOR,e)}),df("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if("h264"!==this.codec)throw new Qp(Vp.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Qp(Vp.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new Qp(Vp.LIVE_STREAMING_TASK_CONFLICT);const n=t?fm.TRANSCODE:fm.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(fm.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter((t=>t&&t.hasUrl(e)));if(!t.length)throw new Qp(Vp.INVALID_PARAMS,"can not find live streaming url to stop");await Zl.all(t.map((t=>t&&t.stopLiveStreamingTask(e))))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(fm.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,fm.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(fm.INJECT),n=Array.from(H_(e=t.streamingTasks).call(e)).find((e=>e.mode===fm.INJECT));if(!this._joinInfo||!n)throw new Qp(Vp.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){Uw(e);const t=this._createChannelMediaRelayClient();await t.startChannelMediaRelay(e)}async updateChannelMediaRelay(e){Uw(e);const t=this._createChannelMediaRelayClient();await t.updateChannelMediaRelay(e)}async stopChannelMediaRelay(){const e=this._createChannelMediaRelayClient();await e.stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"can not send data stream, not joined");if("string"==typeof e&&(e=(new TextEncoder).encode(e)),new Blob([e]).size>1024)throw new Qp(Vp.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request($g.DATA_STREAM,{payload:Bb(e)},!t)}sendMetadata(e){if(!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new Qp(Vp.METADATA_OUT_OF_RANGE);return this._gateway.signal.request($g.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Bb(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(Bg),!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"can not send custom report, not joined");await Zy.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){mg(t.spatialLayer,"spatialLayer",[0,1,2,3]),mg(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(e){throw Jp.error("[".concat(this._clientId,"] pick SVC layer failed"),e.toString()),e}}_reset(){if(Jp.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=kp.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach((e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy()})),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),"fallback"===this._cloudProxyServerMode&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new n_("client-publish"),this._subscribeMutex=new n_("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch(e){}if(this._moderation)try{this.setImageModeration(!1)}catch(e){}}_startSession(e,t){const n=e||mb();e?Jp.debug("[".concat(this._clientId,"] new Session ").concat(n)):Jp.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,t?Zy.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:t.channel,appid:t.appId,mode:this.mode}):this._joinInfo?Zy.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&Zy.sessionInit(this._sessionId,{lts:(new Date).getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||void 0===this._uid)throw new Qp(Vp.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Qp(Vp.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if("auto"===this._turnServer.mode&&df("FORCE_TURN")&&!df("TURN_ENABLE_TCP")&&!df("TURN_ENABLE_UDP"))throw new Qp(Vp.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");Jp.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let i;try{i=await this._gateway.publish(this._uid,r,!0)}catch(e){if(e.code!==Vp.DISCONNECT_P2P)throw n.throw(e),e}await n.next((null===(t=i)||void 0===t?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const t of e)t instanceof PS&&t._encoderConfig&&this._gateway.setVideoProfile(t._encoderConfig),!t.muted&&t.enabled||await this._p2pChannel.muteLocalTrack(t)}catch(t){if(this._p2pChannel.reportPublishEvent(!1,null==t?void 0:t.code,e),(null==t?void 0:t.code)===Vp.WS_ABORT)return;throw t}}async _publishLowStream(){if(!this._joinInfo||void 0===this._uid)throw new Qp(Vp.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if("CONNECTED"!==this.connectionState&&"RECONNECTING"!==this.connectionState)throw new Qp(Vp.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));Jp.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const e=await this._p2pChannel.publishLowStream(this._lowStreamParameter),n=(await e.next()).value;if(n){var t;let r;try{r=await this._gateway.publish(this._uid,n,!0)}catch(t){if(t.code!==Vp.DISCONNECT_P2P)throw e.throw(t),t}e.next((null===(t=r)||void 0===t?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(e){if(this._p2pChannel.reportPublishEvent(!1,null==e?void 0:e.code,void 0,!0),(null==e?void 0:e.code)===Vp.WS_ABORT)return;throw e}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new Qp(Vp.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new Pw(this._joinInfo,this._config.websocketRetryConfig||jp,this._config.httpRetryConfig||jp),n=e=>{e.onLiveStreamError=(e,t)=>{Zy.reportApiInvoke(this._sessionId,{name:Ug.ON_LIVE_STREAM_ERROR,options:[e,t],tag:Fg.TRACER}).onSuccess(),this.safeEmit(Yg.LIVE_STREAMING_ERROR,e,t)},e.onLiveStreamWarning=(e,t)=>{Zy.reportApiInvoke(this._sessionId,{name:Ug.ON_LIVE_STREAM_WARNING,options:[e,t],tag:Fg.TRACER}).onSuccess(),this.safeEmit(Yg.LIVE_STREAMING_WARNING,e,t)},e.on(wm.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new Qp(Vp.INVALID_OPERATION,"can not find join info to get worker manager"));Cw(e,this._joinInfo,this._axiosCancelSource.token,jp).then(t).catch(n)}))};switch(e){case fm.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case fm.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case fm.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(wm.REQUEST_WORKER_MANAGER_LIST,((e,t,n)=>{if(!this._joinInfo)return n(new Qp(Vp.INVALID_OPERATION,"can not find join info to get worker manager"));Cw(e,this._joinInfo,this._axiosCancelSource.token,jp).then(t).catch(n)})),this._injectStreamingClient.onInjectStatusChange=(e,t,n)=>{this.emit(Yg.INJECT_STREAM_STATUS,e,t,n)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new Qp(Vp.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new Hw(this._joinInfo,this._clientId,this._config.websocketRetryConfig||jp,this._config.httpRetryConfig||jp,n),this._channelMediaRelayClient.on("state",(e=>{e===Im.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(Yg.CHANNEL_MEDIA_RELAY_STATE,e)})),this._channelMediaRelayClient.on("event",(e=>{this.safeEmit(Yg.CHANNEL_MEDIA_RELAY_EVENT,e)})),this._statsCollector.onStatsChanged=(e,t)=>{var n;"resolution"===e&&(null===(n=this._channelMediaRelayClient)||void 0===n||n.setVideoProfile(t))}}return this._channelMediaRelayClient}_handleGatewayEvents(){this._gateway.on(Nm.DISCONNECT_P2P,(async()=>{await this._p2pChannel.disconnectForReconnect()})),this._gateway.on(Nm.CONNECTION_STATE_CHANGE,((e,t,n)=>{var r;if(n===qg.FALLBACK)return;const i=()=>{this.safeEmit(Yg.CONNECTION_STATE_CHANGE,e,t,n)};if(Zy.reportApiInvoke(this._sessionId||(null===(r=this._gateway.joinInfo)||void 0===r?void 0:r.sid)||null,{name:Ug.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Fg.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),Jp.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),"DISCONNECTED"===e)return this._reset(),void i();if("RECONNECTING"===e)this._users.forEach((e=>{e._trust_in_room_=!1,e._trust_audio_enabled_state_=!1,e._trust_video_enabled_state_=!1,e._trust_audio_mute_state_=!1,e._trust_video_mute_state_=!1,e._trust_audio_stream_added_state_=!1,e._trust_video_stream_added_state_=!1,e._audioSSRC=void 0,e._videoSSRC=void 0,e._videoOrtc=void 0,e._audioOrtc=void 0,e._cname=void 0,e._rtxSsrcId=void 0})),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if("CONNECTED"===e){var o;this._streamFallbackTypeCacheMap.forEach(((e,t)=>{this._gateway.setStreamFallbackOption(t,e).catch((e=>{Jp.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),e)}))})),this._remoteStreamTypeCacheMap.forEach(((e,t)=>{this._gateway.setRemoteVideoStreamType(t,e).catch((e=>{Jp.warning("[".concat(this._clientId,"] auto set remote stream type failed"),e)}))})),void 0!==this._remoteDefaultVideoStreamType&&void 0===(null===(o=this._joinInfo)||void 0===o?void 0:o.defaultVideoStream)&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then((()=>{Jp.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))})).catch((e=>{Jp.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(e))})),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._userOfflineTimeout=void 0,this._users.filter((e=>!e._trust_in_room_)).forEach((e=>{Jp.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(e.uid)),this._handleUserOffline({uid:e.uid})})))}),3e3),this._streamRemovedTimeout=window.setTimeout((()=>{"CONNECTED"===this.connectionState&&(this._streamRemovedTimeout=void 0,this._users.forEach((e=>{e._trust_audio_mute_state_||(Jp.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,"audio",!1)),e._trust_video_mute_state_||(Jp.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(e.uid)),this._handleMuteStream(e.uid,"video",!1)),e._trust_audio_enabled_state_||(Jp.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(e.uid)),this._handleSetStreamLocalEnable("audio",e.uid,!0)),e._trust_video_enabled_state_||(Jp.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(e.uid)),this._handleSetStreamLocalEnable("video",e.uid,!0)),e._trust_video_stream_added_state_||(Jp.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(e.uid)),this._handleResetAddStream(e,"video")),e._trust_audio_stream_added_state_||(Jp.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(e.uid)),this._handleResetAddStream(e,"audio")),e._video_added_||e._audio_added_||(Jp.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(e.uid)),this._handleRemoveStream({uid:e.uid,uint_id:e._uintid}))})))}),1e3)}i()})),this._gateway.on(Nm.REQUEST_NEW_GATEWAY_LIST,((e,t)=>{if(!this._joinInfo)return t(new Qp(Vp.UNEXPECTED_ERROR,"can not recover, no join info"));bw(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||jp,this.store).then((t=>{this._joinInfo&&(this._joinInfo.apResponse=t.gatewayInfo.res,this._joinInfo.gatewayAddrs=t.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=t.gatewayInfo.uni_lbs_ip),e(t.gatewayInfo.gatewayAddrs.map((e=>{if(this._joinInfo&&this._joinInfo.proxyServer){const t=e.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(t[0],"&p=").concat(t[1])}return"wss://".concat(e.address)})))})).catch(t)})),this._gateway.on(Nm.NETWORK_QUALITY,(e=>{"normal"===this._networkQualitySensitivity&&this.safeEmit(Yg.NETWORK_QUALITY,e)})),this._gateway.on(Nm.STREAM_TYPE_CHANGE,((e,t)=>{this.safeEmit(Yg.STREAM_TYPE_CHANGED,e,t),Zy.reportApiInvoke(this._sessionId,{name:Ug.STREAM_TYPE_CHANGE,options:[e,t],tag:Fg.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))})),this._gateway.on(Nm.IS_P2P_DISCONNECTED,(e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)})),this._gateway.on(Nm.NEED_RENEW_SESSION,(()=>{this._startSession()})),this._gateway.on(Nm.REQUEST_P2P_CONNECTION_PARAMS,(async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(e){n(e)}})),this._gateway.on(Nm.JOIN_RESPONSE,((e,t)=>{const{dtlsParameters:n,iceParameters:r,candidates:i,rtpCapabilities:o,setup:s,cname:a}=tR(e.ortc,t);this._p2pChannel.connect(r,n,i,o,s,a)})),this._gateway.on(Nm.REQUEST_DC_CONNECTION_PARAMS,(e=>{e(this._p2pChannel.getEstablishParams())})),this._gateway.on(Nm.RESET_SIGNAL,(e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()})),this._gateway.on(Nm.DATACHANNEL_FAILBACK,(()=>{this._joinGateway()})),this._gateway.on(Nm.DATACHANNEL_PRECONNECT,(async(e,t,n,r)=>{var i,o,s,a,c,u;await this._p2pChannel.startP2PConnection({turnServer:null===(i=this._joinInfo)||void 0===i?void 0:i.turnServer},!0);const l=function(e,t){let n;return t&&t.ip&&"number"==typeof t.port?(n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],Jp.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(n.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),Jp.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):n=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],n}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat(null===(o=this._joinInfo)||void 0===o?void 0:o.apResponse.cid,"_").concat(null===(s=this._joinInfo)||void 0===s?void 0:s.apResponse.cert),icePwd:"".concat(null===(a=this._joinInfo)||void 0===a?void 0:a.apResponse.cid,"_").concat(null===(c=this._joinInfo)||void 0===c?void 0:c.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:null!==(u=df("FINGERPRINT"))&&void 0!==u?u:e.fingerprint}]},l,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(r)}))}_handleGatewaySignalEvents(){this._gateway.signal.on(tm.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(tm.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(tm.ON_ADD_AUDIO_STREAM,(e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc))),this._gateway.signal.on(tm.ON_ADD_VIDEO_STREAM,(e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId))),this._gateway.signal.on(tm.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(tm.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(tm.MUTE_AUDIO,(e=>this._handleMuteStream(e.uid,"audio",!0))),this._gateway.signal.on(tm.UNMUTE_AUDIO,(e=>this._handleMuteStream(e.uid,"audio",!1))),this._gateway.signal.on(tm.MUTE_VIDEO,(e=>this._handleMuteStream(e.uid,"video",!0))),this._gateway.signal.on(tm.UNMUTE_VIDEO,(e=>this._handleMuteStream(e.uid,"video",!1))),this._gateway.signal.on(tm.RECEIVE_METADATA,(e=>{const t=Nb(e.metadata);this.safeEmit(Yg.RECEIVE_METADATA,e.uid,t)})),this._gateway.signal.on(tm.ON_DATA_STREAM,(e=>{e.seq&&delete e.seq,e.payload=Nb(e.payload),this.safeEmit(Yg.STREAM_MESSAGE,e.uid,e.payload),this.onStreamMessage&&this.onStreamMessage(e)})),this._gateway.signal.on(tm.ON_CRYPT_ERROR,(()=>{xb((()=>{Jp.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Yg.CRYPT_ERROR)}),this._sessionId)})),this._gateway.signal.on(tm.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(tm.ON_TOKEN_PRIVILEGE_DID_EXPIRE,(()=>{Jp.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.safeEmit(Yg.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()})),this._gateway.signal.on(tm.ON_STREAM_FALLBACK_UPDATE,(e=>{Jp.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Yg.STREAM_FALLBACK,e.stream_id,1===e.stream_type?"fallback":"recover")})),this._gateway.signal.on(tm.ON_PUBLISH_STREAM,(e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),Jp.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))})),this._gateway.signal.on(tm.ENABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)})),this._gateway.signal.on(tm.DISABLE_LOCAL_VIDEO,(e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)})),this._gateway.signal.on(Zg.REQUEST_TIMEOUT,((e,t)=>{if(this._joinInfo)switch(e){case $g.PUBLISH:{if(!t)return;const e=(t=t).ortc;if(e){var n,r,i,o;const s=e.some((e=>{let{stream_type:t}=e;return t===xm.Audio})),a=e.some((e=>{let{stream_type:t}=e;return t!==xm.Audio})),c=e.some((e=>{let{stream_type:t}=e;return t===xm.Screen||t===xm.ScreenLow}));"offer"===t.state&&Zy.publish(this._joinInfo.sid,{eventElapse:YE.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Vp.TIMEOUT,audio:s,video:a,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:c,audioName:s?null===(n=e.find((e=>{let{stream_type:t}=e;return t===xm.Audio})))||void 0===n||null===(r=n.ssrcs[0])||void 0===r?void 0:r.ssrcId.toString():void 0,videoName:a?null===(i=e.find((e=>{let{stream_type:t}=e;return t!==xm.Audio})))||void 0===i||null===(o=i.ssrcs[0])||void 0===o?void 0:o.ssrcId.toString():void 0})}break}case $g.SUBSCRIBE:(t=t)&&Zy.subscribe(this._joinInfo.sid,{succ:!1,ec:Vp.TIMEOUT,audio:t.stream_type===Xm.AUDIO,video:t.stream_type===Xm.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:YE.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}})),this._gateway.signal.on(tm.ON_P2P_OK,(e=>{this.uid,this._uid})),this._gateway.signal.on(tm.ON_PUBLISHED_USER_LIST,(e=>{if(null==e||!e.users)return;df("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter((e=>!wf(e.audio_ssrc,this.channelName))));const t=[],n=[];for(const r of e.users){let e=this._users.find((e=>e.uid===r.stream_id));e?e._trust_in_room_=!0:(e=new US(r.stream_id,r.stream_id),this._users.push(e),0===this.getListeners(Yg.PUBLISHED_USER_LIST).length&&(Jp.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Yg.USER_JOINED,e)));const i=Bm.Audio&r.stream_type,o=(Bm.Video|Bm.LwoVideo)&r.stream_type,s=i&&e.hasAudio,a=o&&e.hasVideo;o&&(e._trust_video_stream_added_state_=!0,e._video_added_=!0,e._videoSSRC=r.video_ssrc,e._rtxSsrcId=r.video_rtx),i&&(e._trust_audio_stream_added_state_=!0,e._audio_added_=!0,e._audioSSRC=r.audio_ssrc),i&&!s&&0===this.getListeners(Yg.PUBLISHED_USER_LIST).length&&(Jp.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published audio")),this.safeEmit(Yg.USER_PUBLISHED,e,"audio")),o&&!a&&0===this.getListeners(Yg.PUBLISHED_USER_LIST).length&&(Jp.info("[".concat(this._clientId,"] remote user ").concat(e.uid," published video")),this.safeEmit(Yg.USER_PUBLISHED,e,"video")),(i&&!s||o&&!a)&&t.push(e),o&&this._p2pChannel.hasPendingRemoteMedia(e,"video")&&n.push({user:e,mediaType:"video"}),i&&this._p2pChannel.hasPendingRemoteMedia(e,"audio")&&n.push({user:e,mediaType:"audio"})}n.length>0&&(Jp.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map((e=>"user: ".concat(e.user.uid,", mediaType: ").concat(e.mediaType))).join("; ")," ")),this.massSubscribe(n).catch((e=>{Jp.error("[".concat(this._clientId,"] mass resubscribe error"),e.toString())}))),this.getListeners(Yg.PUBLISHED_USER_LIST).length>0?(Jp.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map((e=>e.uid)).join(", "))),this.safeEmit(Yg.PUBLISHED_USER_LIST,t)):Jp.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map((e=>e.uid)).join(", ")))}))}_handleP2PChannelEvents(){this._p2pChannel.on(tv.RequestMuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===Vp.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(tv.RequestUnmuteLocal,(async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(e){e.code===Vp.DISCONNECT_P2P?t():n(e)}else t()})),this._p2pChannel.on(tv.RequestRePublish,((e,t,n)=>{this.publish(e,!1).then(t).catch(n)})),this._p2pChannel.on(tv.RequestReSubscribe,(async(e,t,n)=>{try{for(const{user:t,kind:n}of e)n===Xm.VIDEO?await this.subscribe(t,"video"):await this.subscribe(t,"audio");t()}catch(e){n(e)}})),this._p2pChannel.on(tv.RequestUploadStats,((e,t)=>{this._gateway.uploadStats(e,t)})),this._p2pChannel.on(tv.MediaReconnectStart,(e=>{this.safeEmit(Yg.MEDIA_RECONNECT_START,e)})),this._p2pChannel.on(tv.MediaReconnectEnd,(e=>{this.safeEmit(Yg.MEDIA_RECONNECT_END,e)})),this._p2pChannel.on(tv.NeedSignalRTT,(e=>{e(this._gateway.getSignalRTT())})),this._p2pChannel.on(tv.RequestRestartICE,(async e=>{const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let i;try{i=await this._gateway.restartICE({iceParameters:r})}catch(e){return void t.throw(e)}const{iceParameters:o}=function(e){const t=e.iceParameters;return{iceParameters:{iceUfrag:t.iceUfrag,icePwd:t.icePwd}}}(i);await t.next({remoteIceParameters:o})})),this._p2pChannel.on(tv.RequestReconnect,(async()=>{this._gateway.reconnect()})),this._p2pChannel.on(tv.RequestReconnectPC,(async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:null===(e=this._joinInfo)||void 0===e?void 0:e.turnServer}),{gatewayEstablishParams:i,gatewayAddress:o}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),{dtlsParameters:s,iceParameters:a,candidates:c,rtpCapabilities:u,setup:l,cname:A}=tR(i,o);await this._p2pChannel.connect(a,s,c,u,l,A),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()})),this._p2pChannel.on(tv.RequestUnpublishForReconnectPC,(async(e,t,n)=>{this._joinInfo&&void 0!==this._uid?(await this._gateway.unpublish(e,this._uid),t()):n()})),this._p2pChannel.on(tv.P2PLost,(()=>{this.safeEmit(Yg.P2P_LOST,this.store.uid)})),this._p2pChannel.on(tv.UpdateVideoEncoder,(e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)})),this._p2pChannel.on(tv.ConnectionTypeChange,(e=>{this.safeEmit(Yg.IS_USING_CLOUD_PROXY,e)})),this._p2pChannel.on(tv.RequestLowStreamParameter,(e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})})),this._p2pChannel.on(tv.QueryClientConnectionState,(e=>{e(this.connectionState)}))}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if("CONNECTED"!==this.connectionState||!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new Qp(Vp.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new Qp(Vp.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new Qp(Vp.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach((e=>{if(!["supervise","moderation"].includes(e))throw new Qp(Vp.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(e," is not a valid inspect type."))})),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new Qp(Vp.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new wO(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},jp)}catch(e){throw Array.isArray(e)?e[0]:e}}async disableContentInspect(){if(!this._inspect)throw new Qp(Vp.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(gg(e,"enabled"),e){if(!t)throw new Qp(Vp.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(vg(t.interval,"interval",1e3,1/0),"CONNECTED"!==this.connectionState||!this._joinInfo)throw new Qp(Vp.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const e=new ex(t);this._moderation=e,this.handleImageModerationEvents(this._moderation),await e.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},jp)}catch(e){throw Array.isArray(e)?e[0]:e}}else{if(!this._moderation)throw new Qp(Vp.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}}handleImageModerationEvents(e){e.on(pv.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.emit(Yg.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t===dv.CONNECTED){if("CONNECTED"!==this.connectionState)throw this.setImageModeration(!1),new Qp(Vp.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}})),e.on(pv.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}handleVideoInspectEvents(e){e.on(cv.CONNECTION_STATE_CHANGE,((t,n)=>{if(this.emit(Yg.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n===sv.CONNECTED){if("CONNECTED"!==this.connectionState)return void this.emit(Yg.CONTENT_INSPECT_ERROR,new Qp(Vp.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}})),e.on(cv.INSPECT_RESULT,((e,t)=>{var n;if((null==t?void 0:t.code)===Vp.INVALID_OPERATION&&"DISCONNECTED"===this.connectionState)return Jp.debug("Stop inspect content because that has left channel"),null==this||null===(n=this._inspect)||void 0===n||n.close(),void(this._inspect=void 0);this.emit(Yg.CONTENT_INSPECT_RESULT,e,t)})),e.on(cv.CLIENT_LOCAL_VIDEO_TRACK,(e=>{e(this.localTracks.filter((e=>"video"===e.trackMediaType))[0])}))}getJoinChannelServiceRecords(){return Jp.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){gg(e,"enabled"),hf("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}).prototype,"leave",[tx],Object.getOwnPropertyDescriptor(Hx.prototype,"leave"),Hx.prototype),Ry(Hx.prototype,"publish",[nx],Object.getOwnPropertyDescriptor(Hx.prototype,"publish"),Hx.prototype),Ry(Hx.prototype,"unpublish",[rx],Object.getOwnPropertyDescriptor(Hx.prototype,"unpublish"),Hx.prototype),Ry(Hx.prototype,"subscribe",[ix],Object.getOwnPropertyDescriptor(Hx.prototype,"subscribe"),Hx.prototype),Ry(Hx.prototype,"massSubscribe",[ox],Object.getOwnPropertyDescriptor(Hx.prototype,"massSubscribe"),Hx.prototype),Ry(Hx.prototype,"unsubscribe",[sx],Object.getOwnPropertyDescriptor(Hx.prototype,"unsubscribe"),Hx.prototype),Ry(Hx.prototype,"massUnsubscribe",[ax],Object.getOwnPropertyDescriptor(Hx.prototype,"massUnsubscribe"),Hx.prototype),Ry(Hx.prototype,"setLowStreamParameter",[cx],Object.getOwnPropertyDescriptor(Hx.prototype,"setLowStreamParameter"),Hx.prototype),Ry(Hx.prototype,"enableDualStream",[ux],Object.getOwnPropertyDescriptor(Hx.prototype,"enableDualStream"),Hx.prototype),Ry(Hx.prototype,"disableDualStream",[lx],Object.getOwnPropertyDescriptor(Hx.prototype,"disableDualStream"),Hx.prototype),Ry(Hx.prototype,"setClientRole",[Ax],Object.getOwnPropertyDescriptor(Hx.prototype,"setClientRole"),Hx.prototype),Ry(Hx.prototype,"setProxyServer",[hx],Object.getOwnPropertyDescriptor(Hx.prototype,"setProxyServer"),Hx.prototype),Ry(Hx.prototype,"setTurnServer",[dx],Object.getOwnPropertyDescriptor(Hx.prototype,"setTurnServer"),Hx.prototype),Ry(Hx.prototype,"setLicense",[px],Object.getOwnPropertyDescriptor(Hx.prototype,"setLicense"),Hx.prototype),Ry(Hx.prototype,"startProxyServer",[fx],Object.getOwnPropertyDescriptor(Hx.prototype,"startProxyServer"),Hx.prototype),Ry(Hx.prototype,"stopProxyServer",[gx],Object.getOwnPropertyDescriptor(Hx.prototype,"stopProxyServer"),Hx.prototype),Ry(Hx.prototype,"setLocalAccessPointsV2",[mx],Object.getOwnPropertyDescriptor(Hx.prototype,"setLocalAccessPointsV2"),Hx.prototype),Ry(Hx.prototype,"setLocalAccessPoints",[vx],Object.getOwnPropertyDescriptor(Hx.prototype,"setLocalAccessPoints"),Hx.prototype),Ry(Hx.prototype,"setRemoteDefaultVideoStreamType",[yx],Object.getOwnPropertyDescriptor(Hx.prototype,"setRemoteDefaultVideoStreamType"),Hx.prototype),Ry(Hx.prototype,"setRemoteVideoStreamType",[_x],Object.getOwnPropertyDescriptor(Hx.prototype,"setRemoteVideoStreamType"),Hx.prototype),Ry(Hx.prototype,"setStreamFallbackOption",[Ex],Object.getOwnPropertyDescriptor(Hx.prototype,"setStreamFallbackOption"),Hx.prototype),Ry(Hx.prototype,"setEncryptionConfig",[bx],Object.getOwnPropertyDescriptor(Hx.prototype,"setEncryptionConfig"),Hx.prototype),Ry(Hx.prototype,"renewToken",[wx],Object.getOwnPropertyDescriptor(Hx.prototype,"renewToken"),Hx.prototype),Ry(Hx.prototype,"enableAudioVolumeIndicator",[Sx],Object.getOwnPropertyDescriptor(Hx.prototype,"enableAudioVolumeIndicator"),Hx.prototype),Ry(Hx.prototype,"startLiveStreaming",[Tx],Object.getOwnPropertyDescriptor(Hx.prototype,"startLiveStreaming"),Hx.prototype),Ry(Hx.prototype,"setLiveTranscoding",[Cx],Object.getOwnPropertyDescriptor(Hx.prototype,"setLiveTranscoding"),Hx.prototype),Ry(Hx.prototype,"stopLiveStreaming",[Rx],Object.getOwnPropertyDescriptor(Hx.prototype,"stopLiveStreaming"),Hx.prototype),Ry(Hx.prototype,"addInjectStreamUrl",[Ix],Object.getOwnPropertyDescriptor(Hx.prototype,"addInjectStreamUrl"),Hx.prototype),Ry(Hx.prototype,"removeInjectStreamUrl",[Ox],Object.getOwnPropertyDescriptor(Hx.prototype,"removeInjectStreamUrl"),Hx.prototype),Ry(Hx.prototype,"startChannelMediaRelay",[xx],Object.getOwnPropertyDescriptor(Hx.prototype,"startChannelMediaRelay"),Hx.prototype),Ry(Hx.prototype,"updateChannelMediaRelay",[Nx],Object.getOwnPropertyDescriptor(Hx.prototype,"updateChannelMediaRelay"),Hx.prototype),Ry(Hx.prototype,"stopChannelMediaRelay",[Bx],Object.getOwnPropertyDescriptor(Hx.prototype,"stopChannelMediaRelay"),Hx.prototype),Ry(Hx.prototype,"sendCustomReportMessage",[Lx],Object.getOwnPropertyDescriptor(Hx.prototype,"sendCustomReportMessage"),Hx.prototype),Ry(Hx.prototype,"pickSVCLayer",[Dx],Object.getOwnPropertyDescriptor(Hx.prototype,"pickSVCLayer"),Hx.prototype),Ry(Hx.prototype,"enableContentInspect",[Mx],Object.getOwnPropertyDescriptor(Hx.prototype,"enableContentInspect"),Hx.prototype),Ry(Hx.prototype,"disableContentInspect",[Px],Object.getOwnPropertyDescriptor(Hx.prototype,"disableContentInspect"),Hx.prototype),Ry(Hx.prototype,"setImageModeration",[kx],Object.getOwnPropertyDescriptor(Hx.prototype,"setImageModeration"),Hx.prototype),Ry(Hx.prototype,"getJoinChannelServiceRecords",[Ux],Object.getOwnPropertyDescriptor(Hx.prototype,"getJoinChannelServiceRecords"),Hx.prototype),Ry(Hx.prototype,"setPublishAudioFilterEnabled",[Fx],Object.getOwnPropertyDescriptor(Hx.prototype,"setPublishAudioFilterEnabled"),Hx.prototype),Hx);class Gx extends f_{set currentState(e){e!==this._currentState&&(this._currentState=e,this.safeEmit(rm.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Kh(this,"audioBuffer",void 0),Kh(this,"sourceNode",void 0),Kh(this,"startPlayTime",0),Kh(this,"startPlayOffset",0),Kh(this,"pausePlayTime",0),Kh(this,"options",void 0),Kh(this,"currentLoopCount",0),Kh(this,"currentPlaybackSpeed",100),Kh(this,"_currentState","stopped"),this.audioBuffer=e,this.options=t,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return"stopped"===this.currentState?0:"paused"===this.currentState?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(e){"stopped"===this.currentState?(this.options=e,this.startPlayOffset=this.options.startPlayTime||0):Jp.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&"playing"===this.currentState&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(e){this.sourceNode&&(this.sourceNode.onended=null,"playing"===this.currentState&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),"playing"===this.currentState?(this.startPlayOffset=e,this.startSourceNode()):"paused"===this.currentState&&(this.pausePlayTime=e))}resumeProcessAudioBuffer(){"paused"===this.currentState&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch(e){}this.reset()}}setAudioBufferPlaybackSpeed(e){this.sourceNode&&("playing"===this.currentState&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=e/100),this.currentPlaybackSpeed=e}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const e=this.context.createBufferSource();return e.buffer=this.audioBuffer,e.loop=!!this.options.loop,e.connect(this.outputNode),e.playbackRate.value=this.currentPlaybackSpeed/100,e}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const Kx=new Map;function Wx(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function zx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Wx(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Wx(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qx(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=zx(zx({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),"motion"!==n.optimizationMode&&"detail"!==n.optimizationMode||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?Jp.debug("[".concat(e,"] set content hint to"),n.optimizationMode):Jp.debug("[".concat(e,"] set content hint failed")))):Jp.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}const Yx=gh().name;function Xx(e,t,n,r){let i,o=0,s=null;return new Zl(((a,c)=>{setTimeout((()=>{i&&(i(),a(o))}),t),i=d_((()=>{!function(){o>r&&i&&(i(),a(o));const t=n.getContext("2d");if(!t){const e=new Qp(Vp.UNEXPECTED_ERROR,"can not get canvas 2d context.");return Jp.error(e.toString()),void c(e)}t.drawImage(e,0,0,160,120);const u=t.getImageData(0,0,n.width,n.height),l=Math.floor(u.data.length/3);if(s){for(let e=0;e<l;e+=3)if(u.data[e]!==s[e])return o+=1,void(s=u.data);s=u.data}else s=u.data}()}),30)}))}class Jx{constructor(e,t){Kh(this,"id",0),Kh(this,"element",void 0),Kh(this,"peerPair",void 0),Kh(this,"context",void 0),Kh(this,"audioPlayerElement",void 0),Kh(this,"audioTrack",void 0),Jx.count+=1,this.id=Jx.count,this.element=e,this.context=t}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=e=>{const t=document.createElement("audio");t.srcObject=new MediaStream([e.track]),t.play(),this.audioPlayerElement=t}}async switchSdp(){if(!this.peerPair)return;const e=async(e,t)=>{const n="offer"===t?await e.createOffer():await e.createAnswer();return await e.setLocalDescription(n),"complete"===e.iceGatheringState?e.localDescription:new Zl((t=>{e.onicegatheringstatechange=()=>{"complete"===e.iceGatheringState&&t(e.localDescription)}}))},t=async(e,t)=>await e.setRemoteDescription(t);try{const n=await e(this.peerPair[0],"offer");await t(this.peerPair[1],n);const r=await e(this.peerPair[1],"answer");await t(this.peerPair[0],r)}catch(e){throw new Qp(Vp.LOCAL_AEC_ERROR,e.toString()).print()}}async getTracksFromMediaElement(e){if(this.audioTrack)return this.audioTrack;let t;try{e instanceof HTMLVideoElement&&(e.captureStream?e.captureStream():e.mozCaptureStream()),t=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(e).connect(t)}catch(e){throw new Qp(Vp.LOCAL_AEC_ERROR,e.toString()).print()}if(!t)throw new Qp(Vp.LOCAL_AEC_ERROR,"no dest node when local aec").print();const n=t.stream.getAudioTracks()[0];return this.audioTrack=n,n}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const e=this.element,t=await this.getTracksFromMediaElement(e);this.peerPair&&this.peerPair[0].addTrack(t),await this.switchSdp()}close(){Jp.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach((e=>{e.close()})),this.peerPair=void 0,this.audioPlayerElement=void 0}}var Zx,$x;Kh(Jx,"count",0);const eN=window.AudioContext||window.webkitAudioContext,tN=new(Zx=Jy({report:Zy}),Ry(($x=class{constructor(){Kh(this,"units",[]),Kh(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return Jp.debug("the system does not need to process local aec"),-1;this.context||(this.context=new eN);let t=this.units.find((t=>t&&t.getElement()===e));return t||(t=new Jx(e,this.context),this.units.push(t)),t.startEchoCancellation(),Jp.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return gh().name!==uh.SAFARI}}).prototype,"processExternalMediaAEC",[Zx],Object.getOwnPropertyDescriptor($x.prototype,"processExternalMediaAEC"),$x.prototype),$x);function nN(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function rN(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?nN(Object(n),!0).forEach((function(t){Kh(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nN(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const iN=window||document;function oN(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!iN)return;const n=sN._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=e=>{if(!(e&&e.blockedURI&&(sN.onSecurityPolicyViolation||sN.getListeners(Av.SECURITY_POLICY_VIOLATION).length>0)))return;const t=e.blockedURI;df("CSP_DETECTED_HOSTNAME_LIST").some((e=>t.includes(e)))&&(sN.onSecurityPolicyViolation&&"function"==typeof sN.onSecurityPolicyViolation&&sN.onSecurityPolicyViolation(e),sN.getListeners(Av.SECURITY_POLICY_VIOLATION).length>0&&sN.safeEmit(Av.SECURITY_POLICY_VIOLATION,e))};n&&iN.removeEventListener("securitypolicyviolation",n),(t||e&&"function"==typeof e||sN.getListeners(Av.SECURITY_POLICY_VIOLATION).length>0)&&iN.addEventListener("securitypolicyviolation",r),sN._cspEventHandlerPointer=r}hf("PROCESS_ID","process-".concat(gb(8,""),"-").concat(gb(4,""),"-").concat(gb(4,""),"-").concat(gb(4,""),"-").concat(gb(12,""))),function(){const e=gh();mv.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),mv.getStreamFromExtension=e.name===uh.CHROME&&Number(e.version)>34,mv.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const e=new RTCPeerConnection;let t=!1;try{e.addTransceiver("audio"),t=!0}catch(e){}return e.close(),t}(),mv.supportMinBitrate=e.name===uh.CHROME||e.name===uh.EDGE,mv.supportSetRtpSenderParameters=function(){const e=gh();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!Mh()||!(!Eh()&&!yh())||e.name===uh.FIREFOX&&Number(e.version)>=64)}(),e.name===uh.SAFARI&&(Number(e.version)>=14?mv.supportDualStream=!0:mv.supportDualStream=!1),mv.webAudioMediaStreamDest=function(){const e=gh();return!(e.name===uh.SAFARI&&Number(e.version)<12)}(),mv.supportReplaceTrack=!!window.RTCRtpSender&&"function"==typeof RTCRtpSender.prototype.replaceTrack,mv.supportWebGL="undefined"!=typeof WebGLRenderingContext,mv.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,Mh()||(mv.webAudioWithAEC=!0),mv.supportShareAudio=function(){const e=gh();return(e.os===ch.WIN_10||e.os===ch.WIN_81||e.os===ch.WIN_7||e.os===ch.LINUX||e.os===ch.MAC_OS)&&e.name===uh.CHROME&&Number(e.version)>=74}(),mv.supportDualStreamEncoding=function(){const e=gh();return!!df("DISABLE_WEBAUDIO")||("Safari"===e.name&&Number(e.version)>=14||!!("Chrome"===e.name&&/Windows/i.test(e.os||"")&&Number(e.version)>=100&&df("CHROME_DUAL_STREAM_USE_ENCODING")))}(),mv.supportDataChannel=!!(Sh(76)||function(e){const t=gh();return!(t.name!==uh.FIREFOX||!t.osVersion)&&Number(t.version)>=68}()||function(e){const t=gh();return!(t.name!==uh.SAFARI||!t.osVersion)&&Number(t.version)>=14}()),mv.supportPCSetConfiguration=function(){const e=window.RTCPeerConnection;return!bh()&&!!e&&e.prototype.setConfiguration instanceof Function}(),mv.supportWebRTCEncodedTransform=function(){const e=gh();return"Chrome"===e.name&&Number(e.version)>=86}(),Jp.info("browser compatibility",JSON.stringify(mv),JSON.stringify(e))}(),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(e){return void Jp.error("Error loading sdk config",e.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();Jp.debug("Loading global parameters from cache",t),Object.keys(t).forEach((e=>{if(Object.prototype.hasOwnProperty.call(pf,e)){const{value:r,expires:i}=t[e];if(i&&i<=n)return;ff[e]=r,pf[e]=r}}))}catch(t){Jp.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(ff.AREAS)&&ff.AREAS.length>0&&Aw(ff.AREAS,!0);const sN=function(e){const t=new Fp,n=e,r={getListeners:t.getListeners.bind(t),on:(e,n)=>(function(e,t){e===Av.SECURITY_POLICY_VIOLATION&&oN(t,!0)}(e,n),t.on.bind(t)(e,n)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return rN(rN({},n),r)}({__CLIENT_LIST__:Ef,__TRACK_LIST__:bf,VERSION:$p,BUILD:Zp,setParameter:(e,t,n)=>{Jp.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),hf(e,t,n)},getParameter:df,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const n=(await t.createOffer()).sdp;if(!n)return e;t.close(),t=null,e=function(e){const t={video:[],audio:[]};return e.match(/ VP8/i)&&t.video.push("VP8"),e.match(/ VP9/i)&&t.video.push("VP9"),e.match(/ AV1/i)&&t.video.push("AV1"),e.match(/ H264/i)&&t.video.push("H264"),e.match(/ H265/i)&&t.video.push("H265"),e.match(/ opus/i)&&t.audio.push("OPUS"),e.match(/ PCMU/i)&&t.audio.push("PCMU"),e.match(/ PCMA/i)&&t.audio.push("PCMA"),e.match(/ G722/i)&&t.audio.push("G722"),t}(n)}catch(e){throw new Qp(Vp.CREATE_OFFER_FAILED,e.toString&&e.toString()).print()}return e},checkSystemRequirements:function(){const e=Zy.reportApiInvoke(null,{name:Ug.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Fg.TRACER});let t=!1;try{const e=window.RTCPeerConnection,n=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,r=window.WebSocket;t=!!(e&&n&&r)}catch(e){return Jp.error("check system requirement failed: ",e),!1}let n=!1;const r=gh();r.name===uh.CHROME&&Number(r.version)>=58&&(!("WebKit"===ph.engine.name)||function(){const e=gh();if(yh()){if(e.os===ch.MAC_OS)return!0;if(e.os===ch.IOS){const e=ph.os.version&&ph.os.version.split(".");if(e&&14===Number(e[0])&&e[1]&&Number(e[1])>=3)return!0;if(e&&Number(e[0])>14)return!0}}return!1}())&&(n=!0),r.name===uh.FIREFOX&&Number(r.version)>=56&&(n=!0),r.name===uh.OPERA&&Number(r.version)>=45&&(n=!0),r.name===uh.SAFARI&&Number(r.version)>=11&&(n=!0),(Lh()||gh().name===uh.QQ)&&(n=!0),Jp.debug("checkSystemRequirements, api:",t,"browser",n);const i=t&&n;return e.onSuccess(i),i},getDevices:function(e){return O_.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return O_.getRecordingDevices(e)},getCameras:function(e){return O_.getCamerasDevices(e)},getElectronScreenSources:v_,getPlaybackDevices:function(e){return O_.getSpeakers(e)},createClient:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=Zy.reportApiInvoke(null,{name:Ug.CREATE_CLIENT,options:[e],tag:Fg.TRACER});try{om(e)}catch(e){throw t.onError(e),e}return void 0===e.audioCodec&&(e.audioCodec="opus"),t.onSuccess(),new jx(Qx(Qx({forceWaitGatewayResponse:!0},e),{},{role:"rtc"===e.mode?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.CREATE_CAM_VIDEO_TRACK,options:[zx({},e)]}),n=qw(e),r=gb(8,"track-cam-");let i=null;Jp.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{i=(await T_({video:n},r)).getVideoTracks()[0]||null}catch(e){throw t.onError(e),e}if(!i){const e=new Qp(Vp.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(e),e.throw()}e.optimizationMode&&qx(r,i,e,af(e.encoderConfig));const o=new kS(i,e,n,e.scalabiltyMode?uf(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return t.onSuccess(o.getTrackId()),Jp.info("create camera video success, trackId:",r),o},createCustomVideoTrack:function(e){const t=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new PS(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?uf(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,gb(8,"track-cus-"),[Mm.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),Jp.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"disable";const n=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.CREATE_SCREEN_VIDEO_TRACK,options:[zx({},e),t]});e.encoderConfig?"string"==typeof e.encoderConfig||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const r=Yw(e),i=gb(8,"track-scr-v-");let o=null,s=null;const a=vv();if(!a.supportShareAudio&&"enable"===t){const e=new Qp(Vp.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(e),e.throw()}Jp.info("start create screen video track with config",e,"withAudio",t,"trackId",i);try{const e=await T_({screen:r,screenAudio:"auto"===t?a.supportShareAudio:"enable"===t},i);o=e.getVideoTracks()[0]||null,s=e.getAudioTracks()[0]||null}catch(e){throw n.onError(e),e}if(!o){const e=new Qp(Vp.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(e),e.throw()}if(!s&&"enable"===t){o&&o.stop();const e=new Qp(Vp.SHARE_AUDIO_NOT_ALLOWED);return n.onError(e),e.throw()}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(qx(i,o,e,e.encoderConfig&&cf(e.encoderConfig)),e.encoderConfig&&"string"!=typeof e.encoderConfig&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const c=new PS(o,e.encoderConfig?cf(e.encoderConfig):{},e.scalabiltyMode?uf(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i,[Mm.SCREEN_TRACK]);if(!s)return n.onSuccess(c.getTrackId()),Jp.info("create screen video track success","video:",c.getTrackId()),c;const u=new jE(s,void 0,gb(8,"track-scr-a-"),!1,!0);return n.onSuccess([c.getTrackId(),u.getTrackId()]),Jp.info("create screen video track success","video:",c.getTrackId(),"audio:",u.getTrackId()),[c,u]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.CREATE_MIC_AND_CAM_TRACKS,options:[e,t]}),r=qw(t),i=Xw(e),o=gb(8,"track-mic-"),s=gb(8,"track-cam-");let a=null,c=null;Jp.info("start create camera video track(".concat(s,") and microphone audio track(").concat(o,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const e=await T_({audio:i,video:r},"".concat(o,"-").concat(s));a=e.getAudioTracks()[0],c=e.getVideoTracks()[0]}catch(e){throw n.onError(e),e}if(!a||!c){const e=new Qp(Vp.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(e),e.throw()}t.optimizationMode&&qx(s,c,t,af(t.encoderConfig));const u=new GE(a,e,i,o),l=new kS(c,t,r,t.scalabiltyMode?uf(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,s);return n.onSuccess([u.getTrackId(),l.getTrackId()]),Jp.info("create camera video track(".concat(s,") and microphone audio track(").concat(o,") success")),[u,l]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=Xw(e),r=gb(8,"track-mic-");let i=null;Jp.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{i=(await T_({audio:n},r)).getAudioTracks()[0]||null}catch(e){throw t.onError(e),e}if(!i){const e=new Qp(Vp.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(e),e.throw()}const o=new GE(i,e,n,r);return t.onSuccess(o.getTrackId()),Jp.info("create microphone audio track success, trackId:",r),o},createCustomAudioTrack:function(e){const t=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new jE(e.mediaStreamTrack,e.encoderConfig?Af(e.encoderConfig):{},gb(8,"track-cus-"),!1,!0);return Jp.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){const t=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.CREATE_BUFFER_AUDIO_TRACK,options:[e]});if(df("DISABLE_WEBAUDIO"))throw new Qp(Vp.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const n=gb(8,"track-buf-");Jp.info("start create buffer source audio track with config",JSON.stringify(e),"trackId",n);const r=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await async function(e,t){let n=null;if("string"==typeof e){const t=Kx.get(e);if(t)return Jp.debug("use cached audio resource: ",e),t;try{n=(await Kp((()=>kp.get(e,{responseType:"arraybuffer"})),void 0,void 0,{maxRetryCount:3})).data}catch(e){throw new Qp(Vp.FETCH_AUDIO_FILE_FAILED,e.toString())}}else{const t=new Zl(((t,n)=>{const r=new FileReader;r.onload=e=>{e.target?t(e.target.result):n(new Qp(Vp.READ_LOCAL_AUDIO_FILE_ERROR))},r.onerror=()=>{n(new Qp(Vp.READ_LOCAL_AUDIO_FILE_ERROR))},r.readAsArrayBuffer(e)}));n=await t}const r=await function(e){const t=u_();return new Zl(((n,r)=>{t.decodeAudioData(e,(e=>{n(e)}),(e=>{r(new Qp(Vp.DECODE_AUDIO_FILE_FAILED,e.toString()))}))}))}(n);return"string"==typeof e&&t&&Kx.set(e,r),r}(e.source,e.cacheOnlineFile)}catch(e){return t.onError(e),e.throw()}const i=new Gx(e.source),o=new KE(r,i,e.encoderConfig?Af(e.encoderConfig):{},n);return Jp.info("create buffer source audio track success, trackId:",n),t.onSuccess(o.getTrackId()),o},setAppType:function(e){if(Jp.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw Jp.debug("Invalid appType"),new Qp(Vp.INVALID_PARAMS,"invalid app type",e);hf("APP_TYPE",Math.floor(e))},setLogLevel:function(e){Jp.setLogLevel(e)},enableLogUpload:function(){df("USE_NEW_LOG")?hf("UPLOAD_LOG",!0):Jp.enableLogUpload()},disableLogUpload:function(){df("USE_NEW_LOG")?hf("UPLOAD_LOG",!1):Jp.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new kw},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof jE||e instanceof fI)){const e=new Qp(Vp.INVALID_TRACK,"the parameter is not a audio track");return n.onError(e),e.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof jE?e.getTrackLabel():"remote_track",i=e.getVolumeLevel();let o=i,s=i;const a=Date.now();return new Zl((i=>{const c=setInterval((()=>{const u=e.getVolumeLevel();o=u>o?u:o,s=u<s?u:s;const l=o-s>1e-4,A=Date.now()-a;if(l||A>t){clearInterval(c);const t=l,s={duration:A,deviceLabel:r,maxVolumeLevel:o,result:t};Jp.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(s))),n.onSuccess(s),i(t)}}),200)}))},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;const n=Zy.reportApiInvoke(null,{tag:Fg.TRACER,name:Ug.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof PS||e instanceof pI)){const e=new Qp(Vp.INVALID_TRACK,"the parameter is not a video track");return n.onError(e),e.throw()}const r=4;t&&t<1e3&&(t=1e3);const i=e instanceof PS?e.getTrackLabel():"remote_track",o=e.getMediaStreamTrack(!0),s=document.createElement("video");s.style.width="1px",s.style.height="1px",s.setAttribute("muted",""),s.muted=!0,s.setAttribute("playsinline",""),s.controls=!1,(Eh()||yh())&&(s.style.opacity="0.01",s.style.position="fixed",s.style.left="0",s.style.top="0",document.body.appendChild(s)),s.srcObject=new MediaStream([o]),s.play();const a=document.createElement("canvas");a.width=160,a.height=120;let c=0,u=0;try{const e=Date.now();c=await Xx(s,t,a,r),u=Date.now()-e}catch(e){throw n.onError(e),e}Yx===uh.SAFARI&&(s.pause(),s.remove()),s.srcObject=null;const l=c>r,A={duration:u,changedPicNum:c,deviceLabel:i,result:l};return Jp.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(A))),n.onSuccess(A),l},setArea:Aw,audioElementPlayCenter:N_,processExternalMediaAEC:function(e){tN.processExternalMediaAEC(e)},registerExtensions:function(e){e.forEach((e=>{const t=e;t.__registered__=!0,t.logger.hookLog=Jp.extLog,t.reporter.hookApiInvoke=Zy.extApiInvoke,t.parameters&&Object.keys(t.parameters).forEach((e=>{t.parameters[e]=df(e)}))}))},ChannelMediaRelayError:Om,ChannelMediaRelayEvent:Rm,ChannelMediaRelayState:Im,RemoteStreamFallbackType:Um,RemoteStreamType:km,ConnectionDisconnectedReason:qg,AudienceLatencyLevelType:zg,AREAS:Qm});return Object.defineProperties(sN,{onAudioAutoplayFailed:{get:()=>Gy.onAudioAutoplayFailed,set:e=>{Gy.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>Gy.onAutoplayFailed,set:e=>{Gy.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>sN._onSecurityPolicyViolation,set(e){sN._onSecurityPolicyViolation=e,oN(e)}}}),O_.on(Vg.CAMERA_DEVICE_CHANGED,(e=>{Jp.info("camera device changed",JSON.stringify(e)),sN.onCameraChanged&&sN.onCameraChanged(e),sN.safeEmit(Av.CAMERA_CHANGED,e)})),O_.on(Vg.RECORDING_DEVICE_CHANGED,(e=>{Jp.info("microphone device changed",JSON.stringify(e)),sN.onMicrophoneChanged&&sN.onMicrophoneChanged(e),sN.safeEmit(Av.MICROPHONE_CHANGED,e)})),O_.on(Vg.PLAYOUT_DEVICE_CHANGED,(e=>{Jp.debug("playout device changed",JSON.stringify(e)),sN.onPlaybackDeviceChanged&&sN.onPlaybackDeviceChanged(e),sN.safeEmit(Av.PLAYBACK_DEVICE_CHANGED,e)})),N_.onAutoplayFailed=()=>{Jp.info("detect audio element autoplay failed"),Gy.onAudioAutoplayFailed&&Gy.onAudioAutoplayFailed()},c_.on("autoplay-failed",(()=>{Jp.info("detect webaudio autoplay failed"),Gy.onAudioAutoplayFailed&&Gy.onAudioAutoplayFailed(),sN.safeEmit(Av.AUTOPLAY_FAILED)})),window&&(window.__ARTC__=sN),sN})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AgoraRTM=t()}(this,(function(){function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Wa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function qa(e){return(qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function wm(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,i)}function ma(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){function o(e){wm(a,r,i,o,s,"next",e)}function s(e){wm(a,r,i,o,s,"throw",e)}var a=e.apply(t,n);o(void 0)}))}}function va(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xm(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function eb(e,t,n){return t&&xm(e.prototype,t),n&&xm(e,n),e}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ga(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Jf(e,t)}function Td(e){return(Td=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jf(e,t){return(Jf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ym(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Ji(e,t,n){return(Ji=ym()?Reflect.construct:function(e,t,n){var r=[null];return r.push.apply(r,t),e=new(Function.bind.apply(e,r)),n&&Jf(e,n.prototype),e}).apply(null,arguments)}function Kf(e){var t="function"==typeof Map?new Map:void 0;return(Kf=function(e){function n(){return Ji(e,arguments,Td(this).constructor)}if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Jf(n,e)})(e)}function Ki(e,t){if(null==e)return{};if(null==e)var n={};else{n={};var r,i=Object.keys(e);for(r=0;r<i.length;r++){var o=i[r];0<=t.indexOf(o)||(n[o]=e[o])}}if(Object.getOwnPropertySymbols)for(r=Object.getOwnPropertySymbols(e),o=0;o<r.length;o++)i=r[o],0<=t.indexOf(i)||Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i]);return n}function z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ha(e){var t=ym();return function(){var n=Td(e);if(t){var r=Td(this).constructor;n=Reflect.construct(n,arguments,r)}else n=n.apply(this,arguments);return!n||"object"!=typeof n&&"function"!=typeof n?z(this):n}}function Li(e,t,n){return(Li="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Td(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}function $a(e,t){var n=Array.isArray(e)?e:void 0;if(!n)if(null==(n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"])))n=void 0;else{var r,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(e){s=!0;var a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}n=i}if(!(e=n||zm(e,t)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function Z(e){var t=Array.isArray(e)?Mi(e):void 0;if(t||(t="undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"]?Array.from(e):void 0),!(e=t||zm(e)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return e}function zm(e,t){if(e){if("string"==typeof e)return Mi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mi(e,t)}}function Mi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function Da(e,t,n,r,i){var o={};return Object.keys(r).forEach((function(e){o[e]=r[e]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(e,t,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(e,t,o),o=null),o}function xb(e){var t={exports:{}};return e(t,t.exports),t.exports}function Ce(e){e||(e={});var t=e.ua;if(t||"undefined"==typeof navigator||(t=navigator.userAgent),t&&t.headers&&"string"==typeof t.headers["user-agent"]&&(t=t.headers["user-agent"]),"string"!=typeof t)return!1;var n=Zt.test(t)&&!$t.test(t)||!!e.tablet&&au.test(t);return!n&&e.tablet&&e.featureDetect&&navigator&&1<navigator.maxTouchPoints&&-1!==t.indexOf("Macintosh")&&-1!==t.indexOf("Safari")&&(n=!0),n}function Am(e,t){var n,r=3>arguments.length?e:arguments[2];return Ia(e)===r?e[t]:(n=dc.f(e,t))?ka(n,"value")?n.value:void 0===n.get?void 0:n.get.call(r):xa(n=uc(e))?Am(n,t,r):void 0}function bu(e){var t=e.charCodeAt(0)<<24,n=0|cu(~t),r=0,i=0|e.length,o="";if(5>n&&i>=n){for(t=t<<n>>>24+n,r=1;r<n;r=r+1|0)t=t<<6|63&e.charCodeAt(r);65535>=t?o+=Ud(t):1114111>=t?o+=Ud(55296+((t=t-65536|0)>>10)|0,56320+(1023&t)|0):r=0}for(;r<i;r=r+1|0)o+="ï¿½";return o}function Bm(){}function du(e){var t=0|e.charCodeAt(0);if(55296<=t&&56319>=t){var n=0|e.charCodeAt(1);if(!(n==n&&56320<=n&&57343>=n))return Ud(239,191,189);if(65535<(t=(t-55296<<10)+n-56320+65536|0))return Ud(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}return 127>=t?e:2047>=t?Ud(192|t>>>6,128|63&t):Ud(224|t>>>12,128|t>>>6&63,128|63&t)}function Cm(){}function Ba(){Ba.init.call(this)}function Wg(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+qa(e))}function Dm(e,t,n,r){Wg(n);var i=e._events;if(void 0===i)i=e._events=Object.create(null),e._eventsCount=0;else{void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events);var o=i[t]}return void 0===o?(i[t]=n,++e._eventsCount):("function"==typeof o?o=i[t]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),0<(n=void 0===e._maxListeners?Ba.defaultMaxListeners:e._maxListeners)&&o.length>n&&!o.warned&&(o.warned=!0,(n=Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=o.length,console&&console.warn&&console.warn(n))),e}function eu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Em(e,t,n){return e={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},(t=eu.bind(e)).listener=n,e.wrapFn=t}function Fm(e,t,n){if(void 0===(e=e._events))return[];if(void 0===(t=e[t]))return[];if("function"==typeof t)return n?[t.listener||t]:[t];if(n)for(n=Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];else n=Gm(t,t.length);return n}function Hm(e){var t=this._events;if(void 0!==t){if("function"==typeof(e=t[e]))return 1;if(void 0!==e)return e.length}return 0}function Gm(e,t){for(var n=Array(t),r=0;r<t;++r)n[r]=e[r];return n}function fu(e,t,n){"function"==typeof e.on&&Im(e,"error",t,n)}function Im(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+qa(e));e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}function gu(e){return e?Z(e):hu((function(){return[]}),(function(e,t){return e.push(t),e}))}function Jm(e,t){var n,r,i,o;return N.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:n=Km(e)([Lm,Lm,function(e,t){return t}])[2],r=0;case 2:if(!(r<t.length)){s.next=17;break}if(i=t[r],!((o=n(Ni,i))instanceof Xg)){s.next=11;break}if((o=Oi(o.deref()))===Ni){s.next=10;break}return s.next=10,o;case 10:return s.abrupt("return");case 11:if(o===Ni){s.next=14;break}return s.next=14,o;case 14:r++,s.next=2;break;case 17:case"end":return s.stop()}}),iu)}function Yg(e,t){return null!=t&&"function"==typeof t[Symbol.iterator]?Jm(Yg(e),t):function(t){var n=t[2];return ju(t,(function(t,r){return n(t,e(r))}))}}function $c(e){return Object.prototype.toString.call(e).slice(8,-1)}function De(e){return"Object"===$c(e)&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Mm(e){var t;return(t="Boolean"===$c(e)||"Null"===$c(e)||"Undefined"===$c(e))||(t="Number"===$c(e)&&!isNaN(e)),t||"String"===$c(e)||"Symbol"===$c(e)}function Vd(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ee(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Fe(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Lf(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Zg;++t<n;)this.add(e[t])}function Ge(e){this.size=(this.__data__=new $g(e)).size}function He(e,t,n,r,i,o){var s,a=1&t,c=2&t,u=4&t;if(n&&(s=i?n(e,r,i,o):n(e)),void 0!==s)return s;if(!Gb(e))return e;if(r=ub(e)){if(s=ku(e),!a)return Pi(e,s)}else{var l=Mf(e),A="[object Function]"==l||"[object GeneratorFunction]"==l;if(Nf(e))return Nm(e,a);if("[object Object]"==l||"[object Arguments]"==l||A&&!i){if(s=c||A?{}:Om(e),!a)return c?lu(e,mu(s,e)):nu(e,ou(s,e))}else{if(!Oa[l])return i?e:{};s=pu(e,l,a)}}if(o||(o=new Ie),i=o.get(e))return i;o.set(e,s),qu(e)?e.forEach((function(r){s.add(He(r,t,n,r,e,o))})):ru(e)&&e.forEach((function(r,i){s.set(i,He(r,t,n,i,e,o))})),c=u?c?Pm:Qi:c?Of:Wd;var h=r?void 0:c(e);return su(h||e,(function(r,i){h&&(r=e[i=r]),Qm(s,i,He(r,t,n,i,e,o))})),s}function Ri(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;return o.has(i)?o.get(i):(r=e.apply(this,r),n.cache=o.set(i,r)||o,r)};return n.cache=new(Ri.Cache||Zg),n}function Rm(e){if("string"==typeof e)return e;if(ub(e))return Je(e,Rm)+"";if(Ke(e))return Sm?Sm.call(e):"";var t=e+"";return"0"==t&&1/e==-tu?"-0":t}function Si(e,t,n,r,i){var o=-1,s=e.length;for(n||(n=uu),i||(i=[]);++o<s;){var a=e[o];0<t&&n(a)?1<t?Si(a,t-1,n,r,i):Ti(i,a):r||(i[i.length]=a)}return i}function Le(e,t,n,r,i){if(e===t)t=!0;else if(null==e||null==t||!Hc(e)&&!Hc(t))t=e!=e&&t!=t;else e:{var o=ub(e),s=ub(t),a=o?"[object Array]":Mf(e),c=s?"[object Array]":Mf(t),u="[object Object]"==(a="[object Arguments]"==a?"[object Object]":a);if(s="[object Object]"==(c="[object Arguments]"==c?"[object Object]":c),(c=a==c)&&Nf(e)){if(!Nf(t)){t=!1;break e}o=!0,u=!1}if(c&&!u)i||(i=new Ie),t=o||Ui(e)?Tm(e,t,n,r,Le,i):vu(e,t,a,n,r,Le,i);else{if(!(1&n)&&(o=u&&Um.call(e,"__wrapped__"),a=s&&Um.call(t,"__wrapped__"),o||a)){e=o?e.value():e,t=a?t.value():t,i||(i=new Ie),t=Le(e,t,n,r,i);break e}if(c)t:if(i||(i=new Ie),o=1&n,a=Qi(e),s=a.length,c=Qi(t).length,s==c||o){for(c=s;c--;){var l=a[c];if(!(o?l in t:wu.call(t,l))){t=!1;break t}}if(u=i.get(e),l=i.get(t),u&&l)t=u==t&&l==e;else{u=!0,i.set(e,t),i.set(t,e);for(var A=o;++c<s;){var h=e[l=a[c]],d=t[l];if(r)var p=o?r(d,h,l,t,e,i):r(h,d,l,e,t,i);if(void 0===p?h!==d&&!Le(h,d,n,r,i):!p){u=!1;break}A||(A="constructor"==l)}u&&!A&&(n=e.constructor)!=(r=t.constructor)&&"constructor"in e&&"constructor"in t&&!("function"==typeof n&&n instanceof n&&"function"==typeof r&&r instanceof r)&&(u=!1),i.delete(e),i.delete(t),t=u}}else t=!1;else t=!1}}return t}function Pa(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function Hb(e){return!0===(e&&e.__isLong__)}function Xd(e,t){var n;if(t){if((t=0<=(e>>>=0)&&256>e)&&(n=Vm[e]))return n;n=Qa(e,0>(0|e)?-1:0,!0),t&&(Vm[e]=n)}else{if((t=-128<=(e|=0)&&128>e)&&(n=Wm[e]))return n;n=Qa(e,0>e?-1:0,!1),t&&(Wm[e]=n)}return n}function ec(e,t){if(isNaN(e))return t?Yd:fc;if(t){if(0>e)return Yd;if(e>=Xm)return Ym}else{if(e<=-Zm)return Ib;if(e+1>=Zm)return $m}return 0>e?ec(-e,t).neg():Qa(e%Me|0,e/Me|0,t)}function Qa(e,t,n){return new Pa(e,t,n)}function Vi(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return fc;if("number"==typeof t?(n=t,t=!1):t=!!t,2>(n=n||10)||36<n)throw RangeError("radix");var r;if(0<(r=e.indexOf("-")))throw Error("interior hyphen");if(0===r)return Vi(e.substring(1),t,n).neg();r=ec(ah(n,8));for(var i=fc,o=0;o<e.length;o+=8){var s=Math.min(8,e.length-o),a=parseInt(e.substring(o,o+s),n);8>s?(s=ec(ah(n,s)),i=i.mul(s).add(ec(a))):i=(i=i.mul(r)).add(ec(a))}return i.unsigned=t,i}function vc(e,t){return"number"==typeof e?ec(e,t):"string"==typeof e?Vi(e,t):Qa(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}function ha(e,t){function n(){this.constructor=e}Wi(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Ne(e){return"function"==typeof e}function Oe(e){setTimeout((function(){throw e}),0)}function Xi(e){return null!==e&&"object"===qa(e)}function an(e){return e.reduce((function(e,t){return e.concat(t instanceof Pf?t.errors:t)}),[])}function Yi(e){for(;e;){var t=e.destination,n=e.isStopped;if(e.closed||n)return!1;e=t&&t instanceof za?t:null}return!0}function wd(e){return e}function Zi(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return bn(e)}function bn(e){return 0===e.length?wd:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}function cn(e){if(e||(e=gc.Promise||Promise),!e)throw Error("no Promise impl found");return e}function dn(){return function(e){return e.lift(new xu(e))}}function Qf(e){return e?yu(e):Sb}function yu(e){return new ua((function(t){return e.schedule((function(){return t.complete()}))}))}function ad(e){return e&&"function"==typeof e.schedule}function $i(e,t){return new ua((function(n){var r=new nb,i=0;return r.add(t.schedule((function(){i===e.length?n.complete():(n.next(e[i++]),n.closed||r.add(this.schedule()))}))),r}))}function Rf(e,t){return t?$i(e,t):new ua(en(e))}function ob(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ad(t=e[e.length-1])?(e.pop(),$i(e,t)):Rf(e)}function ra(e,t){return new ua(t?function(n){return t.schedule(zu,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function zu(e){e.subscriber.error(e.error)}function Au(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Bu(e,t))}}function fn(e){return e in aj&&(delete aj[e],!0)}function Ic(){}function Ea(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Cu(e,t))}}function gn(e,t,n){if(t){if(!ad(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return gn(e,n).apply(void 0,r).pipe(Ea((function(e){return hc(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i,o=this,s={context:o,subject:i,callbackFunc:e,scheduler:n};return new ua((function(r){if(n)return n.schedule(Du,0,{args:t,subscriber:r,params:s});if(!i){i=new Sf;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.next(1>=e.length?e[0]:e),i.complete()}]))}catch(e){Yi(i)?i.error(e):console.warn(e)}}return i.subscribe(r)}))}}function Du(e){var t=this,n=e.args,r=e.subscriber,i=e.params;e=i.callbackFunc;var o=i.context,s=i.scheduler,a=i.subject;if(!a){a=i.subject=new Sf,i=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.add(s.schedule(Eu,0,{value:1>=e.length?e[0]:e,subject:a}))};try{e.apply(o,n.concat([i]))}catch(e){a.error(e)}}this.add(a.subscribe(r))}function Eu(e){var t=e.subject;t.next(e.value),t.complete()}function hn(e,t,n){if(t){if(!ad(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return hn(e,n).apply(void 0,r).pipe(Ea((function(e){return hc(e)?t.apply(void 0,e):t(e)})))};n=t}return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new ua((function(r){var o=i.context,s=i.subject;if(n)return n.schedule(Fu,0,{params:i,subscriber:r,context:o});if(!s){s=i.subject=new Sf;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(t=e.shift())?s.error(t):(s.next(1>=e.length?e[0]:e),s.complete())}]))}catch(e){Yi(s)?s.error(e):console.warn(e)}}return s.subscribe(r)}))}}function Fu(e){var t=this,n=e.params,r=e.subscriber;e=e.context;var i=n.callbackFunc,o=n.args,s=n.scheduler,a=n.subject;if(!a){a=n.subject=new Sf,n=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(n=e.shift())?t.add(s.schedule(jn,0,{err:n,subject:a})):t.add(s.schedule(Gu,0,{value:1>=e.length?e[0]:e,subject:a}))};try{i.apply(e,o.concat([n]))}catch(e){this.add(s.schedule(jn,0,{err:e,subject:a}))}}this.add(a.subscribe(r))}function Gu(e){var t=e.subject;t.next(e.value),t.complete()}function jn(e){e.subject.error(e.err)}function kn(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}function bj(e,t,n,r,i){if(void 0===i&&(i=new Hu(e,n,r)),!i.closed)return t instanceof ua?t.subscribe(i):Tf(t)(i)}function Iu(e,t){return new ua((function(n){var r=new nb;return r.add(t.schedule((function(){var i=e[Pe]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}function Ju(e,t){return new ua((function(n){var r=new nb;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}function Ku(e,t){if(!e)throw Error("Iterable cannot be null");return new ua((function(n){var r,i=new nb;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[xd](),i.add(t.schedule((function(){if(!n.closed){try{var e=r.next(),t=e.value,i=e.done}catch(e){return void n.error(e)}i?n.complete():(n.next(t),this.schedule())}})))}))),i}))}function ln(e,t){if(null!=e){if(e&&"function"==typeof e[Pe])return Iu(e,t);if(kn(e))return Ju(e,t);if(mn(e))return $i(e,t);if(e&&"function"==typeof e[xd]||"string"==typeof e)return Ku(e,t)}throw new TypeError((null!==e&&qa(e)||e)+" is not observable")}function Jc(e,t){return t?ln(e,t):e instanceof ua?e:new ua(Tf(e))}function bd(e,t){if(!t.closed){if(e instanceof ua)return e.subscribe(t);try{var n=Tf(e)(t)}catch(e){t.error(e)}return n}}function Cb(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(Cb((function(n,r){return Jc(e(n,r)).pipe(Ea((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new Lu(e,n))})}function bh(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),Cb(wd,e)}function nn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return bh(1)(ob.apply(void 0,e))}function yd(e){return new ua((function(t){try{var n=e()}catch(e){return void t.error(e)}return(n?Jc(n):Qf()).subscribe(t)}))}function ch(e,t){return new ua((function(n){var r=e.length;if(0===r)n.complete();else for(var i=Array(r),o=0,s=0,a=function(a){var c=Jc(e[a]),u=!1;n.add(c.subscribe({next:function(e){u||(u=!0,s++),i[a]=e},error:function(e){return n.error(e)},complete:function(){++o!==r&&u||(s===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},c=0;c<r;c++)a(c)}))}function Db(e,t,n,r){return Ne(n)&&(r=n,n=void 0),r?Db(e,t,n).pipe(Ea((function(e){return hc(e)?r.apply(void 0,e):r(e)}))):new ua((function(r){on(e,t,(function(e){1<arguments.length?r.next(Array.prototype.slice.call(arguments)):r.next(e)}),r,n)}))}function on(e,t,n,r,i){if(e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener){e.addEventListener(t,n,i);var o=function(){return e.removeEventListener(t,n,i)}}else if(e&&"function"==typeof e.on&&"function"==typeof e.off)e.on(t,n),o=function(){return e.off(t,n)};else if(e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener)e.addListener(t,n),o=function(){return e.removeListener(t,n)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var s=0,a=e.length;s<a;s++)on(e[s],t,n,r,i)}r.add(o)}function pn(e,t,n){return n?pn(e,t).pipe(Ea((function(e){return hc(e)?n.apply(void 0,e):n(e)}))):new ua((function(n){var r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{var i=e(r)}catch(e){return void n.error(e)}if(Ne(t))return function(){return t(r,i)}}))}function Mu(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}try{var i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function cj(e){return!hc(e)&&0<=e-parseFloat(e)+1}function Qe(e,t){return void 0===e&&(e=0),void 0===t&&(t=cd),(!cj(e)||0>e)&&(e=0),t&&"function"==typeof t.schedule||(t=cd),new ua((function(n){return n.add(t.schedule(Nu,e,{subscriber:n,counter:0,period:e})),n}))}function Nu(e){var t=e.subscriber,n=e.counter;e=e.period,t.next(n),this.schedule({subscriber:t,counter:n+1,period:e},e)}function Jb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];t=Number.POSITIVE_INFINITY;var n=null,r=e[e.length-1];return ad(r)?(n=e.pop(),1<e.length&&"number"==typeof e[e.length-1]&&(t=e.pop())):"number"==typeof r&&(t=e.pop()),null===n&&1===e.length&&e[0]instanceof ua?e[0]:bh(t)(Rf(e,n))}function dj(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return Sb;var n=e[0],r=e.slice(1);return 1===e.length&&hc(n)?dj.apply(void 0,n):new ua((function(e){var t=function(){return e.add(dj.apply(void 0,r).subscribe(e))};return Jc(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})}))}function Ou(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription;if(e=e.obj,!r.closed)if(n<t.length){var o=t[n];r.next([o,e[o]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:e}))}else r.complete()}function Pu(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function yb(e,t){return function(n){return n.lift(new Qu(e,t))}}function fb(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!hc(e[0]))return e[0];e=e[0]}return Rf(e,void 0).lift(new Ru)}function Su(e){var t=e.start,n=e.index,r=e.subscriber;n>=e.count?r.complete():(r.next(t),r.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}function dd(e,t,n){void 0===e&&(e=0);var r=-1;return cj(t)?r=1>Number(t)?1:Number(t):ad(t)&&(n=t),ad(n)||(n=cd),new ua((function(t){var i=cj(e)?e:+e-n.now();return n.schedule(Tu,i,{index:0,period:r,subscriber:t})}))}function Tu(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function ej(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return"function"==typeof(t=e[e.length-1])&&e.pop(),Rf(e,void 0).lift(new Uu(t))}function dh(e){var t=arguments.length,n=cd;ad(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var r=null;2<=t&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return 3<=t&&(i=arguments[2]),function(t){return t.lift(new Vu(e,r,i,n))}}function qn(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function Wu(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,r=e.subscriber,i=e.scheduler,o=r.openContext();r.closed||(r.add(o.closeAction=i.schedule(rn,n,{subscriber:r,context:o})),this.schedule(e,t))}function rn(e){e.subscriber.closeContext(e.context)}function ab(e){return function(t){var n=new Xu(e);return t=t.lift(n),n.caught=t}}function fj(e,t){return Cb(e,t,1)}function sn(e){return void 0===e&&(e=null),function(t){return t.lift(new Yu(e))}}function Zd(e,t){void 0===t&&(t=cd);var n=e instanceof Date&&!isNaN(+e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new Zu(n,t))}}function tn(e,t){return function(n){return n.lift(new $u(e,t))}}function $d(e){return void 0===e&&(e=av),function(t){return t.lift(new bv(e))}}function av(){return new eh}function hb(e){return function(t){return 0===e?Qf():t.lift(new cv(e))}}function fh(e){return function(t){return t.lift(new dv(e))}}function Ca(e,t){var n=2<=arguments.length;return function(r){return r.pipe(e?yb((function(t,n){return e(t,n,r)})):wd,hb(1),n?sn(t):$d((function(){return new eh})))}}function ev(){return function(e){return e.lift(new fv)}}function un(e){return function(t){return 0===e?Qf():t.lift(new gv(e))}}function Uf(e){return function(t){return t.lift(new hv(e))}}function gh(e,t){var n=!1;return 2<=arguments.length&&(n=!0),function(r){return r.lift(new iv(e,t,n))}}function vn(e,t){return 2<=arguments.length?function(n){return Zi(gh(e,t),un(1),sn(t))(n)}:function(t){return Zi(gh((function(t,n,r){return e(t,n,r+1)})),un(1))(t)}}function jv(e,t){return function(n){var r="function"==typeof e?e:function(){return e};if("function"==typeof t)return n.lift(new kv(r,t));var i=Object.create(n,lv);return i.source=n,i.subjectFactory=r,i}}function Re(e){return function(t){return t.lift(new mv(e,t))}}function nv(){return new rb}function Se(){return function(e){return dn()(jv(nv)(e))}}function wn(e,t,n){var r=e&&"object"===qa(e)?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n};return function(e){return e.lift(ov(r))}}function ov(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=void 0===(r=e.windowTime)?Number.POSITIVE_INFINITY:r,s=e.refCount,a=e.scheduler,c=0,u=!1,l=!1;return function(e){if(c++,!t||u){u=!1;var r=(t=new Te(i,o,a)).subscribe(this);n=e.subscribe({next:function(e){t.next(e)},error:function(e){u=!0,t.error(e)},complete:function(){l=!0,n=void 0,t.complete()}}),l&&(n=void 0)}else r=t.subscribe(this);this.add((function(){c--,r.unsubscribe(),r=void 0,n&&!l&&s&&0===c&&(n.unsubscribe(),t=n=void 0)}))}}function Kb(e,t){return"function"==typeof t?function(n){return n.pipe(Kb((function(n,r){return Jc(e(n,r)).pipe(Ea((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new pv(e))}}function Kc(e){return function(t){return t.lift(new qv(e))}}function sa(e,t,n){return function(r){return r.lift(new rv(e,t,n))}}function sv(e,t,n){return void 0===t&&(t=cd),void 0===n&&(n=tv),function(r){return r.lift(new uv(e,t,n.leading,n.trailing))}}function vv(e){e.subscriber.clearThrottle()}function wv(e,t,n){return void 0===n&&(n=cd),function(r){var i=e instanceof Date&&!isNaN(+e),o=i?+e-n.now():Math.abs(e);return r.lift(new xv(o,i,t,n))}}function Lb(e,t){return void 0===t&&(t=cd),wv(e,ra(new Tb),t)}function yv(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;return"function"==typeof e[e.length-1]&&(n=e.pop()),t.lift(new zv(e,n))}}function xn(e){(gj||e)&&(yn.abort(),e&&(yn=new AbortController),gj=e)}function zn(e,t,n,r,i){e!==t&&An(t,(function(o,s){if(i||(i=new Ie),Gb(o)){o=i;var a=hj(e,s),c=hj(t,s),u=o.get(c);if(u)ij(e,s,u);else{var l=void 0===(u=r?r(a,c,s+"",e,t,o):void 0);if(l){var A=ub(c),h=!A&&Nf(c),d=!A&&!h&&Ui(c);u=c,A||h||d?ub(a)?u=a:Hc(a)&&ae(a)?u=Pi(a):h?(l=!1,u=Nm(c,!0)):d?(l=!1,u=Bn(c,!0)):u=[]:Cn(c)||Vf(c)?(u=a,Vf(a)?u=Ue(a,Of(a)):Gb(a)&&!jj(a)||(u=Om(c))):l=!1}l&&(o.set(c,u),zn(u,c,n,r,o),o.delete(c)),ij(e,s,u)}}else void 0===(a=r?r(hj(e,s),o,s+"",e,t,i):void 0)&&(a=o),ij(e,s,a)}),Of)}function Av(e){var t=1,n=kj;1==(1>=arguments.length?0:arguments.length-1)?"number"==typeof(1>=arguments.length?void 0:arguments[1])?t=1>=arguments.length?void 0:arguments[1]:n=1>=arguments.length?void 0:arguments[1]:2==(1>=arguments.length?0:arguments.length-1)&&(t=1>=arguments.length?void 0:arguments[1],n=2>=arguments.length?void 0:arguments[2]);var r=t||1;return function(t){return t.pipe(gh((function(t,i){var o=n.now(),s=o-e;if((t=t.filter((function(e){return e.until>s}))).length>=r){var a=t[t.length-1],c=t[0].until+e*Math.floor(t.length/r);t.push({delay:a.until<o?c-o:c-a.until,until:c,value:i})}else t.push({delay:0,until:o,value:i});return t}),[]),Ea((function(e){return e[e.length-1]})),fj((function(e){var t=ob(e.value);return e.delay?t.pipe(Zd(e.delay,n)):t})))}}function Bv(e,t){var n=(t=void 0===t?{protocols:Dn,makeWebSocket:En}:t).protocols,r=void 0===n?Dn:n,i=void 0===(t=t.makeWebSocket)?En:t;return new ua((function(t){var n,o=new rb,s=i(e,r),a=!1,c=!1,u=!1,l=function(e){if(n)throw a=!0,e=Error("Web socket message factory function called more than once"),t.error(e),e;return n=e.subscribe((function(e){s.send(e)})),o};return s.onopen=function(){u=!0,c?(a=!0,s.close()):t.next(l)},s.onmessage=function(e){o.next(e.data)},s.onerror=function(e){a=!0,t.error(Error(e.message))},s.onclose=function(e){a||(a=!0,c?(t.complete(),o.complete()):t.error(Error(1e3===e.code?"Normal closure":e.reason)))},function(){c=!0,n&&n.unsubscribe(),a||(a=!0,u&&s.close())}}))}function hh(){this._listeners={}}function Fn(e){return"undefined"!=typeof Float32Array?function(){function t(e,t,n){o[0]=e,t[n]=s[0],t[n+1]=s[1],t[n+2]=s[2],t[n+3]=s[3]}function n(e,t,n){o[0]=e,t[n]=s[3],t[n+1]=s[2],t[n+2]=s[1],t[n+3]=s[0]}function r(e,t){return s[0]=e[t],s[1]=e[t+1],s[2]=e[t+2],s[3]=e[t+3],o[0]}function i(e,t){return s[3]=e[t],s[2]=e[t+1],s[1]=e[t+2],s[0]=e[t+3],o[0]}var o=new Float32Array([-0]),s=new Uint8Array(o.buffer),a=128===s[3];e.writeFloatLE=a?t:n,e.writeFloatBE=a?n:t,e.readFloatLE=a?r:i,e.readFloatBE=a?i:r}():function(){function t(e,t,n,r){var i=0>t?1:0;if(i&&(t=-t),0===t)e(0<1/t?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(34028234663852886e22<t)e((i<<31|2139095040)>>>0,n,r);else if(11754943508222875e-54>t)e((i<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var o=Math.floor(Math.log(t)/Math.LN2);e((i<<31|o+127<<23|8388607&Math.round(t*Math.pow(2,-o)*8388608))>>>0,n,r)}}function n(e,t,n){return n=e(t,n),e=2*(n>>31)+1,t=n>>>23&255,n&=8388607,255===t?n?NaN:1/0*e:0===t?1401298464324817e-60*e*n:e*Math.pow(2,t-150)*(n+8388608)}e.writeFloatLE=t.bind(null,Gn),e.writeFloatBE=t.bind(null,Hn),e.readFloatLE=n.bind(null,In),e.readFloatBE=n.bind(null,Jn)}(),"undefined"!=typeof Float64Array?function(){function t(e,t,n){o[0]=e,t[n]=s[0],t[n+1]=s[1],t[n+2]=s[2],t[n+3]=s[3],t[n+4]=s[4],t[n+5]=s[5],t[n+6]=s[6],t[n+7]=s[7]}function n(e,t,n){o[0]=e,t[n]=s[7],t[n+1]=s[6],t[n+2]=s[5],t[n+3]=s[4],t[n+4]=s[3],t[n+5]=s[2],t[n+6]=s[1],t[n+7]=s[0]}function r(e,t){return s[0]=e[t],s[1]=e[t+1],s[2]=e[t+2],s[3]=e[t+3],s[4]=e[t+4],s[5]=e[t+5],s[6]=e[t+6],s[7]=e[t+7],o[0]}function i(e,t){return s[7]=e[t],s[6]=e[t+1],s[5]=e[t+2],s[4]=e[t+3],s[3]=e[t+4],s[2]=e[t+5],s[1]=e[t+6],s[0]=e[t+7],o[0]}var o=new Float64Array([-0]),s=new Uint8Array(o.buffer),a=128===s[7];e.writeDoubleLE=a?t:n,e.writeDoubleBE=a?n:t,e.readDoubleLE=a?r:i,e.readDoubleBE=a?i:r}():function(){function t(e,t,n,r,i,o){var s=0>r?1:0;if(s&&(r=-r),0===r)e(0,i,o+t),e(0<1/r?0:2147483648,i,o+n);else if(isNaN(r))e(0,i,o+t),e(2146959360,i,o+n);else if(17976931348623157e292<r)e(0,i,o+t),e((s<<31|2146435072)>>>0,i,o+n);else if(22250738585072014e-324>r)e((r/=5e-324)>>>0,i,o+t),e((s<<31|r/4294967296)>>>0,i,o+n);else{var a=Math.floor(Math.log(r)/Math.LN2);1024===a&&(a=1023),e(4503599627370496*(r*=Math.pow(2,-a))>>>0,i,o+t),e((s<<31|a+1023<<20|1048576*r&1048575)>>>0,i,o+n)}}function n(e,t,n,r,i){return t=e(r,i+t),r=e(r,i+n),e=2*(r>>31)+1,t=4294967296*(1048575&r)+t,2047==(n=r>>>20&2047)?t?NaN:1/0*e:0===n?5e-324*e*t:e*Math.pow(2,n-1075)*(t+4503599627370496)}e.writeDoubleLE=t.bind(null,Gn,0,4),e.writeDoubleBE=t.bind(null,Hn,4,0),e.readDoubleLE=n.bind(null,In,0,4),e.readDoubleBE=n.bind(null,Jn,4,0)}(),e}function Gn(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function Hn(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function In(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function Jn(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function vb(e,t){this.lo=e>>>0,this.hi=t>>>0}function Wf(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function lj(){}function Cv(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function Aa(){this.len=0,this.tail=this.head=new Wf(lj,0,0),this.states=null}function mj(e,t,n){t[n]=255&e}function nj(e,t){this.len=e,this.next=void 0,this.val=t}function oj(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)t[n++]=127&e.lo|128,e.lo>>>=7;t[n++]=e.lo}function pj(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function Lc(){qj.call(this)}function Dv(e,t,n){40>e.length?pa.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}function wc(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function ib(e){this.buf=e,this.pos=0,this.len=e.length}function rj(){var e=new Kn(0,0),t=0;if(!(4<this.len-this.pos)){for(;3>t;++t){if(this.pos>=this.len)throw wc(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;4>t;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(t=0,4<this.len-this.pos){for(;5>t;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>t;++t){if(this.pos>=this.len)throw wc(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function ih(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function Ln(){if(this.pos+8>this.len)throw wc(this,8);return new Kn(ih(this.buf,this.pos+=4),ih(this.buf,this.pos+=4))}function be(e){sj.call(this,e)}function Xf(e,t,n){if("function"!=typeof e)throw TypeError("rpcImpl must be a function");pa.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!t,this.responseDelimited=!!n}function Mn(e){var t=[];return function e(n){if(null===n||"object"!==qa(n))return n;if(-1!==t.indexOf(n))return"[Circular]";if(t.push(n),"function"==typeof n.toJSON)try{var r=e(n.toJSON());return t.pop(),r}catch(e){return"[Throws: "+(e?e.message:"?")+"]"}return Array.isArray(n)?(r=n.map(e),t.pop(),r):(r=Object.keys(n).reduce((function(t,r){e:{if(Ev.call(n,r))try{var i=n[r];break e}catch(e){i="[Throws: "+(e?e.message:"?")+"]";break e}i=n[r]}return t[r]=e(i),t}),{}),t.pop(),r)}(e)}function Fv(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var t=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*t;case"weeks":case"week":case"w":return 6048e5*t;case"days":case"day":case"d":return 864e5*t;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*t;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*t;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t}}}function jh(e,t,n,r){return Math.round(e/n)+" "+r+(t>=1.5*n?"s":"")}function Gv(e){var t=e.areas,n=e.excludedArea;if(1===t.length&&t[0]===S.GLOBAL&&n===S.CHINA)return Ve([S.OVERSEA]);if(t.includes(S.GLOBAL)){if(e=Yf(kh).filter((function(e){return e!==S.GLOBAL&&e!==S.OVERSEA})),n in Zf){t=Zf[n];var r=[].concat(Z(null!=t?t:[]),[n]);return Ve(e.filter((function(e){return!r.includes(e)})))}if(Nn(n)){var i=Hv(n);return Ve(e.filter((function(e){return e!==n&&e!==i})))}}if(Nn(n)||n in Zf)return Ve(t);throw new ca("Invalid excludedArea area config")}function jb(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(Z(i.map(We))));try{var s=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(Z(i.map(We)))),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var a=Date.now();return ma(N.mark((function n(){var r,o;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(Z(i.map(We)))),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==s?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-a):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-a,We(r)):"Object"!==$c(r)||De(r)?e.resultTracker("%s result is %o",t,We(r)):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),s},n}function Mc(e,t,n){void 0===n&&(n=Object.getOwnPropertyDescriptor(e,t));var r=n.value;return n.value=function(){for(var e=this,n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];this.invokeTracker.apply(this,["%s: ".concat(0<i.length?"%s with args: ".concat(i.map((function(){return"%o"}))):"%s"),this.name,t].concat(i));try{var s=r.apply(this,i)}catch(e){throw this.logError.apply(this,["".concat(void 0!==e.code?"Error Code ".concat(e.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),e.originalError&&this.logError(e.originalError),this.errorTracker(e),e}var a=Date.now();return ma(N.mark((function n(){var r,o;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,s;case 3:r=n.sent,n.next=12;break;case 6:return n.prev=6,n.t0=n.catch(0),e.logError.apply(e,["".concat(void 0!==n.t0.code?"Error Code ".concat(n.t0.code,": "):"","%s failed").concat(0<i.length?" with args: ".concat(i.map((function(){return"%o"}))):""),t].concat(i)),n.t0.originalError&&e.logError(n.t0.originalError),e.errorTracker(n.t0),n.abrupt("return");case 12:r!==s?void 0===r?e.resultTracker("%s promise resolves after %dms",t,Date.now()-a):e.resultTracker("%s promise resolves after %dms, result is %o",t,Date.now()-a,r):"Object"!==$c(r)||De(r)?e.resultTracker("%s result is %o",t,r):e.resultTracker("%s result is %s",t,r.name||(null===(o=r.constructor)||void 0===o?void 0:o.name));case 13:case"end":return n.stop()}}),n,null,[[0,6]])})))(),s},n}function bb(e,t,n){return tj.apply(this,arguments)}function tj(){return(tj=ma(N.mark((function e(t,n,r){var i,o,s,a=arguments;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=3<a.length&&void 0!==a[3]&&a[3],o=Iv[t].encode(n).finish(),s=function(){var e=ma(N.mark((function e(n){var a,c,u,l=arguments;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(3<(c=1<l.length&&void 0!==l[1]?l[1]:0))){e.next=3;break}return e.abrupt("return");case 3:if(u=Xe(u=r?"https://".concat(null!==(a=null==fa?void 0:fa.PROXY_NGINX[0])&&void 0!==a?a:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(n,"&p=443&d=events/proto-raw"):"https://".concat(n,"/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),u=Xe(u,"id",Jv[t].toString()),!i){e.next=9;break}return e.next=9,Kv(1e4);case 9:return e.next=11,lh(u,{body:o,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch((function(e){return s(n,c+1)}));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.prev=3,e.next=6,s((null==fa?void 0:fa.EVENT_REPORT_DOMAIN[0])||$f(null)&&null||"webcollector-rtm.agora.io");case 6:e.next=12;break;case 8:return e.prev=8,e.t0=e.catch(3),e.next=12,s(fa&&On(1<(null==fa?void 0:fa.EVENT_REPORT_DOMAIN.length)?null==fa?void 0:fa.EVENT_REPORT_DOMAIN.slice(1):null==fa?void 0:fa.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 12:case"end":return e.stop()}}),e,null,[[3,8]])})))).apply(this,arguments)}function Xa(e){return void 0===e?P.fromNumber(0):P.fromNumber(Date.now()-e)}function Ta(e){return"string"==typeof e&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&"null"!==e}function Pn(e){try{var t=e.split(".").map((function(e){return Number(e)}))}catch(e){return!1}if(4!==t.length||0===t[0])return!1;for(e=0;e<t.length;e++){var n=t[e];if(!Number.isInteger(n)||0>n||255<n)return!1}return!0}function Qn(e,t){if(!Array.isArray(t)||0===t.length||32<t.length||t.some((function(e){return 0===e.length||32<e.length})))throw new ca("arguments is not valid",gb);if(!Ta(e))throw new ca("ID is invalid",gb)}function ag(e){var t=e.attributes,n=e.attrSizeMap,r=e.maxAttrsCount,i=e.maxAttrValueSize;if(e=e.maxTotalSize,!De(t))throw new ca("attributes must be an object",gb);if(Object.keys(t).length>r)throw new ic("Exceed the limit of ".concat(r," attributes"),Ye);if(0===Object.keys(t).length)throw new ca("The attributes is an empty object",gb);var o=0,s=0;for(t=Object.entries(t);s<t.length;s++){var a=$a(t[s],2),c=a[1];a=new Blob([a[0]]).size;var u=new Blob([c]).size;if(0===a||32<a)throw new ca("Invalid attribute key",gb);if(u>i)throw new ic("Invalid attribute value, over the limit of ".concat(i," bytes"),Ye);if("string"!=typeof c||0===c.length)throw new ca("Invalid attribute value",gb);o+=a,o+=u}if(o>e)throw new ic("The attributes size overflow",Ye);if(void 0!==n){if(Object.keys(n).length>r)throw new ic("Exceed the limit of ".concat(r," attributes"),Ye);for(o=r=0,n=Object.entries(n);o<n.length;o++){if(s=(t=$a(n[o],2))[1],0===(t=new Blob([t[0]]).size))throw new ca("Invalid attribute key",gb);if(s>i)throw new ic("Invalid attribute value, over the limit of ".concat(i," bytes"),Ye);r+=t,r+=s}if(r>e)throw new ic("The attributes size overflow",Ye)}}function mh(e,t){return Math.floor(Math.random()*(Math.floor(t)-Math.ceil(e)+1))+e}function nh(){var e=mh(0,4294967295),t=mh(1,4294967295);return new P(e,t,!0)}function sb(e){return e.toString().padEnd(32,"0")}function Rn(e,t){return new TypeError("Unexpected ".concat(e,": ").concat(t))}function Sn(e,t){return e=e.split(".").map((function(e){return Number(e)})),t=t.split(".").map((function(e){return Number(e)})),Math.sqrt(1e3*Math.pow(e[0]-t[0],2)+100*Math.pow(e[1]-t[1],2)+10*Math.pow(e[2]-t[2],2)+1*Math.pow(e[3]-t[3],2))}function Tn(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function uj(e,t){t="".concat(e).concat(t||"");var n=Un.get(t)||1;return Un.set(t,n+1),"".concat(e).concat(n)}function Vn(e,t){var n="number"==typeof t?t:void 0!==t&&"string"!=typeof t?t.code:void 0;return t="number"!=typeof t&&"string"!=typeof t&&void 0!==t&&void 0!==t.serverCode?t.serverCode:void 0,n="".concat(void 0!==n?" Error Code ".concat(n):"").concat(void 0!==t?", server Code ".concat(t):""),e="string"==typeof e&&e?oh(e):Array.isArray(e)&&"string"==typeof e[0]&&e[0]?oh(Wn.apply(void 0,[e[0]].concat(Z(e.slice(1))))):"","".concat(""===n?"":"".concat(n," - ")).concat(e)}function Kv(e,t){return vj.apply(this,arguments)}function vj(){return(vj=ma(N.mark((function e(t,n){return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n||!n.aborted){e.next=2;break}return e.abrupt("return");case 2:return e.abrupt("return",new Promise((function(e){setTimeout(e,t),null==n||n.addEventListener("abort",e)})));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lh(e,t,n){return wj.apply(this,arguments)}function wj(){return(wj=ma(N.mark((function e(t,n,r){var i,o,s,a,c,u,l,A,h,d,p,f,g,m,v,y,_,E,b,w,S,T,C,R,I,O;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.body,o=n.headers,s=void 0===o?{}:o,a=n.timeout,c=void 0===a?1e4:a,u=n.signal,l=n.withCredentials,A=void 0!==l&&l,h=(r||{}).useBinaryResponse,d=void 0!==h&&h,(p=new XMLHttpRequest).open("POST",t,!0),p.responseType=d?"arraybuffer":"text",p.withCredentials=A,p.timeout=c,f=i instanceof FormData,g=i instanceof Uint8Array,!(1<(m=Object.keys(s).filter((function(e){return"content-type"===e.toLowerCase()}))).length)){e.next=14;break}throw new RangeError("multiple content-type");case 14:0===m.length&&(g?s["Content-Type"]="application/octet-stream":f||(s["Content-Type"]="application/json"));case 15:if("setRequestHeader"in p){e.next=46;break}return p.abort(),e.next=19,fetch(t,{body:f||g?i:JSON.stringify(i),cache:"no-cache",credentials:A?"include":"same-origin",headers:s,method:"POST",mode:"cors",referrer:"no-referrer",signal:u});case 19:if(v=e.sent,!(200<=(y=v.status)&&300>y||304===y)){e.next=31;break}if(!d){e.next=27;break}return e.next=25,v.arrayBuffer();case 25:return _=e.sent,e.abrupt("return",{status:y,responseData:_});case 27:return e.next=29,v.text();case 29:return E=e.sent,e.abrupt("return",{status:y,responseText:E});case 31:return b=new Ja(["Post XHR failure, status %d",y]),e.prev=32,e.next=35,v.text();case 35:throw w=e.sent,b.statusCode=y,b.message=w||"Request failed, status ".concat(y),b;case 41:throw e.prev=41,e.t0=e.catch(32),b.statusCode=y,b.message="Request failed, status ".concat(y),b;case 46:if(0!==Object.keys(s).length)for(S=0,T=Object.entries(s);S<T.length;S++)C=$a(T[S],2),R=C[0],I=C[1],p.setRequestHeader(R,I);return void 0!==u&&(O=function e(){p.abort(),u.removeEventListener("abort",e)},u.addEventListener("abort",O)),f||g?p.send(i):p.send(JSON.stringify(i)),e.abrupt("return",new Promise((function(e,t){p.onload=function(){var n=p.status;if(200<=n&&300>n||304===n)e(d?{status:n,responseData:p.response}:{status:n,responseText:p.responseText});else{var r=new Ja(["Post XHR failure, status %d",n]);r.statusCode=n,r.message=p.response||"Request failed, status ".concat(p.status),t(r)}},p.ontimeout=function(e){t(new Ub(["XHR request timed out after %d ms",c],{originalError:e}))},p.onerror=function(){var e=new Ja(["Post XHR failure, status %d",p.status]);e.statusCode=p.status,e.message=p.response||"Request failed, status ".concat(p.status),t(e)},p.onabort=function(){try{t(new DOMException("The request aborted.","AbortError"))}catch(n){var e=Error("The request aborted.");e.name="AbortError",t(e)}}})));case 50:case"end":return e.stop()}}),e,null,[[32,41]])})))).apply(this,arguments)}function Xn(e,t){if(!De(e))throw new ca("message object is not a plain object",t);if(void 0===e.messageType)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",void 0!==e.text)throw new ca("Raw messages cannot have text property. Use description instead",t)}else{if("string"!=typeof e.text)throw new ca("messageType is undefined",t);if(e.messageType="TEXT",void 0!==e.rawMessage)throw new ca("Text messages cannot have rawMessage property",t)}}function ph(e){return xj.apply(this,arguments)}function xj(){return(xj=ma(N.mark((function e(t){var n,r,i,o,s,a,c,u,l,A,h,d,p,f,g,m,v,y,_,E,b;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.message,r=t.peerId,i=t.toPeer,o=t.session,s=t.errorCodes,a=t.diff,c=t.logger,void 0!==o){e.next=3;break}throw new da("The client is not logged in. Cannot do the operation",s.NOT_LOGGED_IN);case 3:if(u=!1,l=i?"TEXT"===n.messageType?Ka.P2pSMsgNoOfflineFlag:Ka.P2pRMsgNoOfflineFlag:"TEXT"===n.messageType?Ka.ChannelSMsg:Ka.ChannelRMsg,"TEXT"!==n.messageType||!n.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!i){e.next=14;break}if(A=n.text.split("_"),h=$a(A,3),d=h[0],p=h[1],void 0!==h[2]&&Ta(p)&&"AgoraRTMLegacyEndcallCompatibleMessagePrefix"===d){e.next=13;break}throw o.emit("messageCount",{messageCategory:l,type:"common",key:"sentcount"}),o.emit("messageCount",{messageCategory:l,type:"common",key:"invalidmessagecount"}),new ca("Message is not valid",bg);case 13:u=!0;case 14:if(f=Date.now(),g=o.messageSentTimes.length-1,!((m=o.messageSentTimes[g])&&m+3e3<f)){e.next=21;break}o.messageSentTimes=[f],e.next=34;break;case 21:v=g;case 22:if(!(0<=v)){e.next=33;break}if(!(o.messageSentTimes[v]+3e3<f)){e.next=26;break}return o.messageSentTimes=o.messageSentTimes.slice(v+1,g+1),e.abrupt("break",33);case 26:if(!(180<=g-v+1)){e.next=30;break}throw o.emit("messageCount",{messageCategory:l,type:"common",key:"sentcount"}),o.emit("messageCount",{messageCategory:l,type:"common",key:"toooftencount"}),new ic("Message sent failed, exceeded the 180 message in 3 seconds",s.TOO_OFTEN);case 30:v--,e.next=22;break;case 33:o.messageSentTimes.push(f);case 34:e.t0=n.messageType,e.next="TEXT"===e.t0?37:"RAW"===e.t0?42:44;break;case 37:if(!u){e.next=41;break}return y=n.text.split("_"),_=$a(y,3),E=_[1],b=_[2],c.info("[rtm-API] EndCall message send api is called"),e.abrupt("return",o.sendInvitationMessage({peerId:r,type:"CallCancel",extra:b,channelId:E,callId:"0"}));case 41:return e.abrupt("return",o.sendTextMessage(n.text,r,i,1e4-a));case 42:return void 0===n.description&&(n.description=""),e.abrupt("return",o.sendRawMessage(n.rawMessage,n.description,r,i,1e4-a));case 44:throw o.emit("messageCount",{messageCategory:l,type:"common",key:"sentcount"}),o.emit("messageCount",{messageCategory:l,type:"common",key:"invalidmessagecount"}),new ca("Invalid message type",bg);case 47:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lv(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=e.replace(/(https?:\/\/)?(www.)?/i,"");return t||(n=n.split(".").slice(e.length-2).join(".")),-1!==n.indexOf("/")?n.split("/")[0]:n}function La(e){if("string"!=typeof e)return"[Sensitive Info]";var t=Math.floor(.7*e.length),n=e.length;return Yn(e,t,n,"*".repeat(n-t))}function Zn(e,t,n){function r(i){if(void 0===e)return e;if(Mm(i))return i;if(Array.isArray(i))return i.map(r);var o={},s=0;for(i=qh(i);s<i.length;s++){var a=$a(i[s],2),c=a[0];if("string"==typeof(a=a[1])&&n.includes(c)){o[c]="string"==typeof a?La(a):"[Sensitive Info]";break}t.includes(c)?o[c]="[Hidden Info]":o[c]=null==a?a:n.includes(c)?"[Sensitive Info]":r(a)}return o}return Array.isArray(e)?e.map(r):r(e)}function $n(e){return Object.getOwnPropertyNames(e).forEach((function(t){"object"==qa(t=e[t])&&null!==t&&$n(t)})),Object.freeze(e)}function cg(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function rh(e){return(new TextEncoder).encode(e).length}function ao(){for(var e=0,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e+=n[t].length;for(e=new Uint8Array(e),r=t=0;r<n.length;r++){var i=n[r];e.set(i,t),t+=i.length}return e}function Xe(e,t,n){var r=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=null==r?void 0:r[1],r=null==r?void 0:r[2]){var i;for(r=r.substr(1).split("&"),i=0;i<r.length;i++)if(r[i].split("=")[0]==t){r[i]=t+"="+encodeURIComponent(n);break}return i==r.length&&r.push(t+"="+encodeURIComponent(n)),e+"?"+r.join("&")}return e+"?"+t+"="+encodeURIComponent(n)}function Yn(e,t,n,r){return"string"!=typeof e?"[Sensitive Info]":e.substring(0,t)+r+e.substring(n)}function $f(e){return"string"==typeof e&&0!==e.length&&"false"!==e&&"null"!==e&&"undefined"!==e}function Mv(e,t){var n="".concat(e,"Uri");if("number"!=typeof(n=yj[n])||0===n)throw new TypeError("Got Unknown URI Name");return t=new(e=bo[e])(t),t=e.encode(t).finish(),new Nv({uri:n,data:t})}function co(e,t){var n=$f(null);return"".concat(e.split(".").join("-"),".edge.").concat(n?null:t?"sd-rtn.com":"agora.io")}function sh(e,t){return P.fromValue(e).eq(t)}function th(e,t){var n=void 0===t?e.val:t,r=e.isBoolean;t=e.isNumber;var i=e.oneof,o=e.len;if(2!==[r,t,i].filter((function(e){return!e})).length)throw new TypeError("invalid field type");if(void 0!==n&&(e=!1,void 0!==i&&(i=zj(i),Ov(i,sh).length===i.length&&void 0!==Pv(i,(function(e){return sh(n,e)}))&&(e=!0)),r=void 0!==r&&(0===n||1===n)&&1===o,t=void 0!==t&&n.toString(2).length<=o,!(e||r||t)))throw Error("invalid field value")}function eo(e){return e.reduce((function(e,t){return e.concat(t instanceof uh.UnsubscriptionError?t.errors:t)}),[])}function Qv(e,t){do{2147483647==dg?dg=0:dg++}while(Ze.hasOwnProperty(dg));var n=dg;return Ze[n]={callback:e,parameters:Array.prototype.slice.call(arguments,2)},Aj.postMessage({name:"setInterval",fakeId:n,time:t}),n}function fo(e){return function(){var t=e();if(!t)throw new da("Client is not logged in. Cannot do the operation");return t}}var Ya="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},vh=function(e){return e&&e.Math==Math&&e},R=vh("object"==typeof globalThis&&globalThis)||vh("object"==typeof window&&window)||vh("object"==typeof self&&self)||vh("object"==typeof Ya&&Ya)||function(){return this}()||Function("return this")(),la=function(e){try{return!!e()}catch(e){return!0}},wa=!la((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),go={}.propertyIsEnumerable,ho=Object.getOwnPropertyDescriptor,eg=ho&&!go.call({1:2},1)?function(e){return!!(e=ho(this,e))&&e.enumerable}:go,Nc=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Rv={}.toString,xc=function(e){return Rv.call(e).slice(8,-1)},Sv="".split,fg=la((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==xc(e)?Sv.call(e,""):Object(e)}:Object,Eb=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},Mb=function(e){return fg(Eb(e))},xa=function(e){return"object"==typeof e?null!==e:"function"==typeof e},Oc=function(e,t){if(!xa(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!xa(r=n.call(e))||"function"==typeof(n=e.valueOf)&&!xa(r=n.call(e))||!t&&"function"==typeof(n=e.toString)&&!xa(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")},pb=function(e){return Object(Eb(e))},Tv={}.hasOwnProperty,ka=function(e,t){return Tv.call(pb(e),t)},$e=R.document,wh=xa($e)&&xa($e.createElement),io=!wa&&!la((function(){return 7!=Object.defineProperty(wh?$e.createElement("div"):{},"a",{get:function(){return 7}}).a})),jo=Object.getOwnPropertyDescriptor,dc={f:wa?jo:function(e,t){if(e=Mb(e),t=Oc(t,!0),io)try{return jo(e,t)}catch(e){}if(ka(e,t))return Nc(!eg.call(e,t),e[t])}},Ia=function(e){if(!xa(e))throw TypeError(String(e)+" is not an object");return e},ko=Object.defineProperty,qb={f:wa?ko:function(e,t,n){if(Ia(e),t=Oc(t,!0),Ia(n),io)try{return ko(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},kb=wa?function(e,t,n){return qb.f(e,t,Nc(1,n))}:function(e,t,n){return e[t]=n,e},Bj=function(e,t){try{kb(R,e,t)}catch(n){R[e]=t}return t},zd=R["__core-js_shared__"]||Bj("__core-js_shared__",{}),Uv=Function.toString;"function"!=typeof zd.inspectSource&&(zd.inspectSource=function(e){return Uv.call(e)});var Cj=zd.inspectSource,lo=R.WeakMap,Vv="function"==typeof lo&&/native code/.test(Cj(lo)),Ad=xb((function(e){(e.exports=function(e,t){return zd[e]||(zd[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})})),Wv=0,Xv=Math.random(),af=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++Wv+Xv).toString(36)},mo=Ad("keys"),xh=function(e){return mo[e]||(mo[e]=af(e))},bf={},Yv=R.WeakMap;if(Vv||zd.state)var ce=zd.state||(zd.state=new Yv),Zv=ce.get,no=ce.has,$v=ce.set,Dj=function(e,t){if(no.call(ce,e))throw new TypeError("Object already initialized");return t.facade=e,$v.call(ce,e,t),t},yh=function(e){return Zv.call(ce,e)||{}},Ej=function(e){return no.call(ce,e)};else{var cf=xh("state");bf[cf]=!0,Dj=function(e,t){if(ka(e,cf))throw new TypeError("Object already initialized");return t.facade=e,kb(e,cf,t),t},yh=function(e){return ka(e,cf)?e[cf]:{}},Ej=function(e){return ka(e,cf)}}var cb={set:Dj,get:yh,has:Ej,enforce:function(e){return Ej(e)?yh(e):Dj(e,{})},getterFor:function(e){return function(t){var n;if(!xa(t)||(n=yh(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},Za=xb((function(e){var t=cb.get,n=cb.enforce,r=String(String).split("String");(e.exports=function(e,t,i,o){var s=!!o&&!!o.unsafe,a=!!o&&!!o.enumerable;if(o=!!o&&!!o.noTargetGet,"function"==typeof i){"string"!=typeof t||ka(i,"name")||kb(i,"name",t);var c=n(i);c.source||(c.source=r.join("string"==typeof t?t:""))}e===R?a?e[t]=i:Bj(t,i):(s?!o&&e[t]&&(a=!0):delete e[t],a?e[t]=i:kb(e,t,i))})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||Cj(this)}))})),oo=function(e){return"function"==typeof e?e:void 0},Pc=function(e,t){return 2>arguments.length?oo(R[e])||oo(R[e]):R[e]&&R[e][t]||R[e]&&R[e][t]},aw=Math.ceil,bw=Math.floor,yc=function(e){return isNaN(e=+e)?0:(0<e?bw:aw)(e)},cw=Math.min,Ma=function(e){return 0<e?cw(yc(e),9007199254740991):0},dw=Math.max,ew=Math.min,Vb=function(e,t){return 0>(e=yc(e))?dw(e+t,0):ew(e,t)},po=function(e){return function(t,n,r){t=Mb(t);var i=Ma(t.length);if(r=Vb(r,i),e&&n!=n){for(;i>r;)if((n=t[r++])!=n)return!0}else for(;i>r;r++)if((e||r in t)&&t[r]===n)return e||r||0;return!e&&-1}},qo=po(!0),Fj=po(!1),ro=function(e,t){e=Mb(e);var n,r=0,i=[];for(n in e)!ka(bf,n)&&ka(e,n)&&i.push(n);for(;t.length>r;)ka(e,n=t[r++])&&(~Fj(i,n)||i.push(n));return i},zh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),fw=zh.concat("length","prototype"),de={f:Object.getOwnPropertyNames||function(e){return ro(e,fw)}},gg={f:Object.getOwnPropertySymbols},so=Pc("Reflect","ownKeys")||function(e){var t=de.f(Ia(e)),n=gg.f;return n?t.concat(n(e)):t},to=function(e,t){for(var n=so(t),r=qb.f,i=dc.f,o=0;o<n.length;o++){var s=n[o];ka(e,s)||r(e,s,i(t,s))}},gw=/#|\.prototype\./,Qc=function(e,t){return(e=hw[iw(e)])==jw||e!=kw&&("function"==typeof t?la(t):!!t)},iw=Qc.normalize=function(e){return String(e).replace(gw,".").toLowerCase()},hw=Qc.data={},kw=Qc.NATIVE="N",jw=Qc.POLYFILL="P",lw=dc.f,ea=function(e,t){var n,r,i,o=e.target,s=e.global,a=e.stat;if(r=s?R:a?R[o]||Bj(o,{}):(R[o]||{}).prototype)for(i in t){var c=t[i],u=e.noTargetGet?(n=lw(r,i))&&n.value:r[i];if(!(n=Qc(s?i:o+(a?".":"#")+i,e.forced))&&void 0!==u){if(typeof c==typeof u)continue;to(c,u)}(e.sham||u&&u.sham)&&kb(c,"sham",!0);try{Za(r,i,c,e)}catch(e){}}},Gj=function(){var e=Ia(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},Rc=la((function(){var e=/a/y;return e.lastIndex=2,null!=e.exec("abcd")})),mw=la((function(){var e=/^r/gy;return e.lastIndex=2,null!=e.exec("str")})),Ah=RegExp.prototype.exec,nw=Ad("native-string-replace",String.prototype.replace),uo=Ah,Hj=(c=/a/,b=/b*/g,Ah.call(c,"a"),Ah.call(b,"a"),0!==c.lastIndex||0!==b.lastIndex),vo=Rc||mw,Ij=void 0!==/()??/.exec("")[1],c,b;(Hj||Ij||vo)&&(uo=function(e){var t,n=vo&&this.sticky,r=Gj.call(this),i=this.source,o=0,s=e;if(n){-1===(r=r.replace("y","")).indexOf("g")&&(r+="g"),s=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&"\n"!==e[this.lastIndex-1])&&(i="(?: "+i+")",s=" "+s,o++);var a=new RegExp("^(?:"+i+")",r)}if(Ij&&(a=new RegExp("^"+i+"$(?!\\s)",r)),Hj)var c=this.lastIndex;var u=Ah.call(n?a:this,s);return n?u?(u.input=u.input.slice(o),u[0]=u[0].slice(o),u.index=this.lastIndex,this.lastIndex+=u[0].length):this.lastIndex=0:Hj&&u&&(this.lastIndex=this.global?u.index+u[0].length:c),Ij&&u&&1<u.length&&nw.call(u[0],a,(function(){for(t=1;t<arguments.length-2;t++)void 0===arguments[t]&&(u[t]=void 0)})),u});var hg=uo;ea({target:"RegExp",proto:!0,forced:/./.exec!==hg},{exec:hg});var df=Pc("navigator","userAgent")||"",wo=R.process,xo=wo&&wo.versions,yo=xo&&xo.v8;if(yo)var Bd=yo.split("."),Jj=4>Bd[0]?1:Bd[0]+Bd[1];else df&&(Bd=df.match(/Edge\/(\d+)/),(!Bd||74<=Bd[1])&&(Bd=df.match(/Chrome\/(\d+)/))&&(Jj=Bd[1]));var Cd=Jj&&+Jj,Sc=!!Object.getOwnPropertySymbols&&!la((function(){return!String(Symbol())||!Symbol.sham&&Cd&&41>Cd})),zo=Sc&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,ig=Ad("wks"),jg=R.Symbol,ow=zo?jg:jg&&jg.withoutSetter||af,Fa=function(e){return ka(ig,e)&&(Sc||"string"==typeof ig[e])||(Sc&&ka(jg,e)?ig[e]=jg[e]:ig[e]=ow("Symbol."+e)),ig[e]},pw=Fa("species"),Kj=RegExp.prototype,qw=!la((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),Ao="$0"==="a".replace(/./,"$0"),Bo=Fa("replace"),Co=!!/./[Bo]&&""===/./[Bo]("a","$0"),rw=!la((function(){var e=/(?:)/,t=e.exec;return e.exec=function(){return t.apply(this,arguments)},2!==(e="ab".split(e)).length||"a"!==e[0]||"b"!==e[1]})),Bh=function(e,t,n,r){var i=Fa(e),o=!la((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),s=o&&!la((function(){var t=!1,n=/a/;return"split"===e&&((n={constructor:{}}).constructor[pw]=function(){return n},n.flags="",n[i]=/./[i]),n.exec=function(){return t=!0,null},n[i](""),!t}));if(!o||!s||"replace"===e&&(!qw||!Ao||Co)||"split"===e&&!rw){var a=/./[i],c=(n=n(i,""[e],(function(e,t,n,r,i){var s=t.exec;return s===hg||s===Kj.exec?o&&!i?{done:!0,value:a.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}}),{REPLACE_KEEPS_$0:Ao,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:Co}))[1];Za(String.prototype,e,n[0]),Za(Kj,i,2==t?function(e,t){return c.call(e,this,t)}:function(e){return c.call(e,this)})}r&&kb(Kj[i],"sham",!0)},sw=Fa("match"),Lj=function(e){var t;return xa(e)&&(void 0!==(t=e[sw])?!!t:"RegExp"==xc(e))},Wb=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},tw=Fa("species"),ee=function(e,t){var n;return void 0===(e=Ia(e).constructor)||null==(n=Ia(e)[tw])?t:Wb(n)},Do=function(e){return function(t,n){t=String(Eb(t)),n=yc(n);var r,i=t.length;if(0>n||n>=i)return e?"":void 0;var o=t.charCodeAt(n);return 55296>o||56319<o||n+1===i||56320>(r=t.charCodeAt(n+1))||57343<r?e?t.charAt(n):o:e?t.slice(n,n+2):r-56320+(o-55296<<10)+65536}},uw=Do(!1),Eo=Do(!0),Mj=function(e,t,n){return t+(n?Eo(e,t).length:1)},ef=function(e,t){var n=e.exec;if("function"==typeof n){if("object"!=typeof(e=n.call(e,t)))throw TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==xc(e))throw TypeError("RegExp#exec called on incompatible receiver");return hg.call(e,t)},vw=[].push,ww=Math.min;Bh("split",2,(function(e,t,n){var r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(e,n){var r=String(Eb(this));if(0==(n=void 0===n?4294967295:n>>>0))return[];if(void 0===e)return[r];if(!Lj(e))return t.call(r,e,n);var i,o,s,a=[],c=0;for(e=new RegExp(e.source,(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":"")+"g");(i=hg.call(e,r))&&!((o=e.lastIndex)>c&&(a.push(r.slice(c,i.index)),1<i.length&&i.index<r.length&&vw.apply(a,i.slice(1)),s=i[0].length,c=o,a.length>=n));)e.lastIndex===i.index&&e.lastIndex++;return c===r.length?(s||!e.test(""))&&a.push(""):a.push(r.slice(c)),a.length>n?a.slice(0,n):a}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t;return[function(t,n){var i=Eb(this),o=null==t?void 0:t[e];return void 0!==o?o.call(t,i,n):r.call(String(i),t,n)},function(e,i){var o=n(r,e,this,i,r!==t);if(o.done)return o.value;var s=Ia(e);e=String(this);var a=ee(s,RegExp);if(o=s.unicode,s=new a(Rc?"^(?:"+s.source+")":s,(s.ignoreCase?"i":"")+(s.multiline?"m":"")+(s.unicode?"u":"")+(Rc?"g":"y")),0==(i=void 0===i?4294967295:i>>>0))return[];if(0===e.length)return null===ef(s,e)?[e]:[];var c=0,u=0;for(a=[];u<e.length;){s.lastIndex=Rc?0:u;var l,A=ef(s,Rc?e.slice(u):e);if(null===A||(l=ww(Ma(s.lastIndex+(Rc?u:0)),e.length))===c)u=Mj(e,u,o);else{if(a.push(e.slice(c,u)),a.length===i)return a;for(c=1;c<=A.length-1;c++)if(a.push(A[c]),a.length===i)return a;u=c=l}}return a.push(e.slice(c)),a}]}),Rc);var xw=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,yw=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,Nj=function(e){return function(t){return t=String(Eb(t)),1&e&&(t=t.replace(xw,"")),2&e&&(t=t.replace(yw,"")),t}};Nj(1),Nj(2);var Oj=Nj(3),Ch=R.parseInt,zw=/^[+-]?0[Xx]/,Fo=8!==Ch("\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff08")||22!==Ch("\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff0x16")?function(e,t){return e=Oj(String(e)),Ch(e,t>>>0||(zw.test(e)?16:10))}:Ch;ea({global:!0,forced:parseInt!=Fo},{parseInt:Fo});var Dd=function(e,t,n){if(Wb(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}},Ed=Array.isArray||function(e){return"Array"==xc(e)},Aw=Fa("species"),Dh=function(e,t){if(Ed(e)){var n=e.constructor;"function"!=typeof n||n!==Array&&!Ed(n.prototype)?xa(n)&&null===(n=n[Aw])&&(n=void 0):n=void 0}return new(void 0===n?Array:n)(0===t?0:t)},Go=[].push,Fd=function(e){var t=1==e,n=2==e,r=3==e,i=4==e,o=6==e,s=7==e,a=5==e||o;return function(c,u,l,A){var h=pb(c),d=fg(h);u=Dd(u,l,3),l=Ma(d.length);var p,f=0;for(A=A||Dh,c=t?A(c,l):n||s?A(c,0):void 0;l>f;f++)if((a||f in d)&&(p=u(A=d[f],f,h),e))if(t)c[f]=p;else if(p)switch(e){case 3:return!0;case 5:return A;case 6:return f;case 2:Go.call(c,A)}else switch(e){case 4:return!1;case 7:Go.call(c,A)}return o?-1:r||i?i:c}},fe=Fd(0),Ho=Fd(1),Io=Fd(2),Bw=Fd(3),Cw=Fd(4),Jo=Fd(5),Dw=Fd(6);Fd(7);var Ew=Fa("species"),kg=function(e){return 51<=Cd||!la((function(){var t=[];return(t.constructor={})[Ew]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},Fw=kg("filter");ea({target:"Array",proto:!0,forced:!Fw},{filter:function(e){return Io(this,e,1<arguments.length?arguments[1]:void 0)}});var ed=Object.keys||function(e){return ro(e,zh)},Gw=la((function(){ed(1)}));ea({target:"Object",stat:!0,forced:Gw},{keys:function(e){return ed(pb(e))}});var ff=function(e,t){var n=[][e];return!!n&&la((function(){n.call(null,t||function(){throw 1},1)}))},Hw=[].join,Iw=fg!=Object,Jw=ff("join",",");ea({target:"Array",proto:!0,forced:Iw||!Jw},{join:function(e){return Hw.call(Mb(this),void 0===e?",":e)}});var Kw=kg("map");ea({target:"Array",proto:!0,forced:!Kw},{map:function(e){return Ho(this,e,1<arguments.length?arguments[1]:void 0)}});var Pj=function(e){var t=e.return;if(void 0!==t)return Ia(t.call(e)).value},gf={},Lw=Fa("iterator"),Mw=Array.prototype,Qj=function(e){return void 0!==e&&(gf.Array===e||Mw[Lw]===e)},hf=function(e,t,n){(t=Oc(t))in e?qb.f(e,t,Nc(0,n)):e[t]=n},Nw=Fa("toStringTag"),Ko={};Ko[Nw]="z";var Rj="[object z]"===String(Ko),Ow=Fa("toStringTag"),Pw="Arguments"==xc(function(){return arguments}()),jf=Rj?xc:function(e){var t;if(void 0===e)var n="Undefined";else{if(null===e)var r="Null";else{e:{var i=e=Object(e);try{r=i[Ow];break e}catch(e){}r=void 0}r="string"==typeof(n=r)?n:Pw?xc(e):"Object"==(t=xc(e))&&"function"==typeof e.callee?"Arguments":t}n=r}return n},Qw=Fa("iterator"),lg=function(e){if(null!=e)return e[Qw]||e["@@iterator"]||gf[jf(e)]},ge=function(e){var t,n=pb(e),r="function"==typeof this?this:Array,i=arguments.length,o=1<i?arguments[1]:void 0,s=void 0!==o,a=lg(n),c=0;if(s&&(o=Dd(o,2<i?arguments[2]:void 0,2)),null==a||r==Array&&Qj(a)){var u=Ma(n.length);for(r=new r(u);u>c;c++)a=s?o(n[c],c):n[c],hf(r,c,a)}else for(i=(n=a.call(n)).next,r=new r;!(t=i.call(n)).done;c++){if(s){a=n;var l=o;t=[t.value,c];try{u=l(Ia(t)[0],t[1])}catch(e){throw Pj(a),e}}else u=t.value;hf(r,c,a=u)}return r.length=c,r},Lo=Fa("iterator"),Mo=!1;try{var Rw=0,No={next:function(){return{done:!!Rw++}},return:function(){Mo=!0}};No[Lo]=function(){return this},Array.from(No,(function(){throw 2}))}catch(c){}var Eh=function(e,t){if(!t&&!Mo)return!1;var n=!1;try{(t={})[Lo]=function(){return{next:function(){return{done:n=!0}}}},e(t)}catch(e){}return n},Sw=!Eh((function(e){Array.from(e)}));ea({target:"Array",stat:!0,forced:Sw},{from:ge});var Oo=!la((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Po=xh("IE_PROTO"),Tw=Object.prototype,uc=Oo?Object.getPrototypeOf:function(e){return e=pb(e),ka(e,Po)?e[Po]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Tw:null},Sj=Fa("iterator"),Qo=!1,Uw=function(){return this},he;if([].keys){var Ro=[].keys();if("next"in Ro){var So=uc(uc(Ro));So!==Object.prototype&&(he=So)}else Qo=!0}(null==he||la((function(){var e={};return he[Sj].call(e)!==e})))&&(he={}),ka(he,Sj)||kb(he,Sj,Uw);var Fh=he,Gh=Qo,To=wa?Object.defineProperties:function(e,t){Ia(e);for(var n,r=ed(t),i=r.length,o=0;i>o;)qb.f(e,n=r[o++],t[n]);return e},Tj=Pc("document","documentElement"),Uo=xh("IE_PROTO"),Uj=function(){},Vj,Hh=function(){try{Vj=document.domain&&new ActiveXObject("htmlfile")}catch(e){}if(Vj){var e=Vj;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=wh?$e.createElement("iframe"):{}).style.display="none",Tj.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(Hh=e,e=zh.length;e--;)delete Hh.prototype[zh[e]];return Hh()};bf[Uo]=!0;var jc=Object.create||function(e,t){if(null!==e){Uj.prototype=Ia(e);var n=new Uj;Uj.prototype=null,n[Uo]=e}else n=Hh();return void 0===t?n:To(n,t)},Vw=qb.f,Vo=Fa("toStringTag"),zc=function(e,t,n){e&&!ka(e=n?e:e.prototype,Vo)&&Vw(e,Vo,{configurable:!0,value:t})},Ww=function(){return this},Wo=function(e,t,n){return t+=" Iterator",e.prototype=jc(Fh,{next:Nc(1,n)}),zc(e,t,!1),gf[t]=Ww,e},tb=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,t={};try{var n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;n.call(t,[]),e=t instanceof Array}catch(e){}return function(t,r){if(Ia(t),!xa(r)&&null!==r)throw TypeError("Can't set "+String(r)+" as a prototype");return e?n.call(t,r):t.__proto__=r,t}}():void 0),mg=Fa("iterator"),Xw=function(){return this},Wj=function(e,t,n,r,i,o,s){Wo(n,t,r),r=function(e){if(e===i&&h)return h;if(!Gh&&e in l)return l[e];switch(e){case"keys":case"values":case"entries":return function(){return new n(this,e)}}return function(){return new n(this)}};var a,c=t+" Iterator",u=!1,l=e.prototype,A=l[mg]||l["@@iterator"]||i&&l[i],h=!Gh&&A||r(i),d="Array"==t&&l.entries||A;if(d&&(e=uc(d.call(new e)),Fh!==Object.prototype&&e.next&&(uc(e)!==Fh&&(tb?tb(e,Fh):"function"!=typeof e[mg]&&kb(e,mg,Xw)),zc(e,c,!0))),"values"==i&&A&&"values"!==A.name&&(u=!0,h=function(){return A.call(this)}),l[mg]!==h&&kb(l,mg,h),gf[t]=h,i){var p={values:r("values"),keys:o?h:r("keys"),entries:r("entries")};if(s)for(a in p)!Gh&&!u&&a in l||Za(l,a,p[a]);else ea({target:t,proto:!0,forced:Gh||u},p)}return p},Yw=cb.set,Zw=cb.getterFor("String Iterator");Wj(String,"String",(function(e){Yw(this,{type:"String Iterator",string:String(e),index:0})}),(function(){var e=Zw(this),t=e.string,n=e.index;return n>=t.length?{value:void 0,done:!0}:(t=Eo(t,n),e.index+=t.length,{value:t,done:!1})}));var Xj=Fa("unscopables"),Yj=Array.prototype;null==Yj[Xj]&&qb.f(Yj,Xj,{configurable:!0,value:jc(null)});var ng=function(e){Yj[Xj][e]=!0},Xo=!0;"find"in[]&&Array(1).find((function(){Xo=!1})),ea({target:"Array",proto:!0,forced:Xo},{find:function(e){return Jo(this,e,1<arguments.length?arguments[1]:void 0)}}),ng("find");var Yo=function(e){var t=String(Eb(this)),n="";if(0>(e=yc(e))||1/0==e)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(t+=t))1&e&&(n+=t);return n};ea({target:"String",proto:!0},{repeat:Yo});var Zo=[].indexOf,$o=!!Zo&&0>1/[1].indexOf(1,-0),$w=ff("indexOf");ea({target:"Array",proto:!0,forced:$o||!$w},{indexOf:function(e){return $o?Zo.apply(this,arguments)||0:Fj(this,e,1<arguments.length?arguments[1]:void 0)}});var Zt=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,$t=/CrOS/,au=/android|ipad|playbook|silk/i;Ce.isMobile=Ce,Ce.default=Ce,ea({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),ea({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),R.Number.isNaN;var ax=Rj?{}.toString:function(){return"[object "+jf(this)+"]"};Rj||Za(Object.prototype,"toString",ax,{unsafe:!0});var Ih=R.Promise,kf=function(e,t,n){for(var r in t)Za(e,r,t[r],n);return e},ap=Fa("species"),og=function(e){e=Pc(e);var t=qb.f;wa&&e&&!e[ap]&&t(e,ap,{configurable:!0,get:function(){return this}})},Ac=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e},pg=function(e,t){this.stopped=e,this.result=t},Jh=function(e,t,n){var r,i=!(!n||!n.AS_ENTRIES),o=!(!n||!n.IS_ITERATOR),s=!(!n||!n.INTERRUPTED),a=Dd(t,n&&n.that,1+i+s),c=function(e){return u&&Pj(u),new pg(!0,e)};if(t=function(e){return i?(Ia(e),s?a(e[0],e[1],c):a(e[0],e[1])):s?a(e,c):a(e)},o)var u=e;else{if("function"!=typeof(o=lg(e)))throw TypeError("Target is not iterable");if(Qj(o)){for(o=0,n=Ma(e.length);n>o;o++)if((r=t(e[o]))&&r instanceof pg)return r;return new pg(!1)}u=o.call(e)}for(e=u.next;!(o=e.call(u)).done;){try{r=t(o.value)}catch(e){throw Pj(u),e}if("object"==typeof r&&r&&r instanceof pg)return r}return new pg(!1)},bp=/(?:iphone|ipod|ipad).*applewebkit/i.test(df),fd="process"==xc(R.process),Kh=R.location,Zj=R.setImmediate,cp=R.clearImmediate,bx=R.process,dp=R.MessageChannel,ak=R.Dispatch,bk=0,qg={},ck=function(e){if(qg.hasOwnProperty(e)){var t=qg[e];delete qg[e],t()}},dk=function(e){return function(){ck(e)}},ep=function(e){ck(e.data)},fp=function(e){R.postMessage(e+"",Kh.protocol+"//"+Kh.host)};if(!Zj||!cp)if(Zj=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return qg[++bk]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},rg(bk),bk},cp=function(e){delete qg[e]},fd)var rg=function(e){bx.nextTick(dk(e))};else if(ak&&ak.now)rg=function(e){ak.now(dk(e))};else if(dp&&!bp){var gp=new dp,hp=gp.port2;gp.port1.onmessage=ep,rg=Dd(hp.postMessage,hp,1)}else R.addEventListener&&"function"==typeof postMessage&&!R.importScripts&&Kh&&"file:"!==Kh.protocol&&!la(fp)?(rg=fp,R.addEventListener("message",ep,!1)):rg="onreadystatechange"in(wh?$e.createElement("script"):{})?function(e){Tj.appendChild(wh?$e.createElement("script"):{}).onreadystatechange=function(){Tj.removeChild(this),ck(e)}}:function(e){setTimeout(dk(e),0)};var ek=Zj,cx=/web0s(?!.*chrome)/i.test(df),dx=dc.f,ip=R.MutationObserver||R.WebKitMutationObserver,jp=R.document,kp=R.process,Lh=R.Promise,lp=dx(R,"queueMicrotask"),mp=lp&&lp.value,ie,sg;if(!mp){var Nh=function(){var e;for(fd&&(e=kp.domain)&&e.exit();ie;){var t=ie.fn;ie=ie.next;try{t()}catch(e){throw ie?Mh():sg=void 0,e}}sg=void 0,e&&e.enter()};if(bp||fd||cx||!ip||!jp)if(Lh&&Lh.resolve){var fk=Lh.resolve(void 0);fk.constructor=Lh;var ex=fk.then,Mh=function(){ex.call(fk,Nh)}}else Mh=fd?function(){kp.nextTick(Nh)}:function(){ek.call(R,Nh)};else{var np=!0,op=jp.createTextNode("");new ip(Nh).observe(op,{characterData:!0}),Mh=function(){op.data=np=!np}}}var pp=mp||function(e){e={fn:e,next:void 0},sg&&(sg.next=e),ie||(ie=e,Mh()),sg=e},fx=function(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=Wb(t),this.reject=Wb(n)},gk={f:function(e){return new fx(e)}},gx=function(e,t){var n=R.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))},hk=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},hx="object"==typeof window,ix=Fa("species"),qp=cb.get,jx=cb.set,kx=cb.getterFor("Promise"),je=Ih&&Ih.prototype,Xb=Ih,Oh=je,rp=R.TypeError,ik=R.document,jk=R.process,lf=gk.f,lx=lf,mx=!!(ik&&ik.createEvent&&R.dispatchEvent),sp="function"==typeof PromiseRejectionEvent,tp=!1,tg=Qc("Promise",(function(){var e=Cj(Xb)!==String(Xb);if(!e&&66===Cd)return!0;if(51<=Cd&&/native code/.test(Xb))return!1;var t=new Xb((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(t.constructor={})[ix]=n,!(tp=t.then((function(){}))instanceof n)||!e&&hx&&!sp})),nx=tg||!Eh((function(e){Xb.all(e).catch((function(){}))})),up=function(e){var t;return!(!xa(e)||"function"!=typeof(t=e.then))&&t},kk=function(e,t){if(!e.notified){e.notified=!0;var n=e.reactions;pp((function(){for(var r=e.value,i=1==e.state,o=0;n.length>o;){var s,a=n[o++],c=i?a.ok:a.fail,u=a.resolve,l=a.reject,A=a.domain;try{if(c){if(i||(2===e.rejection&&ox(e),e.rejection=1),!0===c)var h=r;else if(A&&A.enter(),h=c(r),A){A.exit();var d=!0}h===a.promise?l(rp("Promise-chain cycle")):(s=up(h))?s.call(h,u,l):u(h)}else l(r)}catch(e){A&&!d&&A.exit(),l(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&px(e)}))}},vp=function(e,t,n){var r;if(mx){var i=ik.createEvent("Event");i.promise=t,i.reason=n,i.initEvent(e,!1,!0),R.dispatchEvent(i)}else i={promise:t,reason:n};!sp&&(r=R["on"+e])?r(i):"unhandledrejection"===e&&gx("Unhandled promise rejection",n)},px=function(e){ek.call(R,(function(){var t=e.facade,n=e.value;if(1!==e.rejection&&!e.parent){var r=hk((function(){fd?jk.emit("unhandledRejection",n,t):vp("unhandledrejection",t,n)}));if(e.rejection=fd||1!==e.rejection&&!e.parent?2:1,r.error)throw r.value}}))},ox=function(e){ek.call(R,(function(){var t=e.facade;fd?jk.emit("rejectionHandled",t):vp("rejectionhandled",t,e.value)}))},mf=function(e,t,n){return function(r){e(t,r,n)}},nf=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,kk(e,!0))},lk=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw rp("Promise can't be resolved itself");var r=up(t);r?pp((function(){var n={done:!1};try{r.call(t,mf(lk,n,e),mf(nf,n,e))}catch(t){nf(n,t,e)}})):(e.value=t,e.state=1,kk(e,!1))}catch(t){nf({done:!1},t,e)}}};if(tg){Xb=function(e){Ac(this,Xb,"Promise"),Wb(e),mk.call(this);var t=qp(this);try{e(mf(lk,t),mf(nf,t))}catch(e){nf(t,e)}},Oh=Xb.prototype;var mk=function(e){jx(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};mk.prototype=kf(Oh,{then:function(e,t){var n=kx(this),r=lf(ee(this,Xb));return r.ok="function"!=typeof e||e,r.fail="function"==typeof t&&t,r.domain=fd?jk.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&kk(n,!1),r.promise},catch:function(e){return this.then(void 0,e)}});var qx=function(){var e=new mk,t=qp(e);this.promise=e,this.resolve=mf(lk,t),this.reject=mf(nf,t)};if(gk.f=lf=function(e){return e===Xb||e===rx?new qx(e):lx(e)},"function"==typeof Ih&&je!==Object.prototype){var sx=je.then;tp||(Za(je,"then",(function(e,t){var n=this;return new Xb((function(e,t){sx.call(n,e,t)})).then(e,t)}),{unsafe:!0}),Za(je,"catch",Oh.catch,{unsafe:!0}));try{delete je.constructor}catch(c){}tb&&tb(je,Oh)}}ea({global:!0,wrap:!0,forced:tg},{Promise:Xb}),zc(Xb,"Promise",!1),og("Promise");var rx=Pc("Promise");ea({target:"Promise",stat:!0,forced:tg},{reject:function(e){var t=lf(this);return t.reject.call(void 0,e),t.promise}}),ea({target:"Promise",stat:!0,forced:tg},{resolve:function(e){if(Ia(this),!xa(e)||e.constructor!==this){var t=gk.f(this);(0,t.resolve)(e),e=t.promise}return e}}),ea({target:"Promise",stat:!0,forced:nx},{all:function(e){var t=this,n=lf(t),r=n.resolve,i=n.reject,o=hk((function(){var n=Wb(t.resolve),o=[],s=0,a=1;Jh(e,(function(e){var c=s++,u=!1;o.push(void 0),a++,n.call(t,e).then((function(e){u||(u=!0,o[c]=e,--a||r(o))}),i)})),--a||r(o)}));return o.error&&i(o.value),n.promise},race:function(e){var t=this,n=lf(t),r=n.reject,i=hk((function(){var i=Wb(t.resolve);Jh(e,(function(e){i.call(t,e).then(n.resolve,r)}))}));return i.error&&r(i.value),n.promise}});var tx=Math.floor,ux="".replace,vx=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,wx=/\$([$&'`]|\d{1,2})/g,xx=function(e,t,n,r,i,o){var s=n+e.length,a=r.length,c=wx;return void 0!==i&&(i=pb(i),c=vx),ux.call(o,c,(function(o,c){switch(c.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,n);case"'":return t.slice(s);case"<":o=i[c.slice(1,-1)];break;default:var u=+c;if(0===u)return o;if(u>a)return 0===(u=tx(u/10))?o:u<=a?void 0===r[u-1]?c.charAt(1):r[u-1]+c.charAt(1):o;o=r[u-1]}return void 0===o?"":o}))},yx=Math.max,zx=Math.min;Bh("replace",2,(function(e,t,n,r){var i=r.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,o=r.REPLACE_KEEPS_$0,s=i?"$":"$0";return[function(n,r){var i=Eb(this),o=null==n?void 0:n[e];return void 0!==o?o.call(n,i,r):t.call(String(i),n,r)},function(e,r){if(!i&&o||"string"==typeof r&&-1===r.indexOf(s)){var a=n(t,e,this,r);if(a.done)return a.value}var c=Ia(e);e=String(this),(a="function"==typeof r)||(r=String(r));var u=c.global;if(u){var l=c.unicode;c.lastIndex=0}for(var A=[];;){var h=ef(c,e);if(null===h)break;if(A.push(h),!u)break;""===String(h[0])&&(c.lastIndex=Mj(e,Ma(c.lastIndex),l))}for(l="",u=c=0;u<A.length;u++){h=A[u];for(var d=String(h[0]),p=yx(zx(yc(h.index),e.length),0),f=[],g=1;g<h.length;g++){var m=f,v=h[g];m.push.call(m,void 0===v?v:String(v))}h=h.groups,a?(f=[d].concat(f,p,e),void 0!==h&&f.push(h),h=String(r.apply(void 0,f))):h=xx(d,e,p,f,h,r),p>=c&&(l+=e.slice(c,p)+h,c=p+d.length)}return l+e.slice(c)}]}));var Ax=kg("slice"),Bx=Fa("species"),Cx=[].slice,Dx=Math.max;ea({target:"Array",proto:!0,forced:!Ax},{slice:function(e,t){var n=Mb(this),r=Ma(n.length);if(e=Vb(e,r),t=Vb(void 0===t?r:t,r),Ed(n)){var i=n.constructor;if("function"!=typeof i||i!==Array&&!Ed(i.prototype)?xa(i)&&null===(i=i[Bx])&&(i=void 0):i=void 0,i===Array||void 0===i)return Cx.call(n,e,t)}for(i=new(void 0===i?Array:i)(Dx(t-e,0)),r=0;e<t;e++,r++)e in n&&hf(i,r,n[e]);return i.length=r,i}});var Ex=cb.set,Fx=cb.getterFor("Array Iterator"),Gd=Wj(Array,"Array",(function(e,t){Ex(this,{type:"Array Iterator",target:Mb(e),index:0,kind:t})}),(function(){var e=Fx(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");gf.Arguments=gf.Array,ng("keys"),ng("values"),ng("entries");var wp="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,of=function(e){if(void 0===e)return 0;e=yc(e);var t=Ma(e);if(e!==t)throw RangeError("Wrong length or index");return t},Gx=Math.abs,gd=Math.pow,Hx=Math.floor,Ix=Math.log,Jx=Math.LN2,xp=function(e){var t=pb(this),n=Ma(t.length),r=arguments.length,i=Vb(1<r?arguments[1]:void 0,n);for(n=void 0===(r=2<r?arguments[2]:void 0)?n:Vb(r,n);n>i;)t[i++]=e;return t},Kx=de.f,Lx=qb.f,pf=cb.get,yp=cb.set,Bc=R.ArrayBuffer,Yb=Bc,Cc=R.DataView,Ph=Cc&&Cc.prototype,zp=Object.prototype,Qh=R.RangeError,Ap=function(e,t,n){var r,i=Array(n),o=(1<<(n=8*n-t-1))-1,s=o>>1,a=23===t?gd(2,-24)-gd(2,-77):0,c=0>e||0===e&&0>1/e?1:0,u=0;if((e=Gx(e))!=e||1/0===e){e=e!=e?1:0;var l=o}else l=Hx(Ix(e)/Jx),1>e*(r=gd(2,-l))&&(l--,r*=2),2<=(e=1<=l+s?e+a/r:e+a*gd(2,1-s))*r&&(l++,r/=2),l+s>=o?(e=0,l=o):1<=l+s?(e=(e*r-1)*gd(2,t),l+=s):(e=e*gd(2,s-1)*gd(2,t),l=0);for(;8<=t;i[u++]=255&e,e/=256,t-=8);for(l=l<<t|e,n+=t;0<n;i[u++]=255&l,l/=256,n-=8);return i[--u]|=128*c,i},Bp=function(e,t){var n=e.length,r=8*n-t-1,i=(1<<r)-1,o=i>>1;r-=7,--n;var s=e[n--],a=127&s;for(s>>=7;0<r;a=256*a+e[n],n--,r-=8);var c=a&(1<<-r)-1;for(a>>=-r,r+=t;0<r;c=256*c+e[n],n--,r-=8);if(0===a)a=1-o;else{if(a===i)return c?NaN:s?-1/0:1/0;c+=gd(2,t),a-=o}return(s?-1:1)*c*gd(2,a-t)},Cp=function(e){return[255&e]},Dp=function(e){return[255&e,e>>8&255]},Ep=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Fp=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Mx=function(e){return Ap(e,23,4)},Nx=function(e){return Ap(e,52,8)},Rh=function(e,t){Lx(e.prototype,t,{get:function(){return pf(this)[t]}})},Hd=function(e,t,n,r){n=of(n);var i=pf(e);if(n+t>i.byteLength)throw Qh("Wrong index");return e=pf(i.buffer).bytes,n+=i.byteOffset,t=e.slice(n,n+t),r?t:t.reverse()},Id=function(e,t,n,r,i,o){n=of(n);var s=pf(e);if(n+t>s.byteLength)throw Qh("Wrong index");for(e=pf(s.buffer).bytes,n+=s.byteOffset,r=r(+i),i=0;i<t;i++)e[n+i]=r[o?i:t-i-1]};if(wp){if(!la((function(){Bc(1)}))||!la((function(){new Bc(-1)}))||la((function(){return new Bc,new Bc(1.5),new Bc(NaN),"ArrayBuffer"!=Bc.name}))){Yb=function(e){return Ac(this,Yb),new Bc(of(e))};for(var Ox=Yb.prototype=Bc.prototype,Gp=Kx(Bc),Hp=0,nk;Gp.length>Hp;)(nk=Gp[Hp++])in Yb||kb(Yb,nk,Bc[nk]);Ox.constructor=Yb}tb&&uc(Ph)!==zp&&tb(Ph,zp);var Sh=new Cc(new Yb(2)),Ip=Ph.setInt8;Sh.setInt8(0,2147483648),Sh.setInt8(1,2147483649),!Sh.getInt8(0)&&Sh.getInt8(1)||kf(Ph,{setInt8:function(e,t){Ip.call(this,e,t<<24>>24)},setUint8:function(e,t){Ip.call(this,e,t<<24>>24)}},{unsafe:!0})}else Yb=function(e){Ac(this,Yb,"ArrayBuffer"),e=of(e),yp(this,{bytes:xp.call(Array(e),0),byteLength:e}),wa||(this.byteLength=e)},Cc=function(e,t,n){Ac(this,Cc,"DataView"),Ac(e,Yb,"DataView");var r=pf(e).byteLength;if(0>(t=yc(t))||t>r)throw Qh("Wrong offset");if(t+(n=void 0===n?r-t:Ma(n))>r)throw Qh("Wrong length");yp(this,{buffer:e,byteLength:n,byteOffset:t}),wa||(this.buffer=e,this.byteLength=n,this.byteOffset=t)},wa&&(Rh(Yb,"byteLength"),Rh(Cc,"buffer"),Rh(Cc,"byteLength"),Rh(Cc,"byteOffset")),kf(Cc.prototype,{getInt8:function(e){return Hd(this,1,e)[0]<<24>>24},getUint8:function(e){return Hd(this,1,e)[0]},getInt16:function(e){var t=Hd(this,2,e,1<arguments.length?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Hd(this,2,e,1<arguments.length?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Fp(Hd(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return Fp(Hd(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return Bp(Hd(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return Bp(Hd(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,t){Id(this,1,e,Cp,t)},setUint8:function(e,t){Id(this,1,e,Cp,t)},setInt16:function(e,t){Id(this,2,e,Dp,t,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,t){Id(this,2,e,Dp,t,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,t){Id(this,4,e,Ep,t,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,t){Id(this,4,e,Ep,t,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,t){Id(this,4,e,Mx,t,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,t){Id(this,8,e,Nx,t,2<arguments.length?arguments[2]:void 0)}});zc(Yb,"ArrayBuffer"),zc(Cc,"DataView");var ug={ArrayBuffer:Yb,DataView:Cc},ok=ug.ArrayBuffer,Jp=ug.DataView,Kp=ok.prototype.slice,Px=la((function(){return!new ok(2).slice(1,void 0).byteLength}));ea({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:Px},{slice:function(e,t){if(void 0!==Kp&&void 0===t)return Kp.call(Ia(this),e);var n=Ia(this).byteLength;e=Vb(e,n),t=Vb(void 0===t?n:t,n),n=new(ee(this,ok))(Ma(t-e));for(var r=new Jp(this),i=new Jp(n),o=0;e<t;)i.setUint8(o++,r.getUint8(e++));return n}});var Qx=qb.f,Th=R.Int8Array,pk=Th&&Th.prototype,Lp=R.Uint8ClampedArray,Mp=Lp&&Lp.prototype,Tc=Th&&uc(Th),Dc=pk&&uc(pk),Np=Object.prototype,Op=Np.isPrototypeOf,Pp=Fa("toStringTag"),qk=af("TYPED_ARRAY_TAG"),hd=wp&&!!tb&&"Opera"!==jf(R.opera),Qp=!1,Zb,Uc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Rx={BigInt64Array:8,BigUint64Array:8},Uh=function(e){return!!xa(e)&&(e=jf(e),ka(Uc,e)||ka(Rx,e))};for(Zb in Uc)R[Zb]||(hd=!1);if((!hd||"function"!=typeof Tc||Tc===Function.prototype)&&(Tc=function(){throw TypeError("Incorrect invocation")},hd))for(Zb in Uc)R[Zb]&&tb(R[Zb],Tc);if((!hd||!Dc||Dc===Np)&&(Dc=Tc.prototype,hd))for(Zb in Uc)R[Zb]&&tb(R[Zb].prototype,Dc);if(hd&&uc(Mp)!==Dc&&tb(Mp,Dc),wa&&!ka(Dc,Pp))for(Zb in Qp=!0,Qx(Dc,Pp,{get:function(){return xa(this)?this[qk]:void 0}}),Uc)R[Zb]&&kb(R[Zb],qk,Zb);var vg=hd,Rp=Qp&&qk,Ua=function(e){if(Uh(e))return e;throw TypeError("Target is not a typed array")},qf=function(e){if(tb){if(Op.call(Tc,e))return e}else for(var t in Uc)if(ka(Uc,Zb)){var n=R[t];if(n&&(e===n||Op.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},Ra=function(e,t,n){if(wa){if(n)for(var r in Uc){var i=R[r];if(i&&ka(i.prototype,e))try{delete i.prototype[e]}catch(e){}}Dc[e]&&!n||Za(Dc,e,n?t:hd&&pk[e]||t)}},Sp=function(e,t,n){var r,i;if(wa){if(tb){if(n)for(r in Uc)if((i=R[r])&&ka(i,e))try{delete i[e]}catch(e){}if(Tc[e]&&!n)return;try{return Za(Tc,e,n?t:hd&&Tc[e]||t)}catch(e){}}for(r in Uc)!(i=R[r])||i[e]&&!n||Za(i,e,t)}},Tp=Tc,wg=Dc,Sx=R.ArrayBuffer,ke=R.Int8Array,rk=!vg||!la((function(){ke(1)}))||!la((function(){new ke(-1)}))||!Eh((function(e){new ke,new ke(null),new ke(1.5),new ke(e)}),!0)||la((function(){return 1!==new ke(new Sx(2),1,void 0).length})),Vh=function(e,t){if(0>(e=yc(e)))throw RangeError("The argument can't be less than 0");if(e%t)throw RangeError("Wrong offset");return e},sk=function(e){var t=pb(e),n=arguments.length,r=1<n?arguments[1]:void 0,i=void 0!==r,o=lg(t);if(null!=o&&!Qj(o)){var s=o.call(t),a=s.next;for(t=[];!(o=a.call(s)).done;)t.push(o.value)}for(i&&2<n&&(r=Dd(r,arguments[2],2)),o=Ma(t.length),s=new(qf(this))(o),n=0;o>n;n++)s[n]=i?r(t[n],n):t[n];return s},Wh=function(e,t,n){var r,i;return tb&&"function"==typeof(r=t.constructor)&&r!==n&&xa(i=r.prototype)&&i!==n.prototype&&tb(e,i),e},xg=xb((function(e){var t=de.f,n=cb.get,r=cb.set,i=qb.f,o=dc.f,s=Math.round,a=R.RangeError,c=ug.ArrayBuffer,u=ug.DataView,l=function(e,t){var n=0,r=t.length;for(e=new(qf(e))(r);r>n;)e[n]=t[n++];return e},A=function(e,t){i(e,t,{get:function(){return n(this)[t]}})},h=function(e){var t;return e instanceof c||"ArrayBuffer"==(t=jf(e))||"SharedArrayBuffer"==t},d=function(e,t){return Uh(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},p=function(e,t){return d(e,t=Oc(t,!0))?Nc(2,e[t]):o(e,t)},f=function(e,t,n){return!(d(e,t=Oc(t,!0))&&xa(n)&&ka(n,"value"))||ka(n,"get")||ka(n,"set")||n.configurable||ka(n,"writable")&&!n.writable||ka(n,"enumerable")&&!n.enumerable?i(e,t,n):(e[t]=n.value,e)};wa?(vg||(dc.f=p,qb.f=f,A(wg,"buffer"),A(wg,"byteOffset"),A(wg,"byteLength"),A(wg,"length")),ea({target:"Object",stat:!0,forced:!vg},{getOwnPropertyDescriptor:p,defineProperty:f}),e.exports=function(e,o,A){var d=e.match(/\d+$/)[0]/8,p=e+(A?"Clamped":"")+"Array",f="get"+e,g="set"+e,m=R[p],v=m;e=v&&v.prototype;var y={},_=function(e,t){i(e,t,{get:function(){var e=n(this);return e.view[f](t*d+e.byteOffset,!0)},set:function(e){var r=n(this);A&&(e=0>(e=s(e))?0:255<e?255:255&e),r.view[g](t*d+r.byteOffset,e,!0)},enumerable:!0})};vg?rk&&(v=o((function(e,t,n,r){return Ac(e,v,p),Wh(xa(t)?h(t)?void 0!==r?new m(t,Vh(n,d),r):void 0!==n?new m(t,Vh(n,d)):new m(t):Uh(t)?l(v,t):sk.call(v,t):new m(of(t)),e,v)})),tb&&tb(v,Tp),fe(t(m),(function(e){e in v||kb(v,e,m[e])})),v.prototype=e):(v=o((function(e,t,n,i){Ac(e,v,p);var o=0,s=0;if(xa(t)){if(!h(t))return Uh(t)?l(v,t):sk.call(v,t);var A=t;if(s=Vh(n,d),t=t.byteLength,void 0===i){if(t%d)throw a("Wrong length");if(0>(i=t-s))throw a("Wrong length")}else if((i=Ma(i)*d)+s>t)throw a("Wrong length");t=i/d}else t=of(t),A=new c(i=t*d);for(r(e,{buffer:A,byteOffset:s,byteLength:i,length:t,view:new u(A)});o<t;)_(e,o++)})),tb&&tb(v,Tp),e=v.prototype=jc(wg)),e.constructor!==v&&kb(e,"constructor",v),Rp&&kb(e,Rp,p),y[p]=v,ea({global:!0,forced:v!=m,sham:!vg},y),"BYTES_PER_ELEMENT"in v||kb(v,"BYTES_PER_ELEMENT",d),"BYTES_PER_ELEMENT"in e||kb(e,"BYTES_PER_ELEMENT",d),og(p)}):e.exports=function(){}}));xg("Uint8",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var Tx=Math.min,Ux=[].copyWithin||function(e,t){var n=pb(this),r=Ma(n.length),i=Vb(e,r),o=Vb(t,r),s=2<arguments.length?arguments[2]:void 0;for(r=Tx((void 0===s?r:Vb(s,r))-o,r-i),s=1,o<i&&i<o+r&&(s=-1,o+=r-1,i+=r-1);0<r--;)o in n?n[i]=n[o]:delete n[i],i+=s,o+=s;return n};Ra("copyWithin",(function(e,t){return Ux.call(Ua(this),e,t,2<arguments.length?arguments[2]:void 0)})),Ra("every",(function(e){return Cw(Ua(this),e,1<arguments.length?arguments[1]:void 0)})),Ra("fill",(function(e){return xp.apply(Ua(this),arguments)})),Ra("filter",(function(e){var t=Io(Ua(this),e,1<arguments.length?arguments[1]:void 0),n=ee(this,this.constructor),r=0,i=t.length;for(n=new(qf(n))(i);i>r;)n[r]=t[r++];return n})),Ra("find",(function(e){return Jo(Ua(this),e,1<arguments.length?arguments[1]:void 0)})),Ra("findIndex",(function(e){return Dw(Ua(this),e,1<arguments.length?arguments[1]:void 0)})),Ra("forEach",(function(e){fe(Ua(this),e,1<arguments.length?arguments[1]:void 0)})),Ra("includes",(function(e){return qo(Ua(this),e,1<arguments.length?arguments[1]:void 0)})),Ra("indexOf",(function(e){return Fj(Ua(this),e,1<arguments.length?arguments[1]:void 0)}));var Up=Fa("iterator"),Vp=R.Uint8Array,Vx=Gd.values,Wx=Gd.keys,Xx=Gd.entries,tk=Vp&&Vp.prototype[Up],Wp=!!tk&&("values"==tk.name||null==tk.name),Xp=function(){return Vx.call(Ua(this))};Ra("entries",(function(){return Xx.call(Ua(this))})),Ra("keys",(function(){return Wx.call(Ua(this))})),Ra("values",Xp,!Wp),Ra(Up,Xp,!Wp);var Yx=[].join;Ra("join",(function(e){return Yx.apply(Ua(this),arguments)}));var Zx=Math.min,uk=[].lastIndexOf,Yp=!!uk&&0>1/[1].lastIndexOf(1,-0),$x=ff("lastIndexOf"),ay=Yp||!$x?function(e){if(Yp)return uk.apply(this,arguments)||0;var t=Mb(this),n=Ma(t.length),r=n-1;for(1<arguments.length&&(r=Zx(r,yc(arguments[1]))),0>r&&(r=n+r);0<=r;r--)if(r in t&&t[r]===e)return r||0;return-1}:uk;Ra("lastIndexOf",(function(e){return ay.apply(Ua(this),arguments)})),Ra("map",(function(e){return Ho(Ua(this),e,1<arguments.length?arguments[1]:void 0,(function(e,t){return new(qf(ee(e,e.constructor)))(t)}))}));var Zp=function(e){return function(t,n,r,i){Wb(n),t=pb(t);var o=fg(t),s=Ma(t.length),a=e?s-1:0,c=e?-1:1;if(2>r)for(;;){if(a in o){i=o[a],a+=c;break}if(a+=c,e?0>a:s<=a)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=a:s>a;a+=c)a in o&&(i=n(i,o[a],a,t));return i}},$p=Zp(!1),by=Zp(!0);Ra("reduce",(function(e){return $p(Ua(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)})),Ra("reduceRight",(function(e){return by(Ua(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}));var cy=Math.floor;Ra("reverse",(function(){for(var e,t=Ua(this).length,n=cy(t/2),r=0;r<n;)e=this[r],this[r++]=this[--t],this[t]=e;return this}));var dy=la((function(){new Int8Array(1).set({})}));Ra("set",(function(e){Ua(this);var t=Vh(1<arguments.length?arguments[1]:void 0,1),n=this.length,r=pb(e),i=Ma(r.length),o=0;if(i+t>n)throw RangeError("Wrong length");for(;o<i;)this[t+o]=r[o++]}),dy);var ey=[].slice,fy=la((function(){new Int8Array(1).slice()}));Ra("slice",(function(e,t){e=ey.call(Ua(this),e,t);var n=ee(this,this.constructor);t=0;var r=e.length;for(n=new(qf(n))(r);r>t;)n[t]=e[t++];return n}),fy),Ra("some",(function(e){return Bw(Ua(this),e,1<arguments.length?arguments[1]:void 0)}));var gy=[].sort;Ra("sort",(function(e){return gy.call(Ua(this),e)})),Ra("subarray",(function(e,t){var n=Ua(this),r=n.length;return e=Vb(e,r),new(ee(n,n.constructor))(n.buffer,n.byteOffset+e*n.BYTES_PER_ELEMENT,Ma((void 0===t?r:Vb(t,r))-e))}));var Xh=R.Int8Array,aq=[].toLocaleString,hy=[].slice,iy=!!Xh&&la((function(){aq.call(new Xh(1))})),jy=la((function(){return[1,2].toLocaleString()!=new Xh([1,2]).toLocaleString()}))||!la((function(){Xh.prototype.toLocaleString.call([1,2])}));Ra("toLocaleString",(function(){return aq.apply(iy?hy.call(Ua(this)):Ua(this),arguments)}),jy);var bq=R.Uint8Array,ky=bq&&bq.prototype||{},Yh=[].toString,ly=[].join;la((function(){Yh.call({})}))&&(Yh=function(){return ly.call(this)}),Ra("toString",Yh,ky.toString!=Yh);var cq=ug.ArrayBuffer;ea({global:!0,forced:R.ArrayBuffer!==cq},{ArrayBuffer:cq}),og("ArrayBuffer");var my=qb.f,vk=Function.prototype,ny=vk.toString,oy=/^\s*function ([^ (]*)/;!wa||"name"in vk||my(vk,"name",{configurable:!0,get:function(){try{return ny.call(this).match(oy)[1]}catch(e){return""}}});var dq=RegExp.prototype,eq=dq.toString,py=la((function(){return"/a/b"!=eq.call({source:"a",flags:"b"})})),qy="toString"!=eq.name;(py||qy)&&Za(RegExp.prototype,"toString",(function(){var e=Ia(this),t=String(e.source),n=e.flags;return"/"+t+"/"+String(void 0===n&&e instanceof RegExp&&!("flags"in dq)?Gj.call(e):n)}),{unsafe:!0});var ry=kg("splice"),sy=Math.max,ty=Math.min;ea({target:"Array",proto:!0,forced:!ry},{splice:function(e,t){var n,r,i=pb(this),o=Ma(i.length),s=Vb(e,o),a=arguments.length;if(0===a?a=n=0:1===a?(a=0,n=o-s):(a-=2,n=ty(sy(yc(t),0),o-s)),9007199254740991<o+a-n)throw TypeError("Maximum allowed length exceeded");var c=Dh(i,n);for(r=0;r<n;r++){var u=s+r;u in i&&hf(c,r,i[u])}if(c.length=n,a<n){for(r=s;r<o-n;r++){var l=r+a;(u=r+n)in i?i[l]=i[u]:delete i[l]}for(r=o;r>o-n+a;r--)delete i[r-1]}else if(a>n)for(r=o-n;r>s;r--)l=r+a-1,(u=r+n-1)in i?i[l]=i[u]:delete i[l];for(r=0;r<a;r++)i[r+s]=arguments[r+2];return i.length=o-n+a,c}});var wk={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xk=Fa("iterator"),fq=Fa("toStringTag"),yk=Gd.values,Zh;for(Zh in wk){var gq=R[Zh],id=gq&&gq.prototype;if(id){if(id[xk]!==yk)try{kb(id,xk,yk)}catch(c){id[xk]=yk}if(id[fq]||kb(id,fq,Zh),wk[Zh])for(var rf in Gd)if(id[rf]!==Gd[rf])try{kb(id,rf,Gd[rf])}catch(c){id[rf]=Gd[rf]}}}var hq=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t};Bh("search",1,(function(e,t,n){return[function(t){var n=Eb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;e=Ia(e);var i=String(this);return r=e.lastIndex,hq(r,0)||(e.lastIndex=0),i=ef(e,i),hq(e.lastIndex,r)||(e.lastIndex=r),null===i?-1:i.index}]})),xb((function(e){var t,n;t="undefined"!=typeof self?self:Ya,n=function(e){function t(e){return btoa(e).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(e){return e=(e+="===").slice(0,-e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))}function r(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}function i(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),String.fromCharCode.apply(String,e)}function o(e){var t={name:(e.name||e||"").toUpperCase().replace("V","v")};switch(t.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":e.length&&(t.length=e.length);break;case"HMAC":e.hash&&(t.hash=o(e.hash)),e.length&&(t.length=e.length);break;case"RSAES-PKCS1-v1_5":e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":e.hash&&(t.hash=o(e.hash)),e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return t}function s(e){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[e.name][(e.hash||{}).name||e.length||""]}function a(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&(e=JSON.parse(decodeURIComponent(escape(i(e)))));var t={kty:e.kty,alg:e.alg,ext:e.ext||e.extractable};switch(t.kty){case"oct":t.k=e.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach((function(n){n in e&&(t[n]=e[n])}));break;default:throw new TypeError("Unsupported key type")}return t}function c(e){return e=a(e),_&&(e.extractable=e.ext,delete e.ext),r(unescape(encodeURIComponent(JSON.stringify(e)))).buffer}function u(e){var n=l(e),r=!1;if("1.2.840.113549.1.1.1"!==(2<n.length&&(r=!0,n.shift()),e={ext:!0},n[0][0]))throw new TypeError("Unsupported key type");var o="n e d p q dp dq qi".split(" ");for(n=l(n[1]),r&&n.shift(),r=0;r<n.length;r++)n[r][0]||(n[r]=n[r].subarray(1)),e[o[r]]=t(i(n[r]));return e.kty="RSA",e}function l(e,t){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t||(t={pos:0,end:e.length}),2>t.end-t.pos||t.end>e.length)throw new RangeError("Malformed DER");var n=e[t.pos++],r=e[t.pos++];if(128<=r){if(r&=127,t.end-t.pos<r)throw new RangeError("Malformed DER");for(var o=0;r--;)o<<=8,o|=e[t.pos++];r=o}if(t.end-t.pos<r)throw new RangeError("Malformed DER");switch(n){case 2:n=e.subarray(t.pos,t.pos+=r);break;case 3:if(e[t.pos++])throw Error("Unsupported bit string");r--;case 4:n=new Uint8Array(e.subarray(t.pos,t.pos+=r)).buffer;break;case 5:n=null;break;case 6:if(!((e=btoa(i(e.subarray(t.pos,t.pos+=r))))in b))throw Error("Unsupported OBJECT ID "+e);n=b[e];break;case 48:for(n=[],r=t.pos+r;t.pos<r;)n.push(l(e,t));break;default:throw Error("Unsupported DER tag 0x"+n.toString(16))}return n}function A(e,t){t||(t=[]);var n=t.length+2;if(t.push(0,0),e instanceof Uint8Array)for(var i=2,o=e.length,s=0;s<o;s++)t.push(e[s]);else if(e instanceof ArrayBuffer)for(i=4,o=e.byteLength,e=new Uint8Array(e),s=0;s<o;s++)t.push(e[s]);else if(null===e)i=5,o=0;else if("string"==typeof e&&e in w)for(i=6,o=(e=r(atob(w[e]))).length,s=0;s<o;s++)t.push(e[s]);else if(e instanceof Array){for(s=0;s<e.length;s++)A(e[s],t);i=48,o=t.length-n}else{if(!("object"===qa(e)&&3===e.tag&&e.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+e);for(i=3,o=(e=new Uint8Array(e.value)).byteLength,t.push(0),s=0;s<o;s++)t.push(e[s]);o++}if(128<=o){for(s=o,o=4,t.splice(n,0,s>>24&255,s>>16&255,s>>8&255,255&s);1<o&&!(s>>24);)s<<=8,o--;4>o&&t.splice(n,4-o),o|=128}return t.splice(n-2,2,i,o),t}function h(e,t,n,r){Object.defineProperties(this,{_key:{value:e},type:{value:e.type,enumerable:!0},extractable:{value:void 0===n?e.extractable:n,enumerable:!0},algorithm:{value:void 0===t?e.algorithm:t,enumerable:!0},usages:{value:void 0===r?e.usages:r,enumerable:!0}})}function d(e){return"verify"===e||"encrypt"===e||"wrapKey"===e}function p(e){return"sign"===e||"decrypt"===e||"unwrapKey"===e}if("function"!=typeof Promise)throw"Promise support required";var f=e.crypto||e.msCrypto;if(f){var g=f.subtle||f.webkitSubtle;if(g){var m=e.Crypto||f.constructor||Object,v=e.SubtleCrypto||g.constructor||Object;e.CryptoKey||e.Key;var y=-1<e.navigator.userAgent.indexOf("Edge/"),_=!!e.msCrypto&&!y,E=!f.subtle&&!!f.webkitSubtle;if(_||E){var b={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},w={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach((function(e){var t=g[e];g[e]=function(i,l,A){var m=[].slice.call(arguments);switch(e){case"generateKey":var v=o(i),y=l,b=A;break;case"importKey":v=o(A),y=m[3],b=m[4],"jwk"===i&&((l=a(l)).alg||(l.alg=s(v)),l.key_ops||(l.key_ops="oct"!==l.kty?"d"in l?b.filter(p):b.filter(d):b.slice()),m[1]=c(l));break;case"unwrapKey":v=m[4],y=m[5],b=m[6],m[2]=A._key}if("generateKey"===e&&"HMAC"===v.name&&v.hash)return v.length=v.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[v.hash.name],g.importKey("raw",f.getRandomValues(new Uint8Array(v.length+7>>3)),v,y,b);if(E&&"generateKey"===e&&"RSASSA-PKCS1-v1_5"===v.name&&(!v.modulusLength||2048<=v.modulusLength))return(i=o(i)).name="RSAES-PKCS1-v1_5",delete i.hash,g.generateKey(i,!0,["encrypt","decrypt"]).then((function(e){return Promise.all([g.exportKey("jwk",e.publicKey),g.exportKey("jwk",e.privateKey)])})).then((function(e){return e[0].alg=e[1].alg=s(v),e[0].key_ops=b.filter(d),e[1].key_ops=b.filter(p),Promise.all([g.importKey("jwk",e[0],v,!0,e[0].key_ops),g.importKey("jwk",e[1],v,y,e[1].key_ops)])})).then((function(e){return{publicKey:e[0],privateKey:e[1]}}));if((E||_&&"SHA-1"===(v.hash||{}).name)&&"importKey"===e&&"jwk"===i&&"HMAC"===v.name&&"oct"===l.kty)return g.importKey("raw",r(n(l.k)),A,m[3],m[4]);if(E&&"importKey"===e&&("spki"===i||"pkcs8"===i))return g.importKey("jwk",u(l),A,m[3],m[4]);if(_&&"unwrapKey"===e)return g.decrypt(m[3],A,l).then((function(e){return g.importKey(i,e,m[4],m[5],m[6])}));try{var w=t.apply(g,m)}catch(e){return Promise.reject(e)}return _&&(w=new Promise((function(e,t){w.onabort=w.onerror=function(e){t(e)},w.oncomplete=function(t){e(t.target.result)}}))),w=w.then((function(e){return"HMAC"!==v.name||v.length||(v.length=8*e.algorithm.length),0==v.name.search("RSA")&&(v.modulusLength||(v.modulusLength=(e.publicKey||e).algorithm.modulusLength),v.publicExponent||(v.publicExponent=(e.publicKey||e).algorithm.publicExponent)),e.publicKey&&e.privateKey?{publicKey:new h(e.publicKey,v,y,b.filter(d)),privateKey:new h(e.privateKey,v,y,b.filter(p))}:new h(e,v,y,b)}))}})),["exportKey","wrapKey"].forEach((function(e){var o=g[e];g[e]=function(c,u,l){var h=[].slice.call(arguments);switch(e){case"exportKey":h[1]=u._key;break;case"wrapKey":h[1]=u._key,h[2]=l._key}if((E||_&&"SHA-1"===(u.algorithm.hash||{}).name)&&"exportKey"===e&&"jwk"===c&&"HMAC"===u.algorithm.name&&(h[0]="raw"),!E||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(h[0]="jwk"),_&&"wrapKey"===e)return g.exportKey(c,u).then((function(e){return"jwk"===c&&(e=r(unescape(encodeURIComponent(JSON.stringify(a(e)))))),g.encrypt(h[3],l,e)}));try{var f=o.apply(g,h)}catch(e){return Promise.reject(e)}return _&&(f=new Promise((function(e,t){f.onabort=f.onerror=function(e){t(e)},f.oncomplete=function(t){e(t.target.result)}}))),"exportKey"===e&&"jwk"===c&&(f=f.then((function(e){return(E||_&&"SHA-1"===(u.algorithm.hash||{}).name)&&"HMAC"===u.algorithm.name?{kty:"oct",alg:s(u.algorithm),key_ops:u.usages.slice(),ext:!0,k:t(i(e))}:((e=a(e)).alg||(e.alg=s(u.algorithm)),e.key_ops||(e.key_ops="public"===u.type?u.usages.filter(d):"private"===u.type?u.usages.filter(p):u.usages.slice()),e)}))),!E||"exportKey"!==e||"spki"!==c&&"pkcs8"!==c||(f=f.then((function(e){var t=[["",null]],i=!1;if("RSA"!==(e=a(e)).kty)throw new TypeError("Unsupported key type");for(var o="n e d p q dp dq qi".split(" "),s=[],c=0;c<o.length&&o[c]in e;c++){var u=s[c]=r(n(e[o[c]]));128&u[0]&&(s[c]=new Uint8Array(u.length+1),s[c].set(u,1))}return 2<s.length&&(i=!0,s.unshift(new Uint8Array([0]))),t[0][0]="1.2.840.113549.1.1.1",t.push(new Uint8Array(A(s)).buffer),i?t.unshift(new Uint8Array([0])):t[1]={tag:3,value:t[1]},new Uint8Array(A(t)).buffer}))),f}})),["encrypt","decrypt","sign","verify"].forEach((function(e){var t=g[e];g[e]=function(n,r,i,s){if(_&&(!i.byteLength||s&&!s.byteLength))throw Error("Empty input is not allowed");var a=[].slice.call(arguments),c=o(n);if(!_||"sign"!==e&&"verify"!==e||"RSASSA-PKCS1-v1_5"!==n&&"HMAC"!==n||(a[0]={name:n}),_&&r.algorithm.hash&&(a[0].hash=a[0].hash||r.algorithm.hash),_&&"decrypt"===e&&"AES-GCM"===c.name){var u=n.tagLength>>3;a[2]=(i.buffer||i).slice(0,i.byteLength-u),n.tag=(i.buffer||i).slice(i.byteLength-u)}_&&"AES-GCM"===c.name&&void 0===a[0].tagLength&&(a[0].tagLength=128),a[1]=r._key;try{var l=t.apply(g,a)}catch(e){return Promise.reject(e)}return _&&(l=new Promise((function(t,n){l.onabort=l.onerror=function(e){n(e)},l.oncomplete=function(n){if(n=n.target.result,"encrypt"===e&&n instanceof AesGcmEncryptResult){var r=n.ciphertext,i=n.tag;(n=new Uint8Array(r.byteLength+i.byteLength)).set(new Uint8Array(r),0),n.set(new Uint8Array(i),r.byteLength),n=n.buffer}t(n)}}))),l}})),_){var S=g.digest;g.digest=function(e,t){if(!t.byteLength)throw Error("Empty input is not allowed");try{var n=S.call(g,e,t)}catch(e){return Promise.reject(e)}return n=new Promise((function(e,t){n.onabort=n.onerror=function(e){t(e)},n.oncomplete=function(t){e(t.target.result)}}))},e.crypto=Object.create(f,{getRandomValues:{value:function(e){return f.getRandomValues(e)}},subtle:{value:g}}),e.CryptoKey=h}E&&(f.subtle=g,e.Crypto=m,e.SubtleCrypto=v,e.CryptoKey=h)}}}},e.exports?e.exports=n(t):n(t)})),function(e){e.console||(e.console={}),e=e.console;for(var t,n=function(){},r=["memory"],i="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");t=r.pop();)e[t]||(e[t]={});for(;t=i.pop();)e[t]||(e[t]=n)}("undefined"==typeof window?Ya:window),ea({target:"Object",stat:!0},{setPrototypeOf:tb});var uy=la((function(){uc(1)}));ea({target:"Object",stat:!0,forced:uy,sham:!Oo},{getPrototypeOf:function(e){return uc(pb(e))}});var iq=[].slice,zk={},vy=Function.bind||function(e){var t=Wb(this),n=iq.call(arguments,1),r=function(){var i=n.concat(iq.call(arguments));if(this instanceof r){var o=i.length;if(!(o in zk)){for(var s=[],a=0;a<o;a++)s[a]="a["+a+"]";zk[o]=Function("C,a","return new C("+s.join(",")+")")}i=zk[o](t,i)}else i=t.apply(e,i);return i};return xa(t.prototype)&&(r.prototype=t.prototype),r},Ak=Pc("Reflect","construct"),jq=la((function(){function e(){}return!(Ak((function(){}),[],e)instanceof e)})),kq=!la((function(){Ak((function(){}))})),lq=jq||kq;ea({target:"Reflect",stat:!0,forced:lq,sham:lq},{construct:function(e,t){Wb(e),Ia(t);var n=3>arguments.length?e:Wb(arguments[2]);if(kq&&!jq)return Ak(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}return(n=[null]).push.apply(n,t),new(vy.apply(e,n))}n=n.prototype,n=jc(xa(n)?n:Object.prototype);var r=Function.apply.call(e,n,t);return xa(r)?r:n}}),ea({target:"Reflect",stat:!0},{get:Am});var mq=dc.f,wy=la((function(){mq(1)}));ea({target:"Object",stat:!0,forced:!wa||wy,sham:!wa},{getOwnPropertyDescriptor:function(e,t){return mq(Mb(e),t)}});var nq=de.f,xy={}.toString,oq="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Bk=function(e){if(oq&&"[object Window]"==xy.call(e))try{var t=nq(e)}catch(e){t=oq.slice()}else t=nq(Mb(e));return t},pq={f:Fa},yy=qb.f,$h=function(e){var t=R.Symbol||(R.Symbol={});ka(t,e)||yy(t,e,{value:pq.f(e)})},Nb=xh("hidden"),qq=Fa("toPrimitive"),zy=cb.set,rq=cb.getterFor("Symbol"),kc=Object.prototype,Ob=R.Symbol,yg=Pc("JSON","stringify"),sq=dc.f,Jd=qb.f,tq=Bk,Ay=eg,jd=Ad("symbols"),zg=Ad("op-symbols"),Ck=Ad("string-to-symbol-registry"),Dk=Ad("symbol-to-string-registry"),By=Ad("wks"),Ek=R.QObject,Fk=!Ek||!Ek.prototype||!Ek.prototype.findChild,Gk=wa&&la((function(){return 7!=jc(Jd({},"a",{get:function(){return Jd(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=sq(kc,t);r&&delete kc[t],Jd(e,t,n),r&&e!==kc&&Jd(kc,t,r)}:Jd,Hk=function(e,t){var n=jd[e]=jc(Ob.prototype);return zy(n,{type:"Symbol",tag:e,description:t}),wa||(n.description=t),n},Ik=zo?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof Ob},ai=function(e,t,n){return e===kc&&ai(zg,t,n),Ia(e),t=Oc(t,!0),Ia(n),ka(jd,t)?(n.enumerable?(ka(e,Nb)&&e[Nb][t]&&(e[Nb][t]=!1),n=jc(n,{enumerable:Nc(0,!1)})):(ka(e,Nb)||Jd(e,Nb,Nc(1,{})),e[Nb][t]=!0),Gk(e,t,n)):Jd(e,t,n)},uq=function(e,t){Ia(e);var n=Mb(t);return t=ed(n).concat(Jk(n)),fe(t,(function(t){wa&&!Kk.call(n,t)||ai(e,t,n[t])})),e},Kk=function(e){e=Oc(e,!0);var t=Ay.call(this,e);return!(this===kc&&ka(jd,e)&&!ka(zg,e))&&(!(t||!ka(this,e)||!ka(jd,e)||ka(this,Nb)&&this[Nb][e])||t)},vq=function(e,t){if(e=Mb(e),t=Oc(t,!0),e!==kc||!ka(jd,t)||ka(zg,t)){var n=sq(e,t);return!n||!ka(jd,t)||ka(e,Nb)&&e[Nb][t]||(n.enumerable=!0),n}},wq=function(e){e=tq(Mb(e));var t=[];return fe(e,(function(e){ka(jd,e)||ka(bf,e)||t.push(e)})),t},Jk=function(e){var t=e===kc;e=tq(t?zg:Mb(e));var n=[];return fe(e,(function(e){!ka(jd,e)||t&&!ka(kc,e)||n.push(jd[e])})),n};if(Sc||(Ob=function(){if(this instanceof Ob)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=af(e),n=function(e){this===kc&&n.call(zg,e),ka(this,Nb)&&ka(this[Nb],t)&&(this[Nb][t]=!1),Gk(this,t,Nc(1,e))};return wa&&Fk&&Gk(kc,t,{configurable:!0,set:n}),Hk(t,e)},Za(Ob.prototype,"toString",(function(){return rq(this).tag})),Za(Ob,"withoutSetter",(function(e){return Hk(af(e),e)})),eg=Kk,qb.f=ai,dc.f=vq,de.f=Bk=wq,gg.f=Jk,pq.f=function(e){return Hk(Fa(e),e)},wa&&(Jd(Ob.prototype,"description",{configurable:!0,get:function(){return rq(this).description}}),Za(kc,"propertyIsEnumerable",Kk,{unsafe:!0}))),ea({global:!0,wrap:!0,forced:!Sc,sham:!Sc},{Symbol:Ob}),fe(ed(By),(function(e){$h(e)})),ea({target:"Symbol",stat:!0,forced:!Sc},{for:function(e){if(e=String(e),ka(Ck,e))return Ck[e];var t=Ob(e);return Ck[e]=t,Dk[t]=e,t},keyFor:function(e){if(!Ik(e))throw TypeError(e+" is not a symbol");if(ka(Dk,e))return Dk[e]},useSetter:function(){Fk=!0},useSimple:function(){Fk=!1}}),ea({target:"Object",stat:!0,forced:!Sc,sham:!wa},{create:function(e,t){return void 0===t?jc(e):uq(jc(e),t)},defineProperty:ai,defineProperties:uq,getOwnPropertyDescriptor:vq}),ea({target:"Object",stat:!0,forced:!Sc},{getOwnPropertyNames:wq,getOwnPropertySymbols:Jk}),ea({target:"Object",stat:!0,forced:la((function(){gg.f(1)}))},{getOwnPropertySymbols:function(e){return gg.f(pb(e))}}),yg){var Cy=!Sc||la((function(){var e=Ob();return"[null]"!=yg([e])||"{}"!=yg({a:e})||"{}"!=yg(Object(e))}));ea({target:"JSON",stat:!0,forced:Cy},{stringify:function(e,t,n){for(var r,i=[e],o=1;arguments.length>o;)i.push(arguments[o++]);if(r=t,(xa(t)||void 0!==e)&&!Ik(e))return Ed(t)||(t=function(e,t){if("function"==typeof r&&(t=r.call(this,e,t)),!Ik(t))return t}),i[1]=t,yg.apply(null,i)}})}Ob.prototype[qq]||kb(Ob.prototype,qq,Ob.prototype.valueOf),zc(Ob,"Symbol"),bf[Nb]=!0;var Dy=qb.f,kd=R.Symbol;if(wa&&"function"==typeof kd&&(!("description"in kd.prototype)||void 0!==kd().description)){var xq={},Ag=function(){var e=1>arguments.length||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof Ag?new kd(e):void 0===e?kd():kd(e);return""===e&&(xq[t]=!0),t};to(Ag,kd);var Lk=Ag.prototype=kd.prototype;Lk.constructor=Ag;var Ey=Lk.toString,Fy="Symbol(test)"==String(kd("test")),Gy=/^Symbol\((.*)\)[^)]+$/;Dy(Lk,"description",{configurable:!0,get:function(){var e=xa(this)?this.valueOf():this,t=Ey.call(e);return ka(xq,e)?"":""===(e=Fy?t.slice(7,-1):t.replace(Gy,"$1"))?void 0:e}}),ea({global:!0,forced:!0},{Symbol:Ag})}$h("toStringTag"),zc(R.JSON,"JSON",!0),zc(Math,"Math",!0),function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(e,t,n){return(s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););if(e)return(t=Object.getOwnPropertyDescriptor(e,t)).get?t.get.call(n):t.value})(e,t,n||e)}var a=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(t,[{key:"addEventListener",value:function(e,t,n){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:n})}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var n=0,r=(e=this.listeners[e]).length;n<r;n++)if(e[n].callback===t){e.splice(n,1);break}}},{key:"dispatchEvent",value:function(e){if(e.type in this.listeners){for(var t=this.listeners[e.type].slice(),n=0,r=t.length;n<r;n++){var i=t[n];try{i.callback.call(this,e)}catch(e){Promise.resolve().then((function(){throw e}))}i.options&&i.options.once&&this.removeEventListener(e.type,i.callback)}return!e.defaultPrevented}}}]),t}(),c=function(t){function c(){e(this,c);var t=u.call(this);return t.listeners||a.call(o(t)),Object.defineProperty(o(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(o(t),"onabort",{value:null,writable:!0,configurable:!0}),t}!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(c,t);var u=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n=r(e);if(t){var i=r(this).constructor;n=Reflect.construct(n,arguments,i)}else n=n.apply(this,arguments);return!n||"object"!==qa(n)&&"function"!=typeof n?o(this):n}}(c);return n(c,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),s(r(c.prototype),"dispatchEvent",this).call(this,e)}}]),c}(a),u=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new c,writable:!0,configurable:!0})}return n(t,[{key:"abort",value:function(){try{var e=new Event("abort")}catch(t){"undefined"!=typeof document?document.createEvent?(e=document.createEvent("Event")).initEvent("abort",!1,!1):(e=document.createEventObject()).type="abort":e={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(e)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(u.prototype[Symbol.toStringTag]="AbortController",c.prototype[Symbol.toStringTag]="AbortSignal"),function(e){if(e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var t=!0}else t="function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController;t&&(e.AbortController=u,e.AbortSignal=c)}("undefined"!=typeof self?self:Ya)}();var Hy=Math.floor,Iy=Math.log,Jy=Math.LOG2E;ea({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Hy(Iy(e+.5)*Jy):32}});var Ky=Math.log,Ly=Math.LN2,cu=Math.clz32||function(e){return 31-Ky(e>>>0)/Ly|0},Ud=String.fromCharCode,yq={}.toString,Mk=window.Uint8Array,Nk=Mk||Array,My=yq.call((window.ArrayBuffer||Nk).prototype),Ok;Bm.prototype.decode=function(e){if(e=e&&e.buffer||e,yq.call(e)!==My)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var t="",n=0,r=0|(e=Mk?new Nk(e):e).length;n<r;n=n+32768|0)t+=Ud.apply(0,e[Mk?"slice":"subarray"](n,n+32768|0));return t.replace(/[\xc0-\xff][\x80-\xbf]*/g,bu)},window.TextDecoder||(window.TextDecoder=Bm),Cm.prototype.encode=function(e){for(var t=0|(e=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,du)).length,n=new Nk(t),r=0;r<t;r=r+1|0)n[r]=e.charCodeAt(r);return n},window.TextEncoder||(window.TextEncoder=Cm),function(e){var t,n,r,i,o,s,a,c,u,l,A,h;(n=t||(t={})).LOGIN="LOGIN",n.LOGIN_SUCCESS="LOGIN_SUCCESS",n.LOGIN_FAILURE="LOGIN_FAILURE",n.LOGIN_TIMEOUT="LOGIN_TIMEOUT",n.INTERRUPTED="INTERRUPTED",n.LOGOUT="LOGOUT",n.BANNED_BY_SERVER="BANNED_BY_SERVER",n.REMOTE_LOGIN="REMOTE_LOGIN",n.TOKEN_EXPIRED="TOKEN_EXPIRED",e.ConnectionChangeReason=t,function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.RECONNECTING="RECONNECTING",e.ABORTED="ABORTED"}(r||(r={})),e.ConnectionState=r,function(e){e.IDLE="IDLE",e.SENT_TO_REMOTE="SENT_TO_REMOTE",e.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",e.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",e.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(i||(i={})),e.LocalInvitationState=i,function(e){e.INVITATION_RECEIVED="INVITATION_RECEIVED",e.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",e.REFUSED="REFUSED",e.ACCEPTED="ACCEPTED",e.CANCELED="CANCELED",e.FAILURE="FAILURE"}(o||(o={})),e.RemoteInvitationState=o,function(e){e.UNKNOWN="UNKNOWN",e.PEER_NO_RESPONSE="PEER_NO_RESPONSE",e.INVITATION_EXPIRE="INVITATION_EXPIRE",e.PEER_OFFLINE="PEER_OFFLINE",e.NOT_LOGGEDIN="NOT_LOGGEDIN"}(s||(s={})),e.LocalInvitationFailureReason=s,function(e){e.UNKNOWN="UNKNOWN",e.PEER_OFFLINE="PEER_OFFLINE",e.ACCEPT_FAILURE="ACCEPT_FAILURE",e.INVITATION_EXPIRE="INVITATION_EXPIRE"}(a||(a={})),e.RemoteInvitationFailureReason=a,function(e){e.ONLINE="ONLINE",e.UNREACHABLE="UNREACHABLE",e.OFFLINE="OFFLINE"}(c||(c={})),e.PeerOnlineState=c,(u||(u={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=u,function(e){e.TEXT="TEXT",e.RAW="RAW"}(l||(l={})),e.MessageType=l,function(e){e.CN="CN",e.NA="NA",e.EU="EU",e.AS="AS",e.JP="JP",e.IN="IN",e.GLOB="GLOB",e.OC="OC",e.SA="SA",e.AF="AF",e.OVS="OVS"}(A||(A={})),e.LegacyAreaCode=A,function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"}(h||(h={})),e.AreaCode=h}(Ok||(Ok={}));var ta=Ok;ea({target:"Array",proto:!0},{includes:function(e){return qo(this,e,1<arguments.length?arguments[1]:void 0)}}),ng("includes");var Pk=function(e){if(Lj(e))throw TypeError("The method doesn't accept regular expressions");return e},Ny=Fa("match"),Qk=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[Ny]=!1,"/./"[e](t)}catch(e){}}return!1};ea({target:"String",proto:!0,forced:!Qk("includes")},{includes:function(e){return!!~String(Eb(this)).indexOf(Pk(e),1<arguments.length?arguments[1]:void 0)}});var Ec={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0,ENABLE_EDGE_AUTO_FALLBACK:!0};$h("iterator"),$h("asyncIterator");var Rk=ff("forEach")?[].forEach:function(e){return fe(this,e,1<arguments.length?arguments[1]:void 0)},zq;for(zq in wk){var Aq=R[zq],bi=Aq&&Aq.prototype;if(bi&&bi.forEach!==Rk)try{kb(bi,"forEach",Rk)}catch(c){bi.forEach=Rk}}var Oy=[].reverse,Bq=[1,2];ea({target:"Array",proto:!0,forced:String(Bq)===String(Bq.reverse())},{reverse:function(){return Ed(this)&&(this.length=this.length),Oy.call(this)}});var N=xb((function(e){e=function(e){function t(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}function n(e,t,n,o){return t=Object.create((t&&t.prototype instanceof i?t:i).prototype),o=new h(o||[]),t._invoke=function(e,t,n){var i=b;return function(o,s){if(i===S)throw Error("Generator is already running");if(i===T){if("throw"===o)throw s;return p()}for(n.method=o,n.arg=s;;){if((o=n.delegate)&&(o=u(o,n))){if(o===C)continue;return o}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===b)throw i=T,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);if(i=S,"normal"===(o=r(e,t,n)).type){if(i=n.done?T:w,o.arg===C)continue;return{value:o.arg,done:n.done}}"throw"===o.type&&(i=T,n.method="throw",n.arg=o.arg)}}}(e,n,o),t}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function i(){}function o(){}function s(){}function a(e){["next","throw","return"].forEach((function(n){t(e,n,(function(e){return this._invoke(n,e)}))}))}function c(e,t){function n(i,o,s,a){if("throw"!==(i=r(e[i],e,o)).type){var c=i.arg;return(i=c.value)&&"object"===qa(i)&&m.call(i,"__await")?t.resolve(i.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(i).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,a)}))}a(i.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function u(e,t){var n=e.iterator[t.method];if(n===f){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=f,u(e,t),"throw"===t.method))return C;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return C}return"throw"===(n=r(n,e.iterator,t.arg)).type?(t.method="throw",t.arg=n.arg,t.delegate=null,C):(n=n.arg)?n.done?(t[e.resultName]=n.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=f),t.delegate=null,C):n:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,C)}function l(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function h(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(l,this),this.reset(!0)}function d(e){if(e){var t=e[y];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1;return(t=function t(){for(;++n<e.length;)if(m.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=f,t.done=!0,t}).next=t}}return{next:p}}function p(){return{value:f,done:!0}}var f,g=Object.prototype,m=g.hasOwnProperty,v="function"==typeof Symbol?Symbol:{},y=v.iterator||"@@iterator",_=v.asyncIterator||"@@asyncIterator",E=v.toStringTag||"@@toStringTag";try{t({},"")}catch(e){t=function(e,t,n){return e[t]=n}}e.wrap=n;var b="suspendedStart",w="suspendedYield",S="executing",T="completed",C={};t(v={},y,(function(){return this}));var R=Object.getPrototypeOf;(R=R&&R(R(d([]))))&&R!==g&&m.call(R,y)&&(v=R);var I=s.prototype=i.prototype=Object.create(v);return o.prototype=s,t(I,"constructor",s),t(s,"constructor",o),o.displayName=t(s,E,"GeneratorFunction"),e.isGeneratorFunction=function(e){return!!(e="function"==typeof e&&e.constructor)&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,s):(e.__proto__=s,t(e,E,"GeneratorFunction")),e.prototype=Object.create(I),e},e.awrap=function(e){return{__await:e}},a(c.prototype),t(c.prototype,_,(function(){return this})),e.AsyncIterator=c,e.async=function(t,r,i,o,s){void 0===s&&(s=Promise);var a=new c(n(t,r,i,o),s);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},a(I),t(I,E,"Generator"),t(I,y,(function(){return this})),t(I,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t,n=[];for(t in e)n.push(t);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=d,h.prototype={constructor:h,reset:function(e){if(this.next=this.prev=0,this.sent=this._sent=f,this.done=!1,this.delegate=null,this.method="next",this.arg=f,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&m.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=f)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return o.type="throw",o.arg=e,n.next=t,r&&(n.method="next",n.arg=f),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;0<=r;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var s=m.call(i,"catchLoc"),a=m.call(i,"finallyLoc");if(s&&a){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!a)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&m.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}return i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null),(n=i?i.completion:{}).type=e,n.arg=t,i?(this.method="next",this.next=i.finallyLoc,C):this.complete(n)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),C},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),C}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var n=this.tryEntries[t];if(n.tryLoc===e){if("throw"===(e=n.completion).type){var r=e.arg;A(n)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:d(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=f),C}},e}(e.exports);try{regeneratorRuntime=e}catch(t){"object"===("undefined"==typeof globalThis?"undefined":qa(globalThis))?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})),Cq=!la((function(){return Object.isExtensible(Object.preventExtensions({}))})),Sk=xb((function(e){var t=qb.f,n=af("meta"),r=0,i=Object.isExtensible||function(){return!0},o=function(e){t(e,n,{value:{objectID:"O"+ ++r,weakData:{}}})},s=e.exports={REQUIRED:!1,fastKey:function(e,t){if(!xa(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!ka(e,n)){if(!i(e))return"F";if(!t)return"E";o(e)}return e[n].objectID},getWeakData:function(e,t){if(!ka(e,n)){if(!i(e))return!0;if(!t)return!1;o(e)}return e[n].weakData},onFreeze:function(e){return Cq&&s.REQUIRED&&i(e)&&!ka(e,n)&&o(e),e}};bf[n]=!0})),Dq=function(e,t,n){var r=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=r?"set":"add",s=R[e],a=s&&s.prototype,c=s,u={},l=function(e){var t=a[e];Za(a,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!xa(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!xa(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!xa(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(Qc(e,"function"!=typeof s||!(i||a.forEach&&!la((function(){(new s).entries().next()})))))c=n.getConstructor(t,e,r,o),Sk.REQUIRED=!0;else if(Qc(e,!0)){var A=new c,h=A[o](i?{}:-0,1)!=A,d=la((function(){A.has(1)})),p=Eh((function(e){new s(e)})),f=!i&&la((function(){for(var e=new s,t=5;t--;)e[o](t,t);return!e.has(-0)}));p||((c=t((function(t,n){return Ac(t,c,e),t=Wh(new s,t,c),null!=n&&Jh(n,t[o],{that:t,AS_ENTRIES:r}),t}))).prototype=a,a.constructor=c),(d||f)&&(l("delete"),l("has"),r&&l("get")),(f||h)&&l(o),i&&a.clear&&delete a.clear}return u[e]=c,ea({global:!0,forced:c!=s},u),zc(c,e),i||n.setStrong(c,e,r),c},Py=qb.f,Eq=Sk.fastKey,Fq=cb.set,Tk=cb.getterFor,Gq={getConstructor:function(e,t,n,r){var i=e((function(e,o){Ac(e,i,t),Fq(e,{type:t,index:jc(null),first:void 0,last:void 0,size:0}),wa||(e.size=0),null!=o&&Jh(o,e[r],{that:e,AS_ENTRIES:n})})),o=Tk(t),s=function(e,t,n){var r,i=o(e),s=a(e,t);return s?s.value=n:(i.last=s={index:r=Eq(t,!0),key:t,value:n,previous:t=i.last,next:void 0,removed:!1},i.first||(i.first=s),t&&(t.next=s),wa?i.size++:e.size++,"F"!==r&&(i.index[r]=s)),e},a=function(e,t){e=o(e);var n=Eq(t);if("F"!==n)return e.index[n];for(e=e.first;e;e=e.next)if(e.key==t)return e};return kf(i.prototype,{clear:function(){for(var e=o(this),t=e.index,n=e.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete t[n.index],n=n.next;e.first=e.last=void 0,wa?e.size=0:this.size=0},delete:function(e){var t=o(this);if(e=a(this,e)){var n=e.next,r=e.previous;delete t.index[e.index],e.removed=!0,r&&(r.next=n),n&&(n.previous=r),t.first==e&&(t.first=n),t.last==e&&(t.last=r),wa?t.size--:this.size--}return!!e},forEach:function(e){for(var t,n=o(this),r=Dd(e,1<arguments.length?arguments[1]:void 0,3);t=t?t.next:n.first;)for(r(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),kf(i.prototype,n?{get:function(e){return(e=a(this,e))&&e.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),wa&&Py(i.prototype,"size",{get:function(){return o(this).size}}),i},setStrong:function(e,t,n){var r=t+" Iterator",i=Tk(t),o=Tk(r);Wj(e,t,(function(e,t){Fq(this,{type:r,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,n=e.last;n&&n.removed;)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),og(t)}};Dq("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Gq);var Uk=Pc("Reflect","apply"),Qy=Function.apply,Ry=!la((function(){Uk((function(){}))}));ea({target:"Reflect",stat:!0,forced:Ry},{apply:function(e,t,n){return Wb(e),Ia(n),Uk?Uk(e,t,n):Qy.call(e,t,n)}}),ea({target:"Reflect",stat:!0},{ownKeys:so});var Hq=Fa("isConcatSpreadable"),Sy=51<=Cd||!la((function(){var e=[];return e[Hq]=!1,e.concat()[0]!==e})),Ty=kg("concat");ea({target:"Array",proto:!0,forced:!Sy||!Ty},{concat:function(e){var t,n=pb(this),r=Dh(n,0),i=0,o=-1;for(t=arguments.length;o<t;o++){var s=-1===o?n:arguments[o],a=s;if(xa(a)){var c=a[Hq];a=void 0!==c?!!c:Ed(a)}else a=!1;if(a){if(9007199254740991<i+(c=Ma(s.length)))throw TypeError("Maximum allowed index exceeded");for(a=0;a<c;a++,i++)a in s&&hf(r,i,s[a])}else{if(9007199254740991<=i)throw TypeError("Maximum allowed index exceeded");hf(r,i++,s)}}return r.length=i,r}});var Uy=Bk,Vy=la((function(){return!Object.getOwnPropertyNames(1)}));ea({target:"Object",stat:!0,forced:Vy},{getOwnPropertyNames:Uy});var Wy=de.f,Xy=dc.f,Yy=qb.f,Kd=R.Number,ci=Kd.prototype,Zy="Number"==xc(jc(ci)),Iq=function(e){var t,n=Oc(e,!1);if("string"==typeof n&&2<n.length)if(43===(e=(n=Oj(n)).charCodeAt(0))||45===e){if(88===(e=n.charCodeAt(2))||120===e)return NaN}else if(48===e){switch(n.charCodeAt(1)){case 66:case 98:e=2;var r=49;break;case 79:case 111:e=8,r=55;break;default:return+n}var i=(n=n.slice(2)).length;for(t=0;t<i;t++){var o=n.charCodeAt(t);if(48>o||o>r)return NaN}return parseInt(n,e)}return+n};if(Qc("Number",!Kd(" 0o1")||!Kd("0b1")||Kd("+0x1"))){for(var le=function(e){var t=1>arguments.length?0:e,n=this;return n instanceof le&&(Zy?la((function(){ci.valueOf.call(n)})):"Number"!=xc(n))?Wh(new Kd(Iq(t)),n,le):Iq(t)},Jq=wa?Wy(Kd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),Vk=0,di;Jq.length>Vk;Vk++)ka(Kd,di=Jq[Vk])&&!ka(le,di)&&Yy(le,di,Xy(Kd,di));le.prototype=ci,ci.constructor=le,Za(R,"Number",le)}var sf="object"===("undefined"==typeof Reflect?"undefined":qa(Reflect))?Reflect:null,Kq=sf&&"function"==typeof sf.apply?sf.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},$y=sf&&"function"==typeof sf.ownKeys?sf.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},Lq=Number.isNaN||function(e){return e!=e};Ba.EventEmitter=Ba,Ba.prototype._events=void 0,Ba.prototype._eventsCount=0,Ba.prototype._maxListeners=void 0;var Mq=10;Object.defineProperty(Ba,"defaultMaxListeners",{enumerable:!0,get:function(){return Mq},set:function(e){if("number"!=typeof e||0>e||Lq(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Mq=e}}),Ba.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ba.prototype.setMaxListeners=function(e){if("number"!=typeof e||0>e||Lq(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},Ba.prototype.getMaxListeners=function(){return void 0===this._maxListeners?Ba.defaultMaxListeners:this._maxListeners},Ba.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);n="error"===e;var r=this._events;if(void 0!==r)n=n&&void 0===r.error;else if(!n)return!1;if(n){var i;if(0<t.length&&(i=t[0]),i instanceof Error)throw i;throw(t=Error("Unhandled error."+(i?" ("+i.message+")":""))).context=i,t}if(void 0===(n=r[e]))return!1;if("function"==typeof n)Kq(n,this,t);else for(r=Gm(n,i=n.length),n=0;n<i;++n)Kq(r[n],this,t);return!0},Ba.prototype.addListener=function(e,t){return Dm(this,e,t,!1)},Ba.prototype.on=Ba.prototype.addListener,Ba.prototype.prependListener=function(e,t){return Dm(this,e,t,!0)},Ba.prototype.once=function(e,t){return Wg(t),this.on(e,Em(this,e,t)),this},Ba.prototype.prependOnceListener=function(e,t){return Wg(t),this.prependListener(e,Em(this,e,t)),this},Ba.prototype.removeListener=function(e,t){var n;Wg(t);var r=this._events;if(void 0===r)return this;var i=r[e];if(void 0===i)return this;if(i===t||i.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,i.listener||t));else if("function"!=typeof i){var o=-1;for(n=i.length-1;0<=n;n--)if(i[n]===t||i[n].listener===t){var s=i[n].listener;o=n;break}if(0>o)return this;if(0===o)i.shift();else{for(;o+1<i.length;o++)i[o]=i[o+1];i.pop()}1===i.length&&(r[e]=i[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},Ba.prototype.off=Ba.prototype.removeListener,Ba.prototype.removeAllListeners=function(e){var t=this._events;if(void 0===t)return this;if(void 0===t.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==t[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete t[e]),this;if(0===arguments.length){var n=Object.keys(t);for(t=0;t<n.length;++t){var r=n[t];"removeListener"!==r&&this.removeAllListeners(r)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=t[e]))this.removeListener(e,n);else if(void 0!==n)for(t=n.length-1;0<=t;t--)this.removeListener(e,n[t]);return this},Ba.prototype.listeners=function(e){return Fm(this,e,!0)},Ba.prototype.rawListeners=function(e){return Fm(this,e,!1)},Ba.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Hm.call(e,t)},Ba.prototype.listenerCount=Hm,Ba.prototype.eventNames=function(){return 0<this._eventsCount?$y(this._events):[]},Ba.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}Im(e,t,o,{once:!0}),"error"!==t&&fu(e,i,{once:!0})}))};var tf=Object.assign,Nq=Object.defineProperty,Bg=!tf||la((function(){if(wa&&1!==tf({b:1},tf(Nq({},"a",{enumerable:!0,get:function(){Nq(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol();return e[n]=7,"abcdefghijklmnopqrst".split("").forEach((function(e){t[e]=e})),7!=tf({},e)[n]||"abcdefghijklmnopqrst"!=ed(tf({},t)).join("")}))?function(e,t){for(var n=pb(e),r=arguments.length,i=1,o=gg.f,s=eg;r>i;)for(var a,c=fg(arguments[i++]),u=o?ed(c).concat(o(c)):ed(c),l=u.length,A=0;l>A;)a=u[A++],(!wa||s.call(c,a))&&(n[a]=c[a]);return n}:tf;ea({target:"Object",stat:!0,forced:Object.assign!==Bg},{assign:Bg}),Dq("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Gq);var az=Math.log,bz=Math.LN2;ea({target:"Math",stat:!0},{log2:function(e){return az(e)/bz}});var cz=qb.f,dz=de.f,ez=cb.enforce,fz=Fa("match"),Vc=R.RegExp,Wk=Vc.prototype,Cg=/a/g,Xk=/a/g,Yk=new Vc(Cg)!==Cg;if(wa&&Qc("RegExp",!Yk||Rc||la((function(){return Xk[fz]=!1,Vc(Cg)!=Cg||Vc(Xk)==Xk||"/a/i"!=Vc(Cg,"i")})))){for(var ld=function(e,t){var n,r=this instanceof ld,i=Lj(e),o=void 0===t;return!r&&i&&e.constructor===ld&&o||(Yk?i&&!o&&(e=e.source):e instanceof ld&&(o&&(t=Gj.call(e)),e=e.source),Rc&&(n=!!t&&-1<t.indexOf("y"))&&(t=t.replace(/y/g,"")),e=Wh(Yk?new Vc(e,t):Vc(e,t),r?this:Wk,ld),Rc&&n&&(ez(e).sticky=!0)),e},gz=function(e){e in ld||cz(ld,e,{configurable:!0,get:function(){return Vc[e]},set:function(t){Vc[e]=t}})},Oq=dz(Vc),Pq=0;Oq.length>Pq;)gz(Oq[Pq++]);Wk.constructor=ld,ld.prototype=Wk,Za(R,"RegExp",ld)}og("RegExp"),xg("Float32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),xg("Float64",(function(e){return function(t,n,r){return e(this,t,n,r)}})),xg("Uint32",(function(e){return function(t,n,r){return e(this,t,n,r)}})),xg("Uint16",(function(e){return function(t,n,r){return e(this,t,n,r)}}));var Zk=function(e,t){return e===t?0:null==e?null==t?0:-1:null==t?null==e?0:1:"function"==typeof e.compare?e.compare(t):"function"==typeof t.compare?-t.compare(e):e<t?-1:e>t?1:0},$k=[],Qq=$k.sort,hz=la((function(){$k.sort(void 0)})),iz=la((function(){$k.sort(null)})),jz=ff("sort");ea({target:"Array",proto:!0,forced:hz||!iz||!jz},{sort:function(e){return void 0===e?Qq.call(pb(this)):Qq.call(pb(this),Wb(e))}});var Rq=Object.getPrototypeOf({}),Dg=function(e,t){var n;return e===t||(null==e?e==t:"function"===qa(e.equiv)?e.equiv(t):null==t?e==t:"function"===qa(t.equiv)?t.equiv(e):"string"!==qa(e)&&"string"!==qa(t)&&(null!=(n=Object.getPrototypeOf(e))&&n!==Rq||null!=(n=Object.getPrototypeOf(t))&&n!==Rq?"function"!==qa(e)&&void 0!==e.length&&"function"!==qa(t)&&void 0!==t.length?lz(e,t):e instanceof Set&&t instanceof Set?mz(e,t):e instanceof Map&&t instanceof Map?nz(e,t):e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.toString()===t.toString():e!=e&&t!=t:kz(e,t)))},lz=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Dg,r=e.length;if(r===t.length)for(;0<=--r&&n(e[r],t[r]););return 0>r},mz=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Dg;return e.size===t.size&&n(Z(e.keys()).sort(),Z(t.keys()).sort())},nz=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Dg;return e.size===t.size&&n(Z(e).sort(),Z(t).sort())},kz=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:Dg;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!t.hasOwnProperty(r)||!n(e[r],t[r]))return!1;return!0},Sq=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(e){return void 0!==e?": "+e:""};return function(n){function r(n){return va(this,r),i.call(this,e(n)+t(n))}Ga(r,n);var i=Ha(r);return r}(Kf(Error))},oz=Sq((function(){return"illegal argument(s)"})),ei=function(e){throw new oz(e)},al=Sq((function(){return"index out of bounds"})),Tq=1/4294967295,pz=function(){function e(){va(this,e)}return eb(e,[{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.int()*Tq*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(this.int()*Tq-.5)*e}},{key:"minmax",value:function(e,t){return this.float()*(t-e)+e}}]),e}(),bl=Math.random,qz=new(function(e){function t(){return va(this,t),n.apply(this,arguments)}Ga(t,e);var n=Ha(t);return eb(t,[{key:"int",value:function(){return 4294967296*bl()>>>0}},{key:"float",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return bl()*e}},{key:"norm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return 2*(bl()-.5)*e}}]),t}(pz)),Ni=Symbol(),Lm=function(){},rz=Sk.onFreeze,cl=Object.freeze,sz=la((function(){cl(1)}));ea({target:"Object",stat:!0,forced:sz,sham:!Cq},{freeze:function(e){return cl&&xa(e)?cl(rz(e)):e}});var tz=ff("reduce"),uz=!fd&&79<Cd&&83>Cd;ea({target:"Array",proto:!0,forced:!tz||uz},{reduce:function(e){return $p(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Km=function(e){return null!=e&&"function"==typeof e.xform?e.xform():e},Xg=function(){function e(t){va(this,e),this.value=t}return eb(e,[{key:"deref",value:function(){return this.value}}]),e}(),Oi=function(e){return e instanceof Xg?e.deref():e},hu=function(e,t){return[e,function(e){return e},t]},vz=N.mark((function(e,t){var n,r,i,o,s,a;return N.wrap((function(c){for(;;)switch(c.prev=c.next){case 0:n=Km(e)(gu()),r=n[1],i=n[2],o=0;case 4:if(!(o<t.length)){c.next=15;break}if(s=t[o],!((a=i([],s))instanceof Xg)){c.next=10;break}return c.delegateYield(Oi(r(a.deref())),"t0",9);case 9:return c.abrupt("return");case 10:if(!a.length){c.next=12;break}return c.delegateYield(a,"t1",12);case 12:o++,c.next=4;break;case 15:return c.delegateYield(Oi(r([])),"t2",16);case 16:case"end":return c.stop()}}),vz)})),iu=N.mark(Jm),ju=function(e,t){return[e[0],e[1],t]},wz=function(){function e(t){va(this,e),this._length=0,t&&this.into(t)}return eb(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var e,t=this.head;t;)e=t.next,delete t.value,delete t.prev,delete t.next,t=e;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(e){var t=this._length;if(t<e._length)return-1;if(t>e._length)return 1;if(0===t)return 0;t=this.head,e=e.head;for(var n=0;t&&0==n;)n=Zk(t.value,e.value),t=t.next,e=e.next;return n}},{key:"equiv",value:function(t){if(!(t instanceof e||null!=t&&"function"!=typeof t&&void 0!==t.length)||this._length!==t.length)return!1;if(!this._length||this===t)return!0;for(var n=this.head,r=0;r<t.length;r++){if(!Dg(n.value,t[r]))return!1;n=n.next}return!0}},{key:Symbol.iterator,value:N.mark((function e(){var t;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.head;case 1:if(!t){e.next=7;break}return e.next=4,t.value;case 4:t=t.next,e.next=1;break;case 7:case"end":return e.stop()}}),e,this)}))},{key:"seq",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;if(!(e>=t||0>e)){e=this.nthCell(e);var n=this.nthCell(t-1);return t=function e(t){return{first:function(){return t.value},next:function(){return t!==n&&t.next?e(t.next):void 0}}},e?t(e):void 0}}},{key:"cycle",value:N.mark((function e(){return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(this,"t0",2);case 2:e.next=0;break;case 4:case"end":return e.stop()}}),e,this)}))},{key:"$reduce",value:function(e,t){for(var n=this.head;n&&!(t instanceof Xg);)t=e(t,n.value),n=n.next;return t}},{key:"drop",value:function(){var e=this.head;if(e)return(this.head=e.next)?delete this.head.prev:delete this.tail,this._length--,e.value}},{key:"cons",value:function(e){return e={value:e,next:this.head},this.head?this.head.prev=e:this.tail=e,this.head=e,this._length++,this}},{key:"insertBefore",value:function(e,t){return e||ei("cell is undefined"),t={value:t,next:e,prev:e.prev},e.prev?e.prev.next=t:this.head=t,e.prev=t,this._length++,this}},{key:"insertAfter",value:function(e,t){return e||ei("cell is undefined"),t={value:t,next:e.next,prev:e},e.next?e.next.prev=t:this.tail=t,e.next=t,this._length++,this}},{key:"insertBeforeNth",value:function(e,t){if(0>e&&(e+=this._length),0>=e)return this.cons(t);if(0>e||e>=this._length)throw new al(e);return this.insertBefore(this.nthCellUnsafe(e),t)}},{key:"insertAfterNth",value:function(e,t){if(0>e&&(e+=this._length),e>=this._length-1)return this.push(t);if(0>e||e>=this._length)throw new al(e);return this.insertAfter(this.nthCellUnsafe(e),t)}},{key:"insertSorted",value:function(e,t){t=t||Zk;for(var n=this.head;n;){if(0>=t(e,n.value))return this.insertBefore(n,e);n=n.next}return this.push(e)}},{key:"find",value:function(e){for(var t=this.head;t;){if(t.value===e)return t;t=t.next}}},{key:"findWith",value:function(e){for(var t=this.head;t;){if(e(t.value))return t;t=t.next}}},{key:"concat",value:function(){for(var e=this.copy(),t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];for(t=0;t<n.length;t++)e.into(n[t]);return e}},{key:"into",value:function(e){for(var t=0;t<e.length;t++)this.push(e[t])}},{key:"slice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.length;t=0>t?t+this._length:t,n=0>n?n+this._length:n,(0>t||0>n)&&ei("invalid indices: ${from} / ${to}");for(var r=new e,i=this.nthCell(t);i&&++t<=n;)r.push(i.value),i=i.next;return r}},{key:"splice",value:function(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,r=2<arguments.length?arguments[2]:void 0;if("number"==typeof t){if(0>t&&(t+=this._length),0>t||t>=this._length)throw new al(t);var i=this.nthCellUnsafe(t)}else i=t;var o=new e;if(0<n)for(;i&&0<n--;)this.remove(i),o.push(i.value),i=i.next;else i&&(i=i.next);if(r)if(i)for(n=0;n<r.length;n++)this.insertBefore(i,r[n]);else for(i=0;i<r.length;i++)this.push(r[i]);return o}},{key:"remove",value:function(e){return e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev,this._length--,this}},{key:"swap",value:function(e,t){if(e!==t){var n=e.value;e.value=t.value,t.value=n}return this}},{key:"push",value:function(e){return this.tail?(e={value:e,prev:this.tail},this.tail=this.tail.next=e,this._length++,this):this.cons(e)}},{key:"pop",value:function(){var e=this.tail;if(e)return(this.tail=e.prev)?delete this.tail.next:delete this.head,this._length--,e.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(e){return this.head?(this.head.value=e,this):this.cons(e)}},{key:"setTail",value:function(e){return this.tail?(this.tail.value=e,this):this.push(e)}},{key:"setNth",value:function(e,t){var n=this.nthCell(e);return!n&&ei("index out of bounds: ".concat(e)),n.value=t,this}},{key:"nth",value:function(e,t){return(e=this.nthCell(e))?e.value:t}},{key:"nthCell",value:function(e){if(0>e&&(e+=this._length),!(0>e||e>=this._length))return this.nthCellUnsafe(e)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var e=this.peek();return this.pop(),this.cons(e)}}},{key:"map",value:function(t){for(var n=new e,r=this.head;r;)n.push(t(r.value)),r=r.next;return n}},{key:"filter",value:function(t){for(var n=new e,r=this.head;r;)t(r.value)&&n.push(r.value),r=r.next;return n}},{key:"reduce",value:function(e,t){for(var n=this.head;n;)t=e(t,n.value),n=n.next;return t}},{key:"shuffle",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:qz;if(2>this._length)return this;for(e=null!=e?e:Math.ceil(1.5*Math.log2(this._length));0<e;e--)for(var n=this.head;n;){var r=n.next;.5>t.float()?this.asHead(n):this.asTail(n),n=r}return this}},{key:"sort",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:Zk;if(!this._length)return this;for(var t=1;;){var n=this.head;this.tail=this.head=void 0;for(var r=0;n;){r++;for(var i=n,o=0,s=0;s<t&&(o++,i=i.next);s++);for(s=t;0<o||0<s&&i;){if(0===o){var a=i;i=i.next,s--}else i&&0!==s?0>=e(n.value,i.value)?(a=n,n=n.next,o--):(a=i,i=i.next,s--):(a=n,n=n.next,o--);this.tail?this.tail.next=a:this.head=a,a.prev=this.tail,this.tail=a}n=i}if(this.tail.next=void 0,1>=r)return this;t*=2}}},{key:"reverse",value:function(){for(var e=this.head,t=this.tail,n=(this._length>>>1)+(1&this._length);e&&t&&0<n;){var r=e.value;e.value=t.value,t.value=r,e=e.next,t=t.prev,n--}return this}},{key:"asHead",value:function(e){return e===this.head||(this.remove(e),this.head.prev=e,e.next=this.head,e.prev=void 0,this.head=e,this._length++),this}},{key:"asTail",value:function(e){return e===this.tail||(this.remove(e),this.tail.next=e,e.prev=this.tail,e.next=void 0,this.tail=e,this._length++),this}},{key:"toString",value:function(){for(var e=[],t=this.head;t;)e.push(String(t.value)),t=t.next;return e.join(", ")}},{key:"toJSON",value:function(){return Z(this)}},{key:"nthCellUnsafe",value:function(e){if(e<=this._length>>1)var t=this.head,n="next";else t=this.tail,n="prev",e=this._length-e-1;for(;0<e--&&t;)t=t[n];return t}}]),e}(),Wc=function(){function e(t,n){va(this,e),n=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},n),this.map=n.map(),this.items=new wz,this._size=0,this.opts=n,t&&this.into(t)}return eb(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return Yg((function(e){return[e.k,e]}),this.items)}},{key:"keys",value:function(){return Yg((function(e){return e.k}),this.items)}},{key:"values",value:function(){return Yg((function(e){return e.v}),this.items)}},{key:"copy",value:function(){var e=this.empty();e.items=this.items.copy();for(var t=e.items.head;t;)e.map.set(t.value.k,t),t=t.next;return e}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var e=this.opts.release;if(e){for(var t;t=this.items.drop();)e(t.k,t.v);return!0}return this.items.release()}},{key:"has",value:function(e){return this.map.has(e)}},{key:"get",value:function(e,t){return(e=this.map.get(e))?this.resetEntry(e):t}},{key:"set",value:function(e,t){var n=this.opts.ksize(e)+this.opts.vsize(t),r=this.map.get(e);return this._size+=Math.max(0,n-(r?r.value.s:0)),this.ensureSize()&&this.doSetEntry(r,e,t,n),t}},{key:"into",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this.set(n[0],n[1])}return this}},{key:"getSet",value:function(e,t){var n=this,r=this.map.get(e);return r?Promise.resolve(this.resetEntry(r)):t().then((function(t){return n.set(e,t)}))}},{key:"delete",value:function(e){return!!(e=this.map.get(e))&&(this.removeEntry(e),!0)}},{key:"resetEntry",value:function(e){return this.items.asTail(e),e.value.v}},{key:"ensureSize",value:function(){for(var e=this.opts.release,t=this.opts.maxsize,n=this.opts.maxlen;this._size>t||this.length>=n;){var r=this.items.drop();if(!r)return!1;this.map.delete(r.k),e&&e(r.k,r.v),this._size-=r.s}return!0}},{key:"removeEntry",value:function(e){var t=e.value;this.map.delete(t.k),this.items.remove(e),this.opts.release&&this.opts.release(t.k,t.v),this._size-=t.s}},{key:"doSetEntry",value:function(e,t,n,r){e?(e.value.v=n,e.value.s=r,this.items.asTail(e)):(this.items.push({k:t,v:n,s:r}),this.map.set(t,this.items.tail))}}]),e}(),xz=function(e){function t(e,r){return va(this,t),r=Object.assign({ttl:36e5},r),n.call(this,e,r)}Ga(t,e);var n=Ha(t);return eb(t,[{key:"empty",value:function(){return new t(null,this.opts)}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"get",value:function(e,t){if(e=this.map.get(e)){if(e.value.t>=Date.now())return this.resetEntry(e);this.removeEntry(e)}return t}},{key:"set",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,r=this.opts.ksize(e)+this.opts.vsize(t),i=this.map.get(e);return this._size+=Math.max(0,r-(i?i.value.s:0)),this.ensureSize()&&(n=Date.now()+n,i?(i.value.v=t,i.value.s=r,i.value.t=n,this.items.asTail(i)):(this.items.push({k:e,v:t,s:r,t:n}),this.map.set(e,this.items.tail))),t}},{key:"getSet",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.opts.ttl,i=this.get(e);return i?Promise.resolve(i):t().then((function(t){return n.set(e,t,r)}))}},{key:"prune",value:function(){for(var e=Date.now(),t=this.items.head;t;)t.value.t<e&&this.removeEntry(t),t=t.next}},{key:"ensureSize",value:function(){for(var e=this.opts.maxsize,n=this.opts.maxlen,r=Date.now(),i=this.items.head;i&&(this._size>e||this.length>=n);)i.value.t<r&&this.removeEntry(i),i=i.next;return Li(Td(t.prototype),"ensureSize",this).call(this)}}]),t}(Wc),Uq="object"==qa(Ya)&&Ya&&Ya.Object===Object&&Ya,yz="object"==("undefined"==typeof self?"undefined":qa(self))&&self&&self.Object===Object&&self,$b=Uq||yz||Function("return this")(),lc=$b.Symbol,Vq=Object.prototype,zz=Vq.hasOwnProperty,Az=Vq.toString,Eg=lc?lc.toStringTag:void 0,Bz=Object.prototype.toString,Wq=lc?lc.toStringTag:void 0,me=function(e){if(null==e)e=void 0===e?"[object Undefined]":"[object Null]";else if(Wq&&Wq in Object(e)){var t=zz.call(e,Eg),n=e[Eg];try{e[Eg]=void 0;var r=!0}catch(e){}var i=Az.call(e);r&&(t?e[Eg]=n:delete e[Eg]),e=i}else e=Bz.call(e);return e},Gb=function(e){var t=qa(e);return null!=e&&("object"==t||"function"==t)},jj=function(e){return!!Gb(e)&&("[object Function]"==(e=me(e))||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e)},dl=$b["__core-js_shared__"],Xq=(e=/[^.]+$/.exec(dl&&dl.keys&&dl.keys.IE_PROTO||""),e?"Symbol(src)_1."+e:""),Cz=Function.prototype.toString,ne=function(e){if(null!=e){try{return Cz.call(e)}catch(e){}return e+""}return""},Dz=/^\[object .+?Constructor\]$/,Ez=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),oe=function(e,t){return e=null==e?void 0:e[t],!Gb(e)||Xq&&Xq in e||!(jj(e)?Ez:Dz).test(ne(e))?void 0:e},Fg=oe(Object,"create"),Fz=Object.prototype.hasOwnProperty,Gz=Object.prototype.hasOwnProperty,e;Vd.prototype.clear=function(){this.__data__=Fg?Fg(null):{},this.size=0},Vd.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},Vd.prototype.get=function(e){var t=this.__data__;return Fg?"__lodash_hash_undefined__"===(e=t[e])?void 0:e:Fz.call(t,e)?t[e]:void 0},Vd.prototype.has=function(e){var t=this.__data__;return Fg?void 0!==t[e]:Gz.call(t,e)},Vd.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Fg&&void 0===t?"__lodash_hash_undefined__":t,this};var Gg=function(e,t){return e===t||e!=e&&t!=t},fi=function(e,t){for(var n=e.length;n--;)if(Gg(e[n][0],t))return n;return-1},Hz=Array.prototype.splice;Ee.prototype.clear=function(){this.__data__=[],this.size=0},Ee.prototype.delete=function(e){var t=this.__data__;return!(0>(e=fi(t,e))||(e==t.length-1?t.pop():Hz.call(t,e,1),--this.size,0))},Ee.prototype.get=function(e){var t=this.__data__;return 0>(e=fi(t,e))?void 0:t[e][1]},Ee.prototype.has=function(e){return-1<fi(this.__data__,e)},Ee.prototype.set=function(e,t){var n=this.__data__,r=fi(n,e);return 0>r?(++this.size,n.push([e,t])):n[r][1]=t,this};var $g=Ee,Hg=oe($b,"Map"),gi=function(e,t){e=e.__data__;var n=qa(t);return("string"==n||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==t:null===t)?e["string"==typeof t?"string":"hash"]:e.map};Fe.prototype.clear=function(){this.size=0,this.__data__={hash:new Vd,map:new(Hg||$g),string:new Vd}},Fe.prototype.delete=function(e){return e=gi(this,e).delete(e),this.size-=e?1:0,e},Fe.prototype.get=function(e){return gi(this,e).get(e)},Fe.prototype.has=function(e){return gi(this,e).has(e)},Fe.prototype.set=function(e,t){var n=gi(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};var Zg=Fe;Lf.prototype.add=Lf.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Lf.prototype.has=function(e){return this.__data__.has(e)};var Yq=function(e,t,n,r){var i=e.length;for(n+=r?1:-1;r?n--:++n<i;)if(t(e[n],n,e))return n;return-1},Iz=function(e){return e!=e},Jz=function(e,t){var n;if(n=!(null==e||!e.length)){if(t==t)e:{n=-1;for(var r=e.length;++n<r;)if(e[n]===t){e=n;break e}e=-1}else e=Yq(e,Iz,0);n=-1<e}return n},Kz=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1},Lz=function(e,t){return e.has(t)},uf=oe($b,"Set"),Mz=function(){},el=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n},Nz=1/0,Oz=uf&&1/el(new uf([,-0]))[1]==Nz?function(e){return new uf(e)}:Mz,fl=function(e,t,n){var r=-1,i=Jz,o=e.length,s=!0,a=[],c=a;if(n)s=!1,i=Kz;else if(200<=o){if(i=t?null:Oz(e))return el(i);s=!1,i=Lz,c=new Lf}else c=t?[]:a;e:for(;++r<o;){var u=e[r],l=t?t(u):u;if(u=n||0!==u?u:0,s&&l==l){for(var A=c.length;A--;)if(c[A]===l)continue e;t&&c.push(l),a.push(u)}else i(c,l,n)||(c!==a&&c.push(l),a.push(u))}return a},Zq=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var i=e[t];r[i[0]]=i[1]}return r},Je=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i};Ge.prototype.clear=function(){this.__data__=new $g,this.size=0},Ge.prototype.delete=function(e){var t=this.__data__;return e=t.delete(e),this.size=t.size,e},Ge.prototype.get=function(e){return this.__data__.get(e)},Ge.prototype.has=function(e){return this.__data__.has(e)},Ge.prototype.set=function(e,t){var n=this.__data__;if(n instanceof $g){var r=n.__data__;if(!Hg||199>r.length)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Zg(r)}return n.set(e,t),this.size=n.size,this};var Ie=Ge,su=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e},hi=function(){try{var e=oe(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Ig=function(e,t,n){"__proto__"==t&&hi?hi(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},Pz=Object.prototype.hasOwnProperty,Qm=function(e,t,n){var r=e[t];Pz.call(e,t)&&Gg(r,n)&&(void 0!==n||t in e)||Ig(e,t,n)},Ue=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?Ig(n,a,c):Qm(n,a,c)}return n},Hc=function(e){return null!=e&&"object"==qa(e)},$q=function(e){return Hc(e)&&"[object Arguments]"==me(e)},ar=Object.prototype,Qz=ar.hasOwnProperty,Rz=ar.propertyIsEnumerable,Vf=$q(function(){return arguments}())?$q:function(e){return Hc(e)&&Qz.call(e,"callee")&&!Rz.call(e,"callee")},ub=Array.isArray,Sz=function(){return!1},Nf=xb((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e;t=n&&n.exports===t?$b.Buffer:void 0,e.exports=(t?t.isBuffer:void 0)||Sz})),Tz=/^(?:0|[1-9]\d*)$/,gl=function(e,t){var n=qa(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Tz.test(e))&&-1<e&&0==e%1&&e<t},hl=function(e){return"number"==typeof e&&-1<e&&0==e%1&&9007199254740991>=e},Va={};Va["[object Float32Array]"]=Va["[object Float64Array]"]=Va["[object Int8Array]"]=Va["[object Int16Array]"]=Va["[object Int32Array]"]=Va["[object Uint8Array]"]=Va["[object Uint8ClampedArray]"]=Va["[object Uint16Array]"]=Va["[object Uint32Array]"]=!0,Va["[object Arguments]"]=Va["[object Array]"]=Va["[object ArrayBuffer]"]=Va["[object Boolean]"]=Va["[object DataView]"]=Va["[object Date]"]=Va["[object Error]"]=Va["[object Function]"]=Va["[object Map]"]=Va["[object Number]"]=Va["[object Object]"]=Va["[object RegExp]"]=Va["[object Set]"]=Va["[object String]"]=Va["[object WeakMap]"]=!1;var Uz=function(e){return Hc(e)&&hl(e.length)&&!!Va[me(e)]},ii=function(e){return function(t){return e(t)}},vf=xb((function(e,t){var n=t&&!t.nodeType&&t;n=(t=n&&e&&!e.nodeType&&e)&&t.exports===n&&Uq.process;e:{try{var r=t&&t.require&&t.require("util").types;if(r){var i=r;break e}i=n&&n.binding&&n.binding("util");break e}catch(e){}i=void 0}e.exports=i})),br=vf&&vf.isTypedArray,Ui=br?ii(br):Uz,Vz=Object.prototype.hasOwnProperty,cr=function(e,t){var n=ub(e),r=!n&&Vf(e),i=!n&&!r&&Nf(e),o=!n&&!r&&!i&&Ui(e);if(n=n||r||i||o){r=e.length;for(var s=String,a=-1,c=Array(r);++a<r;)c[a]=s(a);r=c}else r=[];for(var u in s=r.length,e)!t&&!Vz.call(e,u)||n&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||gl(u,s))||r.push(u);return r},Wz=Object.prototype,il=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Wz)},dr=function(e,t){return function(n){return e(t(n))}},Xz=dr(Object.keys,Object),Yz=Object.prototype.hasOwnProperty,ae=function(e){return null!=e&&hl(e.length)&&!jj(e)},Wd=function(e){if(ae(e))e=cr(e);else if(il(e)){var t,n=[];for(t in Object(e))Yz.call(e,t)&&"constructor"!=t&&n.push(t);e=n}else e=Xz(e);return e},ou=function(e,t){return e&&Ue(t,Wd(t),e)},Zz=Object.prototype.hasOwnProperty,Of=function(e){if(ae(e))e=cr(e,!0);else if(Gb(e)){var t=il(e),n=[];for(r in e)("constructor"!=r||!t&&Zz.call(e,r))&&n.push(r);e=n}else{var r=[];if(null!=e)for(t in Object(e))r.push(t);e=r}return e},mu=function(e,t){return e&&Ue(t,Of(t),e)},Nm=xb((function(e,t){var n=(t=t&&!t.nodeType&&t)&&e&&!e.nodeType&&e,r=(t=n&&n.exports===t?$b.Buffer:void 0)?t.allocUnsafe:void 0;e.exports=function(e,t){return t?e.slice():(t=e.length,t=r?r(t):new e.constructor(t),e.copy(t),t)}})),Pi=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t},$z=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o},er=function(){return[]},aA=Object.prototype.propertyIsEnumerable,fr=Object.getOwnPropertySymbols,jl=fr?function(e){return null==e?[]:(e=Object(e),$z(fr(e),(function(t){return aA.call(e,t)})))}:er,nu=function(e,t){return Ue(e,jl(e),t)},Ti=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},kl=dr(Object.getPrototypeOf,Object),gr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Ti(t,jl(e)),e=kl(e);return t}:er,lu=function(e,t){return Ue(e,gr(e),t)},hr=function(e,t,n){return t=t(e),ub(e)?t:Ti(t,n(e))},Qi=function(e){return hr(e,Wd,jl)},Pm=function(e){return hr(e,Of,gr)},ll=oe($b,"DataView"),ml=oe($b,"Promise"),nl=oe($b,"WeakMap"),bA=ne(ll),cA=ne(Hg),dA=ne(ml),eA=ne(uf),fA=ne(nl),pe=me;(ll&&"[object DataView]"!=pe(new ll(new ArrayBuffer(1)))||Hg&&"[object Map]"!=pe(new Hg)||ml&&"[object Promise]"!=pe(ml.resolve())||uf&&"[object Set]"!=pe(new uf)||nl&&"[object WeakMap]"!=pe(new nl))&&(pe=function(e){var t=me(e);if(e=(e="[object Object]"==t?e.constructor:void 0)?ne(e):"")switch(e){case bA:return"[object DataView]";case cA:return"[object Map]";case dA:return"[object Promise]";case eA:return"[object Set]";case fA:return"[object WeakMap]"}return t});var Mf=pe,gA=Object.prototype.hasOwnProperty,ku=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&gA.call(e,"index")&&(n.index=e.index,n.input=e.input),n},ji=$b.Uint8Array,ol=function(e){var t=new e.constructor(e.byteLength);return new ji(t).set(new ji(e)),t},hA=/\w*$/,ir=lc?lc.prototype:void 0,jr=ir?ir.valueOf:void 0,Bn=function(e,t){return t=t?ol(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.length)},pu=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return ol(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return t=n?ol(e.buffer):e.buffer,new e.constructor(t,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Bn(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return(t=new e.constructor(e.source,hA.exec(e))).lastIndex=e.lastIndex,t;case"[object Symbol]":return jr?Object(jr.call(e)):{}}},kr=Object.create,iA=function(){function e(){}return function(t){return Gb(t)?kr?kr(t):(e.prototype=t,t=new e,e.prototype=void 0,t):{}}}(),Om=function(e){return"function"!=typeof e.constructor||il(e)?{}:iA(kl(e))},jA=function(e){return Hc(e)&&"[object Map]"==Mf(e)},lr=vf&&vf.isMap,ru=lr?ii(lr):jA,kA=function(e){return Hc(e)&&"[object Set]"==Mf(e)},mr=vf&&vf.isSet,qu=mr?ii(mr):kA,Oa={};Oa["[object Arguments]"]=Oa["[object Array]"]=Oa["[object ArrayBuffer]"]=Oa["[object DataView]"]=Oa["[object Boolean]"]=Oa["[object Date]"]=Oa["[object Float32Array]"]=Oa["[object Float64Array]"]=Oa["[object Int8Array]"]=Oa["[object Int16Array]"]=Oa["[object Int32Array]"]=Oa["[object Map]"]=Oa["[object Number]"]=Oa["[object Object]"]=Oa["[object RegExp]"]=Oa["[object Set]"]=Oa["[object String]"]=Oa["[object Symbol]"]=Oa["[object Uint8Array]"]=Oa["[object Uint8ClampedArray]"]=Oa["[object Uint16Array]"]=Oa["[object Uint32Array]"]=!0,Oa["[object Error]"]=Oa["[object Function]"]=Oa["[object WeakMap]"]=!1;var Ke=function(e){return"symbol"==qa(e)||Hc(e)&&"[object Symbol]"==me(e)},lA=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,mA=/^\w*$/,pl=function(e,t){if(ub(e))return!1;var n=qa(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Ke(e))||mA.test(e)||!lA.test(e)||null!=t&&e in Object(t)};Ri.Cache=Zg;var nA=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,oA=/\\(\\)?/g,pA=function(e){var t=(e=Ri(e,(function(e){return 500===t.size&&t.clear(),e}))).cache;return e}((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(nA,(function(e,n,r,i){t.push(r?i.replace(oA,"$1"):n||e)})),t})),tu=1/0,nr=lc?lc.prototype:void 0,Sm=nr?nr.toString:void 0,ki=function(e,t){return ub(e)?e:pl(e,t)?[e]:pA(null==e?"":Rm(e))},qA=1/0,Jg=function(e){if("string"==typeof e||Ke(e))return e;var t=e+"";return"0"==t&&1/e==-qA?"-0":t},li=function(e,t){for(var n=0,r=(t=ki(t,e)).length;null!=e&&n<r;)e=e[Jg(t[n++])];return n&&n==r?e:void 0},rA=function(e,t){if(!(2>(t=ki(t,e)).length)){var n=t,r=0,i=-1,o=-1,s=n.length;for(0>r&&(r=-r>s?0:s+r),0>(i=i>s?s:i)&&(i+=s),s=r>i?0:i-r>>>0,r>>>=0,i=Array(s);++o<s;)i[o]=n[o+r];e=li(e,i)}return(n=null==e)||(n=null==t?0:t.length,n=delete e[Jg(n?t[n-1]:void 0)]),n},or=Function.prototype.toString,sA=Object.prototype.hasOwnProperty,tA=or.call(Object),Cn=function(e){return!(!Hc(e)||"[object Object]"!=me(e))&&(null===(e=kl(e))||"function"==typeof(e=sA.call(e,"constructor")&&e.constructor)&&e instanceof e&&or.call(e)==tA)},uA=function(e){return Cn(e)?void 0:e},pr=lc?lc.isConcatSpreadable:void 0,uu=function(e){return ub(e)||Vf(e)||!!(pr&&e&&e[pr])},vA=function(e){return null!=e&&e.length?Si(e,1):[]},wA=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)},qr=Math.max,rr=function(e,t,n){return t=qr(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=qr(r.length-t,0),s=Array(o);++i<o;)s[i]=r[t+i];for(i=-1,o=Array(t+1);++i<t;)o[i]=r[i];return o[t]=n(s),wA(e,this,o)}},xA=function(e){return function(){return e}},mi=function(e){return e},yA=Date.now,sr=function(e){var t=0,n=0;return function(){var r=yA(),i=16-(r-n);if(n=r,0<i){if(800<=++t)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}(hi?function(e,t){return hi(e,"toString",{configurable:!0,enumerable:!1,value:xA(t),writable:!0})}:mi),ql=function(e){return sr(rr(e,void 0,vA),e+"")}((function(e,t){var n={};if(null==e)return n;var r=!1;t=Je(t,(function(t){return t=ki(t,e),r||(r=1<t.length),t})),Ue(e,Pm(e),n),r&&(n=He(n,7,uA));for(var i=t.length;i--;)rA(n,t[i]);return n})),zA=function(e,t,n,r){for(var i=-1,o=null==e?0:e.length;++i<o;){var s=e[i];t(r,s,n(s),e)}return r},An=function(e,t,n){for(var r=-1,i=Object(e),o=(n=n(e)).length;o--;){var s=n[++r];if(!1===t(i[s],s,i))break}return e},tr=function(e,t){return e&&An(e,t,Wd)},rl=function(e,t){return function(t,n){if(null==t)return t;if(!ae(t))return e(t,n);for(var r=t.length,i=-1,o=Object(t);++i<r&&!1!==n(o[i],i,o););return t}}(tr),AA=function(e,t,n,r){return rl(e,(function(e,i,o){t(r,e,n(e),o)})),r},ur=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},Tm=function(e,t,n,r,i,o){var s=1&n,a=e.length,c=t.length;if(a!=c&&!(s&&c>a))return!1;c=o.get(e);var u=o.get(t);if(c&&u)return c==t&&u==e;c=-1,u=!0;var l=2&n?new Lf:void 0;for(o.set(e,t),o.set(t,e);++c<a;){var A=e[c],h=t[c];if(r)var d=s?r(h,A,c,t,e,o):r(A,h,c,e,t,o);if(void 0!==d){if(d)continue;u=!1;break}if(l){if(!ur(t,(function(e,t){if(!l.has(t)&&(A===e||i(A,e,n,r,o)))return l.push(t)}))){u=!1;break}}else if(A!==h&&!i(A,h,n,r,o)){u=!1;break}}return o.delete(e),o.delete(t),u},BA=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},vr=lc?lc.prototype:void 0,sl=vr?vr.valueOf:void 0,vu=function(e,t,n,r,i,o,s){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":if(e.byteLength!=t.byteLength||!o(new ji(e),new ji(t)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return Gg(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=BA;case"[object Set]":if(a||(a=el),e.size!=t.size&&!(1&r))break;return(n=s.get(e))?n==t:(r|=2,s.set(e,t),t=Tm(a(e),a(t),r,i,o,s),s.delete(e),t);case"[object Symbol]":if(sl)return sl.call(e)==sl.call(t)}return!1},wu=Object.prototype.hasOwnProperty,Um=Object.prototype.hasOwnProperty,CA=function(e,t,n,r){var i=n.length,o=i,s=!r;if(null==e)return!o;for(e=Object(e);i--;){var a=n[i];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++i<o;){var c=(a=n[i])[0],u=e[c],l=a[1];if(s&&a[2]){if(void 0===u&&!(c in e))return!1}else{if(a=new Ie,r)var A=r(u,l,c,e,t,a);if(void 0===A?!Le(l,u,3,r,a):!A)return!1}}return!0},DA=function(e){for(var t=Wd(e),n=t.length;n--;){var r=t[n],i=e[r];t[n]=[r,i,i==i&&!Gb(i)]}return t},wr=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},EA=function(e){var t=DA(e);return 1==t.length&&t[0][2]?wr(t[0][0],t[0][1]):function(n){return n===e||CA(n,e,t)}},FA=function(e,t){return pl(e)&&t==t&&!Gb(t)?wr(Jg(e),t):function(n){var r=null==n?void 0:li(n,e);if(void 0===(r=void 0===r?void 0:r)&&r===t){if(r=null!=n){for(var i=-1,o=(r=ki(r=e,n)).length,s=!1;++i<o;){var a=Jg(r[i]);if(!(s=null!=n&&null!=n&&a in Object(n)))break;n=n[a]}r=s||++i!=o?s:!!(o=null==n?0:n.length)&&hl(o)&&gl(a,o)&&(ub(n)||Vf(n))}a=r}else a=Le(t,r,3);return a}},GA=function(e){return function(t){return null==t?void 0:t[e]}},HA=function(e){return function(t){return li(t,e)}},wf=function(e){return"function"==typeof e?e:null==e?mi:"object"==qa(e)?ub(e)?FA(e[0],e[1]):EA(e):pl(e)?GA(Jg(e)):HA(e)},tl=function(e,t){return function(t,n){return(ub(t)?zA:AA)(t,e,wf(n),{})}}((function(e,t,n){Ig(e,n,t)})),md=function(e,t){var n={};return t=wf(t),tr(e,(function(e,r,i){Ig(n,r,t(e,r,i))})),n};ea({target:"String",proto:!0,forced:la((function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length}))},{sub:function(){return"<sub>"+String(Eb(this))+"</sub>"}});var P=Pa,mc=null;try{mc=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(c){}Pa.prototype.__isLong__,Object.defineProperty(Pa.prototype,"__isLong__",{value:!0}),Pa.isLong=Hb;var Wm={},Vm={};Pa.fromInt=Xd,Pa.fromNumber=ec,Pa.fromBits=Qa;var ah=Math.pow;Pa.fromString=Vi,Pa.fromValue=vc;var Me=4294967296,Xm=Me*Me,Zm=Xm/2,xr=Xd(16777216),fc=Xd(0);Pa.ZERO=fc;var Yd=Xd(0,!0);Pa.UZERO=Yd;var xf=Xd(1);Pa.ONE=xf;var yr=Xd(1,!0);Pa.UONE=yr;var ul=Xd(-1);Pa.NEG_ONE=ul;var $m=Qa(-1,2147483647,!1);Pa.MAX_VALUE=$m;var Ym=Qa(-1,-1,!0);Pa.MAX_UNSIGNED_VALUE=Ym;var Ib=Qa(0,-2147483648,!1);Pa.MIN_VALUE=Ib;var V=Pa.prototype;V.toInt=function(){return this.unsigned?this.low>>>0:this.low},V.toNumber=function(){return this.unsigned?(this.high>>>0)*Me+(this.low>>>0):this.high*Me+(this.low>>>0)},V.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Ib)){var t=ec(e),n=this.div(t);return t=n.mul(t).sub(this),n.toString(e)+t.toInt().toString(e)}return"-"+this.neg().toString(e)}n=ec(ah(e,6),this.unsigned),t=this;for(var r="";;){var i=t.div(n),o=(t.sub(i.mul(n)).toInt()>>>0).toString(e);if((t=i).isZero())return o+r;for(;6>o.length;)o="0"+o;r=""+o+r}},V.getHighBits=function(){return this.high},V.getHighBitsUnsigned=function(){return this.high>>>0},V.getLowBits=function(){return this.low},V.getLowBitsUnsigned=function(){return this.low>>>0},V.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Ib)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;0<t&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},V.isZero=function(){return 0===this.high&&0===this.low},V.eqz=V.isZero,V.isNegative=function(){return!this.unsigned&&0>this.high},V.isPositive=function(){return this.unsigned||0<=this.high},V.isOdd=function(){return 1==(1&this.low)},V.isEven=function(){return 0==(1&this.low)},V.equals=function(e){return Hb(e)||(e=vc(e)),(this.unsigned===e.unsigned||1!=this.high>>>31||1!=e.high>>>31)&&this.high===e.high&&this.low===e.low},V.eq=V.equals,V.notEquals=function(e){return!this.eq(e)},V.neq=V.notEquals,V.ne=V.notEquals,V.lessThan=function(e){return 0>this.comp(e)},V.lt=V.lessThan,V.lessThanOrEqual=function(e){return 0>=this.comp(e)},V.lte=V.lessThanOrEqual,V.le=V.lessThanOrEqual,V.greaterThan=function(e){return 0<this.comp(e)},V.gt=V.greaterThan,V.greaterThanOrEqual=function(e){return 0<=this.comp(e)},V.gte=V.greaterThanOrEqual,V.ge=V.greaterThanOrEqual,V.compare=function(e){if(Hb(e)||(e=vc(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},V.comp=V.compare,V.negate=function(){return!this.unsigned&&this.eq(Ib)?Ib:this.not().add(xf)},V.neg=V.negate,V.add=function(e){Hb(e)||(e=vc(e));var t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=e.high>>>16,o=65535&e.high,s=e.low>>>16;return r=(s=((e=(65535&this.low)+(65535&e.low))>>>16)+(r+s))>>>16,Qa((65535&s)<<16|65535&e,(t=((r+=n+o)>>>16)+(t+i)&65535)<<16|65535&r,this.unsigned)},V.subtract=function(e){return Hb(e)||(e=vc(e)),this.add(e.neg())},V.sub=V.subtract,V.multiply=function(e){if(this.isZero())return fc;if(Hb(e)||(e=vc(e)),mc){var t=mc.mul(this.low,this.high,e.low,e.high);return Qa(t,mc.get_high(),this.unsigned)}if(e.isZero())return fc;if(this.eq(Ib))return e.isOdd()?Ib:fc;if(e.eq(Ib))return this.isOdd()?Ib:fc;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(xr)&&e.lt(xr))return ec(this.toNumber()*e.toNumber(),this.unsigned);t=this.high>>>16;var n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,a=e.low>>>16,c=i*(e=65535&e.low),u=(c>>>16)+r*e,l=u>>>16;l+=(u=(65535&u)+i*a)>>>16;var A=(l+=n*e)>>>16;return Qa((65535&u)<<16|65535&c,(A=(A+=(l=(65535&l)+r*a)>>>16)+((l=(65535&l)+i*s)>>>16)+(t*e+n*a+r*s+i*o)&65535)<<16|65535&l,this.unsigned)},V.mul=V.multiply,V.divide=function(e){if(Hb(e)||(e=vc(e)),e.isZero())throw Error("division by zero");if(mc)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?Qa(e=(this.unsigned?mc.div_u:mc.div_s)(this.low,this.high,e.low,e.high),mc.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Yd:fc;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Yd;if(e.gt(this.shru(1)))return yr;var t=Yd}else{if(this.eq(Ib)){if(e.eq(xf)||e.eq(ul))return Ib;if(e.eq(Ib))return xf;var n=this.shr(1).div(e).shl(1);if(n.eq(fc))return e.isNegative()?xf:ul;var r=this.sub(e.mul(n));return n.add(r.div(e))}if(e.eq(Ib))return this.unsigned?Yd:fc;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();t=fc}for(r=this;r.gte(e);){n=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));var i=Math.ceil(Math.log(n)/Math.LN2);i=48>=i?1:ah(2,i-48);for(var o=ec(n),s=o.mul(e);s.isNegative()||s.gt(r);)s=(o=ec(n-=i,this.unsigned)).mul(e);o.isZero()&&(o=xf),t=t.add(o),r=r.sub(s)}return t},V.div=V.divide,V.modulo=function(e){return Hb(e)||(e=vc(e)),mc?Qa(e=(this.unsigned?mc.rem_u:mc.rem_s)(this.low,this.high,e.low,e.high),mc.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},V.mod=V.modulo,V.rem=V.modulo,V.not=function(){return Qa(~this.low,~this.high,this.unsigned)},V.and=function(e){return Hb(e)||(e=vc(e)),Qa(this.low&e.low,this.high&e.high,this.unsigned)},V.or=function(e){return Hb(e)||(e=vc(e)),Qa(this.low|e.low,this.high|e.high,this.unsigned)},V.xor=function(e){return Hb(e)||(e=vc(e)),Qa(this.low^e.low,this.high^e.high,this.unsigned)},V.shiftLeft=function(e){return Hb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?Qa(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Qa(0,this.low<<e-32,this.unsigned)},V.shl=V.shiftLeft,V.shiftRight=function(e){return Hb(e)&&(e=e.toInt()),0==(e&=63)?this:32>e?Qa(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Qa(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},V.shr=V.shiftRight,V.shiftRightUnsigned=function(e){if(Hb(e)&&(e=e.toInt()),0==(e&=63))return this;var t=this.high;return 32>e?Qa(this.low>>>e|t<<32-e,t>>>e,this.unsigned):Qa(32===e?t:t>>>e-32,0,this.unsigned)},V.shru=V.shiftRightUnsigned,V.shr_u=V.shiftRightUnsigned,V.toSigned=function(){return this.unsigned?Qa(this.low,this.high,!1):this},V.toUnsigned=function(){return this.unsigned?this:Qa(this.low,this.high,!0)},V.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},V.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},V.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},Pa.fromBytes=function(e,t,n){return n?Pa.fromBytesLE(e,t):Pa.fromBytesBE(e,t)},Pa.fromBytesLE=function(e,t){return new Pa(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},Pa.fromBytesBE=function(e,t){return new Pa(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)};var Wi=function(e,t){return(Wi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},vl=!1,gc={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+Error().stack):vl&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),vl=e},get useDeprecatedSynchronousErrorHandling(){return vl}},ni={closed:!0,next:function(e){},error:function(e){if(gc.useDeprecatedSynchronousErrorHandling)throw e;Oe(e)},complete:function(){}},hc=Array.isArray||function(e){return e&&"number"==typeof e.length},Pf=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),nb=function(){function e(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){if(!this.closed){var t=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t instanceof e)t.remove(this);else if(null!==t)for(var o=0;o<t.length;++o)t[o].remove(this);if(Ne(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){var s=e instanceof Pf?an(e.errors):[e]}}if(hc(i))for(o=-1,t=i.length;++o<t;)if(Xi(n=i[o]))try{n.unsubscribe()}catch(e){s=s||[],e instanceof Pf?s=s.concat(an(e.errors)):s.push(e)}if(s)throw new Pf(s)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(qa(t)){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof e||(t=n,(n=new e)._subscriptions=[t]);break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}if(null===(t=n._parentOrParents))n._parentOrParents=this;else if(t instanceof e){if(t===this)return n;n._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return n;t.push(this)}return null===(t=this._subscriptions)?this._subscriptions=[n]:t.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;t&&-1!==(e=t.indexOf(e))&&t.splice(e,1)},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}(),oi="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),za=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=ni;break;case 1:if(!n){o.destination=ni;break}if("object"===qa(n)){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new zr(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new zr(o,n,r,i)}return o}return ha(t,e),t.prototype[oi]=function(){return this},t.create=function(e,n,r){return(e=new t(e,n,r)).syncErrorThrowable=!1,e},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=e,this},t}(nb),zr=function(e){function t(t,n,r,i){var o=e.call(this)||this;if(o._parentSubscriber=t,t=o,Ne(n))var s=n;else n&&(s=n.next,r=n.error,i=n.complete,n!==ni&&(Ne((t=Object.create(n)).unsubscribe)&&o.add(t.unsubscribe.bind(t)),t.unsubscribe=o.unsubscribe.bind(o)));return o._context=t,o._next=s,o._error=r,o._complete=i,o}return ha(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;gc.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=gc.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?this.__tryOrSetError(t,this._error,e):this.__tryOrUnsub(this._error,e),this.unsubscribe();else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):Oe(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;Oe(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};gc.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,n):this.__tryOrUnsub(n)}this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),gc.useDeprecatedSynchronousErrorHandling)throw e;Oe(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!gc.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{t.call(this._context,n)}catch(t){return gc.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0):Oe(t),!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._parentSubscriber=this._context=null,e.unsubscribe()},t}(za),Pe="function"==typeof Symbol&&Symbol.observable||"@@observable",ua=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator;e:{if(e){if(e instanceof za)break e;if(e[oi]){e=e[oi]();break e}}e=e||t||n?new za(e,t,n):new za(ni)}if(r?e.add(r.call(e,this.source)):e.add(this.source||gc.useDeprecatedSynchronousErrorHandling&&!e.syncErrorThrowable?this._subscribe(e):this._trySubscribe(e)),gc.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable&&(e.syncErrorThrowable=!1,e.syncErrorThrown))throw e.syncErrorValue;return e},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){gc.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),Yi(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=cn(t))((function(t,r){var i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[Pe]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:bn(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=cn(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}(),Ld=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),Ar=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return ha(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;this.subject=null,!t||0===t.length||e.isStopped||e.closed||-1!==(e=t.indexOf(this.subscriber))&&t.splice(e,1)}},t}(nb),Br=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return ha(t,e),t}(za),rb=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return ha(t,e),t.prototype[oi]=function(){return new Br(this)},t.prototype.lift=function(e){var t=new Cr(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new Ld;if(!this.isStopped){var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].next(e)}},t.prototype.error=function(e){if(this.closed)throw new Ld;this.hasError=!0,this.thrownError=e,this.isStopped=!0;var t=this.observers,n=t.length;t=t.slice();for(var r=0;r<n;r++)t[r].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new Ld;this.isStopped=!0;var e=this.observers,t=e.length;e=e.slice();for(var n=0;n<t;n++)e[n].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new Ld;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new Ld;return this.hasError?(e.error(this.thrownError),nb.EMPTY):this.isStopped?(e.complete(),nb.EMPTY):(this.observers.push(e),new Ar(this,e))},t.prototype.asObservable=function(){var e=new ua;return e.source=this,e},t.create=function(e,t){return new Cr(e,t)},t}(ua),Cr=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return ha(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):nb.EMPTY},t}(rb),xu=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;return n._refCount++,e=new IA(e,n),t=t.subscribe(e),e.closed||(e.connection=n.connect()),t},e}(),IA=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return ha(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null},t}(za),Dr=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return ha(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new nb).add(this.source.subscribe(new JA(this.getSubject(),this))),e.closed&&(this._connection=null,e=nb.EMPTY)),e},t.prototype.refCount=function(){return dn()(this)},t}(ua),lv=function(){var e=Dr.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),JA=function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}return ha(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(Br);!function(e){function t(t,n){return(t=e.call(this,t)||this).connectable=n,t}ha(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;0>=t?this.connection=null:(e._refCount=t-1,1<t?this.connection=null:(t=this.connection,e=e._connection,this.connection=null,!e||t&&e!==t||e.unsubscribe()))}else this.connection=null}}(za),function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).keySelector=n,t.elementSelector=r,t.durationSelector=i,t.subjectSelector=o,t.groups=null,t.attemptedToUnsubscribe=!1,t.count=0,t}ha(t,e),t.prototype._next=function(e){try{var t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r=n.get(t);if(this.elementSelector)try{var i=this.elementSelector(e)}catch(e){this.error(e)}else i=e;if(!r&&(r=this.subjectSelector?this.subjectSelector():new rb,n.set(t,r),e=new wl(t,r,this),this.destination.next(e),this.durationSelector)){e=void 0;try{e=this.durationSelector(new wl(t,r))}catch(e){return void this.error(e)}this.add(e.subscribe(new KA(t,r,this)))}r.closed||r.next(i)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,n){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))}}(za);var KA=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return ha(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(za),wl=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return ha(t,e),t.prototype._subscribe=function(e){var t=new nb,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new LA(n)),t.add(r.subscribe(e)),t},t}(ua),LA=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return ha(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),--t.count,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(nb),MA=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return ha(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ld;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(rb),Kg=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return ha(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,e=this.id;var n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(e=this._execute(e,t))?e:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t.prototype._execute=function(e,t){t=!1;var n=void 0;try{this.work(e)}catch(e){t=!0,n=!!e&&e||Error(e)}if(t)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(function(e){function t(t,n){return e.call(this)||this}return ha(t,e),t.prototype.schedule=function(e,t){return this},t}(nb)),NA=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return ha(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),0<n?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return 0<n||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(Kg),xl=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),Lg=function(e){function t(n,r){void 0===r&&(r=xl.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return ha(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(xl),Mg=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t}(Lg))(NA),Sb=new ua((function(e){return e.complete()})),en=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}},yl;!function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"}(yl||(yl={}));var yf=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return ob(this.value);case"E":return ra(this.error);case"C":return Qf()}throw Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Bu=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new Er(e,this.scheduler,this.delay))},e}(),Er=function(e){function t(t,n,r){return void 0===r&&(r=0),(t=e.call(this,t)||this).scheduler=n,t.delay=r,t}return ha(t,e),t.dispatch=function(e){e.notification.observe(e.destination),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new OA(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(yf.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(yf.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(yf.createComplete()),this.unsubscribe()},t}(za),OA=function(e,t){this.notification=e,this.destination=t},Te=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=1>t?1:t,i._windowTime=1>n?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return ha(t,e),t.prototype.nextInfiniteTimeWindow=function(t){if(!this.isStopped){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift()}e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this.isStopped||(this._events.push(new PA(this._getNow(),t)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t=this._infiniteTimeWindow,n=t?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;if(this.closed)throw new Ld;if(this.isStopped||this.hasError)var o=nb.EMPTY;else this.observers.push(e),o=new Ar(this,e);if(r&&e.add(e=new Er(e,r)),t)for(t=0;t<i&&!e.closed;t++)e.next(n[t]);else for(t=0;t<i&&!e.closed;t++)e.next(n[t].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),o},t.prototype._getNow=function(){return(this.scheduler||Mg).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),0<o&&r.splice(0,o),r},t}(rb),PA=function(e,t){this.time=e,this.value=t},Sf=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return ha(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),nb.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),nb.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(rb),QA=1,RA=Promise.resolve(),aj={},Fr={setImmediate:function(e){var t=QA++;return aj[t]=!0,RA.then((function(){return fn(t)&&e()})),t},clearImmediate:function(e){fn(e)}},SA=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return ha(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=Fr.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(Fr.clearImmediate(n),t.scheduled=void 0)},t}(Kg),kj=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(Lg))(SA),TA=kj,zl=new Lg(Kg),cd=zl,UA=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return ha(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&0<r?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&0<r||null===r&&0<this.delay)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(Kg),Gr=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(Lg))(UA),VA=function(e){function t(t,n){void 0===t&&(t=Hr),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return ha(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(Lg),Hr=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return ha(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){return void 0===r&&(r=0),this.delay=e.frame+r,(e=e.actions).push(this),e.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(Kg),Al=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),eh=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),Tb=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Cu=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new WA(e,this.project,this.thisArg))},e}(),WA=function(e){function t(t,n,r){return(t=e.call(this,t)||this).project=n,t.count=0,t.thisArg=r||t,t}return ha(t,e),t.prototype._next=function(e){try{var t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(za),Bl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(za),Hu=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return ha(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(za),XA=function(e){return function(t){return e.then((function(e){t.closed||(t.next(e),t.complete())}),(function(e){return t.error(e)})).then(null,Oe),t}},xd="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",YA=function(e){return function(t){for(var n=e[xd]();;){var r=void 0;try{r=n.next()}catch(e){return t.error(e),t}if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add((function(){n.return&&n.return()})),t}},ZA=function(e){return function(t){var n=e[Pe]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}},mn=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e},Tf=function(e){if(e&&"function"==typeof e[Pe])return ZA(e);if(mn(e))return en(e);if(kn(e))return XA(e);if(e&&"function"==typeof e[xd])return YA(e);throw e=Xi(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Ir={},aB=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new $A(e,this.resultSelector))},e}(),$A=function(e){function t(t,n){return(t=e.call(this,t)||this).resultSelector=n,t.active=0,t.values=[],t.observables=[],t}return ha(t,e),t.prototype._next=function(e){this.values.push(Ir),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.toRespond=this.active=t;for(var n=0;n<t;n++)this.add(bj(this,e[n],void 0,n))}},t.prototype.notifyComplete=function(e){0==--this.active&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=(e=this.values)[n];r=this.toRespond?r===Ir?--this.toRespond:this.toRespond:0,e[n]=t,0===r&&(this.resultSelector?this._tryResultSelector(e):this.destination.next(e.slice()))},t.prototype._tryResultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Bl),nd=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return ha(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(za);!function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i}ha(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(za);var od=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(za);!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}ha(t,e),t.prototype.notifyNext=function(e,t,n,r){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()}}(za);var Lu=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new bB(e,this.project,this.concurrent))},e}(),bB=function(e){function t(t,n,r){return void 0===r&&(r=Number.POSITIVE_INFINITY),(t=e.call(this,t)||this).project=n,t.concurrent=r,t.hasCompleted=!1,t.buffer=[],t.active=0,t.index=0,t}return ha(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(n)},t.prototype._innerSub=function(e){var t=new nd(this),n=this.destination;n.add(t),(e=bd(e,t))!==t&&n.add(e)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,0<e.length?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(od),Cl=R.parseFloat,Jr=-1/0!=1/Cl("\t\n\v\f\r Â áââââââââââââ¯âã\u2028\u2029\ufeff-0")?function(e){e=Oj(String(e));var t=Cl(e);return 0===t&&"-"==e.charAt(0)?-0:t}:Cl;ea({global:!0,forced:parseFloat!=Jr},{parseFloat:Jr});var Dl=new ua(Ic),Qu=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new cB(e,this.predicate,this.thisArg))},e}(),cB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).predicate=n,t.thisArg=r,t.count=0,t}return ha(t,e),t.prototype._next=function(e){try{var t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(za),Ru=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new dB(e))},e}(),dB=function(e){function t(t){return(t=e.call(this,t)||this).hasFirst=!1,t.observables=[],t.subscriptions=[],t}return ha(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=bj(this,e[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){for(this.hasFirst=!0,e=0;e<this.subscriptions.length;e++)if(e!==n){var r=this.subscriptions[e];r.unsubscribe(),this.remove(r)}this.subscriptions=null}this.destination.next(t)},t}(Bl),Uu=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new eB(e,this.resultSelector))},e}(),eB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).resultSelector=n,t.iterators=[],t.active=0,t.resultSelector="function"==typeof n?n:void 0,t}return ha(t,e),t.prototype._next=function(e){var t=this.iterators;hc(e)?t.push(new fB(e)):"function"==typeof e[xd]?t.push(new gB(e[xd]())):t.push(new hB(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0===t)this.destination.complete();else{this.active=t;for(var n=0;n<t;n++){var r=e[n];r.stillUnsubscribed?this.destination.add(r.subscribe()):this.active--}}},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){var i=e[r];if("function"==typeof i.hasValue&&!i.hasValue())return}var o=!1,s=[];for(r=0;r<t;r++){var a=(i=e[r]).next();if(i.hasCompleted()&&(o=!0),a.done)return void n.complete();s.push(a.value)}this.resultSelector?this._tryresultSelector(s):n.next(s),o&&n.complete()},t.prototype._tryresultSelector=function(e){try{var t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(za),gB=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return!(!e||!e.done)},e}(),fB=function(){function e(e){this.array=e,this.length=this.index=0,this.length=e.length}return e.prototype[xd]=function(){return this},e.prototype.next=function(e){e=this.index++;var t=this.array;return e<this.length?{value:t[e],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),hB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).parent=n,t.observable=r,t.stillUnsubscribed=!0,t.buffer=[],t.isComplete=!1,t}return ha(t,e),t.prototype[xd]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return 0<this.buffer.length},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return bd(this.observable,new nd(this))},t}(od),iB=Object.freeze({__proto__:null,Observable:ua,ConnectableObservable:Dr,GroupedObservable:wl,observable:Pe,Subject:rb,BehaviorSubject:MA,ReplaySubject:Te,AsyncSubject:Sf,asap:TA,asapScheduler:kj,async:cd,asyncScheduler:zl,queue:Mg,queueScheduler:Mg,animationFrame:Gr,animationFrameScheduler:Gr,VirtualTimeScheduler:VA,VirtualAction:Hr,Scheduler:xl,Subscription:nb,Subscriber:za,Notification:yf,get NotificationKind(){return yl},pipe:Zi,noop:Ic,identity:wd,isObservable:function(e){return!!e&&(e instanceof ua||"function"==typeof e.lift&&"function"==typeof e.subscribe)},ArgumentOutOfRangeError:Al,EmptyError:eh,ObjectUnsubscribedError:Ld,UnsubscriptionError:Pf,TimeoutError:Tb,bindCallback:gn,bindNodeCallback:hn,combineLatest:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=t=void 0;return ad(e[e.length-1])&&(n=e.pop()),"function"==typeof e[e.length-1]&&(t=e.pop()),1===e.length&&hc(e[0])&&(e=e[0]),Rf(e,n).lift(new aB(t))},concat:nn,defer:yd,empty:Qf,forkJoin:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(hc(n))return ch(n,null);if(Xi(n)&&Object.getPrototypeOf(n)===Object.prototype)return ch((e=Object.keys(n)).map((function(e){return n[e]})),e)}if("function"==typeof e[e.length-1]){var r=e.pop();return ch(e=1===e.length&&hc(e[0])?e[0]:e,null).pipe(Ea((function(e){return r.apply(void 0,e)})))}return ch(e,null)},from:Jc,fromEvent:Db,fromEventPattern:pn,generate:function(e,t,n,r,i){if(1==arguments.length){var o=e.initialState;t=e.condition,n=e.iterate;var s=e.resultSelector||wd;i=e.scheduler}else void 0===r||ad(r)?(o=e,s=wd,i=r):(o=e,s=r);return new ua((function(e){var r=o;if(i)return i.schedule(Mu,0,{subscriber:e,iterate:n,condition:t,resultSelector:s,state:r});for(;;){if(t){var a=void 0;try{a=t(r)}catch(t){e.error(t);break}if(!a){e.complete();break}}a=void 0;try{a=s(r)}catch(t){e.error(t);break}if(e.next(a),e.closed)break;try{r=n(r)}catch(t){e.error(t);break}}}))},iif:function(e,t,n){return void 0===t&&(t=Sb),void 0===n&&(n=Sb),yd((function(){return e()?t:n}))},interval:Qe,merge:Jb,never:function(){return Dl},of:ob,onErrorResumeNext:dj,pairs:function(e,t){return new ua(t?function(n){var r=Object.keys(e),i=new nb;return i.add(t.schedule(Ou,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i}:function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})},partition:function(e,t,n){return[yb(t,n)(new ua(Tf(e))),yb(Pu(t,n))(new ua(Tf(e)))]},race:fb,range:function(e,t,n){return void 0===e&&(e=0),new ua((function(r){void 0===t&&(t=e,e=0);var i=0,o=e;if(n)return n.schedule(Su,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(o++),r.closed)break}}))},throwError:ra,timer:dd,using:function(e,t){return new ua((function(n){try{var r=e()}catch(e){return void n.error(e)}try{var i=t(r)}catch(e){return void n.error(e)}var o=(i?Jc(i):Sb).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}}))},zip:ej,scheduled:ln,EMPTY:Sb,NEVER:Dl,config:gc}),Vu=function(){function e(e,t,n,r){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new jB(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),kB=function(){this.buffer=[]},jB=function(e){function t(t,n,r,i,o){if((t=e.call(this,t)||this).bufferTimeSpan=n,t.bufferCreationInterval=r,t.maxBufferSize=i,t.scheduler=o,t.contexts=[],i=t.openContext(),t.timespanOnly=null==r||0>r,t.timespanOnly)t.add(i.closeAction=o.schedule(qn,n,{subscriber:t,context:i,bufferTimeSpan:n}));else{var s={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:t,scheduler:o};t.add(i.closeAction=o.schedule(rn,n,{subscriber:t,context:i})),t.add(o.schedule(Wu,r,s))}return t}return ha(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],s=o.buffer;s.push(e),s.length==this.maxBufferSize&&(t=o)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,n=this.destination;0<t.length;){var r=t.shift();n.next(r.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){if(this.closeContext(e),(e=e.closeAction).unsubscribe(),this.remove(e),!this.closed&&this.timespanOnly){e=this.openContext();var t=this.bufferTimeSpan;this.add(e.closeAction=this.scheduler.schedule(qn,t,{subscriber:this,context:e,bufferTimeSpan:t}))}},t.prototype.openContext=function(){var e=new kB;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;0<=(t?t.indexOf(e):-1)&&t.splice(t.indexOf(e),1)},t}(za),Xu=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new lB(e,this.selector,this.caught))},e}(),lB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).selector=n,t.caught=r,t}return ha(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle(),t=new nd(this),this.add(t),(n=bd(n,t))!==t&&this.add(n)}},t}(od),Yu=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new mB(e,this.defaultValue))},e}(),mB=function(e){function t(t,n){return(t=e.call(this,t)||this).defaultValue=n,t.isEmpty=!0,t}return ha(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(za),Zu=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new nB(e,this.delay,this.scheduler))},e}(),nB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).delay=n,t.scheduler=r,t.queue=[],t.active=!1,t.errored=!1,t}return ha(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;0<n.length&&0>=n[0].time-r.now();)n.shift().notification.observe(i);0<n.length?(t=Math.max(0,n[0].time-r.now()),this.schedule(e,t)):(this.unsubscribe(),t.active=!1)},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler;e=new oB(t.now()+this.delay,e),this.queue.push(e),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(yf.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(yf.createComplete()),this.unsubscribe()},t}(za),oB=function(e,t){this.time=e,this.notification=t},$u=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new pB(e,this.keySelector,this.flushes))},e}(),pB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).keySelector=n,t.values=new Set,r&&t.add(bd(r,new nd(t))),t}return ha(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t=this.destination;try{var n=this.keySelector(e)}catch(e){return void t.error(e)}this._finalizeNext(n,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(od),bv=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new qB(e,this.errorFactory))},e}(),qB=function(e){function t(t,n){return(t=e.call(this,t)||this).errorFactory=n,t.hasValue=!1,t}return ha(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(za),cv=function(){function e(e){if(this.total=e,0>this.total)throw new Al}return e.prototype.call=function(e,t){return t.subscribe(new rB(e,this.total))},e}(),rB=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.count=0,t}return ha(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(za),dv=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new sB(e,this.callback))},e}(),sB=function(e){function t(t,n){return(t=e.call(this,t)||this).add(new nb(n)),t}return ha(t,e),t}(za),fv=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new tB(e))},e}(),tB=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ha(t,e),t.prototype._next=function(e){},t}(za),gv=function(){function e(e){if(this.total=e,0>this.total)throw new Al}return e.prototype.call=function(e,t){return t.subscribe(new uB(e,this.total))},e}(),uB=function(e){function t(t,n){return(t=e.call(this,t)||this).total=n,t.ring=[],t.count=0,t}return ha(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(0<t)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()},t}(za),hv=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new vB(e,this.value))},e}(),vB=function(e){function t(t,n){return(t=e.call(this,t)||this).value=n,t}return ha(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(za),iv=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new wB(e,this.accumulator,this.seed,this.hasSeed))},e}(),wB=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this).accumulator=n,t._seed=r,t.hasSeed=i,t.index=0,t}return ha(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t=this.index++;try{var n=this.accumulator(this.seed,e,t)}catch(e){this.destination.error(e)}this.seed=n,this.destination.next(n)},t}(za),kv=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory();return(e=n(r).subscribe(e)).add(t.subscribe(r)),e},e}(),mv=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new xB(e,this.notifier,this.source))},e}(),xB=function(e){function t(t,n,r){return(t=e.call(this,t)||this).notifier=n,t.source=r,t}return ha(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.retriesSubscription=this.errors=void 0;else{n=new rb;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}i=bd(r,new nd(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(od),pv=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new yB(e,this.project))},e}(),yB=function(e){function t(t,n){return(t=e.call(this,t)||this).project=n,t.index=0,t}return ha(t,e),t.prototype._next=function(e){var t=this.index++;try{var n=this.project(e,t)}catch(e){return void this.destination.error(e)}this._innerSub(n)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe(),t=new nd(this);var n=this.destination;n.add(t),this.innerSubscription=bd(e,t),this.innerSubscription!==t&&n.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(od),qv=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){e=new zB(e);var n=bd(this.notifier,new nd(e));return n&&!e.seenValue?(e.add(n),t.subscribe(e)):e},e}(),zB=function(e){function t(t){return(t=e.call(this,t)||this).seenValue=!1,t}return ha(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(od),rv=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new AB(e,this.nextOrObserver,this.error,this.complete))},e}(),AB=function(e){function t(t,n,r,i){return(t=e.call(this,t)||this)._tapNext=Ic,t._tapError=Ic,t._tapComplete=Ic,t._tapError=r||Ic,t._tapComplete=i||Ic,Ne(n)?(t._context=t,t._tapNext=n):n&&(t._context=n,t._tapNext=n.next||Ic,t._tapError=n.error||Ic,t._tapComplete=n.complete||Ic),t}return ha(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(za),tv={leading:!0,trailing:!1};!function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}ha(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._sendValue;this._hasValue&&(this.destination.next(e),this.throttle(e)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){(e=this.tryDurationSelector(e))&&this.add(this._throttled=bd(e,new nd(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()}}(od);for(var uv=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new BB(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),BB=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).duration=n,t.scheduler=r,t.leading=i,t.trailing=o,t._hasTrailingValue=!1,t._trailingValue=null,t}return ha(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(vv,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(za),xv=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new CB(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),CB=function(e){function t(t,n,r,i,o){return(t=e.call(this,t)||this).absoluteTimeout=n,t.waitFor=r,t.withObservable=i,t.scheduler=o,t.scheduleTimeout(),t}return ha(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(bd(t,new nd(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},t}(od),zv=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new DB(e,this.observables,this.project))},e}(),DB=function(e){function t(t,n,r){(t=e.call(this,t)||this).observables=n,t.project=r,t.toRespond=[],r=n.length,t.values=Array(r);for(var i=0;i<r;i++)t.toRespond.push(i);for(i=0;i<r;i++)t.add(bj(t,n[i],void 0,i));return t}return ha(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t,0<(e=this.toRespond).length&&-1!==(n=e.indexOf(n))&&e.splice(n,1)},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){0===this.toRespond.length&&(e=[e].concat(this.values),this.project?this._tryProject(e):this.destination.next(e))},t.prototype._tryProject=function(e){try{var t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(Bl),Kr=xb((function(e){var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=Array(16);e.exports=function(){for(var e,t=0;16>t;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}})),zb=[],pi=0;256>pi;++pi)zb[pi]=(pi+256).toString(16).substr(1);var Lr=function(e,t){return t=t||0,[zb[e[t++]],zb[e[t++]],zb[e[t++]],zb[e[t++]],"-",zb[e[t++]],zb[e[t++]],"-",zb[e[t++]],zb[e[t++]],"-",zb[e[t++]],zb[e[t++]],"-",zb[e[t++]],zb[e[t++]],zb[e[t++]],zb[e[t++]],zb[e[t++]],zb[e[t++]]].join("")},Ng=function(e,t,n){if(n=t&&n||0,"string"==typeof e&&(t="binary"===e?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||Kr)())[6]=15&e[6]|64,e[8]=63&e[8]|128,t)for(var r=0;16>r;++r)t[n+r]=e[r];return t||Lr(e)},Og=Ng(),gj=!1,yn=new AbortController,pd,Md,El,Fl,Nd,qe,Fc,re,nc,Gl,qd,se,rd,sd,td,zf;!function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"}(pd||(pd={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Md||(Md={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(El||(El={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Fl||(Fl={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(Nd||(Nd={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(qe||(qe={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(Fc||(Fc={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_KICKED=4]="LEAVE_CHANNEL_ERR_KICKED",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(re||(re={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(nc||(nc={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Gl||(Gl={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(qd||(qd={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(se||(se={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(rd||(rd={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(td||(td={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(zf||(zf={}));var oc=pd.ATTRIBUTE_OPERATION_ERR_FAILURE,gb=pd.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,Ye=pd.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;pd.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Mr=pd.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,pc=pd.ATTRIBUTE_OPERATION_ERR_TIMEOUT,qc=pd.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,qi=Md.CHANNEL_MESSAGE_ERR_FAILURE,Hl=Md.CHANNEL_MESSAGE_ERR_TIMEOUT,Nr=Md.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Il=Md.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE,EB=Md.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL,Jl=Md.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,FB=El.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Or=Fl.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Pr=sd.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Qr=sd.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,GB=sd.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;sd.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var HB=sd.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,IB=Nd.GET_MEMBERS_ERR_FAILURE,JB=Nd.GET_MEMBERS_ERR_REJECTED;Nd.GET_MEMBERS_ERR_TIMEOUT,Nd.GET_MEMBERS_ERR_TOO_OFTEN;var KB=Nd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,LB=Nd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,Xc=qe.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,MB=qe.INVITATION_API_CALL_ERR_NOT_STARTED,ri=qe.INVITATION_API_CALL_ERR_ALREADY_END,Rr=qe.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,NB=qe.INVITATION_API_CALL_ERR_ALREADY_SENT,Sr=Fc.JOIN_CHANNEL_ERR_FAILURE;Fc.JOIN_CHANNEL_ERR_REJECTED;var OB=Fc.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Tr=Fc.JOIN_CHANNEL_TIMEOUT,Ur=Fc.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Vr=Fc.JOIN_CHANNEL_ERR_ALREADY_JOINED;Fc.JOIN_CHANNEL_ERR_TOO_OFTEN;var Wr=Fc.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Xr=Fc.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Yr=re.LEAVE_CHANNEL_ERR_FAILURE,Zr=re.LEAVE_CHANNEL_ERR_REJECTED,PB=re.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,QB=re.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,RB=re.LEAVE_CHANNEL_ERR_KICKED,$r=nc.LOGIN_ERR_UNKNOWN,Pg=nc.LOGIN_ERR_REJECTED,si=nc.LOGIN_ERR_INVALID_ARGUMENT,as=nc.LOGIN_ERR_INVALID_APP_ID,bs=nc.LOGIN_ERR_INVALID_TOKEN,ti=nc.LOGIN_ERR_TOKEN_EXPIRED;nc.LOGIN_ERR_NOT_AUTHORIZED;var SB=nc.LOGIN_ERR_ALREADY_LOGIN,TB=nc.LOGIN_ERR_TIMEOUT,UB=nc.LOGIN_ERR_TOO_OFTEN,cs=Gl.LOGOUT_ERR_USER_NOT_LOGGED_IN,ds=qd.PEER_MESSAGE_ERR_FAILURE,Kl=qd.PEER_MESSAGE_ERR_TIMEOUT,es=qd.PEER_MESSAGE_ERR_TOO_OFTEN,fs=qd.PEER_MESSAGE_ERR_INVALID_USERID,bg=qd.PEER_MESSAGE_ERR_INVALID_MESSAGE,Ll=qd.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN;qd.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE;var gs=se.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;se.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var VB=se.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;se.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var WB=se.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,Ml=rd.RENEW_TOKEN_ERR_FAILURE,XB=rd.RENEW_TOKEN_ERR_INVALID_ARGUMENT;rd.RENEW_TOKEN_ERR_REJECTED,rd.RENEW_TOKEN_ERR_TOO_OFTEN;var YB=rd.RENEW_TOKEN_ERR_TOKEN_EXPIRED,ZB=rd.RENEW_TOKEN_ERR_INVALID_TOKEN,hs=rd.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,is=td.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,Qg=td.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;td.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var $B=td.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;td.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var js=td.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,Nl=td.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,zf.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var aC=function(e,t){var n;return rl(e,(function(e,r,i){return!(n=t(e,r,i))})),!!n},ui=function(e,t,n){if(!Gb(n))return!1;var r=qa(t);return!!("number"==r?ae(n)&&gl(t,n.length):"string"==r&&t in n)&&Gg(n[t],e)},Ol=function(e,t,n){var r=ub(e)?ur:aC;return n&&ui(e,t,n)&&(t=void 0),r(e,wf(t))},bC=function(e,t){var n=-1,r=ae(e)?Array(e.length):[];return rl(e,(function(e,i,o){r[++n]=t(e,i,o)})),r},cC=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e},dC=function(e,t,n){t=t.length?Je(t,(function(e){return ub(e)?function(t){return li(t,1===e.length?e[0]:e)}:e})):[mi];var r=-1;return t=Je(t,ii(wf)),e=bC(e,(function(e,n,i){return{criteria:Je(t,(function(t){return t(e)})),index:++r,value:e}})),cC(e,(function(e,t){e:{for(var r=-1,i=e.criteria,o=t.criteria,s=i.length,a=n.length;++r<s;){t:{var c=i[r],u=o[r];if(c!==u){var l=void 0!==c,A=null===c,h=c==c,d=Ke(c),p=void 0!==u,f=null===u,g=u==u,m=Ke(u);if(!f&&!m&&!d&&c>u||d&&p&&g&&!f&&!m||A&&p&&g||!l&&g||!h){c=1;break t}if(!A&&!d&&!m&&c<u||m&&l&&h&&!A&&!d||f&&l&&h||!p&&h||!g){c=-1;break t}}c=0}if(c){e=r>=a?c:c*("desc"==n[r]?-1:1);break e}}e=e.index-t.index}return e}))},ks=function(e,t){return sr(rr(e,t,mi),e+"")},ls=ks((function(e,t){if(null==e)return[];var n=t.length;return 1<n&&ui(e,t[0],t[1])?t=[]:2<n&&ui(t[0],t[1],t[2])&&(t=[t[0]]),dC(e,Si(t,1),[])})),ms=function(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})})),t}(iB),ns=xb((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=[],r=function(e,t){return new WebSocket(e,t)};t.normalClosureMessage="Normal closure",t.default=function(e,i){var o=(i=void 0===i?{protocols:n,makeWebSocket:r}:i).protocols,s=void 0===o?n:o,a=void 0===(i=i.makeWebSocket)?r:i;return new ms.Observable((function(n){var r,i=new ms.Subject,o=a(e,s),c=!1,u=!1,l=function(e){if(r)throw c=!0,e=Error("Web socket message factory function called more than once"),n.error(e),e;return r=e.subscribe((function(e){o.send(e)})),i};return o.onopen=function(){u?(c=!0,o.close()):n.next(l)},o.onmessage=function(e){i.next(e.data)},o.onerror=function(e){c=!0,n.error(Error(e.message))},o.onclose=function(e){c||(c=!0,u?(n.complete(),i.complete()):n.error(Error(1e3===e.code?t.normalClosureMessage:e.reason)))},function(){u=!0,r&&r.unsubscribe(),c||(c=!0,o.close())}}))}}));!function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default}(ns);var ij=function(e,t,n){(void 0===n||Gg(e[t],n))&&(void 0!==n||t in e)||Ig(e,t,n)},hj=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]},eC=function(e){return ks((function(t,n){var r=-1,i=n.length,o=1<i?n[i-1]:void 0,s=2<i?n[2]:void 0;for(o=3<e.length&&"function"==typeof o?(i--,o):void 0,s&&ui(n[0],n[1],s)&&(o=3>i?void 0:o,i=1),t=Object(t);++r<i;)(s=n[r])&&e(t,s,r,o);return t}))}((function(e,t,n,r){zn(e,t,n,r)})),fC=Math.floor,gC=Math.random,os=function(e,t){return e+fC(gC()*(t-e+1))},ps=function(e){var t=e.length;return t?e[os(0,t-1)]:void 0},hC=function(e,t){return Je(t,(function(t){return e[t]}))},zj=function(e){return null==e?[]:hC(e,Wd(e))},iC=function(e){return ps(zj(e))},On=function(e){return(ub(e)?ps:iC)(e)},Dn=[],En=function(e,t){return new WebSocket(e,t)},jC=Math.floor;ea({target:"Number",stat:!0},{isInteger:function(e){return!xa(e)&&isFinite(e)&&jC(e)===e}}),Sp("from",sk,rk);var kC=function(e,t){for(var n=Array(arguments.length-1),r=0,i=2,o=!0;i<arguments.length;)n[r++]=arguments[i++];return new Promise((function(i,s){n[r]=function(e){if(o)if(o=!1,e)s(e);else{for(var t=Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];i.apply(null,t)}};try{e.apply(t||null,n)}catch(e){o&&(o=!1,s(e))}}))},lC=xb((function(e,t){t.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;1<--t%4&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};var n=Array(64),r=Array(123);for(e=0;64>e;)r[n[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;t.encode=function(e,t,r){for(var i,o=null,s=[],a=0,c=0;t<r;){var u=e[t++];switch(c){case 0:s[a++]=n[u>>2],i=(3&u)<<4,c=1;break;case 1:s[a++]=n[i|u>>4],i=(15&u)<<2,c=2;break;case 2:s[a++]=n[i|u>>6],s[a++]=n[63&u],c=0}8191<a&&((o||(o=[])).push(String.fromCharCode.apply(String,s)),a=0)}return c&&(s[a++]=n[i],s[a++]=61,1===c&&(s[a++]=61)),o?(a&&o.push(String.fromCharCode.apply(String,s.slice(0,a))),o.join("")):String.fromCharCode.apply(String,s.slice(0,a))},t.decode=function(e,t,n){for(var i,o=n,s=0,a=0;a<e.length;){var c=e.charCodeAt(a++);if(61===c&&1<s)break;if(void 0===(c=r[c]))throw Error("invalid encoding");switch(s){case 0:i=c,s=1;break;case 1:t[n++]=i<<2|(48&c)>>4,i=c,s=2;break;case 2:t[n++]=(15&i)<<4|(60&c)>>2,i=c,s=3;break;case 3:t[n++]=(3&i)<<6|c,s=0}}if(1===s)throw Error("invalid encoding");return n-o},t.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}}));hh.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},hh.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else{e=this._listeners[e];for(var n=0;n<e.length;)e[n].fn===t?e.splice(n,1):++n}return this},hh.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this};var mC=Fn(Fn),nC=function(c){try{var b=eval("quire".replace(/^/,"re"))(c);if(b&&(b.length||Object.keys(b).length))return b}catch(e){}return null},oC=xb((function(e,t){t.length=function(e){for(var t,n=0,r=0;r<e.length;++r)128>(t=e.charCodeAt(r))?n+=1:2048>t?n+=2:55296==(64512&t)&&56320==(64512&e.charCodeAt(r+1))?(++r,n+=4):n+=3;return n},t.read=function(e,t,n){if(1>n-t)return"";for(var r,i=null,o=[],s=0;t<n;)128>(r=e[t++])?o[s++]=r:191<r&&224>r?o[s++]=(31&r)<<6|63&e[t++]:239<r&&365>r?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[s++]=55296+(r>>10),o[s++]=56320+(1023&r)):o[s++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],8191<s&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0);return i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))},t.write=function(e,t,n){for(var r,i,o=n,s=0;s<e.length;++s)128>(r=e.charCodeAt(s))?t[n++]=r:(2048>r?t[n++]=r>>6|192:(55296==(64512&r)&&56320==(64512&(i=e.charCodeAt(s+1)))?(r=65536+((1023&r)<<10)+(1023&i),++s,t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128);return n-o}})),pC=function(e,t,n){var r=n||8192,i=r>>>1,o=null,s=r;return function(n){return 1>n||n>i?e(n):(s+n>r&&(o=e(r),s=0),n=t.call(o,s,s+=n),7&s&&(s=1+(7|s)),n)}},te=vb.zero=new vb(0,0);te.toNumber=function(){return 0},te.zzEncode=te.zzDecode=function(){return this},te.length=function(){return 1};var qC=vb.zeroHash="\0\0\0\0\0\0\0\0";vb.fromNumber=function(e){if(0===e)return te;var t=0>e;t&&(e=-e);var n=e>>>0;return e=(e-n)/4294967296>>>0,t&&(e=~e>>>0,n=~n>>>0,4294967295<++n&&(n=0,4294967295<++e&&(e=0))),new vb(n,e)},vb.from=function(e){if("number"==typeof e)return vb.fromNumber(e);if(pa.isString(e)){if(!pa.Long)return vb.fromNumber(parseInt(e,10));e=pa.Long.fromString(e)}return e.low||e.high?new vb(e.low>>>0,e.high>>>0):te},vb.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var t=~this.hi>>>0;return e||(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi},vb.prototype.toLong=function(e){return pa.Long?new pa.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var Od=String.prototype.charCodeAt;vb.fromHash=function(e){return e===qC?te:new vb((Od.call(e,0)|Od.call(e,1)<<8|Od.call(e,2)<<16|Od.call(e,3)<<24)>>>0,(Od.call(e,4)|Od.call(e,5)<<8|Od.call(e,6)<<16|Od.call(e,7)<<24)>>>0)},vb.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},vb.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},vb.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},vb.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?16384>e?128>e?1:2:2097152>e?3:4:16384>t?128>t?5:6:2097152>t?7:8:128>n?9:10};var pa=xb((function(e,t){function n(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;++i)void 0!==e[r[i]]&&n||(e[r[i]]=t[r[i]]);return e}function r(e){function t(e,r){if(!(this instanceof t))return new t(e,r);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:Error().stack||""}),r&&n(this,r)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}t.asPromise=kC,t.base64=lC,t.EventEmitter=hh,t.float=mC,t.inquire=nC,t.utf8=oC,t.pool=pC,t.LongBits=vb,t.isNode=!!(void 0!==Ya&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),t.global=t.isNode&&Ya||"undefined"!=typeof window&&window||"undefined"!=typeof self&&self||Ya,t.emptyArray=Object.freeze?Object.freeze([]):[],t.emptyObject=Object.freeze?Object.freeze({}):{},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isObject=function(e){return e&&"object"===qa(e)},t.isset=t.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==qa(n)||0<(Array.isArray(n)?n.length:Object.keys(n).length))},t.Buffer=function(){try{var e=t.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(e){return null}}(),t._Buffer_from=null,t._Buffer_allocUnsafe=null,t.newBuffer=function(e){return"number"==typeof e?t.Buffer?t._Buffer_allocUnsafe(e):new t.Array(e):t.Buffer?t._Buffer_from(e):"undefined"==typeof Uint8Array?e:new Uint8Array(e)},t.Array="undefined"!=typeof Uint8Array?Uint8Array:Array,t.Long=t.global.dcodeIO&&t.global.dcodeIO.Long||t.global.Long||t.inquire("long"),t.key2Re=/^true|false|0|1$/,t.key32Re=/^-?(?:0|[1-9][0-9]*)$/,t.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,t.longToHash=function(e){return e?t.LongBits.from(e).toHash():t.LongBits.zeroHash},t.longFromHash=function(e,n){return e=t.LongBits.fromHash(e),t.Long?t.Long.fromBits(e.lo,e.hi,n):e.toNumber(!!n)},t.merge=n,t.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},t.newError=r,t.ProtocolError=r("ProtocolError"),t.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;-1<n;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},t.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},t.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},t._configure=function(){var e=t.Buffer;e?(t._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},t._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):t._Buffer_from=t._Buffer_allocUnsafe=null}})),qj=Aa,Pl,vi=pa.LongBits,qs=pa.base64,rs=pa.utf8,ss=function(){return pa.Buffer?function(){return(Aa.create=function(){return new Pl})()}:function(){return new Aa}};Aa.create=ss(),Aa.alloc=function(e){return new pa.Array(e)},pa.Array!==Array&&(Aa.alloc=pa.pool(Aa.alloc,pa.Array.prototype.subarray)),Aa.prototype._push=function(e,t,n){return this.tail=this.tail.next=new Wf(e,t,n),this.len+=t,this},nj.prototype=Object.create(Wf.prototype),nj.prototype.fn=function(e,t,n){for(;127<e;)t[n++]=127&e|128,e>>>=7;t[n]=e},Aa.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new nj(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},Aa.prototype.int32=function(e){return 0>e?this._push(oj,10,vi.fromNumber(e)):this.uint32(e)},Aa.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},Aa.prototype.uint64=function(e){return e=vi.from(e),this._push(oj,e.length(),e)},Aa.prototype.int64=Aa.prototype.uint64,Aa.prototype.sint64=function(e){return e=vi.from(e).zzEncode(),this._push(oj,e.length(),e)},Aa.prototype.bool=function(e){return this._push(mj,1,e?1:0)},Aa.prototype.fixed32=function(e){return this._push(pj,4,e>>>0)},Aa.prototype.sfixed32=Aa.prototype.fixed32,Aa.prototype.fixed64=function(e){return e=vi.from(e),this._push(pj,4,e.lo)._push(pj,4,e.hi)},Aa.prototype.sfixed64=Aa.prototype.fixed64,Aa.prototype.float=function(e){return this._push(pa.float.writeFloatLE,4,e)},Aa.prototype.double=function(e){return this._push(pa.float.writeDoubleLE,8,e)};var rC=pa.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};Aa.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(mj,1,0);if(pa.isString(e)){var n=Aa.alloc(t=qs.length(e));qs.decode(e,n,0),e=n}return this.uint32(t)._push(rC,t,e)},Aa.prototype.string=function(e){var t=rs.length(e);return t?this.uint32(t)._push(rs.write,t,e):this._push(mj,1,0)},Aa.prototype.fork=function(){return this.states=new Cv(this),this.head=this.tail=new Wf(lj,0,0),this.len=0,this},Aa.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Wf(lj,0,0),this.len=0),this},Aa.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},Aa.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},Aa._configure=function(e){Pl=e,Aa.create=ss(),Pl._configure()},(Lc.prototype=Object.create(qj.prototype)).constructor=Lc,Lc._configure=function(){Lc.alloc=pa._Buffer_allocUnsafe,Lc.writeBytesBuffer=pa.Buffer&&pa.Buffer.prototype instanceof Uint8Array&&"set"===pa.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},Lc.prototype.bytes=function(e){pa.isString(e)&&(e=pa._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Lc.writeBytesBuffer,t,e),this},Lc.prototype.string=function(e){var t=pa.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Dv,t,e),this},Lc._configure();var sj=ib,Ql,Kn=pa.LongBits,sC=pa.utf8,ts="undefined"!=typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new ib(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new ib(e);throw Error("illegal buffer")},us=function(){return pa.Buffer?function(e){return(ib.create=function(e){return pa.Buffer.isBuffer(e)?new Ql(e):ts(e)})(e)}:ts};ib.create=us(),ib.prototype._slice=pa.Array.prototype.subarray||pa.Array.prototype.slice,ib.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++])return e;if((this.pos+=5)>this.len)throw this.pos=this.len,wc(this,10);return e}}(),ib.prototype.int32=function(){return 0|this.uint32()},ib.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},ib.prototype.bool=function(){return 0!==this.uint32()},ib.prototype.fixed32=function(){if(this.pos+4>this.len)throw wc(this,4);return ih(this.buf,this.pos+=4)},ib.prototype.sfixed32=function(){if(this.pos+4>this.len)throw wc(this,4);return 0|ih(this.buf,this.pos+=4)},ib.prototype.float=function(){if(this.pos+4>this.len)throw wc(this,4);var e=pa.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},ib.prototype.double=function(){if(this.pos+8>this.len)throw wc(this,4);var e=pa.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},ib.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw wc(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},ib.prototype.string=function(){var e=this.bytes();return sC.read(e,0,e.length)},ib.prototype.skip=function(e){if("number"==typeof e){if(this.pos+e>this.len)throw wc(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw wc(this)}while(128&this.buf[this.pos++]);return this},ib.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},ib._configure=function(e){Ql=e,ib.create=us(),Ql._configure();var t=pa.Long?"toLong":"toNumber";pa.merge(ib.prototype,{int64:function(){return rj.call(this)[t](!1)},uint64:function(){return rj.call(this)[t](!0)},sint64:function(){return rj.call(this).zzDecode()[t](!1)},fixed64:function(){return Ln.call(this)[t](!0)},sfixed64:function(){return Ln.call(this)[t](!1)}})},(be.prototype=Object.create(sj.prototype)).constructor=be,be._configure=function(){pa.Buffer&&(be.prototype._slice=pa.Buffer.prototype.slice)},be.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},be._configure(),(Xf.prototype=Object.create(pa.EventEmitter.prototype)).constructor=Xf,Xf.prototype.rpcCall=function e(t,n,r,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return pa.asPromise(e,s,t,n,r,i);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return s.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof r))try{n=r[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),o(e)}return s.emit("data",n,t),o(null,n)}s.end(!0)}))}catch(e){s.emit("error",e,t),setTimeout((function(){o(e)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},Xf.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var tC=xb((function(e,t){t.Service=Xf})),uC={},Gc=xb((function(e,t){function n(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}var r=t;r.build="minimal",r.Writer=qj,r.BufferWriter=Lc,r.Reader=sj,r.BufferReader=be,r.util=pa,r.rpc=tC,r.roots=uC,r.configure=n,n()}));Gc.util.Long=P,Gc.configure();var M=Gc.Reader,ia=Gc.Writer,D=Gc.util,I=Gc.roots.default||(Gc.roots.default={}),vC=I.URI=function(){var e={},t=Object.create(e);return t[e[0]="Unknown"]=0,t[e[1]="PingUri"]=1,t[e[2]="PongUri"]=2,t[e[11]="UserJoinUri"]=11,t[e[12]="UserRespUri"]=12,t[e[15]="UserTicketNearlyExpireUri"]=15,t[e[16]="UserRenewTokenReqUri"]=16,t[e[17]="UserRenewTokenRespUri"]=17,t[e[21]="UserQuitUri"]=21,t[e[22]="UserDropUri"]=22,t[e[31]="GroupEnterUri"]=31,t[e[32]="GroupLeaveUri"]=32,t[e[33]="GroupReplyUri"]=33,t[e[35]="GroupDropUri"]=35,t[e[36]="GroupEnterNoticeUri"]=36,t[e[37]="GroupLeaveNoticeUri"]=37,t[e[38]="GroupEventNoticeUri"]=38,t[e[39]="GroupCountNoticeUri"]=39,t[e[41]="UserStatusListUri"]=41,t[e[42]="UserStatusResultUri"]=42,t[e[51]="GroupStatusListUri"]=51,t[e[52]="GroupStatusResultUri"]=52,t[e[55]="GroupAllUsersListUri"]=55,t[e[56]="GroupAllUsersResultUri"]=56,t[e[100]="MessageUri"]=100,t[e[101]="AckUri"]=101,t[e[201]="UserJoinNoticeUri"]=201,t[e[202]="UserQuitNoticeUri"]=202,t[e[203]="UserWaitNoticeUri"]=203,t[e[301]="UserAttributeGetUri"]=301,t[e[302]="UserAttributeRetUri"]=302,t[e[303]="UserAttributeSetUri"]=303,t[e[304]="UserAttributeModUri"]=304,t[e[305]="UserAttributeDelUri"]=305,t[e[307]="UserAttributeRspUri"]=307,t[e[308]="UserAttributeErrUri"]=308,t[e[311]="UserAttributeKeysGetUri"]=311,t[e[312]="UserAttributeKeysRetUri"]=312,t[e[351]="GroupAttributeGetUri"]=351,t[e[352]="GroupAttributeRetUri"]=352,t[e[353]="GroupAttributeSetUri"]=353,t[e[354]="GroupAttributeModUri"]=354,t[e[355]="GroupAttributeDelUri"]=355,t[e[356]="GroupAttributeAltUri"]=356,t[e[357]="GroupAttributeRspUri"]=357,t[e[358]="GroupAttributeErrUri"]=358,t[e[361]="GroupAttributeKeysGetUri"]=361,t[e[362]="GroupAttributeKeysRetUri"]=362,t[e[401]="SubscribeUserStatusUri"]=401,t[e[402]="UnsubscribeUserStatusUri"]=402,t[e[499]="SubscribeResponseUri"]=499,t}(),wi=I.Wrapper=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.uri=0,e.prototype.data=D.newBuffer([]),e.encode=function(e,t){return t||(t=ia.create()),null!=e.uri&&Object.hasOwnProperty.call(e,"uri")&&t.uint32(8).int32(e.uri),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.Wrapper;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.uri=e.int32();break;case 2:n.data=e.bytes();break;default:e.skipType(7&r)}}return n},e}(),wC=I.Ping=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.Ping;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.ms=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),xC=I.Pong=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(16).uint64(e.ms),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.Pong;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.ms=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),yC=I.UserJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.opt=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.opt&&Object.hasOwnProperty.call(e,"opt")&&t.uint32(16).uint64(e.opt),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(34).string(e.account),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(42).string(e.ticket),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserJoin;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.opt=e.uint64();break;case 3:n.instance=e.uint64();break;case 4:n.account=e.string();break;case 5:n.ticket=e.string();break;default:e.skipType(7&r)}}return n},e}(),zC=I.UserResp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserResp;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),AC=I.UserQuit=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.encode=function(e,t){return t||(t=ia.create()),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserQuit;e.pos<t;){var r=e.uint32();e.skipType(7&r)}return n},e}(),BC=I.UserDrop=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.code=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(8).uint32(e.code),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserDrop;e.pos<t;){var r=e.uint32();if(r>>>3==1)n.code=e.uint32();else e.skipType(7&r)}return n},e}(),CC=I.UserTicketNearlyExpire=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.expireTs=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.ticket="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.expireTs&&Object.hasOwnProperty.call(e,"expireTs")&&t.uint32(8).uint64(e.expireTs),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(18).string(e.ticket),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserTicketNearlyExpire;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.expireTs=e.uint64();break;case 2:n.ticket=e.string();break;default:e.skipType(7&r)}}return n},e}(),DC=I.UserRenewTokenReq=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(26).string(e.account),null!=e.ticket&&Object.hasOwnProperty.call(e,"ticket")&&t.uint32(34).string(e.ticket),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserRenewTokenReq;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.seq=e.uint64();break;case 3:n.account=e.string();break;case 4:n.ticket=e.string();break;default:e.skipType(7&r)}}return n},e}(),EC=I.UserRenewTokenResp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserRenewTokenResp;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),FC=I.GroupEnter=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupEnter;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;default:e.skipType(7&r)}}return n},e}(),GC=I.GroupLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupLeave;e.pos<t;){var r=e.uint32();if(r>>>3==1)n.account=e.string();else e.skipType(7&r)}return n},e}(),HC=I.GroupReply=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(24).uint32(e.code),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupReply;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),vs=I.GroupLeaveNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupLeaveNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.user=e.string();break;case 3:n.group=e.string();break;case 4:n.instance=e.uint64();break;case 5:n.size=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),ws=I.GroupEnterNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(18).string(e.user),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(32).uint64(e.instance),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(40).uint32(e.size),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupEnterNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.user=e.string();break;case 3:n.group=e.string();break;case 4:n.instance=e.uint64();break;case 5:n.size=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),xs=I.Message=function(){function e(e){if(this.MiscMap={},e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.dialogue=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.sequence=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.options=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=D.newBuffer([]),e.prototype.MiscMap=D.emptyObject,e.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.options&&Object.hasOwnProperty.call(e,"options")&&t.uint32(32).uint64(e.options),null!=e.src&&Object.hasOwnProperty.call(e,"src")&&t.uint32(42).string(e.src),null!=e.dst&&Object.hasOwnProperty.call(e,"dst")&&t.uint32(50).string(e.dst),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(58).bytes(e.payload),null!=e.MiscMap&&Object.hasOwnProperty.call(e,"MiscMap"))for(var n=Object.keys(e.MiscMap),r=0;r<n.length;++r)t.uint32(66).fork().uint32(10).string(n[r]).uint32(18).bytes(e.MiscMap[n[r]]).ldelim();return null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(72).uint64(e.ms),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n,r,i=new I.Message;e.pos<t;)switch(n=e.uint32(),n>>>3){case 1:i.instance=e.uint64();break;case 2:i.dialogue=e.uint64();break;case 3:i.sequence=e.uint64();break;case 4:i.options=e.uint64();break;case 5:i.src=e.string();break;case 6:i.dst=e.string();break;case 7:i.payload=e.bytes();break;case 8:i.MiscMap===D.emptyObject&&(i.MiscMap={});var o=e.uint32()+e.pos;for(n="",r=[];e.pos<o;){var s=e.uint32();switch(s>>>3){case 1:n=e.string();break;case 2:r=e.bytes();break;default:e.skipType(7&s)}}i.MiscMap[n]=r;break;case 9:i.ms=e.uint64();break;default:e.skipType(7&n)}return i},e}(),ys=I.Ack=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.dialogue=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.sequence=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.dialogue&&Object.hasOwnProperty.call(e,"dialogue")&&t.uint32(16).uint64(e.dialogue),null!=e.sequence&&Object.hasOwnProperty.call(e,"sequence")&&t.uint32(24).uint64(e.sequence),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(32).uint32(e.code),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.Ack;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.dialogue=e.uint64();break;case 3:n.sequence=e.uint64();break;case 4:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),IC=I.GroupDrop=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupDrop;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.account=e.string();break;case 2:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),JC=I.GroupAllUsersList=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(24).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(32).uint32(e.pageNumber),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAllUsersList;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.pageSize=e.uint32();break;case 4:n.pageNumber=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),KC=I.GroupAllUsersResult=function(){function e(e){if(this.memberInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.totalSize&&Object.hasOwnProperty.call(e,"totalSize")&&t.uint32(24).uint32(e.totalSize),null!=e.pageSize&&Object.hasOwnProperty.call(e,"pageSize")&&t.uint32(32).uint32(e.pageSize),null!=e.pageNumber&&Object.hasOwnProperty.call(e,"pageNumber")&&t.uint32(40).uint32(e.pageNumber),null!=e.memberInfos&&e.memberInfos.length)for(var n=0;n<e.memberInfos.length;++n)I.GroupAllUsersResult.MemberInfo.encode(e.memberInfos[n],t.uint32(50).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAllUsersResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.totalSize=e.uint32();break;case 4:n.pageSize=e.uint32();break;case 5:n.pageNumber=e.uint32();break;case 6:n.memberInfos&&n.memberInfos.length||(n.memberInfos=[]),n.memberInfos.push(I.GroupAllUsersResult.MemberInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.MemberInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAllUsersResult.MemberInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.account=e.string();break;case 2:n.ts=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),e}(),LC=I.UserStatusList=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.users=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserStatusList;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.users&&n.users.length||(n.users=[]),n.users.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),MC=I.UserStatusResult=function(){function e(e){if(this.userInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.userInfos=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.userInfos&&e.userInfos.length)for(var n=0;n<e.userInfos.length;++n)I.UserStatusResult.UserStatusInfo.encode(e.userInfos[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserStatusResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.userInfos&&n.userInfos.length||(n.userInfos=[]),n.userInfos.push(I.UserStatusResult.UserStatusInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.UserStatusInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.ts=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.ts&&Object.hasOwnProperty.call(e,"ts")&&t.uint32(16).uint32(e.ts),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserStatusResult.UserStatusInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.account=e.string();break;case 2:n.ts=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),e}(),NC=I.UserAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeGet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),OC=I.UserAttributeRet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.attributeInfos&&e.attributeInfos.length)for(var n=0;n<e.attributeInfos.length;++n)I.UserAttributeRet.AttributeInfo.encode(e.attributeInfos[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeRet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(I.UserAttributeRet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeRet.AttributeInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&r)}}return n},e}(),e}(),PC=I.UserAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var n=0;n<e.attributeInfos.length;++n)I.UserAttributeSet.AttributeInfo.encode(e.attributeInfos[n],t.uint32(26).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeSet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(I.UserAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeSet.AttributeInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&r)}}return n},e}(),e}(),QC=I.UserAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributeInfos&&e.attributeInfos.length)for(var n=0;n<e.attributeInfos.length;++n)I.UserAttributeMod.AttributeInfo.encode(e.attributeInfos[n],t.uint32(26).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeMod;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(I.UserAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeMod.AttributeInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&r)}}return n},e}(),e}(),RC=I.UserAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeDel;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;case 3:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),SC=I.UserAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeErr;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),TC=I.UserAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(18).string(e.account),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeKeysGet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.account=e.string();break;default:e.skipType(7&r)}}return n},e}(),UC=I.UserAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.keys=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeKeysRet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),VC=I.UserAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserAttributeRsp;e.pos<t;){var r=e.uint32();if(r>>>3==1)n.seq=e.uint64();else e.skipType(7&r)}return n},e}(),WC=I.GroupStatusList=function(){function e(e){if(this.groups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.groups=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.groups&&e.groups.length)for(var n=0;n<e.groups.length;++n)t.uint32(18).string(e.groups[n]);return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupStatusList;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.groups&&n.groups.length||(n.groups=[]),n.groups.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),XC=I.GroupStatusResult=function(){function e(e){if(this.groupInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.groupInfos&&e.groupInfos.length)for(var n=0;n<e.groupInfos.length;++n)I.GroupStatusResult.GroupInfo.encode(e.groupInfos[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupStatusResult;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.groupInfos&&n.groupInfos.length||(n.groupInfos=[]),n.groupInfos.push(I.GroupStatusResult.GroupInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.GroupInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.group="",e.prototype.memberCount=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(10).string(e.group),null!=e.memberCount&&Object.hasOwnProperty.call(e,"memberCount")&&t.uint32(16).uint32(e.memberCount),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupStatusResult.GroupInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.group=e.string();break;case 2:n.memberCount=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),e}(),YC=I.GroupCountNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(26).string(e.group),null!=e.size&&Object.hasOwnProperty.call(e,"size")&&t.uint32(32).uint32(e.size),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupCountNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.seq=e.uint64();break;case 3:n.group=e.string();break;case 4:n.size=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),ZC=I.GroupAttributeGet=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(26).string(e.attributes[n]);return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeGet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),$C=I.GroupAttributeRet=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.attributeMaps&&e.attributeMaps.length)for(var n=0;n<e.attributeMaps.length;++n)I.GroupAttributeRet.AttributeMap.encode(e.attributeMaps[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeRet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.attributeMaps&&n.attributeMaps.length||(n.attributeMaps=[]),n.attributeMaps.push(I.GroupAttributeRet.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeRet.AttributeMap;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;case 3:n.origin=e.string();break;case 4:n.ms=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),e}(),aD=I.GroupAttributeSet=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var n=0;n<e.attributeInfos.length;++n)I.GroupAttributeSet.AttributeInfo.encode(e.attributeInfos[n],t.uint32(34).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeSet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.broadcast=e.bool();break;case 4:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(I.GroupAttributeSet.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeSet.AttributeInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&r)}}return n},e}(),e}(),bD=I.GroupAttributeMod=function(){function e(e){if(this.attributeInfos=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributeInfos&&e.attributeInfos.length)for(var n=0;n<e.attributeInfos.length;++n)I.GroupAttributeMod.AttributeInfo.encode(e.attributeInfos[n],t.uint32(34).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeMod;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.broadcast=e.bool();break;case 4:n.attributeInfos&&n.attributeInfos.length||(n.attributeInfos=[]),n.attributeInfos.push(I.GroupAttributeMod.AttributeInfo.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeMod.AttributeInfo;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;default:e.skipType(7&r)}}return n},e}(),e}(),cD=I.GroupAttributeDel=function(){function e(e){if(this.attributes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.broadcast&&Object.hasOwnProperty.call(e,"broadcast")&&t.uint32(24).bool(e.broadcast),null!=e.attributes&&e.attributes.length)for(var n=0;n<e.attributes.length;++n)t.uint32(34).string(e.attributes[n]);return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeDel;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.broadcast=e.bool();break;case 4:n.attributes&&n.attributes.length||(n.attributes=[]),n.attributes.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),dD=I.GroupAttributeAlt=function(){function e(e){if(this.attributeMaps=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(24).uint64(e.instance),null!=e.attributeMaps&&e.attributeMaps.length)for(var n=0;n<e.attributeMaps.length;++n)I.GroupAttributeAlt.AttributeMap.encode(e.attributeMaps[n],t.uint32(34).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeAlt;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;case 3:n.instance=e.uint64();break;case 4:n.attributeMaps&&n.attributeMaps.length||(n.attributeMaps=[]),n.attributeMaps.push(I.GroupAttributeAlt.AttributeMap.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.AttributeMap=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value="",e.prototype.origin="",e.prototype.ms=D.Long?D.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).string(e.value),null!=e.origin&&Object.hasOwnProperty.call(e,"origin")&&t.uint32(26).string(e.origin),null!=e.ms&&Object.hasOwnProperty.call(e,"ms")&&t.uint32(32).uint64(e.ms),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeAlt.AttributeMap;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.key=e.string();break;case 2:n.value=e.string();break;case 3:n.origin=e.string();break;case 4:n.ms=e.uint64();break;default:e.skipType(7&r)}}return n},e}(),e}(),eD=I.GroupAttributeRsp=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeRsp;e.pos<t;){var r=e.uint32();if(r>>>3==1)n.seq=e.uint64();else e.skipType(7&r)}return n},e}(),fD=I.GroupAttributeErr=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeErr;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),gD=I.GroupAttributeKeysGet=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.group&&Object.hasOwnProperty.call(e,"group")&&t.uint32(18).string(e.group),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeKeysGet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.group=e.string();break;default:e.skipType(7&r)}}return n},e}(),hD=I.GroupAttributeKeysRet=function(){function e(e){if(this.keys=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.keys=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.keys&&e.keys.length)for(var n=0;n<e.keys.length;++n)t.uint32(18).string(e.keys[n]);return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.GroupAttributeKeysRet;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.keys&&n.keys.length||(n.keys=[]),n.keys.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),iD=I.SubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.users=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.SubscribeUserStatus;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.users&&n.users.length||(n.users=[]),n.users.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),jD=I.UnsubscribeUserStatus=function(){function e(e){if(this.users=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.users=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.users&&e.users.length)for(var n=0;n<e.users.length;++n)t.uint32(18).string(e.users[n]);return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UnsubscribeUserStatus;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.users&&n.users.length||(n.users=[]),n.users.push(e.string());break;default:e.skipType(7&r)}}return n},e}(),kD=I.UserJoinNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserJoinNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.seq=e.uint64();break;case 3:n.user=e.string();break;default:e.skipType(7&r)}}return n},e}(),lD=I.UserQuitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserQuitNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.seq=e.uint64();break;case 3:n.user=e.string();break;default:e.skipType(7&r)}}return n},e}(),mD=I.UserWaitNotice=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.instance=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(e,t){return t||(t=ia.create()),null!=e.instance&&Object.hasOwnProperty.call(e,"instance")&&t.uint32(8).uint64(e.instance),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.user&&Object.hasOwnProperty.call(e,"user")&&t.uint32(26).string(e.user),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.UserWaitNotice;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.instance=e.uint64();break;case 2:n.seq=e.uint64();break;case 3:n.user=e.string();break;default:e.skipType(7&r)}}return n},e}(),nD=I.SubscribeResponse=function(){function e(e){if(this.errors=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=D.Long?D.Long.fromBits(0,0,!0):0,e.prototype.errors=D.emptyArray,e.encode=function(e,t){if(t||(t=ia.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.errors&&e.errors.length)for(var n=0;n<e.errors.length;++n)I.SubscribeResponse.SubscribeErrorsType.encode(e.errors[n],t.uint32(18).fork()).ldelim();return t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.SubscribeResponse;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.seq=e.uint64();break;case 2:n.errors&&n.errors.length||(n.errors=[]),n.errors.push(I.SubscribeResponse.SubscribeErrorsType.decode(e,e.uint32()));break;default:e.skipType(7&r)}}return n},e.SubscribeErrorsType=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.account="",e.prototype.code=0,e.encode=function(e,t){return t||(t=ia.create()),null!=e.account&&Object.hasOwnProperty.call(e,"account")&&t.uint32(10).string(e.account),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(16).uint32(e.code),t},e.decode=function(e,t){e instanceof M||(e=M.create(e)),t=void 0===t?e.len:e.pos+t;for(var n=new I.SubscribeResponse.SubscribeErrorsType;e.pos<t;){var r=e.uint32();switch(r>>>3){case 1:n.account=e.string();break;case 2:n.code=e.uint32();break;default:e.skipType(7&r)}}return n},e}(),e}(),oD=Object.freeze({__proto__:null,URI:vC,Wrapper:wi,Ping:wC,Pong:xC,UserJoin:yC,UserResp:zC,UserQuit:AC,UserDrop:BC,UserTicketNearlyExpire:CC,UserRenewTokenReq:DC,UserRenewTokenResp:EC,GroupEnter:FC,GroupLeave:GC,GroupReply:HC,GroupLeaveNotice:vs,GroupEnterNotice:ws,Message:xs,Ack:ys,GroupDrop:IC,GroupAllUsersList:JC,GroupAllUsersResult:KC,UserStatusList:LC,UserStatusResult:MC,UserAttributeGet:NC,UserAttributeRet:OC,UserAttributeSet:PC,UserAttributeMod:QC,UserAttributeDel:RC,UserAttributeErr:SC,UserAttributeKeysGet:TC,UserAttributeKeysRet:UC,UserAttributeRsp:VC,GroupStatusList:WC,GroupStatusResult:XC,GroupCountNotice:YC,GroupAttributeGet:ZC,GroupAttributeRet:$C,GroupAttributeSet:aD,GroupAttributeMod:bD,GroupAttributeDel:cD,GroupAttributeAlt:dD,GroupAttributeRsp:eD,GroupAttributeErr:fD,GroupAttributeKeysGet:gD,GroupAttributeKeysRet:hD,SubscribeUserStatus:iD,UnsubscribeUserStatus:jD,UserJoinNotice:kD,UserQuitNotice:lD,UserWaitNotice:mD,SubscribeResponse:nD,default:I}),pD=Math.ceil,zs=function(e){return function(t,n,r){var i=(t=String(Eb(t))).length;return r=void 0===r?" ":String(r),(n=Ma(n))<=i||""==r?t:(n-=i,(i=Yo.call(r,pD(n/r.length))).length>n&&(i=i.slice(0,n)),e?t+i:i+t)}},qD=zs(!1),rD=zs(!0),As=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(df);ea({target:"String",proto:!0,forced:As},{padEnd:function(e){return rD(this,e,1<arguments.length?arguments[1]:void 0)}});var sD=eg,Bs=function(e){return function(t){t=Mb(t);for(var n,r=ed(t),i=r.length,o=0,s=[];i>o;)n=r[o++],wa&&!sD.call(t,n)||s.push(e?[n,t[n]]:t[n]);return s}},tD=Bs(!0),uD=Bs(!1);ea({target:"Object",stat:!0},{entries:function(e){return tD(e)}});var vD=dc.f,Cs="".endsWith,wD=Math.min,Ds=Qk("endsWith"),xD=!Ds&&!!function(){var e=vD(String.prototype,"endsWith");return e&&!e.writable}();ea({target:"String",proto:!0,forced:!xD&&!Ds},{endsWith:function(e){var t=String(Eb(this));Pk(e);var n=1<arguments.length?arguments[1]:void 0,r=Ma(t.length);return n=void 0===n?r:wD(Ma(n),r),r=String(e),Cs?Cs.call(t,r,n):t.slice(n-r.length,n)===r}}),Bh("match",1,(function(e,t,n){return[function(t){var n=Eb(this),r=null==t?void 0:t[e];return void 0!==r?r.call(t,n):new RegExp(t)[e](String(n))},function(e){var r=n(t,e,this);if(r.done)return r.value;if(e=Ia(e),r=String(this),!e.global)return ef(e,r);var i=e.unicode;e.lastIndex=0;for(var o,s=[],a=0;null!==(o=ef(e,r));)o=String(o[0]),s[a]=o,""===o&&(e.lastIndex=Mj(r,Ma(e.lastIndex),i)),a++;return 0===a?null:s}]}));var yD=dc.f,Es="".startsWith,zD=Math.min,Fs=Qk("startsWith"),AD=!Fs&&!!function(){var e=yD(String.prototype,"startsWith");return e&&!e.writable}();ea({target:"String",proto:!0,forced:!AD&&!Fs},{startsWith:function(e){var t=String(Eb(this));Pk(e);var n=Ma(zD(1<arguments.length?arguments[1]:void 0,t.length)),r=String(e);return Es?Es.call(t,r,n):t.slice(n,n+r.length)===r}});var Wn=function(e){var t=/(%?)(%([jds]))/g,n=Array.prototype.slice.call(arguments,1);return n.length&&(e=e.replace(t,(function(e,t,r,i){switch(r=n.shift(),i){case"s":r=""+r;break;case"d":r=Number(r);break;case"j":r=JSON.stringify(r)}return t?(n.unshift(r),e):r}))),n.length&&(e+=" "+n.join(" ")),""+e.replace(/%{2,2}/g,"%")},BD=/\s/,CD=/^\s+/,Gs=NaN,DD=/^[-+]0x[0-9a-f]+$/i,ED=/^0b[01]+$/i,FD=/^0o[0-7]+$/i,GD=parseInt,xi=function(e){if("number"==typeof e)return e;if(Ke(e))return Gs;if(Gb(e)&&(e="function"==typeof e.valueOf?e.valueOf():e,e=Gb(e)?e+"":e),"string"!=typeof e)return 0===e?e:+e;if(e){for(var t=e.slice,n=e.length;n--&&BD.test(e.charAt(n)););e=t.call(e,0,n+1).replace(CD,"")}return(t=ED.test(e))||FD.test(e)?GD(e.slice(2),t?2:8):DD.test(e)?Gs:+e},HD=Math.max,ID=Math.min,JD=function(e,t,n){function r(t){var n=c,r=u;return c=u=void 0,d=t,l=e.apply(r,n)}function i(e){var n=e-h;return e-=d,void 0===h||n>=t||0>n||f&&e>=m}function o(){var e=$b.Date.now();if(i(e))return s(e);var n=setTimeout,r=e-d;e=t-(e-h),r=f?ID(e,m-r):e,A=n(o,r)}function s(e){return A=void 0,g&&c?r(e):(c=u=void 0,l)}function a(){var e=$b.Date.now(),n=i(e);if(c=arguments,u=this,h=e,n){if(void 0===A)return d=e=h,A=setTimeout(o,t),p?r(e):l;if(f)return clearTimeout(A),A=setTimeout(o,t),r(h)}return void 0===A&&(A=setTimeout(o,t)),l}var c,u,l,A,h,d=0,p=!1,f=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");if(t=xi(t)||0,Gb(n)){p=!!n.leading;var m=(f="maxWait"in n)?HD(xi(n.maxWait)||0,t):m;g="trailing"in n?!!n.trailing:g}return a.cancel=function(){void 0!==A&&clearTimeout(A),d=0,c=h=u=A=void 0},a.flush=function(){return void 0===A?l:s($b.Date.now())},a},KD=Math.max,LD=Math.min,Hs=1/0,Rl=function(e){return e?(e=xi(e))===Hs||e===-Hs?17976931348623157e292*(0>e?-1:1):e==e?e:0:0===e?e:0},Is=function(e,t,n){return t=Rl(t),void 0===n?(n=t,t=0):n=Rl(n),(e=xi(e))>=LD(t,n)&&e<KD(t,n)},ac=Gc.Writer,H=Gc.util,Pb=Gc.roots.default||(Gc.roots.default={}),MD=Pb.Session=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(e,t){return t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.appId&&Object.hasOwnProperty.call(e,"appId")&&t.uint32(42).string(e.appId),null!=e.ver&&Object.hasOwnProperty.call(e,"ver")&&t.uint32(50).string(e.ver),null!=e.buildno&&Object.hasOwnProperty.call(e,"buildno")&&t.uint32(56).int32(e.buildno),null!=e.installId&&Object.hasOwnProperty.call(e,"installId")&&t.uint32(66).string(e.installId),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(128).int32(e.os),null!=e.did&&Object.hasOwnProperty.call(e,"did")&&t.uint32(138).string(e.did),null!=e.index&&Object.hasOwnProperty.call(e,"index")&&Pb.Session.CommonIndex.encode(e.index,t.uint32(162).fork()).ldelim(),null!=e.token&&Object.hasOwnProperty.call(e,"token")&&t.uint32(170).string(e.token),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(176).int32(e.version),null!=e.subVersion&&Object.hasOwnProperty.call(e,"subVersion")&&t.uint32(184).int32(e.subVersion),t},e.CommonIndex=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.index1="",e.prototype.index2="",e.prototype.index3="",e.encode=function(e,t){return t||(t=ac.create()),null!=e.index1&&Object.hasOwnProperty.call(e,"index1")&&t.uint32(10).string(e.index1),null!=e.index2&&Object.hasOwnProperty.call(e,"index2")&&t.uint32(18).string(e.index2),null!=e.index3&&Object.hasOwnProperty.call(e,"index3")&&t.uint32(26).string(e.index3),t},e}(),e}(),ND=Pb.ApEvent=function(){function e(e){if(this.linkServerList=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.apAddr="",e.prototype.linkServerList=H.emptyArray,e.prototype.errCode=0,e.prototype.serverErrCode=0,e.prototype.isp="",e.prototype.opId=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.envId=0,e.prototype.flag=0,e.prototype.area="",e.encode=function(e,t){if(t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.apAddr&&Object.hasOwnProperty.call(e,"apAddr")&&t.uint32(50).string(e.apAddr),null!=e.linkServerList&&e.linkServerList.length)for(var n=0;n<e.linkServerList.length;++n)t.uint32(58).string(e.linkServerList[n]);return null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(72).int32(e.errCode),null!=e.serverErrCode&&Object.hasOwnProperty.call(e,"serverErrCode")&&t.uint32(80).int32(e.serverErrCode),null!=e.isp&&Object.hasOwnProperty.call(e,"isp")&&t.uint32(90).string(e.isp),null!=e.opId&&Object.hasOwnProperty.call(e,"opId")&&t.uint32(96).int64(e.opId),null!=e.envId&&Object.hasOwnProperty.call(e,"envId")&&t.uint32(104).int32(e.envId),null!=e.flag&&Object.hasOwnProperty.call(e,"flag")&&t.uint32(112).int32(e.flag),null!=e.area&&Object.hasOwnProperty.call(e,"area")&&t.uint32(122).string(e.area),t},e}(),OD=Pb.ApRequest=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.apAddr="",e.prototype.opId=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.envId=0,e.prototype.flag=0,e.encode=function(e,t){return t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.apAddr&&Object.hasOwnProperty.call(e,"apAddr")&&t.uint32(42).string(e.apAddr),null!=e.opId&&Object.hasOwnProperty.call(e,"opId")&&t.uint32(48).int64(e.opId),null!=e.envId&&Object.hasOwnProperty.call(e,"envId")&&t.uint32(56).int32(e.envId),null!=e.flag&&Object.hasOwnProperty.call(e,"flag")&&t.uint32(64).int32(e.flag),t},e}(),PD=Pb.LinkLoginRequest=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.destServerIp="",e.prototype.linkId=0,e.encode=function(e,t){return t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.destServerIp&&Object.hasOwnProperty.call(e,"destServerIp")&&t.uint32(42).string(e.destServerIp),null!=e.linkId&&Object.hasOwnProperty.call(e,"linkId")&&t.uint32(48).int32(e.linkId),t},e}(),QD=Pb.Link=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(e,t){return t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.ec&&Object.hasOwnProperty.call(e,"ec")&&t.uint32(40).int32(e.ec),null!=e.sc&&Object.hasOwnProperty.call(e,"sc")&&t.uint32(48).int32(e.sc),null!=e.destServerIp&&Object.hasOwnProperty.call(e,"destServerIp")&&t.uint32(58).string(e.destServerIp),null!=e.ackedServerIp&&Object.hasOwnProperty.call(e,"ackedServerIp")&&t.uint32(66).string(e.ackedServerIp),null!=e.responseTime&&Object.hasOwnProperty.call(e,"responseTime")&&t.uint32(72).int32(e.responseTime),t},e}(),RD=Pb.Logout=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.encode=function(e,t){return t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),t},e}(),SD=Pb.KickedOff=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(e,t){return t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.linkId&&Object.hasOwnProperty.call(e,"linkId")&&t.uint32(48).int32(e.linkId),null!=e.code&&Object.hasOwnProperty.call(e,"code")&&t.uint32(56).int32(e.code),null!=e.server&&Object.hasOwnProperty.call(e,"server")&&t.uint32(66).string(e.server),null!=e.serverCode&&Object.hasOwnProperty.call(e,"serverCode")&&t.uint32(72).int32(e.serverCode),t},e}(),TD=Pb.ChnJoin=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),UD=Pb.ChnJoinRes=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(e,t){return t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),null!=e.serverErrCode&&Object.hasOwnProperty.call(e,"serverErrCode")&&t.uint32(64).int32(e.serverErrCode),t},e}(),VD=Pb.ChnLeave=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(e,t){return t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.cname&&Object.hasOwnProperty.call(e,"cname")&&t.uint32(50).string(e.cname),null!=e.errCode&&Object.hasOwnProperty.call(e,"errCode")&&t.uint32(56).int32(e.errCode),t},e}(),WD=Pb.ConnectionStateChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.elapse=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(e,t){return t||(t=ac.create()),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(10).string(e.sid),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(18).string(e.userId),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(24).int64(e.lts),null!=e.elapse&&Object.hasOwnProperty.call(e,"elapse")&&t.uint32(32).int64(e.elapse),null!=e.oldState&&Object.hasOwnProperty.call(e,"oldState")&&t.uint32(40).int32(e.oldState),null!=e.newState&&Object.hasOwnProperty.call(e,"newState")&&t.uint32(48).int32(e.newState),null!=e.reason&&Object.hasOwnProperty.call(e,"reason")&&t.uint32(56).int32(e.reason),null!=e.reconnId&&Object.hasOwnProperty.call(e,"reconnId")&&t.uint32(64).int32(e.reconnId),t},e}(),Js=Pb.RtmSdkMessageCount=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.vid=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.sid="",e.prototype.messagecategory=0,e.prototype.reportsequence=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.sentcount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.receivedcount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack10mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack25mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack50mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack75mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack100mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack150mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack200mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack250mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack300mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack400mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack500mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack600mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack800mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack1000mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack2000mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack3000mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack5000mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerack7000mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.peerackslowcount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack10mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack25mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack50mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack75mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack100mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack150mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack200mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack250mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack300mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack400mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack500mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack600mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack800mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack1000mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack2000mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack3000mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack5000mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientack7000mscount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.norecipientackslowcount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.acktimeoutcount=H.Long?H.Long.fromBits(0,0,!1):0,e.prototype.apimajorversion=0,e.prototype.apiminorversion=0,e.prototype.os=0,e.prototype.toooftencount=0,e.prototype.receiverofflinecount=0,e.prototype.invalidmessagecount=0,e.prototype.unknowerrorcount=0,e.prototype.servercachedcount=0,e.prototype.timeoutcount=0,e.prototype.successcount=0,e.prototype.userid="",e.encode=function(e,t){return t||(t=ac.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(16).int64(e.vid),null!=e.sid&&Object.hasOwnProperty.call(e,"sid")&&t.uint32(26).string(e.sid),null!=e.messagecategory&&Object.hasOwnProperty.call(e,"messagecategory")&&t.uint32(32).int32(e.messagecategory),null!=e.reportsequence&&Object.hasOwnProperty.call(e,"reportsequence")&&t.uint32(40).int64(e.reportsequence),null!=e.sentcount&&Object.hasOwnProperty.call(e,"sentcount")&&t.uint32(48).int64(e.sentcount),null!=e.receivedcount&&Object.hasOwnProperty.call(e,"receivedcount")&&t.uint32(56).int64(e.receivedcount),null!=e.peerack10mscount&&Object.hasOwnProperty.call(e,"peerack10mscount")&&t.uint32(64).int64(e.peerack10mscount),null!=e.peerack25mscount&&Object.hasOwnProperty.call(e,"peerack25mscount")&&t.uint32(72).int64(e.peerack25mscount),null!=e.peerack50mscount&&Object.hasOwnProperty.call(e,"peerack50mscount")&&t.uint32(80).int64(e.peerack50mscount),null!=e.peerack75mscount&&Object.hasOwnProperty.call(e,"peerack75mscount")&&t.uint32(88).int64(e.peerack75mscount),null!=e.peerack100mscount&&Object.hasOwnProperty.call(e,"peerack100mscount")&&t.uint32(96).int64(e.peerack100mscount),null!=e.peerack150mscount&&Object.hasOwnProperty.call(e,"peerack150mscount")&&t.uint32(104).int64(e.peerack150mscount),null!=e.peerack200mscount&&Object.hasOwnProperty.call(e,"peerack200mscount")&&t.uint32(112).int64(e.peerack200mscount),null!=e.peerack250mscount&&Object.hasOwnProperty.call(e,"peerack250mscount")&&t.uint32(120).int64(e.peerack250mscount),null!=e.peerack300mscount&&Object.hasOwnProperty.call(e,"peerack300mscount")&&t.uint32(128).int64(e.peerack300mscount),null!=e.peerack400mscount&&Object.hasOwnProperty.call(e,"peerack400mscount")&&t.uint32(136).int64(e.peerack400mscount),null!=e.peerack500mscount&&Object.hasOwnProperty.call(e,"peerack500mscount")&&t.uint32(144).int64(e.peerack500mscount),null!=e.peerack600mscount&&Object.hasOwnProperty.call(e,"peerack600mscount")&&t.uint32(152).int64(e.peerack600mscount),null!=e.peerack800mscount&&Object.hasOwnProperty.call(e,"peerack800mscount")&&t.uint32(160).int64(e.peerack800mscount),null!=e.peerack1000mscount&&Object.hasOwnProperty.call(e,"peerack1000mscount")&&t.uint32(168).int64(e.peerack1000mscount),null!=e.peerack2000mscount&&Object.hasOwnProperty.call(e,"peerack2000mscount")&&t.uint32(176).int64(e.peerack2000mscount),null!=e.peerack3000mscount&&Object.hasOwnProperty.call(e,"peerack3000mscount")&&t.uint32(184).int64(e.peerack3000mscount),null!=e.peerack5000mscount&&Object.hasOwnProperty.call(e,"peerack5000mscount")&&t.uint32(192).int64(e.peerack5000mscount),null!=e.peerack7000mscount&&Object.hasOwnProperty.call(e,"peerack7000mscount")&&t.uint32(200).int64(e.peerack7000mscount),null!=e.peerackslowcount&&Object.hasOwnProperty.call(e,"peerackslowcount")&&t.uint32(208).int64(e.peerackslowcount),null!=e.norecipientack10mscount&&Object.hasOwnProperty.call(e,"norecipientack10mscount")&&t.uint32(216).int64(e.norecipientack10mscount),null!=e.norecipientack25mscount&&Object.hasOwnProperty.call(e,"norecipientack25mscount")&&t.uint32(224).int64(e.norecipientack25mscount),null!=e.norecipientack50mscount&&Object.hasOwnProperty.call(e,"norecipientack50mscount")&&t.uint32(232).int64(e.norecipientack50mscount),null!=e.norecipientack75mscount&&Object.hasOwnProperty.call(e,"norecipientack75mscount")&&t.uint32(240).int64(e.norecipientack75mscount),null!=e.norecipientack100mscount&&Object.hasOwnProperty.call(e,"norecipientack100mscount")&&t.uint32(248).int64(e.norecipientack100mscount),null!=e.norecipientack150mscount&&Object.hasOwnProperty.call(e,"norecipientack150mscount")&&t.uint32(256).int64(e.norecipientack150mscount),null!=e.norecipientack200mscount&&Object.hasOwnProperty.call(e,"norecipientack200mscount")&&t.uint32(264).int64(e.norecipientack200mscount),null!=e.norecipientack250mscount&&Object.hasOwnProperty.call(e,"norecipientack250mscount")&&t.uint32(272).int64(e.norecipientack250mscount),null!=e.norecipientack300mscount&&Object.hasOwnProperty.call(e,"norecipientack300mscount")&&t.uint32(280).int64(e.norecipientack300mscount),null!=e.norecipientack400mscount&&Object.hasOwnProperty.call(e,"norecipientack400mscount")&&t.uint32(288).int64(e.norecipientack400mscount),null!=e.norecipientack500mscount&&Object.hasOwnProperty.call(e,"norecipientack500mscount")&&t.uint32(296).int64(e.norecipientack500mscount),null!=e.norecipientack600mscount&&Object.hasOwnProperty.call(e,"norecipientack600mscount")&&t.uint32(304).int64(e.norecipientack600mscount),null!=e.norecipientack800mscount&&Object.hasOwnProperty.call(e,"norecipientack800mscount")&&t.uint32(312).int64(e.norecipientack800mscount),null!=e.norecipientack1000mscount&&Object.hasOwnProperty.call(e,"norecipientack1000mscount")&&t.uint32(320).int64(e.norecipientack1000mscount),null!=e.norecipientack2000mscount&&Object.hasOwnProperty.call(e,"norecipientack2000mscount")&&t.uint32(328).int64(e.norecipientack2000mscount),null!=e.norecipientack3000mscount&&Object.hasOwnProperty.call(e,"norecipientack3000mscount")&&t.uint32(336).int64(e.norecipientack3000mscount),null!=e.norecipientack5000mscount&&Object.hasOwnProperty.call(e,"norecipientack5000mscount")&&t.uint32(344).int64(e.norecipientack5000mscount),null!=e.norecipientack7000mscount&&Object.hasOwnProperty.call(e,"norecipientack7000mscount")&&t.uint32(352).int64(e.norecipientack7000mscount),null!=e.norecipientackslowcount&&Object.hasOwnProperty.call(e,"norecipientackslowcount")&&t.uint32(360).int64(e.norecipientackslowcount),null!=e.acktimeoutcount&&Object.hasOwnProperty.call(e,"acktimeoutcount")&&t.uint32(368).int64(e.acktimeoutcount),null!=e.apimajorversion&&Object.hasOwnProperty.call(e,"apimajorversion")&&t.uint32(376).int32(e.apimajorversion),null!=e.apiminorversion&&Object.hasOwnProperty.call(e,"apiminorversion")&&t.uint32(384).int32(e.apiminorversion),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(392).int32(e.os),null!=e.toooftencount&&Object.hasOwnProperty.call(e,"toooftencount")&&t.uint32(400).int32(e.toooftencount),null!=e.receiverofflinecount&&Object.hasOwnProperty.call(e,"receiverofflinecount")&&t.uint32(408).int32(e.receiverofflinecount),null!=e.invalidmessagecount&&Object.hasOwnProperty.call(e,"invalidmessagecount")&&t.uint32(416).int32(e.invalidmessagecount),null!=e.unknowerrorcount&&Object.hasOwnProperty.call(e,"unknowerrorcount")&&t.uint32(424).int32(e.unknowerrorcount),null!=e.servercachedcount&&Object.hasOwnProperty.call(e,"servercachedcount")&&t.uint32(432).int32(e.servercachedcount),null!=e.timeoutcount&&Object.hasOwnProperty.call(e,"timeoutcount")&&t.uint32(440).int32(e.timeoutcount),null!=e.successcount&&Object.hasOwnProperty.call(e,"successcount")&&t.uint32(448).int32(e.successcount),null!=e.userid&&Object.hasOwnProperty.call(e,"userid")&&t.uint32(458).string(e.userid),t},e}(),Iv=Object.freeze({__proto__:null,Session:MD,ApEvent:ND,ApRequest:OD,LinkLoginRequest:PD,Link:QD,Logout:RD,KickedOff:SD,ChnJoin:TD,ChnJoinRes:UD,ChnLeave:VD,ConnectionStateChange:WD,RtmSdkMessageCount:Js,default:Pb}),XD=la((function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}));ea({target:"Date",proto:!0,forced:XD},{toJSON:function(e){e=pb(this);var t=Oc(e);return"number"!=typeof t||isFinite(t)?e.toISOString():null}}),ea({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var Ev=Object.prototype.hasOwnProperty,Ks=function(e,t,n){return JSON.stringify(Mn(e),t,n)};Ks.ensureProperties=Mn;var YD=function(e,t){t=t||{};var n=qa(e);if("string"===n&&0<e.length)return Fv(e);if("number"===n&&isFinite(e))return e=t.long?864e5<=(t=Math.abs(e))?jh(e,t,864e5,"day"):36e5<=t?jh(e,t,36e5,"hour"):6e4<=t?jh(e,t,6e4,"minute"):1e3<=t?jh(e,t,1e3,"second"):e+" ms":864e5<=(t=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=t?Math.round(e/36e5)+"h":6e4<=t?Math.round(e/6e4)+"m":1e3<=t?Math.round(e/1e3)+"s":e+"ms";throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},ZD=function(e){function t(e){function r(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(r.enabled){e=Number(new Date),r.diff=e-(i||e),r.prev=i,i=r.curr=e,n[0]=t.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");var s=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(function(e,i){return"%%"===e?"%":(s++,"function"==typeof(i=t.formatters[i])&&(e=i.call(r,n[s]),n.splice(s,1),s--),e)})),t.formatArgs.call(r,n),(r.log||t.log).apply(r,n)}}var i,o=null;return r.namespace=e,r.useColors=t.useColors(),r.color=t.selectColor(e),r.extend=n,r.destroy=t.destroy,Object.defineProperty(r,"enabled",{enumerable:!0,configurable:!1,get:function(){return null===o?t.enabled(e):o},set:function(e){o=e}}),"function"==typeof t.init&&t.init(r),r}function n(e,n){return(e=t(this.namespace+(void 0===n?":":n)+e)).log=this.log,e}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){var e=[].concat(Z(t.names.map(r)),Z(t.skips.map(r).map((function(e){return"-"+e})))).join(",");return t.enable(""),e},t.enable=function(e){t.save(e),t.names=[],t.skips=[];var n,r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.substr(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;var n,r=0;for(n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=YD,t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((function(n){t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){for(var n=0,r=0;r<e.length;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t},Ls=xb((function(e,t){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)}},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){try{var e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};e:{try{var n=localStorage;break e}catch(r){}n=void 0}var r;t.storage=n,t.destroy=(r=!1,function(){r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),t.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),t.log=console.debug||console.log||function(){},e.exports=ZD(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}})),Ms=Ls("RTM:DEBUG"),Af;Ms.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(Af||(Af={}));var $D=function(){function e(t){va(this,e),x(this,"uploadRequest",void 0),x(this,"uploadState",void 0),x(this,"uploadResendCount",void 0),x(this,"LogCache",void 0),x(this,"LogsToPost",void 0),x(this,"processId",void 0),x(this,"sdkVersion",void 0),x(this,"logId",void 0),x(this,"rtmConfig",void 0),this.processId=t.processId,this.sdkVersion=t.sdkVersion,this.rtmConfig=t.rtmConfig,this.uploadRequest=t.uploadRequest,this.uploadState=Af.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return eb(e,[{key:"upload",value:function(e){this.LogCache.push(e),this.uploadState===Af.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(e){var t=this;this.uploadState=Af.Uploading,setTimeout(ma(N.mark((function n(){var r,i,o;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={sdk_version:t.sdkVersion,process_id:t.processId,payload:JSON.stringify(e)},n.prev=1,n.next=4,t.uploadRequest(r,null!==(i=t.rtmConfig.enableCloudProxy)&&void 0!==i&&i);case 4:if(!gj){n.next=6;break}throw Error("RTM is busy");case 6:n.next=13;break;case 8:return n.prev=8,n.t0=n.catch(1),o=2>t.uploadResendCount++?2e3:1e4,setTimeout((function(){return t.postLog(t.LogsToPost)}),o),n.abrupt("return");case 13:if(Ms('The logs uploaded for "process-'.concat(Og,'"')),0!==t.LogCache.length){n.next=17;break}return t.uploadState=Af.Free,n.abrupt("return");case 17:t.uploadResendCount=0,t.LogsToPost=40>t.LogCache.length?t.LogCache.splice(0,t.LogCache.length):t.LogCache.splice(0,40),t.postLog(t.LogsToPost);case 20:case"end":return n.stop()}}),n,null,[[1,8]])}))),ue.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),Ns=function(e,t,n,r,i,o,s,a){var c=0;for(s=!!s&&Dd(s,a,3);c<r;){if(c in n){if(a=s?s(n[c],c,t):n[c],0<o&&Ed(a))i=Ns(e,t,a,Ma(a.length),i,o-1)-1;else{if(9007199254740991<=i)throw TypeError("Exceed the acceptable array length");e[i]=a}i++}c++}return i},aE=Ns;ea({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=pb(this),n=Ma(t.length),r=Dh(t,0);return r.length=aE(r,t,t,n,0,void 0===e?1:yc(e)),r}}),ea({target:"Object",stat:!0},{values:function(e){return uD(e)}});var ud=function(e){function t(e,r){return va(this,t),x(z(e=n.call(this,Vn(e,r))),"originalError",void 0),x(z(e),"code",void 0),x(z(e),"serverCode",void 0),"number"==typeof r?e.code=r:"string"==typeof r?e.name=r:void 0!==r&&(r.originalError&&(e.originalError=r.originalError),void 0!==r.code&&(e.code=r.code),void 0!==r.serverCode&&(e.serverCode=r.serverCode)),e}Ga(t,e);var n=Ha(t);return t}(Kf(Error)),rc=function(e){function t(e,r){return va(this,t),x(z(e=n.call(this,Vn(e,r))),"name","RtmInternalError"),x(z(e),"code",void 0),e.code=r,e}Ga(t,e);var n=Ha(t);return t}(Kf(Error)),yi=function(){return function(e){function t(e){va(this,t);var r=Object.keys(e);return n.call(this,e[r[0]],r[0])}Ga(t,e);var n=Ha(t);return t}(rc)},mb=yi(),Ub=function(e){function t(){va(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return x(z(e=n.call.apply(n,[this].concat(r))),"name","RtmTimeoutError"),e}Ga(t,e);var n=Ha(t);return t}(ud),ca=function(e){function t(){va(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return x(z(e=n.call.apply(n,[this].concat(r))),"name","RtmInvalidArgumentError"),e}Ga(t,e);var n=Ha(t);return t}(ud),da=function(e){function t(){va(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return x(z(e=n.call.apply(n,[this].concat(r))),"name","RtmInvalidStatusError"),e}Ga(t,e);var n=Ha(t);return t}(ud),ic=function(e){function t(){va(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return x(z(e=n.call.apply(n,[this].concat(r))),"name","RtmLimitExceededError"),e}Ga(t,e);var n=Ha(t);return t}(ud),bE=function(e){function t(){va(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return x(z(e=n.call.apply(n,[this].concat(r))),"name","RtmInvokeTooOftenError"),e}Ga(t,e);var n=Ha(t);return t}(ud),Ja=function(e){function t(){va(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return x(z(e=n.call.apply(n,[this].concat(r))),"name","RtmUnavailableError"),x(z(e),"serverCode",void 0),x(z(e),"statusCode",void 0),e}Ga(t,e);var n=Ha(t);return t}(ud),Bf=function(e){function t(){va(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return x(z(e=n.call.apply(n,[this].concat(r))),"name","RtmUnauthenticatedError"),x(z(e),"serverCode",void 0),e}Ga(t,e);var n=Ha(t);return t}(ud),ve=function(e){function t(){va(this,t);for(var e=arguments.length,r=Array(e),i=0;i<e;i++)r[i]=arguments[i];return x(z(e=n.call.apply(n,[this].concat(r))),"name","RtmUnknownError"),e}Ga(t,e);var n=Ha(t);return t}(ud),Ab=function(e){return e instanceof Ub||e instanceof Tb},Na=function(e){return e instanceof ud},we=function(e,t,n){return['Executing "%s.%s" timed out after %ds',e,t,n/1e3]},cE=["CODE"],bc,Pd,S;!function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"}(S||(S={}));var dE={CN:S.CHINA,NA:S.NORTH_AMERICA,EU:S.EUROPE,AS:S.ASIA,JP:S.JAPAN,IN:S.INDIA,GLOB:S.GLOBAL,AF:S.AFRICA,OC:S.OVERSEA,OVS:S.OVERSEA,SA:S.SOUTH_AMERICA},kh=$n((bc={},x(bc,S.ASIA,{CODE:S.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.NORTH_AMERICA,{CODE:S.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.EUROPE,{CODE:S.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.JAPAN,{CODE:S.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.INDIA,{CODE:S.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.OVERSEA,{CODE:S.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),x(bc,S.GLOBAL,{CODE:S.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.OCEANIA,{CODE:S.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.SOUTH_AMERICA,{CODE:S.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.AFRICA,{CODE:S.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),x(bc,S.CHINA,{CODE:S.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),bc)),Zf=(Pd={},x(Pd,S.ASIA,[S.CHINA,S.JAPAN,S.INDIA]),x(Pd,S.EUROPE,[]),x(Pd,S.NORTH_AMERICA,[]),x(Pd,S.SOUTH_AMERICA,[]),x(Pd,S.OCEANIA,[]),x(Pd,S.AFRICA,[]),Pd),Os=[S.OVERSEA,S.GLOBAL,S.CHINA,S.NORTH_AMERICA,S.EUROPE,S.ASIA,S.JAPAN,S.INDIA,S.OCEANIA,S.SOUTH_AMERICA,S.AFRICA],Nn=function(e){return Object.values(Zf).flat().includes(e)},Hv=function(e){var t;return null===(t=qh(Zf).find((function(t){return(t=$a(t,2))[0],t[1].includes(e)})))||void 0===t?void 0:t[0]},eE=function(e){return e.sort((function(e,t){return Os.indexOf(e)-Os.indexOf(t)}))},Ve=function(e){var t=new Set;if(0===(e=eE(e).slice(0,3).map((function(e){var n=kh[e];if(void 0===n)throw new rc("invalid area key");return e=n.CODE,n=Ki(n,cE),t.add(e),n}))).length)throw new rc("areas cannot be empty");return Wa({CODES:t},e.reduce((function(e,t){for(var n=0,r=qh(e);n<r.length;n++){var i=$a(r[n],2),o=i[0];i=i[1],e[o]=Array.from(new Set([].concat(Z(t[o]),Z(i))))}return e})))},fa,Ps=function(){var e=ma(N.mark((function e(t,n){var r,i,o,s,a,c=arguments;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(2<(i=2<c.length&&void 0!==c[2]?c[2]:0))){e.next=3;break}return e.abrupt("return");case 3:return o={withCredentials:!0,body:t,timeout:2e4},s=0<i?(null==fa?void 0:fa.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(null==fa?void 0:fa.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",a=n?"https://".concat(null!==(r=null==fa?void 0:fa.PROXY_NGINX[0])&&void 0!==r?r:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(s,"&p=443&d=upload/v1"):"https://".concat(s,"/upload/v1"),e.next=8,lh(a,o).catch((function(e){return Ps(t,n,i+1)}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Qs=new $D({processId:"process-".concat(Og),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.5.1-0-g5bbbcd72"),uploadRequest:Ps,rtmConfig:{}}),Sl="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Rs="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Ss=["serverReceivedTs","hasPeerReceived","messageType","enableNotificationToChannelMembers","lastUpdateTs"],fE="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),We=function(e){if("string"==typeof e)return La(e);if(Array.isArray(e)&&e.every((function(e){return"string"==typeof e})))return e.map((function(e){return La(e)}));if(!Mm(e)){for(var t={},n=0;n<Ss.length;n++){var r=Ss[n];r in e&&(t[r]=e[r])}if(0<Object.keys(t).length)return t;if(5>Object.keys(e).length){for(n=0,e=Object.entries(e);n<e.length;n++){var i=$a(e[n],2);r=i[0],i=i[1],Sl.includes(r)?t[r]="[Hidden Info]":t[La(r)]="string"==typeof i?La(i):"[Sensitive Info]"}return t}return"[Sensitive Info]"}return e},Ts=function(e){return"object"===qa(e)?De(e)?Zn(He(e,5),Sl,Rs):e.constructor&&e.constructor.name:e},Us=function(e,t){return e instanceof Error?e.message:"string"!=typeof e?JSON.stringify(Zn(He(e,5),Sl,Rs)):(t=t.map((function(e){return e instanceof Error?e.message:"object"===qa(e)?Ks(Array.isArray(e)?e.map(Ts):Ts(e)):e})),Wn.apply(void 0,[e.replace(/%[%Oo]/g,(function(e){return"%%"===e?"%":"%o"===e||"%O"===e?"%s":e}))].concat(Z(t))))},gE=1,Vs=function(e,t,n){var r=Ls(e);return r.enabled=!0,r.log=n,r.useColors=!1,function(n){for(var i=arguments.length,o=Array(1<i?i-1:0),s=1;s<i;s++)o[s-1]=arguments[s];if(t.enableLogUpload){i=oh(n);var a=Us(i,o);Qs.upload({log_item_id:"".concat(gE++),log_level:e,payload_str:"[".concat(hE(),"] ").concat(e," - ").concat(256<a.length?a.slice(0,256):a)})}switch(i=function(e){var t=a||Us(oh(n),o),i=Ec.LOG_HANDLER;"function"==typeof i&&i({level:e,message:t}),r(t)},e){case"RTM:INFO":t.logFilter.info&&i("log");break;case"RTM:WARN":t.logFilter.warn&&i("warning");break;case"RTM:ERROR":t.logFilter.error&&i("error");break;case"RTM:TRACK":t.logFilter.track&&i("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":case"RTM:DEBUG":t.logFilter.debug&&i("debug")}}},Tl,Ws=function(e){return function(t){var n=1===Tl||void 0===e?"":"Ins#".concat(e," ");return"".concat(n).concat(t)}},Ul=function(e,t,n){var r=Ws(Tl);return Vs("RTM:".concat(t),n,(function(t){return e(r(t))}))},sc=function(){return function(e){function t(e,r){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];va(this,t);var o=n.call(this);if(x(z(o),"logError",void 0),x(z(o),"invokeTracker",void 0),x(z(o),"resultTracker",void 0),x(z(o),"errorTracker",void 0),x(z(o),"eventTracker",void 0),x(z(o),"info",void 0),x(z(o),"warn",void 0),x(z(o),"log",void 0),x(z(o),"genLogger",void 0),x(z(o),"loggerId",void 0),x(z(o),"logger",void 0),x(z(o),"name",void 0),o.logger=e,o.name=r,o.loggerId=e.loggerId,o.info=e.info,o.warn=e.warn,o.logError=e.logError,o.genLogger=e.genLogger,o.log=e.genLogger("RTM:DEBUG","<".concat(r,"> ")),o.invokeTracker=e.genTracker("Invoke"),o.eventTracker=e.genTracker("Event"),o.resultTracker=e.genTracker("Result"),o.errorTracker=e.genTracker("Error"),i){var s=o.emit.bind(z(o));o.emit=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];e=t[0],n=t.slice(1);var i=fE.includes(e);o.eventTracker.apply(o,["%s: ".concat(0<n.length?"%s emitted with args: ".concat(n.map((function(){return"%o"}))):"%s emitted"),r,e].concat(Z(i?n.map(We):n)));try{s.apply(void 0,t)}catch(t){o.logError("Caught in the callback function of the event %s",e,t)}}}return o}Ga(t,e);var n=Ha(t);return t}(Ba)},iE=function(e){return Ul(console.log.bind(console),"INFO",e)},jE=function(e){return Ul(console.warn.bind(console),"WARN",e)},kE=function(e){return Ul(console.error.bind(console),"ERROR",e)},Xs=function(e,t){return function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=Ws(e),o=console.debug.bind(console),s=Vs(n,t,(function(e){return o(i(e))}));return function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return s.apply(void 0,[r+e].concat(n))}}},lE=function(e,t){return function(n){return Xs(e,t)("RTM:TRACK","[".concat(n,"] "))}},Jv=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510}}),Ka;!function(e){e[e.ChannelSMsg=1]="ChannelSMsg",e[e.ChannelRMsg=2]="ChannelRMsg",e[e.P2pSMsgOfflineFlag=3]="P2pSMsgOfflineFlag",e[e.P2pRMsgOfflineFlag=4]="P2pRMsgOfflineFlag",e[e.P2pSMsgNoOfflineFlag=5]="P2pSMsgNoOfflineFlag",e[e.P2pRMsgNoOfflineFlag=6]="P2pRMsgNoOfflineFlag",e[e.P2pCallInvitation=7]="P2pCallInvitation",e[e.P2pCallCancellation=8]="P2pCallCancellation",e[e.P2pCallAcceptance=9]="P2pCallAcceptance",e[e.P2pCallRefusal=10]="P2pCallRefusal"}(Ka||(Ka={}));var zi=function(e){function t(e,r,i){return va(this,t),x(z(r=n.call(this,r,"MessageReport")),"messagecount",r.getInitMessageCount()),x(z(r),"context",void 0),x(z(r),"rtmMessageCategory",void 0),x(z(r),"seq",P.fromNumber(1,!0)),r.context=e,r.rtmMessageCategory=i,r}Ga(t,e);var n=Ha(t);return eb(t,[{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1)}},{key:"getInitMessageCount",value:function(){return{peerack10mscount:P.fromNumber(0),peerack25mscount:P.fromNumber(0),peerack50mscount:P.fromNumber(0),peerack75mscount:P.fromNumber(0),peerack100mscount:P.fromNumber(0),peerack150mscount:P.fromNumber(0),peerack200mscount:P.fromNumber(0),peerack250mscount:P.fromNumber(0),peerack300mscount:P.fromNumber(0),peerack400mscount:P.fromNumber(0),peerack500mscount:P.fromNumber(0),peerack600mscount:P.fromNumber(0),peerack800mscount:P.fromNumber(0),peerack1000mscount:P.fromNumber(0),peerack2000mscount:P.fromNumber(0),peerack3000mscount:P.fromNumber(0),peerack5000mscount:P.fromNumber(0),peerack7000mscount:P.fromNumber(0),peerackslowcount:P.fromNumber(0),norecipientack10mscount:P.fromNumber(0),norecipientack25mscount:P.fromNumber(0),norecipientack50mscount:P.fromNumber(0),norecipientack75mscount:P.fromNumber(0),norecipientack100mscount:P.fromNumber(0),norecipientack150mscount:P.fromNumber(0),norecipientack200mscount:P.fromNumber(0),norecipientack250mscount:P.fromNumber(0),norecipientack300mscount:P.fromNumber(0),norecipientack400mscount:P.fromNumber(0),norecipientack500mscount:P.fromNumber(0),norecipientack600mscount:P.fromNumber(0),norecipientack800mscount:P.fromNumber(0),norecipientack1000mscount:P.fromNumber(0),norecipientack2000mscount:P.fromNumber(0),norecipientack3000mscount:P.fromNumber(0),norecipientack5000mscount:P.fromNumber(0),norecipientack7000mscount:P.fromNumber(0),norecipientackslowcount:P.fromNumber(0),sentcount:P.fromNumber(0),receivedcount:P.fromNumber(0),acktimeoutcount:P.fromNumber(0),toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0}}},{key:"updatePeerAckCount",value:function(e){e/=2;for(var t=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],n=0;n<t.length;n++){var r,i=t[n];if(Is(e,i[0],i[1]))i="peerack".concat(i[1],"mscount"),this.messagecount[i]=null===(r=this.messagecount[i])||void 0===r?void 0:r.add(1);else if(7e3<e){var o;this.messagecount.peerackslowcount=null===(o=this.messagecount.peerackslowcount)||void 0===o?void 0:o.add(1)}}}},{key:"updateNorecipientackCount",value:function(e){e/=2;for(var t=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],n=0;n<t.length;n++){var r,i=t[n];if(Is(e,i[0],i[1]))i="norecipientack".concat(i[1],"mscount"),this.messagecount[i]=null===(r=this.messagecount[i])||void 0===r?void 0:r.add(1);else if(7e3<e){var o;this.messagecount.norecipientackslowcount=null===(o=this.messagecount.norecipientackslowcount)||void 0===o?void 0:o.add(1)}}}},{key:"updateCommonCount",value:function(e){var t=this.messagecount[e];P.isLong(t)?this.messagecount[e]=t.add(1):this.messagecount[e]=t+1}},{key:"report",value:function(){var e,t;bb("RtmSdkMessageCount",new Js(Wa(Wa({},this.messagecount),{},{vid:P.fromString(null!==(e=this.context.vid)&&void 0!==e?e:"0"),os:7,lts:P.fromNumber(Date.now()),sid:this.context.sid,reportsequence:this.incGetSeq(),apimajorversion:4,apiminorversion:18,userid:this.context.uid,messagecategory:this.rtmMessageCategory})),null!==(t=this.context.config.enableCloudProxy)&&void 0!==t&&t),this.messagecount=Wa(Wa({},this.messagecount),{},{toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0})}}]),t}(sc()),Un=new Map,hE=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},Yf=Object.keys,qh=Object.entries.bind(Object),oh=function(e){return"string"==typeof e?e.endsWith(".")?e:"".concat(e,"."):e},yj=I.URI,Nv=wi,mE=Ki(oD,["Wrapper"]),bo=ql(mE,"URI"),Ys=function(e,t){var n=-1,r=e.length,i=r-1;for(t=void 0===t?r:t;++n<t;){var o=e[r=os(n,i)];e[r]=e[n],e[n]=o}return e.length=t,e},nE=function(e){return Ys(Pi(e))},oE=function(e){return Ys(zj(e))},Cf=function(e){return(ub(e)?nE:oE)(e)},Df={0:9591,1:9593},xe=function(e){var t=$f(null);return"https://".concat(t?null:e,"/api/v1")},pE=ob.apply(void 0,Z(Cf(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map(xe)))),qE=ob.apply(void 0,Z(Cf(["ap-web-1.agora.io","ap-web-2.agora.io"].map(xe)))),rE=ob.apply(void 0,Z(Cf(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map(xe)))),sE=ob.apply(void 0,Z(Cf(["ap-web-3.agora.io","ap-web-4.agora.io"].map(xe)))),Zs=yi(),Vl=function(e){function t(e,r,i,o,s,a){var c,u;va(this,t);var l=n.call(this,s,uj("Socket-",s.loggerId));if(x(z(l),"isActiveClose",!1),x(z(l),"loggedIn",!1),x(z(l),"useNewDomain",void 0),x(z(l),"receivedPacket",new rb),x(z(l),"open$",void 0),x(z(l),"input$",new rb),x(z(l),"userJoin$",new rb),x(z(l),"attemptsSinceLastError",0),x(z(l),"message$",new rb),x(z(l),"socket$",void 0),x(z(l),"toClose",new rb),x(z(l),"toReconnect",new rb),x(z(l),"sendLogger",void 0),x(z(l),"receiveLogger",void 0),x(z(l),"ip",void 0),x(z(l),"env",void 0),x(z(l),"ticket",void 0),x(z(l),"context",void 0),x(z(l),"getDomain",(function(){return co(l.ip,l.useNewDomain)})),x(z(l),"socketReconnector",(function(e){var t=function(e){return l.attemptsSinceLastError+=1,l.warn("The %s of Env %d reconnecting %s",l.name,l.env,e.message),dd(3e3)};return e.pipe(ab((function(e){return l.log("socket connection closed"),l.loggedIn=!1,2<=l.attemptsSinceLastError?(l.warn("socket connection failure"),l.emit("connectionFailure"),l.close(),ra(e)):l.isActiveClose?Sb:(l.emit("reconnect"),l.useNewDomain=!l.useNewDomain,ra(e))})),Re((function(e){return e.pipe(Kb(t))})))})),l.ip=e,l.env=r,l.ticket=i,l.context=o,l.useNewDomain=null!=a?a:.5<=Math.random(),l.sendLogger=l.genLogger("RTM:MSG:SEND"),l.receiveLogger=l.genLogger("RTM:MSG:RECV"),0!==r&&1!==r)throw new Zs({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});var A=Df[r];l.log("Opening websocket address %s for the Env %d",l.ip,l.env),bb("LinkLoginRequest",{sid:l.context.sid,userId:l.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(l.context.startTime),destServerIp:l.ip,linkId:l.env},null!==(c=l.context.config.enableCloudProxy||l.context.socketUseProxy)&&void 0!==c&&c),bb("LinkLoginRequest",{sid:l.context.sid,userId:l.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(l.context.startTime),destServerIp:l.ip,linkId:l.env},null!==(u=l.context.config.enableCloudProxy||l.context.socketUseProxy)&&void 0!==u&&u);var h=Jb(l.input$,l.userJoin$.pipe(Av(2)),l.message$).pipe(Ea((function(e){return wi.encode(e).finish()})));return e=Jb(Bv("",{protocols:[],makeWebSocket:function(){if(l.context.config.enableCloudProxy||l.context.socketUseProxy){if(0===l.context.cloudProxyServers.length)throw l.logError("No cloud proxy server to connect"),new Ja;var e=$f(null)?JSON.parse(null.replace(/-/g,".")):l.context.cloudProxyServers;e=Xe(e="wss://".concat(co(On(e),!1),"/"),"sid",l.context.sid),e=Xe(e,"remote_port",A.toString()),e=Xe(e,"remote_ip",l.ip),e=Xe(e,"token",l.context.key),e=new WebSocket(e)}else e=new WebSocket("wss://".concat(l.getDomain(),":").concat(A));return e.binaryType="arraybuffer",e}}),l.toReconnect),l.socket$=fb(e,Dl.pipe(Lb(7e3),ab((function(e){return Ab(e)&&l.warn("socket open timed out"),ra(e)})))).pipe(Ea((function(e){if(e instanceof Error)throw l.warn("Env_%d: Force reconnect the socket",l.env),e;return e(h).pipe(Ea((function(e){return wi.decode(new Uint8Array(e))})))})),l.socketReconnector),l.open$=l.socket$.pipe(sa((function(e){l.log("Websocket opened",l.name),e.subscribe((function(e){var t=e.data;e=yj[e.uri].slice(0,-3),t=bo[e].decode(t);var n=eC({},ql(t,"toJSON"),(function(e,t){return t instanceof P?Tn(t):t})),r=!1;if((t instanceof ws||t instanceof vs)&&t.instance.lessThanOrEqual(4294967295)&&(r=!0),t instanceof xs||t instanceof ys){var i=t.instance,o=t.sequence;(t.dialogue.lessThanOrEqual(4294967295)||i.lessThanOrEqual(4294967295)||o.lessThan(1))&&(r=!0)}r?l.warn("Env_%d: Illegal %s, abandoned %o",l.env,e,n):("Pong"!==e&&l.receiveLogger("Env_%d: %s %o",l.env,e,n),l.receivedPacket.next([e,t]))}),(function(){}))})),Uf(void 0),Kc(l.toClose),Se()),l}Ga(t,e);var n=Ha(t);return eb(t,[{key:"address",get:function(){return"".concat(this.ip,":").concat(Df[this.env])}},{key:"sendPacket",value:function(e,t){if("Ping"!==e){var n=md(t,(function(e){return e instanceof P?Tn(e):e}));this.sendLogger("Env_%d: %s %o",this.env,e,n)}t=Mv(e,t),"UserJoin"===e?this.userJoin$.next(t):"Message"===e?this.message$.next(t):this.input$.next(t)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(e){return this.receivedPacket.pipe(yb((function(t){return $a(t,1)[0]===e})),Ea((function(e){return $a(e,2)[1]})))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new Zs({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),t}(sc());ea({target:"String",proto:!0,forced:As},{padStart:function(e){return qD(this,e,1<arguments.length?arguments[1]:void 0)}});var tE=function(e){var t=Yf(kh);e=Lv(e);for(var n=0;n<t.length;n++){var r=kh[t[n]];if(null!=r&&r.AP_DOMAINS.includes(e)||null!=r&&r.AP_BACKUP_DOMAINS.includes(e)||null!=r&&r.PROXY_AP.includes(e))return[r.CODE]}return[S.CHINA,S.GLOBAL]},uE={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},$s={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},vE=[100,101,102],Ai=/web-(\d)/,at=function(e){function t(e,r){var i=2<arguments.length&&void 0!==arguments[2]&&arguments[2];va(this,t);var o=n.call(this,r,"AccessPoint");return x(z(o),"handleUniLbsError",(function(e,t){var n=e;if(4<e.toString().length){var r=e.toString().padStart(8,"0"),i=parseInt(r.slice(0,4),10);if(r=parseInt(r.slice(4,8),10),201===i)n=r;else if(101===i&&!vE.includes(r))return ra(Error("service is currently unavailable"))}if(i=n.toString(),!Object.keys($s).includes(i))return(e=new Ja(["Login is rejected by the server. The response code is %d",e],Pg)).serverCode=n,ra(e);switch(i=$s[i],n=uE[i],i){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(t=new Bf(n,as)).serverCode=e,ra(t);case"INVALID_USER_ID":return(t=new Bf(n,si)).serverCode=e,ra(t);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(t=new Bf(n,ti)).serverCode=e,ra(t);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(t=new Bf(n,bs)).serverCode=e,ra(t);case"CANNOT_MEET_AREA_DEMAND":return(t=tE(t)).forEach((function(e){return o.failedAreas.add(e)})),o.failedAreas.size===(void 0===fa?2:fa.CODES.size)?((t=new ca(n,Pg)).serverCode=e,ra(t)):ra(Error("ap ".concat(t.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(t=new Ja(n,Pg)).serverCode=e,ra(t);default:return ra(Rn("ApResErrType",i))}})),x(z(o),"getApEdgeInfo$",void 0),x(z(o),"getApEdgeInfoEndFirst$",void 0),x(z(o),"apFinish$",new rb),x(z(o),"retryCount",0),x(z(o),"failedAreas",new Set),x(z(o),"usedUrl",[]),x(z(o),"newDomainUsed",!1),x(z(o),"backupNewDomainUsed",!1),x(z(o),"genUrl",(function(){return void 0===fa?ej.apply(void 0,Z(Cf([pE,qE]))).pipe(fj((function(e){return ob.apply(void 0,Z(e))}))):ob.apply(void 0,Z(fa.AP_DOMAINS.slice(0,3).map(xe)))})),x(z(o),"genBackupUrl",(function(){return void 0===fa?ej.apply(void 0,Z(Cf([rE,sE]))).pipe(fj((function(e){return ob.apply(void 0,Z(e))}))):ob.apply(void 0,Z(fa.AP_BACKUP_DOMAINS.slice(0,3).map(xe)))})),x(z(o),"getApUrl$",(function(e){var n,r;return o.genUrl().pipe(yb((function(e){return!(o.newDomainUsed&&e.includes("sd-rtn.com")||(e.includes("sd-rtn.com")&&(o.newDomainUsed=!0),Ol(o.usedUrl,(function(t){var n;return t===(null===(n=e.match(Ai))||void 0===n?void 0:n[1])}))))})),sa((function(e){var t;void 0===fa&&"string"==typeof(e=null===(t=e.match(Ai))||void 0===t?void 0:t[1])&&o.usedUrl.push(e)})),hb(e?Math.max(Ec.RECONNECTING_AP_NUM,null!==(n=null==fa?void 0:fa.CODES.size)&&void 0!==n?n:0):null!==(r=null==fa?void 0:fa.CODES.size)&&void 0!==r?r:2),$d((function(){return t.runOutOfUrlSymbol})),ab((function(e,n){return o.newDomainUsed=!1,e===t.runOutOfUrlSymbol?(o.usedUrl=[],n):ra(e)})))})),x(z(o),"getBackupApUrl$",(function(e){var n,r;return o.genBackupUrl().pipe(yb((function(e){return!(o.backupNewDomainUsed&&e.includes("sd-rtn.com")||(e.includes("sd-rtn.com")&&(o.backupNewDomainUsed=!0),Ol(o.usedUrl,(function(t){var n;return t===(null===(n=e.match(Ai))||void 0===n?void 0:n[1])}))))})),sa((function(e){var t;void 0===fa&&"string"==typeof(e=null===(t=e.match(Ai))||void 0===t?void 0:t[1])&&o.usedUrl.push(e)})),hb(e?Math.max(Ec.RECONNECTING_AP_NUM,null!==(n=null==fa?void 0:fa.CODES.size)&&void 0!==n?n:0):null!==(r=null==fa?void 0:fa.CODES.size)&&void 0!==r?r:2),$d((function(){return t.runOutOfUrlSymbol})),ab((function(e,n){return o.backupNewDomainUsed=!1,e===t.runOutOfUrlSymbol?(o.usedUrl=[],n):ra(e)})))})),x(z(o),"getProxyApUrl$",(function(e){var t,n;return ob.apply(void 0,Z(((null==fa?void 0:fa.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map(xe))).pipe(hb(e?Math.max(Ec.RECONNECTING_AP_NUM,null!==(t=null==fa?void 0:fa.CODES.size)&&void 0!==t?t:0):null!==(n=null==fa?void 0:fa.CODES.size)&&void 0!==n?n:2))})),x(z(o),"context",void 0),x(z(o),"fetchCloudProxy",(function(e,t){var n=uj("AP-",o.loggerId);o.log("The AccessPoint requests %s(%s)",e,n);var r,i=new AbortController;return o.apFinish$.pipe(hb(1)).subscribe((function(){return i.abort()})),yd(ma(N.mark((function r(){var s,a;return N.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=mh(0,Number.MAX_SAFE_INTEGER),o.log("%s request opid: %d",n,a),bb("ApRequest",{sid:o.context.sid,userId:o.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(o.context.startTime),apAddr:e,opId:P.fromNumber(a),envId:0,flag:128},null!==(s=o.context.config.enableCloudProxy)&&void 0!==s&&s),r.abrupt("return",lh(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:o.context.sid,opid:a,appid:o.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:null!=t?t:o.context.key,cname:o.context.uid,uid:0,detail:Wa({},void 0===fa?{11:[S.CHINA,S.GLOBAL].join(),12:"1"}:{11:Array.from(fa.CODES).map((function(e){return e===S.OVERSEA?"".concat(S.ASIA,",").concat(S.EUROPE,",").concat(S.AFRICA,",").concat(S.NORTH_AMERICA,",").concat(S.SOUTH_AMERICA,",").concat(S.OCEANIA):e})).join(","),12:"1"})}}]},signal:i.signal}));case 4:case"end":return r.stop()}}),r)})))).pipe(ab((function(t){return"AbortError"!==t.name&&(o.logError(t),o.warn("The AP server %s request failure",e,t)),Sb})),Cb((r=ma(N.mark((function t(r){var i,s,a,c,u,l,A,h,d,p,f,g,m,v,y,_,E,b,w;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r.responseText,s=JSON.parse(i),o.log("The %s response is %o",n,s),(void 0===(a=s.response_body)||0===a.length||a.some((function(e){var t;return void 0===(null===(t=e.buffer)||void 0===t?void 0:t.code)||23!==e.uri})))&&ra(new Ja("cloud proxy response_body not valid",Pg)),0===(c=a.filter((function(e){return 0!==e.buffer.code}))).length){t.next=14;break}if(void 0===(u=c.find((function(e){return 128===e.buffer.flag})))){t.next=12;break}return t.abrupt("return",o.handleUniLbsError(u.buffer.code,e));case 12:return o.logError("cloud proxy error response"),t.abrupt("return",o.handleUniLbsError(c[0].buffer.code,e));case 14:for(l=[],A=0;A<a.length;A++)if(262144===(null==(p=a[A])||null===(h=p.buffer)||void 0===h?void 0:h.flag))null===(f=p.buffer)||void 0===f||null===(g=f.edges_services)||void 0===g||null===(m=g.forEach)||void 0===m||m.call(g,(function(e){Pn(e=e.ip)&&-1===o.context.cloudProxyServers.indexOf(e)&&(o.log("got cloud proxy server: %s",e),o.context.cloudProxyServers.push(e))}));else if(128===(null==p||null===(d=p.buffer)||void 0===d?void 0:d.flag)){for(E=function(e,t){var n=t[e];l.some((function(e){return e.ip===n.ip}))||l.push({ip:n.ip,ticket:p.buffer.cert})},b=0,w=p.buffer.edges_services;b<w.length;b++)E(b,w);o.context.rtmArea=null!==(v=null===(y=p.buffer)||void 0===y||null===(_=y.detail)||void 0===_?void 0:_[9])&&void 0!==v?v:""}return t.abrupt("return",ob.apply(void 0,Z(l).concat([Mg])));case 19:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})),ab((function(e){return Na(e)?ra(e):Sb})),bh(),yb((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket&&Pn(e.ip)})))})),x(z(o),"fetchAp",(function(e,t){var n=uj("AP-",o.loggerId);o.log("The AccessPoint requests %s(%s)",e,n);var r=new AbortController;o.apFinish$.pipe(hb(1)).subscribe((function(){return r.abort()}));var i,s=mh(0,Number.MAX_SAFE_INTEGER);return yd(ma(N.mark((function i(){var a;return N.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return o.log("%s request opid: %d",n,s),bb("ApRequest",{sid:o.context.sid,userId:o.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(o.context.startTime),apAddr:e,opId:P.fromNumber(s),envId:0,flag:128},null!==(a=o.context.config.enableCloudProxy)&&void 0!==a&&a),i.abrupt("return",lh(e,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:s,key:t||o.context.key,cname:o.context.uid,detail:Wa({},void 0===fa?{11:[S.CHINA,S.GLOBAL].join(),12:"1"}:{11:Array.from(fa.CODES).map((function(e){return e===S.OVERSEA?"".concat(S.ASIA,",").concat(S.EUROPE,",").concat(S.AFRICA,",").concat(S.NORTH_AMERICA,",").concat(S.SOUTH_AMERICA,",").concat(S.OCEANIA):e})).join(","),12:"1"}),uid:0,sid:o.context.sid},signal:r.signal}));case 3:case"end":return i.stop()}}),i)})))).pipe(ab((function(t){return"AbortError"!==t.name&&(o.logError(t),o.warn("The AP server %s request failure",e,t)),Sb})),Cb((i=ma(N.mark((function t(r){var i,a,c,u,l,A,h,d,p;return N.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=r.responseText,c=JSON.parse(a),o.log("The %s response is %o",n,c),l=(u=c).code,A=u.addresses,h=u.detail,o.context.vid=h[8],bb("ApEvent",{sid:o.context.sid,userId:o.context.uid,lts:P.fromNumber(Date.now()),elapse:Xa(o.context.startTime),apAddr:e,linkServerList:A.map((function(e){return e.ip})),serverErrCode:l,flag:128,envId:0,opId:P.fromNumber(s),errCode:0,area:h[9],isp:h[2]},null!==(i=o.context.config.enableCloudProxy)&&void 0!==i&&i),o.info(c),0===l){t.next=9;break}return t.abrupt("return",o.handleUniLbsError(l,e));case 9:if(d=A,$f(null)&&(p=JSON.parse(null.replace(/-/g,".")),d=p.map((function(e){return{ip:e,ticket:d[0].ticket}}))),0!==d.length){t.next=14;break}return t.abrupt("return",ra(Error("No available edge address to connect")));case 14:return o.context.rtmArea=null==h?void 0:h[9],t.abrupt("return",ob.apply(void 0,Z(d).concat([Mg])));case 16:case"end":return t.stop()}}),t)}))),function(e){return i.apply(this,arguments)})),bh(),ab((function(e){return Na(e)?ra(e):Sb})),yb((function(e){return void 0!==e&&"string"==typeof e.ip&&"string"==typeof e.ticket})))})),o.context=e,o.getApEdgeInfoEndFirst$=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return dd(0,e||i?Ec.RECONNECTING_AP_INTERVAL:2e3).pipe(hb(1),sa((function(){o.retryCount+=1})),Cb((function(){return o.context.config.enableCloudProxy||o.context.socketUseProxy?o.getProxyApUrl$(e||i):(4<=o.retryCount&&(o.retryCount=0),3>=o.retryCount?o.getApUrl$(e||i):o.getBackupApUrl$(e||i))})),Cb((function(e){return o.context.config.enableCloudProxy||o.context.socketUseProxy?o.fetchCloudProxy(e):o.fetchAp(e)})),ab((function(e){return e instanceof Tb&&o.warn("AP request timeout"),ra(e)})),tn((function(e){return e.ip})),Kc(o.apFinish$))},o.getApEdgeInfo$=function(e){return dd(0,e||i?Ec.RECONNECTING_AP_INTERVAL:2e3).pipe(hb(8),sa((function(){o.retryCount+=1})),Cb((function(){return o.context.config.enableCloudProxy||o.context.socketUseProxy?o.getProxyApUrl$(e||i):3>=o.retryCount?o.getApUrl$(e||i):o.getBackupApUrl$(e||i)})),Cb((function(e){return(o.context.config.enableCloudProxy||o.context.socketUseProxy?o.fetchCloudProxy(e):o.fetchAp(e)).pipe()})),ab((function(e){return e instanceof Tb&&o.warn("AP request timeout"),ra(e)})),tn((function(e){return e.ip})),Kc(o.apFinish$))},o}Ga(t,e);var n=Ha(t);return eb(t,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),t}(sc());x(at,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var bt=yi(),ct=function(e){function t(e,r,i){va(this,t);var o=n.call(this,r,"Connection");x(z(o),"apClient",void 0),x(z(o),"lastOpenSockets",[new Te(1),new Te(1)]),x(z(o),"curOpenSockets",[void 0,void 0]),x(z(o),"ipIterator",0),x(z(o),"loginSocketOpenFailureCount",0),x(z(o),"firstEnv",.5<=Math.random()?1:0),x(z(o),"firstSocketOpener",void 0),x(z(o),"secondSocketOpener",void 0),x(z(o),"firstOpenKeeperSubject",new rb),x(z(o),"secondOpenKeeperSubject",new rb),x(z(o),"blacklistedIP",{}),x(z(o),"edgeInfoReplayed",void 0),x(z(o),"firstEnvOpenSocket",void 0),x(z(o),"firstOpenKeeperSub",void 0),x(z(o),"secondOpenKeeperSub",void 0),x(z(o),"context",void 0),x(z(o),"logger",void 0),o.context=e,o.logger=r,o.apClient=new at(o.context,r),o.apClient.apFinish$.subscribe((function(){o.log("Ap client fetch finished")}));var s,a=[];return o.edgeInfoReplayed=o.apClient.getApEdgeInfo$(i).pipe(Re((function(e){return e.pipe(sa((function(e){if(Na(e))throw e})),Zd(i?ue.getParameter("RECONNECTING_AP_INTERVAL"):900),Kc(dd(2e4)))})),yb((function(e){var t;return!Ol(a,e)&&1>=(null!==(t=o.blacklistedIP[e.ip])&&void 0!==t?t:0)})),$d((function(){return new bt({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),sa((function(e){a.push(e),o.log("An edge info got %o",e)})),sa({error:function(e){o.emit("connectionInitFailure",e)}}),fh((function(){o.apClient.clearUp()})),wn()),o.firstEnvOpenSocket=o.edgeInfoReplayed.pipe(Cb((function(e){if(void 0===e)return ra(Error("Invalid edge info"));var t=new Vl(e.ip,o.firstEnv,e.ticket,o.context,r,s);if(o.firstEnv=1===o.firstEnv?0:1,t.once("connectionFailure",(function(){return o.onSocketConnectionFailure(t)})),!i&&Ec.ENABLE_EDGE_AUTO_FALLBACK&&!o.context.config.enableCloudProxy){var n,a=Date.now();t.on("reconnect",(function(){var e;o.loginSocketOpenFailureCount+=1,null!==(e=n)&&void 0!==e||(n=Date.now()-a),500>n&&1<o.loginSocketOpenFailureCount&&(o.context.socketUseProxy=!0)}))}return s=!t.useNewDomain,t.open$.pipe(Uf(t))})),sa((function(e){o.log("The websocket of ENV_%d opened to %s:%d",e.env,e.ip,Df[e.env]),o.curOpenSockets[e.env]=e,o.lastOpenSockets[e.env].next(e),o.firstEnv=e.env,o.openSecondSocket(e.env,e.ip,e.useNewDomain)})),hb(1),Se()),o.firstSocketOpener=o.firstEnvOpenSocket.pipe(Cb((function(e){return e.open$.pipe(sa((function(){o.log("The websocket of first ENV_%d re-opened to %s:%d",e.env,e.ip,Df[e.env]),o.curOpenSockets[e.env]=e,o.lastOpenSockets[e.env].next(e)})))}))),e=o.firstOpenKeeperSubject.pipe(Kb(wd)),o.firstOpenKeeperSub=e.subscribe({error:o.logError}),o}Ga(t,e);var n=Ha(t);return eb(t,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(e,t){if(![0,1].includes(e))throw new mb({INVALID_ENV:"The env argument is not 0 or 1"});var n=e===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var r=this.curOpenSockets[e];this.curOpenSockets[e]=void 0,r&&(r.isActiveClose=!0,setTimeout((function(){r.close()}),t)),void 0!==n&&setTimeout((function(){null==n||n.unsubscribe()}),t)}},{key:"waitClosing",value:function(e){var t=this;return e.isActiveClose=!0,e.open$.pipe(ev(),ab((function(e){return e.message===ns.normalClosureMessage?Sb:ra(e)})),Lb(5e3),ab((function(n){return n instanceof Tb?(t.warn("Force closing the ENV_%d connection",e.env),Sb):ra(n)})))}},{key:"onSocketConnectionFailure",value:function(e){var t=[0,1].filter((function(t){return t!==e.env}))[0];(t=this.curOpenSockets[t])&&t.loggedIn?this.reopenSocketWithApRequest(e.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(e,t,n){var r=this,i=1===e?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(vn((function(e,t){return[].concat(Z(e),[t])}),[]),Ea((function(e){return ls(e,(function(e){return Sn(t,e.ip)})).slice(-1)[0]})),hb(1),Cb((function(e){if(void 0===e)return ra(Error("Invalid edge info"));var t=new Vl(e.ip,i,e.ticket,r.context,r.logger,n);return t.on("connectionFailure",(function(){return r.onSocketConnectionFailure(t)})),t.open$.pipe(sa((function(){r.lastOpenSockets[i].next(t),r.curOpenSockets[i]=t})))})),Se()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Kb(wd)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(e){var t=this,n=[0,1].filter((function(t){return t!==e}))[0];if(void 0!==(n=this.curOpenSockets[n])){var r,i=n.ip;n=this.apClient.getApEdgeInfoEndFirst$(!0).pipe($d((function(){return new bt({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})})),Re((function(e){return e.pipe(sa((function(e){if(e.code===ti)t.emit("tokenExpired"),t.apClient.apFinish$.next(void 0);else if(Na(e))throw e})),Zd(ue.getParameter("RECONNECTING_AP_INTERVAL")),Kc(dd(15e3)))})),sa((function(e){t.log("An edge info got %o",e)})),fh((function(){t.apClient.clearUp()}))).pipe(vn((function(e,t){return[].concat(Z(e),[t])}),[]),Ea((function(e){return(e=ls(e,(function(e){return Sn(i,e.ip)}))).length-1>=t.ipIterator?e.slice(-t.ipIterator++-1)[0]:(t.ipIterator=0,e.slice(-1)[0])})),$d(),Cb((function(n){if(void 0===n)return ra(Error("Invalid edge info"));var i=new Vl(n.ip,e,n.ticket,t.context,t.logger,r);return i.on("connectionFailure",(function(){return t.onSocketConnectionFailure(i)})),r=!i.useNewDomain,i.open$.pipe(Uf(i))})),sa((function(n){t.log("The websocket of ENV_%d re-opened to %s:%d using ap",n.env,n.ip,Df[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})),Cb((function(n){return n.open$.pipe(sa((function(){t.log("The websocket of ENV_%d re-opened to %s:%d",n.env,n.ip,Df[n.env]),t.curOpenSockets[e]=n,t.lastOpenSockets[e].next(n)})))})),Se()),e===this.firstEnv?this.firstOpenKeeperSubject.next(n):this.secondOpenKeeperSubject.next(n)}}}]),t}(sc()),xE=function(e){function t(e,r,i){return va(this,t),x(z(i=n.call(this,i,"Context")),"_token",void 0),x(z(i),"config",void 0),x(z(i),"_uid",void 0),x(z(i),"_sid",void 0),x(z(i),"_vid",void 0),x(z(i),"_startTime",void 0),x(z(i),"_area","CN"),x(z(i),"_socketUseProxy",!1),x(z(i),"appId",void 0),x(z(i),"enableCloudProxy",!1),x(z(i),"cloudProxyServers",[]),i.appId=e,i.config=r,i}Ga(t,e);var n=Ha(t);return eb(t,[{key:"socketUseProxy",get:function(){return this._socketUseProxy&&Ec.ENABLE_EDGE_AUTO_FALLBACK},set:function(e){this.log("socketUseProxy is set to %s",e),this._socketUseProxy=e}},{key:"token",set:function(e){this._token="string"==typeof e&&e?e:void 0}},{key:"uid",get:function(){if("string"==typeof this._uid&&this._uid)return this._uid;throw new rc("Cannot get illegal uid")},set:function(e){if(this.log("The user ID is set to %s",La(e)),!Ta(e))throw new rc;this._uid=e}},{key:"vid",get:function(){if("string"==typeof this._vid&&this._vid)return this._vid;throw new rc("Cannot get illegal vid")},set:function(e){this._vid=e}},{key:"key",get:function(){if("string"==typeof this._token&&this._token)return this._token;if("string"==typeof this.appId&&this.appId)return this.appId;throw new rc("Cannot get illegal key")}},{key:"sid",get:function(){if("string"==typeof this._sid&&this._sid)return this._sid;throw new rc("Cannot get illegal sid")},set:function(e){if(this.log("sid is set to %s",e),"string"!=typeof e||!e)throw new rc;this._sid=e}},{key:"startTime",get:function(){if("number"==typeof this._startTime&&this._startTime)return this._startTime;throw new rc("Cannot get illegal startTime")},set:function(e){if(this.log("startTime is set to %s",e),"number"!=typeof e||!e)throw new rc;this._startTime=e}},{key:"rtmArea",get:function(){if("string"==typeof this._area&&this._area)return this._area;throw new rc("Cannot get illegal area")},set:function(e){this.log("area is set to %s",e),"string"==typeof e&&e?this._area=e:this.warn("set area failed")}}]),t}(sc());Sp("of",(function(){for(var e=0,t=arguments.length,n=new(qf(this))(t);t>e;)n[e]=arguments[e++];return n}),rk);var yE=Math.max,Pv=function(e,t,n){var r=Object(e);if(!ae(e)){var i=wf(t);e=Wd(e),t=function(e){return i(r[e],e,r)}}return-1<(t=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;if(null==n)n=0;else{var i=(n=Rl(n))%1;n=n==n?i?n-i:n:0}return 0>n&&(n=yE(r+n,0)),Yq(e,wf(t),n)}(e,t,n))?r[i?e[t]:t]:void 0},Ov=function(e,t){return e&&e.length?fl(e,void 0,"function"==typeof t?t:void 0):[]},dt=function(){function e(){va(this,e),x(this,"size",0),x(this,"fields",new Map)}return eb(e,[{key:"define",value:function(e,t,n){if(this.size+=n,64<this.size)throw new RangeError("the struct over 64 bits is not supported");th(t={val:0,isNumber:"number"===t,isBoolean:"boolean"===t,oneof:"number"===t||"boolean"===t?void 0:t,len:n}),this.fields.set(e,t)}},{key:"set",value:function(e,t){if(!(e=this.fields.get(e)))throw Error("field not found");var n=e.oneof;if(!P.isLong(t)&&"number"!=typeof t)if("boolean"==typeof t)t=t?1:0;else{if(void 0===n)throw Error("invalid field type");if(void 0===(t=n[t]))throw Error("field type not found")}th(e,t),e.val=t}},{key:"toNumber",value:function(){for(var e=0,t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=$a(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e+=P.fromValue(i).shiftLeft(t).toNumber(),t+=o)}return e}},{key:"toLong",value:function(){for(var e=P.fromNumber(0,!0),t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=$a(r[n],2)[1],o=i.len;void 0!==(i=i.val)&&(e=P.fromValue(i).shiftLeft(t).add(e),t+=o)}return e}},{key:"assert",value:function(e,t){function n(e){if(!P.isLong(e)&&"number"!=typeof e)if("boolean"==typeof e)e=e?1:0;else{if(void 0===i)throw Error("invalid field type");if(void 0===(e=i[e]))throw Error("field type not found")}return th(r,e),sh(e,r.val)}var r=this.fields.get(e);if(!r)throw Error("field not found");var i=r.oneof;if(!Array.isArray(t))return n(t);if(1===t.length)return n(t[0]);if(t.every((function(e){return"string"==typeof e}))&&void 0!==i)return t.some((function(e){return n(e)}));throw Error("invalid valueTypes")}},{key:"from",value:function(e){e=P.fromValue(e);for(var t=0,n=0,r=Array.from(this.fields);n<r.length;n++){var i=$a(r[n],2)[1],o=i.len,s=P.fromNumber(Math.pow(2,o)-1,!0).shiftLeft(t);th(i,s=e.and(s).shiftRightUnsigned(t)),i.val=s,t+=o}}},{key:"typeOf",value:function(e){if(void 0!==(e=this.fields.get(e))){var t=e.oneof;if(e=e.val,void 0!==t){var n=0;for(t=Object.entries(t);n<t.length;n++){var r=$a(t[n],2),i=r[0];if(sh(e,r[1]))return i}}}throw new TypeError("can only get type of oneof type")}}]),e}(),et=function(e){function t(e){va(this,t);var r=n.call(this);return r.define("Rejoin","boolean",1),r.define("Unused","number",31),r.define("Platform","number",8),r.define("Version","number",12),r.define("Subversion","number",12),r.set("Platform",7),r.set("Version",4),r.set("Subversion",18),r.set("Rejoin",e),r}Ga(t,e);var n=Ha(t);return t}(dt),zE=Wa(Wa({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),ft={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},AE=Wa(Wa({},zE),ft),BE={Uncompressed:0,Zlib:1},Ef=function(e){function t(e){va(this,t);var r=n.call(this);if(r.define("MessageType",AE,8),r.define("BroadcastJumps","number",2),r.define("ToCache","boolean",1),r.define("FromCache","boolean",1),r.define("CompressionMethod",BE,2),r.define("IterationNumber","number",4),r.define("BufferedMessage","boolean",1),r.define("ToArchive","boolean",1),r.define("FromArchive","boolean",1),"number"==typeof e||P.isLong(e))r.from(e);else if(void 0!==e){var i=0;for(e=qh(e);i<e.length;i++){var o=$a(e[i],2);r.set(o[0],o[1])}}return r}Ga(t,e);var n=Ha(t);return eb(t,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(e){var t=this;return void 0!==e?this.assert("MessageType",e):Yf(ft).some((function(e){return t.assert("MessageType",e)}))}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),t}(dt),CE=function(e){function t(e){return va(this,t),x(z(e=n.call(this,e,"ChatManager")),"dialogueLru",new xz(void 0,{maxlen:1e4,ttl:1e4})),e}Ga(t,e);var n=Ha(t);return eb(t,[{key:"getChatInfo",value:function(e){var t=this.dialogueLru.get(e);if(this.dialogueLru.prune(),t){var n=t.dialogue,r={dialogue:n,sequence:t=t.sequence.add(1)};return this.dialogueLru.set(e,{dialogue:n,sequence:t}),r}return n={dialogue:nh(),sequence:P.fromNumber(1,!0)},this.dialogueLru.set(e,n),n}}]),t}(sc()),G={};"object"==("undefined"==typeof module?"undefined":qa(module))&&(module.exports=G),G.parse=function(e,t){var n,r=G.bin.readUshort,i=G.bin.readUint,o={};for(n=(e=new Uint8Array(e)).length-4;101010256!=i(e,n);)n--;var s=r(e,n=n+4+4);r(e,n+=2),i(e,n+=2),n=i(e,n+=4);for(var a=0;a<s;a++){i(e,n),n+=4,n+=4,n+=4,i(e,n+=4);var c=i(e,n+=4),u=i(e,n+=4),l=r(e,n+=4),A=r(e,n+2),h=r(e,n+4);n+=6;var d=i(e,n+=8);n+=4,n+=l+A+h,G._readLocal(e,d,o,c,u,t)}return o},G._readLocal=function(e,t,n,r,i,o){var s=G.bin.readUshort,a=G.bin.readUint;a(e,t),s(e,t+=4),s(e,t+=2);var c=s(e,t+=2);a(e,t+=2),a(e,t+=4),a=s(e,t=t+4+8);var u=s(e,t+=2);if(t+=2,s=G.bin.readUTF8(e,t,a),t=t+a+u,o)n[s]={size:i,csize:r};else if(e=new Uint8Array(e.buffer,t),0==c)n[s]=new Uint8Array(e.buffer.slice(t,t+r));else{if(8!=c)throw"unknown compression method: "+c;t=new Uint8Array(i),G.inflateRaw(e,t),n[s]=t}},G.inflateRaw=function(e,t){return G.F.inflate(e,t)},G.inflate=function(e,t){return e[0],e[1],G.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),t)},G.deflate=function(e,t){null==t&&(t={level:6});var n=0,r=new Uint8Array(50+Math.floor(1.1*e.length));return r[n]=120,r[n+1]=156,n=G.F.deflateRaw(e,r,n+2,t.level),e=G.adler(e,0,e.length),r[n+0]=e>>>24&255,r[n+1]=e>>>16&255,r[n+2]=e>>>8&255,r[n+3]=e>>>0&255,new Uint8Array(r.buffer,0,n+4)},G.deflateRaw=function(e,t){null==t&&(t={level:6});var n=new Uint8Array(50+Math.floor(1.1*e.length)),r=G.F.deflateRaw(e,n,r,t.level);return new Uint8Array(n.buffer,0,r)},G.encode=function(e,t){null==t&&(t=!1);var n,r=0,i=G.bin.writeUint,o=G.bin.writeUshort,s={};for(n in e){var a=!G._noNeed(n)&&!t,c=e[n],u=G.crc.crc(c,0,c.length);s[n]={cpr:a,usize:c.length,crc:u,file:a?G.deflateRaw(c):c}}for(n in s)r+=s[n].file.length+30+46+2*G.bin.sizeUTF8(n);for(n in e=new Uint8Array(r+22),t=0,c=[],s)u=s[n],c.push(t),t=G._writeHeader(e,t,n,u,0);for(n in r=0,a=t,s)u=s[n],c.push(t),t=G._writeHeader(e,t,n,u,1,c[r++]);return s=t-a,i(e,t,101010256),o(e,t=t+4+4,r),o(e,t+=2,r),i(e,t+=2,s),i(e,t+4,a),e.buffer},G._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),-1!="png,jpg,jpeg,zip".indexOf(e)},G._writeHeader=function(e,t,n,r,i,o){var s=G.bin.writeUint,a=G.bin.writeUshort,c=r.file;return s(e,t,0==i?67324752:33639248),t+=4,1==i&&(t+=2),a(e,t,20),a(e,t+=2,0),a(e,t+=2,r.cpr?8:0),s(e,t+=2,0),s(e,t+=4,r.crc),s(e,t+=4,c.length),s(e,t+=4,r.usize),a(e,t+=4,G.bin.sizeUTF8(n)),a(e,t+=2,0),t+=2,1==i&&(s(e,t=t+2+2+6,o),t+=4),t+=n=G.bin.writeUTF8(e,t,n),0==i&&(e.set(c,t),t+=c.length),t},G.crc={table:function(){for(var e=new Uint32Array(256),t=0;256>t;t++){for(var n=t,r=0;8>r;r++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}(),update:function(e,t,n,r){for(var i=0;i<r;i++)e=G.crc.table[255&(e^t[n+i])]^e>>>8;return e},crc:function(e,t,n){return 4294967295^G.crc.update(4294967295,e,t,n)}},G.adler=function(e,t,n){var r=1,i=0,o=t;for(t+=n;o<t;){for(n=Math.min(o+5552,t);o<n;)i+=r+=e[o++];r%=65521,i%=65521}return i<<16|r},G.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,n){e[t]=255&n,e[t+1]=n>>8&255,e[t+2]=n>>16&255,e[t+3]=n>>24&255},readASCII:function(e,t,n){for(var r="",i=0;i<n;i++)r+=String.fromCharCode(e[t+i]);return r},writeASCII:function(e,t,n){for(var r=0;r<n.length;r++)e[t+r]=n.charCodeAt(r)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,t,n){for(var r,i="",o=0;o<n;o++)i+="%"+G.bin.pad(e[t+o].toString(16));try{r=decodeURIComponent(i)}catch(r){return G.bin.readASCII(e,t,n)}return r},writeUTF8:function(e,t,n){for(var r=n.length,i=0,o=0;o<r;o++){var s=n.charCodeAt(o);if(0==(4294967168&s))e[t+i]=s,i++;else if(0==(4294965248&s))e[t+i]=192|s>>6,e[t+i+1]=128|s>>0&63,i+=2;else if(0==(4294901760&s))e[t+i]=224|s>>12,e[t+i+1]=128|s>>6&63,e[t+i+2]=128|s>>0&63,i+=3;else{if(0!=(4292870144&s))throw"e";e[t+i]=240|s>>18,e[t+i+1]=128|s>>12&63,e[t+i+2]=128|s>>6&63,e[t+i+3]=128|s>>0&63,i+=4}}return i},sizeUTF8:function(e){for(var t=e.length,n=0,r=0;r<t;r++){var i=e.charCodeAt(r);if(0==(4294967168&i))n++;else if(0==(4294965248&i))n+=2;else if(0==(4294901760&i))n+=3;else{if(0!=(4292870144&i))throw"e";n+=4}}return n}},G.F={},G.F.deflateRaw=function(e,t,n,r){var i=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][r],o=G.F.U,s=G.F._goodIndex;G.F._hash;var a=G.F._putsE,c=0;n<<=3;var u=0,l=e.length;if(0==r){for(;c<l;){var A=Math.min(65535,l-c);a(t,n,c+A==l?1:0),n=G.F._copyExact(e,c,A,t,n+8),c+=A}return n>>>3}a=o.lits,r=o.strt;var h=o.prev,d=0,p=0,f=0,g=0,m=0;for(2<l&&(r[m=G.F._hash(e,0)]=0),c=0;c<l;c++){if(A=m,c+1<l-2){m=G.F._hash(e,c+1);var v=c+1&32767;h[v]=r[m],r[m]=v}if(u<=c){if((14e3<d||26697<p)&&100<l-c&&(u<c&&(a[d]=c-u,d+=2,u=c),n=G.F._writeBlock(c==l-1||u==l?1:0,a,d,g,e,f,c-f,t,n),d=p=g=0,f=c),v=0,c<l-2&&(v=G.F._bestMatch(e,c,h,A,Math.min(i[2],l-c),i[3])),0!=v){A=v>>>16,v&=65535;var y=s(A,o.of0);o.lhst[257+y]++;var _=s(v,o.df0);o.dhst[_]++,g+=o.exb[y]+o.dxb[_],a[d]=A<<23|c-u,a[d+1]=v<<16|y<<8|_,d+=2,u=c+A}else o.lhst[e[c]]++;p++}}for(f==c&&0!=e.length||(u<c&&(a[d]=c-u,d+=2),n=G.F._writeBlock(1,a,d,g,e,f,c-f,t,n));0!=(7&n);)n++;return n>>>3},G.F._bestMatch=function(e,t,n,r,i,o){var s=32767&t,a=n[s],c=s-a+32768&32767;if(a==s||r!=G.F._hash(e,t-c))return 0;for(var u=r=0,l=Math.min(32767,t);c<=l&&0!=--o&&a!=s;){if((0==r||e[t+r]==e[t+r-c])&&(s=G.F._howLong(e,t,c))>r){if(u=c,(r=s)>=i)break;c+2<s&&(s=c+2);for(var A=0,h=0;h<s-2;h++){var d=t-c+h+32768&32767,p=d-n[d]+32768&32767;p>A&&(A=p,a=d)}}c+=(s=a)-(a=n[s])+32768&32767}return r<<16|u},G.F._howLong=function(e,t,n){if(e[t]!=e[t-n]||e[t+1]!=e[t+1-n]||e[t+2]!=e[t+2-n])return 0;var r=t,i=Math.min(e.length,t+258);for(t+=3;t<i&&e[t]==e[t-n];)t++;return t-r},G.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},G.saved=0,G.F._writeBlock=function(e,t,n,r,i,o,s,a,c){var u=G.F.U,l=G.F._putsF,A=G.F._putsE;u.lhst[256]++;var h=G.F.getTrees(),d=h[0],p=h[1],f=h[2],g=h[3],m=h[4],v=h[5],y=h[6];h=h[7];var _=32+(0==(c+3&7)?0:8-(c+3&7))+(s<<3),E=r+G.F.contSize(u.fltree,u.lhst)+G.F.contSize(u.fdtree,u.dhst);r=r+G.F.contSize(u.ltree,u.lhst)+G.F.contSize(u.dtree,u.dhst),r+=14+3*v+G.F.contSize(u.itree,u.ihst)+(2*u.ihst[16]+3*u.ihst[17]+7*u.ihst[18]);for(var b=0;286>b;b++)u.lhst[b]=0;for(b=0;30>b;b++)u.dhst[b]=0;for(b=0;19>b;b++)u.ihst[b]=0;if(_=_<E&&_<r?0:E<r?1:2,l(a,c,e),l(a,c+1,_),c+=3,0==_){for(;0!=(7&c);)c++;c=G.F._copyExact(i,o,s,a,c)}else{if(1==_)var w=u.fltree,S=u.fdtree;if(2==_){for(G.F.makeCodes(u.ltree,d),G.F.revCodes(u.ltree,d),G.F.makeCodes(u.dtree,p),G.F.revCodes(u.dtree,p),G.F.makeCodes(u.itree,f),G.F.revCodes(u.itree,f),w=u.ltree,S=u.dtree,A(a,c,g-257),A(a,c+=5,m-1),A(a,c+=5,v-4),c+=4,e=0;e<v;e++)A(a,c+3*e,u.itree[1+(u.ordr[e]<<1)]);c=G.F._codeTiny(y,u.itree,a,c+3*v),c=G.F._codeTiny(h,u.itree,a,c)}for(v=0;v<n;v+=2){for(y=(e=t[v])>>>23,e=o+(8388607&e);o<e;)c=G.F._writeLit(i[o++],w,a,c);0!=y&&(e=(d=t[v+1])>>16,s=d>>8&255,d&=255,A(a,c=G.F._writeLit(257+s,w,a,c),y-u.of0[s]),c+=u.exb[s],l(a,c=G.F._writeLit(d,S,a,c),e-u.df0[d]),c+=u.dxb[d],o+=y)}c=G.F._writeLit(256,w,a,c)}return c},G.F._copyExact=function(e,t,n,r,i){var o=i>>>3;return r[o]=n,r[o+1]=n>>>8,r[o+2]=255-r[o],r[o+3]=255-r[o+1],o+=4,r.set(new Uint8Array(e.buffer,t,n),o),i+(n+4<<3)},G.F.getTrees=function(){for(var e=G.F.U,t=G.F._hufTree(e.lhst,e.ltree,15),n=G.F._hufTree(e.dhst,e.dtree,15),r=[],i=G.F._lenCodes(e.ltree,r),o=[],s=G.F._lenCodes(e.dtree,o),a=0;a<r.length;a+=2)e.ihst[r[a]]++;for(a=0;a<o.length;a+=2)e.ihst[o[a]]++;a=G.F._hufTree(e.ihst,e.itree,7);for(var c=19;4<c&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,n,a,i,s,c,r,o]},G.F.getSecond=function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(e[n+1]);return t},G.F.nonZero=function(e){for(var t="",n=0;n<e.length;n+=2)0!=e[n+1]&&(t+=(n>>1)+",");return t},G.F.contSize=function(e,t){for(var n=0,r=0;r<t.length;r++)n+=t[r]*e[1+(r<<1)];return n},G.F._codeTiny=function(e,t,n,r){for(var i=0;i<e.length;i+=2){var o=e[i],s=e[i+1];r=G.F._writeLit(o,t,n,r);var a=16==o?2:17==o?3:7;15<o&&(G.F._putsE(n,r,s,a),r+=a)}return r},G.F._lenCodes=function(e,t){for(var n=e.length;2!=n&&0==e[n-1];)n-=2;for(var r=0;r<n;r+=2){var i=e[r+1],o=r+3<n?e[r+3]:-1,s=r+5<n?e[r+5]:-1,a=0==r?-1:e[r-1];if(0==i&&o==i&&s==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;11>(i=Math.min(o+1-r>>>1,138))?t.push(17,i-3):t.push(18,i-11),r+=2*i-2}else if(i==a&&o==i&&s==i){for(o=r+5;o+2<n&&e[o+2]==i;)o+=2;i=Math.min(o+1-r>>>1,6),t.push(16,i-3),r+=2*i-2}else t.push(i,0)}return n>>>1},G.F._hufTree=function(e,t,n){var r=[],i=e.length,o=t.length,s=0;for(s=0;s<o;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<i;s++)0!=e[s]&&r.push({lit:s,f:e[s]});if(e=r.length,i=r.slice(0),0==e)return 0;if(1==e)return t[1+((n=r[0].lit)<<1)]=1,t[1+((0==n?1:0)<<1)]=1;r.sort((function(e,t){return e.f-t.f})),s=r[0],o=r[1];var a=0,c=1,u=2;for(r[0]={lit:-1,f:s.f+o.f,l:s,r:o,d:0};c!=e-1;)s=a!=c&&(u==e||r[a].f<r[u].f)?r[a++]:r[u++],o=a!=c&&(u==e||r[a].f<r[u].f)?r[a++]:r[u++],r[c++]={lit:-1,f:s.f+o.f,l:s,r:o};for((r=G.F.setDepth(r[c-1],0))>n&&(G.F.restrictDepth(i,n,r),r=n),s=0;s<e;s++)t[1+(i[s].lit<<1)]=i[s].d;return r},G.F.setDepth=function(e,t){return-1!=e.lit?e.d=t:Math.max(G.F.setDepth(e.l,t+1),G.F.setDepth(e.r,t+1))},G.F.restrictDepth=function(e,t,n){var r=0,i=1<<n-t,o=0;for(e.sort((function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d})),r=0;r<e.length&&e[r].d>t;r++){var s=e[r].d;e[r].d=t,o+=i-(1<<n-s)}for(o>>>=n-t;0<o;)(s=e[r].d)<t?(e[r].d++,o-=1<<t-s-1):r++;for(;0<=r;r--)e[r].d==t&&0>o&&(e[r].d--,o++);0!=o&&console.log("debt left")},G.F._goodIndex=function(e,t){var n=0;return t[16|n]<=e&&(n|=16),t[8|n]<=e&&(n|=8),t[4|n]<=e&&(n|=4),t[2|n]<=e&&(n|=2),t[1|n]<=e&&(n|=1),n},G.F._writeLit=function(e,t,n,r){return G.F._putsF(n,r,t[e<<1]),r+t[1+(e<<1)]},G.F.inflate=function(e,t){var n=Uint8Array;if(3==e[0]&&0==e[1])return t||new n(0);var r=G.F,i=r._bitsF,o=r._bitsE,s=r._decodeTiny,a=r.makeCodes,c=r.codes2map,u=r._get17,l=r.U,A=null==t;A&&(t=new n(e.length>>>2<<3));for(var h,d,p,f,g=0,m=0,v=d=0,y=0;0==g;)if(g=i(e,y,1),h=i(e,y+1,2),y+=3,0==h)0!=(7&y)&&(y+=8-(7&y)),h=e[(y=4+(y>>>3))-4]|e[y-3]<<8,A&&(t=G.F._check(t,v+h)),t.set(new n(e.buffer,e.byteOffset+y,h),v),y=y+h<<3,v+=h;else{if(A&&(t=G.F._check(t,v+131072)),1==h&&(p=l.flmap,f=l.fdmap,m=511,d=31),2==h){for(d=o(e,y,5)+257,h=o(e,y+5,5)+1,p=o(e,y+10,4)+4,y+=14,f=0;38>f;f+=2)l.itree[f]=0,l.itree[f+1]=0;for(m=1,f=0;f<p;f++){var _=o(e,y+3*f,3);l.itree[1+(l.ordr[f]<<1)]=_,_>m&&(m=_)}y+=3*p,a(l.itree,m),c(l.itree,m,l.imap),p=l.lmap,f=l.dmap,y=s(l.imap,(1<<m)-1,d+h,e,y,l.ttree),m=(1<<(_=r._copyOut(l.ttree,0,d,l.ltree)))-1,d=(1<<(h=r._copyOut(l.ttree,d,h,l.dtree)))-1,a(l.ltree,_),c(l.ltree,_,p),a(l.dtree,h),c(l.dtree,h,f)}for(;;)if(y+=15&(h=p[u(e,y)&m]),0==(_=h>>>4)>>>8)t[v++]=_;else{if(256==_)break;h=v+_-254,264<_&&(h=v+((_=l.ldef[_-257])>>>3)+o(e,y,7&_),y+=7&_),y+=15&(_=f[u(e,y)&d]);var E=((_=l.ddef[_>>>4])>>>4)+i(e,y,15&_);for(y+=15&_,A&&(t=G.F._check(t,v+131072));v<h;)t[v]=t[v++-E],t[v]=t[v++-E],t[v]=t[v++-E],t[v]=t[v++-E];v=h}}return t.length==v?t:t.slice(0,v)},G.F._check=function(e,t){var n=e.length;return t<=n?e:((t=new Uint8Array(Math.max(n<<1,t))).set(e,0),t)},G.F._decodeTiny=function(e,t,n,r,i,o){for(var s=G.F._bitsE,a=G.F._get17,c=0;c<n;){var u=e[a(r,i)&t];i+=15&u;var l=u>>>4;if(15>=l)o[c]=l,c++;else{var A=u=0;for(16==l?(A=3+s(r,i,2),i+=2,u=o[c-1]):17==l?(A=3+s(r,i,3),i+=3):18==l&&(A=11+s(r,i,7),i+=7),l=c+A;c<l;)o[c]=u,c++}}return i},G.F._copyOut=function(e,t,n,r){for(var i=0,o=0,s=r.length>>>1;o<n;){var a=e[o+t];r[o<<1]=0,r[1+(o<<1)]=a,a>i&&(i=a),o++}for(;o<s;)r[o<<1]=0,r[1+(o<<1)]=0,o++;return i},G.F.makeCodes=function(e,t){var n,r,i=G.F.U,o=e.length,s=i.bl_count;for(n=0;n<=t;n++)s[n]=0;for(n=1;n<o;n+=2)s[e[n]]++;for(i=i.next_code,n=0,s[0]=0,r=1;r<=t;r++)n=n+s[r-1]<<1,i[r]=n;for(t=0;t<o;t+=2)0!=(s=e[t+1])&&(e[t]=i[s],i[s]++)},G.F.codes2map=function(e,t,n){for(var r=e.length,i=G.F.U.rev15,o=0;o<r;o+=2)if(0!=e[o+1]){var s=e[o+1],a=o>>1<<4|s,c=t-s;for(c=(s=e[o]<<c)+(1<<c);s!=c;)n[i[s]>>>15-t]=a,s++}},G.F.revCodes=function(e,t){for(var n=G.F.U.rev15,r=15-t,i=0;i<e.length;i+=2)e[i]=n[e[i]<<t-e[i+1]]>>>r},G.F._putsE=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8},G.F._putsF=function(e,t,n){n<<=7&t,e[t>>>=3]|=n,e[t+1]|=n>>>8,e[t+2]|=n>>>16},G.F._bitsE=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<n)-1},G.F._bitsF=function(e,t,n){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<n)-1},G.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},G.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},G.F.U=function(){var e=Uint16Array,t=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new t(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new t(286),dhst:new t(30),ihst:new t(19),lits:new t(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(e,t,n){for(;0!=t--;)e.push(0,n)}for(var t=G.F.U,n=0;32768>n;n++){var r=n;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,t.rev15[n]=(r>>>16|r<<16)>>>17}for(n=0;32>n;n++)t.ldef[n]=t.of0[n]<<3|t.exb[n],t.ddef[n]=t.df0[n]<<4|t.dxb[n];e(t.fltree,144,8),e(t.fltree,112,9),e(t.fltree,24,7),e(t.fltree,8,8),G.F.makeCodes(t.fltree,9),G.F.codes2map(t.fltree,9,t.flmap),G.F.revCodes(t.fltree,9),e(t.fdtree,32,5),G.F.makeCodes(t.fdtree,5),G.F.codes2map(t.fdtree,5,t.fdmap),G.F.revCodes(t.fdtree,5),e(t.itree,19,0),e(t.ltree,286,0),e(t.dtree,30,0),e(t.ttree,320,0)}();var DE=Array.isArray||function(e){return e&&"number"==typeof e.length},EE=Object.defineProperty({isArray:DE},"__esModule",{value:!0}),FE=Object.defineProperty({isObject:function(e){return null!==e&&"object"===qa(e)}},"__esModule",{value:!0}),GE=Object.defineProperty({isFunction:function(e){return"function"==typeof e}},"__esModule",{value:!0}),HE=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),uh=Object.defineProperty({UnsubscriptionError:HE},"__esModule",{value:!0}),IE=function(){function e(e){this.closed=!1,this._subscriptions=this._parentOrParents=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){if(!this.closed){var t=this._parentOrParents,n=this._ctorUnsubscribe,r=this._unsubscribe,i=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,t instanceof e)t.remove(this);else if(null!==t)for(var o=0;o<t.length;++o)t[o].remove(this);if(GE.isFunction(r)){n&&(this._unsubscribe=void 0);try{r.call(this)}catch(e){var s=e instanceof uh.UnsubscriptionError?eo(e.errors):[e]}}if(EE.isArray(i))for(o=-1,t=i.length;++o<t;)if(n=i[o],FE.isObject(n))try{n.unsubscribe()}catch(e){s=s||[],e instanceof uh.UnsubscriptionError?s=s.concat(eo(e.errors)):s.push(e)}if(s)throw new uh.UnsubscriptionError(s)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(qa(t)){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;n instanceof e||(t=n,(n=new e)._subscriptions=[t]);break;default:throw Error("unrecognized teardown "+t+" added to Subscription.")}if(null===(t=n._parentOrParents))n._parentOrParents=this;else if(t instanceof e){if(t===this)return n;n._parentOrParents=[t,this]}else{if(-1!==t.indexOf(this))return n;t.push(this)}return null===(t=this._subscriptions)?this._subscriptions=[n]:t.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;t&&-1!==(e=t.indexOf(e))&&t.splice(e,1)},e.EMPTY=((t=new e).closed=!0,t),e}(),JE=Object.defineProperty({Subscription:IE},"__esModule",{value:!0}),KE=Ya&&Ya.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),LE=function(e){function t(t,n){return e.call(this)||this}return KE(t,e),t.prototype.schedule=function(e,t){return this},t}(JE.Subscription),ME=Object.defineProperty({Action:LE},"__esModule",{value:!0}),NE=Ya&&Ya.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),gt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return NE(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e,e=this.id;var n=this.scheduler;return null!=e&&(this.id=this.recycleAsyncId(n,e,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(n,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(e=this._execute(e,t))?e:void(!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},t.prototype._execute=function(e,t){t=!1;var n=void 0;try{this.work(e)}catch(e){t=!0,n=!!e&&e||Error(e)}if(t)return this.unsubscribe(),n},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(ME.Action);Object.defineProperty({AsyncAction:gt},"__esModule",{value:!0});var OE=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),ht=Object.defineProperty({Scheduler:OE},"__esModule",{value:!0}),PE=Ya&&Ya.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),it=function(e){function t(n,r){void 0===r&&(r=ht.Scheduler.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return PE(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(ht.Scheduler);Object.defineProperty({AsyncScheduler:it},"__esModule",{value:!0});var QE=Fa("iterator"),Wl=!la((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,r){t.delete("b"),n+=r+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[QE]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://ÑÐµÑÑ").host||"#%D0%B1"!==new URL("http://a#Ð±").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})),RE=/[^\0-\u007E]/,SE=/[.\u3002\uFF0E\uFF61]/g,Ff=Math.floor,Xl=String.fromCharCode,jt=function(e){var t=lg(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return Ia(t.call(e))},kt=Pc("fetch"),Yl=Pc("Headers"),TE=Fa("iterator"),lt=cb.set,cc=cb.getterFor("URLSearchParams"),UE=cb.getterFor("URLSearchParamsIterator"),VE=/\+/g,mt=Array(4),WE=function(e){try{return decodeURIComponent(e)}catch(t){return e}},nt=function(e){var t=e.replace(VE," ");e=4;try{return decodeURIComponent(t)}catch(i){for(;e;){var n=t.replace,r=e--;r=mt[r-1]||(mt[r-1]=RegExp("((?:%[\\da-f]{2}){"+r+"})","gi")),t=n.call(t,r,WE)}return t}},ot=/[!'()~]|%20/g,XE={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},pt=function(e){return XE[e]},qt=function(e,t){if(t){t=t.split("&");for(var n,r=0;r<t.length;)(n=t[r++]).length&&(n=n.split("="),e.push({key:nt(n.shift()),value:nt(n.join("="))}))}},YE=function(e){this.entries.length=0,qt(this.entries,e)},Gf=function(e,t){if(e<t)throw TypeError("Not enough arguments")},Zl=Wo((function(e,t){lt(this,{type:"URLSearchParamsIterator",iterator:jt(cc(e).entries),kind:t})}),"Iterator",(function(){var e=UE(this),t=e.kind,n=(e=e.iterator.next()).value;return e.done||(e.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),e})),Rg=function(){Ac(this,Rg,"URLSearchParams");var e,t,n,r=0<arguments.length?arguments[0]:void 0,i=[];if(lt(this,{type:"URLSearchParams",entries:i,updateURL:function(){},updateSearchParams:YE}),void 0!==r)if(xa(r)){var o=lg(r);if("function"==typeof o)for(r=o.call(r),o=r.next;!(e=o.call(r)).done;){var s=(e=jt(Ia(e.value))).next;if((t=s.call(e)).done||(n=s.call(e)).done||!s.call(e).done)throw TypeError("Expected sequence with length 2");i.push({key:t.value+"",value:n.value+""})}else for(e in r)ka(r,e)&&i.push({key:e,value:r[e]+""})}else qt(i,"string"==typeof r?"?"===r.charAt(0)?r.slice(1):r:r+"")},Bi=Rg.prototype;kf(Bi,{append:function(e,t){Gf(arguments.length,2);var n=cc(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){Gf(arguments.length,1);for(var t=cc(this),n=t.entries,r=e+"",i=0;i<n.length;)n[i].key===r?n.splice(i,1):i++;t.updateURL()},get:function(e){Gf(arguments.length,1);for(var t=cc(this).entries,n=e+"",r=0;r<t.length;r++)if(t[r].key===n)return t[r].value;return null},getAll:function(e){Gf(arguments.length,1);for(var t=cc(this).entries,n=e+"",r=[],i=0;i<t.length;i++)t[i].key===n&&r.push(t[i].value);return r},has:function(e){Gf(arguments.length,1);for(var t=cc(this).entries,n=e+"",r=0;r<t.length;)if(t[r++].key===n)return!0;return!1},set:function(e,t){Gf(arguments.length,1);for(var n,r=cc(this),i=r.entries,o=!1,s=e+"",a=t+"",c=0;c<i.length;c++)(n=i[c]).key===s&&(o?i.splice(c--,1):(o=!0,n.value=a));o||i.push({key:s,value:a}),r.updateURL()},sort:function(){var e,t,n=cc(this),r=n.entries,i=r.slice();for(t=r.length=0;t<i.length;t++){var o=i[t];for(e=0;e<t;e++)if(r[e].key>o.key){r.splice(e,0,o);break}e===t&&r.push(o)}n.updateURL()},forEach:function(e){for(var t,n=cc(this).entries,r=Dd(e,1<arguments.length?arguments[1]:void 0,3),i=0;i<n.length;)r((t=n[i++]).value,t.key,this)},keys:function(){return new Zl(this,"keys")},values:function(){return new Zl(this,"values")},entries:function(){return new Zl(this,"entries")}},{enumerable:!0}),Za(Bi,TE,Bi.entries),Za(Bi,"toString",(function(){for(var e,t=cc(this).entries,n=[],r=0;r<t.length;)e=t[r++],n.push(encodeURIComponent(e.key).replace(ot,pt)+"="+encodeURIComponent(e.value).replace(ot,pt));return n.join("&")}),{enumerable:!0}),zc(Rg,"URLSearchParams"),ea({global:!0,forced:!Wl},{URLSearchParams:Rg}),Wl||"function"!=typeof kt||"function"!=typeof Yl||ea({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t=[e];if(1<arguments.length){var n=arguments[1];if(xa(n)){var r=n.body;if("URLSearchParams"===jf(r)){var i=n.headers?new Yl(n.headers):new Yl;i.has("content-type")||i.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),n=jc(n,{body:Nc(0,String(r)),headers:Nc(0,i)})}}t.push(n)}return kt.apply(this,t)}});var Sg=R.URL,ZE=Rg,$E=cb.set,db=cb.getterFor("URL"),aF=Math.floor,rt=Math.pow,st=/[A-Za-z]/,bF=/[\d+-.A-Za-z]/,$l=/\d/,cF=/^(0x|0X)/,dF=/^[0-7]+$/,eF=/^\d+$/,tt=/^[\dA-Fa-f]+$/,fF=/[\0\t\n\r #%/:?@[\\]]/,gF=/[\0\t\n\r #/:?@[\\]]/,hF=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,iF=/[\t\n\r]/g,am=function(e,t){var n;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return"Invalid host";var r=jF(t.slice(1,-1));if(!r)return"Invalid host"}else if(wb(e)){for(r=[],t=t.toLowerCase().replace(SE,".").split("."),n=0;n<t.length;n++){var i=t[n],o=r,s=o.push;if(RE.test(i)){var a=i;i=[];var c=a;a=[];for(var u=0,l=c.length;u<l;){var A=c.charCodeAt(u++);if(55296<=A&&56319>=A&&u<l){var h=c.charCodeAt(u++);56320==(64512&h)?a.push(((1023&A)<<10)+(1023&h)+65536):(a.push(A),u--)}else a.push(A)}u=a.length,l=128;var d=0,p=72;for(c=0;c<a.length;c++){var f=a[c];128>f&&i.push(Xl(f))}for((h=A=i.length)&&i.push("-");h<u;){var g=2147483647;for(c=0;c<a.length;c++)(f=a[c])>=l&&f<g&&(g=f);var m=h+1;if(g-l>Ff((2147483647-d)/m))throw RangeError("Overflow: input needs wider integers to process");for(d+=(g-l)*m,l=g,c=0;c<a.length;c++){if((f=a[c])<l&&2147483647<++d)throw RangeError("Overflow: input needs wider integers to process");if(f==l){var v=d;for(f=36;!(v<(g=f<=p?1:f>=p+26?26:f-p));f+=36){var y=36-g,_=i;g+=(v-=g)%y,_.push.call(_,Xl(g+22+75*(26>g))),v=Ff(v/y)}for(i.push(Xl(v+22+75*(26>v))),p=m,f=0,d=h==A?Ff(d/700):d>>1,d+=Ff(d/p);455<d;f+=36)d=Ff(d/35);p=Ff(f+36*d/(d+38)),d=0,++h}}++d,++l}i="xn--"+i.join("")}s.call(o,i)}if(t=r.join("."),fF.test(t))return"Invalid host";if(null===(r=kF(t)))return"Invalid host"}else{if(gF.test(t))return"Invalid host";for(r="",t=ge(t),n=0;n<t.length;n++)r+=Qd(t[n],Ci)}e.host=r},kF=function(e){var t,n=e.split(".");n.length&&""==n[n.length-1]&&n.pop();var r=n.length;if(4<r)return e;var i=[];for(t=0;t<r;t++){var o=n[t];if(""==o)return e;var s=10;if(1<o.length&&"0"==o.charAt(0)&&(s=cF.test(o)?16:8,o=o.slice(8==s?1:2)),""===o)o=0;else{if(!(10==s?eF:8==s?dF:tt).test(o))return e;o=parseInt(o,s)}i.push(o)}for(t=0;t<r;t++)if(o=i[t],t==r-1){if(o>=rt(256,5-r))return null}else if(255<o)return null;for(e=i.pop(),t=0;t<i.length;t++)e+=i[t]*rt(256,3-t);return e},jF=function(e){var t,n,r=[0,0,0,0,0,0,0,0],i=0,o=null,s=0,a=function(){return e.charAt(s)};if(":"==a()){if(":"!=e.charAt(1))return;s+=2,o=++i}for(;a();){if(8==i)return;if(":"==a()){if(null!==o)return;s++,o=++i}else{for(t=n=0;4>n&&tt.test(a());)t=16*t+parseInt(a(),16),s++,n++;if("."==a()){if(0==n)return;if(s-=n,6<i)return;for(t=0;a();){if(n=null,0<t){if(!("."==a()&&4>t))return;s++}if(!$l.test(a()))return;for(;$l.test(a());){var c=parseInt(a(),10);if(null===n)n=c;else{if(0==n)return;n=10*n+c}if(255<n)return;s++}r[i]=256*r[i]+n,2!=++t&&4!=t||i++}if(4!=t)return;break}if(":"==a()){if(s++,!a())return}else if(a())return;r[i++]=t}}if(null!==o)for(a=i-o,i=7;0!=i&&0<a;)t=r[i],r[i--]=r[o+a-1],r[o+--a]=t;else if(8!=i)return;return r},Tg=function(e){var t,n;if("number"==typeof e){var r=[];for(t=0;4>t;t++)r.unshift(e%256),e=aF(e/256);return r.join(".")}if("object"==typeof e){r="",t=null;for(var i=1,o=null,s=0,a=0;8>a;a++)0!==e[a]?(s>i&&(t=o,i=s),o=null,s=0):(null===o&&(o=a),++s);for(s>i&&(t=o),i=t,t=0;8>t;t++)n&&0===e[t]||(n&&(n=!1),i===t?(r+=t?":":"::",n=!0):(r+=e[t].toString(16),7>t&&(r+=":")));return"["+r+"]"}return e},Ci={},ut=Bg({},Ci,{" ":1,'"':1,"<":1,">":1,"`":1}),vt=Bg({},ut,{"#":1,"?":1,"{":1,"}":1}),bm=Bg({},vt,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Qd=function(e,t){var n=uw(e,0);return 32<n&&127>n&&!ka(t,e)?e:encodeURIComponent(e)},Di={ftp:21,file:null,http:80,https:443,ws:80,wss:443},wb=function(e){return ka(Di,e.scheme)},cm=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},Ug=function(e,t){var n;return 2==e.length&&st.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},wt=function(e){var t;return 1<e.length&&Ug(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},xt=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&Ug(t[0],!0)||t.pop()},dm={},yt={},em={},zt={},At={},fm={},Bt={},Ct={},Ei={},Fi={},gm={},hm={},im={},jm={},Dt={},km={},Vg={},Yc={},Et={},ye={},vd={},Zc=function(e,t,n,r){var i=n||dm,o=0,s="",a=!1,c=!1,u=!1;for(n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(hF,"")),t=t.replace(iF,""),t=ge(t);o<=t.length;){var l=t[o];switch(i){case dm:if(!l||!st.test(l)){if(n)return"Invalid scheme";i=em;continue}s+=l.toLowerCase(),i=yt;break;case yt:if(l&&(bF.test(l)||"+"==l||"-"==l||"."==l))s+=l.toLowerCase();else{if(":"!=l){if(n)return"Invalid scheme";s="",i=em,o=0;continue}if(n&&(wb(e)!=ka(Di,s)||"file"==s&&(""!=e.username||""!=e.password||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=s,n)return void(wb(e)&&Di[e.scheme]==e.port&&(e.port=null));s="","file"==e.scheme?i=jm:wb(e)&&r&&r.scheme==e.scheme?i=zt:wb(e)?i=Ct:"/"==t[o+1]?(i=At,o++):(e.cannotBeABaseURL=!0,e.path.push(""),i=Et)}break;case em:if(!r||r.cannotBeABaseURL&&"#"!=l)return"Invalid scheme";if(r.cannotBeABaseURL&&"#"==l){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,i=vd;break}i="file"==r.scheme?jm:fm;continue;case zt:if("/"!=l||"/"!=t[o+1]){i=fm;continue}i=Ei,o++;break;case At:if("/"==l){i=Fi;break}i=Yc;continue;case fm:if(e.scheme=r.scheme,null==l)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==l||"\\"==l&&wb(e))i=Bt;else if("?"==l)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",i=ye;else{if("#"!=l){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),i=Yc;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",i=vd}break;case Bt:if(!wb(e)||"/"!=l&&"\\"!=l){if("/"!=l){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,i=Yc;continue}i=Fi}else i=Ei;break;case Ct:if(i=Ei,"/"!=l||"/"!=s.charAt(o+1))continue;o++;break;case Ei:if("/"!=l&&"\\"!=l){i=Fi;continue}break;case Fi:if("@"==l){for(a&&(s="%40"+s),a=!0,s=ge(s),l=0;l<s.length;l++){var A=s[l];":"!=A||u?(A=Qd(A,bm),u?e.password+=A:e.username+=A):u=!0}s=""}else if(null==l||"/"==l||"?"==l||"#"==l||"\\"==l&&wb(e)){if(a&&""==s)return"Invalid authority";o-=ge(s).length+1,s="",i=gm}else s+=l;break;case gm:case hm:if(n&&"file"==e.scheme){i=km;continue}if(":"!=l||c){if(null==l||"/"==l||"?"==l||"#"==l||"\\"==l&&wb(e)){if(wb(e)&&""==s)return"Invalid host";if(n&&""==s&&(""!=e.username||""!=e.password||null!==e.port))return;if(i=am(e,s))return i;if(s="",i=Vg,n)return;continue}"["==l?c=!0:"]"==l&&(c=!1),s+=l}else{if(""==s)return"Invalid host";if(i=am(e,s))return i;if(s="",i=im,n==hm)return}break;case im:if(!$l.test(l)){if(null==l||"/"==l||"?"==l||"#"==l||"\\"==l&&wb(e)||n){if(""!=s){if(65535<(i=parseInt(s,10)))return"Invalid port";e.port=wb(e)&&i===Di[e.scheme]?null:i,s=""}if(n)return;i=Vg;continue}return"Invalid port"}s+=l;break;case jm:if(e.scheme="file","/"==l||"\\"==l)i=Dt;else{if(!r||"file"!=r.scheme){i=Yc;continue}if(null==l)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==l)e.host=r.host,e.path=r.path.slice(),e.query="",i=ye;else{if("#"!=l){wt(t.slice(o).join(""))||(e.host=r.host,e.path=r.path.slice(),xt(e)),i=Yc;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",i=vd}}break;case Dt:if("/"==l||"\\"==l){i=km;break}r&&"file"==r.scheme&&!wt(t.slice(o).join(""))&&(Ug(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),i=Yc;continue;case km:if(null==l||"/"==l||"\\"==l||"?"==l||"#"==l){if(!n&&Ug(s))i=Yc;else{if(""==s){if(e.host="",n)return}else{if(i=am(e,s))return i;if("localhost"==e.host&&(e.host=""),n)return;s=""}i=Vg}continue}s+=l;break;case Vg:if(wb(e)){if(i=Yc,"/"!=l&&"\\"!=l)continue}else if(n||"?"!=l)if(n||"#"!=l){if(null!=l&&(i=Yc,"/"!=l))continue}else e.fragment="",i=vd;else e.query="",i=ye;break;case Yc:if(null==l||"/"==l||"\\"==l&&wb(e)||!n&&("?"==l||"#"==l)){if(".."===(A=(A=s).toLowerCase())||"%2e."===A||".%2e"===A||"%2e%2e"===A?(xt(e),"/"==l||"\\"==l&&wb(e)||e.path.push("")):"."===s||"%2e"===s.toLowerCase()?"/"==l||"\\"==l&&wb(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&Ug(s)&&(e.host&&(e.host=""),s=s.charAt(0)+":"),e.path.push(s)),s="","file"==e.scheme&&(null==l||"?"==l||"#"==l))for(;1<e.path.length&&""===e.path[0];)e.path.shift();"?"==l?(e.query="",i=ye):"#"==l&&(e.fragment="",i=vd)}else s+=Qd(l,vt);break;case Et:"?"==l?(e.query="",i=ye):"#"==l?(e.fragment="",i=vd):null!=l&&(e.path[0]+=Qd(l,Ci));break;case ye:n||"#"!=l?null!=l&&("'"==l&&wb(e)?e.query+="%27":e.query="#"==l?e.query+"%23":e.query+Qd(l,Ci)):(e.fragment="",i=vd);break;case vd:null!=l&&(e.fragment+=Qd(l,ut))}o++}},Rd=function(e){var t=Ac(this,Rd,"URL"),n=1<arguments.length?arguments[1]:void 0,r=String(e),i=$E(t,{type:"URL"});if(void 0!==n)if(n instanceof Rd)var o=db(n);else if(n=Zc(o={},String(n)))throw TypeError(n);if(n=Zc(i,r,null,o))throw TypeError(n);var s=i.searchParams=new ZE;(r=cc(s)).updateSearchParams(i.query),r.updateURL=function(){i.query=String(s)||null},wa||(t.href=Gi.call(t),t.origin=Ft.call(t),t.protocol=Gt.call(t),t.username=Ht.call(t),t.password=It.call(t),t.host=Jt.call(t),t.hostname=Kt.call(t),t.port=Lt.call(t),t.pathname=Mt.call(t),t.search=Nt.call(t),t.searchParams=Ot.call(t),t.hash=Pt.call(t))},lm=Rd.prototype,Gi=function(){var e=db(this),t=e.scheme,n=e.username,r=e.password,i=e.host,o=e.port,s=e.path,a=e.query,c=e.fragment,u=t+":";return null!==i?(u+="//",""==e.username&&""==e.password||(u+=n+(r?":"+r:"")+"@"),u+=Tg(i),null!==o&&(u+=":"+o)):"file"==t&&(u+="//"),u+=e.cannotBeABaseURL?s[0]:s.length?"/"+s.join("/"):"",null!==a&&(u+="?"+a),null!==c&&(u+="#"+c),u},Ft=function(){var e=db(this),t=e.scheme,n=e.port;if("blob"==t)try{return new Rd(t.path[0]).origin}catch(e){return"null"}return"file"!=t&&wb(e)?t+"://"+Tg(e.host)+(null!==n?":"+n:""):"null"},Gt=function(){return db(this).scheme+":"},Ht=function(){return db(this).username},It=function(){return db(this).password},Jt=function(){var e=db(this),t=e.host;return e=e.port,null===t?"":null===e?Tg(t):Tg(t)+":"+e},Kt=function(){var e=db(this).host;return null===e?"":Tg(e)},Lt=function(){var e=db(this).port;return null===e?"":String(e)},Mt=function(){var e=db(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},Nt=function(){var e=db(this).query;return e?"?"+e:""},Ot=function(){return db(this).searchParams},Pt=function(){var e=db(this).fragment;return e?"#"+e:""},tc=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(wa&&To(lm,{href:tc(Gi,(function(e){var t=db(this);if(e=Zc(t,String(e)))throw TypeError(e);cc(t.searchParams).updateSearchParams(t.query)})),origin:tc(Ft),protocol:tc(Gt,(function(e){var t=db(this);Zc(t,String(e)+":",dm)})),username:tc(Ht,(function(e){var t=db(this);if(e=ge(String(e)),!cm(t)){t.username="";for(var n=0;n<e.length;n++)t.username+=Qd(e[n],bm)}})),password:tc(It,(function(e){var t=db(this);if(e=ge(String(e)),!cm(t)){t.password="";for(var n=0;n<e.length;n++)t.password+=Qd(e[n],bm)}})),host:tc(Jt,(function(e){var t=db(this);t.cannotBeABaseURL||Zc(t,String(e),gm)})),hostname:tc(Kt,(function(e){var t=db(this);t.cannotBeABaseURL||Zc(t,String(e),hm)})),port:tc(Lt,(function(e){var t=db(this);cm(t)||(""==(e=String(e))?t.port=null:Zc(t,e,im))})),pathname:tc(Mt,(function(e){var t=db(this);t.cannotBeABaseURL||(t.path=[],Zc(t,e+"",Vg))})),search:tc(Nt,(function(e){var t=db(this);""==(e=String(e))?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Zc(t,e,ye)),cc(t.searchParams).updateSearchParams(t.query)})),searchParams:tc(Ot),hash:tc(Pt,(function(e){var t=db(this);""==(e=String(e))?t.fragment=null:("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Zc(t,e,vd))}))}),Za(lm,"toJSON",(function(){return Gi.call(this)}),{enumerable:!0}),Za(lm,"toString",(function(){return Gi.call(this)}),{enumerable:!0}),Sg){var Qt=Sg.createObjectURL,Rt=Sg.revokeObjectURL;Qt&&Za(Rd,"createObjectURL",(function(e){return Qt.apply(Sg,arguments)})),Rt&&Za(Rd,"revokeObjectURL",(function(e){return Rt.apply(Sg,arguments)}))}zc(Rd,"URL"),ea({global:!0,forced:!Wl,sham:!wa},{URL:Rd});var lF=new Blob(["var fakeIdToId = {};onmessage = function (event) {\tvar data = event.data,\t\tname = data.name,\t\tfakeId = data.fakeId,\t\ttime;\tif(data.hasOwnProperty('time')) {\t\ttime = data.time;\t}\tswitch (name) {\t\tcase 'setInterval':\t\t\tfakeIdToId[fakeId] = setInterval(function () {\t\t\t\tpostMessage({fakeId: fakeId});\t\t\t}, time);\t\t\tbreak;\t\tcase 'clearInterval':\t\t\tif (fakeIdToId.hasOwnProperty (fakeId)) {\t\t\t\tclearInterval(fakeIdToId[fakeId]);\t\t\t\tdelete fakeIdToId[fakeId];\t\t\t}\t\t\tbreak;\t}}"]),mF=window.URL.createObjectURL(lF),Ze={},dg=0,Aj=new Worker(mF);Aj.onmessage=function(e){if(e=e.data.fakeId,Ze.hasOwnProperty(e)){var t=Ze[e];e=t.callback,t=t.parameters,e.apply(window,t)}};var nF=function(e){function t(){return va(this,t),n.apply(this,arguments)}Ga(t,e);var n=Ha(t);return eb(t,[{key:"requestAsyncId",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;return Qv(e.flush.bind(e,this),n)}},{key:"recycleAsyncId",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if(null!==n&&this.delay===n&&!1===this.pending)return t;Ze.hasOwnProperty(t)&&(delete Ze[t],Aj.postMessage({name:"clearInterval",fakeId:t}))}}]),t}(gt),oF=new it(nF),pF=["group"],mm=G.inflate,St=G.deflate,Tt=function(e){function t(e,n,i,o){va(this,t);var s=r.call(this,o,"Session");return x(z(s),"lastNoticeTicket",""),x(z(s),"chatManager",void 0),x(z(s),"usedChannelIds",[]),x(z(s),"msgDedupLru",new Wc(void 0,{maxlen:200})),x(z(s),"startTime",Date.now()),x(z(s),"seq",P.fromNumber(1,!0)),x(z(s),"userJoinOptions",new et(!1)),x(z(s),"seqSentStatuses",[!1,!1]),x(z(s),"dialogueSequenceLru",new Wc(void 0,{maxlen:1e4})),x(z(s),"loggedOut",!1),x(z(s),"messageSentTimes",[]),x(z(s),"curLoginSockets",[void 0,void 0]),x(z(s),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),x(z(s),"lastLoginSockets",[new Te(1),new Te(1)]),x(z(s),"dialPendingMsgSubjectMap",new Map),x(z(s),"context",void 0),x(z(s),"connection",void 0),x(z(s),"instanceId",void 0),x(z(s),"lastPingTime",void 0),x(z(s),"chanelStringMessageReport",void 0),x(z(s),"chanelRawMessageReport",void 0),x(z(s),"p2pSMsgNoOfflineReport",void 0),x(z(s),"p2pRMsgNoOfflineReport",void 0),x(z(s),"registerSocketsFailureListener",(function(){s.connection.once("socketsFailure",(function(){s.log("socketsFailure, creating a new connection"),yd((function(){return s.connection.removeAllListeners(),s.connection=new ct(s.context,s.logger,!0),s.loginHandler(15e3,!0)})).pipe(Re((function(e){return e.pipe(Zd(ue.getParameter("RECONNECTING_AP_INTERVAL")))})),Kc(s.connection.apClient.apFinish$)).subscribe((function(){s.log("new connection connected")}))})),0===s.connection.listenerCount("tokenExpired")&&s.connection.on("tokenExpired",(function(){s.emit("tokenExpired")}))})),s.context=e,s.context.startTime=s.startTime,s.connection=n,s.instanceId=i,s.chatManager=new CE(o),s.lastPingTime=[0,0],s.setMaxListeners(512),s.log("The instanceId is %s",s.instanceId.toString()),s.chanelStringMessageReport=new zi(e,o,Ka.ChannelSMsg),s.chanelRawMessageReport=new zi(e,o,Ka.ChannelRMsg),s.p2pSMsgNoOfflineReport=new zi(e,o,Ka.P2pSMsgNoOfflineFlag),s.p2pRMsgNoOfflineReport=new zi(e,o,Ka.P2pRMsgNoOfflineFlag),s}Ga(t,e);var n,r=Ha(t);return eb(t,[{key:"loginHandler",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:12e3,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(this.loggedOut&&n)throw new da("Already logged out, request ignored");n&&this.registerSocketsFailureListener(),this.connection.initConnection();var r=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),i=Date.now();return r.forEach((function(t,r){var o=e.loginSocketSubs[r].login;void 0!==o&&o.unsubscribe(),e.loginSocketSubs[r].login=t.pipe(sa((function(t){var o;e.curLoginSockets[r]=t;var s=Date.now();bb("Link",{ackedServerIp:t.address,destServerIp:t.ip,ec:0,sc:0,elapse:Xa(e.startTime),lts:P.fromNumber(s),responseTime:s-i,sid:sb(e.instanceId),userId:e.context.uid},null!==(o=e.context.config.enableCloudProxy)&&void 0!==o&&o),e.emit("userJoined",t.env),n&&e.connection.apClient.apFinish$.next(void 0)}))).subscribe(e.lastLoginSockets[r])})),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Jb.apply(void 0,Z(r).concat([Db(this.connection,"connectionInitFailure").pipe(sa((function(e){if(Na(e)||Ab(e))throw e;throw new Ja("Login failure",{code:$r,originalError:e})})))])).pipe(hb(1),Lb(t),ab((function(t){return t instanceof Tb&&e.warn("Client login timeout"),t&&t.code===ti&&(e.connection.emit("tokenExpired"),e.connection.apClient.apFinish$.next(void 0)),e.clearSockets(0,n),ra(t)})),sa((function(){n||e.registerSocketsFailureListener()})),fh((function(){n||e.connection.apClient.apFinish$.next(void 0)})))}},{key:"logoutHandler",value:(n=ma(N.mark((function e(){var t,n,r,i=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),t=this.getLoginSockets(),n=t.map((function(e){return e.sendPacket("UserQuit",{}),i.connection.waitClosing(e)})),this.clearSockets(5e3),r=t.map((function(e){return e.env})),[0,1].filter((function(e){return!r.includes(e)})).forEach((function(e){i.connection.closeSocket(e,0)})),e.abrupt("return",Jb.apply(void 0,Z(n)).toPromise());case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"requestChannelJoin",value:function(){var e=ma(N.mark((function e(t){var n,r,i,o=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.getLoginSockets().length){e.next=2;break}throw new da("Client is not logged in. Cannot join the channel",Wr);case 2:return n=Db(this,"channelLeft").pipe(yb((function(e){return t===e})),hb(1)),r=this.incGetSeq(),(i=this.lastLoginSockets.map((function(e){return e.pipe(Kb((function(e,n){0!==n&&o.incSeqIfNeeded(e.env);var i=0===n?r:o.seq;return e.sendPacket("GroupEnter",{account:t,seq:i}),e.fromReceived("GroupReply").pipe(Ca((function(e){return i.eq(e.seq)})),sa((function(e){if(0!==(e=e.code))throw new Ja(["Channel join failure. The response code is %d",e],Sr)})))})),Kc(n),Se())}))).forEach((function(e,n){var r=function(){return o.loginSocketSubs[n].channels.delete(t)};o.loginSocketSubs[n].channels.set(t,e.subscribe({error:r,complete:r}))})),e.next=8,Jb.apply(void 0,Z(i)).pipe(hb(1),Lb(1e4),ab((function(e){return e instanceof Tb&&o.warn("Channel join timeout"),ra(e)}))).toPromise();case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(e){this.getLoginSockets().forEach((function(t){t.sendPacket("GroupLeave",{account:e})}))}},{key:"requestUpdateEdgeTicket",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new da("Client is not logged in. Cannot renew token",hs);var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserRenewTokenReq",{instance:n.instanceId,seq:i,account:n.context.uid,ticket:e})})),fb.apply(void 0,[t.genTimeoutError(Ml)].concat(Z(r.map((function(e){return e.fromReceived("UserRenewTokenResp").pipe(Ca((function(e){var t=e.code;return i.eq(e.seq)&&0===t})))})))))}},{key:"requestChannelMemberList",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in. Cannot get the channel members",JB);var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAllUsersList",{group:e,pageNumber:0,pageSize:200,seq:r})})),fb.apply(void 0,[t.genTimeoutError(Qr)].concat(Z(n.map((function(t){return t.fromReceived("GroupAllUsersResult").pipe(Ca((function(t){var n=t.seq;return t.group===e&&r.eq(n)})))})))))}},{key:"requestPeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserStatusList",{users:e,seq:r})})),fb.apply(void 0,[t.genTimeoutError(VB)].concat(Z(n.map((function(e){return e.fromReceived("UserStatusResult").pipe(Ca((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSetLocalUserAttributes",value:function(e,n){var r=this,i=this.getLoginSockets();if(0===i.length)throw new da("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t,i){void 0!==n&&i!==n||t.sendPacket("UserAttributeSet",{account:r.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=$a(e,2))[0],value:e[1]}})),seq:o})})),fb.apply(void 0,Z(i.map((function(e){return e.fromReceived("UserAttributeErr").pipe(Ca((function(e){return o.eq(e.seq)})),Ea((function(e){throw new Ja(["The user attributes set failure, code %d",e.code],oc)})))}))).concat([t.genTimeoutError(pc)],Z(i.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(Ca((function(e){return o.eq(e.seq)})))})))))}},{key:"requestSetChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new da("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeSet",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=$a(e,2))[0],value:e[1]}})),seq:o})})),fb.apply(void 0,Z(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(Ca((function(e){return o.eq(e.seq)})),Ea((function(e){throw new Ja(["The group attributes set failure, code %d",e.code],oc)})))}))).concat([t.genTimeoutError(pc)],Z(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(Ca((function(e){return o.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new da("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeMod",{account:n.context.uid,attributeInfos:Object.entries(e).map((function(e){return{key:(e=$a(e,2))[0],value:e[1]}})),seq:i})})),fb.apply(void 0,Z(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(Ca((function(e){return i.eq(e.seq)})),Ea((function(e){throw new Ja(["The user attributes add or update failure, code %d",e.code],oc)})))}))).concat([t.genTimeoutError(pc)],Z(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(Ca((function(e){return i.eq(e.seq)})))})))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new da("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeMod",{broadcast:r,group:e,attributeInfos:Object.entries(n).map((function(e){return{key:(e=$a(e,2))[0],value:e[1]}})),seq:o})})),fb.apply(void 0,Z(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(Ca((function(e){return o.eq(e.seq)})),Ea((function(e){throw new Ja(["The group attributes add or update failure, code %d",e.code],oc)})))}))).concat([t.genTimeoutError(pc)],Z(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(Ca((function(e){return o.eq(e.seq)})))})))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(e){var n=this,r=this.getLoginSockets();if(0===r.length)throw new da("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeDel",{account:n.context.uid,attributes:e,seq:i})})),fb.apply(void 0,Z(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(Ca((function(e){return i.eq(e.seq)})),Ea((function(e){throw new Ja(["The user attributes delete failure, code %d",e.code],oc)})))}))).concat([t.genTimeoutError(pc)],Z(r.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(Ca((function(e){return i.eq(e.seq)})))})))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(e,n,r){var i=this.getLoginSockets();if(0===i.length)throw new da("Client is not logged in");var o=this.incGetSeq();return i.forEach((function(t){t.sendPacket("GroupAttributeDel",{group:e,broadcast:r,attributes:n,seq:o})})),fb.apply(void 0,Z(i.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(Ca((function(e){return o.eq(e.seq)})),Ea((function(e){throw new Ja(["The channel attributes delete failure, code %d",e.code],oc)})))}))).concat([t.genTimeoutError(pc)],Z(i.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(Ca((function(e){return o.eq(e.seq)})))})))))}},{key:"requestClearLocalUserAttributes",value:function(){var e=this,n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeSet",{account:e.context.uid,seq:r,attributeInfos:[]})})),fb.apply(void 0,Z(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(Ca((function(e){return r.eq(e.seq)})),Ea((function(e){throw new Ja(["The user attributes clear failure, code %d",e.code],oc)})))}))).concat([t.genTimeoutError(pc)],Z(n.map((function(e){return e.fromReceived("UserAttributeRsp").pipe(Ca((function(e){return r.eq(e.seq)})))})))))}},{key:"requestClearChannelAttributes",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new da("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeSet",{group:e,seq:i,attributeInfos:[],broadcast:n})})),fb.apply(void 0,Z(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(Ca((function(e){return i.eq(e.seq)})),Ea((function(e){throw new Ja(["The channel attributes clear failure, code %d",e.code],oc)})))}))).concat([t.genTimeoutError(pc)],Z(r.map((function(e){return e.fromReceived("GroupAttributeRsp").pipe(Ca((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new da("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("UserAttributeGet",{account:e,seq:i,attributes:n})})),fb.apply(void 0,[t.genTimeoutError(pc)].concat(Z(r.map((function(e){return e.fromReceived("UserAttributeErr").pipe(Ca((function(e){return i.eq(e.seq)})),Ea((function(e){if(10008===(e=e.code))throw new Ja("The user requested is not online",Mr);throw new ve(["User attribute operation unknown error code: %d",e],oc)})))}))),Z(r.map((function(e){return e.fromReceived("UserAttributeRet").pipe(Ca((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesByKeys",value:function(e,n){var r=this.getLoginSockets();if(0===r.length)throw new da("Client is not logged in");var i=this.incGetSeq();return r.forEach((function(t){t.sendPacket("GroupAttributeGet",{group:e,seq:i,attributes:n})})),fb.apply(void 0,[t.genTimeoutError(pc)].concat(Z(r.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(Ca((function(e){return i.eq(e.seq)})),Ea((function(e){throw new Ja(["The channel attributes get failure, code %d",e.code],oc)})))}))),Z(r.map((function(e){return e.fromReceived("GroupAttributeRet").pipe(Ca((function(e){return i.eq(e.seq)})))})))))}},{key:"requestGetUserAttributeKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("UserAttributeKeysGet",{account:e,seq:r})})),fb.apply(void 0,[t.genTimeoutError(pc)].concat(Z(n.map((function(e){return e.fromReceived("UserAttributeErr").pipe(Ca((function(e){return r.eq(e.seq)})),Ea((function(e){if(10008===(e=e.code))throw new Ja("The user requested is not online",Mr);throw new ve(["User attribute operation unknown error code: %d",e],oc)})))}))),Z(n.map((function(e){return e.fromReceived("UserAttributeKeysRet").pipe(Ca((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelAttributesKeys",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupAttributeKeysGet",{group:e,seq:r})})),fb.apply(void 0,[t.genTimeoutError(pc)].concat(Z(n.map((function(e){return e.fromReceived("GroupAttributeErr").pipe(Ca((function(e){return r.eq(e.seq)})),Ea((function(e){throw new ve(["Channel attribute operation unknown error code: %d",e.code],oc)})))}))),Z(n.map((function(e){return e.fromReceived("GroupAttributeKeysRet").pipe(Ca((function(e){return r.eq(e.seq)})))})))))}},{key:"requestGetChannelMemberCount",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("GroupStatusList",{groups:e,seq:r})})),fb.apply(void 0,[t.genTimeoutError(Qr)].concat(Z(n.map((function(e){return e.fromReceived("GroupStatusResult").pipe(Ca((function(e){return r.eq(e.seq)})))})))))}},{key:"requestSubscribePeersOnlineStatus",value:function(e){var n=this.getLoginSockets();if(0===n.length)throw new da("Client is not logged in");var r=this.incGetSeq();return n.forEach((function(t){t.sendPacket("SubscribeUserStatus",{seq:r,users:e})})),fb.apply(void 0,[t.genTimeoutError($B)].concat(Z(n.map((function(e){return e.fromReceived("SubscribeResponse").pipe(Ca((function(e){return r.eq(e.seq)})))})))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(e){var t=this.getLoginSockets();if(0===t.length)throw new da("Client is not logged in");var n=this.incGetSeq();t.forEach((function(t){t.sendPacket("UnsubscribeUserStatus",{seq:n,users:e})}))}},{key:"sendInvitationMessage",value:function(){var e=ma(N.mark((function e(t){var n,r,i,o,s,a,c,u,l,A,h,d,p=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.peerId,r=t.callId,i=t.extra,o=t.isAcceptAck,s=t.channelId,a=t.type,c={callId:r},void 0===o){e.next=6;break}if("CallAccept"===a){e.next=5;break}throw Error("invalid invitation type");case 5:c.type=o?"ack":"request";case 6:return c.channel=s,("CallInvite"===a||"CallCancel"===a||"CallReject"===a||"CallAccept"===a&&!1===o)&&void 0!==i&&(c.extra=i),u=nh(),this.log("The sent invitation body is %o",c),l=function(e){return{MiscMap:{},sequence:P.fromNumber(1),dialogue:u,instance:p.instanceId,dst:n,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:e,MessageType:a}).toLong(),payload:(new TextEncoder).encode(JSON.stringify(c)),src:p.context.uid}},e.next=14,Jc(this.sendMessageToRetry(l,!0)).pipe(Lb(1e4),ab((function(e){return e instanceof Tb&&p.warn("Send invitation timeout"),ra(e)}))).toPromise();case 14:return A=e.sent,h=A.code,d=A.retryTimes,e.abrupt("return",{hasPeerReceived:0===h,hasReSent:0!==d});case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var e=ma(N.mark((function e(t,n,r,i,o){var s,a,c,u,l,A,h,d,p,f,g,m=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=Date.now(),a=i?Ka.P2pRMsgNoOfflineFlag:Ka.ChannelRMsg,Ta(r)&&t instanceof Uint8Array&&"string"==typeof n){e.next=4;break}throw new ca("The send message arguments are not valid",i?fs:qi);case 4:if(!(32768<t.byteLength+new Blob([n]).size)){e.next=8;break}throw this.emit("messageCount",{messageCategory:a,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:a,type:"common",key:"invalidmessagecount"}),new ic("The message size is over the 32KB limit",i?bg:Il);case 8:return c=!ue.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=t.byteLength,u=this.chatManager.getChatInfo(r),l=u.dialogue,A=u.sequence,h=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(h,"-").concat(l,"#").concat(A,'"'),c?" compressed":"",i?"peer":"channel",La(r)),d=function(e){return{MiscMap:{description:(new TextEncoder).encode(n)},sequence:A,dialogue:l,instance:h,dst:r,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:e,CompressionMethod:c?"Zlib":"Uncompressed",MessageType:i?"PeerRawMessage":"ChannelRawMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:c?St(t):t,src:m.context.uid}},e.next=15,Jc(this.sendMessageToRetry(d,!0)).pipe(Lb(void 0===o?1e4:o),ab((function(e){return e instanceof Tb&&m.warn("Send message timeout"),ra(e)}))).toPromise();case 15:return p=e.sent,f=p.code,g=0===f,this.emit("messageCount",{messageCategory:a,type:"common",key:"sentcount"}),g&&(this.emit("messageCount",{messageCategory:a,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:a,type:i?"peer":"recipient",delay:Xa(s).toNumber()})),e.abrupt("return",{hasPeerReceived:g});case 21:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var e=ma(N.mark((function e(t,n,r,i){var o,s,a,c,u,l,A,h,d,p,f,g,m=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=Date.now(),s=r?Ka.P2pSMsgNoOfflineFlag:Ka.ChannelSMsg,Ta(n)){e.next=4;break}throw new ca("The send message arguments are not valid",r?fs:qi);case 4:if(!(32768<new Blob([t]).size)){e.next=8;break}throw this.emit("messageCount",{messageCategory:s,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:s,type:"common",key:"invalidmessagecount"}),new ic("The message size is over the 32KB limit",r?bg:Il);case 8:return a=!ue.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([t]).size,c=this.chatManager.getChatInfo(n),u=c.dialogue,l=c.sequence,A=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(A,"-").concat(u,"#").concat(l,'"'),a?" compressed":"",r?"peer":"channel",La(n)),h=(new TextEncoder).encode(t),d=function(e){return{MiscMap:{},sequence:l,dialogue:u,instance:A,dst:n,ms:P.fromNumber(Date.now(),!0),options:new Ef({IterationNumber:e,CompressionMethod:a?"Zlib":"Uncompressed",MessageType:r?"PeerTextMessage":"ChannelTextMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:a?St(h):h,src:m.context.uid}},e.next=16,Jc(this.sendMessageToRetry(d,!0)).pipe(Lb(void 0===i?1e4:i),ab((function(e){return e instanceof Tb&&(m.emit("messageCount",{messageCategory:s,type:"common",key:"sentcount"}),m.emit("messageCount",{messageCategory:s,type:"common",key:"timeoutcount"}),m.warn("Send message timeout")),ra(e)}))).toPromise();case 16:return p=e.sent,f=p.code,g=0===f,this.emit("messageCount",{messageCategory:s,type:"common",key:"sentcount"}),g&&(this.emit("messageCount",{messageCategory:s,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:s,type:r?"peer":"recipient",delay:Xa(o).toNumber()})),e.abrupt("return",{hasPeerReceived:g});case 22:case"end":return e.stop()}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(e,t){Object.entries(this.loginSocketSubs[e]).forEach((function(e){var n=(e=$a(e,2))[1];"channels"===e[0]&&t||(Array.isArray(n)||n instanceof Map?n.forEach((function(e){return e.unsubscribe()})):n&&n.unsubscribe())})),this.loginSocketSubs[e]={channels:t?this.loginSocketSubs[e].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var e=ma(N.mark((function e(t,n){var r,i,o,s,a,c,u,l,A,h=this,d=arguments;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<d.length&&void 0!==d[2]?d[2]:0,this.log("Attempt to send the message ".concat(n?" with retrying, %o":"without retrying"),{retryTimes:r}),0!==(i=this.getLoginSockets()).length){e.next=5;break}throw Error("no logged-in sockets");case 5:return o=t(r),i.forEach((function(e){e.sendPacket("Message",o)})),s=o.dialogue,a=o.sequence,c=o.instance,u=i.map((function(e){return e.fromReceived("Ack").pipe(yb((function(e){return s.eq(e.dialogue)&&a.eq(e.sequence)&&c.eq(e.instance)})))})),e.prev=9,e.next=12,Jb.apply(void 0,Z(u)).pipe(Lb(6e3),ab((function(e){return Ab(e)&&h.warn("Message send timeout, retry times %d",r),ra(e)})),hb(1)).toPromise();case 12:return l=e.sent,A=l.code,this.log("The message has been acked, %o",{code:A}),e.abrupt("return",{code:A,retryTimes:r});case 18:if(e.prev=18,e.t0=e.catch(9),!(e.t0 instanceof Tb&&n)){e.next=22;break}return e.abrupt("return",this.sendMessageToRetry(t,!1,r+1));case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[9,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var e=this;this.lastLoginSockets.map((function(t){return t.pipe(Kb((function(t){return dd(0,2500,Ce()?void 0:oF).pipe(sa((function(){e.sendPing(t)})))})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAlive;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAlive=t.subscribe({error:function(){}})}))}},{key:"initKeepAliveReconnector",value:function(){var e=this;this.lastLoginSockets.map((function(e){return e.pipe(Kb((function(e){var t,n=!1,r=e.userJoin$.pipe(sa((function(){n=!0}))),i=e.input$.pipe(sa((function(e){"Ping"!==yj[e.uri].slice(0,-3)&&(n=!1)})));return Jb(dd(6e3,1e4).pipe(yv(e.receivedPacket),sa((function(r){r=$a(r,2),r=$a(r[1],2)[1],t!==r||n||e.forceReconnect(),t=r}))),r,i)})))})).forEach((function(t,n){var r=e.loginSocketSubs[n].keepAliveReconnector;void 0!==r&&r.unsubscribe(),e.loginSocketSubs[n].keepAliveReconnector=t.subscribe({error:function(){}})}))}},{key:"initLoginReceiver",value:function(){var e=this;fb.apply(void 0,Z(this.lastLoginSockets.map((function(t){return t.pipe(Kb((function(t){return t.fromReceived("UserTicketNearlyExpire").pipe(sv(5e3),sa(e.onUserTicketNearlyExpire(t)))})))})))).subscribe();var t=Db(this,"messageCount"),n=t.pipe(yb((function(e){return e.messageCategory===Ka.ChannelSMsg})));n.subscribe((function(t){return e.updateMessageCount(t)})),n.pipe(dh(6e3)).subscribe((function(t){t.length&&e.chanelStringMessageReport.report()})),Jb(ob(void 0),n).pipe(Kb((function(){return Qe(36e5)}))).subscribe((function(){e.chanelStringMessageReport.report()})),(n=t.pipe(yb((function(e){return e.messageCategory===Ka.ChannelRMsg})))).subscribe((function(t){return e.updateMessageCount(t)})),n.pipe(dh(6e3)).subscribe((function(t){t.length&&e.chanelRawMessageReport.report()})),Jb(ob(void 0),n).pipe(Kb((function(){return Qe(36e5)}))).subscribe((function(){e.chanelRawMessageReport.report()})),(n=t.pipe(yb((function(e){return e.messageCategory===Ka.P2pSMsgNoOfflineFlag})))).subscribe((function(t){return e.updateMessageCount(t)})),n.pipe(dh(6e3)).subscribe((function(t){t.length&&e.p2pSMsgNoOfflineReport.report()})),Jb(ob(void 0),n).pipe(Kb((function(){return Qe(36e5)}))).subscribe((function(){e.p2pSMsgNoOfflineReport.report()})),(t=t.pipe(yb((function(e){return e.messageCategory===Ka.P2pRMsgNoOfflineFlag})))).subscribe((function(t){return e.updateMessageCount(t)})),t.pipe(dh(6e3)).subscribe((function(t){t.length&&e.p2pRMsgNoOfflineReport.report()})),Jb(ob(void 0),t).pipe(Kb((function(){return Qe(36e5)}))).subscribe((function(){e.p2pSMsgNoOfflineReport.report()})),this.lastLoginSockets.map((function(t){return t.pipe(Kb((function(t){return Jb(Db(t,"reconnect").pipe(sa(e.onSocketReconnect(t))),t.fromReceived("Message").pipe(sa(e.onMessage(t))),t.fromReceived("GroupEnterNotice").pipe(sa(e.onGroupEnterNotice())),t.fromReceived("GroupLeaveNotice").pipe(sa(e.onGroupLeaveNotice())),t.fromReceived("GroupCountNotice").pipe(sa(e.onGroupCountNotice())),t.fromReceived("GroupAttributeAlt").pipe(sa(e.onGroupAttributeAlt())),t.fromReceived("UserJoinNotice").pipe(sa(e.onUserNotice(ta.PeerOnlineState.ONLINE))),t.fromReceived("UserQuitNotice").pipe(sa(e.onUserNotice(ta.PeerOnlineState.OFFLINE))),t.fromReceived("UserWaitNotice").pipe(sa(e.onUserNotice(ta.PeerOnlineState.UNREACHABLE))),t.fromReceived("Pong").pipe(sa(e.onPong())),t.fromReceived("UserDrop").pipe(sa(e.onUserDrop(t))),t.fromReceived("GroupDrop").pipe(sa(e.onGroupDrop()))).pipe(Uf(void 0))})))})).forEach((function(t,n){e.loginSocketSubs[n].receivers.push(t.subscribe({error:function(){}}))}))}},{key:"requestSocketLogin",value:function(e,t,n){var r=this;return nn(yd((function(){r.userJoinOptions=new et(t),e.sendPacket("UserJoin",{account:r.context.uid,instance:r.instanceId,opt:r.userJoinOptions.toLong(),seq:n,ticket:e.ticket})})),e.fromReceived("UserResp").pipe(Ca((function(e){return n.eq(e.seq)})),sa((function(t){if(0!==(t=t.code))throw r.clearSockets(),r.logError("Connected to gateway success but the Rtm server rejected login"),new Ja(["Login failure. The response code from the RTM service is %d",t],Pg);e.attemptsSinceLastError=0,e.loggedIn=!0,r.log("ENV_%d logged in",e.env)})),Uf(e),Lb(6e3))).pipe(yb((function(e){return void 0!==e})),ab((function(n){return n instanceof Tb&&r.warn("Login response timeout, rejoin: %s",t),r.clearSockets(),n.name="loginRespTimeout",r.emit("banEdgeIP",e.ip),ra(n)})))}},{key:"getSocketLoginObservables",value:function(e,t){var n=this;return e.map((function(e){return e.pipe(Kb((function(e,r){return n.incSeqIfNeeded(e.env),n.requestSocketLogin(e,0!==r,0===r?t:n.seq)})),Se())}))}},{key:"incSeqIfNeeded",value:function(e){if(![0,1].includes(e))throw new mb({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[e]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[e]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var e=this.curLoginSockets,t=-1,n=null==e?0:e.length,r=0,i=[];++t<n;){var o=e[t];o&&(i[r++]=o)}return i}},{key:"emitMessage",value:function(e,n){var r,i=e.options,o=e.payload,s=e.src,a=e.dst,c=e.instance,u=e.dialogue,l=e.sequence,A=e.ms,h=e.MiscMap;this.dialogueSequenceLru.set(u.toString(),l),c="".concat(c,"-").concat(u,"#").concat(l),this.msgDedupLru.has(c)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",n,c):(this.msgDedupLru.set(c,void 0),i=new Ef(i),this.lastLoginSockets.forEach((r=ma(N.mark((function n(r){var i;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.pipe(hb(1)).toPromise();case 2:i=n.sent,t.sendMessageAck(e,i);case 4:case"end":return n.stop()}}),n)}))),function(e){return r.apply(this,arguments)})),n=i.isZlibCompressed(),i.isInvitation()?(a=cg(n?mm(ao(o,Uint8Array.of(0,0,0,0))):o),a=JSON.parse(a),this.log("The received invitation body is %o",a),this.emit("invitationMessage",{body:a,type:i.getInvitationType(),peerId:s,serverReceivedTs:A.toNumber()})):i.isTextMessage()?(h=i.isPeerTextMessage(),o=cg(n?mm(ao(o,Uint8Array.of(0,0,0,0))):o),this.info("Received a %s %s text message from %s to %s, %s",n?" compressed":"",h?"peer":"channel",La(s),La(a),c),h?(s={text:o,peerId:s,properties:{serverReceivedTs:A.toNumber()}},this.emit("peerTextMessage",s),this.emit("messageCount",{messageCategory:Ka.P2pSMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelTextMessage",{channelId:a,memberId:s,text:o,properties:{serverReceivedTs:A.toNumber()}}),this.emit("messageCount",{messageCategory:Ka.ChannelSMsg,type:"common",key:"receivedcount"}))):i.isRawMessage()&&(i=i.isRawPeerMessage(),h=void 0===(h=h.description)?"":cg(h),o=n?mm(o):o,this.info("Received a %s %s raw message from %s to %s, %s",n?" compressed":"",i?"peer":"channel",La(s),La(a),c),i?(s={desc:h,raw:o,peerId:s,properties:{serverReceivedTs:A.toNumber()}},this.emit("peerRawMessage",s),this.emit("messageCount",{messageCategory:Ka.P2pRMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelRawMessage",{desc:h,raw:o,channelId:a,memberId:s,properties:{serverReceivedTs:A.toNumber()}}),this.emit("messageCount",{messageCategory:Ka.ChannelRMsg,type:"common",key:"receivedcount"}))))}},{key:"onSocketReconnect",value:function(e){var t=this;return function(){var n=[0,1].filter((function(t){return t!==e.env}))[0];(n=t.connection.curOpenSockets[n])&&!n.loggedIn&&t.emit("connectionLost")}}},{key:"onUserTicketNearlyExpire",value:function(e){var t=this;return function(n){(n=n.ticket)!==t.lastNoticeTicket&&n===e.ticket?(t.lastNoticeTicket=n,t.emit("tokenPrivilegeWillExpire")):t.requestUpdateEdgeTicket(e.ticket).toPromise()}}},{key:"onGroupDrop",value:function(){var e=this;return function(t){var n,r=t.account;bb("ChnLeave",{cname:r,lts:P.fromNumber(Date.now()),elapse:Xa(e.startTime),errCode:RB,sid:sb(e.instanceId),userId:e.context.uid},null!==(n=e.context.config.enableCloudProxy)&&void 0!==n&&n),[0,1].forEach((function(t){return e.loginSocketSubs[t].channels.delete(r)})),e.logError("the user is kicked out of the current channel")}}},{key:"onUserDrop",value:function(e){var t=this;return function(n){var r;n=n.code,bb("KickedOff",{code:0,elapse:Xa(t.startTime),linkId:parseInt(e.name.split("-")[1],10),lts:P.fromNumber(Date.now()),server:e.address,serverCode:n,sid:sb(t.instanceId),userId:t.context.uid},null!==(r=t.context.config.enableCloudProxy)&&void 0!==r&&r),10006===n||10001===n?t.warn("Login too often and kicked off, reconnect and login"):10009===n?(t.warn("The instance ID conflicts, reconnecting"),t.instanceId=nh(),t.context.sid=sb(t.instanceId),t.emit("instanceChanged",t.instanceId)):[2,11,14,15,16].includes(n)&&(t.emit("userDrop",n),t.clearSockets())}}},{key:"clearSockets",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];[0,1].forEach((function(r){e.cleanLoginSubs(r,n),e.connection.closeSocket(r,t)}))}},{key:"onMessage",value:function(e){var t=this;return function(n){var r=n.dialogue,i=n.instance,o=n.sequence,s=n.options;if(n.src===t.context.uid)t.log("The message is from the local account, ignored");else{var a=r.toString(),c=t.dialPendingMsgSubjectMap.get(a);if(r="".concat(i,"-").concat(r,"#").concat(o),c)c.next(n),t.log("Env_%d: The dialogue has pending messages, next: %s",e.env,r);else{var u=t.dialogueSequenceLru.get(a);if(c=!u&&o.eq(1),i=void 0!==u&&o.sub(u).eq(1),c||i)t.emitMessage(n,e.env);else{if(u){if(o.lte(u))return;t.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",e.env,r)}else t.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",e.env,r);o=new rb,t.dialPendingMsgSubjectMap.set(a,o);var l=o.pipe(Au(zl),gh((function(e,t){return[].concat(Z(e),[t])}),[]),Ea((function(e){return Z(e).sort((function(e,t){return e=e.sequence,t=t.sequence,e.eq(t)?0:e.gt(t)?1:-1}))})),wn(1));s=!(s=new Ef(s)).isFromCache()&&!s.isBufferedMessage(),l.pipe(Kc(dd(s?750:1500)),Ca((function(e){if(2>e.length)return!1;for(var t=void 0===u?P.fromNumber(1,!0):u.add(1),n=0;n<e.length;t=t.add(1),n++)if(!e[n].sequence.eq(t))return!1;return!0})),fh((function(){t.dialPendingMsgSubjectMap.delete(a)}))).subscribe((function(n){n.forEach((function(n){t.emitMessage(n,e.env),t.log("Env_%d: The message queue has fully ordered, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence))}))}),(function(n){n instanceof eh&&l.pipe(hb(1)).subscribe((function(n){return n.forEach((function(n){t.log("Env_%d: The message pending queue expired, emitting: %s",e.env,"".concat(n.instance,"-").concat(n.dialogue,"#").concat(n.sequence)),t.emitMessage(n,e.env)}))}))})),o.next(n)}}}}}},{key:"onPong",value:function(){var e=this;return function(){document.hidden&&e.getLoginSockets().forEach((function(t){e.sendPing(t)}))}}},{key:"onGroupEnterNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberJoined",size:t.size})}}},{key:"onGroupLeaveNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,memberId:t.user,type:"MemberLeft",size:t.size})}}},{key:"onGroupCountNotice",value:function(){var e=this;return function(t){e.emit("memberNotice",{channelId:t.group,seq:t.seq,instance:t.instance,type:"MemberCountUpdated",size:t.size})}}},{key:"onGroupAttributeAlt",value:function(){var e=this;return function(t){var n=t.group;t=Ki(t,pF),e.emit("channelAttributesUpdated",Wa({channelId:n},t))}}},{key:"onUserNotice",value:function(e){var t=this;return function(n){t.emit("peerOnlineStatusChanged",{peerId:n.user,instance:n.instance,seq:n.seq,state:e})}}},{key:"sendPing",value:function(e){2500>=Date.now()-this.lastPingTime[e.env]||(this.incSeqIfNeeded(e.env),e.sendPacket("Ping",{ms:P.fromNumber(Date.now(),!0),seq:this.seq}),this.lastPingTime[e.env]=Date.now())}},{key:"updateMessageCount",value:function(e){var t,n=(t={},x(t,Ka.ChannelRMsg,this.chanelRawMessageReport),x(t,Ka.ChannelSMsg,this.chanelStringMessageReport),x(t,Ka.P2pRMsgNoOfflineFlag,this.p2pRMsgNoOfflineReport),x(t,Ka.P2pSMsgNoOfflineFlag,this.p2pSMsgNoOfflineReport),x(t,3,void 0),x(t,4,void 0),x(t,7,void 0),x(t,8,void 0),x(t,9,void 0),x(t,10,void 0),t)[e.messageCategory];"common"===e.type?null==n||n.updateCommonCount(e.key):"peer"===e.type?null==n||n.updatePeerAckCount(e.delay):null==n||n.updateNorecipientackCount(e.delay)}}],[{key:"sendMessageAck",value:function(e,t){var n=new Ef(e.options);(n.isInvitation()||n.isPeerMessage())&&t.sendPacket("Ack",{code:0,dialogue:e.dialogue,instance:e.instance,sequence:e.sequence})}}]),t}(sc());x(Tt,"genTimeoutError",(function(e,t){return ob(void 0).pipe(Zd(void 0===t?1e4:t),Ea((function(){throw new Ub(["Request timed out after %ds",(void 0===t?1e4:t)/1e3],e)})))}));var Ut,nm,om=0,pm=0;Ng.v1=function(e,t,n){n=t&&n||0;var r=t||[],i=(e=e||{}).node||Ut,o=void 0!==e.clockseq?e.clockseq:nm;if(null==i||null==o){var s=Kr();null==i&&(i=Ut=[1|s[0],s[1],s[2],s[3],s[4],s[5]]),null==o&&(o=nm=16383&(s[6]<<8|s[7]))}s=void 0!==e.msecs?e.msecs:(new Date).getTime();var a=void 0!==e.nsecs?e.nsecs:pm+1,c=s-om+(a-pm)/1e4;if(0>c&&void 0===e.clockseq&&(o=o+1&16383),(0>c||s>om)&&void 0===e.nsecs&&(a=0),1e4<=a)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(om=s,pm=a,nm=o,e=(1e4*(268435455&(s+=122192928e5))+a)%4294967296,r[n++]=e>>>24&255,r[n++]=e>>>16&255,r[n++]=e>>>8&255,r[n++]=255&e,e=s/4294967296*1e4&268435455,r[n++]=e>>>8&255,r[n++]=255&e,r[n++]=e>>>24&15|16,r[n++]=e>>>16&255,r[n++]=o>>>8|128,r[n++]=255&o,o=0;6>o;++o)r[n+o]=i[o];return t||Lr(r)},Ng.v4=Ng;var qm=yi(),Sd,Hf=ta.LocalInvitationFailureReason,Sa=ta.LocalInvitationState,qF=(Sd=function(e){function t(e,r,i){va(this,t);var o=n.call(this,i,"RtmLocalInvitation",!0);return x(z(o),"state",Sa.IDLE),x(z(o),"localInvitationEnd$",fb(Db(z(o),"LocalInvitationAccepted"),Db(z(o),"LocalInvitationRefused"),Db(z(o),"LocalInvitationFailure"),Db(z(o),"LocalInvitationCanceled")).pipe(hb(1))),x(z(o),"callId",Ng.v4()),x(z(o),"_content",""),x(z(o),"_channelId",""),x(z(o),"_response",""),x(z(o),"calleeId",void 0),x(z(o),"logger",void 0),x(z(o),"getSession",void 0),o.calleeId=e,o.getSession=r,o.logger=i,o}Ga(t,e);var n=Ha(t);return eb(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){this.state!==Sa.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=e)}},{key:"content",get:function(){return this._content},set:function(e){this.log("set content for %s",this.callId),this._content=e}},{key:"response",get:function(){return this._response},set:function(e){throw new ca('Cannot set the "response" of the LocalInvitation instance.',Xc)}},{key:"send",value:function(){var e,t=this;if(this.state===Sa.SENT_TO_REMOTE||this.state===Sa.RECEIVED_BY_REMOTE)throw new da("The local invitation send failure. The call invitation has already been sent.",NB);if(this.isLocalInvitationEnd())throw new da("The local invitation send failure. The call invitation has ended.",ri);if(0<this._channelId.length&&!Ta(this._channelId))throw new ca("Illegal invitation channel ID",Xc);if(!Ta(this.calleeId))throw new ca("Illegal invitation callee user ID",Xc);if(8192<rh(this._content))throw new ca('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this.state=Sa.SENT_TO_REMOTE,yd(ma(N.mark((function n(){var r,i,o;return N.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.getSession().sendInvitationMessage({peerId:t.calleeId,callId:t.callId,extra:t._content,type:"CallInvite",channelId:t._channelId});case 2:if(r=n.sent,i=r.hasPeerReceived,o=r.hasReSent,!t.isLocalInvitationEnd()){n.next=7;break}throw new Ub("send invitation timeout");case 7:if(t.log("The local invitation has sent to the callee"),i||o){n.next=11;break}throw e=new qm({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(i){n.next=14;break}throw e=new qm({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return n.stop()}}),n)})))).pipe(Re((function(e){return e.pipe(sa((function(e){if(!(e instanceof qm))throw e})),Zd(2e3))})),Lb(3e4),ab((function(e){return Ab(e)&&t.warn("local invitation ack timed out"),ra(e)})),Kc(this.localInvitationEnd$)).subscribe({next:function(){t.state===Sa.RECEIVED_BY_REMOTE?t.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):t.state!==Sa.SENT_TO_REMOTE?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(t.info("The peer received the local invitation %s.",t.callId),t.state=Sa.RECEIVED_BY_REMOTE,t.emit("LocalInvitationReceivedByPeer"),t.localInvitationEnd$.pipe(Lb(6e4),ab((function(e){return Ab(e)&&t.warn("local invitation expired"),ra(e)}))).subscribe({error:function(){t.state=Sa.FAILURE,t.emit("LocalInvitationFailure",Hf.INVITATION_EXPIRE)}}))},error:function(n){t.isLocalInvitationEnd()?t.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(t.state=Sa.FAILURE,Ab(n)&&e?"PEER_NOT_ONLINE"===e.code?t.emit("LocalInvitationFailure",Hf.PEER_OFFLINE):"RESENT_AND_OFFLINE"===e.code&&t.emit("LocalInvitationFailure",Hf.PEER_NO_RESPONSE):Ab(n)?t.emit("LocalInvitationFailure",Hf.PEER_NO_RESPONSE):"RtmInvalidStatusError"===n.name?t.emit("LocalInvitationFailure",Hf.NOT_LOGGEDIN):t.emit("LocalInvitationFailure",Hf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new da("The local invitation cancel failure",ri);if(this.state===Sa.IDLE)throw new da("The local invitation has not been sent",MB);if(8192<rh(this._content))throw new ca('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Sa.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(e){if(this.isLocalInvitationEnd()&&this.state!==Sa.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Sa.IDLE)throw new da("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Sa.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Sa.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Sa.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Sa.ACCEPTED_BY_REMOTE,this._response=e,this.emit("LocalInvitationAccepted",e))}}},{key:"onRefuseReceived",value:function(e){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Sa.IDLE)throw new da("the local have not sent the invitation, how can remote refuse it?");this.state===Sa.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Sa.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=e,this.state=Sa.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",e)}}},{key:"isLocalInvitationEnd",value:function(){return[Sa.CANCELED,Sa.FAILURE,Sa.ACCEPTED_BY_REMOTE,Sa.REFUSED_BY_REMOTE].includes(this.state)}}]),t}(sc()),Da(Sd.prototype,"send",[Mc],Object.getOwnPropertyDescriptor(Sd.prototype,"send"),Sd.prototype),Da(Sd.prototype,"cancel",[Mc],Object.getOwnPropertyDescriptor(Sd.prototype,"cancel"),Sd.prototype),Sd),Hi=ta.RemoteInvitationFailureReason,Fb=ta.RemoteInvitationState,rF=function(e){function t(e){var r=e.invitationChannel,i=e.extraContent,o=e.callId,s=e.callerId,a=e.logger;e=e.getSession,va(this,t);var c=n.call(this,a,"RtmRemoteInvitation",!0);return x(z(c),"state",Fb.INVITATION_RECEIVED),x(z(c),"remoteInvitationEnd$",fb(Db(z(c),"RemoteInvitationCanceled"),Db(z(c),"RemoteInvitationRefused"),Db(z(c),"RemoteInvitationAccepted"),Db(z(c),"RemoteInvitationFailure")).pipe(hb(1))),x(z(c),"callerId",void 0),x(z(c),"callId",void 0),x(z(c),"_getSession",void 0),x(z(c),"logger",void 0),x(z(c),"_content",void 0),x(z(c),"_channelId",void 0),x(z(c),"_response",""),c._channelId=r,c._content=i,c.callId=o,c.callerId=s,c._getSession=e,c.logger=a,c.remoteInvitationEnd$.pipe(Lb(6e4),ab((function(e){return Ab(e)&&c.warn("Remote invitation expired"),ra(e)}))).subscribe({error:function(){c.state=Fb.FAILURE,c.emit("RemoteInvitationFailure",Hi.INVITATION_EXPIRE)}}),c}Ga(t,e);var n=Ha(t);return eb(t,[{key:"channelId",get:function(){return this._channelId},set:function(e){throw new ca('Cannot set the "response" of the RemoteInvitation instance.',Xc)}},{key:"content",get:function(){return this._content},set:function(e){throw new ca('Cannot set the "content" of the RemoteInvitation instance.',Xc)}},{key:"response",get:function(){return this._response},set:function(e){this._response=e}},{key:"accept",value:function(){var e,t=this;if(this.isRemoteInvitationEnd())throw new da("The local invitation has ended. Cannot accept.",ri);if(this.state===Fb.ACCEPT_SENT_TO_LOCAL)throw new da("The remote invitation is accepting. Cannot do the operation.",Rr);if(8192<rh(this._response))throw new ca('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this.state=Fb.ACCEPT_SENT_TO_LOCAL,Jb(Qe(1e3).pipe(Cb((function(){return yd(ma(N.mark((function e(){return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t._getSession().sendInvitationMessage({peerId:t.callerId,callId:t.callId,extra:t.response,type:"CallAccept",isAcceptAck:!1,channelId:t.channelId}));case 1:case"end":return e.stop()}}),e)}))))})),yb((function(t){return e=t.hasPeerReceived})),hb(1)),Db(this,"RemoteInvitationAccepted")).pipe(Lb(5e3),Kc(this.remoteInvitationEnd$)).subscribe({error:function(n){if(t.logError(n),t.state=Fb.FAILURE,Ab(n))switch(e){case void 0:case!0:return void t.emit("RemoteInvitationFailure",Hi.ACCEPT_FAILURE);case!1:return void t.emit("RemoteInvitationFailure",Hi.PEER_OFFLINE)}t.emit("RemoteInvitationFailure",Hi.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===Fb.ACCEPT_SENT_TO_LOCAL)throw new da("The remote invitation is accepting. Cannot do the operation.",Rr);if(this.isRemoteInvitationEnd())throw new da("The invitation is end. Cannot refuse",ri);if(8192<rh(this._response))throw new ca('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã 1024 if encoded in UTF-8.',Xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=Fb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(e){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===Fb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=e,this.state=Fb.CANCELED,this.emit("RemoteInvitationCanceled",e))}},{key:"onAcceptAckReceived",value:function(){this.state!==Fb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=Fb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[Fb.ACCEPTED,Fb.REFUSED,Fb.CANCELED,Fb.FAILURE].includes(this.state)}}]),t}(sc()),sF=function(e){function t(e,r){va(this,t);var i=n.call(this,r,"InvitationManager");return x(z(i),"getSession",void 0),x(z(i),"invitationDispatcher",new Ba.EventEmitter),x(z(i),"outgoingLocalInvitations",new Map),x(z(i),"receivedRemoteInvitations",new Wc(void 0,{maxlen:1e4})),x(z(i),"logger",void 0),i.getSession=fo(e),i.logger=r,i.invitationDispatcher.on("remoteInvitationToManager",(function(e){var t=e.callId,n=e.extra,o=e.callerId;e=e.channelId,i.receivedRemoteInvitations.has(t)||((n=new rF({callerId:o,callId:t,getSession:i.getSession,logger:r,extraContent:n,invitationChannel:e})).remoteInvitationEnd$.subscribe((function(){i.receivedRemoteInvitations.delete(t)})),i.receivedRemoteInvitations.set(t,n),i.emit("remoteInvitationInstance",n))})),i.invitationDispatcher.on("acceptAckToRemoteInvitation",(function(e){(e=i.receivedRemoteInvitations.get(e.callId))&&e.onAcceptAckReceived()})),i.invitationDispatcher.on("cancelToRemoteInvitation",(function(e){var t=e.extra;(e=i.receivedRemoteInvitations.get(e.callId))&&e.onCancelReceived(t)})),i.invitationDispatcher.on("acceptToLocalInvitation",(function(e){var t=e.extra;(e=i.outgoingLocalInvitations.get(e.callId))&&e.onAcceptReceived(t)})),i.invitationDispatcher.on("refuseToLocalInvitation",(function(e){var t=e.extra;(e=i.outgoingLocalInvitations.get(e.callId))&&e.onRefuseReceived(t)})),i}Ga(t,e);var n=Ha(t);return eb(t,[{key:"invitationMessageHandler",value:function(e){var t=e.body,n=t.callId,r=t.extra;r=void 0===r?"":r;var i=t.type,o=void 0===(t=t.channel)?"":t,s=e.type;switch(t=e.peerId,e=e.serverReceivedTs,s){case"CallAccept":"ack"===i?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:n}):"request"===i&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:n,extra:r});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:n,callerId:t,extra:r,channelId:o});break;case"CallCancel":if("0"===n){n="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(o,"_").concat(r),this.getSession().emit("peerTextMessage",{peerId:t,properties:{serverReceivedTs:e},text:n});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:n,extra:r});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:n,extra:r});break;default:throw Rn("invitationType",s)}}},{key:"genLocalInvitation",value:function(e){var t=this,n=new qF(e,this.getSession,this.logger);return n.localInvitationEnd$.subscribe((function(){t.outgoingLocalInvitations.delete(n.callId)})),this.outgoingLocalInvitations.set(n.callId,n),n}}]),t}(sc()),tF=function(e,t,n){var r=!0,i=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return Gb(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),JD(e,t,{leading:r,maxWait:t,trailing:i})},Qb,If;!function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"}(If||(If={}));var Ii=ta.ConnectionState,uF=(Qb=function(e){function t(e,n,i,o){va(this,t);var s=r.call(this,o,"RtmChannel",!0);return x(z(s),"onMemberCountUpdated",tF((function(e){e!==s.memberCount&&(s.memberCount=e,s.emit("MemberCountUpdated",e))}),1e3)),x(z(s),"getSession",void 0),x(z(s),"memberCount",0),x(z(s),"joinState","LEFT"),x(z(s),"joinPromise",void 0),x(z(s),"memberJoinedLru",new Wc(void 0,{maxlen:1e4})),x(z(s),"memberLeftLru",new Wc(void 0,{maxlen:1e4})),x(z(s),"memberJoinStateLru",new Wc(void 0,{maxlen:1e4})),x(z(s),"attributesSeqLru",new Wc(void 0,{maxlen:1e4})),x(z(s),"channelId",void 0),x(z(s),"client",void 0),x(z(s),"onChannelMemberCountUpdated",(function(e,t){s.channelId===e&&s.onMemberCountUpdated(t)})),x(z(s),"onLogout",(function(){try{s.clearChannel(s.getSession())}catch(e){}})),x(z(s),"onAttributesUpdated",(function(e){var t=e.channelId,n=e.attributeMaps,r=e.seq;e=e.instance.toString();var i=s.attributesSeqLru.get(e);if((!i||r.greaterThan(i))&&(s.attributesSeqLru.set(e,r),t===s.channelId)){for(t={},r=0;r<n.length;r++){var o=n[r];e=o.key,i=o.ms;var a=o.value;if(o=o.origin,"string"!=typeof e||!P.isLong(i)||"string"!=typeof a||!Ta(o))break;t[e]={value:a,lastUpdateUserId:o,lastUpdateTs:i.toNumber()}}s.emit("AttributesUpdated",t)}})),x(z(s),"onChannelTextMessage",(function(e){var t=e.memberId,n=e.text,r=e.properties;e.channelId===s.channelId&&s.emit("ChannelMessage",{text:n,messageType:ta.MessageType.TEXT},t,r)})),x(z(s),"onChannelRawMessage",(function(e){var t=e.desc,n=e.raw,r=e.memberId,i=e.properties;e.channelId===s.channelId&&s.emit("ChannelMessage",{messageType:ta.MessageType.RAW,rawMessage:n,description:t},r,i)})),x(z(s),"onMemberNotice",(function(e){var t=e.memberId,n=e.type,r=e.size;if(e.channelId===s.channelId){var i=e.instance.toString();e=e.seq.toString();var o={MemberLeft:s.memberLeftLru,MemberJoined:s.memberJoinedLru,MemberCountUpdated:void 0}[n];if(o){if(o.has(i+e))return void s.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",n,e,La(s.channelId),La(t||""));if(o.set(i+e,void 0),"string"!=typeof t)return;if(t!==s.getSession().context.uid){if((i=s.memberJoinStateLru.get(t))===If.JOINED&&"MemberJoined"===n)return void s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,La(s.channelId),La(t||""));if(i===If.LEFT&&"MemberLeft"===n)return void s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",n,e,La(s.channelId),La(t||""))}s.memberJoinStateLru.set(t,"MemberJoined"===n?If.JOINED:If.LEFT)}s.info("Channel %s - %s, memberId: %s",n,La(s.channelId),"MemberCountUpdated"===n?"[unknown]":La(t||"")),i=t===s.getSession().context.uid,"MemberLeft"===n&&Ta(t)||"MemberJoined"===n&&Ta(t)?(i||s.emit(n,t),s.onMemberCountUpdated(r)):"MemberCountUpdated"===n&&"number"==typeof r&&s.onMemberCountUpdated(r)}})),s.getSession=fo(n),s.channelId=e,s.client=i,s.info("A channel created, id %s",La(e)),s}Ga(t,e);var n,r=Ha(t);return eb(t,[{key:"join",value:(n=ma(N.mark((function e(){var t,n,r,i,o,s,a,c=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,t=this.getSession(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new da("The client is not logged in. Cannot do the operation",Wr);case 7:if(e.prev=7,Ta(this.channelId)){e.next=10;break}throw new ca(["The %s in the arguments is invalid","channelId"],OB);case 10:if("LEFT"===this.joinState){e.next=13;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:t.context.uid,elapse:Xa(t.startTime),errCode:Vr,sid:sb(t.instanceId)},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),new da("The channel has joined. Cannot rejoin",Vr);case 13:if(!t.usedChannelIds.includes(this.channelId)){e.next=16;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:t.context.uid,elapse:Xa(t.startTime),errCode:Xr,sid:sb(t.instanceId)},null!==(o=this.client.context.config.enableCloudProxy)&&void 0!==o&&o),new da("A channel of the same channel ID has already joined. Cannot rejoin",Xr);case 16:if(!(20<=t.usedChannelIds.length)){e.next=19;break}throw bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:t.context.uid,elapse:Xa(t.startTime),errCode:Ur,sid:sb(t.instanceId)},null!==(s=this.client.context.config.enableCloudProxy)&&void 0!==s&&s),new ic("The joined channels has exceeded the limit of 20",Ur);case 19:return bb("ChnJoin",{cname:this.channelId,lts:P.fromNumber(Date.now()),userId:t.context.uid,elapse:Xa(t.startTime),errCode:0,sid:sb(t.instanceId)},null!==(n=this.client.context.config.enableCloudProxy)&&void 0!==n&&n),this.log("Joining the channel %s",La(this.channelId)),this.joinState="JOINING",t.usedChannelIds.push(this.channelId),this.joinPromise=t.requestChannelJoin(this.channelId).then((function(){c.joinState="JOINED"})),e.next=26,this.joinPromise;case 26:bb("ChnJoinRes",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(t.startTime),errCode:0,sid:sb(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),this.info("The channel %s joined successfully",La(this.channelId)),t.on("channelTextMessage",this.onChannelTextMessage),t.on("channelRawMessage",this.onChannelRawMessage),t.on("memberNotice",this.onMemberNotice),t.on("channelAttributesUpdated",this.onAttributesUpdated),this.client.internalEmitter.on("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.once("LOGOUT",this.onLogout),e.next=46;break;case 36:if(e.prev=36,e.t1=e.catch(7),"JOINING"===this.joinState&&(this.joinState="LEFT"),this.logError(e.t1),!Na(e.t1)){e.next=42;break}throw e.t1;case 42:if(!Ab(e.t1)){e.next=45;break}throw bb("ChnJoinRes",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(t.startTime),errCode:Tr,sid:sb(t.instanceId),serverErrCode:0,userId:t.context.uid},null!==(a=this.client.context.config.enableCloudProxy)&&void 0!==a&&a),new Ub(["Join channel %s timed out",La(this.channelId)],Tr);case 45:throw new ve(["The channel %s join failure",La(this.channelId)],{code:Sr,originalError:e.t1});case 46:case"end":return e.stop()}}),e,this,[[0,4],[7,36]])}))),function(){return n.apply(this,arguments)})},{key:"leave",value:function(){var e=ma(N.mark((function e(){var t,n,r,i;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=this.getSession(),e.next=7;break;case 4:throw e.prev=4,e.t0=e.catch(0),new da("The client is not logged in. Cannot do the operation",QB);case 7:if("LEFT"!==this.joinState){e.next=9;break}throw new da("The channel does not join. Cannot do the operation",PB);case 9:return e.prev=9,n.requestChannelLeave(this.channelId),e.next=13,this.clearChannel(n);case 13:e.next=24;break;case 15:if(e.prev=15,e.t1=e.catch(9),this.logError(e.t1),!Na(e.t1)){e.next=22;break}throw void 0===e.t1.code&&(e.t1.code=Zr),bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(n.startTime),errCode:Zr,sid:sb(n.instanceId),userId:n.context.uid},null!==(i=this.client.context.config.enableCloudProxy)&&void 0!==i&&i),e.t1;case 22:throw bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(n.startTime),errCode:Yr,sid:sb(n.instanceId),userId:n.context.uid},null!==(r=this.client.context.config.enableCloudProxy)&&void 0!==r&&r),new ve("The channel leave failure",{code:Yr,originalError:e.t1});case 24:bb("ChnLeave",{cname:this.channelId,lts:P.fromNumber(Date.now()),elapse:Xa(n.startTime),errCode:0,sid:sb(n.instanceId),userId:n.context.uid},null!==(t=this.client.context.config.enableCloudProxy)&&void 0!==t&&t);case 25:case"end":return e.stop()}}),e,this,[[0,4],[9,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var e=ma(N.mark((function e(t){var n,r=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xn(t,Il),this.client.connectionState!==Ii.CONNECTED||"JOINED"===this.joinState){e.next=3;break}throw new da("The channel does not join. Cannot do the operation",EB);case 3:if(this.client.connectionState!==Ii.RECONNECTING){e.next=8;break}return n=Date.now(),e.next=7,new Promise((function(e,i){var o,s=(o=ma(N.mark((function o(){var s;return N.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return s=Date.now()-n,o.prev=1,o.next=4,ph({message:t,peerId:r.channelId,toPeer:!1,session:r.getSession(),errorCodes:{NOT_LOGGED_IN:Jl,TOO_OFTEN:Nr},diff:s,logger:r.logger});case 4:e(),o.next=12;break;case 7:o.prev=7,o.t0=o.catch(1),Ab(o.t0)&&i(new Ub(we(r.name,"sendMessageToPeer",1e4),Hl)),Na(o.t0)&&i(o.t0),i(new Ja("Channel message send failure",{code:qi,originalError:o.t0}));case 12:return o.prev=12,clearTimeout(a),o.finish(12);case 15:case"end":return o.stop()}}),o,null,[[1,7,12,15]])}))),function(){return o.apply(this,arguments)});r.client.internalEmitter.once("RECONNECTED",s);var a=setTimeout((function(){r.client.internalEmitter.off("RECONNECTED",s),i(new Ub(we(r.name,"sendMessageToPeer",1e4),Hl))}),9e3)}));case 7:return e.abrupt("return");case 8:if(this.client.connectionState===Ii.CONNECTED){e.next=10;break}throw new da("The client is not logged in. Cannot do the operation",Jl);case 10:return e.prev=10,e.next=13,ph({message:t,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:Jl,TOO_OFTEN:Nr},diff:0,logger:this.logger});case 13:e.next=23;break;case 15:if(e.prev=15,e.t0=e.catch(10),!Ab(e.t0)){e.next=19;break}throw new Ub(we(this.name,"sendMessage",1e4),Hl);case 19:if(!Na(e.t0)){e.next=22;break}throw this.logError(e.t0),e.t0;case 22:throw new ve("The channel message send failure",qi);case 23:case"end":return e.stop()}}),e,this,[[10,15]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMembers",value:function(){var e=ma(N.mark((function e(){var t,n;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.client.connectionState===Ii.CONNECTED){e.next=3;break}throw new da("The client is not logged in. Cannot do the operation",LB);case 3:if("JOINED"===this.joinState){e.next=5;break}throw new da("The channel does not join. Cannot do the operation",KB);case 5:return t=this.getSession().requestChannelMemberList(this.channelId),e.next=8,t.pipe(Ea((function(e){return e.memberInfos.map((function(e){return e.account}))}))).toPromise();case 8:return n=e.sent,this.info("Channel %s - get members success, %o",La(this.channelId),n.map(La)),e.abrupt("return",n);case 13:if(e.prev=13,e.t0=e.catch(0),!Na(e.t0)){e.next=18;break}throw this.logError(e.t0),e.t0;case 18:throw new ve("The channel members get failure",IB);case 19:case"end":return e.stop()}}),e,this,[[0,13]])})));return function(){return e.apply(this,arguments)}}()},{key:"clearChannel",value:function(){var e=ma(N.mark((function e(t){var n=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.emit("channelLeft",this.channelId),"JOINING"!==this.joinState){e.next=4;break}return e.next=4,this.joinPromise;case 4:this.joinState="LEFT",this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,t.removeListener("channelTextMessage",this.onChannelTextMessage),t.removeListener("channelRawMessage",this.onChannelRawMessage),t.removeListener("memberNotice",this.onMemberNotice),t.removeListener("channelAttributesUpdated",this.onAttributesUpdated),this.client.internalEmitter.removeListener("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.removeListener("LOGOUT",this.onLogout),t.usedChannelIds=t.usedChannelIds.filter((function(e){return e!==n.channelId}));case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),t}(sc()),Da(Qb.prototype,"join",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"join"),Qb.prototype),Da(Qb.prototype,"leave",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"leave"),Qb.prototype),Da(Qb.prototype,"sendMessage",[Mc],Object.getOwnPropertyDescriptor(Qb.prototype,"sendMessage"),Qb.prototype),Da(Qb.prototype,"getMembers",[jb],Object.getOwnPropertyDescriptor(Qb.prototype,"getMembers"),Qb.prototype),Qb),W,Rb=ta.ConnectionChangeReason,oa=ta.ConnectionState,Vt={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},vF={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8,TOKEN_EXPIRED:9},wF=(W=function(e){function t(e,n,i,o){va(this,t);var s=r.call(this,n,"RtmClient",!0);return x(z(s),"connectionState",oa.DISCONNECTED),x(z(s),"internalEmitter",new Ba),x(z(s),"context",void 0),x(z(s),"attributes",{}),x(z(s),"loginPromise",void 0),x(z(s),"attributeDrafts",new Set),x(z(s),"session",void 0),x(z(s),"lastLoginTime",void 0),x(z(s),"reconnId",0),x(z(s),"channelAttributesCacheLru",new Wc(void 0,{maxlen:1e4})),x(z(s),"invitationManager",void 0),x(z(s),"subscribedPeerStatusCache",{}),x(z(s),"pendingPeerStatusSubCount",0),x(z(s),"peerStatusSeqLru",new Wc(void 0,{maxlen:1e4})),x(z(s),"peerUnreachableTimers",{}),x(z(s),"setParameters",void 0),x(z(s),"updateConfig",void 0),x(z(s),"blacklistedIP",{}),x(z(s),"TokenPrivilegeWillExpireHandler",(function(){s.emit("TokenPrivilegeWillExpire")})),x(z(s),"userDropHandler",(function(e){if(s.connectionState!==oa.ABORTED)switch(e){case 2:s.logError("Server banned because of token is expired"),s.onConnectionStateChanged(oa.ABORTED,Rb.TOKEN_EXPIRED),s.emit("TokenExpired");break;case 11:s.logError("Kicked off by remote session"),s.onConnectionStateChanged(oa.ABORTED,Rb.REMOTE_LOGIN);break;case 14:case 15:case 16:s.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[e])),s.onConnectionStateChanged(oa.ABORTED,Rb.BANNED_BY_SERVER);break;default:s.logError("User kicked off for unknown code: ".concat(e)),s.onConnectionStateChanged(oa.ABORTED,Rb.INTERRUPTED)}})),s.context=new xE(e,i,n),s.context.config=i,s.setParameters=o.bind(z(s)),s.updateConfig=o.bind(z(s)),s.invitationManager=new sF((function(){return s.session}),n),s.invitationManager.on("remoteInvitationInstance",(function(e){s.emit("RemoteInvitationReceived",e)})),s.setMaxListeners(512),s.internalEmitter.setMaxListeners(512),s}Ga(t,e);var n,r=Ha(t);return eb(t,[{key:"renewToken",value:(n=ma(N.mark((function e(t){var n,r,i,o,s=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&0!==t.length){e.next=2;break}throw new ca("Invalid argument",XB);case 2:if(this.connectionState!==oa.ABORTED){e.next=5;break}return e.next=5,new Promise((function(){}));case 5:if(this.connectionState===oa.CONNECTED||this.connectionState===oa.RECONNECTING){e.next=7;break}throw new da("The client is not logged in",hs);case 7:if(void 0!==this.session){e.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,n=this.context.token,this.context.token=t,e.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe($d((function(){return Error("No available edge address to connect")})),Re((function(e){return e.pipe(sa((function(e){if(Na(e))throw e})),Zd(2500),hb(4))})),hb(1),Lb(2e4),ab((function(e){return Ab(e)&&s.warn("renewToken timed out"),ra(e)}))).toPromise();case 14:r=e.sent,i=r.ticket,e.next=27;break;case 18:if(e.prev=18,e.t0=e.catch(9),this.context.token=n,e.t0.code!==as&&e.t0.code!==bs){e.next=23;break}throw new Bf("Invalid token",ZB);case 23:if(e.t0.code!==ti){e.next=25;break}throw new Bf("The token expired",YB);case 25:if(!Ab(e.t0)){e.next=27;break}throw new Ub("Renew token timed out",Ml);case 27:o=this.session,this.session.requestUpdateEdgeTicket(i).toPromise().then((function(e){if(0!==e.code)throw new Ja(["RenewToken failure. The response code is %d",e.code],Ml);o.curLoginSockets.filter((function(e){return void 0!==e})).forEach((function(e){return e.ticket=i}))}));case 29:case"end":return e.stop()}}),e,this,[[9,18]])}))),function(e){return n.apply(this,arguments)})},{key:"queryPeersOnlineStatus",value:function(){var e=ma(N.mark((function e(t){var n,r,i=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===oa.CONNECTED){e.next=2;break}throw new da("The client is not logged in",WB);case 2:if(void 0!==this.session){e.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(t)||0===t.length||t.some((function(e){return!Ta(e)}))||256<t.length)){e.next=6;break}throw new ca("invalid arguments",gs);case 6:return e.next=8,this.session.requestPeersOnlineStatus(t).toPromise();case 8:return n=e.sent,r=md(tl(n.userInfos,"account"),(function(e){return!!e.ts})),Object.keys(r).forEach((function(e){if(e in i.subscribedPeerStatusCache&&i.subscribedPeerStatusCache[e]!==ta.PeerOnlineState.UNREACHABLE){var t=r[e]?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE;i.emit("PeersOnlineStatusChanged",x({},e,t)),i.subscribedPeerStatusCache[e]=t}})),e.abrupt("return",r);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var e=ma(N.mark((function e(t){var n,r,i,o,s,a,c,u,l;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===oa.CONNECTED){e.next=2;break}throw new da("The client is not logged in",HB);case 2:if(void 0!==this.session){e.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&t.every((function(e){return"string"==typeof e}))&&0!==t.length){e.next=6;break}throw new ca("Invalid arguments: channelIds",Pr);case 6:if(!(32<t.length)){e.next=8;break}throw new ca("getChannelMemberCount exceed limit of 32 channelIds",GB);case 8:n=0;case 9:if(!(n<t.length)){e.next=16;break}if(Ta(r=t[n])){e.next=13;break}throw new ca(["getChannelMemberCount channel id %s is invalid",r],Pr);case 13:n++,e.next=9;break;case 16:return e.next=18,this.session.requestGetChannelMemberCount(t).toPromise();case 18:for(i=e.sent,o=i.groupInfos,s={},a=0;a<o.length;a++)c=o[a],u=c.group,l=c.memberCount,Ta(u)&&"number"==typeof l&&(this.internalEmitter.emit("channelMemberCountUpdated",u,l),s[u]=l);return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var e=ma(N.mark((function e(t){var n,r;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ag({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===oa.CONNECTED){e.next=3;break}throw new da("The client is not logged in",qc);case 3:if(void 0!==this.session){e.next=5;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return n=this.session.requestSetLocalUserAttributes(t).toPromise(),r={attribute:t,promise:n},this.attributeDrafts.add(r),e.prev=8,e.next=11,n;case 11:this.attributes=t,e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(8),!Na(e.t0)){e.next=18;break}throw e.t0;case 18:throw new ca("arguments is not valid",gb);case 19:return e.prev=19,this.attributeDrafts.delete(r),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[8,14,19,22]])})));return function(t){return e.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var e=ma(N.mark((function e(t,n){var r,i,o,s,a,c=arguments;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<c.length&&void 0!==c[2]?c[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,ag({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===oa.CONNECTED){e.next=4;break}throw new da("The client is not logged in",qc);case 4:if(void 0!==this.session){e.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return s=this.session.requestSetChannelAttributes(t,n,o).toPromise(),e.prev=7,e.next=10,s;case 10:a=md(n,(function(e){return new Blob([e]).size})),this.channelAttributesCacheLru.set(t,a),e.next=19;break;case 14:if(e.prev=14,e.t0=e.catch(7),!Na(e.t0)){e.next=18;break}throw e.t0;case 18:throw new ca("arguments is not valid",gb);case 19:case"end":return e.stop()}}),e,this,[[7,14]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var e=ma(N.mark((function e(t){var n,r,i;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Wa(Wa({},this.attributes),t),ag({attributes:t,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),ag({attributes:n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===oa.CONNECTED){e.next=5;break}throw new da("The client is not logged in",qc);case 5:if(void 0!==this.session){e.next=7;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return r=this.session.requestAddOrUpdateLocalUserAttributes(t).toPromise(),i={attribute:n,promise:r},this.attributeDrafts.add(i),e.prev=10,e.next=13,r;case 13:this.attributes=n,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!Na(e.t0)){e.next=20;break}throw e.t0;case 20:throw new ca("arguments is not valid",gs);case 21:return e.prev=21,this.attributeDrafts.delete(i),e.finish(21);case 24:case"end":return e.stop()}}),e,this,[[10,16,21,24]])})));return function(t){return e.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var e=ma(N.mark((function e(t,n){var r,i,o,s,a,c,u,l=arguments;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,s=this.channelAttributesCacheLru.get(t,{}),a=md(n,(function(e){return new Blob([e]).size})),c=Wa(Wa({},s),a),ag({attributes:n,attrSizeMap:c,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===oa.CONNECTED){e.next=7;break}throw new da("The client is not logged in",qc);case 7:if(void 0!==this.session){e.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return u=this.session.requestAddOrUpdateChannelAttributes(t,n,o).toPromise(),e.prev=10,e.next=13,u;case 13:this.channelAttributesCacheLru.set(t,c),e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(10),!Na(e.t0)){e.next=20;break}throw e.t0;case 20:throw new ca("arguments is not valid",gb);case 21:case"end":return e.stop()}}),e,this,[[10,16]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var e=ma(N.mark((function e(t){var n,r,i,o;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Array.isArray(t)&&0!==t.length&&!t.some((function(e){return 0===e.length}))){e.next=2;break}throw new da("arguments is not valid",gb);case 2:if(this.connectionState===oa.CONNECTED){e.next=4;break}throw new da("The client is not logged in",qc);case 4:if(void 0!==this.session){e.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return n=this.session.requestDeleteLocalUserAttributesByKeys(t).toPromise(),r={attribute:ql(this.attributes,t),promise:n},this.attributeDrafts.add(r),e.prev=9,e.next=12,n;case 12:for(i=0;i<t.length;i++)o=t[i],delete this.attributes[o];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(9),!Na(e.t0)){e.next=19;break}throw e.t0;case 19:throw new ca("arguments is not valid",gb);case 20:return e.prev=20,this.attributeDrafts.delete(r),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[9,15,20,23]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var e=ma(N.mark((function e(t,n){var r,i,o,s,a,c,u,l=arguments;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=2<l.length&&void 0!==l[2]?l[2]:{},i=r.enableNotificationToChannelMembers,o=void 0!==i&&i,Array.isArray(n)&&0!==n.length&&Ta(t)&&!n.some((function(e){return 0===e.length||512<e.length}))){e.next=3;break}throw new da("arguments is not valid",gb);case 3:if(this.connectionState===oa.CONNECTED){e.next=5;break}throw new da("The client is not logged in",qc);case 5:if(void 0!==this.session){e.next=7;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return s=this.session.requestDeleteChannelAttributesByKeys(t,n,o).toPromise(),e.prev=8,e.next=11,s;case 11:if(a=this.channelAttributesCacheLru.get(t))for(c=0;c<n.length;c++)u=n[c],delete a[u];e.next=20;break;case 15:if(e.prev=15,e.t0=e.catch(8),!Na(e.t0)){e.next=19;break}throw e.t0;case 19:throw new ca("arguments is not valid",gb);case 20:case"end":return e.stop()}}),e,this,[[8,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var e=ma(N.mark((function e(){var t,n;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===oa.CONNECTED){e.next=2;break}throw new da("The client is not logged in",qc);case 2:if(void 0!==this.session){e.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return t=this.session.requestClearLocalUserAttributes().toPromise(),n={attribute:{},promise:t},this.attributeDrafts.add(n),e.prev=7,e.next=10,t;case 10:this.attributes={},e.next=18;break;case 13:if(e.prev=13,e.t0=e.catch(7),!Na(e.t0)){e.next=17;break}throw e.t0;case 17:throw new ca("arguments is not valid",gb);case 18:return e.prev=18,this.attributeDrafts.delete(n),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[7,13,18,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var e=ma(N.mark((function e(t){var n,r,i,o,s=arguments;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=1<s.length&&void 0!==s[1]?s[1]:{},r=n.enableNotificationToChannelMembers,i=void 0!==r&&r,this.connectionState===oa.CONNECTED){e.next=3;break}throw new da("The client is not logged in",qc);case 3:if(void 0!==this.session){e.next=5;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return o=this.session.requestClearChannelAttributes(t,i).toPromise(),e.prev=6,e.next=9,o;case 9:this.channelAttributesCacheLru.delete(t),e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(6),!Na(e.t0)){e.next=16;break}throw e.t0;case 16:throw new ca("arguments is not valid",gb);case 17:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var e=ma(N.mark((function e(t){var n,r,i;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ta(t)){e.next=2;break}throw new ca("Not a valid user ID",gb);case 2:if(this.connectionState===oa.CONNECTED){e.next=4;break}throw new da("The client is not logged in",qc);case 4:if(void 0!==this.session){e.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetUserAttributeKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetUserAttributesByKeys(t,r.slice(0,512)).toPromise();case 13:i=e.sent,e.next=21;break;case 16:if(e.prev=16,e.t0=e.catch(6),!Na(e.t0)){e.next=20;break}throw e.t0;case 20:throw new ca("arguments is not valid",gb);case 21:return e.abrupt("return",Zq(i.attributeInfos.map((function(e){return[e.key,e.value]}))));case 22:case"end":return e.stop()}}),e,this,[[6,16]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var e=ma(N.mark((function e(t){var n,r,i,o,s,a,c,u,l,A,h;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ta(t)){e.next=2;break}throw new ca("Not a valid channel ID",gb);case 2:if(this.connectionState===oa.CONNECTED){e.next=4;break}throw new da("The client is not logged in",qc);case 4:if(void 0!==this.session){e.next=6;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return e.prev=6,e.next=9,this.session.requestGetChannelAttributesKeys(t).toPromise();case 9:return n=e.sent,r=n.keys,e.next=13,this.session.requestGetChannelAttributesByKeys(t,r).toPromise();case 13:i=e.sent,o=i.attributeMaps,e.next=22;break;case 17:if(e.prev=17,e.t0=e.catch(6),!Na(e.t0)){e.next=21;break}throw e.t0;case 21:throw new ca("arguments is not valid",gb);case 22:s={},a=0;case 24:if(!(a<o.length)){e.next=32;break}if(c=o[a],u=c.key,l=c.ms,A=c.value,h=c.origin,"string"==typeof u&&P.isLong(l)&&"string"==typeof A&&Ta(h)){e.next=28;break}return e.abrupt("break",32);case 28:s[u]={value:A,lastUpdateUserId:h,lastUpdateTs:l.toNumber()};case 29:a++,e.next=24;break;case 32:return this.channelAttributesCacheLru.set(t,md(s,(function(e){return new Blob([e.value]).size}))),e.abrupt("return",s);case 34:case"end":return e.stop()}}),e,this,[[6,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var e=ma(N.mark((function e(t,n){var r,i,o,s,a,c,u,l,A,h;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===oa.CONNECTED){e.next=2;break}throw new da("The client is not logged in",qc);case 2:if(void 0!==this.session){e.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Qn(t,n),e.prev=5,e.next=8,this.session.requestGetChannelAttributesByKeys(t,n).toPromise();case 8:r=e.sent,i=r.attributeMaps,e.next=17;break;case 12:if(e.prev=12,e.t0=e.catch(5),!Na(e.t0)){e.next=16;break}throw e.t0;case 16:throw new ca("arguments is not valid",gb);case 17:o={},s=this.channelAttributesCacheLru.get(t,{}),a=0;case 20:if(!(a<i.length)){e.next=29;break}if(c=i[a],u=c.key,l=c.ms,A=c.value,h=c.origin,"string"==typeof u&&P.isLong(l)&&"string"==typeof A&&Ta(h)){e.next=24;break}return e.abrupt("break",29);case 24:s[u]=new Blob([A]).size,o[u]={value:A,lastUpdateUserId:h,lastUpdateTs:l.toNumber()};case 26:a++,e.next=20;break;case 29:return this.channelAttributesCacheLru.set(t,s),e.abrupt("return",o);case 31:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var e=ma(N.mark((function e(t,n){var r;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===oa.CONNECTED){e.next=2;break}throw new da("The client is not logged in",qc);case 2:if(void 0!==this.session){e.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Qn(t,n),e.prev=5,e.next=8,this.session.requestGetUserAttributesByKeys(t,n).toPromise();case 8:r=e.sent,e.next=16;break;case 11:if(e.prev=11,e.t0=e.catch(5),!Na(e.t0)){e.next=15;break}throw e.t0;case 15:throw new ca("arguments is not valid",gb);case 16:return e.abrupt("return",Zq(r.attributeInfos.map((function(e){return[e.key,e.value]}))));case 17:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=ma(N.mark((function e(t){var n,r,i,o,s;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(xn(!0),r=nh(),i=t.token,t.token===this.context.appId&&(i=void 0),bb("Session",{appId:this.context.appId,did:navigator.userAgent,elapse:Xa(this.session&&this.session.startTime),index:{index1:t.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},installId:Og,lts:P.fromNumber(Date.now()),os:7,sid:sb(r),token:i||"",userId:t.uid,ver:"1.5.1",buildno:418,subVersion:18,version:4},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n,!0),De(t)&&Ta(t.uid)){e.next=7;break}throw new ca("not a valid user id",si);case 7:if("string"!=typeof i||!i){e.next=11;break}this.context.token=i,e.next=13;break;case 11:if("string"==typeof i||null==i){e.next=13;break}throw new ca('The "token" is not a valid string.',si);case 13:return o=Date.now(),this.context.sid=sb(r),this.loginPromise=this.loginImpl({uid:t.uid,instanceId:r}),this.info("RTM Client logging in as ".concat(La(t.uid))),e.prev=17,e.next=20,this.loginPromise;case 20:e.next=28;break;case 22:throw e.prev=22,e.t0=e.catch(17),Na(e.t0)&&bb("Link",{ackedServerIp:"",destServerIp:"",ec:e.t0.code||1,sc:e.t0.serverCode,elapse:Xa(this.session&&this.session.startTime),lts:P.fromNumber(Date.now()),responseTime:Date.now()-o,sid:sb(r),userId:t.uid},null!==(s=this.context.config.enableCloudProxy)&&void 0!==s&&s),this.context.token=void 0,this.context.socketUseProxy=!1,e.t0;case 28:return e.prev=28,this.loginPromise=void 0,e.finish(28);case 31:this.context.socketUseProxy&&this.emit("FallbackProxyConnected"),xn(!1);case 33:case"end":return e.stop()}}),e,this,[[17,22,28,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=ma(N.mark((function e(){var t;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loginPromise){e.next=3;break}return e.next=3,this.loginPromise;case 3:if(this.connectionState!==oa.DISCONNECTED){e.next=6;break}throw this.logError("Already in logout state"),new da("Logout failure. The client has already been logged out",cs);case 6:if(this.internalEmitter.emit("LOGOUT"),this.connectionState!==oa.ABORTED){e.next=11;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),e.abrupt("return");case 11:if(void 0!==this.session){e.next=14;break}return this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),e.abrupt("return");case 14:return bb("Logout",{elapse:Xa(this.session.startTime),lts:P.fromNumber(Date.now()),sid:sb(this.session.instanceId),userId:this.context.uid},null!==(t=this.context.config.enableCloudProxy)&&void 0!==t&&t),e.next=17,this.session.logoutHandler();case 17:this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT),this.log("Log out success");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var e,t=this;if(this.connectionState===oa.DISCONNECTED)throw this.logError("Already in logout state"),new da("Logout failure. The client has already been logged out",cs);this.connectionState===oa.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):void 0!==this.session&&(bb("Logout",{elapse:Xa(this.session.startTime),lts:P.fromNumber(Date.now()),sid:sb(this.session.instanceId),userId:this.context.uid},null!==(e=this.context.config.enableCloudProxy)&&void 0!==e&&e),this.session.logoutHandler().then((function(){t.log("Log out success")}))),this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var e=ma(N.mark((function e(t,n){var r,i,o=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xn(t,bg),r="TEXT"===t.messageType?Ka.P2pSMsgNoOfflineFlag:Ka.P2pRMsgNoOfflineFlag,this.connectionState!==oa.RECONNECTING){e.next=5;break}return i=Date.now(),e.abrupt("return",new Promise((function(e,s){var a,c=(a=ma(N.mark((function a(){var c;return N.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(void 0!==o.session){a.next=2;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return c=Date.now()-i,a.prev=3,a.t0=e,a.next=7,ph({message:t,peerId:n,toPeer:!0,session:o.session,errorCodes:{NOT_LOGGED_IN:Ll,TOO_OFTEN:es},diff:c,logger:o.logger});case 7:a.t1=a.sent,(0,a.t0)(a.t1),a.next=18;break;case 11:a.prev=11,a.t2=a.catch(3),Ab(a.t2)&&(o.session.emit("messageCount",{messageCategory:r,type:"common",key:"sentcount"}),o.session.emit("messageCount",{messageCategory:r,type:"common",key:"timeoutcount"}),s(new Ub(we(o.name,"sendMessageToPeer",1e4),Kl))),Na(a.t2)&&s(a.t2),o.session.emit("messageCount",{messageCategory:r,type:"common",key:"sentcount"}),o.session.emit("messageCount",{messageCategory:r,type:"common",key:"unknowerrorcount"}),s(new Ja("Peer-to-peer message send failure",{code:ds,originalError:a.t2}));case 18:return a.prev=18,clearTimeout(u),a.finish(18);case 21:case"end":return a.stop()}}),a,null,[[3,11,18,21]])}))),function(){return a.apply(this,arguments)});o.internalEmitter.once("RECONNECTED",c);var u=setTimeout((function(){o.internalEmitter.off("RECONNECTED",c),s(new Ub(we(o.name,"sendMessageToPeer",1e4),Kl))}),9e3)})));case 5:if(this.connectionState===oa.CONNECTED){e.next=7;break}throw new da("Failed to send the peer-to-peer message. The client is not logged in",Ll);case 7:if(void 0!==this.session){e.next=9;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return e.prev=9,e.next=12,ph({message:t,peerId:n,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:Ll,TOO_OFTEN:es},diff:0,logger:this.logger});case 12:return e.abrupt("return",e.sent);case 15:if(e.prev=15,e.t0=e.catch(9),!Ab(e.t0)){e.next=21;break}throw this.session.emit("messageCount",{messageCategory:r,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:r,type:"common",key:"timeoutcount"}),new Ub(we(this.name,"sendMessageToPeer",1e4),Kl);case 21:if(!Na(e.t0)){e.next=23;break}throw e.t0;case 23:throw this.session.emit("messageCount",{messageCategory:r,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:r,type:"common",key:"unknowerrorcount"}),new Ja("Peer-to-peer message send failure",{code:ds,originalError:e.t0});case 26:case"end":return e.stop()}}),e,this,[[9,15]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createChannel",value:function(e){var t=this;if(!Ta(e))throw new ca(["The %s in the arguments is invalid",Object.keys({channelId:e})[0]],FB);return new uF(e,(function(){return t.session}),this,this.logger)}},{key:"createLocalInvitation",value:function(e){if(!Ta(e))throw new ca(["The %s in the arguments is invalid",Object.keys({calleeId:e})[0]],Xc);return this.invitationManager.genLocalInvitation(e)}},{key:"subscribePeersOnlineStatus",value:function(){var e=ma(N.mark((function e(t){var n,r,i,o,s,a,c,u,l,A,h,d,p,f=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===oa.CONNECTED){e.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(void 0!==this.session){e.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new ca("Invalid arguments: peerIds",Qg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(Ta(r=t[n])){e.next=11;break}throw new ca(["subscribePeersOnlineStatus peer id %s is invalid",r],Qg);case 11:n++,e.next=7;break;case 14:if(!(512<(i=t&&t.length?fl(t):[]).length+Object.keys(this.subscribedPeerStatusCache).length+this.pendingPeerStatusSubCount)){e.next=17;break}throw new ic("Subscribed peers overflows",js);case 17:return this.pendingPeerStatusSubCount+=i.length,e.next=20,this.session.requestSubscribePeersOnlineStatus(i).toPromise();case 20:o=e.sent,s=o.errors,this.pendingPeerStatusSubCount-=i.length,a=[],c=[],u=0;case 26:if(!(u<s.length)){e.next=34;break}if(l=s[u],A=l.code,"string"==typeof(h=l.account)){e.next=30;break}throw new Ja("Returned account is invalid",is);case 30:0!==A&&a.push(h);case 31:u++,e.next=26;break;case 34:for(d=0;d<i.length;d++)p=i[d],a.includes(p)||(c.push(p),this.subscribedPeerStatusCache[p]=void 0);if(this.session.requestPeersOnlineStatus(c).pipe(Ea((function(e){return md(tl(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=md(e,(function(e,t){return e=e?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE,f.subscribedPeerStatusCache[t]=e})),f.emit("PeersOnlineStatusChanged",e)})),0===a.length){e.next=38;break}throw new Ja("Subscription failed",is);case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var e=ma(N.mark((function e(t){var n,r,i,o,s;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===oa.CONNECTED){e.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(void 0!==this.session){e.next=4;break}throw new mb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(t)&&0!==t.length){e.next=6;break}throw new ca("Invalid arguments: peerIds",Qg);case 6:n=0;case 7:if(!(n<t.length)){e.next=14;break}if(Ta(r=t[n])){e.next=11;break}throw new ca(["subscribePeersOnlineStatus peer id %s is invalid",r],Qg);case 11:n++,e.next=7;break;case 14:if(!(512<t.length)){e.next=16;break}throw new ic("Unsubscribed peers overflows",js);case 16:for(i=t&&t.length?fl(t):[],this.session.requestUnsubscribePeersOnlineStatus(i),o=0;o<i.length;o++)s=i[o],delete this.subscribedPeerStatusCache[s];case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var e=ma(N.mark((function e(t){return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.connectionState===oa.CONNECTED){e.next=2;break}throw new da("The client is not logged in",Nl);case 2:if(t!==ta.PeerSubscriptionOption.ONLINE_STATUS){e.next=4;break}return e.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new ca("Subscription option not supported",Qg);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createMessage",value:function(e){return e}},{key:"loginImpl",value:function(){var e=ma(N.mark((function e(t){var n,r,i,o,s,a,c,u,l=this;return N.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.uid,r=t.instanceId,i=t.forceLoginTime,o=void 0===i?0:i,s=r,!(void 0!==this.lastLoginTime&&500>Date.now()-this.lastLoginTime)){e.next=4;break}throw new bE(["The frequency of login exceeded the limit of %d queries per second",2],UB);case 4:if(this.connectionState===oa.DISCONNECTED||0!==o){e.next=6;break}throw new da("The SDK is either logging in or has logged in the Agora RTM system",SB);case 6:e.prev=6,this.context.uid=n,e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(6),new ca(["The %s in the arguments is invalid",Object.keys({uid:n})[0]],si);case 13:return 0===o&&this.onConnectionStateChanged(oa.CONNECTING,Rb.LOGIN),(a=new ct(this.context,this.logger,!1)).blacklistedIP=this.blacklistedIP,this.session=c=new Tt(this.context,a,s,this.logger),u=function(){l.connectionState===oa.CONNECTED&&(l.onConnectionStateChanged(oa.RECONNECTING,Rb.INTERRUPTED),l.session)&&l.session.once("userJoined",(function(){l.onConnectionStateChanged(oa.CONNECTED,Rb.LOGIN_SUCCESS)}))},c.on("connectionLost",u),c.on("tokenExpired",(function(){l.emit("TokenExpired")})),c.on("tokenPrivilegeWillExpire",this.TokenPrivilegeWillExpireHandler),c.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",(function(e){l.emit("MessageFromPeer",{text:e.text,messageType:ta.MessageType.TEXT},e.peerId,e.properties)})),this.session.on("peerRawMessage",(function(e){l.emit("MessageFromPeer",{rawMessage:e.raw,description:e.desc,messageType:ta.MessageType.RAW},e.peerId,e.properties)})),c.on("instanceChanged",(function(e){return s=e})),c.on("peerOnlineStatusChanged",(function(e){var t=e.instance.toString()+e.state,n=l.peerStatusSeqLru.get(t);!n||e.seq.greaterThan(n)?(l.peerStatusSeqLru.set(t,e.seq),e.state!==l.subscribedPeerStatusCache[e.peerId]&&l.emit("PeersOnlineStatusChanged",x({},e.peerId,e.state)),l.subscribedPeerStatusCache[e.peerId]=e.state,clearTimeout(l.peerUnreachableTimers[t]),e.state===ta.PeerOnlineState.UNREACHABLE&&(l.peerUnreachableTimers[t]=setTimeout((function(){l.subscribedPeerStatusCache[e.peerId]===ta.PeerOnlineState.UNREACHABLE&&(l.subscribedPeerStatusCache[e.peerId]=ta.PeerOnlineState.ONLINE,l.emit("PeersOnlineStatusChanged",x({},e.peerId,ta.PeerOnlineState.ONLINE)))}),3e4))):l.log("peerOnlineStatusChanged dedup for %s, %d",t,e.seq.toNumber())})),c.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),c.on("channelAttributesUpdated",(function(e){var t=e.channelId;e=e.attributeMaps;for(var n={},r=0;r<e.length;r++){var i=e[r],o=i.key,s=i.ms,a=i.value;if(i=i.origin,"string"!=typeof o||!P.isLong(s)||"string"!=typeof a||!Ta(i))break;n[o]=new Blob([a]).size}l.channelAttributesCacheLru.set(t,n)})),c.on("userJoined",(function(e){if(0!==Object.keys(l.attributes).length){if(void 0===l.session)return;l.session.requestSetLocalUserAttributes(l.attributes,e).toPromise()}if(0!==l.attributeDrafts.size)for(var t=function(t,n){var r=(t=n[t]).attribute;t.promise.then((function(){void 0!==l.session&&l.session.requestSetLocalUserAttributes(r,e).toPromise()}))},n=0,r=Array.from(l.attributeDrafts);n<r.length;n++)t(n,r);0!==Object.keys(l.subscribedPeerStatusCache).length&&c.requestSubscribePeersOnlineStatus(Object.keys(l.subscribedPeerStatusCache))})),c.on("banEdgeIP",(function(e){l.banIP(e)})),this.lastLoginTime=Date.now(),e.prev=32,e.next=35,c.loginHandler().toPromise();case 35:e.next=53;break;case 37:if(e.prev=37,e.t1=e.catch(32),!("loginRespTimeout"===e.t1.name&&2>o)){e.next=46;break}return c.removeAllListeners(),e.next=43,this.loginImpl({uid:n,instanceId:r,forceLoginTime:o+1});case 43:return e.abrupt("return");case 46:if(!Ab(e.t1)){e.next=49;break}throw this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGIN_TIMEOUT),new Ub(we(this.name,"login",12e3),TB);case 49:if(this.onConnectionStateChanged(oa.DISCONNECTED,Rb.LOGIN_FAILURE),!Na(e.t1)){e.next=52;break}throw e.t1;case 52:throw new Ja("Login failure",{code:$r,originalError:e.t1});case 53:this.onConnectionStateChanged(oa.CONNECTED,Rb.LOGIN_SUCCESS);case 54:case"end":return e.stop()}}),e,this,[[6,10],[32,37]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(e,t){var n,r=this;e===oa.RECONNECTING&&(this.reconnId+=1),bb("ConnectionStateChange",{elapse:Xa(this.session&&this.session.startTime),lts:P.fromNumber(Date.now()),newState:Vt[e],oldState:Vt[this.connectionState],reason:vF[t],sid:sb(this.session&&this.session.instanceId||P.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},null!==(n=this.context.config.enableCloudProxy)&&void 0!==n&&n),this.connectionState===oa.RECONNECTING&&e===oa.CONNECTED&&(0!==Object.keys(this.subscribedPeerStatusCache).length&&void 0!==this.session&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(Ea((function(e){return md(tl(e.userInfos,"account"),(function(e){return!!e.ts}))}))).subscribe((function(e){e=md(e,(function(e,t){return e=e?ta.PeerOnlineState.ONLINE:ta.PeerOnlineState.OFFLINE,r.subscribedPeerStatusCache[t]=e})),r.emit("PeersOnlineStatusChanged",e)})),this.internalEmitter.emit("RECONNECTED")),this.connectionState=e,e!==oa.ABORTED&&e!==oa.DISCONNECTED||(this.pendingPeerStatusSubCount=this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.emit("ConnectionStateChanged",e,t)}},{key:"banIP",value:function(e){var t;this.log("ip banned",e);var n=null!==(t=this.blacklistedIP[e])&&void 0!==t?t:0;this.blacklistedIP[e]=n+1}}]),t}(sc()),Da(W.prototype,"renewToken",[jb],Object.getOwnPropertyDescriptor(W.prototype,"renewToken"),W.prototype),Da(W.prototype,"queryPeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"queryPeersOnlineStatus"),W.prototype),Da(W.prototype,"getChannelMemberCount",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelMemberCount"),W.prototype),Da(W.prototype,"setLocalUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"setLocalUserAttributes"),W.prototype),Da(W.prototype,"setChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"setChannelAttributes"),W.prototype),Da(W.prototype,"addOrUpdateLocalUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"addOrUpdateLocalUserAttributes"),W.prototype),Da(W.prototype,"addOrUpdateChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"addOrUpdateChannelAttributes"),W.prototype),Da(W.prototype,"deleteLocalUserAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"deleteLocalUserAttributesByKeys"),W.prototype),Da(W.prototype,"deleteChannelAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"deleteChannelAttributesByKeys"),W.prototype),Da(W.prototype,"clearLocalUserAttributes",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"clearLocalUserAttributes"),W.prototype),Da(W.prototype,"clearChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"clearChannelAttributes"),W.prototype),Da(W.prototype,"getUserAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getUserAttributes"),W.prototype),Da(W.prototype,"getChannelAttributes",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelAttributes"),W.prototype),Da(W.prototype,"getChannelAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getChannelAttributesByKeys"),W.prototype),Da(W.prototype,"getUserAttributesByKeys",[jb],Object.getOwnPropertyDescriptor(W.prototype,"getUserAttributesByKeys"),W.prototype),Da(W.prototype,"login",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"login"),W.prototype),Da(W.prototype,"logout",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"logout"),W.prototype),Da(W.prototype,"logoutSync",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"logoutSync"),W.prototype),Da(W.prototype,"sendMessageToPeer",[jb],Object.getOwnPropertyDescriptor(W.prototype,"sendMessageToPeer"),W.prototype),Da(W.prototype,"createChannel",[jb],Object.getOwnPropertyDescriptor(W.prototype,"createChannel"),W.prototype),Da(W.prototype,"createLocalInvitation",[jb],Object.getOwnPropertyDescriptor(W.prototype,"createLocalInvitation"),W.prototype),Da(W.prototype,"subscribePeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"subscribePeersOnlineStatus"),W.prototype),Da(W.prototype,"unsubscribePeersOnlineStatus",[jb],Object.getOwnPropertyDescriptor(W.prototype,"unsubscribePeersOnlineStatus"),W.prototype),Da(W.prototype,"queryPeersBySubscriptionOption",[jb],Object.getOwnPropertyDescriptor(W.prototype,"queryPeersBySubscriptionOption"),W.prototype),Da(W.prototype,"createMessage",[Mc],Object.getOwnPropertyDescriptor(W.prototype,"createMessage"),W.prototype),W),rm,sm,tm,um,Wt=null===(rm=/Chrome\/([0-9.]+)/.exec(null===(tm=window)||void 0===tm||null===(um=tm.navigator)||void 0===um?void 0:um.userAgent))||void 0===rm||null===(sm=rm[1])||void 0===sm?void 0:sm.split(".")[0];if(Wt&&88<=parseInt(Wt,10)&&!Ce()){var vm,ze=document.createElement("video"),Ae=document.createElement("canvas");ze.setAttribute("style","display:none"),ze.setAttribute("muted",""),ze.muted=!0,ze.setAttribute("autoplay",""),ze.autoplay=!0,ze.setAttribute("playsinline",""),Ae.setAttribute("style","display:none"),Ae.setAttribute("width","1"),Ae.setAttribute("height","1"),null===(vm=Ae.getContext("2d"))||void 0===vm||vm.fillRect(0,0,1,1),ze.srcObject=null==Ae?void 0:Ae.captureStream()}var Xt={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},Yt={enableLogUpload:!1,logFilter:Xt.LOG_FILTER_INFO,enableCloudProxy:!1},ue=Wa(Wa({createInstance:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new ca(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],Or);var r=Object.keys(t).filter((function(e){return!(e in Yt)}));if(0!==r.length)throw new ca("Invalid RTM config: ".concat(r.join(", ")),Or);var i=Wa(Wa({},Yt),t);if(void 0!==n&&(!Array.isArray(n)||0===n.length))throw new ca("Invalid area config");if(null!=n){if(!n.every((function(e){return e in ta.LegacyAreaCode})))throw new ca("Invalid area codes: ".concat(n.filter((function(e){return!(e in ta)})).join(", ")));fa=Ve(n.map((function(e){return dE[e]})))}n=Tl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var o=iE(i);r=jE(i);var s=kE(i),a=lE(n,i),c=Xs(n,i),u=c("RTM:DEBUG","<Entry> ");return Qs.rtmConfig=i,o("The Agora RTM Web SDK version is %s","1.5.1"),t.enableCloudProxy&&o("RTM cloud proxy enabled"),t.enableLogUpload&&o("Log upload enabled"),fa&&u("Area is set to %s",Array.from(fa.CODES).map((function(e){return Yf(S).find((function(t){return S[t]===e}))})).join(", ")),u("Creating an RtmClient instance"),u('The Git commit ID is "'.concat("v1.5.1-0-g5bbbcd72",'"')),u("The App ID is %s",Yn(e,4,10,"*".repeat(6))),o("The process ID is %s",Og),u("The build is %s","v1.5.1-0-g5bbbcd72"),u("NODE_ENV is %s","production"),new wF(e,{genLogger:c,genTracker:a,info:o,warn:r,logError:s,loggerId:n},i,(function(e){for(var t=0,n=Yf(e);t<n.length;t++){var r=n[t];try{var s=e[r];null!=s&&(e.enableCloudProxy&&o("RTM cloud proxy enabled"),e.enableLogUpload&&o("Log upload enabled"),i[r]=s)}catch(e){throw new ca(["The %s in the arguments is invalid",r],void 0)}}}))},BUILD:"v1.5.1-0-g5bbbcd72",VERSION:"1.5.1",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:Og,ConnectionChangeReason:ta.ConnectionChangeReason,ConnectionState:ta.ConnectionState,LocalInvitationFailureReason:ta.LocalInvitationFailureReason,LocalInvitationState:ta.LocalInvitationState,RemoteInvitationFailureReason:ta.RemoteInvitationFailureReason,RemoteInvitationState:ta.RemoteInvitationState,MessageType:ta.MessageType,PeerOnlineState:ta.PeerOnlineState,PeerSubscriptionOption:ta.PeerSubscriptionOption},Xt),{},{setParameter:function(e,t){Object.keys(Ec).includes(e)&&(Ec[e]=t)},getParameter:function(e){return Ec[e]},setArea:function(e){var t=e.areaCodes;if(e=e.excludedArea,!Array.isArray(t)||0===t.length||!t.every((function(e){return e in ta.AreaCode})))throw new ca("Invalid area config");if(void 0!==e&&e===ta.AreaCode.GLOBAL)throw new ca("Excluded area cannot be global");if(void 0===e)fa=Ve(t.map((function(e){return S[e]})));else{if(t.includes(e))throw new ca("Excluded area cannot be in areaCodes");if(!(e in S))throw new ca("Invalid excludedArea:",e);fa=Gv({areas:t.map((function(e){return S[e]})),excludedArea:S[e]})}}});return ue})),"undefined"!=typeof window&&function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Hls=t():e.Hls=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":
/*!*********************************************!*\
  !*** ./node_modules/eventemitter3/index.js ***!
  \*********************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){"use strict";var r=Object.prototype.hasOwnProperty,i="~";function o(){}function s(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,r,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new s(n,r||e,o),c=i?i+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,s=new Array(o);r<o;r++)s[r]=n[r].fn;return s},u.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,r,o,s){var a=i?i+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],A=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),A){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,r),!0;case 5:return l.fn.call(l.context,t,n,r,o),!0;case 6:return l.fn.call(l.context,t,n,r,o,s),!0}for(u=1,c=new Array(A-1);u<A;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var h,d=l.length;for(u=0;u<d;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),A){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,r);break;default:if(!c)for(h=1,c=new Array(A-1);h<A;h++)c[h-1]=arguments[h];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,r){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return c(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||c(this,o);else{for(var a=0,u=[],l=s.length;a<l;a++)(s[a].fn!==t||r&&!s[a].once||n&&s[a].context!==n)&&u.push(s[a]);u.length?this._events[o]=1===u.length?u[0]:u:c(this,o)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&c(this,t)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,e.exports=u},"./node_modules/url-toolkit/src/url-toolkit.js":
/*!*****************************************************!*\
  !*** ./node_modules/url-toolkit/src/url-toolkit.js ***!
  \*****************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){var r,i,o,s,a;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#.*)?$/,i=/^([^\/?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(e,t,n){if(n=n||{},e=e.trim(),!(t=t.trim())){if(!n.alwaysNormalize)return e;var r=a.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=a.normalizePath(r.path),a.buildURLFromParts(r)}var o=a.parseURL(t);if(!o)throw new Error("Error trying to parse relative URL.");if(o.scheme)return n.alwaysNormalize?(o.path=a.normalizePath(o.path),a.buildURLFromParts(o)):t;var s=a.parseURL(e);if(!s)throw new Error("Error trying to parse base URL.");if(!s.netLoc&&s.path&&"/"!==s.path[0]){var c=i.exec(s.path);s.netLoc=c[1],s.path=c[2]}s.netLoc&&!s.path&&(s.path="/");var u={scheme:s.scheme,netLoc:o.netLoc,path:null,params:o.params,query:o.query,fragment:o.fragment};if(!o.netLoc&&(u.netLoc=s.netLoc,"/"!==o.path[0]))if(o.path){var l=s.path,A=l.substring(0,l.lastIndexOf("/")+1)+o.path;u.path=a.normalizePath(A)}else u.path=s.path,o.params||(u.params=s.params,o.query||(u.query=s.query));return null===u.path&&(u.path=n.alwaysNormalize?a.normalizePath(o.path):o.path),a.buildURLFromParts(u)},parseURL:function(e){var t=r.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(o,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}},e.exports=a},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/
/*! no static exports found */
/*! ModuleConcatenation bailout: Module is not an ECMAScript module */function(e,t,n){function r(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n.oe=function(e){throw console.error(e),e};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="[\\.|\\-|\\+|\\w|/|@]+",o="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function a(e,t,r){var a={};a[r]=[];var c=t.toString(),u=c.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!u)return a;for(var l,A=u[1],h=new RegExp("(\\\\n|\\W)"+s(A)+o,"g");l=h.exec(c);)"dll-reference"!==l[3]&&a[r].push(l[3]);for(h=new RegExp("\\("+s(A)+'\\("(dll-reference\\s('+i+'))"\\)\\)'+o,"g");l=h.exec(c);)e[l[2]]||(a[r].push(l[1]),e[l[2]]=n(l[1]).m),a[l[2]]=a[l[2]]||[],a[l[2]].push(l[4]);for(var d,p=Object.keys(a),f=0;f<p.length;f++)for(var g=0;g<a[p[f]].length;g++)d=a[p[f]][g],isNaN(1*d)||(a[p[f]][g]=1*a[p[f]][g]);return a}function c(e){return Object.keys(e).reduce((function(t,n){return t||e[n].length>0}),!1)}e.exports=function(e,t){t=t||{};var i={main:n.m},o=t.all?{main:Object.keys(i.main)}:function(e,t){for(var n={main:[t]},r={main:[]},i={main:{}};c(n);)for(var o=Object.keys(n),s=0;s<o.length;s++){var u=o[s],l=n[u].pop();if(i[u]=i[u]||{},!i[u][l]&&e[u][l]){i[u][l]=!0,r[u]=r[u]||[],r[u].push(l);for(var A=a(e,e[u][l],u),h=Object.keys(A),d=0;d<h.length;d++)n[h[d]]=n[h[d]]||[],n[h[d]]=n[h[d]].concat(A[h[d]])}}return r}(i,e),s="";Object.keys(o).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;o[e][t];)t++;o[e].push(t),i[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+o[e].map((function(t){return JSON.stringify(t)+": "+i[e][t].toString()})).join(",")+"});\n"})),s=s+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+o.main.map((function(e){return JSON.stringify(e)+": "+i.main[e].toString()})).join(",")+"}))(self);";var u=new window.Blob([s],{type:"text/javascript"});if(t.bare)return u;var l=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(u),A=new window.Worker(l);return A.objectURL=l,A}},"./src/crypt/decrypter.js":
/*!********************************************!*\
  !*** ./src/crypt/decrypter.js + 3 modules ***!
  \********************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.ts */function(e,t,n){"use strict";n.r(t);var r=function(){function e(e,t){this.subtle=e,this.aesIV=t}return e.prototype.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),i=function(){function e(e,t){this.subtle=e,this.key=t}return e.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();var o=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),n=new Uint32Array(4),r=0;r<4;r++)n[r]=t.getUint32(4*r);return n},t.initTable=function(){var e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],i=n[1],o=n[2],s=n[3],a=this.invSubMix,c=a[0],u=a[1],l=a[2],A=a[3],h=new Uint32Array(256),d=0,p=0,f=0;for(f=0;f<256;f++)h[f]=f<128?f<<1:f<<1^283;for(f=0;f<256;f++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,e[d]=g,t[g]=d;var m=h[d],v=h[m],y=h[v],_=257*h[g]^16843008*g;r[d]=_<<24|_>>>8,i[d]=_<<16|_>>>16,o[d]=_<<8|_>>>24,s[d]=_,_=16843009*y^65537*v^257*m^16843008*d,c[g]=_<<24|_>>>8,u[g]=_<<16|_>>>16,l[g]=_<<8|_>>>24,A[g]=_,d?(d=m^h[h[h[y^m]]],p^=h[h[p]]):d=p=1}},t.expandKey=function(e){for(var t=this.uint8ArrayToUint32Array_(e),n=!0,r=0;r<t.length&&n;)n=t[r]===this.key[r],r++;if(!n){this.key=t;var i=this.keySize=t.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var o,s,a,c,u=this.ksRows=4*(i+6+1),l=this.keySchedule=new Uint32Array(u),A=this.invKeySchedule=new Uint32Array(u),h=this.sBox,d=this.rcon,p=this.invSubMix,f=p[0],g=p[1],m=p[2],v=p[3];for(o=0;o<u;o++)o<i?a=l[o]=t[o]:(c=a,o%i==0?(c=h[(c=c<<8|c>>>24)>>>24]<<24|h[c>>>16&255]<<16|h[c>>>8&255]<<8|h[255&c],c^=d[o/i|0]<<24):i>6&&o%i==4&&(c=h[c>>>24]<<24|h[c>>>16&255]<<16|h[c>>>8&255]<<8|h[255&c]),l[o]=a=(l[o-i]^c)>>>0);for(s=0;s<u;s++)o=u-s,c=3&s?l[o]:l[o-4],A[s]=s<4||o<=4?c:f[h[c>>>24]]^g[h[c>>>16&255]]^m[h[c>>>8&255]]^v[h[255&c]],A[s]=A[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,n,r){for(var i,o,s,a,c,u,l,A,h,d,p,f,g,m,v,y,_,E=this.keySize+6,b=this.invKeySchedule,w=this.invSBox,S=this.invSubMix,T=S[0],C=S[1],R=S[2],I=S[3],O=this.uint8ArrayToUint32Array_(n),x=O[0],N=O[1],B=O[2],L=O[3],D=new Int32Array(e),M=new Int32Array(D.length),P=this.networkToHostOrderSwap;t<D.length;){for(h=P(D[t]),d=P(D[t+1]),p=P(D[t+2]),f=P(D[t+3]),c=h^b[0],u=f^b[1],l=p^b[2],A=d^b[3],g=4,m=1;m<E;m++)i=T[c>>>24]^C[u>>16&255]^R[l>>8&255]^I[255&A]^b[g],o=T[u>>>24]^C[l>>16&255]^R[A>>8&255]^I[255&c]^b[g+1],s=T[l>>>24]^C[A>>16&255]^R[c>>8&255]^I[255&u]^b[g+2],a=T[A>>>24]^C[c>>16&255]^R[u>>8&255]^I[255&l]^b[g+3],c=i,u=o,l=s,A=a,g+=4;i=w[c>>>24]<<24^w[u>>16&255]<<16^w[l>>8&255]<<8^w[255&A]^b[g],o=w[u>>>24]<<24^w[l>>16&255]<<16^w[A>>8&255]<<8^w[255&c]^b[g+1],s=w[l>>>24]<<24^w[A>>16&255]<<16^w[c>>8&255]<<8^w[255&u]^b[g+2],a=w[A>>>24]<<24^w[c>>16&255]<<16^w[u>>8&255]<<8^w[255&l]^b[g+3],g+=3,M[t]=P(i^x),M[t+1]=P(a^N),M[t+2]=P(s^B),M[t+3]=P(o^L),x=h,N=d,B=p,L=f,t+=4}return r?(v=M.buffer,y=v.byteLength,(_=y&&new DataView(v).getUint8(y-1))?v.slice(0,y-_):v):M.buffer},t.destroy=function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0},e}(),s=n("./src/errors.ts"),a=n("./src/utils/logger.js"),c=n("./src/events.js"),u=n("./src/utils/get-self-scope.js"),l=Object(u.getSelfScope)(),A=function(){function e(e,t,n){var r=(void 0===n?{}:n).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.observer=e,this.config=t,this.removePKCS7Padding=i,i)try{var o=l.crypto;o&&(this.subtle=o.subtle||o.webkitSubtle)}catch(e){}this.disableWebCrypto=!this.subtle}var t=e.prototype;return t.isSync=function(){return this.disableWebCrypto&&this.config.enableSoftwareAES},t.decrypt=function(e,t,n,s){var c=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(a.logger.log("JS AES decrypt"),this.logEnabled=!1);var u=this.decryptor;u||(this.decryptor=u=new o),u.expandKey(t),s(u.decrypt(e,0,n,this.removePKCS7Padding))}else{this.logEnabled&&(a.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var l=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new i(l,t)),this.fastAesKey.expandKey().then((function(i){new r(l,n).decrypt(e,i).catch((function(r){c.onWebCryptoError(r,e,t,n,s)})).then((function(e){s(e)}))})).catch((function(r){c.onWebCryptoError(r,e,t,n,s)}))}},t.onWebCryptoError=function(e,t,n,r,i){this.config.enableSoftwareAES?(a.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,n,r,i)):(a.logger.error("decrypting error : "+e.message),this.observer.trigger(c.default.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))},t.destroy=function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)},e}();t.default=A},"./src/demux/demuxer-inline.js":
/*!**************************************************!*\
  !*** ./src/demux/demuxer-inline.js + 12 modules ***!
  \**************************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/hls.ts */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/hls.ts */function(e,t,n){"use strict";n.r(t);var r=n("./src/events.js"),i=n("./src/errors.ts"),o=n("./src/crypt/decrypter.js"),s=n("./src/polyfills/number.js"),a=n("./src/utils/logger.js"),c=n("./src/utils/get-self-scope.js");function u(e,t){return 255===e[t]&&240==(246&e[t+1])}function l(e,t){return 1&e[t+1]?7:9}function A(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function h(e,t){return!!(t+1<e.length&&u(e,t))}function d(e,t){if(h(e,t)){var n=l(e,t);if(t+n>=e.length)return!1;var r=A(e,t);if(r<=n)return!1;var i=t+r;if(i===e.length||i+1<e.length&&u(e,i))return!0}return!1}function p(e,t,n,o,s){if(!e.samplerate){var c=function(e,t,n,o){var s,c,u,l,A,h=navigator.userAgent.toLowerCase(),d=o,p=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];if(s=1+((192&t[n+2])>>>6),!((c=(60&t[n+2])>>>2)>p.length-1))return l=(1&t[n+2])<<2,l|=(192&t[n+3])>>>6,a.logger.log("manifest codec:"+o+",ADTS data:type:"+s+",sampleingIndex:"+c+"["+p[c]+"Hz],channelConfig:"+l),/firefox/i.test(h)?c>=6?(s=5,A=new Array(4),u=c-3):(s=2,A=new Array(2),u=c):-1!==h.indexOf("android")?(s=2,A=new Array(2),u=c):(s=5,A=new Array(4),o&&(-1!==o.indexOf("mp4a.40.29")||-1!==o.indexOf("mp4a.40.5"))||!o&&c>=6?u=c-3:((o&&-1!==o.indexOf("mp4a.40.2")&&(c>=6&&1===l||/vivaldi/i.test(h))||!o&&1===l)&&(s=2,A=new Array(2)),u=c)),A[0]=s<<3,A[0]|=(14&c)>>1,A[1]|=(1&c)<<7,A[1]|=l<<3,5===s&&(A[1]|=(14&u)>>1,A[2]=(1&u)<<7,A[2]|=8,A[3]=0),{config:A,samplerate:p[c],channelCount:l,codec:"mp4a.40."+s,manifestCodec:d};e.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+c})}(t,n,o,s);e.config=c.config,e.samplerate=c.samplerate,e.channelCount=c.channelCount,e.codec=c.codec,e.manifestCodec=c.manifestCodec,a.logger.log("parsed codec:"+e.codec+",rate:"+c.samplerate+",nb channel:"+c.channelCount)}}function f(e){return 9216e4/e}function g(e,t,n,r,i){var o=function(e,t,n,r,i){var o,s,a=e.length;if(o=l(e,t),s=A(e,t),(s-=o)>0&&t+o+s<=a)return{headerLength:o,frameLength:s,stamp:n+r*i}}(t,n,r,i,f(e.samplerate));if(o){var s=o.stamp,a=o.headerLength,c=o.frameLength,u={unit:t.subarray(n+a,n+a+c),pts:s,dts:s};return e.samples.push(u),{sample:u,length:c+a}}}var m=n("./src/demux/id3.js"),v=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/adts",type:"audio",id:0,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){if(!e)return!1;for(var t=(m.default.getID3Data(e,0)||[]).length,n=e.length;t<n;t++)if(d(e,t))return a.logger.log("ADTS sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=this._audioTrack,o=m.default.getID3Data(e,0)||[],c=m.default.getTimeStamp(o),u=Object(s.isFiniteNumber)(c)?90*c:9e4*t,l=0,A=u,d=e.length,f=o.length,v=[{pts:A,dts:A,data:o}];f<d-1;)if(h(e,f)&&f+5<d){p(i,this.observer,e,f,i.manifestCodec);var y=g(i,e,f,u,l);if(!y){a.logger.log("Unable to parse AAC frame");break}f+=y.length,A=y.sample.pts,l++}else m.default.isHeader(e,f)?(o=m.default.getID3Data(e,f),v.push({pts:A,dts:A,data:o}),f+=o.length):f++;this.remuxer.remux(i,{samples:[]},{samples:v,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),y=n("./src/demux/mp4demuxer.js"),_={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients:[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot:[0,1,1,4],appendFrame:function(e,t,n,r,i){if(!(n+24>t.length)){var o=this.parseHeader(t,n);if(o&&n+o.frameLength<=t.length){var s=r+i*(9e4*o.samplesPerFrame/o.sampleRate),a={unit:t.subarray(n,n+o.frameLength),pts:s,dts:s};return e.config=[],e.channelCount=o.channelCount,e.samplerate=o.sampleRate,e.samples.push(a),{sample:a,length:o.frameLength}}}},parseHeader:function(e,t){var n=e[t+1]>>3&3,r=e[t+1]>>1&3,i=e[t+2]>>4&15,o=e[t+2]>>2&3,s=e[t+2]>>1&1;if(1!==n&&0!==i&&15!==i&&3!==o){var a=3===n?3-r:3===r?3:4,c=1e3*_.BitratesMap[14*a+i-1],u=3===n?0:2===n?1:2,l=_.SamplingRateMap[3*u+o],A=e[t+3]>>6==3?1:2,h=_.SamplesCoefficients[n][r],d=_.BytesInSlot[r],p=8*h*d;return{sampleRate:l,channelCount:A,frameLength:parseInt(h*c/l+s,10)*d,samplesPerFrame:p}}},isHeaderPattern:function(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])},isHeader:function(e,t){return!!(t+1<e.length&&this.isHeaderPattern(e,t))},probe:function(e,t){if(t+1<e.length&&this.isHeaderPattern(e,t)){var n=this.parseHeader(e,t),r=4;n&&n.frameLength&&(r=n.frameLength);var i=t+r;if(i===e.length||i+1<e.length&&this.isHeaderPattern(e,i))return!0}return!1}},E=_,b=function(){function e(e){this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),i=Math.min(4,t);if(0===i)throw new Error("no bytes available");r.set(e.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},t.skipBits=function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,e-=(t=e>>3)>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),n=this.word>>>32-t;return e>32&&a.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),(t=e-t)>0&&this.bitsAvailable?n<<t|this.readBits(t):n},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){var t,n=8,r=8;for(t=0;t<e;t++)0!==r&&(r=(n+this.readEG()+256)%256),n=0===r?n:r},t.readSPS=function(){var e,t,n,r,i,o,s,a=0,c=0,u=0,l=0,A=this.readUByte.bind(this),h=this.readBits.bind(this),d=this.readUEG.bind(this),p=this.readBoolean.bind(this),f=this.skipBits.bind(this),g=this.skipEG.bind(this),m=this.skipUEG.bind(this),v=this.skipScalingList.bind(this);if(A(),e=A(),h(5),f(3),A(),m(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var y=d();if(3===y&&f(1),m(),m(),f(1),p())for(o=3!==y?8:12,s=0;s<o;s++)p()&&v(s<6?16:64)}m();var _=d();if(0===_)d();else if(1===_)for(f(1),g(),g(),t=d(),s=0;s<t;s++)g();m(),f(1),n=d(),r=d(),0===(i=h(1))&&f(1),f(1),p()&&(a=d(),c=d(),u=d(),l=d());var E=[1,1];if(p()&&p())switch(A()){case 1:E=[1,1];break;case 2:E=[12,11];break;case 3:E=[10,11];break;case 4:E=[16,11];break;case 5:E=[40,33];break;case 6:E=[24,11];break;case 7:E=[20,11];break;case 8:E=[32,11];break;case 9:E=[80,33];break;case 10:E=[18,11];break;case 11:E=[15,11];break;case 12:E=[64,33];break;case 13:E=[160,99];break;case 14:E=[4,3];break;case 15:E=[3,2];break;case 16:E=[2,1];break;case 255:E=[A()<<8|A(),A()<<8|A()]}return{width:Math.ceil(16*(n+1)-2*a-2*c),height:(2-i)*(r+1)*16-(i?2:4)*(u+l),pixelRatio:E}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),w=function(){function e(e,t,n,r){this.decryptdata=n,this.discardEPB=r,this.decrypter=new o.default(e,t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)},t.decryptAacSample=function(e,t,n,r){var i=e[t].unit,o=i.subarray(16,i.length-i.length%16),s=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),a=this;this.decryptBuffer(s,(function(o){o=new Uint8Array(o),i.set(o,16),r||a.decryptAacSamples(e,t+1,n)}))},t.decryptAacSamples=function(e,t,n){for(;;t++){if(t>=e.length)return void n();if(!(e[t].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(e,t,n,r),!r)return}}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,n=new Int8Array(t),r=0,i=32;i<=e.length-16;i+=160,r+=16)n.set(e.subarray(i,i+16),r);return n},t.getAvcDecryptedUnit=function(e,t){t=new Uint8Array(t);for(var n=0,r=32;r<=e.length-16;r+=160,n+=16)e.set(t.subarray(n,n+16),r);return e},t.decryptAvcSample=function(e,t,n,r,i,o){var s=this.discardEPB(i.data),a=this.getAvcEncryptedData(s),c=this;this.decryptBuffer(a.buffer,(function(a){i.data=c.getAvcDecryptedUnit(s,a),o||c.decryptAvcSamples(e,t,n+1,r)}))},t.decryptAvcSamples=function(e,t,n,r){for(;;t++,n=0){if(t>=e.length)return void r();for(var i=e[t].units;!(n>=i.length);n++){var o=i[n];if(!(o.length<=48||1!==o.type&&5!==o.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,n,r,o,s),!s)return}}}},e}(),S={video:1,audio:2,id3:3,text:4},T=function(){function e(e,t,n,r){this.observer=e,this.config=n,this.typeSupported=r,this.remuxer=t,this.sampleAes=null,this.pmtUnknownTypes={}}var t=e.prototype;return t.setDecryptData=function(e){null!=e&&null!=e.key&&"SAMPLE-AES"===e.method?this.sampleAes=new w(this.observer,this.config,e,this.discardEPB):this.sampleAes=null},e.probe=function(t){var n=e._syncOffset(t);return!(n<0)&&(n&&a.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),!0)},e._syncOffset=function(e){for(var t=Math.min(1e3,e.length-564),n=0;n<t;){if(71===e[n]&&71===e[n+188]&&71===e[n+376])return n;n++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:S[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:"video"===e?0:void 0,isAAC:"audio"===e||void 0,duration:"audio"===e?t:void 0}},t.resetInitSegment=function(t,n,r,i){this.pmtParsed=!1,this._pmtId=-1,this.pmtUnknownTypes={},this._avcTrack=e.createTrack("video",i),this._audioTrack=e.createTrack("audio",i),this._id3Track=e.createTrack("id3",i),this._txtTrack=e.createTrack("text",i),this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=n,this.videoCodec=r,this._duration=i},t.resetTimeStamp=function(){},t.append=function(t,n,o,s){var c,u,l,A,h,d=t.length,p=!1;this.pmtUnknownTypes={},this.contiguous=o;var f=this.pmtParsed,g=this._avcTrack,m=this._audioTrack,v=this._id3Track,y=g.pid,_=m.pid,E=v.pid,b=this._pmtId,w=g.pesData,S=m.pesData,T=v.pesData,C=this._parsePAT,R=this._parsePMT.bind(this),I=this._parsePES,O=this._parseAVCPES.bind(this),x=this._parseAACPES.bind(this),N=this._parseMPEGPES.bind(this),B=this._parseID3PES.bind(this),L=e._syncOffset(t);for(d-=(d+L)%188,c=L;c<d;c+=188)if(71===t[c]){if(u=!!(64&t[c+1]),l=((31&t[c+1])<<8)+t[c+2],(48&t[c+3])>>4>1){if((A=c+5+t[c+4])===c+188)continue}else A=c+4;switch(l){case y:u&&(w&&(h=I(w))&&O(h,!1),w={data:[],size:0}),w&&(w.data.push(t.subarray(A,c+188)),w.size+=c+188-A);break;case _:u&&(S&&(h=I(S))&&(m.isAAC?x(h):N(h)),S={data:[],size:0}),S&&(S.data.push(t.subarray(A,c+188)),S.size+=c+188-A);break;case E:u&&(T&&(h=I(T))&&B(h),T={data:[],size:0}),T&&(T.data.push(t.subarray(A,c+188)),T.size+=c+188-A);break;case 0:u&&(A+=t[A]+1),b=this._pmtId=C(t,A);break;case b:u&&(A+=t[A]+1);var D=R(t,A,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);(y=D.avc)>0&&(g.pid=y),(_=D.audio)>0&&(m.pid=_,m.isAAC=D.isAAC),(E=D.id3)>0&&(v.pid=E),p&&!f&&(a.logger.log("reparse from beginning"),p=!1,c=L-188),f=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=!0}}else this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});w&&(h=I(w))?(O(h,!0),g.pesData=null):g.pesData=w,S&&(h=I(S))?(m.isAAC?x(h):N(h),m.pesData=null):(S&&S.size&&a.logger.log("last AAC PES packet truncated,might overlap between fragments"),m.pesData=S),T&&(h=I(T))?(B(h),v.pesData=null):v.pesData=T,null==this.sampleAes?this.remuxer.remux(m,g,v,this._txtTrack,n,o,s):this.decryptAndRemux(m,g,v,this._txtTrack,n,o,s)},t.decryptAndRemux=function(e,t,n,r,i,o,s){if(e.samples&&e.isAAC){var a=this;this.sampleAes.decryptAacSamples(e.samples,0,(function(){a.decryptAndRemuxAvc(e,t,n,r,i,o,s)}))}else this.decryptAndRemuxAvc(e,t,n,r,i,o,s)},t.decryptAndRemuxAvc=function(e,t,n,r,i,o,s){if(t.samples){var a=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,(function(){a.remuxer.remux(e,t,n,r,i,o,s)}))}else this.remuxer.remux(e,t,n,r,i,o,s)},t.destroy=function(){this._initPTS=this._initDTS=void 0,this._duration=0},t._parsePAT=function(e,t){return(31&e[t+10])<<8|e[t+11]},t._trackUnknownPmt=function(e,t,n){var r=this.pmtUnknownTypes[e]||0;return 0===r&&(this.pmtUnknownTypes[e]=0,t.call(a.logger,n)),this.pmtUnknownTypes[e]++,r},t._parsePMT=function(e,t,n,r){var i,o,s={audio:-1,avc:-1,id3:-1,isAAC:!0};for(i=t+3+((15&e[t+1])<<8|e[t+2])-4,t+=12+((15&e[t+10])<<8|e[t+11]);t<i;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!r){this._trackUnknownPmt(e[t],a.logger.warn,"ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===s.audio&&(s.audio=o);break;case 21:-1===s.id3&&(s.id3=o);break;case 219:if(!r){this._trackUnknownPmt(e[t],a.logger.warn,"H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===s.avc&&(s.avc=o);break;case 3:case 4:n?-1===s.audio&&(s.audio=o,s.isAAC=!1):this._trackUnknownPmt(e[t],a.logger.warn,"MPEG audio found, not supported in this browser");break;case 36:this._trackUnknownPmt(e[t],a.logger.warn,"Unsupported HEVC stream type found");break;default:this._trackUnknownPmt(e[t],a.logger.log,"Unknown stream type:"+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return s},t._parsePES=function(e){var t,n,r,i,o,s,c,u,l=0,A=e.data;if(!e||0===e.size)return null;for(;A[0].length<19&&A.length>1;){var h=new Uint8Array(A[0].length+A[1].length);h.set(A[0]),h.set(A[1],A[0].length),A[0]=h,A.splice(1,1)}if(1===((t=A[0])[0]<<16)+(t[1]<<8)+t[2]){if((r=(t[4]<<8)+t[5])&&r>e.size-6)return null;if(192&(n=t[7])&&(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&n?s-(c=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2)>54e5&&(a.logger.warn(Math.round((s-c)/9e4)+"s delta between PTS and DTS, align them"),s=c):c=s),u=(i=t[8])+9,e.size<=u)return null;e.size-=u,o=new Uint8Array(e.size);for(var d=0,p=A.length;d<p;d++){var f=(t=A[d]).byteLength;if(u){if(u>f){u-=f;continue}t=t.subarray(u),f-=u,u=0}o.set(t,l),l+=f}return r&&(r-=i+3),{data:o,pts:s,dts:c,len:r}}return null},t.pushAccesUnit=function(e,t){if(e.units.length&&e.frame){var n=t.samples,r=n.length;if(isNaN(e.pts)){if(!r)return void t.dropped++;var i=n[r-1];e.pts=i.pts,e.dts=i.dts}!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(r||this.contiguous)?(e.id=r,n.push(e)):t.dropped++}e.debug.length&&a.logger.log(e.pts+"/"+e.dts+":"+e.debug)},t._parseAVCPES=function(e,t){var n,r,i,o=this,s=this._avcTrack,a=this._parseAVCNALu(e.data),c=this.avcSample,u=!1,l=this.pushAccesUnit.bind(this),A=function(e,t,n,r){return{key:e,pts:t,dts:n,units:[],debug:r}};e.data=null,c&&a.length&&!s.audFound&&(l(c,s),c=this.avcSample=A(!1,e.pts,e.dts,"")),a.forEach((function(t){switch(t.type){case 1:r=!0,c||(c=o.avcSample=A(!0,e.pts,e.dts,"")),c.frame=!0;var a=t.data;if(u&&a.length>4){var h=new b(a).readSliceType();2!==h&&4!==h&&7!==h&&9!==h||(c.key=!0)}break;case 5:r=!0,c||(c=o.avcSample=A(!0,e.pts,e.dts,"")),c.key=!0,c.frame=!0;break;case 6:r=!0,(n=new b(o.discardEPB(t.data))).readUByte();for(var d=0,p=0,f=!1,g=0;!f&&n.bytesAvailable>1;){d=0;do{d+=g=n.readUByte()}while(255===g);p=0;do{p+=g=n.readUByte()}while(255===g);if(4===d&&0!==n.bytesAvailable){if(f=!0,181===n.readUByte())if(49===n.readUShort())if(1195456820===n.readUInt())if(3===n.readUByte()){var v=n.readUByte(),y=31&v,_=[v,n.readUByte()];for(i=0;i<y;i++)_.push(n.readUByte()),_.push(n.readUByte()),_.push(n.readUByte());o._insertSampleInOrder(o._txtTrack.samples,{type:3,pts:e.pts,bytes:_})}}else if(5===d&&0!==n.bytesAvailable){if(f=!0,p>16){var E=[];for(i=0;i<16;i++)E.push(n.readUByte().toString(16)),3!==i&&5!==i&&7!==i&&9!==i||E.push("-");var w=p-16,S=new Uint8Array(w);for(i=0;i<w;i++)S[i]=n.readUByte();o._insertSampleInOrder(o._txtTrack.samples,{pts:e.pts,payloadType:d,uuid:E.join(""),userDataBytes:S,userData:Object(m.utf8ArrayToStr)(S.buffer)})}}else if(p<n.bytesAvailable)for(i=0;i<p;i++)n.readUByte()}break;case 7:if(r=!0,u=!0,!s.sps){var T=(n=new b(t.data)).readSPS();s.width=T.width,s.height=T.height,s.pixelRatio=T.pixelRatio,s.sps=[t.data],s.duration=o._duration;var C=t.data.subarray(1,4),R="avc1.";for(i=0;i<3;i++){var I=C[i].toString(16);I.length<2&&(I="0"+I),R+=I}s.codec=R}break;case 8:r=!0,s.pps||(s.pps=[t.data]);break;case 9:r=!1,s.audFound=!0,c&&l(c,s),c=o.avcSample=A(!1,e.pts,e.dts,"");break;case 12:r=!1;break;default:r=!1,c&&(c.debug+="unknown NAL "+t.type+" ")}c&&r&&c.units.push(t)})),t&&c&&(l(c,s),this.avcSample=null)},t._insertSampleInOrder=function(e,t){var n=e.length;if(n>0){if(t.pts>=e[n-1].pts)e.push(t);else for(var r=n-1;r>=0;r--)if(t.pts<e[r].pts){e.splice(r,0,t);break}}else e.push(t)},t._getLastNalUnit=function(){var e,t=this.avcSample;if(!t||0===t.units.length){var n=this._avcTrack.samples;t=n[n.length-1]}if(t){var r=t.units;e=r[r.length-1]}return e},t._parseAVCNALu=function(e){var t,n,r,i,o=0,s=e.byteLength,a=this._avcTrack,c=a.naluState||0,u=c,l=[],A=-1;for(-1===c&&(A=0,i=31&e[0],c=0,o=1);o<s;)if(t=e[o++],c)if(1!==c)if(t)if(1===t){if(A>=0)r={data:e.subarray(A,o-c-1),type:i},l.push(r);else{var h=this._getLastNalUnit();if(h&&(u&&o<=4-u&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-u)),(n=o-c-1)>0)){var d=new Uint8Array(h.data.byteLength+n);d.set(h.data,0),d.set(e.subarray(0,n),h.data.byteLength),h.data=d}}o<s?(A=o,i=31&e[o],c=0):c=-1}else c=0;else c=3;else c=t?0:2;else c=t?0:1;if(A>=0&&c>=0&&(r={data:e.subarray(A,s),type:i,state:c},l.push(r)),0===l.length){var p=this._getLastNalUnit();if(p){var f=new Uint8Array(p.data.byteLength+e.byteLength);f.set(p.data,0),f.set(e,p.data.byteLength),p.data=f}}return a.naluState=c,l},t.discardEPB=function(e){for(var t,n,r=e.byteLength,i=[],o=1;o<r-2;)0===e[o]&&0===e[o+1]&&3===e[o+2]?(i.push(o+2),o+=2):o++;if(0===i.length)return e;t=r-i.length,n=new Uint8Array(t);var s=0;for(o=0;o<t;s++,o++)s===i[0]&&(s++,i.shift()),n[o]=e[s];return n},t._parseAACPES=function(e){var t,n,o,s,c,u,l,A=this._audioTrack,d=e.data,m=e.pts,v=this.aacOverFlow,y=this.aacLastPTS;if(v){var _=new Uint8Array(v.byteLength+d.byteLength);_.set(v,0),_.set(d,v.byteLength),d=_}for(o=0,c=d.length;o<c-1&&!h(d,o);o++);if(o&&(o<c-1?(u="AAC PES did not start with ADTS header,offset:"+o,l=!1):(u="no ADTS header found in AAC PES",l=!0),a.logger.warn("parsing error:"+u),this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:l,reason:u}),l))return;if(p(A,this.observer,d,o,this.audioCodec),n=0,t=f(A.samplerate),v&&y){var E=y+t;Math.abs(E-m)>1&&(a.logger.log("AAC: align PTS for overlapping frames by "+Math.round((E-m)/90)),m=E)}for(;o<c;){if(h(d,o)){if(o+5<c){var b=g(A,d,o,m,n);if(b){o+=b.length,s=b.sample.pts,n++;continue}}break}o++}v=o<c?d.subarray(o,c):null,this.aacOverFlow=v,this.aacLastPTS=s},t._parseMPEGPES=function(e){for(var t=e.data,n=t.length,r=0,i=0,o=e.pts;i<n;)if(E.isHeader(t,i)){var s=E.appendFrame(this._audioTrack,t,i,o,r);if(!s)break;i+=s.length,r++}else i++},t._parseID3PES=function(e){this._id3Track.samples.push(e)},e}(),C=function(){function e(e,t,n){this.observer=e,this.config=n,this.remuxer=t}var t=e.prototype;return t.resetInitSegment=function(e,t,n,r){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:r,inputTimeScale:9e4}},t.resetTimeStamp=function(){},e.probe=function(e){var t,n,r=m.default.getID3Data(e,0);if(r&&void 0!==m.default.getTimeStamp(r))for(t=r.length,n=Math.min(e.length-1,t+100);t<n;t++)if(E.probe(e,t))return a.logger.log("MPEG Audio sync word found !"),!0;return!1},t.append=function(e,t,n,r){for(var i=m.default.getID3Data(e,0)||[],o=m.default.getTimeStamp(i),s=void 0!==o?90*o:9e4*t,a=i.length,c=e.length,u=0,l=0,A=this._audioTrack,h=[{pts:s,dts:s,data:i}];a<c;)if(E.isHeader(e,a)){var d=E.appendFrame(A,e,a,s,u);if(!d)break;a+=d.length,l=d.sample.pts,u++}else m.default.isHeader(e,a)?(i=m.default.getID3Data(e,a),h.push({pts:l,dts:l,data:i}),a+=i.length):a++;this.remuxer.remux(A,{samples:[]},{samples:h,inputTimeScale:9e4},{samples:[]},t,n,r)},t.destroy=function(){},e}(),R=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}(),I=Math.pow(2,32)-1,O=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,c,s,a),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,i))},e.box=function(e){for(var t,n=Array.prototype.slice.call(arguments,1),r=8,i=n.length,o=i;i--;)r+=n[i].byteLength;for((t=new Uint8Array(r))[0]=r>>24&255,t[1]=r>>16&255,t[2]=r>>8&255,t[3]=255&r,t.set(e,4),i=0,r=8;i<o;i++)t.set(n[i],r),r+=n[i].byteLength;return t},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,n){n*=t;var r=Math.floor(n/(I+1)),i=Math.floor(n%(I+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,n,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,n))},e.moov=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trak(t[n]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(r).concat(e.mvex(t)))},e.mvex=function(t){for(var n=t.length,r=[];n--;)r[n]=e.trex(t[n]);return e.box.apply(null,[e.types.mvex].concat(r))},e.mvhd=function(t,n){n*=t;var r=Math.floor(n/(I+1)),i=Math.floor(n%(I+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,o)},e.sdtp=function(t){var n,r,i=t.samples||[],o=new Uint8Array(4+i.length);for(r=0;r<i.length;r++)n=i[r].flags,o[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,o)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var n,r,i,o=[],s=[];for(n=0;n<t.sps.length;n++)i=(r=t.sps[n]).byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));for(n=0;n<t.pps.length;n++)i=(r=t.pps[n]).byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(r));var a=e.box(e.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|t.sps.length].concat(o).concat([t.pps.length]).concat(s))),c=t.width,u=t.height,l=t.pixelRatio[0],A=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,255&c,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([l>>24,l>>16&255,l>>8&255,255&l,A>>24,A>>16&255,A>>8&255,255&A])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var n=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var n=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},e.stsd=function(t){return"audio"===t.type?t.isAAC||"mp3"!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var n=t.id,r=t.duration*t.timescale,i=t.width,o=t.height,s=Math.floor(r/(I+1)),a=Math.floor(r%(I+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,255&i,0,0,o>>8&255,255&o,0,0]))},e.traf=function(t,n){var r=e.sdtp(t),i=t.id,o=Math.floor(n/(I+1)),s=Math.floor(n%(I+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,r.length+16+20+8+16+8+8),r)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var n=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,n){var r,i,o,s,a,c,u=t.samples||[],l=u.length,A=12+16*l,h=new Uint8Array(A);for(n+=8+A,h.set([0,0,15,1,l>>>24&255,l>>>16&255,l>>>8&255,255&l,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<l;r++)o=(i=u[r]).duration,s=i.size,a=i.flags,c=i.cts,h.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,s>>>24&255,s>>>16&255,s>>>8&255,255&s,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*r);return e.box(e.types.trun,h)},e.initSegment=function(t){e.types||e.init();var n,r=e.moov(t);return(n=new Uint8Array(e.FTYP.byteLength+r.byteLength)).set(e.FTYP),n.set(r,e.FTYP.byteLength),n},e}(),x=O;function N(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=!1);var i=e*t*n;return r?Math.round(i):i}function B(e,t){return void 0===t&&(t=!1),N(e,1e3,1/9e4,t)}function L(e,t){return void 0===t&&(t=1),N(e,9e4,1/t)}var D=L(10),M=L(.2),P=null;function k(e,t){var n;if(void 0===t)return e;for(n=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=n;return e}var U,F=function(){function e(e,t,n,r){if(this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,null===P){var i=navigator.userAgent.match(/Chrome\/(\d+)/i);P=i?parseInt(i[1]):0}}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this._initPTS=this._initDTS=e},t.resetInitSegment=function(){this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,n=e.reduce((function(e,n){var r=n.pts-e;return r<-4294967296?(t=!0,e):r>0?e:n.pts}),e[0].pts);return t&&a.logger.debug("PTS rollover detected"),n},t.remux=function(e,t,n,i,o,s,c){if(this.ISGenerated||this.generateIS(e,t,o),this.ISGenerated){var u=e.samples.length,l=t.samples.length,A=o,h=o;if(u&&l){var d=this.getVideoStartPts(t.samples),p=(e.samples[0].pts-d)/t.inputTimeScale;A+=Math.max(0,p),h+=Math.max(0,-p)}if(u){e.timescale||(a.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(e,t,o));var f,g=this.remuxAudio(e,A,s,c);if(l)g&&(f=g.endPTS-g.startPTS),t.timescale||(a.logger.warn("regenerate InitSegment as video detected"),this.generateIS(e,t,o)),this.remuxVideo(t,h,s,f)}else if(l){var m=this.remuxVideo(t,h,s,0,c);m&&e.codec&&this.remuxEmptyAudio(e,A,s,m)}}n.samples.length&&this.remuxID3(n,o),i.samples.length&&this.remuxText(i,o),this.observer.trigger(r.default.FRAG_PARSED)},t.generateIS=function(e,t,n){var o,s,c=this.observer,u=e.samples,l=t.samples,A=this.typeSupported,h="audio/mp4",d={},p={tracks:d},f=void 0===this._initPTS;if(f&&(o=s=1/0),e.config&&u.length&&(e.timescale=e.samplerate,a.logger.log("audio sampling rate : "+e.samplerate),e.isAAC||(A.mpeg?(h="audio/mpeg",e.codec=""):A.mp3&&(e.codec="mp3")),d.audio={container:h,codec:e.codec,initSegment:!e.isAAC&&A.mpeg?new Uint8Array:x.initSegment([e]),metadata:{channelCount:e.channelCount}},f&&(o=s=u[0].pts-Math.round(e.inputTimeScale*n))),t.sps&&t.pps&&l.length){var g=t.inputTimeScale;if(t.timescale=g,d.video={container:"video/mp4",codec:t.codec,initSegment:x.initSegment([t]),metadata:{width:t.width,height:t.height}},f){var m=this.getVideoStartPts(l),v=Math.round(g*n);s=Math.min(s,l[0].dts-v),o=Math.min(o,m-v),this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:o})}}else f&&d.audio&&this.observer.trigger(r.default.INIT_PTS_FOUND,{initPTS:o});Object.keys(d).length?(c.trigger(r.default.FRAG_PARSING_INIT_SEGMENT,p),this.ISGenerated=!0,f&&(this._initPTS=o,this._initDTS=s)):c.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})},t.remuxVideo=function(e,t,n,o){var s,c,u,l,A,h=e.timescale,d=e.samples,p=[],f=d.length,g=this._initPTS,m=8,v=Number.POSITIVE_INFINITY,y=Number.NEGATIVE_INFINITY,_=0,E=!1,b=this.nextAvcDts;if(0!==f){if(!n)b=t*h-(d[0].pts-k(d[0].dts,d[0].pts));for(var w=0;w<f;w++){var S=d[w];S.pts=k(S.pts-g,b),S.dts=k(S.dts-g,b),S.dts>S.pts&&(_=Math.max(Math.min(_,S.pts-S.dts),-1*M)),S.dts<d[w>0?w-1:w].dts&&(E=!0)}E&&d.sort((function(e,t){var n=e.dts-t.dts,r=e.pts-t.pts;return n||r||e.id-t.id})),l=d[0].dts,A=d[f-1].dts;var T=Math.round((A-l)/(f-1));if(_<0){if(_<-2*T){a.logger.warn("PTS < DTS detected in video samples, offsetting DTS to PTS "+B(-T,!0)+" ms");for(var C=0;C<f;C++)d[C].dts=d[C].pts-T}else{a.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+B(_,!0)+" ms to overcome this issue");for(var R=0;R<f;R++)d[R].dts=d[R].dts+_}l=d[0].dts,A=d[f-1].dts}if(n){var I=l-b,O=I>T;if(O||I<-1){O?a.logger.warn("AVC: "+B(I,!0)+" ms ("+I+"dts) hole between fragments detected, filling it"):a.logger.warn("AVC: "+B(-I,!0)+" ms ("+I+"dts) overlapping between fragments detected"),l=b;var N=d[0].pts-I;d[0].dts=l,d[0].pts=N,a.logger.log("Video: First PTS/DTS adjusted: "+B(N,!0)+"/"+B(l,!0)+", delta: "+B(I,!0)+" ms")}}P&&P<75&&(l=Math.max(0,l));for(var L=0,D=0,U=0;U<f;U++){for(var F=d[U],H=F.units,V=H.length,Q=0,j=0;j<V;j++)Q+=H[j].data.length;D+=Q,L+=V,F.length=Q,F.dts=Math.max(F.dts,l),F.pts=Math.max(F.pts,F.dts,0),v=Math.min(F.pts,v),y=Math.max(F.pts,y)}A=d[f-1].dts;var G=D+4*L+8;try{c=new Uint8Array(G)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:G,reason:"fail allocating video mdat "+G})}var K=new DataView(c.buffer);K.setUint32(0,G),c.set(x.types.mdat,4);for(var W=0;W<f;W++){for(var z,q=d[W],Y=q.units,X=0,J=0,Z=Y.length;J<Z;J++){var $=Y[J],ee=$.data,te=$.data.byteLength;K.setUint32(m,te),m+=4,c.set(ee,m),m+=te,X+=4+te}if(W<f-1)s=d[W+1].dts-q.dts;else{var ne=this.config,re=q.dts-d[W>0?W-1:W].dts;if(ne.stretchShortVideoTrack){var ie=ne.maxBufferHole,oe=Math.floor(ie*h),se=(o?v+o*h:this.nextAudioPts)-q.pts;se>oe?((s=se-re)<0&&(s=re),a.logger.log("It is approximately "+B(se,!1)+" ms to the next segment; using duration "+B(s,!1)+" ms for the last video frame.")):s=re}else s=re}z=Math.round(q.pts-q.dts),p.push({size:X,duration:s,cts:z,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:q.key?2:1,isNonSync:q.key?0:1}})}this.nextAvcDts=A+s;var ae=e.dropped;if(e.nbNalu=0,e.dropped=0,p.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ce=p[0].flags;ce.dependsOn=2,ce.isNonSync=0}e.samples=p,u=x.moof(e.sequenceNumber++,l,e),e.samples=[];var ue={data1:u,data2:c,startPTS:v/h,endPTS:(y+s)/h,startDTS:l/h,endDTS:this.nextAvcDts/h,type:"video",hasAudio:!1,hasVideo:!0,nb:p.length,dropped:ae};return this.observer.trigger(r.default.FRAG_PARSING_DATA,ue),ue}},t.remuxAudio=function(e,t,n,o){var s,c,u,l,A,h,d=e.inputTimeScale,p=e.timescale,f=d/p,g=(e.isAAC?1024:1152)*f,m=this._initPTS,v=!e.isAAC&&this.typeSupported.mpeg,y=v?0:8,_=e.samples,E=[],b=this.nextAudioPts;if(n|=_.length&&b&&(o&&Math.abs(t-b/d)<.1||Math.abs(_[0].pts-b-m)<20*g),_.forEach((function(e){e.pts=e.dts=k(e.pts-m,t*d)})),_=_.filter((function(e){return e.pts>=0})),0!==_.length){if(n||(b=o?Math.max(0,t*d):_[0].pts),e.isAAC)for(var w=this.config.maxAudioFramesDrift,S=0,T=b;S<_.length;){var C=_[S],I=C.pts,O=I-T;if(O<=-w*g)n||S>0?(a.logger.warn("Dropping 1 audio frame @ "+B(T,!0)/1e3+"s due to "+B(O,!0)+" ms overlap."),_.splice(S,1)):(a.logger.warn("Audio frame @ "+B(I,!0)/1e3+"s overlaps nextAudioPts by "+B(O,!0)+" ms."),T=I+g,S++);else if(O>=w*g&&O<D&&T){var N=Math.round(O/g);a.logger.warn("Injecting "+N+" audio frames @ "+B(T,!0)/1e3+"s due to "+B(O,!0)+" ms gap.");for(var L=0;L<N;L++){var M=Math.max(T,0);(c=R.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(a.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),c=C.unit.subarray()),_.splice(S,0,{unit:c,pts:M,dts:M}),T+=g,S++}C.pts=C.dts=T,T+=g,S++}else Math.abs(O),C.pts=C.dts=T,T+=g,S++}for(var P=_.length,U=0;P--;)U+=_[P].unit.byteLength;for(var F=0,H=_.length;F<H;F++){var V=_[F],Q=V.unit,j=V.pts;if(void 0!==h&&s)s.duration=Math.round((j-h)/f);else{var G=j-b,K=0;if(n&&e.isAAC&&G){if(G>0&&G<D)K=Math.round((j-b)/g),a.logger.log(B(G,!0)+" ms hole between AAC samples detected,filling it"),K>0&&((c=R.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(c=Q.subarray()),U+=K*c.length);else if(G<-12){a.logger.log("drop overlapping AAC sample, expected/parsed/delta: "+B(b,!0)+" ms / "+B(j,!0)+" ms / "+B(-G,!0)+" ms"),U-=Q.byteLength;continue}j=b}if(A=j,!(U>0))return;U+=y;try{u=new Uint8Array(U)}catch(e){return void this.observer.trigger(r.default.ERROR,{type:i.ErrorTypes.MUX_ERROR,details:i.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating audio mdat "+U})}v||(new DataView(u.buffer).setUint32(0,U),u.set(x.types.mdat,4));for(var W=0;W<K;W++)(c=R.getSilentFrame(e.manifestCodec||e.codec,e.channelCount))||(a.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),c=Q.subarray()),u.set(c,y),y+=c.byteLength,s={size:c.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(s)}u.set(Q,y);var z=Q.byteLength;y+=z,s={size:z,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},E.push(s),h=j}var q=0;if((P=E.length)>=2&&(q=E[P-2].duration,s.duration=q),P){this.nextAudioPts=b=h+f*q,e.samples=E,l=v?new Uint8Array:x.moof(e.sequenceNumber++,A/f,e),e.samples=[];var Y=A/d,X=b/d,J={data1:l,data2:u,startPTS:Y,endPTS:X,startDTS:Y,endDTS:X,type:"audio",hasAudio:!0,hasVideo:!1,nb:P};return this.observer.trigger(r.default.FRAG_PARSING_DATA,J),J}return null}},t.remuxEmptyAudio=function(e,t,n,r){var i=e.inputTimeScale,o=i/(e.samplerate?e.samplerate:i),s=this.nextAudioPts,c=(void 0!==s?s:r.startDTS*i)+this._initDTS,u=r.endDTS*i+this._initDTS,l=1024*o,A=Math.ceil((u-c)/l),h=R.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(a.logger.warn("remux empty Audio"),h){for(var d=[],p=0;p<A;p++){var f=c+p*l;d.push({unit:h,pts:f,dts:f})}e.samples=d,this.remuxAudio(e,t,n)}else a.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!")},t.remuxID3=function(e,t){var n=e.samples.length;if(n){for(var i=e.inputTimeScale,o=this._initPTS,s=this._initDTS,a=0;a<n;a++){var c=e.samples[a];c.pts=k(c.pts-o,t*i)/i,c.dts=k(c.dts-s,t*i)/i}this.observer.trigger(r.default.FRAG_PARSING_METADATA,{samples:e.samples}),e.samples=[]}},t.remuxText=function(e,t){var n=e.samples.length,i=e.inputTimeScale,o=this._initPTS;if(n){for(var s=0;s<n;s++){var a=e.samples[s];a.pts=k(a.pts-o,t*i)/i}e.samples.sort((function(e,t){return e.pts-t.pts})),this.observer.trigger(r.default.FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[]},e}(),H=function(){function e(e){this.observer=e}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(){},t.resetInitSegment=function(){},t.remux=function(e,t,n,i,o,s,a,c){var u=this.observer,l="";e&&(l+="audio"),t&&(l+="video"),u.trigger(r.default.FRAG_PARSING_DATA,{data1:c,startPTS:o,startDTS:o,type:l,hasAudio:!!e,hasVideo:!!t,nb:1,dropped:0}),u.trigger(r.default.FRAG_PARSED)},e}(),V=Object(c.getSelfScope)();try{U=V.performance.now.bind(V.performance)}catch(e){a.logger.debug("Unable to use Performance API on this environment"),U=V.Date.now}var Q=function(){function e(e,t,n,r){this.observer=e,this.typeSupported=t,this.config=n,this.vendor=r}var t=e.prototype;return t.destroy=function(){var e=this.demuxer;e&&e.destroy()},t.push=function(e,t,n,i,s,a,c,u,l,A,h,d){var p=this;if(e.byteLength>0&&null!=t&&null!=t.key&&"AES-128"===t.method){var f=this.decrypter;null==f&&(f=this.decrypter=new o.default(this.observer,this.config));var g=U();f.decrypt(e,t.key.buffer,t.iv.buffer,(function(e){var o=U();p.observer.trigger(r.default.FRAG_DECRYPTED,{stats:{tstart:g,tdecrypt:o}}),p.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,s,a,c,u,l,A,h,d)}))}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(n),i,s,a,c,u,l,A,h,d)},t.pushDecrypted=function(e,t,n,o,s,a,c,u,l,A,h,d){var p=this.demuxer,f=this.remuxer;if(!p||c||u){for(var g,m=this.observer,_=this.typeSupported,E=this.config,b=[{demux:T,remux:F},{demux:y.default,remux:H},{demux:v,remux:F},{demux:C,remux:F}],w=0,S=b.length;w<S&&!(g=b[w]).demux.probe(e);w++);if(!g)return void m.trigger(r.default.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});f&&f instanceof g.remux||(f=new g.remux(m,E,_,this.vendor)),p&&p instanceof g.demux||(p=new g.demux(m,f,E,_),this.probe=g.demux.probe),this.demuxer=p,this.remuxer=f}(c||u)&&(p.resetInitSegment(n,o,s,A),f.resetInitSegment()),c&&(p.resetTimeStamp(d),f.resetTimeStamp(d)),"function"==typeof p.setDecryptData&&p.setDecryptData(t),p.append(e,a,l,h)},e}();t.default=Q},"./src/demux/demuxer-worker.js":
/*!*************************************!*\
  !*** ./src/demux/demuxer-worker.js ***!
  \*************************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Module is referenced from these modules with unsupported syntax: ./src/demux/demuxer.js (referenced with require.resolve) */function(e,t,n){"use strict";n.r(t);var r=n(/*! ../demux/demuxer-inline */"./src/demux/demuxer-inline.js"),i=n(/*! ../events */"./src/events.js"),o=n(/*! ../utils/logger */"./src/utils/logger.js"),s=n(/*! eventemitter3 */"./node_modules/eventemitter3/index.js");t.default=function(e){var t=new s.EventEmitter;t.trigger=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.emit.apply(t,[e,e].concat(r))},t.off=function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.removeListener.apply(t,[e].concat(r))};var n=function(t,n){e.postMessage({event:t,data:n})};e.addEventListener("message",(function(i){var s=i.data;switch(s.cmd){case"init":var a=JSON.parse(s.config);e.demuxer=new r.default(t,s.typeSupported,a,s.vendor),Object(o.enableLogs)(a.debug),n("init",null);break;case"demux":e.demuxer.push(s.data,s.decryptdata,s.initSegment,s.audioCodec,s.videoCodec,s.timeOffset,s.discontinuity,s.trackSwitch,s.contiguous,s.duration,s.accurateTimeOffset,s.defaultInitPTS)}})),t.on(i.default.FRAG_DECRYPTED,n),t.on(i.default.FRAG_PARSING_INIT_SEGMENT,n),t.on(i.default.FRAG_PARSED,n),t.on(i.default.ERROR,n),t.on(i.default.FRAG_PARSING_METADATA,n),t.on(i.default.FRAG_PARSING_USERDATA,n),t.on(i.default.INIT_PTS_FOUND,n),t.on(i.default.FRAG_PARSING_DATA,(function(t,n){var r=[],i={event:t,data:n};n.data1&&(i.data1=n.data1.buffer,r.push(n.data1.buffer),delete n.data1),n.data2&&(i.data2=n.data2.buffer,r.push(n.data2.buffer),delete n.data2),e.postMessage(i,r)}))}},"./src/demux/id3.js":
/*!**************************!*\
  !*** ./src/demux/id3.js ***!
  \**************************/
/*! exports provided: default, utf8ArrayToStr */function(e,t,n){"use strict";n.r(t),n.d(t,"utf8ArrayToStr",(function(){return a}));var r,i=n(/*! ../utils/get-self-scope */"./src/utils/get-self-scope.js"),o=function(){function e(){}return e.isHeader=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.isFooter=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},e.getID3Data=function(t,n){for(var r=n,i=0;e.isHeader(t,n);){i+=10,i+=e._readSize(t,n+6),e.isFooter(t,n+10)&&(i+=10),n+=i}if(i>0)return t.subarray(r,r+i)},e._readSize=function(e,t){var n=0;return n=(127&e[t])<<21,n|=(127&e[t+1])<<14,n|=(127&e[t+2])<<7,n|=127&e[t+3]},e.getTimeStamp=function(t){for(var n=e.getID3Frames(t),r=0;r<n.length;r++){var i=n[r];if(e.isTimeStampFrame(i))return e._readTimeStamp(i)}},e.isTimeStampFrame=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},e._getFrameData=function(t){var n=String.fromCharCode(t[0],t[1],t[2],t[3]),r=e._readSize(t,4);return{type:n,size:r,data:t.subarray(10,10+r)}},e.getID3Frames=function(t){for(var n=0,r=[];e.isHeader(t,n);){for(var i=e._readSize(t,n+6),o=(n+=10)+i;n+8<o;){var s=e._getFrameData(t.subarray(n)),a=e._decodeFrame(s);a&&r.push(a),n+=s.size+10}e.isFooter(t,n)&&(n+=10)}return r},e._decodeFrame=function(t){return"PRIV"===t.type?e._decodePrivFrame(t):"T"===t.type[0]?e._decodeTextFrame(t):"W"===t.type[0]?e._decodeURLFrame(t):void 0},e._readTimeStamp=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),n=1&t[3],r=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},e._decodePrivFrame=function(t){if(!(t.size<2)){var n=e._utf8ArrayToStr(t.data,!0),r=new Uint8Array(t.data.subarray(n.length+1));return{key:t.type,info:n,data:r.buffer}}},e._decodeTextFrame=function(t){if(!(t.size<2)){if("TXXX"===t.type){var n=1,r=e._utf8ArrayToStr(t.data.subarray(n),!0);n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var o=e._utf8ArrayToStr(t.data.subarray(1));return{key:t.type,data:o}}},e._decodeURLFrame=function(t){if("WXXX"===t.type){if(t.size<2)return;var n=1,r=e._utf8ArrayToStr(t.data.subarray(n),!0);n+=r.length+1;var i=e._utf8ArrayToStr(t.data.subarray(n));return{key:t.type,info:r,data:i}}var o=e._utf8ArrayToStr(t.data);return{key:t.type,data:o}},e._utf8ArrayToStr=function(e,t){void 0===t&&(t=!1);var n=s();if(n){var r=n.decode(e);if(t){var i=r.indexOf("\0");return-1!==i?r.substring(0,i):r}return r.replace(/\0/g,"")}for(var o,a,c,u=e.length,l="",A=0;A<u;){if(0===(o=e[A++])&&t)return l;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(o);break;case 12:case 13:a=e[A++],l+=String.fromCharCode((31&o)<<6|63&a);break;case 14:a=e[A++],c=e[A++],l+=String.fromCharCode((15&o)<<12|(63&a)<<6|(63&c)<<0)}}return l},e}();function s(){var e=Object(i.getSelfScope)();return r||void 0===e.TextDecoder||(r=new e.TextDecoder("utf-8")),r}var a=o._utf8ArrayToStr;t.default=o},"./src/demux/mp4demuxer.js":
/*!*********************************!*\
  !*** ./src/demux/mp4demuxer.js ***!
  \*********************************/
/*! exports provided: default */function(e,t,n){"use strict";n.r(t);var r=n(/*! ../utils/logger */"./src/utils/logger.js"),i=n(/*! ../events */"./src/events.js"),o=Math.pow(2,32)-1,s=function(){function e(e,t){this.observer=e,this.remuxer=t}var t=e.prototype;return t.resetTimeStamp=function(e){this.initPTS=e},t.resetInitSegment=function(t,n,r,o){if(t&&t.byteLength){var s=this.initData=e.parseInitSegment(t);null==n&&(n="mp4a.40.5"),null==r&&(r="avc1.42e01e");var a={};s.audio&&s.video?a.audiovideo={container:"video/mp4",codec:n+","+r,initSegment:o?t:null}:(s.audio&&(a.audio={container:"audio/mp4",codec:n,initSegment:o?t:null}),s.video&&(a.video={container:"video/mp4",codec:r,initSegment:o?t:null})),this.observer.trigger(i.default.FRAG_PARSING_INIT_SEGMENT,{tracks:a})}else n&&(this.audioCodec=n),r&&(this.videoCodec=r)},e.probe=function(t){return e.findBox({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.bin2str=function(e){return String.fromCharCode.apply(null,e)},e.readUint16=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<8|e[t+1];return n<0?65536+n:n},e.readUint32=function(e,t){e.data&&(t+=e.start,e=e.data);var n=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return n<0?4294967296+n:n},e.writeUint32=function(e,t,n){e.data&&(t+=e.start,e=e.data),e[t]=n>>24,e[t+1]=n>>16&255,e[t+2]=n>>8&255,e[t+3]=255&n},e.findBox=function(t,n){var r,i,o,s,a,c,u=[];if(t.data?(a=t.start,o=t.end,t=t.data):(a=0,o=t.byteLength),!n.length)return null;for(r=a;r<o;)c=(i=e.readUint32(t,r))>1?r+i:o,e.bin2str(t.subarray(r+4,r+8))===n[0]&&(1===n.length?u.push({data:t,start:r+8,end:c}):(s=e.findBox({data:t,start:r+8,end:c},n.slice(1))).length&&(u=u.concat(s))),r=c;return u},e.parseSegmentIndex=function(t){var n,r=e.findBox(t,["moov"])[0],i=r?r.end:null,o=0,s=e.findBox(t,["sidx"]);if(!s||!s[0])return null;n=[];var a=(s=s[0]).data[0];o=0===a?8:16;var c=e.readUint32(s,o);o+=4;o+=0===a?8:16,o+=2;var u=s.end+0,l=e.readUint16(s,o);o+=2;for(var A=0;A<l;A++){var h=o,d=e.readUint32(s,h);h+=4;var p=2147483647&d;if(1===(2147483648&d)>>>31)return void console.warn("SIDX has hierarchical references (not supported)");var f=e.readUint32(s,h);h+=4,n.push({referenceSize:p,subsegmentDuration:f,info:{duration:f/c,start:u,end:u+p-1}}),u+=p,o=h+=4}return{earliestPresentationTime:0,timescale:c,version:a,referencesCount:l,references:n,moovEndOffset:i}},e.parseInitSegment=function(t){var n=[];return e.findBox(t,["moov","trak"]).forEach((function(t){var i=e.findBox(t,["tkhd"])[0];if(i){var o=i.data[i.start],s=0===o?12:20,a=e.readUint32(i,s),c=e.findBox(t,["mdia","mdhd"])[0];if(c){s=0===(o=c.data[c.start])?12:20;var u=e.readUint32(c,s),l=e.findBox(t,["mdia","hdlr"])[0];if(l){var A={soun:"audio",vide:"video"}[e.bin2str(l.data.subarray(l.start+8,l.start+12))];if(A){var h=e.findBox(t,["mdia","minf","stbl","stsd"]);if(h.length){h=h[0];var d=e.bin2str(h.data.subarray(h.start+12,h.start+16));r.logger.log("MP4Demuxer:"+A+":"+d+" found")}n[a]={timescale:u,type:A},n[A]={timescale:u,id:a}}}}}})),n},e.getStartDTS=function(t,n){var r,i,o;return r=e.findBox(n,["moof","traf"]),i=[].concat.apply([],r.map((function(n){return e.findBox(n,["tfhd"]).map((function(r){var i,o,s;return i=e.readUint32(r,4),o=t[i].timescale||9e4,s=e.findBox(n,["tfdt"]).map((function(t){var n,r;return n=t.data[t.start],r=e.readUint32(t,4),1===n&&(r*=Math.pow(2,32),r+=e.readUint32(t,8)),r}))[0],s/o}))}))),o=Math.min.apply(null,i),isFinite(o)?o:0},e.offsetStartDTS=function(t,n,r){e.findBox(n,["moof","traf"]).map((function(n){return e.findBox(n,["tfhd"]).map((function(i){var s=e.readUint32(i,4),a=t[s].timescale||9e4;e.findBox(n,["tfdt"]).map((function(t){var n=t.data[t.start],i=e.readUint32(t,4);if(0===n)e.writeUint32(t,4,i-r*a);else{i*=Math.pow(2,32),i+=e.readUint32(t,8),i-=r*a,i=Math.max(i,0);var s=Math.floor(i/(o+1)),c=Math.floor(i%(o+1));e.writeUint32(t,4,s),e.writeUint32(t,8,c)}}))}))}))},t.append=function(t,n,r,o){var s=this.initData;s||(this.resetInitSegment(t,this.audioCodec,this.videoCodec,!1),s=this.initData);var a,c=this.initPTS;if(void 0===c){var u=e.getStartDTS(s,t);this.initPTS=c=u-n,this.observer.trigger(i.default.INIT_PTS_FOUND,{initPTS:c})}e.offsetStartDTS(s,t,c),a=e.getStartDTS(s,t),this.remuxer.remux(s.audio,s.video,null,null,a,r,o,t)},t.destroy=function(){},e}();t.default=s},"./src/errors.ts":
/*!***********************!*\
  !*** ./src/errors.ts ***!
  \***********************/
/*! exports provided: ErrorTypes, ErrorDetails */function(e,t,n){"use strict";var r,i;n.r(t),n.d(t,"ErrorTypes",(function(){return r})),n.d(t,"ErrorDetails",(function(){return i})),function(e){e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError"}(r||(r={})),function(e){e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException"}(i||(i={}))},"./src/events.js":
/*!***********************!*\
  !*** ./src/events.js ***!
  \***********************/
/*! exports provided: default */function(e,t,n){"use strict";n.r(t);t.default={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVELS_UPDATED:"hlsLevelsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",CUES_PARSED:"hlsCuesParsed",NON_NATIVE_TEXT_TRACKS_FOUND:"hlsNonNativeTextTracksFound",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition",LIVE_BACK_BUFFER_REACHED:"hlsLiveBackBufferReached"}},"./src/hls.ts":
/*!*********************************!*\
  !*** ./src/hls.ts + 50 modules ***!
  \*********************************/
/*! exports provided: default */
/*! ModuleConcatenation bailout: Cannot concat with ./src/crypt/decrypter.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/demuxer-inline.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/id3.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/demux/mp4demuxer.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/errors.ts because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/events.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/polyfills/number.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/get-self-scope.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./src/utils/logger.js because of ./src/demux/demuxer-worker.js */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/eventemitter3/index.js (<- Module is not an ECMAScript module) */
/*! ModuleConcatenation bailout: Cannot concat with ./node_modules/url-toolkit/src/url-toolkit.js (<- Module is not an ECMAScript module) */function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return ln}));var r={};n.r(r),n.d(r,"newCue",(function(){return pt}));var i,o,s=n("./node_modules/url-toolkit/src/url-toolkit.js"),a=n("./src/errors.ts"),c=n("./src/polyfills/number.js"),u=n("./src/events.js"),l=n("./src/utils/logger.js"),A={hlsEventGeneric:!0,hlsHandlerDestroying:!0,hlsHandlerDestroyed:!0},h=function(){function e(e){this.hls=void 0,this.handledEvents=void 0,this.useGenericHandler=void 0,this.hls=e,this.onEvent=this.onEvent.bind(this);for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.handledEvents=n,this.useGenericHandler=!0,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.unregisterListeners(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){},t.onHandlerDestroyed=function(){},t.isEventHandler=function(){return"object"==typeof this.handledEvents&&this.handledEvents.length&&"function"==typeof this.onEvent},t.registerListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){if(A[e])throw new Error("Forbidden event-name: "+e);this.hls.on(e,this.onEvent)}),this)},t.unregisterListeners=function(){this.isEventHandler()&&this.handledEvents.forEach((function(e){this.hls.off(e,this.onEvent)}),this)},t.onEvent=function(e,t){this.onEventGeneric(e,t)},t.onEventGeneric=function(e,t){try{(function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)}).call(this,e,t).call()}catch(t){l.logger.error("An internal error happened while handling event "+e+'. Error message: "'+t.message+'". Here is a stacktrace:',t),this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t})}},e}(),d=h;!function(e){e.MANIFEST="manifest",e.LEVEL="level",e.AUDIO_TRACK="audioTrack",e.SUBTITLE_TRACK="subtitleTrack"}(i||(i={})),function(e){e.MAIN="main",e.AUDIO="audio",e.SUBTITLE="subtitle"}(o||(o={}));var p=n("./src/demux/mp4demuxer.js");function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g,m=function(){function e(e,t){this._uri=null,this.baseuri=void 0,this.reluri=void 0,this.method=null,this.key=null,this.iv=null,this.baseuri=e,this.reluri=t}var t,n,r;return t=e,(n=[{key:"uri",get:function(){return!this._uri&&this.reluri&&(this._uri=Object(s.buildAbsoluteURL)(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}])&&f(t.prototype,n),r&&f(t,r),e}();function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}!function(e){e.AUDIO="audio",e.VIDEO="video"}(g||(g={}));var y=function(){function e(){var e;this._url=null,this._byteRange=null,this._decryptdata=null,this._elementaryStreams=((e={})[g.AUDIO]=!1,e[g.VIDEO]=!1,e),this.deltaPTS=0,this.rawProgramDateTime=null,this.programDateTime=null,this.title=null,this.tagList=[],this.cc=void 0,this.type=void 0,this.relurl=void 0,this.baseurl=void 0,this.duration=void 0,this.start=void 0,this.sn=0,this.urlId=0,this.level=0,this.levelkey=void 0,this.loader=void 0}var t,n,r,i=e.prototype;return i.setByteRange=function(e,t){var n=e.split("@",2),r=[];1===n.length?r[0]=t?t.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r},i.addElementaryStream=function(e){this._elementaryStreams[e]=!0},i.hasElementaryStream=function(e){return!0===this._elementaryStreams[e]},i.createInitializationVector=function(e){for(var t=new Uint8Array(16),n=12;n<16;n++)t[n]=e>>8*(15-n)&255;return t},i.setDecryptDataFromLevelKey=function(e,t){var n=e;return(null==e?void 0:e.method)&&e.uri&&!e.iv&&((n=new m(e.baseuri,e.reluri)).method=e.method,n.iv=this.createInitializationVector(t)),n},t=e,(n=[{key:"url",get:function(){return!this._url&&this.relurl&&(this._url=Object(s.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function(e){this._url=e}},{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var e=this.sn;"number"!=typeof e&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&l.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),e=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,e)}return this._decryptdata}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(c.isFiniteNumber)(this.programDateTime))return null;var e=Object(c.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){return!(!this.decryptdata||null===this.decryptdata.uri||null!==this.decryptdata.key)}}])&&v(t.prototype,n),r&&v(t,r),e}();function _(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var E=function(){function e(e){this.endCC=0,this.endSN=0,this.fragments=[],this.initSegment=null,this.live=!0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=e,this.version=null}var t,n,r;return t=e,(n=[{key:"hasProgramDateTime",get:function(){return!(!this.fragments[0]||!Object(c.isFiniteNumber)(this.fragments[0].programDateTime))}}])&&_(t.prototype,n),r&&_(t,r),e}(),b=/^(\d+)x(\d+)$/,w=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,S=function(){function e(t){for(var n in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(n)&&(this[n]=t[n])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var n=new Uint8Array(t.length/2),r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(2*r,2*r+2),16);return n}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.enumeratedString=function(e){return this[e]},t.decimalResolution=function(e){var t=b.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,n={};for(w.lastIndex=0;null!==(t=w.exec(e));){var r=t[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[t[1]]=r}return n},e}(),T={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0}};function C(e,t){return MediaSource.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"')}var R=/(?:#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)|#EXT-X-SESSION-DATA:([^\n\r]*)[\r\n]+)/g,I=/#EXT-X-MEDIA:(.*)/g,O=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)([\S+ ?]+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),x=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)([^:]*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,N=/\.(mp4|m4s|m4v|m4a)$/i,B=function(){function e(){}return e.findGroup=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.id===t)return r}},e.convertAVC1ToAVCOTI=function(e){var t,n=e.split(".");return n.length>2?(t=n.shift()+".",t+=parseInt(n.shift()).toString(16),t+=("000"+parseInt(n.shift()).toString(16)).substr(-4)):t=e,t},e.resolve=function(e,t){return s.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.parseMasterPlaylist=function(t,n){var r,i=[],o={},s=!1;function a(e,t){["video","audio"].forEach((function(n){var r=e.filter((function(e){return function(e,t){var n=T[t];return!!n&&!0===n[e.slice(0,4)]}(e,n)}));if(r.length){var i=r.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[n+"Codec"]=i.length>0?i[0]:r[0],e=e.filter((function(e){return-1===r.indexOf(e)}))}})),t.unknownCodecs=e}for(R.lastIndex=0;null!=(r=R.exec(t));)if(r[1]){var c={},u=c.attrs=new S(r[1]);c.url=e.resolve(r[2],n);var l=u.decimalResolution("RESOLUTION");l&&(c.width=l.width,c.height=l.height),c.bitrate=u.decimalInteger("AVERAGE-BANDWIDTH")||u.decimalInteger("BANDWIDTH"),c.name=u.NAME,a([].concat((u.CODECS||"").split(/[ ,]+/)),c),c.videoCodec&&-1!==c.videoCodec.indexOf("avc1")&&(c.videoCodec=e.convertAVC1ToAVCOTI(c.videoCodec)),i.push(c)}else if(r[3]){var A=new S(r[3]);A["DATA-ID"]&&(s=!0,o[A["DATA-ID"]]=A)}return{levels:i,sessionData:s?o:null}},e.parseMasterPlaylistMedia=function(t,n,r,i){var o;void 0===i&&(i=[]);var s=[],a=0;for(I.lastIndex=0;null!==(o=I.exec(t));){var c=new S(o[1]);if(c.TYPE===r){var u={attrs:c,id:a++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE,type:r,default:"YES"===c.DEFAULT,autoselect:"YES"===c.AUTOSELECT,forced:"YES"===c.FORCED,lang:c.LANGUAGE};if(c.URI&&(u.url=e.resolve(c.URI,n)),i.length){var l=e.findGroup(i,u.groupId);u.audioCodec=l?l.codec:i[0].codec}s.push(u)}}return s},e.parseLevelPlaylist=function(e,t,n,r,i){var o,s,a,u=0,A=0,h=new E(t),d=0,p=null,f=new y,g=null;for(O.lastIndex=0;null!==(o=O.exec(e));){var v=o[1];if(v){f.duration=parseFloat(v);var _=(" "+o[2]).slice(1);f.title=_||null,f.tagList.push(_?["INF",v,_]:["INF",v])}else if(o[3]){if(Object(c.isFiniteNumber)(f.duration)){var b=u++;f.type=r,f.start=A,a&&(f.levelkey=a),f.sn=b,f.level=n,f.cc=d,f.urlId=i,f.baseurl=t,f.relurl=(" "+o[3]).slice(1),L(f,p),h.fragments.push(f),p=f,A+=f.duration,f=new y}}else if(o[4]){var w=(" "+o[4]).slice(1);p?f.setByteRange(w,p):f.setByteRange(w)}else if(o[5])f.rawProgramDateTime=(" "+o[5]).slice(1),f.tagList.push(["PROGRAM-DATE-TIME",f.rawProgramDateTime]),null===g&&(g=h.fragments.length);else{if(!(o=o[0].match(x))){l.logger.warn("No matches on slow regex match for level playlist!");continue}for(s=1;s<o.length&&void 0===o[s];s++);var T=(" "+o[s+1]).slice(1),C=(" "+o[s+2]).slice(1);switch(o[s]){case"#":f.tagList.push(C?[T,C]:[T]);break;case"PLAYLIST-TYPE":h.type=T.toUpperCase();break;case"MEDIA-SEQUENCE":u=h.startSN=parseInt(T);break;case"TARGETDURATION":h.targetduration=parseFloat(T);break;case"VERSION":h.version=parseInt(T);break;case"EXTM3U":break;case"ENDLIST":h.live=!1;break;case"DIS":d++,f.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":d=parseInt(T);break;case"KEY":var R=new S(T),I=R.enumeratedString("METHOD"),B=R.URI,D=R.hexadecimalInteger("IV");if("com.apple.streamingkeydelivery"===(R.KEYFORMAT||"identity")){l.logger.warn("Keyformat com.apple.streamingkeydelivery is not supported");continue}I&&(a=new m(t,B),B&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(I)>=0&&(a.method=I,a.key=null,a.iv=D));break;case"START":var M=new S(T).decimalFloatingPoint("TIME-OFFSET");Object(c.isFiniteNumber)(M)&&(h.startTimeOffset=M);break;case"MAP":var P=new S(T);f.relurl=P.URI,P.BYTERANGE&&f.setByteRange(P.BYTERANGE),f.baseurl=t,f.level=n,f.type=r,f.sn="initSegment",h.initSegment=f,(f=new y).rawProgramDateTime=h.initSegment.rawProgramDateTime;break;default:l.logger.warn("line parsed but not handled: "+o)}}}return(f=p)&&!f.relurl&&(h.fragments.pop(),A-=f.duration),h.totalduration=A,h.averagetargetduration=A/h.fragments.length,h.endSN=u-1,h.startCC=h.fragments[0]?h.fragments[0].cc:0,h.endCC=d,!h.initSegment&&h.fragments.length&&h.fragments.every((function(e){return N.test(e.relurl)}))&&(l.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(f=new y).relurl=h.fragments[0].relurl,f.baseurl=t,f.level=n,f.type=r,f.sn="initSegment",h.initSegment=f,h.needSidxRanges=!0),g&&function(e,t){for(var n=e[t],r=t-1;r>=0;r--){var i=e[r];i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(h.fragments,g),h},e}();function L(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):(null==t?void 0:t.programDateTime)&&(e.programDateTime=t.endProgramDateTime),Object(c.isFiniteNumber)(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}var D=window.performance,M=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MANIFEST_LOADING,u.default.LEVEL_LOADING,u.default.AUDIO_TRACK_LOADING,u.default.SUBTITLE_TRACK_LOADING)||this).loaders={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.canHaveQualityLevels=function(e){return e!==i.AUDIO_TRACK&&e!==i.SUBTITLE_TRACK},r.mapContextToLevelType=function(e){switch(e.type){case i.AUDIO_TRACK:return o.AUDIO;case i.SUBTITLE_TRACK:return o.SUBTITLE;default:return o.MAIN}},r.getResponseUrl=function(e,t){var n=e.url;return void 0!==n&&0!==n.indexOf("data:")||(n=t.url),n};var s=r.prototype;return s.createInternalLoader=function(e){var t=this.hls.config,n=t.pLoader,r=t.loader,i=new(n||r)(t);return e.loader=i,this.loaders[e.type]=i,i},s.getInternalLoader=function(e){return this.loaders[e.type]},s.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},s.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},s.destroy=function(){this.destroyInternalLoaders(),e.prototype.destroy.call(this)},s.onManifestLoading=function(e){this.load({url:e.url,type:i.MANIFEST,level:0,id:null,responseType:"text"})},s.onLevelLoading=function(e){this.load({url:e.url,type:i.LEVEL,level:e.level,id:e.id,responseType:"text"})},s.onAudioTrackLoading=function(e){this.load({url:e.url,type:i.AUDIO_TRACK,level:null,id:e.id,responseType:"text"})},s.onSubtitleTrackLoading=function(e){this.load({url:e.url,type:i.SUBTITLE_TRACK,level:null,id:e.id,responseType:"text"})},s.load=function(e){var t=this.hls.config;l.logger.debug("Loading playlist of type "+e.type+", level: "+e.level+", id: "+e.id);var n,r,o,s,a=this.getInternalLoader(e);if(a){var c=a.context;if(c&&c.url===e.url)return l.logger.trace("playlist request ongoing"),!1;l.logger.warn("aborting previous loader for type: "+e.type),a.abort()}switch(e.type){case i.MANIFEST:n=t.manifestLoadingMaxRetry,r=t.manifestLoadingTimeOut,o=t.manifestLoadingRetryDelay,s=t.manifestLoadingMaxRetryTimeout;break;case i.LEVEL:n=0,s=0,o=0,r=t.levelLoadingTimeOut;break;default:n=t.levelLoadingMaxRetry,r=t.levelLoadingTimeOut,o=t.levelLoadingRetryDelay,s=t.levelLoadingMaxRetryTimeout}a=this.createInternalLoader(e);var u={timeout:r,maxRetry:n,retryDelay:o,maxRetryDelay:s},A={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};return l.logger.debug("Calling internal loader delegate for URL: "+e.url),a.load(e,u,A),!0},s.loadsuccess=function(e,t,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this._handleSidxRequest(e,n),void this._handlePlaylistLoaded(e,t,n,r);if(this.resetInternalLoader(n.type),"string"!=typeof e.data)throw new Error('expected responseType of "text" for PlaylistLoader');var i=e.data;t.tload=D.now(),0===i.indexOf("#EXTM3U")?i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this._handleTrackOrLevelPlaylist(e,t,n,r):this._handleMasterPlaylist(e,t,n,r):this._handleManifestParsingError(e,n,"no EXTM3U delimiter",r)},s.loaderror=function(e,t,n){void 0===n&&(n=null),this._handleNetworkError(t,n,!1,e)},s.loadtimeout=function(e,t,n){void 0===n&&(n=null),this._handleNetworkError(t,n,!0)},s._handleMasterPlaylist=function(e,t,n,i){var o=this.hls,s=e.data,a=r.getResponseUrl(e,n),c=B.parseMasterPlaylist(s,a),A=c.levels,h=c.sessionData;if(A.length){var d=A.map((function(e){return{id:e.attrs.AUDIO,codec:e.audioCodec}})),p=B.parseMasterPlaylistMedia(s,a,"AUDIO",d),f=B.parseMasterPlaylistMedia(s,a,"SUBTITLES"),g=B.parseMasterPlaylistMedia(s,a,"CLOSED-CAPTIONS");if(p.length){var m=!1;p.forEach((function(e){e.url||(m=!0)})),!1===m&&A[0].audioCodec&&!A[0].attrs.AUDIO&&(l.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:{},url:""}))}o.trigger(u.default.MANIFEST_LOADED,{levels:A,audioTracks:p,subtitles:f,captions:g,url:a,stats:t,networkDetails:i,sessionData:h})}else this._handleManifestParsingError(e,n,"no level found in manifest",i)},s._handleTrackOrLevelPlaylist=function(e,t,n,o){var s=this.hls,l=n.id,A=n.level,h=n.type,d=r.getResponseUrl(e,n),p=Object(c.isFiniteNumber)(l)?l:0,f=Object(c.isFiniteNumber)(A)?A:p,g=r.mapContextToLevelType(n),m=B.parseLevelPlaylist(e.data,d,f,g,p);if(m.tload=t.tload,m.fragments.length){if(h===i.MANIFEST){var v={url:d,details:m};s.trigger(u.default.MANIFEST_LOADED,{levels:[v],audioTracks:[],url:d,stats:t,networkDetails:o,sessionData:null})}if(t.tparsed=D.now(),m.needSidxRanges){var y=m.initSegment.url;this.load({url:y,isSidxRequest:!0,type:h,level:A,levelDetails:m,id:l,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer"})}else n.levelDetails=m,this._handlePlaylistLoaded(e,t,n,o)}else s.trigger(u.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:d,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},s._handleSidxRequest=function(e,t){if("string"==typeof e.data)throw new Error("sidx request must be made with responseType of array buffer");var n=p.default.parseSegmentIndex(new Uint8Array(e.data));if(n){var r=n.references,i=t.levelDetails;r.forEach((function(e,t){var n=e.info;if(i){var r=i.fragments[t];0===r.byteRange.length&&r.setByteRange(String(1+n.end-n.start)+"@"+String(n.start))}})),i&&i.initSegment.setByteRange(String(n.moovEndOffset)+"@0")}},s._handleManifestParsingError=function(e,t,n,r){this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:e.url,reason:n,networkDetails:r})},s._handleNetworkError=function(e,t,n,r){var o,s;void 0===n&&(n=!1),void 0===r&&(r=null),l.logger.info("A network error occured while loading a "+e.type+"-type playlist");var c=this.getInternalLoader(e);switch(e.type){case i.MANIFEST:o=n?a.ErrorDetails.MANIFEST_LOAD_TIMEOUT:a.ErrorDetails.MANIFEST_LOAD_ERROR,s=!0;break;case i.LEVEL:o=n?a.ErrorDetails.LEVEL_LOAD_TIMEOUT:a.ErrorDetails.LEVEL_LOAD_ERROR,s=!1;break;case i.AUDIO_TRACK:o=n?a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,s=!1;break;default:s=!1}c&&(c.abort(),this.resetInternalLoader(e.type));var A={type:a.ErrorTypes.NETWORK_ERROR,details:o,fatal:s,url:e.url,loader:c,context:e,networkDetails:t};r&&(A.response=r),this.hls.trigger(u.default.ERROR,A)},s._handlePlaylistLoaded=function(e,t,n,o){var s=n.type,a=n.level,c=n.id,l=n.levelDetails;if(l&&l.targetduration)if(r.canHaveQualityLevels(n.type))this.hls.trigger(u.default.LEVEL_LOADED,{details:l,level:a||0,id:c||0,stats:t,networkDetails:o});else switch(s){case i.AUDIO_TRACK:this.hls.trigger(u.default.AUDIO_TRACK_LOADED,{details:l,id:c,stats:t,networkDetails:o});break;case i.SUBTITLE_TRACK:this.hls.trigger(u.default.SUBTITLE_TRACK_LOADED,{details:l,id:c,stats:t,networkDetails:o})}else this._handleManifestParsingError(e,n,"invalid target duration",o)},r}(d);var P=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.FRAG_LOADING)||this).loaders={},n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){var t=this.loaders;for(var n in t){var r=t[n];r&&r.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.onFragLoading=function(e){var t=e.frag,n=t.type,r=this.loaders,i=this.hls.config,o=i.fLoader,s=i.loader;t.loaded=0;var a,u,A,h=r[n];h&&(l.logger.warn("abort previous fragment loader for type: "+n),h.abort()),h=r[n]=t.loader=i.fLoader?new o(i):new s(i),a={url:t.url,frag:t,responseType:"arraybuffer",progressData:!1};var d=t.byteRangeStartOffset,p=t.byteRangeEndOffset;Object(c.isFiniteNumber)(d)&&Object(c.isFiniteNumber)(p)&&(a.rangeStart=d,a.rangeEnd=p),u={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:i.fragLoadingMaxRetryTimeout},A={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},h.load(a,u,A)},i.loadsuccess=function(e,t,n,r){void 0===r&&(r=null);var i=e.data,o=n.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:i,frag:o,stats:t,networkDetails:r})},i.loaderror=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e,networkDetails:n})},i.loadtimeout=function(e,t,n){void 0===n&&(n=null);var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag,networkDetails:n})},i.loadprogress=function(e,t,n,r){void 0===r&&(r=null);var i=t.frag;i.loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:i,stats:e,networkDetails:r})},r}(d);var k=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.KEY_LOADING)||this).loaders={},n.decryptkey=null,n.decrypturl=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){for(var t in this.loaders){var n=this.loaders[t];n&&n.destroy()}this.loaders={},e.prototype.destroy.call(this)},i.onKeyLoading=function(e){var t=e.frag,n=t.type,r=this.loaders[n];if(t.decryptdata){var i=t.decryptdata.uri;if(i!==this.decrypturl||null===this.decryptkey){var o=this.hls.config;if(r&&(l.logger.warn("abort previous key loader for type:"+n),r.abort()),!i)return void l.logger.warn("key uri is falsy");t.loader=this.loaders[n]=new o.loader(o),this.decrypturl=i,this.decryptkey=null;var s={url:i,frag:t,responseType:"arraybuffer"},a={timeout:o.fragLoadingTimeOut,maxRetry:0,retryDelay:o.fragLoadingRetryDelay,maxRetryDelay:o.fragLoadingMaxRetryTimeout},c={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};t.loader.load(s,a,c)}else this.decryptkey&&(t.decryptdata.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:t}))}else l.logger.warn("Missing decryption data on fragment in onKeyLoading")},i.loadsuccess=function(e,t,n){var r=n.frag;r.decryptdata?(this.decryptkey=r.decryptdata.key=new Uint8Array(e.data),r.loader=void 0,delete this.loaders[r.type],this.hls.trigger(u.default.KEY_LOADED,{frag:r})):l.logger.error("after key load, decryptdata unset")},i.loaderror=function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:e})},i.loadtimeout=function(e,t){var n=t.frag,r=n.loader;r&&r.abort(),delete this.loaders[n.type],this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.NETWORK_ERROR,details:a.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},r}(d);var U="NOT_LOADED",F="APPENDING",H="PARTIAL",V="OK",Q=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.BUFFER_APPENDED,u.default.FRAG_BUFFERED,u.default.FRAG_LOADED)||this).bufferPadding=.2,n.fragments=Object.create(null),n.timeRanges=Object.create(null),n.config=t.config,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.config=null,d.prototype.destroy.call(this),e.prototype.destroy.call(this)},i.getBufferedFrag=function(e,t){var n=this.fragments,r=Object.keys(n).filter((function(r){var i=n[r];if(i.body.type!==t)return!1;if(!i.buffered)return!1;var o=i.body;return o.startPTS<=e&&e<=o.endPTS}));if(0===r.length)return null;var i=r.pop();return n[i].body},i.detectEvictedFragments=function(e,t){var n=this;Object.keys(this.fragments).forEach((function(r){var i=n.fragments[r];if(i&&i.buffered){var o=i.range[e];if(o)for(var s=o.time,a=0;a<s.length;a++){var c=s[a];if(!n.isTimeBuffered(c.startPTS,c.endPTS,t)){n.removeFragment(i.body);break}}}}))},i.detectPartialFragments=function(e){var t=this,n=this.getFragmentKey(e),r=this.fragments[n];r&&(r.buffered=!0,Object.keys(this.timeRanges).forEach((function(n){if(e.hasElementaryStream(n)){var i=t.timeRanges[n];r.range[n]=t.getBufferedTimes(e.startPTS,e.endPTS,i)}})))},i.getBufferedTimes=function(e,t,n){for(var r,i,o=[],s=!1,a=0;a<n.length;a++){if(r=n.start(a)-this.bufferPadding,i=n.end(a)+this.bufferPadding,e>=r&&t<=i){o.push({startPTS:Math.max(e,n.start(a)),endPTS:Math.min(t,n.end(a))});break}if(e<i&&t>r)o.push({startPTS:Math.max(e,n.start(a)),endPTS:Math.min(t,n.end(a))}),s=!0;else if(t<=r)break}return{time:o,partial:s}},i.getFragmentKey=function(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn},i.getPartialFragment=function(e){var t,n,r,i=this,o=null,s=0;return Object.keys(this.fragments).forEach((function(a){var c=i.fragments[a];i.isPartial(c)&&(n=c.body.startPTS-i.bufferPadding,r=c.body.endPTS+i.bufferPadding,e>=n&&e<=r&&(t=Math.min(e-n,r-e),s<=t&&(o=c.body,s=t)))})),o},i.getState=function(e){var t=this.getFragmentKey(e),n=this.fragments[t],r=U;return void 0!==n&&(r=n.buffered?!0===this.isPartial(n)?H:V:F),r},i.isPartial=function(e){return!0===e.buffered&&(void 0!==e.range.video&&!0===e.range.video.partial||void 0!==e.range.audio&&!0===e.range.audio.partial)},i.isTimeBuffered=function(e,t,n){for(var r,i,o=0;o<n.length;o++){if(r=n.start(o)-this.bufferPadding,i=n.end(o)+this.bufferPadding,e>=r&&t<=i)return!0;if(t<=r)return!1}return!1},i.onFragLoaded=function(e){var t=e.frag;Object(c.isFiniteNumber)(t.sn)&&!t.bitrateTest&&(this.fragments[this.getFragmentKey(t)]={body:t,range:Object.create(null),buffered:!1})},i.onBufferAppended=function(e){var t=this;this.timeRanges=e.timeRanges,Object.keys(this.timeRanges).forEach((function(e){var n=t.timeRanges[e];t.detectEvictedFragments(e,n)}))},i.onFragBuffered=function(e){this.detectPartialFragments(e.frag)},i.hasFragment=function(e){var t=this.getFragmentKey(e);return void 0!==this.fragments[t]},i.removeFragment=function(e){var t=this.getFragmentKey(e);delete this.fragments[t]},i.removeAllFragments=function(){this.fragments=Object.create(null)},r}(d),j={search:function(e,t){for(var n=0,r=e.length-1,i=null,o=null;n<=r;){var s=t(o=e[i=(n+r)/2|0]);if(s>0)n=i+1;else{if(!(s<0))return o;r=i-1}}return null}},G=function(){function e(){}return e.isBuffered=function(e,t){try{if(e)for(var n=e.buffered,r=0;r<n.length;r++)if(t>=n.start(r)&&t<=n.end(r))return!0}catch(e){}return!1},e.bufferInfo=function(e,t,n){try{if(e){var r,i=e.buffered,o=[];for(r=0;r<i.length;r++)o.push({start:i.start(r),end:i.end(r)});return this.bufferedInfo(o,t,n)}}catch(e){}return{len:0,start:t,end:t,nextStart:void 0}},e.bufferedInfo=function(e,t,n){e.sort((function(e,t){var n=e.start-t.start;return n||t.end-e.end}));var r=[];if(n)for(var i=0;i<e.length;i++){var o=r.length;if(o){var s=r[o-1].end;e[i].start-s<n?e[i].end>s&&(r[o-1].end=e[i].end):r.push(e[i])}else r.push(e[i])}else r=e;for(var a,c=0,u=t,l=t,A=0;A<r.length;A++){var h=r[A].start,d=r[A].end;if(t+n>=h&&t<d)u=h,c=(l=d)-t;else if(t+n<h){a=h;break}}return{len:c,start:u,end:l,nextStart:a}},e}(),K=n("./node_modules/eventemitter3/index.js"),W=n("./node_modules/webworkify-webpack/index.js"),z=n("./src/demux/demuxer-inline.js");function q(){return window.MediaSource||window.WebKitMediaSource}var Y=n("./src/utils/get-self-scope.js");var X=function(e){var t,n;function r(){return e.apply(this,arguments)||this}return n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.prototype.trigger=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.emit.apply(this,[e,e].concat(n))},r}(K.EventEmitter),J=Object(Y.getSelfScope)(),Z=q()||{isTypeSupported:function(){return!1}},$=function(){function e(e,t){var n=this;this.hls=e,this.id=t;var r=this.observer=new X,i=e.config,o=function(t,r){(r=r||{}).frag=n.frag,r.id=n.id,e.trigger(t,r)};r.on(u.default.FRAG_DECRYPTED,o),r.on(u.default.FRAG_PARSING_INIT_SEGMENT,o),r.on(u.default.FRAG_PARSING_DATA,o),r.on(u.default.FRAG_PARSED,o),r.on(u.default.ERROR,o),r.on(u.default.FRAG_PARSING_METADATA,o),r.on(u.default.FRAG_PARSING_USERDATA,o),r.on(u.default.INIT_PTS_FOUND,o);var s={mp4:Z.isTypeSupported("video/mp4"),mpeg:Z.isTypeSupported("audio/mpeg"),mp3:Z.isTypeSupported('audio/mp4; codecs="mp3"')},c=navigator.vendor;if(i.enableWorker&&"undefined"!=typeof Worker){var A;l.logger.log("demuxing in webworker");try{A=this.w=W(/*! ../demux/demuxer-worker.js */"./src/demux/demuxer-worker.js"),this.onwmsg=this.onWorkerMessage.bind(this),A.addEventListener("message",this.onwmsg),A.onerror=function(t){e.trigger(u.default.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:t.message+" ("+t.filename+":"+t.lineno+")"}})},A.postMessage({cmd:"init",typeSupported:s,vendor:c,id:t,config:JSON.stringify(i)})}catch(e){l.logger.warn("Error in worker:",e),l.logger.error("Error while initializing DemuxerWorker, fallback on DemuxerInline"),A&&J.URL.revokeObjectURL(A.objectURL),this.demuxer=new z.default(r,s,i,c),this.w=void 0}}else this.demuxer=new z.default(r,s,i,c)}var t=e.prototype;return t.destroy=function(){var e=this.w;if(e)e.removeEventListener("message",this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var n=this.observer;n&&(n.removeAllListeners(),this.observer=null)},t.push=function(e,t,n,r,i,o,s,a){var u=this.w,A=Object(c.isFiniteNumber)(i.startPTS)?i.startPTS:i.start,h=i.decryptdata,d=this.frag,p=!(d&&i.cc===d.cc),f=!(d&&i.level===d.level),g=d&&i.sn===d.sn+1,m=!f&&g;if(p&&l.logger.log(this.id+":discontinuity detected"),f&&l.logger.log(this.id+":switch detected"),this.frag=i,u)u.postMessage({cmd:"demux",data:e,decryptdata:h,initSegment:t,audioCodec:n,videoCodec:r,timeOffset:A,discontinuity:p,trackSwitch:f,contiguous:m,duration:o,accurateTimeOffset:s,defaultInitPTS:a},e instanceof ArrayBuffer?[e]:[]);else{var v=this.demuxer;v&&v.push(e,h,t,n,r,A,p,f,m,o,s,a)}},t.onWorkerMessage=function(e){var t=e.data,n=this.hls;switch(t.event){case"init":J.URL.revokeObjectURL(this.w.objectURL);break;case u.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,n.trigger(t.event,t.data)}},e}();function ee(e,t,n){switch(t){case"audio":e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds.push(n);break;case"text":e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds.push(n)}}function te(e,t,n){var r=e[t],i=e[n],o=i.startPTS;if(Object(c.isFiniteNumber)(o))n>t?(r.duration=o-r.start,r.duration<0&&l.logger.warn("negative duration computed for frag "+r.sn+",level "+r.level+", there should be some duration drift between playlist and fragment!")):(i.duration=r.start-o,i.duration<0&&l.logger.warn("negative duration computed for frag "+i.sn+",level "+i.level+", there should be some duration drift between playlist and fragment!"));else if(n>t){var s=r.cc===i.cc;i.start=r.start+(s&&r.minEndPTS?r.minEndPTS-r.start:r.duration)}else i.start=Math.max(r.start-i.duration,0)}function ne(e,t,n,r,i,o){var s=n,a=r;if(Object(c.isFiniteNumber)(t.startPTS)){var u=Math.abs(t.startPTS-n);Object(c.isFiniteNumber)(t.deltaPTS)?t.deltaPTS=Math.max(u,t.deltaPTS):t.deltaPTS=u,s=Math.max(n,t.startPTS),n=Math.min(n,t.startPTS),a=Math.min(r,t.endPTS),r=Math.max(r,t.endPTS),i=Math.min(i,t.startDTS),o=Math.max(o,t.endDTS)}var l=n-t.start;t.start=t.startPTS=n,t.maxStartPTS=s,t.endPTS=r,t.minEndPTS=a,t.startDTS=i,t.endDTS=o,t.duration=r-n;var A,h,d,p=t.sn;if(!e||p<e.startSN||p>e.endSN)return 0;for(A=p-e.startSN,(h=e.fragments)[A]=t,d=A;d>0;d--)te(h,d,d-1);for(d=A;d<h.length-1;d++)te(h,d,d+1);return e.PTSKnown=!0,l}function re(e,t){t.initSegment&&e.initSegment&&(t.initSegment=e.initSegment);var n,r=0;if(ie(e,t,(function(e,i){r=e.cc-i.cc,Object(c.isFiniteNumber)(e.startPTS)&&(i.start=i.startPTS=e.startPTS,i.endPTS=e.endPTS,i.duration=e.duration,i.backtracked=e.backtracked,i.dropped=e.dropped,n=i),t.PTSKnown=!0})),t.PTSKnown){if(r){l.logger.log("discontinuity sliding from playlist, take drift into account");for(var i=t.fragments,o=0;o<i.length;o++)i[o].cc+=r}n?ne(t,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS):function(e,t){var n=t.startSN-e.startSN,r=e.fragments,i=t.fragments;if(n<0||n>r.length)return;for(var o=0;o<i.length;o++)i[o].start+=r[n].start}(e,t),t.PTSKnown=e.PTSKnown}}function ie(e,t,n){if(e&&t)for(var r=Math.max(e.startSN,t.startSN)-t.startSN,i=Math.min(e.endSN,t.endSN)-t.startSN,o=t.startSN-e.startSN,s=r;s<=i;s++){var a=e.fragments[o+s],c=t.fragments[s];if(!a||!c)break;n(a,c,s)}}function oe(e,t,n){var r=1e3*(t.averagetargetduration?t.averagetargetduration:t.targetduration),i=r/2;return e&&t.endSN===e.endSN&&(r=i),n&&(r=Math.max(i,r-(window.performance.now()-n))),Math.round(r)}var se={toString:function(e){for(var t="",n=e.length,r=0;r<n;r++)t+="["+e.start(r).toFixed(3)+","+e.end(r).toFixed(3)+"]";return t}};function ae(e,t){t.fragments.forEach((function(t){if(t){var n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}})),t.PTSKnown=!0}function ce(e,t,n){!function(e,t,n){if(function(e,t,n){var r=!1;return t&&t.details&&n&&(n.endCC>n.startCC||e&&e.cc<n.startCC)&&(r=!0),r}(e,n,t)){var r=function(e,t){var n=e.fragments,r=t.fragments;if(r.length&&n.length){var i=function(e,t){for(var n=null,r=0;r<e.length;r+=1){var i=e[r];if(i&&i.cc===t){n=i;break}}return n}(n,r[0].cc);if(i&&(!i||i.startPTS))return i;l.logger.log("No frag in previous level to align on")}else l.logger.log("No fragments to align")}(n.details,t);r&&(l.logger.log("Adjusting PTS using last level due to CC increase within current level"),ae(r.start,t))}}(e,n,t),!n.PTSKnown&&t&&function(e,t){if(t&&t.fragments.length){if(!e.hasProgramDateTime||!t.hasProgramDateTime)return;var n=t.fragments[0].programDateTime,r=(e.fragments[0].programDateTime-n)/1e3+t.fragments[0].start;Object(c.isFiniteNumber)(r)&&(l.logger.log("adjusting PTS using programDateTime delta, sliding:"+r.toFixed(3)),ae(r,e))}}(n,t.details)}function ue(e,t,n){if(null===t||!Array.isArray(e)||!e.length||!Object(c.isFiniteNumber)(t))return null;if(t<(e[0].programDateTime||0))return null;if(t>=(e[e.length-1].endProgramDateTime||0))return null;n=n||0;for(var r=0;r<e.length;++r){var i=e[r];if(he(t,n,i))return i}return null}function le(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=null;if(e?i=t[e.sn-t[0].sn+1]:0===n&&0===t[0].start&&(i=t[0]),i&&0===Ae(n,r,i))return i;var o=j.search(t,Ae.bind(null,n,r));return o||i}function Ae(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0);var r=Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=e?1:n.start-r>e&&n.start?-1:0}function he(e,t,n){var r=1e3*Math.min(t,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>e}var de=function(){function e(e,t,n,r){this.config=e,this.media=t,this.fragmentTracker=n,this.hls=r,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1}var t=e.prototype;return t.poll=function(e){var t=this.config,n=this.media,r=this.stalled,i=n.currentTime,o=n.seeking,s=this.seeking&&!o,a=!this.seeking&&o;if(this.seeking=o,i===e){if((a||s)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&n.buffered.length){var c=G.bufferInfo(n,i,0),u=c.len>0,A=c.nextStart||0;if(u||A){if(o){var h=c.len>2,d=!A||A-i>2&&!this.fragmentTracker.getPartialFragment(i);if(h||d)return;this.moved=!1}if(!this.moved&&this.stalled){var p=Math.max(A,c.start||0)-i;if(p>0&&p<=2)return void this._trySkipBufferHole(null)}var f=self.performance.now();if(null!==r){var g=f-r;!o&&g>=250&&this._reportStall(c.len);var m=G.bufferInfo(n,i,t.maxBufferHole);this._tryFixBufferStall(m,g)}else this.stalled=f}}}else if(this.moved=!0,null!==r){if(this.stallReported){var v=self.performance.now()-r;l.logger.warn("playback not stuck anymore @"+i+", after "+Math.round(v)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},t._tryFixBufferStall=function(e,t){var n=this.config,r=this.fragmentTracker,i=this.media.currentTime,o=r.getPartialFragment(i);if(o&&this._trySkipBufferHole(o))return;e.len>n.maxBufferHole&&t>1e3*n.highBufferWatchdogPeriod&&(l.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},t._reportStall=function(e){var t=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,l.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+e+")"),t.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:e}))},t._trySkipBufferHole=function(e){for(var t=this.config,n=this.hls,r=this.media,i=r.currentTime,o=0,s=0;s<r.buffered.length;s++){var c=r.buffered.start(s);if(i+t.maxBufferHole>=o&&i<c){var A=Math.max(c+.05,r.currentTime+.1);return l.logger.warn("skipping hole, adjusting currentTime from "+i+" to "+A),this.moved=!0,this.stalled=null,r.currentTime=A,e&&n.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+i+" to "+A,frag:e}),A}o=r.buffered.end(s)}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,n=this.media,r=n.currentTime,i=(this.nudgeRetry||0)+1;if(this.nudgeRetry=i,i<e.nudgeMaxRetry){var o=r+i*e.nudgeOffset;l.logger.warn("Nudging 'currentTime' from "+r+" to "+o),n.currentTime=o,t.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else l.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+e.nudgeMaxRetry+" nudges"),t.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},e}();function pe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var fe=function(e){var t,n;function r(t){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return(n=e.call.apply(e,[this,t].concat(i))||this)._boundTick=void 0,n._tickTimer=null,n._tickInterval=null,n._tickCallCount=0,n._boundTick=n.tick.bind(pe(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},i.hasInterval=function(){return!!this._tickInterval},i.hasNextTick=function(){return!!this._tickTimer},i.setInterval=function(e){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,e),!0)},i.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},i.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},i.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&(this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)),this._tickCallCount=0)},i.doTick=function(){},r}(d);var ge="STOPPED",me="STARTING",ve="IDLE",ye="PAUSED",_e="KEY_LOADING",Ee="FRAG_LOADING",be="FRAG_LOADING_WAITING_RETRY",we="WAITING_TRACK",Se="PARSING",Te="PARSED",Ce="BUFFER_FLUSHING",Re="ENDED",Ie="ERROR",Oe="WAITING_INIT_PTS",xe="WAITING_LEVEL",Ne=function(e){var t,n;function r(){return e.apply(this,arguments)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.doTick=function(){},i.startLoad=function(){},i.stopLoad=function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragmentTracker.removeFragment(e)),this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=ge},i._streamEnded=function(e,t){var n=this.fragCurrent,r=this.fragmentTracker;if(!t.live&&n&&!n.backtracked&&n.sn===t.endSN&&!e.nextStart){var i=r.getState(n);return i===H||i===V}return!1},i.onMediaSeeking=function(){var e=this.config,t=this.media,n=this.mediaBuffer,r=this.state,i=t?t.currentTime:null,o=G.bufferInfo(n||t,i,this.config.maxBufferHole);if(l.logger.log("media seeking to "+(Object(c.isFiniteNumber)(i)?i.toFixed(3):i)),r===Ee){var s=this.fragCurrent;if(0===o.len&&s){var a=e.maxFragLookUpTolerance,u=s.start-a,A=s.start+s.duration+a;i<u||i>A?(s.loader&&(l.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),s.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=ve):l.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else r===Re&&(0===o.len&&(this.fragPrevious=null,this.fragCurrent=null),this.state=ve);t&&(this.lastCurrentTime=i),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=i),this.tick()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=ge,this.fragmentTracker=null},i.computeLivePosition=function(e,t){var n=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-n)},r}(fe);function Be(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Le,De=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.LEVEL_LOADED,u.default.LEVELS_UPDATED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_LOAD_EMERGENCY_ABORTED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_SWITCHED,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED)||this).fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=ge,r.stallReported=!1,r.gapController=null,r.altAudio=!1,r.audioOnly=!1,r.bitrateTest=!1,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,s,A,h=r.prototype;return h.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(n.config.testBandwidth?(r=0,this.bitrateTest=!0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}t>0&&-1===e&&(l.logger.log("override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=ve,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=ge},h.stopLoad=function(){this.forceStartLoad=!1,e.prototype.stopLoad.call(this)},h.doTick=function(){switch(this.state){case Ce:this.fragLoadError=0;break;case ve:this._doTickIdle();break;case xe:var e=this.levels[this.level];e&&e.details&&(this.state=ve);break;case be:var t=window.performance.now(),n=this.retryDate;(!n||t>=n||this.media&&this.media.seeking)&&(l.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=ve)}this._checkBuffer(),this._checkFragmentChanged()},h._doTickIdle=function(){var e=this.hls,t=e.config,n=this.media;if(void 0!==this.levelLastLoaded&&(n||!this.startFragRequested&&t.startFragPrefetch))if(this.altAudio&&this.audioOnly)this.demuxer.frag=null;else{var r;r=this.loadedmetadata?n.currentTime:this.nextLoadPosition;var i=e.nextLoadLevel,o=this.levels[i];if(o){var s,a=o.bitrate;s=a?Math.max(8*t.maxBufferSize/a,t.maxBufferLength):t.maxBufferLength,s=Math.min(s,t.maxMaxBufferLength);var c=r<t.maxBufferHole?Math.max(2,t.maxBufferHole):t.maxBufferHole,A=G.bufferInfo(this.mediaBuffer?this.mediaBuffer:n,r,c),h=A.len;if(!(h>=s)){l.logger.trace("buffer length of "+h.toFixed(3)+" is below max of "+s.toFixed(3)+". checking for more payload ..."),this.level=e.nextLoadLevel=i;var d=o.details;if(!d||d.live&&this.levelLastLoaded!==i)this.state=xe;else{if(this._streamEnded(A,d)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(u.default.BUFFER_EOS,p),void(this.state=Re)}this._fetchPayloadOrEos(r,A,d)}}}}},h._fetchPayloadOrEos=function(e,t,n){var r=this.fragPrevious,i=(this.level,n.fragments),o=i.length;if(0!==o){var s,a=i[0].start,c=i[o-1].start+i[o-1].duration,u=t.end;if(n.initSegment&&!n.initSegment.data)s=n.initSegment;else if(n.live){var A=this.config.initialLiveManifestSize;if(o<A)return void l.logger.warn("Can not start playback of a level, reason: not enough fragments "+o+" < "+A);if(null===(s=this._ensureFragmentAtLivePoint(n,u,a,c,r,i)))return}else u<a&&(s=i[0]);s||(s=this._findFragment(a,r,o,i,u,c,n)),s&&(s.encrypted?this._loadKey(s,n):this._loadFragment(s,n,e,u))}},h._ensureFragmentAtLivePoint=function(e,t,n,r,i,o){var s,a=this.hls.config,u=this.media,A=1/0;if(void 0!==a.liveMaxLatencyDuration?A=a.liveMaxLatencyDuration:Object(c.isFiniteNumber)(a.liveMaxLatencyDurationCount)&&(A=a.liveMaxLatencyDurationCount*e.targetduration),t<Math.max(n-a.maxFragLookUpTolerance,r-A)){var h=this.liveSyncPosition=this.computeLivePosition(n,e);t=h,u&&!u.paused&&u.readyState&&u.duration>h&&h>u.currentTime&&(l.logger.log("buffer end: "+t.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),u.currentTime=h),this.nextLoadPosition=h}if(e.PTSKnown&&t>r&&u&&u.readyState)return null;if(this.startFragRequested&&!e.PTSKnown&&i)if(e.hasProgramDateTime)l.logger.log("live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),s=ue(o,i.endProgramDateTime,a.maxFragLookUpTolerance);else{var d=i.sn+1;if(d>=e.startSN&&d<=e.endSN){var p=o[d-e.startSN];i.cc===p.cc&&(s=p,l.logger.log("live playlist, switching playlist, load frag with next SN: "+s.sn))}s||(s=j.search(o,(function(e){return i.cc-e.cc})))&&l.logger.log("live playlist, switching playlist, load frag with same CC: "+s.sn)}return s},h._findFragment=function(e,t,n,r,i,o,s){var a,c=this.hls.config;i<o?a=le(t,r,i,i>o-c.maxFragLookUpTolerance?0:c.maxFragLookUpTolerance):a=r[n-1];if(a){var u=a.sn-s.startSN,A=t&&a.level===t.level,h=r[u-1],d=r[u+1];if(t&&a.sn===t.sn)if(A&&!a.backtracked)if(a.sn<s.endSN){var p=t.deltaPTS;p&&p>c.maxBufferHole&&t.dropped&&u?(a=h,l.logger.warn("Previous fragment was dropped with large PTS gap between audio and video. Maybe fragment is not starting with a keyframe? Loading previous one to try to overcome this")):(a=d,this.fragmentTracker.getState(a)!==V&&l.logger.log("Re-loading fragment with SN: "+a.sn))}else a=null;else a.backtracked&&(d&&d.backtracked?(l.logger.warn("Already backtracked from fragment "+d.sn+", will not backtrack to fragment "+a.sn+". Loading fragment "+d.sn),a=d):(l.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),a.dropped=0,h?(a=h).backtracked=!0:u&&(a=null)))}return a},h._loadKey=function(e,t){l.logger.log("Loading key for "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level),this.state=_e,this.hls.trigger(u.default.KEY_LOADING,{frag:e})},h._loadFragment=function(e,t,n,r){var i=this.fragmentTracker.getState(e);this.fragCurrent=e,"initSegment"!==e.sn&&(this.startFragRequested=!0),Object(c.isFiniteNumber)(e.sn)&&!e.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),e.backtracked||i===U||i===H?(e.autoLevel=this.hls.autoLevelEnabled,e.bitrateTest=this.bitrateTest,l.logger.log("Loading "+e.sn+" of ["+t.startSN+"-"+t.endSN+"], level "+this.level+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+parseFloat(n.toFixed(3))+", bufferEnd: "+parseFloat(r.toFixed(3))),this.hls.trigger(u.default.FRAG_LOADING,{frag:e}),this.demuxer||(this.demuxer=new $(this.hls,"main")),this.state=Ee):i===F&&this._reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e)},h.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,o.MAIN)},h.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.endPTS+.5):null},h._checkFragmentChanged=function(){var e,t,n=this.media;if(n&&n.readyState&&!1===n.seeking&&((t=n.currentTime)>this.lastCurrentTime&&(this.lastCurrentTime=t),G.isBuffered(n,t)?e=this.getBufferedFrag(t):G.isBuffered(n,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var r=e;if(r!==this.fragPlaying){this.hls.trigger(u.default.FRAG_CHANGED,{frag:r});var i=r.level;this.fragPlaying&&this.fragPlaying.level===i||this.hls.trigger(u.default.LEVEL_SWITCHED,{level:i}),this.fragPlaying=r}}},h.immediateLevelSwitch=function(){if(l.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var e,t=this.media;t?(e=t.paused)||t.pause():e=!0,this.previouslyPaused=e}var n=this.fragCurrent;n&&n.loader&&n.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},h.immediateLevelSwitchEnd=function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,e.currentTime>0&&G.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())},h.nextLevelSwitch=function(){var e=this.media;if(e&&e.readyState){var t,n=this.getBufferedFrag(e.currentTime);if(n&&n.startPTS>1&&this.flushMainBuffer(0,n.startPTS-1),e.paused)t=0;else{var r=this.hls.nextLoadLevel,i=this.levels[r],o=this.fragLastKbps;t=o&&this.fragCurrent?this.fragCurrent.duration*i.bitrate/(1e3*o)+1:0}var s=this.getBufferedFrag(e.currentTime+t);if(s){var a=this.followingBufferedFrag(s);if(a){var c=this.fragCurrent;c&&c.loader&&c.loader.abort(),this.fragCurrent=null;var u=Math.max(s.endPTS,a.maxStartPTS+Math.min(this.config.maxFragLookUpTolerance,a.duration));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}},h.flushMainBuffer=function(e,t){this.state=Ce;var n={startOffset:e,endOffset:t};this.altAudio&&(n.type="video"),this.hls.trigger(u.default.BUFFER_FLUSHING,n)},h.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.hls.startLoad(n.startPosition),this.gapController=new de(n,t,this.fragmentTracker,this.hls)},h.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach((function(e){e.details&&e.details.fragments.forEach((function(e){e.backtracked=void 0}))})),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.fragmentTracker.removeAllFragments(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()},h.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:void 0;Object(c.isFiniteNumber)(t)&&l.logger.log("media seeked to "+t.toFixed(3)),this.tick()},h.onManifestLoading=function(){l.logger.log("trigger BUFFER_RESET"),this.hls.trigger(u.default.BUFFER_RESET),this.fragmentTracker.removeAllFragments(),this.stalled=!1,this.startPosition=this.lastCurrentTime=0},h.onManifestParsed=function(e){var t,n=!1,r=!1;e.levels.forEach((function(e){(t=e.audioCodec)&&(-1!==t.indexOf("mp4a.40.2")&&(n=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))})),this.audioCodecSwitch=n&&r,this.audioCodecSwitch&&l.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.altAudio=e.altAudio,this.levels=e.levels,this.startFragRequested=!1;var i=this.config;(i.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(i.startPosition)},h.onLevelLoaded=function(e){var t=e.details,n=e.level,r=this.levels[this.levelLastLoaded],i=this.levels[n],o=t.totalduration,s=0;if(l.logger.log("level "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+o),t.live){var a=i.details;a&&t.fragments.length>0?(re(a,t),s=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(s,a),t.PTSKnown&&Object(c.isFiniteNumber)(s)?l.logger.log("live playlist sliding:"+s.toFixed(3)):(l.logger.log("live playlist - outdated PTS, unknown sliding"),ce(this.fragPrevious,r,t))):(l.logger.log("live playlist - first load, unknown sliding"),t.PTSKnown=!1,ce(this.fragPrevious,r,t))}else t.PTSKnown=!1;if(i.details=t,this.levelLastLoaded=n,this.hls.trigger(u.default.LEVEL_UPDATED,{details:t,level:n}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var A=t.startTimeOffset;Object(c.isFiniteNumber)(A)?(A<0&&(l.logger.log("negative start time offset "+A+", count from end of last fragment"),A=s+o+A),l.logger.log("start time offset found in playlist, adjust startPosition to "+A),this.startPosition=A):t.live?(this.startPosition=this.computeLivePosition(s,t),l.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0,this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===xe&&(this.state=ve),this.tick()},h.onKeyLoaded=function(){this.state===_e&&(this.state=ve,this.tick())},h.onFragLoaded=function(e){var t=this.fragCurrent,n=this.hls,r=this.levels,i=this.media,o=e.frag;if(this.state===Ee&&t&&"main"===o.type&&o.level===t.level&&o.sn===t.sn){var s=e.stats,a=r[t.level],c=a.details;if(this.bitrateTest=!1,this.stats=s,l.logger.log("Loaded "+t.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+t.level),o.bitrateTest&&n.nextLoadLevel)this.state=ve,this.startFragRequested=!1,s.tparsed=s.tbuffered=window.performance.now(),n.trigger(u.default.FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else if("initSegment"===o.sn)this.state=ve,s.tparsed=s.tbuffered=window.performance.now(),c.initSegment.data=e.payload,n.trigger(u.default.FRAG_BUFFERED,{stats:s,frag:t,id:"main"}),this.tick();else{l.logger.log("Parsing "+t.sn+" of ["+c.startSN+" ,"+c.endSN+"],level "+t.level+", cc "+t.cc),this.state=Se,this.pendingBuffering=!0,this.appended=!1,o.bitrateTest&&(o.bitrateTest=!1,this.fragmentTracker.onFragLoaded({frag:o}));var A=!(i&&i.seeking)&&(c.PTSKnown||!c.live),h=c.initSegment?c.initSegment.data:[],d=this._getAudioCodec(a);(this.demuxer=this.demuxer||new $(this.hls,"main")).push(e.payload,h,d,a.videoCodec,t,c.totalduration,A)}}this.fragLoadError=0},h.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Se){var r,i,o=e.tracks;if(this.audioOnly=o.audio&&!o.video,this.altAudio&&!this.audioOnly&&delete o.audio,i=o.audio){var s=this.levels[this.level].audioCodec,a=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(l.logger.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==i.metadata.channelCount&&-1===a.indexOf("firefox")&&(s="mp4a.40.5"),-1!==a.indexOf("android")&&"audio/mpeg"!==i.container&&(s="mp4a.40.2",l.logger.log("Android: force audio codec to "+s)),i.levelCodec=s,i.id=e.id}for(r in(i=o.video)&&(i.levelCodec=this.levels[this.level].videoCodec,i.id=e.id),this.hls.trigger(u.default.BUFFER_CODECS,o),o){i=o[r],l.logger.log("main track:"+r+",container:"+i.container+",codecs[level/parsed]=["+i.levelCodec+"/"+i.codec+"]");var c=i.initSegment;c&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,{type:r,data:c,parent:"main",content:"initSegment"}))}this.tick()}},h.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"main"===e.id&&r.sn===n.sn&&r.level===n.level&&("audio"!==e.type||!this.altAudio)&&this.state===Se){var i=this.levels[this.level],o=n;if(Object(c.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),!0===e.hasAudio&&o.addElementaryStream(g.AUDIO),!0===e.hasVideo&&o.addElementaryStream(g.VIDEO),l.logger.log("Parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb+",dropped:"+(e.dropped||0)),"video"===e.type)if(o.dropped=e.dropped,o.dropped)if(o.backtracked)l.logger.warn("Already backtracked on this fragment, appending with the gap",o.sn);else{var s=i.details;if(!s||o.sn!==s.startSN)return l.logger.warn("missing video frame(s), backtracking fragment",o.sn),this.fragmentTracker.removeFragment(o),o.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=ve,this.fragPrevious=o,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),void this.tick();l.logger.warn("missing video frame(s) on first frag, appending with gap",o.sn)}else o.backtracked=!1;var a=ne(i.details,o,e.startPTS,e.endPTS,e.startDTS,e.endDTS),A=this.hls;A.trigger(u.default.LEVEL_PTS_UPDATED,{details:i.details,level:this.level,drift:a,type:e.type,start:e.startPTS,end:e.endPTS}),[e.data1,e.data2].forEach((function(n){n&&n.length&&t.state===Se&&(t.appended=!0,t.pendingBuffering=!0,A.trigger(u.default.BUFFER_APPENDING,{type:e.type,data:n,parent:"main",content:"data"}))})),this.tick()}},h.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"main"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Se&&(this.stats.tparsed=window.performance.now(),this.state=Te,this._checkAppendedParsed())},h.onAudioTrackSwitching=function(e){var t=this.altAudio,n=!!e.url,r=e.id;if(!n){if(this.mediaBuffer!==this.media){l.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(l.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=ve}var o=this.hls;t&&o.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),o.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:r})}},h.onAudioTrackSwitched=function(e){var t=e.id,n=!!this.hls.audioTracks[t].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(l.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()},h.onBufferCreated=function(e){var t,n,r=e.tracks,i=!1;for(var o in r){var s=r[o];"main"===s.id?(n=o,t=s,"video"===o&&(this.videoBuffer=r[o].buffer)):i=!0}i&&t?(l.logger.log("alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=t.buffer):this.mediaBuffer=this.media},h.onBufferAppended=function(e){if("main"===e.parent){var t=this.state;t!==Se&&t!==Te||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},h._checkAppendedParsed=function(){if(!(this.state!==Te||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;l.logger.log("main buffered : "+se.toString(t.buffered)),this.fragPrevious=e;var n=this.stats;n.tbuffered=window.performance.now(),this.fragLastKbps=Math.round(8*n.total/(n.tbuffered-n.tfirst)),this.hls.trigger(u.default.FRAG_BUFFERED,{stats:n,frag:e,id:"main"}),this.state=ve}(this.loadedmetadata||this.startPosition<=0)&&this.tick()}},h.onError=function(e){var t=e.frag||this.fragCurrent;if(!t||"main"===t.type){var n=!!this.media&&G.isBuffered(this.media,this.media.currentTime)&&G.isBuffered(this.media,this.media.currentTime+.5);switch(e.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal)if(this.fragLoadError+1<=this.config.fragLoadingMaxRetry){var r=Math.min(Math.pow(2,this.fragLoadError)*this.config.fragLoadingRetryDelay,this.config.fragLoadingMaxRetryTimeout);l.logger.warn("mediaController: frag loading failed, retry in "+r+" ms"),this.retryDate=window.performance.now()+r,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.fragLoadError++,this.state=be}else l.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Ie;break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==Ie&&(e.fatal?(this.state=Ie,l.logger.warn("streamController: "+e.details+",switch to "+this.state+" state ...")):e.levelRetry||this.state!==xe||(this.state=ve));break;case a.ErrorDetails.BUFFER_FULL_ERROR:"main"!==e.parent||this.state!==Se&&this.state!==Te||(n?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=ve):(l.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}},h._reduceMaxBufferLength=function(e){var t=this.config;return t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,l.logger.warn("main:reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},h._checkBuffer=function(){var e=this.media;if(e&&0!==e.readyState){var t=(this.mediaBuffer?this.mediaBuffer:e).buffered;!this.loadedmetadata&&t.length?(this.loadedmetadata=!0,this._seekToStartPos()):this.immediateSwitch?this.immediateLevelSwitchEnd():this.gapController.poll(this.lastCurrentTime,t)}},h.onFragLoadEmergencyAborted=function(){this.state=ve,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()},h.onBufferFlushed=function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;if(e){var t=this.audioOnly?g.AUDIO:g.VIDEO;this.fragmentTracker.detectEvictedFragments(t,e.buffered)}this.state=ve,this.fragPrevious=null},h.onLevelsUpdated=function(e){this.levels=e.levels},h.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},h._seekToStartPos=function(){var e=this.media,t=e.currentTime,n=this.startPosition;if(t!==n&&n>=0){if(e.seeking)return void l.logger.log("could not seek to "+n+", already seeking at "+t);var r=(e.buffered.length?e.buffered.start(0):0)-n;r>0&&r<this.config.maxBufferHole&&(l.logger.log("adjusting start position by "+r+" to match buffer start"),n+=r,this.startPosition=n),l.logger.log("seek to target start position "+n+" from current time "+t+". ready state "+e.readyState),e.currentTime=n}},h._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&(l.logger.log("swapping playlist audio codec"),t&&(t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),t},i=r,(s=[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,l.logger.log("main stream-controller: "+t+"->"+e),this.hls.trigger(u.default.STREAM_STATE_TRANSITION,{previousState:t,nextState:e})}},get:function(){return this._state}},{key:"currentLevel",get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1}},{key:"nextBufferedFrag",get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"liveSyncPosition",get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e}}])&&Be(i.prototype,s),A&&Be(i,A),r}(Ne);function Me(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Pe=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.FRAG_LOADED,u.default.ERROR)||this).canload=!1,n.currentLevelIndex=null,n.manualLevelIndex=-1,n.timer=null,Le=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,s,c=r.prototype;return c.onHandlerDestroying=function(){this.clearTimer(),this.manualLevelIndex=-1},c.clearTimer=function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)},c.startLoad=function(){var e=this._levels;this.canload=!0,this.levelRetryCount=0,e&&e.forEach((function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)})),null!==this.timer&&this.loadLevel()},c.stopLoad=function(){this.canload=!1},c.onManifestLoaded=function(e){var t,n=[],r=[],i={},o=null,s=!1,c=!1;if(e.levels.forEach((function(e){var t=e.attrs;e.loadError=0,e.fragmentError=!1,s=s||!!e.videoCodec,c=c||!!e.audioCodec,Le&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(o=i[e.bitrate])?o.url.push(e.url):(e.url=[e.url],e.urlId=0,i[e.bitrate]=e,n.push(e)),t&&(t.AUDIO&&ee(o||e,"audio",t.AUDIO),t.SUBTITLES&&ee(o||e,"text",t.SUBTITLES))})),s&&c&&(n=n.filter((function(e){return!!e.videoCodec}))),n=n.filter((function(e){var t=e.audioCodec,n=e.videoCodec;return(!t||C(t,"audio"))&&(!n||C(n,"video"))})),e.audioTracks&&(r=e.audioTracks.filter((function(e){return!e.audioCodec||C(e.audioCodec,"audio")}))).forEach((function(e,t){e.id=t})),n.length>0){t=n[0].bitrate,n.sort((function(e,t){return e.bitrate-t.bitrate})),this._levels=n;for(var A=0;A<n.length;A++)if(n[A].bitrate===t){this._firstLevel=A,l.logger.log("manifest loaded,"+n.length+" level(s) found, first bitrate:"+t);break}var h=c&&!s;this.hls.trigger(u.default.MANIFEST_PARSED,{levels:n,audioTracks:r,firstLevel:this._firstLevel,stats:e.stats,audio:c,video:s,altAudio:!h&&r.some((function(e){return!!e.url}))})}else this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:this.hls.url,reason:"no level with compatible codecs found in manifest"})},c.setLevelInternal=function(e){var t=this._levels,n=this.hls;if(e>=0&&e<t.length){if(this.clearTimer(),this.currentLevelIndex!==e){l.logger.log("switching to level "+e),this.currentLevelIndex=e;var r=t[e];r.level=e,n.trigger(u.default.LEVEL_SWITCHING,r)}var i=t[e],o=i.details;if(!o||o.live){var s=i.urlId;n.trigger(u.default.LEVEL_LOADING,{url:i.url[s],level:e,id:s})}}else n.trigger(u.default.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})},c.onError=function(e){if(e.fatal)e.type===a.ErrorTypes.NETWORK_ERROR&&this.clearTimer();else{var t,n=!1,r=!1;switch(e.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level,r=!0;break;case a.ErrorDetails.LEVEL_LOAD_ERROR:case a.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.context.level,n=!0;break;case a.ErrorDetails.REMUX_ALLOC_ERROR:t=e.level,n=!0}void 0!==t&&this.recoverLevel(e,t,n,r)}},c.recoverLevel=function(e,t,n,r){var i,o,s,a=this,c=this.hls.config,u=e.details,A=this._levels[t];if(A.loadError++,A.fragmentError=r,n){if(!(this.levelRetryCount+1<=c.levelLoadingMaxRetry))return l.logger.error("level controller, cannot recover from "+u+" error"),this.currentLevelIndex=null,this.clearTimer(),void(e.fatal=!0);o=Math.min(Math.pow(2,this.levelRetryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout),this.timer=setTimeout((function(){return a.loadLevel()}),o),e.levelRetry=!0,this.levelRetryCount++,l.logger.warn("level controller, "+u+", retry in "+o+" ms, current retry count is "+this.levelRetryCount)}(n||r)&&((i=A.url.length)>1&&A.loadError<i?(A.urlId=(A.urlId+1)%i,A.details=void 0,l.logger.warn("level controller, "+u+" for level "+t+": switching to redundant URL-id "+A.urlId)):-1===this.manualLevelIndex?(s=0===t?this._levels.length-1:t-1,l.logger.warn("level controller, "+u+": switch to "+s),this.hls.nextAutoLevel=this.currentLevelIndex=s):r&&(l.logger.warn("level controller, "+u+": reload a fragment"),this.currentLevelIndex=null))},c.onFragLoaded=function(e){var t=e.frag;if(void 0!==t&&"main"===t.type){var n=this._levels[t.level];void 0!==n&&(n.fragmentError=!1,n.loadError=0,this.levelRetryCount=0)}},c.onLevelLoaded=function(e){var t=this,n=e.level,r=e.details;if(n===this.currentLevelIndex){var i=this._levels[n];if(i.fragmentError||(i.loadError=0,this.levelRetryCount=0),r.live){var o=oe(i.details,r,e.stats.trequest);l.logger.log("live playlist, reload in "+Math.round(o)+" ms"),this.timer=setTimeout((function(){return t.loadLevel()}),o)}else this.clearTimer()}},c.onAudioTrackSwitched=function(e){var t=this.hls.audioTracks[e.id].groupId,n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=0;i<n.audioGroupIds.length;i++)if(n.audioGroupIds[i]===t){r=i;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},c.loadLevel=function(){if(l.logger.debug("call to loadLevel"),null!==this.currentLevelIndex&&this.canload){var e=this._levels[this.currentLevelIndex];if("object"==typeof e&&e.url.length>0){var t=this.currentLevelIndex,n=e.urlId,r=e.url[n];l.logger.log("Attempt loading level index "+t+" with URL-id "+n),this.hls.trigger(u.default.LEVEL_LOADING,{url:r,level:t,id:n})}}},c.removeLevel=function(e,t){var n=this.levels.filter((function(n,r){return r!==e||n.url.length>1&&void 0!==t&&(n.url=n.url.filter((function(e,n){return n!==t})),n.urlId=0,!0)})).map((function(e,t){var n=e.details;return n&&n.fragments&&n.fragments.forEach((function(e){e.level=t})),e}));this._levels=n,this.hls.trigger(u.default.LEVELS_UPDATED,{levels:n})},i=r,(o=[{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;t&&(e=Math.min(e,t.length-1),this.currentLevelIndex===e&&t[e].details||this.setLevelInternal(e))}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}])&&Me(i.prototype,o),s&&Me(i,s),r}(d),ke=n("./src/demux/id3.js");function Ue(e,t){var n;try{n=new Event("addtrack")}catch(e){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=e,t.dispatchEvent(n)}function Fe(e){if(null==e?void 0:e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}var He=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_METADATA,u.default.LIVE_BACK_BUFFER_REACHED)||this).id3Track=void 0,n.media=void 0,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){d.prototype.destroy.call(this)},i.onMediaAttached=function(e){this.media=e.media,this.media},i.onMediaDetaching=function(){Fe(this.id3Track),this.id3Track=void 0,this.media=void 0},i.getID3Track=function(e){for(var t=0;t<e.length;t++){var n=e[t];if("metadata"===n.kind&&"id3"===n.label)return Ue(n,this.media),n}return this.media.addTextTrack("metadata","id3")},i.onFragParsingMetadata=function(e){var t=e.frag,n=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var r=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,i=0;i<n.length;i++){var o=ke.default.getID3Frames(n[i].data);if(o){var s=Math.max(n[i].pts,0),a=i<n.length-1?n[i+1].pts:t.endPTS;a||(a=t.start+t.duration),a-s<=0&&(a=s+.25);for(var c=0;c<o.length;c++){var u=o[c];if(!ke.default.isTimeStampFrame(u)){var l=new r(s,a,"");l.value=u,this.id3Track.addCue(l)}}}}},i.onLiveBackBufferReached=function(e){var t=e.bufferEnd,n=this.id3Track;if(n&&n.cues&&n.cues.length){var r=function(e,t){if(t<e[0].endTime)return e[0];if(t>e[e.length-1].endTime)return e[e.length-1];for(var n=0,r=e.length-1;n<=r;){var i=Math.floor((r+n)/2);if(t<e[i].endTime)r=i-1;else{if(!(t>e[i].endTime))return e[i];n=i+1}}return e[n].endTime-t<t-e[r].endTime?e[n]:e[r]}(n.cues,t);if(r)for(;n.cues[0]!==r;)n.removeCue(n.cues[0])}},r}(d);var Ve=function(){function e(e){this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=0,this.totalWeight_=0}var t=e.prototype;return t.sample=function(e,t){var n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_},e}(),Qe=function(){function e(e,t,n,r){this.hls=void 0,this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.hls=e,this.defaultEstimate_=r,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Ve(t),this.fast_=new Ve(n)}var t=e.prototype;return t.sample=function(e,t){var n=(e=Math.max(e,this.minDelayMs_))/1e3,r=8*t/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},t.canEstimate=function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.destroy=function(){},e}();function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ge=window.performance,Ke=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR)||this).lastLoadedFragLevel=0,n._nextAutoLevel=-1,n.hls=t,n.timer=null,n._bwEstimator=null,n.onCheck=n._abandonRulesCheck.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,s,A=r.prototype;return A.destroy=function(){this.clearTimer(),d.prototype.destroy.call(this)},A.onFragLoading=function(e){var t=e.frag;if("main"===t.type&&(this.timer||(this.fragCurrent=t,this.timer=setInterval(this.onCheck,100)),!this._bwEstimator)){var n,r,i=this.hls,o=i.config,s=t.level;i.levels[s].details.live?(n=o.abrEwmaFastLive,r=o.abrEwmaSlowLive):(n=o.abrEwmaFastVoD,r=o.abrEwmaSlowVoD),this._bwEstimator=new Qe(i,r,n,o.abrEwmaDefaultEstimate)}},A._abandonRulesCheck=function(){var e=this.hls,t=e.media,n=this.fragCurrent;if(n){var r=n.loader;if(!r||r.stats&&r.stats.aborted)return l.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);var i=r.stats;if(t&&i&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&n.autoLevel&&n.level){var o=Ge.now()-i.trequest,s=Math.abs(t.playbackRate);if(o>500*n.duration/s){var a=e.levels,c=Math.max(1,i.bw?i.bw/8:1e3*i.loaded/o),A=a[n.level];if(!A)return;var h=A.realBitrate?Math.max(A.realBitrate,A.bitrate):A.bitrate,d=i.total?i.total:Math.max(i.loaded,Math.round(n.duration*h/8)),p=t.currentTime,f=(d-i.loaded)/c,g=(G.bufferInfo(t,p,e.config.maxBufferHole).end-p)/s;if(g<2*n.duration/s&&f>g){var m,v,y=e.minAutoLevel;for(v=n.level-1;v>y;v--){var _=a[v].realBitrate?Math.max(a[v].realBitrate,a[v].bitrate):a[v].bitrate;if(n.duration*_/(6.4*c)<g)break}m<f&&(l.logger.warn("loading too slow, abort fragment loading and switch to level "+v+":fragLoadedDelay["+v+"]<fragLoadedDelay["+(n.level-1)+"];bufferStarvationDelay:"+m.toFixed(1)+"<"+f.toFixed(1)+":"+g.toFixed(1)),e.nextLoadLevel=v,this._bwEstimator.sample(o,i.loaded),r.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:n,stats:i}))}}}}},A.onFragLoaded=function(e){var t=e.frag;if("main"===t.type&&Object(c.isFiniteNumber)(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var n=this.hls.levels[t.level],r=(n.loaded?n.loaded.bytes:0)+e.stats.loaded,i=(n.loaded?n.loaded.duration:0)+e.frag.duration;n.loaded={bytes:r,duration:i},n.realBitrate=Math.round(8*r/i)}if(e.frag.bitrateTest){var o=e.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(e)}}},A.onFragBuffered=function(e){var t=e.stats,n=e.frag;if(!0!==t.aborted&&"main"===n.type&&Object(c.isFiniteNumber)(n.sn)&&(!n.bitrateTest||t.tload===t.tbuffered)){var r=t.tparsed-t.trequest;l.logger.log("latency/loading/parsing/append/kbps:"+Math.round(t.tfirst-t.trequest)+"/"+Math.round(t.tload-t.tfirst)+"/"+Math.round(t.tparsed-t.tload)+"/"+Math.round(t.tbuffered-t.tparsed)+"/"+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(r,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=r/1e3:this.bitrateTestDelay=0}},A.onError=function(e){switch(e.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},A.clearTimer=function(){clearInterval(this.timer),this.timer=null},A._findBestLevel=function(e,t,n,r,i,o,s,a,c){for(var u=i;u>=r;u--){var A=c[u];if(A){var h=A.details,d=h?h.totalduration/h.fragments.length:t,p=!!h&&h.live,f=void 0;f=u<=e?s*n:a*n;var g=c[u].realBitrate?Math.max(c[u].realBitrate,c[u].bitrate):c[u].bitrate,m=g*d/f;if(l.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+u+"/"+Math.round(f)+"/"+g+"/"+d+"/"+o+"/"+m),f>g&&(!m||p&&!this.bitrateTestDelay||m<o))return u}}return-1},i=r,(o=[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var n=this._nextABRAutoLevel;return-1!==e&&(n=Math.min(e,n)),n},set:function(e){this._nextAutoLevel=e}},{key:"_nextABRAutoLevel",get:function(){var e=this.hls,t=e.maxAutoLevel,n=e.levels,r=e.config,i=e.minAutoLevel,o=e.media,s=this.lastLoadedFragLevel,a=this.fragCurrent?this.fragCurrent.duration:0,c=o?o.currentTime:0,u=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,A=this._bwEstimator?this._bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,h=(G.bufferInfo(o,c,r.maxBufferHole).end-c)/u,d=this._findBestLevel(s,a,A,i,t,h,r.abrBandWidthFactor,r.abrBandWidthUpFactor,n);if(d>=0)return d;l.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=a?Math.min(a,r.maxStarvationDelay):r.maxStarvationDelay,f=r.abrBandWidthFactor,g=r.abrBandWidthUpFactor;if(0===h){var m=this.bitrateTestDelay;m&&(p=(a?Math.min(a,r.maxLoadingDelay):r.maxLoadingDelay)-m,l.logger.trace("bitrate test took "+Math.round(1e3*m)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),f=g=1)}return d=this._findBestLevel(s,a,A,i,t,h+p,f,g,n),Math.max(d,0)}}])&&je(i.prototype,o),s&&je(i,s),r}(d);var We=q(),ze=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED)||this)._msDuration=null,n._levelDuration=null,n._levelTargetDuration=10,n._live=null,n._objectUrl=null,n._needsFlush=!1,n._needsEos=!1,n.config=void 0,n.audioTimestampOffset=void 0,n.bufferCodecEventsExpected=0,n._bufferCodecEventsTotal=0,n.media=null,n.mediaSource=null,n.segments=[],n.parent=void 0,n.appending=!1,n.appended=0,n.appendError=0,n.flushBufferCounter=0,n.tracks={},n.pendingTracks={},n.sourceBuffer={},n.flushRange=[],n._onMediaSourceOpen=function(){l.logger.log("media source opened"),n.hls.trigger(u.default.MEDIA_ATTACHED,{media:n.media});var e=n.mediaSource;e&&e.removeEventListener("sourceopen",n._onMediaSourceOpen),n.checkPendingTracks()},n._onMediaSourceClose=function(){l.logger.log("media source closed")},n._onMediaSourceEnded=function(){l.logger.log("media source ended")},n._onSBUpdateEnd=function(){if(n.audioTimestampOffset&&n.sourceBuffer.audio){var e=n.sourceBuffer.audio;l.logger.warn("change mpeg audio timestamp offset from "+e.timestampOffset+" to "+n.audioTimestampOffset),e.timestampOffset=n.audioTimestampOffset,delete n.audioTimestampOffset}n._needsFlush&&n.doFlush(),n._needsEos&&n.checkEos(),n.appending=!1;var t=n.parent,r=n.segments.reduce((function(e,n){return n.parent===t?e+1:e}),0),i={},o=n.sourceBuffer;for(var s in o){var a=o[s];if(!a)throw Error("handling source buffer update end error: source buffer for "+s+" uninitilized and unable to update buffered TimeRanges.");i[s]=a.buffered}n.hls.trigger(u.default.BUFFER_APPENDED,{parent:t,pending:r,timeRanges:i}),n._needsFlush||n.doAppending(),n.updateMediaElementDuration(),0===r&&n.flushLiveBackBuffer()},n._onSBUpdateError=function(e){l.logger.error("sourceBuffer error:",e),n.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})},n.config=t.config,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){d.prototype.destroy.call(this)},i.onLevelPtsUpdated=function(e){var t=e.type,n=this.tracks.audio;if("audio"===t&&n&&"audio/mpeg"===n.container){var r=this.sourceBuffer.audio;if(!r)throw Error("Level PTS Updated and source buffer for audio uninitalized");if(Math.abs(r.timestampOffset-e.start)>.1){var i=r.updating;try{r.abort()}catch(e){l.logger.warn("can not abort audio buffer: "+e)}i?this.audioTimestampOffset=e.start:(l.logger.warn("change mpeg audio timestamp offset from "+r.timestampOffset+" to "+e.start),r.timestampOffset=e.start)}}},i.onManifestParsed=function(e){var t=2;(e.audio&&!e.video||!e.altAudio)&&(t=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=t,l.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},i.onMediaAttaching=function(e){var t=this.media=e.media;if(t&&We){var n=this.mediaSource=new We;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),t.src=window.URL.createObjectURL(n),this._objectUrl=t.src}},i.onMediaDetaching=function(){l.logger.log("media source detaching");var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(e){l.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),this.media&&(this._objectUrl&&window.URL.revokeObjectURL(this._objectUrl),this.media.src===this._objectUrl?(this.media.removeAttribute("src"),this.media.load()):l.logger.warn("media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.hls.trigger(u.default.MEDIA_DETACHED)},i.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.pendingTracks,n=Object.keys(t).length;(n&&!e||2===n)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())},i.onBufferReset=function(){var e=this.sourceBuffer;for(var t in e){var n=e[t];try{n&&(this.mediaSource&&this.mediaSource.removeSourceBuffer(n),n.removeEventListener("updateend",this._onSBUpdateEnd),n.removeEventListener("error",this._onSBUpdateError))}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0},i.onBufferCodecs=function(e){var t=this;Object.keys(this.sourceBuffer).length||(Object.keys(e).forEach((function(n){t.pendingTracks[n]=e[n]})),this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},i.createSourceBuffers=function(e){var t=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");for(var r in e)if(!t[r]){var i=e[r];if(!i)throw Error("source buffer exists for track "+r+", however track does not");var o=i.levelCodec||i.codec,s=i.container+";codecs="+o;l.logger.log("creating sourceBuffer("+s+")");try{var c=t[r]=n.addSourceBuffer(s);c.addEventListener("updateend",this._onSBUpdateEnd),c.addEventListener("error",this._onSBUpdateError),this.tracks[r]={buffer:c,codec:o,id:i.id,container:i.container,levelCodec:i.levelCodec}}catch(e){l.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:this.tracks})},i.onBufferAppending=function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())},i.onBufferEos=function(e){for(var t in this.sourceBuffer)if(!e.type||e.type===t){var n=this.sourceBuffer[t];n&&!n.ended&&(n.ended=!0,l.logger.log(t+" sourceBuffer now EOS"))}this.checkEos()},i.checkEos=function(){var e=this.sourceBuffer,t=this.mediaSource;if(t&&"open"===t.readyState){for(var n in e){var r=e[n];if(r){if(!r.ended)return;if(r.updating)return void(this._needsEos=!0)}}l.logger.log("all media data are available, signal endOfStream() to MediaSource and stop loading fragment");try{t.endOfStream()}catch(e){l.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}else this._needsEos=!1},i.onBufferFlushing=function(e){e.type?this.flushRange.push({start:e.startOffset,end:e.endOffset,type:e.type}):(this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"video"}),this.flushRange.push({start:e.startOffset,end:e.endOffset,type:"audio"})),this.flushBufferCounter=0,this.doFlush()},i.flushLiveBackBuffer=function(){if(this._live){var e=this.config.liveBackBufferLength;if(isFinite(e)&&!(e<0))if(this.media)for(var t=this.media.currentTime,n=this.sourceBuffer,r=Object.keys(n),i=t-Math.max(e,this._levelTargetDuration),o=r.length-1;o>=0;o--){var s=r[o],a=n[s];if(a){var c=a.buffered;c.length>0&&i>c.start(0)&&this.removeBufferRange(s,a,0,i)&&this.hls.trigger(u.default.LIVE_BACK_BUFFER_REACHED,{bufferEnd:i})}}else l.logger.error("flushLiveBackBuffer called without attaching media")}},i.onLevelUpdated=function(e){var t=e.details;t.fragments.length>0&&(this._levelDuration=t.totalduration+t.fragments[0].start,this._levelTargetDuration=t.averagetargetduration||t.targetduration||10,this._live=t.live,this.updateMediaElementDuration())},i.updateMediaElementDuration=function(){var e,t=this.config;if(null!==this._levelDuration&&this.media&&this.mediaSource&&this.sourceBuffer&&0!==this.media.readyState&&"open"===this.mediaSource.readyState){for(var n in this.sourceBuffer){var r=this.sourceBuffer[n];if(r&&!0===r.updating)return}e=this.media.duration,null===this._msDuration&&(this._msDuration=this.mediaSource.duration),!0===this._live&&!0===t.liveDurationInfinity?(l.logger.log("Media Source duration is set to Infinity"),this._msDuration=this.mediaSource.duration=1/0):(this._levelDuration>this._msDuration&&this._levelDuration>e||!Object(c.isFiniteNumber)(e))&&(l.logger.log("Updating Media Source duration to "+this._levelDuration.toFixed(3)),this._msDuration=this.mediaSource.duration=this._levelDuration)}},i.doFlush=function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,n=this.sourceBuffer;try{for(var r in n){var i=n[r];i&&(t+=i.buffered.length)}}catch(e){l.logger.error("error while accessing sourceBuffer.buffered")}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}},i.doAppending=function(){var e=this.config,t=this.hls,n=this.segments,r=this.sourceBuffer;if(Object.keys(r).length){if(!this.media||this.media.error)return this.segments=[],void l.logger.error("trying to append although a media error occured, flush segment and abort");if(!this.appending){var i=n.shift();if(i)try{var o=r[i.type];if(!o)return void this._onSBUpdateEnd();if(o.updating)return void n.unshift(i);o.ended=!1,this.parent=i.parent,o.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0}catch(r){l.logger.error("error while trying to append buffer:"+r.message),n.unshift(i);var s={type:a.ErrorTypes.MEDIA_ERROR,parent:i.parent,details:"",fatal:!1};22===r.code?(this.segments=[],s.details=a.ErrorDetails.BUFFER_FULL_ERROR):(this.appendError++,s.details=a.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.appendErrorMaxRetry&&(l.logger.log("fail "+e.appendErrorMaxRetry+" times to append segment in sourceBuffer"),this.segments=[],s.fatal=!0)),t.trigger(u.default.ERROR,s)}}}},i.flushBuffer=function(e,t,n){var r=this.sourceBuffer;if(!Object.keys(r).length)return!0;var i="null";if(this.media&&(i=this.media.currentTime.toFixed(3)),l.logger.log("flushBuffer,pos/start/end: "+i+"/"+e+"/"+t),this.flushBufferCounter>=this.appended)return l.logger.warn("abort flushing too many retries"),!0;var o=r[n];if(o){if(o.ended=!1,o.updating)return l.logger.warn("cannot flush, sb updating in progress"),!1;if(this.removeBufferRange(n,o,e,t))return this.flushBufferCounter++,!1}return l.logger.log("buffer flushed"),!0},i.removeBufferRange=function(e,t,n,r){try{for(var i=0;i<t.buffered.length;i++){var o=t.buffered.start(i),s=t.buffered.end(i),a=Math.max(o,n),c=Math.min(s,r);if(Math.min(c,s)-a>.5){var u="null";return this.media&&(u=this.media.currentTime.toString()),l.logger.log("sb remove "+e+" ["+a+","+c+"], of ["+o+","+s+"], pos:"+u),t.remove(a,c),!0}}}catch(e){l.logger.warn("removeBufferRange failed",e)}return!1},r}(d);function qe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ye=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED,u.default.LEVELS_UPDATED,u.default.BUFFER_CODECS,u.default.MEDIA_DETACHING)||this).autoLevelCapping=Number.POSITIVE_INFINITY,n.firstLevel=null,n.levels=[],n.media=null,n.restrictedLevels=[],n.timer=null,n.clientRect=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,s,a=r.prototype;return a.destroy=function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.clientRect=null,this.stopCapping())},a.onFpsDropLevelCapping=function(e){r.isLevelAllowed(e.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(e.droppedLevel)},a.onMediaAttaching=function(e){this.media=e.media instanceof window.HTMLVideoElement?e.media:null},a.onManifestParsed=function(e){var t=this.hls;this.restrictedLevels=[],this.levels=e.levels,this.firstLevel=e.firstLevel,t.config.capLevelToPlayerSize&&e.video&&this.startCapping()},a.onBufferCodecs=function(e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},a.onLevelsUpdated=function(e){this.levels=e.levels},a.onMediaDetaching=function(){this.stopCapping()},a.detectPlayerSize=function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},a.getMaxLevel=function(e){var t=this;if(!this.levels)return-1;var n=this.levels.filter((function(n,i){return r.isLevelAllowed(i,t.restrictedLevels)&&i<=e}));return this.clientRect=null,r.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)},a.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},a.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer),this.timer=null)},a.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t},r.isLevelAllowed=function(e,t){return void 0===t&&(t=[]),-1===t.indexOf(e)},r.getMaxLevelByMediaSize=function(e,t,n){if(!e||e&&!e.length)return-1;for(var r,i,o=e.length-1,s=0;s<e.length;s+=1){var a=e[s];if((a.width>=t||a.height>=n)&&(r=a,!(i=e[s+1])||r.width!==i.width||r.height!==i.height)){o=s;break}}return o},i=r,s=[{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e}}],(o=[{key:"mediaWidth",get:function(){return this.getDimensions().width*r.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*r.contentScaleFactor}}])&&qe(i.prototype,o),s&&qe(i,s),r}(d);var Xe=window.performance,Je=function(e){var t,n;function r(t){return e.call(this,t,u.default.MEDIA_ATTACHING)||this}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.destroy=function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1},i.onMediaAttaching=function(e){var t=this.hls.config;t.capLevelOnFPSDrop&&("function"==typeof(this.video=e.media instanceof window.HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod))},i.checkFPS=function(e,t,n){var r=Xe.now();if(t){if(this.lastTime){var i=r-this.lastTime,o=n-this.lastDroppedFrames,s=t-this.lastDecodedFrames,a=1e3*o/i,c=this.hls;if(c.trigger(u.default.FPS_DROP,{currentDropped:o,currentDecoded:s,totalDroppedFrames:n}),a>0&&o>c.config.fpsDroppedMonitoringThreshold*s){var A=c.currentLevel;l.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+A),A>0&&(-1===c.autoLevelCapping||c.autoLevelCapping>=A)&&(A-=1,c.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:A,droppedLevel:c.currentLevel}),c.autoLevelCapping=A,c.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}},i.checkFPSInterval=function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},r}(d),Ze=function(){function e(e){e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}var t=e.prototype;return t.destroy=function(){this.abort(),this.loader=null},t.abort=function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null},t.load=function(e,t,n){this.context=e,this.config=t,this.callbacks=n,this.stats={trequest:window.performance.now(),retry:0},this.retryDelay=t.retryDelay,this.loadInternal()},t.loadInternal=function(){var e,t=this.context;e=this.loader=new window.XMLHttpRequest;var n=this.stats;n.tfirst=0,n.loaded=0;var r=this.xhrSetup;try{if(r)try{r(e,t.url)}catch(n){e.open("GET",t.url,!0),r(e,t.url)}e.readyState||e.open("GET",t.url,!0)}catch(n){return void this.callbacks.onError({code:e.status,text:n.message},t,e)}t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()},t.readystatechange=function(e){var t=e.currentTarget,n=t.readyState,r=this.stats,i=this.context,o=this.config;if(!r.aborted&&n>=2)if(window.clearTimeout(this.requestTimeout),0===r.tfirst&&(r.tfirst=Math.max(window.performance.now(),r.trequest)),4===n){var s=t.status;if(s>=200&&s<300){var a,c;r.tload=Math.max(r.tfirst,window.performance.now()),c="arraybuffer"===i.responseType?(a=t.response).byteLength:(a=t.responseText).length,r.loaded=r.total=c;var u={url:t.responseURL,data:a};this.callbacks.onSuccess(u,r,i,t)}else r.retry>=o.maxRetry||s>=400&&s<499?(l.logger.error(s+" while loading "+i.url),this.callbacks.onError({code:s,text:t.statusText},i,t)):(l.logger.warn(s+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,o.maxRetryDelay),r.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),o.timeout)},t.loadtimeout=function(){l.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)},t.loadprogress=function(e){var t=e.currentTarget,n=this.stats;n.loaded=e.loaded,e.lengthComputable&&(n.total=e.total);var r=this.callbacks.onProgress;r&&r(n,this.context,null,t)},e}();function $e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var et=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MANIFEST_LOADING,u.default.MANIFEST_PARSED,u.default.AUDIO_TRACK_LOADED,u.default.AUDIO_TRACK_SWITCHED,u.default.LEVEL_LOADED,u.default.ERROR)||this)._trackId=-1,n._selectDefaultTrack=!0,n.tracks=[],n.trackIdBlacklist=Object.create(null),n.audioGroupId=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,s,c=r.prototype;return c.onManifestLoading=function(){this.tracks=[],this._trackId=-1,this._selectDefaultTrack=!0},c.onManifestParsed=function(e){var t=this.tracks=e.audioTracks||[];this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{audioTracks:t}),this._selectAudioGroup(this.hls.nextLoadLevel)},c.onAudioTrackLoaded=function(e){if(e.id>=this.tracks.length)l.logger.warn("Invalid audio track id:",e.id);else{if(l.logger.log("audioTrack "+e.id+" loaded"),this.tracks[e.id].details=e.details,e.details.live&&!this.hasInterval()){var t=1e3*e.details.targetduration;this.setInterval(t)}!e.details.live&&this.hasInterval()&&this.clearInterval()}},c.onAudioTrackSwitched=function(e){var t=this.tracks[e.id].groupId;t&&this.audioGroupId!==t&&(this.audioGroupId=t)},c.onLevelLoaded=function(e){this._selectAudioGroup(e.level)},c.onError=function(e){e.type===a.ErrorTypes.NETWORK_ERROR&&(e.fatal&&this.clearInterval(),e.details===a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR&&(l.logger.warn("Network failure on audio-track id:",e.context.id),this._handleLoadError()))},c._setAudioTrack=function(e){if(this._trackId===e&&this.tracks[this._trackId].details)l.logger.debug("Same id as current audio-track passed, and track details available -> no-op");else if(e<0||e>=this.tracks.length)l.logger.warn("Invalid id passed to audio-track controller");else{var t=this.tracks[e];l.logger.log("Now switching to audio-track index "+e),this.clearInterval(),this._trackId=e;var n=t.url,r=t.type,i=t.id;this.hls.trigger(u.default.AUDIO_TRACK_SWITCHING,{id:i,type:r,url:n}),this._loadTrackDetailsIfNeeded(t)}},c.doTick=function(){this._updateTrack(this._trackId)},c._selectAudioGroup=function(e){var t=this.hls.levels[e];if(t&&t.audioGroupIds){var n=t.audioGroupIds[t.urlId];this.audioGroupId!==n&&(this.audioGroupId=n,this._selectInitialAudioTrack())}},c._selectInitialAudioTrack=function(){var e=this,t=this.tracks;if(t.length){var n=this.tracks[this._trackId],r=null;if(n&&(r=n.name),this._selectDefaultTrack){var i=t.filter((function(e){return e.default}));i.length?t=i:l.logger.warn("No default audio tracks defined")}var o=!1,s=function(){t.forEach((function(t){o||e.audioGroupId&&t.groupId!==e.audioGroupId||r&&r!==t.name||(e._setAudioTrack(t.id),o=!0)}))};s(),o||(r=null,s()),o||(l.logger.error("No track found for running audio group-ID: "+this.audioGroupId),this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))}},c._needsTrackLoading=function(e){var t=e.details,n=e.url;return!(t&&!t.live)&&!!n},c._loadTrackDetailsIfNeeded=function(e){if(this._needsTrackLoading(e)){var t=e.url,n=e.id;l.logger.log("loading audio-track playlist for id: "+n),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{url:t,id:n})}},c._updateTrack=function(e){if(!(e<0||e>=this.tracks.length)){this.clearInterval(),this._trackId=e,l.logger.log("trying to update audio-track "+e);var t=this.tracks[e];this._loadTrackDetailsIfNeeded(t)}},c._handleLoadError=function(){this.trackIdBlacklist[this._trackId]=!0;var e=this._trackId,t=this.tracks[e],n=t.name,r=t.language,i=t.groupId;l.logger.warn("Loading failed on audio track id: "+e+", group-id: "+i+', name/language: "'+n+'" / "'+r+'"');for(var o=e,s=0;s<this.tracks.length;s++){if(!this.trackIdBlacklist[s])if(this.tracks[s].name===n){o=s;break}}o!==e?(l.logger.log("Attempting audio-track fallback id:",o,"group-id:",this.tracks[o].groupId),this._setAudioTrack(o)):l.logger.warn('No fallback audio-track found for name/language: "'+n+'" / "'+r+'"')},i=r,(o=[{key:"audioTracks",get:function(){return this.tracks}},{key:"audioTrack",get:function(){return this._trackId},set:function(e){this._setAudioTrack(e),this._selectDefaultTrack=!1}}])&&$e(i.prototype,o),s&&$e(i,s),r}(fe);function tt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var nt=window.performance,rt=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.AUDIO_TRACKS_UPDATED,u.default.AUDIO_TRACK_SWITCHING,u.default.AUDIO_TRACK_LOADED,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.FRAG_PARSING_INIT_SEGMENT,u.default.FRAG_PARSING_DATA,u.default.FRAG_PARSED,u.default.ERROR,u.default.BUFFER_RESET,u.default.BUFFER_CREATED,u.default.BUFFER_APPENDED,u.default.BUFFER_FLUSHED,u.default.INIT_PTS_FOUND)||this).fragmentTracker=n,r.config=t.config,r.audioCodecSwap=!1,r._state=ge,r.initPTS=[],r.waitingFragment=null,r.videoTrackCC=null,r.waitingVideoCC=null,r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,s,A=r.prototype;return A.onInitPtsFound=function(e){var t=e.id,n=e.frag.cc,r=e.initPTS;"main"===t&&(this.initPTS[n]=r,this.videoTrackCC=n,l.logger.log("InitPTS for cc: "+n+" found from main: "+r),this.state===Oe&&this.tick())},A.startLoad=function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,t>0&&-1===e?(l.logger.log("audio:override startPosition with lastCurrentTime @"+t.toFixed(3)),this.state=ve):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=me),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=ge},A.doTick=function(){var e,t,n,r=this.hls,i=r.config;switch(this.state){case Ie:case ye:case Ce:break;case me:this.state=we,this.loadedmetadata=!1;break;case ve:var o=this.tracks;if(!o)break;if(!this.media&&(this.startFragRequested||!i.startFragPrefetch))break;if(this.loadedmetadata)e=this.media.currentTime;else if(void 0===(e=this.nextLoadPosition))break;var s=this.mediaBuffer?this.mediaBuffer:this.media,a=this.videoBuffer?this.videoBuffer:this.media,A=e<i.maxBufferHole?Math.max(2,i.maxBufferHole):i.maxBufferHole,h=G.bufferInfo(s,e,A),d=G.bufferInfo(a,e,A),p=h.len,f=h.end,g=this.fragPrevious,m=Math.min(i.maxBufferLength,i.maxMaxBufferLength),v=Math.max(m,d.len),y=this.audioSwitch,_=this.trackId;if((p<v||y)&&_<o.length){if(void 0===(n=o[_].details)){this.state=we;break}if(!y&&this._streamEnded(h,n))return this.hls.trigger(u.default.BUFFER_EOS,{type:"audio"}),void(this.state=Re);var E,b=n.fragments,w=b.length,S=b[0].start,T=b[w-1].start+b[w-1].duration;if(y)if(n.live&&!n.PTSKnown)l.logger.log("switching audiotrack, live stream, unknown PTS,load first fragment"),f=0;else if(f=e,n.PTSKnown&&e<S){if(!(h.end>S||h.nextStart))return;l.logger.log("alt audio track ahead of main track, seek to start of alt audio track"),this.media.currentTime=S+.05}if(n.initSegment&&!n.initSegment.data)E=n.initSegment;else if(f<=S){if(E=b[0],null!==this.videoTrackCC&&E.cc!==this.videoTrackCC&&(E=function(e,t){return j.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}(b,this.videoTrackCC)),n.live&&E.loadIdx&&E.loadIdx===this.fragLoadIdx){var C=h.nextStart?h.nextStart:S;return l.logger.log("no alt audio available @currentTime:"+this.media.currentTime+", seeking @"+(C+.05)),void(this.media.currentTime=C+.05)}}else{var R,I=i.maxFragLookUpTolerance,O=g?b[g.sn-b[0].sn+1]:void 0;f<T?(f>T-I&&(I=0),R=O&&!Ae(f,I,O)?O:j.search(b,(function(e){return Ae(f,I,e)}))):R=b[w-1],R&&(E=R,S=R.start,g&&E.level===g.level&&E.sn===g.sn&&(E.sn<n.endSN?(E=b[E.sn+1-n.startSN],this.fragmentTracker.getState(E)!==V&&l.logger.log("SN just loaded, load next one: "+E.sn)):E=null))}E&&(E.encrypted?(l.logger.log("Loading key for "+E.sn+" of ["+n.startSN+" ,"+n.endSN+"],track "+_),this.state=_e,r.trigger(u.default.KEY_LOADING,{frag:E})):(this.fragCurrent=E,(y||this.fragmentTracker.getState(E)===U)&&(l.logger.log("Loading "+E.sn+", cc: "+E.cc+" of ["+n.startSN+" ,"+n.endSN+"],track "+_+", "+(this.loadedmetadata?"currentTime":"nextLoadPosition")+": "+e+", bufferEnd: "+f.toFixed(3)),"initSegment"!==E.sn&&(this.startFragRequested=!0),Object(c.isFiniteNumber)(E.sn)&&(this.nextLoadPosition=E.start+E.duration),r.trigger(u.default.FRAG_LOADING,{frag:E}),this.state=Ee)))}break;case we:(t=this.tracks[this.trackId])&&t.details&&(this.state=ve);break;case be:var x=nt.now(),N=this.retryDate,B=(s=this.media)&&s.seeking;(!N||x>=N||B)&&(l.logger.log("audioStreamController: retryDate reached, switch back to IDLE state"),this.state=ve);break;case Oe:var L=this.waitingFragment;if(L){var D=L.frag.cc;if(void 0!==this.initPTS[D])this.waitingFragment=null,this.state=Ee,this.onFragLoaded(L);else if(this.videoTrackCC!==this.waitingVideoCC)l.logger.log("Waiting fragment cc ("+D+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var M=G.bufferInfo(this.mediaBuffer,this.media.currentTime,i.maxBufferHole);Ae(M.end,i.maxFragLookUpTolerance,L.frag)<0&&(l.logger.log("Waiting fragment cc ("+D+") @ "+L.frag.start+" cancelled because another fragment at "+M.end+" is needed"),this.clearWaitingFragment())}}else this.state=ve}},A.clearWaitingFragment=function(){var e=this.waitingFragment;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingFragment=null,this.waitingVideoCC=null,this.state=ve)},A.onMediaAttached=function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("ended",this.onvended);var n=this.config;this.tracks&&n.autoStartLoad&&this.startLoad(n.startPosition)},A.onMediaDetaching=function(){var e=this.media;e&&e.ended&&(l.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},A.onAudioTracksUpdated=function(e){l.logger.log("audio tracks updated"),this.tracks=e.audioTracks},A.onAudioTrackSwitching=function(e){var t=!!e.url;this.trackId=e.id,this.fragCurrent=null,this.clearWaitingFragment(),this.state=ye,t?this.setInterval(100):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=ve),this.tick()},A.onAudioTrackLoaded=function(e){var t=e.details,n=e.id,r=this.tracks[n],i=t.totalduration,o=0;if(l.logger.log("track "+n+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),t.live){var s=r.details;s&&t.fragments.length>0?(re(s,t),o=t.fragments[0].start,t.PTSKnown?l.logger.log("live audio playlist sliding:"+o.toFixed(3)):l.logger.log("live audio playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,l.logger.log("live audio playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,!this.startFragRequested){if(-1===this.startPosition){var a=t.startTimeOffset;Object(c.isFiniteNumber)(a)?(l.logger.log("start time offset found in playlist, adjust startPosition to "+a),this.startPosition=a):t.live?(this.startPosition=this.computeLivePosition(o,t),l.logger.log("compute startPosition for audio-track to "+this.startPosition)):this.startPosition=0}this.nextLoadPosition=this.startPosition}this.state===we&&(this.state=ve),this.tick()},A.onKeyLoaded=function(){this.state===_e&&(this.state=ve,this.tick())},A.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag;if(this.state===Ee&&t&&"audio"===n.type&&n.level===t.level&&n.sn===t.sn){var r=this.tracks[this.trackId],i=r.details,o=i.totalduration,s=t.level,a=t.sn,c=t.cc,A=this.config.defaultAudioCodec||r.audioCodec||"mp4a.40.2",h=this.stats=e.stats;if("initSegment"===a)this.state=ve,h.tparsed=h.tbuffered=nt.now(),i.initSegment.data=e.payload,this.hls.trigger(u.default.FRAG_BUFFERED,{stats:h,frag:t,id:"audio"}),this.tick();else{this.state=Se,this.appended=!1,this.demuxer||(this.demuxer=new $(this.hls,"audio"));var d=this.initPTS[c],p=i.initSegment?i.initSegment.data:[];if(void 0!==d){this.pendingBuffering=!0,l.logger.log("Demuxing "+a+" of ["+i.startSN+" ,"+i.endSN+"],track "+s);this.demuxer.push(e.payload,p,A,null,t,o,!1,d)}else l.logger.log("Unknown video PTS for cc "+c+", waiting for video PTS before demuxing audio frag "+a+" of ["+i.startSN+" ,"+i.endSN+"],track "+s),this.waitingFragment=e,this.waitingVideoCC=this.videoTrackCC,this.state=Oe}}this.fragLoadError=0},A.onFragParsingInitSegment=function(e){var t=this.fragCurrent,n=e.frag;if(t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Se){var r,i=e.tracks;if(i.video&&delete i.video,r=i.audio){r.levelCodec=r.codec,r.id=e.id,this.hls.trigger(u.default.BUFFER_CODECS,i),l.logger.log("audio track:audio,container:"+r.container+",codecs[level/parsed]=["+r.levelCodec+"/"+r.codec+"]");var o=r.initSegment;if(o){var s={type:"audio",data:o,parent:"audio",content:"initSegment"};this.audioSwitch?this.pendingData=[s]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(u.default.BUFFER_APPENDING,s))}this.tick()}}},A.onFragParsingData=function(e){var t=this,n=this.fragCurrent,r=e.frag;if(n&&"audio"===e.id&&"audio"===e.type&&r.sn===n.sn&&r.level===n.level&&this.state===Se){var i=this.trackId,o=this.tracks[i],s=this.hls;Object(c.isFiniteNumber)(e.endPTS)||(e.endPTS=e.startPTS+n.duration,e.endDTS=e.startDTS+n.duration),n.addElementaryStream(g.AUDIO),l.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb),ne(o.details,n,e.startPTS,e.endPTS);var A=this.media,h=!1;if(this.audioSwitch)if(A&&A.readyState){var d=A.currentTime;l.logger.log("switching audio track : currentTime:"+d),d>=e.startPTS&&(l.logger.log("switching audio track : flushing all audio"),this.state=Ce,s.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),h=!0,this.audioSwitch=!1,s.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i}))}else this.audioSwitch=!1,s.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:i});var p=this.pendingData;if(!p)return l.logger.warn("Apparently attempt to enqueue media payload without codec initialization data upfront"),void s.trigger(u.default.ERROR,{type:a.ErrorTypes.MEDIA_ERROR,details:null,fatal:!0});this.audioSwitch||([e.data1,e.data2].forEach((function(t){t&&t.length&&p.push({type:e.type,data:t,parent:"audio",content:"data"})})),!h&&p.length&&(p.forEach((function(e){t.state===Se&&(t.pendingBuffering=!0,t.hls.trigger(u.default.BUFFER_APPENDING,e))})),this.pendingData=[],this.appended=!0)),this.tick()}},A.onFragParsed=function(e){var t=this.fragCurrent,n=e.frag;t&&"audio"===e.id&&n.sn===t.sn&&n.level===t.level&&this.state===Se&&(this.stats.tparsed=nt.now(),this.state=Te,this._checkAppendedParsed())},A.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},A.onBufferCreated=function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},A.onBufferAppended=function(e){if("audio"===e.parent){var t=this.state;t!==Se&&t!==Te||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}},A._checkAppendedParsed=function(){if(!(this.state!==Te||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,n=this.hls;if(e){this.fragPrevious=e,t.tbuffered=nt.now(),n.trigger(u.default.FRAG_BUFFERED,{stats:t,frag:e,id:"audio"});var r=this.mediaBuffer?this.mediaBuffer:this.media;r&&l.logger.log("audio buffered : "+se.toString(r.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,n.trigger(u.default.AUDIO_TRACK_SWITCHED,{id:this.trackId})),this.state=ve}this.tick()}},A.onError=function(e){var t=e.frag;if(!t||"audio"===t.type)switch(e.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:var n=e.frag;if(n&&"audio"!==n.type)break;if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r;var o=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);l.logger.warn("AudioStreamController: frag loading failed, retry in "+o+" ms"),this.retryDate=nt.now()+o,this.state=be}else l.logger.error("AudioStreamController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.state=Ie}break;case a.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case a.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case a.ErrorDetails.KEY_LOAD_ERROR:case a.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==Ie&&(this.state=e.fatal?Ie:ve,l.logger.warn("AudioStreamController: "+e.details+" while loading frag, now switching to "+this.state+" state ..."));break;case a.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===e.parent&&(this.state===Se||this.state===Te)){var s=this.mediaBuffer,c=this.media.currentTime;if(s&&G.isBuffered(s,c)&&G.isBuffered(s,c+.5)){var A=this.config;A.maxMaxBufferLength>=A.maxBufferLength&&(A.maxMaxBufferLength/=2,l.logger.warn("AudioStreamController: reduce max buffer length to "+A.maxMaxBufferLength+"s")),this.state=ve}else l.logger.warn("AudioStreamController: buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,this.state=Ce,this.hls.trigger(u.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"})}}},A.onBufferFlushed=function(){var e=this,t=this.pendingData;t&&t.length?(l.logger.log("AudioStreamController: appending pending audio data after buffer flushed"),t.forEach((function(t){e.hls.trigger(u.default.BUFFER_APPENDING,t)})),this.appended=!0,this.pendingData=[],this.state=Te):(this.state=ve,this.fragPrevious=null,this.tick())},i=r,(o=[{key:"state",set:function(e){if(this.state!==e){var t=this.state;this._state=e,l.logger.log("audio stream:"+t+"->"+e)}},get:function(){return this._state}}])&&tt(i.prototype,o),s&&tt(i,s),r}(Ne),it=function(){if("undefined"!=typeof window&&window.VTTCue)return window.VTTCue;var e={"":!0,lr:!0,rl:!0},t={start:!0,middle:!0,end:!0,left:!0,right:!0};function n(e){return"string"==typeof e&&(!!t[e.toLowerCase()]&&e.toLowerCase())}function r(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function i(t,i,o){var s=this,a={enumerable:!0};s.hasBeenReset=!1;var c="",u=!1,l=t,A=i,h=o,d=null,p="",f=!0,g="auto",m="start",v=50,y="middle",_=50,E="middle";Object.defineProperty(s,"id",r({},a,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(s,"pauseOnExit",r({},a,{get:function(){return u},set:function(e){u=!!e}})),Object.defineProperty(s,"startTime",r({},a,{get:function(){return l},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");l=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"endTime",r({},a,{get:function(){return A},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");A=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"text",r({},a,{get:function(){return h},set:function(e){h=""+e,this.hasBeenReset=!0}})),Object.defineProperty(s,"region",r({},a,{get:function(){return d},set:function(e){d=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"vertical",r({},a,{get:function(){return p},set:function(t){var n=function(t){return"string"==typeof t&&!!e[t.toLowerCase()]&&t.toLowerCase()}(t);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");p=n,this.hasBeenReset=!0}})),Object.defineProperty(s,"snapToLines",r({},a,{get:function(){return f},set:function(e){f=!!e,this.hasBeenReset=!0}})),Object.defineProperty(s,"line",r({},a,{get:function(){return g},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");g=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"lineAlign",r({},a,{get:function(){return m},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");m=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"position",r({},a,{get:function(){return v},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");v=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"positionAlign",r({},a,{get:function(){return y},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(s,"size",r({},a,{get:function(){return _},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");_=e,this.hasBeenReset=!0}})),Object.defineProperty(s,"align",r({},a,{get:function(){return E},set:function(e){var t=n(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");E=t,this.hasBeenReset=!0}})),s.displayState=void 0}return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}(),ot=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}};function st(){this.window=window,this.state="INITIAL",this.buffer="",this.decoder=new ot,this.regionList=[]}function at(){this.values=Object.create(null)}function ct(e,t,n,r){var i=r?e.split(r):[e];for(var o in i)if("string"==typeof i[o]){var s=i[o].split(n);if(2===s.length)t(s[0],s[1])}}at.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var ut=new it(0,0,0),lt="middle"===ut.align?"middle":"center";function At(e,t,n){var r=e;function i(){var t=function(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+(0|r)/1e3}var n=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}(e);if(null===t)throw new Error("Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function o(){e=e.replace(/^\s+/,"")}if(o(),t.startTime=i(),o(),"--\x3e"!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),o(),t.endTime=i(),o(),function(e,t){var r=new at;ct(e,(function(e,t){switch(e){case"region":for(var i=n.length-1;i>=0;i--)if(n[i].id===t){r.set(e,n[i].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var o=t.split(","),s=o[0];r.integer(e,s),r.percent(e,s)&&r.set("snapToLines",!1),r.alt(e,s,["auto"]),2===o.length&&r.alt("lineAlign",o[1],["start",lt,"end"]);break;case"position":o=t.split(","),r.percent(e,o[0]),2===o.length&&r.alt("positionAlign",o[1],["start",lt,"end","line-left","line-right","auto"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start",lt,"end","left","right"])}}),/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===ut.line&&(i=-1),t.line=i,t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align",lt);var o=r.get("position","auto");"auto"===o&&50===ut.position&&(o="start"===t.align||"left"===t.align?0:"end"===t.align||"right"===t.align?100:50),t.position=o}(e,t)}function ht(e){return e.replace(/<br(?: \/)?>/gi,"\n")}st.prototype={parse:function(e){var t=this;function n(){var e=t.buffer,n=0;for(e=ht(e);n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var r=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),r}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var r;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var i=(r=n()).match(/^(Ã¯Â»Â¿)?WEBVTT([ \t].*)?$/);if(!i||!i[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var o=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(o?o=!1:r=n(),t.state){case"HEADER":/:/.test(r)?ct(r,(function(e,t){}),/:/):r||(t.state="ID");continue;case"NOTE":r||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(r)){t.state="NOTE";break}if(!r)continue;if(t.cue=new it(0,0,""),t.state="CUE",-1===r.indexOf("--\x3e")){t.cue.id=r;continue}case"CUE":try{At(r,t.cue,t.regionList)}catch(e){t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var s=-1!==r.indexOf("--\x3e");if(!r||s&&(o=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=r;continue;case"BADCUE":r||(t.state="ID");continue}}}catch(e){"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new Error("Malformed WebVTT signature.")}catch(e){throw e}return e.onflush&&e.onflush(),this}};var dt=st;function pt(e,t,n,r){for(var i,o,s,a,c,u=[],l=window.VTTCue||TextTrackCue,A=0;A<r.rows.length;A++)if(s=!0,a=0,c="",!(i=r.rows[A]).isEmpty()){for(var h=0;h<i.chars.length;h++)i.chars[h].uchar.match(/\s/)&&s?a++:(c+=i.chars[h].uchar,s=!1);i.cueStartTime=t,t===n&&(n+=1e-4),o=new l(t,n,ht(c.trim())),a>=16?a--:a++,navigator.userAgent.match(/Firefox\//)?o.line=A+1:o.line=A>7?A-2:A+1,o.align="left",o.position=Math.max(0,Math.min(100,a/32*100)),u.push(o),e&&e.addCue(o)}return u}var ft,gt={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},mt=function(e){var t=e;return gt.hasOwnProperty(e)&&(t=gt[e]),String.fromCharCode(t)},vt=15,yt=100,_t={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},Et={17:2,18:4,21:6,22:8,23:10,19:13,20:15},bt={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},wt={25:2,26:4,29:6,30:8,31:10,27:13,28:15},St=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];!function(e){e[e.ERROR=0]="ERROR",e[e.TEXT=1]="TEXT",e[e.WARNING=2]="WARNING",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.DATA=3]="DATA"}(ft||(ft={}));var Tt=function(){function e(){this.time=null,this.verboseLevel=ft.ERROR}return e.prototype.log=function(e,t){this.verboseLevel>=e&&l.logger.log(this.time+" ["+e+"] "+t)},e}(),Ct=function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].toString(16));return t},Rt=function(){function e(e,t,n,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=e||"white",this.underline=t||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}var t=e.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var t=["foreground","underline","italics","background","flash"],n=0;n<t.length;n++){var r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}},t.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},e}(),It=function(){function e(e,t,n,r,i,o){this.uchar=void 0,this.penState=void 0,this.uchar=e||" ",this.penState=new Rt(t,n,r,i,o)}var t=e.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,t){this.uchar=e,this.penState.copy(t)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},e}(),Ot=function(){function e(e){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var t=0;t<yt;t++)this.chars.push(new It);this.logger=e,this.pos=0,this.currPenState=new Rt}var t=e.prototype;return t.equals=function(e){for(var t=!0,n=0;n<yt;n++)if(!this.chars[n].equals(e.chars[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<yt;t++)this.chars[t].copy(e.chars[t])},t.isEmpty=function(){for(var e=!0,t=0;t<yt;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(ft.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>yt&&(this.logger.log(ft.DEBUG,"Too large cursor position "+this.pos),this.pos=yt)},t.moveCursor=function(e){var t=this.pos+e;if(e>1)for(var n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){e>=144&&this.backSpace();var t=mt(e);this.pos>=yt?this.logger.log(ft.ERROR,"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1))},t.clearFromPos=function(e){var t;for(t=e;t<yt;t++)this.chars[t].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],t=!0,n=0;n<yt;n++){var r=this.chars[n].uchar;" "!==r&&(t=!1),e.push(r)}return t?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)},e}(),xt=function(){function e(e){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var t=0;t<vt;t++)this.rows.push(new Ot(e));this.logger=e,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=e.prototype;return t.reset=function(){for(var e=0;e<vt;e++)this.rows[e].clear();this.currRow=14},t.equals=function(e){for(var t=!0,n=0;n<vt;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t},t.copy=function(e){for(var t=0;t<vt;t++)this.rows[t].copy(e.rows[t])},t.isEmpty=function(){for(var e=!0,t=0;t<vt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e},t.backSpace=function(){this.rows[this.currRow].backSpace()},t.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},t.insertChar=function(e){this.rows[this.currRow].insertChar(e)},t.setPen=function(e){this.rows[this.currRow].setPenStyles(e)},t.moveCursor=function(e){this.rows[this.currRow].moveCursor(e)},t.setCursor=function(e){this.logger.log(ft.INFO,"setCursor: "+e),this.rows[this.currRow].setCursor(e)},t.setPAC=function(e){this.logger.log(ft.INFO,"pacData = "+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var n=0;n<vt;n++)this.rows[n].clear();var r=this.currRow+1-this.nrRollUpRows,i=this.lastOutputScreen;if(i){var o=i.rows[r].cueStartTime,s=this.logger.time;if(o&&null!==s&&o<s)for(var a=0;a<this.nrRollUpRows;a++)this.rows[t-this.nrRollUpRows+a+1].copy(i.rows[r+a])}}this.currRow=t;var c=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,l=Math.max(u-1,0);c.setCursor(e.indent),e.color=c.chars[l].penState.foreground}var A={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(A)},t.setBkgData=function(e){this.logger.log(ft.INFO,"bkgData = "+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(ft.TEXT,this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(ft.INFO,"Rolling up")}else this.logger.log(ft.DEBUG,"roll_up but nrRollUpRows not set yet")},t.getDisplayText=function(e){e=e||!1;for(var t=[],n="",r=-1,i=0;i<vt;i++){var o=this.rows[i].getTextString();o&&(r=i+1,e?t.push("Row "+r+": '"+o+"'"):t.push(o.trim()))}return t.length>0&&(n=e?"["+t.join(" | ")+"]":t.join("\n")),n},t.getTextAndFormat=function(){return this.rows},e}(),Nt=function(){function e(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new xt(n),this.nonDisplayedMemory=new xt(n),this.lastOutputScreen=new xt(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var t=e.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(ft.INFO,"MODE="+e),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(ft.INFO,n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(ft.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(ft.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(ft.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(ft.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(ft.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(ft.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(ft.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(ft.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(ft.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(ft.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(ft.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(ft.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){if(this.logger.log(ft.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(ft.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(ft.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var t={flash:!1};if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground="white";else{var n=Math.floor(e/2)-16;t.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(ft.INFO,"MIDROW: "+JSON.stringify(t)),this.writeScreen.setPen(t)},t.outputDataUpdate=function(e){void 0===e&&(e=!1);var t=this.logger.time;null!==t&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},e}(),Bt=function(){function e(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new Tt;this.channels=[null,new Nt(e,t,r),new Nt(e+1,n,r)],this.cmdHistory={a:null,b:null},this.logger=r}var t=e.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,t){this.channels[e].setHandler(t)},t.addData=function(e,t){var n,r,i,o=!1;this.logger.time=e;for(var s=0;s<t.length;s+=2)if(r=127&t[s],i=127&t[s+1],0!==r||0!==i){if(this.logger.log(ft.DATA,"["+Ct([t[s],t[s+1]])+"] -> ("+Ct([r,i])+")"),(n=this.parseCmd(r,i))||(n=this.parseMidrow(r,i)),n||(n=this.parsePAC(r,i)),n||(n=this.parseBackgroundAttributes(r,i)),!n&&(o=this.parseChars(r,i))){var a=this.currentChannel;if(a&&a>0)this.channels[a].insertChars(o);else this.logger.log(ft.WARNING,"No channel found yet. TEXT-MODE?")}n||o||this.logger.log(ft.WARNING,"Couldn't parse cleaned data "+Ct([r,i])+" orig: "+Ct([t[s],t[s+1]]))}},t.parseCmd=function(e,t){var n=this.cmdHistory;if(!((20===e||28===e||21===e||29===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=33&&t<=35))return!1;if(Dt(e,t,n))return Lt(null,null,n),this.logger.log(ft.DEBUG,"Repeated command ("+Ct([e,t])+") is dropped"),!0;var r=20===e||21===e||23===e?1:2,i=this.channels[r];return 20===e||21===e||28===e||29===e?32===t?i.ccRCL():33===t?i.ccBS():34===t?i.ccAOF():35===t?i.ccAON():36===t?i.ccDER():37===t?i.ccRU(2):38===t?i.ccRU(3):39===t?i.ccRU(4):40===t?i.ccFON():41===t?i.ccRDC():42===t?i.ccTR():43===t?i.ccRTD():44===t?i.ccEDM():45===t?i.ccCR():46===t?i.ccENM():47===t&&i.ccEOC():i.ccTO(t-32),Lt(e,t,n),this.currentChannel=r,!0},t.parseMidrow=function(e,t){var n=0;if((17===e||25===e)&&t>=32&&t<=47){if((n=17===e?1:2)!==this.currentChannel)return this.logger.log(ft.ERROR,"Mismatch channel in midrow parsing"),!1;var r=this.channels[n];return!!r&&(r.ccMIDROW(t),this.logger.log(ft.DEBUG,"MIDROW ("+Ct([e,t])+")"),!0)}return!1},t.parsePAC=function(e,t){var n,r=this.cmdHistory;if(!((e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127)&&!((16===e||24===e)&&t>=64&&t<=95))return!1;if(Dt(e,t,r))return Lt(null,null,r),!0;var i=e<=23?1:2;n=t>=64&&t<=95?1===i?_t[e]:bt[e]:1===i?Et[e]:wt[e];var o=this.channels[i];return!!o&&(o.setPAC(this.interpretPAC(n,t)),Lt(e,t,r),this.currentChannel=i,!0)},t.interpretPAC=function(e,t){var n=t,r={color:null,italics:!1,indent:null,underline:!1,row:e};return n=t>95?t-96:t-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},t.parseChars=function(e,t){var n,r=null,i=null;if(e>=25?(n=2,i=e-8):(n=1,i=e),i>=17&&i<=19){var o=t;o=17===i?t+80:18===i?t+112:t+144,this.logger.log(ft.INFO,"Special char '"+mt(o)+"' in channel "+n),r=[o]}else e>=32&&e<=127&&(r=0===t?[e]:[e,t]);if(r){var s=Ct(r);this.logger.log(ft.DEBUG,"Char codes =  "+s.join(",")),Lt(e,t,this.cmdHistory)}return r},t.parseBackgroundAttributes=function(e,t){var n;if(!((16===e||24===e)&&t>=32&&t<=47)&&!((23===e||31===e)&&t>=45&&t<=47))return!1;var r={};16===e||24===e?(n=Math.floor((t-32)/2),r.background=St[n],t%2==1&&(r.background=r.background+"_semi")):45===t?r.background="transparent":(r.foreground="black",47===t&&(r.underline=!0));var i=e<=23?1:2;return this.channels[i].setBkgData(r),Lt(e,t,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var t=this.channels[e];t&&t.reset()}this.cmdHistory={a:null,b:null}},t.cueSplitAtTime=function(e){for(var t=0;t<this.channels.length;t++){var n=this.channels[t];n&&n.cueSplitAtTime(e)}},e}();function Lt(e,t,n){n.a=e,n.b=t}function Dt(e,t,n){return n.a===e&&n.b===t}var Mt=Bt,Pt=function(){function e(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}var t=e.prototype;return t.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},t.newCue=function(e,t,n){(null===this.startTime||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},t.reset=function(){this.cueRanges=[]},e}(),kt=function(e,t,n){return e.substr(n||0,t.length)===t},Ut=function(e){for(var t=5381,n=e.length;n;)t=33*t^e.charCodeAt(--n);return(t>>>0).toString()},Ft={parse:function(e,t,n,r,i,o){var s,a=Object(ke.utf8ArrayToStr)(new Uint8Array(e)).trim().replace(/\r\n|\n\r|\n|\r/g,"\n").split("\n"),u="00:00.000",l=0,A=0,h=0,d=[],p=!0,f=!1,g=new dt;g.oncue=function(e){var t=n[r],i=n.ccOffset;t&&t.new&&(void 0!==A?i=n.ccOffset=t.start:function(e,t,n){var r=e[t],i=e[r.prevCC];if(!i||!i.new&&r.new)return e.ccOffset=e.presentationOffset=r.start,void(r.new=!1);for(;i&&i.new;)e.ccOffset+=r.start-i.start,r.new=!1,i=e[(r=i).prevCC];e.presentationOffset=n}(n,r,h)),h&&(i=h-n.presentationOffset),f&&(e.startTime+=i-A,e.endTime+=i-A),e.id=Ut(e.startTime.toString())+Ut(e.endTime.toString())+Ut(e.text),e.text=decodeURIComponent(encodeURIComponent(e.text)),e.endTime>0&&d.push(e)},g.onparsingerror=function(e){s=e},g.onflush=function(){s&&o?o(s):i(d)},a.forEach((function(e){if(p){if(kt(e,"X-TIMESTAMP-MAP=")){p=!1,f=!0,e.substr(16).split(",").forEach((function(e){kt(e,"LOCAL:")?u=e.substr(6):kt(e,"MPEGTS:")&&(l=parseInt(e.substr(7)))}));try{t+(9e4*n[r].start||0)<0&&(t+=8589934592),l-=t,A=function(e){var t=parseInt(e.substr(-3)),n=parseInt(e.substr(-6,2)),r=parseInt(e.substr(-9,2)),i=e.length>9?parseInt(e.substr(0,e.indexOf(":"))):0;if(!(Object(c.isFiniteNumber)(t)&&Object(c.isFiniteNumber)(n)&&Object(c.isFiniteNumber)(r)&&Object(c.isFiniteNumber)(i)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+e);return t+=1e3*n,t+=6e4*r,t+36e5*i}(u)/1e3,h=l/9e4}catch(e){f=!1,s=e}return}""===e&&(p=!1)}g.parse(e+"\n")})),g.flush()}};function Ht(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Vt(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}var Qt=function(e){var t,n;function r(t){var n;if((n=e.call(this,t,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_USERDATA,u.default.FRAG_DECRYPTED,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.FRAG_LOADED,u.default.INIT_PTS_FOUND)||this).media=null,n.config=void 0,n.enabled=!0,n.Cues=void 0,n.textTracks=[],n.tracks=[],n.initPTS=[],n.unparsedVttFrags=[],n.captionsTracks={},n.nonNativeCaptionsTracks={},n.captionsProperties=void 0,n.cea608Parser1=void 0,n.cea608Parser2=void 0,n.lastSn=-1,n.prevCC=-1,n.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},n.hls=t,n.config=t.config,n.Cues=t.config.cueHandler,n.captionsProperties={textTrack1:{label:n.config.captionsTextTrack1Label,languageCode:n.config.captionsTextTrack1LanguageCode},textTrack2:{label:n.config.captionsTextTrack2Label,languageCode:n.config.captionsTextTrack2LanguageCode},textTrack3:{label:n.config.captionsTextTrack3Label,languageCode:n.config.captionsTextTrack3LanguageCode},textTrack4:{label:n.config.captionsTextTrack4Label,languageCode:n.config.captionsTextTrack4LanguageCode}},n.config.enableCEA708Captions){var r=new Pt(Ht(n),"textTrack1"),i=new Pt(Ht(n),"textTrack2"),o=new Pt(Ht(n),"textTrack3"),s=new Pt(Ht(n),"textTrack4");n.cea608Parser1=new Mt(1,r,i),n.cea608Parser2=new Mt(3,o,s)}return n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.addCues=function(e,t,n,r,i){for(var o,s,a,c,l=!1,A=i.length;A--;){var h=i[A],d=(o=h[0],s=h[1],a=t,c=n,Math.min(s,c)-Math.max(o,a));if(d>=0&&(h[0]=Math.min(h[0],t),h[1]=Math.max(h[1],n),l=!0,d/(n-t)>.5))return}if(l||i.push([t,n]),this.config.renderTextTracksNatively)this.Cues.newCue(this.captionsTracks[e],t,n,r);else{var p=this.Cues.newCue(null,t,n,r);this.hls.trigger(u.default.CUES_PARSED,{type:"captions",cues:p,track:e})}},i.onInitPtsFound=function(e){var t=this,n=e.frag,r=e.id,i=e.initPTS,o=this.unparsedVttFrags;"main"===r&&(this.initPTS[n.cc]=i),o.length&&(this.unparsedVttFrags=[],o.forEach((function(e){t.onFragLoaded(e)})))},i.getExistingTrack=function(e){var t=this.media;if(t)for(var n=0;n<t.textTracks.length;n++){var r=t.textTracks[n];if(r[e])return r}return null},i.createCaptionsTrack=function(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)},i.createNativeTrack=function(e){if(!this.captionsTracks[e]){var t=this.captionsProperties,n=this.captionsTracks,r=this.media,i=t[e],o=i.label,s=i.languageCode,a=this.getExistingTrack(e);if(a)n[e]=a,Fe(n[e]),Ue(n[e],r);else{var c=this.createTextTrack("captions",o,s);c&&(c[e]=!0,n[e]=c)}}},i.createNonNativeTrack=function(e){if(!this.nonNativeCaptionsTracks[e]){var t=this.captionsProperties[e];if(t){var n={_id:e,label:t.label,kind:"captions",default:!!t.media&&!!t.media.default,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=n,this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},i.createTextTrack=function(e,t,n){var r=this.media;if(r)return r.addTextTrack(e,t,n)},i.destroy=function(){e.prototype.destroy.call(this)},i.onMediaAttaching=function(e){this.media=e.media,this._cleanTracks()},i.onMediaDetaching=function(){var e=this.captionsTracks;Object.keys(e).forEach((function(t){Fe(e[t]),delete e[t]})),this.nonNativeCaptionsTracks={}},i.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={}},i._cleanTracks=function(){var e=this.media;if(e){var t=e.textTracks;if(t)for(var n=0;n<t.length;n++)Fe(t[n])}},i.onManifestLoaded=function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset()),this.config.enableWebVTT){var n=e.subtitles||[],r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=e.subtitles||[],this.config.renderTextTracksNatively){var i=this.media?this.media.textTracks:[];this.tracks.forEach((function(e,n){var r;if(n<i.length){for(var o=null,s=0;s<i.length;s++)if(Vt(i[s],e)){o=i[s];break}o&&(r=o)}r||(r=t.createTextTrack("subtitles",e.name,e.lang)),e.default?r.mode=t.hls.subtitleDisplay?"showing":"hidden":r.mode="disabled",t.textTracks.push(r)}))}else if(!r&&this.tracks&&this.tracks.length){var o=this.tracks.map((function(e){return{label:e.name,kind:e.type.toLowerCase(),default:e.default,subtitleTrack:e}}));this.hls.trigger(u.default.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:o})}}this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(e){var n=/(?:CC|SERVICE)([1-4])/.exec(e.instreamId);if(n){var r="textTrack"+n[1],i=t.captionsProperties[r];i&&(i.label=e.name,e.lang&&(i.languageCode=e.lang),i.media=e)}}))},i.onFragLoaded=function(e){var t=e.frag,n=e.payload,r=this.cea608Parser1,i=this.cea608Parser2,o=this.initPTS,s=this.lastSn,a=this.unparsedVttFrags;if("main"===t.type){var l=t.sn;t.sn!==s+1&&r&&i&&(r.reset(),i.reset()),this.lastSn=l}else if("subtitle"===t.type)if(n.byteLength){if(!Object(c.isFiniteNumber)(o[t.cc]))return a.push(e),void(o.length&&this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t}));var A=t.decryptdata;null!=A&&null!=A.key&&"AES-128"===A.method||this._parseVTTs(t,n)}else this.hls.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t})},i._parseVTTs=function(e,t){var n=this,r=this.hls,i=this.prevCC,o=this.textTracks,s=this.vttCCs;s[e.cc]||(s[e.cc]={start:e.start,prevCC:i,new:!0},this.prevCC=e.cc),Ft.parse(t,this.initPTS[e.cc],s,e.cc,(function(t){if(n.config.renderTextTracksNatively){var i=o[e.level];if("disabled"===i.mode)return void r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e});t.forEach((function(e){if(!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(n){l.logger.debug("Failed occurred on adding cues: "+n);var t=new window.TextTrackCue(e.startTime,e.endTime,e.text);t.id=e.id,i.addCue(t)}}))}else{var s=n.tracks[e.level].default?"default":"subtitles"+e.level;r.trigger(u.default.CUES_PARSED,{type:"subtitles",cues:t,track:s})}r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})}),(function(t){l.logger.log("Failed to parse VTT cue: "+t),r.trigger(u.default.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e})}))},i.onFragDecrypted=function(e){var t=e.frag,n=e.payload;if("subtitle"===t.type){if(!Object(c.isFiniteNumber)(this.initPTS[t.cc]))return void this.unparsedVttFrags.push(e);this._parseVTTs(t,n)}},i.onFragParsingUserdata=function(e){var t=this.cea608Parser1,n=this.cea608Parser2;if(this.enabled&&t&&n)for(var r=0;r<e.samples.length;r++){var i=e.samples[r].bytes;if(i){var o=this.extractCea608Data(i);t.addData(e.samples[r].pts,o[0]),n.addData(e.samples[r].pts,o[1])}}},i.extractCea608Data=function(e){for(var t=31&e[0],n=2,r=[[],[]],i=0;i<t;i++){var o=e[n++],s=127&e[n++],a=127&e[n++],c=3&o;0===s&&0===a||0!=(4&o)&&(0!==c&&1!==c||(r[c].push(s),r[c].push(a)))}return r},r}(d);function jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Gt(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];"subtitles"===r.kind&&r.label&&t.push(e[n])}return t}var Kt=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.MANIFEST_LOADED,u.default.SUBTITLE_TRACK_LOADED)||this).tracks=[],n.trackId=-1,n.media=null,n.stopped=!0,n.subtitleDisplay=!0,n.queuedDefaultTrack=null,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,s,a=r.prototype;return a.destroy=function(){d.prototype.destroy.call(this)},a.onMediaAttached=function(e){var t=this;this.media=e.media,this.media&&(Object(c.isFiniteNumber)(this.queuedDefaultTrack)&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=null),this.trackChangeListener=this._onTextTracksChanged.bind(this),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.subtitlePollingInterval=setInterval((function(){t.trackChangeListener()}),500):this.media.textTracks.addEventListener("change",this.trackChangeListener))},a.onMediaDetaching=function(){this.media&&(this.useTextTrackPolling?clearInterval(this.subtitlePollingInterval):this.media.textTracks.removeEventListener("change",this.trackChangeListener),Object(c.isFiniteNumber)(this.subtitleTrack)&&(this.queuedDefaultTrack=this.subtitleTrack),Gt(this.media.textTracks).forEach((function(e){Fe(e)})),this.subtitleTrack=-1,this.media=null)},a.onManifestLoaded=function(e){var t=this,n=e.subtitles||[];this.tracks=n,this.hls.trigger(u.default.SUBTITLE_TRACKS_UPDATED,{subtitleTracks:n}),n.forEach((function(e){e.default&&(t.media?t.subtitleTrack=e.id:t.queuedDefaultTrack=e.id)}))},a.onSubtitleTrackLoaded=function(e){var t=this,n=e.id,r=e.details,i=this.trackId,o=this.tracks,s=o[i];if(n>=o.length||n!==i||!s||this.stopped)this._clearReloadTimer();else if(l.logger.log("subtitle track "+n+" loaded"),r.live){var a=oe(s.details,r,e.stats.trequest);l.logger.log("Reloading live subtitle playlist in "+a+"ms"),this.timer=setTimeout((function(){t._loadCurrentTrack()}),a)}else this._clearReloadTimer()},a.startLoad=function(){this.stopped=!1,this._loadCurrentTrack()},a.stopLoad=function(){this.stopped=!0,this._clearReloadTimer()},a._clearReloadTimer=function(){this.timer&&(clearTimeout(this.timer),this.timer=null)},a._loadCurrentTrack=function(){var e=this.trackId,t=this.tracks,n=this.hls,r=t[e];e<0||!r||r.details&&!r.details.live||(l.logger.log("Loading subtitle track "+e),n.trigger(u.default.SUBTITLE_TRACK_LOADING,{url:r.url,id:e}))},a._toggleTrackModes=function(e){var t=this.media,n=this.subtitleDisplay,r=this.trackId;if(t){var i=Gt(t.textTracks);if(-1===e)[].slice.call(i).forEach((function(e){e.mode="disabled"}));else{var o=i[r];o&&(o.mode="disabled")}var s=i[e];s&&(s.mode=n?"showing":"hidden")}},a._setSubtitleTrackInternal=function(e){var t=this.hls,n=this.tracks;!Object(c.isFiniteNumber)(e)||e<-1||e>=n.length||(this.trackId=e,l.logger.log("Switching to subtitle track "+e),t.trigger(u.default.SUBTITLE_TRACK_SWITCH,{id:e}),this._loadCurrentTrack())},a._onTextTracksChanged=function(){if(this.media&&this.hls.config.renderTextTracksNatively){for(var e=-1,t=Gt(this.media.textTracks),n=0;n<t.length;n++)if("hidden"===t[n].mode)e=n;else if("showing"===t[n].mode){e=n;break}this.subtitleTrack=e}},i=r,(o=[{key:"subtitleTracks",get:function(){return this.tracks}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.trackId!==e&&(this._toggleTrackModes(e),this._setSubtitleTrackInternal(e))}}])&&jt(i.prototype,o),s&&jt(i,s),r}(d),Wt=n("./src/crypt/decrypter.js");var zt,qt=window.performance,Yt=function(e){var t,n;function r(t,n){var r;return(r=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.ERROR,u.default.KEY_LOADED,u.default.FRAG_LOADED,u.default.SUBTITLE_TRACKS_UPDATED,u.default.SUBTITLE_TRACK_SWITCH,u.default.SUBTITLE_TRACK_LOADED,u.default.SUBTITLE_FRAG_PROCESSED,u.default.LEVEL_UPDATED)||this).fragmentTracker=n,r.config=t.config,r.state=ge,r.tracks=[],r.tracksBuffered=[],r.currentTrackId=-1,r.decrypter=new Wt.default(t,t.config),r.lastAVStart=0,r._onMediaSeeking=r.onMediaSeeking.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i=r.prototype;return i.onSubtitleFragProcessed=function(e){var t=e.frag,n=e.success;if(this.fragPrevious=t,this.state=ve,n){var r=this.tracksBuffered[this.currentTrackId];if(r){for(var i,o=t.start,s=0;s<r.length;s++)if(o>=r[s].start&&o<=r[s].end){i=r[s];break}var a=t.start+t.duration;i?i.end=a:(i={start:o,end:a},r.push(i))}}},i.onMediaAttached=function(e){var t=e.media;this.media=t,t.addEventListener("seeking",this._onMediaSeeking),this.state=ve},i.onMediaDetaching=function(){var e=this;this.media&&(this.media.removeEventListener("seeking",this._onMediaSeeking),this.fragmentTracker.removeAllFragments(),this.currentTrackId=-1,this.tracks.forEach((function(t){e.tracksBuffered[t.id]=[]})),this.media=null,this.state=ge)},i.onError=function(e){var t=e.frag;t&&"subtitle"===t.type&&(this.state=ve)},i.onSubtitleTracksUpdated=function(e){var t=this;l.logger.log("subtitle tracks updated"),this.tracksBuffered=[],this.tracks=e.subtitleTracks,this.tracks.forEach((function(e){t.tracksBuffered[e.id]=[]}))},i.onSubtitleTrackSwitch=function(e){if(this.currentTrackId=e.id,this.tracks&&this.tracks.length&&-1!==this.currentTrackId){var t=this.tracks[this.currentTrackId];t&&t.details&&this.setInterval(500)}else this.clearInterval()},i.onSubtitleTrackLoaded=function(e){var t=e.id,n=e.details,r=this.currentTrackId,i=this.tracks,o=i[r];t>=i.length||t!==r||!o||(n.live&&function(e,t,n){void 0===n&&(n=0);var r=-1;ie(e,t,(function(e,t,n){t.start=e.start,r=n}));var i=t.fragments;if(r<0)i.forEach((function(e){e.start+=n}));else for(var o=r+1;o<i.length;o++)i[o].start=i[o-1].start+i[o-1].duration}(o.details,n,this.lastAVStart),o.details=n,this.setInterval(500))},i.onKeyLoaded=function(){this.state===_e&&(this.state=ve)},i.onFragLoaded=function(e){var t=this.fragCurrent,n=e.frag.decryptdata,r=e.frag,i=this.hls;if(this.state===Ee&&t&&"subtitle"===e.frag.type&&t.sn===e.frag.sn&&e.payload.byteLength>0&&n&&n.key&&"AES-128"===n.method){var o=qt.now();this.decrypter.decrypt(e.payload,n.key.buffer,n.iv.buffer,(function(e){var t=qt.now();i.trigger(u.default.FRAG_DECRYPTED,{frag:r,payload:e,stats:{tstart:o,tdecrypt:t}})}))}},i.onLevelUpdated=function(e){var t=e.details.fragments;this.lastAVStart=t.length?t[0].start:0},i.doTick=function(){if(this.media)switch(this.state){case ve:var e=this.config,t=this.currentTrackId,n=this.fragmentTracker,r=this.media,i=this.tracks;if(!i||!i[t]||!i[t].details)break;var o,s=e.maxBufferHole,a=e.maxFragLookUpTolerance,c=Math.min(e.maxBufferLength,e.maxMaxBufferLength),A=G.bufferedInfo(this._getBuffered(),r.currentTime,s),h=A.end,d=A.len,p=i[t].details,f=p.fragments,g=f.length,m=f[g-1].start+f[g-1].duration;if(d>c)return;var v=this.fragPrevious;h<m?(v&&p.hasProgramDateTime&&(o=ue(f,v.endProgramDateTime,a)),o||(o=le(v,f,h,a))):o=f[g-1],o&&o.encrypted?(l.logger.log("Loading key for "+o.sn),this.state=_e,this.hls.trigger(u.default.KEY_LOADING,{frag:o})):o&&n.getState(o)===U&&(this.fragCurrent=o,this.state=Ee,this.hls.trigger(u.default.FRAG_LOADING,{frag:o}))}else this.state=ve},i.stopLoad=function(){this.lastAVStart=0,e.prototype.stopLoad.call(this)},i._getBuffered=function(){return this.tracksBuffered[this.currentTrackId]||[]},i.onMediaSeeking=function(){this.fragPrevious=null},r}(Ne);!function(e){e.WIDEVINE="com.widevine.alpha",e.PLAYREADY="com.microsoft.playready"}(zt||(zt={}));var Xt="undefined"!=typeof window&&window.navigator&&window.navigator.requestMediaKeySystemAccess?window.navigator.requestMediaKeySystemAccess.bind(window.navigator):null;function Jt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Zt=function(e){var t,n;function r(t){var n;return(n=e.call(this,t,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHED,u.default.MANIFEST_PARSED)||this)._widevineLicenseUrl=void 0,n._licenseXhrSetup=void 0,n._emeEnabled=void 0,n._requestMediaKeySystemAccess=void 0,n._drmSystemOptions=void 0,n._config=void 0,n._mediaKeysList=[],n._media=null,n._hasSetMediaKeys=!1,n._requestLicenseFailureCount=0,n.mediaKeysPromise=null,n._onMediaEncrypted=function(e){if(l.logger.log('Media is encrypted using "'+e.initDataType+'" init data type'),!n.mediaKeysPromise)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void n.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var t=function(t){n._media&&(n._attemptSetMediaKeys(t),n._generateRequestWithPreferredKeySession(e.initDataType,e.initData))};n.mediaKeysPromise.then(t).catch(t)},n._config=t.config,n._widevineLicenseUrl=n._config.widevineLicenseUrl,n._licenseXhrSetup=n._config.licenseXhrSetup,n._emeEnabled=n._config.emeEnabled,n._requestMediaKeySystemAccess=n._config.requestMediaKeySystemAccessFunc,n._drmSystemOptions=t.config.drmSystemOptions,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var i,o,s,c=r.prototype;return c.getLicenseServerUrl=function(e){switch(e){case zt.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+e+'"')},c._attemptKeySystemAccess=function(e,t,n){var r=this,i=function(e,t,n,r){if(e===zt.WIDEVINE)return function(e,t,n){var r={audioCapabilities:[],videoCapabilities:[]};return e.forEach((function(e){r.audioCapabilities.push({contentType:'audio/mp4; codecs="'+e+'"',robustness:n.audioRobustness||""})})),t.forEach((function(e){r.videoCapabilities.push({contentType:'video/mp4; codecs="'+e+'"',robustness:n.videoRobustness||""})})),[r]}(t,n,r);throw new Error("Unknown key-system: "+e)}(e,t,n,this._drmSystemOptions);l.logger.log("Requesting encrypted media key-system access");var o=this.requestMediaKeySystemAccess(e,i);this.mediaKeysPromise=o.then((function(t){return r._onMediaKeySystemAccessObtained(e,t)})),o.catch((function(t){l.logger.error('Failed to obtain key-system "'+e+'" access:',t)}))},c._onMediaKeySystemAccessObtained=function(e,t){var n=this;l.logger.log('Access for key-system "'+e+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:e};this._mediaKeysList.push(r);var i=Promise.resolve().then((function(){return t.createMediaKeys()})).then((function(t){return r.mediaKeys=t,l.logger.log('Media-keys created for key-system "'+e+'"'),n._onMediaKeysCreated(),t}));return i.catch((function(e){l.logger.error("Failed to create media-keys:",e)})),i},c._onMediaKeysCreated=function(){var e=this;this._mediaKeysList.forEach((function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),e._onNewMediaKeySession(t.mediaKeysSession))}))},c._onNewMediaKeySession=function(e){var t=this;l.logger.log("New key-system session "+e.sessionId),e.addEventListener("message",(function(n){t._onKeySessionMessage(e,n.message)}),!1)},c._onKeySessionMessage=function(e,t){l.logger.log("Got EME message event, creating license request"),this._requestLicense(t,(function(t){l.logger.log("Received license data (length: "+(t?t.byteLength:t)+"), updating key-session"),e.update(t)}))},c._attemptSetMediaKeys=function(e){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys)return l.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});l.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},c._generateRequestWithPreferredKeySession=function(e,t){var n=this,r=this._mediaKeysList[0];if(!r)return l.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(r.mediaKeysSessionInitialized)l.logger.warn("Key-Session already initialized but requested again");else{var i=r.mediaKeysSession;if(!i)return l.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!t)return l.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});l.logger.log('Generating key-session request for "'+e+'" init data type'),r.mediaKeysSessionInitialized=!0,i.generateRequest(e,t).then((function(){l.logger.debug("Key-session generation succeeded")})).catch((function(e){l.logger.error("Error generating key-session request:",e),n.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},c._createLicenseXhr=function(e,t,n){var r=new XMLHttpRequest,i=this._licenseXhrSetup;try{if(i)try{i(r,e)}catch(t){r.open("POST",e,!0),i(r,e)}r.readyState||r.open("POST",e,!0)}catch(e){throw new Error("issue setting up KeySystem license XHR "+e)}return r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,e,t,n),r},c._onLicenseRequestReadyStageChange=function(e,t,n,r){if(4===e.readyState)if(200===e.status)this._requestLicenseFailureCount=0,l.logger.log("License request succeeded"),"arraybuffer"!==e.responseType&&l.logger.warn("xhr response type was not set to the expected arraybuffer for license request"),r(e.response);else{if(l.logger.error("License Request XHR failed ("+t+"). Status: "+e.status+" ("+e.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var i=3-this._requestLicenseFailureCount+1;l.logger.warn("Retrying license request, "+i+" attempts left"),this._requestLicense(n,r)}},c._generateLicenseRequestChallenge=function(e,t){if(e.mediaKeySystemDomain===zt.WIDEVINE)return t;throw new Error("unsupported key-system: "+e.mediaKeySystemDomain)},c._requestLicense=function(e,t){l.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return l.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),i=this._createLicenseXhr(r,e,t);l.logger.log("Sending license request to URL: "+r);var o=this._generateLicenseRequestChallenge(n,e);i.send(o)}catch(e){l.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(u.default.ERROR,{type:a.ErrorTypes.KEY_SYSTEM_ERROR,details:a.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},c.onMediaAttached=function(e){if(this._emeEnabled){var t=e.media;this._media=t,t.addEventListener("encrypted",this._onMediaEncrypted)}},c.onMediaDetached=function(){var e=this._media,t=this._mediaKeysList;e&&(e.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map((function(e){if(e.mediaKeysSession)return e.mediaKeysSession.close().catch((function(){}))}))).then((function(){return e.setMediaKeys(null)})).catch((function(){})))},c.onManifestParsed=function(e){if(this._emeEnabled){var t=e.levels.map((function(e){return e.audioCodec})),n=e.levels.map((function(e){return e.videoCodec}));this._attemptKeySystemAccess(zt.WIDEVINE,t,n)}},i=r,(o=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&Jt(i.prototype,o),s&&Jt(i,s),r}(d);function $t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function en(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$t(Object(n),!0).forEach((function(t){tn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function tn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var nn=en(en({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,liveDurationInfinity:!1,liveBackBufferLength:1/0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Ze,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,abrController:Ke,bufferController:ze,capLevelController:Ye,fpsController:Je,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:Xt,testBandwidth:!0},{cueHandler:r,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:Yt,subtitleTrackController:Kt,timelineController:Qt,audioStreamController:rt,audioTrackController:et,emeController:Zt});function rn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function on(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rn(Object(n),!0).forEach((function(t){sn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function sn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function an(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function cn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function un(e,t,n){return t&&cn(e.prototype,t),n&&cn(e,n),e}var ln=function(e){var t,n;function r(t){var n;void 0===t&&(t={}),(n=e.call(this)||this).config=void 0,n._autoLevelCapping=void 0,n.abrController=void 0,n.capLevelController=void 0,n.levelController=void 0,n.streamController=void 0,n.networkControllers=void 0,n.audioTrackController=void 0,n.subtitleTrackController=void 0,n.emeController=void 0,n.coreComponents=void 0,n.media=null,n.url=null;var i=r.DefaultConfig;if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");n.config=on(on({},i),t);var o=an(n).config;if(void 0!==o.liveMaxLatencyDurationCount&&o.liveMaxLatencyDurationCount<=o.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==o.liveMaxLatencyDuration&&(void 0===o.liveSyncDuration||o.liveMaxLatencyDuration<=o.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');Object(l.enableLogs)(o.debug),n._autoLevelCapping=-1;var s=n.abrController=new o.abrController(an(n)),a=new o.bufferController(an(n)),c=n.capLevelController=new o.capLevelController(an(n)),u=new o.fpsController(an(n)),A=new M(an(n)),h=new P(an(n)),d=new k(an(n)),p=new He(an(n)),f=n.levelController=new Pe(an(n)),g=new Q(an(n)),m=[f,n.streamController=new De(an(n),g)],v=o.audioStreamController;v&&m.push(new v(an(n),g)),n.networkControllers=m;var y=[A,h,d,s,a,c,u,p,g];if(v=o.audioTrackController){var _=new v(an(n));n.audioTrackController=_,y.push(_)}if(v=o.subtitleTrackController){var E=new v(an(n));n.subtitleTrackController=E,m.push(E)}if(v=o.emeController){var b=new v(an(n));n.emeController=b,y.push(b)}return(v=o.subtitleStreamController)&&m.push(new v(an(n),g)),(v=o.timelineController)&&y.push(new v(an(n))),n.coreComponents=y,n}n=e,(t=r).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n,r.isSupported=function(){return function(){var e=q();if(!e)return!1;var t=self.SourceBuffer||self.WebKitSourceBuffer,n=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!n&&!!r}()},un(r,null,[{key:"version",get:function(){return"0.14.12"}},{key:"Events",get:function(){return u.default}},{key:"ErrorTypes",get:function(){return a.ErrorTypes}},{key:"ErrorDetails",get:function(){return a.ErrorDetails}},{key:"DefaultConfig",get:function(){return r.defaultConfig?r.defaultConfig:nn},set:function(e){r.defaultConfig=e}}]);var i=r.prototype;return i.destroy=function(){l.logger.log("destroy"),this.trigger(u.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach((function(e){e.destroy()})),this.url=null,this.removeAllListeners(),this._autoLevelCapping=-1},i.attachMedia=function(e){l.logger.log("attachMedia"),this.media=e,this.trigger(u.default.MEDIA_ATTACHING,{media:e})},i.detachMedia=function(){l.logger.log("detachMedia"),this.trigger(u.default.MEDIA_DETACHING),this.media=null},i.loadSource=function(e){e=s.buildAbsoluteURL(window.location.href,e,{alwaysNormalize:!0}),l.logger.log("loadSource:"+e),this.url=e,this.trigger(u.default.MANIFEST_LOADING,{url:e})},i.startLoad=function(e){void 0===e&&(e=-1),l.logger.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},i.stopLoad=function(){l.logger.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},i.swapAudioCodec=function(){l.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},i.recoverMediaError=function(){l.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),e&&this.attachMedia(e)},i.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},un(r,[{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){l.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){l.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){l.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){l.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){l.logger.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){l.logger.log("set autoLevelCapping:"+e),this._autoLevelCapping=e}},{key:"bandwidthEstimate",get:function(){var e=this.abrController._bwEstimator;return e?e.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){for(var e=this.levels,t=this.config.minAutoBitrate,n=e?e.length:0,r=0;r<n;r++){if((e[r].realBitrate?Math.max(e[r].realBitrate,e[r].bitrate):e[r].bitrate)>t)return r}return 0}},{key:"maxAutoLevel",get:function(){var e=this.levels,t=this.autoLevelCapping;return-1===t&&e&&e.length?e.length-1:t}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"liveSyncPosition",get:function(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}}]),r}(X);ln.defaultConfig=void 0},"./src/polyfills/number.js":
/*!*********************************!*\
  !*** ./src/polyfills/number.js ***!
  \*********************************/
/*! exports provided: isFiniteNumber, MAX_SAFE_INTEGER */function(e,t,n){"use strict";n.r(t),n.d(t,"isFiniteNumber",(function(){return r})),n.d(t,"MAX_SAFE_INTEGER",(function(){return i}));var r=Number.isFinite||function(e){return"number"==typeof e&&isFinite(e)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/utils/get-self-scope.js":
/*!*************************************!*\
  !*** ./src/utils/get-self-scope.js ***!
  \*************************************/
/*! exports provided: getSelfScope */function(e,t,n){"use strict";function r(){return"undefined"==typeof window?self:window}n.r(t),n.d(t,"getSelfScope",(function(){return r}))},"./src/utils/logger.js":
/*!*****************************!*\
  !*** ./src/utils/logger.js ***!
  \*****************************/
/*! exports provided: enableLogs, logger */function(e,t,n){"use strict";n.r(t),n.d(t,"enableLogs",(function(){return l})),n.d(t,"logger",(function(){return A}));var r=n(/*! ./get-self-scope */"./src/utils/get-self-scope.js");function i(){}var o={trace:i,debug:i,log:i,warn:i,info:i,error:i},s=o;function a(e,t){return t="["+e+"] > "+t}var c=Object(r.getSelfScope)();function u(e){var t=c.console[e];return t?function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];r[0]&&(r[0]=a(e,r[0])),t.apply(c.console,r)}:i}var l=function(e){if(c.console&&!0===e||"object"==typeof e){!function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach((function(t){s[t]=e[t]?e[t].bind(e):u(t)}))}(e,"debug","log","info","warn","error");try{s.log()}catch(e){s=o}}else s=o},A=s}}).default})),
/**
  @license
                                 Apache License
                         Version 2.0, January 2004
                      http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

    "License" shall mean the terms and conditions for use, reproduction,
    and distribution as defined by Sections 1 through 9 of this document.

    "Licensor" shall mean the copyright owner or entity authorized by
    the copyright owner that is granting the License.

    "Legal Entity" shall mean the union of the acting entity and all
    other entities that control, are controlled by, or are under common
    control with that entity. For the purposes of this definition,
    "control" means (i) the power, direct or indirect, to cause the
    direction or management of such entity, whether by contract or
    otherwise, or (ii) ownership of fifty percent (50%) or more of the
    outstanding shares, or (iii) beneficial ownership of such entity.

    "You" (or "Your") shall mean an individual or Legal Entity
    exercising permissions granted by this License.

    "Source" form shall mean the preferred form for making modifications,
    including but not limited to software source code, documentation
    source, and configuration files.

    "Object" form shall mean any form resulting from mechanical
    transformation or translation of a Source form, including but
    not limited to compiled object code, generated documentation,
    and conversions to other media types.

    "Work" shall mean the work of authorship, whether in Source or
    Object form, made available under the License, as indicated by a
    copyright notice that is included in or attached to the work
    (an example is provided in the Appendix below).

    "Derivative Works" shall mean any work, whether in Source or Object
    form, that is based on (or derived from) the Work and for which the
    editorial revisions, annotations, elaborations, or other modifications
    represent, as a whole, an original work of authorship. For the purposes
    of this License, Derivative Works shall not include works that remain
    separable from, or merely link (or bind by name) to the interfaces of,
    the Work and Derivative Works thereof.

    "Contribution" shall mean any work of authorship, including
    the original version of the Work and any modifications or additions
    to that Work or Derivative Works thereof, that is intentionally
    submitted to Licensor for inclusion in the Work by the copyright owner
    or by an individual or Legal Entity authorized to submit on behalf of
    the copyright owner. For the purposes of this definition, "submitted"
    means any form of electronic, verbal, or written communication sent
    to the Licensor or its representatives, including but not limited to
    communication on electronic mailing lists, source code control systems,
    and issue tracking systems that are managed by, or on behalf of, the
    Licensor for the purpose of discussing and improving the Work, but
    excluding communication that is conspicuously marked or otherwise
    designated in writing by the copyright owner as "Not a Contribution."

    "Contributor" shall mean Licensor and any individual or Legal Entity
    on behalf of whom a Contribution has been received by Licensor and
    subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    copyright license to reproduce, prepare Derivative Works of,
    publicly display, publicly perform, sublicense, and distribute the
    Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    (except as stated in this section) patent license to make, have made,
    use, offer to sell, sell, import, and otherwise transfer the Work,
    where such license applies only to those patent claims licensable
    by such Contributor that are necessarily infringed by their
    Contribution(s) alone or by combination of their Contribution(s)
    with the Work to which such Contribution(s) was submitted. If You
    institute patent litigation against any entity (including a
    cross-claim or counterclaim in a lawsuit) alleging that the Work
    or a Contribution incorporated within the Work constitutes direct
    or contributory patent infringement, then any patent licenses
    granted to You under this License for that Work shall terminate
    as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
    Work or Derivative Works thereof in any medium, with or without
    modifications, and in Source or Object form, provided that You
    meet the following conditions:

    (a) You must give any other recipients of the Work or
        Derivative Works a copy of this License; and

    (b) You must cause any modified files to carry prominent notices
        stating that You changed the files; and

    (c) You must retain, in the Source form of any Derivative Works
        that You distribute, all copyright, patent, trademark, and
        attribution notices from the Source form of the Work,
        excluding those notices that do not pertain to any part of
        the Derivative Works; and

    (d) If the Work includes a "NOTICE" text file as part of its
        distribution, then any Derivative Works that You distribute must
        include a readable copy of the attribution notices contained
        within such NOTICE file, excluding those notices that do not
        pertain to any part of the Derivative Works, in at least one
        of the following places: within a NOTICE text file distributed
        as part of the Derivative Works; within the Source form or
        documentation, if provided along with the Derivative Works; or,
        within a display generated by the Derivative Works, if and
        wherever such third-party notices normally appear. The contents
        of the NOTICE file are for informational purposes only and
        do not modify the License. You may add Your own attribution
        notices within Derivative Works that You distribute, alongside
        or as an addendum to the NOTICE text from the Work, provided
        that such additional attribution notices cannot be construed
        as modifying the License.

    You may add Your own copyright statement to Your modifications and
    may provide additional or different license terms and conditions
    for use, reproduction, or distribution of Your modifications, or
    for any such Derivative Works as a whole, provided Your use,
    reproduction, and distribution of the Work otherwise complies with
    the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
    any Contribution intentionally submitted for inclusion in the Work
    by You to the Licensor shall be under the terms and conditions of
    this License, without any additional terms or conditions.
    Notwithstanding the above, nothing herein shall supersede or modify
    the terms of any separate license agreement you may have executed
    with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
    names, trademarks, service marks, or product names of the Licensor,
    except as required for reasonable and customary use in describing the
    origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
    agreed to in writing, Licensor provides the Work (and each
    Contributor provides its Contributions) on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied, including, without limitation, any warranties or conditions
    of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
    PARTICULAR PURPOSE. You are solely responsible for determining the
    appropriateness of using or redistributing the Work and assume any
    risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
    whether in tort (including negligence), contract, or otherwise,
    unless required by applicable law (such as deliberate and grossly
    negligent acts) or agreed to in writing, shall any Contributor be
    liable to You for damages, including any direct, indirect, special,
    incidental, or consequential damages of any character arising as a
    result of this License or out of the use or inability to use the
    Work (including but not limited to damages for loss of goodwill,
    work stoppage, computer failure or malfunction, or any and all
    other commercial damages or losses), even if such Contributor
    has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
    the Work or Derivative Works thereof, You may choose to offer,
    and charge a fee for, acceptance of support, warranty, indemnity,
    or other liability obligations and/or rights consistent with this
    License. However, in accepting such obligations, You may act only
    on Your own behalf and on Your sole responsibility, not on behalf
    of any other Contributor, and only if You agree to indemnify,
    defend, and hold each Contributor harmless for any liability
    incurred by, or claims asserted against, such Contributor by reason
    of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

    To apply the Apache License to your work, attach the following
    boilerplate notice, with the fields enclosed by brackets "[]"
    replaced with your own identifying information. (Don't include
    the brackets!)  The text should be enclosed in the appropriate
    comment syntax for the file format. We also recommend that a
    file or class name and description of purpose be included on the
    same "printed page" as the copyright notice for easier
    identification within third-party archives.

 Copyright (c) 2015-2018 Google, Inc., Netflix, Inc., Microsoft Corp. and contributors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 

 **/
/**
  @license
                                 Apache License
                         Version 2.0, January 2004
                      http://www.apache.org/licenses/

 TERMS AND CONDITIONS FOR USE, REPRODUCTION, AND DISTRIBUTION

 1. Definitions.

    "License" shall mean the terms and conditions for use, reproduction,
    and distribution as defined by Sections 1 through 9 of this document.

    "Licensor" shall mean the copyright owner or entity authorized by
    the copyright owner that is granting the License.

    "Legal Entity" shall mean the union of the acting entity and all
    other entities that control, are controlled by, or are under common
    control with that entity. For the purposes of this definition,
    "control" means (i) the power, direct or indirect, to cause the
    direction or management of such entity, whether by contract or
    otherwise, or (ii) ownership of fifty percent (50%) or more of the
    outstanding shares, or (iii) beneficial ownership of such entity.

    "You" (or "Your") shall mean an individual or Legal Entity
    exercising permissions granted by this License.

    "Source" form shall mean the preferred form for making modifications,
    including but not limited to software source code, documentation
    source, and configuration files.

    "Object" form shall mean any form resulting from mechanical
    transformation or translation of a Source form, including but
    not limited to compiled object code, generated documentation,
    and conversions to other media types.

    "Work" shall mean the work of authorship, whether in Source or
    Object form, made available under the License, as indicated by a
    copyright notice that is included in or attached to the work
    (an example is provided in the Appendix below).

    "Derivative Works" shall mean any work, whether in Source or Object
    form, that is based on (or derived from) the Work and for which the
    editorial revisions, annotations, elaborations, or other modifications
    represent, as a whole, an original work of authorship. For the purposes
    of this License, Derivative Works shall not include works that remain
    separable from, or merely link (or bind by name) to the interfaces of,
    the Work and Derivative Works thereof.

    "Contribution" shall mean any work of authorship, including
    the original version of the Work and any modifications or additions
    to that Work or Derivative Works thereof, that is intentionally
    submitted to Licensor for inclusion in the Work by the copyright owner
    or by an individual or Legal Entity authorized to submit on behalf of
    the copyright owner. For the purposes of this definition, "submitted"
    means any form of electronic, verbal, or written communication sent
    to the Licensor or its representatives, including but not limited to
    communication on electronic mailing lists, source code control systems,
    and issue tracking systems that are managed by, or on behalf of, the
    Licensor for the purpose of discussing and improving the Work, but
    excluding communication that is conspicuously marked or otherwise
    designated in writing by the copyright owner as "Not a Contribution."

    "Contributor" shall mean Licensor and any individual or Legal Entity
    on behalf of whom a Contribution has been received by Licensor and
    subsequently incorporated within the Work.

 2. Grant of Copyright License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    copyright license to reproduce, prepare Derivative Works of,
    publicly display, publicly perform, sublicense, and distribute the
    Work and such Derivative Works in Source or Object form.

 3. Grant of Patent License. Subject to the terms and conditions of
    this License, each Contributor hereby grants to You a perpetual,
    worldwide, non-exclusive, no-charge, royalty-free, irrevocable
    (except as stated in this section) patent license to make, have made,
    use, offer to sell, sell, import, and otherwise transfer the Work,
    where such license applies only to those patent claims licensable
    by such Contributor that are necessarily infringed by their
    Contribution(s) alone or by combination of their Contribution(s)
    with the Work to which such Contribution(s) was submitted. If You
    institute patent litigation against any entity (including a
    cross-claim or counterclaim in a lawsuit) alleging that the Work
    or a Contribution incorporated within the Work constitutes direct
    or contributory patent infringement, then any patent licenses
    granted to You under this License for that Work shall terminate
    as of the date such litigation is filed.

 4. Redistribution. You may reproduce and distribute copies of the
    Work or Derivative Works thereof in any medium, with or without
    modifications, and in Source or Object form, provided that You
    meet the following conditions:

    (a) You must give any other recipients of the Work or
        Derivative Works a copy of this License; and

    (b) You must cause any modified files to carry prominent notices
        stating that You changed the files; and

    (c) You must retain, in the Source form of any Derivative Works
        that You distribute, all copyright, patent, trademark, and
        attribution notices from the Source form of the Work,
        excluding those notices that do not pertain to any part of
        the Derivative Works; and

    (d) If the Work includes a "NOTICE" text file as part of its
        distribution, then any Derivative Works that You distribute must
        include a readable copy of the attribution notices contained
        within such NOTICE file, excluding those notices that do not
        pertain to any part of the Derivative Works, in at least one
        of the following places: within a NOTICE text file distributed
        as part of the Derivative Works; within the Source form or
        documentation, if provided along with the Derivative Works; or,
        within a display generated by the Derivative Works, if and
        wherever such third-party notices normally appear. The contents
        of the NOTICE file are for informational purposes only and
        do not modify the License. You may add Your own attribution
        notices within Derivative Works that You distribute, alongside
        or as an addendum to the NOTICE text from the Work, provided
        that such additional attribution notices cannot be construed
        as modifying the License.

    You may add Your own copyright statement to Your modifications and
    may provide additional or different license terms and conditions
    for use, reproduction, or distribution of Your modifications, or
    for any such Derivative Works as a whole, provided Your use,
    reproduction, and distribution of the Work otherwise complies with
    the conditions stated in this License.

 5. Submission of Contributions. Unless You explicitly state otherwise,
    any Contribution intentionally submitted for inclusion in the Work
    by You to the Licensor shall be under the terms and conditions of
    this License, without any additional terms or conditions.
    Notwithstanding the above, nothing herein shall supersede or modify
    the terms of any separate license agreement you may have executed
    with Licensor regarding such Contributions.

 6. Trademarks. This License does not grant permission to use the trade
    names, trademarks, service marks, or product names of the Licensor,
    except as required for reasonable and customary use in describing the
    origin of the Work and reproducing the content of the NOTICE file.

 7. Disclaimer of Warranty. Unless required by applicable law or
    agreed to in writing, Licensor provides the Work (and each
    Contributor provides its Contributions) on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or
    implied, including, without limitation, any warranties or conditions
    of TITLE, NON-INFRINGEMENT, MERCHANTABILITY, or FITNESS FOR A
    PARTICULAR PURPOSE. You are solely responsible for determining the
    appropriateness of using or redistributing the Work and assume any
    risks associated with Your exercise of permissions under this License.

 8. Limitation of Liability. In no event and under no legal theory,
    whether in tort (including negligence), contract, or otherwise,
    unless required by applicable law (such as deliberate and grossly
    negligent acts) or agreed to in writing, shall any Contributor be
    liable to You for damages, including any direct, indirect, special,
    incidental, or consequential damages of any character arising as a
    result of this License or out of the use or inability to use the
    Work (including but not limited to damages for loss of goodwill,
    work stoppage, computer failure or malfunction, or any and all
    other commercial damages or losses), even if such Contributor
    has been advised of the possibility of such damages.

 9. Accepting Warranty or Additional Liability. While redistributing
    the Work or Derivative Works thereof, You may choose to offer,
    and charge a fee for, acceptance of support, warranty, indemnity,
    or other liability obligations and/or rights consistent with this
    License. However, in accepting such obligations, You may act only
    on Your own behalf and on Your sole responsibility, not on behalf
    of any other Contributor, and only if You agree to indemnify,
    defend, and hold each Contributor harmless for any liability
    incurred by, or claims asserted against, such Contributor by reason
    of your accepting any such warranty or additional liability.

 END OF TERMS AND CONDITIONS

 APPENDIX: How to apply the Apache License to your work.

    To apply the Apache License to your work, attach the following
    boilerplate notice, with the fields enclosed by brackets "[]"
    replaced with your own identifying information. (Don't include
    the brackets!)  The text should be enclosed in the appropriate
    comment syntax for the file format. We also recommend that a
    file or class name and description of purpose be included on the
    same "printed page" as the copyright notice for easier
    identification within third-party archives.

 Copyright (c) 2015-2018 Google, Inc., Netflix, Inc., Microsoft Corp. and contributors

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
 

 **/
function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("rxjs",["exports"],t):t(e.rxjs={})}(this,(function(e){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};function n(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e};function i(e){return"function"==typeof e}var o=!1,s={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else o&&console.log("RxJS: Back to a better error behavior. Thank you. <3");o=e},get useDeprecatedSynchronousErrorHandling(){return o}};function a(e){setTimeout((function(){throw e}),0)}var c={closed:!0,next:function(e){},error:function(e){if(s.useDeprecatedSynchronousErrorHandling)throw e;a(e)},complete:function(){}},u=Array.isArray||function(e){return e&&"number"==typeof e.length};function l(e){return null!==e&&"object"==typeof e}var A=function(){function e(e){return Error.call(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),h=function(){function e(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var n=this,r=n._parentOrParents,o=n._ctorUnsubscribe,s=n._unsubscribe,a=n._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof e)r.remove(this);else if(null!==r)for(var c=0;c<r.length;++c){r[c].remove(this)}if(i(s)){o&&(this._unsubscribe=void 0);try{s.call(this)}catch(e){t=e instanceof A?d(e.errors):[e]}}if(u(a)){c=-1;for(var h=a.length;++c<h;){var p=a[c];if(l(p))try{p.unsubscribe()}catch(e){t=t||[],e instanceof A?t=t.concat(d(e.errors)):t.push(e)}}}if(t)throw new A(t)}},e.prototype.add=function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();function d(e){return e.reduce((function(e,t){return e.concat(t instanceof A?t.errors:t)}),[])}var p="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),f=function(e){function t(n,r,i){var o=e.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=c;break;case 1:if(!n){o.destination=c;break}if("object"==typeof n){n instanceof t?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new g(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new g(o,n,r,i)}return o}return n(t,e),t.prototype[p]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this},t}(h),g=function(e){function t(t,n,r,o){var s,a=e.call(this)||this;a._parentSubscriber=t;var u=a;return i(n)?s=n:n&&(s=n.next,r=n.error,o=n.complete,n!==c&&(i((u=Object.create(n)).unsubscribe)&&a.add(u.unsubscribe.bind(u)),u.unsubscribe=a.unsubscribe.bind(a))),a._context=u,a._next=s,a._error=r,a._complete=o,a}return n(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;s.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=s.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):a(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;a(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};s.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){if(this.unsubscribe(),s.useDeprecatedSynchronousErrorHandling)throw e;a(e)}},t.prototype.__tryOrSetError=function(e,t,n){if(!s.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(t){return s.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=t,e.syncErrorThrown=!0,!0):(a(t),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(f);function m(e){for(;e;){var t=e,n=t.closed,r=t.destination,i=t.isStopped;if(n||i)return!1;e=r&&r instanceof f?r:null}return!0}var v="function"==typeof Symbol&&Symbol.observable||"@@observable";function y(e){return e}function _(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return E(e)}function E(e){return 0===e.length?y:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var b=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this.operator,i=function(e,t,n){if(e){if(e instanceof f)return e;if(e[p])return e[p]()}return e||t||n?new f(e,t,n):new f(c)}(e,t,n);if(r?i.add(r.call(i,this.source)):i.add(this.source||s.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),s.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){s.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),m(e)?e.error(t):console.warn(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=w(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(e){r(e),i&&i.unsubscribe()}}),r,t)}))},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[v]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:E(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=w(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function w(e){if(e||(e=s.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var S=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),T=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return n(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(h),C=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return n(t,e),t}(f),R=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return n(t,e),t.prototype[p]=function(){return new C(this)},t.prototype.lift=function(e){var t=new I(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new S;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new S;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new S;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new S;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new S;return this.hasError?(e.error(this.thrownError),h.EMPTY):this.isStopped?(e.complete(),h.EMPTY):(this.observers.push(e),new T(this,e))},t.prototype.asObservable=function(){var e=new b;return e.source=this,e},t.create=function(e,t){return new I(e,t)},t}(b),I=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return n(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):h.EMPTY},t}(R);function O(){return function(e){return e.lift(new N(e))}}var x,N=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new B(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),B=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return n(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(f),L=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return n(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new h).add(this.source.subscribe(new M(this.getSubject(),this))),e.closed&&(this._connection=null,e=h.EMPTY)),e},t.prototype.refCount=function(){return O()(this)},t}(b),D={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:(x=L.prototype)._subscribe},_isComplete:{value:x._isComplete,writable:!0},getSubject:{value:x.getSubject},connect:{value:x.connect},refCount:{value:x.refCount}},M=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return n(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(C);!function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}n(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}(f);var P=function(){function e(e,t,n,r){this.keySelector=e,this.elementSelector=t,this.durationSelector=n,this.subjectSelector=r}return e.prototype.call=function(e,t){return t.subscribe(new k(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),k=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.keySelector=n,s.elementSelector=r,s.durationSelector=i,s.subjectSelector=o,s.groups=null,s.attemptedToUnsubscribe=!1,s.count=0,s}return n(t,e),t.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(e){return void this.error(e)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(t);if(this.elementSelector)try{r=this.elementSelector(e)}catch(e){this.error(e)}else r=e;if(!i){i=this.subjectSelector?this.subjectSelector():new R,n.set(t,i);var o=new F(t,i,this);if(this.destination.next(o),this.durationSelector){var s=void 0;try{s=this.durationSelector(new F(t,i))}catch(e){return void this.error(e)}this.add(s.subscribe(new U(t,i,this)))}}i.closed||i.next(r)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach((function(t,n){t.error(e)})),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach((function(e,t){e.complete()})),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},t}(f),U=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return n(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(f),F=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return n(t,e),t.prototype._subscribe=function(e){var t=new h,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new H(n)),t.add(r.subscribe(e)),t},t}(b),H=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return n(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(h),V=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return n(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new S;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(R),Q=function(e){function t(t,n){return e.call(this)||this}return n(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(h),j=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return n(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(e){n=!0,r=!!e&&e||new Error(e)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(Q),G=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return n(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(j),K=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}(),W=function(e){function t(n,r){void 0===r&&(r=K.now);var i=e.call(this,n,(function(){return t.delegate&&t.delegate!==i?t.delegate.now():r()}))||this;return i.actions=[],i.active=!1,i.scheduled=void 0,i}return n(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(K),z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t}(W),q=new z(G),Y=q,X=new b((function(e){return e.complete()}));function J(e){return e?function(e){return new b((function(t){return e.schedule((function(){return t.complete()}))}))}(e):X}function Z(e){return e&&"function"==typeof e.schedule}var $,ee=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}};function te(e,t){return new b((function(n){var r=new h,i=0;return r.add(t.schedule((function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function ne(e,t){return t?te(e,t):new b(ee(e))}function re(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return Z(n)?(e.pop(),te(e,n)):ne(e)}function ie(e,t){return new b(t?function(n){return t.schedule(oe,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function oe(e){var t=e.error;e.subscriber.error(t)}($=e.NotificationKind||(e.NotificationKind={})).NEXT="N",$.ERROR="E",$.COMPLETE="C";var se=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return re(this.value);case"E":return ie(this.error);case"C":return J()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}();var ae=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new ce(e,this.scheduler,this.delay))},e}(),ce=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return n(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.destination.add(this.scheduler.schedule(t.dispatch,this.delay,new ue(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(se.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(se.createError(e)),this.unsubscribe()},t.prototype._complete=function(){this.scheduleMessage(se.createComplete()),this.unsubscribe()},t}(f),ue=function(e,t){this.notification=e,this.destination=t},le=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=t<1?1:t,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return n(t,e),t.prototype.nextInfiniteTimeWindow=function(t){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift(),e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this._events.push(new Ae(this._getNow(),t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new S;if(this.isStopped||this.hasError?t=h.EMPTY:(this.observers.push(e),t=new T(this,e)),i&&e.add(e=new ce(e,i)),n)for(var s=0;s<o&&!e.closed;s++)e.next(r[s]);else for(s=0;s<o&&!e.closed;s++)e.next(r[s].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||Y).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),o>0&&r.splice(0,o),r},t}(R),Ae=function(e,t){this.time=e,this.value=t},he=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return n(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),h.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),h.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(R),de=1,pe=Promise.resolve(),fe={};function ge(e){return e in fe&&(delete fe[e],!0)}var me=function(e){var t=de++;return fe[t]=!0,pe.then((function(){return ge(t)&&e()})),t},ve=function(e){ge(e)},ye=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return n(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=me(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(ve(n),t.scheduled=void 0)},t}(j),_e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(W),Ee=new _e(ye),be=Ee,we=new W(j),Se=we,Te=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return n(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame((function(){return t.flush(null)}))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(j),Ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(W),Re=new Ce(Te),Ie=Re,Oe=function(e){function t(t,n){void 0===t&&(t=xe),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,(function(){return r.frame}))||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return n(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n[0])&&t.delay<=r&&(n.shift(),this.frame=t.delay,!(e=t.execute(t.state,t.delay))););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(W),xe=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return n(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var i=e.actions;return i.push(this),i.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(j);function Ne(){}var Be=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),Le=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),De=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}();function Me(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new Pe(e,t))}}var Pe=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new ke(e,this.project,this.thisArg))},e}(),ke=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return n(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(f);function Ue(e){var t=this,n=e.args,r=e.subscriber,i=e.params,o=i.callbackFunc,s=i.context,a=i.scheduler,c=i.subject;if(!c){c=i.subject=new he;try{o.apply(s,n.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.length<=1?e[0]:e;t.add(a.schedule(Fe,0,{value:r,subject:c}))}]))}catch(e){c.error(e)}}this.add(c.subscribe(r))}function Fe(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function He(e){var t=this,n=e.params,r=e.subscriber,i=e.context,o=n.callbackFunc,s=n.args,a=n.scheduler,c=n.subject;if(!c){c=n.subject=new he;try{o.apply(i,s.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.shift();if(r)t.add(a.schedule(Qe,0,{err:r,subject:c}));else{var i=e.length<=1?e[0]:e;t.add(a.schedule(Ve,0,{value:i,subject:c}))}}]))}catch(e){this.add(a.schedule(Qe,0,{err:e,subject:c}))}}this.add(c.subscribe(r))}function Ve(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function Qe(e){var t=e.err;e.subject.error(t)}var je=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(f),Ge=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return n(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(f);var Ke="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",We=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function ze(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var qe=function(e){if(e&&"function"==typeof e[v])return r=e,function(e){var t=r[v]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(We(e))return ee(e);if(ze(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,a),e};if(e&&"function"==typeof e[Ke])return t=e,function(e){for(var n=t[Ke]();;){var r=void 0;try{r=n.next()}catch(t){return e.error(t),e}if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,r,i=l(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+i+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function Ye(e,t,n,r,i){if(void 0===i&&(i=new Ge(e,n,r)),!i.closed)return t instanceof b?t.subscribe(i):qe(t)(i)}var Xe={};var Je=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ze(e,this.resultSelector))},e}(),Ze=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return n(t,e),t.prototype._next=function(e){this.values.push(Xe),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(Ye(this,r,void 0,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n){var r=this.values,i=r[n],o=this.toRespond?i===Xe?--this.toRespond:this.toRespond:0;r[n]=t,0===o&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(je);function $e(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[v]}(e))return function(e,t){return new b((function(n){var r=new h;return r.add(t.schedule((function(){var i=e[v]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if(ze(e))return function(e,t){return new b((function(n){var r=new h;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if(We(e))return te(e,t);if(function(e){return e&&"function"==typeof e[Ke]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new b((function(n){var r,i=new h;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[Ke](),i.add(t.schedule((function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(e){return void n.error(e)}t?n.complete():(n.next(e),this.schedule())}})))}))),i}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}function et(e,t){return t?$e(e,t):e instanceof b?e:new b(qe(e))}var tt=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,n}return n(t,e),t.prototype._next=function(e){this.parent.notifyNext(e)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},t}(f),nt=(function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i}n(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this)},t.prototype._error=function(e){this.parent.notifyError(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}}(f),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.destination.complete()},t}(f));!function(e){function t(){return null!==e&&e.apply(this,arguments)||this}n(t,e),t.prototype.notifyNext=function(e,t,n,r){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()}}(f);function rt(e,t){if(!t.closed)return e instanceof b?e.subscribe(t):qe(e)(t)}function it(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(it((function(n,r){return et(e(n,r)).pipe(Me((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new ot(e,n))})}var ot=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new st(e,this.project,this.concurrent))},e}(),st=function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return n(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.active++,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new tt(this),n=this.destination;n.add(t);var r=rt(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(nt),at=it;function ct(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),it(y,e)}function ut(){return ct(1)}function lt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ut()(re.apply(void 0,e))}function At(e){return new b((function(t){var n;try{n=e()}catch(e){return void t.error(e)}return(n?et(n):J()).subscribe(t)}))}function ht(e,t){return new b((function(n){var r=e.length;if(0!==r)for(var i=new Array(r),o=0,s=0,a=function(a){var c=et(e[a]),u=!1;n.add(c.subscribe({next:function(e){u||(u=!0,s++),i[a]=e},error:function(e){return n.error(e)},complete:function(){++o!==r&&u||(s===r&&n.next(t?t.reduce((function(e,t,n){return e[t]=i[n],e}),{}):i),n.complete())}}))},c=0;c<r;c++)a(c);else n.complete()}))}function dt(e,t,n,r,i){var o;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(e)){var s=e;e.addEventListener(t,n,i),o=function(){return s.removeEventListener(t,n,i)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(e)){var a=e;e.on(t,n),o=function(){return a.off(t,n)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(e)){var c=e;e.addListener(t,n),o=function(){return c.removeListener(t,n)}}else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var u=0,l=e.length;u<l;u++)dt(e[u],t,n,r,i)}r.add(o)}function pt(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(e){return void t.error(e)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(e){return void t.error(e)}if(!r)return void t.complete();if(t.closed)return}var i;try{i=e.resultSelector(e.state)}catch(e){return void t.error(e)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}function ft(e){return!u(e)&&e-parseFloat(e)+1>=0}function gt(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}function mt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,r=null,i=e[e.length-1];return Z(i)?(r=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof i&&(n=e.pop()),null===r&&1===e.length&&e[0]instanceof b?e[0]:ct(n)(ne(e,r))}var vt=new b(Ne);function yt(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription,o=e.obj;if(!r.closed)if(n<t.length){var s=t[n];r.next([s,o[s]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:o}))}else r.complete()}function _t(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}function Et(e,t){return function(n){return n.lift(new bt(e,t))}}var bt=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new wt(e,this.predicate,this.thisArg))},e}(),wt=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return n(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(e){return void this.destination.error(e)}t&&this.destination.next(e)},t}(f);function St(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!u(e[0]))return e[0];e=e[0]}return ne(e,void 0).lift(new Tt)}var Tt=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Ct(e))},e}(),Ct=function(e){function t(t){var n=e.call(this,t)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return n(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=Ye(this,e[n],void 0,n);this.subscriptions&&this.subscriptions.push(r),this.add(r)}this.observables=null}},t.prototype.notifyNext=function(e,t,n){if(!this.hasFirst){this.hasFirst=!0;for(var r=0;r<this.subscriptions.length;r++)if(r!==n){var i=this.subscriptions[r];i.unsubscribe(),this.remove(i)}this.subscriptions=null}this.destination.next(t)},t}(je);function Rt(e){var t=e.start,n=e.index,r=e.count,i=e.subscriber;n>=r?i.complete():(i.next(t),i.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}function It(e,t,n){void 0===e&&(e=0);var r=-1;return ft(t)?r=Number(t)<1?1:Number(t):Z(t)&&(n=t),Z(n)||(n=Se),new b((function(t){var i=ft(e)?e:+e-n.now();return n.schedule(Ot,i,{index:0,period:r,subscriber:t})}))}function Ot(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}function xt(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return"function"==typeof n&&e.pop(),ne(e,void 0).lift(new Nt(n))}var Nt=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Bt(e,this.resultSelector))},e}(),Bt=function(e){function t(t,n,r){void 0===r&&(r=Object.create(null));var i=e.call(this,t)||this;return i.resultSelector=n,i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:void 0,i}return n(t,e),t.prototype._next=function(e){var t=this.iterators;u(e)?t.push(new Dt(e)):"function"==typeof e[Ke]?t.push(new Lt(e[Ke]())):t.push(new Mt(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(this.unsubscribe(),0!==t){this.active=t;for(var n=0;n<t;n++){var r=e[n];if(r.stillUnsubscribed)this.destination.add(r.subscribe());else this.active--}}else this.destination.complete()},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){if("function"==typeof(s=e[r]).hasValue&&!s.hasValue())return}var i=!1,o=[];for(r=0;r<t;r++){var s,a=(s=e[r]).next();if(s.hasCompleted()&&(i=!0),a.done)return void n.complete();o.push(a.value)}this.resultSelector?this._tryresultSelector(o):n.next(o),i&&n.complete()},t.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(f),Lt=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return Boolean(e&&e.done)},e}(),Dt=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[Ke]=function(){return this},e.prototype.next=function(e){var t=this.index++,n=this.array;return t<this.length?{value:n[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Mt=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return n(t,e),t.prototype[Ke]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e){this.buffer.push(e),this.parent.checkIterators()},t.prototype.subscribe=function(){return rt(this.observable,new tt(this))},t}(nt);function Pt(e){return function(t){return t.lift(new kt(e))}}var kt=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ut(e,this.durationSelector))},e}(),Ut=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return n(t,e),t.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=void 0;try{t=(0,this.durationSelector)(e)}catch(e){return this.destination.error(e)}var n=rt(t,new tt(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}},t.prototype.clearThrottle=function(){var e=this,t=e.value,n=e.hasValue,r=e.throttled;r&&(this.remove(r),this.throttled=void 0,r.unsubscribe()),n&&(this.value=void 0,this.hasValue=!1,this.destination.next(t))},t.prototype.notifyNext=function(){this.clearThrottle()},t.prototype.notifyComplete=function(){this.clearThrottle()},t}(nt);var Ft=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Ht(e,this.closingNotifier))},e}(),Ht=function(e){function t(t,n){var r=e.call(this,t)||this;return r.buffer=[],r.add(rt(n,new tt(r))),r}return n(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype.notifyNext=function(){var e=this.buffer;this.buffer=[],this.destination.next(e)},t}(nt);var Vt=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t,this.subscriberClass=t&&e!==t?jt:Qt}return e.prototype.call=function(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))},e}(),Qt=function(e){function t(t,n){var r=e.call(this,t)||this;return r.bufferSize=n,r.buffer=[],r}return n(t,e),t.prototype._next=function(e){var t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])},t.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)},t}(f),jt=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}return n(t,e),t.prototype._next=function(e){var t=this,n=t.bufferSize,r=t.startBufferEvery,i=t.buffers,o=t.count;this.count++,o%r==0&&i.push([]);for(var s=i.length;s--;){var a=i[s];a.push(e),a.length===n&&(i.splice(s,1),this.destination.next(a))}},t.prototype._complete=function(){for(var t=this.buffers,n=this.destination;t.length>0;){var r=t.shift();r.length>0&&n.next(r)}e.prototype._complete.call(this)},t}(f);var Gt=function(){function e(e,t,n,r){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new Wt(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),Kt=function(){this.buffer=[]},Wt=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;s.bufferTimeSpan=n,s.bufferCreationInterval=r,s.maxBufferSize=i,s.scheduler=o,s.contexts=[];var a=s.openContext();if(s.timespanOnly=null==r||r<0,s.timespanOnly){var c={subscriber:s,context:a,bufferTimeSpan:n};s.add(a.closeAction=o.schedule(zt,n,c))}else{var u={subscriber:s,context:a},l={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:s,scheduler:o};s.add(a.closeAction=o.schedule(Yt,n,u)),s.add(o.schedule(qt,r,l))}return s}return n(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],s=o.buffer;s.push(e),s.length==this.maxBufferSize&&(t=o)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,n=this.destination;t.length>0;){var r=t.shift();n.next(r.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:e,bufferTimeSpan:n};this.add(e.closeAction=this.scheduler.schedule(zt,n,r))}},t.prototype.openContext=function(){var e=new Kt;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)},t}(f);function zt(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function qt(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,r=e.subscriber,i=e.scheduler,o=r.openContext();r.closed||(r.add(o.closeAction=i.schedule(Yt,n,{subscriber:r,context:o})),this.schedule(e,t))}function Yt(e){var t=e.subscriber,n=e.context;t.closeContext(n)}var Xt=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Jt(e,this.openings,this.closingSelector))},e}(),Jt=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.closingSelector=r,i.contexts=[],i.add(Ye(i,n)),i}return n(t,e),t.prototype._next=function(e){for(var t=this.contexts,n=t.length,r=0;r<n;r++)t[r].buffer.push(e)},t.prototype._error=function(t){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var n=t.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t){e?this.closeBuffer(e):this.openBuffer(t)},t.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},t.prototype.openBuffer=function(e){try{var t=this.closingSelector.call(this,e);t&&this.trySubscribe(t)}catch(e){this._error(e)}},t.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var n=e.buffer,r=e.subscription;this.destination.next(n),t.splice(t.indexOf(e),1),this.remove(r),r.unsubscribe()}},t.prototype.trySubscribe=function(e){var t=this.contexts,n=new h,r={buffer:[],subscription:n};t.push(r);var i=Ye(this,e,r);!i||i.closed?this.closeBuffer(r):(i.context=r,this.add(i),n.add(i))},t}(je);var Zt=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new $t(e,this.closingSelector))},e}(),$t=function(e){function t(t,n){var r=e.call(this,t)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}return n(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.buffer=void 0,this.subscribing=!1},t.prototype.notifyNext=function(){this.openBuffer()},t.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},t.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t,n=this.buffer;this.buffer&&this.destination.next(n),this.buffer=[];try{t=(0,this.closingSelector)()}catch(e){return this.error(e)}e=new h,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(rt(t,new tt(this))),this.subscribing=!1},t}(nt);var en=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new tn(e,this.selector,this.caught))},e}(),tn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.selector=n,i.caught=r,i}return n(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(t){return void e.prototype.error.call(this,t)}this._unsubscribeAndRecycle();var r=new tt(this);this.add(r);var i=rt(n,r);i!==r&&this.add(i)}},t}(nt);function nn(e,t){return it(e,t,1)}var rn=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new on(e,this.predicate,this.source))},e}(),on=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}return n(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},t}(f);var sn=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new an(e,this.durationSelector))},e}(),an=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return n(t,e),t.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.emitValue(),this.destination.complete()},t.prototype._tryNext=function(e,t){var n=this.durationSubscription;this.value=e,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=rt(t,new tt(this)))&&!n.closed&&this.add(this.durationSubscription=n)},t.prototype.notifyNext=function(){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){if(this.hasValue){var t=this.value,n=this.durationSubscription;n&&(this.durationSubscription=void 0,n.unsubscribe(),this.remove(n)),this.value=void 0,this.hasValue=!1,e.prototype._next.call(this,t)}},t}(nt);var cn=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new un(e,this.dueTime,this.scheduler))},e}(),un=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return n(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(ln,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(f);function ln(e){e.debouncedNext()}function An(e){return void 0===e&&(e=null),function(t){return t.lift(new hn(e))}}var hn=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new dn(e,this.defaultValue))},e}(),dn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.defaultValue=n,r.isEmpty=!0,r}return n(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(f);function pn(e){return e instanceof Date&&!isNaN(+e)}var fn=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new gn(e,this.delay,this.scheduler))},e}(),gn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return n(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(e,o)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.destination.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,n=new mn(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(se.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.scheduleNotification(se.createComplete()),this.unsubscribe()},t}(f),mn=function(e,t){this.time=e,this.notification=t};var vn=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new yn(e,this.delayDurationSelector))},e}(),yn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r.index=0,r}return n(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){var t=this.index++;try{var n=this.delayDurationSelector(e,t);n&&this.tryDelay(n,e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.completed=!0,this.tryComplete(),this.unsubscribe()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);return-1!==t&&this.delayNotifierSubscriptions.splice(t,1),e.outerValue},t.prototype.tryDelay=function(e,t){var n=Ye(this,e,t);n&&!n.closed&&(this.destination.add(n),this.delayNotifierSubscriptions.push(n))},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},t}(je),_n=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subscriptionDelay=n,r}return n(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new En(e,this.source))},t}(b),En=function(e){function t(t,n){var r=e.call(this)||this;return r.parent=t,r.source=n,r.sourceSubscribed=!1,r}return n(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.unsubscribe(),this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},t}(f);var bn=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new wn(e))},e}(),wn=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype._next=function(e){e.observe(this.destination)},t}(f);var Sn=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new Tn(e,this.keySelector,this.flushes))},e}(),Tn=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=n,i.values=new Set,r&&i.add(rt(r,new tt(i))),i}return n(t,e),t.prototype.notifyNext=function(){this.values.clear()},t.prototype.notifyError=function(e){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,n=this.destination;try{t=this.keySelector(e)}catch(e){return void n.error(e)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(nt);function Cn(e,t){return function(n){return n.lift(new Rn(e,t))}}var Rn=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new In(e,this.compare,this.keySelector))},e}(),In=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return n(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t;try{var n=this.keySelector;t=n?n(e):e}catch(e){return this.destination.error(e)}var r=!1;if(this.hasKey)try{r=(0,this.compare)(this.key,t)}catch(e){return this.destination.error(e)}else this.hasKey=!0;r||(this.key=t,this.destination.next(e))},t}(f);function On(e){return void 0===e&&(e=Bn),function(t){return t.lift(new xn(e))}}var xn=function(){function e(e){this.errorFactory=e}return e.prototype.call=function(e,t){return t.subscribe(new Nn(e,this.errorFactory))},e}(),Nn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.errorFactory=n,r.hasValue=!1,r}return n(t,e),t.prototype._next=function(e){this.hasValue=!0,this.destination.next(e)},t.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var e=void 0;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)},t}(f);function Bn(){return new Le}function Ln(e){return function(t){return 0===e?J():t.lift(new Dn(e))}}var Dn=function(){function e(e){if(this.total=e,this.total<0)throw new Be}return e.prototype.call=function(e,t){return t.subscribe(new Mn(e,this.total))},e}(),Mn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return n(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(f);var Pn=function(){function e(e,t,n){this.predicate=e,this.thisArg=t,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new kn(e,this.predicate,this.thisArg,this.source))},e}(),kn=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.predicate=n,o.thisArg=r,o.source=i,o.index=0,o.thisArg=r||o,o}return n(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(e){return void this.destination.error(e)}t||this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(f);var Un=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Fn(e))},e}(),Fn=function(e){function t(t){var n=e.call(this,t)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return n(t,e),t.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add(rt(e,new tt(this))))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(nt);var Hn=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Vn(e,this.project))},e}(),Vn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}return n(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this.hasSubscription=!0,this._innerSub(t)},t.prototype._innerSub=function(e){var t=new tt(this),n=this.destination;n.add(t);var r=rt(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this.destination.next(e)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(nt);var Qn=function(){function e(e,t,n){this.project=e,this.concurrent=t,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new jn(e,this.project,this.concurrent,this.scheduler))},e}(),jn=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.project=n,o.concurrent=r,o.scheduler=i,o.index=0,o.active=0,o.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(o.buffer=[]),o}return n(t,e),t.dispatch=function(e){var t=e.subscriber,n=e.result,r=e.value,i=e.index;t.subscribeToProjection(n,r,i)},t.prototype._next=function(e){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(e);try{var i=(0,this.project)(e,r);if(this.scheduler){var o={subscriber:this,result:i,value:e,index:r};this.destination.add(this.scheduler.schedule(t.dispatch,0,o))}else this.subscribeToProjection(i,e,r)}catch(e){n.error(e)}}else this.buffer.push(e)}},t.prototype.subscribeToProjection=function(e,t,n){this.active++,this.destination.add(rt(e,new tt(this)))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(e){this._next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e&&e.length>0&&this._next(e.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},t}(nt);var Gn=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new Kn(e,this.callback))},e}(),Kn=function(e){function t(t,n){var r=e.call(this,t)||this;return r.add(new h(n)),r}return n(t,e),t}(f);var Wn=function(){function e(e,t,n,r){this.predicate=e,this.source=t,this.yieldIndex=n,this.thisArg=r}return e.prototype.call=function(e,t){return t.subscribe(new zn(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}(),zn=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.predicate=n,s.source=r,s.yieldIndex=i,s.thisArg=o,s.index=0,s}return n(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete(),this.unsubscribe()},t.prototype._next=function(e){var t=this.predicate,n=this.thisArg,r=this.index++;try{t.call(n||this,e,r,this.source)&&this.notifyComplete(this.yieldIndex?r:e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},t}(f);var qn=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Yn(e))},e}(),Yn=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype._next=function(e){},t}(f);var Xn=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new Jn(e))},e}(),Jn=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(f);function Zn(e){return function(t){return 0===e?J():t.lift(new $n(e))}}var $n=function(){function e(e){if(this.total=e,this.total<0)throw new Be}return e.prototype.call=function(e,t){return t.subscribe(new er(e,this.total))},e}(),er=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.ring=new Array,r.count=0,r}return n(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()},t}(f);var tr=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new nr(e,this.value))},e}(),nr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.value=n,r}return n(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(f);var rr=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new ir(e))},e}(),ir=function(e){function t(t){return e.call(this,t)||this}return n(t,e),t.prototype._next=function(e){this.destination.next(se.createNext(e))},t.prototype._error=function(e){var t=this.destination;t.next(se.createError(e)),t.complete()},t.prototype._complete=function(){var e=this.destination;e.next(se.createComplete()),e.complete()},t}(f);function or(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new sr(e,t,n))}}var sr=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new ar(e,this.accumulator,this.seed,this.hasSeed))},e}(),ar=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.accumulator=n,o._seed=r,o.hasSeed=i,o.index=0,o}return n(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(e){this.destination.error(e)}this.seed=t,this.destination.next(t)},t}(f);function cr(e,t){return arguments.length>=2?function(n){return _(or(e,t),Zn(1),An(t))(n)}:function(t){return _(or((function(t,n,r){return e(t,n,r+1)})),Zn(1))(t)}}var ur=function(){function e(e,t,n){this.accumulator=e,this.seed=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new lr(e,this.accumulator,this.seed,this.concurrent))},e}(),lr=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.accumulator=n,o.acc=r,o.concurrent=i,o.hasValue=!1,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return n(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,n=this.destination,r=void 0;try{r=(0,this.accumulator)(this.acc,e,t)}catch(e){return n.error(e)}this.active++,this._innerSub(r)}else this.buffer.push(e)},t.prototype._innerSub=function(e){var t=new tt(this),n=this.destination;n.add(t);var r=rt(e,t);r!==t&&n.add(r)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete()),this.unsubscribe()},t.prototype.notifyNext=function(e){var t=this.destination;this.acc=e,this.hasValue=!0,t.next(e)},t.prototype.notifyComplete=function(){var e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t}(nt);function Ar(e,t){return function(n){var r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new hr(r,t));var i=Object.create(n,D);return i.source=n,i.subjectFactory=r,i}}var hr=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(e);return i.add(t.subscribe(r)),i},e}();var dr=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new pr(e,this.nextSources))},e}(),pr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.nextSources=n,r}return n(t,e),t.prototype.notifyError=function(){this.subscribeToNextSource()},t.prototype.notifyComplete=function(){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource(),this.unsubscribe()},t.prototype._complete=function(){this.subscribeToNextSource(),this.unsubscribe()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();if(e){var t=new tt(this),n=this.destination;n.add(t);var r=rt(e,t);r!==t&&n.add(r)}else this.destination.complete()},t}(nt);var fr=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new gr(e))},e}(),gr=function(e){function t(t){var n=e.call(this,t)||this;return n.hasPrev=!1,n}return n(t,e),t.prototype._next=function(e){var t;this.hasPrev?t=[this.prev,e]:this.hasPrev=!0,this.prev=e,t&&this.destination.next(t)},t}(f);function mr(e,t){return function(n){for(var r=n,i=0;i<t;i++){var o=null!=r?r[e[i]]:void 0;if(void 0===o)return;r=o}return r}}var vr=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new yr(e,this.count,this.source))},e}(),yr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return n(t,e),t.prototype.complete=function(){if(!this.isStopped){var t=this.source,n=this.count;if(0===n)return e.prototype.complete.call(this);n>-1&&(this.count=n-1),t.subscribe(this._unsubscribeAndRecycle())}},t}(f);var _r=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Er(e,this.notifier,t))},e}(),Er=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}return n(t,e),t.prototype.notifyNext=function(){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},t.prototype.notifyComplete=function(){if(!1===this.sourceIsBeingSubscribedTo)return e.prototype.complete.call(this)},t.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return e.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next(void 0)}},t.prototype._unsubscribe=function(){var e=this.notifications,t=this.retriesSubscription;e&&(e.unsubscribe(),this.notifications=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,e.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},t.prototype.subscribeToRetries=function(){var t;this.notifications=new R;try{t=(0,this.notifier)(this.notifications)}catch(t){return e.prototype.complete.call(this)}this.retries=t,this.retriesSubscription=rt(t,new tt(this))},t}(nt);var br=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new wr(e,this.count,this.source))},e}(),wr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return n(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return e.prototype.error.call(this,t);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(f);var Sr=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Tr(e,this.notifier,this.source))},e}(),Tr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i}return n(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,i=this.retriesSubscription;if(r)this.errors=void 0,this.retriesSubscription=void 0;else{n=new R;try{r=(0,this.notifier)(n)}catch(t){return e.prototype.error.call(this,t)}i=rt(r,new tt(this))}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=i,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=void 0),t&&(t.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},t.prototype.notifyNext=function(){var e=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=e,this.source.subscribe(this)},t}(nt);var Cr=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new Rr(e),r=t.subscribe(n);return r.add(rt(this.notifier,new tt(n))),r},e}(),Rr=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasValue=!1,t}return n(t,e),t.prototype._next=function(e){this.value=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},t}(nt);var Ir=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new Or(e,this.period,this.scheduler))},e}(),Or=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(xr,n,{subscriber:i,period:n})),i}return n(t,e),t.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},t}(f);function xr(e){var t=e.subscriber,n=e.period;t.notifyNext(),this.schedule(e,n)}var Nr=function(){function e(e,t){this.compareTo=e,this.comparator=t}return e.prototype.call=function(e,t){return t.subscribe(new Br(e,this.compareTo,this.comparator))},e}(),Br=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.compareTo=n,i.comparator=r,i._a=[],i._b=[],i._oneComplete=!1,i.destination.add(n.subscribe(new Lr(t,i))),i}return n(t,e),t.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},t.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0,this.unsubscribe()},t.prototype.checkValues=function(){for(var e=this,t=e._a,n=e._b,r=e.comparator;t.length>0&&n.length>0;){var i=t.shift(),o=n.shift(),s=!1;try{s=r?r(i,o):i===o}catch(e){this.destination.error(e)}s||this.emit(!1)}},t.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},t.prototype.completeB=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},t}(f),Lr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.parent=n,r}return n(t,e),t.prototype._next=function(e){this.parent.nextB(e)},t.prototype._error=function(e){this.parent.error(e),this.unsubscribe()},t.prototype._complete=function(){this.parent.completeB(),this.unsubscribe()},t}(f);function Dr(){return new R}var Mr=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new Pr(e,this.predicate,this.source))},e}(),Pr=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}return n(t,e),t.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},t.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},t.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(e){this.destination.error(e)}},t.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new Le)},t}(f);var kr=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new Ur(e,this.total))},e}(),Ur=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return n(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(f);var Fr=function(){function e(e){if(this._skipCount=e,this._skipCount<0)throw new Be}return e.prototype.call=function(e,t){return 0===this._skipCount?t.subscribe(new f(e)):t.subscribe(new Hr(e,this._skipCount))},e}(),Hr=function(e){function t(t,n){var r=e.call(this,t)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}return n(t,e),t.prototype._next=function(e){var t=this._skipCount,n=this._count++;if(n<t)this._ring[n]=e;else{var r=n%t,i=this._ring,o=i[r];i[r]=e,this.destination.next(o)}},t}(f);var Vr=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new Qr(e,this.notifier))},e}(),Qr=function(e){function t(t,n){var r=e.call(this,t)||this;r.hasValue=!1;var i=new tt(r);r.add(i),r.innerSubscription=i;var o=rt(n,i);return o!==i&&(r.add(o),r.innerSubscription=o),r}return n(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype.notifyNext=function(){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},t.prototype.notifyComplete=function(){},t}(nt);var jr=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new Gr(e,this.predicate))},e}(),Gr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}return n(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(e){this.destination.error(e)}},t}(f);var Kr=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=be);var i=e.call(this)||this;return i.source=t,i.delayTime=n,i.scheduler=r,(!ft(n)||n<0)&&(i.delayTime=0),r&&"function"==typeof r.schedule||(i.scheduler=be),i}return n(t,e),t.create=function(e,n,r){return void 0===n&&(n=0),void 0===r&&(r=be),new t(e,n,r)},t.dispatch=function(e){var t=e.source,n=e.subscriber;return this.add(t.subscribe(n))},t.prototype._subscribe=function(e){var n=this.delayTime,r=this.source;return this.scheduler.schedule(t.dispatch,n,{source:r,subscriber:e})},t}(b);var Wr=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new Kr(t,this.delay,this.scheduler).subscribe(e)},e}();function zr(e,t){return"function"==typeof t?function(n){return n.pipe(zr((function(n,r){return et(e(n,r)).pipe(Me((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new qr(e))}}var qr=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new Yr(e,this.project))},e}(),Yr=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return n(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(e){return void this.destination.error(e)}this._innerSub(t)},t.prototype._innerSub=function(e){var t=this.innerSubscription;t&&t.unsubscribe();var n=new tt(this),r=this.destination;r.add(n),this.innerSubscription=rt(e,n),this.innerSubscription!==n&&r.add(this.innerSubscription)},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this),this.unsubscribe()},t.prototype._unsubscribe=function(){this.innerSubscription=void 0},t.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e){this.destination.next(e)},t}(nt);var Xr=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new Jr(e),r=rt(this.notifier,new tt(n));return r&&!n.seenValue?(n.add(r),t.subscribe(n)):n},e}(),Jr=function(e){function t(t){var n=e.call(this,t)||this;return n.seenValue=!1,n}return n(t,e),t.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(nt);var Zr=function(){function e(e,t){this.predicate=e,this.inclusive=t}return e.prototype.call=function(e,t){return t.subscribe(new $r(e,this.predicate,this.inclusive))},e}(),$r=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.inclusive=r,i.index=0,i}return n(t,e),t.prototype._next=function(e){var t,n=this.destination;try{t=this.predicate(e,this.index++)}catch(e){return void n.error(e)}this.nextOrComplete(e,t)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;Boolean(t)?n.next(e):(this.inclusive&&n.next(e),n.complete())},t}(f);var ei=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new ti(e,this.nextOrObserver,this.error,this.complete))},e}(),ti=function(e){function t(t,n,r,o){var s=e.call(this,t)||this;return s._tapNext=Ne,s._tapError=Ne,s._tapComplete=Ne,s._tapError=r||Ne,s._tapComplete=o||Ne,i(n)?(s._context=s,s._tapNext=n):n&&(s._context=n,s._tapNext=n.next||Ne,s._tapError=n.error||Ne,s._tapComplete=n.complete||Ne),s}return n(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(f),ni={leading:!0,trailing:!1};var ri=function(){function e(e,t,n){this.durationSelector=e,this.leading=t,this.trailing=n}return e.prototype.call=function(e,t){return t.subscribe(new ii(e,this.durationSelector,this.leading,this.trailing))},e}(),ii=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}return n(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._hasValue,t=this._sendValue;e&&(this.destination.next(t),this.throttle(t)),this._hasValue=!1,this._sendValue=void 0},t.prototype.throttle=function(e){var t=this.tryDurationSelector(e);t&&this.add(this._throttled=rt(t,new tt(this)))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(e){return this.destination.error(e),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=void 0,t&&this.send()},t.prototype.notifyNext=function(){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()},t}(nt);var oi=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new si(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),si=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.duration=n,s.scheduler=r,s.leading=i,s.trailing=o,s._hasTrailingValue=!1,s._trailingValue=null,s}return n(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(ai,this.duration,{subscriber:this})),this.leading?this.destination.next(e):this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0))},t.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(f);function ai(e){e.subscriber.clearThrottle()}var ci=function(e,t){this.value=e,this.interval=t};function ui(e,t,n){return void 0===n&&(n=Se),function(r){var i=pn(e),o=i?+e-n.now():Math.abs(e);return r.lift(new li(o,i,t,n))}}var li=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new Ai(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Ai=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.absoluteTimeout=n,s.waitFor=r,s.withObservable=i,s.scheduler=o,s.scheduleTimeout(),s}return n(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(rt(t,new tt(e)))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=void 0,this.scheduler=null,this.withObservable=null},t}(nt);var hi=function(e,t){this.value=e,this.timestamp=t};function di(e,t,n){return 0===n?[t]:(e.push(t),e)}var pi=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var n=new fi(e),r=t.subscribe(n);return r.closed||n.add(rt(this.windowBoundaries,new tt(n))),r},e}(),fi=function(e){function t(t){var n=e.call(this,t)||this;return n.window=new R,t.next(n.window),n}return n(t,e),t.prototype.notifyNext=function(){this.openWindow()},t.prototype.notifyError=function(e){this._error(e)},t.prototype.notifyComplete=function(){this._complete()},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e)},t.prototype._complete=function(){this.window.complete(),this.destination.complete()},t.prototype._unsubscribe=function(){this.window=null},t.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,n=this.window=new R;t.next(n)},t}(nt);var gi=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new mi(e,this.windowSize,this.startWindowEvery))},e}(),mi=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.destination=t,i.windowSize=n,i.startWindowEvery=r,i.windows=[new R],i.count=0,t.next(i.windows[0]),i}return n(t,e),t.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,o=i.length,s=0;s<o&&!this.closed;s++)i[s].next(e);var a=this.count-r+1;if(a>=0&&a%t==0&&!this.closed&&i.shift().complete(),++this.count%t==0&&!this.closed){var c=new R;i.push(c),n.next(c)}},t.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},t.prototype._unsubscribe=function(){this.count=0,this.windows=null},t}(f);var vi=function(){function e(e,t,n,r){this.windowTimeSpan=e,this.windowCreationInterval=t,this.maxWindowSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new _i(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},e}(),yi=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numberOfNextedValues=0,t}return n(t,e),t.prototype.next=function(t){this._numberOfNextedValues++,e.prototype.next.call(this,t)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),t}(R),_i=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;s.destination=t,s.windowTimeSpan=n,s.windowCreationInterval=r,s.maxWindowSize=i,s.scheduler=o,s.windows=[];var a=s.openWindow();if(null!==r&&r>=0){var c={subscriber:s,window:a,context:null},u={windowTimeSpan:n,windowCreationInterval:r,subscriber:s,scheduler:o};s.add(o.schedule(wi,n,c)),s.add(o.schedule(bi,r,u))}else{var l={subscriber:s,window:a,windowTimeSpan:n};s.add(o.schedule(Ei,n,l))}return s}return n(t,e),t.prototype._next=function(e){for(var t=this.windows,n=t.length,r=0;r<n;r++){var i=t[r];i.closed||(i.next(e),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},t.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new yi;return this.windows.push(e),this.destination.next(e),e},t.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},t}(f);function Ei(e){var t=e.subscriber,n=e.windowTimeSpan,r=e.window;r&&t.closeWindow(r),e.window=t.openWindow(),this.schedule(e,n)}function bi(e){var t=e.windowTimeSpan,n=e.subscriber,r=e.scheduler,i=e.windowCreationInterval,o=n.openWindow(),s=this,a={action:s,subscription:null},c={subscriber:n,window:o,context:a};a.subscription=r.schedule(wi,t,c),s.add(a.subscription),s.schedule(e,i)}function wi(e){var t=e.subscriber,n=e.window,r=e.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),t.closeWindow(n)}var Si=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new Ti(e,this.openings,this.closingSelector))},e}(),Ti=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=Ye(i,n,n)),i}return n(t,e),t.prototype._next=function(e){var t=this.contexts;if(t)for(var n=t.length,r=0;r<n;r++)t[r].window.next(e)},t.prototype._error=function(t){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var o=n[i];o.window.error(t),o.subscription.unsubscribe()}e.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var n=t.length,r=-1;++r<n;){var i=t[r];i.window.complete(),i.subscription.unsubscribe()}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,n=-1;++n<t;){var r=e[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},t.prototype.notifyNext=function(e,t,n,r,i){if(e===this.openings){var o=void 0;try{o=(0,this.closingSelector)(t)}catch(e){return this.error(e)}var s=new R,a=new h,c={window:s,subscription:a};this.contexts.push(c);var u=Ye(this,o,c);u.closed?this.closeWindow(this.contexts.length-1):(u.context=c,a.add(u)),this.destination.next(s)}else this.closeWindow(this.contexts.indexOf(e))},t.prototype.notifyError=function(e){this.error(e)},t.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},t.prototype.closeWindow=function(e){if(-1!==e){var t=this.contexts,n=t[e],r=n.window,i=n.subscription;t.splice(e,1),r.complete(),i.unsubscribe()}},t}(je);var Ci=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new Ri(e,this.closingSelector))},e}(),Ri=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.closingSelector=n,r.openWindow(),r}return n(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow(i)},t.prototype.notifyError=function(e){this._error(e)},t.prototype.notifyComplete=function(e){this.openWindow(e)},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var n,r=this.window=new R;this.destination.next(r);try{n=(0,this.closingSelector)()}catch(e){return this.destination.error(e),void this.window.error(e)}this.add(this.closingNotification=Ye(this,n))},t}(je);var Ii=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new Oi(e,this.observables,this.project))},e}(),Oi=function(e){function t(t,n,r){var i=e.call(this,t)||this;i.observables=n,i.project=r,i.toRespond=[];var o=n.length;i.values=new Array(o);for(var s=0;s<o;s++)i.toRespond.push(s);for(s=0;s<o;s++){var a=n[s];i.add(Ye(i,a,void 0,s))}return i}return n(t,e),t.prototype.notifyNext=function(e,t,n){this.values[n]=t;var r=this.toRespond;if(r.length>0){var i=r.indexOf(n);-1!==i&&r.splice(i,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(e){return void this.destination.error(e)}this.destination.next(t)},t}(je);var xi=Object.freeze({audit:Pt,auditTime:function(e,t){return void 0===t&&(t=Se),Pt((function(){return It(e,t)}))},buffer:function(e){return function(t){return t.lift(new Ft(e))}},bufferCount:function(e,t){return void 0===t&&(t=null),function(n){return n.lift(new Vt(e,t))}},bufferTime:function(e){var t=arguments.length,n=Se;Z(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var r=null;t>=2&&(r=arguments[1]);var i=Number.POSITIVE_INFINITY;return t>=3&&(i=arguments[2]),function(t){return t.lift(new Gt(e,r,i,n))}},bufferToggle:function(e,t){return function(n){return n.lift(new Xt(e,t))}},bufferWhen:function(e){return function(t){return t.lift(new Zt(e))}},catchError:function(e){return function(t){var n=new en(e),r=t.lift(n);return n.caught=r}},combineAll:function(e){return function(t){return t.lift(new Je(e))}},combineLatest:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&u(e[0])&&(e=e[0].slice()),function(t){return t.lift.call(et([t].concat(e)),new Je(n))}},concat:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(lt.apply(void 0,[t].concat(e)))}},concatAll:ut,concatMap:nn,concatMapTo:function(e,t){return nn((function(){return e}),t)},count:function(e){return function(t){return t.lift(new rn(e,t))}},debounce:function(e){return function(t){return t.lift(new sn(e))}},debounceTime:function(e,t){return void 0===t&&(t=Se),function(n){return n.lift(new cn(e,t))}},defaultIfEmpty:An,delay:function(e,t){void 0===t&&(t=Se);var n=pn(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new fn(n,t))}},delayWhen:function(e,t){return t?function(n){return new _n(n,t).lift(new vn(e))}:function(t){return t.lift(new vn(e))}},dematerialize:function(){return function(e){return e.lift(new bn)}},distinct:function(e,t){return function(n){return n.lift(new Sn(e,t))}},distinctUntilChanged:Cn,distinctUntilKeyChanged:function(e,t){return Cn((function(n,r){return t?t(n[e],r[e]):n[e]===r[e]}))},elementAt:function(e,t){if(e<0)throw new Be;var n=arguments.length>=2;return function(r){return r.pipe(Et((function(t,n){return n===e})),Ln(1),n?An(t):On((function(){return new Be})))}},endWith:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return lt(t,re.apply(void 0,e))}},every:function(e,t){return function(n){return n.lift(new Pn(e,t,n))}},exhaust:function(){return function(e){return e.lift(new Un)}},exhaustMap:function e(t,n){return n?function(r){return r.pipe(e((function(e,r){return et(t(e,r)).pipe(Me((function(t,i){return n(e,t,r,i)})))})))}:function(e){return e.lift(new Hn(t))}},expand:function(e,t,n){return void 0===t&&(t=Number.POSITIVE_INFINITY),t=(t||0)<1?Number.POSITIVE_INFINITY:t,function(r){return r.lift(new Qn(e,t,n))}},filter:Et,finalize:function(e){return function(t){return t.lift(new Gn(e))}},find:function(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(n){return n.lift(new Wn(e,n,!1,t))}},findIndex:function(e,t){return function(n){return n.lift(new Wn(e,n,!0,t))}},first:function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Et((function(t,n){return e(t,n,r)})):y,Ln(1),n?An(t):On((function(){return new Le})))}},groupBy:function(e,t,n,r){return function(i){return i.lift(new P(e,t,n,r))}},ignoreElements:function(){return function(e){return e.lift(new qn)}},isEmpty:function(){return function(e){return e.lift(new Xn)}},last:function(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?Et((function(t,n){return e(t,n,r)})):y,Zn(1),n?An(t):On((function(){return new Le})))}},map:Me,mapTo:function(e){return function(t){return t.lift(new tr(e))}},materialize:function(){return function(e){return e.lift(new rr)}},max:function(e){return cr("function"==typeof e?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t})},merge:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(mt.apply(void 0,[t].concat(e)))}},mergeAll:ct,mergeMap:it,flatMap:at,mergeMapTo:function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?it((function(){return e}),t,n):("number"==typeof t&&(n=t),it((function(){return e}),n))},mergeScan:function(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new ur(e,t,n))}},min:function(e){return cr("function"==typeof e?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t})},multicast:Ar,observeOn:function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new ae(e,t))}},onErrorResumeNext:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&u(e[0])&&(e=e[0]),function(t){return t.lift(new dr(e))}},pairwise:function(){return function(e){return e.lift(new fr)}},partition:function(e,t){return function(n){return[Et(e,t)(n),Et(_t(e,t))(n)]}},pluck:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(t){return Me(mr(e,n))(t)}},publish:function(e){return e?Ar((function(){return new R}),e):Ar(new R)},publishBehavior:function(e){return function(t){return Ar(new V(e))(t)}},publishLast:function(){return function(e){return Ar(new he)(e)}},publishReplay:function(e,t,n,r){n&&"function"!=typeof n&&(r=n);var i="function"==typeof n?n:void 0,o=new le(e,t,r);return function(e){return Ar((function(){return o}),i)(e)}},race:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return 1===e.length&&u(e[0])&&(e=e[0]),t.lift.call(St.apply(void 0,[t].concat(e)))}},reduce:cr,repeat:function(e){return void 0===e&&(e=-1),function(t){return 0===e?J():e<0?t.lift(new vr(-1,t)):t.lift(new vr(e-1,t))}},repeatWhen:function(e){return function(t){return t.lift(new _r(e))}},retry:function(e){return void 0===e&&(e=-1),function(t){return t.lift(new br(e,t))}},retryWhen:function(e){return function(t){return t.lift(new Sr(e,t))}},refCount:O,sample:function(e){return function(t){return t.lift(new Cr(e))}},sampleTime:function(e,t){return void 0===t&&(t=Se),function(n){return n.lift(new Ir(e,t))}},scan:or,sequenceEqual:function(e,t){return function(n){return n.lift(new Nr(e,t))}},share:function(){return function(e){return O()(Ar(Dr)(e))}},shareReplay:function(e,t,n){var r;return r=e&&"object"==typeof e?e:{bufferSize:e,windowTime:t,refCount:!1,scheduler:n},function(e){return e.lift(function(e){var t,n,r=e.bufferSize,i=void 0===r?Number.POSITIVE_INFINITY:r,o=e.windowTime,s=void 0===o?Number.POSITIVE_INFINITY:o,a=e.refCount,c=e.scheduler,u=0,l=!1,A=!1;return function(e){var r;u++,!t||l?(l=!1,t=new le(i,s,c),r=t.subscribe(this),n=e.subscribe({next:function(e){t.next(e)},error:function(e){l=!0,t.error(e)},complete:function(){A=!0,n=void 0,t.complete()}})):r=t.subscribe(this),this.add((function(){u--,r.unsubscribe(),n&&!A&&a&&0===u&&(n.unsubscribe(),n=void 0,t=void 0)}))}}(r))}},single:function(e){return function(t){return t.lift(new Mr(e,t))}},skip:function(e){return function(t){return t.lift(new kr(e))}},skipLast:function(e){return function(t){return t.lift(new Fr(e))}},skipUntil:function(e){return function(t){return t.lift(new Vr(e))}},skipWhile:function(e){return function(t){return t.lift(new jr(e))}},startWith:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return Z(n)?(e.pop(),function(t){return lt(e,t,n)}):function(t){return lt(e,t)}},subscribeOn:function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new Wr(e,t))}},switchAll:function(){return zr(y)},switchMap:zr,switchMapTo:function(e,t){return t?zr((function(){return e}),t):zr((function(){return e}))},take:Ln,takeLast:Zn,takeUntil:function(e){return function(t){return t.lift(new Xr(e))}},takeWhile:function(e,t){return void 0===t&&(t=!1),function(n){return n.lift(new Zr(e,t))}},tap:function(e,t,n){return function(r){return r.lift(new ei(e,t,n))}},throttle:function(e,t){return void 0===t&&(t=ni),function(n){return n.lift(new ri(e,!!t.leading,!!t.trailing))}},throttleTime:function(e,t,n){return void 0===t&&(t=Se),void 0===n&&(n=ni),function(r){return r.lift(new oi(e,t,n.leading,n.trailing))}},throwIfEmpty:On,timeInterval:function(e){return void 0===e&&(e=Se),function(t){return At((function(){return t.pipe(or((function(t,n){var r=t.current;return{value:n,current:e.now(),last:r}}),{current:e.now(),value:void 0,last:void 0}),Me((function(e){var t=e.current,n=e.last,r=e.value;return new ci(r,t-n)})))}))}},timeout:function(e,t){return void 0===t&&(t=Se),ui(e,ie(new De),t)},timeoutWith:ui,timestamp:function(e){return void 0===e&&(e=Se),Me((function(t){return new hi(t,e.now())}))},toArray:function(){return cr(di,[])},window:function(e){return function(t){return t.lift(new pi(e))}},windowCount:function(e,t){return void 0===t&&(t=0),function(n){return n.lift(new gi(e,t))}},windowTime:function(e){var t=Se,n=null,r=Number.POSITIVE_INFINITY;return Z(arguments[3])&&(t=arguments[3]),Z(arguments[2])?t=arguments[2]:ft(arguments[2])&&(r=Number(arguments[2])),Z(arguments[1])?t=arguments[1]:ft(arguments[1])&&(n=Number(arguments[1])),function(i){return i.lift(new vi(e,n,r,t))}},windowToggle:function(e,t){return function(n){return n.lift(new Si(e,t))}},windowWhen:function(e){return function(t){return t.lift(new Ci(e))}},withLatestFrom:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;"function"==typeof e[e.length-1]&&(n=e.pop());var r=e;return t.lift(new Ii(r,n))}},zip:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(xt.apply(void 0,[t].concat(e)))}},zipAll:function(e){return function(t){return t.lift(new Nt(e))}}}),Ni=function(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.subscribedFrame=e,this.unsubscribedFrame=t},Bi=function(){function e(){this.subscriptions=[]}return e.prototype.logSubscribedFrame=function(){return this.subscriptions.push(new Ni(this.scheduler.now())),this.subscriptions.length-1},e.prototype.logUnsubscribedFrame=function(e){var t=this.subscriptions,n=t[e];t[e]=new Ni(n.subscribedFrame,this.scheduler.now())},e}();function Li(e,t){for(var n=0,r=t.length;n<r;n++)for(var i=t[n],o=Object.getOwnPropertyNames(i.prototype),s=0,a=o.length;s<a;s++){var c=o[s];e.prototype[c]=i.prototype[c]}}var Di=function(e){function t(t,n){var r=e.call(this,(function(e){var t=this,n=t.logSubscribedFrame(),r=new h;return r.add(new h((function(){t.logUnsubscribedFrame(n)}))),t.scheduleMessages(e),r}))||this;return r.messages=t,r.subscriptions=[],r.scheduler=n,r}return n(t,e),t.prototype.scheduleMessages=function(e){for(var t=this.messages.length,n=0;n<t;n++){var r=this.messages[n];e.add(this.scheduler.schedule((function(e){var t=e.message,n=e.subscriber;t.notification.observe(n)}),r.frame,{message:r,subscriber:e}))}},t}(b);Li(Di,[Bi]);var Mi=function(e){function t(t,n){var r=e.call(this)||this;return r.messages=t,r.subscriptions=[],r.scheduler=n,r}return n(t,e),t.prototype._subscribe=function(t){var n=this,r=n.logSubscribedFrame(),i=new h;return i.add(new h((function(){n.logUnsubscribedFrame(r)}))),i.add(e.prototype._subscribe.call(this,t)),i},t.prototype.setup=function(){for(var e=this,t=e.messages.length,n=0;n<t;n++)!function(){var t=e.messages[n];e.scheduler.schedule((function(){t.notification.observe(e)}),t.frame)}()},t}(R);Li(Mi,[Bi]);var Pi=function(e){function t(t){var n=e.call(this,xe,750)||this;return n.assertDeepEqual=t,n.hotObservables=[],n.coldObservables=[],n.flushTests=[],n.runMode=!1,n}return n(t,e),t.prototype.createTime=function(e){var n=e.indexOf("|");if(-1===n)throw new Error('marble diagram for time should have a completion marker "|"');return n*t.frameTimeFactor},t.prototype.createColdObservable=function(e,n,r){if(-1!==e.indexOf("^"))throw new Error('cold observable cannot have subscription offset "^"');if(-1!==e.indexOf("!"))throw new Error('cold observable cannot have unsubscription marker "!"');var i=t.parseMarbles(e,n,r,void 0,this.runMode),o=new Di(i,this);return this.coldObservables.push(o),o},t.prototype.createHotObservable=function(e,n,r){if(-1!==e.indexOf("!"))throw new Error('hot observable cannot have unsubscription marker "!"');var i=t.parseMarbles(e,n,r,void 0,this.runMode),o=new Mi(i,this);return this.hotObservables.push(o),o},t.prototype.materializeInnerObservable=function(e,t){var n=this,r=[];return e.subscribe((function(e){r.push({frame:n.frame-t,notification:se.createNext(e)})}),(function(e){r.push({frame:n.frame-t,notification:se.createError(e)})}),(function(){r.push({frame:n.frame-t,notification:se.createComplete()})})),r},t.prototype.expectObservable=function(e,n){var r=this;void 0===n&&(n=null);var i,o=[],s={actual:o,ready:!1},a=t.parseMarblesAsSubscriptions(n,this.runMode),c=a.subscribedFrame===Number.POSITIVE_INFINITY?0:a.subscribedFrame,u=a.unsubscribedFrame;this.schedule((function(){i=e.subscribe((function(e){var t=e;e instanceof b&&(t=r.materializeInnerObservable(t,r.frame)),o.push({frame:r.frame,notification:se.createNext(t)})}),(function(e){o.push({frame:r.frame,notification:se.createError(e)})}),(function(){o.push({frame:r.frame,notification:se.createComplete()})}))}),c),u!==Number.POSITIVE_INFINITY&&this.schedule((function(){return i.unsubscribe()}),u),this.flushTests.push(s);var l=this.runMode;return{toBe:function(e,n,r){s.ready=!0,s.expected=t.parseMarbles(e,n,r,!0,l)}}},t.prototype.expectSubscriptions=function(e){var n={actual:e,ready:!1};this.flushTests.push(n);var r=this.runMode;return{toBe:function(e){var i="string"==typeof e?[e]:e;n.ready=!0,n.expected=i.map((function(e){return t.parseMarblesAsSubscriptions(e,r)}))}}},t.prototype.flush=function(){for(var t=this,n=this.hotObservables;n.length>0;)n.shift().setup();e.prototype.flush.call(this),this.flushTests=this.flushTests.filter((function(e){return!e.ready||(t.assertDeepEqual(e.actual,e.expected),!1)}))},t.parseMarblesAsSubscriptions=function(e,t){var n=this;if(void 0===t&&(t=!1),"string"!=typeof e)return new Ni(Number.POSITIVE_INFINITY);for(var r,i=e.length,o=-1,s=Number.POSITIVE_INFINITY,a=Number.POSITIVE_INFINITY,c=0,u=function(i){var u=c,A=function(e){u+=e*n.frameTimeFactor},h=e[i];switch(h){case" ":t||A(1);break;case"-":A(1);break;case"(":o=c,A(1);break;case")":o=-1,A(1);break;case"^":if(s!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");s=o>-1?o:c,A(1);break;case"!":if(a!==Number.POSITIVE_INFINITY)throw new Error("found a second subscription point '^' in a subscription marble diagram. There can only be one.");a=o>-1?o:c;break;default:if(t&&h.match(/^[0-9]$/)&&(0===i||" "===e[i-1])){var d=e.slice(i).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(d){i+=d[0].length-1;var p=parseFloat(d[1]),f=void 0;switch(d[2]){case"ms":f=p;break;case"s":f=1e3*p;break;case"m":f=1e3*p*60}A(f/l.frameTimeFactor);break}}throw new Error("there can only be '^' and '!' markers in a subscription marble diagram. Found instead '"+h+"'.")}c=u,r=i},l=this,A=0;A<i;A++)u(A),A=r;return a<0?new Ni(s):new Ni(s,a)},t.parseMarbles=function(e,t,n,r,i){var o=this;if(void 0===r&&(r=!1),void 0===i&&(i=!1),-1!==e.indexOf("!"))throw new Error('conventional marble diagrams cannot have the unsubscription marker "!"');for(var s,a=e.length,c=[],u=i?e.replace(/^[ ]+/,"").indexOf("^"):e.indexOf("^"),l=-1===u?0:u*-this.frameTimeFactor,A="object"!=typeof t?function(e){return e}:function(e){return r&&t[e]instanceof Di?t[e].messages:t[e]},h=-1,d=function(t){var r=l,a=function(e){r+=e*o.frameTimeFactor},u=void 0,d=e[t];switch(d){case" ":i||a(1);break;case"-":case"^":a(1);break;case"(":h=l,a(1);break;case")":h=-1,a(1);break;case"|":u=se.createComplete(),a(1);break;case"#":u=se.createError(n||"error"),a(1);break;default:if(i&&d.match(/^[0-9]$/)&&(0===t||" "===e[t-1])){var f=e.slice(t).match(/^([0-9]+(?:\.[0-9]+)?)(ms|s|m) /);if(f){t+=f[0].length-1;var g=parseFloat(f[1]),m=void 0;switch(f[2]){case"ms":m=g;break;case"s":m=1e3*g;break;case"m":m=1e3*g*60}a(m/p.frameTimeFactor);break}}u=se.createNext(A(d)),a(1)}u&&c.push({frame:h>-1?h:l,notification:u}),l=r,s=t},p=this,f=0;f<a;f++)d(f),f=s;return c},t.prototype.run=function(e){var n=t.frameTimeFactor,r=this.maxFrames;t.frameTimeFactor=1,this.maxFrames=Number.POSITIVE_INFINITY,this.runMode=!0,W.delegate=this;var i={cold:this.createColdObservable.bind(this),hot:this.createHotObservable.bind(this),flush:this.flush.bind(this),expectObservable:this.expectObservable.bind(this),expectSubscriptions:this.expectSubscriptions.bind(this)};try{var o=e(i);return this.flush(),o}finally{t.frameTimeFactor=n,this.maxFrames=r,this.runMode=!1,W.delegate=void 0}},t}(Oe),ki=Object.freeze({TestScheduler:Pi}),Ui="undefined"!=typeof window&&window,Fi="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Hi="undefined"!=typeof global&&global,Vi=Ui||Hi||Fi;function Qi(e,t){return void 0===t&&(t=null),new Yi({method:"GET",url:e,headers:t})}function ji(e,t,n){return new Yi({method:"POST",url:e,body:t,headers:n})}function Gi(e,t){return new Yi({method:"DELETE",url:e,headers:t})}function Ki(e,t,n){return new Yi({method:"PUT",url:e,body:t,headers:n})}function Wi(e,t,n){return new Yi({method:"PATCH",url:e,body:t,headers:n})}!function(){if(!Vi)throw new Error("RxJS could not find any global context (window, self, global)")}();var zi=Me((function(e,t){return e.response}));function qi(e,t){return zi(new Yi({method:"GET",url:e,responseType:"json",headers:t}))}var Yi=function(e){function t(t){var n=e.call(this)||this,r={async:!0,createXHR:function(){return this.crossDomain?function(){if(Vi.XMLHttpRequest)return new Vi.XMLHttpRequest;if(Vi.XDomainRequest)return new Vi.XDomainRequest;throw new Error("CORS is not supported by your browser")}():function(){if(Vi.XMLHttpRequest)return new Vi.XMLHttpRequest;var e=void 0;try{for(var t=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],n=0;n<3;n++)try{if(e=t[n],new Vi.ActiveXObject(e))break}catch(e){}return new Vi.ActiveXObject(e)}catch(e){throw new Error("XMLHttpRequest is not supported by your browser")}}()},crossDomain:!0,withCredentials:!1,headers:{},method:"GET",responseType:"json",timeout:0};if("string"==typeof t)r.url=t;else for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return n.request=r,n}var r;return n(t,e),t.prototype._subscribe=function(e){return new Xi(e,this.request)},t.create=((r=function(e){return new t(e)}).get=Qi,r.post=ji,r.delete=Gi,r.put=Ki,r.patch=Wi,r.getJSON=qi,r),t}(b),Xi=function(e){function t(t,n){var r=e.call(this,t)||this;r.request=n,r.done=!1;var i=n.headers=n.headers||{};return n.crossDomain||r.getHeader(i,"X-Requested-With")||(i["X-Requested-With"]="XMLHttpRequest"),r.getHeader(i,"Content-Type")||Vi.FormData&&n.body instanceof Vi.FormData||void 0===n.body||(i["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8"),n.body=r.serializeBody(n.body,r.getHeader(n.headers,"Content-Type")),r.send(),r}return n(t,e),t.prototype.next=function(e){this.done=!0;var t,n=this,r=n.xhr,i=n.request,o=n.destination;try{t=new Ji(e,r,i)}catch(e){return o.error(e)}o.next(t)},t.prototype.send=function(){var e=this.request,t=this.request,n=t.user,r=t.method,i=t.url,o=t.async,s=t.password,a=t.headers,c=t.body;try{var u=this.xhr=e.createXHR();this.setupEvents(u,e),n?u.open(r,i,o,n,s):u.open(r,i,o),o&&(u.timeout=e.timeout,u.responseType=e.responseType),"withCredentials"in u&&(u.withCredentials=!!e.withCredentials),this.setHeaders(u,a),c?u.send(c):u.send()}catch(e){this.error(e)}},t.prototype.serializeBody=function(e,t){if(!e||"string"==typeof e)return e;if(Vi.FormData&&e instanceof Vi.FormData)return e;if(t){var n=t.indexOf(";");-1!==n&&(t=t.substring(0,n))}switch(t){case"application/x-www-form-urlencoded":return Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&");case"application/json":return JSON.stringify(e);default:return e}},t.prototype.setHeaders=function(e,t){for(var n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n])},t.prototype.getHeader=function(e,t){for(var n in e)if(n.toLowerCase()===t.toLowerCase())return e[n]},t.prototype.setupEvents=function(e,t){var n=t.progressSubscriber;function r(e){var t,n=r,i=n.subscriber,o=n.progressSubscriber,s=n.request;o&&o.error(e);try{t=new eo(this,s)}catch(e){t=e}i.error(t)}if(e.ontimeout=r,r.request=t,r.subscriber=this,r.progressSubscriber=n,e.upload&&"withCredentials"in e){var i,o;if(n)i=function(e){i.progressSubscriber.next(e)},Vi.XDomainRequest?e.onprogress=i:e.upload.onprogress=i,i.progressSubscriber=n;o=function(e){var t,n=o,r=n.progressSubscriber,i=n.subscriber,s=n.request;r&&r.error(e);try{t=new Zi("ajax error",this,s)}catch(e){t=e}i.error(t)},e.onerror=o,o.request=t,o.subscriber=this,o.progressSubscriber=n}function s(e){}function a(e){var t=a,n=t.subscriber,r=t.progressSubscriber,i=t.request;if(4===this.readyState){var o=1223===this.status?204:this.status,s="text"===this.responseType?this.response||this.responseText:this.response;if(0===o&&(o=s?200:0),o<400)r&&r.complete(),n.next(e),n.complete();else{r&&r.error(e);var c=void 0;try{c=new Zi("ajax error "+o,this,i)}catch(e){c=e}n.error(c)}}}e.onreadystatechange=s,s.subscriber=this,s.progressSubscriber=n,s.request=t,e.onload=a,a.subscriber=this,a.progressSubscriber=n,a.request=t},t.prototype.unsubscribe=function(){var t=this.done,n=this.xhr;!t&&n&&4!==n.readyState&&"function"==typeof n.abort&&n.abort(),e.prototype.unsubscribe.call(this)},t}(f),Ji=function(e,t,n){this.originalEvent=e,this.xhr=t,this.request=n,this.status=t.status,this.responseType=t.responseType||n.responseType,this.response=$i(this.responseType,t)},Zi=function(){function e(e,t,n){return Error.call(this),this.message=e,this.name="AjaxError",this.xhr=t,this.request=n,this.status=t.status,this.responseType=t.responseType||n.responseType,this.response=$i(this.responseType,t),this}return e.prototype=Object.create(Error.prototype),e}();function $i(e,t){switch(e){case"json":return function(e){return"response"in e?e.responseType?e.response:JSON.parse(e.response||e.responseText||"null"):JSON.parse(e.responseText||"null")}(t);case"xml":return t.responseXML;default:return"response"in t?t.response:t.responseText}}var eo=function(e,t){return Zi.call(this,"ajax timeout",e,t),this.name="AjaxTimeoutError",this},to=Yi.create,no=Object.freeze({ajax:to,AjaxResponse:Ji,AjaxError:Zi,AjaxTimeoutError:eo}),ro={url:"",deserializer:function(e){return JSON.parse(e.data)},serializer:function(e){return JSON.stringify(e)}},io=function(e){function t(t,n){var i=e.call(this)||this;if(t instanceof b)i.destination=n,i.source=t;else{var o=i._config=r({},ro);if(i._output=new R,"string"==typeof t)o.url=t;else for(var s in t)t.hasOwnProperty(s)&&(o[s]=t[s]);if(!o.WebSocketCtor&&WebSocket)o.WebSocketCtor=WebSocket;else if(!o.WebSocketCtor)throw new Error("no WebSocket constructor can be found");i.destination=new le}return i}return n(t,e),t.prototype.lift=function(e){var n=new t(this._config,this.destination);return n.operator=e,n.source=this,n},t.prototype._resetState=function(){this._socket=null,this.source||(this.destination=new le),this._output=new R},t.prototype.multiplex=function(e,t,n){var r=this;return new b((function(i){try{r.next(e())}catch(e){i.error(e)}var o=r.subscribe((function(e){try{n(e)&&i.next(e)}catch(e){i.error(e)}}),(function(e){return i.error(e)}),(function(){return i.complete()}));return function(){try{r.next(t())}catch(e){i.error(e)}o.unsubscribe()}}))},t.prototype._connectSocket=function(){var e=this,t=this._config,n=t.WebSocketCtor,r=t.protocol,i=t.url,o=t.binaryType,s=this._output,a=null;try{a=r?new n(i,r):new n(i),this._socket=a,o&&(this._socket.binaryType=o)}catch(e){return void s.error(e)}var c=new h((function(){e._socket=null,a&&1===a.readyState&&a.close()}));a.onopen=function(t){if(!e._socket)return a.close(),void e._resetState();var n=e._config.openObserver;n&&n.next(t);var r=e.destination;e.destination=f.create((function(t){if(1===a.readyState)try{var n=e._config.serializer;a.send(n(t))}catch(t){e.destination.error(t)}}),(function(t){var n=e._config.closingObserver;n&&n.next(void 0),t&&t.code?a.close(t.code,t.reason):s.error(new TypeError("WebSocketSubject.error must be called with an object with an error code, and an optional reason: { code: number, reason: string }")),e._resetState()}),(function(){var t=e._config.closingObserver;t&&t.next(void 0),a.close(),e._resetState()})),r&&r instanceof le&&c.add(r.subscribe(e.destination))},a.onerror=function(t){e._resetState(),s.error(t)},a.onclose=function(t){e._resetState();var n=e._config.closeObserver;n&&n.next(t),t.wasClean?s.complete():s.error(t)},a.onmessage=function(t){try{var n=e._config.deserializer;s.next(n(t))}catch(e){s.error(e)}}},t.prototype._subscribe=function(e){var t=this,n=this.source;return n?n.subscribe(e):(this._socket||this._connectSocket(),this._output.subscribe(e),e.add((function(){var e=t._socket;0===t._output.observers.length&&(e&&1===e.readyState&&e.close(),t._resetState())})),e)},t.prototype.unsubscribe=function(){var t=this._socket;t&&1===t.readyState&&t.close(),this._resetState(),e.prototype.unsubscribe.call(this)},t}(I);var oo=xi,so=ki,ao=no,co=Object.freeze({webSocket:function(e){return new io(e)},WebSocketSubject:io}),uo=Object.freeze({fromFetch:function(e,t){void 0===t&&(t={});var n=t.selector,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n}(t,["selector"]);return new b((function(t){var o,s=new AbortController,a=s.signal,c=!0,u=!1,l=new h;if(l.add((function(){u=!0,c&&s.abort()})),i){if(i.signal)if(i.signal.aborted)s.abort();else{var A=i.signal,d=function(){a.aborted||s.abort()};A.addEventListener("abort",d),l.add((function(){return A.removeEventListener("abort",d)}))}o=r({},i,{signal:a})}else o={signal:a};return fetch(e,o).then((function(e){n?l.add(et(n(e)).subscribe((function(e){return t.next(e)}),(function(e){c=!1,u||t.error(e)}),(function(){c=!1,t.complete()}))):(c=!1,t.next(e),t.complete())})).catch((function(e){c=!1,u||t.error(e)})),l}))}});e.operators=oo,e.testing=so,e.ajax=ao,e.webSocket=co,e.fetch=uo,e.Observable=b,e.ConnectableObservable=L,e.GroupedObservable=F,e.observable=v,e.Subject=R,e.BehaviorSubject=V,e.ReplaySubject=le,e.AsyncSubject=he,e.asap=be,e.asapScheduler=Ee,e.async=Se,e.asyncScheduler=we,e.queue=Y,e.queueScheduler=q,e.animationFrame=Ie,e.animationFrameScheduler=Re,e.VirtualTimeScheduler=Oe,e.VirtualAction=xe,e.Scheduler=K,e.Subscription=h,e.Subscriber=f,e.Notification=se,e.pipe=_,e.noop=Ne,e.identity=y,e.isObservable=function(e){return!!e&&(e instanceof b||"function"==typeof e.lift&&"function"==typeof e.subscribe)},e.ArgumentOutOfRangeError=Be,e.EmptyError=Le,e.ObjectUnsubscribedError=S,e.UnsubscriptionError=A,e.TimeoutError=De,e.bindCallback=function e(t,n,r){if(n){if(!Z(n))return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return e(t,r).apply(void 0,i).pipe(Me((function(e){return u(e)?n.apply(void 0,e):n(e)})))};r=n}return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i,o=this,s={context:o,subject:i,callbackFunc:t,scheduler:r};return new b((function(n){if(r){var a={args:e,subscriber:n,params:s};return r.schedule(Ue,0,a)}if(!i){i=new he;try{t.apply(o,e.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.next(e.length<=1?e[0]:e),i.complete()}]))}catch(e){m(i)?i.error(e):console.warn(e)}}return i.subscribe(n)}))}},e.bindNodeCallback=function e(t,n,r){if(n){if(!Z(n))return function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return e(t,r).apply(void 0,i).pipe(Me((function(e){return u(e)?n.apply(void 0,e):n(e)})))};r=n}return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i={subject:void 0,args:e,callbackFunc:t,scheduler:r,context:this};return new b((function(n){var o=i.context,s=i.subject;if(r)return r.schedule(He,0,{params:i,subscriber:n,context:o});if(!s){s=i.subject=new he;try{t.apply(o,e.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.shift();n?s.error(n):(s.next(e.length<=1?e[0]:e),s.complete())}]))}catch(e){m(s)?s.error(e):console.warn(e)}}return s.subscribe(n)}))}},e.combineLatest=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=void 0,r=void 0;return Z(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&u(e[0])&&(e=e[0]),ne(e,r).lift(new Je(n))},e.concat=lt,e.defer=At,e.empty=J,e.forkJoin=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){var n=e[0];if(u(n))return ht(n,null);if(l(n)&&Object.getPrototypeOf(n)===Object.prototype){var r=Object.keys(n);return ht(r.map((function(e){return n[e]})),r)}}if("function"==typeof e[e.length-1]){var i=e.pop();return ht(e=1===e.length&&u(e[0])?e[0]:e,null).pipe(Me((function(e){return i.apply(void 0,e)})))}return ht(e,null)},e.from=et,e.fromEvent=function e(t,n,r,o){return i(r)&&(o=r,r=void 0),o?e(t,n,r).pipe(Me((function(e){return u(e)?o.apply(void 0,e):o(e)}))):new b((function(e){dt(t,n,(function(t){arguments.length>1?e.next(Array.prototype.slice.call(arguments)):e.next(t)}),e,r)}))},e.fromEventPattern=function e(t,n,r){return r?e(t,n).pipe(Me((function(e){return u(e)?r.apply(void 0,e):r(e)}))):new b((function(e){var r,o=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1===t.length?t[0]:t)};try{r=t(o)}catch(t){return void e.error(t)}if(i(n))return function(){return n(o,r)}}))},e.generate=function(e,t,n,r,i){var o,s;if(1==arguments.length){var a=e;s=a.initialState,t=a.condition,n=a.iterate,o=a.resultSelector||y,i=a.scheduler}else void 0===r||Z(r)?(s=e,o=y,i=r):(s=e,o=r);return new b((function(e){var r=s;if(i)return i.schedule(pt,0,{subscriber:e,iterate:n,condition:t,resultSelector:o,state:r});for(;;){if(t){var a=void 0;try{a=t(r)}catch(t){return void e.error(t)}if(!a){e.complete();break}}var c=void 0;try{c=o(r)}catch(t){return void e.error(t)}if(e.next(c),e.closed)break;try{r=n(r)}catch(t){return void e.error(t)}}}))},e.iif=function(e,t,n){return void 0===t&&(t=X),void 0===n&&(n=X),At((function(){return e()?t:n}))},e.interval=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=Se),(!ft(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=Se),new b((function(n){return n.add(t.schedule(gt,e,{subscriber:n,counter:0,period:e})),n}))},e.merge=mt,e.never=function(){return vt},e.of=re,e.onErrorResumeNext=function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(0===t.length)return X;var r=t[0],i=t.slice(1);return 1===t.length&&u(r)?e.apply(void 0,r):new b((function(t){var n=function(){return t.add(e.apply(void 0,i).subscribe(t))};return et(r).subscribe({next:function(e){t.next(e)},error:n,complete:n})}))},e.pairs=function(e,t){return new b(t?function(n){var r=Object.keys(e),i=new h;return i.add(t.schedule(yt,0,{keys:r,index:0,subscriber:n,subscription:i,obj:e})),i}:function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})},e.partition=function(e,t,n){return[Et(t,n)(new b(qe(e))),Et(_t(t,n))(new b(qe(e)))]},e.race=St,e.range=function(e,t,n){return void 0===e&&(e=0),new b((function(r){void 0===t&&(t=e,e=0);var i=0,o=e;if(n)return n.schedule(Rt,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(o++),r.closed)break}}))},e.throwError=ie,e.timer=It,e.using=function(e,t){return new b((function(n){var r,i;try{r=e()}catch(e){return void n.error(e)}try{i=t(r)}catch(e){return void n.error(e)}var o=(i?et(i):X).subscribe(n);return function(){o.unsubscribe(),r&&r.unsubscribe()}}))},e.zip=xt,e.scheduled=$e,e.EMPTY=X,e.NEVER=vt,e.config=s,Object.defineProperty(e,"__esModule",{value:!0})})),
/**
 * @license rxcomp v1.0.0-beta.21
 * (c) 2022 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["exports","rxjs","rxjs/operators"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).rxcomp={},e.rxjs,e.rxjs.operators)}(this,(function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,a(e,t)}function s(e){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},s(e)}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,n){return u=c()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&a(i,n.prototype),i},u.apply(null,arguments)}function l(e){var t="function"==typeof Map?new Map:void 0;return l=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return u(e,arguments,s(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,e)},l(e)}var A={},h={},d=function(){var e=n.prototype;function n(){this.rxcompId=-1,this.unsubscribe$=new t.Subject,this.changes$=new t.ReplaySubject(1)}return e.onInit=function(){},e.onChanges=function(e){},e.onView=function(){},e.onDestroy=function(){},e.pushChanges=function(){p(this).module.instances&&(this.changes$.next(this),this.onView())},e.onParentDidChange=function(e){p(this).module.resolveInputsOutputs(this,e),this.onChanges(e),this.pushChanges()},n.getInputsTokens=function(e,t,n){var r,i={};return null==(r=this.meta.inputs)||r.forEach((function(e){var r=n.resolveAttribute(e,t);r&&(i[e]=r)})),i},n}();function p(e){return A[e.rxcompId]}d.meta=void 0;var f=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t}(d),g=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).class="",t.keys=[],t}o(t,e);var n=t.prototype;return n.onInit=function(){var e=this,t=p(this).node;Array.prototype.slice.call(t.classList).forEach((function(t){e.keys.push(t)}))},n.onChanges=function(){var e=p(this).node,t=[],n=this.class;if("object"==typeof n)for(var r in n)n[r]&&t.push(r);else"string"==typeof n&&(t=n.split(/\s+/));t=t.concat(this.keys),e.setAttribute("class",t.join(" "))},t}(f);g.meta={selector:"[[class]]",inputs:["class"]};var m=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t}(l(Error)),v=function(e){function t(t,n,r,i,o){var s,a="ExpressionError in "+r.constructor.name+' "'+i+'"\n\t\t'+t.message;(s=e.call(this,a)||this).module=void 0,s.instance=void 0,s.expression=void 0,s.params=void 0,s.template=void 0,s.name=t.name,s.module=n,s.instance=r,s.expression=i,s.params=o;var c=p(r).node;return s.template=c.outerHTML,s}return o(t,e),t}(l(Error)),y=function(){function e(e,t){this.next=void 0,this.interceptor=void 0,this.next=e,this.interceptor=t}return e.prototype.handle=function(e){return this.interceptor.intercept(e,this.next)},e}(),_=function(){function e(){}return e.prototype.handle=function(e){return t.of(e)},e}(),E=[],b=new t.ReplaySubject(1),w=b.pipe(n.switchMap((function(e){return E.reduceRight((function(e,t){return new y(e,t)}),new _).handle(e)})),n.tap((function(e){e&&console.error(e)}))),S=function(e){function r(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).event="",t}return o(r,e),r.prototype.onInit=function(){var e=p(this),r=e.module,i=e.node,o=e.parentInstance,s=e.selector,a=this.event=s.replace(/\[|\]|\(|\)/g,""),c=t.fromEvent(i,a).pipe(n.shareReplay(1)),u=i.getAttribute("("+a+")");if(u){var l=r.makeFunction(u,["$event"]);c.pipe(n.takeUntil(this.unsubscribe$)).subscribe((function(e){r.resolve(l,o,e)}))}else o[a+"$"]=c},r}(f);S.meta={selector:"[("+["mousedown","mouseup","mousemove","click","dblclick","mouseover","mouseout","mouseenter","mouseleave","contextmenu","touchstart","touchmove","touchend","keydown","keyup","input","change","loaded"].join(")],[(")+")]"};var T=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t}(d),C=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.prototype.pushChanges=function(){var e=p(this),t=e.module,n=e.node;t.instances&&(this.changes$.next(this),t.parse(n,this),this.onView())},t}(d),R=["constructor","rxcompId","onInit","onChanges","onDestroy","pushChanges","changes$","unsubscribe$"],I=function(e){function t(n,r){var i;return void 0===r&&(r={}),i=e.call(this)||this,r=t.mergeDescriptors(n,n,r),r=t.mergeDescriptors(Object.getPrototypeOf(n),n,r),Object.defineProperties(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i),r),i}o(t,e);var n=t.prototype;return n.pushChanges=function(){var t=this,n=p(this);n.keys||(n.keys=Object.keys(n.parentInstance).filter((function(e){return-1===R.indexOf(e)}))),n.module.instances&&n.keys.forEach((function(e){t[e]=n.parentInstance[e]})),e.prototype.pushChanges.call(this)},n.onParentDidChange=function(e){this.onChanges(e),this.pushChanges()},t.mergeDescriptors=function(e,t,n){void 0===n&&(n={});for(var r=Object.getOwnPropertyNames(e),i=function(){var i=r.shift();if(-1===R.indexOf(i)&&!n.hasOwnProperty(i)){var o=Object.getOwnPropertyDescriptor(e,i);"function"==typeof o.value&&(o.value=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t[i].apply(t,n)}),n[i]=o}};r.length;)i();return n},t}(C),O=function(e){function t(t,n,r,i,o,s,a){var c;return(c=e.call(this,a)||this).index=void 0,c.count=void 0,c[t]=n,c[r]=i,c.index=o,c.count=s,c}return o(t,e),i(t,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),t}(I),x=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).instances=[],t.forbegin=void 0,t.forend=void 0,t.tokens=void 0,t}o(t,e);var n=t.prototype;return n.onInit=function(){var e=p(this).node,t=this.forbegin=document.createComment("*for begin");t.rxcompId=e.rxcompId,e.parentNode.replaceChild(t,e);var n=this.forend=document.createComment("*for end");t.parentNode.insertBefore(n,t.nextSibling),e.removeAttribute("*for")},n.onChanges=function(){for(var e=p(this),t=e.module,n=e.node,r=this.tokens,i=this.for||[],o=Array.isArray(i),s=o?i:Object.keys(i),a=s.length,c=this.instances.length,u=0;u<Math.max(c,a);u++)if(u<a){var l=o?u:s[u],A=o?s[l]:i[l];if(u<c){var h=this.instances[u];h[r.key]=l,h[r.value]=A}else{var d=n.cloneNode(!0);delete d.rxcompId,this.forend.parentNode.insertBefore(d,this.forend);var f=[r.key,l,r.value,A,u,a,e.parentInstance],g=t.makeInstance(d,O,e.selector,e.parentInstance,f,void 0,!0);g&&(t.compile(d,g),t.makeInstanceSubscription(g,e.parentInstance),this.instances.push(g))}}else{var m=p(this.instances[u]).node;m.parentNode.removeChild(m),t.remove(m)}this.instances.length=s.length},t.getInputsTokens=function(e,n,r){var i={},o=n.getAttribute("*for");if(o){var s=t.getForExpressionTokens(o);e.tokens=s,i.for=s.iterable}return i},t.getForExpressionTokens=function(e){if(null===e)throw new Error("invalid for");if(-1===e.trim().indexOf("let ")||-1===e.trim().indexOf(" of "))throw new Error("invalid for");var t=e.split(";").map((function(e){return e.trim()})).filter((function(e){return""!==e})),n=t[0].split(" of ").map((function(e){return e.trim()})),r=n[0].replace(/\s*let\s*/,""),i=n[1],o="index",s=r.match(/\[(.+)\s*,\s*(.+)\]/);if(s&&(o=s[1],r=s[2]),t.length>1){var a=t[1].split(/\s*let\s*|\s*=\s*index/).map((function(e){return e.trim()}));3===a.length&&(o=a[1])}return{key:o,value:r,iterable:i}},t}(T);x.meta={selector:"[*for]",inputs:["for"]};var N=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),i(t,[{key:"target",get:function(){return this.target_},set:function(e){if(this.target_!==e){this.target_=e;var t=p(this).node;e?t.setAttribute("target",e):t.removeAttribute("target")}}}]),t}(f);N.meta={selector:"[[target]]",inputs:["target"]};var B=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),i(t,[{key:"href",get:function(){return this.href_},set:function(e){if(this.href_!==e){this.href_=e;var t=p(this).node;e?t.setAttribute("href",e):t.removeAttribute("href")}}}]),t}(f);B.meta={selector:"[[href]]",inputs:["href"]};var L=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).ifbegin=void 0,t.ifend=void 0,t.clonedNode=void 0,t.element=void 0,t}o(t,e);var n=t.prototype;return n.onInit=function(){var e=p(this).node,t=this.ifbegin=document.createComment("*if begin");t.rxcompId=e.rxcompId,e.parentNode.replaceChild(t,e);var n=this.ifend=document.createComment("*if end");t.parentNode.insertBefore(n,t.nextSibling);var r=e.cloneNode(!0);r.removeAttribute("*if"),this.clonedNode=r,this.element=r.cloneNode(!0)},n.onChanges=function(){var e=p(this).module,t=this.element;if(Boolean(this.if)){if(!t.parentNode){var n=this.ifend;n.parentNode.insertBefore(t,n),e.compile(t)}}else t.parentNode&&(e.remove(t,this),t.parentNode.removeChild(t),this.element=this.clonedNode.cloneNode(!0))},t}(T);L.meta={selector:"[*if]",inputs:["if"]};var D=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),i(t,[{key:"innerHTML",get:function(){return this.innerHTML_},set:function(e){this.innerHTML_!==e&&(this.innerHTML_=e,p(this).node.innerHTML=null==e?"":e)}}]),t}(f);D.meta={selector:"[innerHTML]",inputs:["innerHTML"]};var M=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).active=!1,t}return o(t,e),t.prototype.onToggle=function(){this.active=!this.active,this.pushChanges()},t}(C);M.meta={selector:"json-component",inputs:["item"],template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ json </span>\n\t\t\t\t\t<span *if="active">- json </span>\n\t\t\t\t\t<span [innerHTML]="item"></span>\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item">\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item | json"></span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var P=function(){function e(){}return e.transform=function(e){return e},e}();P.meta=void 0;var k=[T,C,f],U=function(){function e(){}return e.bootstrap=function(e){if(!e)throw new m("missing moduleFactory");if(!e.meta)throw new m("missing moduleFactory meta");if(!e.meta.bootstrap)throw new m("missing bootstrap");if(!e.meta.bootstrap.meta)throw new m("missing bootstrap meta");if(!e.meta.bootstrap.meta.selector)throw new m("missing bootstrap meta selector");var t=this.resolveMeta(e),n=new e;return n.meta=t,t.imports.forEach((function(e){e.prototype.onInit.call(n)})),n},e.querySelector=function(e){return document.querySelector(e)},e.resolveMeta=function(e){var t=this.resolveImportedMeta(e),n=e.meta.bootstrap,r=this.querySelector(n.meta.selector);if(!r)throw new m("missing node "+n.meta.selector);var i=r.innerHTML,o=this.resolvePipes(t),s=this.resolveFactories(t);return this.sortFactories(s),s.unshift(n),{factories:s,pipes:o,selectors:this.unwrapSelectors(s),bootstrap:n,node:r,nodeInnerHTML:i,imports:e.meta.imports||[]}},e.resolveImportedMeta=function(e){var t=this,n=Object.assign({imports:[],declarations:[],pipes:[],exports:[]},e.meta);return n.imports=(e.meta.imports||[]).map((function(e){return t.resolveImportedMeta(e)})),n},e.resolvePipes=function(e,t){var n=this,r=e.imports.map((function(e){return n.resolvePipes(e,!0)})),i={};return(t?e.exports:e.declarations).filter((function(e){return e.prototype instanceof P})).forEach((function(e){return i[e.meta.name]=e})),Object.assign.apply(Object,[{}].concat(r,[i]))},e.resolveFactories=function(e,t){var n,r=this,i=e.imports.map((function(e){return r.resolveFactories(e,!0)})),o=(t?e.exports:e.declarations).filter((function(e){return e.prototype instanceof d}));return(n=Array.prototype.concat).call.apply(n,[o].concat(i))},e.sortFactories=function(e){e.sort((function(e,t){var n=k.reduce((function(t,n,r){return e.prototype instanceof n?r:t}),-1)-k.reduce((function(e,n,r){return t.prototype instanceof n?r:e}),-1);return 0===n?(e.meta.hosts?1:0)-(t.meta.hosts?1:0):n}))},e.getExpressions=function(e){var t=[];return e.replace(/\.([\w\-\_]+)|\[(.+?\]*)(\=)(.*?)\]|\[(.+?\]*)\]|([\w\-\_]+)/g,(function(e,n,r,i,o,s,a){return n&&t.push((function(e){return e.classList.contains(n)})),r&&t.push((function(e){return e.hasAttribute(r)&&e.getAttribute(r)===o||e.hasAttribute("["+r+"]")&&e.getAttribute("["+r+"]")===o})),s&&t.push((function(e){return e.hasAttribute(s)||e.hasAttribute("["+s+"]")})),a&&t.push((function(e){return e.nodeName.toLowerCase()===a.toLowerCase()})),""})),t},e.unwrapSelectors=function(e){var t=this,n=[];return e.forEach((function(e){e.meta&&e.meta.selector&&e.meta.selector.split(",").forEach((function(r){r=r.trim();var i=[],o=r.replace(/\:not\((.+?)\)/g,(function(e,n){return i=t.getExpressions(n),""})),s=t.getExpressions(o);n.push((function(t){var n=s.reduce((function(e,n){return e&&n(t)}),!0),o=i.reduce((function(e,n){return e||n(t)}),!1);return!(!n||o)&&{node:t,factory:e,selector:r}}))}))})),n},e}(),F="undefined"!=typeof window&&void 0!==window.document,H="undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("Node.js")||"undefined"!=typeof navigator&&-1!==navigator.userAgent.indexOf("jsdom"),V="undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node,Q="object"==typeof self&&self.constructor&&"DedicatedWorkerGlobalScope"===self.constructor.name,j=V,G=!V&&F,K=Q,W=function(){function e(){}return e.encode=function(e,t){return void 0===t&&(t=[z]),t.reduce((function(e,t){return t(e)}),e)},e.decode=function(e,t){return void 0===t&&(t=[Y]),t.reduce((function(e,t){return t(e)}),e)},e.encodeJson=function(e){return this.encode(e,[z])},e.decodeJson=function(e){return this.decode(e,[Y])},e.encodeBase64=function(e){return this.encode(e,[z,X])},e.decodeBase64=function(e){return this.decode(e,[J,Y])},e}();function z(e,t,n){var r;try{var i=[],o=JSON.stringify(e,(function(e,n){if("object"==typeof n&&null!=n){if(-1!==i.indexOf(n))return t;i.push(n)}return n}),n);r=o}catch(e){}return r}function q(e,t){return function(n){return z(n,e,t)}}function Y(e){var t;if(e)try{t=JSON.parse(e)}catch(e){}return t}function X(e){var t;try{t=G?btoa(e):Buffer.from(e).toString("base64")}catch(n){t=e}return t}function J(e){var t;try{t=G?atob(e):Buffer.from(e,"base64").toString()}catch(n){t=e}return t}var Z=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.transform=function(e){return W.encode(e,[q("#ref",2)])},t}(P);Z.meta={name:"json"};var $="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||void 0,ee=0,te=function(){function e(){this.meta=void 0,this.instances=void 0,this.unsubscribe$=new t.Subject}var r=e.prototype;return r.onInit=function(){},r.compile=function(t,n){var r,i=this;return e.querySelectorsAll(t,this.meta.selectors,[]).map((function(e){r&&r!==e.node&&(n=void 0);var t=i.makeInstance(e.node,e.factory,e.selector,n);return e.factory.prototype instanceof C&&(r=e.node),t})).filter((function(e){return void 0!==e}))},r.makeInstance=function(t,n,r,i,o,s,a){if(void 0===a&&(a=!1),i||t.parentNode){var c=n.meta;if(!(i=i||this.getParentInstance(t.parentNode)))return;var l=u(n,o||[]);s&&Object.keys(s).forEach((function(e){Object.defineProperty(l,e,{value:s[e],configurable:!1,enumerable:!1,writable:!0})}));var A=e.makeContext(this,l,i,t,n,r);return l instanceof I||(this.makeHosts(c,l,t),A.inputs=this.makeInputs(c,l,t,n),A.outputs=this.makeOutputs(c,l),this.resolveInputsOutputs(l,i)),l.onInit(),a||this.makeInstanceSubscription(l,i),l}},r.makeInstanceSubscription=function(e,t){t instanceof d&&t.changes$.pipe(n.takeUntil(e.unsubscribe$)).subscribe((function(t){e.onParentDidChange(t)}))},r.makeFunction=function(t,n){void 0===n&&(n=["$instance"]),t=e.parseExpression(t);var r="with(this) {\n\treturn (function ("+n.join(",")+", $$module) {\n\t\ttry {\n\t\t\tconst $$pipes = $$module.meta.pipes;\n\t\t\treturn "+t+";\n\t\t} catch(error) {\n\t\t\t$$module.nextError(error, this, "+JSON.stringify(t)+", arguments);\n\t\t}\n\t}.bind(this)).apply(this, arguments);\n}",i=new Function(r);return i.expression=t,i},r.resolveInputsOutputs=function(e,t){var n=p(e),r=n.parentInstance,i=n.inputs;for(var o in i){var s=i[o],a=this.resolve(s,r,e);e[o]=a}},r.resolveAttribute=function(e,t){var n=null;if(t.hasAttribute("["+e+"]"))n=t.getAttribute("["+e+"]");else if(t.hasAttribute("*"+e))n=t.getAttribute("*"+e);else if(t.hasAttribute(e)&&(n=t.getAttribute(e))){var r=n.replace(/({{)|(}})|(")/g,(function(e,t,n,r){return t?'"+':n?'+"':r?'"':""}));n='"'+r+'"'}return n},r.resolve=function(e,t,n){return e.apply(t,[n,this])},r.parse=function(e,t){for(var n=0;n<e.childNodes.length;n++){var r=e.childNodes[n];if(1===r.nodeType){var i=r;ne(i)||this.parse(i,t)}else if(3===r.nodeType){var o=r;this.parseTextNode(o,t)}}},r.remove=function(t,n){var r=n?p(n):void 0;return e.traverseDown(t,(function(t){var n=t.rxcompId;n&&(0===e.deleteContext(n,r).length&&delete t.rxcompId)})),t},r.destroy=function(){this.unsubscribe$.next(),this.unsubscribe$.complete(),this.remove(this.meta.node),this.meta.node.innerHTML=this.meta.nodeInnerHTML},r.nextError=function(e,t,n,r){var i=new v(e,this,t,n,r);b.next(i)},r.makeContext=function(t,n,r,i){return e.makeContext(this,t,n,r,t.constructor,i)},r.makeHosts=function(e,t,n){e.hosts&&Object.keys(e.hosts).forEach((function(r){var i=e.hosts[r];t[r]=ie(t,i,n)}))},r.makeInputs=function(e,t,n,r){var i=this,o={},s=r.getInputsTokens(t,n,this);return Object.keys(s).forEach((function(e){o[e]=i.makeFunction(s[e])})),o},r.makeOutput=function(e,r){var i=this,o=p(e),s=o.node,a=o.parentInstance,c=s.getAttribute("("+r+")"),u=c?this.makeFunction(c,["$event"]):null,l=(new t.Subject).pipe(n.tap((function(e){u&&i.resolve(u,a,e)})));return l.pipe(n.takeUntil(e.unsubscribe$)).subscribe(),e[r]=l,l},r.makeOutputs=function(e,t){var n=this,r={};return e.outputs&&e.outputs.forEach((function(e){var i=n.makeOutput(t,e);i&&(r[e]=i)})),r},r.getInstance=function(e){if(e===document)return $;var t=re(e);return t?t.instance:void 0},r.getParentInstance=function(t){var n=this;return e.traverseUp(t,(function(e){return n.getInstance(e)}))},r.parseTextNode=function(e,t){var n=this,r=e.nodeExpressions;if(r||(r=this.parseTextNodeExpression(e.wholeText)),r.length){var i=r.reduce((function(e,r){var i;return"function"==typeof r?null==(i=n.resolve(r,t,t))&&(i=""):i=r,e+i}),"");if(e.nodeValue!==i){var o=document.createTextNode(i);o.nodeExpressions=r,e.parentNode.replaceChild(o,e)}}else e.nodeExpressions=r},r.pushFragment=function(e,t,n,r){var i=e.substring(t,n);r.push(i)},r.parseTextNodeExpression=function(e){for(var t,n=[],r=/\{{2}((([^{}])|(\{([^{}]|(\{.*?\}))+?\}))*?)\}{2}/g,i=0;null!==(t=r.exec(e));){var o=r.lastIndex-t[0].length;if(o>i&&this.pushFragment(e,o,i,n),i=r.lastIndex,t[1]){var s=this.makeFunction(t[1]);n.push(s)}}var a=e.length;return a>i&&this.pushFragment(e,i,a,n),n.find((function(e){return"function"==typeof e}))?n:[]},e.makeContext=function(e,t,n,r,i,o){t.rxcompId=++ee;var s={module:e,instance:t,parentInstance:n,node:r,factory:i,selector:o},a=r.rxcompId=r.rxcompId||t.rxcompId;return(h[a]||(h[a]=[])).push(s),A[t.rxcompId]=s,s},e.parseExpression=function(t){for(var n=/(\()([^\(\)]*)(\))/;t.match(n);)t=t.replace(n,(function(t){return"â"+e.parsePipes(arguments.length<=2?void 0:arguments[2])+"â"}));return t=(t=e.parsePipes(t)).replace(/(â)|(â)/g,(function(e){return(arguments.length<=1?void 0:arguments[1])?"(":")"})),e.parseOptionalChaining(t)},e.parsePipes=function(t){for(var n=/(.*?[^\|])\|([^\|]+)/;t.match(n);)t=t.replace(n,(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r[0].trim(),s=e.parsePipeParams(r[1]),a=s.shift().trim();return"$$pipes."+a+".transformâ"+[o].concat(s)+"â"}));return t},e.parsePipeParams=function(e){for(var t=[],n=0,r="",i=0,o=e.length;n<o;){var s=e.substr(n,1);"{"!==s&&"("!==s&&"["!==s||i++,"}"!==s&&")"!==s&&"]"!==s||i--,":"===s&&0===i?(r.length&&t.push(r.trim()),r=""):r+=s,n++}return r.length&&t.push(r.trim()),t},e.parseOptionalChaining=function(e){var t;return e=e.replace(/(\w+(\?\.))+([\.|\w]+)/g,(function(e){for(var n=e.split("?."),r=0;r<n.length-1;r++){var i=r>0?"("+n[r]+" = "+t+")":n[r],o=n[r+1];t=r>0?i+"."+o:"("+i+" ? "+i+"."+o+" : void 0)"}return t||""}))},e.deleteContext=function(e,t){var n=[],r=h[e];return r&&(r.forEach((function(e){if(e===t)n.push(t);else{var r=e.instance;r.unsubscribe$.next(),r.unsubscribe$.complete(),r.onDestroy(),delete A[r.rxcompId]}})),n.length?h[e]=n:delete h[e]),n},e.matchSelectors=function(e,t,n){for(var r=0;r<t.length;r++){var i=t[r](e);if(i){var o=i.factory;if(o.prototype instanceof C&&o.meta.template&&(e.innerHTML=o.meta.template),n.push(i),o.prototype instanceof T)break}}return n},e.querySelectorsAll=function(e,t,n){if(1===e.nodeType){var r=this.matchSelectors(e,t,[]);if(n=n.concat(r),r.find((function(e){return e.factory.prototype instanceof T})))return n;for(var i=e.childNodes,o=0;o<i.length;o++)n=this.querySelectorsAll(i[o],t,n)}return n},e.traverseUp=function(e,t,n){if(void 0===n&&(n=0),e){var r=t(e,n);return r||this.traverseUp(e.parentNode,t,n+1)}},e.traverseDown=function(e,t,n){if(void 0===n&&(n=0),e){var r=t(e,n);if(r)return r;if(1===e.nodeType)for(var i=0,o=e.childNodes.length;i<o&&!r;)r=this.traverseDown(e.childNodes[i],t,n+1),i++;return r}},e.traversePrevious=function(e,t,n){if(void 0===n&&(n=0),e){var r=t(e,n);return r||this.traversePrevious(e.previousSibling,t,n+1)}},e.traverseNext=function(e,t,n){if(void 0===n&&(n=0),e){var r=t(e,n);return r||this.traverseNext(e.nextSibling,t,n+1)}},e}();function ne(e){var t,n=e.rxcompId;if(n){var r=h[n];r&&(t=r.reduce((function(e,t){return t.instance instanceof I?e||t:t.instance instanceof C?t:e}),void 0))}return t}function re(e){var t=ne(e);if(!(t&&t.factory.prototype instanceof T))return t}function ie(e,t,n){if(n||(n=p(e).node),n.rxcompId){var r=h[n.rxcompId];if(r)for(var i=0;i<r.length;i++){var o=r[i];if(o.instance!==e&&o.instance instanceof t)return o.instance}}return n.parentNode?ie(e,t,n.parentNode):void 0}te.forRoot=void 0,te.meta=void 0;var oe=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),i(t,[{key:"src",get:function(){return this.src_},set:function(e){if(this.src_!==e){this.src_=e;var t=p(this).node;e?t.setAttribute("src",e):t.removeAttribute("src")}}}]),t}(f);oe.meta={selector:"[[src]]",inputs:["src"]};var se=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).style=void 0,t.previousStyle=void 0,t}return o(t,e),t.prototype.onChanges=function(){var e=p(this).node,t=this.style,n=this.previousStyle;if(n)for(var r in n)if(!t||!t[r]){var i=r.split(".").shift();e.style.removeProperty(i)}if(t)for(var o in t)if(!n||n[o]!==t[o]){var s=o.split("."),a=s.shift(),c=t[o]+(s.length?s[0]:"");e.style.setProperty(a,c)}this.previousStyle=t},t}(f);se.meta={selector:"[[style]]",inputs:["style"]};var ae=[g,S,x,B,N,L,D,M,oe,se],ce=[Z],ue=function(e){function t(){var t;return t=e.call(this)||this,w.pipe(n.takeUntil(t.unsubscribe$)).subscribe(),t}return o(t,e),t}(te);ue.meta={declarations:[].concat(ae,ce),exports:[].concat(ae,ce)};var le=function(e){function t(){return e.apply(this,arguments)||this}return o(t,e),t.bootstrap=function(e){if(!G)throw new m("missing platform browser, Window not found");if(!e)throw new m("missing moduleFactory");if(!e.meta)throw new m("missing moduleFactory meta");if(!e.meta.bootstrap)throw new m("missing bootstrap");if(!e.meta.bootstrap.meta)throw new m("missing bootstrap meta");if(!e.meta.bootstrap.meta.selector)throw new m("missing bootstrap meta selector");var t=this.resolveMeta(e),n=new e;if(n.meta=t,t.imports.forEach((function(e){e.prototype.onInit.call(n)})),$.rxcomp_hydrate_){var r,i=t.node.cloneNode();i.innerHTML=t.nodeInnerHTML=$.rxcomp_hydrate_.innerHTML;var o=n.compile(i,$);n.instances=o,o[0].pushChanges(),null==(r=t.node.parentNode)||r.replaceChild(i,t.node)}else{var s=n.compile(t.node,$);n.instances=s,s[0].pushChanges()}return n},t}(U);var Ae=function(){function e(){}return e.makeKey=function(e,t){var n="rxcomp-hydrate-"+e+"-"+(t?he(t):"");return n=n.replace(/(\s+)|(\W+)/g,(function(){return(arguments.length<=1?void 0:arguments[1])?"":"_"})),n},e.has=function(e){return null!==document.querySelector("#"+e)},e.get=function(e){var t=document.querySelector("#"+e);if(t&&t.firstChild){var n=t.firstChild.nodeValue;return n?W.decode(n,[Y]):void 0}},e.set=function(e,t){var n=W.encode(t,[z]);if(n){var r=document.createTextNode(n),i=document.querySelector("#"+e);i?i.replaceChild(r,i.firstChild):((i=document.createElement("script")).setAttribute("id",e),i.setAttribute("type","text/template"),i.append(r),document.head.append(i))}},e.remove=function(e){var t=document.querySelector("#"+e);t&&t.parentNode&&t.parentNode.removeChild(t)},e}();function he(e,t){return void 0===t&&(t=""),"number"==typeof e?t+="-"+e.toString():"string"==typeof e?t+="-"+e.substr(0,20):e&&Array.isArray(e)?t+="-"+e.map((function(e){return he(e)})).join(""):e&&"object"==typeof e&&(t+="-"+Object.keys(e).map((function(t){return t+he(e[t])})).join("-")),t}e.Browser=le,e.ClassDirective=g,e.Component=C,e.Context=I,e.CoreModule=ue,e.DefaultErrorHandler=_,e.Directive=f,e.ErrorInterceptorHandler=y,e.ErrorInterceptors=E,e.EventDirective=S,e.ExpressionError=v,e.Factory=d,e.ForItem=O,e.ForStructure=x,e.HrefDirective=B,e.HrefTargetDirective=N,e.IfStructure=L,e.InnerHtmlDirective=D,e.JsonComponent=M,e.JsonPipe=Z,e.Module=te,e.ModuleError=m,e.PLATFORM_BROWSER=F,e.PLATFORM_JS_DOM=H,e.PLATFORM_NODE=V,e.PLATFORM_WEB_WORKER=Q,e.Pipe=P,e.Platform=U,e.Serializer=W,e.SrcDirective=oe,e.Structure=T,e.StyleDirective=se,e.TransferService=Ae,e.WINDOW=$,e.decodeBase64=J,e.decodeJson=Y,e.encodeBase64=X,e.encodeJson=z,e.encodeJsonWithOptions=q,e.errors$=w,e.getContext=p,e.getContextByNode=re,e.getHost=ie,e.getLocationComponents=function(e){for(var t,n="",r="",i="",o="",s="",a="",c="",u=/^((http\:|https\:)?\/\/)?((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])|(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])|locahost)?(\:([^\/]+))?(\.?\/[^\?]+)?(\?[^\#]+)?(\#.+)?$/g,l=[];null!==(t=u.exec(e));)l.push(t);for(var A=0,h=l;A<h.length;A++){var d=h[A];n=d[2]||"",r=i=d[3]||"",o=d[11]||"",s=d[12]||"",a=d[13]||"",c=d[14]||""}return{href:e,protocol:n,host:r,hostname:i,port:o,pathname:s,search:a,hash:c}},e.getParsableContextByElement=ne,e.isPlatformBrowser=G,e.isPlatformServer=j,e.isPlatformWorker=K,e.nextError$=b,e.optionsToKey=he,Object.defineProperty(e,"__esModule",{value:!0})})),
/**
 * @license rxcomp-form v1.0.0-beta.18
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxcomp"),require("rxjs"),require("rxjs/operators")):"function"==typeof define&&define.amd?define(["exports","rxcomp","rxjs","rxjs/operators"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).rxcomp=e.rxcomp||{},e.rxcomp.form={}),e.rxcomp,e.rxjs,e.rxjs.operators)}(this,(function(e,t,n,r){"use strict";function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function s(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var a=function(e){function n(){return e.apply(this,arguments)||this}return s(n,e),n.prototype.onChanges=function(e){var n=t.getContext(this).node,r=this.control.flags;Object.keys(r).forEach((function(e){r[e]?n.classList.add(e):n.classList.remove(e)}))},o(n,[{key:"control",get:function(){return{}}}]),n}(t.Directive);a.meta={selector:"",hosts:{host:a}};var c=function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),o(t,[{key:"control",get:function(){if(this.formArray)return this.formArray;if(!this.host)throw"missing form collection";return this.host.control.get(this.formArrayName)}}]),t}(a);c.meta={selector:"[formArray],[formArrayName]",inputs:["formArray","formArrayName"],hosts:{host:a}};var u=function(e){function i(){return e.apply(this,arguments)||this}s(i,e);var a=i.prototype;return a.onInit=function(){var e=this,i=t.getContext(this).node;n.fromEvent(i,"input").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onChange(t)})),n.fromEvent(i,"change").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onChange(t)})),n.fromEvent(i,"blur").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onBlur(t)}))},a.onChanges=function(e){var n=t.getContext(this).node;this.formControlName&&(n.name=this.formControlName);var r=this.control,i=r.flags;Object.keys(i).forEach((function(e){i[e]?n.classList.add(e):n.classList.remove(e)})),this.writeValue(r.value)},a.writeValue=function(e){t.getContext(this).node.value=null==e?"":e},a.onChange=function(e){var n=t.getContext(this).node;this.control.value=""===n.value?null:n.value},a.onBlur=function(e){this.control.touched=!0},a.setDisabledState=function(e){t.getContext(this).node.disabled=e},o(i,[{key:"control",get:function(){if(this.formControl)return this.formControl;if(!this.host)throw"missing form collection";return this.host.control.get(this.formControlName)}}]),i}(t.Directive);u.meta={selector:"",inputs:["formControl","formControlName","value"],hosts:{host:a}};var l=function(e){function i(){return e.apply(this,arguments)||this}s(i,e);var o=i.prototype;return o.onInit=function(){var e=this,i=t.getContext(this).node;n.fromEvent(i,"change").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onChange(t)})),n.fromEvent(i,"blur").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onBlur(t)}))},o.writeValue=function(e){var n=t.getContext(this).node;e===this.value?n.setAttribute("checked",e):n.removeAttribute("checked")},o.setDisabledState=function(e){t.getContext(this).node.disabled=e},o.onChange=function(e){var n=t.getContext(this).node;this.control.value=n.checked?this.value:!0!==this.value&&null},o.onBlur=function(e){this.control.touched=!0},i}(u);l.meta={selector:"input[type=checkbox][formControl],input[type=checkbox][formControlName]",inputs:["formControl","formControlName","value"],hosts:{host:a}};var A=function(e){function n(){return e.apply(this,arguments)||this}return s(n,e),n.prototype.onChanges=function(e){var n=t.getContext(this).node,r=this.control.flags;Object.keys(r).forEach((function(e){r[e]?n.classList.add(e):n.classList.remove(e)}))},o(n,[{key:"control",get:function(){if(this.formField)return this.formField;if(!this.host)throw"missing form collection";return this.host.control.get(this.formFieldName)}}]),n}(t.Component);A.meta={selector:"[formField],[formFieldName]",inputs:["formField","formFieldName"],hosts:{host:a}};var h=function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),o(t,[{key:"control",get:function(){if(this.formGroup)return this.formGroup;if(!this.host)throw"missing form collection";return this.host.control.get(this.formGroupName)}}]),t}(a);h.meta={selector:"[formGroup],[formGroupName]",inputs:["formGroup","formGroupName"],hosts:{host:a}};var d=function(e){function n(){return e.apply(this,arguments)||this}s(n,e);var r=n.prototype;return r.writeValue=function(e){t.getContext(this).node.value=null==e?"":e},r.onChange=function(e){var n=t.getContext(this).node;this.control.value=""===n.value?null:n.value},r.onBlur=function(e){this.control.touched=!0},n}(u);d.meta={selector:"input[type=text][formControl],input[type=text][formControlName],input[type=email][formControl],input[type=email][formControlName],input[type=password][formControl],input[type=password][formControlName],textarea[formControl],textarea[formControlName]",inputs:["formControl","formControlName"],hosts:{host:a}};var p=function(e){function n(){return e.apply(this,arguments)||this}return s(n,e),n.prototype.onChanges=function(e){t.getContext(this).node.setAttribute("placeholder",this.placeholder||"")},n}(t.Directive);p.meta={selector:"input[placeholder],textarea[placeholder]",inputs:["placeholder"]};var f=function(e){function i(){return e.apply(this,arguments)||this}s(i,e);var o=i.prototype;return o.onInit=function(){var e=this,i=t.getContext(this).node;n.fromEvent(i,"change").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onChange(t)})),n.fromEvent(i,"blur").pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(t){return e.onBlur(t)}))},o.writeValue=function(e){var n=t.getContext(this).node;n.checked=n.value===e},o.setDisabledState=function(e){t.getContext(this).node.disabled=e},o.onChange=function(e){var n=t.getContext(this).node;n.checked&&(this.control.value=n.value)},o.onBlur=function(e){this.control.touched=!0},i}(u);f.meta={selector:"input[type=radio][formControl],input[type=radio][formControlName]",inputs:["formControl","formControlName"],hosts:{host:a}};var g=function(e){function n(){return e.apply(this,arguments)||this}s(n,e);var r=n.prototype;return r.writeValue=function(e){t.getContext(this).node.value=null==e?"":e},r.setDisabledState=function(e){t.getContext(this).node.disabled=e},r.onChange=function(e){var n=t.getContext(this).node;this.control.value=""===n.value?null:n.value},r.onBlur=function(e){this.control.touched=!0},n}(u);g.meta={selector:"select[formControl],select[formControlName]",inputs:["formControl","formControlName"],hosts:{host:a}};var m=function(e){function i(){return e.apply(this,arguments)||this}return s(i,e),i.prototype.onInit=function(){var e=t.getContext(this),i=e.module,o=e.node,s=e.selector,a=e.parentInstance,c=this.event=s.replace(/\[|\]|\(|\)/g,""),u=o,l=this.event$=n.fromEvent(u,"submit").pipe(r.tap((function(e){e.preventDefault()})),r.shareReplay(1)),A=o.getAttribute("("+c+")");if(A){var h=i.makeFunction(A,["$event"]);l.pipe(r.takeUntil(this.unsubscribe$)).subscribe((function(e){i.resolve(h,a,e)}))}else a[c+"$"]=l},i}(t.Directive);m.meta={selector:"[(submit)]"};var v=function(){function e(e,t){this.validator=e,this.params$=new n.BehaviorSubject(t)}return e.prototype.validate=function(e){return this.validator(e,this.params)},o(e,[{key:"params",get:function(){return this.params$.getValue()},set:function(e){if(e){var t=this.params;Object.keys(e).reduce((function(n,r){return n||!t||t[r]!==e[r]}),!1)&&this.params$.next(e)}}}]),e}();function y(){return new v((function(e,t){return null}))}function _(){return new v((function(e,t){return null==e||0===e.length?{required:!0}:null}))}function E(){return new v((function(e,t){return!0===e?null:{required:!0}}))}function b(e){return new v((function(e,t){var n=t.min;return e&&n?(e=parseFloat(e),!isNaN(e)&&e<n?{min:{min:n,actual:e}}:null):null}),{min:e})}function w(e){return new v((function(e,t){var n=t.max;return e&&n?(e=parseFloat(e),!isNaN(e)&&e>n?{max:{max:n,actual:e}}:null):null}),{max:e})}function S(e){return new v((function(e,t){var n=t.minlength;if(!e||!n)return null;var r=e?e.length:0;return r<n?{minlength:{requiredLength:n,actualLength:r}}:null}),{minlength:e})}function T(e){return new v((function(e,t){var n=t.maxlength;if(!e||!n)return null;var r=e?e.length:0;return r>n?{minlength:{requiredLength:n,actualLength:r}}:null}),{maxlength:e})}function C(e){return new v((function(e,t){var n=t.pattern;if(!e||!n)return null;var r=function(e){var t;e instanceof RegExp?t=e:"string"==typeof e&&(e="$"===(e="^"===e.charAt(0)?e:"^"+e).charAt(e.length-1)?e:e+"$",t=new RegExp(e));return t||new RegExp("")}(n);return r.test(e)?null:{pattern:{requiredPattern:r.toString(),actualValue:e}}}),{pattern:e})}function R(){var e=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return new v((function(t,n){return t?e.test(t)?null:{email:!0}:null}))}var I=Object.freeze({__proto__:null,NullValidator:y,RequiredValidator:_,RequiredTrueValidator:E,MinValidator:b,MaxValidator:w,MinLengthValidator:S,MaxLengthValidator:T,PatternValidator:C,EmailValidator:R}),O=function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),t.prototype.onInit=function(){var e=this.validator=R();this.host&&this.host.control.addValidators(e)},t}(t.Directive);O.meta={selector:"[email][formControl],[email][formControlName]",inputs:["email"],hosts:{host:u}};var x=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).maxlength=Number.POSITIVE_INFINITY,t}s(t,e);var n=t.prototype;return n.onInit=function(){this.validator=T(this.maxlength),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(e){this.validator&&(this.validator.params={maxlength:this.maxlength})},t}(t.Directive);x.meta={selector:"[maxlength][formControl],[maxlength][formControlName]",inputs:["maxlength"],hosts:{host:u}};var N=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).max=Number.POSITIVE_INFINITY,t}s(t,e);var n=t.prototype;return n.onInit=function(){this.validator=w(this.max),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(e){this.validator&&(this.validator.params={max:this.max})},t}(t.Directive);N.meta={selector:"[max][formControl],[max][formControlName]",inputs:["max"],hosts:{host:u}};var B=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).minlength=Number.NEGATIVE_INFINITY,t}s(t,e);var n=t.prototype;return n.onInit=function(){this.validator=S(this.minlength),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(e){this.validator&&(this.validator.params={minlength:this.minlength})},t}(t.Directive);B.meta={selector:"[minlength][formControl],[minlength][formControlName]",inputs:["minlength"],hosts:{host:u}};var L=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).min=Number.NEGATIVE_INFINITY,t}s(t,e);var n=t.prototype;return n.onInit=function(){this.validator=b(this.min),this.host&&this.host.control.addValidators(this.validator)},n.onChanges=function(e){this.validator&&(this.validator.params={min:this.min})},t}(t.Directive);L.meta={selector:"[min][formControl],[min][formControlName]",inputs:["min"],hosts:{host:u}};var D=function(e){function t(){return e.apply(this,arguments)||this}s(t,e);var n=t.prototype;return n.onInit=function(){this.pattern&&(this.validator=C(this.pattern),this.host&&this.host.control.addValidators(this.validator))},n.onChanges=function(e){this.validator&&(this.validator.params={pattern:this.pattern})},t}(t.Directive);D.meta={selector:"[pattern][formControl],[pattern][formControlName]",inputs:["pattern"],hosts:{host:u}};var M=function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),t.prototype.onInit=function(){this.validator=E(),this.host&&this.host.control.addValidators(this.validator)},t}(t.Directive);M.meta={selector:"[requiredTrue][formControl],[requiredTrue][formControlName]",inputs:["requiredTrue"],hosts:{host:u}};var P=function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),t.prototype.onInit=function(){this.validator=_(),this.host&&this.host.control.addValidators(this.validator)},t}(t.Directive);P.meta={selector:"[required][formControl],[required][formControlName]",inputs:["required"],hosts:{host:u}};var k,U=[c,l,A,h,d,p,f,g,m,O,N,x,L,B,D,P,M],F=[],H=function(e){function t(){return e.apply(this,arguments)||this}return s(t,e),t}(t.Module);H.meta={declarations:[].concat(U,F),exports:[].concat(U,F)},function(e){e.Pending="pending",e.Valid="valid",e.Invalid="invalid",e.Disabled="disabled",e.Hidden="hidden"}(k||(k={}));var V=k,Q=function(){function e(e){var t=this;this.value_=void 0,this.submitted_=!1,this.touched_=!1,this.dirty_=!1,this.valueSubject=new n.BehaviorSubject(null),this.statusSubject=new n.BehaviorSubject(null),this.validatorsSubject=(new n.ReplaySubject).pipe(r.switchAll()),this.value$=this.valueSubject.pipe(r.distinctUntilChanged(),r.skip(1),r.tap((function(){t.submitted_=!1,t.dirty_=!0,t.statusSubject.next(null)})),r.shareReplay(1)),this.status$=n.merge(this.statusSubject,this.validatorsSubject).pipe(r.switchMap((function(){return t.validate$(t.value)})),r.shareReplay(1)),this.changes$=n.merge(this.value$,this.status$).pipe(r.map((function(){return t.value})),r.auditTime(1),r.shareReplay(1)),this.validators=e?Array.isArray(e)?e:[e]:[]}var t=e.prototype;return t.initSubjects_=function(){this.switchValidators_()},t.switchValidators_=function(){var e=this.validators.map((function(e){return e.params$})),t=e.length?n.combineLatest(e):n.of(e);this.validatorsSubject.next(t)},t.initObservables_=function(){},t.validate$=function(e){var t=this;return this.status===V.Disabled||this.status===V.Hidden||this.submitted_||!this.validators.length?(this.errors_={},this.status===V.Invalid&&(this.status=V.Valid),n.of(this.errors_)):n.combineLatest(this.validators.map((function(t){var r=t.validate(e);return n.isObservable(r)?r:n.of(r)}))).pipe(r.map((function(e){return t.errors_=Object.assign.apply(Object,[{}].concat(e)),t.status=0===Object.keys(t.errors_).length?V.Valid:V.Invalid,t.errors_})))},t.reset=function(e){this.status=e||V.Pending,this.value_=null,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)},t.patch=function(e){this.value_=e,this.dirty_=!0,this.submitted_=!1,this.statusSubject.next(null)},t.addValidators=function(){var e;(e=this.validators).push.apply(e,arguments),this.switchValidators_()},t.replaceValidators=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.validators=t,this.switchValidators_()},t.clearValidators=function(){this.validators=[],this.switchValidators_()},o(e,[{key:"errors",get:function(){return this.errors_},set:function(e){this.errors_=e}},{key:"pending",get:function(){return this.status===V.Pending}},{key:"valid",get:function(){return this.status!==V.Invalid}},{key:"invalid",get:function(){return this.status===V.Invalid}},{key:"disabled",get:function(){return this.status===V.Disabled},set:function(e){e?this.status!==V.Disabled&&(this.status=V.Disabled,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)):this.status===V.Disabled&&(this.status=V.Pending,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null))}},{key:"enabled",get:function(){return this.status!==V.Disabled}},{key:"hidden",get:function(){return this.status===V.Hidden},set:function(e){e?this.status!==V.Hidden&&(this.status=V.Hidden,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null)):this.status===V.Hidden&&(this.status=V.Pending,this.dirty_=!1,this.touched_=!1,this.submitted_=!1,this.statusSubject.next(null))}},{key:"visible",get:function(){return this.status!==V.Hidden}},{key:"submitted",get:function(){return this.submitted_},set:function(e){this.submitted_=e,this.statusSubject.next(null)}},{key:"dirty",get:function(){return this.dirty_}},{key:"pristine",get:function(){return!this.dirty_}},{key:"touched",get:function(){return this.touched_},set:function(e){this.touched_=e,this.statusSubject.next(null)}},{key:"untouched",get:function(){return!this.touched_}},{key:"flags",get:function(){return{untouched:this.untouched,touched:this.touched,pristine:this.pristine,dirty:this.dirty,pending:this.pending,enabled:this.enabled,disabled:this.disabled,hidden:this.hidden,visible:this.visible,valid:this.valid,invalid:this.invalid,submitted:this.submitted}}},{key:"value",get:function(){return this.value_},set:function(e){this.value_=e,this.valueSubject.next(e)}}]),e}(),j=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,n)||this).value_=t,r.status=V.Pending,r.errors={},r.initSubjects_(),r.initObservables_(),r.statusSubject.next(null),r}return s(t,e),t}(Q),G=function(e){function t(t,r){var i;return(i=e.call(this,r)||this).changesChildren=new n.BehaviorSubject(void 0),i.controls=t,i.initControls_(),i.initSubjects_(),i.initObservables_(),i}s(t,e);var i=t.prototype;return i.initControl_=function(e,t){var n=e instanceof Q?e:new j(e);return n.addValidators.apply(n,this.validators),n.name=t,n},i.initControls_=function(){var e=this;return this.forEach_((function(t,n){e.init(t,n)})),this.controls},i.initSubjects_=function(){this.changesChildren=this.changesChildren.pipe(r.switchAll()),this.switchSubjects_()},i.switchSubjects_=function(){var e=this.reduce_((function(e,t){return e.push(t.changes$),e}),[]),t=e.length?n.combineLatest(e):n.of(e);this.changesChildren.next(t)},i.initObservables_=function(){var e=this;this.changes$=this.changesChildren.pipe(r.map((function(){return e.value})),r.shareReplay(1))},i.validate=function(e){var t;if(this.status===V.Disabled||this.status===V.Hidden)t=[];else{var n=this.validators.map((function(t){return t.validate(e)})).filter((function(e){return null!==e}));t=this.reduce_((function(e,t){return e.concat(t.errors)}),n),this.status=0===t.length?V.Valid:V.Invalid}return t},i.forEach_=function(e){var t=this;Object.keys(this.controls).forEach((function(n){return e(t.controls[n],n)}))},i.reduce_=function(e,t){return this.forEach_((function(n,r){t=e(t,n,r)})),t},i.all_=function(e,t){return this.reduce_((function(n,r){return n&&r[e]===t}),!0)},i.any_=function(e,t){return this.reduce_((function(n,r){return n||r[e]===t}),!1)},i.reset=function(){this.forEach_((function(e){return e.reset()}))},i.patch=function(e){e&&this.forEach_((function(t,n){null!=e[n]&&t.patch(e[n])}))},i.init=function(e,t){this.controls[t]=this.initControl_(e,t)},i.get=function(e){return this.controls[e]},i.set=function(e,t){delete this.controls[t],this.controls[t]=this.initControl_(e,t),this.switchSubjects_()},i.add=function(e,t){this.controls[t]=this.initControl_(e,t),this.switchSubjects_()},i.remove=function(e){var t=this,n=Object.keys(this.controls).find((function(n){return t.controls[n]===e?n:null}));n&&this.removeKey(n)},i.removeKey=function(e){var t=void 0!==this.controls[e];delete this.controls[e],t&&this.switchSubjects_()},i.addValidators=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.forEach_((function(e){return e.addValidators.apply(e,t)}))},i.replaceValidators=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.forEach_((function(e){return e.replaceValidators.apply(e,t)}))},i.clearValidators=function(){this.forEach_((function(e){return e.clearValidators()}))},o(t,[{key:"valid",get:function(){return this.all_("valid",!0)}},{key:"invalid",get:function(){return this.any_("invalid",!0)}},{key:"pending",get:function(){return this.any_("pending",!0)}},{key:"disabled",get:function(){return this.all_("disabled",!0)},set:function(e){this.forEach_((function(t){t.disabled=e}))}},{key:"enabled",get:function(){return this.any_("enabled",!0)}},{key:"hidden",get:function(){return this.all_("hidden",!0)},set:function(e){this.forEach_((function(t){t.hidden=e}))}},{key:"visible",get:function(){return this.any_("visible",!0)}},{key:"submitted",get:function(){return this.all_("submitted",!0)},set:function(e){this.forEach_((function(t){t.submitted=e}))}},{key:"dirty",get:function(){return this.any_("dirty",!0)}},{key:"pristine",get:function(){return this.all_("pristine",!0)}},{key:"touched",get:function(){return this.all_("touched",!0)},set:function(e){this.forEach_((function(t){t.touched=e}))}},{key:"untouched",get:function(){return this.any_("untouched",!0)}},{key:"value",get:function(){return this.reduce_((function(e,t,n){return e[n]=t.value,e}),{})},set:function(e){this.forEach_((function(t,n){t.value=e[n]}))}},{key:"errors",get:function(){return this.reduce_((function(e,t){return Object.assign(e,t.errors)}),{})},set:function(e){}}]),t}(Q),K=function(e){function t(t,n){return void 0===t&&(t=[]),e.call(this,t,n)||this}s(t,e);var n=t.prototype;return n.forEach_=function(e){this.controls.forEach((function(t,n){return e(t,n)}))},n.init=function(e,t){this.controls.length=Math.max(this.controls.length,t),this.controls[t]=this.initControl_(e,t)},n.set=function(e,t){this.controls.splice(t,1,this.initControl_(e,t)),this.switchSubjects_()},n.add=function(e,t){this.controls.length=Math.max(this.controls.length,t),this.controls[t]=this.initControl_(e,t),this.switchSubjects_()},n.push=function(e){this.controls.push(this.initControl_(e,this.controls.length)),this.switchSubjects_()},n.insert=function(e,t){this.controls.splice(t,0,this.initControl_(e,t)),this.switchSubjects_()},n.remove=function(e){var t=this.controls.indexOf(e);-1!==t&&this.removeKey(t)},n.removeKey=function(e){this.controls.length>e&&(this.controls.splice(e,1),this.switchSubjects_())},n.at=function(e){return this.controls[e]},o(t,[{key:"value",get:function(){return this.reduce_((function(e,t,n){return e[n]=t.value,e}),[])}},{key:"length",get:function(){return this.controls.length}}]),t}(G);var W=function(e){function t(t,n){return void 0===t&&(t={}),e.call(this,t,n)||this}return s(t,e),t}(G);e.EmailValidator=R,e.FormAbstract=Q,e.FormAbstractCollection=G,e.FormAbstractCollectionDirective=a,e.FormArray=K,e.FormArrayDirective=c,e.FormCheckboxDirective=l,e.FormControl=j,e.FormEmailDirective=O,e.FormFieldComponent=A,e.FormGroup=W,e.FormGroupDirective=h,e.FormInputDirective=d,e.FormMaxDirective=N,e.FormMaxLengthDirective=x,e.FormMinDirective=L,e.FormMinLengthDirective=B,e.FormModule=H,e.FormPatternDirective=D,e.FormPlaceholderDirective=p,e.FormRadioDirective=f,e.FormRequiredDirective=P,e.FormRequiredTrueDirective=M,e.FormSelectDirective=g,e.FormStatus=V,e.FormValidator=v,e.MaxLengthValidator=T,e.MaxValidator=w,e.MinLengthValidator=S,e.MinValidator=b,e.NullValidator=y,e.PatternValidator=C,e.RequiredTrueValidator=E,e.RequiredValidator=_,e.Validators=I,e.formArray=function(e,t){return void 0===e&&(e=[]),new K(e,t)},e.formGroup=function(e,t){return void 0===e&&(e={}),new W(e,t)},Object.defineProperty(e,"__esModule",{value:!0})})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).window=e.window||{})}(this,(function(e){"use strict";
/*!
	 * EasePack 3.9.1
	 * https://greensock.com
	 *
	 * @license Copyright 2008-2021, GreenSock. All rights reserved.
	 * Subject to the terms at https://greensock.com/standard-license or for
	 * Club GreenSock members, the agreement issued with that membership.
	 * @author: Jack Doyle, jack@greensock.com
	*/var t,n,r=function(){return t||"undefined"!=typeof window&&(t=window.gsap)&&t.registerPlugin&&t},i=function(e,t){return!!(void 0===e?t:e&&!~(e+"").indexOf("false"))},o=function(e){if(t=e||r()){n=t.registerEase;var i,o=t.parseEase(),s=function(e){return function(t){var n=.5+t/2;e.config=function(t){return e(2*(1-t)*t*n+t*t)}}};for(i in o)o[i].config||s(o[i]);for(i in n("slow",l),n("expoScale",A),n("rough",h),d)"version"!==i&&t.core.globals(i,d[i])}},s=function(e,t,n){var r=(e=Math.min(1,e||.7))<1?t||0===t?t:.7:0,o=(1-e)/2,s=o+e,a=i(n);return function(e){var t=e+(.5-e)*r;return e<o?a?1-(e=1-e/o)*e:t-(e=1-e/o)*e*e*e*t:e>s?a?1===e?0:1-(e=(e-s)/o)*e:t+(e-t)*(e=(e-s)/o)*e*e*e:a?1:t}},a=function(e,n,r){var i=Math.log(n/e),o=n-e;return r&&(r=t.parseEase(r)),function(t){return(e*Math.exp(i*(r?r(t):t))-e)/o}},c=function(e,t,n){this.t=e,this.v=t,n&&(this.next=n,n.prev=this,this.c=n.v-t,this.gap=n.t-e)},u=function(e){"object"!=typeof e&&(e={points:+e||20});for(var n,r,o,s,a,u,l,A=e.taper||"none",h=[],d=0,p=0|(+e.points||20),f=p,g=i(e.randomize,!0),m=i(e.clamp),v=t?t.parseEase(e.template):0,y=.4*(+e.strength||1);--f>-1;)n=g?Math.random():1/p*f,r=v?v(n):n,o="none"===A?y:"out"===A?(s=1-n)*s*y:"in"===A?n*n*y:n<.5?(s=2*n)*s*.5*y:(s=2*(1-n))*s*.5*y,g?r+=Math.random()*o-.5*o:f%2?r+=.5*o:r-=.5*o,m&&(r>1?r=1:r<0&&(r=0)),h[d++]={x:n,y:r};for(h.sort((function(e,t){return e.x-t.x})),u=new c(1,1,null),f=p;f--;)a=h[f],u=new c(a.x,a.y,u);return l=new c(0,0,u.t?u:u.next),function(e){var t=l;if(e>t.t){for(;t.next&&e>=t.t;)t=t.next;t=t.prev}else for(;t.prev&&e<=t.t;)t=t.prev;return l=t,t.v+(e-t.t)/t.gap*t.c}},l=s(.7);l.ease=l,l.config=s;var A=a(1,2);A.config=a;var h=u();h.ease=h,h.config=u;var d={SlowMo:l,RoughEase:h,ExpoScaleEase:A};for(var p in d)d[p].register=o,d[p].version="3.9.1";r()&&t.registerPlugin(l),e.EasePack=d,e.ExpoScaleEase=A,e.RoughEase=h,e.SlowMo=l,e.default=d,Object.defineProperty(e,"__esModule",{value:!0})})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).window=e.window||{})}(this,(function(e){"use strict";function t(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function n(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}
/*!
   * GSAP 3.9.1
   * https://greensock.com
   *
   * @license Copyright 2008-2021, GreenSock. All rights reserved.
   * Subject to the terms at https://greensock.com/standard-license or for
   * Club GreenSock members, the agreement issued with that membership.
   * @author: Jack Doyle, jack@greensock.com
  */var r,i,o,s,a,c,u,l,A,h,d,p,f,g,m,v,y,_,E,b,w,S,T,C,R,I,O,x,N={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},B={duration:.5,overwrite:!1,delay:0},L=1e8,D=1e-8,M=2*Math.PI,P=M/4,k=0,U=Math.sqrt,F=Math.cos,H=Math.sin,V=function(e){return"string"==typeof e},Q=function(e){return"function"==typeof e},j=function(e){return"number"==typeof e},G=function(e){return void 0===e},K=function(e){return"object"==typeof e},W=function(e){return!1!==e},z=function(){return"undefined"!=typeof window},q=function(e){return Q(e)||V(e)},Y="function"==typeof ArrayBuffer&&ArrayBuffer.isView||function(){},X=Array.isArray,J=/(?:-?\.?\d|\.)+/gi,Z=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,$=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,ee=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,te=/[+-]=-?[.\d]+/,ne=/[^,'"\[\]\s]+/gi,re=/[\d.+\-=]+(?:e[-+]\d*)*/i,ie={},oe={},se=function(e){return(oe=Ne(e,ie))&&_n},ae=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},ce=function(e,t){return!t&&console.warn(e)},ue=function(e,t){return e&&(ie[e]=t)&&oe&&(oe[e]=t)||ie},le=function(){return 0},Ae={},he=[],de={},pe={},fe={},ge=30,me=[],ve="",ye=function(e){var t,n,r=e[0];if(K(r)||Q(r)||(e=[e]),!(t=(r._gsap||{}).harness)){for(n=me.length;n--&&!me[n].targetTest(r););t=me[n]}for(n=e.length;n--;)e[n]&&(e[n]._gsap||(e[n]._gsap=new jt(e[n],t)))||e.splice(n,1);return e},_e=function(e){return e._gsap||ye(ct(e))[0]._gsap},Ee=function(e,t,n){return(n=e[t])&&Q(n)?e[t]():G(n)&&e.getAttribute&&e.getAttribute(t)||n},be=function(e,t){return(e=e.split(",")).forEach(t)||e},we=function(e){return Math.round(1e5*e)/1e5||0},Se=function(e){return Math.round(1e7*e)/1e7||0},Te=function(e,t){for(var n=t.length,r=0;e.indexOf(t[r])<0&&++r<n;);return r<n},Ce=function(){var e,t,n=he.length,r=he.slice(0);for(de={},he.length=0,e=0;e<n;e++)(t=r[e])&&t._lazy&&(t.render(t._lazy[0],t._lazy[1],!0)._lazy=0)},Re=function(e,t,n,r){he.length&&Ce(),e.render(t,n,r),he.length&&Ce()},Ie=function(e){var t=parseFloat(e);return(t||0===t)&&(e+"").match(ne).length<2?t:V(e)?e.trim():e},Oe=function(e){return e},xe=function(e,t){for(var n in t)n in e||(e[n]=t[n]);return e},Ne=function(e,t){for(var n in t)e[n]=t[n];return e},Be=function e(t,n){for(var r in n)"__proto__"!==r&&"constructor"!==r&&"prototype"!==r&&(t[r]=K(n[r])?e(t[r]||(t[r]={}),n[r]):n[r]);return t},Le=function(e,t){var n,r={};for(n in e)n in t||(r[n]=e[n]);return r},De=function(e){var t,n=e.parent||i,r=e.keyframes?(t=X(e.keyframes),function(e,n){for(var r in n)r in e||"duration"===r&&t||"ease"===r||(e[r]=n[r])}):xe;if(W(e.inherit))for(;n;)r(e,n.vars.defaults),n=n.parent||n._dp;return e},Me=function(e,t,n,r){void 0===n&&(n="_first"),void 0===r&&(r="_last");var i=t._prev,o=t._next;i?i._next=o:e[n]===t&&(e[n]=o),o?o._prev=i:e[r]===t&&(e[r]=i),t._next=t._prev=t.parent=null},Pe=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove(e),e._act=0},ke=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var n=e;n;)n._dirty=1,n=n.parent;return e},Ue=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},Fe=function e(t){return!t||t._ts&&e(t.parent)},He=function(e){return e._repeat?Ve(e._tTime,e=e.duration()+e._rDelay)*e:0},Ve=function(e,t){var n=Math.floor(e/=t);return e&&n===e?n-1:n},Qe=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},je=function(e){return e._end=Se(e._start+(e._tDur/Math.abs(e._ts||e._rts||D)||0))},Ge=function(e,t){var n=e._dp;return n&&n.smoothChildTiming&&e._ts&&(e._start=Se(n._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),je(e),n._dirty||ke(n,e)),e},Ke=function(e,t){var n;if((t._time||t._initted&&!t._dur)&&(n=Qe(e.rawTime(),t),(!t._dur||rt(0,t.totalDuration(),n)-t._tTime>D)&&t.render(n,!0)),ke(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(n=e;n._dp;)n.rawTime()>=0&&n.totalTime(n._tTime),n=n._dp;e._zTime=-1e-8}},We=function(e,t,n,r){return t.parent&&Pe(t),t._start=Se((j(n)?n:n||e!==i?et(e,n,t):e._time)+t._delay),t._end=Se(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),function(e,t,n,r,i){void 0===n&&(n="_first"),void 0===r&&(r="_last");var o,s=e[r];if(i)for(o=t[i];s&&s[i]>o;)s=s._prev;s?(t._next=s._next,s._next=t):(t._next=e[n],e[n]=t),t._next?t._next._prev=t:e[r]=t,t._prev=s,t.parent=t._dp=e}(e,t,"_first","_last",e._sort?"_start":0),Xe(t)||(e._recent=t),r||Ke(e,t),e},ze=function(e,t){return(ie.ScrollTrigger||ae("scrollTrigger",t))&&ie.ScrollTrigger.create(t,e)},qe=function(e,t,n,r){return Xt(e,t),e._initted?!n&&e._pt&&(e._dur&&!1!==e.vars.lazy||!e._dur&&e.vars.lazy)&&u!==xt.frame?(he.push(e),e._lazy=[t,r],1):void 0:1},Ye=function e(t){var n=t.parent;return n&&n._ts&&n._initted&&!n._lock&&(n.rawTime()<0||e(n))},Xe=function(e){var t=e.data;return"isFromStart"===t||"isStart"===t},Je=function(e,t,n,r){var i=e._repeat,o=Se(t)||0,s=e._tTime/e._tDur;return s&&!r&&(e._time*=o/e._dur),e._dur=o,e._tDur=i?i<0?1e10:Se(o*(i+1)+e._rDelay*i):o,s>0&&!r?Ge(e,e._tTime=e._tDur*s):e.parent&&je(e),n||ke(e.parent,e),e},Ze=function(e){return e instanceof Kt?ke(e):Je(e,e._dur)},$e={_start:0,endTime:le,totalDuration:le},et=function e(t,n,r){var i,o,s,a=t.labels,c=t._recent||$e,u=t.duration()>=L?c.endTime(!1):t._dur;return V(n)&&(isNaN(n)||n in a)?(o=n.charAt(0),s="%"===n.substr(-1),i=n.indexOf("="),"<"===o||">"===o?(i>=0&&(n=n.replace(/=/,"")),("<"===o?c._start:c.endTime(c._repeat>=0))+(parseFloat(n.substr(1))||0)*(s?(i<0?c:r).totalDuration()/100:1)):i<0?(n in a||(a[n]=u),a[n]):(o=parseFloat(n.charAt(i-1)+n.substr(i+1)),s&&r&&(o=o/100*(X(r)?r[0]:r).totalDuration()),i>1?e(t,n.substr(0,i-1),r)+o:u+o)):null==n?u:+n},tt=function(e,t,n){var r,i,o=j(t[1]),s=(o?2:1)+(e<2?0:1),a=t[s];if(o&&(a.duration=t[1]),a.parent=n,e){for(r=a,i=n;i&&!("immediateRender"in r);)r=i.vars.defaults||{},i=W(i.vars.inherit)&&i.parent;a.immediateRender=W(r.immediateRender),e<2?a.runBackwards=1:a.startAt=t[s-1]}return new tn(t[0],a,t[s+1])},nt=function(e,t){return e||0===e?t(e):t},rt=function(e,t,n){return n<e?e:n>t?t:n},it=function(e,t){return V(e)&&(t=re.exec(e))?e.substr(t.index+t[0].length):""},ot=[].slice,st=function(e,t){return e&&K(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&K(e[0]))&&!e.nodeType&&e!==o},at=function(e,t,n){return void 0===n&&(n=[]),e.forEach((function(e){var r;return V(e)&&!t||st(e,1)?(r=n).push.apply(r,ct(e)):n.push(e)}))||n},ct=function(e,t,n){return!V(e)||n||!s&&Nt()?X(e)?at(e,n):st(e)?ot.call(e,0):e?[e]:[]:ot.call((t||a).querySelectorAll(e),0)},ut=function(e){return e.sort((function(){return.5-Math.random()}))},lt=function(e){if(Q(e))return e;var t=K(e)?e:{each:e},n=Ut(t.ease),r=t.from||0,i=parseFloat(t.base)||0,o={},s=r>0&&r<1,a=isNaN(r)||s,c=t.axis,u=r,l=r;return V(r)?u=l={center:.5,edges:.5,end:1}[r]||0:!s&&a&&(u=r[0],l=r[1]),function(e,s,A){var h,d,p,f,g,m,v,y,_,E=(A||t).length,b=o[E];if(!b){if(!(_="auto"===t.grid?0:(t.grid||[1,L])[1])){for(v=-L;v<(v=A[_++].getBoundingClientRect().left)&&_<E;);_--}for(b=o[E]=[],h=a?Math.min(_,E)*u-.5:r%_,d=_===L?0:a?E*l/_-.5:r/_|0,v=0,y=L,m=0;m<E;m++)p=m%_-h,f=d-(m/_|0),b[m]=g=c?Math.abs("y"===c?f:p):U(p*p+f*f),g>v&&(v=g),g<y&&(y=g);"random"===r&&ut(b),b.max=v-y,b.min=y,b.v=E=(parseFloat(t.amount)||parseFloat(t.each)*(_>E?E-1:c?"y"===c?E/_:_:Math.max(_,E/_))||0)*("edges"===r?-1:1),b.b=E<0?i-E:i,b.u=it(t.amount||t.each)||0,n=n&&E<0?Pt(n):n}return E=(b[e]-b.min)/b.max||0,Se(b.b+(n?n(E):E)*b.v)+b.u}},At=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(n){var r=Math.round(parseFloat(n)/e)*e*t;return(r-r%1)/t+(j(n)?0:it(n))}},ht=function(e,t){var n,r,i=X(e);return!i&&K(e)&&(n=i=e.radius||L,e.values?(e=ct(e.values),(r=!j(e[0]))&&(n*=n)):e=At(e.increment)),nt(t,i?Q(e)?function(t){return r=e(t),Math.abs(r-t)<=n?r:t}:function(t){for(var i,o,s=parseFloat(r?t.x:t),a=parseFloat(r?t.y:0),c=L,u=0,l=e.length;l--;)(i=r?(i=e[l].x-s)*i+(o=e[l].y-a)*o:Math.abs(e[l]-s))<c&&(c=i,u=l);return u=!n||c<=n?e[u]:t,r||u===t||j(t)?u:u+it(t)}:At(e))},dt=function(e,t,n,r){return nt(X(e)?!t:!0===n?!!(n=0):!r,(function(){return X(e)?e[~~(Math.random()*e.length)]:(n=n||1e-5)&&(r=n<1?Math.pow(10,(n+"").length-2):1)&&Math.floor(Math.round((e-n/2+Math.random()*(t-e+.99*n))/n)*n*r)/r}))},pt=function(e,t,n){return nt(n,(function(n){return e[~~t(n)]}))},ft=function(e){for(var t,n,r,i,o=0,s="";~(t=e.indexOf("random(",o));)r=e.indexOf(")",t),i="["===e.charAt(t+7),n=e.substr(t+7,r-t-7).match(i?ne:J),s+=e.substr(o,t-o)+dt(i?n:+n[0],i?0:+n[1],+n[2]||1e-5),o=r+1;return s+e.substr(o,e.length-o)},gt=function(e,t,n,r,i){var o=t-e,s=r-n;return nt(i,(function(t){return n+((t-e)/o*s||0)}))},mt=function(e,t,n){var r,i,o,s=e.labels,a=L;for(r in s)(i=s[r]-t)<0==!!n&&i&&a>(i=Math.abs(i))&&(o=r,a=i);return o},vt=function(e,t,n){var r,i,o=e.vars,s=o[t];if(s)return r=o[t+"Params"],i=o.callbackScope||e,n&&he.length&&Ce(),r?s.apply(i,r):s.call(i)},yt=function(e){return Pe(e),e.scrollTrigger&&e.scrollTrigger.kill(!1),e.progress()<1&&vt(e,"onInterrupt"),e},_t=function(e){var t=(e=!e.name&&e.default||e).name,n=Q(e),r=t&&!n&&e.init?function(){this._props=[]}:e,i={init:le,render:An,add:qt,kill:dn,modifier:hn,rawVars:0},o={targetTest:0,get:0,getSetter:an,aliases:{},register:0};if(Nt(),e!==r){if(pe[t])return;xe(r,xe(Le(e,i),o)),Ne(r.prototype,Ne(i,Le(e,o))),pe[r.prop=t]=r,e.targetTest&&(me.push(r),Ae[t]=1),t=("css"===t?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}ue(t,r),e.register&&e.register(_n,r,gn)},Et=255,bt={aqua:[0,Et,Et],lime:[0,Et,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,Et],navy:[0,0,128],white:[Et,Et,Et],olive:[128,128,0],yellow:[Et,Et,0],orange:[Et,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[Et,0,0],pink:[Et,192,203],cyan:[0,Et,Et],transparent:[Et,Et,Et,0]},wt=function(e,t,n){return(6*(e+=e<0?1:e>1?-1:0)<1?t+(n-t)*e*6:e<.5?n:3*e<2?t+(n-t)*(2/3-e)*6:t)*Et+.5|0},St=function(e,t,n){var r,i,o,s,a,c,u,l,A,h,d=e?j(e)?[e>>16,e>>8&Et,e&Et]:0:bt.black;if(!d){if(","===e.substr(-1)&&(e=e.substr(0,e.length-1)),bt[e])d=bt[e];else if("#"===e.charAt(0)){if(e.length<6&&(r=e.charAt(1),i=e.charAt(2),o=e.charAt(3),e="#"+r+r+i+i+o+o+(5===e.length?e.charAt(4)+e.charAt(4):"")),9===e.length)return[(d=parseInt(e.substr(1,6),16))>>16,d>>8&Et,d&Et,parseInt(e.substr(7),16)/255];d=[(e=parseInt(e.substr(1),16))>>16,e>>8&Et,e&Et]}else if("hsl"===e.substr(0,3))if(d=h=e.match(J),t){if(~e.indexOf("="))return d=e.match(Z),n&&d.length<4&&(d[3]=1),d}else s=+d[0]%360/360,a=+d[1]/100,r=2*(c=+d[2]/100)-(i=c<=.5?c*(a+1):c+a-c*a),d.length>3&&(d[3]*=1),d[0]=wt(s+1/3,r,i),d[1]=wt(s,r,i),d[2]=wt(s-1/3,r,i);else d=e.match(J)||bt.transparent;d=d.map(Number)}return t&&!h&&(r=d[0]/Et,i=d[1]/Et,o=d[2]/Et,c=((u=Math.max(r,i,o))+(l=Math.min(r,i,o)))/2,u===l?s=a=0:(A=u-l,a=c>.5?A/(2-u-l):A/(u+l),s=u===r?(i-o)/A+(i<o?6:0):u===i?(o-r)/A+2:(r-i)/A+4,s*=60),d[0]=~~(s+.5),d[1]=~~(100*a+.5),d[2]=~~(100*c+.5)),n&&d.length<4&&(d[3]=1),d},Tt=function(e){var t=[],n=[],r=-1;return e.split(Rt).forEach((function(e){var i=e.match($)||[];t.push.apply(t,i),n.push(r+=i.length+1)})),t.c=n,t},Ct=function(e,t,n){var r,i,o,s,a="",c=(e+a).match(Rt),u=t?"hsla(":"rgba(",l=0;if(!c)return e;if(c=c.map((function(e){return(e=St(e,t,1))&&u+(t?e[0]+","+e[1]+"%,"+e[2]+"%,"+e[3]:e.join(","))+")"})),n&&(o=Tt(e),(r=n.c).join(a)!==o.c.join(a)))for(s=(i=e.replace(Rt,"1").split($)).length-1;l<s;l++)a+=i[l]+(~r.indexOf(l)?c.shift()||u+"0,0,0,0)":(o.length?o:c.length?c:n).shift());if(!i)for(s=(i=e.split(Rt)).length-1;l<s;l++)a+=i[l]+c[l];return a+i[s]},Rt=function(){var e,t="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b";for(e in bt)t+="|"+e+"\\b";return new RegExp(t+")","gi")}(),It=/hsl[a]?\(/,Ot=function(e){var t,n=e.join(" ");if(Rt.lastIndex=0,Rt.test(n))return t=It.test(n),e[1]=Ct(e[1],t),e[0]=Ct(e[0],t,Tt(e[1])),!0},xt=(v=Date.now,y=500,_=33,E=v(),b=E,S=w=1e3/240,C=function e(t){var n,r,i,o,s=v()-b,a=!0===t;if(s>y&&(E+=s-_),((n=(i=(b+=s)-E)-S)>0||a)&&(o=++f.frame,g=i-1e3*f.time,f.time=i/=1e3,S+=n+(n>=w?4:w-n),r=1),a||(h=d(e)),r)for(m=0;m<T.length;m++)T[m](i,g,o,t)},f={time:0,frame:0,tick:function(){C(!0)},deltaRatio:function(e){return g/(1e3/(e||60))},wake:function(){c&&(!s&&z()&&(o=s=window,a=o.document||{},ie.gsap=_n,(o.gsapVersions||(o.gsapVersions=[])).push(_n.version),se(oe||o.GreenSockGlobals||!o.gsap&&o||{}),p=o.requestAnimationFrame),h&&f.sleep(),d=p||function(e){return setTimeout(e,S-1e3*f.time+1|0)},A=1,C(2))},sleep:function(){(p?o.cancelAnimationFrame:clearTimeout)(h),A=0,d=le},lagSmoothing:function(e,t){y=e||1e8,_=Math.min(t,y,0)},fps:function(e){w=1e3/(e||240),S=1e3*f.time+w},add:function(e){T.indexOf(e)<0&&T.push(e),Nt()},remove:function(e,t){~(t=T.indexOf(e))&&T.splice(t,1)&&m>=t&&m--},_listeners:T=[]}),Nt=function(){return!A&&xt.wake()},Bt={},Lt=/^[\d.\-M][\d.\-,\s]/,Dt=/["']/g,Mt=function(e){for(var t,n,r,i={},o=e.substr(1,e.length-3).split(":"),s=o[0],a=1,c=o.length;a<c;a++)n=o[a],t=a!==c-1?n.lastIndexOf(","):n.length,r=n.substr(0,t),i[s]=isNaN(r)?r.replace(Dt,"").trim():+r,s=n.substr(t+1).trim();return i},Pt=function(e){return function(t){return 1-e(1-t)}},kt=function e(t,n){for(var r,i=t._first;i;)i instanceof Kt?e(i,n):!i.vars.yoyoEase||i._yoyo&&i._repeat||i._yoyo===n||(i.timeline?e(i.timeline,n):(r=i._ease,i._ease=i._yEase,i._yEase=r,i._yoyo=n)),i=i._next},Ut=function(e,t){return e&&(Q(e)?e:Bt[e]||function(e){var t,n,r,i,o=(e+"").split("("),s=Bt[o[0]];return s&&o.length>1&&s.config?s.config.apply(null,~e.indexOf("{")?[Mt(o[1])]:(t=e,n=t.indexOf("(")+1,r=t.indexOf(")"),i=t.indexOf("(",n),t.substring(n,~i&&i<r?t.indexOf(")",r+1):r)).split(",").map(Ie)):Bt._CE&&Lt.test(e)?Bt._CE("",e):s}(e))||t},Ft=function(e,t,n,r){void 0===n&&(n=function(e){return 1-t(1-e)}),void 0===r&&(r=function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2});var i,o={easeIn:t,easeOut:n,easeInOut:r};return be(e,(function(e){for(var t in Bt[e]=ie[e]=o,Bt[i=e.toLowerCase()]=n,o)Bt[i+("easeIn"===t?".in":"easeOut"===t?".out":".inOut")]=Bt[e+"."+t]=o[t]})),o},Ht=function(e){return function(t){return t<.5?(1-e(1-2*t))/2:.5+e(2*(t-.5))/2}},Vt=function e(t,n,r){var i=n>=1?n:1,o=(r||(t?.3:.45))/(n<1?n:1),s=o/M*(Math.asin(1/i)||0),a=function(e){return 1===e?1:i*Math.pow(2,-10*e)*H((e-s)*o)+1},c="out"===t?a:"in"===t?function(e){return 1-a(1-e)}:Ht(a);return o=M/o,c.config=function(n,r){return e(t,n,r)},c},Qt=function e(t,n){void 0===n&&(n=1.70158);var r=function(e){return e?--e*e*((n+1)*e+n)+1:0},i="out"===t?r:"in"===t?function(e){return 1-r(1-e)}:Ht(r);return i.config=function(n){return e(t,n)},i};be("Linear,Quad,Cubic,Quart,Quint,Strong",(function(e,t){var n=t<5?t+1:t;Ft(e+",Power"+(n-1),t?function(e){return Math.pow(e,n)}:function(e){return e},(function(e){return 1-Math.pow(1-e,n)}),(function(e){return e<.5?Math.pow(2*e,n)/2:1-Math.pow(2*(1-e),n)/2}))})),Bt.Linear.easeNone=Bt.none=Bt.Linear.easeIn,Ft("Elastic",Vt("in"),Vt("out"),Vt()),R=7.5625,O=1/(I=2.75),Ft("Bounce",(function(e){return 1-x(1-e)}),x=function(e){return e<O?R*e*e:e<.7272727272727273?R*Math.pow(e-1.5/I,2)+.75:e<.9090909090909092?R*(e-=2.25/I)*e+.9375:R*Math.pow(e-2.625/I,2)+.984375}),Ft("Expo",(function(e){return e?Math.pow(2,10*(e-1)):0})),Ft("Circ",(function(e){return-(U(1-e*e)-1)})),Ft("Sine",(function(e){return 1===e?1:1-F(e*P)})),Ft("Back",Qt("in"),Qt("out"),Qt()),Bt.SteppedEase=Bt.steps=ie.SteppedEase={config:function(e,t){void 0===e&&(e=1);var n=1/e,r=e+(t?0:1),i=t?1:0;return function(e){return((r*rt(0,.99999999,e)|0)+i)*n}}},B.ease=Bt["quad.out"],be("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",(function(e){return ve+=e+","+e+"Params,"}));var jt=function(e,t){this.id=k++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:Ee,this.set=t?t.getSetter:an},Gt=function(){function e(e){this.vars=e,this._delay=+e.delay||0,(this._repeat=e.repeat===1/0?-2:e.repeat||0)&&(this._rDelay=e.repeatDelay||0,this._yoyo=!!e.yoyo||!!e.yoyoEase),this._ts=1,Je(this,+e.duration,1,1),this.data=e.data,A||xt.wake()}var t=e.prototype;return t.delay=function(e){return e||0===e?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+e-this._delay),this._delay=e,this):this._delay},t.duration=function(e){return arguments.length?this.totalDuration(this._repeat>0?e+(e+this._rDelay)*this._repeat:e):this.totalDuration()&&this._dur},t.totalDuration=function(e){return arguments.length?(this._dirty=0,Je(this,this._repeat<0?e:(e-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},t.totalTime=function(e,t){if(Nt(),!arguments.length)return this._tTime;var n=this._dp;if(n&&n.smoothChildTiming&&this._ts){for(Ge(this,e),!n._dp||n.parent||Ke(n,this);n&&n.parent;)n.parent._time!==n._start+(n._ts>=0?n._tTime/n._ts:(n.totalDuration()-n._tTime)/-n._ts)&&n.totalTime(n._tTime,!0),n=n.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&e<this._tDur||this._ts<0&&e>0||!this._tDur&&!e)&&We(this._dp,this,this._start-this._delay)}return(this._tTime!==e||!this._dur&&!t||this._initted&&Math.abs(this._zTime)===D||!e&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=e),Re(this,e,t)),this},t.time=function(e,t){return arguments.length?this.totalTime(Math.min(this.totalDuration(),e+He(this))%(this._dur+this._rDelay)||(e?this._dur:0),t):this._time},t.totalProgress=function(e,t){return arguments.length?this.totalTime(this.totalDuration()*e,t):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},t.progress=function(e,t){return arguments.length?this.totalTime(this.duration()*(!this._yoyo||1&this.iteration()?e:1-e)+He(this),t):this.duration()?Math.min(1,this._time/this._dur):this.ratio},t.iteration=function(e,t){var n=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(e-1)*n,t):this._repeat?Ve(this._tTime,n)+1:1},t.timeScale=function(e){if(!arguments.length)return-1e-8===this._rts?0:this._rts;if(this._rts===e)return this;var t=this.parent&&this._ts?Qe(this.parent._time,this):this._tTime;return this._rts=+e||0,this._ts=this._ps||-1e-8===e?0:this._rts,Ue(this.totalTime(rt(-this._delay,this._tDur,t),!0)),je(this),this},t.paused=function(e){return arguments.length?(this._ps!==e&&(this._ps=e,e?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(Nt(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,1===this.progress()&&Math.abs(this._zTime)!==D&&(this._tTime-=D)))),this):this._ps},t.startTime=function(e){if(arguments.length){this._start=e;var t=this.parent||this._dp;return t&&(t._sort||!this.parent)&&We(t,this,e-this._delay),this}return this._start},t.endTime=function(e){return this._start+(W(e)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},t.rawTime=function(e){var t=this.parent||this._dp;return t?e&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?Qe(t.rawTime(e),this):this._tTime:this._tTime},t.globalTime=function(e){for(var t=this,n=arguments.length?e:t.rawTime();t;)n=t._start+n/(t._ts||1),t=t._dp;return n},t.repeat=function(e){return arguments.length?(this._repeat=e===1/0?-2:e,Ze(this)):-2===this._repeat?1/0:this._repeat},t.repeatDelay=function(e){if(arguments.length){var t=this._time;return this._rDelay=e,Ze(this),t?this.time(t):this}return this._rDelay},t.yoyo=function(e){return arguments.length?(this._yoyo=e,this):this._yoyo},t.seek=function(e,t){return this.totalTime(et(this,e),W(t))},t.restart=function(e,t){return this.play().totalTime(e?-this._delay:0,W(t))},t.play=function(e,t){return null!=e&&this.seek(e,t),this.reversed(!1).paused(!1)},t.reverse=function(e,t){return null!=e&&this.seek(e||this.totalDuration(),t),this.reversed(!0).paused(!1)},t.pause=function(e,t){return null!=e&&this.seek(e,t),this.paused(!0)},t.resume=function(){return this.paused(!1)},t.reversed=function(e){return arguments.length?(!!e!==this.reversed()&&this.timeScale(-this._rts||(e?-1e-8:0)),this):this._rts<0},t.invalidate=function(){return this._initted=this._act=0,this._zTime=-1e-8,this},t.isActive=function(){var e,t=this.parent||this._dp,n=this._start;return!(t&&!(this._ts&&this._initted&&t.isActive()&&(e=t.rawTime(!0))>=n&&e<this.endTime(!0)-D))},t.eventCallback=function(e,t,n){var r=this.vars;return arguments.length>1?(t?(r[e]=t,n&&(r[e+"Params"]=n),"onUpdate"===e&&(this._onUpdate=t)):delete r[e],this):r[e]},t.then=function(e){var t=this;return new Promise((function(n){var r=Q(e)?e:Oe,i=function(){var e=t.then;t.then=null,Q(r)&&(r=r(t))&&(r.then||r===t)&&(t.then=e),n(r),t.then=e};t._initted&&1===t.totalProgress()&&t._ts>=0||!t._tTime&&t._ts<0?i():t._prom=i}))},t.kill=function(){yt(this)},e}();xe(Gt.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-1e-8,_prom:0,_ps:!1,_rts:1});var Kt=function(e){function r(t,r){var o;return void 0===t&&(t={}),(o=e.call(this,t)||this).labels={},o.smoothChildTiming=!!t.smoothChildTiming,o.autoRemoveChildren=!!t.autoRemoveChildren,o._sort=W(t.sortChildren),i&&We(t.parent||i,n(o),r),t.reversed&&o.reverse(),t.paused&&o.paused(!0),t.scrollTrigger&&ze(n(o),t.scrollTrigger),o}t(r,e);var o=r.prototype;return o.to=function(e,t,n){return tt(0,arguments,this),this},o.from=function(e,t,n){return tt(1,arguments,this),this},o.fromTo=function(e,t,n,r){return tt(2,arguments,this),this},o.set=function(e,t,n){return t.duration=0,t.parent=this,De(t).repeatDelay||(t.repeat=0),t.immediateRender=!!t.immediateRender,new tn(e,t,et(this,n),1),this},o.call=function(e,t,n){return We(this,tn.delayedCall(0,e,t),n)},o.staggerTo=function(e,t,n,r,i,o,s){return n.duration=t,n.stagger=n.stagger||r,n.onComplete=o,n.onCompleteParams=s,n.parent=this,new tn(e,n,et(this,i)),this},o.staggerFrom=function(e,t,n,r,i,o,s){return n.runBackwards=1,De(n).immediateRender=W(n.immediateRender),this.staggerTo(e,t,n,r,i,o,s)},o.staggerFromTo=function(e,t,n,r,i,o,s,a){return r.startAt=n,De(r).immediateRender=W(r.immediateRender),this.staggerTo(e,t,r,i,o,s,a)},o.render=function(e,t,n){var r,o,s,a,c,u,l,A,h,d,p,f,g=this._time,m=this._dirty?this.totalDuration():this._tDur,v=this._dur,y=e<=0?0:Se(e),_=this._zTime<0!=e<0&&(this._initted||!v);if(this!==i&&y>m&&e>=0&&(y=m),y!==this._tTime||n||_){if(g!==this._time&&v&&(y+=this._time-g,e+=this._time-g),r=y,h=this._start,u=!(A=this._ts),_&&(v||(g=this._zTime),(e||!t)&&(this._zTime=e)),this._repeat){if(p=this._yoyo,c=v+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*c+e,t,n);if(r=Se(y%c),y===m?(a=this._repeat,r=v):((a=~~(y/c))&&a===y/c&&(r=v,a--),r>v&&(r=v)),d=Ve(this._tTime,c),!g&&this._tTime&&d!==a&&(d=a),p&&1&a&&(r=v-r,f=1),a!==d&&!this._lock){var E=p&&1&d,b=E===(p&&1&a);if(a<d&&(E=!E),g=E?0:v,this._lock=1,this.render(g||(f?0:Se(a*c)),t,!v)._lock=0,this._tTime=y,!t&&this.parent&&vt(this,"onRepeat"),this.vars.repeatRefresh&&!f&&(this.invalidate()._lock=1),g&&g!==this._time||u!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(v=this._dur,m=this._tDur,b&&(this._lock=2,g=E?v:-1e-4,this.render(g,!0),this.vars.repeatRefresh&&!f&&this.invalidate()),this._lock=0,!this._ts&&!u)return this;kt(this,f)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(l=function(e,t,n){var r;if(n>t)for(r=e._first;r&&r._start<=n;){if("isPause"===r.data&&r._start>t)return r;r=r._next}else for(r=e._last;r&&r._start>=n;){if("isPause"===r.data&&r._start<t)return r;r=r._prev}}(this,Se(g),Se(r)),l&&(y-=r-(r=l._start))),this._tTime=y,this._time=r,this._act=!A,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=e,g=0),!g&&r&&!t&&(vt(this,"onStart"),this._tTime!==y))return this;if(r>=g&&e>=0)for(o=this._first;o;){if(s=o._next,(o._act||r>=o._start)&&o._ts&&l!==o){if(o.parent!==this)return this.render(e,t,n);if(o.render(o._ts>0?(r-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(r-o._start)*o._ts,t,n),r!==this._time||!this._ts&&!u){l=0,s&&(y+=this._zTime=-1e-8);break}}o=s}else{o=this._last;for(var w=e<0?e:r;o;){if(s=o._prev,(o._act||w<=o._end)&&o._ts&&l!==o){if(o.parent!==this)return this.render(e,t,n);if(o.render(o._ts>0?(w-o._start)*o._ts:(o._dirty?o.totalDuration():o._tDur)+(w-o._start)*o._ts,t,n),r!==this._time||!this._ts&&!u){l=0,s&&(y+=this._zTime=w?-1e-8:D);break}}o=s}}if(l&&!t&&(this.pause(),l.render(r>=g?0:-1e-8)._zTime=r>=g?1:-1,this._ts))return this._start=h,je(this),this.render(e,t,n);this._onUpdate&&!t&&vt(this,"onUpdate",!0),(y===m&&m>=this.totalDuration()||!y&&g)&&(h!==this._start&&Math.abs(A)===Math.abs(this._ts)||this._lock||((e||!v)&&(y===m&&this._ts>0||!y&&this._ts<0)&&Pe(this,1),t||e<0&&!g||!y&&!g&&m||(vt(this,y===m&&e>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(y<m&&this.timeScale()>0)&&this._prom())))}return this},o.add=function(e,t){var n=this;if(j(t)||(t=et(this,t,e)),!(e instanceof Gt)){if(X(e))return e.forEach((function(e){return n.add(e,t)})),this;if(V(e))return this.addLabel(e,t);if(!Q(e))return this;e=tn.delayedCall(0,e)}return this!==e?We(this,e,t):this},o.getChildren=function(e,t,n,r){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===r&&(r=-L);for(var i=[],o=this._first;o;)o._start>=r&&(o instanceof tn?t&&i.push(o):(n&&i.push(o),e&&i.push.apply(i,o.getChildren(!0,t,n)))),o=o._next;return i},o.getById=function(e){for(var t=this.getChildren(1,1,1),n=t.length;n--;)if(t[n].vars.id===e)return t[n]},o.remove=function(e){return V(e)?this.removeLabel(e):Q(e)?this.killTweensOf(e):(Me(this,e),e===this._recent&&(this._recent=this._last),ke(this))},o.totalTime=function(t,n){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=Se(xt.time-(this._ts>0?t/this._ts:(this.totalDuration()-t)/-this._ts))),e.prototype.totalTime.call(this,t,n),this._forcing=0,this):this._tTime},o.addLabel=function(e,t){return this.labels[e]=et(this,t),this},o.removeLabel=function(e){return delete this.labels[e],this},o.addPause=function(e,t,n){var r=tn.delayedCall(0,t||le,n);return r.data="isPause",this._hasPause=1,We(this,r,et(this,e))},o.removePause=function(e){var t=this._first;for(e=et(this,e);t;)t._start===e&&"isPause"===t.data&&Pe(t),t=t._next},o.killTweensOf=function(e,t,n){for(var r=this.getTweensOf(e,n),i=r.length;i--;)Wt!==r[i]&&r[i].kill(e,t);return this},o.getTweensOf=function(e,t){for(var n,r=[],i=ct(e),o=this._first,s=j(t);o;)o instanceof tn?Te(o._targets,i)&&(s?(!Wt||o._initted&&o._ts)&&o.globalTime(0)<=t&&o.globalTime(o.totalDuration())>t:!t||o.isActive())&&r.push(o):(n=o.getTweensOf(i,t)).length&&r.push.apply(r,n),o=o._next;return r},o.tweenTo=function(e,t){t=t||{};var n,r=this,i=et(r,e),o=t,s=o.startAt,a=o.onStart,c=o.onStartParams,u=o.immediateRender,l=tn.to(r,xe({ease:t.ease||"none",lazy:!1,immediateRender:!1,time:i,overwrite:"auto",duration:t.duration||Math.abs((i-(s&&"time"in s?s.time:r._time))/r.timeScale())||D,onStart:function(){if(r.pause(),!n){var e=t.duration||Math.abs((i-(s&&"time"in s?s.time:r._time))/r.timeScale());l._dur!==e&&Je(l,e,0,1).render(l._time,!0,!0),n=1}a&&a.apply(l,c||[])}},t));return u?l.render(0):l},o.tweenFromTo=function(e,t,n){return this.tweenTo(t,xe({startAt:{time:et(this,e)}},n))},o.recent=function(){return this._recent},o.nextLabel=function(e){return void 0===e&&(e=this._time),mt(this,et(this,e))},o.previousLabel=function(e){return void 0===e&&(e=this._time),mt(this,et(this,e),1)},o.currentLabel=function(e){return arguments.length?this.seek(e,!0):this.previousLabel(this._time+D)},o.shiftChildren=function(e,t,n){void 0===n&&(n=0);for(var r,i=this._first,o=this.labels;i;)i._start>=n&&(i._start+=e,i._end+=e),i=i._next;if(t)for(r in o)o[r]>=n&&(o[r]+=e);return ke(this)},o.invalidate=function(){var t=this._first;for(this._lock=0;t;)t.invalidate(),t=t._next;return e.prototype.invalidate.call(this)},o.clear=function(e){void 0===e&&(e=!0);for(var t,n=this._first;n;)t=n._next,this.remove(n),n=t;return this._dp&&(this._time=this._tTime=this._pTime=0),e&&(this.labels={}),ke(this)},o.totalDuration=function(e){var t,n,r,o=0,s=this,a=s._last,c=L;if(arguments.length)return s.timeScale((s._repeat<0?s.duration():s.totalDuration())/(s.reversed()?-e:e));if(s._dirty){for(r=s.parent;a;)t=a._prev,a._dirty&&a.totalDuration(),(n=a._start)>c&&s._sort&&a._ts&&!s._lock?(s._lock=1,We(s,a,n-a._delay,1)._lock=0):c=n,n<0&&a._ts&&(o-=n,(!r&&!s._dp||r&&r.smoothChildTiming)&&(s._start+=n/s._ts,s._time-=n,s._tTime-=n),s.shiftChildren(-n,!1,-Infinity),c=0),a._end>o&&a._ts&&(o=a._end),a=t;Je(s,s===i&&s._time>o?s._time:o,1,1),s._dirty=0}return s._tDur},r.updateRoot=function(e){if(i._ts&&(Re(i,Qe(e,i)),u=xt.frame),xt.frame>=ge){ge+=N.autoSleep||120;var t=i._first;if((!t||!t._ts)&&N.autoSleep&&xt._listeners.length<2){for(;t&&!t._ts;)t=t._next;t||xt.sleep()}}},r}(Gt);xe(Kt.prototype,{_lock:0,_hasPause:0,_forcing:0});var Wt,zt=function(e,t,n,r,i,o,s){var a,c,u,l,A,h,d,p,f=new gn(this._pt,e,t,0,1,ln,null,i),g=0,m=0;for(f.b=n,f.e=r,n+="",(d=~(r+="").indexOf("random("))&&(r=ft(r)),o&&(o(p=[n,r],e,t),n=p[0],r=p[1]),c=n.match(ee)||[];a=ee.exec(r);)l=a[0],A=r.substring(g,a.index),u?u=(u+1)%5:"rgba("===A.substr(-5)&&(u=1),l!==c[m++]&&(h=parseFloat(c[m-1])||0,f._pt={_next:f._pt,p:A||1===m?A:",",s:h,c:"="===l.charAt(1)?parseFloat(l.substr(2))*("-"===l.charAt(0)?-1:1):parseFloat(l)-h,m:u&&u<4?Math.round:0},g=ee.lastIndex);return f.c=g<r.length?r.substring(g,r.length):"",f.fp=s,(te.test(r)||d)&&(f.e=0),this._pt=f,f},qt=function(e,t,n,r,i,o,s,a,c){Q(r)&&(r=r(i||0,e,o));var u,l=e[t],A="get"!==n?n:Q(l)?c?e[t.indexOf("set")||!Q(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():l,h=Q(l)?c?on:rn:nn;if(V(r)&&(~r.indexOf("random(")&&(r=ft(r)),"="===r.charAt(1)&&((u=parseFloat(A)+parseFloat(r.substr(2))*("-"===r.charAt(0)?-1:1)+(it(A)||0))||0===u)&&(r=u)),A!==r)return isNaN(A*r)||""===r?(!l&&!(t in e)&&ae(t,r),zt.call(this,e,t,A,r,h,a||N.stringFilter,c)):(u=new gn(this._pt,e,t,+A||0,r-(A||0),"boolean"==typeof l?un:cn,0,h),c&&(u.fp=c),s&&u.modifier(s,this,e),this._pt=u)},Yt=function(e,t,n,r,i,o){var s,a,c,u;if(pe[e]&&!1!==(s=new pe[e]).init(i,s.rawVars?t[e]:function(e,t,n,r,i){if(Q(e)&&(e=Zt(e,i,t,n,r)),!K(e)||e.style&&e.nodeType||X(e)||Y(e))return V(e)?Zt(e,i,t,n,r):e;var o,s={};for(o in e)s[o]=Zt(e[o],i,t,n,r);return s}(t[e],r,i,o,n),n,r,o)&&(n._pt=a=new gn(n._pt,i,e,0,1,s.render,s,0,s.priority),n!==l))for(c=n._ptLookup[n._targets.indexOf(i)],u=s._props.length;u--;)c[s._props[u]]=a;return s},Xt=function e(t,n){var o,s,a,c,u,l,A,h,d,p,f,g,m,v=t.vars,y=v.ease,_=v.startAt,E=v.immediateRender,b=v.lazy,w=v.onUpdate,S=v.onUpdateParams,T=v.callbackScope,C=v.runBackwards,R=v.yoyoEase,I=v.keyframes,O=v.autoRevert,x=t._dur,N=t._startAt,M=t._targets,P=t.parent,k=P&&"nested"===P.data?P.parent._targets:M,U="auto"===t._overwrite&&!r,F=t.timeline;if(F&&(!I||!y)&&(y="none"),t._ease=Ut(y,B.ease),t._yEase=R?Pt(Ut(!0===R?y:R,B.ease)):0,R&&t._yoyo&&!t._repeat&&(R=t._yEase,t._yEase=t._ease,t._ease=R),t._from=!F&&!!v.runBackwards,!F||I&&!v.stagger){if(g=(h=M[0]?_e(M[0]).harness:0)&&v[h.prop],o=Le(v,Ae),N&&Pe(N.render(-1,!0)),_)if(Pe(t._startAt=tn.set(M,xe({data:"isStart",overwrite:!1,parent:P,immediateRender:!0,lazy:W(b),startAt:null,delay:0,onUpdate:w,onUpdateParams:S,callbackScope:T,stagger:0},_))),n<0&&!E&&!O&&t._startAt.render(-1,!0),E){if(n>0&&!O&&(t._startAt=0),x&&n<=0)return void(n&&(t._zTime=n))}else!1===O&&(t._startAt=0);else if(C&&x)if(N)!O&&(t._startAt=0);else if(n&&(E=!1),a=xe({overwrite:!1,data:"isFromStart",lazy:E&&W(b),immediateRender:E,stagger:0,parent:P},o),g&&(a[h.prop]=g),Pe(t._startAt=tn.set(M,a)),n<0&&t._startAt.render(-1,!0),t._zTime=n,E){if(!n)return}else e(t._startAt,D);for(t._pt=0,b=x&&W(b)||b&&!x,s=0;s<M.length;s++){if(A=(u=M[s])._gsap||ye(M)[s]._gsap,t._ptLookup[s]=p={},de[A.id]&&he.length&&Ce(),f=k===M?s:k.indexOf(u),h&&!1!==(d=new h).init(u,g||o,t,f,k)&&(t._pt=c=new gn(t._pt,u,d.name,0,1,d.render,d,0,d.priority),d._props.forEach((function(e){p[e]=c})),d.priority&&(l=1)),!h||g)for(a in o)pe[a]&&(d=Yt(a,o,t,f,u,k))?d.priority&&(l=1):p[a]=c=qt.call(t,u,a,"get",o[a],f,k,0,v.stringFilter);t._op&&t._op[s]&&t.kill(u,t._op[s]),U&&t._pt&&(Wt=t,i.killTweensOf(u,p,t.globalTime(n)),m=!t.parent,Wt=0),t._pt&&b&&(de[A.id]=1)}l&&fn(t),t._onInit&&t._onInit(t)}t._onUpdate=w,t._initted=(!t._op||t._pt)&&!m,I&&n<=0&&F.render(L,!0,!0)},Jt=function(e,t,n,r){var i,o,s=t.ease||r||"power1.inOut";if(X(t))o=n[e]||(n[e]=[]),t.forEach((function(e,n){return o.push({t:n/(t.length-1)*100,v:e,e:s})}));else for(i in t)o=n[i]||(n[i]=[]),"ease"===i||o.push({t:parseFloat(e),v:t[i],e:s})},Zt=function(e,t,n,r,i){return Q(e)?e.call(t,n,r,i):V(e)&&~e.indexOf("random(")?ft(e):e},$t=ve+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase",en={};be($t+",id,stagger,delay,duration,paused,scrollTrigger",(function(e){return en[e]=1}));var tn=function(e){function o(t,o,s,a){var c;"number"==typeof o&&(s.duration=o,o=s,s=null);var u,l,A,h,d,p,f,g,m=(c=e.call(this,a?o:De(o))||this).vars,v=m.duration,y=m.delay,_=m.immediateRender,E=m.stagger,b=m.overwrite,w=m.keyframes,S=m.defaults,T=m.scrollTrigger,C=m.yoyoEase,R=o.parent||i,I=(X(t)||Y(t)?j(t[0]):"length"in o)?[t]:ct(t);if(c._targets=I.length?ye(I):ce("GSAP target "+t+" not found. https://greensock.com",!N.nullTargetWarn)||[],c._ptLookup=[],c._overwrite=b,w||E||q(v)||q(y)){if(o=c.vars,(u=c.timeline=new Kt({data:"nested",defaults:S||{}})).kill(),u.parent=u._dp=n(c),u._start=0,E||q(v)||q(y)){if(h=I.length,f=E&&lt(E),K(E))for(d in E)~$t.indexOf(d)&&(g||(g={}),g[d]=E[d]);for(l=0;l<h;l++)(A=Le(o,en)).stagger=0,C&&(A.yoyoEase=C),g&&Ne(A,g),p=I[l],A.duration=+Zt(v,n(c),l,p,I),A.delay=(+Zt(y,n(c),l,p,I)||0)-c._delay,!E&&1===h&&A.delay&&(c._delay=y=A.delay,c._start+=y,A.delay=0),u.to(p,A,f?f(l,p,I):0),u._ease=Bt.none;u.duration()?v=y=0:c.timeline=0}else if(w){De(xe(u.vars.defaults,{ease:"none"})),u._ease=Ut(w.ease||o.ease||"none");var O,x,B,L=0;if(X(w))w.forEach((function(e){return u.to(I,e,">")}));else{for(d in A={},w)"ease"===d||"easeEach"===d||Jt(d,w[d],A,w.easeEach);for(d in A)for(O=A[d].sort((function(e,t){return e.t-t.t})),L=0,l=0;l<O.length;l++)(B={ease:(x=O[l]).e,duration:(x.t-(l?O[l-1].t:0))/100*v})[d]=x.v,u.to(I,B,L),L+=B.duration;u.duration()<v&&u.to({},{duration:v-u.duration()})}}v||c.duration(v=u.duration())}else c.timeline=0;return!0!==b||r||(Wt=n(c),i.killTweensOf(I),Wt=0),We(R,n(c),s),o.reversed&&c.reverse(),o.paused&&c.paused(!0),(_||!v&&!w&&c._start===Se(R._time)&&W(_)&&Fe(n(c))&&"nested"!==R.data)&&(c._tTime=-1e-8,c.render(Math.max(0,-y))),T&&ze(n(c),T),c}t(o,e);var s=o.prototype;return s.render=function(e,t,n){var r,i,o,s,a,c,u,l,A,h=this._time,d=this._tDur,p=this._dur,f=e>d-D&&e>=0?d:e<D?0:e;if(p){if(f!==this._tTime||!e||n||!this._initted&&this._tTime||this._startAt&&this._zTime<0!=e<0){if(r=f,l=this.timeline,this._repeat){if(s=p+this._rDelay,this._repeat<-1&&e<0)return this.totalTime(100*s+e,t,n);if(r=Se(f%s),f===d?(o=this._repeat,r=p):((o=~~(f/s))&&o===f/s&&(r=p,o--),r>p&&(r=p)),(c=this._yoyo&&1&o)&&(A=this._yEase,r=p-r),a=Ve(this._tTime,s),r===h&&!n&&this._initted)return this;o!==a&&(l&&this._yEase&&kt(l,c),!this.vars.repeatRefresh||c||this._lock||(this._lock=n=1,this.render(Se(s*o),!0).invalidate()._lock=0))}if(!this._initted){if(qe(this,e<0?e:r,n,t))return this._tTime=0,this;if(p!==this._dur)return this.render(e,t,n)}if(this._tTime=f,this._time=r,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=u=(A||this._ease)(r/p),this._from&&(this.ratio=u=1-u),r&&!h&&!t&&(vt(this,"onStart"),this._tTime!==f))return this;for(i=this._pt;i;)i.r(u,i.d),i=i._next;l&&l.render(e<0?e:!r&&c?-1e-8:l._dur*l._ease(r/this._dur),t,n)||this._startAt&&(this._zTime=e),this._onUpdate&&!t&&(e<0&&this._startAt&&this._startAt.render(e,!0,n),vt(this,"onUpdate")),this._repeat&&o!==a&&this.vars.onRepeat&&!t&&this.parent&&vt(this,"onRepeat"),f!==this._tDur&&f||this._tTime!==f||(e<0&&this._startAt&&!this._onUpdate&&this._startAt.render(e,!0,!0),(e||!p)&&(f===this._tDur&&this._ts>0||!f&&this._ts<0)&&Pe(this,1),t||e<0&&!h||!f&&!h||(vt(this,f===d?"onComplete":"onReverseComplete",!0),this._prom&&!(f<d&&this.timeScale()>0)&&this._prom()))}}else!function(e,t,n,r){var i,o,s,a=e.ratio,c=t<0||!t&&(!e._start&&Ye(e)&&(e._initted||!Xe(e))||(e._ts<0||e._dp._ts<0)&&!Xe(e))?0:1,u=e._rDelay,l=0;if(u&&e._repeat&&(l=rt(0,e._tDur,t),o=Ve(l,u),e._yoyo&&1&o&&(c=1-c),o!==Ve(e._tTime,u)&&(a=1-c,e.vars.repeatRefresh&&e._initted&&e.invalidate())),c!==a||r||e._zTime===D||!t&&e._zTime){if(!e._initted&&qe(e,t,r,n))return;for(s=e._zTime,e._zTime=t||(n?D:0),n||(n=t&&!s),e.ratio=c,e._from&&(c=1-c),e._time=0,e._tTime=l,i=e._pt;i;)i.r(c,i.d),i=i._next;e._startAt&&t<0&&e._startAt.render(t,!0,!0),e._onUpdate&&!n&&vt(e,"onUpdate"),l&&e._repeat&&!n&&e.parent&&vt(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===c&&(c&&Pe(e,1),n||(vt(e,c?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)}(this,e,t,n);return this},s.targets=function(){return this._targets},s.invalidate=function(){return this._pt=this._op=this._startAt=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(),e.prototype.invalidate.call(this)},s.kill=function(e,t){if(void 0===t&&(t="all"),!(e||t&&"all"!==t))return this._lazy=this._pt=0,this.parent?yt(this):this;if(this.timeline){var n=this.timeline.totalDuration();return this.timeline.killTweensOf(e,t,Wt&&!0!==Wt.vars.overwrite)._first||yt(this),this.parent&&n!==this.timeline.totalDuration()&&Je(this,this._dur*this.timeline._tDur/n,0,1),this}var r,i,o,s,a,c,u,l=this._targets,A=e?ct(e):l,h=this._ptLookup,d=this._pt;if((!t||"all"===t)&&function(e,t){for(var n=e.length,r=n===t.length;r&&n--&&e[n]===t[n];);return n<0}(l,A))return"all"===t&&(this._pt=0),yt(this);for(r=this._op=this._op||[],"all"!==t&&(V(t)&&(a={},be(t,(function(e){return a[e]=1})),t=a),t=function(e,t){var n,r,i,o,s=e[0]?_e(e[0]).harness:0,a=s&&s.aliases;if(!a)return t;for(r in n=Ne({},t),a)if(r in n)for(i=(o=a[r].split(",")).length;i--;)n[o[i]]=n[r];return n}(l,t)),u=l.length;u--;)if(~A.indexOf(l[u]))for(a in i=h[u],"all"===t?(r[u]=t,s=i,o={}):(o=r[u]=r[u]||{},s=t),s)(c=i&&i[a])&&("kill"in c.d&&!0!==c.d.kill(a)||Me(this,c,"_pt"),delete i[a]),"all"!==o&&(o[a]=1);return this._initted&&!this._pt&&d&&yt(this),this},o.to=function(e,t){return new o(e,t,arguments[2])},o.from=function(e,t){return tt(1,arguments)},o.delayedCall=function(e,t,n,r){return new o(t,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:e,onComplete:t,onReverseComplete:t,onCompleteParams:n,onReverseCompleteParams:n,callbackScope:r})},o.fromTo=function(e,t,n){return tt(2,arguments)},o.set=function(e,t){return t.duration=0,t.repeatDelay||(t.repeat=0),new o(e,t)},o.killTweensOf=function(e,t,n){return i.killTweensOf(e,t,n)},o}(Gt);xe(tn.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0}),be("staggerTo,staggerFrom,staggerFromTo",(function(e){tn[e]=function(){var t=new Kt,n=ot.call(arguments,0);return n.splice("staggerFromTo"===e?5:4,0,0),t[e].apply(t,n)}}));var nn=function(e,t,n){return e[t]=n},rn=function(e,t,n){return e[t](n)},on=function(e,t,n,r){return e[t](r.fp,n)},sn=function(e,t,n){return e.setAttribute(t,n)},an=function(e,t){return Q(e[t])?rn:G(e[t])&&e.setAttribute?sn:nn},cn=function(e,t){return t.set(t.t,t.p,Math.round(1e6*(t.s+t.c*e))/1e6,t)},un=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},ln=function(e,t){var n=t._pt,r="";if(!e&&t.b)r=t.b;else if(1===e&&t.e)r=t.e;else{for(;n;)r=n.p+(n.m?n.m(n.s+n.c*e):Math.round(1e4*(n.s+n.c*e))/1e4)+r,n=n._next;r+=t.c}t.set(t.t,t.p,r,t)},An=function(e,t){for(var n=t._pt;n;)n.r(e,n.d),n=n._next},hn=function(e,t,n,r){for(var i,o=this._pt;o;)i=o._next,o.p===r&&o.modifier(e,t,n),o=i},dn=function(e){for(var t,n,r=this._pt;r;)n=r._next,r.p===e&&!r.op||r.op===e?Me(this,r,"_pt"):r.dep||(t=1),r=n;return!t},pn=function(e,t,n,r){r.mSet(e,t,r.m.call(r.tween,n,r.mt),r)},fn=function(e){for(var t,n,r,i,o=e._pt;o;){for(t=o._next,n=r;n&&n.pr>o.pr;)n=n._next;(o._prev=n?n._prev:i)?o._prev._next=o:r=o,(o._next=n)?n._prev=o:i=o,o=t}e._pt=r},gn=function(){function e(e,t,n,r,i,o,s,a,c){this.t=t,this.s=r,this.c=i,this.p=n,this.r=o||cn,this.d=s||this,this.set=a||nn,this.pr=c||0,this._next=e,e&&(e._prev=this)}return e.prototype.modifier=function(e,t,n){this.mSet=this.mSet||this.set,this.set=pn,this.m=e,this.mt=n,this.tween=t},e}();be(ve+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",(function(e){return Ae[e]=1})),ie.TweenMax=ie.TweenLite=tn,ie.TimelineLite=ie.TimelineMax=Kt,i=new Kt({sortChildren:!1,defaults:B,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0}),N.stringFilter=Ot;var mn={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((function(e){return _t(e)}))},timeline:function(e){return new Kt(e)},getTweensOf:function(e,t){return i.getTweensOf(e,t)},getProperty:function(e,t,n,r){V(e)&&(e=ct(e)[0]);var i=_e(e||{}).get,o=n?Oe:Ie;return"native"===n&&(n=""),e?t?o((pe[t]&&pe[t].get||i)(e,t,n,r)):function(t,n,r){return o((pe[t]&&pe[t].get||i)(e,t,n,r))}:e},quickSetter:function(e,t,n){if((e=ct(e)).length>1){var r=e.map((function(e){return _n.quickSetter(e,t,n)})),i=r.length;return function(e){for(var t=i;t--;)r[t](e)}}e=e[0]||{};var o=pe[t],s=_e(e),a=s.harness&&(s.harness.aliases||{})[t]||t,c=o?function(t){var r=new o;l._pt=0,r.init(e,n?t+n:t,l,0,[e]),r.render(1,r),l._pt&&An(1,l)}:s.set(e,a);return o?c:function(t){return c(e,a,n?t+n:t,s,1)}},isTweening:function(e){return i.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=Ut(e.ease,B.ease)),Be(B,e||{})},config:function(e){return Be(N,e||{})},registerEffect:function(e){var t=e.name,n=e.effect,r=e.plugins,i=e.defaults,o=e.extendTimeline;(r||"").split(",").forEach((function(e){return e&&!pe[e]&&!ie[e]&&ce(t+" effect requires "+e+" plugin.")})),fe[t]=function(e,t,r){return n(ct(e),xe(t||{},i),r)},o&&(Kt.prototype[t]=function(e,n,r){return this.add(fe[t](e,K(n)?n:(r=n)&&{},this),r)})},registerEase:function(e,t){Bt[e]=Ut(t)},parseEase:function(e,t){return arguments.length?Ut(e,t):Bt},getById:function(e){return i.getById(e)},exportRoot:function(e,t){void 0===e&&(e={});var n,r,o=new Kt(e);for(o.smoothChildTiming=W(e.smoothChildTiming),i.remove(o),o._dp=0,o._time=o._tTime=i._time,n=i._first;n;)r=n._next,!t&&!n._dur&&n instanceof tn&&n.vars.onComplete===n._targets[0]||We(o,n,n._start-n._delay),n=r;return We(i,o,0),o},utils:{wrap:function e(t,n,r){var i=n-t;return X(t)?pt(t,e(0,t.length),n):nt(r,(function(e){return(i+(e-t)%i)%i+t}))},wrapYoyo:function e(t,n,r){var i=n-t,o=2*i;return X(t)?pt(t,e(0,t.length-1),n):nt(r,(function(e){return t+((e=(o+(e-t)%o)%o||0)>i?o-e:e)}))},distribute:lt,random:dt,snap:ht,normalize:function(e,t,n){return gt(e,t,0,1,n)},getUnit:it,clamp:function(e,t,n){return nt(n,(function(n){return rt(e,t,n)}))},splitColor:St,toArray:ct,selector:function(e){return e=ct(e)[0]||ce("Invalid scope")||{},function(t){var n=e.current||e.nativeElement||e;return ct(t,n.querySelectorAll?n:n===e?ce("Invalid scope")||a.createElement("div"):e)}},mapRange:gt,pipe:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return t.reduce((function(e,t){return t(e)}),e)}},unitize:function(e,t){return function(n){return e(parseFloat(n))+(t||it(n))}},interpolate:function e(t,n,r,i){var o=isNaN(t+n)?0:function(e){return(1-e)*t+e*n};if(!o){var s,a,c,u,l,A=V(t),h={};if(!0===r&&(i=1)&&(r=null),A)t={p:t},n={p:n};else if(X(t)&&!X(n)){for(c=[],u=t.length,l=u-2,a=1;a<u;a++)c.push(e(t[a-1],t[a]));u--,o=function(e){e*=u;var t=Math.min(l,~~e);return c[t](e-t)},r=n}else i||(t=Ne(X(t)?[]:{},t));if(!c){for(s in n)qt.call(h,t,s,"get",n[s]);o=function(e){return An(e,h)||(A?t.p:t)}}}return nt(r,o)},shuffle:ut},install:se,effects:fe,ticker:xt,updateRoot:Kt.updateRoot,plugins:pe,globalTimeline:i,core:{PropTween:gn,globals:ue,Tween:tn,Timeline:Kt,Animation:Gt,getCache:_e,_removeLinkedListItem:Me,suppressOverwrites:function(e){return r=e}}};be("to,from,fromTo,delayedCall,set,killTweensOf",(function(e){return mn[e]=tn[e]})),xt.add(Kt.updateRoot),l=mn.to({},{duration:0});var vn=function(e,t){for(var n=e._pt;n&&n.p!==t&&n.op!==t&&n.fp!==t;)n=n._next;return n},yn=function(e,t){return{name:e,rawVars:1,init:function(e,n,r){r._onInit=function(e){var r,i;if(V(n)&&(r={},be(n,(function(e){return r[e]=1})),n=r),t){for(i in r={},n)r[i]=t(n[i]);n=r}!function(e,t){var n,r,i,o=e._targets;for(n in t)for(r=o.length;r--;)(i=e._ptLookup[r][n])&&(i=i.d)&&(i._pt&&(i=vn(i,n)),i&&i.modifier&&i.modifier(t[n],e,o[r],n))}(e,n)}}}},_n=mn.registerPlugin({name:"attr",init:function(e,t,n,r,i){var o,s;for(o in t)(s=this.add(e,"setAttribute",(e.getAttribute(o)||0)+"",t[o],r,i,0,0,o))&&(s.op=o),this._props.push(o)}},{name:"endArray",init:function(e,t){for(var n=t.length;n--;)this.add(e,n,e[n]||0,t[n])}},yn("roundProps",At),yn("modifiers"),yn("snap",ht))||mn;tn.version=Kt.version=_n.version="3.9.1",c=1,z()&&Nt();var En,bn,wn,Sn,Tn,Cn,Rn,In=Bt.Power0,On=Bt.Power1,xn=Bt.Power2,Nn=Bt.Power3,Bn=Bt.Power4,Ln=Bt.Linear,Dn=Bt.Quad,Mn=Bt.Cubic,Pn=Bt.Quart,kn=Bt.Quint,Un=Bt.Strong,Fn=Bt.Elastic,Hn=Bt.Back,Vn=Bt.SteppedEase,Qn=Bt.Bounce,jn=Bt.Sine,Gn=Bt.Expo,Kn=Bt.Circ,Wn={},zn=180/Math.PI,qn=Math.PI/180,Yn=Math.atan2,Xn=/([A-Z])/g,Jn=/(?:left|right|width|margin|padding|x)/i,Zn=/[\s,\(]\S/,$n={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},er=function(e,t){return t.set(t.t,t.p,Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},tr=function(e,t){return t.set(t.t,t.p,1===e?t.e:Math.round(1e4*(t.s+t.c*e))/1e4+t.u,t)},nr=function(e,t){return t.set(t.t,t.p,e?Math.round(1e4*(t.s+t.c*e))/1e4+t.u:t.b,t)},rr=function(e,t){var n=t.s+t.c*e;t.set(t.t,t.p,~~(n+(n<0?-.5:.5))+t.u,t)},ir=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},or=function(e,t){return t.set(t.t,t.p,1!==e?t.b:t.e,t)},sr=function(e,t,n){return e.style[t]=n},ar=function(e,t,n){return e.style.setProperty(t,n)},cr=function(e,t,n){return e._gsap[t]=n},ur=function(e,t,n){return e._gsap.scaleX=e._gsap.scaleY=n},lr=function(e,t,n,r,i){var o=e._gsap;o.scaleX=o.scaleY=n,o.renderTransform(i,o)},Ar=function(e,t,n,r,i){var o=e._gsap;o[t]=n,o.renderTransform(i,o)},hr="transform",dr=hr+"Origin",pr=function(e,t){var n=bn.createElementNS?bn.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):bn.createElement(e);return n.style?n:bn.createElement(e)},fr=function e(t,n,r){var i=getComputedStyle(t);return i[n]||i.getPropertyValue(n.replace(Xn,"-$1").toLowerCase())||i.getPropertyValue(n)||!r&&e(t,mr(n)||n,1)||""},gr="O,Moz,ms,Ms,Webkit".split(","),mr=function(e,t,n){var r=(t||Tn).style,i=5;if(e in r&&!n)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);i--&&!(gr[i]+e in r););return i<0?null:(3===i?"ms":i>=0?gr[i]:"")+e},vr=function(){"undefined"!=typeof window&&window.document&&(En=window,bn=En.document,wn=bn.documentElement,Tn=pr("div")||{style:{}},pr("div"),hr=mr(hr),dr=hr+"Origin",Tn.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",Rn=!!mr("perspective"),Sn=1)},yr=function e(t){var n,r=pr("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=this.parentNode,o=this.nextSibling,s=this.style.cssText;if(wn.appendChild(r),r.appendChild(this),this.style.display="block",t)try{n=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=e}catch(e){}else this._gsapBBox&&(n=this._gsapBBox());return i&&(o?i.insertBefore(this,o):i.appendChild(this)),wn.removeChild(r),this.style.cssText=s,n},_r=function(e,t){for(var n=t.length;n--;)if(e.hasAttribute(t[n]))return e.getAttribute(t[n])},Er=function(e){var t;try{t=e.getBBox()}catch(n){t=yr.call(e,!0)}return t&&(t.width||t.height)||e.getBBox===yr||(t=yr.call(e,!0)),!t||t.width||t.x||t.y?t:{x:+_r(e,["x","cx","x1"])||0,y:+_r(e,["y","cy","y1"])||0,width:0,height:0}},br=function(e){return!(!e.getCTM||e.parentNode&&!e.ownerSVGElement||!Er(e))},wr=function(e,t){if(t){var n=e.style;t in Wn&&t!==dr&&(t=hr),n.removeProperty?("ms"!==t.substr(0,2)&&"webkit"!==t.substr(0,6)||(t="-"+t),n.removeProperty(t.replace(Xn,"-$1").toLowerCase())):n.removeAttribute(t)}},Sr=function(e,t,n,r,i,o){var s=new gn(e._pt,t,n,0,1,o?or:ir);return e._pt=s,s.b=r,s.e=i,e._props.push(n),s},Tr={deg:1,rad:1,turn:1},Cr=function e(t,n,r,i){var o,s,a,c,u=parseFloat(r)||0,l=(r+"").trim().substr((u+"").length)||"px",A=Tn.style,h=Jn.test(n),d="svg"===t.tagName.toLowerCase(),p=(d?"client":"offset")+(h?"Width":"Height"),f=100,g="px"===i,m="%"===i;return i===l||!u||Tr[i]||Tr[l]?u:("px"!==l&&!g&&(u=e(t,n,r,"px")),c=t.getCTM&&br(t),!m&&"%"!==l||!Wn[n]&&!~n.indexOf("adius")?(A[h?"width":"height"]=f+(g?l:i),s=~n.indexOf("adius")||"em"===i&&t.appendChild&&!d?t:t.parentNode,c&&(s=(t.ownerSVGElement||{}).parentNode),s&&s!==bn&&s.appendChild||(s=bn.body),(a=s._gsap)&&m&&a.width&&h&&a.time===xt.time?we(u/a.width*f):((m||"%"===l)&&(A.position=fr(t,"position")),s===t&&(A.position="static"),s.appendChild(Tn),o=Tn[p],s.removeChild(Tn),A.position="absolute",h&&m&&((a=_e(s)).time=xt.time,a.width=s[p]),we(g?o*u/f:o&&u?f/o*u:0))):(o=c?t.getBBox()[h?"width":"height"]:t[p],we(m?u/o*f:u/100*o)))},Rr=function(e,t,n,r){var i;return Sn||vr(),t in $n&&"transform"!==t&&~(t=$n[t]).indexOf(",")&&(t=t.split(",")[0]),Wn[t]&&"transform"!==t?(i=Ur(e,r),i="transformOrigin"!==t?i[t]:i.svg?i.origin:Fr(fr(e,dr))+" "+i.zOrigin+"px"):(!(i=e.style[t])||"auto"===i||r||~(i+"").indexOf("calc("))&&(i=Nr[t]&&Nr[t](e,t,n)||fr(e,t)||Ee(e,t)||("opacity"===t?1:0)),n&&!~(i+"").trim().indexOf(" ")?Cr(e,t,i,n)+n:i},Ir=function(e,t,n,r){if(!n||"none"===n){var i=mr(t,e,1),o=i&&fr(e,i,1);o&&o!==n?(t=i,n=o):"borderColor"===t&&(n=fr(e,"borderTopColor"))}var s,a,c,u,l,A,h,d,p,f,g,m,v=new gn(this._pt,e.style,t,0,1,ln),y=0,_=0;if(v.b=n,v.e=r,n+="","auto"===(r+="")&&(e.style[t]=r,r=fr(e,t)||r,e.style[t]=n),Ot(s=[n,r]),r=s[1],c=(n=s[0]).match($)||[],(r.match($)||[]).length){for(;a=$.exec(r);)h=a[0],p=r.substring(y,a.index),l?l=(l+1)%5:"rgba("!==p.substr(-5)&&"hsla("!==p.substr(-5)||(l=1),h!==(A=c[_++]||"")&&(u=parseFloat(A)||0,g=A.substr((u+"").length),(m="="===h.charAt(1)?+(h.charAt(0)+"1"):0)&&(h=h.substr(2)),d=parseFloat(h),f=h.substr((d+"").length),y=$.lastIndex-f.length,f||(f=f||N.units[t]||g,y===r.length&&(r+=f,v.e+=f)),g!==f&&(u=Cr(e,t,A,f)||0),v._pt={_next:v._pt,p:p||1===_?p:",",s:u,c:m?m*d:d-u,m:l&&l<4||"zIndex"===t?Math.round:0});v.c=y<r.length?r.substring(y,r.length):""}else v.r="display"===t&&"none"===r?or:ir;return te.test(r)&&(v.e=0),this._pt=v,v},Or={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},xr=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var n,r,i,o=t.t,s=o.style,a=t.u,c=o._gsap;if("all"===a||!0===a)s.cssText="",r=1;else for(i=(a=a.split(",")).length;--i>-1;)n=a[i],Wn[n]&&(r=1,n="transformOrigin"===n?dr:hr),wr(o,n);r&&(wr(o,hr),c&&(c.svg&&o.removeAttribute("transform"),Ur(o,1),c.uncache=1))}},Nr={clearProps:function(e,t,n,r,i){if("isFromStart"!==i.data){var o=e._pt=new gn(e._pt,t,n,0,0,xr);return o.u=r,o.pr=-10,o.tween=i,e._props.push(n),1}}},Br=[1,0,0,1,0,0],Lr={},Dr=function(e){return"matrix(1, 0, 0, 1, 0, 0)"===e||"none"===e||!e},Mr=function(e){var t=fr(e,hr);return Dr(t)?Br:t.substr(7).match(Z).map(we)},Pr=function(e,t){var n,r,i,o,s=e._gsap||_e(e),a=e.style,c=Mr(e);return s.svg&&e.getAttribute("transform")?"1,0,0,1,0,0"===(c=[(i=e.transform.baseVal.consolidate().matrix).a,i.b,i.c,i.d,i.e,i.f]).join(",")?Br:c:(c!==Br||e.offsetParent||e===wn||s.svg||(i=a.display,a.display="block",(n=e.parentNode)&&e.offsetParent||(o=1,r=e.nextSibling,wn.appendChild(e)),c=Mr(e),i?a.display=i:wr(e,"display"),o&&(r?n.insertBefore(e,r):n?n.appendChild(e):wn.removeChild(e))),t&&c.length>6?[c[0],c[1],c[4],c[5],c[12],c[13]]:c)},kr=function(e,t,n,r,i,o){var s,a,c,u=e._gsap,l=i||Pr(e,!0),A=u.xOrigin||0,h=u.yOrigin||0,d=u.xOffset||0,p=u.yOffset||0,f=l[0],g=l[1],m=l[2],v=l[3],y=l[4],_=l[5],E=t.split(" "),b=parseFloat(E[0])||0,w=parseFloat(E[1])||0;n?l!==Br&&(a=f*v-g*m)&&(c=b*(-g/a)+w*(f/a)-(f*_-g*y)/a,b=b*(v/a)+w*(-m/a)+(m*_-v*y)/a,w=c):(b=(s=Er(e)).x+(~E[0].indexOf("%")?b/100*s.width:b),w=s.y+(~(E[1]||E[0]).indexOf("%")?w/100*s.height:w)),r||!1!==r&&u.smooth?(y=b-A,_=w-h,u.xOffset=d+(y*f+_*m)-y,u.yOffset=p+(y*g+_*v)-_):u.xOffset=u.yOffset=0,u.xOrigin=b,u.yOrigin=w,u.smooth=!!r,u.origin=t,u.originIsAbsolute=!!n,e.style[dr]="0px 0px",o&&(Sr(o,u,"xOrigin",A,b),Sr(o,u,"yOrigin",h,w),Sr(o,u,"xOffset",d,u.xOffset),Sr(o,u,"yOffset",p,u.yOffset)),e.setAttribute("data-svg-origin",b+" "+w)},Ur=function(e,t){var n=e._gsap||new jt(e);if("x"in n&&!t&&!n.uncache)return n;var r,i,o,s,a,c,u,l,A,h,d,p,f,g,m,v,y,_,E,b,w,S,T,C,R,I,O,x,B,L,D,M,P=e.style,k=n.scaleX<0,U="px",F="deg",H=fr(e,dr)||"0";return r=i=o=c=u=l=A=h=d=0,s=a=1,n.svg=!(!e.getCTM||!br(e)),g=Pr(e,n.svg),n.svg&&(C=(!n.uncache||"0px 0px"===H)&&!t&&e.getAttribute("data-svg-origin"),kr(e,C||H,!!C||n.originIsAbsolute,!1!==n.smooth,g)),p=n.xOrigin||0,f=n.yOrigin||0,g!==Br&&(_=g[0],E=g[1],b=g[2],w=g[3],r=S=g[4],i=T=g[5],6===g.length?(s=Math.sqrt(_*_+E*E),a=Math.sqrt(w*w+b*b),c=_||E?Yn(E,_)*zn:0,(A=b||w?Yn(b,w)*zn+c:0)&&(a*=Math.abs(Math.cos(A*qn))),n.svg&&(r-=p-(p*_+f*b),i-=f-(p*E+f*w))):(M=g[6],L=g[7],O=g[8],x=g[9],B=g[10],D=g[11],r=g[12],i=g[13],o=g[14],u=(m=Yn(M,B))*zn,m&&(C=S*(v=Math.cos(-m))+O*(y=Math.sin(-m)),R=T*v+x*y,I=M*v+B*y,O=S*-y+O*v,x=T*-y+x*v,B=M*-y+B*v,D=L*-y+D*v,S=C,T=R,M=I),l=(m=Yn(-b,B))*zn,m&&(v=Math.cos(-m),D=w*(y=Math.sin(-m))+D*v,_=C=_*v-O*y,E=R=E*v-x*y,b=I=b*v-B*y),c=(m=Yn(E,_))*zn,m&&(C=_*(v=Math.cos(m))+E*(y=Math.sin(m)),R=S*v+T*y,E=E*v-_*y,T=T*v-S*y,_=C,S=R),u&&Math.abs(u)+Math.abs(c)>359.9&&(u=c=0,l=180-l),s=we(Math.sqrt(_*_+E*E+b*b)),a=we(Math.sqrt(T*T+M*M)),m=Yn(S,T),A=Math.abs(m)>2e-4?m*zn:0,d=D?1/(D<0?-D:D):0),n.svg&&(C=e.getAttribute("transform"),n.forceCSS=e.setAttribute("transform","")||!Dr(fr(e,hr)),C&&e.setAttribute("transform",C))),Math.abs(A)>90&&Math.abs(A)<270&&(k?(s*=-1,A+=c<=0?180:-180,c+=c<=0?180:-180):(a*=-1,A+=A<=0?180:-180)),n.x=r-((n.xPercent=r&&(n.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-r)?-50:0)))?e.offsetWidth*n.xPercent/100:0)+U,n.y=i-((n.yPercent=i&&(n.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-i)?-50:0)))?e.offsetHeight*n.yPercent/100:0)+U,n.z=o+U,n.scaleX=we(s),n.scaleY=we(a),n.rotation=we(c)+F,n.rotationX=we(u)+F,n.rotationY=we(l)+F,n.skewX=A+F,n.skewY=h+F,n.transformPerspective=d+U,(n.zOrigin=parseFloat(H.split(" ")[2])||0)&&(P[dr]=Fr(H)),n.xOffset=n.yOffset=0,n.force3D=N.force3D,n.renderTransform=n.svg?Wr:Rn?Kr:Vr,n.uncache=0,n},Fr=function(e){return(e=e.split(" "))[0]+" "+e[1]},Hr=function(e,t,n){var r=it(t);return we(parseFloat(t)+parseFloat(Cr(e,"x",n+"px",r)))+r},Vr=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,Kr(e,t)},Qr="0deg",jr="0px",Gr=") ",Kr=function(e,t){var n=t||this,r=n.xPercent,i=n.yPercent,o=n.x,s=n.y,a=n.z,c=n.rotation,u=n.rotationY,l=n.rotationX,A=n.skewX,h=n.skewY,d=n.scaleX,p=n.scaleY,f=n.transformPerspective,g=n.force3D,m=n.target,v=n.zOrigin,y="",_="auto"===g&&e&&1!==e||!0===g;if(v&&(l!==Qr||u!==Qr)){var E,b=parseFloat(u)*qn,w=Math.sin(b),S=Math.cos(b);b=parseFloat(l)*qn,E=Math.cos(b),o=Hr(m,o,w*E*-v),s=Hr(m,s,-Math.sin(b)*-v),a=Hr(m,a,S*E*-v+v)}f!==jr&&(y+="perspective("+f+Gr),(r||i)&&(y+="translate("+r+"%, "+i+"%) "),(_||o!==jr||s!==jr||a!==jr)&&(y+=a!==jr||_?"translate3d("+o+", "+s+", "+a+") ":"translate("+o+", "+s+Gr),c!==Qr&&(y+="rotate("+c+Gr),u!==Qr&&(y+="rotateY("+u+Gr),l!==Qr&&(y+="rotateX("+l+Gr),A===Qr&&h===Qr||(y+="skew("+A+", "+h+Gr),1===d&&1===p||(y+="scale("+d+", "+p+Gr),m.style[hr]=y||"translate(0, 0)"},Wr=function(e,t){var n,r,i,o,s,a=t||this,c=a.xPercent,u=a.yPercent,l=a.x,A=a.y,h=a.rotation,d=a.skewX,p=a.skewY,f=a.scaleX,g=a.scaleY,m=a.target,v=a.xOrigin,y=a.yOrigin,_=a.xOffset,E=a.yOffset,b=a.forceCSS,w=parseFloat(l),S=parseFloat(A);h=parseFloat(h),d=parseFloat(d),(p=parseFloat(p))&&(d+=p=parseFloat(p),h+=p),h||d?(h*=qn,d*=qn,n=Math.cos(h)*f,r=Math.sin(h)*f,i=Math.sin(h-d)*-g,o=Math.cos(h-d)*g,d&&(p*=qn,s=Math.tan(d-p),i*=s=Math.sqrt(1+s*s),o*=s,p&&(s=Math.tan(p),n*=s=Math.sqrt(1+s*s),r*=s)),n=we(n),r=we(r),i=we(i),o=we(o)):(n=f,o=g,r=i=0),(w&&!~(l+"").indexOf("px")||S&&!~(A+"").indexOf("px"))&&(w=Cr(m,"x",l,"px"),S=Cr(m,"y",A,"px")),(v||y||_||E)&&(w=we(w+v-(v*n+y*i)+_),S=we(S+y-(v*r+y*o)+E)),(c||u)&&(s=m.getBBox(),w=we(w+c/100*s.width),S=we(S+u/100*s.height)),s="matrix("+n+","+r+","+i+","+o+","+w+","+S+")",m.setAttribute("transform",s),b&&(m.style[hr]=s)},zr=function(e,t,n,r,i,o){var s,a,c=360,u=V(i),l=parseFloat(i)*(u&&~i.indexOf("rad")?zn:1),A=o?l*o:l-r,h=r+A+"deg";return u&&("short"===(s=i.split("_")[1])&&(A%=c)!==A%180&&(A+=A<0?c:-360),"cw"===s&&A<0?A=(A+36e9)%c-~~(A/c)*c:"ccw"===s&&A>0&&(A=(A-36e9)%c-~~(A/c)*c)),e._pt=a=new gn(e._pt,t,n,r,A,tr),a.e=h,a.u="deg",e._props.push(n),a},qr=function(e,t){for(var n in t)e[n]=t[n];return e},Yr=function(e,t,n){var r,i,o,s,a,c,u,l=qr({},n._gsap),A=n.style;for(i in l.svg?(o=n.getAttribute("transform"),n.setAttribute("transform",""),A[hr]=t,r=Ur(n,1),wr(n,hr),n.setAttribute("transform",o)):(o=getComputedStyle(n)[hr],A[hr]=t,r=Ur(n,1),A[hr]=o),Wn)(o=l[i])!==(s=r[i])&&"perspective,force3D,transformOrigin,svgOrigin".indexOf(i)<0&&(a=it(o)!==(u=it(s))?Cr(n,i,o,u):parseFloat(o),c=parseFloat(s),e._pt=new gn(e._pt,r,i,a,c-a,er),e._pt.u=u||0,e._props.push(i));qr(r,l)};be("padding,margin,Width,Radius",(function(e,t){var n="Top",r="Right",i="Bottom",o="Left",s=(t<3?[n,r,i,o]:[n+o,n+r,i+r,i+o]).map((function(n){return t<2?e+n:"border"+n+e}));Nr[t>1?"border"+e:e]=function(e,t,n,r,i){var o,a;if(arguments.length<4)return o=s.map((function(t){return Rr(e,t,n)})),5===(a=o.join(" ")).split(o[0]).length?o[0]:a;o=(r+"").split(" "),a={},s.forEach((function(e,t){return a[e]=o[t]=o[t]||o[(t-1)/2|0]})),e.init(t,a,i)}}));var Xr,Jr,Zr,$r={name:"css",register:vr,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,n,r,i){var o,s,a,c,u,l,A,h,d,p,f,g,m,v,y,_,E,b,w,S=this._props,T=e.style,C=n.vars.startAt;for(A in Sn||vr(),t)if("autoRound"!==A&&(s=t[A],!pe[A]||!Yt(A,t,n,r,e,i)))if(u=typeof s,l=Nr[A],"function"===u&&(u=typeof(s=s.call(n,r,e,i))),"string"===u&&~s.indexOf("random(")&&(s=ft(s)),l)l(this,e,A,s,n)&&(y=1);else if("--"===A.substr(0,2))o=(getComputedStyle(e).getPropertyValue(A)+"").trim(),s+="",Rt.lastIndex=0,Rt.test(o)||(h=it(o),d=it(s)),d?h!==d&&(o=Cr(e,A,o,d)+d):h&&(s+=h),this.add(T,"setProperty",o,s,r,i,0,0,A),S.push(A);else if("undefined"!==u){if(C&&A in C?(o="function"==typeof C[A]?C[A].call(n,r,e,i):C[A],V(o)&&~o.indexOf("random(")&&(o=ft(o)),it(o+"")||(o+=N.units[A]||it(Rr(e,A))||""),"="===(o+"").charAt(1)&&(o=Rr(e,A))):o=Rr(e,A),c=parseFloat(o),(p="string"===u&&"="===s.charAt(1)?+(s.charAt(0)+"1"):0)&&(s=s.substr(2)),a=parseFloat(s),A in $n&&("autoAlpha"===A&&(1===c&&"hidden"===Rr(e,"visibility")&&a&&(c=0),Sr(this,T,"visibility",c?"inherit":"hidden",a?"inherit":"hidden",!a)),"scale"!==A&&"transform"!==A&&~(A=$n[A]).indexOf(",")&&(A=A.split(",")[0])),f=A in Wn)if(g||((m=e._gsap).renderTransform&&!t.parseTransform||Ur(e,t.parseTransform),v=!1!==t.smoothOrigin&&m.smooth,(g=this._pt=new gn(this._pt,T,hr,0,1,m.renderTransform,m,0,-1)).dep=1),"scale"===A)this._pt=new gn(this._pt,m,"scaleY",m.scaleY,(p?p*a:a-m.scaleY)||0),S.push("scaleY",A),A+="X";else{if("transformOrigin"===A){E=void 0,b=void 0,w=void 0,E=(_=s).split(" "),b=E[0],w=E[1]||"50%","top"!==b&&"bottom"!==b&&"left"!==w&&"right"!==w||(_=b,b=w,w=_),E[0]=Or[b]||b,E[1]=Or[w]||w,s=E.join(" "),m.svg?kr(e,s,0,v,0,this):((d=parseFloat(s.split(" ")[2])||0)!==m.zOrigin&&Sr(this,m,"zOrigin",m.zOrigin,d),Sr(this,T,A,Fr(o),Fr(s)));continue}if("svgOrigin"===A){kr(e,s,1,v,0,this);continue}if(A in Lr){zr(this,m,A,c,s,p);continue}if("smoothOrigin"===A){Sr(this,m,"smooth",m.smooth,s);continue}if("force3D"===A){m[A]=s;continue}if("transform"===A){Yr(this,s,e);continue}}else A in T||(A=mr(A)||A);if(f||(a||0===a)&&(c||0===c)&&!Zn.test(s)&&A in T)a||(a=0),(h=(o+"").substr((c+"").length))!==(d=it(s)||(A in N.units?N.units[A]:h))&&(c=Cr(e,A,o,d)),this._pt=new gn(this._pt,f?m:T,A,c,p?p*a:a-c,f||"px"!==d&&"zIndex"!==A||!1===t.autoRound?er:rr),this._pt.u=d||0,h!==d&&"%"!==d&&(this._pt.b=o,this._pt.r=nr);else if(A in T)Ir.call(this,e,A,o,s);else{if(!(A in e)){ae(A,s);continue}this.add(e,A,o||e[A],s,r,i)}S.push(A)}y&&fn(this)},get:Rr,aliases:$n,getSetter:function(e,t,n){var r=$n[t];return r&&r.indexOf(",")<0&&(t=r),t in Wn&&t!==dr&&(e._gsap.x||Rr(e,"x"))?n&&Cn===n?"scale"===t?ur:cr:(Cn=n||{})&&("scale"===t?lr:Ar):e.style&&!G(e.style[t])?sr:~t.indexOf("-")?ar:an(e,t)},core:{_removeProperty:wr,_getMatrix:Pr}};_n.utils.checkPrefix=mr,Zr=be((Xr="x,y,z,scale,scaleX,scaleY,xPercent,yPercent")+","+(Jr="rotation,rotationX,rotationY,skewX,skewY")+",transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective",(function(e){Wn[e]=1})),be(Jr,(function(e){N.units[e]="deg",Lr[e]=1})),$n[Zr[13]]=Xr+","+Jr,be("0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY",(function(e){var t=e.split(":");$n[t[1]]=Zr[t[0]]})),be("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",(function(e){N.units[e]="px"})),_n.registerPlugin($r);var ei=_n.registerPlugin($r)||_n,ti=ei.core.Tween;e.Back=Hn,e.Bounce=Qn,e.CSSPlugin=$r,e.Circ=Kn,e.Cubic=Mn,e.Elastic=Fn,e.Expo=Gn,e.Linear=Ln,e.Power0=In,e.Power1=On,e.Power2=xn,e.Power3=Nn,e.Power4=Bn,e.Quad=Dn,e.Quart=Pn,e.Quint=kn,e.Sine=jn,e.SteppedEase=Vn,e.Strong=Un,e.TimelineLite=Kt,e.TimelineMax=Kt,e.TweenLite=tn,e.TweenMax=ti,e.default=ei,e.gsap=ei,"undefined"==typeof window||window!==e?Object.defineProperty(e,"__esModule",{value:!0}):delete window.default})),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.QRious=t()}(this,(function(){"use strict";var e=function(){},t=Object.prototype.hasOwnProperty,n=Array.prototype.slice;function r(e,r,i){for(var o,s,a=0,c=(i=n.call(arguments,2)).length;a<c;a++)for(o in s=i[a])e&&!t.call(s,o)||(r[o]=s[o])}var i=function(t,n,i,o){var s=this;return"string"!=typeof t&&(o=i,i=n,n=t,t=null),"function"!=typeof n&&(o=i,i=n,n=function(){return s.apply(this,arguments)}),r(!1,n,s,o),n.prototype=function(t,n){var i;return"function"==typeof Object.create?i=Object.create(t):(e.prototype=t,i=new e,e.prototype=null),n&&r(!0,i,n),i}(s.prototype,i),n.prototype.constructor=n,n.class_=t||s.class_,n.super_=s,n};function o(){}o.class_="Nevis",o.super_=Object,o.extend=i;var s=o,a=s.extend((function(e,t,n){this.qrious=e,this.element=t,this.element.qrious=e,this.enabled=Boolean(n)}),{draw:function(e){},getElement:function(){return this.enabled||(this.enabled=!0,this.render()),this.element},getModuleSize:function(e){var t=this.qrious,n=t.padding||0,r=Math.floor((t.size-2*n)/e.width);return Math.max(1,r)},getOffset:function(e){var t=this.qrious,n=t.padding;if(null!=n)return n;var r=this.getModuleSize(e),i=Math.floor((t.size-r*e.width)/2);return Math.max(0,i)},render:function(e){this.enabled&&(this.resize(),this.reset(),this.draw(e))},reset:function(){},resize:function(){}}),c=a.extend({draw:function(e){var t,n,r=this.qrious,i=this.getModuleSize(e),o=this.getOffset(e),s=this.element.getContext("2d");for(s.fillStyle=r.foreground,s.globalAlpha=r.foregroundAlpha,t=0;t<e.width;t++)for(n=0;n<e.width;n++)e.buffer[n*e.width+t]&&s.fillRect(i*t+o,i*n+o,i,i)},reset:function(){var e=this.qrious,t=this.element.getContext("2d"),n=e.size;t.lineWidth=1,t.clearRect(0,0,n,n),t.fillStyle=e.background,t.globalAlpha=e.backgroundAlpha,t.fillRect(0,0,n,n)},resize:function(){var e=this.element;e.width=e.height=this.qrious.size}}),u=s.extend(null,{BLOCK:[0,11,15,19,23,27,31,16,18,20,22,24,26,28,20,22,24,24,26,28,28,22,24,24,26,26,28,28,24,24,26,26,26,28,28,24,26,26,26,28,28]}),l=s.extend(null,{BLOCKS:[1,0,19,7,1,0,16,10,1,0,13,13,1,0,9,17,1,0,34,10,1,0,28,16,1,0,22,22,1,0,16,28,1,0,55,15,1,0,44,26,2,0,17,18,2,0,13,22,1,0,80,20,2,0,32,18,2,0,24,26,4,0,9,16,1,0,108,26,2,0,43,24,2,2,15,18,2,2,11,22,2,0,68,18,4,0,27,16,4,0,19,24,4,0,15,28,2,0,78,20,4,0,31,18,2,4,14,18,4,1,13,26,2,0,97,24,2,2,38,22,4,2,18,22,4,2,14,26,2,0,116,30,3,2,36,22,4,4,16,20,4,4,12,24,2,2,68,18,4,1,43,26,6,2,19,24,6,2,15,28,4,0,81,20,1,4,50,30,4,4,22,28,3,8,12,24,2,2,92,24,6,2,36,22,4,6,20,26,7,4,14,28,4,0,107,26,8,1,37,22,8,4,20,24,12,4,11,22,3,1,115,30,4,5,40,24,11,5,16,20,11,5,12,24,5,1,87,22,5,5,41,24,5,7,24,30,11,7,12,24,5,1,98,24,7,3,45,28,15,2,19,24,3,13,15,30,1,5,107,28,10,1,46,28,1,15,22,28,2,17,14,28,5,1,120,30,9,4,43,26,17,1,22,28,2,19,14,28,3,4,113,28,3,11,44,26,17,4,21,26,9,16,13,26,3,5,107,28,3,13,41,26,15,5,24,30,15,10,15,28,4,4,116,28,17,0,42,26,17,6,22,28,19,6,16,30,2,7,111,28,17,0,46,28,7,16,24,30,34,0,13,24,4,5,121,30,4,14,47,28,11,14,24,30,16,14,15,30,6,4,117,30,6,14,45,28,11,16,24,30,30,2,16,30,8,4,106,26,8,13,47,28,7,22,24,30,22,13,15,30,10,2,114,28,19,4,46,28,28,6,22,28,33,4,16,30,8,4,122,30,22,3,45,28,8,26,23,30,12,28,15,30,3,10,117,30,3,23,45,28,4,31,24,30,11,31,15,30,7,7,116,30,21,7,45,28,1,37,23,30,19,26,15,30,5,10,115,30,19,10,47,28,15,25,24,30,23,25,15,30,13,3,115,30,2,29,46,28,42,1,24,30,23,28,15,30,17,0,115,30,10,23,46,28,10,35,24,30,19,35,15,30,17,1,115,30,14,21,46,28,29,19,24,30,11,46,15,30,13,6,115,30,14,23,46,28,44,7,24,30,59,1,16,30,12,7,121,30,12,26,47,28,39,14,24,30,22,41,15,30,6,14,121,30,6,34,47,28,46,10,24,30,2,64,15,30,17,4,122,30,29,14,46,28,49,10,24,30,24,46,15,30,4,18,122,30,13,32,46,28,48,14,24,30,42,32,15,30,20,4,117,30,40,7,47,28,43,22,24,30,10,67,15,30,19,6,118,30,18,31,47,28,34,34,24,30,20,61,15,30],FINAL_FORMAT:[30660,29427,32170,30877,26159,25368,27713,26998,21522,20773,24188,23371,17913,16590,20375,19104,13663,12392,16177,14854,9396,8579,11994,11245,5769,5054,7399,6608,1890,597,3340,2107],LEVELS:{L:1,M:2,Q:3,H:4}}),A=s.extend(null,{EXPONENT:[1,2,4,8,16,32,64,128,29,58,116,232,205,135,19,38,76,152,45,90,180,117,234,201,143,3,6,12,24,48,96,192,157,39,78,156,37,74,148,53,106,212,181,119,238,193,159,35,70,140,5,10,20,40,80,160,93,186,105,210,185,111,222,161,95,190,97,194,153,47,94,188,101,202,137,15,30,60,120,240,253,231,211,187,107,214,177,127,254,225,223,163,91,182,113,226,217,175,67,134,17,34,68,136,13,26,52,104,208,189,103,206,129,31,62,124,248,237,199,147,59,118,236,197,151,51,102,204,133,23,46,92,184,109,218,169,79,158,33,66,132,21,42,84,168,77,154,41,82,164,85,170,73,146,57,114,228,213,183,115,230,209,191,99,198,145,63,126,252,229,215,179,123,246,241,255,227,219,171,75,150,49,98,196,149,55,110,220,165,87,174,65,130,25,50,100,200,141,7,14,28,56,112,224,221,167,83,166,81,162,89,178,121,242,249,239,195,155,43,86,172,69,138,9,18,36,72,144,61,122,244,245,247,243,251,235,203,139,11,22,44,88,176,125,250,233,207,131,27,54,108,216,173,71,142,0],LOG:[255,0,1,25,2,50,26,198,3,223,51,238,27,104,199,75,4,100,224,14,52,141,239,129,28,193,105,248,200,8,76,113,5,138,101,47,225,36,15,33,53,147,142,218,240,18,130,69,29,181,194,125,106,39,249,185,201,154,9,120,77,228,114,166,6,191,139,98,102,221,48,253,226,152,37,179,16,145,34,136,54,208,148,206,143,150,219,189,241,210,19,92,131,56,70,64,30,66,182,163,195,72,126,110,107,58,40,84,250,133,186,61,202,94,155,159,10,21,121,43,78,212,229,172,115,243,167,87,7,112,192,247,140,128,99,13,103,74,222,237,49,197,254,24,227,165,153,119,38,184,180,124,17,68,146,217,35,32,137,46,55,63,209,91,149,188,207,205,144,135,151,178,220,252,190,97,242,86,211,171,20,42,93,158,132,60,57,83,71,109,65,162,31,45,67,216,183,123,164,118,196,23,73,236,127,12,111,246,108,161,59,82,41,157,85,170,251,96,134,177,187,204,62,90,203,89,95,176,156,169,160,81,11,245,22,235,122,117,44,215,79,174,213,233,230,231,173,232,116,214,244,234,168,80,88,175]}),h=s.extend(null,{BLOCK:[3220,1468,2713,1235,3062,1890,2119,1549,2344,2936,1117,2583,1330,2470,1667,2249,2028,3780,481,4011,142,3098,831,3445,592,2517,1776,2234,1951,2827,1070,2660,1345,3177]}),d=s.extend((function(e){var t,n,r,i,o,s=e.value.length;for(this._badness=[],this._level=l.LEVELS[e.level],this._polynomial=[],this._value=e.value,this._version=0,this._stringBuffer=[];this._version<40&&(this._version++,r=4*(this._level-1)+16*(this._version-1),i=l.BLOCKS[r++],o=l.BLOCKS[r++],t=l.BLOCKS[r++],n=l.BLOCKS[r],!(s<=(r=t*(i+o)+o-3+(this._version<=9)))););this._dataBlock=t,this._eccBlock=n,this._neccBlock1=i,this._neccBlock2=o;var a=this.width=17+4*this._version;this.buffer=d._createArray(a*a),this._ecc=d._createArray(t+(t+n)*(i+o)+o),this._mask=d._createArray((a*(a+1)+1)/2),this._insertFinders(),this._insertAlignments(),this.buffer[8+a*(a-8)]=1,this._insertTimingGap(),this._reverseMask(),this._insertTimingRowAndColumn(),this._insertVersion(),this._syncMask(),this._convertBitStream(s),this._calculatePolynomial(),this._appendEccToData(),this._interleaveBlocks(),this._pack(),this._finish()}),{_addAlignment:function(e,t){var n,r=this.buffer,i=this.width;for(r[e+i*t]=1,n=-2;n<2;n++)r[e+n+i*(t-2)]=1,r[e-2+i*(t+n+1)]=1,r[e+2+i*(t+n)]=1,r[e+n+1+i*(t+2)]=1;for(n=0;n<2;n++)this._setMask(e-1,t+n),this._setMask(e+1,t-n),this._setMask(e-n,t-1),this._setMask(e+n,t+1)},_appendData:function(e,t,n,r){var i,o,s,a=this._polynomial,c=this._stringBuffer;for(o=0;o<r;o++)c[n+o]=0;for(o=0;o<t;o++){if(255!==(i=A.LOG[c[e+o]^c[n]]))for(s=1;s<r;s++)c[n+s-1]=c[n+s]^A.EXPONENT[d._modN(i+a[r-s])];else for(s=n;s<n+r;s++)c[s]=c[s+1];c[n+r-1]=255===i?0:A.EXPONENT[d._modN(i+a[0])]}},_appendEccToData:function(){var e,t=0,n=this._dataBlock,r=this._calculateMaxLength(),i=this._eccBlock;for(e=0;e<this._neccBlock1;e++)this._appendData(t,n,r,i),t+=n,r+=i;for(e=0;e<this._neccBlock2;e++)this._appendData(t,n+1,r,i),t+=n+1,r+=i},_applyMask:function(e){var t,n,r,i,o=this.buffer,s=this.width;switch(e){case 0:for(i=0;i<s;i++)for(r=0;r<s;r++)r+i&1||this._isMasked(r,i)||(o[r+i*s]^=1);break;case 1:for(i=0;i<s;i++)for(r=0;r<s;r++)1&i||this._isMasked(r,i)||(o[r+i*s]^=1);break;case 2:for(i=0;i<s;i++)for(t=0,r=0;r<s;r++,t++)3===t&&(t=0),t||this._isMasked(r,i)||(o[r+i*s]^=1);break;case 3:for(n=0,i=0;i<s;i++,n++)for(3===n&&(n=0),t=n,r=0;r<s;r++,t++)3===t&&(t=0),t||this._isMasked(r,i)||(o[r+i*s]^=1);break;case 4:for(i=0;i<s;i++)for(t=0,n=i>>1&1,r=0;r<s;r++,t++)3===t&&(t=0,n=!n),n||this._isMasked(r,i)||(o[r+i*s]^=1);break;case 5:for(n=0,i=0;i<s;i++,n++)for(3===n&&(n=0),t=0,r=0;r<s;r++,t++)3===t&&(t=0),(r&i&1)+!(!t|!n)||this._isMasked(r,i)||(o[r+i*s]^=1);break;case 6:for(n=0,i=0;i<s;i++,n++)for(3===n&&(n=0),t=0,r=0;r<s;r++,t++)3===t&&(t=0),(r&i&1)+(t&&t===n)&1||this._isMasked(r,i)||(o[r+i*s]^=1);break;case 7:for(n=0,i=0;i<s;i++,n++)for(3===n&&(n=0),t=0,r=0;r<s;r++,t++)3===t&&(t=0),(t&&t===n)+(r+i&1)&1||this._isMasked(r,i)||(o[r+i*s]^=1)}},_calculateMaxLength:function(){return this._dataBlock*(this._neccBlock1+this._neccBlock2)+this._neccBlock2},_calculatePolynomial:function(){var e,t,n=this._eccBlock,r=this._polynomial;for(r[0]=1,e=0;e<n;e++){for(r[e+1]=1,t=e;t>0;t--)r[t]=r[t]?r[t-1]^A.EXPONENT[d._modN(A.LOG[r[t]]+e)]:r[t-1];r[0]=A.EXPONENT[d._modN(A.LOG[r[0]]+e)]}for(e=0;e<=n;e++)r[e]=A.LOG[r[e]]},_checkBadness:function(){var e,t,n,r,i,o=0,s=this._badness,a=this.buffer,c=this.width;for(i=0;i<c-1;i++)for(r=0;r<c-1;r++)(a[r+c*i]&&a[r+1+c*i]&&a[r+c*(i+1)]&&a[r+1+c*(i+1)]||!(a[r+c*i]||a[r+1+c*i]||a[r+c*(i+1)]||a[r+1+c*(i+1)]))&&(o+=d.N2);var u=0;for(i=0;i<c;i++){for(n=0,s[0]=0,e=0,r=0;r<c;r++)e===(t=a[r+c*i])?s[n]++:s[++n]=1,u+=(e=t)?1:-1;o+=this._getBadness(n)}u<0&&(u=-u);var l=0,A=u;for(A+=A<<2,A<<=1;A>c*c;)A-=c*c,l++;for(o+=l*d.N4,r=0;r<c;r++){for(n=0,s[0]=0,e=0,i=0;i<c;i++)e===(t=a[r+c*i])?s[n]++:s[++n]=1,e=t;o+=this._getBadness(n)}return o},_convertBitStream:function(e){var t,n,r=this._ecc,i=this._version;for(n=0;n<e;n++)r[n]=this._value.charCodeAt(n);var o=this._stringBuffer=r.slice(),s=this._calculateMaxLength();e>=s-2&&(e=s-2,i>9&&e--);var a=e;if(i>9){for(o[a+2]=0,o[a+3]=0;a--;)t=o[a],o[a+3]|=255&t<<4,o[a+2]=t>>4;o[2]|=255&e<<4,o[1]=e>>4,o[0]=64|e>>12}else{for(o[a+1]=0,o[a+2]=0;a--;)t=o[a],o[a+2]|=255&t<<4,o[a+1]=t>>4;o[1]|=255&e<<4,o[0]=64|e>>4}for(a=e+3-(i<10);a<s;)o[a++]=236,o[a++]=17},_getBadness:function(e){var t,n=0,r=this._badness;for(t=0;t<=e;t++)r[t]>=5&&(n+=d.N1+r[t]-5);for(t=3;t<e-1;t+=2)r[t-2]===r[t+2]&&r[t+2]===r[t-1]&&r[t-1]===r[t+1]&&3*r[t-1]===r[t]&&(0===r[t-3]||t+3>e||3*r[t-3]>=4*r[t]||3*r[t+3]>=4*r[t])&&(n+=d.N3);return n},_finish:function(){var e,t;this._stringBuffer=this.buffer.slice();var n=0,r=3e4;for(t=0;t<8&&(this._applyMask(t),(e=this._checkBadness())<r&&(r=e,n=t),7!==n);t++)this.buffer=this._stringBuffer.slice();n!==t&&this._applyMask(n),r=l.FINAL_FORMAT[n+(this._level-1<<3)];var i=this.buffer,o=this.width;for(t=0;t<8;t++,r>>=1)1&r&&(i[o-1-t+8*o]=1,t<6?i[8+o*t]=1:i[8+o*(t+1)]=1);for(t=0;t<7;t++,r>>=1)1&r&&(i[8+o*(o-7+t)]=1,t?i[6-t+8*o]=1:i[7+8*o]=1)},_interleaveBlocks:function(){var e,t,n=this._dataBlock,r=this._ecc,i=this._eccBlock,o=0,s=this._calculateMaxLength(),a=this._neccBlock1,c=this._neccBlock2,u=this._stringBuffer;for(e=0;e<n;e++){for(t=0;t<a;t++)r[o++]=u[e+t*n];for(t=0;t<c;t++)r[o++]=u[a*n+e+t*(n+1)]}for(t=0;t<c;t++)r[o++]=u[a*n+e+t*(n+1)];for(e=0;e<i;e++)for(t=0;t<a+c;t++)r[o++]=u[s+e+t*i];this._stringBuffer=r},_insertAlignments:function(){var e,t,n,r=this._version,i=this.width;if(r>1)for(e=u.BLOCK[r],n=i-7;;){for(t=i-7;t>e-3&&(this._addAlignment(t,n),!(t<e));)t-=e;if(n<=e+9)break;n-=e,this._addAlignment(6,n),this._addAlignment(n,6)}},_insertFinders:function(){var e,t,n,r,i=this.buffer,o=this.width;for(e=0;e<3;e++){for(t=0,r=0,1===e&&(t=o-7),2===e&&(r=o-7),i[r+3+o*(t+3)]=1,n=0;n<6;n++)i[r+n+o*t]=1,i[r+o*(t+n+1)]=1,i[r+6+o*(t+n)]=1,i[r+n+1+o*(t+6)]=1;for(n=1;n<5;n++)this._setMask(r+n,t+1),this._setMask(r+1,t+n+1),this._setMask(r+5,t+n),this._setMask(r+n+1,t+5);for(n=2;n<4;n++)i[r+n+o*(t+2)]=1,i[r+2+o*(t+n+1)]=1,i[r+4+o*(t+n)]=1,i[r+n+1+o*(t+4)]=1}},_insertTimingGap:function(){var e,t,n=this.width;for(t=0;t<7;t++)this._setMask(7,t),this._setMask(n-8,t),this._setMask(7,t+n-7);for(e=0;e<8;e++)this._setMask(e,7),this._setMask(e+n-8,7),this._setMask(e,n-8)},_insertTimingRowAndColumn:function(){var e,t=this.buffer,n=this.width;for(e=0;e<n-14;e++)1&e?(this._setMask(8+e,6),this._setMask(6,8+e)):(t[8+e+6*n]=1,t[6+n*(8+e)]=1)},_insertVersion:function(){var e,t,n,r,i=this.buffer,o=this._version,s=this.width;if(o>6)for(e=h.BLOCK[o-7],t=17,n=0;n<6;n++)for(r=0;r<3;r++,t--)1&(t>11?o>>t-12:e>>t)?(i[5-n+s*(2-r+s-11)]=1,i[2-r+s-11+s*(5-n)]=1):(this._setMask(5-n,2-r+s-11),this._setMask(2-r+s-11,5-n))},_isMasked:function(e,t){var n=d._getMaskBit(e,t);return 1===this._mask[n]},_pack:function(){var e,t,n,r=1,i=1,o=this.width,s=o-1,a=o-1,c=(this._dataBlock+this._eccBlock)*(this._neccBlock1+this._neccBlock2)+this._neccBlock2;for(t=0;t<c;t++)for(e=this._stringBuffer[t],n=0;n<8;n++,e<<=1){128&e&&(this.buffer[s+o*a]=1);do{i?s--:(s++,r?0!==a?a--:(r=!r,6===(s-=2)&&(s--,a=9)):a!==o-1?a++:(r=!r,6===(s-=2)&&(s--,a-=8))),i=!i}while(this._isMasked(s,a))}},_reverseMask:function(){var e,t,n=this.width;for(e=0;e<9;e++)this._setMask(e,8);for(e=0;e<8;e++)this._setMask(e+n-8,8),this._setMask(8,e);for(t=0;t<7;t++)this._setMask(8,t+n-7)},_setMask:function(e,t){var n=d._getMaskBit(e,t);this._mask[n]=1},_syncMask:function(){var e,t,n=this.width;for(t=0;t<n;t++)for(e=0;e<=t;e++)this.buffer[e+n*t]&&this._setMask(e,t)}},{_createArray:function(e){var t,n=[];for(t=0;t<e;t++)n[t]=0;return n},_getMaskBit:function(e,t){var n;return e>t&&(n=e,e=t,t=n),n=t,n+=t*t,n>>=1,n+=e},_modN:function(e){for(;e>=255;)e=((e-=255)>>8)+(255&e);return e},N1:3,N2:3,N3:40,N4:10}),p=d,f=a.extend({draw:function(){this.element.src=this.qrious.toDataURL()},reset:function(){this.element.src=""},resize:function(){var e=this.element;e.width=e.height=this.qrious.size}}),g=s.extend((function(e,t,n,r){this.name=e,this.modifiable=Boolean(t),this.defaultValue=n,this._valueTransformer=r}),{transform:function(e){var t=this._valueTransformer;return"function"==typeof t?t(e,this):e}}),m=s.extend(null,{abs:function(e){return null!=e?Math.abs(e):null},hasOwn:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},noop:function(){},toUpperCase:function(e){return null!=e?e.toUpperCase():null}}),v=s.extend((function(e){this.options={},e.forEach((function(e){this.options[e.name]=e}),this)}),{exists:function(e){return null!=this.options[e]},get:function(e,t){return v._get(this.options[e],t)},getAll:function(e){var t,n=this.options,r={};for(t in n)m.hasOwn(n,t)&&(r[t]=v._get(n[t],e));return r},init:function(e,t,n){var r,i;for(r in"function"!=typeof n&&(n=m.noop),this.options)m.hasOwn(this.options,r)&&(i=this.options[r],v._set(i,i.defaultValue,t),v._createAccessor(i,t,n));this._setAll(e,t,!0)},set:function(e,t,n){return this._set(e,t,n)},setAll:function(e,t){return this._setAll(e,t)},_set:function(e,t,n,r){var i=this.options[e];if(!i)throw new Error("Invalid option: "+e);if(!i.modifiable&&!r)throw new Error("Option cannot be modified: "+e);return v._set(i,t,n)},_setAll:function(e,t,n){if(!e)return!1;var r,i=!1;for(r in e)m.hasOwn(e,r)&&this._set(r,e[r],t,n)&&(i=!0);return i}},{_createAccessor:function(e,t,n){var r={get:function(){return v._get(e,t)}};e.modifiable&&(r.set=function(r){v._set(e,r,t)&&n(r,e)}),Object.defineProperty(t,e.name,r)},_get:function(e,t){return t["_"+e.name]},_set:function(e,t,n){var r="_"+e.name,i=n[r],o=e.transform(null!=t?t:e.defaultValue);return n[r]=o,o!==i}}),y=v,_=s.extend((function(){this._services={}}),{getService:function(e){var t=this._services[e];if(!t)throw new Error("Service is not being managed with name: "+e);return t},setService:function(e,t){if(this._services[e])throw new Error("Service is already managed with name: "+e);t&&(this._services[e]=t)}}),E=new y([new g("background",!0,"white"),new g("backgroundAlpha",!0,1,m.abs),new g("element"),new g("foreground",!0,"black"),new g("foregroundAlpha",!0,1,m.abs),new g("level",!0,"L",m.toUpperCase),new g("mime",!0,"image/png"),new g("padding",!0,null,m.abs),new g("size",!0,100,m.abs),new g("value",!0,"")]),b=new _,w=s.extend((function(e){E.init(e,this,this.update.bind(this));var t=E.get("element",this),n=b.getService("element"),r=t&&n.isCanvas(t)?t:n.createCanvas(),i=t&&n.isImage(t)?t:n.createImage();this._canvasRenderer=new c(this,r,!0),this._imageRenderer=new f(this,i,i===t),this.update()}),{get:function(){return E.getAll(this)},set:function(e){E.setAll(e,this)&&this.update()},toDataURL:function(e){return this.canvas.toDataURL(e||this.mime)},update:function(){var e=new p({level:this.level,value:this.value});this._canvasRenderer.render(e),this._imageRenderer.render(e)}},{use:function(e){b.setService(e.getName(),e)}});Object.defineProperties(w.prototype,{canvas:{get:function(){return this._canvasRenderer.getElement()}},image:{get:function(){return this._imageRenderer.getElement()}}});var S=w,T=s.extend({getName:function(){}}).extend({createCanvas:function(){},createImage:function(){},getName:function(){return"element"},isCanvas:function(e){},isImage:function(e){}}).extend({createCanvas:function(){return document.createElement("canvas")},createImage:function(){return document.createElement("img")},isCanvas:function(e){return e instanceof HTMLCanvasElement},isImage:function(e){return e instanceof HTMLImageElement}});return S.use(new T),S})),
/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 */
function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).html2canvas=t()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function o(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||t)}for(var s=function(){function e(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r}return e.prototype.add=function(t,n,r,i){return new e(this.left+t,this.top+n,this.width+r,this.height+i)},e.fromClientRect=function(t,n){return new e(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height)},e.fromDOMRectList=function(t,n){var r=Array.from(n).find((function(e){return 0!==e.width}));return r?new e(r.left+t.windowBounds.left,r.top+t.windowBounds.top,r.width,r.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),a=function(e,t){return s.fromClientRect(e,t.getBoundingClientRect())},c=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],i=-1,o="";++i<n;){var s=e[i];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(i+1===n||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A="undefined"==typeof Uint8Array?[]:new Uint8Array(256),h=0;h<l.length;h++)A[l.charCodeAt(h)]=h;for(var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p="undefined"==typeof Uint8Array?[]:new Uint8Array(256),f=0;f<d.length;f++)p[d.charCodeAt(f)]=f;for(var g=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},m=function(){function e(e,t,n,r,i,o){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=i,this.data=o}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y="undefined"==typeof Uint8Array?[]:new Uint8Array(256),_=0;_<v.length;_++)y[v.charCodeAt(_)]=_;var E=10,b=13,w=15,S=17,T=18,C=19,R=20,I=21,O=22,x=24,N=25,B=26,L=27,D=28,M=30,P=32,k=33,U=34,F=35,H=37,V=38,Q=39,j=40,G=42,K=[9001,65288],W="Ã",z="Ã·",q=function(e,t){var n,r,i,o=function(e){var t,n,r,i,o,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),l=Array.isArray(u)?u:new Uint8Array(u);for(t=0;t<a;t+=4)n=p[e.charCodeAt(t)],r=p[e.charCodeAt(t+1)],i=p[e.charCodeAt(t+2)],o=p[e.charCodeAt(t+3)],l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|i>>2,l[c++]=(3&i)<<6|63&o;return u}(e),s=Array.isArray(o)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n}(o):new Uint32Array(o),a=Array.isArray(o)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n}(o):new Uint16Array(o),c=g(a,12,s[4]/2),u=2===s[5]?g(a,(24+s[4])/2):(n=s,r=Math.ceil((24+s[4])/4),n.slice?n.slice(r,i):new Uint32Array(Array.prototype.slice.call(n,r,i)));return new m(s[0],s[1],s[2],s[3],c,u)}("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),Y=[M,36],X=[1,2,3,5],J=[E,8],Z=[L,B],$=X.concat(J),ee=[V,Q,j,U,F],te=[w,b],ne=function(e,t,n,r){var i=r[n];if(Array.isArray(e)?-1!==e.indexOf(i):e===i)for(var o=n;o<=r.length;){if((c=r[++o])===t)return!0;if(c!==E)break}if(i===E)for(o=n;o>0;){var s=r[--o];if(Array.isArray(e)?-1!==e.indexOf(s):e===s)for(var a=n;a<=r.length;){var c;if((c=r[++a])===t)return!0;if(c!==E)break}if(s!==E)break}return!1},re=function(e,t){for(var n=e;n>=0;){var r=t[n];if(r!==E)return r;n--}return 0},ie=function(e,t,n,r,i){if(0===n[r])return W;var o=r-1;if(Array.isArray(i)&&!0===i[o])return W;var s=o-1,a=o+1,c=t[o],u=s>=0?t[s]:0,l=t[a];if(2===c&&3===l)return W;if(-1!==X.indexOf(c))return"!";if(-1!==X.indexOf(l))return W;if(-1!==J.indexOf(l))return W;if(8===re(o,t))return z;if(11===q.get(e[o]))return W;if((c===P||c===k)&&11===q.get(e[a]))return W;if(7===c||7===l)return W;if(9===c)return W;if(-1===[E,b,w].indexOf(c)&&9===l)return W;if(-1!==[S,T,C,x,D].indexOf(l))return W;if(re(o,t)===O)return W;if(ne(23,O,o,t))return W;if(ne([S,T],I,o,t))return W;if(ne(12,12,o,t))return W;if(c===E)return z;if(23===c||23===l)return W;if(16===l||16===c)return z;if(-1!==[b,w,I].indexOf(l)||14===c)return W;if(36===u&&-1!==te.indexOf(c))return W;if(c===D&&36===l)return W;if(l===R)return W;if(-1!==Y.indexOf(l)&&c===N||-1!==Y.indexOf(c)&&l===N)return W;if(c===L&&-1!==[H,P,k].indexOf(l)||-1!==[H,P,k].indexOf(c)&&l===B)return W;if(-1!==Y.indexOf(c)&&-1!==Z.indexOf(l)||-1!==Z.indexOf(c)&&-1!==Y.indexOf(l))return W;if(-1!==[L,B].indexOf(c)&&(l===N||-1!==[O,w].indexOf(l)&&t[a+1]===N)||-1!==[O,w].indexOf(c)&&l===N||c===N&&-1!==[N,D,x].indexOf(l))return W;if(-1!==[N,D,x,S,T].indexOf(l))for(var A=o;A>=0;){if((h=t[A])===N)return W;if(-1===[D,x].indexOf(h))break;A--}if(-1!==[L,B].indexOf(l))for(A=-1!==[S,T].indexOf(c)?s:o;A>=0;){var h;if((h=t[A])===N)return W;if(-1===[D,x].indexOf(h))break;A--}if(V===c&&-1!==[V,Q,U,F].indexOf(l)||-1!==[Q,U].indexOf(c)&&-1!==[Q,j].indexOf(l)||-1!==[j,F].indexOf(c)&&l===j)return W;if(-1!==ee.indexOf(c)&&-1!==[R,B].indexOf(l)||-1!==ee.indexOf(l)&&c===L)return W;if(-1!==Y.indexOf(c)&&-1!==Y.indexOf(l))return W;if(c===x&&-1!==Y.indexOf(l))return W;if(-1!==Y.concat(N).indexOf(c)&&l===O&&-1===K.indexOf(e[a])||-1!==Y.concat(N).indexOf(l)&&c===T)return W;if(41===c&&41===l){for(var d=n[o],p=1;d>0&&41===t[--d];)p++;if(p%2!=0)return W}return c===P&&l===k?W:z},oe=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var n=function(e,t){void 0===t&&(t="strict");var n=[],r=[],i=[];return e.forEach((function(e,o){var s=q.get(e);if(s>50?(i.push(!0),s-=50):i.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return r.push(o),n.push(16);if(4===s||11===s){if(0===o)return r.push(o),n.push(M);var a=n[o-1];return-1===$.indexOf(a)?(r.push(r[o-1]),n.push(a)):(r.push(o),n.push(M))}return r.push(o),31===s?n.push("strict"===t?I:H):s===G||29===s?n.push(M):43===s?e>=131072&&e<=196605||e>=196608&&e<=262141?n.push(H):n.push(M):void n.push(s)})),[r,n,i]}(e,t.lineBreak),r=n[0],i=n[1],o=n[2];"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(i=i.map((function(e){return-1!==[N,M,G].indexOf(e)?H:e})));var s="keep-all"===t.wordBreak?o.map((function(t,n){return t&&e[n]>=19968&&e[n]<=40959})):void 0;return[r,i,s]},se=function(){function e(e,t,n,r){this.codePoints=e,this.required="!"===t,this.start=n,this.end=r}return e.prototype.slice=function(){return u.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),ae=45,ce=43,ue=-1,le=function(e){return e>=48&&e<=57},Ae=function(e){return le(e)||e>=65&&e<=70||e>=97&&e<=102},he=function(e){return 10===e||9===e||32===e},de=function(e){return function(e){return function(e){return e>=97&&e<=122}(e)||function(e){return e>=65&&e<=90}(e)}(e)||function(e){return e>=128}(e)||95===e},pe=function(e){return de(e)||le(e)||e===ae},fe=function(e){return e>=0&&e<=8||11===e||e>=14&&e<=31||127===e},ge=function(e,t){return 92===e&&10!==t},me=function(e,t,n){return e===ae?de(t)||ge(t,n):!!de(e)||!(92!==e||!ge(e,t))},ve=function(e,t,n){return e===ce||e===ae?!!le(t)||46===t&&le(n):le(46===e?t:e)},ye=function(e){var t=0,n=1;e[t]!==ce&&e[t]!==ae||(e[t]===ae&&(n=-1),t++);for(var r=[];le(e[t]);)r.push(e[t++]);var i=r.length?parseInt(u.apply(void 0,r),10):0;46===e[t]&&t++;for(var o=[];le(e[t]);)o.push(e[t++]);var s=o.length,a=s?parseInt(u.apply(void 0,o),10):0;69!==e[t]&&101!==e[t]||t++;var c=1;e[t]!==ce&&e[t]!==ae||(e[t]===ae&&(c=-1),t++);for(var l=[];le(e[t]);)l.push(e[t++]);var A=l.length?parseInt(u.apply(void 0,l),10):0;return n*(i+a*Math.pow(10,-s))*Math.pow(10,c*A)},_e={type:2},Ee={type:3},be={type:4},we={type:13},Se={type:8},Te={type:21},Ce={type:9},Re={type:10},Ie={type:11},Oe={type:12},xe={type:14},Ne={type:23},Be={type:1},Le={type:25},De={type:24},Me={type:26},Pe={type:27},ke={type:28},Ue={type:29},Fe={type:31},He={type:32},Ve=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(c(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==He;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case 34:return this.consumeStringToken(34);case 35:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),r=this.peekCodePoint(2);if(pe(t)||ge(n,r)){var i=me(t,n,r)?2:1;return{type:5,value:this.consumeName(),flags:i}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),we;break;case 39:return this.consumeStringToken(39);case 40:return _e;case 41:return Ee;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),xe;break;case ce:if(ve(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 44:return be;case ae:var o=e,s=this.peekCodePoint(0),a=this.peekCodePoint(1);if(ve(o,s,a))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(me(o,s,a))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(s===ae&&62===a)return this.consumeCodePoint(),this.consumeCodePoint(),De;break;case 46:if(ve(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var c=this.consumeCodePoint();if(42===c&&47===(c=this.consumeCodePoint()))return this.consumeToken();if(c===ue)return this.consumeToken()}break;case 58:return Me;case 59:return Pe;case 60:if(33===this.peekCodePoint(0)&&this.peekCodePoint(1)===ae&&this.peekCodePoint(2)===ae)return this.consumeCodePoint(),this.consumeCodePoint(),Le;break;case 64:var l=this.peekCodePoint(0),A=this.peekCodePoint(1),h=this.peekCodePoint(2);if(me(l,A,h))return{type:7,value:this.consumeName()};break;case 91:return ke;case 92:if(ge(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case 93:return Ue;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Se;break;case 123:return Ie;case 125:return Oe;case 117:case 85:var d=this.peekCodePoint(0),p=this.peekCodePoint(1);return d!==ce||!Ae(p)&&63!==p||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ce;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),Te;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Re;break;case ue:return He}return he(e)?(this.consumeWhiteSpace(),Fe):le(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):de(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:u(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();Ae(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;63===t&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n)return{type:30,start:parseInt(u.apply(void 0,e.map((function(e){return 63===e?48:e}))),16),end:parseInt(u.apply(void 0,e.map((function(e){return 63===e?70:e}))),16)};var r=parseInt(u.apply(void 0,e),16);if(this.peekCodePoint(0)===ae&&Ae(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var i=[];Ae(t)&&i.length<6;)i.push(t),t=this.consumeCodePoint();return{type:30,start:r,end:parseInt(u.apply(void 0,i),16)}}return{type:30,start:r,end:r}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===ue)return{type:22,value:""};var t=this.peekCodePoint(0);if(39===t||34===t){var n=this.consumeStringToken(this.consumeCodePoint());return 0===n.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===ue||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),Ne)}for(;;){var r=this.consumeCodePoint();if(r===ue||41===r)return{type:22,value:u.apply(void 0,e)};if(he(r))return this.consumeWhiteSpace(),this.peekCodePoint(0)===ue||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:22,value:u.apply(void 0,e)}):(this.consumeBadUrlRemnants(),Ne);if(34===r||39===r||40===r||fe(r))return this.consumeBadUrlRemnants(),Ne;if(92===r){if(!ge(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),Ne;e.push(this.consumeEscapedCodePoint())}else e.push(r)}},e.prototype.consumeWhiteSpace=function(){for(;he(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(41===e||e===ue)return;ge(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t="";e>0;){var n=Math.min(5e4,e);t+=u.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),t},e.prototype.consumeStringToken=function(e){for(var t="",n=0;;){var r=this._value[n];if(r===ue||void 0===r||r===e)return{type:0,value:t+=this.consumeStringSlice(n)};if(10===r)return this._value.splice(0,n),Be;if(92===r){var i=this._value[n+1];i!==ue&&void 0!==i&&(10===i?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):ge(r,i)&&(t+=this.consumeStringSlice(n),t+=u(this.consumeEscapedCodePoint()),n=-1))}n++}},e.prototype.consumeNumber=function(){var e=[],t=4,n=this.peekCodePoint(0);for(n!==ce&&n!==ae||e.push(this.consumeCodePoint());le(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(46===n&&le(r))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;le(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),r=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((69===n||101===n)&&((r===ce||r===ae)&&le(i)||le(r)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;le(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[ye(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],r=this.peekCodePoint(0),i=this.peekCodePoint(1),o=this.peekCodePoint(2);return me(r,i,o)?{type:15,number:t,flags:n,unit:this.consumeName()}:37===r?(this.consumeCodePoint(),{type:16,number:t,flags:n}):{type:17,number:t,flags:n}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(Ae(e)){for(var t=u(e);Ae(this.peekCodePoint(0))&&t.length<6;)t+=u(this.consumeCodePoint());he(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return 0===n||function(e){return e>=55296&&e<=57343}(n)||n>1114111?65533:n}return e===ue?65533:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(pe(t))e+=u(t);else{if(!ge(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=u(this.consumeEscapedCodePoint())}}},e}(),Qe=function(){function e(e){this._tokens=e}return e.create=function(t){var n=new Ve;return n.write(t),new e(n.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();31===e.type;)e=this.consumeToken();if(32===e.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(31===e.type);if(32===e.type)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(32===t.type)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(32===n.type||Je(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(32===n.type||3===n.type)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?He:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),je=function(e){return 15===e.type},Ge=function(e){return 17===e.type},Ke=function(e){return 20===e.type},We=function(e){return 0===e.type},ze=function(e,t){return Ke(e)&&e.value===t},qe=function(e){return 31!==e.type},Ye=function(e){return 31!==e.type&&4!==e.type},Xe=function(e){var t=[],n=[];return e.forEach((function(e){if(4===e.type){if(0===n.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(n),void(n=[])}31!==e.type&&n.push(e)})),n.length&&t.push(n),t},Je=function(e,t){return 11===t&&12===e.type||(28===t&&29===e.type||2===t&&3===e.type)},Ze=function(e){return 17===e.type||15===e.type},$e=function(e){return 16===e.type||Ze(e)},et=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},tt={type:17,number:0,flags:4},nt={type:16,number:50,flags:4},rt={type:16,number:100,flags:4},it=function(e,t,n){var r=e[0],i=e[1];return[ot(r,t),ot(void 0!==i?i:r,n)]},ot=function(e,t){if(16===e.type)return e.number/100*t;if(je(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},st="grad",at="turn",ct=function(e,t){if(15===t.type)switch(t.unit){case"deg":return Math.PI*t.number/180;case st:return Math.PI/200*t.number;case"rad":return t.number;case at:return 2*Math.PI*t.number}throw new Error("Unsupported angle type")},ut=function(e){return 15===e.type&&("deg"===e.unit||e.unit===st||"rad"===e.unit||e.unit===at)},lt=function(e){switch(e.filter(Ke).map((function(e){return e.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[tt,tt];case"to top":case"bottom":return At(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[tt,rt];case"to right":case"left":return At(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[rt,rt];case"to bottom":case"top":return At(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[rt,tt];case"to left":case"right":return At(270)}return 0},At=function(e){return Math.PI*e/180},ht=function(e,t){if(18===t.type){var n=_t[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return n(e,t.values)}if(5===t.type){if(3===t.value.length){var r=t.value.substring(0,1),i=t.value.substring(1,2),o=t.value.substring(2,3);return ft(parseInt(r+r,16),parseInt(i+i,16),parseInt(o+o,16),1)}if(4===t.value.length){r=t.value.substring(0,1),i=t.value.substring(1,2),o=t.value.substring(2,3);var s=t.value.substring(3,4);return ft(parseInt(r+r,16),parseInt(i+i,16),parseInt(o+o,16),parseInt(s+s,16)/255)}if(6===t.value.length){r=t.value.substring(0,2),i=t.value.substring(2,4),o=t.value.substring(4,6);return ft(parseInt(r,16),parseInt(i,16),parseInt(o,16),1)}if(8===t.value.length){r=t.value.substring(0,2),i=t.value.substring(2,4),o=t.value.substring(4,6),s=t.value.substring(6,8);return ft(parseInt(r,16),parseInt(i,16),parseInt(o,16),parseInt(s,16)/255)}}if(20===t.type){var a=bt[t.value.toUpperCase()];if(void 0!==a)return a}return bt.TRANSPARENT},dt=function(e){return 0==(255&e)},pt=function(e){var t=255&e,n=255&e>>8,r=255&e>>16,i=255&e>>24;return t<255?"rgba("+i+","+r+","+n+","+t/255+")":"rgb("+i+","+r+","+n+")"},ft=function(e,t,n,r){return(e<<24|t<<16|n<<8|Math.round(255*r)<<0)>>>0},gt=function(e,t){if(17===e.type)return e.number;if(16===e.type){var n=3===t?1:255;return 3===t?e.number/100*n:Math.round(e.number/100*n)}return 0},mt=function(e,t){var n=t.filter(Ye);if(3===n.length){var r=n.map(gt),i=r[0],o=r[1],s=r[2];return ft(i,o,s,1)}if(4===n.length){var a=n.map(gt),c=(i=a[0],o=a[1],s=a[2],a[3]);return ft(i,o,s,c)}return 0};function vt(e,t,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(t-e)*n*6+e:n<.5?t:n<2/3?6*(t-e)*(2/3-n)+e:e}var yt=function(e,t){var n=t.filter(Ye),r=n[0],i=n[1],o=n[2],s=n[3],a=(17===r.type?At(r.number):ct(e,r))/(2*Math.PI),c=$e(i)?i.number/100:0,u=$e(o)?o.number/100:0,l=void 0!==s&&$e(s)?ot(s,1):1;if(0===c)return ft(255*u,255*u,255*u,1);var A=u<=.5?u*(c+1):u+c-u*c,h=2*u-A,d=vt(h,A,a+1/3),p=vt(h,A,a),f=vt(h,A,a-1/3);return ft(255*d,255*p,255*f,l)},_t={hsl:yt,hsla:yt,rgb:mt,rgba:mt},Et=function(e,t){return ht(e,Qe.create(t).parseComponentValue())},bt={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},wt={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Ke(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},St={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Tt=function(e,t){var n=ht(e,t[0]),r=t[1];return r&&$e(r)?{color:n,stop:r}:{color:n,stop:null}},Ct=function(e,t){var n=e[0],r=e[e.length-1];null===n.stop&&(n.stop=tt),null===r.stop&&(r.stop=rt);for(var i=[],o=0,s=0;s<e.length;s++){var a=e[s].stop;if(null!==a){var c=ot(a,t);c>o?i.push(c):i.push(o),o=c}else i.push(null)}var u=null;for(s=0;s<i.length;s++){var l=i[s];if(null===l)null===u&&(u=s);else if(null!==u){for(var A=s-u,h=(l-i[u-1])/(A+1),d=1;d<=A;d++)i[u+d-1]=h*d;u=null}}return e.map((function(e,n){return{color:e.color,stop:Math.max(Math.min(1,i[n]/t),0)}}))},Rt=function(e,t,n){var r="number"==typeof e?e:function(e,t,n){var r=t/2,i=n/2,o=ot(e[0],t)-r,s=i-ot(e[1],n);return(Math.atan2(s,o)+2*Math.PI)%(2*Math.PI)}(e,t,n),i=Math.abs(t*Math.sin(r))+Math.abs(n*Math.cos(r)),o=t/2,s=n/2,a=i/2,c=Math.sin(r-Math.PI/2)*a,u=Math.cos(r-Math.PI/2)*a;return[i,o-u,o+u,s-c,s+c]},It=function(e,t){return Math.sqrt(e*e+t*t)},Ot=function(e,t,n,r,i){return[[0,0],[0,t],[e,0],[e,t]].reduce((function(e,t){var o=t[0],s=t[1],a=It(n-o,r-s);return(i?a<e.optimumDistance:a>e.optimumDistance)?{optimumCorner:t,optimumDistance:a}:e}),{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},xt=function(e,t){var n=At(180),r=[];return Xe(t).forEach((function(t,i){if(0===i){var o=t[0];if(20===o.type&&-1!==["top","left","right","bottom"].indexOf(o.value))return void(n=lt(t));if(ut(o))return void(n=(ct(e,o)+At(270))%At(360))}var s=Tt(e,t);r.push(s)})),{angle:n,stops:r,type:1}},Nt="closest-side",Bt="farthest-side",Lt="closest-corner",Dt="farthest-corner",Mt="circle",Pt="ellipse",kt="cover",Ut="contain",Ft=function(e,t){var n=0,r=3,i=[],o=[];return Xe(t).forEach((function(t,s){var a=!0;if(0===s?a=t.reduce((function(e,t){if(Ke(t))switch(t.value){case"center":return o.push(nt),!1;case"top":case"left":return o.push(tt),!1;case"right":case"bottom":return o.push(rt),!1}else if($e(t)||Ze(t))return o.push(t),!1;return e}),a):1===s&&(a=t.reduce((function(e,t){if(Ke(t))switch(t.value){case Mt:return n=0,!1;case Pt:return n=1,!1;case Ut:case Nt:return r=0,!1;case Bt:return r=1,!1;case Lt:return r=2,!1;case kt:case Dt:return r=3,!1}else if(Ze(t)||$e(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),a)),a){var c=Tt(e,t);i.push(c)}})),{size:r,shape:n,stops:i,position:o,type:2}},Ht=function(e,t){if(22===t.type){var n={url:t.value,type:0};return e.cache.addImage(t.value),n}if(18===t.type){var r=Qt[t.name];if(void 0===r)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return r(e,t.values)}throw new Error("Unsupported image type "+t.type)};var Vt,Qt={"linear-gradient":function(e,t){var n=At(180),r=[];return Xe(t).forEach((function(t,i){if(0===i){var o=t[0];if(20===o.type&&"to"===o.value)return void(n=lt(t));if(ut(o))return void(n=ct(e,o))}var s=Tt(e,t);r.push(s)})),{angle:n,stops:r,type:1}},"-moz-linear-gradient":xt,"-ms-linear-gradient":xt,"-o-linear-gradient":xt,"-webkit-linear-gradient":xt,"radial-gradient":function(e,t){var n=0,r=3,i=[],o=[];return Xe(t).forEach((function(t,s){var a=!0;if(0===s){var c=!1;a=t.reduce((function(e,t){if(c)if(Ke(t))switch(t.value){case"center":return o.push(nt),e;case"top":case"left":return o.push(tt),e;case"right":case"bottom":return o.push(rt),e}else($e(t)||Ze(t))&&o.push(t);else if(Ke(t))switch(t.value){case Mt:return n=0,!1;case Pt:return n=1,!1;case"at":return c=!0,!1;case Nt:return r=0,!1;case kt:case Bt:return r=1,!1;case Ut:case Lt:return r=2,!1;case Dt:return r=3,!1}else if(Ze(t)||$e(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),a)}if(a){var u=Tt(e,t);i.push(u)}})),{size:r,shape:n,stops:i,position:o,type:2}},"-moz-radial-gradient":Ft,"-ms-radial-gradient":Ft,"-o-radial-gradient":Ft,"-webkit-radial-gradient":Ft,"-webkit-gradient":function(e,t){var n=At(180),r=[],i=1;return Xe(t).forEach((function(t,n){var o=t[0];if(0===n){if(Ke(o)&&"linear"===o.value)return void(i=1);if(Ke(o)&&"radial"===o.value)return void(i=2)}if(18===o.type)if("from"===o.name){var s=ht(e,o.values[0]);r.push({stop:tt,color:s})}else if("to"===o.name){s=ht(e,o.values[0]);r.push({stop:rt,color:s})}else if("color-stop"===o.name){var a=o.values.filter(Ye);if(2===a.length){s=ht(e,a[1]);var c=a[0];Ge(c)&&r.push({stop:{type:16,number:100*c.number,flags:c.flags},color:s})}}})),1===i?{angle:(n+At(180))%At(360),stops:r,type:i}:{size:3,shape:0,stops:r,position:[],type:i}}},jt={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t.filter((function(e){return Ye(e)&&function(e){return!(20===e.type&&"none"===e.value||18===e.type&&!Qt[e.name])}(e)})).map((function(t){return Ht(e,t)}))}},Gt={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Ke(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Kt={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return Xe(t).map((function(e){return e.filter($e)})).map(et)}},Wt={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return Xe(t).map((function(e){return e.filter(Ke).map((function(e){return e.value})).join(" ")})).map(zt)}},zt=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(Vt||(Vt={}));var qt,Yt={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return Xe(t).map((function(e){return e.filter(Xt)}))}},Xt=function(e){return Ke(e)||$e(e)},Jt=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Zt=Jt("top"),$t=Jt("right"),en=Jt("bottom"),tn=Jt("left"),nn=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return et(t.filter($e))}}},rn=nn("top-left"),on=nn("top-right"),sn=nn("bottom-right"),an=nn("bottom-left"),cn=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},un=cn("top"),ln=cn("right"),An=cn("bottom"),hn=cn("left"),dn=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return je(t)?t.number:0}}},pn=dn("top"),fn=dn("right"),gn=dn("bottom"),mn=dn("left"),vn={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},yn={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){return"rtl"===t?1:0}},_n={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(Ke).reduce((function(e,t){return e|En(t.value)}),0)}},En=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},bn={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},wn={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return 20===t.type&&"normal"===t.value?0:17===t.type||15===t.type?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(qt||(qt={}));var Sn,Tn={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"strict"===t?qt.STRICT:qt.NORMAL}},Cn={name:"line-height",initialValue:"normal",prefix:!1,type:4},Rn=function(e,t){return Ke(e)&&"normal"===e.value?1.2*t:17===e.type?t*e.number:$e(e)?ot(e,t):t},In={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return 20===t.type&&"none"===t.value?null:Ht(e,t)}},On={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){return"inside"===t?0:1}},xn={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},Nn=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},Bn=Nn("top"),Ln=Nn("right"),Dn=Nn("bottom"),Mn=Nn("left"),Pn={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(Ke).map((function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}}))}},kn={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"break-word"===t?"break-word":"normal"}},Un=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Fn=Un("top"),Hn=Un("right"),Vn=Un("bottom"),Qn=Un("left"),jn={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Gn={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Kn={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&ze(t[0],"none")?[]:Xe(t).map((function(t){for(var n={color:bt.TRANSPARENT,offsetX:tt,offsetY:tt,blur:tt},r=0,i=0;i<t.length;i++){var o=t[i];Ze(o)?(0===r?n.offsetX=o:1===r?n.offsetY=o:n.blur=o,r++):n.color=ht(e,o)}return n}))}},Wn={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},zn={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(20===t.type&&"none"===t.value)return null;if(18===t.type){var n=qn[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return n(t.values)}return null}},qn={matrix:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number}));return 6===t.length?t:null},matrix3d:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number})),n=t[0],r=t[1];t[2],t[3];var i=t[4],o=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var s=t[12],a=t[13];return t[14],t[15],16===t.length?[n,r,i,o,s,a]:null}},Yn={type:16,number:50,flags:4},Xn=[Yn,Yn],Jn={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var n=t.filter($e);return 2!==n.length?Xn:[n[0],n[1]]}},Zn={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(Sn||(Sn={}));for(var $n={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return Sn.BREAK_ALL;case"keep-all":return Sn.KEEP_ALL;default:return Sn.NORMAL}}},er={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(20===t.type)return{auto:!0,order:0};if(Ge(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},tr=function(e,t){if(15===t.type)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")},nr={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return Ge(t)?t.number:1}},rr={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},ir={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(Ke).map((function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(e){return 0!==e}))}},or={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var n=[],r=[];return t.forEach((function(e){switch(e.type){case 20:case 0:n.push(e.value);break;case 17:n.push(e.number.toString());break;case 4:r.push(n.join(" ")),n.length=0}})),n.length&&r.push(n.join(" ")),r.map((function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"}))}},sr={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},ar={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){return Ge(t)?t.number:Ke(t)&&"bold"===t.value?700:400}},cr={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(Ke).map((function(e){return e.value}))}},ur={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},lr=function(e,t){return 0!=(e&t)},Ar={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t}},hr={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;for(var r=[],i=t.filter(qe),o=0;o<i.length;o++){var s=i[o],a=i[o+1];if(20===s.type){var c=a&&Ge(a)?a.number:1;r.push({counter:s.value,increment:c})}}return r}},dr={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return[];for(var n=[],r=t.filter(qe),i=0;i<r.length;i++){var o=r[i],s=r[i+1];if(Ke(o)&&"none"!==o.value){var a=s&&Ge(s)?s.number:0;n.push({counter:o.value,reset:a})}}return n}},pr={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(je).map((function(t){return tr(e,t)}))}},fr={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;var r=[],i=t.filter(We);if(i.length%2!=0)return null;for(var o=0;o<i.length;o+=2){var s=i[o].value,a=i[o+1].value;r.push({open:s,close:a})}return r}},gr=function(e,t,n){if(!e)return"";var r=e[Math.min(t,e.length-1)];return r?n?r.open:r.close:""},mr={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&ze(t[0],"none")?[]:Xe(t).map((function(t){for(var n={color:255,offsetX:tt,offsetY:tt,blur:tt,spread:tt,inset:!1},r=0,i=0;i<t.length;i++){var o=t[i];ze(o,"inset")?n.inset=!0:Ze(o)?(0===r?n.offsetX=o:1===r?n.offsetY=o:2===r?n.blur=o:n.spread=o,r++):n.color=ht(e,o)}return n}))}},vr={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var n=[];return t.filter(Ke).forEach((function(e){switch(e.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2)}})),[0,1,2].forEach((function(e){-1===n.indexOf(e)&&n.push(e)})),n}},yr={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},_r={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return je(t)?t.number:0}},Er=function(){function e(e,t){var n,r;this.animationDuration=Sr(e,pr,t.animationDuration),this.backgroundClip=Sr(e,wt,t.backgroundClip),this.backgroundColor=Sr(e,St,t.backgroundColor),this.backgroundImage=Sr(e,jt,t.backgroundImage),this.backgroundOrigin=Sr(e,Gt,t.backgroundOrigin),this.backgroundPosition=Sr(e,Kt,t.backgroundPosition),this.backgroundRepeat=Sr(e,Wt,t.backgroundRepeat),this.backgroundSize=Sr(e,Yt,t.backgroundSize),this.borderTopColor=Sr(e,Zt,t.borderTopColor),this.borderRightColor=Sr(e,$t,t.borderRightColor),this.borderBottomColor=Sr(e,en,t.borderBottomColor),this.borderLeftColor=Sr(e,tn,t.borderLeftColor),this.borderTopLeftRadius=Sr(e,rn,t.borderTopLeftRadius),this.borderTopRightRadius=Sr(e,on,t.borderTopRightRadius),this.borderBottomRightRadius=Sr(e,sn,t.borderBottomRightRadius),this.borderBottomLeftRadius=Sr(e,an,t.borderBottomLeftRadius),this.borderTopStyle=Sr(e,un,t.borderTopStyle),this.borderRightStyle=Sr(e,ln,t.borderRightStyle),this.borderBottomStyle=Sr(e,An,t.borderBottomStyle),this.borderLeftStyle=Sr(e,hn,t.borderLeftStyle),this.borderTopWidth=Sr(e,pn,t.borderTopWidth),this.borderRightWidth=Sr(e,fn,t.borderRightWidth),this.borderBottomWidth=Sr(e,gn,t.borderBottomWidth),this.borderLeftWidth=Sr(e,mn,t.borderLeftWidth),this.boxShadow=Sr(e,mr,t.boxShadow),this.color=Sr(e,vn,t.color),this.direction=Sr(e,yn,t.direction),this.display=Sr(e,_n,t.display),this.float=Sr(e,bn,t.cssFloat),this.fontFamily=Sr(e,or,t.fontFamily),this.fontSize=Sr(e,sr,t.fontSize),this.fontStyle=Sr(e,ur,t.fontStyle),this.fontVariant=Sr(e,cr,t.fontVariant),this.fontWeight=Sr(e,ar,t.fontWeight),this.letterSpacing=Sr(e,wn,t.letterSpacing),this.lineBreak=Sr(e,Tn,t.lineBreak),this.lineHeight=Sr(e,Cn,t.lineHeight),this.listStyleImage=Sr(e,In,t.listStyleImage),this.listStylePosition=Sr(e,On,t.listStylePosition),this.listStyleType=Sr(e,xn,t.listStyleType),this.marginTop=Sr(e,Bn,t.marginTop),this.marginRight=Sr(e,Ln,t.marginRight),this.marginBottom=Sr(e,Dn,t.marginBottom),this.marginLeft=Sr(e,Mn,t.marginLeft),this.opacity=Sr(e,nr,t.opacity);var i=Sr(e,Pn,t.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=Sr(e,kn,t.overflowWrap),this.paddingTop=Sr(e,Fn,t.paddingTop),this.paddingRight=Sr(e,Hn,t.paddingRight),this.paddingBottom=Sr(e,Vn,t.paddingBottom),this.paddingLeft=Sr(e,Qn,t.paddingLeft),this.paintOrder=Sr(e,vr,t.paintOrder),this.position=Sr(e,Gn,t.position),this.textAlign=Sr(e,jn,t.textAlign),this.textDecorationColor=Sr(e,rr,null!==(n=t.textDecorationColor)&&void 0!==n?n:t.color),this.textDecorationLine=Sr(e,ir,null!==(r=t.textDecorationLine)&&void 0!==r?r:t.textDecoration),this.textShadow=Sr(e,Kn,t.textShadow),this.textTransform=Sr(e,Wn,t.textTransform),this.transform=Sr(e,zn,t.transform),this.transformOrigin=Sr(e,Jn,t.transformOrigin),this.visibility=Sr(e,Zn,t.visibility),this.webkitTextStrokeColor=Sr(e,yr,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=Sr(e,_r,t.webkitTextStrokeWidth),this.wordBreak=Sr(e,$n,t.wordBreak),this.zIndex=Sr(e,er,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},e.prototype.isTransparent=function(){return dt(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return 0!==this.position},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return 0!==this.float},e.prototype.isInlineLevel=function(){return lr(this.display,4)||lr(this.display,33554432)||lr(this.display,268435456)||lr(this.display,536870912)||lr(this.display,67108864)||lr(this.display,134217728)},e}(),br=function(e,t){this.content=Sr(e,Ar,t.content),this.quotes=Sr(e,fr,t.quotes)},wr=function(e,t){this.counterIncrement=Sr(e,hr,t.counterIncrement),this.counterReset=Sr(e,dr,t.counterReset)},Sr=function(e,t,n){var r=new Ve,i=null!=n?n.toString():t.initialValue;r.write(i);var o=new Qe(r.read());switch(t.type){case 2:var s=o.parseComponentValue();return t.parse(e,Ke(s)?s.value:t.initialValue);case 0:return t.parse(e,o.parseComponentValue());case 1:return t.parse(e,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(t.format){case"angle":return ct(e,o.parseComponentValue());case"color":return ht(e,o.parseComponentValue());case"image":return Ht(e,o.parseComponentValue());case"length":var a=o.parseComponentValue();return Ze(a)?a:tt;case"length-percentage":var c=o.parseComponentValue();return $e(c)?c:tt;case"time":return tr(e,o.parseComponentValue())}}},Tr=function(e,t){var n=function(e){switch(e.getAttribute("data-html2canvas-debug")){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}}(e);return 1===n||t===n},Cr=function(e,t){this.context=e,this.textNodes=[],this.elements=[],this.flags=0,Tr(t,3),this.styles=new Er(e,window.getComputedStyle(t,null)),xi(t)&&(this.styles.animationDuration.some((function(e){return e>0}))&&(t.style.animationDuration="0s"),null!==this.styles.transform&&(t.style.transform="none")),this.bounds=a(this.context,t),Tr(t,4)&&(this.flags|=16)},Rr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ir="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Or=0;Or<Rr.length;Or++)Ir[Rr.charCodeAt(Or)]=Or;for(var xr=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},Nr=function(){function e(e,t,n,r,i,o){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=i,this.data=o}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),Br="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Lr="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Dr=0;Dr<Br.length;Dr++)Lr[Br.charCodeAt(Dr)]=Dr;var Mr,Pr=8,kr=9,Ur=11,Fr=12,Hr=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],i=-1,o="";++i<n;){var s=e[i];s<=65535?r.push(s):(s-=65536,r.push(55296+(s>>10),s%1024+56320)),(i+1===n||r.length>16384)&&(o+=String.fromCharCode.apply(String,r),r.length=0)}return o},Vr=function(e,t){var n,r,i,o=function(e){var t,n,r,i,o,s=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(s--,"="===e[e.length-2]&&s--);var u="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(s):new Array(s),l=Array.isArray(u)?u:new Uint8Array(u);for(t=0;t<a;t+=4)n=Ir[e.charCodeAt(t)],r=Ir[e.charCodeAt(t+1)],i=Ir[e.charCodeAt(t+2)],o=Ir[e.charCodeAt(t+3)],l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|i>>2,l[c++]=(3&i)<<6|63&o;return u}(e),s=Array.isArray(o)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n}(o):new Uint32Array(o),a=Array.isArray(o)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n}(o):new Uint16Array(o),c=xr(a,12,s[4]/2),u=2===s[5]?xr(a,(24+s[4])/2):(n=s,r=Math.ceil((24+s[4])/4),n.slice?n.slice(r,i):new Uint32Array(Array.prototype.slice.call(n,r,i)));return new Nr(s[0],s[1],s[2],s[3],c,u)}("AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA="),Qr="Ã",jr=function(e){return Vr.get(e)},Gr=function(e,t,n){var r=n-2,i=t[r],o=t[n-1],s=t[n];if(2===o&&3===s)return Qr;if(2===o||3===o||4===o)return"Ã·";if(2===s||3===s||4===s)return"Ã·";if(o===Pr&&-1!==[Pr,kr,Ur,Fr].indexOf(s))return Qr;if(!(o!==Ur&&o!==kr||s!==kr&&10!==s))return Qr;if((o===Fr||10===o)&&10===s)return Qr;if(13===s||5===s)return Qr;if(7===s)return Qr;if(1===o)return Qr;if(13===o&&14===s){for(;5===i;)i=t[--r];if(14===i)return Qr}if(15===o&&15===s){for(var a=0;15===i;)a++,i=t[--r];if(a%2==0)return Qr}return"Ã·"},Kr=function(e){var t=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=e.charCodeAt(n++);56320==(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),n--)}else t.push(i)}return t}(e),n=t.length,r=0,i=0,o=t.map(jr);return{next:function(){if(r>=n)return{done:!0,value:null};for(var e=Qr;r<n&&(e=Gr(0,o,++r))===Qr;);if(e!==Qr||r===n){var s=Hr.apply(null,t.slice(i,r));return i=r,{value:s,done:!1}}return{done:!0,value:null}}}},Wr=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},zr=function(e,t,n,r,i){var o="http://www.w3.org/2000/svg",s=document.createElementNS(o,"svg"),a=document.createElementNS(o,"foreignObject");return s.setAttributeNS(null,"width",e.toString()),s.setAttributeNS(null,"height",t.toString()),a.setAttributeNS(null,"width","100%"),a.setAttributeNS(null,"height","100%"),a.setAttributeNS(null,"x",n.toString()),a.setAttributeNS(null,"y",r.toString()),a.setAttributeNS(null,"externalResourcesRequired","true"),s.appendChild(a),a.appendChild(i),s},qr=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},Yr={get SUPPORT_RANGE_BOUNDS(){var e=function(e){if(e.createRange){var t=e.createRange();if(t.getBoundingClientRect){var n=e.createElement("boundtest");n.style.height="123px",n.style.display="block",e.body.appendChild(n),t.selectNode(n);var r=t.getBoundingClientRect(),i=Math.round(r.height);if(e.body.removeChild(n),123===i)return!0}}return!1}(document);return Object.defineProperty(Yr,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Yr.SUPPORT_RANGE_BOUNDS&&function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var n=e.createRange();t.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var r=t.firstChild,i=c(r.data).map((function(e){return u(e)})),o=0,s={},a=i.every((function(e,t){n.setStart(r,o),n.setEnd(r,o+e.length);var i=n.getBoundingClientRect();o+=e.length;var a=i.x>s.x||i.y>s.y;return s=i,0===t||a}));return e.body.removeChild(t),a}(document);return Object.defineProperty(Yr,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=function(e){var t=new Image,n=e.createElement("canvas"),r=n.getContext("2d");if(!r)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(t,0,0),n.toDataURL()}catch(e){return!1}return!0}(document);return Object.defineProperty(Yr,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?function(e){var t=e.createElement("canvas"),n=100;t.width=n,t.height=n;var r=t.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,n,n);var i=new Image,o=t.toDataURL();i.src=o;var s=zr(n,n,0,0,i);return r.fillStyle="red",r.fillRect(0,0,n,n),qr(s).then((function(t){r.drawImage(t,0,0);var i=r.getImageData(0,0,n,n).data;r.fillStyle="red",r.fillRect(0,0,n,n);var s=e.createElement("div");return s.style.backgroundImage="url("+o+")",s.style.height="100px",Wr(i)?qr(zr(n,n,0,0,s)):Promise.reject(!1)})).then((function(e){return r.drawImage(e,0,0),Wr(r.getImageData(0,0,n,n).data)})).catch((function(){return!1}))}(document):Promise.resolve(!1);return Object.defineProperty(Yr,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=void 0!==(new Image).crossOrigin;return Object.defineProperty(Yr,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Yr,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Yr,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(Yr,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},Xr=function(e,t){this.text=e,this.bounds=t},Jr=function(e,t){var n=t.ownerDocument;if(n){var r=n.createElement("html2canvaswrapper");r.appendChild(t.cloneNode(!0));var i=t.parentNode;if(i){i.replaceChild(r,t);var o=a(e,r);return r.firstChild&&i.replaceChild(r.firstChild,r),o}}return s.EMPTY},Zr=function(e,t,n){var r=e.ownerDocument;if(!r)throw new Error("Node has no owner document");var i=r.createRange();return i.setStart(e,t),i.setEnd(e,t+n),i},$r=function(e){if(Yr.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map((function(e){return e.segment}))}return function(e){for(var t,n=Kr(e),r=[];!(t=n.next()).done;)t.value&&r.push(t.value.slice());return r}(e)},ei=function(e,t){return 0!==t.letterSpacing?$r(e):function(e,t){if(Yr.SUPPORT_NATIVE_TEXT_SEGMENTATION){var n=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(n.segment(e)).map((function(e){return e.segment}))}return ni(e,t)}(e,t)},ti=[32,160,4961,65792,65793,4153,4241],ni=function(e,t){for(var n,r=function(e,t){var n=c(e),r=oe(n,t),i=r[0],o=r[1],s=r[2],a=n.length,u=0,l=0;return{next:function(){if(l>=a)return{done:!0,value:null};for(var e=W;l<a&&(e=ie(n,o,i,++l,s))===W;);if(e!==W||l===a){var t=new se(n,e,u,l);return u=l,{value:t,done:!1}}return{done:!0,value:null}}}}(e,{lineBreak:t.lineBreak,wordBreak:"break-word"===t.overflowWrap?"break-word":t.wordBreak}),i=[],o=function(){if(n.value){var e=n.value.slice(),t=c(e),r="";t.forEach((function(e){-1===ti.indexOf(e)?r+=u(e):(r.length&&i.push(r),i.push(u(e)),r="")})),r.length&&i.push(r)}};!(n=r.next()).done;)o();return i},ri=function(e,t,n){this.text=ii(t.data,n.textTransform),this.textBounds=function(e,t,n,r){var i=ei(t,n),o=[],a=0;return i.forEach((function(t){if(n.textDecorationLine.length||t.trim().length>0)if(Yr.SUPPORT_RANGE_BOUNDS){var i=Zr(r,a,t.length).getClientRects();if(i.length>1){var c=$r(t),u=0;c.forEach((function(t){o.push(new Xr(t,s.fromDOMRectList(e,Zr(r,u+a,t.length).getClientRects()))),u+=t.length}))}else o.push(new Xr(t,s.fromDOMRectList(e,i)))}else{var l=r.splitText(t.length);o.push(new Xr(t,Jr(e,r))),r=l}else Yr.SUPPORT_RANGE_BOUNDS||(r=r.splitText(t.length));a+=t.length})),o}(e,this.text,n,t)},ii=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(oi,si);case 2:return e.toUpperCase();default:return e}},oi=/(^|\s|:|-|\(|\))([a-z])/g,si=function(e,t,n){return e.length>0?t+n.toUpperCase():e},ai=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.src=n.currentSrc||n.src,r.intrinsicWidth=n.naturalWidth,r.intrinsicHeight=n.naturalHeight,r.context.cache.addImage(r.src),r}return t(n,e),n}(Cr),ci=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n,r.intrinsicWidth=n.width,r.intrinsicHeight=n.height,r}return t(n,e),n}(Cr),ui=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=new XMLSerializer,o=a(t,n);return n.setAttribute("width",o.width+"px"),n.setAttribute("height",o.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(n)),r.intrinsicWidth=n.width.baseVal.value,r.intrinsicHeight=n.height.baseVal.value,r.context.cache.addImage(r.svg),r}return t(n,e),n}(Cr),li=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(Cr),Ai=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.start=n.start,r.reversed="boolean"==typeof n.reversed&&!0===n.reversed,r}return t(n,e),n}(Cr),hi=[{type:15,flags:0,unit:"px",number:3}],di=[{type:16,flags:0,number:50}],pi="checkbox",fi="radio",gi="password",mi=707406591,vi=function(e){function n(t,n){var r,i,o,a=e.call(this,t,n)||this;switch(a.type=n.type.toLowerCase(),a.checked=n.checked,a.value=0===(i=(r=n).type===gi?new Array(r.value.length+1).join("â¢"):r.value).length?r.placeholder||"":i,a.type!==pi&&a.type!==fi||(a.styles.backgroundColor=3739148031,a.styles.borderTopColor=a.styles.borderRightColor=a.styles.borderBottomColor=a.styles.borderLeftColor=2779096575,a.styles.borderTopWidth=a.styles.borderRightWidth=a.styles.borderBottomWidth=a.styles.borderLeftWidth=1,a.styles.borderTopStyle=a.styles.borderRightStyle=a.styles.borderBottomStyle=a.styles.borderLeftStyle=1,a.styles.backgroundClip=[0],a.styles.backgroundOrigin=[0],a.bounds=(o=a.bounds).width>o.height?new s(o.left+(o.width-o.height)/2,o.top,o.height,o.height):o.width<o.height?new s(o.left,o.top+(o.height-o.width)/2,o.width,o.width):o),a.type){case pi:a.styles.borderTopRightRadius=a.styles.borderTopLeftRadius=a.styles.borderBottomRightRadius=a.styles.borderBottomLeftRadius=hi;break;case fi:a.styles.borderTopRightRadius=a.styles.borderTopLeftRadius=a.styles.borderBottomRightRadius=a.styles.borderBottomLeftRadius=di}return a}return t(n,e),n}(Cr),yi=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=n.options[n.selectedIndex||0];return r.value=i&&i.text||"",r}return t(n,e),n}(Cr),_i=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return t(n,e),n}(Cr),Ei=function(e){function n(t,n){var r=e.call(this,t,n)||this;r.src=n.src,r.width=parseInt(n.width,10)||0,r.height=parseInt(n.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){r.tree=Ti(t,n.contentWindow.document.documentElement);var i=n.contentWindow.document.documentElement?Et(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):bt.TRANSPARENT,o=n.contentWindow.document.body?Et(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):bt.TRANSPARENT;r.backgroundColor=dt(i)?dt(o)?r.styles.backgroundColor:o:i}}catch(e){}return r}return t(n,e),n}(Cr),bi=["OL","UL","MENU"],wi=function(e,t,n,r){for(var i=t.firstChild,o=void 0;i;i=o)if(o=i.nextSibling,Ii(i)&&i.data.trim().length>0)n.textNodes.push(new ri(e,i,n.styles));else if(Oi(i))if(Gi(i)&&i.assignedNodes)i.assignedNodes().forEach((function(t){return wi(e,t,n,r)}));else{var s=Si(e,i);s.styles.isVisible()&&(Ci(i,s,r)?s.flags|=4:Ri(s.styles)&&(s.flags|=2),-1!==bi.indexOf(i.tagName)&&(s.flags|=8),n.elements.push(s),i.slot,i.shadowRoot?wi(e,i.shadowRoot,s,r):Qi(i)||Mi(i)||ji(i)||wi(e,i,s,r))}},Si=function(e,t){return Fi(t)?new ai(e,t):ki(t)?new ci(e,t):Mi(t)?new ui(e,t):Bi(t)?new li(e,t):Li(t)?new Ai(e,t):Di(t)?new vi(e,t):ji(t)?new yi(e,t):Qi(t)?new _i(e,t):Hi(t)?new Ei(e,t):new Cr(e,t)},Ti=function(e,t){var n=Si(e,t);return n.flags|=4,wi(e,t,n,n),n},Ci=function(e,t,n){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||Pi(e)&&n.styles.isTransparent()},Ri=function(e){return e.isPositioned()||e.isFloating()},Ii=function(e){return e.nodeType===Node.TEXT_NODE},Oi=function(e){return e.nodeType===Node.ELEMENT_NODE},xi=function(e){return Oi(e)&&void 0!==e.style&&!Ni(e)},Ni=function(e){return"object"==typeof e.className},Bi=function(e){return"LI"===e.tagName},Li=function(e){return"OL"===e.tagName},Di=function(e){return"INPUT"===e.tagName},Mi=function(e){return"svg"===e.tagName},Pi=function(e){return"BODY"===e.tagName},ki=function(e){return"CANVAS"===e.tagName},Ui=function(e){return"VIDEO"===e.tagName},Fi=function(e){return"IMG"===e.tagName},Hi=function(e){return"IFRAME"===e.tagName},Vi=function(e){return"STYLE"===e.tagName},Qi=function(e){return"TEXTAREA"===e.tagName},ji=function(e){return"SELECT"===e.tagName},Gi=function(e){return"SLOT"===e.tagName},Ki=function(e){return e.tagName.indexOf("-")>0},Wi=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},e.prototype.pop=function(e){var t=this;e.forEach((function(e){return t.counters[e].pop()}))},e.prototype.parse=function(e){var t=this,n=e.counterIncrement,r=e.counterReset,i=!0;null!==n&&n.forEach((function(e){var n=t.counters[e.counter];n&&0!==e.increment&&(i=!1,n.length||n.push(1),n[Math.max(0,n.length-1)]+=e.increment)}));var o=[];return i&&r.forEach((function(e){var n=t.counters[e.counter];o.push(e.counter),n||(n=t.counters[e.counter]=[]),n.push(e.reset)})),o},e}(),zi={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},qi={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Õ","Ô¿","Ô¾","Ô½","Ô¼","Ô»","Ôº","Ô¹","Ô¸","Ô·","Ô¶","Ôµ","Ô´","Ô³","Ô²","Ô±"]},Yi={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["××³","××³","××³","××³","××³","××³","××³","××³","××³","××³","×ª","×©","×¨","×§","×¦","×¤","×¢","×¡","× ","×","×","×","××","××","××","××","××","×","×","×","×","×","×","×","×","×","×"]},Xi={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["áµ","á°","á¯","á´","á®","á­","á¬","á«","áª","á©","á¨","á§","á¦","á¥","á¤","á³","á¢","á¡","á ","á","á","á","á²","á","á","á","á","á","á","á±","á","á","á","á","á","á","á"]},Ji=function(e,t,n,r,i,o){return e<t||e>n?so(e,i,o.length>0):r.integers.reduce((function(t,n,i){for(;e>=n;)e-=n,t+=r.values[i];return t}),"")+o},Zi=function(e,t,n,r){var i="";do{n||e--,i=r(e)+i,e/=t}while(e*t>=t);return i},$i=function(e,t,n,r,i){var o=n-t+1;return(e<0?"-":"")+(Zi(Math.abs(e),o,r,(function(e){return u(Math.floor(e%o)+t)}))+i)},eo=function(e,t,n){void 0===n&&(n=". ");var r=t.length;return Zi(Math.abs(e),r,!1,(function(e){return t[Math.floor(e%r)]}))+n},to=function(e,t,n,r,i,o){if(e<-9999||e>9999)return so(e,4,i.length>0);var s=Math.abs(e),a=i;if(0===s)return t[0]+a;for(var c=0;s>0&&c<=4;c++){var u=s%10;0===u&&lr(o,1)&&""!==a?a=t[u]+a:u>1||1===u&&0===c||1===u&&1===c&&lr(o,2)||1===u&&1===c&&lr(o,4)&&e>100||1===u&&c>1&&lr(o,8)?a=t[u]+(c>0?n[c-1]:"")+a:1===u&&c>0&&(a=n[c-1]+a),s=Math.floor(s/10)}return(e<0?r:"")+a},no="åç¾åè¬",ro="æ¾ä½°ä»è¬",io="ãã¤ãã¹",oo="ë§ì´ëì¤",so=function(e,t,n){var r=n?". ":"",i=n?"ã":"",o=n?", ":"",s=n?" ":"";switch(t){case 0:return"â¢"+s;case 1:return"â¦"+s;case 2:return"â¾"+s;case 5:var a=$i(e,48,57,!0,r);return a.length<4?"0"+a:a;case 4:return eo(e,"ãä¸äºä¸åäºå­ä¸å«ä¹",i);case 6:return Ji(e,1,3999,zi,3,r).toLowerCase();case 7:return Ji(e,1,3999,zi,3,r);case 8:return $i(e,945,969,!1,r);case 9:return $i(e,97,122,!1,r);case 10:return $i(e,65,90,!1,r);case 11:return $i(e,1632,1641,!0,r);case 12:case 49:return Ji(e,1,9999,qi,3,r);case 35:return Ji(e,1,9999,qi,3,r).toLowerCase();case 13:return $i(e,2534,2543,!0,r);case 14:case 30:return $i(e,6112,6121,!0,r);case 15:return eo(e,"å­ä¸å¯å¯è¾°å·³åæªç³éæäº¥",i);case 16:return eo(e,"ç²ä¹ä¸ä¸æå·±åºè¾å£¬ç¸",i);case 17:case 48:return to(e,"é¶ä¸äºä¸åäºå­ä¸å«ä¹",no,"è² ",i,14);case 47:return to(e,"é¶å£¹è²³åèä¼é¸ææç",ro,"è² ",i,15);case 42:return to(e,"é¶ä¸äºä¸åäºå­ä¸å«ä¹",no,"è´",i,14);case 41:return to(e,"é¶å£¹è´°åèä¼éææç",ro,"è´",i,15);case 26:return to(e,"ãä¸äºä¸åäºå­ä¸å«ä¹","åç¾åä¸",io,i,0);case 25:return to(e,"é¶å£±å¼ååä¼å­ä¸å«ä¹","æ¾ç¾åä¸",io,i,7);case 31:return to(e,"ìì¼ì´ì¼ì¬ì¤ì¡ì¹ íêµ¬","ì­ë°±ì²ë§",oo,o,7);case 33:return to(e,"é¶ä¸äºä¸åäºå­ä¸å«ä¹","åç¾åè¬",oo,o,0);case 32:return to(e,"é¶å£¹è²³ååäºå­ä¸å«ä¹","æ¾ç¾å",oo,o,7);case 18:return $i(e,2406,2415,!0,r);case 20:return Ji(e,1,19999,Xi,3,r);case 21:return $i(e,2790,2799,!0,r);case 22:return $i(e,2662,2671,!0,r);case 22:return Ji(e,1,10999,Yi,3,r);case 23:return eo(e,"ããããããããããããããããã¡ã¤ã¦ã¨ãªã«ã¬ã­ã®ã¯ã²ãµã¸ã»ã¾ã¿ãããããããããããããããã");case 24:return eo(e,"ããã¯ã«ã»ã¸ã¨ã¡ãã¬ããããããããã¤ã­ãªããããã®ãããã¾ããµããã¦ãããããã¿ããã²ããã");case 27:return $i(e,3302,3311,!0,r);case 28:return eo(e,"ã¢ã¤ã¦ã¨ãªã«ã­ã¯ã±ã³ãµã·ã¹ã»ã½ã¿ããããããããããããããããã ã¡ã¢ã¤ã¦ã¨ã©ãªã«ã¬ã­ã¯ã°ã±ã²ã³",i);case 29:return eo(e,"ã¤ã­ãããããããªãã«ã²ã¯ã«ã¨ã¿ã¬ã½ãããã©ã ã¦ã°ããªã¯ã¤ãã±ãã³ã¨ãã¢ãµã­ã¦ã¡ãã·ã±ãã¢ã»ã¹",i);case 34:return $i(e,3792,3801,!0,r);case 37:return $i(e,6160,6169,!0,r);case 38:return $i(e,4160,4169,!0,r);case 39:return $i(e,2918,2927,!0,r);case 40:return $i(e,1776,1785,!0,r);case 43:return $i(e,3046,3055,!0,r);case 44:return $i(e,3174,3183,!0,r);case 45:return $i(e,3664,3673,!0,r);case 46:return $i(e,3872,3881,!0,r);default:return $i(e,48,57,!0,r)}},ao="data-html2canvas-ignore",co=function(){function e(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new Wi,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(e,t){var n=this,o=lo(e,t);if(!o.contentWindow)return Promise.reject("Unable to find iframe window");var s=e.defaultView.pageXOffset,a=e.defaultView.pageYOffset,c=o.contentWindow,u=c.document,l=po(o).then((function(){return r(n,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return this.scrolledElements.forEach(yo),c&&(c.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||c.scrollY===t.top&&c.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(c.scrollX-t.left,c.scrollY-t.top,0,0))),e=this.options.onclone,void 0===(n=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:u.fonts&&u.fonts.ready?[4,u.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,ho(u)]:[3,4];case 3:r.sent(),r.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then((function(){return e(u,n)})).then((function(){return o}))]:[2,o]}}))}))}));return u.open(),u.write(mo(document.doctype)+"<html></html>"),vo(this.referenceElement.ownerDocument,s,a),u.replaceChild(u.adoptNode(this.documentElement),u.documentElement),u.close(),l},e.prototype.createElementClone=function(e){if(Tr(e,2),ki(e))return this.createCanvasClone(e);if(Ui(e))return this.createVideoClone(e);if(Vi(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return Fi(t)&&(Fi(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),Ki(t)?this.createCustomElementClone(t):t},e.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return go(e.style,t),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce((function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e}),""),r=e.cloneNode(!1);return r.textContent=n,r}}catch(e){if(this.context.logger.error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch(t){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var r=e.cloneNode(!1);try{r.width=e.width,r.height=e.height;var i=e.getContext("2d"),o=r.getContext("2d");if(o)if(!this.options.allowTaint&&i)o.putImageData(i.getImageData(0,0,e.width,e.height),0,0);else{var s=null!==(t=e.getContext("webgl2"))&&void 0!==t?t:e.getContext("webgl");if(s){var a=s.getContextAttributes();!1===(null==a?void 0:a.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}o.drawImage(e,0,0)}return r}catch(t){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return r},e.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var n=t.getContext("2d");try{return n&&(n.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||n.getImageData(0,0,t.width,t.height)),t}catch(t){this.context.logger.info("Unable to clone video as it is tainted",e)}var r=e.ownerDocument.createElement("canvas");return r.width=e.offsetWidth,r.height=e.offsetHeight,r},e.prototype.appendChildNode=function(e,t,n){Oi(t)&&("SCRIPT"===t.tagName||t.hasAttribute(ao)||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(t))||this.options.copyStyles&&Oi(t)&&Vi(t)||e.appendChild(this.cloneNode(t,n))},e.prototype.cloneChildNodes=function(e,t,n){for(var r=this,i=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;i;i=i.nextSibling)if(Oi(i)&&Gi(i)&&"function"==typeof i.assignedNodes){var o=i.assignedNodes();o.length&&o.forEach((function(e){return r.appendChildNode(t,e,n)}))}else this.appendChildNode(t,i,n)},e.prototype.cloneNode=function(e,t){if(Ii(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var n=e.ownerDocument.defaultView;if(n&&Oi(e)&&(xi(e)||Ni(e))){var r=this.createElementClone(e);r.style.transitionProperty="none";var i=n.getComputedStyle(e),o=n.getComputedStyle(e,":before"),s=n.getComputedStyle(e,":after");this.referenceElement===e&&xi(r)&&(this.clonedReferenceElement=r),Pi(r)&&wo(r);var a=this.counters.parse(new wr(this.context,i)),c=this.resolvePseudoContent(e,r,o,Mr.BEFORE);Ki(e)&&(t=!0),Ui(e)||this.cloneChildNodes(e,r,t),c&&r.insertBefore(c,r.firstChild);var u=this.resolvePseudoContent(e,r,s,Mr.AFTER);return u&&r.appendChild(u),this.counters.pop(a),(i&&(this.options.copyStyles||Ni(e))&&!Hi(e)||t)&&go(i,r),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([r,e.scrollLeft,e.scrollTop]),(Qi(e)||ji(e))&&(Qi(r)||ji(r))&&(r.value=e.value),r}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,n,r){var i=this;if(n){var o=n.content,s=t.ownerDocument;if(s&&o&&"none"!==o&&"-moz-alt-content"!==o&&"none"!==n.display){this.counters.parse(new wr(this.context,n));var a=new br(this.context,n),c=s.createElement("html2canvaspseudoelement");go(n,c),a.content.forEach((function(t){if(0===t.type)c.appendChild(s.createTextNode(t.value));else if(22===t.type){var n=s.createElement("img");n.src=t.value,n.style.opacity="1",c.appendChild(n)}else if(18===t.type){if("attr"===t.name){var r=t.values.filter(Ke);r.length&&c.appendChild(s.createTextNode(e.getAttribute(r[0].value)||""))}else if("counter"===t.name){var o=t.values.filter(Ye),u=o[0],l=o[1];if(u&&Ke(u)){var A=i.counters.getCounterValue(u.value),h=l&&Ke(l)?xn.parse(i.context,l.value):3;c.appendChild(s.createTextNode(so(A,h,!1)))}}else if("counters"===t.name){var d=t.values.filter(Ye),p=(u=d[0],d[1]);l=d[2];if(u&&Ke(u)){var f=i.counters.getCounterValues(u.value),g=l&&Ke(l)?xn.parse(i.context,l.value):3,m=p&&0===p.type?p.value:"",v=f.map((function(e){return so(e,g,!1)})).join(m);c.appendChild(s.createTextNode(v))}}}else if(20===t.type)switch(t.value){case"open-quote":c.appendChild(s.createTextNode(gr(a.quotes,i.quoteDepth++,!0)));break;case"close-quote":c.appendChild(s.createTextNode(gr(a.quotes,--i.quoteDepth,!1)));break;default:c.appendChild(s.createTextNode(t.value))}})),c.className=_o+" "+Eo;var u=r===Mr.BEFORE?" "+_o:" "+Eo;return Ni(t)?t.className.baseValue+=u:t.className+=u,c}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(Mr||(Mr={}));var uo,lo=function(e,t){var n=e.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=t.width.toString(),n.height=t.height.toString(),n.scrolling="no",n.setAttribute(ao,"true"),e.body.appendChild(n),n},Ao=function(e){return new Promise((function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()}))},ho=function(e){return Promise.all([].slice.call(e.images,0).map(Ao))},po=function(e){return new Promise((function(t,n){var r=e.contentWindow;if(!r)return n("No window assigned for iframe");var i=r.document;r.onload=e.onload=function(){r.onload=e.onload=null;var n=setInterval((function(){i.body.childNodes.length>0&&"complete"===i.readyState&&(clearInterval(n),t(e))}),50)}}))},fo=["all","d","content"],go=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e.item(n);-1===fo.indexOf(r)&&t.style.setProperty(r,e.getPropertyValue(r))}return t},mo=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},vo=function(e,t,n){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||n!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,n)},yo=function(e){var t=e[0],n=e[1],r=e[2];t.scrollLeft=n,t.scrollTop=r},_o="___html2canvas___pseudoelement_before",Eo="___html2canvas___pseudoelement_after",bo='{\n    content: "" !important;\n    display: none !important;\n}',wo=function(e){So(e,"."+_o+":before"+bo+"\n         ."+Eo+":after"+bo)},So=function(e,t){var n=e.ownerDocument;if(n){var r=n.createElement("style");r.textContent=t,e.appendChild(r)}},To=function(){function e(){}return e.getOrigin=function(t){var n=e._link;return n?(n.href=t,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),Co=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:Lo(e)||xo(e)?((this._cache[e]=this.loadImage(e)).catch((function(){})),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,s=this;return i(this,(function(i){switch(i.label){case 0:return t=To.isSameOrigin(e),n=!No(e)&&!0===this._options.useCORS&&Yr.SUPPORT_CORS_IMAGES&&!t,r=!No(e)&&!t&&!Lo(e)&&"string"==typeof this._options.proxy&&Yr.SUPPORT_CORS_XHR&&!n,t||!1!==this._options.allowTaint||No(e)||Lo(e)||r||n?(o=e,r?[4,this.proxy(o)]:[3,2]):[2];case 1:o=i.sent(),i.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise((function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,(Bo(o)||n)&&(r.crossOrigin="anonymous"),r.src=o,!0===r.complete&&setTimeout((function(){return e(r)}),500),s._options.imageTimeout>0&&setTimeout((function(){return t("Timed out ("+s._options.imageTimeout+"ms) loading image")}),s._options.imageTimeout)}))];case 3:return[2,i.sent()]}}))}))},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var r=e.substring(0,256);return new Promise((function(i,o){var s=Yr.SUPPORT_RESPONSE_TYPE?"blob":"text",a=new XMLHttpRequest;a.onload=function(){if(200===a.status)if("text"===s)i(a.response);else{var e=new FileReader;e.addEventListener("load",(function(){return i(e.result)}),!1),e.addEventListener("error",(function(e){return o(e)}),!1),e.readAsDataURL(a.response)}else o("Failed to proxy resource "+r+" with status code "+a.status)},a.onerror=o;var c=n.indexOf("?")>-1?"&":"?";if(a.open("GET",""+n+c+"url="+encodeURIComponent(e)+"&responseType="+s),"text"!==s&&a instanceof XMLHttpRequest&&(a.responseType=s),t._options.imageTimeout){var u=t._options.imageTimeout;a.timeout=u,a.ontimeout=function(){return o("Timed out ("+u+"ms) proxying "+r)}}a.send()}))},e}(),Ro=/^data:image\/svg\+xml/i,Io=/^data:image\/.*;base64,/i,Oo=/^data:image\/.*/i,xo=function(e){return Yr.SUPPORT_SVG_DRAWING||!Do(e)},No=function(e){return Oo.test(e)},Bo=function(e){return Io.test(e)},Lo=function(e){return"blob"===e.substr(0,4)},Do=function(e){return"svg"===e.substr(-3).toLowerCase()||Ro.test(e)},Mo=function(){function e(e,t){this.type=0,this.x=e,this.y=t}return e.prototype.add=function(t,n){return new e(this.x+t,this.y+n)},e}(),Po=function(e,t,n){return new Mo(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},ko=function(){function e(e,t,n,r){this.type=1,this.start=e,this.startControl=t,this.endControl=n,this.end=r}return e.prototype.subdivide=function(t,n){var r=Po(this.start,this.startControl,t),i=Po(this.startControl,this.endControl,t),o=Po(this.endControl,this.end,t),s=Po(r,i,t),a=Po(i,o,t),c=Po(s,a,t);return n?new e(this.start,r,s,c):new e(c,a,o,this.end)},e.prototype.add=function(t,n){return new e(this.start.add(t,n),this.startControl.add(t,n),this.endControl.add(t,n),this.end.add(t,n))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),Uo=function(e){return 1===e.type},Fo=function(e){var t=e.styles,n=e.bounds,r=it(t.borderTopLeftRadius,n.width,n.height),i=r[0],o=r[1],s=it(t.borderTopRightRadius,n.width,n.height),a=s[0],c=s[1],u=it(t.borderBottomRightRadius,n.width,n.height),l=u[0],A=u[1],h=it(t.borderBottomLeftRadius,n.width,n.height),d=h[0],p=h[1],f=[];f.push((i+a)/n.width),f.push((d+l)/n.width),f.push((o+p)/n.height),f.push((c+A)/n.height);var g=Math.max.apply(Math,f);g>1&&(i/=g,o/=g,a/=g,c/=g,l/=g,A/=g,d/=g,p/=g);var m=n.width-a,v=n.height-A,y=n.width-l,_=n.height-p,E=t.borderTopWidth,b=t.borderRightWidth,w=t.borderBottomWidth,S=t.borderLeftWidth,T=ot(t.paddingTop,e.bounds.width),C=ot(t.paddingRight,e.bounds.width),R=ot(t.paddingBottom,e.bounds.width),I=ot(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||o>0?Ho(n.left+S/3,n.top+E/3,i-S/3,o-E/3,uo.TOP_LEFT):new Mo(n.left+S/3,n.top+E/3),this.topRightBorderDoubleOuterBox=i>0||o>0?Ho(n.left+m,n.top+E/3,a-b/3,c-E/3,uo.TOP_RIGHT):new Mo(n.left+n.width-b/3,n.top+E/3),this.bottomRightBorderDoubleOuterBox=l>0||A>0?Ho(n.left+y,n.top+v,l-b/3,A-w/3,uo.BOTTOM_RIGHT):new Mo(n.left+n.width-b/3,n.top+n.height-w/3),this.bottomLeftBorderDoubleOuterBox=d>0||p>0?Ho(n.left+S/3,n.top+_,d-S/3,p-w/3,uo.BOTTOM_LEFT):new Mo(n.left+S/3,n.top+n.height-w/3),this.topLeftBorderDoubleInnerBox=i>0||o>0?Ho(n.left+2*S/3,n.top+2*E/3,i-2*S/3,o-2*E/3,uo.TOP_LEFT):new Mo(n.left+2*S/3,n.top+2*E/3),this.topRightBorderDoubleInnerBox=i>0||o>0?Ho(n.left+m,n.top+2*E/3,a-2*b/3,c-2*E/3,uo.TOP_RIGHT):new Mo(n.left+n.width-2*b/3,n.top+2*E/3),this.bottomRightBorderDoubleInnerBox=l>0||A>0?Ho(n.left+y,n.top+v,l-2*b/3,A-2*w/3,uo.BOTTOM_RIGHT):new Mo(n.left+n.width-2*b/3,n.top+n.height-2*w/3),this.bottomLeftBorderDoubleInnerBox=d>0||p>0?Ho(n.left+2*S/3,n.top+_,d-2*S/3,p-2*w/3,uo.BOTTOM_LEFT):new Mo(n.left+2*S/3,n.top+n.height-2*w/3),this.topLeftBorderStroke=i>0||o>0?Ho(n.left+S/2,n.top+E/2,i-S/2,o-E/2,uo.TOP_LEFT):new Mo(n.left+S/2,n.top+E/2),this.topRightBorderStroke=i>0||o>0?Ho(n.left+m,n.top+E/2,a-b/2,c-E/2,uo.TOP_RIGHT):new Mo(n.left+n.width-b/2,n.top+E/2),this.bottomRightBorderStroke=l>0||A>0?Ho(n.left+y,n.top+v,l-b/2,A-w/2,uo.BOTTOM_RIGHT):new Mo(n.left+n.width-b/2,n.top+n.height-w/2),this.bottomLeftBorderStroke=d>0||p>0?Ho(n.left+S/2,n.top+_,d-S/2,p-w/2,uo.BOTTOM_LEFT):new Mo(n.left+S/2,n.top+n.height-w/2),this.topLeftBorderBox=i>0||o>0?Ho(n.left,n.top,i,o,uo.TOP_LEFT):new Mo(n.left,n.top),this.topRightBorderBox=a>0||c>0?Ho(n.left+m,n.top,a,c,uo.TOP_RIGHT):new Mo(n.left+n.width,n.top),this.bottomRightBorderBox=l>0||A>0?Ho(n.left+y,n.top+v,l,A,uo.BOTTOM_RIGHT):new Mo(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=d>0||p>0?Ho(n.left,n.top+_,d,p,uo.BOTTOM_LEFT):new Mo(n.left,n.top+n.height),this.topLeftPaddingBox=i>0||o>0?Ho(n.left+S,n.top+E,Math.max(0,i-S),Math.max(0,o-E),uo.TOP_LEFT):new Mo(n.left+S,n.top+E),this.topRightPaddingBox=a>0||c>0?Ho(n.left+Math.min(m,n.width-b),n.top+E,m>n.width+b?0:Math.max(0,a-b),Math.max(0,c-E),uo.TOP_RIGHT):new Mo(n.left+n.width-b,n.top+E),this.bottomRightPaddingBox=l>0||A>0?Ho(n.left+Math.min(y,n.width-S),n.top+Math.min(v,n.height-w),Math.max(0,l-b),Math.max(0,A-w),uo.BOTTOM_RIGHT):new Mo(n.left+n.width-b,n.top+n.height-w),this.bottomLeftPaddingBox=d>0||p>0?Ho(n.left+S,n.top+Math.min(_,n.height-w),Math.max(0,d-S),Math.max(0,p-w),uo.BOTTOM_LEFT):new Mo(n.left+S,n.top+n.height-w),this.topLeftContentBox=i>0||o>0?Ho(n.left+S+I,n.top+E+T,Math.max(0,i-(S+I)),Math.max(0,o-(E+T)),uo.TOP_LEFT):new Mo(n.left+S+I,n.top+E+T),this.topRightContentBox=a>0||c>0?Ho(n.left+Math.min(m,n.width+S+I),n.top+E+T,m>n.width+S+I?0:a-S+I,c-(E+T),uo.TOP_RIGHT):new Mo(n.left+n.width-(b+C),n.top+E+T),this.bottomRightContentBox=l>0||A>0?Ho(n.left+Math.min(y,n.width-(S+I)),n.top+Math.min(v,n.height+E+T),Math.max(0,l-(b+C)),A-(w+R),uo.BOTTOM_RIGHT):new Mo(n.left+n.width-(b+C),n.top+n.height-(w+R)),this.bottomLeftContentBox=d>0||p>0?Ho(n.left+S+I,n.top+_,Math.max(0,d-(S+I)),p-(w+R),uo.BOTTOM_LEFT):new Mo(n.left+S+I,n.top+n.height-(w+R))};!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(uo||(uo={}));var Ho=function(e,t,n,r,i){var o=(Math.sqrt(2)-1)/3*4,s=n*o,a=r*o,c=e+n,u=t+r;switch(i){case uo.TOP_LEFT:return new ko(new Mo(e,u),new Mo(e,u-a),new Mo(c-s,t),new Mo(c,t));case uo.TOP_RIGHT:return new ko(new Mo(e,t),new Mo(e+s,t),new Mo(c,u-a),new Mo(c,u));case uo.BOTTOM_RIGHT:return new ko(new Mo(c,t),new Mo(c,t+a),new Mo(e+s,u),new Mo(e,u));case uo.BOTTOM_LEFT:default:return new ko(new Mo(c,u),new Mo(c-s,u),new Mo(e,t+a),new Mo(e,t))}},Vo=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},Qo=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},jo=function(e,t,n){this.offsetX=e,this.offsetY=t,this.matrix=n,this.type=0,this.target=6},Go=function(e,t){this.path=e,this.target=t,this.type=1},Ko=function(e){this.opacity=e,this.type=2,this.target=6},Wo=function(e){return 1===e.type},zo=function(e,t){return e.length===t.length&&e.some((function(e,n){return e===t[n]}))},qo=function(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},Yo=function(){function e(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new Fo(this.container),this.container.styles.opacity<1&&this.effects.push(new Ko(this.container.styles.opacity)),null!==this.container.styles.transform){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,i=this.container.styles.transform;this.effects.push(new jo(n,r,i))}if(0!==this.container.styles.overflowX){var o=Vo(this.curves),s=Qo(this.curves);zo(o,s)?this.effects.push(new Go(o,6)):(this.effects.push(new Go(o,2)),this.effects.push(new Go(s,4)))}}return e.prototype.getEffects=function(e){for(var t=-1===[2,3].indexOf(this.container.styles.position),n=this.parent,r=this.effects.slice(0);n;){var i=n.effects.filter((function(e){return!Wo(e)}));if(t||0!==n.container.styles.position||!n.parent){if(r.unshift.apply(r,i),t=-1===[2,3].indexOf(n.container.styles.position),0!==n.container.styles.overflowX){var o=Vo(n.curves),s=Qo(n.curves);zo(o,s)||r.unshift(new Go(s,6))}}else r.unshift.apply(r,i);n=n.parent}return r.filter((function(t){return lr(t.target,e)}))},e}(),Xo=function(e,t,n,r){e.container.elements.forEach((function(i){var o=lr(i.flags,4),s=lr(i.flags,2),a=new Yo(i,e);lr(i.styles.display,2048)&&r.push(a);var c=lr(i.flags,8)?[]:r;if(o||s){var u=o||i.styles.isPositioned()?n:t,l=new qo(a);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var A=i.styles.zIndex.order;if(A<0){var h=0;u.negativeZIndex.some((function(e,t){return A>e.element.container.styles.zIndex.order?(h=t,!1):h>0})),u.negativeZIndex.splice(h,0,l)}else if(A>0){var d=0;u.positiveZIndex.some((function(e,t){return A>=e.element.container.styles.zIndex.order?(d=t+1,!1):d>0})),u.positiveZIndex.splice(d,0,l)}else u.zeroOrAutoZIndexOrTransformedOrOpacity.push(l)}else i.styles.isFloating()?u.nonPositionedFloats.push(l):u.nonPositionedInlineLevel.push(l);Xo(a,l,o?l:n,c)}else i.styles.isInlineLevel()?t.inlineLevel.push(a):t.nonInlineLevel.push(a),Xo(a,t,n,c);lr(i.flags,8)&&Jo(i,c)}))},Jo=function(e,t){for(var n=e instanceof Ai?e.start:1,r=e instanceof Ai&&e.reversed,i=0;i<t.length;i++){var o=t[i];o.container instanceof li&&"number"==typeof o.container.value&&0!==o.container.value&&(n=o.container.value),o.listValue=so(n,o.container.styles.listStyleType,!0),n+=r?-1:1}},Zo=function(e,t){switch(t){case 0:return es(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return es(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return es(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return es(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},$o=function(e,t){var n=[];return Uo(e)?n.push(e.subdivide(.5,!1)):n.push(e),Uo(t)?n.push(t.subdivide(.5,!0)):n.push(t),n},es=function(e,t,n,r){var i=[];return Uo(e)?i.push(e.subdivide(.5,!1)):i.push(e),Uo(n)?i.push(n.subdivide(.5,!0)):i.push(n),Uo(r)?i.push(r.subdivide(.5,!0).reverse()):i.push(r),Uo(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},ts=function(e){var t=e.bounds,n=e.styles;return t.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},ns=function(e){var t=e.styles,n=e.bounds,r=ot(t.paddingLeft,n.width),i=ot(t.paddingRight,n.width),o=ot(t.paddingTop,n.width),s=ot(t.paddingBottom,n.width);return n.add(r+t.borderLeftWidth,o+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+r+i),-(t.borderTopWidth+t.borderBottomWidth+o+s))},rs=function(e,t,n){var r=function(e,t){return 0===e?t.bounds:2===e?ns(t):ts(t)}(as(e.styles.backgroundOrigin,t),e),i=function(e,t){return 0===e?t.bounds:2===e?ns(t):ts(t)}(as(e.styles.backgroundClip,t),e),o=ss(as(e.styles.backgroundSize,t),n,r),s=o[0],a=o[1],c=it(as(e.styles.backgroundPosition,t),r.width-s,r.height-a);return[cs(as(e.styles.backgroundRepeat,t),c,o,r,i),Math.round(r.left+c[0]),Math.round(r.top+c[1]),s,a]},is=function(e){return Ke(e)&&e.value===Vt.AUTO},os=function(e){return"number"==typeof e},ss=function(e,t,n){var r=t[0],i=t[1],o=t[2],s=e[0],a=e[1];if(!s)return[0,0];if($e(s)&&a&&$e(a))return[ot(s,n.width),ot(a,n.height)];var c=os(o);if(Ke(s)&&(s.value===Vt.CONTAIN||s.value===Vt.COVER))return os(o)?n.width/n.height<o!=(s.value===Vt.COVER)?[n.width,n.width/o]:[n.height*o,n.height]:[n.width,n.height];var u=os(r),l=os(i),A=u||l;if(is(s)&&(!a||is(a)))return u&&l?[r,i]:c||A?A&&c?[u?r:i*o,l?i:r/o]:[u?r:n.width,l?i:n.height]:[n.width,n.height];if(c){var h=0,d=0;return $e(s)?h=ot(s,n.width):$e(a)&&(d=ot(a,n.height)),is(s)?h=d*o:a&&!is(a)||(d=h/o),[h,d]}var p=null,f=null;if($e(s)?p=ot(s,n.width):a&&$e(a)&&(f=ot(a,n.height)),null===p||a&&!is(a)||(f=u&&l?p/r*i:n.height),null!==f&&is(s)&&(p=u&&l?f/i*r:n.width),null!==p&&null!==f)return[p,f];throw new Error("Unable to calculate background-size for element")},as=function(e,t){var n=e[t];return void 0===n?e[0]:n},cs=function(e,t,n,r,i){var o=t[0],s=t[1],a=n[0],c=n[1];switch(e){case 2:return[new Mo(Math.round(r.left),Math.round(r.top+s)),new Mo(Math.round(r.left+r.width),Math.round(r.top+s)),new Mo(Math.round(r.left+r.width),Math.round(c+r.top+s)),new Mo(Math.round(r.left),Math.round(c+r.top+s))];case 3:return[new Mo(Math.round(r.left+o),Math.round(r.top)),new Mo(Math.round(r.left+o+a),Math.round(r.top)),new Mo(Math.round(r.left+o+a),Math.round(r.height+r.top)),new Mo(Math.round(r.left+o),Math.round(r.height+r.top))];case 1:return[new Mo(Math.round(r.left+o),Math.round(r.top+s)),new Mo(Math.round(r.left+o+a),Math.round(r.top+s)),new Mo(Math.round(r.left+o+a),Math.round(r.top+s+c)),new Mo(Math.round(r.left+o),Math.round(r.top+s+c))];default:return[new Mo(Math.round(i.left),Math.round(i.top)),new Mo(Math.round(i.left+i.width),Math.round(i.top)),new Mo(Math.round(i.left+i.width),Math.round(i.height+i.top)),new Mo(Math.round(i.left),Math.round(i.height+i.top))]}},us="Hidden Text",ls=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),r=this._document.createElement("img"),i=this._document.createElement("span"),o=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",o.appendChild(n),r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",i.style.fontFamily=e,i.style.fontSize=t,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode(us)),n.appendChild(i),n.appendChild(r);var s=r.offsetTop-i.offsetTop+2;n.removeChild(i),n.appendChild(this._document.createTextNode(us)),n.style.lineHeight="normal",r.style.verticalAlign="super";var a=r.offsetTop-n.offsetTop+2;return o.removeChild(n),{baseline:s,middle:a}},e.prototype.getMetrics=function(e,t){var n=e+" "+t;return void 0===this._data[n]&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},e}(),As=function(e,t){this.context=e,this.options=t},hs=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r._activeEffects=[],r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),n.canvas||(r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px"),r.fontMetrics=new ls(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),r}return t(n,e),n.prototype.applyEffects=function(e){for(var t=this;this._activeEffects.length;)this.popEffect();e.forEach((function(e){return t.applyEffect(e)}))},n.prototype.applyEffect=function(e){this.ctx.save(),function(e){return 2===e.type}(e)&&(this.ctx.globalAlpha=e.opacity),function(e){return 0===e.type}(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),Wo(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},n.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},n.prototype.renderStack=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.renderNode=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return lr(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},n.prototype.renderTextWithLetterSpacing=function(e,t,n){var r=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+n):$r(e.text).reduce((function(t,i){return r.ctx.fillText(i,t,e.bounds.top+n),t+r.ctx.measureText(i).width}),e.bounds.left)},n.prototype.createFontStyle=function(e){var t=e.fontVariant.filter((function(e){return"normal"===e||"small-caps"===e})).join(""),n=ms(e.fontFamily).join(", "),r=je(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,r,n].join(" "),n,r]},n.prototype.renderTextNode=function(e,t){return r(this,void 0,void 0,(function(){var n,r,o,s,a,c,u,l,A=this;return i(this,(function(i){return n=this.createFontStyle(t),r=n[0],o=n[1],s=n[2],this.ctx.font=r,this.ctx.direction=1===t.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",a=this.fontMetrics.getMetrics(o,s),c=a.baseline,u=a.middle,l=t.paintOrder,e.textBounds.forEach((function(e){l.forEach((function(n){switch(n){case 0:A.ctx.fillStyle=pt(t.color),A.renderTextWithLetterSpacing(e,t.letterSpacing,c);var r=t.textShadow;r.length&&e.text.trim().length&&(r.slice(0).reverse().forEach((function(n){A.ctx.shadowColor=pt(n.color),A.ctx.shadowOffsetX=n.offsetX.number*A.options.scale,A.ctx.shadowOffsetY=n.offsetY.number*A.options.scale,A.ctx.shadowBlur=n.blur.number,A.renderTextWithLetterSpacing(e,t.letterSpacing,c)})),A.ctx.shadowColor="",A.ctx.shadowOffsetX=0,A.ctx.shadowOffsetY=0,A.ctx.shadowBlur=0),t.textDecorationLine.length&&(A.ctx.fillStyle=pt(t.textDecorationColor||t.color),t.textDecorationLine.forEach((function(t){switch(t){case 1:A.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+c),e.bounds.width,1);break;case 2:A.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:A.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+u),e.bounds.width,1)}})));break;case 1:t.webkitTextStrokeWidth&&e.text.trim().length&&(A.ctx.strokeStyle=pt(t.webkitTextStrokeColor),A.ctx.lineWidth=t.webkitTextStrokeWidth,A.ctx.lineJoin=window.chrome?"miter":"round",A.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+c)),A.ctx.strokeStyle="",A.ctx.lineWidth=0,A.ctx.lineJoin="miter"}}))})),[2]}))}))},n.prototype.renderReplacedElement=function(e,t,n){if(n&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var r=ns(e),i=Qo(t);this.path(i),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,e.intrinsicWidth,e.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},n.prototype.renderNodeContent=function(e){return r(this,void 0,void 0,(function(){var t,r,o,a,c,u,l,A,h,d,p,f,g,m,v,y,_,E;return i(this,(function(i){switch(i.label){case 0:this.applyEffects(e.getEffects(4)),t=e.container,r=e.curves,o=t.styles,a=0,c=t.textNodes,i.label=1;case 1:return a<c.length?(u=c[a],[4,this.renderTextNode(u,o)]):[3,4];case 2:i.sent(),i.label=3;case 3:return a++,[3,1];case 4:if(!(t instanceof ai))return[3,8];i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this.context.cache.match(t.src)];case 6:return v=i.sent(),this.renderReplacedElement(t,r,v),[3,8];case 7:return i.sent(),this.context.logger.error("Error loading image "+t.src),[3,8];case 8:if(t instanceof ci&&this.renderReplacedElement(t,r,t.canvas),!(t instanceof ui))return[3,12];i.label=9;case 9:return i.trys.push([9,11,,12]),[4,this.context.cache.match(t.svg)];case 10:return v=i.sent(),this.renderReplacedElement(t,r,v),[3,12];case 11:return i.sent(),this.context.logger.error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof Ei&&t.tree?[4,new n(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height}).render(t.tree)]:[3,14];case 13:l=i.sent(),t.width&&t.height&&this.ctx.drawImage(l,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),i.label=14;case 14:if(t instanceof vi&&(A=Math.min(t.bounds.width,t.bounds.height),t.type===pi?t.checked&&(this.ctx.save(),this.path([new Mo(t.bounds.left+.39363*A,t.bounds.top+.79*A),new Mo(t.bounds.left+.16*A,t.bounds.top+.5549*A),new Mo(t.bounds.left+.27347*A,t.bounds.top+.44071*A),new Mo(t.bounds.left+.39694*A,t.bounds.top+.5649*A),new Mo(t.bounds.left+.72983*A,t.bounds.top+.23*A),new Mo(t.bounds.left+.84*A,t.bounds.top+.34085*A),new Mo(t.bounds.left+.39363*A,t.bounds.top+.79*A)]),this.ctx.fillStyle=pt(mi),this.ctx.fill(),this.ctx.restore()):t.type===fi&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+A/2,t.bounds.top+A/2,A/4,0,2*Math.PI,!0),this.ctx.fillStyle=pt(mi),this.ctx.fill(),this.ctx.restore())),ds(t)&&t.value.length){switch(h=this.createFontStyle(o),_=h[0],d=h[1],p=this.fontMetrics.getMetrics(_,d).baseline,this.ctx.font=_,this.ctx.fillStyle=pt(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=fs(t.styles.textAlign),E=ns(t),f=0,t.styles.textAlign){case 1:f+=E.width/2;break;case 2:f+=E.width}g=E.add(f,0,0,-E.height/2+1),this.ctx.save(),this.path([new Mo(E.left,E.top),new Mo(E.left+E.width,E.top),new Mo(E.left+E.width,E.top+E.height),new Mo(E.left,E.top+E.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Xr(t.value,g),o.letterSpacing,p),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!lr(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if(0!==(m=t.styles.listStyleImage).type)return[3,18];v=void 0,y=m.url,i.label=15;case 15:return i.trys.push([15,17,,18]),[4,this.context.cache.match(y)];case 16:return v=i.sent(),this.ctx.drawImage(v,t.bounds.left-(v.width+10),t.bounds.top),[3,18];case 17:return i.sent(),this.context.logger.error("Error loading list-style-image "+y),[3,18];case 18:return[3,20];case 19:e.listValue&&-1!==t.styles.listStyleType&&(_=this.createFontStyle(o)[0],this.ctx.font=_,this.ctx.fillStyle=pt(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",E=new s(t.bounds.left,t.bounds.top+ot(t.styles.paddingTop,t.bounds.width),t.bounds.width,Rn(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Xr(e.listValue,E),o.letterSpacing,Rn(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),i.label=20;case 20:return[2]}}))}))},n.prototype.renderStackContent=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,s,a,c,u,l,A,h,d,p,f,g;return i(this,(function(i){switch(i.label){case 0:return lr(e.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:i.sent(),t=0,n=e.negativeZIndex,i.label=2;case 2:return t<n.length?(g=n[t],[4,this.renderStack(g)]):[3,5];case 3:i.sent(),i.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:i.sent(),r=0,o=e.nonInlineLevel,i.label=7;case 7:return r<o.length?(g=o[r],[4,this.renderNode(g)]):[3,10];case 8:i.sent(),i.label=9;case 9:return r++,[3,7];case 10:s=0,a=e.nonPositionedFloats,i.label=11;case 11:return s<a.length?(g=a[s],[4,this.renderStack(g)]):[3,14];case 12:i.sent(),i.label=13;case 13:return s++,[3,11];case 14:c=0,u=e.nonPositionedInlineLevel,i.label=15;case 15:return c<u.length?(g=u[c],[4,this.renderStack(g)]):[3,18];case 16:i.sent(),i.label=17;case 17:return c++,[3,15];case 18:l=0,A=e.inlineLevel,i.label=19;case 19:return l<A.length?(g=A[l],[4,this.renderNode(g)]):[3,22];case 20:i.sent(),i.label=21;case 21:return l++,[3,19];case 22:h=0,d=e.zeroOrAutoZIndexOrTransformedOrOpacity,i.label=23;case 23:return h<d.length?(g=d[h],[4,this.renderStack(g)]):[3,26];case 24:i.sent(),i.label=25;case 25:return h++,[3,23];case 26:p=0,f=e.positiveZIndex,i.label=27;case 27:return p<f.length?(g=f[p],[4,this.renderStack(g)]):[3,30];case 28:i.sent(),i.label=29;case 29:return p++,[3,27];case 30:return[2]}}))}))},n.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},n.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},n.prototype.formatPath=function(e){var t=this;e.forEach((function(e,n){var r=Uo(e)?e.start:e;0===n?t.ctx.moveTo(r.x,r.y):t.ctx.lineTo(r.x,r.y),Uo(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)}))},n.prototype.renderRepeat=function(e,t,n,r){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(n,r),this.ctx.fill(),this.ctx.translate(-n,-r)},n.prototype.resizeImage=function(e,t,n){var r;if(e.width===t&&e.height===n)return e;var i=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return i.width=Math.max(1,t),i.height=Math.max(1,n),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,n),i},n.prototype.renderBackgroundImage=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,s,a;return i(this,(function(c){switch(c.label){case 0:t=e.styles.backgroundImage.length-1,n=function(n){var o,s,a,c,u,l,A,h,d,p,f,g,m,v,y,_,E,b,w,S,T,C,R,I,O,x,N,B,L,D,M;return i(this,(function(i){switch(i.label){case 0:if(0!==n.type)return[3,5];o=void 0,s=n.url,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,r.context.cache.match(s)];case 2:return o=i.sent(),[3,4];case 3:return i.sent(),r.context.logger.error("Error loading background-image "+s),[3,4];case 4:return o&&(a=rs(e,t,[o.width,o.height,o.width/o.height]),_=a[0],C=a[1],R=a[2],w=a[3],S=a[4],v=r.ctx.createPattern(r.resizeImage(o,w,S),"repeat"),r.renderRepeat(_,v,C,R)),[3,6];case 5:1===n.type?(c=rs(e,t,[null,null,null]),_=c[0],C=c[1],R=c[2],w=c[3],S=c[4],u=Rt(n.angle,w,S),l=u[0],A=u[1],h=u[2],d=u[3],p=u[4],(f=document.createElement("canvas")).width=w,f.height=S,g=f.getContext("2d"),m=g.createLinearGradient(A,d,h,p),Ct(n.stops,l).forEach((function(e){return m.addColorStop(e.stop,pt(e.color))})),g.fillStyle=m,g.fillRect(0,0,w,S),w>0&&S>0&&(v=r.ctx.createPattern(f,"repeat"),r.renderRepeat(_,v,C,R))):function(e){return 2===e.type}(n)&&(y=rs(e,t,[null,null,null]),_=y[0],E=y[1],b=y[2],w=y[3],S=y[4],T=0===n.position.length?[nt]:n.position,C=ot(T[0],w),R=ot(T[T.length-1],S),I=function(e,t,n,r,i){var o=0,s=0;switch(e.size){case 0:0===e.shape?o=s=Math.min(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-i)):1===e.shape&&(o=Math.min(Math.abs(t),Math.abs(t-r)),s=Math.min(Math.abs(n),Math.abs(n-i)));break;case 2:if(0===e.shape)o=s=Math.min(It(t,n),It(t,n-i),It(t-r,n),It(t-r,n-i));else if(1===e.shape){var a=Math.min(Math.abs(n),Math.abs(n-i))/Math.min(Math.abs(t),Math.abs(t-r)),c=Ot(r,i,t,n,!0),u=c[0],l=c[1];s=a*(o=It(u-t,(l-n)/a))}break;case 1:0===e.shape?o=s=Math.max(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-i)):1===e.shape&&(o=Math.max(Math.abs(t),Math.abs(t-r)),s=Math.max(Math.abs(n),Math.abs(n-i)));break;case 3:if(0===e.shape)o=s=Math.max(It(t,n),It(t,n-i),It(t-r,n),It(t-r,n-i));else if(1===e.shape){a=Math.max(Math.abs(n),Math.abs(n-i))/Math.max(Math.abs(t),Math.abs(t-r));var A=Ot(r,i,t,n,!1);u=A[0],l=A[1],s=a*(o=It(u-t,(l-n)/a))}}return Array.isArray(e.size)&&(o=ot(e.size[0],r),s=2===e.size.length?ot(e.size[1],i):o),[o,s]}(n,C,R,w,S),O=I[0],x=I[1],O>0&&x>0&&(N=r.ctx.createRadialGradient(E+C,b+R,0,E+C,b+R,O),Ct(n.stops,2*O).forEach((function(e){return N.addColorStop(e.stop,pt(e.color))})),r.path(_),r.ctx.fillStyle=N,O!==x?(B=e.bounds.left+.5*e.bounds.width,L=e.bounds.top+.5*e.bounds.height,M=1/(D=x/O),r.ctx.save(),r.ctx.translate(B,L),r.ctx.transform(1,0,0,D,0,0),r.ctx.translate(-B,-L),r.ctx.fillRect(E,M*(b-L)+L,w,S*M),r.ctx.restore()):r.ctx.fill())),i.label=6;case 6:return t--,[2]}}))},r=this,o=0,s=e.styles.backgroundImage.slice(0).reverse(),c.label=1;case 1:return o<s.length?(a=s[o],[5,n(a)]):[3,4];case 2:c.sent(),c.label=3;case 3:return o++,[3,1];case 4:return[2]}}))}))},n.prototype.renderSolidBorder=function(e,t,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return this.path(Zo(n,t)),this.ctx.fillStyle=pt(e),this.ctx.fill(),[2]}))}))},n.prototype.renderDoubleBorder=function(e,t,n,o){return r(this,void 0,void 0,(function(){var r,s;return i(this,(function(i){switch(i.label){case 0:return t<3?[4,this.renderSolidBorder(e,n,o)]:[3,2];case 1:return i.sent(),[2];case 2:return r=function(e,t){switch(t){case 0:return es(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return es(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return es(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);default:return es(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}}(o,n),this.path(r),this.ctx.fillStyle=pt(e),this.ctx.fill(),s=function(e,t){switch(t){case 0:return es(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return es(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return es(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);default:return es(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}}(o,n),this.path(s),this.ctx.fill(),[2]}}))}))},n.prototype.renderNodeBackgroundAndBorders=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,s,a,c,u,l=this;return i(this,(function(i){switch(i.label){case 0:return this.applyEffects(e.getEffects(2)),t=e.container.styles,n=!dt(t.backgroundColor)||t.backgroundImage.length,r=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],o=ps(as(t.backgroundClip,0),e.curves),n||t.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),dt(t.backgroundColor)||(this.ctx.fillStyle=pt(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:i.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach((function(t){l.ctx.save();var n,r,i,o,s,a=Vo(e.curves),c=t.inset?0:1e4,u=(n=a,r=-c+(t.inset?1:-1)*t.spread.number,i=(t.inset?1:-1)*t.spread.number,o=t.spread.number*(t.inset?-2:2),s=t.spread.number*(t.inset?-2:2),n.map((function(e,t){switch(t){case 0:return e.add(r,i);case 1:return e.add(r+o,i);case 2:return e.add(r+o,i+s);case 3:return e.add(r,i+s)}return e})));t.inset?(l.path(a),l.ctx.clip(),l.mask(u)):(l.mask(a),l.ctx.clip(),l.path(u)),l.ctx.shadowOffsetX=t.offsetX.number+c,l.ctx.shadowOffsetY=t.offsetY.number,l.ctx.shadowColor=pt(t.color),l.ctx.shadowBlur=t.blur.number,l.ctx.fillStyle=t.inset?pt(t.color):"rgba(0,0,0,1)",l.ctx.fill(),l.ctx.restore()})),i.label=2;case 2:s=0,a=0,c=r,i.label=3;case 3:return a<c.length?0!==(u=c[a]).style&&!dt(u.color)&&u.width>0?2!==u.style?[3,5]:[4,this.renderDashedDottedBorder(u.color,u.width,s,e.curves,2)]:[3,11]:[3,13];case 4:return i.sent(),[3,11];case 5:return 3!==u.style?[3,7]:[4,this.renderDashedDottedBorder(u.color,u.width,s,e.curves,3)];case 6:return i.sent(),[3,11];case 7:return 4!==u.style?[3,9]:[4,this.renderDoubleBorder(u.color,u.width,s,e.curves)];case 8:return i.sent(),[3,11];case 9:return[4,this.renderSolidBorder(u.color,s,e.curves)];case 10:i.sent(),i.label=11;case 11:s++,i.label=12;case 12:return a++,[3,3];case 13:return[2]}}))}))},n.prototype.renderDashedDottedBorder=function(e,t,n,o,s){return r(this,void 0,void 0,(function(){var r,a,c,u,l,A,h,d,p,f,g,m,v,y,_,E;return i(this,(function(i){return this.ctx.save(),r=function(e,t){switch(t){case 0:return $o(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return $o(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return $o(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);default:return $o(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}}(o,n),a=Zo(o,n),2===s&&(this.path(a),this.ctx.clip()),Uo(a[0])?(c=a[0].start.x,u=a[0].start.y):(c=a[0].x,u=a[0].y),Uo(a[1])?(l=a[1].end.x,A=a[1].end.y):(l=a[1].x,A=a[1].y),h=0===n||2===n?Math.abs(c-l):Math.abs(u-A),this.ctx.beginPath(),3===s?this.formatPath(r):this.formatPath(a.slice(0,2)),d=t<3?3*t:2*t,p=t<3?2*t:t,3===s&&(d=t,p=t),f=!0,h<=2*d?f=!1:h<=2*d+p?(d*=g=h/(2*d+p),p*=g):(m=Math.floor((h+p)/(d+p)),v=(h-m*d)/(m-1),p=(y=(h-(m+1)*d)/m)<=0||Math.abs(p-v)<Math.abs(p-y)?v:y),f&&(3===s?this.ctx.setLineDash([0,d+p]):this.ctx.setLineDash([d,p])),3===s?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=pt(e),this.ctx.stroke(),this.ctx.setLineDash([]),2===s&&(Uo(a[0])&&(_=a[3],E=a[0],this.ctx.beginPath(),this.formatPath([new Mo(_.end.x,_.end.y),new Mo(E.start.x,E.start.y)]),this.ctx.stroke()),Uo(a[1])&&(_=a[1],E=a[2],this.ctx.beginPath(),this.formatPath([new Mo(_.end.x,_.end.y),new Mo(E.start.x,E.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},n.prototype.render=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=pt(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),r=new Yo(e,null),i=new qo(r),Xo(r,i,i,o=[]),Jo(r.container,o),t=i,[4,this.renderStack(t)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}var r,i,o}))}))},n}(As),ds=function(e){return e instanceof _i||(e instanceof yi||e instanceof vi&&e.type!==fi&&e.type!==pi)},ps=function(e,t){switch(e){case 0:return Vo(t);case 2:return function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]}(t);default:return Qo(t)}},fs=function(e){switch(e){case 1:return"center";case 2:return"right";default:return"left"}},gs=["-apple-system","system-ui"],ms=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter((function(e){return-1===gs.indexOf(e)})):e},vs=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=n,r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),r}return t(n,e),n.prototype.render=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=zr(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,ys(t)];case 1:return n=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=pt(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},n}(As),ys=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},_s=function(){function e(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,o([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),Es=function(){function e(t,n){var r;this.windowBounds=n,this.instanceName="#"+e.instanceCount++,this.logger=new _s({id:this.instanceName,enabled:t.logging}),this.cache=null!==(r=t.cache)&&void 0!==r?r:new Co(this,t)}return e.instanceCount=1,e}();"undefined"!=typeof window&&To.setContext(window);var bs=function(e,t){return r(void 0,void 0,void 0,(function(){var r,o,c,u,l,A,h,d,p,f,g,m,v,y,_,E,b,w,S,T,C,R,I,O,x,N,B,L,D,M,P,k,U,F,H,V,Q,j;return i(this,(function(i){switch(i.label){case 0:if(!e||"object"!=typeof e)return[2,Promise.reject("Invalid element provided as first argument")];if(!(r=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(o=r.defaultView))throw new Error("Document is not attached to a Window");return c={allowTaint:null!==(R=t.allowTaint)&&void 0!==R&&R,imageTimeout:null!==(I=t.imageTimeout)&&void 0!==I?I:15e3,proxy:t.proxy,useCORS:null!==(O=t.useCORS)&&void 0!==O&&O},u=n({logging:null===(x=t.logging)||void 0===x||x,cache:t.cache},c),l={windowWidth:null!==(N=t.windowWidth)&&void 0!==N?N:o.innerWidth,windowHeight:null!==(B=t.windowHeight)&&void 0!==B?B:o.innerHeight,scrollX:null!==(L=t.scrollX)&&void 0!==L?L:o.pageXOffset,scrollY:null!==(D=t.scrollY)&&void 0!==D?D:o.pageYOffset},A=new s(l.scrollX,l.scrollY,l.windowWidth,l.windowHeight),h=new Es(u,A),d=null!==(M=t.foreignObjectRendering)&&void 0!==M&&M,p={allowTaint:null!==(P=t.allowTaint)&&void 0!==P&&P,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:d,copyStyles:d},h.logger.debug("Starting document clone with size "+A.width+"x"+A.height+" scrolled to "+-A.left+","+-A.top),f=new co(h,e,p),(g=f.clonedReferenceElement)?[4,f.toIFrame(r,A)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return m=i.sent(),v=Pi(g)||"HTML"===g.tagName?function(e){var t=e.body,n=e.documentElement;if(!t||!n)throw new Error("Unable to get document size");var r=Math.max(Math.max(t.scrollWidth,n.scrollWidth),Math.max(t.offsetWidth,n.offsetWidth),Math.max(t.clientWidth,n.clientWidth)),i=Math.max(Math.max(t.scrollHeight,n.scrollHeight),Math.max(t.offsetHeight,n.offsetHeight),Math.max(t.clientHeight,n.clientHeight));return new s(0,0,r,i)}(g.ownerDocument):a(h,g),y=v.width,_=v.height,E=v.left,b=v.top,w=ws(h,g,t.backgroundColor),S={canvas:t.canvas,backgroundColor:w,scale:null!==(U=null!==(k=t.scale)&&void 0!==k?k:o.devicePixelRatio)&&void 0!==U?U:1,x:(null!==(F=t.x)&&void 0!==F?F:0)+E,y:(null!==(H=t.y)&&void 0!==H?H:0)+b,width:null!==(V=t.width)&&void 0!==V?V:Math.ceil(y),height:null!==(Q=t.height)&&void 0!==Q?Q:Math.ceil(_)},d?(h.logger.debug("Document cloned, using foreign object rendering"),[4,new vs(h,S).render(g)]):[3,3];case 2:return T=i.sent(),[3,5];case 3:return h.logger.debug("Document cloned, element located at "+E+","+b+" with size "+y+"x"+_+" using computed rendering"),h.logger.debug("Starting DOM parsing"),C=Ti(h,g),w===C.styles.backgroundColor&&(C.styles.backgroundColor=bt.TRANSPARENT),h.logger.debug("Starting renderer for element at "+S.x+","+S.y+" with size "+S.width+"x"+S.height),[4,new hs(h,S).render(C)];case 4:T=i.sent(),i.label=5;case 5:return(null===(j=t.removeContainer)||void 0===j||j)&&(co.destroy(m)||h.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),h.logger.debug("Finished rendering"),[2,T]}}))}))},ws=function(e,t,n){var r=t.ownerDocument,i=r.documentElement?Et(e,getComputedStyle(r.documentElement).backgroundColor):bt.TRANSPARENT,o=r.body?Et(e,getComputedStyle(r.body).backgroundColor):bt.TRANSPARENT,s="string"==typeof n?Et(e,n):null===n?bt.TRANSPARENT:4294967295;return t===r.documentElement?dt(i)?dt(o)?s:o:i:s};return function(e,t){return void 0===t&&(t={}),bs(e,t)}})),
/**
 * @license beta-bhere-development v1.0.30-canary.0
 * (c) 2023 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THREE={})}(this,(function(e){"use strict";
/**
	 * @license
	 * Copyright 2010-2022 Three.js Authors
	 * SPDX-License-Identifier: MIT
	 */const t="138",n=100,r=300,i=301,o=302,s=303,a=304,c=306,u=307,l=1e3,A=1001,h=1002,d=1003,p=1004,f=1005,g=1006,m=1007,v=1008,y=1009,_=1012,E=1014,b=1015,w=1016,S=1020,T=1023,C=1026,R=1027,I=33776,O=33777,x=33778,N=33779,B=35840,L=35841,D=35842,M=35843,P=37492,k=37496,U=37808,F=37809,H=37810,V=37811,Q=37812,j=37813,G=37814,K=37815,W=37816,z=37817,q=37818,Y=37819,X=37820,J=37821,Z=36492,$=2300,ee=2301,te=2302,ne=2400,re=2401,ie=2402,oe=2500,se=2501,ae=3e3,ce=3001,ue=7680,le=35044,Ae=35048,he="300 es",de=1035;class pe{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const n=this._listeners[e];if(void 0!==n){const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const n=t.slice(0);for(let t=0,r=n.length;t<r;t++)n[t].call(this,e);e.target=null}}}const fe=[];for(let e=0;e<256;e++)fe[e]=(e<16?"0":"")+e.toString(16);let ge=1234567;const me=Math.PI/180,ve=180/Math.PI;function ye(){const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(fe[255&e]+fe[e>>8&255]+fe[e>>16&255]+fe[e>>24&255]+"-"+fe[255&t]+fe[t>>8&255]+"-"+fe[t>>16&15|64]+fe[t>>24&255]+"-"+fe[63&n|128]+fe[n>>8&255]+"-"+fe[n>>16&255]+fe[n>>24&255]+fe[255&r]+fe[r>>8&255]+fe[r>>16&255]+fe[r>>24&255]).toUpperCase()}function _e(e,t,n){return Math.max(t,Math.min(n,e))}function Ee(e,t){return(e%t+t)%t}function be(e,t,n){return(1-n)*e+n*t}function we(e){return 0==(e&e-1)&&0!==e}function Se(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Te(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Ce=Object.freeze({__proto__:null,DEG2RAD:me,RAD2DEG:ve,generateUUID:ye,clamp:_e,euclideanModulo:Ee,mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:be,damp:function(e,t,n,r){return be(e,t,1-Math.exp(-n*r))},pingpong:function(e,t=1){return t-Math.abs(Ee(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(ge=e%2147483647),ge=16807*ge%2147483647,(ge-1)/2147483646},degToRad:function(e){return e*me},radToDeg:function(e){return e*ve},isPowerOfTwo:we,ceilPowerOfTwo:Se,floorPowerOfTwo:Te,setQuaternionFromProperEuler:function(e,t,n,r,i){const o=Math.cos,s=Math.sin,a=o(n/2),c=s(n/2),u=o((t+r)/2),l=s((t+r)/2),A=o((t-r)/2),h=s((t-r)/2),d=o((r-t)/2),p=s((r-t)/2);switch(i){case"XYX":e.set(a*l,c*A,c*h,a*u);break;case"YZY":e.set(c*h,a*l,c*A,a*u);break;case"ZXZ":e.set(c*A,c*h,a*l,a*u);break;case"XZX":e.set(a*l,c*p,c*d,a*u);break;case"YXY":e.set(c*d,a*l,c*p,a*u);break;case"ZYZ":e.set(c*p,c*d,a*l,a*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}});class Re{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*r+e.x,this.y=i*r+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Re.prototype.isVector2=!0;class Ie{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,s,a,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=s,u[3]=t,u[4]=i,u[5]=a,u[6]=n,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[3],a=n[6],c=n[1],u=n[4],l=n[7],A=n[2],h=n[5],d=n[8],p=r[0],f=r[3],g=r[6],m=r[1],v=r[4],y=r[7],_=r[2],E=r[5],b=r[8];return i[0]=o*p+s*m+a*_,i[3]=o*f+s*v+a*E,i[6]=o*g+s*y+a*b,i[1]=c*p+u*m+l*_,i[4]=c*f+u*v+l*E,i[7]=c*g+u*y+l*b,i[2]=A*p+h*m+d*_,i[5]=A*f+h*v+d*E,i[8]=A*g+h*y+d*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],u=e[8];return t*o*u-t*s*c-n*i*u+n*s*a+r*i*c-r*o*a}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],u=e[8],l=u*o-s*c,A=s*a-u*i,h=c*i-o*a,d=t*l+n*A+r*h;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const p=1/d;return e[0]=l*p,e[1]=(r*c-u*n)*p,e[2]=(s*n-r*o)*p,e[3]=A*p,e[4]=(u*t-r*a)*p,e[5]=(r*i-s*t)*p,e[6]=h*p,e[7]=(n*a-c*t)*p,e[8]=(o*t-n*i)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,i,o,s){const a=Math.cos(i),c=Math.sin(i);return this.set(n*a,n*c,-n*(a*o+c*s)+o+e,-r*c,r*a,-r*(-c*o+a*s)+s+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],o=r[3],s=r[6],a=r[1],c=r[4],u=r[7];return r[0]=t*i+n*a,r[3]=t*o+n*c,r[6]=t*s+n*u,r[1]=-n*i+t*a,r[4]=-n*o+t*c,r[7]=-n*s+t*u,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<9;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function Oe(e){for(let t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}Ie.prototype.isMatrix3=!0;const xe={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Ne(e,t){return new xe[e](t)}function Be(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}const Le={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},De={h:0,s:0,l:0},Me={h:0,s:0,l:0};function Pe(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function ke(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Ue(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Fe{constructor(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,n){return this.r=e,this.g=t,this.b=n,this}setHSL(e,t,n){if(e=Ee(e,1),t=_e(t,0,1),n=_e(n,0,1),0===t)this.r=this.g=this.b=n;else{const r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Pe(i,r,e+1/3),this.g=Pe(i,r,e),this.b=Pe(i,r,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const r=n[1],i=n[2];switch(r){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(i)){const n=parseFloat(e[1])/360,r=parseInt(e[2],10)/100,i=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(n,r,i)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=n[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=Le[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=ke(e.r),this.g=ke(e.g),this.b=ke(e.b),this}copyLinearToSRGB(e){return this.r=Ue(e.r),this.g=Ue(e.g),this.b=Ue(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),o=Math.min(t,n,r);let s,a;const c=(o+i)/2;if(o===i)s=0,a=0;else{const e=i-o;switch(a=c<=.5?e/(i+o):e/(2-i-o),i){case t:s=(n-r)/e+(n<r?6:0);break;case n:s=(r-t)/e+2;break;case r:s=(t-n)/e+4}s/=6}return e.h=s,e.s=a,e.l=c,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,n){return this.getHSL(De),De.h+=e,De.s+=t,De.l+=n,this.setHSL(De.h,De.s,De.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(De),e.getHSL(Me);const n=be(De.h,Me.h,t),r=be(De.s,Me.s,t),i=be(De.l,Me.l,t);return this.setHSL(n,r,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}let He;Fe.NAMES=Le,Fe.prototype.isColor=!0,Fe.prototype.r=1,Fe.prototype.g=1,Fe.prototype.b=1;class Ve{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===He&&(He=Be("canvas")),He.width=e.width,He.height=e.height;const n=He.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=He}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const t=Be("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),i=r.data;for(let e=0;e<i.length;e++)i[e]=255*ke(i[e]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let e=0;e<t.length;e++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[e]=Math.floor(255*ke(t[e]/255)):t[e]=ke(t[e]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class Qe{constructor(e=null){this.uuid=ye(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(null!==r){let e;if(Array.isArray(r)){e=[];for(let t=0,n=r.length;t<n;t++)r[t].isDataTexture?e.push(je(r[t].image)):e.push(je(r[t]))}else e=je(r);n.url=e}return t||(e.images[this.uuid]=n),n}}function je(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?Ve.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Qe.prototype.isSource=!0;let Ge=0;class Ke extends pe{constructor(e=Ke.DEFAULT_IMAGE,t=Ke.DEFAULT_MAPPING,n=1001,r=1001,i=1006,o=1008,s=1023,a=1009,c=1,u=3e3){super(),Object.defineProperty(this,"id",{value:Ge++}),this.uuid=ye(),this.name="",this.source=new Qe(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=o,this.anisotropy=c,this.format=s,this.internalFormat=null,this.type=a,this.offset=new Re(0,0),this.repeat=new Re(1,1),this.center=new Re(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ie,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==r)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case l:e.x=e.x-Math.floor(e.x);break;case A:e.x=e.x<0?0:1;break;case h:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case l:e.y=e.y-Math.floor(e.y);break;case A:e.y=e.y<0?0:1;break;case h:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}Ke.DEFAULT_IMAGE=null,Ke.DEFAULT_MAPPING=r,Ke.prototype.isTexture=!0;class We{constructor(e=0,t=0,n=0,r=1){this.x=e,this.y=t,this.z=n,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*r+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,r,i;const o=.01,s=.1,a=e.elements,c=a[0],u=a[4],l=a[8],A=a[1],h=a[5],d=a[9],p=a[2],f=a[6],g=a[10];if(Math.abs(u-A)<o&&Math.abs(l-p)<o&&Math.abs(d-f)<o){if(Math.abs(u+A)<s&&Math.abs(l+p)<s&&Math.abs(d+f)<s&&Math.abs(c+h+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;const e=(c+1)/2,a=(h+1)/2,m=(g+1)/2,v=(u+A)/4,y=(l+p)/4,_=(d+f)/4;return e>a&&e>m?e<o?(n=0,r=.707106781,i=.707106781):(n=Math.sqrt(e),r=v/n,i=y/n):a>m?a<o?(n=.707106781,r=0,i=.707106781):(r=Math.sqrt(a),n=v/r,i=_/r):m<o?(n=.707106781,r=.707106781,i=0):(i=Math.sqrt(m),n=y/i,r=_/i),this.set(n,r,i,t),this}let m=Math.sqrt((f-d)*(f-d)+(l-p)*(l-p)+(A-u)*(A-u));return Math.abs(m)<.001&&(m=1),this.x=(f-d)/m,this.y=(l-p)/m,this.z=(A-u)/m,this.w=Math.acos((c+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}We.prototype.isVector4=!0;class ze extends pe{constructor(e,t,n={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new We(0,0,e,t),this.scissorTest=!1,this.viewport=new We(0,0,e,t);const r={width:e,height:t,depth:1};this.texture=new Ke(r,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.internalFormat=void 0!==n.internalFormat?n.internalFormat:null,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:g,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0!==n.stencilBuffer&&n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null,this.samples=void 0!==n.samples?n.samples:0}setSize(e,t,n=1){this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}ze.prototype.isWebGLRenderTarget=!0;class qe extends Ke{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=d,this.minFilter=d,this.wrapR=A,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}qe.prototype.isDataArrayTexture=!0;class Ye extends ze{constructor(e,t,n){super(e,t),this.depth=n,this.texture=new qe(null,e,t,n),this.texture.isRenderTargetTexture=!0}}Ye.prototype.isWebGLArrayRenderTarget=!0;class Xe extends Ke{constructor(e=null,t=1,n=1,r=1){super(null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=d,this.minFilter=d,this.wrapR=A,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Xe.prototype.isData3DTexture=!0;class Je extends ze{constructor(e,t,n){super(e,t),this.depth=n,this.texture=new Xe(null,e,t,n),this.texture.isRenderTargetTexture=!0}}Je.prototype.isWebGL3DRenderTarget=!0;class Ze extends ze{constructor(e,t,n,r={}){super(e,t,r);const i=this.texture;this.texture=[];for(let e=0;e<n;e++)this.texture[e]=i.clone(),this.texture[e].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let r=0,i=this.texture.length;r<i;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}}Ze.prototype.isWebGLMultipleRenderTargets=!0;class $e{constructor(e=0,t=0,n=0,r=1){this._x=e,this._y=t,this._z=n,this._w=r}static slerp(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}static slerpFlat(e,t,n,r,i,o,s){let a=n[r+0],c=n[r+1],u=n[r+2],l=n[r+3];const A=i[o+0],h=i[o+1],d=i[o+2],p=i[o+3];if(0===s)return e[t+0]=a,e[t+1]=c,e[t+2]=u,void(e[t+3]=l);if(1===s)return e[t+0]=A,e[t+1]=h,e[t+2]=d,void(e[t+3]=p);if(l!==p||a!==A||c!==h||u!==d){let e=1-s;const t=a*A+c*h+u*d+l*p,n=t>=0?1:-1,r=1-t*t;if(r>Number.EPSILON){const i=Math.sqrt(r),o=Math.atan2(i,t*n);e=Math.sin(e*o)/i,s=Math.sin(s*o)/i}const i=s*n;if(a=a*e+A*i,c=c*e+h*i,u=u*e+d*i,l=l*e+p*i,e===1-s){const e=1/Math.sqrt(a*a+c*c+u*u+l*l);a*=e,c*=e,u*=e,l*=e}}e[t]=a,e[t+1]=c,e[t+2]=u,e[t+3]=l}static multiplyQuaternionsFlat(e,t,n,r,i,o){const s=n[r],a=n[r+1],c=n[r+2],u=n[r+3],l=i[o],A=i[o+1],h=i[o+2],d=i[o+3];return e[t]=s*d+u*l+a*h-c*A,e[t+1]=a*d+u*A+c*l-s*h,e[t+2]=c*d+u*h+s*A-a*l,e[t+3]=u*d-s*l-a*A-c*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=e._x,r=e._y,i=e._z,o=e._order,s=Math.cos,a=Math.sin,c=s(n/2),u=s(r/2),l=s(i/2),A=a(n/2),h=a(r/2),d=a(i/2);switch(o){case"XYZ":this._x=A*u*l+c*h*d,this._y=c*h*l-A*u*d,this._z=c*u*d+A*h*l,this._w=c*u*l-A*h*d;break;case"YXZ":this._x=A*u*l+c*h*d,this._y=c*h*l-A*u*d,this._z=c*u*d-A*h*l,this._w=c*u*l+A*h*d;break;case"ZXY":this._x=A*u*l-c*h*d,this._y=c*h*l+A*u*d,this._z=c*u*d+A*h*l,this._w=c*u*l-A*h*d;break;case"ZYX":this._x=A*u*l-c*h*d,this._y=c*h*l+A*u*d,this._z=c*u*d-A*h*l,this._w=c*u*l+A*h*d;break;case"YZX":this._x=A*u*l+c*h*d,this._y=c*h*l+A*u*d,this._z=c*u*d-A*h*l,this._w=c*u*l-A*h*d;break;case"XZY":this._x=A*u*l-c*h*d,this._y=c*h*l-A*u*d,this._z=c*u*d+A*h*l,this._w=c*u*l+A*h*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],r=t[4],i=t[8],o=t[1],s=t[5],a=t[9],c=t[2],u=t[6],l=t[10],A=n+s+l;if(A>0){const e=.5/Math.sqrt(A+1);this._w=.25/e,this._x=(u-a)*e,this._y=(i-c)*e,this._z=(o-r)*e}else if(n>s&&n>l){const e=2*Math.sqrt(1+n-s-l);this._w=(u-a)/e,this._x=.25*e,this._y=(r+o)/e,this._z=(i+c)/e}else if(s>l){const e=2*Math.sqrt(1+s-n-l);this._w=(i-c)/e,this._x=(r+o)/e,this._y=.25*e,this._z=(a+u)/e}else{const e=2*Math.sqrt(1+l-n-s);this._w=(o-r)/e,this._x=(i+c)/e,this._y=(a+u)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(_e(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(0===n)return this;const r=Math.min(1,t/n);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,r=e._y,i=e._z,o=e._w,s=t._x,a=t._y,c=t._z,u=t._w;return this._x=n*u+o*s+r*c-i*a,this._y=r*u+o*a+i*s-n*c,this._z=i*u+o*c+n*a-r*s,this._w=o*u-n*s-r*a-i*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const n=this._x,r=this._y,i=this._z,o=this._w;let s=o*e._w+n*e._x+r*e._y+i*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=n,this._y=r,this._z=i,this;const a=1-s*s;if(a<=Number.EPSILON){const e=1-t;return this._w=e*o+t*this._w,this._x=e*n+t*this._x,this._y=e*r+t*this._y,this._z=e*i+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(a),u=Math.atan2(c,s),l=Math.sin((1-t)*u)/c,A=Math.sin(t*u)/c;return this._w=o*l+this._w*A,this._x=n*l+this._x*A,this._y=r*l+this._y*A,this._z=i*l+this._z*A,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(i),n*Math.cos(i),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}$e.prototype.isQuaternion=!0;class et{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(nt.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(nt.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,r=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,r=this.z,i=e.x,o=e.y,s=e.z,a=e.w,c=a*t+o*r-s*n,u=a*n+s*t-i*r,l=a*r+i*n-o*t,A=-i*t-o*n-s*r;return this.x=c*a+A*-i+u*-s-l*-o,this.y=u*a+A*-o+l*-i-c*-s,this.z=l*a+A*-s+c*-o-u*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,r=e.y,i=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-i*s,this.y=i*o-n*a,this.z=n*s-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return tt.copy(this).projectOnVector(e),this.sub(tt)}reflect(e){return this.sub(tt.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(_e(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}et.prototype.isVector3=!0;const tt=new et,nt=new $e;class rt{constructor(e=new et(1/0,1/0,1/0),t=new et(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,c=e.length;a<c;a+=3){const c=e[a],u=e[a+1],l=e[a+2];c<t&&(t=c),u<n&&(n=u),l<r&&(r=l),c>i&&(i=c),u>o&&(o=u),l>s&&(s=l)}return this.min.set(t,n,r),this.max.set(i,o,s),this}setFromBufferAttribute(e){let t=1/0,n=1/0,r=1/0,i=-1/0,o=-1/0,s=-1/0;for(let a=0,c=e.count;a<c;a++){const c=e.getX(a),u=e.getY(a),l=e.getZ(a);c<t&&(t=c),u<n&&(n=u),l<r&&(r=l),c>i&&(i=c),u>o&&(o=u),l>s&&(s=l)}return this.min.set(t,n,r),this.max.set(i,o,s),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=ot.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(void 0!==n)if(t&&null!=n.attributes&&void 0!==n.attributes.position){const t=n.attributes.position;for(let n=0,r=t.count;n<r;n++)ot.fromBufferAttribute(t,n).applyMatrix4(e.matrixWorld),this.expandByPoint(ot)}else null===n.boundingBox&&n.computeBoundingBox(),st.copy(n.boundingBox),st.applyMatrix4(e.matrixWorld),this.union(st);const r=e.children;for(let e=0,n=r.length;e<n;e++)this.expandByObject(r[e],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,ot),ot.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(dt),pt.subVectors(this.max,dt),at.subVectors(e.a,dt),ct.subVectors(e.b,dt),ut.subVectors(e.c,dt),lt.subVectors(ct,at),At.subVectors(ut,ct),ht.subVectors(at,ut);let t=[0,-lt.z,lt.y,0,-At.z,At.y,0,-ht.z,ht.y,lt.z,0,-lt.x,At.z,0,-At.x,ht.z,0,-ht.x,-lt.y,lt.x,0,-At.y,At.x,0,-ht.y,ht.x,0];return!!mt(t,at,ct,ut,pt)&&(t=[1,0,0,0,1,0,0,0,1],!!mt(t,at,ct,ut,pt)&&(ft.crossVectors(lt,At),t=[ft.x,ft.y,ft.z],mt(t,at,ct,ut,pt)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return ot.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(ot).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(it[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),it[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),it[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),it[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),it[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),it[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),it[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),it[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(it)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}rt.prototype.isBox3=!0;const it=[new et,new et,new et,new et,new et,new et,new et,new et],ot=new et,st=new rt,at=new et,ct=new et,ut=new et,lt=new et,At=new et,ht=new et,dt=new et,pt=new et,ft=new et,gt=new et;function mt(e,t,n,r,i){for(let o=0,s=e.length-3;o<=s;o+=3){gt.fromArray(e,o);const s=i.x*Math.abs(gt.x)+i.y*Math.abs(gt.y)+i.z*Math.abs(gt.z),a=t.dot(gt),c=n.dot(gt),u=r.dot(gt);if(Math.max(-Math.max(a,c,u),Math.min(a,c,u))>s)return!1}return!0}const vt=new rt,yt=new et,_t=new et,Et=new et;class bt{constructor(e=new et,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;void 0!==t?n.copy(t):vt.setFromPoints(e).getCenter(n);let r=0;for(let t=0,i=e.length;t<i;t++)r=Math.max(r,n.distanceToSquared(e[t]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Et.subVectors(e,this.center);const t=Et.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),n=.5*(e-this.radius);this.center.add(Et.multiplyScalar(n/e)),this.radius+=n}return this}union(e){return!0===this.center.equals(e.center)?_t.set(0,0,1).multiplyScalar(e.radius):_t.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(yt.copy(e.center).add(_t)),this.expandByPoint(yt.copy(e.center).sub(_t)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const wt=new et,St=new et,Tt=new et,Ct=new et,Rt=new et,It=new et,Ot=new et;class xt{constructor(e=new et,t=new et(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,wt)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=wt.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(wt.copy(this.direction).multiplyScalar(t).add(this.origin),wt.distanceToSquared(e))}distanceSqToSegment(e,t,n,r){St.copy(e).add(t).multiplyScalar(.5),Tt.copy(t).sub(e).normalize(),Ct.copy(this.origin).sub(St);const i=.5*e.distanceTo(t),o=-this.direction.dot(Tt),s=Ct.dot(this.direction),a=-Ct.dot(Tt),c=Ct.lengthSq(),u=Math.abs(1-o*o);let l,A,h,d;if(u>0)if(l=o*a-s,A=o*s-a,d=i*u,l>=0)if(A>=-d)if(A<=d){const e=1/u;l*=e,A*=e,h=l*(l+o*A+2*s)+A*(o*l+A+2*a)+c}else A=i,l=Math.max(0,-(o*A+s)),h=-l*l+A*(A+2*a)+c;else A=-i,l=Math.max(0,-(o*A+s)),h=-l*l+A*(A+2*a)+c;else A<=-d?(l=Math.max(0,-(-o*i+s)),A=l>0?-i:Math.min(Math.max(-i,-a),i),h=-l*l+A*(A+2*a)+c):A<=d?(l=0,A=Math.min(Math.max(-i,-a),i),h=A*(A+2*a)+c):(l=Math.max(0,-(o*i+s)),A=l>0?i:Math.min(Math.max(-i,-a),i),h=-l*l+A*(A+2*a)+c);else A=o>0?-i:i,l=Math.max(0,-(o*A+s)),h=-l*l+A*(A+2*a)+c;return n&&n.copy(this.direction).multiplyScalar(l).add(this.origin),r&&r.copy(Tt).multiplyScalar(A).add(St),h}intersectSphere(e,t){wt.subVectors(e.center,this.origin);const n=wt.dot(this.direction),r=wt.dot(wt)-n*n,i=e.radius*e.radius;if(r>i)return null;const o=Math.sqrt(i-r),s=n-o,a=n+o;return s<0&&a<0?null:s<0?this.at(a,t):this.at(s,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,r,i,o,s,a;const c=1/this.direction.x,u=1/this.direction.y,l=1/this.direction.z,A=this.origin;return c>=0?(n=(e.min.x-A.x)*c,r=(e.max.x-A.x)*c):(n=(e.max.x-A.x)*c,r=(e.min.x-A.x)*c),u>=0?(i=(e.min.y-A.y)*u,o=(e.max.y-A.y)*u):(i=(e.max.y-A.y)*u,o=(e.min.y-A.y)*u),n>o||i>r?null:((i>n||n!=n)&&(n=i),(o<r||r!=r)&&(r=o),l>=0?(s=(e.min.z-A.z)*l,a=(e.max.z-A.z)*l):(s=(e.max.z-A.z)*l,a=(e.min.z-A.z)*l),n>a||s>r?null:((s>n||n!=n)&&(n=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(n>=0?n:r,t)))}intersectsBox(e){return null!==this.intersectBox(e,wt)}intersectTriangle(e,t,n,r,i){Rt.subVectors(t,e),It.subVectors(n,e),Ot.crossVectors(Rt,It);let o,s=this.direction.dot(Ot);if(s>0){if(r)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}Ct.subVectors(this.origin,e);const a=o*this.direction.dot(It.crossVectors(Ct,It));if(a<0)return null;const c=o*this.direction.dot(Rt.cross(Ct));if(c<0)return null;if(a+c>s)return null;const u=-o*Ct.dot(Ot);return u<0?null:this.at(u/s,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Nt{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,r,i,o,s,a,c,u,l,A,h,d,p,f){const g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=r,g[1]=i,g[5]=o,g[9]=s,g[13]=a,g[2]=c,g[6]=u,g[10]=l,g[14]=A,g[3]=h,g[7]=d,g[11]=p,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Nt).fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,r=1/Bt.setFromMatrixColumn(e,0).length(),i=1/Bt.setFromMatrixColumn(e,1).length(),o=1/Bt.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,n=e.x,r=e.y,i=e.z,o=Math.cos(n),s=Math.sin(n),a=Math.cos(r),c=Math.sin(r),u=Math.cos(i),l=Math.sin(i);if("XYZ"===e.order){const e=o*u,n=o*l,r=s*u,i=s*l;t[0]=a*u,t[4]=-a*l,t[8]=c,t[1]=n+r*c,t[5]=e-i*c,t[9]=-s*a,t[2]=i-e*c,t[6]=r+n*c,t[10]=o*a}else if("YXZ"===e.order){const e=a*u,n=a*l,r=c*u,i=c*l;t[0]=e+i*s,t[4]=r*s-n,t[8]=o*c,t[1]=o*l,t[5]=o*u,t[9]=-s,t[2]=n*s-r,t[6]=i+e*s,t[10]=o*a}else if("ZXY"===e.order){const e=a*u,n=a*l,r=c*u,i=c*l;t[0]=e-i*s,t[4]=-o*l,t[8]=r+n*s,t[1]=n+r*s,t[5]=o*u,t[9]=i-e*s,t[2]=-o*c,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){const e=o*u,n=o*l,r=s*u,i=s*l;t[0]=a*u,t[4]=r*c-n,t[8]=e*c+i,t[1]=a*l,t[5]=i*c+e,t[9]=n*c-r,t[2]=-c,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){const e=o*a,n=o*c,r=s*a,i=s*c;t[0]=a*u,t[4]=i-e*l,t[8]=r*l+n,t[1]=l,t[5]=o*u,t[9]=-s*u,t[2]=-c*u,t[6]=n*l+r,t[10]=e-i*l}else if("XZY"===e.order){const e=o*a,n=o*c,r=s*a,i=s*c;t[0]=a*u,t[4]=-l,t[8]=c*u,t[1]=e*l+i,t[5]=o*u,t[9]=n*l-r,t[2]=r*l-n,t[6]=s*u,t[10]=i*l+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Dt,e,Mt)}lookAt(e,t,n){const r=this.elements;return Ut.subVectors(e,t),0===Ut.lengthSq()&&(Ut.z=1),Ut.normalize(),Pt.crossVectors(n,Ut),0===Pt.lengthSq()&&(1===Math.abs(n.z)?Ut.x+=1e-4:Ut.z+=1e-4,Ut.normalize(),Pt.crossVectors(n,Ut)),Pt.normalize(),kt.crossVectors(Ut,Pt),r[0]=Pt.x,r[4]=kt.x,r[8]=Ut.x,r[1]=Pt.y,r[5]=kt.y,r[9]=Ut.y,r[2]=Pt.z,r[6]=kt.z,r[10]=Ut.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,i=this.elements,o=n[0],s=n[4],a=n[8],c=n[12],u=n[1],l=n[5],A=n[9],h=n[13],d=n[2],p=n[6],f=n[10],g=n[14],m=n[3],v=n[7],y=n[11],_=n[15],E=r[0],b=r[4],w=r[8],S=r[12],T=r[1],C=r[5],R=r[9],I=r[13],O=r[2],x=r[6],N=r[10],B=r[14],L=r[3],D=r[7],M=r[11],P=r[15];return i[0]=o*E+s*T+a*O+c*L,i[4]=o*b+s*C+a*x+c*D,i[8]=o*w+s*R+a*N+c*M,i[12]=o*S+s*I+a*B+c*P,i[1]=u*E+l*T+A*O+h*L,i[5]=u*b+l*C+A*x+h*D,i[9]=u*w+l*R+A*N+h*M,i[13]=u*S+l*I+A*B+h*P,i[2]=d*E+p*T+f*O+g*L,i[6]=d*b+p*C+f*x+g*D,i[10]=d*w+p*R+f*N+g*M,i[14]=d*S+p*I+f*B+g*P,i[3]=m*E+v*T+y*O+_*L,i[7]=m*b+v*C+y*x+_*D,i[11]=m*w+v*R+y*N+_*M,i[15]=m*S+v*I+y*B+_*P,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],o=e[1],s=e[5],a=e[9],c=e[13],u=e[2],l=e[6],A=e[10],h=e[14];return e[3]*(+i*a*l-r*c*l-i*s*A+n*c*A+r*s*h-n*a*h)+e[7]*(+t*a*h-t*c*A+i*o*A-r*o*h+r*c*u-i*a*u)+e[11]*(+t*c*l-t*s*h-i*o*l+n*o*h+i*s*u-n*c*u)+e[15]*(-r*s*u-t*a*l+t*s*A+r*o*l-n*o*A+n*a*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],s=e[5],a=e[6],c=e[7],u=e[8],l=e[9],A=e[10],h=e[11],d=e[12],p=e[13],f=e[14],g=e[15],m=l*f*c-p*A*c+p*a*h-s*f*h-l*a*g+s*A*g,v=d*A*c-u*f*c-d*a*h+o*f*h+u*a*g-o*A*g,y=u*p*c-d*l*c+d*s*h-o*p*h-u*s*g+o*l*g,_=d*l*a-u*p*a-d*s*A+o*p*A+u*s*f-o*l*f,E=t*m+n*v+r*y+i*_;if(0===E)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/E;return e[0]=m*b,e[1]=(p*A*i-l*f*i-p*r*h+n*f*h+l*r*g-n*A*g)*b,e[2]=(s*f*i-p*a*i+p*r*c-n*f*c-s*r*g+n*a*g)*b,e[3]=(l*a*i-s*A*i-l*r*c+n*A*c+s*r*h-n*a*h)*b,e[4]=v*b,e[5]=(u*f*i-d*A*i+d*r*h-t*f*h-u*r*g+t*A*g)*b,e[6]=(d*a*i-o*f*i-d*r*c+t*f*c+o*r*g-t*a*g)*b,e[7]=(o*A*i-u*a*i+u*r*c-t*A*c-o*r*h+t*a*h)*b,e[8]=y*b,e[9]=(d*l*i-u*p*i-d*n*h+t*p*h+u*n*g-t*l*g)*b,e[10]=(o*p*i-d*s*i+d*n*c-t*p*c-o*n*g+t*s*g)*b,e[11]=(u*s*i-o*l*i-u*n*c+t*l*c+o*n*h-t*s*h)*b,e[12]=_*b,e[13]=(u*p*r-d*l*r+d*n*A-t*p*A-u*n*f+t*l*f)*b,e[14]=(d*s*r-o*p*r-d*n*a+t*p*a+o*n*f-t*s*f)*b,e[15]=(o*l*r-u*s*r+u*n*a-t*l*a-o*n*A+t*s*A)*b,this}scale(e){const t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),r=Math.sin(t),i=1-n,o=e.x,s=e.y,a=e.z,c=i*o,u=i*s;return this.set(c*o+n,c*s-r*a,c*a+r*s,0,c*s+r*a,u*s+n,u*a-r*o,0,c*a-r*s,u*a+r*o,i*a*a+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,r,i,o){return this.set(1,n,i,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,n){const r=this.elements,i=t._x,o=t._y,s=t._z,a=t._w,c=i+i,u=o+o,l=s+s,A=i*c,h=i*u,d=i*l,p=o*u,f=o*l,g=s*l,m=a*c,v=a*u,y=a*l,_=n.x,E=n.y,b=n.z;return r[0]=(1-(p+g))*_,r[1]=(h+y)*_,r[2]=(d-v)*_,r[3]=0,r[4]=(h-y)*E,r[5]=(1-(A+g))*E,r[6]=(f+m)*E,r[7]=0,r[8]=(d+v)*b,r[9]=(f-m)*b,r[10]=(1-(A+p))*b,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,n){const r=this.elements;let i=Bt.set(r[0],r[1],r[2]).length();const o=Bt.set(r[4],r[5],r[6]).length(),s=Bt.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],Lt.copy(this);const a=1/i,c=1/o,u=1/s;return Lt.elements[0]*=a,Lt.elements[1]*=a,Lt.elements[2]*=a,Lt.elements[4]*=c,Lt.elements[5]*=c,Lt.elements[6]*=c,Lt.elements[8]*=u,Lt.elements[9]*=u,Lt.elements[10]*=u,t.setFromRotationMatrix(Lt),n.x=i,n.y=o,n.z=s,this}makePerspective(e,t,n,r,i,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const s=this.elements,a=2*i/(t-e),c=2*i/(n-r),u=(t+e)/(t-e),l=(n+r)/(n-r),A=-(o+i)/(o-i),h=-2*o*i/(o-i);return s[0]=a,s[4]=0,s[8]=u,s[12]=0,s[1]=0,s[5]=c,s[9]=l,s[13]=0,s[2]=0,s[6]=0,s[10]=A,s[14]=h,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this}makeOrthographic(e,t,n,r,i,o){const s=this.elements,a=1/(t-e),c=1/(n-r),u=1/(o-i),l=(t+e)*a,A=(n+r)*c,h=(o+i)*u;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-l,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-A,s[2]=0,s[6]=0,s[10]=-2*u,s[14]=-h,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let e=0;e<16;e++)if(t[e]!==n[e])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}Nt.prototype.isMatrix4=!0;const Bt=new et,Lt=new Nt,Dt=new et(0,0,0),Mt=new et(1,1,1),Pt=new et,kt=new et,Ut=new et,Ft=new Nt,Ht=new $e;class Vt{constructor(e=0,t=0,n=0,r=Vt.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,r=this._order){return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const r=e.elements,i=r[0],o=r[4],s=r[8],a=r[1],c=r[5],u=r[9],l=r[2],A=r[6],h=r[10];switch(t){case"XYZ":this._y=Math.asin(_e(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-u,h),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(A,c),this._z=0);break;case"YXZ":this._x=Math.asin(-_e(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(s,h),this._z=Math.atan2(a,c)):(this._y=Math.atan2(-l,i),this._z=0);break;case"ZXY":this._x=Math.asin(_e(A,-1,1)),Math.abs(A)<.9999999?(this._y=Math.atan2(-l,h),this._z=Math.atan2(-o,c)):(this._y=0,this._z=Math.atan2(a,i));break;case"ZYX":this._y=Math.asin(-_e(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(A,h),this._z=Math.atan2(a,i)):(this._x=0,this._z=Math.atan2(-o,c));break;case"YZX":this._z=Math.asin(_e(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,c),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(s,h));break;case"XZY":this._z=Math.asin(-_e(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(A,c),this._y=Math.atan2(s,i)):(this._x=Math.atan2(-u,h),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Ft.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Ft,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Ht.setFromEuler(this),this.setFromQuaternion(Ht,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Vt.prototype.isEuler=!0,Vt.DefaultOrder="XYZ",Vt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Qt{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let jt=0;const Gt=new et,Kt=new $e,Wt=new Nt,zt=new et,qt=new et,Yt=new et,Xt=new $e,Jt=new et(1,0,0),Zt=new et(0,1,0),$t=new et(0,0,1),en={type:"added"},tn={type:"removed"};class nn extends pe{constructor(){super(),Object.defineProperty(this,"id",{value:jt++}),this.uuid=ye(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=nn.DefaultUp.clone();const e=new et,t=new Vt,n=new $e,r=new et(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Nt},normalMatrix:{value:new Ie}}),this.matrix=new Nt,this.matrixWorld=new Nt,this.matrixAutoUpdate=nn.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Qt,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Kt.setFromAxisAngle(e,t),this.quaternion.multiply(Kt),this}rotateOnWorldAxis(e,t){return Kt.setFromAxisAngle(e,t),this.quaternion.premultiply(Kt),this}rotateX(e){return this.rotateOnAxis(Jt,e)}rotateY(e){return this.rotateOnAxis(Zt,e)}rotateZ(e){return this.rotateOnAxis($t,e)}translateOnAxis(e,t){return Gt.copy(e).applyQuaternion(this.quaternion),this.position.add(Gt.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Jt,e)}translateY(e){return this.translateOnAxis(Zt,e)}translateZ(e){return this.translateOnAxis($t,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(Wt.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?zt.copy(e):zt.set(e,t,n);const r=this.parent;this.updateWorldMatrix(!0,!1),qt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Wt.lookAt(qt,zt,this.up):Wt.lookAt(zt,qt,this.up),this.quaternion.setFromRotationMatrix(Wt),r&&(Wt.extractRotation(r.matrixWorld),Kt.setFromRotationMatrix(Wt),this.quaternion.premultiply(Kt.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(en)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(tn)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(tn)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),Wt.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Wt.multiply(e.parent.matrixWorld)),e.applyMatrix4(Wt),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,r=this.children.length;n<r;n++){const r=this.children[n].getObjectByProperty(e,t);if(void 0!==r)return r}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qt,e,Yt),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(qt,Xt,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,n=e.length;t<n;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let t=0,r=n.length;t<r;t++){const r=n[t];i(e.shapes,r)}else i(e.shapes,n)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let n=0,r=this.material.length;n<r;n++)t.push(i(e.materials,this.material[n]));r.material=t}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(let t=0;t<this.children.length;t++)r.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let t=0;t<this.animations.length;t++){const n=this.animations[t];r.animations.push(i(e.animations,n))}}if(t){const t=o(e.geometries),r=o(e.materials),i=o(e.textures),s=o(e.images),a=o(e.shapes),c=o(e.skeletons),u=o(e.animations),l=o(e.nodes);t.length>0&&(n.geometries=t),r.length>0&&(n.materials=r),i.length>0&&(n.textures=i),s.length>0&&(n.images=s),a.length>0&&(n.shapes=a),c.length>0&&(n.skeletons=c),u.length>0&&(n.animations=u),l.length>0&&(n.nodes=l)}return n.object=r,n;function o(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const n=e.children[t];this.add(n.clone())}return this}}nn.DefaultUp=new et(0,1,0),nn.DefaultMatrixAutoUpdate=!0,nn.prototype.isObject3D=!0;const rn=new et,on=new et,sn=new et,an=new et,cn=new et,un=new et,ln=new et,An=new et,hn=new et,dn=new et;class pn{constructor(e=new et,t=new et,n=new et){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,r){r.subVectors(n,t),rn.subVectors(e,t),r.cross(rn);const i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}static getBarycoord(e,t,n,r,i){rn.subVectors(r,t),on.subVectors(n,t),sn.subVectors(e,t);const o=rn.dot(rn),s=rn.dot(on),a=rn.dot(sn),c=on.dot(on),u=on.dot(sn),l=o*c-s*s;if(0===l)return i.set(-2,-1,-1);const A=1/l,h=(c*a-s*u)*A,d=(o*u-s*a)*A;return i.set(1-h-d,d,h)}static containsPoint(e,t,n,r){return this.getBarycoord(e,t,n,r,an),an.x>=0&&an.y>=0&&an.x+an.y<=1}static getUV(e,t,n,r,i,o,s,a){return this.getBarycoord(e,t,n,r,an),a.set(0,0),a.addScaledVector(i,an.x),a.addScaledVector(o,an.y),a.addScaledVector(s,an.z),a}static isFrontFacing(e,t,n,r){return rn.subVectors(n,t),on.subVectors(e,t),rn.cross(on).dot(r)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return rn.subVectors(this.c,this.b),on.subVectors(this.a,this.b),.5*rn.cross(on).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return pn.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return pn.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,r,i){return pn.getUV(e,this.a,this.b,this.c,t,n,r,i)}containsPoint(e){return pn.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return pn.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,r=this.b,i=this.c;let o,s;cn.subVectors(r,n),un.subVectors(i,n),An.subVectors(e,n);const a=cn.dot(An),c=un.dot(An);if(a<=0&&c<=0)return t.copy(n);hn.subVectors(e,r);const u=cn.dot(hn),l=un.dot(hn);if(u>=0&&l<=u)return t.copy(r);const A=a*l-u*c;if(A<=0&&a>=0&&u<=0)return o=a/(a-u),t.copy(n).addScaledVector(cn,o);dn.subVectors(e,i);const h=cn.dot(dn),d=un.dot(dn);if(d>=0&&h<=d)return t.copy(i);const p=h*c-a*d;if(p<=0&&c>=0&&d<=0)return s=c/(c-d),t.copy(n).addScaledVector(un,s);const f=u*d-h*l;if(f<=0&&l-u>=0&&h-d>=0)return ln.subVectors(i,r),s=(l-u)/(l-u+(h-d)),t.copy(r).addScaledVector(ln,s);const g=1/(f+p+A);return o=p*g,s=A*g,t.copy(n).addScaledVector(cn,o).addScaledVector(un,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let fn=0;class gn extends pe{constructor(){super(),Object.defineProperty(this,"id",{value:fn++}),this.uuid=ye(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=n,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ue,this.stencilZFail=ue,this.stencilZPass=ue,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const n=e[t];if(void 0===n){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){const t=[];for(const n in e){const r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),0!==this.side&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){const t=r(e.textures),i=r(e.images);t.length>0&&(n.textures=t),i.length>0&&(n.images=i)}return n}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(null!==t){const e=t.length;n=new Array(e);for(let r=0;r!==e;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}gn.prototype.isMaterial=!0,gn.fromType=function(){return null};class mn extends gn{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Fe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}mn.prototype.isMeshBasicMaterial=!0;const vn=new et,yn=new Re;class _n{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=le,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new Fe),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this}copyVector2sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new Re),t[n++]=i.x,t[n++]=i.y}return this}copyVector3sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new et),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this}copyVector4sArray(e){const t=this.array;let n=0;for(let r=0,i=e.length;r<i;r++){let i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new We),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,n=this.count;t<n;t++)yn.fromBufferAttribute(this,t),yn.applyMatrix3(e),this.setXY(t,yn.x,yn.y);else if(3===this.itemSize)for(let t=0,n=this.count;t<n;t++)vn.fromBufferAttribute(this,t),vn.applyMatrix3(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)vn.x=this.getX(t),vn.y=this.getY(t),vn.z=this.getZ(t),vn.applyMatrix4(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)vn.x=this.getX(t),vn.y=this.getY(t),vn.z=this.getZ(t),vn.applyNormalMatrix(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)vn.x=this.getX(t),vn.y=this.getY(t),vn.z=this.getZ(t),vn.transformDirection(e),this.setXYZ(t,vn.x,vn.y,vn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==le&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}_n.prototype.isBufferAttribute=!0;class En extends _n{constructor(e,t,n){super(new Int8Array(e),t,n)}}class bn extends _n{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class wn extends _n{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class Sn extends _n{constructor(e,t,n){super(new Int16Array(e),t,n)}}class Tn extends _n{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Cn extends _n{constructor(e,t,n){super(new Int32Array(e),t,n)}}class Rn extends _n{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class In extends _n{constructor(e,t,n){super(new Uint16Array(e),t,n)}}In.prototype.isFloat16BufferAttribute=!0;class On extends _n{constructor(e,t,n){super(new Float32Array(e),t,n)}}class xn extends _n{constructor(e,t,n){super(new Float64Array(e),t,n)}}let Nn=0;const Bn=new Nt,Ln=new nn,Dn=new et,Mn=new rt,Pn=new rt,kn=new et;class Un extends pe{constructor(){super(),Object.defineProperty(this,"id",{value:Nn++}),this.uuid=ye(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(Oe(e)?Rn:Tn)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const t=(new Ie).getNormalMatrix(e);n.applyNormalMatrix(t),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Bn.makeRotationFromQuaternion(e),this.applyMatrix4(Bn),this}rotateX(e){return Bn.makeRotationX(e),this.applyMatrix4(Bn),this}rotateY(e){return Bn.makeRotationY(e),this.applyMatrix4(Bn),this}rotateZ(e){return Bn.makeRotationZ(e),this.applyMatrix4(Bn),this}translate(e,t,n){return Bn.makeTranslation(e,t,n),this.applyMatrix4(Bn),this}scale(e,t,n){return Bn.makeScale(e,t,n),this.applyMatrix4(Bn),this}lookAt(e){return Ln.lookAt(e),Ln.updateMatrix(),this.applyMatrix4(Ln.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Dn).negate(),this.translate(Dn.x,Dn.y,Dn.z),this}setFromPoints(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t.push(r.x,r.y,r.z||0)}return this.setAttribute("position",new On(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new rt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new et(-1/0,-1/0,-1/0),new et(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Mn.setFromBufferAttribute(n),this.morphTargetsRelative?(kn.addVectors(this.boundingBox.min,Mn.min),this.boundingBox.expandByPoint(kn),kn.addVectors(this.boundingBox.max,Mn.max),this.boundingBox.expandByPoint(kn)):(this.boundingBox.expandByPoint(Mn.min),this.boundingBox.expandByPoint(Mn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new bt);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new et,1/0);if(e){const n=this.boundingSphere.center;if(Mn.setFromBufferAttribute(e),t)for(let e=0,n=t.length;e<n;e++){const n=t[e];Pn.setFromBufferAttribute(n),this.morphTargetsRelative?(kn.addVectors(Mn.min,Pn.min),Mn.expandByPoint(kn),kn.addVectors(Mn.max,Pn.max),Mn.expandByPoint(kn)):(Mn.expandByPoint(Pn.min),Mn.expandByPoint(Pn.max))}Mn.getCenter(n);let r=0;for(let t=0,i=e.count;t<i;t++)kn.fromBufferAttribute(e,t),r=Math.max(r,n.distanceToSquared(kn));if(t)for(let i=0,o=t.length;i<o;i++){const o=t[i],s=this.morphTargetsRelative;for(let t=0,i=o.count;t<i;t++)kn.fromBufferAttribute(o,t),s&&(Dn.fromBufferAttribute(e,t),kn.add(Dn)),r=Math.max(r,n.distanceToSquared(kn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const n=e.array,r=t.position.array,i=t.normal.array,o=t.uv.array,s=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new _n(new Float32Array(4*s),4));const a=this.getAttribute("tangent").array,c=[],u=[];for(let e=0;e<s;e++)c[e]=new et,u[e]=new et;const l=new et,A=new et,h=new et,d=new Re,p=new Re,f=new Re,g=new et,m=new et;function v(e,t,n){l.fromArray(r,3*e),A.fromArray(r,3*t),h.fromArray(r,3*n),d.fromArray(o,2*e),p.fromArray(o,2*t),f.fromArray(o,2*n),A.sub(l),h.sub(l),p.sub(d),f.sub(d);const i=1/(p.x*f.y-f.x*p.y);isFinite(i)&&(g.copy(A).multiplyScalar(f.y).addScaledVector(h,-p.y).multiplyScalar(i),m.copy(h).multiplyScalar(p.x).addScaledVector(A,-f.x).multiplyScalar(i),c[e].add(g),c[t].add(g),c[n].add(g),u[e].add(m),u[t].add(m),u[n].add(m))}let y=this.groups;0===y.length&&(y=[{start:0,count:n.length}]);for(let e=0,t=y.length;e<t;++e){const t=y[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)v(n[e+0],n[e+1],n[e+2])}const _=new et,E=new et,b=new et,w=new et;function S(e){b.fromArray(i,3*e),w.copy(b);const t=c[e];_.copy(t),_.sub(b.multiplyScalar(b.dot(t))).normalize(),E.crossVectors(w,t);const n=E.dot(u[e])<0?-1:1;a[4*e]=_.x,a[4*e+1]=_.y,a[4*e+2]=_.z,a[4*e+3]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],r=t.start;for(let e=r,i=r+t.count;e<i;e+=3)S(n[e+0]),S(n[e+1]),S(n[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let n=this.getAttribute("normal");if(void 0===n)n=new _n(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(let e=0,t=n.count;e<t;e++)n.setXYZ(e,0,0,0);const r=new et,i=new et,o=new et,s=new et,a=new et,c=new et,u=new et,l=new et;if(e)for(let A=0,h=e.count;A<h;A+=3){const h=e.getX(A+0),d=e.getX(A+1),p=e.getX(A+2);r.fromBufferAttribute(t,h),i.fromBufferAttribute(t,d),o.fromBufferAttribute(t,p),u.subVectors(o,i),l.subVectors(r,i),u.cross(l),s.fromBufferAttribute(n,h),a.fromBufferAttribute(n,d),c.fromBufferAttribute(n,p),s.add(u),a.add(u),c.add(u),n.setXYZ(h,s.x,s.y,s.z),n.setXYZ(d,a.x,a.y,a.z),n.setXYZ(p,c.x,c.y,c.z)}else for(let e=0,s=t.count;e<s;e+=3)r.fromBufferAttribute(t,e+0),i.fromBufferAttribute(t,e+1),o.fromBufferAttribute(t,e+2),u.subVectors(o,i),l.subVectors(r,i),u.cross(l),n.setXYZ(e+0,u.x,u.y,u.z),n.setXYZ(e+1,u.x,u.y,u.z),n.setXYZ(e+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===e.attributes[r])continue;const i=n[r].array,o=e.attributes[r],s=o.array,a=o.itemSize*t,c=Math.min(s.length,i.length-a);for(let e=0,t=a;e<c;e++,t++)i[t]=s[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)kn.fromBufferAttribute(e,t),kn.normalize(),e.setXYZ(t,kn.x,kn.y,kn.z)}toNonIndexed(){function e(e,t){const n=e.array,r=e.itemSize,i=e.normalized,o=new n.constructor(t.length*r);let s=0,a=0;for(let i=0,c=t.length;i<c;i++){s=e.isInterleavedBufferAttribute?t[i]*e.data.stride+e.offset:t[i]*r;for(let e=0;e<r;e++)o[a++]=n[s++]}return new _n(o,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Un,n=this.index.array,r=this.attributes;for(const i in r){const o=e(r[i],n);t.setAttribute(i,o)}const i=this.morphAttributes;for(const r in i){const o=[],s=i[r];for(let t=0,r=s.length;t<r;t++){const r=e(s[t],n);o.push(r)}t.morphAttributes[r]=o}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let e=0,n=o.length;e<n;e++){const n=o[e];t.addGroup(n.start,n.count,n.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const t in n){const r=n[t];e.data.attributes[t]=r.toJSON(e.data)}const r={};let i=!1;for(const t in this.morphAttributes){const n=this.morphAttributes[t],o=[];for(let t=0,r=n.length;t<r;t++){const r=n[t];o.push(r.toJSON(e.data))}o.length>0&&(r[t]=o,i=!0)}i&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const s=this.boundingSphere;return null!==s&&(e.data.boundingSphere={center:s.center.toArray(),radius:s.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;null!==n&&this.setIndex(n.clone(t));const r=e.attributes;for(const e in r){const n=r[e];this.setAttribute(e,n.clone(t))}const i=e.morphAttributes;for(const e in i){const n=[],r=i[e];for(let e=0,i=r.length;e<i;e++)n.push(r[e].clone(t));this.morphAttributes[e]=n}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let e=0,t=o.length;e<t;e++){const t=o[e];this.addGroup(t.start,t.count,t.materialIndex)}const s=e.boundingBox;null!==s&&(this.boundingBox=s.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}Un.prototype.isBufferGeometry=!0;const Fn=new Nt,Hn=new xt,Vn=new bt,Qn=new et,jn=new et,Gn=new et,Kn=new et,Wn=new et,zn=new et,qn=new et,Yn=new et,Xn=new et,Jn=new Re,Zn=new Re,$n=new Re,er=new et,tr=new et;class nr extends nn{constructor(e=new Un,t=new mn){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const n=this.geometry,r=this.material,i=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),Vn.copy(n.boundingSphere),Vn.applyMatrix4(i),!1===e.ray.intersectsSphere(Vn))return;if(Fn.copy(i).invert(),Hn.copy(e.ray).applyMatrix4(Fn),null!==n.boundingBox&&!1===Hn.intersectsBox(n.boundingBox))return;let o;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position,a=n.morphAttributes.position,c=n.morphTargetsRelative,u=n.attributes.uv,l=n.attributes.uv2,A=n.groups,h=n.drawRange;if(null!==i)if(Array.isArray(r))for(let n=0,d=A.length;n<d;n++){const d=A[n],p=r[d.materialIndex];for(let n=Math.max(d.start,h.start),r=Math.min(i.count,Math.min(d.start+d.count,h.start+h.count));n<r;n+=3){const r=i.getX(n),A=i.getX(n+1),h=i.getX(n+2);o=rr(this,p,e,Hn,s,a,c,u,l,r,A,h),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=d.materialIndex,t.push(o))}}else{for(let n=Math.max(0,h.start),A=Math.min(i.count,h.start+h.count);n<A;n+=3){const A=i.getX(n),h=i.getX(n+1),d=i.getX(n+2);o=rr(this,r,e,Hn,s,a,c,u,l,A,h,d),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}else if(void 0!==s)if(Array.isArray(r))for(let n=0,i=A.length;n<i;n++){const i=A[n],d=r[i.materialIndex];for(let n=Math.max(i.start,h.start),r=Math.min(s.count,Math.min(i.start+i.count,h.start+h.count));n<r;n+=3){o=rr(this,d,e,Hn,s,a,c,u,l,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),o.face.materialIndex=i.materialIndex,t.push(o))}}else{for(let n=Math.max(0,h.start),i=Math.min(s.count,h.start+h.count);n<i;n+=3){o=rr(this,r,e,Hn,s,a,c,u,l,n,n+1,n+2),o&&(o.faceIndex=Math.floor(n/3),t.push(o))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function rr(e,t,n,r,i,o,s,a,c,u,l,A){Qn.fromBufferAttribute(i,u),jn.fromBufferAttribute(i,l),Gn.fromBufferAttribute(i,A);const h=e.morphTargetInfluences;if(o&&h){qn.set(0,0,0),Yn.set(0,0,0),Xn.set(0,0,0);for(let e=0,t=o.length;e<t;e++){const t=h[e],n=o[e];0!==t&&(Kn.fromBufferAttribute(n,u),Wn.fromBufferAttribute(n,l),zn.fromBufferAttribute(n,A),s?(qn.addScaledVector(Kn,t),Yn.addScaledVector(Wn,t),Xn.addScaledVector(zn,t)):(qn.addScaledVector(Kn.sub(Qn),t),Yn.addScaledVector(Wn.sub(jn),t),Xn.addScaledVector(zn.sub(Gn),t)))}Qn.add(qn),jn.add(Yn),Gn.add(Xn)}e.isSkinnedMesh&&(e.boneTransform(u,Qn),e.boneTransform(l,jn),e.boneTransform(A,Gn));const d=function(e,t,n,r,i,o,s,a){let c;if(c=1===t.side?r.intersectTriangle(s,o,i,!0,a):r.intersectTriangle(i,o,s,2!==t.side,a),null===c)return null;tr.copy(a),tr.applyMatrix4(e.matrixWorld);const u=n.ray.origin.distanceTo(tr);return u<n.near||u>n.far?null:{distance:u,point:tr.clone(),object:e}}(e,t,n,r,Qn,jn,Gn,er);if(d){a&&(Jn.fromBufferAttribute(a,u),Zn.fromBufferAttribute(a,l),$n.fromBufferAttribute(a,A),d.uv=pn.getUV(er,Qn,jn,Gn,Jn,Zn,$n,new Re)),c&&(Jn.fromBufferAttribute(c,u),Zn.fromBufferAttribute(c,l),$n.fromBufferAttribute(c,A),d.uv2=pn.getUV(er,Qn,jn,Gn,Jn,Zn,$n,new Re));const e={a:u,b:l,c:A,normal:new et,materialIndex:0};pn.getNormal(Qn,jn,Gn,e.normal),d.face=e}return d}nr.prototype.isMesh=!0;class ir extends Un{constructor(e=1,t=1,n=1,r=1,i=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:r,heightSegments:i,depthSegments:o};const s=this;r=Math.floor(r),i=Math.floor(i),o=Math.floor(o);const a=[],c=[],u=[],l=[];let A=0,h=0;function d(e,t,n,r,i,o,d,p,f,g,m){const v=o/f,y=d/g,_=o/2,E=d/2,b=p/2,w=f+1,S=g+1;let T=0,C=0;const R=new et;for(let o=0;o<S;o++){const s=o*y-E;for(let a=0;a<w;a++){const A=a*v-_;R[e]=A*r,R[t]=s*i,R[n]=b,c.push(R.x,R.y,R.z),R[e]=0,R[t]=0,R[n]=p>0?1:-1,u.push(R.x,R.y,R.z),l.push(a/f),l.push(1-o/g),T+=1}}for(let e=0;e<g;e++)for(let t=0;t<f;t++){const n=A+t+w*e,r=A+t+w*(e+1),i=A+(t+1)+w*(e+1),o=A+(t+1)+w*e;a.push(n,r,o),a.push(r,i,o),C+=6}s.addGroup(h,C,m),h+=C,A+=T}d("z","y","x",-1,-1,n,t,e,o,i,0),d("z","y","x",1,-1,n,t,-e,o,i,1),d("x","z","y",1,1,e,n,t,r,o,2),d("x","z","y",1,-1,e,n,-t,r,o,3),d("x","y","z",1,-1,e,t,n,r,i,4),d("x","y","z",-1,-1,e,t,-n,r,i,5),this.setIndex(a),this.setAttribute("position",new On(c,3)),this.setAttribute("normal",new On(u,3)),this.setAttribute("uv",new On(l,2))}static fromJSON(e){return new ir(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function or(e){const t={};for(const n in e){t[n]={};for(const r in e[n]){const i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}}return t}function sr(e){const t={};for(let n=0;n<e.length;n++){const r=or(e[n]);for(const e in r)t[e]=r[e]}return t}const ar={clone:or,merge:sr};class cr extends gn{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=or(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const n in this.uniforms){const r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const n={};for(const e in this.extensions)!0===this.extensions[e]&&(n[e]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}cr.prototype.isShaderMaterial=!0;class ur extends nn{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Nt,this.projectionMatrix=new Nt,this.projectionMatrixInverse=new Nt}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}ur.prototype.isCamera=!0;class lr extends ur{constructor(e=50,t=1,n=.1,r=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*ve*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*me*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*ve*Math.atan(Math.tan(.5*me*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,r,i,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*me*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const e=o.fullWidth,s=o.fullHeight;i+=o.offsetX*r/e,t-=o.offsetY*n/s,r*=o.width/e,n*=o.height/s}const s=this.filmOffset;0!==s&&(i+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}lr.prototype.isPerspectiveCamera=!0;const Ar=90;class hr extends nn{constructor(e,t,n){if(super(),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new lr(Ar,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new et(1,0,0)),this.add(r);const i=new lr(Ar,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new et(-1,0,0)),this.add(i);const o=new lr(Ar,1,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new et(0,1,0)),this.add(o);const s=new lr(Ar,1,e,t);s.layers=this.layers,s.up.set(0,0,-1),s.lookAt(new et(0,-1,0)),this.add(s);const a=new lr(Ar,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new et(0,0,1)),this.add(a);const c=new lr(Ar,1,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new et(0,0,-1)),this.add(c)}update(e,t){null===this.parent&&this.updateMatrixWorld();const n=this.renderTarget,[r,i,o,s,a,c]=this.children,u=e.xr.enabled,l=e.getRenderTarget();e.xr.enabled=!1;const A=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,a),n.texture.generateMipmaps=A,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(l),e.xr.enabled=u,n.texture.needsPMREMUpdate=!0}}class dr extends Ke{constructor(e,t,n,r,o,s,a,c,u,l){super(e=void 0!==e?e:[],t=void 0!==t?t:i,n,r,o,s,a,c,u,l),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}dr.prototype.isCubeTexture=!0;class pr extends ze{constructor(e,t={}){super(e,e,t);const n={width:e,height:e,depth:1},r=[n,n,n,n,n,n];this.texture=new dr(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:g}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=T,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},r=new ir(5,5,5),i=new cr({name:"CubemapFromEquirect",uniforms:or(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:1,blending:0});i.uniforms.tEquirect.value=t;const o=new nr(r,i),s=t.minFilter;t.minFilter===v&&(t.minFilter=g);return new hr(1,10,this).update(e,o),t.minFilter=s,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,r){const i=e.getRenderTarget();for(let i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(i)}}pr.prototype.isWebGLCubeRenderTarget=!0;const fr=new et,gr=new et,mr=new Ie;class vr{constructor(e=new et(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const r=fr.subVectors(n,t).cross(gr.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const n=e.delta(fr),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?null:t.copy(n).multiplyScalar(i).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||mr.getNormalMatrix(e),r=this.coplanarPoint(fr).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}vr.prototype.isPlane=!0;const yr=new bt,_r=new et;class Er{constructor(e=new vr,t=new vr,n=new vr,r=new vr,i=new vr,o=new vr){this.planes=[e,t,n,r,i,o]}set(e,t,n,r,i,o){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(r),s[4].copy(i),s[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){const t=this.planes,n=e.elements,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],c=n[5],u=n[6],l=n[7],A=n[8],h=n[9],d=n[10],p=n[11],f=n[12],g=n[13],m=n[14],v=n[15];return t[0].setComponents(s-r,l-a,p-A,v-f).normalize(),t[1].setComponents(s+r,l+a,p+A,v+f).normalize(),t[2].setComponents(s+i,l+c,p+h,v+g).normalize(),t[3].setComponents(s-i,l-c,p-h,v-g).normalize(),t[4].setComponents(s-o,l-u,p-d,v-m).normalize(),t[5].setComponents(s+o,l+u,p+d,v+m).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),yr.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(yr)}intersectsSprite(e){return yr.center.set(0,0,0),yr.radius=.7071067811865476,yr.applyMatrix4(e.matrixWorld),this.intersectsSphere(yr)}intersectsSphere(e){const t=this.planes,n=e.center,r=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(n)<r)return!1}return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const r=t[n];if(_r.x=r.normal.x>0?e.max.x:e.min.x,_r.y=r.normal.y>0?e.max.y:e.min.y,_r.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(_r)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function br(){let e=null,t=!1,n=null,r=null;function i(t,o){n(t,o),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function wr(e,t){const n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){const e=r.get(t);return void((!e||e.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const o=r.get(t);void 0===o?r.set(t,function(t,r){const i=t.array,o=t.usage,s=e.createBuffer();let a;if(e.bindBuffer(r,s),e.bufferData(r,i,o),t.onUploadCallback(),i instanceof Float32Array)a=5126;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(i instanceof Int16Array)a=5122;else if(i instanceof Uint32Array)a=5125;else if(i instanceof Int32Array)a=5124;else if(i instanceof Int8Array)a=5120;else if(i instanceof Uint8Array)a=5121;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);a=5121}return{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(!function(t,r,i){const o=r.array,s=r.updateRange;e.bindBuffer(i,t),-1===s.count?e.bufferSubData(i,0,o):(n?e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o,s.offset,s.count):e.bufferSubData(i,s.offset*o.BYTES_PER_ELEMENT,o.subarray(s.offset,s.offset+s.count)),s.count=-1)}(o.buffer,t,i),o.version=t.version)}}}class Sr extends Un{constructor(e=1,t=1,n=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:r};const i=e/2,o=t/2,s=Math.floor(n),a=Math.floor(r),c=s+1,u=a+1,l=e/s,A=t/a,h=[],d=[],p=[],f=[];for(let e=0;e<u;e++){const t=e*A-o;for(let n=0;n<c;n++){const r=n*l-i;d.push(r,-t,0),p.push(0,0,1),f.push(n/s),f.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<s;t++){const n=t+c*e,r=t+c*(e+1),i=t+1+c*(e+1),o=t+1+c*e;h.push(n,r,o),h.push(r,i,o)}this.setIndex(h),this.setAttribute("position",new On(d,3)),this.setAttribute("normal",new On(p,3)),this.setAttribute("uv",new On(f,2))}static fromJSON(e){return new Sr(e.width,e.height,e.widthSegments,e.heightSegments)}}const Tr={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ]\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tfloat texelIndex = float( vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},Cr={common:{diffuse:{value:new Fe(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ie},uv2Transform:{value:new Ie},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Re(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Fe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Fe(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ie}},sprite:{diffuse:{value:new Fe(16777215)},opacity:{value:1},center:{value:new Re(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Ie}}},Rr={basic:{uniforms:sr([Cr.common,Cr.specularmap,Cr.envmap,Cr.aomap,Cr.lightmap,Cr.fog]),vertexShader:Tr.meshbasic_vert,fragmentShader:Tr.meshbasic_frag},lambert:{uniforms:sr([Cr.common,Cr.specularmap,Cr.envmap,Cr.aomap,Cr.lightmap,Cr.emissivemap,Cr.fog,Cr.lights,{emissive:{value:new Fe(0)}}]),vertexShader:Tr.meshlambert_vert,fragmentShader:Tr.meshlambert_frag},phong:{uniforms:sr([Cr.common,Cr.specularmap,Cr.envmap,Cr.aomap,Cr.lightmap,Cr.emissivemap,Cr.bumpmap,Cr.normalmap,Cr.displacementmap,Cr.fog,Cr.lights,{emissive:{value:new Fe(0)},specular:{value:new Fe(1118481)},shininess:{value:30}}]),vertexShader:Tr.meshphong_vert,fragmentShader:Tr.meshphong_frag},standard:{uniforms:sr([Cr.common,Cr.envmap,Cr.aomap,Cr.lightmap,Cr.emissivemap,Cr.bumpmap,Cr.normalmap,Cr.displacementmap,Cr.roughnessmap,Cr.metalnessmap,Cr.fog,Cr.lights,{emissive:{value:new Fe(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Tr.meshphysical_vert,fragmentShader:Tr.meshphysical_frag},toon:{uniforms:sr([Cr.common,Cr.aomap,Cr.lightmap,Cr.emissivemap,Cr.bumpmap,Cr.normalmap,Cr.displacementmap,Cr.gradientmap,Cr.fog,Cr.lights,{emissive:{value:new Fe(0)}}]),vertexShader:Tr.meshtoon_vert,fragmentShader:Tr.meshtoon_frag},matcap:{uniforms:sr([Cr.common,Cr.bumpmap,Cr.normalmap,Cr.displacementmap,Cr.fog,{matcap:{value:null}}]),vertexShader:Tr.meshmatcap_vert,fragmentShader:Tr.meshmatcap_frag},points:{uniforms:sr([Cr.points,Cr.fog]),vertexShader:Tr.points_vert,fragmentShader:Tr.points_frag},dashed:{uniforms:sr([Cr.common,Cr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Tr.linedashed_vert,fragmentShader:Tr.linedashed_frag},depth:{uniforms:sr([Cr.common,Cr.displacementmap]),vertexShader:Tr.depth_vert,fragmentShader:Tr.depth_frag},normal:{uniforms:sr([Cr.common,Cr.bumpmap,Cr.normalmap,Cr.displacementmap,{opacity:{value:1}}]),vertexShader:Tr.meshnormal_vert,fragmentShader:Tr.meshnormal_frag},sprite:{uniforms:sr([Cr.sprite,Cr.fog]),vertexShader:Tr.sprite_vert,fragmentShader:Tr.sprite_frag},background:{uniforms:{uvTransform:{value:new Ie},t2D:{value:null}},vertexShader:Tr.background_vert,fragmentShader:Tr.background_frag},cube:{uniforms:sr([Cr.envmap,{opacity:{value:1}}]),vertexShader:Tr.cube_vert,fragmentShader:Tr.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Tr.equirect_vert,fragmentShader:Tr.equirect_frag},distanceRGBA:{uniforms:sr([Cr.common,Cr.displacementmap,{referencePosition:{value:new et},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Tr.distanceRGBA_vert,fragmentShader:Tr.distanceRGBA_frag},shadow:{uniforms:sr([Cr.lights,Cr.fog,{color:{value:new Fe(0)},opacity:{value:1}}]),vertexShader:Tr.shadow_vert,fragmentShader:Tr.shadow_frag}};function Ir(e,t,n,r,i,o){const s=new Fe(0);let a,u,l=!0===i?0:1,A=null,h=0,d=null;function p(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,o)}return{getClearColor:function(){return s},setClearColor:function(e,t=1){s.set(e),l=t,p(s,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,p(s,l)},render:function(n,i){let o=!1,f=!0===i.isScene?i.background:null;f&&f.isTexture&&(f=t.get(f));const g=e.xr,m=g.getSession&&g.getSession();m&&"additive"===m.environmentBlendMode&&(f=null),null===f?p(s,l):f&&f.isColor&&(p(f,1),o=!0),(e.autoClear||o)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),f&&(f.isCubeTexture||f.mapping===c)?(void 0===u&&(u=new nr(new ir(1,1,1),new cr({name:"BackgroundCubeMaterial",uniforms:or(Rr.cube.uniforms),vertexShader:Rr.cube.vertexShader,fragmentShader:Rr.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=f,u.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,A===f&&h===f.version&&d===e.toneMapping||(u.material.needsUpdate=!0,A=f,h=f.version,d=e.toneMapping),n.unshift(u,u.geometry,u.material,0,0,null)):f&&f.isTexture&&(void 0===a&&(a=new nr(new Sr(2,2),new cr({name:"BackgroundMaterial",uniforms:or(Rr.background.uniforms),vertexShader:Rr.background.vertexShader,fragmentShader:Rr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(a)),a.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),a.material.uniforms.uvTransform.value.copy(f.matrix),A===f&&h===f.version&&d===e.toneMapping||(a.material.needsUpdate=!0,A=f,h=f.version,d=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function Or(e,t,n,r){const i=e.getParameter(34921),o=r.isWebGL2?null:t.get("OES_vertex_array_object"),s=r.isWebGL2||null!==o,a={},c=h(null);let u=c;function l(t){return r.isWebGL2?e.bindVertexArray(t):o.bindVertexArrayOES(t)}function A(t){return r.isWebGL2?e.deleteVertexArray(t):o.deleteVertexArrayOES(t)}function h(e){const t=[],n=[],r=[];for(let e=0;e<i;e++)t[e]=0,n[e]=0,r[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function d(){const e=u.newAttributes;for(let t=0,n=e.length;t<n;t++)e[t]=0}function p(e){f(e,0)}function f(n,i){const o=u.newAttributes,s=u.enabledAttributes,a=u.attributeDivisors;if(o[n]=1,0===s[n]&&(e.enableVertexAttribArray(n),s[n]=1),a[n]!==i){(r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),a[n]=i}}function g(){const t=u.newAttributes,n=u.enabledAttributes;for(let r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function m(t,n,i,o,s,a){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,o,s,a):e.vertexAttribIPointer(t,n,i,s,a)}function v(){y(),u!==c&&(u=c,l(u.object))}function y(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(i,c,A,v,y){let _=!1;if(s){const t=function(t,n,i){const s=!0===i.wireframe;let c=a[t.id];void 0===c&&(c={},a[t.id]=c);let u=c[n.id];void 0===u&&(u={},c[n.id]=u);let l=u[s];void 0===l&&(l=h(r.isWebGL2?e.createVertexArray():o.createVertexArrayOES()),u[s]=l);return l}(v,A,c);u!==t&&(u=t,l(u.object)),_=function(e,t){const n=u.attributes,r=e.attributes;let i=0;for(const e in r){const t=n[e],o=r[e];if(void 0===t)return!0;if(t.attribute!==o)return!0;if(t.data!==o.data)return!0;i++}return u.attributesNum!==i||u.index!==t}(v,y),_&&function(e,t){const n={},r=e.attributes;let i=0;for(const e in r){const t=r[e],o={};o.attribute=t,t.data&&(o.data=t.data),n[e]=o,i++}u.attributes=n,u.attributesNum=i,u.index=t}(v,y)}else{const e=!0===c.wireframe;u.geometry===v.id&&u.program===A.id&&u.wireframe===e||(u.geometry=v.id,u.program=A.id,u.wireframe=e,_=!0)}!0===i.isInstancedMesh&&(_=!0),null!==y&&n.update(y,34963),_&&(!function(i,o,s,a){if(!1===r.isWebGL2&&(i.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;d();const c=a.attributes,u=s.getAttributes(),l=o.defaultAttributeValues;for(const t in u){const r=u[t];if(r.location>=0){let o=c[t];if(void 0===o&&("instanceMatrix"===t&&i.instanceMatrix&&(o=i.instanceMatrix),"instanceColor"===t&&i.instanceColor&&(o=i.instanceColor)),void 0!==o){const t=o.normalized,s=o.itemSize,c=n.get(o);if(void 0===c)continue;const u=c.buffer,l=c.type,A=c.bytesPerElement;if(o.isInterleavedBufferAttribute){const n=o.data,c=n.stride,h=o.offset;if(n.isInstancedInterleavedBuffer){for(let e=0;e<r.locationSize;e++)f(r.location+e,n.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=n.meshPerAttribute*n.count)}else for(let e=0;e<r.locationSize;e++)p(r.location+e);e.bindBuffer(34962,u);for(let e=0;e<r.locationSize;e++)m(r.location+e,s/r.locationSize,l,t,c*A,(h+s/r.locationSize*e)*A)}else{if(o.isInstancedBufferAttribute){for(let e=0;e<r.locationSize;e++)f(r.location+e,o.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=o.meshPerAttribute*o.count)}else for(let e=0;e<r.locationSize;e++)p(r.location+e);e.bindBuffer(34962,u);for(let e=0;e<r.locationSize;e++)m(r.location+e,s/r.locationSize,l,t,s*A,s/r.locationSize*e*A)}}else if(void 0!==l){const n=l[t];if(void 0!==n)switch(n.length){case 2:e.vertexAttrib2fv(r.location,n);break;case 3:e.vertexAttrib3fv(r.location,n);break;case 4:e.vertexAttrib4fv(r.location,n);break;default:e.vertexAttrib1fv(r.location,n)}}}}g()}(i,c,A,v),null!==y&&e.bindBuffer(34963,n.get(y).buffer))},reset:v,resetDefaultState:y,dispose:function(){v();for(const e in a){const t=a[e];for(const e in t){const n=t[e];for(const e in n)A(n[e].object),delete n[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const n=t[e];for(const e in n)A(n[e].object),delete n[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const n=a[t];if(void 0===n[e.id])continue;const r=n[e.id];for(const e in r)A(r[e].object),delete r[e];delete n[e.id]}},initAttributes:d,enableAttribute:p,disableUnusedAttributes:g}}function xr(e,t,n,r){const i=r.isWebGL2;let o;this.setMode=function(e){o=e},this.render=function(t,r){e.drawArrays(o,t,r),n.update(r,o,1)},this.renderInstances=function(r,s,a){if(0===a)return;let c,u;if(i)c=e,u="drawArraysInstanced";else if(c=t.get("ANGLE_instanced_arrays"),u="drawArraysInstancedANGLE",null===c)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[u](o,r,s,a),n.update(s,o,a)}}function Nr(e,t,n){let r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let s=void 0!==n.precision?n.precision:"highp";const a=i(s);a!==s&&(console.warn("THREE.WebGLRenderer:",s,"not supported, using",a,"instead."),s=a);const c=o||t.has("WEBGL_draw_buffers"),u=!0===n.logarithmicDepthBuffer,l=e.getParameter(34930),A=e.getParameter(35660),h=e.getParameter(3379),d=e.getParameter(34076),p=e.getParameter(34921),f=e.getParameter(36347),g=e.getParameter(36348),m=e.getParameter(36349),v=A>0,y=o||t.has("OES_texture_float");return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){const n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:i,precision:s,logarithmicDepthBuffer:u,maxTextures:l,maxVertexTextures:A,maxTextureSize:h,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:m,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:v&&y,maxSamples:o?e.getParameter(36183):0}}function Br(e){const t=this;let n=null,r=0,i=!1,o=!1;const s=new vr,a=new Ie,c={value:null,needsUpdate:!1};function u(){c.value!==n&&(c.value=n,c.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function l(e,n,r,i){const o=null!==e?e.length:0;let u=null;if(0!==o){if(u=c.value,!0!==i||null===u){const t=r+4*o,i=n.matrixWorldInverse;a.getNormalMatrix(i),(null===u||u.length<t)&&(u=new Float32Array(t));for(let t=0,n=r;t!==o;++t,n+=4)s.copy(e[t]).applyMatrix4(i,a),s.normal.toArray(u,n),u[n+3]=s.constant}c.value=u,c.needsUpdate=!0}return t.numPlanes=o,t.numIntersection=0,u}this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,o){const s=0!==e.length||t||0!==r||i;return i=t,n=l(e,o,0),r=e.length,s},this.beginShadows=function(){o=!0,l(null)},this.endShadows=function(){o=!1,u()},this.setState=function(t,s,a){const A=t.clippingPlanes,h=t.clipIntersection,d=t.clipShadows,p=e.get(t);if(!i||null===A||0===A.length||o&&!d)o?l(null):u();else{const e=o?0:r,t=4*e;let i=p.clippingState||null;c.value=i,i=l(A,s,t,a);for(let e=0;e!==t;++e)i[e]=n[e];p.clippingState=i,this.numIntersection=h?this.numPlanes:0,this.numPlanes+=e}}}function Lr(e){let t=new WeakMap;function n(e,t){return t===s?e.mapping=i:t===a&&(e.mapping=o),e}function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture&&!1===i.isRenderTargetTexture){const o=i.mapping;if(o===s||o===a){if(t.has(i)){return n(t.get(i).texture,i.mapping)}{const o=i.image;if(o&&o.height>0){const s=new pr(o.height/2);return s.fromEquirectangularTexture(e,i),t.set(i,s),i.addEventListener("dispose",r),n(s.texture,i.mapping)}return null}}}return i},dispose:function(){t=new WeakMap}}}Rr.physical={uniforms:sr([Rr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Re(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Fe(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Re},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Fe(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Fe(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Tr.meshphysical_vert,fragmentShader:Tr.meshphysical_frag};class Dr extends ur{constructor(e=-1,t=1,n=1,r=-1,i=.1,o=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,n,r,i,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let i=n-e,o=n+e,s=r+t,a=r-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=e*this.view.offsetX,o=i+e*this.view.width,s-=t*this.view.offsetY,a=s-t*this.view.height}this.projectionMatrix.makeOrthographic(i,o,s,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}Dr.prototype.isOrthographicCamera=!0;const Mr=[.125,.215,.35,.446,.526,.582],Pr=20,kr=new Dr,Ur=new Fe;let Fr=null;const Hr=(1+Math.sqrt(5))/2,Vr=1/Hr,Qr=[new et(1,1,1),new et(-1,1,1),new et(1,1,-1),new et(-1,1,-1),new et(0,Hr,Vr),new et(0,Hr,-Vr),new et(Vr,0,Hr),new et(-Vr,0,Hr),new et(Hr,Vr,0),new et(-Hr,Vr,0)];class jr{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,r=100){Fr=this._renderer.getRenderTarget(),this._setSize(256);const i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,r,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=zr(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Wr(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Fr),e.scissorTest=!1,Kr(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===i||e.mapping===o?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Fr=this._renderer.getRenderTarget();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize-32,n={magFilter:g,minFilter:g,generateMipmaps:!1,type:w,format:T,encoding:ae,depthBuffer:!1},r=Gr(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Gr(e,t,n);const{_lodMax:r}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(e){const t=[],n=[],r=[];let i=e;const o=e-4+1+Mr.length;for(let s=0;s<o;s++){const o=Math.pow(2,i);n.push(o);let a=1/o;s>e-4?a=Mr[s-e+4-1]:0===s&&(a=0),r.push(a);const c=1/(o-1),u=-c/2,l=1+c/2,A=[u,u,l,u,l,l,u,u,l,l,u,l],h=6,d=6,p=3,f=2,g=1,m=new Float32Array(p*d*h),v=new Float32Array(f*d*h),y=new Float32Array(g*d*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,n=e>2?0:-1,r=[t,n,0,t+2/3,n,0,t+2/3,n+1,0,t,n,0,t+2/3,n+1,0,t,n+1,0];m.set(r,p*d*e),v.set(A,f*d*e);const i=[e,e,e,e,e,e];y.set(i,g*d*e)}const _=new Un;_.setAttribute("position",new _n(m,p)),_.setAttribute("uv",new _n(v,f)),_.setAttribute("faceIndex",new _n(y,g)),t.push(_),i>4&&i--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(r)),this._blurMaterial=function(e,t,n){const r=new Float32Array(Pr),i=new et(0,1,0);return new cr({name:"SphericalGaussianBlur",defines:{n:Pr,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${e}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:qr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(r,e,t)}return r}_compileMaterial(e){const t=new nr(this._lodPlanes[0],e);this._renderer.compile(t,kr)}_sceneToCubeUV(e,t,n,r){const i=new lr(90,1,t,n),o=[1,-1,1,1,1,1],s=[1,1,1,-1,-1,-1],a=this._renderer,c=a.autoClear,u=a.toneMapping;a.getClearColor(Ur),a.toneMapping=0,a.autoClear=!1;const l=new mn({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),A=new nr(new ir,l);let h=!1;const d=e.background;d?d.isColor&&(l.color.copy(d),e.background=null,h=!0):(l.color.copy(Ur),h=!0);for(let t=0;t<6;t++){const n=t%3;0===n?(i.up.set(0,o[t],0),i.lookAt(s[t],0,0)):1===n?(i.up.set(0,0,o[t]),i.lookAt(0,s[t],0)):(i.up.set(0,o[t],0),i.lookAt(0,0,s[t]));const c=this._cubeSize;Kr(r,n*c,t>2?c:0,c,c),a.setRenderTarget(r),h&&a.render(A,i),a.render(e,i)}A.geometry.dispose(),A.material.dispose(),a.toneMapping=u,a.autoClear=c,e.background=d}_textureToCubeUV(e,t){const n=this._renderer,r=e.mapping===i||e.mapping===o;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=zr()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Wr());const s=r?this._cubemapMaterial:this._equirectMaterial,a=new nr(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const c=this._cubeSize;Kr(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(a,kr)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let t=1;t<this._lodPlanes.length;t++){const n=Math.sqrt(this._sigmas[t]*this._sigmas[t]-this._sigmas[t-1]*this._sigmas[t-1]),r=Qr[(t-1)%Qr.length];this._blur(e,t-1,t,n,r)}t.autoClear=n}_blur(e,t,n,r,i){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,r,"latitudinal",i),this._halfBlur(o,e,n,n,r,"longitudinal",i)}_halfBlur(e,t,n,r,i,o,s){const a=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const u=new nr(this._lodPlanes[r],c),l=c.uniforms,A=this._sizeLods[n]-1,h=isFinite(i)?Math.PI/(2*A):2*Math.PI/39,d=i/h,p=isFinite(i)?1+Math.floor(3*d):Pr;p>Pr&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${p} samples when the maximum is set to 20`);const f=[];let g=0;for(let e=0;e<Pr;++e){const t=e/d,n=Math.exp(-t*t/2);f.push(n),0===e?g+=n:e<p&&(g+=2*n)}for(let e=0;e<f.length;e++)f[e]=f[e]/g;l.envMap.value=e.texture,l.samples.value=p,l.weights.value=f,l.latitudinal.value="latitudinal"===o,s&&(l.poleAxis.value=s);const{_lodMax:m}=this;l.dTheta.value=h,l.mipInt.value=m-n;const v=this._sizeLods[r];Kr(t,3*v*(r>m-4?r-m+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(t),a.render(u,kr)}}function Gr(e,t,n){const r=new ze(e,t,n);return r.texture.mapping=c,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Kr(e,t,n,r,i){e.viewport.set(t,n,r,i),e.scissor.set(t,n,r,i)}function Wr(){return new cr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:qr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function zr(){return new cr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:qr(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function qr(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Yr(e){let t=new WeakMap,n=null;function r(e){const n=e.target;n.removeEventListener("dispose",r);const i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(c){if(c&&c.isTexture){const u=c.mapping,l=u===s||u===a,A=u===i||u===o;if(l||A){if(c.isRenderTargetTexture&&!0===c.needsPMREMUpdate){c.needsPMREMUpdate=!1;let r=t.get(c);return null===n&&(n=new jr(e)),r=l?n.fromEquirectangular(c,r):n.fromCubemap(c,r),t.set(c,r),r.texture}if(t.has(c))return t.get(c).texture;{const i=c.image;if(l&&i&&i.height>0||A&&i&&function(e){let t=0;const n=6;for(let r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(i)){null===n&&(n=new jr(e));const i=l?n.fromEquirectangular(c):n.fromCubemap(c);return t.set(c,i),c.addEventListener("dispose",r),i.texture}return null}}}return c},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function Xr(e){const t={};function n(n){if(void 0!==t[n])return t[n];let r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){const t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Jr(e,t,n,r){const i={},o=new WeakMap;function s(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",s),delete i[a.id];const c=o.get(a);c&&(t.remove(c),o.delete(a)),r.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,n.memory.geometries--}function a(e){const n=[],r=e.index,i=e.attributes.position;let s=0;if(null!==r){const e=r.array;s=r.version;for(let t=0,r=e.length;t<r;t+=3){const r=e[t+0],i=e[t+1],o=e[t+2];n.push(r,i,i,o,o,r)}}else{const e=i.array;s=i.version;for(let t=0,r=e.length/3-1;t<r;t+=3){const e=t+0,r=t+1,i=t+2;n.push(e,r,r,i,i,e)}}const a=new(Oe(n)?Rn:Tn)(n,1);a.version=s;const c=o.get(e);c&&t.remove(c),o.set(e,a)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",s),i[t.id]=!0,n.memory.geometries++),t},update:function(e){const n=e.attributes;for(const e in n)t.update(n[e],34962);const r=e.morphAttributes;for(const e in r){const n=r[e];for(let e=0,r=n.length;e<r;e++)t.update(n[e],34962)}},getWireframeAttribute:function(e){const t=o.get(e);if(t){const n=e.index;null!==n&&t.version<n.version&&a(e)}else a(e);return o.get(e)}}}function Zr(e,t,n,r){const i=r.isWebGL2;let o,s,a;this.setMode=function(e){o=e},this.setIndex=function(e){s=e.type,a=e.bytesPerElement},this.render=function(t,r){e.drawElements(o,r,s,t*a),n.update(r,o,1)},this.renderInstances=function(r,c,u){if(0===u)return;let l,A;if(i)l=e,A="drawElementsInstanced";else if(l=t.get("ANGLE_instanced_arrays"),A="drawElementsInstancedANGLE",null===l)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[A](o,c,s,r*a,u),n.update(c,o,u)}}function $r(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function ei(e,t){return e[0]-t[0]}function ti(e,t){return Math.abs(t[1])-Math.abs(e[1])}function ni(e,t){let n=1;const r=t.isInterleavedBufferAttribute?t.data.array:t.array;r instanceof Int8Array?n=127:r instanceof Int16Array?n=32767:r instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),e.divideScalar(n)}function ri(e,t,n){const r={},i=new Float32Array(8),o=new WeakMap,s=new We,a=[];for(let e=0;e<8;e++)a[e]=[e,0];return{update:function(c,u,l,A){const h=c.morphTargetInfluences;if(!0===t.isWebGL2){const d=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,p=void 0!==d?d.length:0;let f=o.get(u);if(void 0===f||f.count!==p){void 0!==f&&f.texture.dispose();const v=void 0!==u.morphAttributes.position,y=void 0!==u.morphAttributes.normal,_=void 0!==u.morphAttributes.color,E=u.morphAttributes.position||[],w=u.morphAttributes.normal||[],S=u.morphAttributes.color||[];let C=0;!0===v&&(C=1),!0===y&&(C=2),!0===_&&(C=3);let R=u.attributes.position.count*C,I=1;R>t.maxTextureSize&&(I=Math.ceil(R/t.maxTextureSize),R=t.maxTextureSize);const O=new Float32Array(R*I*4*p),x=new qe(O,R,I,p);x.format=T,x.type=b,x.needsUpdate=!0;const N=4*C;for(let L=0;L<p;L++){const D=E[L],M=w[L],P=S[L],k=R*I*4*L;for(let U=0;U<D.count;U++){const F=U*N;!0===v&&(s.fromBufferAttribute(D,U),!0===D.normalized&&ni(s,D),O[k+F+0]=s.x,O[k+F+1]=s.y,O[k+F+2]=s.z,O[k+F+3]=0),!0===y&&(s.fromBufferAttribute(M,U),!0===M.normalized&&ni(s,M),O[k+F+4]=s.x,O[k+F+5]=s.y,O[k+F+6]=s.z,O[k+F+7]=0),!0===_&&(s.fromBufferAttribute(P,U),!0===P.normalized&&ni(s,M),O[k+F+8]=s.x,O[k+F+9]=s.y,O[k+F+10]=s.z,O[k+F+11]=4===P.itemSize?s.w:1)}}function B(){x.dispose(),o.delete(u),u.removeEventListener("dispose",B)}f={count:p,texture:x,size:new Re(R,I)},o.set(u,f),u.addEventListener("dispose",B)}let g=0;for(let H=0;H<h.length;H++)g+=h[H];const m=u.morphTargetsRelative?1:1-g;A.getUniforms().setValue(e,"morphTargetBaseInfluence",m),A.getUniforms().setValue(e,"morphTargetInfluences",h),A.getUniforms().setValue(e,"morphTargetsTexture",f.texture,n),A.getUniforms().setValue(e,"morphTargetsTextureSize",f.size)}else{const V=void 0===h?0:h.length;let Q=r[u.id];if(void 0===Q||Q.length!==V){Q=[];for(let z=0;z<V;z++)Q[z]=[z,0];r[u.id]=Q}for(let q=0;q<V;q++){const Y=Q[q];Y[0]=q,Y[1]=h[q]}Q.sort(ti);for(let X=0;X<8;X++)X<V&&Q[X][1]?(a[X][0]=Q[X][0],a[X][1]=Q[X][1]):(a[X][0]=Number.MAX_SAFE_INTEGER,a[X][1]=0);a.sort(ei);const j=u.morphAttributes.position,G=u.morphAttributes.normal;let K=0;for(let J=0;J<8;J++){const Z=a[J],$=Z[0],ee=Z[1];$!==Number.MAX_SAFE_INTEGER&&ee?(j&&u.getAttribute("morphTarget"+J)!==j[$]&&u.setAttribute("morphTarget"+J,j[$]),G&&u.getAttribute("morphNormal"+J)!==G[$]&&u.setAttribute("morphNormal"+J,G[$]),i[J]=ee,K+=ee):(j&&!0===u.hasAttribute("morphTarget"+J)&&u.deleteAttribute("morphTarget"+J),G&&!0===u.hasAttribute("morphNormal"+J)&&u.deleteAttribute("morphNormal"+J),i[J]=0)}const W=u.morphTargetsRelative?1:1-K;A.getUniforms().setValue(e,"morphTargetBaseInfluence",W),A.getUniforms().setValue(e,"morphTargetInfluences",i)}}}}function ii(e,t,n,r){let i=new WeakMap;function o(e){const t=e.target;t.removeEventListener("dispose",o),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){const s=r.render.frame,a=e.geometry,c=t.get(e,a);return i.get(c)!==s&&(t.update(c),i.set(c,s)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",o)&&e.addEventListener("dispose",o),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),c},dispose:function(){i=new WeakMap}}}const oi=new Ke,si=new qe,ai=new Xe,ci=new dr,ui=[],li=[],Ai=new Float32Array(16),hi=new Float32Array(9),di=new Float32Array(4);function pi(e,t,n){const r=e[0];if(r<=0||r>0)return e;const i=t*n;let o=ui[i];if(void 0===o&&(o=new Float32Array(i),ui[i]=o),0!==t){r.toArray(o,0);for(let r=1,i=0;r!==t;++r)i+=n,e[r].toArray(o,i)}return o}function fi(e,t){if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function gi(e,t){for(let n=0,r=t.length;n<r;n++)e[n]=t[n]}function mi(e,t){let n=li[t];void 0===n&&(n=new Int32Array(t),li[t]=n);for(let r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function vi(e,t){const n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function yi(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(fi(n,t))return;e.uniform2fv(this.addr,t),gi(n,t)}}function _i(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(fi(n,t))return;e.uniform3fv(this.addr,t),gi(n,t)}}function Ei(e,t){const n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(fi(n,t))return;e.uniform4fv(this.addr,t),gi(n,t)}}function bi(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(fi(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),gi(n,t)}else{if(fi(n,r))return;di.set(r),e.uniformMatrix2fv(this.addr,!1,di),gi(n,r)}}function wi(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(fi(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),gi(n,t)}else{if(fi(n,r))return;hi.set(r),e.uniformMatrix3fv(this.addr,!1,hi),gi(n,r)}}function Si(e,t){const n=this.cache,r=t.elements;if(void 0===r){if(fi(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),gi(n,t)}else{if(fi(n,r))return;Ai.set(r),e.uniformMatrix4fv(this.addr,!1,Ai),gi(n,r)}}function Ti(e,t){const n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Ci(e,t){const n=this.cache;fi(n,t)||(e.uniform2iv(this.addr,t),gi(n,t))}function Ri(e,t){const n=this.cache;fi(n,t)||(e.uniform3iv(this.addr,t),gi(n,t))}function Ii(e,t){const n=this.cache;fi(n,t)||(e.uniform4iv(this.addr,t),gi(n,t))}function Oi(e,t){const n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function xi(e,t){const n=this.cache;fi(n,t)||(e.uniform2uiv(this.addr,t),gi(n,t))}function Ni(e,t){const n=this.cache;fi(n,t)||(e.uniform3uiv(this.addr,t),gi(n,t))}function Bi(e,t){const n=this.cache;fi(n,t)||(e.uniform4uiv(this.addr,t),gi(n,t))}function Li(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2D(t||oi,i)}function Di(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||ai,i)}function Mi(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTextureCube(t||ci,i)}function Pi(e,t,n){const r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||si,i)}function ki(e,t){e.uniform1fv(this.addr,t)}function Ui(e,t){const n=pi(t,this.size,2);e.uniform2fv(this.addr,n)}function Fi(e,t){const n=pi(t,this.size,3);e.uniform3fv(this.addr,n)}function Hi(e,t){const n=pi(t,this.size,4);e.uniform4fv(this.addr,n)}function Vi(e,t){const n=pi(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function Qi(e,t){const n=pi(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ji(e,t){const n=pi(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function Gi(e,t){e.uniform1iv(this.addr,t)}function Ki(e,t){e.uniform2iv(this.addr,t)}function Wi(e,t){e.uniform3iv(this.addr,t)}function zi(e,t){e.uniform4iv(this.addr,t)}function qi(e,t){e.uniform1uiv(this.addr,t)}function Yi(e,t){e.uniform2uiv(this.addr,t)}function Xi(e,t){e.uniform3uiv(this.addr,t)}function Ji(e,t){e.uniform4uiv(this.addr,t)}function Zi(e,t,n){const r=t.length,i=mi(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.setTexture2D(t[e]||oi,i[e])}function $i(e,t,n){const r=t.length,i=mi(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.setTexture3D(t[e]||ai,i[e])}function eo(e,t,n){const r=t.length,i=mi(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.setTextureCube(t[e]||ci,i[e])}function to(e,t,n){const r=t.length,i=mi(n,r);e.uniform1iv(this.addr,i);for(let e=0;e!==r;++e)n.setTexture2DArray(t[e]||si,i[e])}function no(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return vi;case 35664:return yi;case 35665:return _i;case 35666:return Ei;case 35674:return bi;case 35675:return wi;case 35676:return Si;case 5124:case 35670:return Ti;case 35667:case 35671:return Ci;case 35668:case 35672:return Ri;case 35669:case 35673:return Ii;case 5125:return Oi;case 36294:return xi;case 36295:return Ni;case 36296:return Bi;case 35678:case 36198:case 36298:case 36306:case 35682:return Li;case 35679:case 36299:case 36307:return Di;case 35680:case 36300:case 36308:case 36293:return Mi;case 36289:case 36303:case 36311:case 36292:return Pi}}(t.type)}function ro(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return ki;case 35664:return Ui;case 35665:return Fi;case 35666:return Hi;case 35674:return Vi;case 35675:return Qi;case 35676:return ji;case 5124:case 35670:return Gi;case 35667:case 35671:return Ki;case 35668:case 35672:return Wi;case 35669:case 35673:return zi;case 5125:return qi;case 36294:return Yi;case 36295:return Xi;case 36296:return Ji;case 35678:case 36198:case 36298:case 36306:case 35682:return Zi;case 35679:case 36299:case 36307:return $i;case 35680:case 36300:case 36308:case 36293:return eo;case 36289:case 36303:case 36311:case 36292:return to}}(t.type)}function io(e){this.id=e,this.seq=[],this.map={}}ro.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),gi(t,e)},io.prototype.setValue=function(e,t,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const o=r[i];o.setValue(e,t[o.id],n)}};const oo=/(\w+)(\])?(\[|\.)?/g;function so(e,t){e.seq.push(t),e.map[t.id]=t}function ao(e,t,n){const r=e.name,i=r.length;for(oo.lastIndex=0;;){const o=oo.exec(r),s=oo.lastIndex;let a=o[1];const c="]"===o[2],u=o[3];if(c&&(a|=0),void 0===u||"["===u&&s+2===i){so(n,void 0===u?new no(a,e,t):new ro(a,e,t));break}{let e=n.map[a];void 0===e&&(e=new io(a),so(n,e)),n=e}}}function co(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,35718);for(let r=0;r<n;++r){const n=e.getActiveUniform(t,r);ao(n,e.getUniformLocation(t,n.name),this)}}function uo(e,t,n){const r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}co.prototype.setValue=function(e,t,n,r){const i=this.map[t];void 0!==i&&i.setValue(e,n,r)},co.prototype.setOptional=function(e,t,n){const r=t[n];void 0!==r&&this.setValue(e,n,r)},co.upload=function(e,t,n,r){for(let i=0,o=t.length;i!==o;++i){const o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},co.seqWithValue=function(e,t){const n=[];for(let r=0,i=e.length;r!==i;++r){const i=e[r];i.id in t&&n.push(i)}return n};let lo=0;function Ao(e,t,n){const r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":n.toUpperCase()+"\n\n"+i+"\n\n"+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function ho(e,t){const n=function(e){switch(e){case ae:return["Linear","( value )"];case ce:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function po(e,t){let n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function fo(e){return""!==e}function go(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function mo(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const vo=/^[ \t]*#include +<([\w\d./]+)>/gm;function yo(e){return e.replace(vo,_o)}function _o(e,t){const n=Tr[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return yo(n)}const Eo=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,bo=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function wo(e){return e.replace(bo,To).replace(Eo,So)}function So(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),To(e,t,n,r)}function To(e,t,n,r){let i="";for(let e=parseInt(t);e<parseInt(n);e++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return i}function Co(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Ro(e,t,n,r){const s=e.getContext(),a=n.defines;let l=n.vertexShader,A=n.fragmentShader;const h=function(e){let t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),d=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case i:case o:t="ENVMAP_TYPE_CUBE";break;case c:case u:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),p=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case o:case u:t="ENVMAP_MODE_REFRACTION"}return t}(n),f=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),g=function(e){const t=e.envMapCubeUVHeight;if(null===t)return null;const n=Math.log2(t/32+1)+3,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),m=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(fo).join("\n")}(n),v=function(e){const t=[];for(const n in e){const r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(a),y=s.createProgram();let _,E,b=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?(_=[v].filter(fo).join("\n"),_.length>0&&(_+="\n"),E=[m,v].filter(fo).join("\n"),E.length>0&&(E+="\n")):(_=[Co(n),"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+p:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(fo).join("\n"),E=[m,Co(n),"#define SHADER_NAME "+n.shaderName,v,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+d:"",n.envMap?"#define "+p:"",n.envMap?"#define "+f:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+h:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Tr.tonemapping_pars_fragment:"",0!==n.toneMapping?po("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Tr.encodings_pars_fragment,ho("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(fo).join("\n")),l=yo(l),l=go(l,n),l=mo(l,n),A=yo(A),A=go(A,n),A=mo(A,n),l=wo(l),A=wo(A),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(b="#version 300 es\n",_=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,E=["#define varying in",n.glslVersion===he?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===he?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+E);const w=b+E+A,S=uo(s,35633,b+_+l),T=uo(s,35632,w);if(s.attachShader(y,S),s.attachShader(y,T),void 0!==n.index0AttributeName?s.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&s.bindAttribLocation(y,0,"position"),s.linkProgram(y),e.debug.checkShaderErrors){const e=s.getProgramInfoLog(y).trim(),t=s.getShaderInfoLog(S).trim(),n=s.getShaderInfoLog(T).trim();let r=!0,i=!0;if(!1===s.getProgramParameter(y,35714)){r=!1;const t=Ao(s,S,"vertex"),n=Ao(s,T,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(y,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+n)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==n||(i=!1);i&&(this.diagnostics={runnable:r,programLog:e,vertexShader:{log:t,prefix:_},fragmentShader:{log:n,prefix:E}})}let C,R;return s.deleteShader(S),s.deleteShader(T),this.getUniforms=function(){return void 0===C&&(C=new co(s,y)),C},this.getAttributes=function(){return void 0===R&&(R=function(e,t){const n={},r=e.getProgramParameter(t,35721);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i),o=r.name;let s=1;35674===r.type&&(s=2),35675===r.type&&(s=3),35676===r.type&&(s=4),n[o]={type:r.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(s,y)),R},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=lo++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=S,this.fragmentShader=T,this}let Io=0;class Oo{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),i=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(i)&&(o.add(i),i.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const e of t)e.usedTimes--,0===e.usedTimes&&this.shaderCache.delete(e);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}_getShaderStage(e){const t=this.shaderCache;if(!1===t.has(e)){const n=new xo;t.set(e,n)}return t.get(e)}}class xo{constructor(){this.id=Io++,this.usedTimes=0}}function No(e,t,n,r,i,o,s){const a=new Qt,l=new Oo,A=[],h=i.isWebGL2,d=i.logarithmicDepthBuffer,p=i.floatVertexTextures,f=i.maxVertexUniforms,g=i.vertexTextures;let m=i.precision;const v={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(o,a,A,y,_){const E=y.fog,b=_.geometry,w=o.isMeshStandardMaterial?y.environment:null,S=(o.isMeshStandardMaterial?n:t).get(o.envMap||w),T=!S||S.mapping!==c&&S.mapping!==u?null:S.image.height,C=v[o.type],R=_.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(p)return 1024;{const e=f,n=Math.floor((e-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}}(_):0;null!==o.precision&&(m=i.getMaxPrecision(o.precision),m!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",m,"instead."));const I=b.morphAttributes.position||b.morphAttributes.normal||b.morphAttributes.color,O=void 0!==I?I.length:0;let x,N,B,L,D=0;if(void 0!==b.morphAttributes.position&&(D=1),void 0!==b.morphAttributes.normal&&(D=2),void 0!==b.morphAttributes.color&&(D=3),C){const e=Rr[C];x=e.vertexShader,N=e.fragmentShader}else x=o.vertexShader,N=o.fragmentShader,l.update(o),B=l.getVertexShaderID(o),L=l.getFragmentShaderID(o);const M=e.getRenderTarget(),P=o.alphaTest>0,k=o.clearcoat>0;return{isWebGL2:h,shaderID:C,shaderName:o.type,vertexShader:x,fragmentShader:N,defines:o.defines,customVertexShaderID:B,customFragmentShaderID:L,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:m,instancing:!0===_.isInstancedMesh,instancingColor:!0===_.isInstancedMesh&&null!==_.instanceColor,supportsVertexTextures:g,outputEncoding:null===M?e.outputEncoding:!0===M.isXRRenderTarget?M.texture.encoding:ae,map:!!o.map,matcap:!!o.matcap,envMap:!!S,envMapMode:S&&S.mapping,envMapCubeUVHeight:T,lightMap:!!o.lightMap,aoMap:!!o.aoMap,emissiveMap:!!o.emissiveMap,bumpMap:!!o.bumpMap,normalMap:!!o.normalMap,objectSpaceNormalMap:1===o.normalMapType,tangentSpaceNormalMap:0===o.normalMapType,decodeVideoTexture:!!o.map&&!0===o.map.isVideoTexture&&o.map.encoding===ce,clearcoat:k,clearcoatMap:k&&!!o.clearcoatMap,clearcoatRoughnessMap:k&&!!o.clearcoatRoughnessMap,clearcoatNormalMap:k&&!!o.clearcoatNormalMap,displacementMap:!!o.displacementMap,roughnessMap:!!o.roughnessMap,metalnessMap:!!o.metalnessMap,specularMap:!!o.specularMap,specularIntensityMap:!!o.specularIntensityMap,specularColorMap:!!o.specularColorMap,opaque:!1===o.transparent&&1===o.blending,alphaMap:!!o.alphaMap,alphaTest:P,gradientMap:!!o.gradientMap,sheen:o.sheen>0,sheenColorMap:!!o.sheenColorMap,sheenRoughnessMap:!!o.sheenRoughnessMap,transmission:o.transmission>0,transmissionMap:!!o.transmissionMap,thicknessMap:!!o.thicknessMap,combine:o.combine,vertexTangents:!!o.normalMap&&!!b.attributes.tangent,vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!b.attributes.color&&4===b.attributes.color.itemSize,vertexUvs:!!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatMap||o.clearcoatRoughnessMap||o.clearcoatNormalMap||o.displacementMap||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheenColorMap||o.sheenRoughnessMap),uvsVertexOnly:!(o.map||o.bumpMap||o.normalMap||o.specularMap||o.alphaMap||o.emissiveMap||o.roughnessMap||o.metalnessMap||o.clearcoatNormalMap||o.transmission>0||o.transmissionMap||o.thicknessMap||o.specularIntensityMap||o.specularColorMap||o.sheen>0||o.sheenColorMap||o.sheenRoughnessMap||!o.displacementMap),fog:!!E,useFog:o.fog,fogExp2:E&&E.isFogExp2,flatShading:!!o.flatShading,sizeAttenuation:o.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===_.isSkinnedMesh&&R>0,maxBones:R,useVertexTexture:p,morphTargets:void 0!==b.morphAttributes.position,morphNormals:void 0!==b.morphAttributes.normal,morphColors:void 0!==b.morphAttributes.color,morphTargetsCount:O,morphTextureStride:D,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:s.numPlanes,numClipIntersection:s.numIntersection,dithering:o.dithering,shadowMapEnabled:e.shadowMap.enabled&&A.length>0,shadowMapType:e.shadowMap.type,toneMapping:o.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:o.premultipliedAlpha,doubleSided:2===o.side,flipSided:1===o.side,depthPacking:void 0!==o.depthPacking&&o.depthPacking,index0AttributeName:o.index0AttributeName,extensionDerivatives:o.extensions&&o.extensions.derivatives,extensionFragDepth:o.extensions&&o.extensions.fragDepth,extensionDrawBuffers:o.extensions&&o.extensions.drawBuffers,extensionShaderTextureLOD:o.extensions&&o.extensions.shaderTextureLOD,rendererExtensionFragDepth:h||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:h||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:h||r.has("EXT_shader_texture_lod"),customProgramCacheKey:o.customProgramCacheKey()}},getProgramCacheKey:function(t){const n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(const e in t.defines)n.push(e),n.push(t.defines[e]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.maxBones),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection)}(n,t),function(e,t){a.disableAll(),t.isWebGL2&&a.enable(0);t.supportsVertexTextures&&a.enable(1);t.instancing&&a.enable(2);t.instancingColor&&a.enable(3);t.map&&a.enable(4);t.matcap&&a.enable(5);t.envMap&&a.enable(6);t.lightMap&&a.enable(7);t.aoMap&&a.enable(8);t.emissiveMap&&a.enable(9);t.bumpMap&&a.enable(10);t.normalMap&&a.enable(11);t.objectSpaceNormalMap&&a.enable(12);t.tangentSpaceNormalMap&&a.enable(13);t.clearcoat&&a.enable(14);t.clearcoatMap&&a.enable(15);t.clearcoatRoughnessMap&&a.enable(16);t.clearcoatNormalMap&&a.enable(17);t.displacementMap&&a.enable(18);t.specularMap&&a.enable(19);t.roughnessMap&&a.enable(20);t.metalnessMap&&a.enable(21);t.gradientMap&&a.enable(22);t.alphaMap&&a.enable(23);t.alphaTest&&a.enable(24);t.vertexColors&&a.enable(25);t.vertexAlphas&&a.enable(26);t.vertexUvs&&a.enable(27);t.vertexTangents&&a.enable(28);t.uvsVertexOnly&&a.enable(29);t.fog&&a.enable(30);e.push(a.mask),a.disableAll(),t.useFog&&a.enable(0);t.flatShading&&a.enable(1);t.logarithmicDepthBuffer&&a.enable(2);t.skinning&&a.enable(3);t.useVertexTexture&&a.enable(4);t.morphTargets&&a.enable(5);t.morphNormals&&a.enable(6);t.morphColors&&a.enable(7);t.premultipliedAlpha&&a.enable(8);t.shadowMapEnabled&&a.enable(9);t.physicallyCorrectLights&&a.enable(10);t.doubleSided&&a.enable(11);t.flipSided&&a.enable(12);t.depthPacking&&a.enable(13);t.dithering&&a.enable(14);t.specularIntensityMap&&a.enable(15);t.specularColorMap&&a.enable(16);t.transmission&&a.enable(17);t.transmissionMap&&a.enable(18);t.thicknessMap&&a.enable(19);t.sheen&&a.enable(20);t.sheenColorMap&&a.enable(21);t.sheenRoughnessMap&&a.enable(22);t.decodeVideoTexture&&a.enable(23);t.opaque&&a.enable(24);e.push(a.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){const t=v[e.type];let n;if(t){const e=Rr[t];n=ar.clone(e.uniforms)}else n=e.uniforms;return n},acquireProgram:function(t,n){let r;for(let e=0,t=A.length;e<t;e++){const t=A[e];if(t.cacheKey===n){r=t,++r.usedTimes;break}}return void 0===r&&(r=new Ro(e,n,t,o),A.push(r)),r},releaseProgram:function(e){if(0==--e.usedTimes){const t=A.indexOf(e);A[t]=A[A.length-1],A.pop(),e.destroy()}},releaseShaderCache:function(e){l.remove(e)},programs:A,dispose:function(){l.dispose()}}}function Bo(){let e=new WeakMap;return{get:function(t){let n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function Lo(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Do(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Mo(){const e=[];let t=0;const n=[],r=[],i=[];function o(n,r,i,o,s,a){let c=e[t];return void 0===c?(c={id:n.id,object:n,geometry:r,material:i,groupOrder:o,renderOrder:n.renderOrder,z:s,group:a},e[t]=c):(c.id=n.id,c.object=n,c.geometry=r,c.material=i,c.groupOrder=o,c.renderOrder=n.renderOrder,c.z=s,c.group=a),t++,c}return{opaque:n,transmissive:r,transparent:i,init:function(){t=0,n.length=0,r.length=0,i.length=0},push:function(e,t,s,a,c,u){const l=o(e,t,s,a,c,u);s.transmission>0?r.push(l):!0===s.transparent?i.push(l):n.push(l)},unshift:function(e,t,s,a,c,u){const l=o(e,t,s,a,c,u);s.transmission>0?r.unshift(l):!0===s.transparent?i.unshift(l):n.unshift(l)},finish:function(){for(let n=t,r=e.length;n<r;n++){const t=e[n];if(null===t.id)break;t.id=null,t.object=null,t.geometry=null,t.material=null,t.group=null}},sort:function(e,t){n.length>1&&n.sort(e||Lo),r.length>1&&r.sort(t||Do),i.length>1&&i.sort(t||Do)}}}function Po(){let e=new WeakMap;return{get:function(t,n){let r;return!1===e.has(t)?(r=new Mo,e.set(t,[r])):n>=e.get(t).length?(r=new Mo,e.get(t).push(r)):r=e.get(t)[n],r},dispose:function(){e=new WeakMap}}}function ko(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":n={direction:new et,color:new Fe};break;case"SpotLight":n={position:new et,direction:new et,color:new Fe,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new et,color:new Fe,distance:0,decay:0};break;case"HemisphereLight":n={direction:new et,skyColor:new Fe,groundColor:new Fe};break;case"RectAreaLight":n={color:new Fe,position:new et,halfWidth:new et,halfHeight:new et}}return e[t.id]=n,n}}}let Uo=0;function Fo(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Ho(e,t){const n=new ko,r=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Re};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Re,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)i.probe.push(new et);const o=new et,s=new Nt,a=new Nt;return{setup:function(o,s){let a=0,c=0,u=0;for(let e=0;e<9;e++)i.probe[e].set(0,0,0);let l=0,A=0,h=0,d=0,p=0,f=0,g=0,m=0;o.sort(Fo);const v=!0!==s?Math.PI:1;for(let e=0,t=o.length;e<t;e++){const t=o[e],s=t.color,y=t.intensity,_=t.distance,E=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=s.r*y*v,c+=s.g*y*v,u+=s.b*y*v;else if(t.isLightProbe)for(let e=0;e<9;e++)i.probe[e].addScaledVector(t.sh.coefficients[e],y);else if(t.isDirectionalLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*v),t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.directionalShadow[l]=n,i.directionalShadowMap[l]=E,i.directionalShadowMatrix[l]=t.shadow.matrix,f++}i.directional[l]=e,l++}else if(t.isSpotLight){const e=n.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(s).multiplyScalar(y*v),e.distance=_,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,i.spotShadow[h]=n,i.spotShadowMap[h]=E,i.spotShadowMatrix[h]=t.shadow.matrix,m++}i.spot[h]=e,h++}else if(t.isRectAreaLight){const e=n.get(t);e.color.copy(s).multiplyScalar(y),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),i.rectArea[d]=e,d++}else if(t.isPointLight){const e=n.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*v),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,n=r.get(t);n.shadowBias=e.bias,n.shadowNormalBias=e.normalBias,n.shadowRadius=e.radius,n.shadowMapSize=e.mapSize,n.shadowCameraNear=e.camera.near,n.shadowCameraFar=e.camera.far,i.pointShadow[A]=n,i.pointShadowMap[A]=E,i.pointShadowMatrix[A]=t.shadow.matrix,g++}i.point[A]=e,A++}else if(t.isHemisphereLight){const e=n.get(t);e.skyColor.copy(t.color).multiplyScalar(y*v),e.groundColor.copy(t.groundColor).multiplyScalar(y*v),i.hemi[p]=e,p++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=Cr.LTC_FLOAT_1,i.rectAreaLTC2=Cr.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=Cr.LTC_HALF_1,i.rectAreaLTC2=Cr.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=a,i.ambient[1]=c,i.ambient[2]=u;const y=i.hash;y.directionalLength===l&&y.pointLength===A&&y.spotLength===h&&y.rectAreaLength===d&&y.hemiLength===p&&y.numDirectionalShadows===f&&y.numPointShadows===g&&y.numSpotShadows===m||(i.directional.length=l,i.spot.length=h,i.rectArea.length=d,i.point.length=A,i.hemi.length=p,i.directionalShadow.length=f,i.directionalShadowMap.length=f,i.pointShadow.length=g,i.pointShadowMap.length=g,i.spotShadow.length=m,i.spotShadowMap.length=m,i.directionalShadowMatrix.length=f,i.pointShadowMatrix.length=g,i.spotShadowMatrix.length=m,y.directionalLength=l,y.pointLength=A,y.spotLength=h,y.rectAreaLength=d,y.hemiLength=p,y.numDirectionalShadows=f,y.numPointShadows=g,y.numSpotShadows=m,i.version=Uo++)},setupView:function(e,t){let n=0,r=0,c=0,u=0,l=0;const A=t.matrixWorldInverse;for(let t=0,h=e.length;t<h;t++){const h=e[t];if(h.isDirectionalLight){const e=i.directional[n];e.direction.setFromMatrixPosition(h.matrixWorld),o.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(A),n++}else if(h.isSpotLight){const e=i.spot[c];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(A),e.direction.setFromMatrixPosition(h.matrixWorld),o.setFromMatrixPosition(h.target.matrixWorld),e.direction.sub(o),e.direction.transformDirection(A),c++}else if(h.isRectAreaLight){const e=i.rectArea[u];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(A),a.identity(),s.copy(h.matrixWorld),s.premultiply(A),a.extractRotation(s),e.halfWidth.set(.5*h.width,0,0),e.halfHeight.set(0,.5*h.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),u++}else if(h.isPointLight){const e=i.point[r];e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(A),r++}else if(h.isHemisphereLight){const e=i.hemi[l];e.direction.setFromMatrixPosition(h.matrixWorld),e.direction.transformDirection(A),e.direction.normalize(),l++}}},state:i}}function Vo(e,t){const n=new Ho(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Qo(e,t){let n=new WeakMap;return{get:function(r,i=0){let o;return!1===n.has(r)?(o=new Vo(e,t),n.set(r,[o])):i>=n.get(r).length?(o=new Vo(e,t),n.get(r).push(o)):o=n.get(r)[i],o},dispose:function(){n=new WeakMap}}}class jo extends gn{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}jo.prototype.isMeshDepthMaterial=!0;class Go extends gn{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new et,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}Go.prototype.isMeshDistanceMaterial=!0;function Ko(e,t,n){let r=new Er;const i=new Re,o=new Re,s=new We,a=new jo({depthPacking:3201}),c=new Go,u={},l=n.maxTextureSize,A={0:1,1:0,2:2},h=new cr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Re},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.HORIZONTAL_PASS=1;const f=new Un;f.setAttribute("position",new _n(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const m=new nr(f,h),v=this;function y(n,r){const i=t.update(m);h.defines.VSM_SAMPLES!==n.blurSamples&&(h.defines.VSM_SAMPLES=n.blurSamples,p.defines.VSM_SAMPLES=n.blurSamples,h.needsUpdate=!0,p.needsUpdate=!0),h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,h,m,null),p.uniforms.shadow_pass.value=n.mapPass.texture,p.uniforms.resolution.value=n.mapSize,p.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,p,m,null)}function _(t,n,r,i,o,s){let l=null;const h=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(l=void 0!==h?h:!0===r.isPointLight?c:a,e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const e=l.uuid,t=n.uuid;let r=u[e];void 0===r&&(r={},u[e]=r);let i=r[t];void 0===i&&(i=l.clone(),r[t]=i),l=i}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=3===s?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:A[n.side],l.alphaMap=n.alphaMap,l.alphaTest=n.alphaTest,l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.displacementMap=n.displacementMap,l.displacementScale=n.displacementScale,l.displacementBias=n.displacementBias,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=i,l.farDistance=o),l}function E(n,i,o,s,a){if(!1===n.visible)return;if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===a)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,n.matrixWorld);const r=t.update(n),i=n.material;if(Array.isArray(i)){const t=r.groups;for(let c=0,u=t.length;c<u;c++){const u=t[c],l=i[u.materialIndex];if(l&&l.visible){const t=_(n,l,s,o.near,o.far,a);e.renderBufferDirect(o,null,r,t,n,u)}}}else if(i.visible){const t=_(n,i,s,o.near,o.far,a);e.renderBufferDirect(o,null,r,t,n,null)}}const c=n.children;for(let e=0,t=c.length;e<t;e++)E(c[e],i,o,s,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,n,a){if(!1===v.enabled)return;if(!1===v.autoUpdate&&!1===v.needsUpdate)return;if(0===t.length)return;const c=e.getRenderTarget(),u=e.getActiveCubeFace(),A=e.getActiveMipmapLevel(),h=e.state;h.setBlending(0),h.buffers.color.setClear(1,1,1,1),h.buffers.depth.setTest(!0),h.setScissorTest(!1);for(let c=0,u=t.length;c<u;c++){const u=t[c],A=u.shadow;if(void 0===A){console.warn("THREE.WebGLShadowMap:",u,"has no shadow.");continue}if(!1===A.autoUpdate&&!1===A.needsUpdate)continue;i.copy(A.mapSize);const p=A.getFrameExtents();if(i.multiply(p),o.copy(A.mapSize),(i.x>l||i.y>l)&&(i.x>l&&(o.x=Math.floor(l/p.x),i.x=o.x*p.x,A.mapSize.x=o.x),i.y>l&&(o.y=Math.floor(l/p.y),i.y=o.y*p.y,A.mapSize.y=o.y)),null===A.map&&!A.isPointLightShadow&&3===this.type){const e={minFilter:g,magFilter:g,format:T};A.map=new ze(i.x,i.y,e),A.map.texture.name=u.name+".shadowMap",A.mapPass=new ze(i.x,i.y,e),A.camera.updateProjectionMatrix()}if(null===A.map){const e={minFilter:d,magFilter:d,format:T};A.map=new ze(i.x,i.y,e),A.map.texture.name=u.name+".shadowMap",A.camera.updateProjectionMatrix()}e.setRenderTarget(A.map),e.clear();const f=A.getViewportCount();for(let e=0;e<f;e++){const t=A.getViewport(e);s.set(o.x*t.x,o.y*t.y,o.x*t.z,o.y*t.w),h.viewport(s),A.updateMatrices(u,e),r=A.getFrustum(),E(n,a,A.camera,u,this.type)}A.isPointLightShadow||3!==this.type||y(A,a),A.needsUpdate=!1}v.needsUpdate=!1,e.setRenderTarget(c,u,A)}}function Wo(e,t,r){const i=r.isWebGL2;const o=new function(){let t=!1;const n=new We;let r=null;const i=new We(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,o,s,a){!0===a&&(t*=s,r*=s,o*=s),n.set(t,r,o,s),!1===i.equals(n)&&(e.clearColor(t,r,o,s),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){let t=!1,n=null,r=null,i=null;return{setTest:function(e){e?F(2929):H(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:default:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},a=new function(){let t=!1,n=null,r=null,i=null,o=null,s=null,a=null,c=null,u=null;return{setTest:function(e){t||(e?F(2960):H(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,s){r===t&&i===n&&o===s||(e.stencilFunc(t,n,s),r=t,i=n,o=s)},setOp:function(t,n,r){s===t&&a===n&&c===r||(e.stencilOp(t,n,r),s=t,a=n,c=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,i=null,o=null,s=null,a=null,c=null,u=null}}};let c={},u={},l=new WeakMap,A=[],h=null,d=!1,p=null,f=null,g=null,m=null,v=null,y=null,_=null,E=!1,b=null,w=null,S=null,T=null,C=null;const R=e.getParameter(35661);let I=!1,O=0;const x=e.getParameter(7938);-1!==x.indexOf("WebGL")?(O=parseFloat(/^WebGL (\d)/.exec(x)[1]),I=O>=1):-1!==x.indexOf("OpenGL ES")&&(O=parseFloat(/^OpenGL ES (\d)/.exec(x)[1]),I=O>=2);let N=null,B={};const L=e.getParameter(3088),D=e.getParameter(2978),M=(new We).fromArray(L),P=(new We).fromArray(D);function k(t,n,r){const i=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<r;t++)e.texImage2D(n+t,0,6408,1,1,0,6408,5121,i);return o}const U={};function F(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function H(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}U[3553]=k(3553,3553,1),U[34067]=k(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),a.setClear(0),F(2929),s.setFunc(3),G(!1),K(1),F(2884),j(0);const V={[n]:32774,101:32778,102:32779};if(i)V[103]=32775,V[104]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(V[103]=e.MIN_EXT,V[104]=e.MAX_EXT)}const Q={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function j(t,r,i,o,s,a,c,u){if(0!==t){if(!1===d&&(F(3042),d=!0),5===t)s=s||r,a=a||i,c=c||o,r===f&&s===v||(e.blendEquationSeparate(V[r],V[s]),f=r,v=s),i===g&&o===m&&a===y&&c===_||(e.blendFuncSeparate(Q[i],Q[o],Q[a],Q[c]),g=i,m=o,y=a,_=c),p=t,E=null;else if(t!==p||u!==E){if(f===n&&v===n||(e.blendEquation(32774),f=n,v=n),u)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFuncSeparate(0,769,0,1);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}g=null,m=null,y=null,_=null,p=t,E=u}}else!0===d&&(H(3042),d=!1)}function G(t){b!==t&&(t?e.frontFace(2304):e.frontFace(2305),b=t)}function K(t){0!==t?(F(2884),t!==w&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):H(2884),w=t}function W(t,n,r){t?(F(32823),T===n&&C===r||(e.polygonOffset(n,r),T=n,C=r)):H(32823)}function z(t){void 0===t&&(t=33984+R-1),N!==t&&(e.activeTexture(t),N=t)}return{buffers:{color:o,depth:s,stencil:a},enable:F,disable:H,bindFramebuffer:function(t,n){return u[t]!==n&&(e.bindFramebuffer(t,n),u[t]=n,i&&(36009===t&&(u[36160]=n),36160===t&&(u[36009]=n)),!0)},drawBuffers:function(n,i){let o=A,s=!1;if(n)if(o=l.get(i),void 0===o&&(o=[],l.set(i,o)),n.isWebGLMultipleRenderTargets){const e=n.texture;if(o.length!==e.length||36064!==o[0]){for(let t=0,n=e.length;t<n;t++)o[t]=36064+t;o.length=e.length,s=!0}}else 36064!==o[0]&&(o[0]=36064,s=!0);else 1029!==o[0]&&(o[0]=1029,s=!0);s&&(r.isWebGL2?e.drawBuffers(o):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(o))},useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:j,setMaterial:function(e,t){2===e.side?H(2884):F(2884);let n=1===e.side;t&&(n=!n),G(n),1===e.blending&&!1===e.transparent?j(0):j(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);const r=e.stencilWrite;a.setTest(r),r&&(a.setMask(e.stencilWriteMask),a.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),a.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),W(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?F(32926):H(32926)},setFlipSided:G,setCullFace:K,setLineWidth:function(t){t!==S&&(I&&e.lineWidth(t),S=t)},setPolygonOffset:W,setScissorTest:function(e){e?F(3089):H(3089)},activeTexture:z,bindTexture:function(t,n){null===N&&z();let r=B[N];void 0===r&&(r={type:void 0,texture:void 0},B[N]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||U[t]),r.type=t,r.texture=n)},unbindTexture:function(){const t=B[N];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===M.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),M.copy(t))},viewport:function(t){!1===P.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),P.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},N=null,B={},u={},l=new WeakMap,A=[],h=null,d=!1,p=null,f=null,g=null,m=null,v=null,y=null,_=null,E=!1,b=null,w=null,S=null,T=null,C=null,M.set(0,0,e.canvas.width,e.canvas.height),P.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),a.reset()}}}function zo(e,t,n,r,i,o,s){const a=i.isWebGL2,c=i.maxTextures,u=i.maxCubemapSize,I=i.maxTextureSize,O=i.maxSamples,x=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,N=new WeakMap;let B;const L=new WeakMap;let D=!1;try{D="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function M(e,t){return D?new OffscreenCanvas(e,t):Be("canvas")}function P(e,t,n,r){let i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const r=t?Te:Math.floor,o=r(i*e.width),s=r(i*e.height);void 0===B&&(B=M(o,s));const a=n?M(o,s):B;a.width=o,a.height=s;return a.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function k(e){return we(e.width)&&we(e.height)}function U(e,t){return e.generateMipmaps&&t&&e.minFilter!==d&&e.minFilter!==g}function F(t){e.generateMipmap(t)}function H(n,r,i,o,s=!1){if(!1===a)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let c=r;return 6403===r&&(5126===i&&(c=33326),5131===i&&(c=33325),5121===i&&(c=33321)),33319===r&&(5126===i&&(c=33328),5131===i&&(c=33327),5121===i&&(c=33323)),6408===r&&(5126===i&&(c=34836),5131===i&&(c=34842),5121===i&&(c=o===ce&&!1===s?35907:32856),32819===i&&(c=32854),32820===i&&(c=32855)),33325!==c&&33326!==c&&33327!==c&&33328!==c&&34842!==c&&34836!==c||t.get("EXT_color_buffer_float"),c}function V(e,t,n){return!0===U(e,n)||e.isFramebufferTexture&&e.minFilter!==d&&e.minFilter!==g?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function Q(e){return e===d||e===p||e===f?9728:9729}function j(e){const t=e.target;t.removeEventListener("dispose",j),function(e){const t=r.get(e);if(void 0===t.__webglInit)return;const n=e.source,i=L.get(n);if(i){const r=i[t.__cacheKey];r.usedTimes--,0===r.usedTimes&&K(e),0===Object.keys(i).length&&L.delete(n)}r.remove(e)}(t),t.isVideoTexture&&N.delete(t)}function G(t){const n=t.target;n.removeEventListener("dispose",G),function(t){const n=t.texture,i=r.get(t),o=r.get(n);void 0!==o.__webglTexture&&(e.deleteTexture(o.__webglTexture),s.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(i.__webglFramebuffer[t]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[t]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&e.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer&&e.deleteRenderbuffer(i.__webglColorRenderbuffer),i.__webglDepthRenderbuffer&&e.deleteRenderbuffer(i.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);i.__webglTexture&&(e.deleteTexture(i.__webglTexture),s.memory.textures--),r.remove(n[t])}r.remove(n),r.remove(t)}(n)}function K(t){const n=r.get(t);e.deleteTexture(n.__webglTexture);const i=t.source;delete L.get(i)[n.__cacheKey],s.memory.textures--}let W=0;function z(e,t){const i=r.get(e);if(e.isVideoTexture&&function(e){const t=s.render.frame;N.get(e)!==t&&(N.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&i.__version!==e.version){const n=e.image;if(null===n)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==n.complete)return void Z(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}const q={[l]:10497,[A]:33071,[h]:33648},Y={[d]:9728,[p]:9984,[f]:9986,[g]:9729,[m]:9985,[v]:9987};function X(n,o,s){if(s?(e.texParameteri(n,10242,q[o.wrapS]),e.texParameteri(n,10243,q[o.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,q[o.wrapR]),e.texParameteri(n,10240,Y[o.magFilter]),e.texParameteri(n,10241,Y[o.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),o.wrapS===A&&o.wrapT===A||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,Q(o.magFilter)),e.texParameteri(n,10241,Q(o.minFilter)),o.minFilter!==d&&o.minFilter!==g&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const s=t.get("EXT_texture_filter_anisotropic");if(o.type===b&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&o.type===w&&!1===t.has("OES_texture_half_float_linear"))return;(o.anisotropy>1||r.get(o).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,i.getMaxAnisotropy())),r.get(o).__currentAnisotropy=o.anisotropy)}}function J(t,n){let r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",j));const i=n.source;let o=L.get(i);void 0===o&&(o={},L.set(i,o));const a=function(e){const t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(a!==t.__cacheKey){void 0===o[a]&&(o[a]={texture:e.createTexture(),usedTimes:0},s.memory.textures++,r=!0),o[a].usedTimes++;const i=o[t.__cacheKey];void 0!==i&&(o[t.__cacheKey].usedTimes--,0===i.usedTimes&&K(n)),t.__cacheKey=a,t.__webglTexture=o[a].texture}return r}function Z(t,r,i){let s=3553;r.isDataArrayTexture&&(s=35866),r.isData3DTexture&&(s=32879);const c=J(t,r),u=r.source;if(n.activeTexture(33984+i),n.bindTexture(s,t.__webglTexture),u.version!==u.__currentVersion||!0===c){e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const i=function(e){return!a&&(e.wrapS!==A||e.wrapT!==A||e.minFilter!==d&&e.minFilter!==g)}(r)&&!1===k(r.image);let c=P(r.image,i,!1,I);c=ie(r,c);const l=k(c)||a,h=o.convert(r.format,r.encoding);let p,f=o.convert(r.type),m=H(r.internalFormat,h,f,r.encoding,r.isVideoTexture);X(s,r,l);const v=r.mipmaps,y=a&&!0!==r.isVideoTexture,w=void 0===t.__version,O=V(r,c,l);if(r.isDepthTexture)m=6402,a?m=r.type===b?36012:r.type===E?33190:r.type===S?35056:33189:r.type===b&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===C&&6402===m&&r.type!==_&&r.type!==E&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=_,f=o.convert(r.type)),r.format===R&&6402===m&&(m=34041,r.type!==S&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=S,f=o.convert(r.type))),y&&w?n.texStorage2D(3553,1,m,c.width,c.height):n.texImage2D(3553,0,m,c.width,c.height,0,h,f,null);else if(r.isDataTexture)if(v.length>0&&l){y&&w&&n.texStorage2D(3553,O,m,v[0].width,v[0].height);for(let e=0,t=v.length;e<t;e++)p=v[e],y?n.texSubImage2D(3553,e,0,0,p.width,p.height,h,f,p.data):n.texImage2D(3553,e,m,p.width,p.height,0,h,f,p.data);r.generateMipmaps=!1}else y?(w&&n.texStorage2D(3553,O,m,c.width,c.height),n.texSubImage2D(3553,0,0,0,c.width,c.height,h,f,c.data)):n.texImage2D(3553,0,m,c.width,c.height,0,h,f,c.data);else if(r.isCompressedTexture){y&&w&&n.texStorage2D(3553,O,m,v[0].width,v[0].height);for(let e=0,t=v.length;e<t;e++)p=v[e],r.format!==T?null!==h?y?n.compressedTexSubImage2D(3553,e,0,0,p.width,p.height,h,p.data):n.compressedTexImage2D(3553,e,m,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):y?n.texSubImage2D(3553,e,0,0,p.width,p.height,h,f,p.data):n.texImage2D(3553,e,m,p.width,p.height,0,h,f,p.data)}else if(r.isDataArrayTexture)y?(w&&n.texStorage3D(35866,O,m,c.width,c.height,c.depth),n.texSubImage3D(35866,0,0,0,0,c.width,c.height,c.depth,h,f,c.data)):n.texImage3D(35866,0,m,c.width,c.height,c.depth,0,h,f,c.data);else if(r.isData3DTexture)y?(w&&n.texStorage3D(32879,O,m,c.width,c.height,c.depth),n.texSubImage3D(32879,0,0,0,0,c.width,c.height,c.depth,h,f,c.data)):n.texImage3D(32879,0,m,c.width,c.height,c.depth,0,h,f,c.data);else if(r.isFramebufferTexture)y&&w?n.texStorage2D(3553,O,m,c.width,c.height):n.texImage2D(3553,0,m,c.width,c.height,0,h,f,null);else if(v.length>0&&l){y&&w&&n.texStorage2D(3553,O,m,v[0].width,v[0].height);for(let e=0,t=v.length;e<t;e++)p=v[e],y?n.texSubImage2D(3553,e,0,0,h,f,p):n.texImage2D(3553,e,m,h,f,p);r.generateMipmaps=!1}else y?(w&&n.texStorage2D(3553,O,m,c.width,c.height),n.texSubImage2D(3553,0,0,0,h,f,c)):n.texImage2D(3553,0,m,h,f,c);U(r,l)&&F(s),u.__currentVersion=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function $(t,i,s,a,c){const u=o.convert(s.format,s.encoding),l=o.convert(s.type),A=H(s.internalFormat,u,l,s.encoding);r.get(i).__hasExternalTextures||(32879===c||35866===c?n.texImage3D(c,0,A,i.width,i.height,i.depth,0,u,l,null):n.texImage2D(c,0,A,i.width,i.height,0,u,l,null)),n.bindFramebuffer(36160,t),re(i)?x.framebufferTexture2DMultisampleEXT(36160,a,c,r.get(s).__webglTexture,0,ne(i)):e.framebufferTexture2D(36160,a,c,r.get(s).__webglTexture,0),n.bindFramebuffer(36160,null)}function ee(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){let i=33189;if(r||re(n)){const t=n.depthTexture;t&&t.isDepthTexture&&(t.type===b?i=36012:t.type===E&&(i=33190));const r=ne(n);re(n)?x.renderbufferStorageMultisampleEXT(36161,r,i,n.width,n.height):e.renderbufferStorageMultisample(36161,r,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){const i=ne(n);r&&!1===re(n)?e.renderbufferStorageMultisample(36161,i,35056,n.width,n.height):re(n)?x.renderbufferStorageMultisampleEXT(36161,i,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===n.isWebGLMultipleRenderTargets?n.texture[0]:n.texture,i=o.convert(t.format,t.encoding),s=o.convert(t.type),a=H(t.internalFormat,i,s,t.encoding),c=ne(n);r&&!1===re(n)?e.renderbufferStorageMultisample(36161,c,a,n.width,n.height):re(n)?x.renderbufferStorageMultisampleEXT(36161,c,a,n.width,n.height):e.renderbufferStorage(36161,a,n.width,n.height)}e.bindRenderbuffer(36161,null)}function te(t){const i=r.get(t),o=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!i.__autoAllocateDepthBuffer){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),z(i.depthTexture,0);const o=r.get(i.depthTexture).__webglTexture,s=ne(i);if(i.depthTexture.format===C)re(i)?x.framebufferTexture2DMultisampleEXT(36160,36096,3553,o,0,s):e.framebufferTexture2D(36160,36096,3553,o,0);else{if(i.depthTexture.format!==R)throw new Error("Unknown depthTexture format");re(i)?x.framebufferTexture2DMultisampleEXT(36160,33306,3553,o,0,s):e.framebufferTexture2D(36160,33306,3553,o,0)}}(i.__webglFramebuffer,t)}else if(o){i.__webglDepthbuffer=[];for(let r=0;r<6;r++)n.bindFramebuffer(36160,i.__webglFramebuffer[r]),i.__webglDepthbuffer[r]=e.createRenderbuffer(),ee(i.__webglDepthbuffer[r],t,!1)}else n.bindFramebuffer(36160,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),ee(i.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function ne(e){return Math.min(O,e.samples)}function re(e){const n=r.get(e);return a&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function ie(e,n){const r=e.encoding,i=e.format,o=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===de||r!==ae&&(r===ce?!1===a?!0===t.has("EXT_sRGB")&&i===T?(e.format=de,e.minFilter=g,e.generateMipmaps=!1):n=Ve.sRGBToLinear(n):i===T&&o===y||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),n}this.allocateTextureUnit=function(){const e=W;return e>=c&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+c),W+=1,e},this.resetTextureUnits=function(){W=0},this.setTexture2D=z,this.setTexture2DArray=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?Z(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){const i=r.get(e);e.version>0&&i.__version!==e.version?Z(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=function(t,i){const s=r.get(t);t.version>0&&s.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;const s=J(t,r),c=r.source;if(n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),c.version!==c.__currentVersion||!0===s){e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);const i=r.isCompressedTexture||r.image[0].isCompressedTexture,s=r.image[0]&&r.image[0].isDataTexture,l=[];for(let e=0;e<6;e++)l[e]=i||s?s?r.image[e].image:r.image[e]:P(r.image[e],!1,!0,u),l[e]=ie(r,l[e]);const A=l[0],h=k(A)||a,d=o.convert(r.format,r.encoding),p=o.convert(r.type),f=H(r.internalFormat,d,p,r.encoding),g=a&&!0!==r.isVideoTexture,m=void 0===t.__version;let v,y=V(r,A,h);if(X(34067,r,h),i){g&&m&&n.texStorage2D(34067,y,f,A.width,A.height);for(let e=0;e<6;e++){v=l[e].mipmaps;for(let t=0;t<v.length;t++){const i=v[t];r.format!==T?null!==d?g?n.compressedTexSubImage2D(34069+e,t,0,0,i.width,i.height,d,i.data):n.compressedTexImage2D(34069+e,t,f,i.width,i.height,0,i.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):g?n.texSubImage2D(34069+e,t,0,0,i.width,i.height,d,p,i.data):n.texImage2D(34069+e,t,f,i.width,i.height,0,d,p,i.data)}}}else{v=r.mipmaps,g&&m&&(v.length>0&&y++,n.texStorage2D(34067,y,f,l[0].width,l[0].height));for(let e=0;e<6;e++)if(s){g?n.texSubImage2D(34069+e,0,0,0,l[e].width,l[e].height,d,p,l[e].data):n.texImage2D(34069+e,0,f,l[e].width,l[e].height,0,d,p,l[e].data);for(let t=0;t<v.length;t++){const r=v[t].image[e].image;g?n.texSubImage2D(34069+e,t+1,0,0,r.width,r.height,d,p,r.data):n.texImage2D(34069+e,t+1,f,r.width,r.height,0,d,p,r.data)}}else{g?n.texSubImage2D(34069+e,0,0,0,d,p,l[e]):n.texImage2D(34069+e,0,f,d,p,l[e]);for(let t=0;t<v.length;t++){const r=v[t];g?n.texSubImage2D(34069+e,t+1,0,0,d,p,r.image[e]):n.texImage2D(34069+e,t+1,f,d,p,r.image[e])}}}U(r,h)&&F(34067),c.__currentVersion=c.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(s,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,s.__webglTexture))},this.rebindTextures=function(e,t,n){const i=r.get(e);void 0!==t&&$(i.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&te(e)},this.setupRenderTarget=function(t){const c=t.texture,u=r.get(t),l=r.get(c);t.addEventListener("dispose",G),!0!==t.isWebGLMultipleRenderTargets&&(void 0===l.__webglTexture&&(l.__webglTexture=e.createTexture()),l.__version=c.version,s.memory.textures++);const A=!0===t.isWebGLCubeRenderTarget,h=!0===t.isWebGLMultipleRenderTargets,d=k(t)||a;if(A){u.__webglFramebuffer=[];for(let t=0;t<6;t++)u.__webglFramebuffer[t]=e.createFramebuffer()}else if(u.__webglFramebuffer=e.createFramebuffer(),h)if(i.drawBuffers){const n=t.texture;for(let t=0,i=n.length;t<i;t++){const i=r.get(n[t]);void 0===i.__webglTexture&&(i.__webglTexture=e.createTexture(),s.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(a&&t.samples>0&&!1===re(t)){u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,u.__webglColorRenderbuffer);const r=o.convert(c.format,c.encoding),i=o.convert(c.type),s=H(c.internalFormat,r,i,c.encoding),a=ne(t);e.renderbufferStorageMultisample(36161,a,s,t.width,t.height),n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,u.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),ee(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}if(A){n.bindTexture(34067,l.__webglTexture),X(34067,c,d);for(let e=0;e<6;e++)$(u.__webglFramebuffer[e],t,c,36064,34069+e);U(c,d)&&F(34067),n.unbindTexture()}else if(h){const e=t.texture;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=r.get(o);n.bindTexture(3553,s.__webglTexture),X(3553,o,d),$(u.__webglFramebuffer,t,o,36064+i,3553),U(o,d)&&F(3553)}n.unbindTexture()}else{let e=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(a?e=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(e,l.__webglTexture),X(e,c,d),$(u.__webglFramebuffer,t,c,36064,e),U(c,d)&&F(e),n.unbindTexture()}t.depthBuffer&&te(t)},this.updateRenderTargetMipmap=function(e){const t=k(e)||a,i=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let o=0,s=i.length;o<s;o++){const s=i[o];if(U(s,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,i=r.get(s).__webglTexture;n.bindTexture(t,i),F(t),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(a&&t.samples>0&&!1===re(t)){const i=t.width,o=t.height;let s=16384;const a=[36064],c=t.stencilBuffer?33306:36096;t.depthBuffer&&a.push(c);const u=r.get(t),l=void 0!==u.__ignoreDepthValues&&u.__ignoreDepthValues;!1===l&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),n.bindFramebuffer(36008,u.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,u.__webglFramebuffer),!0===l&&(e.invalidateFramebuffer(36008,[c]),e.invalidateFramebuffer(36009,[c])),e.blitFramebuffer(0,0,i,o,0,0,i,o,s,9728),e.invalidateFramebuffer(36008,a),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,u.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=te,this.setupFrameBufferTexture=$,this.useMultisampledRTT=re}function qo(e,t,n){const r=n.isWebGL2;return{convert:function(e,n=null){let i;if(e===y)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1010===e)return 5120;if(1011===e)return 5122;if(e===_)return 5123;if(1013===e)return 5124;if(e===E)return 5125;if(e===b)return 5126;if(e===w)return r?5131:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(1021===e)return 6406;if(e===T)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(e===C)return 6402;if(e===R)return 34041;if(1028===e)return 6403;if(1022===e)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(e===de)return i=t.get("EXT_sRGB"),null!==i?i.SRGB_ALPHA_EXT:null;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1033===e)return 36249;if(e===I||e===O||e===x||e===N)if(n===ce){if(i=t.get("WEBGL_compressed_texture_s3tc_srgb"),null===i)return null;if(e===I)return i.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===O)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===x)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===N)return i.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===I)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===O)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===x)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===N)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===B||e===L||e===D||e===M){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===B)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===L)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===D)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===M)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if(e===P||e===k){if(i=t.get("WEBGL_compressed_texture_etc"),null===i)return null;if(e===P)return n===ce?i.COMPRESSED_SRGB8_ETC2:i.COMPRESSED_RGB8_ETC2;if(e===k)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:i.COMPRESSED_RGBA8_ETC2_EAC}if(e===U||e===F||e===H||e===V||e===Q||e===j||e===G||e===K||e===W||e===z||e===q||e===Y||e===X||e===J){if(i=t.get("WEBGL_compressed_texture_astc"),null===i)return null;if(e===U)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:i.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===F)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:i.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===H)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:i.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===V)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:i.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===Q)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:i.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===j)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:i.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===G)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:i.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===K)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:i.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===W)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:i.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===z)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:i.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===q)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:i.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===Y)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:i.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===X)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:i.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===J)return n===ce?i.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:i.COMPRESSED_RGBA_ASTC_12x12_KHR}if(e===Z){if(i=t.get("EXT_texture_compression_bptc"),null===i)return null;if(e===Z)return n===ce?i.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:i.COMPRESSED_RGBA_BPTC_UNORM_EXT}return e===S?r?34042:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class Yo extends lr{constructor(e=[]){super(),this.cameras=e}}Yo.prototype.isArrayCamera=!0;class Xo extends nn{constructor(){super(),this.type="Group"}}Xo.prototype.isGroup=!0;const Jo={type:"move"};class Zo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Xo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Xo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new et,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new et),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Xo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new et,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new et),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,n){let r=null,i=null,o=null;const s=this._targetRay,a=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==s&&(r=t.getPose(e.targetRaySpace,n),null!==r&&(s.matrix.fromArray(r.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),r.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(r.linearVelocity)):s.hasLinearVelocity=!1,r.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(r.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(Jo))),c&&e.hand){o=!0;for(const r of e.hand.values()){const e=t.getJointPose(r,n);if(void 0===c.joints[r.jointName]){const e=new Xo;e.matrixAutoUpdate=!1,e.visible=!1,c.joints[r.jointName]=e,c.add(e)}const i=c.joints[r.jointName];null!==e&&(i.matrix.fromArray(e.transform.matrix),i.matrix.decompose(i.position,i.rotation,i.scale),i.jointRadius=e.radius),i.visible=null!==e}const r=c.joints["index-finger-tip"],i=c.joints["thumb-tip"],s=r.position.distanceTo(i.position),a=.02,u=.005;c.inputState.pinching&&s>a+u?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&s<=a-u&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),null!==i&&(a.matrix.fromArray(i.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),i.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(i.linearVelocity)):a.hasLinearVelocity=!1,i.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(i.angularVelocity)):a.hasAngularVelocity=!1));return null!==s&&(s.visible=null!==r),null!==a&&(a.visible=null!==i),null!==c&&(c.visible=null!==o),this}}class $o extends Ke{constructor(e,t,n,r,i,o,s,a,c,u){if((u=void 0!==u?u:C)!==C&&u!==R)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===C&&(n=_),void 0===n&&u===R&&(n=S),super(null,r,i,o,s,a,u,n,c),this.image={width:e,height:t},this.magFilter=void 0!==s?s:d,this.minFilter=void 0!==a?a:d,this.flipY=!1,this.generateMipmaps=!1}}$o.prototype.isDepthTexture=!0;class es extends pe{constructor(e,t){super();const n=this;let r=null,i=1,o=null,s="local-floor",a=null,c=null,u=null,l=null,A=null;const h=t.getContextAttributes();let d=null,p=null;const f=[],g=new Map,m=new lr;m.layers.enable(1),m.viewport=new We;const v=new lr;v.layers.enable(2),v.viewport=new We;const E=[m,v],b=new Yo;b.layers.enable(1),b.layers.enable(2);let w=null,I=null;function O(e){const t=g.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function x(){g.forEach((function(e,t){e.disconnect(t)})),g.clear(),w=null,I=null,e.setRenderTarget(d),l=null,u=null,c=null,r=null,p=null,P.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function N(e){const t=r.inputSources;for(let e=0;e<f.length;e++)g.set(t[e],f[e]);for(let t=0;t<e.removed.length;t++){const n=e.removed[t],r=g.get(n);r&&(r.dispatchEvent({type:"disconnected",data:n}),g.delete(n))}for(let t=0;t<e.added.length;t++){const n=e.added[t],r=g.get(n);r&&r.dispatchEvent({type:"connected",data:n})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=f[e];return void 0===t&&(t=new Zo,f[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=f[e];return void 0===t&&(t=new Zo,f[e]=t),t.getGripSpace()},this.getHand=function(e){let t=f[e];return void 0===t&&(t=new Zo,f[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){s=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==u?u:l},this.getBinding=function(){return c},this.getFrame=function(){return A},this.getSession=function(){return r},this.setSession=async function(a){if(r=a,null!==r){if(d=e.getRenderTarget(),r.addEventListener("select",O),r.addEventListener("selectstart",O),r.addEventListener("selectend",O),r.addEventListener("squeeze",O),r.addEventListener("squeezestart",O),r.addEventListener("squeezeend",O),r.addEventListener("end",x),r.addEventListener("inputsourceschange",N),!0!==h.xrCompatible&&await t.makeXRCompatible(),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2){const n={antialias:void 0!==r.renderState.layers||h.antialias,alpha:h.alpha,depth:h.depth,stencil:h.stencil,framebufferScaleFactor:i};l=new XRWebGLLayer(r,t,n),r.updateRenderState({baseLayer:l}),p=new ze(l.framebufferWidth,l.framebufferHeight,{format:T,type:y,encoding:e.outputEncoding})}else{let n=null,o=null,s=null;h.depth&&(s=h.stencil?35056:33190,n=h.stencil?R:C,o=h.stencil?S:_);const a={colorFormat:e.outputEncoding===ce?35907:32856,depthFormat:s,scaleFactor:i};c=new XRWebGLBinding(r,t),u=c.createProjectionLayer(a),r.updateRenderState({layers:[u]}),p=new ze(u.textureWidth,u.textureHeight,{format:T,type:y,depthTexture:new $o(u.textureWidth,u.textureHeight,o,void 0,void 0,void 0,void 0,void 0,void 0,n),stencilBuffer:h.stencil,encoding:e.outputEncoding,samples:h.antialias?4:0});e.properties.get(p).__ignoreDepthValues=u.ignoreDepthValues}p.isXRRenderTarget=!0,this.setFoveation(1),o=await r.requestReferenceSpace(s),P.setContext(r),P.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};const B=new et,L=new et;function D(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===r)return;b.near=v.near=m.near=e.near,b.far=v.far=m.far=e.far,w===b.near&&I===b.far||(r.updateRenderState({depthNear:b.near,depthFar:b.far}),w=b.near,I=b.far);const t=e.parent,n=b.cameras;D(b,t);for(let e=0;e<n.length;e++)D(n[e],t);b.matrixWorld.decompose(b.position,b.quaternion,b.scale),e.position.copy(b.position),e.quaternion.copy(b.quaternion),e.scale.copy(b.scale),e.matrix.copy(b.matrix),e.matrixWorld.copy(b.matrixWorld);const i=e.children;for(let e=0,t=i.length;e<t;e++)i[e].updateMatrixWorld(!0);2===n.length?function(e,t,n){B.setFromMatrixPosition(t.matrixWorld),L.setFromMatrixPosition(n.matrixWorld);const r=B.distanceTo(L),i=t.projectionMatrix.elements,o=n.projectionMatrix.elements,s=i[14]/(i[10]-1),a=i[14]/(i[10]+1),c=(i[9]+1)/i[5],u=(i[9]-1)/i[5],l=(i[8]-1)/i[0],A=(o[8]+1)/o[0],h=s*l,d=s*A,p=r/(-l+A),f=p*-l;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=s+p,m=a+p,v=h-f,y=d+(r-f),_=c*a/m*g,E=u*a/m*g;e.projectionMatrix.makePerspective(v,y,_,E,g,m)}(b,m,v):b.projectionMatrix.copy(m.projectionMatrix)},this.getCamera=function(){return b},this.getFoveation=function(){return null!==u?u.fixedFoveation:null!==l?l.fixedFoveation:void 0},this.setFoveation=function(e){null!==u&&(u.fixedFoveation=e),null!==l&&void 0!==l.fixedFoveation&&(l.fixedFoveation=e)};let M=null;const P=new br;P.setAnimationLoop((function(t,n){if(a=n.getViewerPose(o),A=n,null!==a){const t=a.views;null!==l&&(e.setRenderTargetFramebuffer(p,l.framebuffer),e.setRenderTarget(p));let n=!1;t.length!==b.cameras.length&&(b.cameras.length=0,n=!0);for(let r=0;r<t.length;r++){const i=t[r];let o=null;if(null!==l)o=l.getViewport(i);else{const t=c.getViewSubImage(u,i);o=t.viewport,0===r&&(e.setRenderTargetTextures(p,t.colorTexture,u.ignoreDepthValues?void 0:t.depthStencilTexture),e.setRenderTarget(p))}const s=E[r];s.matrix.fromArray(i.transform.matrix),s.projectionMatrix.fromArray(i.projectionMatrix),s.viewport.set(o.x,o.y,o.width,o.height),0===r&&b.matrix.copy(s.matrix),!0===n&&b.cameras.push(s)}}const i=r.inputSources;for(let e=0;e<f.length;e++){const t=f[e],r=i[e];t.update(r,n,o)}M&&M(t,n),A=null})),this.setAnimationLoop=function(e){M=e},this.dispose=function(){}}}function ts(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap),n.alphaTest>0&&(t.alphaTest.value=n.alphaTest);const r=e.get(n).envMap;let i,o;r&&(t.envMap.value=r,t.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,t.reflectivity.value=n.reflectivity,t.ior.value=n.ior,t.refractionRatio.value=n.refractionRatio),n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?i=n.map:n.specularMap?i=n.specularMap:n.displacementMap?i=n.displacementMap:n.normalMap?i=n.normalMap:n.bumpMap?i=n.bumpMap:n.roughnessMap?i=n.roughnessMap:n.metalnessMap?i=n.metalnessMap:n.alphaMap?i=n.alphaMap:n.emissiveMap?i=n.emissiveMap:n.clearcoatMap?i=n.clearcoatMap:n.clearcoatNormalMap?i=n.clearcoatNormalMap:n.clearcoatRoughnessMap?i=n.clearcoatRoughnessMap:n.specularIntensityMap?i=n.specularIntensityMap:n.specularColorMap?i=n.specularColorMap:n.transmissionMap?i=n.transmissionMap:n.thicknessMap?i=n.thicknessMap:n.sheenColorMap?i=n.sheenColorMap:n.sheenRoughnessMap&&(i=n.sheenRoughnessMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix)),n.aoMap?o=n.aoMap:n.lightMap&&(o=n.lightMap),void 0!==o&&(o.isWebGLRenderTarget&&(o=o.texture),!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uv2Transform.value.copy(o.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias);e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,o,s){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t,r){n(e,t),e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate()));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=r.texture,e.transmissionSamplerSize.value.set(r.width,r.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,r,s):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,o):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function ns(e={}){const t=void 0!==e.canvas?e.canvas:function(){const e=Be("canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0===e.depth||e.depth,i=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,a=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",u=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let l;l=void 0!==e.context?n.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;let A=null,h=null;const d=[],p=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=ae,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const f=this;let g=!1,m=0,_=0,E=null,S=-1,C=null;const R=new We,I=new We;let O=null,x=t.width,N=t.height,B=1,L=null,D=null;const M=new We(0,0,x,N),P=new We(0,0,x,N);let k=!1;const U=new Er;let F=!1,H=!1,V=null;const Q=new Nt,j=new Re,G=new et,K={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function W(){return null===E?B:1}let z,q,Y,X,J,Z,$,ee,te,ne,re,ie,oe,se,ce,ue,le,Ae,he,de,pe,fe,ge,me=n;function ve(e,n){for(let r=0;r<e.length;r++){const i=e[r],o=t.getContext(i,n);if(null!==o)return o}return null}try{const e={alpha:!0,depth:r,stencil:i,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:a,powerPreference:c,failIfMajorPerformanceCaveat:u};if("setAttribute"in t&&t.setAttribute("data-engine","three.js r138"),t.addEventListener("webglcontextlost",Ee,!1),t.addEventListener("webglcontextrestored",be,!1),null===me){const t=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&t.shift(),me=ve(t,e),null===me)throw ve(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===me.getShaderPrecisionFormat&&(me.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function ye(){z=new Xr(me),q=new Nr(me,z,e),z.init(q),fe=new qo(me,z,q),Y=new Wo(me,z,q),X=new $r(me),J=new Bo,Z=new zo(me,z,Y,J,q,fe,X),$=new Lr(f),ee=new Yr(f),te=new wr(me,q),ge=new Or(me,z,te,q),ne=new Jr(me,te,X,ge),re=new ii(me,ne,te,X),he=new ri(me,q,Z),ue=new Br(J),ie=new No(f,$,ee,z,q,ge,ue),oe=new ts(J),se=new Po,ce=new Qo(z,q),Ae=new Ir(f,$,Y,re,l,s),le=new Ko(f,re,q),de=new xr(me,z,X,q),pe=new Zr(me,z,X,q),X.programs=ie.programs,f.capabilities=q,f.extensions=z,f.properties=J,f.renderLists=se,f.shadowMap=le,f.state=Y,f.info=X}ye();const _e=new es(f,me);function Ee(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function be(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const e=X.autoReset,t=le.enabled,n=le.autoUpdate,r=le.needsUpdate,i=le.type;ye(),X.autoReset=e,le.enabled=t,le.autoUpdate=n,le.needsUpdate=r,le.type=i}function we(e){const t=e.target;t.removeEventListener("dispose",we),function(e){(function(e){const t=J.get(e).programs;void 0!==t&&(t.forEach((function(e){ie.releaseProgram(e)})),e.isShaderMaterial&&ie.releaseShaderCache(e))})(e),J.remove(e)}(t)}this.xr=_e,this.getContext=function(){return me},this.getContextAttributes=function(){return me.getContextAttributes()},this.forceContextLoss=function(){const e=z.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=z.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(e){void 0!==e&&(B=e,this.setSize(x,N,!1))},this.getSize=function(e){return e.set(x,N)},this.setSize=function(e,n,r){_e.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(x=e,N=n,t.width=Math.floor(e*B),t.height=Math.floor(n*B),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return e.set(x*B,N*B).floor()},this.setDrawingBufferSize=function(e,n,r){x=e,N=n,B=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return e.copy(R)},this.getViewport=function(e){return e.copy(M)},this.setViewport=function(e,t,n,r){e.isVector4?M.set(e.x,e.y,e.z,e.w):M.set(e,t,n,r),Y.viewport(R.copy(M).multiplyScalar(B).floor())},this.getScissor=function(e){return e.copy(P)},this.setScissor=function(e,t,n,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,r),Y.scissor(I.copy(P).multiplyScalar(B).floor())},this.getScissorTest=function(){return k},this.setScissorTest=function(e){Y.setScissorTest(k=e)},this.setOpaqueSort=function(e){L=e},this.setTransparentSort=function(e){D=e},this.getClearColor=function(e){return e.copy(Ae.getClearColor())},this.setClearColor=function(){Ae.setClearColor.apply(Ae,arguments)},this.getClearAlpha=function(){return Ae.getClearAlpha()},this.setClearAlpha=function(){Ae.setClearAlpha.apply(Ae,arguments)},this.clear=function(e=!0,t=!0,n=!0){let r=0;e&&(r|=16384),t&&(r|=256),n&&(r|=1024),me.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ee,!1),t.removeEventListener("webglcontextrestored",be,!1),se.dispose(),ce.dispose(),J.dispose(),$.dispose(),ee.dispose(),re.dispose(),ge.dispose(),ie.dispose(),_e.dispose(),_e.removeEventListener("sessionstart",Ce),_e.removeEventListener("sessionend",Ie),V&&(V.dispose(),V=null),Oe.stop()},this.renderBufferDirect=function(e,t,n,r,i,o){null===t&&(t=K);const s=i.isMesh&&i.matrixWorld.determinant()<0,a=function(e,t,n,r,i){!0!==t.isScene&&(t=K);Z.resetTextureUnits();const o=t.fog,s=r.isMeshStandardMaterial?t.environment:null,a=null===E?f.outputEncoding:!0===E.isXRRenderTarget?E.texture.encoding:ae,c=(r.isMeshStandardMaterial?ee:$).get(r.envMap||s),u=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,l=!!r.normalMap&&!!n.attributes.tangent,A=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,g=r.toneMapped?f.toneMapping:0,m=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,v=void 0!==m?m.length:0,y=J.get(r),_=h.state.lights;if(!0===F&&(!0===H||e!==C)){const t=e===C&&r.id===S;ue.setState(r,e,t)}let b=!1;r.version===y.__version?y.needsLights&&y.lightsStateVersion!==_.state.version||y.outputEncoding!==a||i.isInstancedMesh&&!1===y.instancing?b=!0:i.isInstancedMesh||!0!==y.instancing?i.isSkinnedMesh&&!1===y.skinning?b=!0:i.isSkinnedMesh||!0!==y.skinning?y.envMap!==c||r.fog&&y.fog!==o?b=!0:void 0===y.numClippingPlanes||y.numClippingPlanes===ue.numPlanes&&y.numIntersection===ue.numIntersection?(y.vertexAlphas!==u||y.vertexTangents!==l||y.morphTargets!==A||y.morphNormals!==d||y.morphColors!==p||y.toneMapping!==g||!0===q.isWebGL2&&y.morphTargetsCount!==v)&&(b=!0):b=!0:b=!0:b=!0:(b=!0,y.__version=r.version);let w=y.currentProgram;!0===b&&(w=Me(r,t,i));let T=!1,R=!1,I=!1;const O=w.getUniforms(),x=y.uniforms;Y.useProgram(w.program)&&(T=!0,R=!0,I=!0);r.id!==S&&(S=r.id,R=!0);if(T||C!==e){if(O.setValue(me,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&O.setValue(me,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),C!==e&&(C=e,R=!0,I=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){const t=O.map.cameraPosition;void 0!==t&&t.setValue(me,G.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&O.setValue(me,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||i.isSkinnedMesh)&&O.setValue(me,"viewMatrix",e.matrixWorldInverse)}if(i.isSkinnedMesh){O.setOptional(me,i,"bindMatrix"),O.setOptional(me,i,"bindMatrixInverse");const e=i.skeleton;e&&(q.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),O.setValue(me,"boneTexture",e.boneTexture,Z),O.setValue(me,"boneTextureSize",e.boneTextureSize)):O.setOptional(me,e,"boneMatrices"))}const L=n.morphAttributes;(void 0!==L.position||void 0!==L.normal||void 0!==L.color&&!0===q.isWebGL2)&&he.update(i,n,r,w);(R||y.receiveShadow!==i.receiveShadow)&&(y.receiveShadow=i.receiveShadow,O.setValue(me,"receiveShadow",i.receiveShadow));R&&(O.setValue(me,"toneMappingExposure",f.toneMappingExposure),y.needsLights&&(M=I,(D=x).ambientLightColor.needsUpdate=M,D.lightProbe.needsUpdate=M,D.directionalLights.needsUpdate=M,D.directionalLightShadows.needsUpdate=M,D.pointLights.needsUpdate=M,D.pointLightShadows.needsUpdate=M,D.spotLights.needsUpdate=M,D.spotLightShadows.needsUpdate=M,D.rectAreaLights.needsUpdate=M,D.hemisphereLights.needsUpdate=M),o&&r.fog&&oe.refreshFogUniforms(x,o),oe.refreshMaterialUniforms(x,r,B,N,V),co.upload(me,y.uniformsList,x,Z));var D,M;r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(co.upload(me,y.uniformsList,x,Z),r.uniformsNeedUpdate=!1);r.isSpriteMaterial&&O.setValue(me,"center",i.center);return O.setValue(me,"modelViewMatrix",i.modelViewMatrix),O.setValue(me,"normalMatrix",i.normalMatrix),O.setValue(me,"modelMatrix",i.matrixWorld),w}(e,t,n,r,i);Y.setMaterial(r,s);let c=n.index;const u=n.attributes.position;if(null===c){if(void 0===u||0===u.count)return}else if(0===c.count)return;let l,A=1;!0===r.wireframe&&(c=ne.getWireframeAttribute(n),A=2),ge.setup(i,r,a,n,c);let d=de;null!==c&&(l=te.get(c),d=pe,d.setIndex(l));const p=null!==c?c.count:u.count,g=n.drawRange.start*A,m=n.drawRange.count*A,v=null!==o?o.start*A:0,y=null!==o?o.count*A:1/0,_=Math.max(g,v),b=Math.min(p,g+m,v+y)-1,w=Math.max(0,b-_+1);if(0!==w){if(i.isMesh)!0===r.wireframe?(Y.setLineWidth(r.wireframeLinewidth*W()),d.setMode(1)):d.setMode(4);else if(i.isLine){let e=r.linewidth;void 0===e&&(e=1),Y.setLineWidth(e*W()),i.isLineSegments?d.setMode(1):i.isLineLoop?d.setMode(2):d.setMode(3)}else i.isPoints?d.setMode(0):i.isSprite&&d.setMode(4);if(i.isInstancedMesh)d.renderInstances(_,w,i.count);else if(n.isInstancedBufferGeometry){const e=Math.min(n.instanceCount,n._maxInstanceCount);d.renderInstances(_,w,e)}else d.render(_,w)}},this.compile=function(e,t){h=ce.get(e),h.init(),p.push(h),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(h.pushLight(e),e.castShadow&&h.pushShadow(e))})),h.setupLights(f.physicallyCorrectLights),e.traverse((function(t){const n=t.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){Me(n[r],e,t)}else Me(n,e,t)})),p.pop(),h=null};let Se=null;function Ce(){Oe.stop()}function Ie(){Oe.start()}const Oe=new br;function xe(e,t,n,r){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)h.pushLight(e),e.castShadow&&h.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){r&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Q);const t=re.update(e),i=e.material;i.visible&&A.push(e,t,i,n,G.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==X.render.frame&&(e.skeleton.update(),e.skeleton.frame=X.render.frame),!e.frustumCulled||U.intersectsObject(e))){r&&G.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Q);const t=re.update(e),i=e.material;if(Array.isArray(i)){const r=t.groups;for(let o=0,s=r.length;o<s;o++){const s=r[o],a=i[s.materialIndex];a&&a.visible&&A.push(e,t,a,n,G.z,s)}}else i.visible&&A.push(e,t,i,n,G.z,null)}const i=e.children;for(let e=0,o=i.length;e<o;e++)xe(i[e],t,n,r)}function Ne(e,t,n,r){const i=e.opaque,s=e.transmissive,a=e.transparent;h.setupLightsView(n),s.length>0&&function(e,t,n){const r=q.isWebGL2;null===V&&(V=new ze(1,1,{generateMipmaps:!0,type:null!==fe.convert(w)?w:y,minFilter:v,samples:r&&!0===o?4:0}));f.getDrawingBufferSize(j),r?V.setSize(j.x,j.y):V.setSize(Te(j.x),Te(j.y));const i=f.getRenderTarget();f.setRenderTarget(V),f.clear();const s=f.toneMapping;f.toneMapping=0,Le(e,t,n),f.toneMapping=s,Z.updateMultisampleRenderTarget(V),Z.updateRenderTargetMipmap(V),f.setRenderTarget(i)}(i,t,n),r&&Y.viewport(R.copy(r)),i.length>0&&Le(i,t,n),s.length>0&&Le(s,t,n),a.length>0&&Le(a,t,n),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1)}function Le(e,t,n){const r=!0===t.isScene?t.overrideMaterial:null;for(let i=0,o=e.length;i<o;i++){const o=e[i],s=o.object,a=o.geometry,c=null===r?o.material:r,u=o.group;s.layers.test(n.layers)&&De(s,t,n,a,c,u)}}function De(e,t,n,r,i,o){e.onBeforeRender(f,t,n,r,i,o),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),i.onBeforeRender(f,t,n,r,e,o),!0===i.transparent&&2===i.side?(i.side=1,i.needsUpdate=!0,f.renderBufferDirect(n,t,r,i,e,o),i.side=0,i.needsUpdate=!0,f.renderBufferDirect(n,t,r,i,e,o),i.side=2):f.renderBufferDirect(n,t,r,i,e,o),e.onAfterRender(f,t,n,r,i,o)}function Me(e,t,n){!0!==t.isScene&&(t=K);const r=J.get(e),i=h.state.lights,o=h.state.shadowsArray,s=i.state.version,a=ie.getParameters(e,i.state,o,t,n),c=ie.getProgramCacheKey(a);let u=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?ee:$).get(e.envMap||r.environment),void 0===u&&(e.addEventListener("dispose",we),u=new Map,r.programs=u);let l=u.get(c);if(void 0!==l){if(r.currentProgram===l&&r.lightsStateVersion===s)return Pe(e,a),l}else a.uniforms=ie.getUniforms(e),e.onBuild(n,a,f),e.onBeforeCompile(a,f),l=ie.acquireProgram(a,c),u.set(c,l),r.uniforms=a.uniforms;const A=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(A.clippingPlanes=ue.uniform),Pe(e,a),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=s,r.needsLights&&(A.ambientLightColor.value=i.state.ambient,A.lightProbe.value=i.state.probe,A.directionalLights.value=i.state.directional,A.directionalLightShadows.value=i.state.directionalShadow,A.spotLights.value=i.state.spot,A.spotLightShadows.value=i.state.spotShadow,A.rectAreaLights.value=i.state.rectArea,A.ltc_1.value=i.state.rectAreaLTC1,A.ltc_2.value=i.state.rectAreaLTC2,A.pointLights.value=i.state.point,A.pointLightShadows.value=i.state.pointShadow,A.hemisphereLights.value=i.state.hemi,A.directionalShadowMap.value=i.state.directionalShadowMap,A.directionalShadowMatrix.value=i.state.directionalShadowMatrix,A.spotShadowMap.value=i.state.spotShadowMap,A.spotShadowMatrix.value=i.state.spotShadowMatrix,A.pointShadowMap.value=i.state.pointShadowMap,A.pointShadowMatrix.value=i.state.pointShadowMatrix);const d=l.getUniforms(),p=co.seqWithValue(d.seq,A);return r.currentProgram=l,r.uniformsList=p,l}function Pe(e,t){const n=J.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}Oe.setAnimationLoop((function(e){Se&&Se(e)})),"undefined"!=typeof window&&Oe.setContext(window),this.setAnimationLoop=function(e){Se=e,_e.setAnimationLoop(e),null===e?Oe.stop():Oe.start()},_e.addEventListener("sessionstart",Ce),_e.addEventListener("sessionend",Ie),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===_e.enabled&&!0===_e.isPresenting&&(!0===_e.cameraAutoUpdate&&_e.updateCamera(t),t=_e.getCamera()),!0===e.isScene&&e.onBeforeRender(f,e,t,E),h=ce.get(e,p.length),h.init(),p.push(h),Q.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(Q),H=this.localClippingEnabled,F=ue.init(this.clippingPlanes,H,t),A=se.get(e,d.length),A.init(),d.push(A),xe(e,t,0,f.sortObjects),A.finish(),!0===f.sortObjects&&A.sort(L,D),!0===F&&ue.beginShadows();const n=h.state.shadowsArray;if(le.render(n,e,t),!0===F&&ue.endShadows(),!0===this.info.autoReset&&this.info.reset(),Ae.render(A,e),h.setupLights(f.physicallyCorrectLights),t.isArrayCamera){const n=t.cameras;for(let t=0,r=n.length;t<r;t++){const r=n[t];Ne(A,e,r,r.viewport)}}else Ne(A,e,t);null!==E&&(Z.updateMultisampleRenderTarget(E),Z.updateRenderTargetMipmap(E)),!0===e.isScene&&e.onAfterRender(f,e,t),ge.resetDefaultState(),S=-1,C=null,p.pop(),h=p.length>0?p[p.length-1]:null,d.pop(),A=d.length>0?d[d.length-1]:null},this.getActiveCubeFace=function(){return m},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return E},this.setRenderTargetTextures=function(e,t,n){J.get(e.texture).__webglTexture=t,J.get(e.depthTexture).__webglTexture=n;const r=J.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===z.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){const n=J.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e,t=0,n=0){E=e,m=t,_=n;let r=!0;if(e){const t=J.get(e);void 0!==t.__useDefaultFramebuffer?(Y.bindFramebuffer(36160,null),r=!1):void 0===t.__webglFramebuffer?Z.setupRenderTarget(e):t.__hasExternalTextures&&Z.rebindTextures(e,J.get(e.texture).__webglTexture,J.get(e.depthTexture).__webglTexture)}let i=null,o=!1,s=!1;if(e){const n=e.texture;(n.isData3DTexture||n.isDataArrayTexture)&&(s=!0);const r=J.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=r[t],o=!0):i=q.isWebGL2&&e.samples>0&&!1===Z.useMultisampledRTT(e)?J.get(e).__webglMultisampledFramebuffer:r,R.copy(e.viewport),I.copy(e.scissor),O=e.scissorTest}else R.copy(M).multiplyScalar(B).floor(),I.copy(P).multiplyScalar(B).floor(),O=k;if(Y.bindFramebuffer(36160,i)&&q.drawBuffers&&r&&Y.drawBuffers(e,i),Y.viewport(R),Y.scissor(I),Y.setScissorTest(O),o){const r=J.get(e.texture);me.framebufferTexture2D(36160,36064,34069+t,r.__webglTexture,n)}else if(s){const r=J.get(e.texture),i=t||0;me.framebufferTextureLayer(36160,36064,r.__webglTexture,n||0,i)}S=-1},this.readRenderTargetPixels=function(e,t,n,r,i,o,s){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=J.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==s&&(a=a[s]),a){Y.bindFramebuffer(36160,a);try{const s=e.texture,a=s.format,c=s.type;if(a!==T&&fe.convert(a)!==me.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const u=c===w&&(z.has("EXT_color_buffer_half_float")||q.isWebGL2&&z.has("EXT_color_buffer_float"));if(!(c===y||fe.convert(c)===me.getParameter(35738)||c===b&&(q.isWebGL2||z.has("OES_texture_float")||z.has("WEBGL_color_buffer_float"))||u))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===me.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&me.readPixels(t,n,r,i,fe.convert(a),fe.convert(c),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==E?J.get(E).__webglFramebuffer:null;Y.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,n=0){if(!0!==t.isFramebufferTexture)return void console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");const r=Math.pow(2,-n),i=Math.floor(t.image.width*r),o=Math.floor(t.image.height*r);Z.setTexture2D(t,0),me.copyTexSubImage2D(3553,n,0,0,e.x,e.y,i,o),Y.unbindTexture()},this.copyTextureToTexture=function(e,t,n,r=0){const i=t.image.width,o=t.image.height,s=fe.convert(n.format),a=fe.convert(n.type);Z.setTexture2D(n,0),me.pixelStorei(37440,n.flipY),me.pixelStorei(37441,n.premultiplyAlpha),me.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?me.texSubImage2D(3553,r,e.x,e.y,i,o,s,a,t.image.data):t.isCompressedTexture?me.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,s,t.mipmaps[0].data):me.texSubImage2D(3553,r,e.x,e.y,s,a,t.image),0===r&&n.generateMipmaps&&me.generateMipmap(3553),Y.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r,i=0){if(f.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,c=fe.convert(r.format),u=fe.convert(r.type);let l;if(r.isData3DTexture)Z.setTexture3D(r,0),l=32879;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");Z.setTexture2DArray(r,0),l=35866}me.pixelStorei(37440,r.flipY),me.pixelStorei(37441,r.premultiplyAlpha),me.pixelStorei(3317,r.unpackAlignment);const A=me.getParameter(3314),h=me.getParameter(32878),d=me.getParameter(3316),p=me.getParameter(3315),g=me.getParameter(32877),m=n.isCompressedTexture?n.mipmaps[0]:n.image;me.pixelStorei(3314,m.width),me.pixelStorei(32878,m.height),me.pixelStorei(3316,e.min.x),me.pixelStorei(3315,e.min.y),me.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?me.texSubImage3D(l,i,t.x,t.y,t.z,o,s,a,c,u,m.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),me.compressedTexSubImage3D(l,i,t.x,t.y,t.z,o,s,a,c,m.data)):me.texSubImage3D(l,i,t.x,t.y,t.z,o,s,a,c,u,m),me.pixelStorei(3314,A),me.pixelStorei(32878,h),me.pixelStorei(3316,d),me.pixelStorei(3315,p),me.pixelStorei(32877,g),0===i&&r.generateMipmaps&&me.generateMipmap(l),Y.unbindTexture()},this.initTexture=function(e){Z.setTexture2D(e,0),Y.unbindTexture()},this.resetState=function(){m=0,_=0,E=null,Y.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}ns.prototype.isWebGLRenderer=!0;class rs extends ns{}rs.prototype.isWebGL1Renderer=!0;class is{constructor(e,t=25e-5){this.name="",this.color=new Fe(e),this.density=t}clone(){return new is(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}is.prototype.isFogExp2=!0;class os{constructor(e,t=1,n=1e3){this.name="",this.color=new Fe(e),this.near=t,this.far=n}clone(){return new os(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}os.prototype.isFog=!0;class ss extends nn{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}ss.prototype.isScene=!0;class as{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=le,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=ye()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ye()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ye()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}as.prototype.isInterleavedBuffer=!0;const cs=new et;class us{constructor(e,t,n,r=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)cs.x=this.getX(t),cs.y=this.getY(t),cs.z=this.getZ(t),cs.applyMatrix4(e),this.setXYZ(t,cs.x,cs.y,cs.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)cs.x=this.getX(t),cs.y=this.getY(t),cs.z=this.getZ(t),cs.applyNormalMatrix(e),this.setXYZ(t,cs.x,cs.y,cs.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)cs.x=this.getX(t),cs.y=this.getY(t),cs.z=this.getZ(t),cs.transformDirection(e),this.setXYZ(t,cs.x,cs.y,cs.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}setXYZW(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return new _n(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new us(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const n=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[n+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}us.prototype.isInterleavedBufferAttribute=!0;class ls extends gn{constructor(e){super(),this.type="SpriteMaterial",this.color=new Fe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let As;ls.prototype.isSpriteMaterial=!0;const hs=new et,ds=new et,ps=new et,fs=new Re,gs=new Re,ms=new Nt,vs=new et,ys=new et,_s=new et,Es=new Re,bs=new Re,ws=new Re;class Ss extends nn{constructor(e){if(super(),this.type="Sprite",void 0===As){As=new Un;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new as(e,5);As.setIndex([0,1,2,0,2,3]),As.setAttribute("position",new us(t,3,0,!1)),As.setAttribute("uv",new us(t,2,3,!1))}this.geometry=As,this.material=void 0!==e?e:new ls,this.center=new Re(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ds.setFromMatrixScale(this.matrixWorld),ms.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ps.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ds.multiplyScalar(-ps.z);const n=this.material.rotation;let r,i;0!==n&&(i=Math.cos(n),r=Math.sin(n));const o=this.center;Ts(vs.set(-.5,-.5,0),ps,o,ds,r,i),Ts(ys.set(.5,-.5,0),ps,o,ds,r,i),Ts(_s.set(.5,.5,0),ps,o,ds,r,i),Es.set(0,0),bs.set(1,0),ws.set(1,1);let s=e.ray.intersectTriangle(vs,ys,_s,!1,hs);if(null===s&&(Ts(ys.set(-.5,.5,0),ps,o,ds,r,i),bs.set(0,1),s=e.ray.intersectTriangle(vs,_s,ys,!1,hs),null===s))return;const a=e.ray.origin.distanceTo(hs);a<e.near||a>e.far||t.push({distance:a,point:hs.clone(),uv:pn.getUV(hs,vs,ys,_s,Es,bs,ws,new Re),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function Ts(e,t,n,r,i,o){fs.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(gs.x=o*fs.x-i*fs.y,gs.y=i*fs.x+o*fs.y):gs.copy(fs),e.copy(t),e.x+=gs.x,e.y+=gs.y,e.applyMatrix4(ms)}Ss.prototype.isSprite=!0;const Cs=new et,Rs=new et;class Is extends nn{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.addLevel(n.object.clone(),n.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const n=this.levels;let r;for(r=0;r<n.length&&!(t<n[r].distance);r++);return n.splice(r,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Cs.setFromMatrixPosition(this.matrixWorld);const n=e.ray.origin.distanceTo(Cs);this.getObjectForDistance(n).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Cs.setFromMatrixPosition(e.matrixWorld),Rs.setFromMatrixPosition(this.matrixWorld);const n=Cs.distanceTo(Rs)/e.zoom;let r,i;for(t[0].object.visible=!0,r=1,i=t.length;r<i&&n>=t[r].distance;r++)t[r-1].object.visible=!1,t[r].object.visible=!0;for(this._currentLevel=r-1;r<i;r++)t[r].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let e=0,r=n.length;e<r;e++){const r=n[e];t.object.levels.push({object:r.object.uuid,distance:r.distance})}return t}}const Os=new et,xs=new We,Ns=new We,Bs=new et,Ls=new Nt;class Ds extends nr{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Nt,this.bindMatrixInverse=new Nt}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new We,t=this.geometry.attributes.skinWeight;for(let n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);const r=1/e.manhattanLength();r!==1/0?e.multiplyScalar(r):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const n=this.skeleton,r=this.geometry;xs.fromBufferAttribute(r.attributes.skinIndex,e),Ns.fromBufferAttribute(r.attributes.skinWeight,e),Os.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const r=Ns.getComponent(e);if(0!==r){const i=xs.getComponent(e);Ls.multiplyMatrices(n.bones[i].matrixWorld,n.boneInverses[i]),t.addScaledVector(Bs.copy(Os).applyMatrix4(Ls),r)}}return t.applyMatrix4(this.bindMatrixInverse)}}Ds.prototype.isSkinnedMesh=!0;class Ms extends nn{constructor(){super(),this.type="Bone"}}Ms.prototype.isBone=!0;class Ps extends Ke{constructor(e=null,t=1,n=1,r,i,o,s,a,c=1003,u=1003,l,A){super(null,o,s,a,c,u,r,i,l,A),this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}Ps.prototype.isDataTexture=!0;const ks=new Nt,Us=new Nt;class Fs{constructor(e=[],t=[]){this.uuid=ye(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Nt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Nt;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let r=0,i=e.length;r<i;r++){const i=e[r]?e[r].matrixWorld:Us;ks.multiplyMatrices(i,t[r]),ks.toArray(n,16*r)}null!==r&&(r.needsUpdate=!0)}clone(){return new Fs(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Se(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Ps(t,e,e,T,b);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const n=this.bones[t];if(n.name===e)return n}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,r=e.bones.length;n<r;n++){const r=e.bones[n];let i=t[r];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",r),i=new Ms),this.bones.push(i),this.boneInverses.push((new Nt).fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let r=0,i=t.length;r<i;r++){const i=t[r];e.bones.push(i.uuid);const o=n[r];e.boneInverses.push(o.toArray())}return e}}class Hs extends _n{constructor(e,t,n,r=1){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,n),this.meshPerAttribute=r}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}Hs.prototype.isInstancedBufferAttribute=!0;const Vs=new Nt,Qs=new Nt,js=[],Gs=new nr;class Ks extends nr{constructor(e,t,n){super(e,t),this.instanceMatrix=new Hs(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const n=this.matrixWorld,r=this.count;if(Gs.geometry=this.geometry,Gs.material=this.material,void 0!==Gs.material)for(let i=0;i<r;i++){this.getMatrixAt(i,Vs),Qs.multiplyMatrices(n,Vs),Gs.matrixWorld=Qs,Gs.raycast(e,js);for(let e=0,n=js.length;e<n;e++){const n=js[e];n.instanceId=i,n.object=this,t.push(n)}js.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new Hs(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}Ks.prototype.isInstancedMesh=!0;class Ws extends gn{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Fe(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}Ws.prototype.isLineBasicMaterial=!0;const zs=new et,qs=new et,Ys=new Nt,Xs=new xt,Js=new bt;class Zs extends nn{constructor(e=new Un,t=new Ws){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[0];for(let e=1,r=t.count;e<r;e++)zs.fromBufferAttribute(t,e-1),qs.fromBufferAttribute(t,e),n[e]=n[e-1],n[e]+=zs.distanceTo(qs);e.setAttribute("lineDistance",new On(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),Js.copy(n.boundingSphere),Js.applyMatrix4(r),Js.radius+=i,!1===e.ray.intersectsSphere(Js))return;Ys.copy(r).invert(),Xs.copy(e.ray).applyMatrix4(Ys);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s,c=new et,u=new et,l=new et,A=new et,h=this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,i=n.attributes.position;if(null!==r){for(let n=Math.max(0,o.start),s=Math.min(r.count,o.start+o.count)-1;n<s;n+=h){const o=r.getX(n),s=r.getX(n+1);c.fromBufferAttribute(i,o),u.fromBufferAttribute(i,s);if(Xs.distanceSqToSegment(c,u,A,l)>a)continue;A.applyMatrix4(this.matrixWorld);const h=e.ray.origin.distanceTo(A);h<e.near||h>e.far||t.push({distance:h,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}else{for(let n=Math.max(0,o.start),r=Math.min(i.count,o.start+o.count)-1;n<r;n+=h){c.fromBufferAttribute(i,n),u.fromBufferAttribute(i,n+1);if(Xs.distanceSqToSegment(c,u,A,l)>a)continue;A.applyMatrix4(this.matrixWorld);const r=e.ray.origin.distanceTo(A);r<e.near||r>e.far||t.push({distance:r,point:l.clone().applyMatrix4(this.matrixWorld),index:n,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Zs.prototype.isLine=!0;const $s=new et,ea=new et;class ta extends Zs{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,n=[];for(let e=0,r=t.count;e<r;e+=2)$s.fromBufferAttribute(t,e),ea.fromBufferAttribute(t,e+1),n[e]=0===e?0:n[e-1],n[e+1]=n[e]+$s.distanceTo(ea);e.setAttribute("lineDistance",new On(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}ta.prototype.isLineSegments=!0;class na extends Zs{constructor(e,t){super(e,t),this.type="LineLoop"}}na.prototype.isLineLoop=!0;class ra extends gn{constructor(e){super(),this.type="PointsMaterial",this.color=new Fe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}ra.prototype.isPointsMaterial=!0;const ia=new Nt,oa=new xt,sa=new bt,aa=new et;class ca extends nn{constructor(e=new Un,t=new ra){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold,o=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),sa.copy(n.boundingSphere),sa.applyMatrix4(r),sa.radius+=i,!1===e.ray.intersectsSphere(sa))return;ia.copy(r).invert(),oa.copy(e.ray).applyMatrix4(ia);const s=i/((this.scale.x+this.scale.y+this.scale.z)/3),a=s*s;if(n.isBufferGeometry){const i=n.index,s=n.attributes.position;if(null!==i){for(let n=Math.max(0,o.start),c=Math.min(i.count,o.start+o.count);n<c;n++){const o=i.getX(n);aa.fromBufferAttribute(s,o),ua(aa,o,a,r,e,t,this)}}else{for(let n=Math.max(0,o.start),i=Math.min(s.count,o.start+o.count);n<i;n++)aa.fromBufferAttribute(s,n),ua(aa,n,a,r,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,n=Object.keys(t);if(n.length>0){const e=t[n[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,n=e.length;t<n;t++){const n=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function ua(e,t,n,r,i,o,s){const a=oa.distanceSqToPoint(e);if(a<n){const n=new et;oa.closestPointToPoint(e,n),n.applyMatrix4(r);const c=i.ray.origin.distanceTo(n);if(c<i.near||c>i.far)return;o.push({distance:c,distanceToRay:Math.sqrt(a),point:n,index:t,face:null,object:s})}}ca.prototype.isPoints=!0;class la extends Ke{constructor(e,t,n,r,i,o,s,a,c){super(e,t,n,r,i,o,s,a,c),this.minFilter=void 0!==o?o:g,this.magFilter=void 0!==i?i:g,this.generateMipmaps=!1;const u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){u.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}la.prototype.isVideoTexture=!0;class Aa extends Ke{constructor(e,t,n){super({width:e,height:t}),this.format=n,this.magFilter=d,this.minFilter=d,this.generateMipmaps=!1,this.needsUpdate=!0}}Aa.prototype.isFramebufferTexture=!0;class ha extends Ke{constructor(e,t,n,r,i,o,s,a,c,u,l,A){super(null,o,s,a,c,u,r,i,l,A),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}ha.prototype.isCompressedTexture=!0;class da extends Ke{constructor(e,t,n,r,i,o,s,a,c){super(e,t,n,r,i,o,s,a,c),this.needsUpdate=!0}}da.prototype.isCanvasTexture=!0;class pa extends Un{constructor(e=1,t=8,n=0,r=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:r},t=Math.max(3,t);const i=[],o=[],s=[],a=[],c=new et,u=new Re;o.push(0,0,0),s.push(0,0,1),a.push(.5,.5);for(let i=0,l=3;i<=t;i++,l+=3){const A=n+i/t*r;c.x=e*Math.cos(A),c.y=e*Math.sin(A),o.push(c.x,c.y,c.z),s.push(0,0,1),u.x=(o[l]/e+1)/2,u.y=(o[l+1]/e+1)/2,a.push(u.x,u.y)}for(let e=1;e<=t;e++)i.push(e,e+1,0);this.setIndex(i),this.setAttribute("position",new On(o,3)),this.setAttribute("normal",new On(s,3)),this.setAttribute("uv",new On(a,2))}static fromJSON(e){return new pa(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class fa extends Un{constructor(e=1,t=1,n=1,r=8,i=1,o=!1,s=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:r,heightSegments:i,openEnded:o,thetaStart:s,thetaLength:a};const c=this;r=Math.floor(r),i=Math.floor(i);const u=[],l=[],A=[],h=[];let d=0;const p=[],f=n/2;let g=0;function m(n){const i=d,o=new Re,p=new et;let m=0;const v=!0===n?e:t,y=!0===n?1:-1;for(let e=1;e<=r;e++)l.push(0,f*y,0),A.push(0,y,0),h.push(.5,.5),d++;const _=d;for(let e=0;e<=r;e++){const t=e/r*a+s,n=Math.cos(t),i=Math.sin(t);p.x=v*i,p.y=f*y,p.z=v*n,l.push(p.x,p.y,p.z),A.push(0,y,0),o.x=.5*n+.5,o.y=.5*i*y+.5,h.push(o.x,o.y),d++}for(let e=0;e<r;e++){const t=i+e,r=_+e;!0===n?u.push(r,r+1,t):u.push(r+1,r,t),m+=3}c.addGroup(g,m,!0===n?1:2),g+=m}!function(){const o=new et,m=new et;let v=0;const y=(t-e)/n;for(let c=0;c<=i;c++){const u=[],g=c/i,v=g*(t-e)+e;for(let e=0;e<=r;e++){const t=e/r,i=t*a+s,c=Math.sin(i),p=Math.cos(i);m.x=v*c,m.y=-g*n+f,m.z=v*p,l.push(m.x,m.y,m.z),o.set(c,y,p).normalize(),A.push(o.x,o.y,o.z),h.push(t,1-g),u.push(d++)}p.push(u)}for(let e=0;e<r;e++)for(let t=0;t<i;t++){const n=p[t][e],r=p[t+1][e],i=p[t+1][e+1],o=p[t][e+1];u.push(n,r,o),u.push(r,i,o),v+=6}c.addGroup(g,v,0),g+=v}(),!1===o&&(e>0&&m(!0),t>0&&m(!1)),this.setIndex(u),this.setAttribute("position",new On(l,3)),this.setAttribute("normal",new On(A,3)),this.setAttribute("uv",new On(h,2))}static fromJSON(e){return new fa(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ga extends fa{constructor(e=1,t=1,n=8,r=1,i=!1,o=0,s=2*Math.PI){super(0,e,t,n,r,i,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:r,openEnded:i,thetaStart:o,thetaLength:s}}static fromJSON(e){return new ga(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ma extends Un{constructor(e=[],t=[],n=1,r=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:r};const i=[],o=[];function s(e,t,n,r){const i=r+1,o=[];for(let r=0;r<=i;r++){o[r]=[];const s=e.clone().lerp(n,r/i),a=t.clone().lerp(n,r/i),c=i-r;for(let e=0;e<=c;e++)o[r][e]=0===e&&r===i?s:s.clone().lerp(a,e/c)}for(let e=0;e<i;e++)for(let t=0;t<2*(i-e)-1;t++){const n=Math.floor(t/2);t%2==0?(a(o[e][n+1]),a(o[e+1][n]),a(o[e][n])):(a(o[e][n+1]),a(o[e+1][n+1]),a(o[e+1][n]))}}function a(e){i.push(e.x,e.y,e.z)}function c(t,n){const r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function u(e,t,n,r){r<0&&1===e.x&&(o[t]=e.x-1),0===n.x&&0===n.z&&(o[t]=r/2/Math.PI+.5)}function l(e){return Math.atan2(e.z,-e.x)}!function(e){const n=new et,r=new et,i=new et;for(let o=0;o<t.length;o+=3)c(t[o+0],n),c(t[o+1],r),c(t[o+2],i),s(n,r,i,e)}(r),function(e){const t=new et;for(let n=0;n<i.length;n+=3)t.x=i[n+0],t.y=i[n+1],t.z=i[n+2],t.normalize().multiplyScalar(e),i[n+0]=t.x,i[n+1]=t.y,i[n+2]=t.z}(n),function(){const e=new et;for(let n=0;n<i.length;n+=3){e.x=i[n+0],e.y=i[n+1],e.z=i[n+2];const r=l(e)/2/Math.PI+.5,s=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);o.push(r,1-s)}var t;(function(){const e=new et,t=new et,n=new et,r=new et,s=new Re,a=new Re,c=new Re;for(let A=0,h=0;A<i.length;A+=9,h+=6){e.set(i[A+0],i[A+1],i[A+2]),t.set(i[A+3],i[A+4],i[A+5]),n.set(i[A+6],i[A+7],i[A+8]),s.set(o[h+0],o[h+1]),a.set(o[h+2],o[h+3]),c.set(o[h+4],o[h+5]),r.copy(e).add(t).add(n).divideScalar(3);const d=l(r);u(s,h+0,e,d),u(a,h+2,t,d),u(c,h+4,n,d)}})(),function(){for(let e=0;e<o.length;e+=6){const t=o[e+0],n=o[e+2],r=o[e+4],i=Math.max(t,n,r),s=Math.min(t,n,r);i>.9&&s<.1&&(t<.2&&(o[e+0]+=1),n<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.setAttribute("position",new On(i,3)),this.setAttribute("normal",new On(i.slice(),3)),this.setAttribute("uv",new On(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new ma(e.vertices,e.indices,e.radius,e.details)}}class va extends ma{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,r=1/n;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new va(e.radius,e.detail)}}const ya=new et,_a=new et,Ea=new et,ba=new pn;class wa extends Un{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const n=4,r=Math.pow(10,n),i=Math.cos(me*t),o=e.getIndex(),s=e.getAttribute("position"),a=o?o.count:s.count,c=[0,0,0],u=["a","b","c"],l=new Array(3),A={},h=[];for(let e=0;e<a;e+=3){o?(c[0]=o.getX(e),c[1]=o.getX(e+1),c[2]=o.getX(e+2)):(c[0]=e,c[1]=e+1,c[2]=e+2);const{a:t,b:n,c:a}=ba;if(t.fromBufferAttribute(s,c[0]),n.fromBufferAttribute(s,c[1]),a.fromBufferAttribute(s,c[2]),ba.getNormal(Ea),l[0]=`${Math.round(t.x*r)},${Math.round(t.y*r)},${Math.round(t.z*r)}`,l[1]=`${Math.round(n.x*r)},${Math.round(n.y*r)},${Math.round(n.z*r)}`,l[2]=`${Math.round(a.x*r)},${Math.round(a.y*r)},${Math.round(a.z*r)}`,l[0]!==l[1]&&l[1]!==l[2]&&l[2]!==l[0])for(let e=0;e<3;e++){const t=(e+1)%3,n=l[e],r=l[t],o=ba[u[e]],s=ba[u[t]],a=`${n}_${r}`,d=`${r}_${n}`;d in A&&A[d]?(Ea.dot(A[d].normal)<=i&&(h.push(o.x,o.y,o.z),h.push(s.x,s.y,s.z)),A[d]=null):a in A||(A[a]={index0:c[e],index1:c[t],normal:Ea.clone()})}}for(const e in A)if(A[e]){const{index0:t,index1:n}=A[e];ya.fromBufferAttribute(s,t),_a.fromBufferAttribute(s,n),h.push(ya.x,ya.y,ya.z),h.push(_a.x,_a.y,_a.z)}this.setAttribute("position",new On(h,3))}}}class Sa{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,r=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(r),t.push(i),r=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const n=this.getLengths();let r=0;const i=n.length;let o;o=t||e*n[i-1];let s,a=0,c=i-1;for(;a<=c;)if(r=Math.floor(a+(c-a)/2),s=n[r]-o,s<0)a=r+1;else{if(!(s>0)){c=r;break}c=r-1}if(r=c,n[r]===o)return r/(i-1);const u=n[r];return(r+(o-u)/(n[r+1]-u))/(i-1)}getTangent(e,t){const n=1e-4;let r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);const o=this.getPoint(r),s=this.getPoint(i),a=t||(o.isVector2?new Re:new et);return a.copy(s).sub(o).normalize(),a}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){const n=new et,r=[],i=[],o=[],s=new et,a=new Nt;for(let t=0;t<=e;t++){const n=t/e;r[t]=this.getTangentAt(n,new et)}i[0]=new et,o[0]=new et;let c=Number.MAX_VALUE;const u=Math.abs(r[0].x),l=Math.abs(r[0].y),A=Math.abs(r[0].z);u<=c&&(c=u,n.set(1,0,0)),l<=c&&(c=l,n.set(0,1,0)),A<=c&&n.set(0,0,1),s.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],s),o[0].crossVectors(r[0],i[0]);for(let t=1;t<=e;t++){if(i[t]=i[t-1].clone(),o[t]=o[t-1].clone(),s.crossVectors(r[t-1],r[t]),s.length()>Number.EPSILON){s.normalize();const e=Math.acos(_e(r[t-1].dot(r[t]),-1,1));i[t].applyMatrix4(a.makeRotationAxis(s,e))}o[t].crossVectors(r[t],i[t])}if(!0===t){let t=Math.acos(_e(i[0].dot(i[e]),-1,1));t/=e,r[0].dot(s.crossVectors(i[0],i[e]))>0&&(t=-t);for(let n=1;n<=e;n++)i[n].applyMatrix4(a.makeRotationAxis(r[n],t*n)),o[n].crossVectors(r[n],i[n])}return{tangents:r,normals:i,binormals:o}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class Ta extends Sa{constructor(e=0,t=0,n=1,r=1,i=0,o=2*Math.PI,s=!1,a=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=s,this.aRotation=a}getPoint(e,t){const n=t||new Re,r=2*Math.PI;let i=this.aEndAngle-this.aStartAngle;const o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=o?0:r),!0!==this.aClockwise||o||(i===r?i=-r:i-=r);const s=this.aStartAngle+e*i;let a=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),n=a-this.aX,r=c-this.aY;a=n*e-r*t+this.aX,c=n*t+r*e+this.aY}return n.set(a,c)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}Ta.prototype.isEllipseCurve=!0;class Ca extends Ta{constructor(e,t,n,r,i,o){super(e,t,n,n,r,i,o),this.type="ArcCurve"}}function Ra(){let e=0,t=0,n=0,r=0;function i(i,o,s,a){e=i,t=s,n=-3*i+3*o-2*s-a,r=2*i-2*o+s+a}return{initCatmullRom:function(e,t,n,r,o){i(t,n,o*(n-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,o,s,a){let c=(t-e)/o-(n-e)/(o+s)+(n-t)/s,u=(n-t)/s-(r-t)/(s+a)+(r-n)/a;c*=s,u*=s,i(t,n,c,u)},calc:function(i){const o=i*i;return e+t*i+n*o+r*(o*i)}}}Ca.prototype.isArcCurve=!0;const Ia=new et,Oa=new Ra,xa=new Ra,Na=new Ra;class Ba extends Sa{constructor(e=[],t=!1,n="centripetal",r=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}getPoint(e,t=new et){const n=t,r=this.points,i=r.length,o=(i-(this.closed?0:1))*e;let s,a,c=Math.floor(o),u=o-c;this.closed?c+=c>0?0:(Math.floor(Math.abs(c)/i)+1)*i:0===u&&c===i-1&&(c=i-2,u=1),this.closed||c>0?s=r[(c-1)%i]:(Ia.subVectors(r[0],r[1]).add(r[0]),s=Ia);const l=r[c%i],A=r[(c+1)%i];if(this.closed||c+2<i?a=r[(c+2)%i]:(Ia.subVectors(r[i-1],r[i-2]).add(r[i-1]),a=Ia),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(s.distanceToSquared(l),e),n=Math.pow(l.distanceToSquared(A),e),r=Math.pow(A.distanceToSquared(a),e);n<1e-4&&(n=1),t<1e-4&&(t=n),r<1e-4&&(r=n),Oa.initNonuniformCatmullRom(s.x,l.x,A.x,a.x,t,n,r),xa.initNonuniformCatmullRom(s.y,l.y,A.y,a.y,t,n,r),Na.initNonuniformCatmullRom(s.z,l.z,A.z,a.z,t,n,r)}else"catmullrom"===this.curveType&&(Oa.initCatmullRom(s.x,l.x,A.x,a.x,this.tension),xa.initCatmullRom(s.y,l.y,A.y,a.y,this.tension),Na.initCatmullRom(s.z,l.z,A.z,a.z,this.tension));return n.set(Oa.calc(u),xa.calc(u),Na.calc(u)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new et).fromArray(n))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function La(e,t,n,r,i){const o=.5*(r-t),s=.5*(i-n),a=e*e;return(2*n-2*r+o+s)*(e*a)+(-3*n+3*r-2*o-s)*a+o*e+n}function Da(e,t,n,r){return function(e,t){const n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Ma(e,t,n,r,i){return function(e,t){const n=1-e;return n*n*n*t}(e,t)+function(e,t){const n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}Ba.prototype.isCatmullRomCurve3=!0;class Pa extends Sa{constructor(e=new Re,t=new Re,n=new Re,r=new Re){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new Re){const n=t,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(Ma(e,r.x,i.x,o.x,s.x),Ma(e,r.y,i.y,o.y,s.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}Pa.prototype.isCubicBezierCurve=!0;class ka extends Sa{constructor(e=new et,t=new et,n=new et,r=new et){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}getPoint(e,t=new et){const n=t,r=this.v0,i=this.v1,o=this.v2,s=this.v3;return n.set(Ma(e,r.x,i.x,o.x,s.x),Ma(e,r.y,i.y,o.y,s.y),Ma(e,r.z,i.z,o.z,s.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}ka.prototype.isCubicBezierCurve3=!0;class Ua extends Sa{constructor(e=new Re,t=new Re){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Re){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const n=t||new Re;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Ua.prototype.isLineCurve=!0;class Fa extends Sa{constructor(e=new et,t=new et){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new et){const n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Ha extends Sa{constructor(e=new Re,t=new Re,n=new Re){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Re){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(Da(e,r.x,i.x,o.x),Da(e,r.y,i.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Ha.prototype.isQuadraticBezierCurve=!0;class Va extends Sa{constructor(e=new et,t=new et,n=new et){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new et){const n=t,r=this.v0,i=this.v1,o=this.v2;return n.set(Da(e,r.x,i.x,o.x),Da(e,r.y,i.y,o.y),Da(e,r.z,i.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}Va.prototype.isQuadraticBezierCurve3=!0;class Qa extends Sa{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Re){const n=t,r=this.points,i=(r.length-1)*e,o=Math.floor(i),s=i-o,a=r[0===o?o:o-1],c=r[o],u=r[o>r.length-2?r.length-1:o+1],l=r[o>r.length-3?r.length-1:o+2];return n.set(La(s,a.x,c.x,u.x,l.x),La(s,a.y,c.y,u.y,l.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const n=this.points[t];e.points.push(n.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const n=e.points[t];this.points.push((new Re).fromArray(n))}return this}}Qa.prototype.isSplineCurve=!0;var ja=Object.freeze({__proto__:null,ArcCurve:Ca,CatmullRomCurve3:Ba,CubicBezierCurve:Pa,CubicBezierCurve3:ka,EllipseCurve:Ta,LineCurve:Ua,LineCurve3:Fa,QuadraticBezierCurve:Ha,QuadraticBezierCurve3:Va,SplineCurve:Qa});class Ga extends Sa{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Ua(t,e))}getPoint(e,t){const n=e*this.getLength(),r=this.getCurveLengths();let i=0;for(;i<r.length;){if(r[i]>=n){const e=r[i]-n,o=this.curves[i],s=o.getLength(),a=0===s?0:1-e/s;return o.getPointAt(a,t)}i++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let r=0,i=this.curves;r<i.length;r++){const o=i[r],s=o.isEllipseCurve?2*e:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s);for(let e=0;e<a.length;e++){const r=a[e];n&&n.equals(r)||(t.push(r),n=r)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push(n.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const n=this.curves[t];e.curves.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const n=e.curves[t];this.curves.push((new ja[n.type]).fromJSON(n))}return this}}class Ka extends Ga{constructor(e){super(),this.type="Path",this.currentPoint=new Re,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new Ua(this.currentPoint.clone(),new Re(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,r){const i=new Ha(this.currentPoint.clone(),new Re(e,t),new Re(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this}bezierCurveTo(e,t,n,r,i,o){const s=new Pa(this.currentPoint.clone(),new Re(e,t),new Re(n,r),new Re(i,o));return this.curves.push(s),this.currentPoint.set(i,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Qa(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,r,i,o){const s=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+s,t+a,n,r,i,o),this}absarc(e,t,n,r,i,o){return this.absellipse(e,t,n,n,r,i,o),this}ellipse(e,t,n,r,i,o,s,a){const c=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+c,t+u,n,r,i,o,s,a),this}absellipse(e,t,n,r,i,o,s,a){const c=new Ta(e,t,n,r,i,o,s,a);if(this.curves.length>0){const e=c.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(c);const u=c.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Wa extends Ka{constructor(e){super(e),this.uuid=ye(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push(n.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const n=this.holes[t];e.holes.push(n.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const n=e.holes[t];this.holes.push((new Ka).fromJSON(n))}return this}}const za=function(e,t,n=2){const r=t&&t.length,i=r?t[0]*n:e.length;let o=qa(e,0,i,n,!0);const s=[];if(!o||o.next===o.prev)return s;let a,c,u,l,A,h,d;if(r&&(o=function(e,t,n,r){const i=[];let o,s,a,c,u;for(o=0,s=t.length;o<s;o++)a=t[o]*r,c=o<s-1?t[o+1]*r:e.length,u=qa(e,a,c,r,!1),u===u.next&&(u.steiner=!0),i.push(oc(u));for(i.sort(tc),o=0;o<i.length;o++)nc(i[o],n),n=Ya(n,n.next);return n}(e,t,o,n)),e.length>80*n){a=u=e[0],c=l=e[1];for(let t=n;t<i;t+=n)A=e[t],h=e[t+1],A<a&&(a=A),h<c&&(c=h),A>u&&(u=A),h>l&&(l=h);d=Math.max(u-a,l-c),d=0!==d?1/d:0}return Xa(o,s,n,a,c,d),s};function qa(e,t,n,r,i){let o,s;if(i===function(e,t,n,r){let i=0;for(let o=t,s=n-r;o<n;o+=r)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}(e,t,n,r)>0)for(o=t;o<n;o+=r)s=fc(o,e[o],e[o+1],s);else for(o=n-r;o>=t;o-=r)s=fc(o,e[o],e[o+1],s);return s&&uc(s,s.next)&&(gc(s),s=s.next),s}function Ya(e,t){if(!e)return e;t||(t=e);let n,r=e;do{if(n=!1,r.steiner||!uc(r,r.next)&&0!==cc(r.prev,r,r.next))r=r.next;else{if(gc(r),r=t=r.prev,r===r.next)break;n=!0}}while(n||r!==t);return t}function Xa(e,t,n,r,i,o,s){if(!e)return;!s&&o&&function(e,t,n,r){let i=e;do{null===i.z&&(i.z=ic(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,n,r,i,o,s,a,c,u=1;do{for(n=e,e=null,o=null,s=0;n;){for(s++,r=n,a=0,t=0;t<u&&(a++,r=r.nextZ,r);t++);for(c=u;a>0||c>0&&r;)0!==a&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,u*=2}while(s>1)}(i)}(e,r,i,o);let a,c,u=e;for(;e.prev!==e.next;)if(a=e.prev,c=e.next,o?Za(e,r,i,o):Ja(e))t.push(a.i/n),t.push(e.i/n),t.push(c.i/n),gc(e),e=c.next,u=c.next;else if((e=c)===u){s?1===s?Xa(e=$a(Ya(e),t,n),t,n,r,i,o,2):2===s&&ec(e,t,n,r,i,o):Xa(Ya(e),t,n,r,i,o,1);break}}function Ja(e){const t=e.prev,n=e,r=e.next;if(cc(t,n,r)>=0)return!1;let i=e.next.next;for(;i!==e.prev;){if(sc(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&cc(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Za(e,t,n,r){const i=e.prev,o=e,s=e.next;if(cc(i,o,s)>=0)return!1;const a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,c=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,u=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,l=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,A=ic(a,c,t,n,r),h=ic(u,l,t,n,r);let d=e.prevZ,p=e.nextZ;for(;d&&d.z>=A&&p&&p.z<=h;){if(d!==e.prev&&d!==e.next&&sc(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&cc(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&sc(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&cc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=A;){if(d!==e.prev&&d!==e.next&&sc(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&cc(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=h;){if(p!==e.prev&&p!==e.next&&sc(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&cc(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function $a(e,t,n){let r=e;do{const i=r.prev,o=r.next.next;!uc(i,o)&&lc(i,r,r.next,o)&&dc(i,o)&&dc(o,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(o.i/n),gc(r),gc(r.next),r=e=o),r=r.next}while(r!==e);return Ya(r)}function ec(e,t,n,r,i,o){let s=e;do{let e=s.next.next;for(;e!==s.prev;){if(s.i!==e.i&&ac(s,e)){let a=pc(s,e);return s=Ya(s,s.next),a=Ya(a,a.next),Xa(s,t,n,r,i,o),void Xa(a,t,n,r,i,o)}e=e.next}s=s.next}while(s!==e)}function tc(e,t){return e.x-t.x}function nc(e,t){if(t=function(e,t){let n=t;const r=e.x,i=e.y;let o,s=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){const e=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(e<=r&&e>s){if(s=e,e===r){if(i===n.y)return n;if(i===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!o)return null;if(r===s)return o;const a=o,c=o.x,u=o.y;let l,A=1/0;n=o;do{r>=n.x&&n.x>=c&&r!==n.x&&sc(i<u?r:s,i,c,u,i<u?s:r,i,n.x,n.y)&&(l=Math.abs(i-n.y)/(r-n.x),dc(n,e)&&(l<A||l===A&&(n.x>o.x||n.x===o.x&&rc(o,n)))&&(o=n,A=l)),n=n.next}while(n!==a);return o}(e,t),t){const n=pc(t,e);Ya(t,t.next),Ya(n,n.next)}}function rc(e,t){return cc(e.prev,e,t.prev)<0&&cc(t.next,e,e.next)<0}function ic(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function oc(e){let t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function sc(e,t,n,r,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(n-s)*(t-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function ac(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&lc(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(dc(e,t)&&dc(t,e)&&function(e,t){let n=e,r=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(cc(e.prev,e,t.prev)||cc(e,t.prev,t))||uc(e,t)&&cc(e.prev,e,e.next)>0&&cc(t.prev,t,t.next)>0)}function cc(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function uc(e,t){return e.x===t.x&&e.y===t.y}function lc(e,t,n,r){const i=hc(cc(e,t,n)),o=hc(cc(e,t,r)),s=hc(cc(n,r,e)),a=hc(cc(n,r,t));return i!==o&&s!==a||(!(0!==i||!Ac(e,n,t))||(!(0!==o||!Ac(e,r,t))||(!(0!==s||!Ac(n,e,r))||!(0!==a||!Ac(n,t,r)))))}function Ac(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function hc(e){return e>0?1:e<0?-1:0}function dc(e,t){return cc(e.prev,e,e.next)<0?cc(e,t,e.next)>=0&&cc(e,e.prev,t)>=0:cc(e,t,e.prev)<0||cc(e,e.next,t)<0}function pc(e,t){const n=new mc(e.i,e.x,e.y),r=new mc(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function fc(e,t,n,r){const i=new mc(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function gc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function mc(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class vc{static area(e){const t=e.length;let n=0;for(let r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n}static isClockWise(e){return vc.area(e)<0}static triangulateShape(e,t){const n=[],r=[],i=[];yc(e),_c(n,e);let o=e.length;t.forEach(yc);for(let e=0;e<t.length;e++)r.push(o),o+=t[e].length,_c(n,t[e]);const s=za(n,r);for(let e=0;e<s.length;e+=3)i.push(s.slice(e,e+3));return i}}function yc(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function _c(e,t){for(let n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}class Ec extends Un{constructor(e=new Wa([new Re(.5,.5),new Re(-.5,.5),new Re(-.5,-.5),new Re(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,r=[],i=[];for(let t=0,n=e.length;t<n;t++){o(e[t])}function o(e){const o=[],s=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let c=void 0!==t.depth?t.depth:1,u=void 0===t.bevelEnabled||t.bevelEnabled,l=void 0!==t.bevelThickness?t.bevelThickness:.2,A=void 0!==t.bevelSize?t.bevelSize:l-.1,h=void 0!==t.bevelOffset?t.bevelOffset:0,d=void 0!==t.bevelSegments?t.bevelSegments:3;const p=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:bc;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),c=t.amount);let g,m,v,y,_,E=!1;p&&(g=p.getSpacedPoints(a),E=!0,u=!1,m=p.computeFrenetFrames(a,!1),v=new et,y=new et,_=new et),u||(d=0,l=0,A=0,h=0);const b=e.extractPoints(s);let w=b.shape;const S=b.holes;if(!vc.isClockWise(w)){w=w.reverse();for(let e=0,t=S.length;e<t;e++){const t=S[e];vc.isClockWise(t)&&(S[e]=t.reverse())}}const T=vc.triangulateShape(w,S),C=w;for(let e=0,t=S.length;e<t;e++){const t=S[e];w=w.concat(t)}function R(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}const I=w.length,O=T.length;function x(e,t,n){let r,i,o;const s=e.x-t.x,a=e.y-t.y,c=n.x-e.x,u=n.y-e.y,l=s*s+a*a,A=s*u-a*c;if(Math.abs(A)>Number.EPSILON){const A=Math.sqrt(l),h=Math.sqrt(c*c+u*u),d=t.x-a/A,p=t.y+s/A,f=((n.x-u/h-d)*u-(n.y+c/h-p)*c)/(s*u-a*c);r=d+s*f-e.x,i=p+a*f-e.y;const g=r*r+i*i;if(g<=2)return new Re(r,i);o=Math.sqrt(g/2)}else{let e=!1;s>Number.EPSILON?c>Number.EPSILON&&(e=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(u)&&(e=!0),e?(r=-a,i=s,o=Math.sqrt(l)):(r=s,i=a,o=Math.sqrt(l/2))}return new Re(r/o,i/o)}const N=[];for(let e=0,t=C.length,n=t-1,r=e+1;e<t;e++,n++,r++)n===t&&(n=0),r===t&&(r=0),N[e]=x(C[e],C[n],C[r]);const B=[];let L,D=N.concat();for(let e=0,t=S.length;e<t;e++){const t=S[e];L=[];for(let e=0,n=t.length,r=n-1,i=e+1;e<n;e++,r++,i++)r===n&&(r=0),i===n&&(i=0),L[e]=x(t[e],t[r],t[i]);B.push(L),D=D.concat(L)}for(let e=0;e<d;e++){const t=e/d,n=l*Math.cos(t*Math.PI/2),r=A*Math.sin(t*Math.PI/2)+h;for(let e=0,t=C.length;e<t;e++){const t=R(C[e],N[e],r);k(t.x,t.y,-n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];L=B[e];for(let e=0,i=t.length;e<i;e++){const i=R(t[e],L[e],r);k(i.x,i.y,-n)}}}const M=A+h;for(let e=0;e<I;e++){const t=u?R(w[e],D[e],M):w[e];E?(y.copy(m.normals[0]).multiplyScalar(t.x),v.copy(m.binormals[0]).multiplyScalar(t.y),_.copy(g[0]).add(y).add(v),k(_.x,_.y,_.z)):k(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<I;t++){const n=u?R(w[t],D[t],M):w[t];E?(y.copy(m.normals[e]).multiplyScalar(n.x),v.copy(m.binormals[e]).multiplyScalar(n.y),_.copy(g[e]).add(y).add(v),k(_.x,_.y,_.z)):k(n.x,n.y,c/a*e)}for(let e=d-1;e>=0;e--){const t=e/d,n=l*Math.cos(t*Math.PI/2),r=A*Math.sin(t*Math.PI/2)+h;for(let e=0,t=C.length;e<t;e++){const t=R(C[e],N[e],r);k(t.x,t.y,c+n)}for(let e=0,t=S.length;e<t;e++){const t=S[e];L=B[e];for(let e=0,i=t.length;e<i;e++){const i=R(t[e],L[e],r);E?k(i.x,i.y+g[a-1].y,g[a-1].x+n):k(i.x,i.y,c+n)}}}function P(e,t){let n=e.length;for(;--n>=0;){const r=n;let i=n-1;i<0&&(i=e.length-1);for(let e=0,n=a+2*d;e<n;e++){const n=I*e,o=I*(e+1);F(t+r+n,t+i+n,t+i+o,t+r+o)}}}function k(e,t,n){o.push(e),o.push(t),o.push(n)}function U(e,t,i){H(e),H(t),H(i);const o=r.length/3,s=f.generateTopUV(n,r,o-3,o-2,o-1);V(s[0]),V(s[1]),V(s[2])}function F(e,t,i,o){H(e),H(t),H(o),H(t),H(i),H(o);const s=r.length/3,a=f.generateSideWallUV(n,r,s-6,s-3,s-2,s-1);V(a[0]),V(a[1]),V(a[3]),V(a[1]),V(a[2]),V(a[3])}function H(e){r.push(o[3*e+0]),r.push(o[3*e+1]),r.push(o[3*e+2])}function V(e){i.push(e.x),i.push(e.y)}!function(){const e=r.length/3;if(u){let e=0,t=I*e;for(let e=0;e<O;e++){const n=T[e];U(n[2]+t,n[1]+t,n[0]+t)}e=a+2*d,t=I*e;for(let e=0;e<O;e++){const n=T[e];U(n[0]+t,n[1]+t,n[2]+t)}}else{for(let e=0;e<O;e++){const t=T[e];U(t[2],t[1],t[0])}for(let e=0;e<O;e++){const t=T[e];U(t[0]+I*a,t[1]+I*a,t[2]+I*a)}}n.addGroup(e,r.length/3-e,0)}(),function(){const e=r.length/3;let t=0;P(C,t),t+=C.length;for(let e=0,n=S.length;e<n;e++){const n=S[e];P(n,t),t+=n.length}n.addGroup(e,r.length/3-e,1)}()}this.setAttribute("position",new On(r,3)),this.setAttribute("uv",new On(i,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(let t=0,r=e.length;t<r;t++){const r=e[t];n.shapes.push(r.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}const r=e.options.extrudePath;return void 0!==r&&(e.options.extrudePath=(new ja[r.type]).fromJSON(r)),new Ec(n,e.options)}}const bc={generateTopUV:function(e,t,n,r,i){const o=t[3*n],s=t[3*n+1],a=t[3*r],c=t[3*r+1],u=t[3*i],l=t[3*i+1];return[new Re(o,s),new Re(a,c),new Re(u,l)]},generateSideWallUV:function(e,t,n,r,i,o){const s=t[3*n],a=t[3*n+1],c=t[3*n+2],u=t[3*r],l=t[3*r+1],A=t[3*r+2],h=t[3*i],d=t[3*i+1],p=t[3*i+2],f=t[3*o],g=t[3*o+1],m=t[3*o+2];return Math.abs(a-l)<Math.abs(s-u)?[new Re(s,1-c),new Re(u,1-A),new Re(h,1-p),new Re(f,1-m)]:[new Re(a,1-c),new Re(l,1-A),new Re(d,1-p),new Re(g,1-m)]}};class wc extends ma{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2;super([-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new wc(e.radius,e.detail)}}class Sc extends Un{constructor(e=[new Re(0,.5),new Re(.5,0),new Re(0,-.5)],t=12,n=0,r=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:r},t=Math.floor(t),r=_e(r,0,2*Math.PI);const i=[],o=[],s=[],a=[],c=[],u=1/t,l=new et,A=new Re,h=new et,d=new et,p=new et;let f=0,g=0;for(let t=0;t<=e.length-1;t++)switch(t){case 0:f=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,h.x=1*g,h.y=-f,h.z=0*g,p.copy(h),h.normalize(),a.push(h.x,h.y,h.z);break;case e.length-1:a.push(p.x,p.y,p.z);break;default:f=e[t+1].x-e[t].x,g=e[t+1].y-e[t].y,h.x=1*g,h.y=-f,h.z=0*g,d.copy(h),h.x+=p.x,h.y+=p.y,h.z+=p.z,h.normalize(),a.push(h.x,h.y,h.z),p.copy(d)}for(let i=0;i<=t;i++){const h=n+i*u*r,d=Math.sin(h),p=Math.cos(h);for(let n=0;n<=e.length-1;n++){l.x=e[n].x*d,l.y=e[n].y,l.z=e[n].x*p,o.push(l.x,l.y,l.z),A.x=i/t,A.y=n/(e.length-1),s.push(A.x,A.y);const r=a[3*n+0]*d,u=a[3*n+1],h=a[3*n+0]*p;c.push(r,u,h)}}for(let n=0;n<t;n++)for(let t=0;t<e.length-1;t++){const r=t+n*e.length,o=r,s=r+e.length,a=r+e.length+1,c=r+1;i.push(o,s,c),i.push(a,c,s)}this.setIndex(i),this.setAttribute("position",new On(o,3)),this.setAttribute("uv",new On(s,2)),this.setAttribute("normal",new On(c,3))}static fromJSON(e){return new Sc(e.points,e.segments,e.phiStart,e.phiLength)}}class Tc extends ma{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Tc(e.radius,e.detail)}}class Cc extends Un{constructor(e=.5,t=1,n=8,r=1,i=0,o=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:r,thetaStart:i,thetaLength:o},n=Math.max(3,n);const s=[],a=[],c=[],u=[];let l=e;const A=(t-e)/(r=Math.max(1,r)),h=new et,d=new Re;for(let e=0;e<=r;e++){for(let e=0;e<=n;e++){const r=i+e/n*o;h.x=l*Math.cos(r),h.y=l*Math.sin(r),a.push(h.x,h.y,h.z),c.push(0,0,1),d.x=(h.x/t+1)/2,d.y=(h.y/t+1)/2,u.push(d.x,d.y)}l+=A}for(let e=0;e<r;e++){const t=e*(n+1);for(let e=0;e<n;e++){const r=e+t,i=r,o=r+n+1,a=r+n+2,c=r+1;s.push(i,o,c),s.push(o,a,c)}}this.setIndex(s),this.setAttribute("position",new On(a,3)),this.setAttribute("normal",new On(c,3)),this.setAttribute("uv",new On(u,2))}static fromJSON(e){return new Cc(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class Rc extends Un{constructor(e=new Wa([new Re(0,.5),new Re(-.5,-.5),new Re(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],r=[],i=[],o=[];let s=0,a=0;if(!1===Array.isArray(e))c(e);else for(let t=0;t<e.length;t++)c(e[t]),this.addGroup(s,a,t),s+=a,a=0;function c(e){const s=r.length/3,c=e.extractPoints(t);let u=c.shape;const l=c.holes;!1===vc.isClockWise(u)&&(u=u.reverse());for(let e=0,t=l.length;e<t;e++){const t=l[e];!0===vc.isClockWise(t)&&(l[e]=t.reverse())}const A=vc.triangulateShape(u,l);for(let e=0,t=l.length;e<t;e++){const t=l[e];u=u.concat(t)}for(let e=0,t=u.length;e<t;e++){const t=u[e];r.push(t.x,t.y,0),i.push(0,0,1),o.push(t.x,t.y)}for(let e=0,t=A.length;e<t;e++){const t=A[e],r=t[0]+s,i=t[1]+s,o=t[2]+s;n.push(r,i,o),a+=3}}this.setIndex(n),this.setAttribute("position",new On(r,3)),this.setAttribute("normal",new On(i,3)),this.setAttribute("uv",new On(o,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let n=0,r=e.length;n<r;n++){const r=e[n];t.shapes.push(r.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const n=[];for(let r=0,i=e.shapes.length;r<i;r++){const i=t[e.shapes[r]];n.push(i)}return new Rc(n,e.curveSegments)}}class Ic extends Un{constructor(e=1,t=32,n=16,r=0,i=2*Math.PI,o=0,s=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:r,phiLength:i,thetaStart:o,thetaLength:s},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const a=Math.min(o+s,Math.PI);let c=0;const u=[],l=new et,A=new et,h=[],d=[],p=[],f=[];for(let h=0;h<=n;h++){const g=[],m=h/n;let v=0;0==h&&0==o?v=.5/t:h==n&&a==Math.PI&&(v=-.5/t);for(let n=0;n<=t;n++){const a=n/t;l.x=-e*Math.cos(r+a*i)*Math.sin(o+m*s),l.y=e*Math.cos(o+m*s),l.z=e*Math.sin(r+a*i)*Math.sin(o+m*s),d.push(l.x,l.y,l.z),A.copy(l).normalize(),p.push(A.x,A.y,A.z),f.push(a+v,1-m),g.push(c++)}u.push(g)}for(let e=0;e<n;e++)for(let r=0;r<t;r++){const t=u[e][r+1],i=u[e][r],s=u[e+1][r],c=u[e+1][r+1];(0!==e||o>0)&&h.push(t,i,c),(e!==n-1||a<Math.PI)&&h.push(i,s,c)}this.setIndex(h),this.setAttribute("position",new On(d,3)),this.setAttribute("normal",new On(p,3)),this.setAttribute("uv",new On(f,2))}static fromJSON(e){return new Ic(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class Oc extends ma{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Oc(e.radius,e.detail)}}class xc extends Un{constructor(e=1,t=.4,n=8,r=6,i=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:r,arc:i},n=Math.floor(n),r=Math.floor(r);const o=[],s=[],a=[],c=[],u=new et,l=new et,A=new et;for(let o=0;o<=n;o++)for(let h=0;h<=r;h++){const d=h/r*i,p=o/n*Math.PI*2;l.x=(e+t*Math.cos(p))*Math.cos(d),l.y=(e+t*Math.cos(p))*Math.sin(d),l.z=t*Math.sin(p),s.push(l.x,l.y,l.z),u.x=e*Math.cos(d),u.y=e*Math.sin(d),A.subVectors(l,u).normalize(),a.push(A.x,A.y,A.z),c.push(h/r),c.push(o/n)}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*e+t-1,i=(r+1)*(e-1)+t-1,s=(r+1)*(e-1)+t,a=(r+1)*e+t;o.push(n,i,a),o.push(i,s,a)}this.setIndex(o),this.setAttribute("position",new On(s,3)),this.setAttribute("normal",new On(a,3)),this.setAttribute("uv",new On(c,2))}static fromJSON(e){return new xc(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class Nc extends Un{constructor(e=1,t=.4,n=64,r=8,i=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:r,p:i,q:o},n=Math.floor(n),r=Math.floor(r);const s=[],a=[],c=[],u=[],l=new et,A=new et,h=new et,d=new et,p=new et,f=new et,g=new et;for(let s=0;s<=n;++s){const v=s/n*i*Math.PI*2;m(v,i,o,e,h),m(v+.01,i,o,e,d),f.subVectors(d,h),g.addVectors(d,h),p.crossVectors(f,g),g.crossVectors(p,f),p.normalize(),g.normalize();for(let e=0;e<=r;++e){const i=e/r*Math.PI*2,o=-t*Math.cos(i),d=t*Math.sin(i);l.x=h.x+(o*g.x+d*p.x),l.y=h.y+(o*g.y+d*p.y),l.z=h.z+(o*g.z+d*p.z),a.push(l.x,l.y,l.z),A.subVectors(l,h).normalize(),c.push(A.x,A.y,A.z),u.push(s/n),u.push(e/r)}}for(let e=1;e<=n;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,a=(r+1)*(e-1)+t;s.push(n,i,a),s.push(i,o,a)}function m(e,t,n,r,i){const o=Math.cos(e),s=Math.sin(e),a=n/t*e,c=Math.cos(a);i.x=r*(2+c)*.5*o,i.y=r*(2+c)*s*.5,i.z=r*Math.sin(a)*.5}this.setIndex(s),this.setAttribute("position",new On(a,3)),this.setAttribute("normal",new On(c,3)),this.setAttribute("uv",new On(u,2))}static fromJSON(e){return new Nc(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class Bc extends Un{constructor(e=new Va(new et(-1,-1,0),new et(-1,1,0),new et(1,1,0)),t=64,n=1,r=8,i=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:r,closed:i};const o=e.computeFrenetFrames(t,i);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const s=new et,a=new et,c=new Re;let u=new et;const l=[],A=[],h=[],d=[];function p(i){u=e.getPointAt(i/t,u);const c=o.normals[i],h=o.binormals[i];for(let e=0;e<=r;e++){const t=e/r*Math.PI*2,i=Math.sin(t),o=-Math.cos(t);a.x=o*c.x+i*h.x,a.y=o*c.y+i*h.y,a.z=o*c.z+i*h.z,a.normalize(),A.push(a.x,a.y,a.z),s.x=u.x+n*a.x,s.y=u.y+n*a.y,s.z=u.z+n*a.z,l.push(s.x,s.y,s.z)}}!function(){for(let e=0;e<t;e++)p(e);p(!1===i?t:0),function(){for(let e=0;e<=t;e++)for(let n=0;n<=r;n++)c.x=e/t,c.y=n/r,h.push(c.x,c.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=r;t++){const n=(r+1)*(e-1)+(t-1),i=(r+1)*e+(t-1),o=(r+1)*e+t,s=(r+1)*(e-1)+t;d.push(n,i,s),d.push(i,o,s)}}()}(),this.setIndex(d),this.setAttribute("position",new On(l,3)),this.setAttribute("normal",new On(A,3)),this.setAttribute("uv",new On(h,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new Bc((new ja[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class Lc extends Un{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],n=new Set,r=new et,i=new et;if(null!==e.index){const o=e.attributes.position,s=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:s.count,materialIndex:0}]);for(let e=0,c=a.length;e<c;++e){const c=a[e],u=c.start;for(let e=u,a=u+c.count;e<a;e+=3)for(let a=0;a<3;a++){const c=s.getX(e+a),u=s.getX(e+(a+1)%3);r.fromBufferAttribute(o,c),i.fromBufferAttribute(o,u),!0===Dc(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}}else{const o=e.attributes.position;for(let e=0,s=o.count/3;e<s;e++)for(let s=0;s<3;s++){const a=3*e+s,c=3*e+(s+1)%3;r.fromBufferAttribute(o,a),i.fromBufferAttribute(o,c),!0===Dc(r,i,n)&&(t.push(r.x,r.y,r.z),t.push(i.x,i.y,i.z))}}this.setAttribute("position",new On(t,3))}}}function Dc(e,t,n){const r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,i=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==n.has(r)&&!0!==n.has(i)&&(n.add(r),n.add(i),!0)}var Mc=Object.freeze({__proto__:null,BoxGeometry:ir,BoxBufferGeometry:ir,CircleGeometry:pa,CircleBufferGeometry:pa,ConeGeometry:ga,ConeBufferGeometry:ga,CylinderGeometry:fa,CylinderBufferGeometry:fa,DodecahedronGeometry:va,DodecahedronBufferGeometry:va,EdgesGeometry:wa,ExtrudeGeometry:Ec,ExtrudeBufferGeometry:Ec,IcosahedronGeometry:wc,IcosahedronBufferGeometry:wc,LatheGeometry:Sc,LatheBufferGeometry:Sc,OctahedronGeometry:Tc,OctahedronBufferGeometry:Tc,PlaneGeometry:Sr,PlaneBufferGeometry:Sr,PolyhedronGeometry:ma,PolyhedronBufferGeometry:ma,RingGeometry:Cc,RingBufferGeometry:Cc,ShapeGeometry:Rc,ShapeBufferGeometry:Rc,SphereGeometry:Ic,SphereBufferGeometry:Ic,TetrahedronGeometry:Oc,TetrahedronBufferGeometry:Oc,TorusGeometry:xc,TorusBufferGeometry:xc,TorusKnotGeometry:Nc,TorusKnotBufferGeometry:Nc,TubeGeometry:Bc,TubeBufferGeometry:Bc,WireframeGeometry:Lc});class Pc extends gn{constructor(e){super(),this.type="ShadowMaterial",this.color=new Fe(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}Pc.prototype.isShadowMaterial=!0;class kc extends cr{constructor(e){super(e),this.type="RawShaderMaterial"}}kc.prototype.isRawShaderMaterial=!0;class Uc extends gn{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Fe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Re(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Uc.prototype.isMeshStandardMaterial=!0;class Fc extends Uc{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Re(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return _e(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new Fe(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Fe(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Fe(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}Fc.prototype.isMeshPhysicalMaterial=!0;class Hc extends gn{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Fe(16777215),this.specular=new Fe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Re(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}Hc.prototype.isMeshPhongMaterial=!0;class Vc extends gn{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Fe(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Re(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}Vc.prototype.isMeshToonMaterial=!0;class Qc extends gn{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Re(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}Qc.prototype.isMeshNormalMaterial=!0;class jc extends gn{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Fe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Fe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}jc.prototype.isMeshLambertMaterial=!0;class Gc extends gn{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Fe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Re(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}Gc.prototype.isMeshMatcapMaterial=!0;class Kc extends Ws{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}Kc.prototype.isLineDashedMaterial=!0;const Wc={ShadowMaterial:Pc,SpriteMaterial:ls,RawShaderMaterial:kc,ShaderMaterial:cr,PointsMaterial:ra,MeshPhysicalMaterial:Fc,MeshStandardMaterial:Uc,MeshPhongMaterial:Hc,MeshToonMaterial:Vc,MeshNormalMaterial:Qc,MeshLambertMaterial:jc,MeshDepthMaterial:jo,MeshDistanceMaterial:Go,MeshBasicMaterial:mn,MeshMatcapMaterial:Gc,LineDashedMaterial:Kc,LineBasicMaterial:Ws,Material:gn};gn.fromType=function(e){return new Wc[e]};const zc={arraySlice:function(e,t,n){return zc.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,n=new Array(t);for(let e=0;e!==t;++e)n[e]=e;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){const r=e.length,i=new e.constructor(r);for(let o=0,s=0;s!==r;++o){const r=n[o]*t;for(let n=0;n!==t;++n)i[s++]=e[r+n]}return i},flattenJSON:function(e,t,n,r){let i=1,o=e[0];for(;void 0!==o&&void 0===o[r];)o=e[i++];if(void 0===o)return;let s=o[r];if(void 0!==s)if(Array.isArray(s))do{s=o[r],void 0!==s&&(t.push(o.time),n.push.apply(n,s)),o=e[i++]}while(void 0!==o);else if(void 0!==s.toArray)do{s=o[r],void 0!==s&&(t.push(o.time),s.toArray(n,n.length)),o=e[i++]}while(void 0!==o);else do{s=o[r],void 0!==s&&(t.push(o.time),n.push(s)),o=e[i++]}while(void 0!==o)},subclip:function(e,t,n,r,i=30){const o=e.clone();o.name=t;const s=[];for(let e=0;e<o.tracks.length;++e){const t=o.tracks[e],a=t.getValueSize(),c=[],u=[];for(let e=0;e<t.times.length;++e){const o=t.times[e]*i;if(!(o<n||o>=r)){c.push(t.times[e]);for(let n=0;n<a;++n)u.push(t.values[e*a+n])}}0!==c.length&&(t.times=zc.convertArray(c,t.times.constructor),t.values=zc.convertArray(u,t.values.constructor),s.push(t))}o.tracks=s;let a=1/0;for(let e=0;e<o.tracks.length;++e)a>o.tracks[e].times[0]&&(a=o.tracks[e].times[0]);for(let e=0;e<o.tracks.length;++e)o.tracks[e].shift(-1*a);return o.resetDuration(),o},makeClipAdditive:function(e,t=0,n=e,r=30){r<=0&&(r=30);const i=n.tracks.length,o=t/r;for(let t=0;t<i;++t){const r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)continue;const s=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===s)continue;let a=0;const c=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=c/3);let u=0;const l=s.getValueSize();s.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=l/3);const A=r.times.length-1;let h;if(o<=r.times[0]){const e=a,t=c-a;h=zc.arraySlice(r.values,e,t)}else if(o>=r.times[A]){const e=A*c+a,t=e+c-a;h=zc.arraySlice(r.values,e,t)}else{const e=r.createInterpolant(),t=a,n=c-a;e.evaluate(o),h=zc.arraySlice(e.resultBuffer,t,n)}if("quaternion"===i){(new $e).fromArray(h).normalize().conjugate().toArray(h)}const d=s.times.length;for(let e=0;e<d;++e){const t=e*l+u;if("quaternion"===i)$e.multiplyQuaternionsFlat(s.values,t,h,0,s.values,t);else{const e=l-2*u;for(let n=0;n<e;++n)s.values[t+n]-=h[n]}}}return e.blendMode=se,e}};class qc{constructor(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<r)){for(let o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,r=t[++n],e<r)break t}o=t.length;break n}if(e>=i)break e;{const s=t[1];e<s&&(n=2,i=s);for(let o=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===o)break;if(r=i,i=t[--n-1],e>=i)break t}o=n,n=0}}for(;n<o;){const r=n+o>>>1;e<t[r]?o=r:n=r+1}if(r=t[n],i=t[n-1],void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r;for(let e=0;e!==r;++e)t[e]=n[i+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}qc.prototype.beforeStart_=qc.prototype.copySampleValue_,qc.prototype.afterEnd_=qc.prototype.copySampleValue_;class Yc extends qc{constructor(e,t,n,r){super(e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ne,endingEnd:ne}}intervalChanged_(e,t,n){const r=this.parameterPositions;let i=e-2,o=e+1,s=r[i],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case re:i=e,s=2*t-n;break;case ie:i=r.length-2,s=t+r[i]-r[i+1];break;default:i=e,s=n}if(void 0===a)switch(this.getSettings_().endingEnd){case re:o=e,a=2*n-t;break;case ie:o=1,a=n+r[1]-r[0];break;default:o=e-1,a=t}const c=.5*(n-t),u=this.valueSize;this._weightPrev=c/(t-s),this._weightNext=c/(a-n),this._offsetPrev=i*u,this._offsetNext=o*u}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,u=this._offsetPrev,l=this._offsetNext,A=this._weightPrev,h=this._weightNext,d=(n-t)/(r-t),p=d*d,f=p*d,g=-A*f+2*A*p-A*d,m=(1+A)*f+(-1.5-2*A)*p+(-.5+A)*d+1,v=(-1-h)*f+(1.5+h)*p+.5*d,y=h*f-h*p;for(let e=0;e!==s;++e)i[e]=g*o[u+e]+m*o[c+e]+v*o[a+e]+y*o[l+e];return i}}class Xc extends qc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,u=(n-t)/(r-t),l=1-u;for(let e=0;e!==s;++e)i[e]=o[c+e]*l+o[a+e]*u;return i}}class Jc extends qc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Zc{constructor(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=zc.convertArray(t,this.TimeBufferType),this.values=zc.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:zc.convertArray(e.times,Array),values:zc.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(n.interpolation=t)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new Jc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new Xc(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Yc(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case $:t=this.InterpolantFactoryMethodDiscrete;break;case ee:t=this.InterpolantFactoryMethodLinear;break;case te:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return $;case this.InterpolantFactoryMethodLinear:return ee;case this.InterpolantFactoryMethodSmooth:return te}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let n=0,r=t.length;n!==r;++n)t[n]*=e}return this}trim(e,t){const n=this.times,r=n.length;let i=0,o=r-1;for(;i!==r&&n[i]<e;)++i;for(;-1!==o&&n[o]>t;)--o;if(++o,0!==i||o!==r){i>=o&&(o=Math.max(o,1),i=o-1);const e=this.getValueSize();this.times=zc.arraySlice(n,i,o),this.values=zc.arraySlice(this.values,i*e,o*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let t=0;t!==i;t++){const r=n[t];if("number"==typeof r&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,r),e=!1;break}if(null!==o&&o>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,r,o),e=!1;break}o=r}if(void 0!==r&&zc.isTypedArray(r))for(let t=0,n=r.length;t!==n;++t){const n=r[t];if(isNaN(n)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,n),e=!1;break}}return e}optimize(){const e=zc.arraySlice(this.times),t=zc.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===te,i=e.length-1;let o=1;for(let s=1;s<i;++s){let i=!1;const a=e[s];if(a!==e[s+1]&&(1!==s||a!==e[0]))if(r)i=!0;else{const e=s*n,r=e-n,o=e+n;for(let s=0;s!==n;++s){const n=t[e+s];if(n!==t[r+s]||n!==t[o+s]){i=!0;break}}}if(i){if(s!==o){e[o]=e[s];const r=s*n,i=o*n;for(let e=0;e!==n;++e)t[i+e]=t[r+e]}++o}}if(i>0){e[o]=e[i];for(let e=i*n,r=o*n,s=0;s!==n;++s)t[r+s]=t[e+s];++o}return o!==e.length?(this.times=zc.arraySlice(e,0,o),this.values=zc.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){const e=zc.arraySlice(this.times,0),t=zc.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}Zc.prototype.TimeBufferType=Float32Array,Zc.prototype.ValueBufferType=Float32Array,Zc.prototype.DefaultInterpolation=ee;class $c extends Zc{}$c.prototype.ValueTypeName="bool",$c.prototype.ValueBufferType=Array,$c.prototype.DefaultInterpolation=$,$c.prototype.InterpolantFactoryMethodLinear=void 0,$c.prototype.InterpolantFactoryMethodSmooth=void 0;class eu extends Zc{}eu.prototype.ValueTypeName="color";class tu extends Zc{}tu.prototype.ValueTypeName="number";class nu extends qc{constructor(e,t,n,r){super(e,t,n,r)}interpolate_(e,t,n,r){const i=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=(n-t)/(r-t);let c=e*s;for(let e=c+s;c!==e;c+=4)$e.slerpFlat(i,0,o,c-s,o,c,a);return i}}class ru extends Zc{InterpolantFactoryMethodLinear(e){return new nu(this.times,this.values,this.getValueSize(),e)}}ru.prototype.ValueTypeName="quaternion",ru.prototype.DefaultInterpolation=ee,ru.prototype.InterpolantFactoryMethodSmooth=void 0;class iu extends Zc{}iu.prototype.ValueTypeName="string",iu.prototype.ValueBufferType=Array,iu.prototype.DefaultInterpolation=$,iu.prototype.InterpolantFactoryMethodLinear=void 0,iu.prototype.InterpolantFactoryMethodSmooth=void 0;class ou extends Zc{}ou.prototype.ValueTypeName="vector";class su{constructor(e,t=-1,n,r=2500){this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=ye(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,r=1/(e.fps||1);for(let e=0,i=n.length;e!==i;++e)t.push(au(n[e]).scale(r));const i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){const t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,r=n.length;e!==r;++e)t.push(Zc.toJSON(n[e]));return r}static CreateFromMorphTargetSequence(e,t,n,r){const i=t.length,o=[];for(let e=0;e<i;e++){let s=[],a=[];s.push((e+i-1)%i,e,(e+1)%i),a.push(0,1,0);const c=zc.getKeyframeOrder(s);s=zc.sortedArray(s,1,c),a=zc.sortedArray(a,1,c),r||0!==s[0]||(s.push(i),a.push(a[0])),o.push(new tu(".morphTargetInfluences["+t[e].name+"]",s,a).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const t=e;n=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<n.length;e++)if(n[e].name===t)return n[e];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const r={},i=/^([\w-]*?)([\d]+)$/;for(let t=0,n=e.length;t<n;t++){const n=e[t],o=n.name.match(i);if(o&&o.length>1){const e=o[1];let t=r[e];t||(r[e]=t=[]),t.push(n)}}const o=[];for(const e in r)o.push(this.CreateFromMorphTargetSequence(e,r[e],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(e,t,n,r,i){if(0!==n.length){const o=[],s=[];zc.flattenJSON(n,o,s,r),0!==o.length&&i.push(new e(t,o,s))}},r=[],i=e.name||"default",o=e.fps||30,s=e.blendMode;let a=e.length||-1;const c=e.hierarchy||[];for(let e=0;e<c.length;e++){const i=c[e].keys;if(i&&0!==i.length)if(i[0].morphTargets){const e={};let t;for(t=0;t<i.length;t++)if(i[t].morphTargets)for(let n=0;n<i[t].morphTargets.length;n++)e[i[t].morphTargets[n]]=-1;for(const n in e){const e=[],o=[];for(let r=0;r!==i[t].morphTargets.length;++r){const r=i[t];e.push(r.time),o.push(r.morphTarget===n?1:0)}r.push(new tu(".morphTargetInfluence["+n+"]",e,o))}a=e.length*o}else{const o=".bones["+t[e].name+"]";n(ou,o+".position",i,"pos",r),n(ru,o+".quaternion",i,"rot",r),n(ou,o+".scale",i,"scl",r)}}if(0===r.length)return null;return new this(i,a,r,s)}resetDuration(){let e=0;for(let t=0,n=this.tracks.length;t!==n;++t){const n=this.tracks[t];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function au(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return tu;case"vector":case"vector2":case"vector3":case"vector4":return ou;case"color":return eu;case"quaternion":return ru;case"bool":case"boolean":return $c;case"string":return iu}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],n=[];zc.flattenJSON(e.keys,t,n,"value"),e.times=t,e.values=n}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const cu={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class uu{constructor(e,t,n){const r=this;let i,o=!1,s=0,a=0;const c=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){a++,!1===o&&void 0!==r.onStart&&r.onStart(e,s,a),o=!0},this.itemEnd=function(e){s++,void 0!==r.onProgress&&r.onProgress(e,s,a),s===a&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return i?i(e):e},this.setURLModifier=function(e){return i=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){const t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(let t=0,n=c.length;t<n;t+=2){const n=c[t],r=c[t+1];if(n.global&&(n.lastIndex=0),n.test(e))return r}return null}}}const lu=new uu;class Au{constructor(e){this.manager=void 0!==e?e:lu,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const hu={};class du extends Au{constructor(e){super(e)}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=cu.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout((()=>{t&&t(i),this.manager.itemEnd(e)}),0),i;if(void 0!==hu[e])return void hu[e].push({onLoad:t,onProgress:n,onError:r});hu[e]=[],hu[e].push({onLoad:t,onProgress:n,onError:r});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,a=this.responseType;fetch(o).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;const n=hu[e],r=t.body.getReader(),i=t.headers.get("Content-Length"),o=i?parseInt(i):0,s=0!==o;let a=0;const c=new ReadableStream({start(e){!function t(){r.read().then((({done:r,value:i})=>{if(r)e.close();else{a+=i.byteLength;const r=new ProgressEvent("progress",{lengthComputable:s,loaded:a,total:o});for(let e=0,t=n.length;e<t;e++){const t=n[e];t.onProgress&&t.onProgress(r)}e.enqueue(i),t()}}))}()}});return new Response(c)}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)})).then((e=>{switch(a){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,s)));case"json":return e.json();default:if(void 0===s)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((e=>r.decode(e)))}}})).then((t=>{cu.add(e,t);const n=hu[e];delete hu[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onLoad&&r.onLoad(t)}})).catch((t=>{const n=hu[e];if(void 0===n)throw this.manager.itemError(e),t;delete hu[e];for(let e=0,r=n.length;e<r;e++){const r=n[e];r.onError&&r.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class pu extends Au{constructor(e){super(e)}load(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=cu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s=Be("img");function a(){u(),cu.add(e,this),t&&t(this),i.manager.itemEnd(e)}function c(t){u(),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}function u(){s.removeEventListener("load",a,!1),s.removeEventListener("error",c,!1)}return s.addEventListener("load",a,!1),s.addEventListener("error",c,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),i.manager.itemStart(e),s.src=e,s}}class fu extends Au{constructor(e){super(e)}load(e,t,n,r){const i=new dr,o=new pu(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let s=0;function a(n){o.load(e[n],(function(e){i.images[n]=e,s++,6===s&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(let t=0;t<e.length;++t)a(t);return i}}class gu extends Au{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new Ps,s=new du(this.manager);return s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setPath(this.path),s.setWithCredentials(i.withCredentials),s.load(e,(function(e){const n=i.parse(e);n&&(void 0!==n.image?o.image=n.image:void 0!==n.data&&(o.image.width=n.width,o.image.height=n.height,o.image.data=n.data),o.wrapS=void 0!==n.wrapS?n.wrapS:A,o.wrapT=void 0!==n.wrapT?n.wrapT:A,o.magFilter=void 0!==n.magFilter?n.magFilter:g,o.minFilter=void 0!==n.minFilter?n.minFilter:g,o.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(o.encoding=n.encoding),void 0!==n.flipY&&(o.flipY=n.flipY),void 0!==n.format&&(o.format=n.format),void 0!==n.type&&(o.type=n.type),void 0!==n.mipmaps&&(o.mipmaps=n.mipmaps,o.minFilter=v),1===n.mipmapCount&&(o.minFilter=g),void 0!==n.generateMipmaps&&(o.generateMipmaps=n.generateMipmaps),o.needsUpdate=!0,t&&t(o,n))}),n,r),o}}class mu extends Au{constructor(e){super(e)}load(e,t,n,r){const i=new Ke,o=new pu(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(e){i.image=e,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}class vu extends nn{constructor(e,t=1){super(),this.type="Light",this.color=new Fe(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}vu.prototype.isLight=!0;class yu extends vu{constructor(e,t,n){super(e,n),this.type="HemisphereLight",this.position.copy(nn.DefaultUp),this.updateMatrix(),this.groundColor=new Fe(t)}copy(e){return vu.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}yu.prototype.isHemisphereLight=!0;const _u=new Nt,Eu=new et,bu=new et;class wu{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Re(512,512),this.map=null,this.mapPass=null,this.matrix=new Nt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Er,this._frameExtents=new Re(1,1),this._viewportCount=1,this._viewports=[new We(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;Eu.setFromMatrixPosition(e.matrixWorld),t.position.copy(Eu),bu.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(bu),t.updateMatrixWorld(),_u.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_u),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class Su extends wu{constructor(){super(new lr(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,n=2*ve*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}Su.prototype.isSpotLightShadow=!0;class Tu extends vu{constructor(e,t,n=0,r=Math.PI/3,i=0,o=1){super(e,t),this.type="SpotLight",this.position.copy(nn.DefaultUp),this.updateMatrix(),this.target=new nn,this.distance=n,this.angle=r,this.penumbra=i,this.decay=o,this.shadow=new Su}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Tu.prototype.isSpotLight=!0;const Cu=new Nt,Ru=new et,Iu=new et;class Ou extends wu{constructor(){super(new lr(90,1,.5,500)),this._frameExtents=new Re(4,2),this._viewportCount=6,this._viewports=[new We(2,1,1,1),new We(0,1,1,1),new We(3,1,1,1),new We(1,1,1,1),new We(3,0,1,1),new We(1,0,1,1)],this._cubeDirections=[new et(1,0,0),new et(-1,0,0),new et(0,0,1),new et(0,0,-1),new et(0,1,0),new et(0,-1,0)],this._cubeUps=[new et(0,1,0),new et(0,1,0),new et(0,1,0),new et(0,1,0),new et(0,0,1),new et(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,r=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),Ru.setFromMatrixPosition(e.matrixWorld),n.position.copy(Ru),Iu.copy(n.position),Iu.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(Iu),n.updateMatrixWorld(),r.makeTranslation(-Ru.x,-Ru.y,-Ru.z),Cu.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Cu)}}Ou.prototype.isPointLightShadow=!0;class xu extends vu{constructor(e,t,n=0,r=1){super(e,t),this.type="PointLight",this.distance=n,this.decay=r,this.shadow=new Ou}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}xu.prototype.isPointLight=!0;class Nu extends wu{constructor(){super(new Dr(-5,5,5,-5,.5,500))}}Nu.prototype.isDirectionalLightShadow=!0;class Bu extends vu{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(nn.DefaultUp),this.updateMatrix(),this.target=new nn,this.shadow=new Nu}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}Bu.prototype.isDirectionalLight=!0;class Lu extends vu{constructor(e,t){super(e,t),this.type="AmbientLight"}}Lu.prototype.isAmbientLight=!0;class Du extends vu{constructor(e,t,n=10,r=10){super(e,t),this.type="RectAreaLight",this.width=n,this.height=r}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}Du.prototype.isRectAreaLight=!0;class Mu{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new et)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*r),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],n*r*1.092548),t.addScaledVector(o[5],r*i*1.092548),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],n*i*1.092548),t.addScaledVector(o[8],.546274*(n*n-r*r)),t}getIrradianceAt(e,t){const n=e.x,r=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],1.023328*r),t.addScaledVector(o[2],1.023328*i),t.addScaledVector(o[3],1.023328*n),t.addScaledVector(o[4],.858086*n*r),t.addScaledVector(o[5],.858086*r*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],.858086*n*i),t.addScaledVector(o[8],.429043*(n*n-r*r)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}toArray(e=[],t=0){const n=this.coefficients;for(let r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}static getBasisAt(e,t){const n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}Mu.prototype.isSphericalHarmonics3=!0;class Pu extends vu{constructor(e=new Mu,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}Pu.prototype.isLightProbe=!0;class ku extends Au{constructor(e){super(e),this.textures={}}load(e,t,n,r){const i=this,o=new du(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const r=gn.fromType(e.type);if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=e.sheen),void 0!==e.sheenColor&&(r.sheenColor=(new Fe).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(r.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.specularIntensity&&(r.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==r.specularColor&&r.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.thickness&&(r.thickness=e.thickness),void 0!==e.attenuationDistance&&(r.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==r.attenuationColor&&r.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.shadowSide&&(r.shadowSide=e.shadowSide),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.alphaToCoverage&&(r.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(r.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const i=e.uniforms[t];switch(r.uniforms[t]={},i.type){case"t":r.uniforms[t].value=n(i.value);break;case"c":r.uniforms[t].value=(new Fe).setHex(i.value);break;case"v2":r.uniforms[t].value=(new Re).fromArray(i.value);break;case"v3":r.uniforms[t].value=(new et).fromArray(i.value);break;case"v4":r.uniforms[t].value=(new We).fromArray(i.value);break;case"m3":r.uniforms[t].value=(new Ie).fromArray(i.value);break;case"m4":r.uniforms[t].value=(new Nt).fromArray(i.value);break;default:r.uniforms[t].value=i.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)r.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),r.normalScale=(new Re).fromArray(t)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.specularIntensityMap&&(r.specularIntensityMap=n(e.specularIntensityMap)),void 0!==e.specularColorMap&&(r.specularColorMap=n(e.specularColorMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new Re).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),void 0!==e.thicknessMap&&(r.thicknessMap=n(e.thicknessMap)),void 0!==e.sheenColorMap&&(r.sheenColorMap=n(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(r.sheenRoughnessMap=n(e.sheenRoughnessMap)),r}setTextures(e){return this.textures=e,this}}class Uu{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class Fu extends Un{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}Fu.prototype.isInstancedBufferGeometry=!0;class Hu extends Au{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new du(i.manager);o.setPath(i.path),o.setRequestHeader(i.requestHeader),o.setWithCredentials(i.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t={},n={};function r(e,r){if(void 0!==t[r])return t[r];const i=e.interleavedBuffers[r],o=function(e,t){if(void 0!==n[t])return n[t];const r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),s=Ne(i.type,o),a=new as(s,i.stride);return a.uuid=i.uuid,t[r]=a,a}const i=e.isInstancedBufferGeometry?new Fu:new Un,o=e.data.index;if(void 0!==o){const e=Ne(o.type,o.array);i.setIndex(new _n(e,1))}const s=e.data.attributes;for(const t in s){const n=s[t];let o;if(n.isInterleavedBufferAttribute){const t=r(e.data,n.data);o=new us(t,n.itemSize,n.offset,n.normalized)}else{const e=Ne(n.type,n.array);o=new(n.isInstancedBufferAttribute?Hs:_n)(e,n.itemSize,n.normalized)}void 0!==n.name&&(o.name=n.name),void 0!==n.usage&&o.setUsage(n.usage),void 0!==n.updateRange&&(o.updateRange.offset=n.updateRange.offset,o.updateRange.count=n.updateRange.count),i.setAttribute(t,o)}const a=e.data.morphAttributes;if(a)for(const t in a){const n=a[t],o=[];for(let t=0,i=n.length;t<i;t++){const i=n[t];let s;if(i.isInterleavedBufferAttribute){const t=r(e.data,i.data);s=new us(t,i.itemSize,i.offset,i.normalized)}else{const e=Ne(i.type,i.array);s=new _n(e,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),o.push(s)}i.morphAttributes[t]=o}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);const c=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==c)for(let e=0,t=c.length;e!==t;++e){const t=c[e];i.addGroup(t.start,t.count,t.materialIndex)}const u=e.data.boundingSphere;if(void 0!==u){const e=new et;void 0!==u.center&&e.fromArray(u.center),i.boundingSphere=new bt(e,u.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}}const Vu={UVMapping:r,CubeReflectionMapping:i,CubeRefractionMapping:o,EquirectangularReflectionMapping:s,EquirectangularRefractionMapping:a,CubeUVReflectionMapping:c,CubeUVRefractionMapping:u},Qu={RepeatWrapping:l,ClampToEdgeWrapping:A,MirroredRepeatWrapping:h},ju={NearestFilter:d,NearestMipmapNearestFilter:p,NearestMipmapLinearFilter:f,LinearFilter:g,LinearMipmapNearestFilter:m,LinearMipmapLinearFilter:v};class Gu extends Au{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const i=this,o=cu.get(e);if(void 0!==o)return i.manager.itemStart(e),setTimeout((function(){t&&t(o),i.manager.itemEnd(e)}),0),o;const s={};s.credentials="anonymous"===this.crossOrigin?"same-origin":"include",s.headers=this.requestHeader,fetch(e,s).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(i.options,{colorSpaceConversion:"none"}))})).then((function(n){cu.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}let Ku;Gu.prototype.isImageBitmapLoader=!0;const Wu={getContext:function(){return void 0===Ku&&(Ku=new(window.AudioContext||window.webkitAudioContext)),Ku},setContext:function(e){Ku=e}};class zu extends Au{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new du(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{const e=n.slice(0);Wu.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}}class qu extends Pu{constructor(e,t,n=1){super(void 0,n);const r=(new Fe).set(e),i=(new Fe).set(t),o=new et(r.r,r.g,r.b),s=new et(i.r,i.g,i.b),a=Math.sqrt(Math.PI),c=a*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(s).multiplyScalar(a),this.sh.coefficients[1].copy(o).sub(s).multiplyScalar(c)}}qu.prototype.isHemisphereLightProbe=!0;class Yu extends Pu{constructor(e,t=1){super(void 0,t);const n=(new Fe).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}}Yu.prototype.isAmbientLightProbe=!0;const Xu=new Nt,Ju=new Nt,Zu=new Nt;class $u{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=el(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=el();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function el(){return("undefined"==typeof performance?Date:performance).now()}const tl=new et,nl=new $e,rl=new et,il=new et;class ol extends nn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const sl=new et,al=new $e,cl=new et,ul=new et;class ll{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class Al{constructor(e,t,n){let r,i,o;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,r=this.valueSize,i=e*r+r;let o=this.cumulativeWeight;if(0===o){for(let e=0;e!==r;++e)n[i+e]=n[e];o=t}else{o+=t;const e=t/o;this._mixBufferRegion(n,i,0,e,r)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,s=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){const e=t*this._origIndex;this._mixBufferRegion(n,r,e,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(let e=t,i=t+t;e!==i;++e)if(n[e]!==n[e+t]){s.setValue(n,r);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(let e=n,i=r;e!==i;++e)t[e]=t[r+e%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,r,i){if(r>=.5)for(let r=0;r!==i;++r)e[t+r]=e[n+r]}_slerp(e,t,n,r){$e.slerpFlat(e,t,e,t,e,n,r)}_slerpAdditive(e,t,n,r,i){const o=this._workIndex*i;$e.multiplyQuaternionsFlat(e,o,e,t,e,n),$e.slerpFlat(e,t,e,t,e,o,r)}_lerp(e,t,n,r,i){const o=1-r;for(let s=0;s!==i;++s){const i=t+s;e[i]=e[i]*o+e[n+s]*r}}_lerpAdditive(e,t,n,r,i){for(let o=0;o!==i;++o){const i=t+o;e[i]=e[i]+e[n+o]*r}}}const hl="\\[\\]\\.:\\/",dl=new RegExp("[\\[\\]\\.:\\/]","g"),pl="[^\\[\\]\\.:\\/]",fl="[^"+hl.replace("\\.","")+"]",gl=/((?:WC+[\/:])*)/.source.replace("WC",pl),ml=/(WCOD+)?/.source.replace("WCOD",fl),vl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pl),yl=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pl),_l=new RegExp("^"+gl+ml+vl+yl+"$"),El=["material","materials","bones"];class bl{constructor(e,t,n){this.path=t,this.parsedPath=n||bl.parseTrackName(t),this.node=bl.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new bl.Composite(e,t,n):new bl(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(dl,"")}static parseTrackName(e){const t=_l.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const e=n.nodeName.substring(r+1);-1!==El.indexOf(e)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=e)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){const n=function(e){for(let r=0;r<e.length;r++){const i=e[r];if(i.name===t||i.uuid===t)return i;const o=n(i.children);if(o)return o}return null},r=n(e.children);if(r)return r}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)e[t++]=n[r]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,r=t.propertyName;let i=t.propertyIndex;if(e||(e=bl.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===r){r=t;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==r){if(void 0===e[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[r]}}const o=e[r];if(void 0===o){const n=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",e)}let s=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?s=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(s=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}a=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else void 0!==o.fromArray&&void 0!==o.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(a=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=r;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][s]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}bl.Composite=class{constructor(e,t,n){const r=n||bl.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},bl.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},bl.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},bl.prototype.GetterByBindingType=[bl.prototype._getValue_direct,bl.prototype._getValue_array,bl.prototype._getValue_arrayElement,bl.prototype._getValue_toArray],bl.prototype.SetterByBindingTypeAndVersioning=[[bl.prototype._setValue_direct,bl.prototype._setValue_direct_setNeedsUpdate,bl.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[bl.prototype._setValue_array,bl.prototype._setValue_array_setNeedsUpdate,bl.prototype._setValue_array_setMatrixWorldNeedsUpdate],[bl.prototype._setValue_arrayElement,bl.prototype._setValue_arrayElement_setNeedsUpdate,bl.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[bl.prototype._setValue_fromArray,bl.prototype._setValue_fromArray_setNeedsUpdate,bl.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class wl{constructor(){this.uuid=ye(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,o=i.length;let s,a=e.length,c=this.nCachedObjects_;for(let u=0,l=arguments.length;u!==l;++u){const l=arguments[u],A=l.uuid;let h=t[A];if(void 0===h){h=a++,t[A]=h,e.push(l);for(let e=0,t=o;e!==t;++e)i[e].push(new bl(l,n[e],r[e]))}else if(h<c){s=e[h];const a=--c,u=e[a];t[u.uuid]=h,e[h]=u,t[A]=a,e[a]=l;for(let e=0,t=o;e!==t;++e){const t=i[e],o=t[a];let s=t[h];t[h]=o,void 0===s&&(s=new bl(l,n[e],r[e])),t[a]=s}}else e[h]!==s&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=c}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_;for(let o=0,s=arguments.length;o!==s;++o){const s=arguments[o],a=s.uuid,c=t[a];if(void 0!==c&&c>=i){const o=i++,u=e[o];t[u.uuid]=c,e[c]=u,t[a]=o,e[o]=s;for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[o],i=t[c];t[c]=r,t[o]=i}}}this.nCachedObjects_=i}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length;let i=this.nCachedObjects_,o=e.length;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s].uuid,c=t[a];if(void 0!==c)if(delete t[a],c<i){const s=--i,a=e[s],u=--o,l=e[u];t[a.uuid]=c,e[c]=a,t[l.uuid]=s,e[s]=l,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e],r=t[s],i=t[u];t[c]=r,t[s]=i,t.pop()}}else{const i=--o,s=e[i];i>0&&(t[s.uuid]=c),e[c]=s,e.pop();for(let e=0,t=r;e!==t;++e){const t=n[e];t[c]=t[i],t.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){const n=this._bindingsIndicesByPath;let r=n[e];const i=this._bindings;if(void 0!==r)return i[r];const o=this._paths,s=this._parsedPaths,a=this._objects,c=a.length,u=this.nCachedObjects_,l=new Array(c);r=i.length,n[e]=r,o.push(e),s.push(t),i.push(l);for(let n=u,r=a.length;n!==r;++n){const r=a[n];l[n]=new bl(r,e,t)}return l}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){const r=this._paths,i=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=n,o[n]=a,o.pop(),i[n]=i[s],i.pop(),r[n]=r[s],r.pop()}}}wl.prototype.isAnimationObjectGroup=!0;class Sl{constructor(e,t,n=null,r=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=r;const i=t.tracks,o=i.length,s=new Array(o),a={endingStart:ne,endingEnd:ne};for(let e=0;e!==o;++e){const t=i[e].createInterpolant(null);s[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){const n=this._clip.duration,r=e._clip.duration,i=r/n,o=n/r;e.warp(1,i,t),this.warp(o,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const r=this._mixer,i=r.time,o=this.timeScale;let s=this._timeScaleInterpolant;null===s&&(s=r._lendControlInterpolant(),this._timeScaleInterpolant=s);const a=s.parameterPositions,c=s.sampleValues;return a[0]=i,a[1]=i+n,c[0]=e/o,c[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,r){if(!this.enabled)return void this._updateWeight(e);const i=this._startTime;if(null!==i){const r=(e-i)*n;if(r<0||0===n)return;this._startTime=null,t=n*r}t*=this._updateTimeScale(e);const o=this._updateTime(t),s=this._updateWeight(e);if(s>0){const e=this._interpolants,t=this._propertyBindings;if(this.blendMode===se)for(let n=0,r=e.length;n!==r;++n)e[n].evaluate(o),t[n].accumulateAdditive(s);else for(let n=0,i=e.length;n!==i;++n)e[n].evaluate(o),t[n].accumulate(r,s)}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(null!==n){const r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(null!==n){t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let r=this.time+e,i=this._loopCount;const o=2202===n;if(0===e)return-1===i?r:o&&1==(1&i)?t-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),r>=t||r<0){const n=Math.floor(r/t);r-=t*n,i+=Math.abs(n);const s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){const t=e<0;this._setEndings(t,!t,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=r;if(o&&1==(1&i))return t-r}return r}_setEndings(e,t,n){const r=this._interpolantSettings;n?(r.endingStart=re,r.endingEnd=re):(r.endingStart=e?this.zeroSlopeAtStart?re:ne:ie,r.endingEnd=t?this.zeroSlopeAtEnd?re:ne:ie)}_scheduleFading(e,t,n){const r=this._mixer,i=r.time;let o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);const s=o.parameterPositions,a=o.sampleValues;return s[0]=i,a[0]=t,s[1]=i+e,a[1]=n,this}}class Tl extends pe{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,o=e._propertyBindings,s=e._interpolants,a=n.uuid,c=this._bindingsByRootAndName;let u=c[a];void 0===u&&(u={},c[a]=u);for(let e=0;e!==i;++e){const i=r[e],c=i.name;let l=u[c];if(void 0!==l)++l.referenceCount,o[e]=l;else{if(l=o[e],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,c));continue}const r=t&&t._propertyBindings[e].binding.parsedPath;l=new Al(bl.create(n,c,r),i.ValueTypeName,i.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,c),o[e]=l}s[e].resultBuffer=l.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==n.useCount++&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,n){const r=this._actions,i=this._actionsByClip;let o=i[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{const t=o.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;const i=e._clip.uuid,o=this._actionsByClip,s=o[i],a=s.knownActions,c=a[a.length-1],u=e._byClipCacheIndex;c._byClipCacheIndex=u,a[u]=c,a.pop(),e._byClipCacheIndex=null;delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,n=t.length;e!==n;++e){const n=t[e];0==--n.referenceCount&&this._removeInactiveBinding(n)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){const r=this._bindingsByRootAndName,i=this._bindings;let o=r[t];void 0===o&&(o={},r[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,s=o[r],a=t[t.length-1],c=e._cacheIndex;a._cacheIndex=c,t[c]=a,t.pop(),delete s[i],0===Object.keys(s).length&&delete o[r]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return void 0===n&&(n=new Xc(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){const r=t||this._root,i=r.uuid;let o="string"==typeof e?su.findByName(r,e):e;const s=null!==o?o.uuid:e,a=this._actionsByClip[s];let c=null;if(void 0===n&&(n=null!==o?o.blendMode:oe),void 0!==a){const e=a.actionByRoot[i];if(void 0!==e&&e.blendMode===n)return e;c=a.knownActions[0],null===o&&(o=c._clip)}if(null===o)return null;const u=new Sl(this,o,t,n);return this._bindAction(u,c),this._addInactiveAction(u,s,i),u}existingAction(e,t){const n=t||this._root,r=n.uuid,i="string"==typeof e?su.findByName(n,e):e,o=i?i.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let s=0;s!==n;++s){t[s]._update(r,e,i,o)}const s=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)s[e].apply(o);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){const e=i.knownActions;for(let n=0,r=e.length;n!==r;++n){const r=e[n];this._deactivateAction(r);const i=r._cacheIndex,o=t[t.length-1];r._cacheIndex=null,r._byClipCacheIndex=null,o._cacheIndex=i,t[i]=o,t.pop(),this._removeInactiveBindingsForAction(r)}delete r[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const e in n){const r=n[e].actionByRoot[t];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[t];if(void 0!==r)for(const e in r){const t=r[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}Tl.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Cl{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Cl(void 0===this.value.clone?this.value:this.value.clone())}}class Rl extends as{constructor(e,t,n=1){super(e,t),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}Rl.prototype.isInstancedInterleavedBuffer=!0;class Il{constructor(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}Il.prototype.isGLBufferAttribute=!0;function Ol(e,t){return e.distance-t.distance}function xl(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r){const r=e.children;for(let e=0,i=r.length;e<i;e++)xl(r[e],t,n,!0)}}const Nl=new Re;class Bl{constructor(e=new Re(1/0,1/0),t=new Re(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Nl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Nl.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Bl.prototype.isBox2=!0;const Ll=new et,Dl=new et;class Ml{constructor(e=new et,t=new et){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Ll.subVectors(e,this.start),Dl.subVectors(this.end,this.start);const n=Dl.dot(Dl);let r=Dl.dot(Ll)/n;return t&&(r=_e(r,0,1)),r}closestPointToPoint(e,t,n){const r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Pl=new et;const kl=new et,Ul=new Nt,Fl=new Nt;class Hl extends ta{constructor(e){const t=Vl(e),n=new Un,r=[],i=[],o=new Fe(0,0,1),s=new Fe(0,1,0);for(let e=0;e<t.length;e++){const n=t[e];n.parent&&n.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),i.push(o.r,o.g,o.b),i.push(s.r,s.g,s.b))}n.setAttribute("position",new On(r,3)),n.setAttribute("color",new On(i,3));super(n,new Ws({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,r=n.getAttribute("position");Fl.copy(this.root.matrixWorld).invert();for(let e=0,n=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(Ul.multiplyMatrices(Fl,i.matrixWorld),kl.setFromMatrixPosition(Ul),r.setXYZ(n,kl.x,kl.y,kl.z),Ul.multiplyMatrices(Fl,i.parent.matrixWorld),kl.setFromMatrixPosition(Ul),r.setXYZ(n+1,kl.x,kl.y,kl.z),n+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function Vl(e){const t=[];!0===e.isBone&&t.push(e);for(let n=0;n<e.children.length;n++)t.push.apply(t,Vl(e.children[n]));return t}const Ql=new et,jl=new Fe,Gl=new Fe;class Kl extends ta{constructor(e=10,t=10,n=4473924,r=8947848){n=new Fe(n),r=new Fe(r);const i=t/2,o=e/t,s=e/2,a=[],c=[];for(let e=0,u=0,l=-s;e<=t;e++,l+=o){a.push(-s,0,l,s,0,l),a.push(l,0,-s,l,0,s);const t=e===i?n:r;t.toArray(c,u),u+=3,t.toArray(c,u),u+=3,t.toArray(c,u),u+=3,t.toArray(c,u),u+=3}const u=new Un;u.setAttribute("position",new On(a,3)),u.setAttribute("color",new On(c,3));super(u,new Ws({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}const Wl=new et,zl=new et,ql=new et;const Yl=new et,Xl=new ur;function Jl(e,t,n,r,i,o,s){Yl.set(i,o,s).unproject(r);const a=t[e];if(void 0!==a){const e=n.getAttribute("position");for(let t=0,n=a.length;t<n;t++)e.setXYZ(a[t],Yl.x,Yl.y,Yl.z)}}const Zl=new rt;class $l extends ta{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),i=new Un;i.setIndex(new _n(n,1)),i.setAttribute("position",new _n(r,3)),super(i,new Ws({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Zl.setFromObject(this.object),Zl.isEmpty())return;const t=Zl.min,n=Zl.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=t.x,i[4]=n.y,i[5]=n.z,i[6]=t.x,i[7]=t.y,i[8]=n.z,i[9]=n.x,i[10]=t.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=t.z,i[15]=t.x,i[16]=n.y,i[17]=t.z,i[18]=t.x,i[19]=t.y,i[20]=t.z,i[21]=n.x,i[22]=t.y,i[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return ta.prototype.copy.call(this,e),this.object=e.object,this}}const eA=new et;let tA,nA;class rA extends ta{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=new Un;n.setAttribute("position",new On(t,3)),n.setAttribute("color",new On([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(n,new Ws({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,n){const r=new Fe,i=this.geometry.attributes.color.array;return r.set(e),r.toArray(i,0),r.toArray(i,3),r.set(t),r.toArray(i,6),r.toArray(i,9),r.set(n),r.toArray(i,12),r.toArray(i,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}const iA=new Float32Array(1),oA=new Int32Array(iA.buffer);Sa.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Sa.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Ka.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},Kl.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Hl.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Au.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Uu.extractUrlBase(e)},Au.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Bl.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Bl.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Bl.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Bl.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},rt.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},rt.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},rt.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},rt.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},rt.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Vt.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")},bt.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Er.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Ml.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Ie.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Ie.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Ie.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Ie.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Ie.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Ie.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Nt.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Nt.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Nt.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new et).setFromMatrixColumn(this,3)},Nt.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Nt.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Nt.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Nt.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Nt.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Nt.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Nt.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Nt.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Nt.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Nt.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Nt.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Nt.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Nt.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Nt.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Nt.prototype.makeFrustum=function(e,t,n,r,i,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,o)},Nt.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},vr.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},$e.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},$e.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},xt.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},xt.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},xt.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},pn.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},pn.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},pn.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},pn.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},pn.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},pn.barycoordFromPoint=function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),pn.getBarycoord(e,t,n,r,i)},pn.normal=function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),pn.getNormal(e,t,n,r)},Wa.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},Wa.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ec(this,e)},Wa.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Rc(this,e)},Re.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},Re.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Re.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},et.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},et.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},et.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},et.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},et.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},et.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},et.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},et.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},et.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},We.prototype.fromAttribute=function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},We.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},nn.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},nn.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},nn.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},nn.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},nn.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(nn.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),nr.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(nr.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Ds.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},lr.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(vu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(_n.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Ae},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Ae)}}}),_n.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Ae:le),this},_n.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},_n.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Un.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},Un.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new _n(arguments[1],arguments[2])))},Un.prototype.addDrawCall=function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},Un.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},Un.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},Un.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},Un.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Un.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),as.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?Ae:le),this},as.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},Ec.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},Ec.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},Ec.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},ss.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Cl.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(gn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Fe}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(cr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),ns.prototype.clearTarget=function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},ns.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},ns.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},ns.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},ns.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},ns.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},ns.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},ns.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},ns.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},ns.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},ns.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},ns.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},ns.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},ns.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},ns.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},ns.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},ns.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},ns.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},ns.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},ns.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},ns.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},ns.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},ns.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},ns.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},ns.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(ns.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?ce:ae}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}}),Object.defineProperties(Ko.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(ze.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),ol.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new zu).load(e,(function(e){t.setBuffer(e)})),this},ll.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},hr.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},hr.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)},Ve.crossOrigin=void 0,Ve.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const i=new mu;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Ve.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const i=new fu;i.setCrossOrigin(this.crossOrigin);const o=i.load(e,n,void 0,r);return t&&(o.mapping=t),o},Ve.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Ve.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const sA={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t),e.ACESFilmicToneMapping=4,e.AddEquation=n,e.AddOperation=2,e.AdditiveAnimationBlendMode=se,e.AdditiveBlending=2,e.AlphaFormat=1021,e.AlwaysDepth=1,e.AlwaysStencilFunc=519,e.AmbientLight=Lu,e.AmbientLightProbe=Yu,e.AnimationClip=su,e.AnimationLoader=class extends Au{constructor(e){super(e)}load(e,t,n,r){const i=this,o=new du(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(t){r?r(t):console.error(t),i.manager.itemError(e)}}),n,r)}parse(e){const t=[];for(let n=0;n<e.length;n++){const r=su.parse(e[n]);t.push(r)}return t}},e.AnimationMixer=Tl,e.AnimationObjectGroup=wl,e.AnimationUtils=zc,e.ArcCurve=Ca,e.ArrayCamera=Yo,e.ArrowHelper=class extends nn{constructor(e=new et(0,0,1),t=new et(0,0,0),n=1,r=16776960,i=.2*n,o=.2*i){super(),this.type="ArrowHelper",void 0===tA&&(tA=new Un,tA.setAttribute("position",new On([0,0,0,0,1,0],3)),nA=new fa(0,.5,1,5,1),nA.translate(0,-.5,0)),this.position.copy(t),this.line=new Zs(tA,new Ws({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new nr(nA,new mn({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{eA.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(eA,t)}}setLength(e,t=.2*e,n=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}},e.Audio=ol,e.AudioAnalyser=ll,e.AudioContext=Wu,e.AudioListener=class extends nn{constructor(){super(),this.type="AudioListener",this.context=Wu.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new $u}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(tl,nl,rl),il.set(0,0,-1).applyQuaternion(nl),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(tl.x,e),t.positionY.linearRampToValueAtTime(tl.y,e),t.positionZ.linearRampToValueAtTime(tl.z,e),t.forwardX.linearRampToValueAtTime(il.x,e),t.forwardY.linearRampToValueAtTime(il.y,e),t.forwardZ.linearRampToValueAtTime(il.z,e),t.upX.linearRampToValueAtTime(n.x,e),t.upY.linearRampToValueAtTime(n.y,e),t.upZ.linearRampToValueAtTime(n.z,e)}else t.setPosition(tl.x,tl.y,tl.z),t.setOrientation(il.x,il.y,il.z,n.x,n.y,n.z)}},e.AudioLoader=zu,e.AxesHelper=rA,e.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new rA(e)},e.BackSide=1,e.BasicDepthPacking=3200,e.BasicShadowMap=0,e.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new gu(e)},e.Bone=Ms,e.BooleanKeyframeTrack=$c,e.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new $l(e,t)},e.Box2=Bl,e.Box3=rt,e.Box3Helper=class extends ta{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Un;r.setIndex(new _n(n,1)),r.setAttribute("position",new On([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(r,new Ws({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}},e.BoxBufferGeometry=ir,e.BoxGeometry=ir,e.BoxHelper=$l,e.BufferAttribute=_n,e.BufferGeometry=Un,e.BufferGeometryLoader=Hu,e.ByteType=1010,e.Cache=cu,e.Camera=ur,e.CameraHelper=class extends ta{constructor(e){const t=new Un,n=new Ws({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],i=[],o={},s=new Fe(16755200),a=new Fe(16711680),c=new Fe(43775),u=new Fe(16777215),l=new Fe(3355443);function A(e,t,n){h(e,n),h(t,n)}function h(e,t){r.push(0,0,0),i.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}A("n1","n2",s),A("n2","n4",s),A("n4","n3",s),A("n3","n1",s),A("f1","f2",s),A("f2","f4",s),A("f4","f3",s),A("f3","f1",s),A("n1","f1",s),A("n2","f2",s),A("n3","f3",s),A("n4","f4",s),A("p","n1",a),A("p","n2",a),A("p","n3",a),A("p","n4",a),A("u1","u2",c),A("u2","u3",c),A("u3","u1",c),A("c","t",u),A("p","c",l),A("cn1","cn2",l),A("cn3","cn4",l),A("cf1","cf2",l),A("cf3","cf4",l),t.setAttribute("position",new On(r,3)),t.setAttribute("color",new On(i,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}update(){const e=this.geometry,t=this.pointMap;Xl.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Jl("c",t,e,Xl,0,0,-1),Jl("t",t,e,Xl,0,0,1),Jl("n1",t,e,Xl,-1,-1,-1),Jl("n2",t,e,Xl,1,-1,-1),Jl("n3",t,e,Xl,-1,1,-1),Jl("n4",t,e,Xl,1,1,-1),Jl("f1",t,e,Xl,-1,-1,1),Jl("f2",t,e,Xl,1,-1,1),Jl("f3",t,e,Xl,-1,1,1),Jl("f4",t,e,Xl,1,1,1),Jl("u1",t,e,Xl,.7,1.1,-1),Jl("u2",t,e,Xl,-.7,1.1,-1),Jl("u3",t,e,Xl,0,2,-1),Jl("cf1",t,e,Xl,-1,0,1),Jl("cf2",t,e,Xl,1,0,1),Jl("cf3",t,e,Xl,0,-1,1),Jl("cf4",t,e,Xl,0,1,1),Jl("cn1",t,e,Xl,-1,0,-1),Jl("cn2",t,e,Xl,1,0,-1),Jl("cn3",t,e,Xl,0,-1,-1),Jl("cn4",t,e,Xl,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},e.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},e.CanvasTexture=da,e.CatmullRomCurve3=Ba,e.CineonToneMapping=3,e.CircleBufferGeometry=pa,e.CircleGeometry=pa,e.ClampToEdgeWrapping=A,e.Clock=$u,e.Color=Fe,e.ColorKeyframeTrack=eu,e.CompressedTexture=ha,e.CompressedTextureLoader=class extends Au{constructor(e){super(e)}load(e,t,n,r){const i=this,o=[],s=new ha,a=new du(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials);let c=0;function u(u){a.load(e[u],(function(e){const n=i.parse(e,!0);o[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},c+=1,6===c&&(1===n.mipmapCount&&(s.minFilter=g),s.image=o,s.format=n.format,s.needsUpdate=!0,t&&t(s))}),n,r)}if(Array.isArray(e))for(let t=0,n=e.length;t<n;++t)u(t);else a.load(e,(function(e){const n=i.parse(e,!0);if(n.isCubemap){const e=n.mipmaps.length/n.mipmapCount;for(let t=0;t<e;t++){o[t]={mipmaps:[]};for(let e=0;e<n.mipmapCount;e++)o[t].mipmaps.push(n.mipmaps[t*n.mipmapCount+e]),o[t].format=n.format,o[t].width=n.width,o[t].height=n.height}s.image=o}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=g),s.format=n.format,s.needsUpdate=!0,t&&t(s)}),n,r);return s}},e.ConeBufferGeometry=ga,e.ConeGeometry=ga,e.CubeCamera=hr,e.CubeReflectionMapping=i,e.CubeRefractionMapping=o,e.CubeTexture=dr,e.CubeTextureLoader=fu,e.CubeUVReflectionMapping=c,e.CubeUVRefractionMapping=u,e.CubicBezierCurve=Pa,e.CubicBezierCurve3=ka,e.CubicInterpolant=Yc,e.CullFaceBack=1,e.CullFaceFront=2,e.CullFaceFrontBack=3,e.CullFaceNone=0,e.Curve=Sa,e.CurvePath=Ga,e.CustomBlending=5,e.CustomToneMapping=5,e.CylinderBufferGeometry=fa,e.CylinderGeometry=fa,e.Cylindrical=class{constructor(e=1,t=0,n=0){return this.radius=e,this.theta=t,this.y=n,this}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return(new this.constructor).copy(this)}},e.Data3DTexture=Xe,e.DataArrayTexture=qe,e.DataTexture=Ps,e.DataTexture2DArray=function(e,t,n,r){return console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),new qe(e,t,n,r)},e.DataTexture3D=function(e,t,n,r){return console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),new Xe(e,t,n,r)},e.DataTextureLoader=gu,e.DataUtils=class{static toHalfFloat(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),iA[0]=e;const t=oA[0];let n=t>>16&32768,r=t>>12&2047;const i=t>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&t,n):i<113?(r|=2048,n|=(r>>114-i)+(r>>113-i&1),n):(n|=i-112<<10|r>>1,n+=1&r,n)}},e.DecrementStencilOp=7683,e.DecrementWrapStencilOp=34056,e.DefaultLoadingManager=lu,e.DepthFormat=C,e.DepthStencilFormat=R,e.DepthTexture=$o,e.DirectionalLight=Bu,e.DirectionalLightHelper=class extends nn{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===t&&(t=1);let r=new Un;r.setAttribute("position",new On([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const i=new Ws({fog:!1,toneMapped:!1});this.lightPlane=new Zs(r,i),this.add(this.lightPlane),r=new Un,r.setAttribute("position",new On([0,0,0,0,0,1],3)),this.targetLine=new Zs(r,i),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Wl.setFromMatrixPosition(this.light.matrixWorld),zl.setFromMatrixPosition(this.light.target.matrixWorld),ql.subVectors(zl,Wl),this.lightPlane.lookAt(zl),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(zl),this.targetLine.scale.z=ql.length()}},e.DiscreteInterpolant=Jc,e.DodecahedronBufferGeometry=va,e.DodecahedronGeometry=va,e.DoubleSide=2,e.DstAlphaFactor=206,e.DstColorFactor=208,e.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new _n(e,t).setUsage(Ae)},e.DynamicCopyUsage=35050,e.DynamicDrawUsage=Ae,e.DynamicReadUsage=35049,e.EdgesGeometry=wa,e.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new ta(new wa(e.geometry),new Ws({color:void 0!==t?t:16777215}))},e.EllipseCurve=Ta,e.EqualDepth=4,e.EqualStencilFunc=514,e.EquirectangularReflectionMapping=s,e.EquirectangularRefractionMapping=a,e.Euler=Vt,e.EventDispatcher=pe,e.ExtrudeBufferGeometry=Ec,e.ExtrudeGeometry=Ec,e.FaceColors=1,e.FileLoader=du,e.FlatShading=1,e.Float16BufferAttribute=In,e.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new On(e,t)},e.Float32BufferAttribute=On,e.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new xn(e,t)},e.Float64BufferAttribute=xn,e.FloatType=b,e.Fog=os,e.FogExp2=is,e.Font=function(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")},e.FontLoader=function(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")},e.FramebufferTexture=Aa,e.FrontSide=0,e.Frustum=Er,e.GLBufferAttribute=Il,e.GLSL1="100",e.GLSL3=he,e.GreaterDepth=6,e.GreaterEqualDepth=5,e.GreaterEqualStencilFunc=518,e.GreaterStencilFunc=516,e.GridHelper=Kl,e.Group=Xo,e.HalfFloatType=w,e.HemisphereLight=yu,e.HemisphereLightHelper=class extends nn{constructor(e,t,n){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new Tc(t);r.rotateY(.5*Math.PI),this.material=new mn({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const i=r.getAttribute("position"),o=new Float32Array(3*i.count);r.setAttribute("color",new _n(o,3)),this.add(new nr(r,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");jl.copy(this.light.color),Gl.copy(this.light.groundColor);for(let e=0,n=t.count;e<n;e++){const r=e<n/2?jl:Gl;t.setXYZ(e,r.r,r.g,r.b)}t.needsUpdate=!0}e.lookAt(Ql.setFromMatrixPosition(this.light.matrixWorld).negate())}},e.HemisphereLightProbe=qu,e.IcosahedronBufferGeometry=wc,e.IcosahedronGeometry=wc,e.ImageBitmapLoader=Gu,e.ImageLoader=pu,e.ImageUtils=Ve,e.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")},e.IncrementStencilOp=7682,e.IncrementWrapStencilOp=34055,e.InstancedBufferAttribute=Hs,e.InstancedBufferGeometry=Fu,e.InstancedInterleavedBuffer=Rl,e.InstancedMesh=Ks,e.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Sn(e,t)},e.Int16BufferAttribute=Sn,e.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Cn(e,t)},e.Int32BufferAttribute=Cn,e.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new En(e,t)},e.Int8BufferAttribute=En,e.IntType=1013,e.InterleavedBuffer=as,e.InterleavedBufferAttribute=us,e.Interpolant=qc,e.InterpolateDiscrete=$,e.InterpolateLinear=ee,e.InterpolateSmooth=te,e.InvertStencilOp=5386,e.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},e.KeepStencilOp=ue,e.KeyframeTrack=Zc,e.LOD=Is,e.LatheBufferGeometry=Sc,e.LatheGeometry=Sc,e.Layers=Qt,e.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")},e.LessDepth=2,e.LessEqualDepth=3,e.LessEqualStencilFunc=515,e.LessStencilFunc=513,e.Light=vu,e.LightProbe=Pu,e.Line=Zs,e.Line3=Ml,e.LineBasicMaterial=Ws,e.LineCurve=Ua,e.LineCurve3=Fa,e.LineDashedMaterial=Kc,e.LineLoop=na,e.LinePieces=1,e.LineSegments=ta,e.LineStrip=0,e.LinearEncoding=ae,e.LinearFilter=g,e.LinearInterpolant=Xc,e.LinearMipMapLinearFilter=1008,e.LinearMipMapNearestFilter=1007,e.LinearMipmapLinearFilter=v,e.LinearMipmapNearestFilter=m,e.LinearToneMapping=1,e.Loader=Au,e.LoaderUtils=Uu,e.LoadingManager=uu,e.LoopOnce=2200,e.LoopPingPong=2202,e.LoopRepeat=2201,e.LuminanceAlphaFormat=1025,e.LuminanceFormat=1024,e.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},e.Material=gn,e.MaterialLoader=ku,e.Math=Ce,e.MathUtils=Ce,e.Matrix3=Ie,e.Matrix4=Nt,e.MaxEquation=104,e.Mesh=nr,e.MeshBasicMaterial=mn,e.MeshDepthMaterial=jo,e.MeshDistanceMaterial=Go,e.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},e.MeshLambertMaterial=jc,e.MeshMatcapMaterial=Gc,e.MeshNormalMaterial=Qc,e.MeshPhongMaterial=Hc,e.MeshPhysicalMaterial=Fc,e.MeshStandardMaterial=Uc,e.MeshToonMaterial=Vc,e.MinEquation=103,e.MirroredRepeatWrapping=h,e.MixOperation=1,e.MultiMaterial=function(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},e.MultiplyBlending=4,e.MultiplyOperation=0,e.NearestFilter=d,e.NearestMipMapLinearFilter=1005,e.NearestMipMapNearestFilter=1004,e.NearestMipmapLinearFilter=f,e.NearestMipmapNearestFilter=p,e.NeverDepth=0,e.NeverStencilFunc=512,e.NoBlending=0,e.NoColors=0,e.NoToneMapping=0,e.NormalAnimationBlendMode=oe,e.NormalBlending=1,e.NotEqualDepth=7,e.NotEqualStencilFunc=517,e.NumberKeyframeTrack=tu,e.Object3D=nn,e.ObjectLoader=class extends Au{constructor(e){super(e)}load(e,t,n,r){const i=this,o=""===this.path?Uu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const s=new du(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){let o=null;try{o=JSON.parse(n)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?i.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)}async loadAsync(e,t){const n=""===this.path?Uu.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||n;const r=new du(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const i=await r.loadAsync(e,t),o=JSON.parse(i),s=o.metadata;if(void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(o)}parse(e,t){const n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,r),o=this.parseImages(e.images,(function(){void 0!==t&&t(c)})),s=this.parseTextures(e.textures,o),a=this.parseMaterials(e.materials,s),c=this.parseObject(e.object,i,a,s,n),u=this.parseSkeletons(e.skeletons,c);if(this.bindSkeletons(c,u),void 0!==t){let e=!1;for(const t in o)if(o[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(c)}return c}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),r=this.parseGeometries(e.geometries,n),i=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,r,s,o,t),c=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,c),a}parseShapes(e){const t={};if(void 0!==e)for(let n=0,r=e.length;n<r;n++){const r=(new Wa).fromJSON(e[n]);t[r.uuid]=r}return t}parseSkeletons(e,t){const n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(let t=0,i=e.length;t<i;t++){const i=(new Fs).fromJSON(e[t],r);n[i.uuid]=i}return n}parseGeometries(e,t){const n={};if(void 0!==e){const r=new Hu;for(let i=0,o=e.length;i<o;i++){let o;const s=e[i];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(s);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:s.type in Mc?o=Mc[s.type].fromJSON(s,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${s.type}"`)}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}}return n}parseMaterials(e,t){const n={},r={};if(void 0!==e){const i=new ku;i.setTextures(t);for(let t=0,o=e.length;t<o;t++){const o=e[t];if("MultiMaterial"===o.type){const e=[];for(let t=0;t<o.materials.length;t++){const r=o.materials[t];void 0===n[r.uuid]&&(n[r.uuid]=i.parse(r)),e.push(n[r.uuid])}r[o.uuid]=e}else void 0===n[o.uuid]&&(n[o.uuid]=i.parse(o)),r[o.uuid]=n[o.uuid]}}return r}parseAnimations(e){const t={};if(void 0!==e)for(let n=0;n<e.length;n++){const r=e[n],i=su.parse(r);t[i.uuid]=i}return t}parseImages(e,t){const n=this,r={};let i;function o(e){if("string"==typeof e){const t=e;return function(e){return n.manager.itemStart(e),i.load(e,(function(){n.manager.itemEnd(e)}),void 0,(function(){n.manager.itemError(e),n.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:n.resourcePath+t)}return e.data?{data:Ne(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const n=new uu(t);i=new pu(n),i.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],i=n.url;if(Array.isArray(i)){const e=[];for(let t=0,n=i.length;t<n;t++){const n=o(i[t]);null!==n&&(n instanceof HTMLImageElement?e.push(n):e.push(new Ps(n.data,n.width,n.height)))}r[n.uuid]=new Qe(e)}else{const e=o(n.url);r[n.uuid]=new Qe(e)}}}return r}async parseImagesAsync(e){const t=this,n={};let r;async function i(e){if("string"==typeof e){const n=e,i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(n)?n:t.resourcePath+n;return await r.loadAsync(i)}return e.data?{data:Ne(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){r=new pu(this.manager),r.setCrossOrigin(this.crossOrigin);for(let t=0,r=e.length;t<r;t++){const r=e[t],o=r.url;if(Array.isArray(o)){const e=[];for(let t=0,n=o.length;t<n;t++){const n=o[t],r=await i(n);null!==r&&(r instanceof HTMLImageElement?e.push(r):e.push(new Ps(r.data,r.width,r.height)))}n[r.uuid]=new Qe(e)}else{const e=await i(r.url);n[r.uuid]=new Qe(e)}}}return n}parseTextures(e,t){function n(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const r={};if(void 0!==e)for(let i=0,o=e.length;i<o;i++){const o=e[i];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);const s=t[o.image],a=s.data;let c;Array.isArray(a)?(c=new dr,6===a.length&&(c.needsUpdate=!0)):(c=a&&a.data?new Ps:new Ke,a&&(c.needsUpdate=!0)),c.source=s,c.uuid=o.uuid,void 0!==o.name&&(c.name=o.name),void 0!==o.mapping&&(c.mapping=n(o.mapping,Vu)),void 0!==o.offset&&c.offset.fromArray(o.offset),void 0!==o.repeat&&c.repeat.fromArray(o.repeat),void 0!==o.center&&c.center.fromArray(o.center),void 0!==o.rotation&&(c.rotation=o.rotation),void 0!==o.wrap&&(c.wrapS=n(o.wrap[0],Qu),c.wrapT=n(o.wrap[1],Qu)),void 0!==o.format&&(c.format=o.format),void 0!==o.type&&(c.type=o.type),void 0!==o.encoding&&(c.encoding=o.encoding),void 0!==o.minFilter&&(c.minFilter=n(o.minFilter,ju)),void 0!==o.magFilter&&(c.magFilter=n(o.magFilter,ju)),void 0!==o.anisotropy&&(c.anisotropy=o.anisotropy),void 0!==o.flipY&&(c.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(c.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(c.unpackAlignment=o.unpackAlignment),void 0!==o.userData&&(c.userData=o.userData),r[o.uuid]=c}return r}parseObject(e,t,n,r,i){let o,s,a;function c(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function u(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let r=0,i=e.length;r<i;r++){const i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function l(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":o=new ss,void 0!==e.background&&(Number.isInteger(e.background)?o.background=new Fe(e.background):o.background=l(e.background)),void 0!==e.environment&&(o.environment=l(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?o.fog=new os(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(o.fog=new is(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":o=new lr(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(o.focus=e.focus),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.filmGauge&&(o.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(o.filmOffset=e.filmOffset),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new Dr(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(o.zoom=e.zoom),void 0!==e.view&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new Lu(e.color,e.intensity);break;case"DirectionalLight":o=new Bu(e.color,e.intensity);break;case"PointLight":o=new xu(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new Du(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new Tu(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":o=new yu(e.color,e.groundColor,e.intensity);break;case"LightProbe":o=(new Pu).fromJSON(e);break;case"SkinnedMesh":s=c(e.geometry),a=u(e.material),o=new Ds(s,a),void 0!==e.bindMode&&(o.bindMode=e.bindMode),void 0!==e.bindMatrix&&o.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(o.skeleton=e.skeleton);break;case"Mesh":s=c(e.geometry),a=u(e.material),o=new nr(s,a);break;case"InstancedMesh":s=c(e.geometry),a=u(e.material);const t=e.count,n=e.instanceMatrix,r=e.instanceColor;o=new Ks(s,a,t),o.instanceMatrix=new Hs(new Float32Array(n.array),16),void 0!==r&&(o.instanceColor=new Hs(new Float32Array(r.array),r.itemSize));break;case"LOD":o=new Is;break;case"Line":o=new Zs(c(e.geometry),u(e.material));break;case"LineLoop":o=new na(c(e.geometry),u(e.material));break;case"LineSegments":o=new ta(c(e.geometry),u(e.material));break;case"PointCloud":case"Points":o=new ca(c(e.geometry),u(e.material));break;case"Sprite":o=new Ss(u(e.material));break;case"Group":o=new Xo;break;case"Bone":o=new Ms;break;default:o=new nn}if(o.uuid=e.uuid,void 0!==e.name&&(o.name=e.name),void 0!==e.matrix?(o.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(void 0!==e.position&&o.position.fromArray(e.position),void 0!==e.rotation&&o.rotation.fromArray(e.rotation),void 0!==e.quaternion&&o.quaternion.fromArray(e.quaternion),void 0!==e.scale&&o.scale.fromArray(e.scale)),void 0!==e.castShadow&&(o.castShadow=e.castShadow),void 0!==e.receiveShadow&&(o.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(o.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(o.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(o.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&o.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(o.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(o.visible=e.visible),void 0!==e.frustumCulled&&(o.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(o.renderOrder=e.renderOrder),void 0!==e.userData&&(o.userData=e.userData),void 0!==e.layers&&(o.layers.mask=e.layers),void 0!==e.children){const s=e.children;for(let e=0;e<s.length;e++)o.add(this.parseObject(s[e],t,n,r,i))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const n=t[e];o.animations.push(i[n])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(o.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const n=t[e],r=o.getObjectByProperty("uuid",n.object);void 0!==r&&o.addLevel(r,n.distance)}}return o}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}},e.ObjectSpaceNormalMap=1,e.OctahedronBufferGeometry=Tc,e.OctahedronGeometry=Tc,e.OneFactor=201,e.OneMinusDstAlphaFactor=207,e.OneMinusDstColorFactor=209,e.OneMinusSrcAlphaFactor=205,e.OneMinusSrcColorFactor=203,e.OrthographicCamera=Dr,e.PCFShadowMap=1,e.PCFSoftShadowMap=2,e.PMREMGenerator=jr,e.ParametricGeometry=function(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new Un},e.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Ss(e)},e.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new ra(e)},e.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new ca(e,t)},e.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new ra(e)},e.Path=Ka,e.PerspectiveCamera=lr,e.Plane=vr,e.PlaneBufferGeometry=Sr,e.PlaneGeometry=Sr,e.PlaneHelper=class extends Zs{constructor(e,t=1,n=16776960){const r=n,i=new Un;i.setAttribute("position",new On([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),i.computeBoundingSphere(),super(i,new Ws({color:r,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const o=new Un;o.setAttribute("position",new On([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new nr(o,new mn({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?1:0,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}},e.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new ca(e,t)},e.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new ra(e)},e.PointLight=xu,e.PointLightHelper=class extends nr{constructor(e,t,n){super(new Ic(t,4,2),new mn({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},e.Points=ca,e.PointsMaterial=ra,e.PolarGridHelper=class extends ta{constructor(e=10,t=16,n=8,r=64,i=4473924,o=8947848){i=new Fe(i),o=new Fe(o);const s=[],a=[];for(let n=0;n<=t;n++){const r=n/t*(2*Math.PI),c=Math.sin(r)*e,u=Math.cos(r)*e;s.push(0,0,0),s.push(c,0,u);const l=1&n?i:o;a.push(l.r,l.g,l.b),a.push(l.r,l.g,l.b)}for(let t=0;t<=n;t++){const c=1&t?i:o,u=e-e/n*t;for(let e=0;e<r;e++){let t=e/r*(2*Math.PI),n=Math.sin(t)*u,i=Math.cos(t)*u;s.push(n,0,i),a.push(c.r,c.g,c.b),t=(e+1)/r*(2*Math.PI),n=Math.sin(t)*u,i=Math.cos(t)*u,s.push(n,0,i),a.push(c.r,c.g,c.b)}}const c=new Un;c.setAttribute("position",new On(s,3)),c.setAttribute("color",new On(a,3));super(c,new Ws({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},e.PolyhedronBufferGeometry=ma,e.PolyhedronGeometry=ma,e.PositionalAudio=class extends ol{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(sl,al,cl),ul.set(0,0,1).applyQuaternion(al);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(sl.x,e),t.positionY.linearRampToValueAtTime(sl.y,e),t.positionZ.linearRampToValueAtTime(sl.z,e),t.orientationX.linearRampToValueAtTime(ul.x,e),t.orientationY.linearRampToValueAtTime(ul.y,e),t.orientationZ.linearRampToValueAtTime(ul.z,e)}else t.setPosition(sl.x,sl.y,sl.z),t.setOrientation(ul.x,ul.y,ul.z)}},e.PropertyBinding=bl,e.PropertyMixer=Al,e.QuadraticBezierCurve=Ha,e.QuadraticBezierCurve3=Va,e.Quaternion=$e,e.QuaternionKeyframeTrack=ru,e.QuaternionLinearInterpolant=nu,e.REVISION=t,e.RGBADepthPacking=3201,e.RGBAFormat=T,e.RGBAIntegerFormat=1033,e.RGBA_ASTC_10x10_Format=Y,e.RGBA_ASTC_10x5_Format=W,e.RGBA_ASTC_10x6_Format=z,e.RGBA_ASTC_10x8_Format=q,e.RGBA_ASTC_12x10_Format=X,e.RGBA_ASTC_12x12_Format=J,e.RGBA_ASTC_4x4_Format=U,e.RGBA_ASTC_5x4_Format=F,e.RGBA_ASTC_5x5_Format=H,e.RGBA_ASTC_6x5_Format=V,e.RGBA_ASTC_6x6_Format=Q,e.RGBA_ASTC_8x5_Format=j,e.RGBA_ASTC_8x6_Format=G,e.RGBA_ASTC_8x8_Format=K,e.RGBA_BPTC_Format=Z,e.RGBA_ETC2_EAC_Format=k,e.RGBA_PVRTC_2BPPV1_Format=M,e.RGBA_PVRTC_4BPPV1_Format=D,e.RGBA_S3TC_DXT1_Format=O,e.RGBA_S3TC_DXT3_Format=x,e.RGBA_S3TC_DXT5_Format=N,e.RGBFormat=1022,e.RGB_ETC1_Format=36196,e.RGB_ETC2_Format=P,e.RGB_PVRTC_2BPPV1_Format=L,e.RGB_PVRTC_4BPPV1_Format=B,e.RGB_S3TC_DXT1_Format=I,e.RGFormat=1030,e.RGIntegerFormat=1031,e.RawShaderMaterial=kc,e.Ray=xt,e.Raycaster=class{constructor(e,t,n=0,r=1/0){this.ray=new xt(e,t),this.near=n,this.far=r,this.camera=null,this.layers=new Qt,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return xl(e,this,n,t),n.sort(Ol),n}intersectObjects(e,t=!0,n=[]){for(let r=0,i=e.length;r<i;r++)xl(e[r],this,n,t);return n.sort(Ol),n}},e.RectAreaLight=Du,e.RedFormat=1028,e.RedIntegerFormat=1029,e.ReinhardToneMapping=2,e.RepeatWrapping=l,e.ReplaceStencilOp=7681,e.ReverseSubtractEquation=102,e.RingBufferGeometry=Cc,e.RingGeometry=Cc,e.Scene=ss,e.SceneUtils=sA,e.ShaderChunk=Tr,e.ShaderLib=Rr,e.ShaderMaterial=cr,e.ShadowMaterial=Pc,e.Shape=Wa,e.ShapeBufferGeometry=Rc,e.ShapeGeometry=Rc,e.ShapePath=class{constructor(){this.type="ShapePath",this.color=new Fe,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Ka,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}bezierCurveTo(e,t,n,r,i,o){return this.currentPath.bezierCurveTo(e,t,n,r,i,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function n(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n],i=new Wa;i.curves=r.curves,t.push(i)}return t}function r(e,t){const n=t.length;let r=!1;for(let i=n-1,o=0;o<n;i=o++){let n=t[i],s=t[o],a=s.x-n.x,c=s.y-n.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(n=t[o],a=-a,s=t[i],c=-c),e.y<n.y||e.y>s.y)continue;if(e.y===n.y){if(e.x===n.x)return!0}else{const t=c*(e.x-n.x)-a*(e.y-n.y);if(0===t)return!0;if(t<0)continue;r=!r}}else{if(e.y!==n.y)continue;if(s.x<=e.x&&e.x<=n.x||n.x<=e.x&&e.x<=s.x)return!0}}return r}const i=vc.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return n(o);let s,a,c;const u=[];if(1===o.length)return a=o[0],c=new Wa,c.curves=a.curves,u.push(c),u;let l=!i(o[0].getPoints());l=e?!l:l;const A=[],h=[];let d,p,f=[],g=0;h[g]=void 0,f[g]=[];for(let t=0,n=o.length;t<n;t++)a=o[t],d=a.getPoints(),s=i(d),s=e?!s:s,s?(!l&&h[g]&&g++,h[g]={s:new Wa,p:d},h[g].s.curves=a.curves,l&&g++,f[g]=[]):f[g].push({h:a,p:d[0]});if(!h[0])return n(o);if(h.length>1){let e=!1,t=0;for(let e=0,t=h.length;e<t;e++)A[e]=[];for(let n=0,i=h.length;n<i;n++){const i=f[n];for(let o=0;o<i.length;o++){const s=i[o];let a=!0;for(let i=0;i<h.length;i++)r(s.p,h[i].p)&&(n!==i&&t++,a?(a=!1,A[i].push(s)):e=!0);a&&A[n].push(s)}}t>0&&!1===e&&(f=A)}for(let e=0,t=h.length;e<t;e++){c=h[e].s,u.push(c),p=f[e];for(let e=0,t=p.length;e<t;e++)c.holes.push(p[e].h)}return u}},e.ShapeUtils=vc,e.ShortType=1011,e.Skeleton=Fs,e.SkeletonHelper=Hl,e.SkinnedMesh=Ds,e.SmoothShading=2,e.Sphere=bt,e.SphereBufferGeometry=Ic,e.SphereGeometry=Ic,e.Spherical=class{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(_e(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},e.SphericalHarmonics3=Mu,e.SplineCurve=Qa,e.SpotLight=Tu,e.SpotLightHelper=class extends nn{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const n=new Un,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,n=32;e<n;e++,t++){const i=e/n*Math.PI*2,o=t/n*Math.PI*2;r.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}n.setAttribute("position",new On(r,3));const i=new Ws({fog:!1,toneMapped:!1});this.cone=new ta(n,i),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Pl.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Pl),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},e.Sprite=Ss,e.SpriteMaterial=ls,e.SrcAlphaFactor=204,e.SrcAlphaSaturateFactor=210,e.SrcColorFactor=202,e.StaticCopyUsage=35046,e.StaticDrawUsage=le,e.StaticReadUsage=35045,e.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new lr,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new lr,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Zu.copy(e.projectionMatrix);const n=t.eyeSep/2,r=n*t.near/t.focus,i=t.near*Math.tan(me*t.fov*.5)/t.zoom;let o,s;Ju.elements[12]=-n,Xu.elements[12]=n,o=-i*t.aspect+r,s=i*t.aspect+r,Zu.elements[0]=2*t.near/(s-o),Zu.elements[8]=(s+o)/(s-o),this.cameraL.projectionMatrix.copy(Zu),o=-i*t.aspect-r,s=i*t.aspect-r,Zu.elements[0]=2*t.near/(s-o),Zu.elements[8]=(s+o)/(s-o),this.cameraR.projectionMatrix.copy(Zu)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Ju),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Xu)}},e.StreamCopyUsage=35042,e.StreamDrawUsage=35040,e.StreamReadUsage=35041,e.StringKeyframeTrack=iu,e.SubtractEquation=101,e.SubtractiveBlending=3,e.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},e.TangentSpaceNormalMap=0,e.TetrahedronBufferGeometry=Oc,e.TetrahedronGeometry=Oc,e.TextGeometry=function(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new Un},e.Texture=Ke,e.TextureLoader=mu,e.TorusBufferGeometry=xc,e.TorusGeometry=xc,e.TorusKnotBufferGeometry=Nc,e.TorusKnotGeometry=Nc,e.Triangle=pn,e.TriangleFanDrawMode=2,e.TriangleStripDrawMode=1,e.TrianglesDrawMode=0,e.TubeBufferGeometry=Bc,e.TubeGeometry=Bc,e.UVMapping=r,e.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Tn(e,t)},e.Uint16BufferAttribute=Tn,e.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Rn(e,t)},e.Uint32BufferAttribute=Rn,e.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new bn(e,t)},e.Uint8BufferAttribute=bn,e.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new wn(e,t)},e.Uint8ClampedBufferAttribute=wn,e.Uniform=Cl,e.UniformsLib=Cr,e.UniformsUtils=ar,e.UnsignedByteType=y,e.UnsignedInt248Type=S,e.UnsignedIntType=E,e.UnsignedShort4444Type=1017,e.UnsignedShort5551Type=1018,e.UnsignedShortType=_,e.VSMShadowMap=3,e.Vector2=Re,e.Vector3=et,e.Vector4=We,e.VectorKeyframeTrack=ou,e.Vertex=function(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new et(e,t,n)},e.VertexColors=2,e.VideoTexture=la,e.WebGL1Renderer=rs,e.WebGL3DRenderTarget=Je,e.WebGLArrayRenderTarget=Ye,e.WebGLCubeRenderTarget=pr,e.WebGLMultipleRenderTargets=Ze,e.WebGLMultisampleRenderTarget=function(e,t,n){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.');const r=new ze(e,t,n);return r.samples=4,r},e.WebGLRenderTarget=ze,e.WebGLRenderTargetCube=function(e,t,n){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new pr(e,n)},e.WebGLRenderer=ns,e.WebGLUtils=qo,e.WireframeGeometry=Lc,e.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new ta(new Lc(e.geometry),new Ws({color:void 0!==t?t:16777215}))},e.WrapAroundEnding=ie,e.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new du(e)},e.ZeroCurvatureEnding=ne,e.ZeroFactor=200,e.ZeroSlopeEnding=re,e.ZeroStencilOp=0,e._SRGBAFormat=de,e.sRGBEncoding=ce,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=vendors.min.js.map